import{u as tl,i as sl,r as i,p as al,Q as O,o as Pn,j as e,L as eo,aX as We,aY as ra,aG as to,a5 as Fn,y as m,Z as oe,U as rl,bb as An,aZ as Bn,f as ol,g as nl,X as il,a$ as ll,aV as L,bc as dl,S as Q,G as Oa,b0 as Mn,b1 as qa,b as Wt,b2 as Zr,bd as Gt,b3 as Jr,l as It,b4 as Ye,W as Qr,au as Ha,be as cl,ak as Ua,b5 as $n,b6 as ml,b7 as ul,a1 as hl,Y as Ss,b8 as Dn,b9 as gl,t as xl,ba as fl,bf as Ln}from"./index-D5SGkqik.js";import{F as En}from"./linkFormatter-BHztCqnI.js";import{I as pl}from"./ImagePreview-DUyVAx1D.js";import{E as yl,e as bl,L as In,a as aa}from"./ExportChatModal-CLn9O_MV.js";import{P as wl}from"./PaymentModal-BrgXRcio.js";const D="https://urbansetu.onrender.com";function zl(){tl("My Appointments - Bookings");const{currentUser:o}=sl(g=>g.user),[h,C]=i.useState([]),[Kt,Zt]=i.useState([]),[pt,Le]=i.useState(!0),[Ge,Oe]=i.useState(null),[X,ye]=i.useState(""),[ee,Tt]=i.useState("all"),[Re,Y]=i.useState("all"),[me,Ee]=i.useState(1),[be,we]=i.useState(1),[ne,B]=i.useState(1),[U,E]=i.useState(1),[$,oa]=i.useState([]),[_s,W]=i.useState(""),[Ke,Ae]=i.useState(!1),[V,Ze]=i.useState(null),[ae,Pt]=i.useState(null),[je,Jt]=i.useState(""),[I,Je]=i.useState(""),[te,T]=i.useState(!1),[A,fe]=i.useState(null),[H,K]=i.useState([]),[Me,na]=i.useState(!1),yt=al(),[Va,Qt]=i.useState(null),[Ft,bt]=i.useState(!1),[wt,Rs]=i.useState(!1),[jt,Qe]=i.useState(null),[ia,As]=i.useState(null),[vt,Xt]=i.useState(!1),[la,es]=i.useState(null),[Bt,da]=i.useState(null),[qe,ts]=i.useState(!1),[ue,ss]=i.useState(null),[Ms,as]=i.useState([]);i.useEffect(()=>(Ft||wt?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[Ft,wt]),i.useEffect(()=>{const g=p=>{!p.target.closest("[data-audio-menu]")&&!p.target.closest("[data-audio-speed-menu]")&&!p.target.closest("[data-audio-controls-menu]")&&!p.target.closest('button[title="Audio options"]')&&(document.querySelectorAll("[data-audio-menu]").forEach(y=>{y.classList.add("hidden")}),document.querySelectorAll("[data-audio-speed-menu]").forEach(y=>{y.classList.add("hidden")}),document.querySelectorAll("[data-audio-controls-menu]").forEach(y=>{y.classList.add("hidden")}))};return document.addEventListener("click",g),()=>{document.removeEventListener("click",g)}},[]),i.useEffect(()=>{const g=async()=>{if(!o){Oe("Please sign in to view your appointments"),Le(!1);return}try{Le(!0),Oe(null);const{data:y}=await L.get(`${D}/api/bookings/my`,{withCredentials:!0});console.log("All appointments fetched:",y);const _=y.appointments||y;Zt(_)}catch{Oe("Failed to load appointments. Please try again.")}finally{Le(!1)}},p=async()=>{if(o)try{const{data:y}=await L.get(`${D}/api/bookings/archived`,{withCredentials:!0});K(Array.isArray(y)?y:[])}catch(y){K([]),console.error("Failed to fetch archived appointments:",y)}else K([])};g(),p()},[o]),i.useEffect(()=>{if(Kt.length===0)return;let g=Kt.filter(M=>{var dt,ct,mt,ut,Nt,Ct,ua,rs,He,os,ns,is,Ds;if(o._id===((ct=(dt=M.buyerId)==null?void 0:dt._id)==null?void 0:ct.toString())&&M.visibleToBuyer===!1||o._id===((ut=(mt=M.sellerId)==null?void 0:mt._id)==null?void 0:ut.toString())&&M.visibleToSeller===!1)return!1;const de=new Date(M.date)<new Date||new Date(M.date).toDateString()===new Date().toDateString()&&M.time&&M.time<new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});if(ee==="outdated")return de;const ve=ee==="all"?!0:M.status===ee,lt=Re==="all"?!0:M.role===Re,he=((Nt=M.propertyName)==null?void 0:Nt.toLowerCase().includes(X.toLowerCase()))||((ua=(Ct=M.buyerId)==null?void 0:Ct.email)==null?void 0:ua.toLowerCase().includes(X.toLowerCase()))||((He=(rs=M.sellerId)==null?void 0:rs.email)==null?void 0:He.toLowerCase().includes(X.toLowerCase()))||((ns=(os=M.buyerId)==null?void 0:os.username)==null?void 0:ns.toLowerCase().includes(X.toLowerCase()))||((Ds=(is=M.sellerId)==null?void 0:is.username)==null?void 0:Ds.toLowerCase().includes(X.toLowerCase())),zt=(!je||new Date(M.date)>=new Date(je))&&(!I||new Date(M.date)<=new Date(I));return ve&&lt&&he&&zt});const p=10,y=Math.ceil(g.length/p);we(y);const _=(me-1)*p,R=_+p,F=g.slice(_,R);console.log(`Page ${me} of ${y}, showing ${F.length} appointments`),C(F)},[Kt,me,X,ee,Re,je,I,o]),i.useEffect(()=>{if(H.length===0)return;let g=H.filter(M=>{var dt,ct,mt,ut,Nt,Ct;const de=new Date(M.date)<new Date||new Date(M.date).toDateString()===new Date().toDateString()&&M.time&&M.time<new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),ve=ee==="all"?!0:ee==="outdated"?de:M.status===ee,lt=Re==="all"?!0:M.role===Re,he=((dt=M.propertyName)==null?void 0:dt.toLowerCase().includes(X.toLowerCase()))||((ct=M.message)==null?void 0:ct.toLowerCase().includes(X.toLowerCase()))||((ut=(mt=M.buyerId)==null?void 0:mt.username)==null?void 0:ut.toLowerCase().includes(X.toLowerCase()))||((Ct=(Nt=M.sellerId)==null?void 0:Nt.username)==null?void 0:Ct.toLowerCase().includes(X.toLowerCase())),zt=(!je||new Date(M.date)>=new Date(je))&&(!I||new Date(M.date)<=new Date(I));return ve&&lt&&he&&zt});const p=10,y=Math.ceil(g.length/p);E(y);const _=(ne-1)*p,R=_+p,F=g.slice(_,R);console.log(`Archived Page ${ne} of ${y}, showing ${F.length} archived appointments`),oa(F)},[H,ne,X,ee,Re,je,I]),i.useEffect(()=>{const g=p=>{C(y=>y.filter(_=>_._id!==p.detail))};return window.addEventListener("removeAppointmentRow",g),()=>{window.removeEventListener("removeAppointmentRow",g)}},[o]),i.useEffect(()=>{const g=p=>{const{appointmentId:y,preferUnread:_}=p.detail||{};if(y){const R=h.find(F=>F._id===y);R&&(As(R),Xt(!0),es(y),_&&da(y))}};return window.addEventListener("openChatFromNotification",g),()=>{window.removeEventListener("openChatFromNotification",g)}},[h]),i.useEffect(()=>(Ke?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[Ke]),i.useEffect(()=>(te?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[te]),i.useEffect(()=>{o&&C(g=>g.map(p=>{const y={...p};return p.buyerId&&(p.buyerId._id===o._id||p.buyerId===o._id)&&(y.buyerId={...y.buyerId,username:o.username,email:o.email,mobileNumber:o.mobileNumber,avatar:o.avatar}),p.sellerId&&(p.sellerId._id===o._id||p.sellerId===o._id)&&(y.sellerId={...y.sellerId,username:o.username,email:o.email,mobileNumber:o.mobileNumber,avatar:o.avatar}),y}))},[o]),i.useEffect(()=>{function g(y){C(_=>_.map(R=>R._id===y.appointmentId?{...R,...y.updatedAppointment}:R))}function p(y){C(_=>_.map(R=>R._id===y.appointmentId?{...R,paymentConfirmed:y.paymentConfirmed}:R))}return O.on("appointmentUpdate",g),O.on("paymentStatusUpdated",p),()=>{O.off("appointmentUpdate",g),O.off("paymentStatusUpdated",p)}},[]),i.useEffect(()=>{function g(y){const _=y.appointment;_.buyerId&&o&&(_.buyerId._id===o._id||_.buyerId===o._id)?_.role="buyer":_.sellerId&&o&&(_.sellerId._id===o._id||_.sellerId===o._id)&&(_.role="seller"),C(R=>[_,...R])}O.on("appointmentCreated",g);const p=y=>{C(_=>_.map(R=>{const F={...R};return R.buyerId&&(R.buyerId._id===y.userId||R.buyerId===y.userId)&&(F.buyerId={...F.buyerId,username:y.username,email:y.email,mobileNumber:y.mobileNumber,avatar:y.avatar}),R.sellerId&&(R.sellerId._id===y.userId||R.sellerId===y.userId)&&(F.sellerId={...F.sellerId,username:y.username,email:y.email,mobileNumber:y.mobileNumber,avatar:y.avatar}),F}))};return O.on("profileUpdated",p),()=>{O.off("appointmentCreated",g),O.off("profileUpdated",p)}},[o]),i.useEffect(()=>{if(!o)return;const g=setInterval(()=>{O.emit("userAppointmentsActive",{userId:o._id})},1e3);return()=>clearInterval(g)},[o]),i.useEffect(()=>{},[vt,ia]);const Ie=Pn();i.useEffect(()=>{var g,p;if((g=Ie.state)!=null&&g.fromNotification&&((p=Ie.state)!=null&&p.openChatForAppointment)){const y=Ie.state.openChatForAppointment;if(h.length>0){const _=h.find(R=>R._id===y);_&&(As(_),Xt(!0),es(y),yt(Ie.pathname,{replace:!0}))}else{const _=setInterval(()=>{if(h.length>0){const R=h.find(F=>F._id===y);R&&(As(R),Xt(!0),es(y),yt(Ie.pathname,{replace:!0})),clearInterval(_)}},100);setTimeout(()=>clearInterval(_),5e3)}}},[Ie.state,yt,h,o._id]);const kt=async(g,p)=>{var y,_,R;W(g+p);try{const{data:F}=await L.patch(`${D}/api/bookings/${g}/status`,{status:p},{withCredentials:!0,headers:{"Content-Type":"application/json"}});C(de=>de.map(ve=>ve._id===g?{...ve,status:p}:ve));const M=p==="accepted"?"accepted":"rejected";m.success(`Appointment ${M} successfully! ${p==="accepted"?"Contact information is now visible to both parties.":""}`,{autoClose:3e3,closeOnClick:!0,pauseOnHover:!1,draggable:!1}),yt("/user/my-appointments")}catch(F){if(((y=F.response)==null?void 0:y.status)===401){m.error("Session expired or unauthorized. Please sign in again."),yt("/sign-in");return}m.error(((R=(_=F.response)==null?void 0:_.data)==null?void 0:R.message)||"Failed to update appointment status.")}W("")},w=async g=>{Qe(g),setDeleteReason(""),setShowDeleteAppointmentModal(!0)},ca=async g=>{Qe(g),bt(!0)},Ya=async()=>{var g,p;try{const{data:y}=await L.patch(`${D}/api/bookings/${jt}/archive`,{},{withCredentials:!0,headers:{"Content-Type":"application/json"}}),_=h.find(R=>R._id===jt);_&&(C(R=>R.filter(F=>F._id!==jt)),K(R=>[{..._,archivedAt:new Date},...R])),m.success("Appointment archived successfully.",{autoClose:3e3,closeOnClick:!0,pauseOnHover:!1,draggable:!1}),bt(!1),Qe(null)}catch(y){m.error(((p=(g=y.response)==null?void 0:g.data)==null?void 0:p.message)||"Failed to archive appointment.")}},$s=async g=>{Qe(g),Rs(!0)},Wa=async()=>{var g,p;try{const{data:y}=await L.patch(`${D}/api/bookings/${jt}/unarchive`,{},{withCredentials:!0,headers:{"Content-Type":"application/json"}}),_=H.find(R=>R._id===jt);_&&(K(R=>R.filter(F=>F._id!==jt)),C(R=>[{..._,archivedAt:void 0},...R])),m.success("Appointment unarchived successfully.",{autoClose:3e3,closeOnClick:!0,pauseOnHover:!1,draggable:!1}),Rs(!1),Qe(null)}catch(y){m.error(((p=(g=y.response)==null?void 0:g.data)==null?void 0:p.message)||"Failed to unarchive appointment.")}};function ma(g){fe({...g,date:g.date?new Date(g.date).toISOString().split("T")[0]:"",time:g.time||"",message:g.message||"",buyerReinitiationCount:g.buyerReinitiationCount||0,sellerReinitiationCount:g.sellerReinitiationCount||0}),T(!0)}async function it(g){var R,F,M,de;if(g.preventDefault(),!A)return;const p=o&&(((R=A.buyerId)==null?void 0:R._id)===o._id||A.buyerId===o._id);if(o&&(((F=A.sellerId)==null?void 0:F._id)===o._id||(A.sellerId,o._id)),(p?A.buyerReinitiationCount||0:A.sellerReinitiationCount||0)>=2){m.error("You have reached the maximum number of reinitiations for your role.");return}if(!A.buyerId||!A.sellerId){m.error("Cannot reinitiate: one of the parties no longer exists.");return}const _={...A,status:"pending"};try{const{data:ve}=await L.post(`${D}/api/bookings/reinitiate`,_,{withCredentials:!0,headers:{"Content-Type":"application/json"}});m.success("Appointment reinitiated successfully!",{autoClose:5e3,closeOnClick:!0,pauseOnHover:!1,draggable:!1}),T(!1),fe(null),yt("/user/my-appointments"),C(lt=>lt.map(he=>he._id===ve.appointment._id?{...he,...ve.appointment}:he))}catch(ve){m.error(((de=(M=ve.response)==null?void 0:M.data)==null?void 0:de.message)||"Failed to reinitiate appointment.")}}const Ga=(g,p)=>{C(y=>y.map(_=>_._id===g?{..._,status:p}:_))},so=async()=>{Le(!0),Oe(null);try{const{data:g}=await L.get(`${D}/api/bookings/my`,{withCredentials:!0});if(C(g),o){const{data:p}=await L.get(`${D}/api/bookings/archived`,{withCredentials:!0});K(Array.isArray(p)?p:[])}else K([])}catch{Oe("Failed to refresh appointments. Please try again.")}finally{Le(!1)}},P=g=>{if(!g){m.error("No message to copy");return}navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(g).then(()=>{m.success("Copied",{autoClose:2e3,position:"bottom-center"})}).catch(()=>{Xe(g)}):Xe(g)},Xe=g=>{try{const p=document.createElement("textarea");p.value=g,p.style.position="fixed",p.style.left="-999999px",p.style.top="-999999px",document.body.appendChild(p),p.focus(),p.select();const y=document.execCommand("copy");document.body.removeChild(p),y?m.success("Copied",{autoClose:2e3,position:"bottom-center"}):(console.error("Fallback copy failed"),m.error("Failed to copy message"))}catch(p){console.error("Fallback copy error:",p),m.error("Copy not supported")}};return pt?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading your appointments..."})]})}):Ge?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-100 py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6",children:e.jsx("div",{className:"text-center text-red-600 text-lg",children:Ge})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-100 py-10 px-2 md:px-8",children:[o&&e.jsx("div",{className:"max-w-7xl mx-auto mb-4 flex justify-end",children:e.jsxs(eo,{to:"/user/my-payments",className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-semibold shadow",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("path",{d:"M2 7a2 2 0 012-2h16a2 2 0 012 2v3H2V7z"}),e.jsx("path",{d:"M2 12h20v5a2 2 0 01-2 2H4a2 2 0 01-2-2v-5zm4 3a1 1 0 100 2h6a1 1 0 100-2H6z"})]}),"Go to Payments"]})}),e.jsxs("div",{className:"max-w-7xl mx-auto bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl md:text-3xl font-extrabold text-blue-700 drop-shadow",children:Me?`Archived Appointments (${$.length})`:`My Appointments (${h.length})`}),!Me&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"ðŸ’¡ Monitor all appointments across the platform. Use the status filter to view appointments and interactive chatbox to connect with otherparty."})]}),e.jsxs("div",{className:"flex flex-row gap-2 md:gap-4",children:[e.jsx("button",{onClick:so,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-2.5 py-1.5 rounded-md hover:from-blue-600 hover:to-purple-600 transition-all font-semibold shadow-md text-xs sm:text-base sm:px-3 sm:py-1.5 sm:rounded-md flex-1 sm:flex-none sm:w-auto",title:"Refresh appointments",children:"Refresh"}),e.jsx("button",{onClick:()=>{na(!Me),Ee(1),B(1)},className:`bg-gradient-to-r text-white px-2.5 py-1.5 rounded-md transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-1 sm:gap-2 text-xs sm:text-base flex-1 sm:flex-none sm:w-auto sm:px-4 sm:py-2 sm:rounded-md justify-center ${Me?"from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600":"from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700"}`,children:Me?e.jsxs(e.Fragment,{children:[e.jsx(We,{})," ",e.jsx("span",{children:"Active Appointments"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ra,{})," ",e.jsxs("span",{children:["Archived Appointments (",H.length,")"]})]})})]})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold text-sm",children:"Status:"}),e.jsxs("select",{className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200 text-sm",value:ee,onChange:g=>Tt(g.target.value),children:[e.jsx("option",{value:"all",children:"All Appointments"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"cancelledByBuyer",children:"Cancelled by Buyer"}),e.jsx("option",{value:"cancelledBySeller",children:"Cancelled by Seller"}),e.jsx("option",{value:"cancelledByAdmin",children:"Cancelled by Admin"}),e.jsx("option",{value:"deletedByAdmin",children:"Deleted by Admin"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"noShow",children:"No Show"}),e.jsx("option",{value:"outdated",children:"Outdated"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold text-sm",children:"Role:"}),e.jsxs("select",{className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200 text-sm",value:Re,onChange:g=>Y(g.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"buyer",children:"As Buyer"}),e.jsx("option",{value:"seller",children:"As Seller"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold text-sm",children:"From:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200 text-sm",value:je,onChange:g=>Jt(g.target.value),max:I||void 0}),e.jsx("label",{className:"font-semibold text-sm",children:"To:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200 text-sm",value:I,onChange:g=>Je(g.target.value),min:je||void 0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(to,{className:"text-gray-500 hover:text-blue-500 transition-colors duration-200"}),e.jsx("input",{type:"text",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200 text-sm flex-1",placeholder:"Search by property, message, or user...",value:X,onChange:g=>ye(g.target.value)})]})]})]}),Me&&e.jsx("p",{className:"text-center text-gray-600 mb-6",children:"ðŸ“‹ View and manage archived appointments. You can unarchive them to move them back to active appointments."}),Me?$.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg",children:"No archived appointments found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-gray-100 to-gray-200",children:[e.jsx("th",{className:"border p-2",children:"Date & Time"}),e.jsx("th",{className:"border p-2",children:"Property"}),e.jsx("th",{className:"border p-2",children:"Role"}),e.jsx("th",{className:"border p-2",children:"Other Party"}),e.jsx("th",{className:"border p-2",children:"Purpose"}),e.jsx("th",{className:"border p-2",children:"Message"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Payment"}),e.jsx("th",{className:"border p-2",children:"Actions"}),e.jsx("th",{className:"border p-2",children:"Connect"})]})}),e.jsx("tbody",{children:$.map(g=>e.jsx(Tn,{appt:g,currentUser:o,handleStatusUpdate:kt,handleAdminDelete:w,actionLoading:_s,onShowOtherParty:(p,y)=>{Ze(p),Pt(y),Ae(!0)},onOpenReinitiate:()=>ma(g),handleArchiveAppointment:ca,handleUnarchiveAppointment:$s,isArchived:!0,onCancelRefresh:Ga,copyMessageToClipboard:P,onExportChat:(p,y)=>{ss(p),as(y),ts(!0)}},g._id))})]})}):h.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-500 text-lg mb-6",children:"No appointments found."}),e.jsxs(eo,{to:"/search",className:"inline-flex items-center px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-200 transform hover:scale-105 shadow-lg",children:[e.jsx(Fn,{className:"mr-2"}),"Book Appointment"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-100 to-purple-100",children:[e.jsx("th",{className:"border p-2",children:"Date & Time"}),e.jsx("th",{className:"border p-2",children:"Property"}),e.jsx("th",{className:"border p-2",children:"Role"}),e.jsx("th",{className:"border p-2",children:"Other Party"}),e.jsx("th",{className:"border p-2",children:"Purpose"}),e.jsx("th",{className:"border p-2",children:"Message"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Payment"}),e.jsx("th",{className:"border p-2",children:"Actions"}),e.jsx("th",{className:"border p-2",children:"Connect"})]})}),e.jsx("tbody",{children:h.map(g=>e.jsx(Tn,{appt:g,currentUser:o,handleStatusUpdate:kt,handleAdminDelete:w,actionLoading:_s,onShowOtherParty:(p,y)=>{Ze(p),Pt(y),Ae(!0)},onOpenReinitiate:()=>ma(g),handleArchiveAppointment:ca,handleUnarchiveAppointment:$s,isArchived:!1,onCancelRefresh:Ga,copyMessageToClipboard:P,activeChatAppointmentId:la,shouldOpenChatFromNotification:vt,onChatOpened:()=>{Xt(!1),es(null)},preferUnreadForAppointmentId:Bt,onConsumePreferUnread:p=>{Bt===p&&da(null)},onExportChat:(p,y)=>{ss(p),as(y),ts(!0)}},g._id))})]})}),!Me&&be>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-6 gap-2",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Page ",me," of ",be]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsx("button",{onClick:()=>{Ee(Math.max(1,me-1)),m.info(`Navigated to page ${Math.max(1,me-1)}`)},disabled:me===1,className:"px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed w-full sm:w-auto",children:"Previous"}),e.jsx("button",{onClick:()=>{Ee(Math.min(be,me+1)),m.info(`Navigated to page ${Math.min(be,me+1)}`)},disabled:me===be,className:"px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed w-full sm:w-auto",children:"Next"})]})]}),Me&&U>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-6 gap-2",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Archived Page ",ne," of ",U]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsx("button",{onClick:()=>{B(Math.max(1,ne-1)),m.info(`Navigated to archived page ${Math.max(1,ne-1)}`)},disabled:ne===1,className:"px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed w-full sm:w-auto",children:"Previous"}),e.jsx("button",{onClick:()=>{B(Math.min(U,ne+1)),m.info(`Navigated to archived page ${Math.min(U,ne+1)}`)},disabled:ne===U,className:"px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed w-full sm:w-auto",children:"Next"})]})]}),Ke&&V&&ae&&(()=>{const g=new Date(ae.date)>new Date||new Date(ae.date).toDateString()===new Date().toDateString()&&(!ae.time||ae.time>new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),y=(o&&(o.role==="admin"||o.role==="rootadmin")||ae.status==="accepted")&&g&&ae.status!=="cancelledByBuyer"&&ae.status!=="cancelledBySeller"&&ae.status!=="cancelledByAdmin"&&ae.status!=="rejected"&&ae.status!=="deletedByAdmin";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",style:{overflow:"hidden"},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 max-h-[90vh] overflow-y-auto relative animate-fadeIn",children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>Ae(!1),title:"Close","aria-label":"Close",children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex flex-col items-center justify-center bg-gradient-to-r from-blue-100 to-purple-100 rounded-t-2xl px-6 py-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(rl,{user:{username:V.username,avatar:V.avatar},size:"w-16 h-16",textSize:"text-lg",showBorder:!0,className:"border-4 border-white shadow-lg"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 border-2 border-white rounded-full flex items-center justify-center",children:y?V.isTyping?e.jsx("div",{className:"w-full h-full bg-yellow-500 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"})}):V.isOnline?e.jsx("div",{className:"w-full h-full bg-green-500 rounded-full flex items-center justify-center",children:e.jsx(An,{className:"w-2 h-2 text-white"})}):e.jsx("div",{className:"w-full h-full bg-gray-400 rounded-full flex items-center justify-center",children:e.jsx(An,{className:"w-2 h-2 text-white"})}):e.jsx("div",{className:"w-full h-full bg-gray-400 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-[8px] font-bold",children:"N/A"})})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-blue-800 flex items-center gap-2",children:[V.username||"User",V.role==="admin"&&e.jsx(Bn,{className:"text-purple-600 text-base",title:"Admin user"})]}),e.jsx("p",{className:"text-sm text-gray-600 capitalize font-medium bg-white px-3 py-1 rounded-full shadow-sm",children:(()=>{var R;return(((R=ae.buyerId)==null?void 0:R._id)===o._id||ae.buyerId===o._id?"buyer":"seller")==="buyer"?"seller":"buyer"})()}),y?V.isTyping?e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"text-yellow-600 font-medium text-xs bg-yellow-100 px-3 py-1 rounded-full",children:"Typing..."})}):V.isOnline?e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"text-green-600 font-medium text-xs bg-green-100 px-3 py-1 rounded-full",children:"Online"})}):e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"text-gray-600 font-medium text-xs bg-gray-100 px-3 py-1 rounded-full",children:(()=>{if(!V.lastSeen)return"Offline";const _=new Date(V.lastSeen),F=Math.floor((new Date-_)/(1e3*60)),M=Math.floor(F/60),de=Math.floor(M/24);return F<1?"Last seen just now":F<60?`Last seen ${F} minute${F>1?"s":""} ago`:M<24?`Last seen ${M} hour${M>1?"s":""} ago`:de<7?`Last seen ${de} day${de>1?"s":""} ago`:`Last seen ${_.toLocaleDateString("en-US",{month:"short",day:"numeric"})}`})()})}):e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"text-gray-600 font-medium text-xs bg-gray-100 px-3 py-1 rounded-full",children:"Not available"})})]})]})}),e.jsx("div",{className:"px-6 py-6 space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[y?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx(ol,{className:"text-blue-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Email"}),e.jsx("p",{className:"text-gray-800 font-medium",children:V.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-green-500",children:[e.jsx(nl,{className:"text-green-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Phone"}),e.jsx("p",{className:"text-gray-800 font-medium",children:V.mobileNumber||"Not provided"})]})]})]}):e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-yellow-50 rounded-lg border-l-4 border-yellow-500",children:[e.jsx(il,{className:"text-yellow-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-yellow-700 uppercase tracking-wide font-semibold",children:"Contact Information Restricted"}),e.jsx("p",{className:"text-yellow-800 font-medium",children:"Contact details are only available for accepted appointments"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-purple-500",children:[e.jsx(ll,{className:"text-purple-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Member Since"}),e.jsx("p",{className:"text-gray-800 font-medium",children:V.createdAt?new Date(V.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"Not available"})]})]})]})})]})})})(),te&&A&&e.jsx("div",{className:"modal-backdrop",children:e.jsx("div",{className:"modal-content",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-blue-700",children:"Reinitiate Appointment"}),e.jsxs("form",{onSubmit:it,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Date"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 w-full",value:A.date,onChange:g=>fe(p=>({...p,date:g.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Time"}),e.jsx("input",{type:"time",className:"border rounded px-2 py-1 w-full",value:A.time,onChange:g=>fe(p=>({...p,time:g.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Message (optional)"}),e.jsx("textarea",{className:"border rounded px-2 py-1 w-full",value:A.message,onChange:g=>fe(p=>({...p,message:g.target.value}))})]}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full",children:"Submit"}),e.jsx("button",{type:"button",className:"mt-2 w-full bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400",onClick:()=>T(!1),children:"Cancel"})]})]})})}),Ft&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(ra,{className:"text-blue-500"}),"Archive Appointment"]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to archive this appointment? It will be moved to the archived section."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{bt(!1),Qe(null)},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Ya,className:"px-4 py-2 rounded bg-blue-600 text-white font-semibold hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(ra,{size:12}),"Archive"]})]})]})}),wt&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(We,{className:"text-green-500"}),"Unarchive Appointment"]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to unarchive this appointment? It will be moved back to the active appointments."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{Rs(!1),Qe(null)},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Wa,className:"px-4 py-2 rounded bg-green-600 text-white font-semibold hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(We,{size:12}),"Unarchive"]})]})]})})]}),e.jsx(yl,{isOpen:qe,onClose:()=>{ts(!1),ss(null),as([])},onExport:async g=>{var p;try{m.info("Generating PDF...",{autoClose:2e3});const y=((p=ue==null?void 0:ue.buyerId)==null?void 0:p._id)===o._id?ue==null?void 0:ue.sellerId:ue==null?void 0:ue.buyerId,_=await bl(ue,Ms,o,y,g);_.success?m.success(`Chat transcript exported as ${_.filename}`):m.error(`Export failed: ${_.error}`)}catch(y){m.error("Failed to export chat transcript"),console.error("Export error:",y)}},appointment:ue,messageCount:Ms.filter(g=>{var p;return!g.deleted&&(((p=g.message)==null?void 0:p.trim())||g.imageUrl||g.audioUrl||g.videoUrl||g.documentUrl)}).length,imageCount:Ms.filter(g=>g.imageUrl&&!g.deleted).length})]})}function Xr(o){const h=new Date,C=new Date;return C.setDate(h.getDate()-1),o.toDateString()===h.toDateString()?"Today":o.toDateString()===C.toDateString()?"Yesterday":o.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}function Tn({appt:o,currentUser:h,handleStatusUpdate:C,handleAdminDelete:Kt,actionLoading:Zt,onShowOtherParty:pt,onOpenReinitiate:Le,handleArchiveAppointment:Ge,handleUnarchiveAppointment:Oe,isArchived:X,onCancelRefresh:ye,copyMessageToClipboard:ee,activeChatAppointmentId:Tt,shouldOpenChatFromNotification:Re,onChatOpened:Y,onExportChat:me,preferUnreadForAppointmentId:Ee,onConsumePreferUnread:be}){var hn,gn,xn,fn,pn,yn,bn,wn,jn,vn;const[we,ne]=i.useState(null),[B,U]=i.useState(""),[E,$]=i.useState(o.comments||[]),[oa,_s]=i.useState(!1),[W,Ke]=i.useState(null),[Ae,V]=i.useState(""),[Ze,ae]=i.useState(""),[Pt,je]=i.useState(null),Jt=Pn(),[I,Je]=i.useState(!1),te=i.useRef(null),T=i.useRef(null),[A,fe]=i.useState(!0),[H,K]=i.useState(0),[Me,na]=i.useState(!1),[yt,Va]=i.useState(!1),Qt=30,[Ft,bt]=i.useState(Qt),[wt,Rs]=i.useState(""),[jt,Qe]=i.useState(!1),[ia,As]=i.useState(!1),[vt,Xt]=i.useState(!1),[la,es]=i.useState(null),[Bt,da]=i.useState(null),[qe,ts]=i.useState(!1),[ue,ss]=i.useState(!1),[Ms,as]=i.useState(!1),Ie=i.useRef(null),kt=i.useRef(null),w=i.useRef(null),[ca,Ya]=i.useState([]),[$s,Wa]=i.useState(!1);i.useEffect(()=>{if(!I||!(o!=null&&o._id)||!(h!=null&&h._id))return;const t=`appt_draft_${o._id}_${h._id}`,s=localStorage.getItem(t);s!=null&&(U(s),setTimeout(()=>{try{if(w.current){const a=w.current.value.length;w.current.focus(),w.current.setSelectionRange(a,a),Ba(w.current)}}catch{}},0))},[I,o==null?void 0:o._id]),i.useEffect(()=>{!I||!/@[^\s]*$/.test(B||"")||$s||(async()=>{try{const a=await(await fetch(`${D}/api/listing/get?limit=300`,{credentials:"include"})).json(),r=Array.isArray(a)?a.map(n=>({id:n._id,name:n.name||"Property"})):[];Ya(r),Wa(!0)}catch{}})()},[B,I,$s]),i.useEffect(()=>{if(!I||!(o!=null&&o._id)||!(h!=null&&h._id))return;const t=`appt_draft_${o._id}_${h._id}`;localStorage.setItem(t,B)},[B,I,o==null?void 0:o._id,h==null?void 0:h._id]);const[ma,it]=i.useState(!1),[Ga,so]=i.useState(null),[P,Xe]=i.useState(null),[g,p]=i.useState(!0),[y,_]=i.useState(!1),[R,F]=i.useState(null),[M,de]=i.useState(null),[ve,lt]=i.useState(!1),[he,zt]=i.useState(""),[dt,ct]=i.useState(""),[mt,ut]=i.useState(null),[Nt,Ct]=i.useState(!1),[ua,rs]=i.useState(!1),[He,os]=i.useState(""),[ns,is]=i.useState(""),[Ds,ao]=i.useState(!1),[zn,On]=i.useState(!1),[Ka,Za]=i.useState(!1),[qn,Ja]=i.useState(!1),[Qa,Xa]=i.useState(!1),[ke,ha]=i.useState(!1),[ls,ds]=i.useState(!1),[ge,ro]=i.useState(!0),[er,tr]=i.useState(!1),[sr,cs]=i.useState(!1),[ar,rr]=i.useState(!1),[or,nr]=i.useState(!1),[Ls,ir]=i.useState(""),[lr,dr]=i.useState(""),[cr,mr]=i.useState(""),[ur,hr]=i.useState(""),[ga,oo]=i.useState(!1),[gr,no]=i.useState(!1),[xr,fr]=i.useState(!1),[io,lo]=i.useState(!1),[co,mo]=i.useState(!1),[uo,ho]=i.useState(!1),[go,xo]=i.useState(!1),[fo,vl]=i.useState(!1),[po,kl]=i.useState(!1);i.useEffect(()=>(Ka||Qa?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[Ka,Qa]),i.useEffect(()=>(er||sr||or||ar?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[er,sr,or,ar]),i.useEffect(()=>(fo?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[fo]),i.useEffect(()=>(po?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[po]),i.useEffect(()=>()=>{M&&clearTimeout(M)},[M]),i.useEffect(()=>{I||(F(null),M&&(clearTimeout(M),de(null)))},[I,M]),i.useEffect(()=>{var t,s;if(Re&&Tt===o._id){const a=o.buyerChatLocked||o.sellerChatLocked,r=h._id,n=((t=o.buyerId)==null?void 0:t._id)===r||o.buyerId===r,l=((s=o.sellerId)==null?void 0:s._id)===r||o.sellerId===r;a?(n&&o.buyerChatLocked||l&&o.sellerChatLocked)&&cs(!0):(Je(!0),window.dispatchEvent(new CustomEvent("chatOpened",{detail:{appointmentId:o._id}})),Y&&Y(),Ee===o._id&&(Va(!0),typeof be=="function"&&be(o._id)))}},[Re,Tt,o._id,o.buyerChatLocked,o.sellerChatLocked,o.buyerId,o.sellerId,h._id,Y,Ee,be]);const[Nl,Hn]=i.useState(null),[ms,St]=i.useState(""),[Un,yo]=i.useState(""),Ue=i.useRef({}),[xa,re]=i.useState(null),[Cl,Sl]=i.useState(!1),[fa,pe]=i.useState(!1),[us,Es]=i.useState(!1),[_t,Is]=i.useState(null),[hs,Rt]=i.useState(!1),[_l,Vn]=i.useState(window.innerWidth<=768);i.useEffect(()=>{const t=()=>{Vn(window.innerWidth<=768)};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const[Yn,bo]=i.useState(!1),[Te,wo]=i.useState(null),[pr,jo]=i.useState(!1),[Wn,vo]=i.useState(!1),[yr,pa]=i.useState(!1),[ht,Ot]=i.useState([]),[ko,No]=i.useState(!1),[br,Co]=i.useState(!1),[So,_o]=i.useState(null),[Ro,Ao]=i.useState(!1),[wr,Ts]=i.useState([]),[Rl,Mo]=i.useState(!1),[ya,ba]=i.useState(!1),[Gn,gs]=i.useState(!1),[$e,xs]=i.useState(null),[Ne,fs]=i.useState("24hrs"),[wa,jr]=i.useState(24),[$o,Do]=i.useState(null),[Ps,Ce]=i.useState(!1),[vr,Pe]=i.useState(!1),[ce,xe]=i.useState([]),[ps,ja]=i.useState({starring:!1,pinning:!1,copying:!1,deleting:!1}),[kr,va]=i.useState(!1),[Nr,ka]=i.useState(""),[gt,Fs]=i.useState([]),[Bs,xt]=i.useState(-1),[Na,zs]=i.useState(!1),[Kn,Zn]=i.useState(""),[Al,Lo]=i.useState(null),[At,ft]=i.useState(!1),[Eo,qt]=i.useState(""),[z,Mt]=i.useState([]),[Jn,Cr]=i.useState(!1),[Qn,Io]=i.useState([]),[Se,et]=i.useState(0),[Os,Ht]=i.useState({}),[Xn,qs]=i.useState(!1),[$t,tt]=i.useState(0),[To,Ca]=i.useState(-1),[ei,Hs]=i.useState(0),[ys,Sr]=i.useState([]),[Ml,Po]=i.useState(!1),Us=i.useRef(null),[Fo,bs]=i.useState(null),[ti,ws]=i.useState(!1),[si,Sa]=i.useState(!1),ai=i.useRef(null),ri=i.useRef(null),Bo=i.useRef(null),zo=i.useRef(null),_r=i.useRef(null),Rr=i.useRef(null),[_a,Dt]=i.useState(!1),[st,Ra]=i.useState(null),[oi,Aa]=i.useState(!1),[Lt,Ma]=i.useState(null),[ni,$a]=i.useState(!1),[Vs,Da]=i.useState(""),[Ys,La]=i.useState(""),[ii,Ar]=i.useState(null),[at,js]=i.useState(null),[li,Ws]=i.useState(!1),[Gs,Mr]=i.useState(""),[di,$r]=i.useState(null),Dr=i.useRef(null),[ci,Lr]=i.useState(!1),[vs,Er]=i.useState(!1),[Ea,Ia]=i.useState(!1),[Ks,ks]=i.useState(0),[Ut,Ir]=i.useState(null),Fe=i.useRef(null),Tr=i.useRef([]),Ve=i.useRef(null),Et=i.useRef(0),Pr=i.useRef(!1),Vt=i.useRef(0);i.useEffect(()=>{if(vs&&!Ea){Et.current||(Et.current=Date.now());const t=setInterval(()=>{const s=Date.now()-Et.current-Vt.current;ks(s)},500);return()=>clearInterval(t)}},[vs,Ea]);const{playMessageSent:mi,playMessageReceived:Oo,playNotification:ui,toggleMute:hi,setVolume:qo,isMuted:Ho,getCurrentVolume:Uo}=dl(),[Ta,Fr]=i.useState(1),[Ns,Pa]=i.useState(!1),[Vo,Br]=i.useState(!1),rt=t=>{t(),setTimeout(()=>Br(!1),100)};i.useEffect(()=>{Fr(Uo()),Pa(Ho())},[Uo,Ho]),i.useEffect(()=>{document.querySelectorAll("audio[data-audio-id]").forEach(t=>{t&&(t.volume=Ta,t.muted=Ns)})},[Ta,Ns]),i.useEffect(()=>{if(st){const t=URL.createObjectURL(st);return Ar(t),()=>{URL.revokeObjectURL(t),Ar(null)}}else Ar(null)},[st]),i.useEffect(()=>{if(at){const t=URL.createObjectURL(at);return $r(t),()=>{URL.revokeObjectURL(t),$r(null)}}else $r(null)},[at]),i.useEffect(()=>()=>{Ve.current&&clearInterval(Ve.current),Ut&&Ut.getTracks().forEach(t=>t.stop())},[Ut]);const gi=async()=>{try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});Ir(t),Tr.current=[];const s=new MediaRecorder(t,{mimeType:"audio/webm"});Fe.current=s,s.ondataavailable=a=>{a.data&&a.data.size>0&&Tr.current.push(a.data)},s.onstop=()=>{try{if(Pr.current)return;const a=new Blob(Tr.current,{type:"audio/webm"}),r=`recording-${Date.now()}.webm`,n=new File([a],r,{type:"audio/webm"});js(n),Lr(!1),Ws(!0)}catch{m.error("Failed to prepare audio preview")}finally{Ut&&Ut.getTracks().forEach(a=>a.stop()),Ir(null),Er(!1),Ia(!1),ks(0),Vt.current=0,Ve.current&&clearInterval(Ve.current),Et.current=0,Pr.current=!1}},s.start(100),Er(!0),Et.current=Date.now(),ks(0),Ve.current=setInterval(()=>{const a=Date.now()-Et.current-Vt.current;ks(a)},500)}catch(t){console.error("Recording error:",t),m.error("Microphone permission denied or unavailable")}},xi=()=>{if(Fe.current)try{Fe.current.stop()}catch{}},fi=()=>{if(!(!Fe.current||Fe.current.state!=="recording"))try{Fe.current.pause(),Ia(!0),Ve.current&&(clearInterval(Ve.current),Ve.current=null)}catch(t){console.error("Pause recording error:",t)}},pi=()=>{if(!(!Fe.current||Fe.current.state!=="paused"))try{Fe.current.resume(),Ia(!1);const t=Date.now(),s=Et.current+Ks+Vt.current;Vt.current+=t-s,Ve.current=setInterval(()=>{const a=Date.now()-Et.current-Vt.current;ks(a)},500)}catch(t){console.error("Resume recording error:",t)}},Yo=()=>{try{Pr.current=!0,Fe.current&&Fe.current.state!=="inactive"&&Fe.current.stop()}catch{}Ut&&Ut.getTracks().forEach(t=>t.stop()),Ir(null),Er(!1),Ia(!1),ks(0),Vt.current=0,Ve.current&&clearInterval(Ve.current),Lr(!1),js(null)};i.useEffect(()=>{if(!_a)return;const t=s=>{const a=Bo.current,r=zo.current;r&&r.contains(s.target)||a&&a.contains(s.target)||Dt(!1)};return document.addEventListener("mousedown",t,!0),()=>document.removeEventListener("mousedown",t,!0)},[_a]);const Wo=async t=>{if(!t||t.length===0)return;const s=[],a=[];if(Array.from(t).forEach((r,n)=>{if(!r.type.startsWith("image/")){a.push(`File ${n+1}: Please select an image file`);return}if(r.size>5*1024*1024){a.push(`File ${n+1}: File size must be less than 5MB`);return}s.push(r)}),a.length>0){qt(a.join(", ")),setTimeout(()=>qt(""),5e3);return}if(s.length>10){qt("Maximum 10 images allowed at once"),setTimeout(()=>qt(""),3e3);return}Mt(s),et(0),qs(!0),qt("")},yi=async(t,s,a="")=>{var l,d;const r=`temp-${Date.now()}`,n={_id:r,sender:h._id,senderEmail:h.email,senderName:h.username,message:a||"",imageUrl:t,status:"sending",timestamp:new Date().toISOString(),readBy:[h._id],type:"image"};$(c=>[...c,n]),te.current&&te.current.scrollIntoView({behavior:"smooth"});try{const{data:c}=await L.post(`${D}/api/bookings/${o._id}/comment`,{message:a||"",imageUrl:t,type:"image"},{withCredentials:!0,headers:{"Content-Type":"application/json"}}),x=c.comments[c.comments.length-1];$(b=>b.map(j=>j._id===r?{...x}:j))}catch(c){console.error("Send image error:",c),$(x=>x.filter(b=>b._id!==r)),m.error(((d=(l=c.response)==null?void 0:l.data)==null?void 0:d.message)||"Failed to send image.")}},Go=async(t,s)=>{var a;if(!t||typeof t!="string"){m.error("Error: Invalid image URL. Cannot download image.");return}try{const r=t.split("/");let l=r[r.length-1];if(!l.includes(".")||l.length<5){const d=((a=t.match(/\.(jpg|jpeg|png|gif|webp|bmp|svg)(\?|$)/i))==null?void 0:a[1])||"jpg";l=`chat-image-${s||Date.now()}.${d}`}try{const d=await fetch(t,{mode:"cors",cache:"no-cache"});if(d.ok)try{const c=await d.blob();if(!c||c.size===0)throw new Error("Downloaded image is empty or corrupted");const x=window.URL.createObjectURL(c),b=document.createElement("a");b.href=x,b.download=l,b.style.display="none",document.body.appendChild(b),b.click(),document.body.removeChild(b),setTimeout(()=>window.URL.revokeObjectURL(x),100),m.success(`Image "${l}" downloaded successfully!`);return}catch(c){throw console.error("Blob processing error:",c),new Error(`Failed to process image data: ${c.message}`)}else{let c=`Server error (${d.status}): `;switch(d.status){case 404:c+="Image not found on server";break;case 403:c+="Access denied to image";break;case 500:c+="Server internal error";break;default:c+="Unable to fetch image"}throw new Error(c)}}catch(d){console.warn("Fetch failed, trying direct download:",d),d.name==="TypeError"&&d.message.includes("Failed to fetch")?m.warn("Network error: Trying alternative download method..."):d.message.includes("CORS")?m.warn("CORS error: Trying alternative download method..."):m.warn(`Fetch error: ${d.message}. Trying alternative download method...`);try{const c=document.createElement("a");c.href=t,c.download=l,c.target="_blank",c.rel="noopener noreferrer",c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c),m.info(`Alternative download initiated. If it doesn't start automatically, please try right-clicking the image and selecting "Save image as..."`);return}catch(c){throw console.error("Direct download failed:",c),new Error(`Direct download failed: ${c.message}`)}}}catch(r){console.error("Download process failed:",r),m.error(`Download failed: ${r.message}. Attempting to open image in new tab...`);try{if(window.open(t,"_blank","noopener,noreferrer"))m.info("Image opened in new tab. You can right-click to save it manually.");else throw new Error("Pop-up blocked by browser")}catch(n){console.error("Failed to open image in new tab:",n),n.message.includes("Pop-up blocked")?m.error('Error: Pop-up blocked. Please allow pop-ups for this site or right-click the image and select "Save image as..."'):m.error(`All download methods failed: ${n.message}. Please right-click the image and select "Save image as..." or check your internet connection.`)}}},bi=async(t,s,a="")=>{var l,d;const r=`temp-${Date.now()}`,n={_id:r,sender:h._id,senderEmail:h.email,message:a||"",videoUrl:t,type:"video",status:"sending",timestamp:new Date().toISOString()};$(c=>[...c,n]);try{const{data:c}=await L.post(`${D}/api/bookings/${o._id}/comment`,{message:a||"",videoUrl:t,type:"video"},{withCredentials:!0});$(c.comments||((l=c.updated)==null?void 0:l.comments)||((d=c==null?void 0:c.appointment)==null?void 0:d.comments)||[])}catch{m.error("Failed to send video"),$(x=>x.filter(b=>b._id!==r))}},wi=async()=>{var t,s;if(st)try{ft(!0);const a=new FormData;a.append("video",st);const{data:r}=await L.post(`${D}/api/upload/video`,a,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:n=>{const l=Math.round(n.loaded*100/Math.max(1,n.total||st.size));tt(l)}});await bi(r.videoUrl,st.name,Vs),Ra(null),Aa(!1),Da(""),tt(0)}catch(a){m.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Video upload failed")}finally{ft(!1)}},ji=async(t,s,a="")=>{var l,d;const r=`temp-${Date.now()}`,n={_id:r,sender:h._id,senderEmail:h.email,message:a||"",audioUrl:t,audioName:s.name,audioMimeType:s.type||null,type:"audio",status:"sending",timestamp:new Date().toISOString()};$(c=>[...c,n]);try{const{data:c}=await L.post(`${D}/api/bookings/${o._id}/comment`,{message:a||"",audioUrl:t,audioName:s.name,audioMimeType:s.type||null,type:"audio"},{withCredentials:!0});$(c.comments||((l=c.updated)==null?void 0:l.comments)||((d=c==null?void 0:c.appointment)==null?void 0:d.comments)||[])}catch{m.error("Failed to send audio"),$(x=>x.filter(b=>b._id!==r))}},vi=async()=>{var t,s;if(at)try{ft(!0);const a=new FormData;a.append("audio",at);const{data:r}=await L.post(`${D}/api/upload/audio`,a,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:n=>{const l=Math.round(n.loaded*100/Math.max(1,n.total||at.size));tt(l)}});await ji(r.audioUrl,at,Gs),js(null),Ws(!1),Mr(""),tt(0)}catch(a){m.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Audio upload failed")}finally{ft(!1)}},ki=async(t,s,a="")=>{var l,d;const r=`temp-${Date.now()}`,n={_id:r,sender:h._id,senderEmail:h.email,message:a||"",documentUrl:t,documentName:s.name,documentMimeType:s.type||null,type:"document",status:"sending",timestamp:new Date().toISOString()};$(c=>[...c,n]);try{const{data:c}=await L.post(`${D}/api/bookings/${o._id}/comment`,{message:a||"",documentUrl:t,documentName:s.name,documentMimeType:s.type||null,type:"document"},{withCredentials:!0});$(c.comments||((l=c.updated)==null?void 0:l.comments)||((d=c==null?void 0:c.appointment)==null?void 0:d.comments)||[])}catch{m.error("Failed to send document"),$(x=>x.filter(b=>b._id!==r))}},Ni=async()=>{var t,s;if(Lt)try{ft(!0);const a=new FormData;a.append("document",Lt);const{data:r}=await L.post(`${D}/api/upload/document`,a,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:n=>{const l=Math.round(n.loaded*100/Math.max(1,n.total||Lt.size));tt(l)}});await ki(r.documentUrl,Lt,Ys),Ma(null),$a(!1),La(""),tt(0)}catch(a){m.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Document upload failed")}finally{ft(!1)}},Ko=t=>{if(u){m.info("Image sending disabled for this appointment status. You can view chat history.");return}if(((z==null?void 0:z.length)||0)+t.length>10){m.error("Maximum 10 images allowed. Please remove some images first.");return}const a=t.filter(n=>n.type.startsWith("image/"));if(a.length===0){m.error("No valid image files found");return}Mt(n=>[...n||[],...a]);const r={};a.forEach(n=>{r[n.name]=""}),Ht(n=>({...n,...r})),qs(!0),m.success(`${a.length} image${a.length>1?"s":""} added successfully!`)},Zo=async()=>{var t,s,a,r;if(!(!z||z.length===0)){if(u){m.info("Image sending disabled for this appointment status. You can view chat history.");return}ft(!0),tt(0),Ca(-1),Hs(0),Sr([]),Po(!1);try{let n=!1;const l=[];for(let d=0;d<z.length;d++){const c=z[d];Ca(d),Hs(0);const x=new FormData;x.append("image",c);const b=new AbortController;Us.current=b;try{const{data:j}=await L.post(`${D}/api/upload/image`,x,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"},signal:b.signal,onUploadProgress:q=>{if(q.total){const ie=Math.round(q.loaded*100/q.total);Hs(ie);const ot=Math.round((d+ie/100)/z.length*100);tt(ot)}}});await yi(j.imageUrl,c.name,Os[c.name]||""),tt(Math.round((d+1)/z.length*100))}catch(j){if(j.name==="CanceledError"||j.code==="ERR_CANCELED"){n=!0,Po(!0);break}else l.push(c)}finally{Us.current===b&&(Us.current=null)}}l.length&&Sr(l),!n&&l.length===0&&(Mt([]),Ht({}),et(0),qs(!1))}catch(n){console.error("File upload error:",n),qt(((s=(t=n.response)==null?void 0:t.data)==null?void 0:s.message)||"Upload failed. Please try again."),m.error(((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.message)||"Upload failed. Please try again."),setTimeout(()=>qt(""),3e3)}finally{ft(!1),tt(0),Ca(-1),Hs(0)}}},zr=()=>{if(Us.current)try{Us.current.abort()}catch{}ft(!1),Ca(-1),Hs(0)},Ci=async()=>{ys.length&&(Mt(ys),Sr([]),await Zo())},Si=async()=>{var t,s;if(!Ls||!lr){m.error("Please fill in both password fields");return}if(Ls!==lr){m.error("Passwords do not match");return}if(Ls.length<4){m.error("Password must be at least 4 characters long");return}lo(!0);try{const{data:a}=await L.patch(`${D}/api/bookings/${o._id}/chat/lock`,{password:Ls},{withCredentials:!0,headers:{"Content-Type":"application/json"}});ha(!0),ds(!1),tr(!1),ir(""),dr(""),m.success("Chat locked successfully.")}catch(a){m.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to lock chat")}finally{lo(!1)}},Jo=async()=>{var t,s;if(!cr){m.error("Please enter your password");return}mo(!0);try{const{data:a}=await L.patch(`${D}/api/bookings/${o._id}/chat/unlock`,{password:cr},{withCredentials:!0,headers:{"Content-Type":"application/json"}});ds(!0),cs(!1),mr(""),m.success("Chat access granted."),Je(!0),window.dispatchEvent(new CustomEvent("chatOpened",{detail:{appointmentId:o._id}})),Y&&Y()}catch(a){m.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Incorrect password")}finally{mo(!1)}},Qo=async()=>{var t,s;if(!ur){m.error("Please enter your password");return}ho(!0);try{const{data:a}=await L.patch(`${D}/api/bookings/${o._id}/chat/remove-lock`,{password:ur},{withCredentials:!0,headers:{"Content-Type":"application/json"}});ha(!1),ds(!1),rr(!1),hr(""),fr(!1),m.success("Chat lock removed.")}catch(a){m.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Incorrect password")}finally{ho(!1)}},_i=async()=>{var t,s;xo(!0);try{const{data:a}=await L.patch(`${D}/api/bookings/${o._id}/chat/forgot-password`,{},{withCredentials:!0});ha(!1),ds(!1),nr(!1),$([]),m.success("Chat lock removed and cleared successfully.")}catch(a){m.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to reset chat")}finally{xo(!1)}},Ri=async()=>{if(Je(!1),window.dispatchEvent(new CustomEvent("chatClosed")),ke&&ls)try{await L.patch(`${D}/api/bookings/${o._id}/chat/reset-access`,{},{withCredentials:!0}),ds(!1)}catch(t){console.error("Error resetting chat access:",t)}};i.useEffect(()=>{(async()=>{ro(!0);try{const{data:s}=await L.get(`${D}/api/bookings/${o._id}/chat/lock-status`,{withCredentials:!0});ha(s.chatLocked),ds(s.accessGranted)}catch(s){console.error("Error fetching chat lock status:",s)}finally{ro(!1)}})()},[o._id]),i.useEffect(()=>{if(E.length>0){const t=E.filter(s=>s.starredBy&&s.starredBy.includes(h._id));Ot(t)}},[E,h._id]),i.useEffect(()=>{if(E.length>0){const t=new Date,s=E.filter(a=>!a.pinned||!a.pinExpiresAt?!1:new Date(a.pinExpiresAt)>t);Ts(s)}},[E]),i.useEffect(()=>{o!=null&&o._id&&E.length>0&&Di()},[o._id,E.length]),i.useEffect(()=>{if(ue){const t=setTimeout(()=>ss(!1),1e4);return()=>clearTimeout(t)}},[ue]);const Xo=async()=>{if(o!=null&&o._id){Co(!0);try{const{data:t}=await L.get(`${D}/api/bookings/${o._id}/starred-messages`,{withCredentials:!0});t.starredMessages&&Ot(t.starredMessages)}catch(t){console.error("Error fetching starred messages:",t),m.error("Failed to load starred messages")}finally{Co(!1)}}};i.useEffect(()=>{yr&&Xo()},[yr,o._id]);const Ai=async()=>{if(ht.length!==0){ht.length,Ao(!0);try{console.log("Starting remove all starred messages operation for",ht.length,"messages");let t=0,s=0;const a=[];for(const r of ht)try{console.log(`Unstarring message ${r._id}`);const n=await L.patch(`${D}/api/bookings/${o._id}/comment/${r._id}/star`,{starred:!1},{withCredentials:!0,headers:{"Content-Type":"application/json"}});console.log(`Successfully unstarred message ${r._id}`),t++,$(l=>l.map(d=>d._id===r._id?{...d,starredBy:(d.starredBy||[]).filter(c=>c!==h._id)}:d))}catch(n){console.error(`Failed to unstar message ${r._id}:`,n),s++,a.push(r)}console.log(`Remove all operation completed: ${t} successful, ${s} failed`),Ot(r=>r.filter(n=>!a.some(l=>l._id===n._id))),t>0&&s===0?(m.success(`Successfully removed ${t} starred message${t!==1?"s":""}`),pa(!1)):t>0&&s>0?m.warning(`Partially successful: ${t} messages unstarred, ${s} failed`):m.error("Failed to unstar any messages. Please try again.")}catch(t){console.error("Error removing all starred messages:",t),m.error("Failed to remove all starred messages. Please try again.")}finally{Ao(!1)}}};i.useEffect(()=>{const t=n=>{Ps&&!n.target.closest(".chat-options-menu")&&Ce(!1),fa&&!n.target.closest(".chat-options-menu")&&pe(!1),us&&!n.target.closest(".reactions-bar")&&(Es(!1),Is(null))},s=()=>{Ps&&Ce(!1),fa&&pe(!1),us&&!hs&&(Es(!1),Is(null))},a=n=>{kr&&!n.target.closest(".search-container")&&!n.target.closest(".enhanced-search-header")&&(va(!1),ka(""),Fs([]),xt(-1))},r=n=>{Na&&!n.target.closest(".calendar-container")&&zs(!1)};return document.addEventListener("mousedown",t),document.addEventListener("mousedown",a),document.addEventListener("mousedown",r),document.addEventListener("scroll",s,!0),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("mousedown",a),document.removeEventListener("mousedown",r),document.removeEventListener("scroll",s,!0)}},[Ps,fa,kr,Na,us,hs]),i.useEffect(()=>{if(pr){const t=setTimeout(()=>{jo(!1),vo(!0);const s=setTimeout(()=>vo(!1),1e3);return()=>clearTimeout(s)},800);return()=>clearTimeout(t)}},[pr]),i.useEffect(()=>{Bs>=0&&gt[Bs]&&sn(gt[Bs]._id)},[Bs,gt]),i.useEffect(()=>{const t=T.current;if(!t)return;const s=()=>{if(t.scrollTop<=0&&E.length>Ft){const a=t.scrollHeight;bt(r=>Math.min(r+Qt,E.length)),setTimeout(()=>{const r=t.scrollHeight;t.scrollTop=r-a},0)}};return t.addEventListener("scroll",s),()=>t.removeEventListener("scroll",s)},[E.length,Ft]),i.useEffect(()=>{if(!I)return;const t=E.filter(r=>r.senderEmail!==h.email&&(!r.readBy||!r.readBy.includes(h._id))).length,a=yt||Ee===o._id?H||t:H;a>0?(bt(r=>Math.max(Qt,H+5)),setTimeout(()=>{const r=Math.max(0,se.length-a),n=se[r];if(n&&Ue.current[n._id])try{Ue.current[n._id].scrollIntoView({behavior:"auto",block:"center"})}catch{}na(!0),Va(!1),Ee===o._id&&setPreferUnreadForAppointmentId(null)},50)):(bt(Qt),setTimeout(()=>cn(),0))},[o._id,I]),i.useEffect(()=>{if(!I)return;const t=T.current;if(!t)return;const s=()=>{Me&&na(!1)};return t.addEventListener("scroll",s,{passive:!0}),()=>t.removeEventListener("scroll",s)},[I,Me]);function Zs(t){try{return JSON.parse(localStorage.getItem(`removedDeletedMsgs_${t}`))||[]}catch{return[]}}function Js(t,s){const a=Zs(t);if(!a.includes(s)){const r=[...a,s];localStorage.setItem(`removedDeletedMsgs_${t}`,JSON.stringify(r))}}const Mi=()=>{if(R){const s=Zs(o._id).filter(a=>a!==R._id);localStorage.setItem(`removedDeletedMsgs_${o._id}`,JSON.stringify(s)),$(a=>{const r=[...a],n=r.findIndex(l=>new Date(l.timestamp)>new Date(R.timestamp));return n===-1?r.push(R):r.splice(n,0,R),r}),F(null),M&&(clearTimeout(M),de(null)),m.success("Message restored!")}},en=t=>{M&&clearTimeout(M),F(t);const s=setTimeout(()=>{F(null),de(null)},5e3);de(s)},$i=async()=>{try{as(!0);const{data:t}=await L.get(`${D}/api/bookings/${o._id}`,{withCredentials:!0});t.comments&&($(s=>{const a=new Set(t.comments.map(l=>l._id)),r=s.filter(l=>l._id.startsWith("temp-")),n=[...t.comments];return r.forEach(l=>{a.has(l._id)||n.push(l)}),n}),K(0),m.success("Messages refreshed successfully!",{autoClose:2e3,position:"top-center"}))}catch(t){console.error("Error fetching latest comments:",t),m.error("Failed to refresh messages")}finally{as(!1)}},Di=async()=>{if(o!=null&&o._id){Mo(!0);try{const{data:t}=await L.get(`${D}/api/bookings/${o._id}/pinned-messages`,{withCredentials:!0});Ts(t.pinnedMessages||[])}catch{m.error("Failed to fetch pinned messages")}finally{Mo(!1)}}},Fa=async(t,s,a="24hrs",r=24)=>{if(o!=null&&o._id){ba(!0);try{const{data:n}=await L.patch(`${D}/api/bookings/${o._id}/comment/${t._id}/pin`,{pinned:s,pinDuration:a,customHours:a==="custom"?r:void 0},{withCredentials:!0,headers:{"Content-Type":"application/json"}});if($(l=>l.map(d=>d._id===t._id?{...d,pinned:n.pinned,pinnedBy:n.pinned?h._id:null,pinnedAt:n.pinned?new Date:null,pinExpiresAt:n.pinned?new Date(n.pinExpiresAt):null,pinDuration:n.pinned?a:null}:d)),s){const l={...t,pinned:!0,pinnedBy:h._id,pinnedAt:new Date,pinExpiresAt:new Date(n.pinExpiresAt),pinDuration:a};Ts(d=>[...d,l])}else Ts(l=>l.filter(d=>d._id!==t._id));m.success(n.message),gs(!1),xs(null)}catch{m.error("Failed to update pin status")}finally{ba(!1)}}},Qs=(h.role==="admin"||h.role==="rootadmin")&&h.adminApprovalStatus==="approved",Li=Jt.pathname.includes("/admin"),Be=o.role==="seller",Yt=o.role==="buyer",Xs=new Date(o.date)>new Date||new Date(o.date).toDateString()===new Date().toDateString()&&(!o.time||o.time>new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),u=!Xs||o.status==="rejected"||o.status==="cancelledByAdmin"||o.status==="cancelledByBuyer"||o.status==="cancelledBySeller"||o.status==="deletedByAdmin",ea=o.status==="pending"||o.status==="rejected"||o.status==="cancelledByAdmin"||o.status==="cancelledByBuyer"||o.status==="cancelledBySeller"||o.status==="deletedByAdmin",Or=(Qs||o.status==="accepted")&&Xs&&o.status!=="cancelledByBuyer"&&o.status!=="cancelledBySeller"&&o.status!=="cancelledByAdmin"&&o.status!=="rejected"&&o.status!=="deletedByAdmin",k=Be?o.buyerId:o.sellerId,Ei=t=>{Xe(t),p(!u),it(!0)},Ii=t=>{Xe(t),p(!1),it(!0)},Ti=async()=>{var t,s,a,r,n,l,d;if(P){try{if(Array.isArray(P)){const c=P.map(x=>x._id);if(g)try{const{data:x}=await L.delete(`${D}/api/bookings/${o._id}/comments/bulk-delete`,{withCredentials:!0,headers:{"Content-Type":"application/json"},data:{commentIds:c}});x!=null&&x.comments&&$(b=>x.comments.map(j=>{const q=b.find(ie=>ie._id===j._id);return q&&q.status==="read"&&j.status!=="read"?{...j,status:"read"}:j})),m.success(`Deleted ${c.length} messages for everyone!`)}catch(x){m.error(((s=(t=x.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to delete selected messages.");return}else try{await L.post(`${D}/api/bookings/${o._id}/comments/removed/sync`,{removedIds:c},{withCredentials:!0,headers:{"Content-Type":"application/json"}}),$(x=>x.filter(b=>!c.includes(b._id))),c.forEach(x=>Js(o._id,x)),P.length>0&&en(P[0]),m.success(`Deleted ${c.length} messages for you!`)}catch(x){m.error(((r=(a=x.response)==null?void 0:a.data)==null?void 0:r.message)||"Failed to delete selected messages for you.");return}}else if(g){const c=!((n=P.readBy)!=null&&n.includes(h._id))&&P.senderEmail!==h.email,{data:x}=await L.delete(`${D}/api/bookings/${o._id}/comment/${P._id}`,{withCredentials:!0});$(b=>x.comments.map(j=>{const q=b.find(ie=>ie._id===j._id);return q&&q.status==="read"&&j.status!=="read"?{...j,status:"read"}:j})),c&&K(b=>Math.max(0,b-1)),m.success("Message deleted for everyone!")}else{try{await L.patch(`${D}/api/bookings/${o._id}/comment/${P._id}/remove-for-me`,{},{withCredentials:!0})}catch{}$(c=>c.filter(x=>x._id!==P._id)),Js(o._id,P._id),en(P),m.success("Message deleted for you!")}}catch(c){m.error(((d=(l=c.response)==null?void 0:l.data)==null?void 0:d.message)||"An error occurred. Please try again.")}it(!1),Xe(null),p(!0)}},Pi=async()=>{var t,s;try{const a=Date.now();localStorage.setItem(mn,a),$([]),await L.patch(`${D}/api/bookings/${o._id}/chat/clear-local`,{},{withCredentials:!0}),m.success("Chat Cleared.")}catch(a){console.error("Failed to persist chat clear:",a),m.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Cleared locally, but failed to sync with server.")}finally{_(!1)}},Fi=t=>{wo(t),bo(!0)},qr=async()=>{if(!B.trim())return;if(u){m.info("Sending disabled for this appointment status. You can view chat history.");return}window.dispatchEvent(new Event("closeEmojiPicker")),jo(!0);const t=B.trim(),s=we,a=`temp-${Date.now()}`,r={_id:a,sender:h._id,senderEmail:h.email,senderName:h.username,message:t,status:"sending",timestamp:new Date().toISOString(),readBy:[h._id],previewDismissed:ti,...s?{replyTo:s._id}:{}};$(l=>[...l,r]),U("");try{const l=`appt_draft_${o._id}_${h._id}`;localStorage.removeItem(l)}catch{}bs(null),ws(!1),ne(null),zi();const n=()=>{w.current&&(w.current.focus(),w.current.setSelectionRange(0,0),document.activeElement!==w.current&&(w.current.click(),w.current.focus()))};n(),requestAnimationFrame(n),setTimeout(n,10),te.current&&te.current.scrollIntoView({behavior:"smooth"}),(async()=>{var l,d;try{const{data:c}=await L.post(`${D}/api/bookings/${o._id}/comment`,{message:t,...s?{replyTo:s._id}:{}},{withCredentials:!0,headers:{"Content-Type":"application/json"}}),x=c.comments[c.comments.length-1];$(b=>b.map(j=>j._id===a?{...j,_id:x._id,status:x.status,readBy:x.readBy||j.readBy,timestamp:x.timestamp||j.timestamp}:j)),mi()}catch(c){$(b=>b.filter(j=>j._id!==a)),m.error(((d=(l=c.response)==null?void 0:l.data)==null?void 0:d.message)||"An error occurred. Please try again.");const x=()=>{w.current&&(w.current.focus(),w.current.setSelectionRange(0,0),document.activeElement!==w.current&&(w.current.click(),w.current.focus()))};x(),requestAnimationFrame(x)}})()},Hr=async t=>{var a,r;if(!Ae.trim())return;je(t),$(n=>n.map(l=>l._id===t?{...l,message:Ae,edited:!0,editedAt:new Date}:l));try{const{data:n}=await L.patch(`${D}/api/bookings/${o._id}/comment/${t}`,{message:Ae},{withCredentials:!0,headers:{"Content-Type":"application/json"}});$(c=>c.map(x=>{const b=n.comments.find(j=>j._id===x._id);return b?b._id===t?b:x.status==="read"&&b.status!=="read"?{...b,status:"read"}:b:x})),Ke(null),V(""),U(Ze),setTimeout(()=>{ae("")},100),bs(null),ws(!1),setTimeout(()=>{if(w.current){const c=new Event("input",{bubbles:!0});w.current.dispatchEvent(c),Ba(w.current)}},50);const d=()=>{if(w.current){w.current.focus();const c=w.current.value.length;w.current.setSelectionRange(c,c),w.current.style.height="48px";const x=w.current.scrollHeight,b=144;w.current.style.height=Math.min(x,b)+"px"}};d(),requestAnimationFrame(d),setTimeout(d,10),m.success("Message edited successfully!")}catch(n){$(l=>l.map(d=>d._id===t?{...d,message:d.originalMessage||d.message,edited:d.wasEdited||!1}:d)),Ke(t),V(Ae),U(Ae),m.error(((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.message)||"An error occurred. Please try again.")}finally{je(null)}},Bi=t=>{ae(B),Ke(t._id),V(t.message),U(t.message),$(s=>s.map(a=>a._id===t._id?{...a,originalMessage:a.message,wasEdited:a.edited}:a)),setTimeout(()=>{if(w.current){w.current.focus();const s=w.current.value.length;w.current.setSelectionRange(s,s),Ba(w.current)}},100)},Ba=t=>{if(t){t.style.height="48px";const s=t.scrollHeight,a=144;s<=a?(t.style.height=s+"px",t.style.overflowY="hidden"):(t.style.height=a+"px",t.style.overflowY="auto")}},zi=()=>{w.current&&(w.current.style.height="48px",w.current.style.overflowY="hidden")},tn=t=>{ne(t);const s=()=>{if(w.current){w.current.focus();const a=w.current.value.length;w.current.setSelectionRange(a,a),document.activeElement!==w.current&&(w.current.click(),w.current.focus()),Ba(w.current)}};setTimeout(s,50),setTimeout(s,100),setTimeout(s,200)},Oi=t=>{switch(t){case"pending":return"bg-yellow-100 text-yellow-700";case"accepted":return"bg-green-100 text-green-700";case"rejected":return"bg-red-100 text-red-700";case"cancelledByBuyer":return"bg-orange-100 text-orange-700";case"cancelledBySeller":return"bg-pink-100 text-pink-700";case"cancelledByAdmin":return"bg-purple-100 text-purple-700";default:return"bg-gray-100 text-gray-700"}},qi=t=>{if(!t.trim()){Fs([]),xt(-1),document.querySelectorAll(".search-highlight").forEach(r=>{r.classList.remove("search-highlight","search-pulse","search-glow")}),document.querySelectorAll(".search-text-highlight").forEach(r=>{r.outerHTML=r.innerHTML});return}const a=E.filter(r=>{var d,c;const n=r.clearTime||0,l=Math.max(n,0);return new Date(r.timestamp).getTime()>l&&!za.includes(r._id)&&!((c=(d=r.removedFor)==null?void 0:d.includes)!=null&&c.call(d,h._id))}).filter(r=>!r.deleted).filter(r=>{var n,l;return r.message.toLowerCase().includes(t.toLowerCase())||((n=r.senderName)==null?void 0:n.toLowerCase().includes(t.toLowerCase()))||((l=r.senderEmail)==null?void 0:l.toLowerCase().includes(t.toLowerCase()))}).map(r=>({...r,matchIndex:r.message.toLowerCase().indexOf(t.toLowerCase())}));Fs(a),a.length>0?(xt(0),setTimeout(()=>{sn(a[0]._id)},100)):xt(-1)},Hi=t=>{const s=t.target.value;ka(s),qi(s)},Ui=t=>{t.key==="Enter"?(t.preventDefault(),gt.length>0&&xt(s=>s<gt.length-1?s+1:0)):t.key==="Escape"&&(va(!1),ka(""),Fs([]),xt(-1),document.querySelectorAll(".search-text-highlight").forEach(s=>{s.outerHTML=s.innerHTML}))},sn=t=>{const s=Ue.current[t];s&&(s.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),setTimeout(()=>{document.querySelectorAll(".search-highlight").forEach(r=>{r.classList.remove("search-highlight","search-pulse","search-glow")}),s.classList.add("search-highlight","search-pulse","search-glow");const a=document.createElement("div");a.className="search-ripple",s.style.position="relative",s.appendChild(a),setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},1e3),setTimeout(()=>{s.classList.remove("search-highlight","search-pulse","search-glow")},3e3)},300))},Vi=t=>{Zn(t),zs(!1);const s=E.filter(l=>{var x,b;const d=l.clearTime||0,c=Math.max(d,0);return new Date(l.timestamp).getTime()>c&&!za.includes(l._id)&&!((b=(x=l.removedFor)==null?void 0:x.includes)!=null&&b.call(x,h._id))}),r=new Date(t).toDateString(),n=s.find(l=>new Date(l.timestamp).toDateString()===r);if(n){const l=Ue.current[n._id];l&&(l.classList.add("date-jump-preparing"),l.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),setTimeout(()=>{l.classList.remove("date-jump-preparing"),Lo(n._id),l.classList.add("date-highlight","date-jump-pulse");const d=document.createElement("div");d.className="date-jump-ripple",l.style.position="relative",l.appendChild(d),setTimeout(()=>{d.parentNode&&d.parentNode.removeChild(d)},1e3),setTimeout(()=>{l.classList.remove("date-highlight","date-jump-pulse"),Lo(null)},4e3)},500))}else m.info("No messages found for the selected date in visible chat",{position:"top-center",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0})},Yi=t=>{const s=new Date(t),a=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0");return`${a}-${r}-${n}`},an=async()=>{St(""),Za(!0)},Wi=async()=>{var t,s,a;if(!ms.trim()){m.error("Reason is required for cancellation.");return}try{const{data:r}=await L.patch(`${D}/api/bookings/${o._id}/cancel`,{reason:ms},{withCredentials:!0,headers:{"Content-Type":"application/json"}});m.success("Appointment cancelled successfully."),typeof ye=="function"&&ye(o._id,Be?"cancelledBySeller":"cancelledByBuyer"),Za(!1),St("")}catch(r){if(((t=r.response)==null?void 0:t.status)===401){m.error("Session expired or unauthorized. Please sign in again."),navigate("/sign-in");return}m.error(((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.message)||"An error occurred. Please try again.")}},Gi=async()=>{St(""),Ja(!0)},Ki=async()=>{var t,s,a;if(!ms.trim()){m.error("Reason is required for admin cancellation.");return}try{const{data:r}=await L.patch(`${D}/api/bookings/${o._id}/cancel`,{reason:ms},{withCredentials:!0,headers:{"Content-Type":"application/json"}});m.success("Appointment cancelled by admin."),navigate("/user/my-appointments"),Ja(!1),St("")}catch(r){if(((t=r.response)==null?void 0:t.status)===401){m.error("Session expired or unauthorized. Please sign in again."),navigate("/sign-in");return}m.error(((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to cancel appointment.")}},Ur=async()=>{Xa(!0)},Zi=async()=>{var t,s;try{const a=Yt?"buyer":Be?"seller":null;if(!a)return;const{data:r}=await L.patch(`${D}/api/bookings/${o._id}/soft-delete`,{who:a},{withCredentials:!0,headers:{"Content-Type":"application/json"}});if(typeof window<"u"){const n=new CustomEvent("removeAppointmentRow",{detail:o._id});window.dispatchEvent(n),m.success("Appointment removed from your table successfully.")}Xa(!1)}catch(a){m.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to remove appointment from table.")}};i.useEffect(()=>{I&&te.current&&te.current.scrollIntoView({behavior:"smooth"})},[I]);const _e=async(t,s)=>{var a,r;if(u){m.info("Reactions disabled for this appointment status. You can view chat history.");return}try{if(!E.find(d=>d._id===t)){m.error("Message not found");return}const{data:l}=await L.patch(`${D}/api/bookings/${o._id}/comment/${t}/react`,{emoji:s},{withCredentials:!0,headers:{"Content-Type":"application/json"}});$(d=>d.map(c=>c._id===t?{...c,reactions:l.reactions||c.reactions||[]}:c)),Rt(!1),Es(!1),Is(null),m.success("Reaction added!")}catch(n){m.error(((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.message)||"Failed to add reaction")}},Ji=t=>{if(u){m.info("Reactions disabled for this appointment status. You can view chat history.");return}_t===t&&us?(Es(!1),Is(null),Rt(!1)):(Is(t),Es(!0),Rt(!1))},[$l,Dl]=i.useState("react"),[Ll,El]=i.useState(""),[ta,rn]=i.useState(""),on=[{emoji:"ðŸ˜€",keywords:["grinning","happy","smile","joy"]},{emoji:"ðŸ˜ƒ",keywords:["grinning","happy","smile","joy","smiley"]},{emoji:"ðŸ˜„",keywords:["grinning","happy","smile","joy","laugh"]},{emoji:"ðŸ˜",keywords:["grinning","happy","smile","joy","beaming"]},{emoji:"ðŸ˜†",keywords:["grinning","happy","smile","joy","laugh","squinting"]},{emoji:"ðŸ˜…",keywords:["grinning","happy","smile","sweat","relief"]},{emoji:"ðŸ˜‚",keywords:["joy","laugh","tears","funny","lol","crying"]},{emoji:"ðŸ¤£",keywords:["rolling","laugh","funny","lol","rofl"]},{emoji:"ðŸ˜Š",keywords:["smiling","happy","blush","smile"]},{emoji:"ðŸ˜‡",keywords:["innocent","angel","halo","good"]},{emoji:"ðŸ™‚",keywords:["slightly","smiling","happy"]},{emoji:"ðŸ™ƒ",keywords:["upside","down","silly","sarcastic"]},{emoji:"ðŸ˜‰",keywords:["winking","flirt","wink"]},{emoji:"ðŸ˜Œ",keywords:["relieved","peaceful","calm"]},{emoji:"ðŸ˜",keywords:["heart","eyes","love","adore","crush"]},{emoji:"ðŸ¥°",keywords:["smiling","hearts","love","adore"]},{emoji:"ðŸ˜˜",keywords:["kiss","love","heart"]},{emoji:"ðŸ˜—",keywords:["kissing","kiss"]},{emoji:"ðŸ˜™",keywords:["kissing","smiling","eyes"]},{emoji:"ðŸ˜š",keywords:["kissing","closed","eyes"]},{emoji:"ðŸ˜‹",keywords:["yummy","delicious","tongue"]},{emoji:"ðŸ˜›",keywords:["tongue","out","playful"]},{emoji:"ðŸ˜",keywords:["tongue","winking","playful"]},{emoji:"ðŸ˜œ",keywords:["tongue","winking","crazy"]},{emoji:"ðŸ¤ª",keywords:["zany","crazy","wild"]},{emoji:"ðŸ¤¨",keywords:["raised","eyebrow","suspicious"]},{emoji:"ðŸ§",keywords:["monocle","thinking","pondering"]},{emoji:"ðŸ¤“",keywords:["nerd","geek","glasses"]},{emoji:"ðŸ˜Ž",keywords:["cool","sunglasses","awesome"]},{emoji:"ðŸ¤©",keywords:["star","struck","excited"]},{emoji:"ðŸ¥³",keywords:["party","celebration","hat"]},{emoji:"ðŸ˜",keywords:["smirk","sly","mischievous"]},{emoji:"ðŸ˜’",keywords:["unamused","bored","meh"]},{emoji:"ðŸ˜ž",keywords:["disappointed","sad"]},{emoji:"ðŸ˜”",keywords:["pensive","sad","thoughtful"]},{emoji:"ðŸ˜Ÿ",keywords:["worried","concerned"]},{emoji:"ðŸ˜•",keywords:["confused","slightly","frowning"]},{emoji:"ðŸ™",keywords:["slightly","frowning","sad"]},{emoji:"â˜¹ï¸",keywords:["frowning","sad"]},{emoji:"ðŸ˜£",keywords:["persevering","struggling"]},{emoji:"ðŸ˜–",keywords:["confounded","frustrated"]},{emoji:"ðŸ˜«",keywords:["tired","exhausted"]},{emoji:"ðŸ˜©",keywords:["weary","tired"]},{emoji:"ðŸ¥º",keywords:["pleading","puppy","eyes"]},{emoji:"ðŸ˜¢",keywords:["crying","sad","tear"]},{emoji:"ðŸ˜­",keywords:["loudly","crying","sad","bawling"]},{emoji:"ðŸ˜¤",keywords:["huffing","angry","steam"]},{emoji:"ðŸ˜ ",keywords:["angry","mad"]},{emoji:"ðŸ˜¡",keywords:["pouting","angry","rage"]},{emoji:"ðŸ¤¬",keywords:["swearing","cursing","angry"]},{emoji:"ðŸ¤¯",keywords:["exploding","head","mind","blown"]},{emoji:"ðŸ˜³",keywords:["flushed","embarrassed"]},{emoji:"ðŸ¥µ",keywords:["hot","sweating"]},{emoji:"ðŸ¥¶",keywords:["cold","freezing"]},{emoji:"ðŸ˜±",keywords:["screaming","fear","shocked"]},{emoji:"ðŸ˜¨",keywords:["fearful","scared"]},{emoji:"ðŸ˜°",keywords:["anxious","sweat","worried"]},{emoji:"ðŸ˜¥",keywords:["sad","relieved","disappointed"]},{emoji:"ðŸ˜“",keywords:["downcast","sweat","sad"]},{emoji:"ðŸ¤—",keywords:["hugging","hug","embrace"]},{emoji:"ðŸ¤”",keywords:["thinking","pondering"]},{emoji:"ðŸ¤­",keywords:["hand","over","mouth","giggle"]},{emoji:"ðŸ¤«",keywords:["shushing","quiet","secret"]},{emoji:"ðŸ¤¥",keywords:["lying","pinocchio"]},{emoji:"ðŸ˜¶",keywords:["no","mouth","speechless"]},{emoji:"ðŸ˜",keywords:["neutral","expressionless"]},{emoji:"ðŸ˜‘",keywords:["expressionless","blank"]},{emoji:"ðŸ˜¯",keywords:["hushed","surprised"]},{emoji:"ðŸ˜¦",keywords:["frowning","open","mouth"]},{emoji:"ðŸ˜§",keywords:["anguished","shocked"]},{emoji:"ðŸ˜®",keywords:["open","mouth","surprised","wow"]},{emoji:"ðŸ˜²",keywords:["astonished","shocked"]},{emoji:"ðŸ¥±",keywords:["yawning","tired","sleepy"]},{emoji:"ðŸ˜´",keywords:["sleeping","zzz","tired"]},{emoji:"ðŸ¤¤",keywords:["drooling","sleepy"]},{emoji:"ðŸ˜ª",keywords:["sleepy","tired"]},{emoji:"ðŸ˜µ",keywords:["dizzy","confused"]},{emoji:"ðŸ¤",keywords:["zipper","mouth","quiet"]},{emoji:"ðŸ¥´",keywords:["woozy","drunk","dizzy"]},{emoji:"ðŸ¤¢",keywords:["nauseated","sick"]},{emoji:"ðŸ¤®",keywords:["vomiting","sick"]},{emoji:"ðŸ¤§",keywords:["sneezing","sick"]},{emoji:"ðŸ˜·",keywords:["mask","sick","medical"]},{emoji:"ðŸ¤’",keywords:["thermometer","sick","fever"]},{emoji:"ðŸ¤•",keywords:["bandage","hurt","injured"]},{emoji:"ðŸ¤‘",keywords:["money","mouth","rich"]},{emoji:"ðŸ¤ ",keywords:["cowboy","hat"]},{emoji:"ðŸ’€",keywords:["skull","death","dead"]},{emoji:"ðŸ‘»",keywords:["ghost","spooky"]},{emoji:"ðŸ‘½",keywords:["alien","extraterrestrial"]},{emoji:"ðŸ‘¾",keywords:["alien","monster","game"]},{emoji:"ðŸ¤–",keywords:["robot","bot"]},{emoji:"ðŸ˜ˆ",keywords:["smiling","devil","evil"]},{emoji:"ðŸ‘¿",keywords:["angry","devil","evil"]},{emoji:"ðŸ‘¹",keywords:["ogre","monster"]},{emoji:"ðŸ‘º",keywords:["goblin","monster"]},{emoji:"ðŸ’ª",keywords:["flexed","biceps","strong","muscle"]},{emoji:"ðŸ¦¾",keywords:["mechanical","arm","prosthetic"]},{emoji:"ðŸ¦¿",keywords:["mechanical","leg","prosthetic"]},{emoji:"ðŸ¦µ",keywords:["leg"]},{emoji:"ðŸ¦¶",keywords:["foot"]},{emoji:"ðŸ‘‚",keywords:["ear","hearing"]},{emoji:"ðŸ¦»",keywords:["ear","hearing","aid"]},{emoji:"ðŸ‘ƒ",keywords:["nose","smell"]},{emoji:"ðŸ§ ",keywords:["brain","smart"]},{emoji:"ðŸ«€",keywords:["heart","organ"]},{emoji:"ðŸ«",keywords:["lungs","breathing"]},{emoji:"ðŸ¦·",keywords:["tooth","dental"]},{emoji:"ðŸ¦´",keywords:["bone"]},{emoji:"ðŸ‘€",keywords:["eyes","looking","watching"]},{emoji:"ðŸ‘ï¸",keywords:["eye","looking"]},{emoji:"ðŸ‘…",keywords:["tongue"]},{emoji:"ðŸ‘„",keywords:["mouth","lips"]},{emoji:"ðŸ’‹",keywords:["kiss","lips"]},{emoji:"ðŸ©¸",keywords:["blood","drop"]},{emoji:"ðŸ«‚",keywords:["people","hugging","hug"]},{emoji:"ðŸ‘¶",keywords:["baby","infant"]},{emoji:"ðŸ‘§",keywords:["girl","child"]},{emoji:"ðŸ§’",keywords:["child"]},{emoji:"ðŸ‘¦",keywords:["boy","child"]},{emoji:"ðŸ‘©",keywords:["woman","female"]},{emoji:"ðŸ§‘",keywords:["person","adult"]},{emoji:"ðŸ‘¨",keywords:["man","male"]},{emoji:"ðŸ‘µ",keywords:["old","woman","grandmother"]},{emoji:"ðŸ§“",keywords:["older","person"]},{emoji:"ðŸ‘´",keywords:["old","man","grandfather"]},{emoji:"ðŸ‘",keywords:["thumbs","up","good","yes","like","approve"]},{emoji:"ðŸ‘Ž",keywords:["thumbs","down","bad","no","dislike"]},{emoji:"ðŸ‘Œ",keywords:["ok","okay","perfect"]},{emoji:"âœŒï¸",keywords:["victory","peace","two"]},{emoji:"ðŸ¤ž",keywords:["crossed","fingers","luck"]},{emoji:"ðŸ¤Ÿ",keywords:["love","you","gesture"]},{emoji:"ðŸ¤˜",keywords:["rock","on","horns"]},{emoji:"ðŸ¤™",keywords:["call","me","hang","loose"]},{emoji:"ðŸ‘ˆ",keywords:["pointing","left"]},{emoji:"ðŸ‘‰",keywords:["pointing","right"]},{emoji:"ðŸ‘†",keywords:["pointing","up"]},{emoji:"ðŸ–•",keywords:["middle","finger","rude"]},{emoji:"ðŸ‘‡",keywords:["pointing","down"]},{emoji:"â˜ï¸",keywords:["index","pointing","up"]},{emoji:"ðŸ‘‹",keywords:["waving","hand","hello","goodbye"]},{emoji:"ðŸ¤š",keywords:["raised","back","hand"]},{emoji:"ðŸ–ï¸",keywords:["hand","five","fingers"]},{emoji:"âœ‹",keywords:["raised","hand","stop"]},{emoji:"ðŸ––",keywords:["vulcan","salute","spock"]},{emoji:"ðŸ¤Œ",keywords:["pinched","fingers"]},{emoji:"ðŸ¤",keywords:["pinching","hand"]},{emoji:"ðŸ¶",keywords:["dog","puppy","pet"]},{emoji:"ðŸ±",keywords:["cat","kitten","pet"]},{emoji:"ðŸ­",keywords:["mouse","rodent"]},{emoji:"ðŸ¹",keywords:["hamster","pet"]},{emoji:"ðŸ°",keywords:["rabbit","bunny"]},{emoji:"ðŸ¦Š",keywords:["fox"]},{emoji:"ðŸ»",keywords:["bear"]},{emoji:"ðŸ¼",keywords:["panda","bear"]},{emoji:"ðŸ»â€â„ï¸",keywords:["polar","bear"]},{emoji:"ðŸ¨",keywords:["koala"]},{emoji:"ðŸ¯",keywords:["tiger"]},{emoji:"ðŸ¦",keywords:["lion"]},{emoji:"ðŸ®",keywords:["cow"]},{emoji:"ðŸ·",keywords:["pig"]},{emoji:"ðŸ¸",keywords:["frog"]},{emoji:"ðŸµ",keywords:["monkey"]},{emoji:"ðŸ™ˆ",keywords:["see","no","evil","monkey"]},{emoji:"ðŸ™‰",keywords:["hear","no","evil","monkey"]},{emoji:"ðŸ™Š",keywords:["speak","no","evil","monkey"]},{emoji:"ðŸ’",keywords:["monkey"]},{emoji:"ðŸ”",keywords:["chicken"]},{emoji:"ðŸ§",keywords:["penguin"]},{emoji:"ðŸ¦",keywords:["bird"]},{emoji:"ðŸ¤",keywords:["baby","chick"]},{emoji:"ðŸ£",keywords:["hatching","chick"]},{emoji:"ðŸ¦†",keywords:["duck"]},{emoji:"ðŸ¦…",keywords:["eagle"]},{emoji:"ðŸ¦‰",keywords:["owl"]},{emoji:"ðŸ¦‡",keywords:["bat"]},{emoji:"ðŸº",keywords:["wolf"]},{emoji:"ðŸ—",keywords:["boar"]},{emoji:"ðŸ´",keywords:["horse"]},{emoji:"ðŸ¦„",keywords:["unicorn","magical"]},{emoji:"ðŸ",keywords:["bee","honeybee"]},{emoji:"ðŸ›",keywords:["bug","insect"]},{emoji:"ðŸ¦‹",keywords:["butterfly"]},{emoji:"ðŸŒ",keywords:["snail"]},{emoji:"ðŸž",keywords:["ladybug","beetle"]},{emoji:"ðŸœ",keywords:["ant"]},{emoji:"ðŸ¦Ÿ",keywords:["mosquito"]},{emoji:"ðŸ¦—",keywords:["cricket"]},{emoji:"ðŸ•·ï¸",keywords:["spider"]},{emoji:"ðŸ•¸ï¸",keywords:["spider","web"]},{emoji:"ðŸ¦‚",keywords:["scorpion"]},{emoji:"ðŸ¢",keywords:["turtle"]},{emoji:"ðŸ",keywords:["snake"]},{emoji:"ðŸ¦Ž",keywords:["lizard"]},{emoji:"ðŸ¦–",keywords:["t-rex","dinosaur"]},{emoji:"ðŸ¦•",keywords:["sauropod","dinosaur"]},{emoji:"ðŸ™",keywords:["octopus"]},{emoji:"ðŸ¦‘",keywords:["squid"]},{emoji:"ðŸ¦",keywords:["shrimp"]},{emoji:"ðŸ¦ž",keywords:["lobster"]},{emoji:"ðŸ¦€",keywords:["crab"]},{emoji:"ðŸ¡",keywords:["blowfish"]},{emoji:"ðŸ ",keywords:["tropical","fish"]},{emoji:"ðŸŸ",keywords:["fish"]},{emoji:"ðŸ¬",keywords:["dolphin"]},{emoji:"ðŸ³",keywords:["spouting","whale"]},{emoji:"ðŸ‹",keywords:["whale"]},{emoji:"ðŸ¦ˆ",keywords:["shark"]},{emoji:"ðŸŠ",keywords:["crocodile"]},{emoji:"ðŸŽ",keywords:["apple","fruit","red"]},{emoji:"ðŸ",keywords:["pear","fruit"]},{emoji:"ðŸŠ",keywords:["orange","fruit"]},{emoji:"ðŸ‹",keywords:["lemon","fruit","sour"]},{emoji:"ðŸŒ",keywords:["banana","fruit"]},{emoji:"ðŸ‰",keywords:["watermelon","fruit"]},{emoji:"ðŸ‡",keywords:["grapes","fruit"]},{emoji:"ðŸ“",keywords:["strawberry","fruit"]},{emoji:"ðŸ«",keywords:["blueberries","fruit"]},{emoji:"ðŸˆ",keywords:["melon","fruit"]},{emoji:"ðŸ’",keywords:["cherries","fruit"]},{emoji:"ðŸ‘",keywords:["peach","fruit"]},{emoji:"ðŸ¥­",keywords:["mango","fruit"]},{emoji:"ðŸ",keywords:["pineapple","fruit"]},{emoji:"ðŸ¥¥",keywords:["coconut","fruit"]},{emoji:"ðŸ¥",keywords:["kiwi","fruit"]},{emoji:"ðŸ…",keywords:["tomato","vegetable"]},{emoji:"ðŸ†",keywords:["eggplant","vegetable"]},{emoji:"ðŸ¥‘",keywords:["avocado","fruit"]},{emoji:"ðŸ¥¦",keywords:["broccoli","vegetable"]},{emoji:"ðŸ¥¬",keywords:["leafy","greens","vegetable"]},{emoji:"ðŸ¥’",keywords:["cucumber","vegetable"]},{emoji:"ðŸŒ¶ï¸",keywords:["hot","pepper","spicy"]},{emoji:"ðŸ«‘",keywords:["bell","pepper","vegetable"]},{emoji:"ðŸŒ½",keywords:["corn","vegetable"]},{emoji:"ðŸ¥•",keywords:["carrot","vegetable"]},{emoji:"ðŸ«’",keywords:["olive"]},{emoji:"ðŸ§„",keywords:["garlic"]},{emoji:"ðŸ§…",keywords:["onion"]},{emoji:"ðŸ¥”",keywords:["potato","vegetable"]},{emoji:"ðŸ ",keywords:["roasted","sweet","potato"]},{emoji:"ðŸ¥",keywords:["croissant","bread"]},{emoji:"ðŸ¥¯",keywords:["bagel","bread"]},{emoji:"ðŸž",keywords:["bread","loaf"]},{emoji:"ðŸ¥–",keywords:["baguette","bread"]},{emoji:"ðŸ¥¨",keywords:["pretzel"]},{emoji:"ðŸ§€",keywords:["cheese"]},{emoji:"ðŸ¥š",keywords:["egg"]},{emoji:"ðŸ³",keywords:["cooking","egg","fried"]},{emoji:"ðŸ§ˆ",keywords:["butter"]},{emoji:"ðŸ¥ž",keywords:["pancakes"]},{emoji:"ðŸ§‡",keywords:["waffle"]},{emoji:"ðŸ¥“",keywords:["bacon"]},{emoji:"ðŸ¥©",keywords:["cut","meat"]},{emoji:"ðŸ—",keywords:["poultry","leg","chicken"]},{emoji:"ðŸ–",keywords:["meat","bone"]},{emoji:"ðŸ¦´",keywords:["bone"]},{emoji:"ðŸŒ­",keywords:["hot","dog"]},{emoji:"ðŸ”",keywords:["hamburger","burger"]},{emoji:"ðŸŸ",keywords:["french","fries"]},{emoji:"ðŸ•",keywords:["pizza"]},{emoji:"ðŸ¥ª",keywords:["sandwich"]},{emoji:"ðŸ¥™",keywords:["stuffed","flatbread"]},{emoji:"ðŸ§†",keywords:["falafel"]},{emoji:"ðŸŒ®",keywords:["taco"]},{emoji:"ðŸŒ¯",keywords:["burrito"]},{emoji:"ðŸ«”",keywords:["tamale"]},{emoji:"ðŸ¥—",keywords:["green","salad"]},{emoji:"ðŸ¥˜",keywords:["shallow","pan","food"]},{emoji:"ðŸ«•",keywords:["fondue"]},{emoji:"ðŸ¥«",keywords:["canned","food"]},{emoji:"ðŸ",keywords:["spaghetti","pasta"]},{emoji:"ðŸœ",keywords:["steaming","bowl","ramen"]},{emoji:"ðŸ²",keywords:["pot","food","stew"]},{emoji:"ðŸ›",keywords:["curry","rice"]},{emoji:"ðŸ£",keywords:["sushi"]},{emoji:"ðŸ±",keywords:["bento","box"]},{emoji:"ðŸ¥Ÿ",keywords:["dumpling"]},{emoji:"ðŸ¦ª",keywords:["oyster"]},{emoji:"ðŸ¤",keywords:["fried","shrimp"]},{emoji:"ðŸ™",keywords:["rice","ball"]},{emoji:"ðŸš",keywords:["cooked","rice"]},{emoji:"ðŸ˜",keywords:["rice","cracker"]},{emoji:"ðŸ¥",keywords:["fish","cake","swirl"]},{emoji:"ðŸ¥ ",keywords:["fortune","cookie"]},{emoji:"ðŸ¥®",keywords:["moon","cake"]},{emoji:"ðŸ¢",keywords:["oden"]},{emoji:"ðŸ¡",keywords:["dango"]},{emoji:"ðŸ§",keywords:["shaved","ice"]},{emoji:"ðŸ¨",keywords:["ice","cream"]},{emoji:"ðŸ¦",keywords:["soft","ice","cream"]},{emoji:"ðŸ°",keywords:["shortcake","cake"]},{emoji:"ðŸ§",keywords:["cupcake"]},{emoji:"ðŸ¥§",keywords:["pie"]},{emoji:"ðŸ®",keywords:["custard"]},{emoji:"ðŸ­",keywords:["lollipop","candy"]},{emoji:"ðŸ¬",keywords:["candy","sweet"]},{emoji:"ðŸ«",keywords:["chocolate","bar"]},{emoji:"ðŸ¿",keywords:["popcorn"]},{emoji:"ðŸª",keywords:["cookie"]},{emoji:"ðŸŒ°",keywords:["chestnut"]},{emoji:"ðŸ¥œ",keywords:["peanuts","nuts"]},{emoji:"ðŸ¯",keywords:["honey","pot"]},{emoji:"ðŸ¥›",keywords:["glass","milk"]},{emoji:"ðŸ¼",keywords:["baby","bottle"]},{emoji:"ðŸ«–",keywords:["teapot"]},{emoji:"âš½",keywords:["soccer","ball","football"]},{emoji:"ðŸ€",keywords:["basketball"]},{emoji:"ðŸˆ",keywords:["american","football"]},{emoji:"âš¾",keywords:["baseball"]},{emoji:"ðŸ¥Ž",keywords:["softball"]},{emoji:"ðŸŽ¾",keywords:["tennis"]},{emoji:"ðŸ",keywords:["volleyball"]},{emoji:"ðŸ‰",keywords:["rugby","football"]},{emoji:"ðŸ¥",keywords:["flying","disc","frisbee"]},{emoji:"ðŸŽ±",keywords:["pool","8","ball"]},{emoji:"ðŸª€",keywords:["yo-yo"]},{emoji:"ðŸ“",keywords:["ping","pong","table","tennis"]},{emoji:"ðŸ¸",keywords:["badminton"]},{emoji:"ðŸ’",keywords:["ice","hockey"]},{emoji:"ðŸ‘",keywords:["field","hockey"]},{emoji:"ðŸ¥",keywords:["lacrosse"]},{emoji:"ðŸ",keywords:["cricket"]},{emoji:"ðŸ¥…",keywords:["goal","net"]},{emoji:"â›³",keywords:["flag","hole","golf"]},{emoji:"ðŸª",keywords:["kite"]},{emoji:"ðŸ¹",keywords:["bow","arrow"]},{emoji:"ðŸŽ£",keywords:["fishing","pole"]},{emoji:"ðŸ¤¿",keywords:["diving","mask"]},{emoji:"ðŸ¥Š",keywords:["boxing","glove"]},{emoji:"ðŸ¥‹",keywords:["martial","arts","uniform"]},{emoji:"ðŸŽ½",keywords:["running","shirt"]},{emoji:"ðŸ›¹",keywords:["skateboard"]},{emoji:"ðŸ›·",keywords:["sled"]},{emoji:"â›¸ï¸",keywords:["ice","skate"]},{emoji:"ðŸ¥Œ",keywords:["curling","stone"]},{emoji:"ðŸŽ¿",keywords:["skis"]},{emoji:"â›·ï¸",keywords:["skier"]},{emoji:"ðŸ‚",keywords:["snowboarder"]},{emoji:"ðŸª‚",keywords:["parachute"]},{emoji:"ðŸŽ­",keywords:["performing","arts","theater"]},{emoji:"ðŸ©°",keywords:["ballet","shoes"]},{emoji:"ðŸŽ¨",keywords:["artist","palette","art"]},{emoji:"ðŸŽ¬",keywords:["clapper","board","movie"]},{emoji:"ðŸŽ¤",keywords:["microphone","singing"]},{emoji:"ðŸŽ§",keywords:["headphone","music"]},{emoji:"ðŸŽ¼",keywords:["musical","score"]},{emoji:"ðŸŽ¹",keywords:["musical","keyboard","piano"]},{emoji:"ðŸ¥",keywords:["drum"]},{emoji:"ðŸª˜",keywords:["long","drum"]},{emoji:"ðŸŽ·",keywords:["saxophone"]},{emoji:"ðŸŽº",keywords:["trumpet"]},{emoji:"ðŸŽ¸",keywords:["guitar"]},{emoji:"ðŸª•",keywords:["banjo"]},{emoji:"ðŸŽ»",keywords:["violin"]},{emoji:"ðŸŽ²",keywords:["game","die","dice"]},{emoji:"â™Ÿï¸",keywords:["chess","pawn"]},{emoji:"ðŸŽ¯",keywords:["direct","hit","target"]},{emoji:"ðŸŽ³",keywords:["bowling"]},{emoji:"ðŸŽ®",keywords:["video","game","controller"]},{emoji:"ðŸŽ°",keywords:["slot","machine"]},{emoji:"ðŸ§©",keywords:["puzzle","piece"]},{emoji:"ðŸ“±",keywords:["mobile","phone","cell"]},{emoji:"ðŸš—",keywords:["automobile","car"]},{emoji:"ðŸš•",keywords:["taxi"]},{emoji:"ðŸš™",keywords:["sport","utility","vehicle","suv"]},{emoji:"ðŸšŒ",keywords:["bus"]},{emoji:"ðŸšŽ",keywords:["trolleybus"]},{emoji:"ðŸŽï¸",keywords:["racing","car"]},{emoji:"ðŸš“",keywords:["police","car"]},{emoji:"ðŸš‘",keywords:["ambulance"]},{emoji:"ðŸš’",keywords:["fire","engine"]},{emoji:"ðŸš",keywords:["minibus"]},{emoji:"ðŸšš",keywords:["delivery","truck"]},{emoji:"ðŸš›",keywords:["articulated","lorry"]},{emoji:"ðŸšœ",keywords:["tractor"]},{emoji:"ðŸ›´",keywords:["kick","scooter"]},{emoji:"ðŸ›µ",keywords:["motor","scooter"]},{emoji:"ðŸï¸",keywords:["motorcycle"]},{emoji:"ðŸš¨",keywords:["police","car","light"]},{emoji:"ðŸš”",keywords:["oncoming","police","car"]},{emoji:"ðŸš",keywords:["oncoming","bus"]},{emoji:"ðŸš˜",keywords:["oncoming","automobile"]},{emoji:"ðŸš–",keywords:["oncoming","taxi"]},{emoji:"ðŸš¡",keywords:["aerial","tramway"]},{emoji:"ðŸš ",keywords:["mountain","cableway"]},{emoji:"ðŸšŸ",keywords:["suspension","railway"]},{emoji:"ðŸšƒ",keywords:["railway","car"]},{emoji:"ðŸš‹",keywords:["tram","car"]},{emoji:"ðŸšž",keywords:["mountain","railway"]},{emoji:"ðŸš",keywords:["monorail"]},{emoji:"ðŸš„",keywords:["high-speed","train"]},{emoji:"ðŸš…",keywords:["bullet","train"]},{emoji:"ðŸšˆ",keywords:["light","rail"]},{emoji:"ðŸš‚",keywords:["locomotive"]},{emoji:"ðŸš†",keywords:["train"]},{emoji:"ðŸš‡",keywords:["metro","subway"]},{emoji:"ðŸšŠ",keywords:["tram"]},{emoji:"ðŸš‰",keywords:["station"]},{emoji:"âœˆï¸",keywords:["airplane","plane","flight"]},{emoji:"ðŸ›«",keywords:["airplane","departure"]},{emoji:"ðŸ›¬",keywords:["airplane","arrival"]},{emoji:"ðŸ›©ï¸",keywords:["small","airplane"]},{emoji:"ðŸ’º",keywords:["seat"]},{emoji:"ðŸ›°ï¸",keywords:["satellite"]},{emoji:"ðŸš€",keywords:["rocket","space"]},{emoji:"ðŸ›¸",keywords:["flying","saucer","ufo"]},{emoji:"ðŸš",keywords:["helicopter"]},{emoji:"ðŸ›¶",keywords:["canoe"]},{emoji:"â›µ",keywords:["sailboat"]},{emoji:"ðŸš¤",keywords:["speedboat"]},{emoji:"ðŸ›¥ï¸",keywords:["motor","boat"]},{emoji:"ðŸ›³ï¸",keywords:["passenger","ship"]},{emoji:"â›´ï¸",keywords:["ferry"]},{emoji:"ðŸš¢",keywords:["ship"]},{emoji:"âš“",keywords:["anchor"]},{emoji:"ðŸš§",keywords:["construction"]},{emoji:"â›½",keywords:["fuel","pump","gas"]},{emoji:"ðŸš",keywords:["bus","stop"]},{emoji:"ðŸš¦",keywords:["vertical","traffic","light"]},{emoji:"ðŸš¥",keywords:["horizontal","traffic","light"]},{emoji:"ðŸ—ºï¸",keywords:["world","map"]},{emoji:"ðŸ—¿",keywords:["moai","statue"]},{emoji:"ðŸ—½",keywords:["statue","liberty"]},{emoji:"ðŸ—¼",keywords:["tokyo","tower"]},{emoji:"ðŸ°",keywords:["castle"]},{emoji:"ðŸ¯",keywords:["japanese","castle"]},{emoji:"ðŸŸï¸",keywords:["stadium"]},{emoji:"ðŸŽ¡",keywords:["ferris","wheel"]},{emoji:"ðŸŽ¢",keywords:["roller","coaster"]},{emoji:"ðŸŽ ",keywords:["carousel","horse"]},{emoji:"â›²",keywords:["fountain"]},{emoji:"â›±ï¸",keywords:["umbrella","beach"]},{emoji:"ðŸ–ï¸",keywords:["beach","umbrella"]},{emoji:"ðŸï¸",keywords:["desert","island"]},{emoji:"ðŸ”ï¸",keywords:["snow-capped","mountain"]},{emoji:"ðŸ—»",keywords:["mount","fuji"]},{emoji:"ðŸŒ‹",keywords:["volcano"]},{emoji:"ðŸ—¾",keywords:["map","japan"]},{emoji:"ðŸ•ï¸",keywords:["camping"]},{emoji:"â›º",keywords:["tent"]},{emoji:"ðŸ ",keywords:["house"]},{emoji:"ðŸ¡",keywords:["house","garden"]},{emoji:"ðŸ˜ï¸",keywords:["houses"]},{emoji:"ðŸšï¸",keywords:["derelict","house"]},{emoji:"ðŸ—ï¸",keywords:["building","construction"]},{emoji:"ðŸ­",keywords:["factory"]},{emoji:"ðŸ¢",keywords:["office","building"]},{emoji:"ðŸ¬",keywords:["department","store"]},{emoji:"ðŸ£",keywords:["japanese","post","office"]},{emoji:"ðŸ¤",keywords:["post","office"]},{emoji:"ðŸ¥",keywords:["hospital"]},{emoji:"ðŸ¦",keywords:["bank"]},{emoji:"ðŸ¨",keywords:["hotel"]},{emoji:"ðŸª",keywords:["convenience","store"]},{emoji:"ðŸ«",keywords:["school"]},{emoji:"ðŸ©",keywords:["love","hotel"]},{emoji:"ðŸ’’",keywords:["wedding"]},{emoji:"â›ª",keywords:["church"]},{emoji:"â¤ï¸",keywords:["red","heart","love"]},{emoji:"ðŸ§¡",keywords:["orange","heart","love"]},{emoji:"ðŸ’›",keywords:["yellow","heart","love"]},{emoji:"ðŸ’š",keywords:["green","heart","love"]},{emoji:"ðŸ’™",keywords:["blue","heart","love"]},{emoji:"ðŸ’œ",keywords:["purple","heart","love"]},{emoji:"ðŸ–¤",keywords:["black","heart","love"]},{emoji:"ðŸ¤",keywords:["white","heart","love"]},{emoji:"ðŸ¤Ž",keywords:["brown","heart","love"]},{emoji:"ðŸ’”",keywords:["broken","heart","sad"]},{emoji:"â£ï¸",keywords:["heavy","heart","exclamation"]},{emoji:"ðŸ’•",keywords:["two","hearts","love"]},{emoji:"ðŸ’ž",keywords:["revolving","hearts","love"]},{emoji:"ðŸ’“",keywords:["beating","heart","love"]},{emoji:"ðŸ’—",keywords:["growing","heart","love"]},{emoji:"ðŸ’–",keywords:["sparkling","heart","love"]},{emoji:"ðŸ’˜",keywords:["heart","arrow","cupid"]},{emoji:"ðŸ’",keywords:["heart","ribbon","gift"]},{emoji:"ðŸ’Ÿ",keywords:["heart","decoration"]},{emoji:"â˜®ï¸",keywords:["peace","symbol"]},{emoji:"âœï¸",keywords:["latin","cross"]},{emoji:"â˜ªï¸",keywords:["star","crescent"]},{emoji:"ðŸ•‰ï¸",keywords:["om"]},{emoji:"â˜¸ï¸",keywords:["wheel","dharma"]},{emoji:"âœ¡ï¸",keywords:["star","david"]},{emoji:"ðŸ”¯",keywords:["dotted","six-pointed","star"]},{emoji:"ðŸ•Ž",keywords:["menorah"]},{emoji:"â˜¯ï¸",keywords:["yin","yang"]},{emoji:"â˜¦ï¸",keywords:["orthodox","cross"]},{emoji:"ðŸ›",keywords:["place","worship"]},{emoji:"â›Ž",keywords:["ophiuchus"]},{emoji:"â™ˆ",keywords:["aries"]},{emoji:"â™‰",keywords:["taurus"]},{emoji:"â™Š",keywords:["gemini"]},{emoji:"â™‹",keywords:["cancer"]},{emoji:"â™Œ",keywords:["leo"]},{emoji:"â™",keywords:["virgo"]},{emoji:"â™Ž",keywords:["libra"]},{emoji:"â™",keywords:["scorpio"]},{emoji:"â™",keywords:["sagittarius"]},{emoji:"â™‘",keywords:["capricorn"]},{emoji:"â™’",keywords:["aquarius"]},{emoji:"â™“",keywords:["pisces"]},{emoji:"ðŸ†”",keywords:["id","button"]},{emoji:"âš›ï¸",keywords:["atom","symbol"]},{emoji:"ðŸ‰‘",keywords:["japanese","acceptable"]},{emoji:"â˜¢ï¸",keywords:["radioactive"]},{emoji:"â˜£ï¸",keywords:["biohazard"]},{emoji:"ðŸ“´",keywords:["mobile","phone","off"]},{emoji:"ðŸ“³",keywords:["vibration","mode"]},{emoji:"ðŸˆ¶",keywords:["japanese","not","free","charge"]},{emoji:"ðŸˆš",keywords:["japanese","free","charge"]},{emoji:"ðŸˆ¸",keywords:["japanese","application"]},{emoji:"ðŸˆº",keywords:["japanese","open","business"]},{emoji:"ðŸˆ·ï¸",keywords:["japanese","monthly","amount"]},{emoji:"âœ´ï¸",keywords:["eight-pointed","star"]},{emoji:"ðŸ†š",keywords:["vs","button"]},{emoji:"ðŸ’®",keywords:["white","flower"]},{emoji:"ðŸ‰",keywords:["japanese","bargain"]},{emoji:"ãŠ™ï¸",keywords:["japanese","secret"]},{emoji:"ãŠ—ï¸",keywords:["japanese","congratulations"]},{emoji:"ðŸˆ´",keywords:["japanese","passing","grade"]},{emoji:"ðŸˆµ",keywords:["japanese","no","vacancy"]},{emoji:"ðŸˆ¹",keywords:["japanese","discount"]},{emoji:"ðŸˆ²",keywords:["japanese","prohibited"]},{emoji:"ðŸ…°ï¸",keywords:["a","button","blood","type"]},{emoji:"ðŸ…±ï¸",keywords:["b","button","blood","type"]},{emoji:"ðŸ†Ž",keywords:["ab","button","blood","type"]},{emoji:"ðŸ†‘",keywords:["cl","button"]},{emoji:"ðŸ…¾ï¸",keywords:["o","button","blood","type"]},{emoji:"ðŸ†˜",keywords:["sos","button"]},{emoji:"âŒ",keywords:["cross","mark","no","x"]},{emoji:"â­•",keywords:["heavy","large","circle"]},{emoji:"ðŸ›‘",keywords:["stop","sign"]},{emoji:"â›”",keywords:["no","entry"]},{emoji:"ðŸ“›",keywords:["name","badge"]},{emoji:"ðŸš«",keywords:["prohibited"]},{emoji:"ðŸ’¯",keywords:["hundred","points","perfect"]},{emoji:"ðŸ’¢",keywords:["anger","symbol"]},{emoji:"â™¨ï¸",keywords:["hot","springs"]},{emoji:"ðŸš·",keywords:["no","pedestrians"]},{emoji:"ðŸš¯",keywords:["no","littering"]},{emoji:"ðŸš³",keywords:["no","bicycles"]},{emoji:"ðŸš±",keywords:["non-potable","water"]},{emoji:"ðŸ”ž",keywords:["no","one","under","eighteen"]},{emoji:"ðŸ“µ",keywords:["no","mobile","phones"]},{emoji:"ðŸš­",keywords:["no","smoking"]},{emoji:"â—",keywords:["exclamation","mark"]},{emoji:"â•",keywords:["white","exclamation","mark"]},{emoji:"â“",keywords:["question","mark"]},{emoji:"â”",keywords:["white","question","mark"]},{emoji:"â€¼ï¸",keywords:["double","exclamation","mark"]},{emoji:"â‰ï¸",keywords:["exclamation","question","mark"]},{emoji:"ðŸ”…",keywords:["dim","button"]},{emoji:"ðŸ”†",keywords:["bright","button"]},{emoji:"ã€½ï¸",keywords:["part","alternation","mark"]},{emoji:"ðŸ",keywords:["chequered","flag","racing"]},{emoji:"ðŸš©",keywords:["triangular","flag"]},{emoji:"ðŸŽŒ",keywords:["crossed","flags"]},{emoji:"ðŸ´",keywords:["black","flag"]},{emoji:"ðŸ³ï¸",keywords:["white","flag"]},{emoji:"ðŸ³ï¸â€ðŸŒˆ",keywords:["rainbow","flag","pride"]},{emoji:"ðŸ´â€â˜ ï¸",keywords:["pirate","flag"]},{emoji:"ðŸŽ‰",keywords:["party","popper","celebration"]},{emoji:"ðŸŽŠ",keywords:["confetti","ball","celebration"]},{emoji:"ðŸŽˆ",keywords:["balloon","party"]},{emoji:"ðŸŽ‚",keywords:["birthday","cake"]},{emoji:"ðŸŽ",keywords:["wrapped","gift","present"]},{emoji:"ðŸŽ„",keywords:["christmas","tree"]},{emoji:"ðŸŽƒ",keywords:["jack-o-lantern","halloween"]},{emoji:"ðŸŽ—ï¸",keywords:["reminder","ribbon"]},{emoji:"ðŸŽŸï¸",keywords:["admission","tickets"]},{emoji:"ðŸŽ«",keywords:["ticket"]},{emoji:"ðŸŽ–ï¸",keywords:["military","medal"]},{emoji:"ðŸ†",keywords:["trophy","winner"]},{emoji:"ðŸ…",keywords:["sports","medal"]},{emoji:"ðŸ¥‡",keywords:["1st","place","medal","gold"]},{emoji:"ðŸ¥ˆ",keywords:["2nd","place","medal","silver"]},{emoji:"ðŸ¥‰",keywords:["3rd","place","medal","bronze"]},{emoji:"ðŸ”¥",keywords:["fire","hot","lit"]},{emoji:"ðŸ’¯",keywords:["hundred","points","perfect","100"]},{emoji:"âœ¨",keywords:["sparkles","magic","shiny"]},{emoji:"ðŸŒŸ",keywords:["glowing","star"]},{emoji:"ðŸ’«",keywords:["dizzy"]},{emoji:"â­",keywords:["star"]},{emoji:"ðŸ’¥",keywords:["collision","explosion"]},{emoji:"âš¡",keywords:["high","voltage","lightning"]},{emoji:"ðŸ’¦",keywords:["sweat","droplets"]},{emoji:"ðŸ’¨",keywords:["dashing","away","wind"]},{emoji:"â˜ï¸",keywords:["cloud"]},{emoji:"ðŸŒ¤ï¸",keywords:["sun","behind","small","cloud"]},{emoji:"â›…",keywords:["sun","behind","cloud"]},{emoji:"ðŸŒ¥ï¸",keywords:["sun","behind","large","cloud"]},{emoji:"ðŸŒ¦ï¸",keywords:["sun","behind","rain","cloud"]},{emoji:"ðŸŒ§ï¸",keywords:["cloud","rain"]},{emoji:"â›ˆï¸",keywords:["cloud","lightning","rain"]},{emoji:"ðŸŒ©ï¸",keywords:["cloud","lightning"]},{emoji:"ðŸŒ¨ï¸",keywords:["cloud","snow"]},{emoji:"â˜ƒï¸",keywords:["snowman"]},{emoji:"â›„",keywords:["snowman","without","snow"]},{emoji:"ðŸŒ¬ï¸",keywords:["wind","face"]},{emoji:"ðŸŒªï¸",keywords:["tornado"]},{emoji:"ðŸŒ«ï¸",keywords:["fog"]},{emoji:"ðŸŒŠ",keywords:["water","wave"]},{emoji:"ðŸ’§",keywords:["droplet","water"]},{emoji:"â˜”",keywords:["umbrella","rain","drops"]},{emoji:"â˜‚ï¸",keywords:["umbrella"]},{emoji:"ðŸŒ‚",keywords:["closed","umbrella"]}],Vr=t=>{if(!t.trim())return on.map(a=>a.emoji);const s=t.toLowerCase();return on.filter(a=>a.keywords.some(r=>r.toLowerCase().includes(s))).map(a=>a.emoji)},nn=()=>{Rt(!hs)};i.useCallback(t=>{if(hs)return t.stopPropagation(),t.preventDefault(),!1},[hs]);const Yr=i.useRef(!1),Cs=i.useCallback(async()=>{var l,d;if(!T.current||Yr.current||!(o!=null&&o._id))return;const{scrollTop:t,scrollHeight:s,clientHeight:a}=T.current;if(!(s-t-a<10))return;const n=E.filter(c=>{var x;return!((x=c.readBy)!=null&&x.includes(h._id))&&c.senderEmail!==h.email});if(n.length>0){Yr.current=!0;try{const{data:c}=await L.patch(`${D}/api/bookings/${o._id}/comments/read`,{},{withCredentials:!0,headers:{"Content-Type":"application/json"}});$(x=>x.map(b=>n.some(j=>j._id===b._id)?{...b,readBy:[...b.readBy||[],h._id],status:"read"}:b)),n.forEach(x=>{O.emit("messageRead",{appointmentId:o._id,messageId:x._id,userId:h._id,readBy:h._id})}),K(x=>Math.max(0,x-n.length))}catch(c){((l=c.response)==null?void 0:l.status)!==500?console.error("Error marking messages as read:",c):console.warn("Server error marking messages as read (will retry later):",(d=c.response)==null?void 0:d.status)}finally{Yr.current=!1}}},[E,h._id,o._id,O]),ln=i.useRef(E.length),Qi=i.useRef(E);i.useEffect(()=>{const t=E.slice(ln.current),s=t.length;if(ln.current=E.length,Qi.current=E,s>0&&I){const a=t.some(n=>n.senderEmail===h.email),r=t.filter(n=>n.senderEmail!==h.email);a||A?setTimeout(()=>{te.current&&(te.current.scrollIntoView({behavior:"smooth"}),A&&r.length>0&&setTimeout(()=>{Cs()},300))},100):r.length>0&&K(n=>n+r.length)}},[E.length,A,I,h.email,Cs]);const dn=i.useCallback(()=>{if(T.current){const{scrollTop:t,scrollHeight:s,clientHeight:a}=T.current,r=s-t-a<10;fe(r),r&&(E.filter(l=>{var d;return!((d=l.readBy)!=null&&d.includes(h._id))&&l.senderEmail!==h.email}).length>0&&Cs(),H>0&&K(0))}},[H,Cs,E,h._id]),Wr=i.useCallback(()=>{if(!T.current||E.length===0)return;const t=`chatClearTime_${o._id}`,s=Number(localStorage.getItem(t))||0,a=(()=>{const j=o.role==="buyer"?o.buyerChatClearedAt:o.sellerChatClearedAt;return j?new Date(j).getTime():0})(),r=Math.max(s,a),n=Zs(o._id),l=E.filter(j=>new Date(j.timestamp).getTime()>r&&!n.includes(j._id));if(l.length===0)return;const c=T.current.getBoundingClientRect(),x=c.top+60;let b="";for(let j=0;j<l.length;j++){const q=Ue.current[l[j]._id];if(q){const ie=q.getBoundingClientRect();if(ie.top>=x&&ie.bottom<=c.bottom){const ot=new Date(l[j].timestamp);b=Xr(ot);break}}}if(!b)for(let j=0;j<l.length;j++){const q=Ue.current[l[j]._id];if(q&&q.getBoundingClientRect().bottom>x){const ot=new Date(l[j].timestamp);b=Xr(ot);break}}b&&b!==wt&&Rs(b)},[E,wt,o._id]);i.useEffect(()=>{const t=T.current;if(t&&I){const s=()=>{dn(),Wr(),Qe(!0),kt.current&&clearTimeout(kt.current),kt.current=setTimeout(()=>{Qe(!1)},1e3)};if(t.addEventListener("scroll",s),t){const{scrollTop:a,scrollHeight:r,clientHeight:n}=t,l=r-a-n<10;fe(l)}return setTimeout(Wr,100),()=>{t.removeEventListener("scroll",s),kt.current&&clearTimeout(kt.current)}}},[I,dn,Wr]),i.useEffect(()=>{I&&te.current&&te.current.scrollIntoView({behavior:"smooth"})},[I]);const cn=i.useCallback(()=>{K(0),setTimeout(()=>{T.current&&(T.current.scrollTop=T.current.scrollHeight),te.current&&te.current.scrollIntoView({behavior:"smooth",block:"end"}),setTimeout(()=>{Cs()},500)},100)},[Cs]);i.useEffect(()=>{function t(r){r.appointmentId===o._id&&$(n=>{var d;const l=n.findIndex(c=>c._id===r.comment._id);if(l!==-1){const c=[...n],x=n[l],b=r.comment;let j=b.status;return x.status==="read"&&b.status!=="read"&&(j="read"),c[l]={...b,status:j},c}else return!n.some(x=>x._id.toString().startsWith("temp-"))||r.comment.senderEmail!==h.email?(r.comment.senderEmail!==h.email&&!I&&!((d=r.comment.readBy)!=null&&d.includes(h._id))?K(x=>x+1):Oo(),[...n,r.comment]):n})}function s({appointmentId:r,clearedAt:n}){if(r===o._id){try{const l=`chatClearTime_${o._id}`,d=Number(localStorage.getItem(l))||0,c=n?new Date(n).getTime():0,x=Math.max(d,c);localStorage.setItem(l,String(x))}catch{}$([]),K(0)}}function a({appointmentId:r,commentId:n}){r===o._id&&($(l=>l.filter(d=>d._id!==n)),Js(o._id,n))}return O.on("commentUpdate",t),O.on("chatClearedForUser",s),O.on("commentRemovedForUser",a),()=>{O.off("commentUpdate",t),O.off("chatClearedForUser",s),O.off("commentRemovedForUser",a)}},[o._id,h.email,h._id,I,ui,Oo]),i.useEffect(()=>(I?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[I]),i.useEffect(()=>{I&&(o!=null&&o._id)&&L.patch(`${D}/api/bookings/${o._id}/comments/read`,{},{withCredentials:!0}).catch(t=>{var s,a;((s=t.response)==null?void 0:s.status)!==500?console.warn("Error marking comments as read on modal open:",t):console.warn("Server error marking comments as read on modal open (will retry later):",(a=t.response)==null?void 0:a.status)})},[I,o._id]),i.useEffect(()=>{function t(a){a.appointmentId===o._id&&$(r=>r.map(n=>n._id===a.commentId?{...n,status:n.status==="read"?"read":"delivered",deliveredAt:new Date}:n))}function s(a){a.appointmentId===o._id&&$(r=>r.map(n=>{var l;return(l=n.readBy)!=null&&l.includes(a.userId)?n:{...n,status:"read",readBy:[...n.readBy||[],a.userId],readAt:new Date}}))}return O.on("commentDelivered",t),O.on("commentRead",s),()=>{O.off("commentDelivered",t),O.off("commentRead",s)}},[o._id,$]);const mn=`chatClearTime_${o._id}`,Xi=Number(localStorage.getItem(mn))||0,el=(()=>{const t=o.role==="buyer"?o.buyerChatClearedAt:o.sellerChatClearedAt;return t?new Date(t).getTime():0})(),Gr=Math.max(Xi,el),za=Zs(o._id),ze=E.filter(t=>{var s,a,r;return!((s=t.readBy)!=null&&s.includes(h._id))&&t.senderEmail!==h.email&&!t.deleted&&new Date(t.timestamp).getTime()>Gr&&!((r=(a=t.removedFor)==null?void 0:a.includes)!=null&&r.call(a,h._id))&&!za.includes(t._id)}).length;i.useEffect(()=>{I&&H===0&&ze>0&&K(ze)},[I,ze,H]),i.useEffect(()=>{!I&&ze>0&&K(ze)},[ze,I]),i.useEffect(()=>{E.length>0&&ze>0&&H===0&&K(ze)},[E,ze,H]),i.useEffect(()=>{(async()=>{if(E.length>0&&H===0){const s=E.filter(a=>{var r,n,l;return!((r=a.readBy)!=null&&r.includes(h._id))&&a.senderEmail!==h.email&&!a.deleted&&new Date(a.timestamp).getTime()>Gr&&!((l=(n=a.removedFor)==null?void 0:n.includes)!=null&&l.call(n,h._id))&&!Zs(o._id).includes(a._id)}).length;s>0&&K(s)}})()},[E,h._id,o._id,H]),i.useEffect(()=>(I?document.body.style.overflow="hidden":(document.body.style.overflow="",ze>0?K(ze):K(0)),()=>{document.body.style.overflow=""}),[I,ze]);const se=E.filter(t=>{var s,a;return new Date(t.timestamp).getTime()>Gr&&!za.includes(t._id)&&!((a=(s=t.removedFor)==null?void 0:s.includes)!=null&&a.call(s,h._id))});i.useEffect(()=>{if(!I||!(k!=null&&k._id))return;O.emit("checkUserOnline",{userId:k._id});function t(s){s.userId===k._id&&(As(!!s.online),es(s.lastSeen||null))}return O.on("userOnlineStatus",t),O.on("userOnlineUpdate",t),()=>{O.off("userOnlineStatus",t),O.off("userOnlineUpdate",t)}},[I,k==null?void 0:k._id]),i.useEffect(()=>{if(!(k!=null&&k._id))return;O.emit("checkUserOnline",{userId:k._id});function t(s){s.userId===k._id&&(Xt(!!s.online),da(s.lastSeen||null))}return O.on("userOnlineStatus",t),O.on("userOnlineUpdate",t),()=>{O.off("userOnlineStatus",t),O.off("userOnlineUpdate",t)}},[k==null?void 0:k._id]),i.useEffect(()=>{function t(s){s.fromUserId===(k==null?void 0:k._id)&&s.appointmentId===o._id&&(ts(!0),Ie.current&&clearTimeout(Ie.current),Ie.current=setTimeout(()=>ts(!1),1e3))}return O.on("typing",t),()=>{O.off("typing",t),Ie.current&&clearTimeout(Ie.current)}},[k==null?void 0:k._id,o._id]),i.useEffect(()=>{if(!I)return;setTimeout(()=>{w.current&&xl(w.current,w.current.value.length)},100);const s=a=>{a.ctrlKey&&a.key==="f"?(a.preventDefault(),w.current&&fl(w.current,w.current.value.length)):a.key==="Escape"&&(a.preventDefault(),Je(!1))};return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[I]);function un(t){if(!t)return null;const s=new Date(t),a=new Date,r=Math.floor((a-s)/(1e3*60)),n=Math.floor(r/60),l=Math.floor(n/24);return r<1?"last seen just now":r<60?`last seen ${r} minute${r>1?"s":""} ago`:n<24?`last seen ${n} hour${n>1?"s":""} ago`:l<7?`last seen ${l} day${l>1?"s":""} ago`:`last seen ${s.toLocaleDateString("en-US",{month:"short",day:"numeric",year:s.getFullYear()!==a.getFullYear()?"numeric":void 0})}`}const S=xa?E.find(t=>t._id===xa):null;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-blue-50 transition align-top ${Xs?"":"bg-gray-100"}`,children:[e.jsx("td",{className:"border p-2",children:e.jsxs("div",{children:[e.jsx("div",{children:new Date(o.date).toLocaleDateString("en-GB")}),e.jsx("div",{className:"text-sm text-gray-600",children:o.time}),!Xs&&e.jsx("div",{className:"text-xs text-red-600 font-medium mt-1",children:"Outdated"}),X&&o.archivedAt&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Archived: ",new Date(o.archivedAt).toLocaleDateString("en-GB")]})]})}),e.jsx("td",{className:"border p-2",children:e.jsx("div",{children:o.listingId?e.jsx(eo,{to:Li?`/admin/listing/${o.listingId._id}`:`/user/listing/${o.listingId._id}`,className:"font-semibold text-blue-600 hover:text-blue-800 hover:underline cursor-pointer",children:o.propertyName}):e.jsx("div",{className:"font-semibold",children:o.propertyName})})}),e.jsx("td",{className:"border p-2 text-center",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${Be?"bg-blue-100 text-blue-700":"bg-green-100 text-green-700"}`,children:Be?"Seller":"Buyer"})}),e.jsx("td",{className:"border p-2",children:e.jsxs("div",{children:[Or?e.jsx("button",{className:"font-semibold text-blue-700 hover:underline text-left",style:{cursor:"pointer"},onClick:()=>pt({...k,isOnline:vt,isTyping:qe,lastSeen:Bt},o),title:"Click to view details",children:(k==null?void 0:k.username)||"Unknown"}):e.jsx("span",{className:"font-semibold",children:(k==null?void 0:k.username)||"Unknown"}),Or?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm text-gray-600",children:k==null?void 0:k.email}),e.jsx("div",{className:"text-sm text-gray-600",children:k!=null&&k.mobileNumber&&(k==null?void 0:k.mobileNumber)!==""?k.mobileNumber:"No phone"})]}):e.jsx("div",{className:"text-sm text-gray-500 italic",children:Qs?"Contact info available":"Contact info hidden until accepted"})]})}),e.jsx("td",{className:"border p-2 capitalize",children:o.purpose}),e.jsx("td",{className:"border p-2 max-w-xs truncate",children:o.message||"No message provided"}),e.jsx("td",{className:"border p-2 text-center",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${Oi(o.status)}`,children:o.status==="cancelledByBuyer"?"Cancelled by Buyer":o.status==="cancelledBySeller"?"Cancelled by Seller":o.status==="cancelledByAdmin"?"Cancelled by Admin":o.status.charAt(0).toUpperCase()+o.status.slice(1)})}),e.jsx("td",{className:"border p-2 text-center",children:e.jsx(jl,{appointment:o,isBuyer:Yt})}),e.jsx("td",{className:"border p-2 text-center",children:e.jsx("div",{className:"flex flex-col gap-2",children:X?e.jsx("button",{className:"text-green-600 hover:text-green-800 text-xl",onClick:()=>Oe(o._id),title:"Unarchive Appointment",children:e.jsx(We,{size:16})}):e.jsx(e.Fragment,{children:Xs?e.jsxs(e.Fragment,{children:[Be&&o.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"text-green-500 hover:text-green-700 text-xl disabled:opacity-50",onClick:()=>C(o._id,"accepted"),disabled:Zt===o._id+"accepted"||!o.paymentConfirmed,title:o.paymentConfirmed?"Accept Appointment":"Accept enabled after buyer payment",children:e.jsx(Oa,{})}),!o.paymentConfirmed&&e.jsx("button",{className:"text-red-500 hover:text-red-700 text-xl disabled:opacity-50",onClick:()=>C(o._id,"rejected"),disabled:Zt===o._id+"rejected",title:"Reject Appointment",children:e.jsx(oe,{})})]}),Be&&o.status==="accepted"&&e.jsx("button",{className:"text-red-500 hover:text-red-700 text-xl",onClick:an,title:"Cancel Appointment (Seller)",children:e.jsx(Q,{})}),Be&&(o.status==="cancelledBySeller"||o.status==="cancelledByBuyer"||o.status==="cancelledByAdmin"||o.status==="rejected"||o.status==="deletedByAdmin")&&e.jsx("button",{className:"text-gray-400 hover:text-red-700 text-xl",onClick:Ur,title:"Remove from table",style:{opacity:.5},children:e.jsx(Q,{className:"group-hover:text-red-900 group-hover:scale-125 group-hover:animate-shake transition-all duration-200"})}),Yt&&(o.status==="pending"||o.status==="accepted")&&e.jsx("button",{className:"text-red-500 hover:text-red-700 text-xl",onClick:an,title:"Cancel Appointment (Buyer)",children:e.jsx(Q,{})}),Yt&&(o.status==="cancelledByBuyer"||o.status==="cancelledBySeller"||o.status==="cancelledByAdmin"||o.status==="deletedByAdmin"||o.status==="rejected")&&e.jsx("button",{className:"text-gray-400 hover:text-red-700 text-xl",onClick:Ur,title:"Remove from table",style:{opacity:.5},children:e.jsx(Q,{className:"group-hover:text-red-900 group-hover:scale-125 group-hover:animate-shake transition-all duration-200"})}),Qs&&e.jsx("button",{className:"text-red-500 hover:text-red-700 text-xl",onClick:Gi,title:"Cancel Appointment (Admin)",children:e.jsx(Bn,{})}),!Qs&&e.jsx("button",{className:"text-gray-600 hover:text-gray-800 text-xl",onClick:()=>Ge(o._id),title:"Archive Appointment",children:e.jsx(ra,{size:16})}),(o.status==="cancelledByBuyer"&&Yt||o.status==="cancelledBySeller"&&Be)&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("button",{className:"text-blue-500 hover:text-blue-700 text-xs border border-blue-500 rounded px-2 py-1 mt-1",onClick:()=>Le(o),disabled:o.status==="cancelledByBuyer"&&Yt&&(o.buyerReinitiationCount||0)>=2||o.status==="cancelledBySeller"&&Be&&(o.sellerReinitiationCount||0)>=2||!o.buyerId||!o.sellerId,title:"Reinitiate or Reschedule Appointment",children:"Reinitiate"}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:Yt&&o.status==="cancelledByBuyer"?`${2-(o.buyerReinitiationCount||0)} left`:Be&&o.status==="cancelledBySeller"?`${2-(o.sellerReinitiationCount||0)} left`:""})]})]}):e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{className:"text-gray-400 hover:text-red-700 text-xl",onClick:Ur,title:"Delete outdated appointment from table",style:{opacity:.7},children:e.jsx(Q,{size:18})}),!Qs&&e.jsx("button",{className:"text-gray-600 hover:text-gray-800 text-xl",onClick:()=>Ge(o._id),title:"Archive outdated appointment",children:e.jsx(ra,{size:16})})]})})})}),e.jsx("td",{className:"border p-2 text-center relative",children:e.jsxs("button",{className:"flex items-center justify-center rounded-full p-3 shadow-lg mx-auto relative transform transition-all duration-200 group bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white hover:shadow-xl hover:scale-105",title:"Open Chat",onClick:()=>{(ke||ge)&&!ls?cs(!0):(Je(!0),window.dispatchEvent(new CustomEvent("chatOpened",{detail:{appointmentId:o._id}})))},children:[e.jsx(Mn,{size:22,className:"group-hover:animate-pulse"}),e.jsx("div",{className:"absolute inset-0 bg-white rounded-full opacity-0 group-hover:opacity-20 transition-opacity duration-200"}),(ke||ge)&&!ls&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-orange-500 text-white text-xs rounded-full px-1.5 py-0.5 min-w-[18px] text-center font-bold border-2 border-white",children:ge?"â³":"ðŸ”’"}),qe&&!((ke||ge)&&!ls)&&!ea&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-green-500 text-white text-xs rounded-full px-1.5 py-0.5 min-w-[18px] text-center font-bold border-2 border-white animate-pulse",children:"..."}),!qe&&H>0&&!((ke||ge)&&!ls)&&!ea&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1.5 py-0.5 min-w-[18px] text-center font-bold border-2 border-white",children:H}),!qe&&H===0&&vt&&!((ke||ge)&&!ls)&&!ea&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-green-500 border-2 border-white rounded-full w-3 h-3"})]})})]}),I&&e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-md flex items-center justify-center z-50 p-4",children:[hs&&_t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 backdrop-blur-sm flex items-center justify-center z-[999999] animate-fadeIn",onMouseDown:t=>{t.target===t.currentTarget&&Rt(!1)},onClick:t=>{t.target===t.currentTarget&&Rt(!1)},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-200 p-6 max-w-md w-full mx-4 max-h-[80vh] overflow-hidden quick-reactions-modal",onMouseDown:t=>{t.stopPropagation()},onClick:t=>{t.stopPropagation()},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-800",children:"Quick Reactions"}),e.jsx("button",{onMouseDown:t=>{t.stopPropagation(),t.preventDefault()},onClick:t=>{t.stopPropagation(),Rt(!1),rn("")},className:"text-gray-500 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors",title:"Close",children:e.jsx(oe,{size:16})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search emojis...",value:ta,onChange:t=>rn(t.target.value),className:"w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",onMouseDown:t=>t.stopPropagation(),onClick:t=>t.stopPropagation()}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),ta&&e.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:[Vr(ta).length," emoji",Vr(ta).length!==1?"s":""," found"]})]}),e.jsx("div",{className:"overflow-y-auto max-h-[60vh] scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",onMouseDown:t=>{t.stopPropagation()},onClick:t=>{t.stopPropagation()},children:e.jsx("div",{className:"grid grid-cols-10 gap-2",onMouseDown:t=>{t.stopPropagation()},onClick:t=>{t.stopPropagation()},children:Vr(ta).map(t=>e.jsx("button",{onMouseDown:s=>{s.stopPropagation(),s.preventDefault()},onClick:s=>{s.stopPropagation(),s.preventDefault(),_t&&o._id?(_e(_t,t),Rt(!1)):m.error("Unable to add reaction - missing message information")},className:"w-10 h-10 flex items-center justify-center text-xl hover:scale-110 transition-all duration-200 bg-gray-50 hover:bg-gray-100 rounded-lg border border-gray-200 hover:border-gray-300 hover:shadow-md",title:`React with ${t}`,children:t},t))})})]})}),e.jsxs("div",{className:"bg-gradient-to-br from-white via-blue-50 to-purple-50 rounded-3xl shadow-2xl w-full h-full max-w-6xl max-h-full p-0 relative animate-fadeIn flex flex-col border border-gray-200 transform transition-all duration-500 hover:shadow-3xl overflow-hidden",children:[e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-2 sm:gap-3 px-4 sm:px-6 py-2 sm:py-3 border-b-2 border-blue-700 bg-gradient-to-r from-blue-700 via-purple-700 to-blue-900 rounded-t-3xl relative shadow-2xl flex-shrink-0 md:sticky md:top-0 sticky top-[env(safe-area-inset-top,0px)] z-30",children:vr?e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-white text-sm cursor-pointer hover:text-blue-200 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:ce.length===se.length&&se.length>0,onChange:()=>{ce.length===se.length?xe([]):xe([...se])},className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),e.jsx("span",{className:"font-medium",children:"Select All Messages"})]}),e.jsxs("span",{className:"text-white text-sm font-medium",children:["(",ce.length," message",ce.length!==1?"s":""," selected)"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[ce.length===1?e.jsx("div",{className:"flex items-center gap-2",children:(()=>{var a,r,n;const t=ce[0],s=t.senderEmail===h.email;return e.jsxs(e.Fragment,{children:[!t.deleted&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{tn(t),Pe(!1),xe([])},title:"Reply","aria-label":"Reply",children:e.jsx("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c4.28 0 6.92 1.45 8.84 4.55.23.36.76.09.65-.32C18.31 13.13 15.36 10.36 10 9z"})})}),e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{ee(t.message),Pe(!1),xe([])},title:"Copy message","aria-label":"Copy message",children:e.jsx(qa,{size:18})}),e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:async()=>{var d,c,x;const l=(d=t.starredBy)==null?void 0:d.includes(h._id);ja(b=>({...b,starring:!0}));try{const{data:b}=await L.patch(`${D}/api/bookings/${o._id}/comment/${t._id}/star`,{starred:!l},{withCredentials:!0,headers:{"Content-Type":"application/json"}});$(j=>j.map(q=>q._id===t._id?{...q,starredBy:l?(q.starredBy||[]).filter(ie=>ie!==h._id):[...q.starredBy||[],h._id]}:q)),m.success(l?"Message unstarred.":"Message starred.")}catch(b){m.error(((x=(c=b.response)==null?void 0:c.data)==null?void 0:x.message)||"Failed to update star status")}finally{ja(b=>({...b,starring:!1}))}Pe(!1),xe([])},title:(a=t.starredBy)!=null&&a.includes(h._id)?"Unstar message":"Star message","aria-label":(r=t.starredBy)!=null&&r.includes(h._id)?"Unstar message":"Star message",disabled:ps.starring,children:ps.starring?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):(n=t.starredBy)!=null&&n.includes(h._id)?e.jsx(Wt,{size:18}):e.jsx(Zr,{size:18})}),s&&null,e.jsx("button",{className:`rounded-full p-2 transition-colors ${u?"text-gray-400 bg-white/5 cursor-not-allowed":"text-white hover:text-red-200 bg-white/10 hover:bg-white/20"}`,onClick:()=>{if(u){m.info("Delete disabled for this appointment status. You can view chat history.");return}Xe(t),p(u?!1:s),it(!0),Pe(!1),xe([])},disabled:u,title:u?"Delete disabled for this appointment status":"Delete","aria-label":u?"Delete disabled for this appointment status":"Delete",children:e.jsx(Q,{size:18})})]}),t.deleted&&e.jsx("button",{className:`rounded-full p-2 transition-colors ${u?"text-gray-400 bg-white/5 cursor-not-allowed":"text-white hover:text-red-200 bg-white/10 hover:bg-white/20"}`,onClick:async()=>{if(u){m.info("Delete disabled for this appointment status. You can view chat history.");return}try{await L.patch(`${D}/api/bookings/${o._id}/comment/${t._id}/remove-for-me`,{},{withCredentials:!0})}catch{}$(l=>l.filter(d=>d._id!==t._id)),Js(o._id,t._id),m.success("Message deleted for you!"),Pe(!1),xe([])},disabled:u,title:u?"Delete disabled for this appointment status":"Delete for me","aria-label":u?"Delete disabled for this appointment status":"Delete for me",children:e.jsx(Q,{size:18})})]})})()}):ce.length>1?e.jsx("div",{className:"flex items-center gap-2",children:ce.some(t=>t.deleted)?e.jsx("button",{className:`rounded-full p-2 transition-colors ${u?"text-gray-400 bg-white/5 cursor-not-allowed":"text-white hover:text-red-200 bg-white/10 hover:bg-white/20"}`,onClick:async()=>{var s,a;if(u){m.info("Delete disabled for this appointment status. You can view chat history.");return}const t=ce.map(r=>r._id);try{await L.post(`${D}/api/bookings/${o._id}/comments/removed/sync`,{removedIds:t},{withCredentials:!0,headers:{"Content-Type":"application/json"}}),$(r=>r.filter(n=>!t.includes(n._id))),t.forEach(r=>Js(o._id,r)),m.success(`Deleted ${t.length} messages for you!`),Pe(!1),xe([])}catch(r){m.error(((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to delete selected messages for you.")}},disabled:u,title:u?"Delete disabled for this appointment status":"Delete selected (for me)","aria-label":u?"Delete disabled for this appointment status":"Delete selected (for me)",children:e.jsx(Q,{size:18})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:async()=>{var t,s,a;ja(r=>({...r,starring:!0}));try{let r=0,n=0;const l=[];for(const d of ce)try{const c=(t=d.starredBy)==null?void 0:t.includes(h._id);console.log(`Processing message ${d._id}: currently starred = ${c}, will set starred = ${!c}`);const x=await L.patch(`${D}/api/bookings/${o._id}/comment/${d._id}/star`,{starred:!c},{withCredentials:!0,headers:{"Content-Type":"application/json"}});console.log(`Successfully processed message ${d._id}`),r++,$(b=>b.map(j=>j._id===d._id?{...j,starredBy:c?(j.starredBy||[]).filter(q=>q!==h._id):[...j.starredBy||[],h._id]}:j)),Ot(b=>c?b.filter(j=>j._id!==d._id):b.some(j=>j._id===d._id)?b:[...b,{...d,starredBy:[...d.starredBy||[],h._id]}])}catch(c){console.error(`Failed to process message ${d._id}:`,c),n++,l.push(d)}console.log(`Bulk operation completed: ${r} successful, ${n} failed`),r>0&&n===0?m.success(`Successfully updated star status for ${r} messages`):r>0&&n>0?m.warning(`Partially successful: ${r} messages updated, ${n} failed`):m.error("Failed to update any messages. Please try again."),n===0&&(Pe(!1),xe([]))}catch(r){console.error("Error in bulk starring operation:",r),r.response&&(console.error("Response data:",r.response.data),console.error("Response status:",r.response.status)),m.error(((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to star messages. Please try again.")}finally{ja(r=>({...r,starring:!1}))}},title:"Star all selected messages","aria-label":"Star all selected messages",disabled:ps.starring,children:ps.starring?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Wt,{size:18})}),e.jsx("button",{className:`rounded-full p-2 transition-colors ${u?"text-gray-400 bg-white/5 cursor-not-allowed":"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20"}`,onClick:()=>{if(u){m.info("Pinning disabled for this appointment status. You can view chat history.");return}xs(ce),gs(!0)},title:u?"Pinning disabled for this appointment status":"Pin all selected messages","aria-label":u?"Pinning disabled for this appointment status":"Pin all selected messages",disabled:ps.pinning||u,children:ps.pinning?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Gt,{size:18})}),e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{const t=ce.map(s=>s.message).join(`

`);ee(t),m.success("Copied all selected messages"),Pe(!1),xe([])},title:"Copy all selected messages","aria-label":"Copy all selected messages",children:e.jsx(qa,{size:18})}),e.jsx("button",{className:`rounded-full p-2 transition-colors ${u?"text-gray-400 bg-white/5 cursor-not-allowed":"text-white hover:text-red-200 bg-white/10 hover:bg-white/20"}`,onClick:()=>{if(u){m.info("Delete disabled for this appointment status. You can view chat history.");return}const t=ce.every(a=>a.senderEmail===h.email),s=ce.some(a=>a.senderEmail!==h.email);Xe(ce),p(u?!1:t&&!s),it(!0),Pe(!1),xe([])},disabled:u,title:u?"Delete disabled for this appointment status":"Delete all selected messages","aria-label":u?"Delete disabled for this appointment status":"Delete all selected messages",children:e.jsx(Q,{size:18})})]})}):null,e.jsx("button",{className:"text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{Pe(!1),xe([])},title:"Exit selection mode","aria-label":"Exit selection mode",children:e.jsx(oe,{className:"w-4 h-4"})})]})]}):xa&&S?e.jsxs("div",{className:"flex items-center justify-end w-full gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[!S.deleted&&e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{tn(S),re(null)},title:"Reply","aria-label":"Reply",children:e.jsx("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c4.28 0 6.92 1.45 8.84 4.55.23.36.76.09.65-.32C18.31 13.13 15.36 10.36 10 9z"})})}),!S.deleted&&e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{ee(S.message),re(null)},title:"Copy message","aria-label":"Copy message",children:e.jsx(qa,{size:18})}),!S.deleted&&e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:async()=>{var s,a,r;const t=(s=S.starredBy)==null?void 0:s.includes(h._id);No(!0);try{const{data:n}=await L.patch(`${D}/api/bookings/${o._id}/comment/${S._id}/star`,{starred:!t},{withCredentials:!0,headers:{"Content-Type":"application/json"}});$(l=>l.map(d=>d._id===S._id?{...d,starredBy:t?(d.starredBy||[]).filter(c=>c!==h._id):[...d.starredBy||[],h._id]}:d)),Ot(t?l=>l.filter(d=>d._id!==S._id):l=>[...l,S]),m.success(t?"Message unstarred.":"Message starred.")}catch(n){m.error(((r=(a=n.response)==null?void 0:a.data)==null?void 0:r.message)||"Failed to update star status")}finally{No(!1)}re(null)},title:(hn=S.starredBy)!=null&&hn.includes(h._id)?"Unstar message":"Star message","aria-label":(gn=S.starredBy)!=null&&gn.includes(h._id)?"Unstar message":"Star message",disabled:ko,children:ko?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):(xn=S.starredBy)!=null&&xn.includes(h._id)?e.jsx(Wt,{size:18}):e.jsx(Zr,{size:18})}),!S.deleted&&e.jsx("button",{className:`rounded-full p-2 transition-colors ${u?"text-gray-400 bg-white/5 cursor-not-allowed":"text-white hover:text-red-200 bg-white/10 hover:bg-white/20"}`,onClick:()=>{if(u){m.info("Delete disabled for this appointment status. You can view chat history.");return}S.senderEmail===h.email?Ei(S):Ii(S),re(null)},disabled:u,title:u?"Delete disabled for this appointment status":"Delete","aria-label":u?"Delete disabled for this appointment status":"Delete",children:e.jsx(Q,{size:18})}),!S.deleted&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>pe(t=>!t),title:"More options","aria-label":"More options",children:e.jsx(Jr,{size:14})}),fa&&e.jsx("div",{className:"absolute top-full right-0 mt-2 bg-white rounded-lg shadow-lg border border-gray-200 z-20 min-w-[180px] chat-options-menu",children:S.senderEmail===h.email?e.jsxs(e.Fragment,{children:[S.imageUrl&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2",onClick:()=>{Go(S.imageUrl,S._id),pe(!1),re(null)},children:[e.jsx(It,{className:"text-sm"}),"Download Image"]}),S.videoUrl&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2",onClick:async()=>{try{const t=await fetch(S.videoUrl,{mode:"cors"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const s=await t.blob(),a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`video-${S._id||Date.now()}.mp4`,document.body.appendChild(r),r.click(),r.remove(),setTimeout(()=>window.URL.revokeObjectURL(a),200),m.success("Video downloaded successfully")}catch(t){console.error("Video download failed:",t);const s=document.createElement("a");s.href=S.videoUrl,s.download=`video-${S._id||Date.now()}.mp4`,s.target="_blank",document.body.appendChild(s),s.click(),s.remove(),m.success("Video download started")}pe(!1),re(null)},children:[e.jsx(It,{className:"text-sm"}),"Download Video"]}),S.audioUrl&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2",onClick:async()=>{try{const t=await fetch(S.audioUrl,{mode:"cors"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const s=await t.blob(),a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=S.audioName||`audio-${S._id||Date.now()}`,document.body.appendChild(r),r.click(),r.remove(),setTimeout(()=>window.URL.revokeObjectURL(a),200),m.success("Audio downloaded successfully")}catch{const s=document.createElement("a");s.href=S.audioUrl,s.download=S.audioName||`audio-${S._id||Date.now()}`,s.target="_blank",document.body.appendChild(s),s.click(),s.remove(),m.success("Audio download started")}pe(!1),re(null)},children:[e.jsx(It,{className:"text-sm"}),"Download Audio"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{Fi(S),pe(!1),re(null)},children:[e.jsx(Ye,{className:"text-sm"}),"Info"]}),e.jsxs("button",{className:`w-full px-4 py-2 text-left text-sm flex items-center gap-2 ${u?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,onClick:()=>{if(u){m.info("Pinning disabled for this appointment status. You can view chat history.");return}S.pinned?Fa(S,!1):(xs(S),gs(!0)),pe(!1),re(null)},disabled:ya||u,children:[e.jsx(Gt,{className:"text-sm"}),S.pinned?"Unpin":"Pin"]}),e.jsxs("button",{className:`w-full px-4 py-2 text-left text-sm flex items-center gap-2 ${u||W!==null?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,onClick:()=>{if(u){m.info("Edit disabled for this appointment status. You can view chat history.");return}Bi(S),pe(!1),re(null)},disabled:u||W!==null,title:u?"Edit disabled for this appointment status":"Edit message",children:[e.jsx(Qr,{className:"text-sm"}),"Edit"]})]}):e.jsxs(e.Fragment,{children:[S.imageUrl&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2",onClick:()=>{Go(S.imageUrl,S._id),pe(!1),re(null)},children:[e.jsx(It,{className:"text-sm"}),"Download Image"]}),S.videoUrl&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2",onClick:async()=>{try{const t=await fetch(S.videoUrl,{mode:"cors"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const s=await t.blob(),a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=`video-${S._id||Date.now()}.mp4`,document.body.appendChild(r),r.click(),r.remove(),setTimeout(()=>window.URL.revokeObjectURL(a),200)}catch(t){console.error("Video download failed:",t);const s=document.createElement("a");s.href=S.videoUrl,s.download=`video-${S._id||Date.now()}.mp4`,s.target="_blank",document.body.appendChild(s),s.click(),s.remove()}pe(!1),re(null)},children:[e.jsx(It,{className:"text-sm"}),"Download Video"]}),S.audioUrl&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2",onClick:async()=>{try{const t=await fetch(S.audioUrl,{mode:"cors"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const s=await t.blob(),a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=S.audioName||`audio-${S._id||Date.now()}`,document.body.appendChild(r),r.click(),r.remove(),setTimeout(()=>window.URL.revokeObjectURL(a),200),m.success("Audio downloaded successfully")}catch{const s=document.createElement("a");s.href=S.audioUrl,s.download=S.audioName||`audio-${S._id||Date.now()}`,s.target="_blank",document.body.appendChild(s),s.click(),s.remove(),m.success("Audio download started")}pe(!1),re(null)},children:[e.jsx(It,{className:"text-sm"}),"Download Audio"]}),e.jsxs("button",{className:`w-full px-4 py-2 text-left text-sm flex items-center gap-2 ${u?"text-gray-400 cursor-not-allowed":"text-gray-700 hover:bg-gray-100"}`,onClick:()=>{if(u){m.info("Pinning disabled for this appointment status. You can view chat history.");return}S.pinned?Fa(S,!1):(xs(S),gs(!0)),pe(!1),re(null)},disabled:ya||u,children:[e.jsx(Gt,{className:"text-sm"}),S.pinned?"Unpin":"Pin"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",onClick:()=>{ut(S),lt(!0),pe(!1),re(null)},children:[e.jsx(Ha,{className:"text-sm"}),"Report"]})]})})]}),S.deleted&&e.jsx("button",{className:"text-white hover:text-red-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{Xe(S),p(!1),it(!0),re(null)},title:"Delete from chat locally","aria-label":"Delete from chat locally",children:e.jsx(Q,{size:18})})]}),e.jsx("button",{className:"text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>{re(null),pe(!1)},title:"Close options","aria-label":"Close options",children:e.jsx(oe,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-full p-1 sm:p-1.5 shadow-lg flex-shrink-0 cursor-pointer hover:scale-105 transition-transform duration-200",onClick:()=>pt({...k,isOnline:vt,isTyping:qe,lastSeen:Bt},o),title:"Click to view user details",children:k!=null&&k.avatar?e.jsx("img",{src:k.avatar,alt:k.username||"User",className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-blue-400 to-purple-500 flex items-center justify-center text-white font-semibold text-sm",children:((k==null?void 0:k.username)||"U").charAt(0).toUpperCase()})}),e.jsx("div",{className:`flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3 min-w-0 flex-1 ${ke||ge?"pr-2 sm:pr-0":""}`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-2",children:[e.jsx("h3",{className:"text-sm sm:text-lg font-bold text-white truncate cursor-pointer hover:underline",onClick:()=>pt({...k,isOnline:vt,isTyping:qe,lastSeen:Bt},o),title:"Click to view user details",children:(k==null?void 0:k.username)||"Unknown User"}),e.jsx("div",{className:`flex items-center gap-1 sm:hidden ${ke||ge?"max-w-[120px]":""}`,children:ea?e.jsx("span",{className:`text-gray-100 font-semibold text-[10px] bg-gray-500 bg-opacity-80 px-1.5 py-0.5 rounded-full whitespace-nowrap ${ke||ge?"truncate":""}`,children:"Not available"}):qe?e.jsx("span",{className:`text-yellow-100 font-semibold text-[10px] bg-yellow-500 bg-opacity-80 px-1.5 py-0.5 rounded-full whitespace-nowrap ${ke||ge?"truncate":""}`,children:"Typing..."}):ia?e.jsx("span",{className:`text-green-100 font-semibold text-[10px] bg-green-500 bg-opacity-80 px-1.5 py-0.5 rounded-full whitespace-nowrap ${ke||ge?"truncate":""}`,children:"Online"}):e.jsx("span",{className:`text-gray-100 font-semibold text-[10px] bg-gray-500 bg-opacity-80 px-1.5 py-0.5 rounded-full whitespace-nowrap ${ke||ge?"truncate":""}`,children:un(la)||"Offline"})}),e.jsx("div",{className:"hidden sm:flex items-center gap-1",children:ea?e.jsx("span",{className:"text-gray-100 font-semibold text-xs bg-gray-500 bg-opacity-80 px-2 py-1 rounded-full whitespace-nowrap",children:"Not available"}):qe?e.jsx("span",{className:"text-yellow-100 font-semibold text-xs bg-yellow-500 bg-opacity-80 px-2 py-1 rounded-full whitespace-nowrap",children:"Typing..."}):ia?e.jsx("span",{className:"text-green-100 font-semibold text-xs bg-green-500 bg-opacity-80 px-2 py-1 rounded-full whitespace-nowrap",children:"Online"}):e.jsx("span",{className:"text-gray-100 font-semibold text-xs bg-gray-500 bg-opacity-80 px-2 py-1 rounded-full whitespace-nowrap",children:un(la)||"Offline"})})]})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 ml-auto flex-shrink-0",children:[e.jsx("div",{className:"hidden sm:block",children:e.jsx(cl,{onToggleMute:()=>{const t=hi();Pa(t),m.info(`All sounds ${t?"muted":"unmuted"}`)},isMuted:Ns,currentVolume:Ta,onVolumeChange:t=>{qo(t),Fr(t)}})}),(ke||ge)&&e.jsxs("div",{className:"flex items-center gap-1 bg-orange-500 text-white text-xs px-2 py-1 rounded-full font-bold flex-shrink-0",children:[ge?e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx("svg",{width:"12",height:"12",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M18 10v-4c0-3.313-2.687-6-6-6s-6 2.687-6 6v4H4v10h16V10h-2zM8 6c0-2.206 1.794-4 4-4s4 1.794 4 4v4H8V6z"})}),ge?"Loading...":"Locked"]}),e.jsx("div",{className:"relative search-container",children:e.jsx("button",{className:"text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-all duration-300 transform hover:scale-110 shadow",onClick:()=>va(!0),title:"Search messages","aria-label":"Search messages",children:e.jsx(to,{className:"text-sm"})})}),e.jsxs("div",{className:"relative flex items-center gap-2",children:[Ms&&e.jsx("div",{className:"text-white bg-white/10 rounded-full p-2 shadow",children:e.jsx(Ua,{className:"text-sm animate-spin"})}),e.jsx("button",{className:"text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors shadow",onClick:()=>Ce(!Ps),title:"Chat options","aria-label":"Chat options",children:e.jsx(Jr,{className:"text-sm"})}),Ps&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 bg-white rounded-lg shadow-lg border border-gray-200 z-20 min-w-[180px] chat-options-menu",children:[Or&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2",onClick:()=>{pt({...k,isOnline:vt,isTyping:qe,lastSeen:Bt},o),Ce(!1)},children:[e.jsx(Ye,{className:"text-sm"}),"Contact Information"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{$i(),Ce(!1)},children:[e.jsx($n,{className:"text-sm"}),"Refresh Messages"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-yellow-600 hover:bg-yellow-50 flex items-center gap-2",onClick:()=>{pa(!0),Ce(!1)},children:[e.jsx(Wt,{className:"text-sm"}),"Starred Messages"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2",onClick:()=>{Pe(!0),xe([]),Ce(!1)},children:[e.jsx(ml,{className:"text-sm"}),"Select Messages"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{ss(!ue),Ce(!1)},children:[e.jsx(ul,{className:"text-sm"}),"Tips & Guidelines"]}),se.length>0&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-green-600 hover:bg-green-50 flex items-center gap-2",onClick:()=>{Ce(!1),me(o,se)},children:[e.jsx(It,{className:"text-sm"}),"Export Chat Transcript (PDF)"]}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),ke||ge?e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",onClick:()=>{rr(!0),Ce(!1)},children:[e.jsx("svg",{width:"16",height:"16",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M18 10v-4c0-3.313-2.687-6-6-6s-6 2.687-6 6v4H4v10h16V10h-2zM8 6c0-2.206 1.794-4 4-4s4 1.794 4 4v4H8V6z"})}),"Remove Chat Lock"]}):e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2",onClick:()=>{tr(!0),Ce(!1)},children:[e.jsx("svg",{width:"16",height:"16",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M18 10v-4c0-3.313-2.687-6-6-6s-6 2.687-6 6v4H4v10h16V10h-2zM8 6c0-2.206 1.794-4 4-4s4 1.794 4 4v4H8V6z"})}),"Lock Chat"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-purple-600 hover:bg-purple-50 flex items-center gap-2",onClick:()=>{Br(!Vo),Ce(!1)},children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5 4v3h5.5v12h3V7H19V4H5z"})}),"Text Styling"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",onClick:()=>{rs(!0),Ce(!1)},children:[e.jsx(Ha,{className:"text-sm"}),"Report Chat"]}),se.length>0&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",onClick:()=>{_(!0),Ce(!1)},children:[e.jsx(Q,{className:"text-sm"}),"Clear Chat"]})]})]}),ue&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 bg-gray-800 text-white text-xs rounded-lg px-3 py-2 shadow-lg z-20 max-w-xs animate-fadeIn",children:[e.jsx("div",{className:"font-semibold mb-2",children:"âŒ¨ï¸ Keyboard Shortcuts:"}),e.jsx("div",{className:"mb-2",children:"â€¢ Press Ctrl + F to quickly focus and type your message"}),e.jsx("div",{className:"mb-2",children:"â€¢ Press Esc to close chatbox."}),e.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[e.jsx("div",{className:"font-semibold mb-2",children:"ðŸ“Ž File Upload Guidelines:"}),e.jsx("div",{children:"â€¢ Photos: JPG, PNG, GIF, WebP (â‰¤ 5MB)"}),e.jsx("div",{children:"â€¢ Videos: MP4, WebM, MOV, MKV, OGG (â‰¤ 5MB)"}),e.jsx("div",{children:"â€¢ Documents: PDF, DOCX, XLSX, TXT and more (â‰¤ 5MB)"}),e.jsx("div",{children:"â€¢ Audio: MP3, WAV, M4A, OGG (â‰¤ 5MB)"}),e.jsx("div",{children:"â€¢ Camera: Direct photo capture from device"}),e.jsx("div",{children:"â€¢ Add captions to all media types"})]}),e.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[e.jsx("div",{className:"font-semibold mb-2",children:"ðŸ’¬ Chat Features:"}),e.jsx("div",{children:"â€¢ Real-time messaging with socket.io"}),e.jsx("div",{children:"â€¢ Message reactions and emoji support"}),e.jsx("div",{children:"â€¢ File sharing and media previews"}),e.jsx("div",{children:"â€¢ Audio recording with pause/resume"}),e.jsx("div",{children:"â€¢ Audio playback with speed controls"}),e.jsx("div",{children:"â€¢ Message editing and deletion"}),e.jsx("div",{children:"â€¢ Message starring and search"}),e.jsx("div",{children:"â€¢ Chat export to PDF"}),e.jsx("div",{children:"â€¢ Chat locking for dispute resolution"})]}),e.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[e.jsx("div",{className:"font-semibold mb-2",children:"ðŸ”’ Security & Moderation:"}),e.jsx("div",{children:"â€¢ Report inappropriate content"}),e.jsx("div",{children:"â€¢ Report chat"}),e.jsx("div",{children:"â€¢ Content filtering and moderation"}),e.jsx("div",{children:"â€¢ User blocking capabilities"})]}),e.jsx("div",{className:"absolute -top-1 right-4 w-2 h-2 bg-gray-800 transform rotate-45"})]}),e.jsx("button",{className:"text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-10 shadow",onClick:Ri,title:"Close","aria-label":"Close",children:e.jsx(oe,{className:"w-4 h-4"})})]})]})}),kr&&e.jsx("div",{className:"enhanced-search-header bg-gradient-to-r from-blue-600 via-purple-600 to-blue-800 px-3 sm:px-4 py-3 border-b-2 border-blue-700 flex-shrink-0 animate-slideDown",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-nowrap",children:[e.jsxs("div",{className:"relative calendar-container",children:[e.jsx("button",{className:"text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-all duration-300 transform hover:scale-110 shadow",onClick:t=>{t.stopPropagation(),zs(!Na)},title:"Jump to date","aria-label":"Jump to date",children:e.jsx(Fn,{className:"text-sm"})}),Na&&e.jsxs("div",{className:"absolute top-full left-0 mt-2 bg-white rounded-lg shadow-xl border border-gray-200 p-3 min-w-[250px] animate-fadeIn",style:{zIndex:9999},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Jump to Date"}),e.jsx("button",{onClick:t=>{t.stopPropagation(),zs(!1)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(oe,{size:14})})]}),e.jsx("input",{type:"date",value:Kn,onChange:t=>{t.stopPropagation(),Vi(t.target.value)},className:"w-full p-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",max:Yi(new Date)}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"Select a date to jump to the first message from that day"})]})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-2 bg-white/20 rounded-full px-3 sm:px-4 py-2 backdrop-blur-sm min-w-0 overflow-hidden",children:[e.jsx(to,{className:"text-white/70 text-sm"}),e.jsx("input",{type:"text",placeholder:"Search messages...",value:Nr,onChange:Hi,onKeyDown:Ui,className:"bg-transparent text-white placeholder-white/70 text-sm outline-none flex-1 min-w-0 w-full",autoFocus:!0}),gt.length>0&&e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[e.jsxs("span",{className:"text-white/80 text-xs bg-white/10 px-2 py-1 rounded-full",children:[Bs+1,"/",gt.length]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>xt(t=>t>0?t-1:gt.length-1),className:"text-white/80 hover:text-white p-1 rounded transition-colors text-xs",title:"Previous result",children:"â†‘"}),e.jsx("button",{onClick:()=>xt(t=>t<gt.length-1?t+1:0),className:"text-white/80 hover:text-white p-1 rounded transition-colors text-xs",title:"Next result",children:"â†“"})]})]})]}),e.jsx("button",{onClick:()=>{va(!1),ka(""),Fs([]),xt(-1),zs(!1),document.querySelectorAll(".search-text-highlight").forEach(t=>{t.outerHTML=t.innerHTML})},className:"flex-shrink-0 text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-all duration-300 transform hover:scale-110 shadow",title:"Close search","aria-label":"Close search",children:e.jsx(oe,{className:"text-sm"})})]})}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[wr.length>0&&e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 border-b border-purple-200 px-4 py-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Gt,{className:"text-purple-600 text-sm"}),e.jsx("span",{className:"text-purple-700 font-semibold text-sm",children:"Pinned Messages"}),e.jsxs("span",{className:"text-purple-600 text-xs",children:["(",wr.length,")"]})]}),e.jsx("div",{className:"space-y-2 max-h-24 overflow-y-auto",children:wr.map(t=>e.jsx("div",{className:`bg-white rounded-lg p-2 border-l-4 border-purple-500 cursor-pointer transition-all duration-200 hover:shadow-md ${$o===t._id?"ring-2 ring-purple-400 shadow-lg":""}`,onClick:()=>{Do(t._id);const s=document.getElementById(`message-${t._id}`);s&&(s.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>Do(null),3e3))},children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs text-purple-600 font-medium",children:t.senderEmail===h.email?"You":(k==null?void 0:k.username)||"Other"}),e.jsx("span",{className:"text-xs text-gray-500",children:t.pinDuration==="custom"?`${Math.round((new Date(t.pinExpiresAt)-new Date)/(1e3*60*60))}h left`:t.pinDuration==="24hrs"?"24h left":t.pinDuration==="7days"?"7d left":"30d left"})]}),e.jsx("div",{className:"text-sm text-gray-800 line-clamp-2",children:t.message})]}),e.jsx("button",{className:"text-purple-600 hover:text-purple-800 p-1 rounded-full hover:bg-purple-100 transition-colors",onClick:s=>{s.stopPropagation(),Fa(t,!1)},title:"Unpin message",children:e.jsx(Gt,{size:14})})]})},t._id))})]}),e.jsxs("div",{ref:T,className:`flex-1 overflow-y-auto space-y-2 px-4 pt-4 animate-fadeInChat relative bg-gradient-to-b from-transparent to-blue-50/30 ${si?"bg-blue-50/50 border-2 border-dashed border-blue-300":""}`,onDragOver:t=>{t.preventDefault(),t.stopPropagation(),u||Sa(!0)},onDragEnter:t=>{t.preventDefault(),t.stopPropagation(),u||Sa(!0)},onDragLeave:t=>{t.preventDefault(),t.stopPropagation(),t.currentTarget.contains(t.relatedTarget)||Sa(!1)},onDrop:t=>{if(t.preventDefault(),t.stopPropagation(),Sa(!1),u){m.info("Image sending disabled for this appointment status. You can view chat history.");return}const s=Array.from(t.dataTransfer.files),a=s.filter(r=>r.type.startsWith("image/"));a.length>0?Ko(a):s.length>0&&m.error("Only image files are supported")},children:[e.jsx("div",{className:"px-4 py-3 bg-gradient-to-r from-blue-50 to-purple-50 border-l-4 border-blue-400 rounded-r-lg mb-4 backdrop-blur-sm",children:e.jsxs("p",{className:"text-sm text-blue-700 font-medium text-center flex items-center justify-center gap-2",children:[e.jsx("span",{className:"animate-gentlePulse",children:"ðŸ”’"}),"Your privacy is our top priority â€” all your chats and data are fully encrypted for your safety"]})}),wt&&se.length>0&&e.jsx("div",{className:`sticky top-0 left-0 right-0 z-30 pointer-events-none transition-all duration-300 ease-in-out ${jt?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:e.jsx("div",{className:"w-full flex justify-center py-2",children:e.jsx("div",{className:"bg-blue-600 text-white text-xs px-4 py-2 rounded-full shadow-lg border-2 border-white",children:wt})})}),se.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-8",children:[e.jsx(Mn,{className:"text-gray-300 text-4xl mb-3"}),e.jsx("p",{className:"text-gray-500 font-medium text-sm",children:"No messages yet"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Start the conversation and connect with the other party"})]}):se.slice(Math.max(0,se.length-Math.min(Ft,se.length))).map((t,s,a)=>{var b,j,q,ie,ot,le,sa,Z,kn,Nn,Cn,Sn,_n,Rn;const r=se.length-a.length+s,n=t.senderEmail===h.email,l=W===t._id,d=new Date(t.timestamp),c=r>0?new Date(se[r-1].timestamp):null,x=c?d.toDateString()!==c.toDateString():!0;return d.toLocaleDateString("en-US",{month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"}),e.jsxs(hl.Fragment,{children:[x&&e.jsx("div",{className:"w-full flex justify-center my-2",children:e.jsx("span",{className:"bg-blue-600 text-white text-xs px-4 py-2 rounded-full shadow-lg border-2 border-white",children:Xr(d)})}),Me&&H>0&&r===se.length-H&&e.jsxs("div",{className:"w-full flex items-center my-2",children:[e.jsx("div",{className:"flex-1 h-px bg-gray-300"}),e.jsxs("span",{className:"mx-2 text-xs font-semibold text-red-600 bg-red-50 px-2 py-1 rounded-full border border-red-200",children:[H," unread message",H>1?"s":""]}),e.jsx("div",{className:"flex-1 h-px bg-gray-300"})]}),e.jsxs("div",{className:`flex w-full ${n?"justify-end":"justify-start"} animate-fadeInChatBubble`,style:{animationDelay:`${.03*r}s`},children:[vr&&e.jsx("div",{className:`flex items-start ${n?"order-2 ml-2":"order-1 mr-2"}`,children:e.jsx("input",{type:"checkbox",checked:ce.some(f=>f._id===t._id),onChange:f=>{f.target.checked?xe(v=>[...v,t]):xe(v=>v.filter(N=>N._id!==t._id))},className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"})}),e.jsxs("div",{ref:f=>Ue.current[t._id]=f,id:`message-${t._id}`,"data-message-id":t._id,className:`relative rounded-2xl px-4 sm:px-5 py-3 text-sm shadow-xl max-w-[90%] sm:max-w-[80%] md:max-w-[70%] lg:max-w-[60%] xl:max-w-[50%] break-words overflow-visible transition-all duration-300 min-h-[60px] ${t.audioUrl&&!t.deleted?"min-w-[280px] sm:min-w-[320px]":""} ${n?"bg-gradient-to-r from-blue-600 to-purple-700 hover:from-blue-500 hover:to-purple-600 text-white shadow-blue-200 hover:shadow-blue-300 hover:shadow-2xl":"bg-white hover:bg-gray-50 text-gray-800 border border-gray-200 shadow-gray-200 hover:shadow-lg hover:border-gray-300 hover:shadow-xl"} ${$o===t._id?"ring-4 ring-purple-400 shadow-2xl scale-105":""} ${vr&&ce.some(f=>f._id===t._id)?"ring-2 ring-blue-400":""}`,style:{animationDelay:`${.03*r}s`},children:[t.replyTo&&e.jsx("div",{className:"border-l-4 border-purple-400 pl-3 mb-2 text-xs bg-gradient-to-r from-purple-50 to-blue-50 hover:from-purple-100 hover:to-blue-100 rounded-lg w-full max-w-full break-words cursor-pointer transition-all duration-200 hover:shadow-sm",onClick:()=>{Ue.current[t.replyTo]&&(Ue.current[t.replyTo].scrollIntoView({behavior:"smooth",block:"center"}),Ue.current[t.replyTo].classList.add("reply-highlight"),setTimeout(()=>{var f;(f=Ue.current[t.replyTo])==null||f.classList.remove("reply-highlight")},1600))},role:"button",tabIndex:0,"aria-label":"Go to replied message",children:e.jsxs("span",{className:"text-xs text-gray-700 font-medium truncate max-w-[150px] flex items-center gap-1",children:[e.jsx("span",{className:"text-purple-500",children:"â†©"}),((j=(b=E.find(f=>f._id===t.replyTo))==null?void 0:b.message)==null?void 0:j.substring(0,30))||"Original message",((ie=(q=E.find(f=>f._id===t.replyTo))==null?void 0:q.message)==null?void 0:ie.length)>30?"...":""]})}),!n&&t.senderEmail!==((ot=o.buyerId)==null?void 0:ot.email)&&t.senderEmail!==((le=o.sellerId)==null?void 0:le.email)&&e.jsx("div",{className:"font-semibold mb-1 text-xs text-purple-600",children:"UrbanSetu"}),e.jsx("div",{className:`text-left ${n?"text-base font-medium":"text-sm"}`,children:t.deleted?e.jsxs("span",{className:"flex items-center gap-1 text-gray-400 italic",children:[e.jsx(Ss,{className:"inline-block text-lg"})," ",t.senderEmail===h.email?"You deleted this message":"This message was deleted."]}):e.jsx("div",{children:l?e.jsx("div",{className:"bg-yellow-100 border-l-4 border-yellow-400 px-2 py-1 rounded",children:e.jsx("span",{className:"text-yellow-800 text-xs font-medium",children:"âœï¸ Editing this message below..."})}):e.jsxs(e.Fragment,{children:[t.imageUrl&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:t.imageUrl,alt:"Shared image",className:"max-w-full max-h-64 rounded-lg cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>{const f=(E||[]).filter(N=>!!N.imageUrl).map(N=>N.imageUrl),v=Math.max(0,f.indexOf(t.imageUrl));Io(f),et(v),Cr(!0)},onError:f=>{f.target.src="https://via.placeholder.com/300x200?text=Image+Not+Found",f.target.className="max-w-full max-h-64 rounded-lg opacity-50"}})}),t.videoUrl&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"relative",children:e.jsx("video",{src:t.videoUrl,className:"max-w-full max-h-64 rounded-lg border cursor-pointer hover:opacity-90 transition-opacity",controls:!0,onClick:f=>{f.preventDefault(),f.stopPropagation(),f.target.requestFullscreen?f.target.requestFullscreen():f.target.webkitRequestFullscreen?f.target.webkitRequestFullscreen():f.target.msRequestFullscreen&&f.target.msRequestFullscreen()}})}),e.jsx("div",{className:`mt-1 text-xs flex gap-3 ${n?"text-blue-100":"text-gray-500"}`,children:e.jsx("button",{className:`${n?"text-white hover:text-blue-100":"text-blue-600 hover:underline"}`,onClick:f=>{f.stopPropagation();const v=document.createElement("a");v.href=t.videoUrl,v.download=`video-${t._id||Date.now()}`,v.target="_blank",document.body.appendChild(v),v.click(),v.remove(),m.success("Video download started")},children:"Download"})})]}),t.audioUrl&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full min-w-[280px] sm:min-w-[320px]",children:e.jsx("audio",{src:t.audioUrl,className:"w-full",controls:!0,preload:"metadata",onClick:f=>f.stopPropagation(),ref:f=>{if(f&&!f.dataset.audioId){f.dataset.audioId=t._id,f.volume=Ta,f.muted=Ns,f.addEventListener("play",()=>{document.querySelectorAll("audio[data-audio-id]").forEach(N=>{N!==f&&!N.paused&&N.pause()})}),f.addEventListener("ratechange",()=>{const N=f.playbackRate,J=document.querySelector(`[data-audio-id="${t._id}"].playback-rate-display`);J&&(J.textContent=`${N}x`);const G=document.querySelector(`[data-audio-speed-menu="${t._id}"]`);G&&G.querySelectorAll("[data-speed-option]").forEach(nt=>{nt.classList.remove("bg-blue-100","text-blue-700"),nt.classList.add("text-gray-700","hover:bg-gray-100"),parseFloat(nt.dataset.speedOption)===N&&(nt.classList.remove("text-gray-700","hover:bg-gray-100"),nt.classList.add("bg-blue-100","text-blue-700"))})}),f.addEventListener("volumechange",()=>{f.muted||(Fr(f.volume),qo(f.volume,!0));const N=document.querySelectorAll("audio[data-audio-id]"),J=Array.from(N).every(De=>De.muted),G=Array.from(N).some(De=>!De.muted);J&&!Ns?Pa(!0):G&&Ns&&Pa(!1)});const v=document.querySelector(`[data-audio-id="${t._id}"].playback-rate-display`);v&&(v.textContent=`${f.playbackRate}x`)}}})}),e.jsxs("div",{className:"mt-2 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:`px-3 py-1.5 text-xs rounded-full shadow-sm border transition-colors ${n?"bg-white text-blue-600 hover:bg-blue-50 border-blue-200":"bg-blue-600 text-white hover:bg-blue-700 border-transparent"}`,onClick:async f=>{f.stopPropagation();try{const v=await fetch(t.audioUrl,{mode:"cors"});if(!v.ok)throw new Error(`HTTP ${v.status}`);const N=await v.blob(),J=window.URL.createObjectURL(N),G=document.createElement("a");G.href=J,G.download=t.audioName||`audio-${t._id||Date.now()}`,document.body.appendChild(G),G.click(),G.remove(),setTimeout(()=>window.URL.revokeObjectURL(J),200),m.success("Audio downloaded successfully")}catch{const N=document.createElement("a");N.href=t.audioUrl,N.download=t.audioName||`audio-${t._id||Date.now()}`,N.target="_blank",document.body.appendChild(N),N.click(),N.remove(),m.success("Audio download started")}},title:"Download audio",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5 5m0 0l5-5m-5 5V4"})}),"Download"]})}),e.jsx("span",{className:`text-xs playback-rate-display ${n?"text-blue-100":"text-gray-500"}`,"data-audio-id":t._id,children:"1x"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:`p-2 rounded-full hover:bg-gray-100 transition-colors ${n?"text-white hover:bg-blue-500":"text-gray-600 hover:bg-gray-200"}`,onClick:f=>{f.stopPropagation();const v=document.querySelector(`[data-audio-menu="${t._id}"]`);v&&(v.classList.toggle("hidden"),v.classList.contains("hidden")||document.querySelectorAll("[data-audio-menu]").forEach(N=>{N!==v&&N.classList.add("hidden")}))},title:"Audio options",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})})}),e.jsx("div",{"data-audio-menu":t._id,className:"hidden absolute right-0 bottom-full mb-1 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-[9999]",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:f=>{f.stopPropagation();const v=document.querySelector(`[data-audio-menu="${t._id}"]`),N=document.querySelector(`[data-audio-speed-menu="${t._id}"]`);v&&N&&(v.classList.add("hidden"),N.classList.remove("hidden"))},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Playback Speed",e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),e.jsxs("button",{className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:f=>{f.stopPropagation();const v=document.querySelector(`[data-audio-menu="${t._id}"]`),N=document.querySelector(`[data-audio-controls-menu="${t._id}"]`);v&&N&&(v.classList.add("hidden"),N.classList.remove("hidden"))},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h1m4 0h1m-6-8h8a2 2 0 012 2v8a2 2 0 01-2 2H8a2 2 0 01-2-2V6a2 2 0 012-2z"})}),"Audio Controls",e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})}),e.jsx("div",{"data-audio-speed-menu":t._id,className:"hidden absolute right-0 bottom-full mb-1 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-[9999]",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("div",{className:"px-3 py-2 text-xs font-medium text-gray-500 uppercase tracking-wide flex items-center gap-2",children:[e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:f=>{f.stopPropagation();const v=document.querySelector(`[data-audio-menu="${t._id}"]`),N=document.querySelector(`[data-audio-speed-menu="${t._id}"]`);v&&N&&(N.classList.add("hidden"),v.classList.remove("hidden"))},children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),"Playback Speed"]}),[.5,.75,1,1.25,1.5,2].map(f=>e.jsxs("button",{"data-speed-option":f,className:`w-full px-3 py-2 text-left text-sm flex items-center justify-between transition-colors ${f===1?"bg-blue-100 text-blue-700":"text-gray-700 hover:bg-gray-100"}`,onClick:v=>{v.stopPropagation();const N=document.querySelector(`[data-audio-id="${t._id}"]`);if(N){N.playbackRate=f;const De=document.querySelector(`[data-audio-id="${t._id}"].playback-rate-display`);De&&(De.textContent=`${f}x`)}const J=document.querySelector(`[data-audio-speed-menu="${t._id}"]`);if(J){J.querySelectorAll("[data-speed-option]").forEach(Kr=>{Kr.classList.remove("bg-blue-100","text-blue-700"),Kr.classList.add("text-gray-700","hover:bg-gray-100")});const nt=J.querySelector(`[data-speed-option="${f}"]`);nt&&(nt.classList.remove("text-gray-700","hover:bg-gray-100"),nt.classList.add("bg-blue-100","text-blue-700"))}const G=document.querySelector(`[data-audio-speed-menu="${t._id}"]`);G&&G.classList.add("hidden")},children:[e.jsxs("span",{children:[f,"x"]}),f===1&&e.jsx("span",{className:"text-xs text-gray-400",children:"Normal"})]},f))]})}),e.jsx("div",{"data-audio-controls-menu":t._id,className:"hidden absolute right-0 bottom-full mb-1 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-[9999]",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("div",{className:"px-3 py-2 text-xs font-medium text-gray-500 uppercase tracking-wide flex items-center gap-2",children:[e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:f=>{f.stopPropagation();const v=document.querySelector(`[data-audio-menu="${t._id}"]`),N=document.querySelector(`[data-audio-controls-menu="${t._id}"]`);v&&N&&(N.classList.add("hidden"),v.classList.remove("hidden"))},children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),"Audio Controls"]}),e.jsxs("button",{className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:f=>{f.stopPropagation();const v=document.querySelector(`[data-audio-id="${t._id}"]`);v&&(v.paused?v.play():v.pause());const N=document.querySelector(`[data-audio-controls-menu="${t._id}"]`);N&&N.classList.add("hidden")},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h1m4 0h1m-6-8h8a2 2 0 012 2v8a2 2 0 01-2 2H8a2 2 0 01-2-2V6a2 2 0 012-2z"})}),"Toggle Play/Pause"]}),e.jsxs("button",{className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:f=>{f.stopPropagation();const v=document.querySelector(`[data-audio-id="${t._id}"]`);v&&(v.currentTime=0);const N=document.querySelector(`[data-audio-controls-menu="${t._id}"]`);N&&N.classList.add("hidden")},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Restart Audio"]}),e.jsxs("button",{className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:f=>{f.stopPropagation();const v=document.querySelector(`[data-audio-id="${t._id}"]`);v&&(v.muted=!v.muted,v.dispatchEvent(new Event("volumechange")));const N=document.querySelector(`[data-audio-controls-menu="${t._id}"]`);N&&N.classList.add("hidden")},children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]}),"Toggle Mute"]})]})})]})]})]}),t.message&&e.jsxs("div",{className:`mt-2 text-sm whitespace-pre-wrap break-words ${n?"text-white":"text-gray-700"}`,children:[t.message,t.edited&&e.jsx("span",{className:`ml-2 text-[10px] italic whitespace-nowrap ${n?"text-blue-200":"text-gray-400"}`,children:"(Edited)"})]})]}),t.documentUrl&&e.jsx("div",{className:"mb-2",children:e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border hover:bg-gray-50",onClick:async f=>{f.stopPropagation();try{const v=await fetch(t.documentUrl,{mode:"cors"});if(!v.ok)throw new Error(`HTTP ${v.status}`);const N=await v.blob(),J=window.URL.createObjectURL(N),G=document.createElement("a");G.href=J,G.download=t.documentName||`document-${t._id||Date.now()}`,document.body.appendChild(G),G.click(),G.remove(),setTimeout(()=>window.URL.revokeObjectURL(J),200),m.success("Document downloaded successfully")}catch(v){console.error("Download failed:",v);const N=document.createElement("a");N.href=t.documentUrl,N.download=t.documentName||`document-${t._id||Date.now()}`,N.target="_blank",document.body.appendChild(N),N.click(),N.remove(),m.success("Document download started")}},children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“„"}),e.jsx("span",{className:`text-sm truncate max-w-[200px] ${n?"text-white":"text-blue-700"}`,children:t.documentName||"Document"})]})}),(()=>{if(t.previewDismissed)return null;const f=/(https?:\/\/[^\s]+|www\.[^\s]+\.[^\s]{2,}(?:\/[^\s]*)?|[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*\.[a-zA-Z]{2,}(?:\/[^\s]*)?)/gi,v=(t.message||"").match(f);return v&&v.length>0?e.jsx("div",{className:"mb-2 max-h-40 overflow-hidden",children:e.jsx(In,{url:v[0],className:"max-w-xs",showRemoveButton:!1,clickable:!0})}):null})(),!t.audioUrl&&e.jsxs("div",{className:"inline",children:[e.jsx(En,{text:(t.message||"").replace(/\n+$/,""),isSentMessage:n,className:"whitespace-pre-wrap break-words",searchQuery:Nr}),t.edited&&e.jsx("span",{className:"ml-2 text-[10px] italic text-gray-300 whitespace-nowrap",children:"(Edited)"})]})]})})}),e.jsxs("div",{className:"flex items-center gap-1 justify-end mt-2","data-message-actions":!0,children:[t.pinned&&e.jsx(Gt,{className:`${n?"text-purple-300":"text-purple-500"} text-[10px]`,title:"Pinned message"}),((sa=t.starredBy)==null?void 0:sa.includes(h._id))&&e.jsx(Wt,{className:`${n?"text-yellow-300":"text-yellow-500"} text-[10px]`,title:"Starred message"}),e.jsx("span",{className:`${n?"text-blue-200":"text-gray-500"} text-[10px]`,children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx("button",{className:`${t.senderEmail===h.email?"text-blue-200 hover:text-white":"text-gray-500 hover:text-gray-700"} transition-all duration-200 hover:scale-110 p-1 rounded-full hover:bg-white hover:bg-opacity-20 ml-1`,onClick:f=>{f.stopPropagation(),re(t._id),u||Ji(t._id)},title:"Message options","aria-label":"Message options",children:e.jsx(Jr,{size:12})}),!t.deleted&&t.reactions&&t.reactions.length>0&&e.jsx("div",{className:"flex items-center gap-1 ml-1",children:(()=>{const f={};return t.reactions.forEach(v=>{f[v.emoji]||(f[v.emoji]=[]),f[v.emoji].push(v)}),Object.entries(f).map(([v,N])=>{const J=N.some(De=>De.userId===h._id),G=N.map(De=>De.userName).join(", ");return e.jsxs("button",{onClick:()=>_e(t._id,v),className:`text-xs rounded-full px-2 py-1 flex items-center gap-1 transition-all duration-200 hover:scale-105 ${J?"bg-blue-500 border-2 border-blue-600 hover:bg-blue-600 shadow-md":"bg-gray-100 border border-gray-300 hover:bg-gray-200"}`,title:`${G} reacted with ${v}${J?" (Click to remove)":" (Click to add)"}`,children:[e.jsx("span",{children:v}),e.jsx("span",{className:`${J?"text-white font-semibold":"text-gray-600"}`,children:N.length})]},v)})})()}),t.senderEmail===h.email&&!t.deleted&&e.jsx("span",{className:"flex items-center gap-1 ml-1",children:(Z=t.readBy)!=null&&Z.includes(k==null?void 0:k._id)?e.jsx(Dn,{className:"text-green-400 text-xs transition-all duration-300 animate-fadeIn",title:"Read"}):t.status==="delivered"?e.jsx(Dn,{className:"text-blue-200 text-xs transition-all duration-300 animate-fadeIn",title:"Delivered"}):t.status==="sending"?e.jsx(Oa,{className:"text-blue-200 text-xs animate-pulse transition-all duration-300",title:"Sending..."}):e.jsx(Oa,{className:"text-blue-200 text-xs transition-all duration-300 animate-fadeIn",title:"Sent"})})]})]}),(()=>{if(!(!t.deleted&&us&&_t===t._id))return!1;const v=document.querySelector(`[data-message-id="${t._id}"]`);if(v){const N=v.getBoundingClientRect(),J=T.current;if(J){const G=J.getBoundingClientRect();if(N.top-G.top<120&&G.bottom-N.bottom>=60+20)return!1}}return!0})()&&e.jsxs("div",{className:`absolute -top-8 ${n?"right-0":"left-0"} bg-red-500 rounded-full shadow-lg border-2 border-red-600 p-1 flex items-center gap-1 animate-reactions-bar z-[999999] reactions-bar transition-all duration-300`,style:{minWidth:"max-content"},children:[e.jsx("button",{onClick:()=>_e(t._id,"ðŸ‘"),className:`w-8 h-8 flex items-center justify-center text-lg transition-transform rounded-full ${u?"bg-gray-200 cursor-not-allowed opacity-50":(kn=t.reactions)!=null&&kn.some(f=>f.emoji==="ðŸ‘"&&f.userId===h._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100 hover:scale-110"}`,disabled:u,title:u?"Reactions disabled":"Like",children:"ðŸ‘"}),e.jsx("button",{onClick:()=>_e(t._id,"â¤ï¸"),className:`w-8 h-8 flex items-center justify-center text-lg transition-transform rounded-full ${u?"bg-gray-200 cursor-not-allowed opacity-50":(Nn=t.reactions)!=null&&Nn.some(f=>f.emoji==="â¤ï¸"&&f.userId===h._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100 hover:scale-110"}`,disabled:u,title:u?"Reactions disabled":"Love",children:"â¤ï¸"}),e.jsx("button",{onClick:()=>_e(t._id,"ðŸ˜‚"),className:`w-8 h-8 flex items-center justify-center text-lg transition-transform rounded-full ${u?"bg-gray-200 cursor-not-allowed opacity-50":(Cn=t.reactions)!=null&&Cn.some(f=>f.emoji==="ðŸ˜‚"&&f.userId===h._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100 hover:scale-110"}`,disabled:u,title:u?"Reactions disabled":"Laugh",children:"ðŸ˜‚"}),e.jsx("button",{onClick:()=>_e(t._id,"ðŸ˜®"),className:`w-8 h-8 flex items-center justify-center text-lg transition-transform rounded-full ${u?"bg-gray-200 cursor-not-allowed opacity-50":(Sn=t.reactions)!=null&&Sn.some(f=>f.emoji==="ðŸ˜®"&&f.userId===h._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100 hover:scale-110"}`,disabled:u,title:u?"Reactions disabled":"Wow",children:"ðŸ˜®"}),e.jsx("button",{onClick:()=>_e(t._id,"ðŸ˜¢"),className:`w-8 h-8 flex items-center justify-center text-lg transition-transform rounded-full ${u?"bg-gray-200 cursor-not-allowed opacity-50":(_n=t.reactions)!=null&&_n.some(f=>f.emoji==="ðŸ˜¢"&&f.userId===h._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100 hover:scale-110"}`,disabled:u,title:u?"Reactions disabled":"Sad",children:"ðŸ˜¢"}),e.jsx("button",{onClick:()=>_e(t._id,"ðŸ˜¡"),className:`w-8 h-8 flex items-center justify-center text-lg transition-transform rounded-full ${u?"bg-gray-200 cursor-not-allowed opacity-50":(Rn=t.reactions)!=null&&Rn.some(f=>f.emoji==="ðŸ˜¡"&&f.userId===h._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100 hover:scale-110"}`,disabled:u,title:u?"Reactions disabled":"Angry",children:"ðŸ˜¡"}),e.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),e.jsx("button",{onClick:nn,className:`w-8 h-8 flex items-center justify-center text-lg transition-transform rounded-full ${u?"bg-gray-200 cursor-not-allowed opacity-50":"bg-gray-50 hover:bg-gray-100 hover:scale-110"}`,disabled:u,title:u?"Reactions disabled":"More emojis",children:"âž•"})]})]})]},t._id||r)}),e.jsx("div",{ref:te})]})]}),(()=>{var d,c,x,b,j,q;if(!(us&&_t))return null;const s=document.querySelector(`[data-message-id="${_t}"]`);if(!s)return null;const a=s.getBoundingClientRect(),r=T.current;if(!r)return null;const n=r.getBoundingClientRect();if(a.top-n.top<120&&n.bottom-a.bottom>=60+20){const le=E.find(Z=>Z._id===_t);if(!le||le.deleted)return null;const sa=le.senderEmail===h.email;return e.jsxs("div",{className:"fixed bg-red-500 rounded-full shadow-lg border-2 border-red-600 p-1 flex items-center gap-1 animate-reactions-bar z-[999999] reactions-bar transition-all duration-300",style:{minWidth:"max-content",top:`${a.bottom+2}px`,left:sa?"auto":`${a.left}px`,right:sa?`${window.innerWidth-a.right}px`:"auto"},children:[e.jsx("button",{onClick:()=>_e(le._id,"ðŸ‘"),className:`w-8 h-8 flex items-center justify-center text-lg transition-transform rounded-full ${u?"bg-gray-200 cursor-not-allowed opacity-50":(d=le.reactions)!=null&&d.some(Z=>Z.emoji==="ðŸ‘"&&Z.userId===h._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100 hover:scale-110"}`,disabled:u,title:u?"Reactions disabled":"Like",children:"ðŸ‘"}),e.jsx("button",{onClick:()=>_e(le._id,"â¤ï¸"),className:`w-8 h-8 flex items-center justify-center text-lg transition-transform rounded-full ${u?"bg-gray-200 cursor-not-allowed opacity-50":(c=le.reactions)!=null&&c.some(Z=>Z.emoji==="â¤ï¸"&&Z.userId===h._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100 hover:scale-110"}`,disabled:u,title:u?"Reactions disabled":"Love",children:"â¤ï¸"}),e.jsx("button",{onClick:()=>_e(le._id,"ðŸ˜‚"),className:`w-8 h-8 flex items-center justify-center text-lg transition-transform rounded-full ${u?"bg-gray-200 cursor-not-allowed opacity-50":(x=le.reactions)!=null&&x.some(Z=>Z.emoji==="ðŸ˜‚"&&Z.userId===h._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100 hover:scale-110"}`,disabled:u,title:u?"Reactions disabled":"Laugh",children:"ðŸ˜‚"}),e.jsx("button",{onClick:()=>_e(le._id,"ðŸ˜®"),className:`w-8 h-8 flex items-center justify-center text-lg transition-transform rounded-full ${u?"bg-gray-200 cursor-not-allowed opacity-50":(b=le.reactions)!=null&&b.some(Z=>Z.emoji==="ðŸ˜®"&&Z.userId===h._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100 hover:scale-110"}`,disabled:u,title:u?"Reactions disabled":"Wow",children:"ðŸ˜®"}),e.jsx("button",{onClick:()=>_e(le._id,"ðŸ˜¢"),className:`w-8 h-8 flex items-center justify-center text-lg transition-transform rounded-full ${u?"bg-gray-200 cursor-not-allowed opacity-50":(j=le.reactions)!=null&&j.some(Z=>Z.emoji==="ðŸ˜¢"&&Z.userId===h._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100 hover:scale-110"}`,disabled:u,title:u?"Reactions disabled":"Sad",children:"ðŸ˜¢"}),e.jsx("button",{onClick:()=>_e(le._id,"ðŸ˜¡"),className:`w-8 h-8 flex items-center justify-center text-lg transition-transform rounded-full ${u?"bg-gray-200 cursor-not-allowed opacity-50":(q=le.reactions)!=null&&q.some(Z=>Z.emoji==="ðŸ˜¡"&&Z.userId===h._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100 hover:scale-110"}`,disabled:u,title:u?"Reactions disabled":"Angry",children:"ðŸ˜¡"}),e.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),e.jsx("button",{onClick:nn,className:`w-8 h-8 flex items-center justify-center text-lg transition-transform rounded-full ${u?"bg-gray-200 cursor-not-allowed opacity-50":"bg-gray-50 hover:bg-gray-100 hover:scale-110"}`,disabled:u,title:u?"Reactions disabled":"More emojis",children:"âž•"})]})}return null})(),we&&e.jsx("div",{className:"px-4 mb-2",children:e.jsxs("div",{className:"flex items-center bg-blue-50 border-l-4 border-blue-400 px-2 py-1 rounded",children:[e.jsx("span",{className:"text-xs text-gray-700 font-semibold mr-2",children:"Replying to:"}),e.jsxs("span",{className:"text-xs text-gray-600 truncate max-w-[200px]",children:[(fn=we.message)==null?void 0:fn.substring(0,40),((pn=we.message)==null?void 0:pn.length)>40?"...":""]}),e.jsx("button",{className:"ml-auto text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-1 transition-colors",onClick:()=>ne(null),title:"Cancel reply",children:e.jsx(oe,{className:"w-3 h-3"})})]})}),W&&e.jsx("div",{className:"px-4 mb-2",children:e.jsxs("div",{className:"flex items-center bg-yellow-50 border-l-4 border-yellow-400 px-2 py-1 rounded",children:[e.jsx("span",{className:"text-xs text-yellow-700 font-semibold mr-2",children:"âœï¸ Editing message:"}),e.jsx("span",{className:"text-xs text-yellow-600 truncate",children:Ae}),e.jsx("button",{className:"ml-auto text-yellow-400 hover:text-yellow-700 bg-yellow-100 hover:bg-yellow-200 rounded-full p-1 transition-colors",onClick:()=>{Ke(null),V(""),U(Ze),setTimeout(()=>{ae("")},100),bs(null),ws(!1),setTimeout(()=>{if(w.current){const s=new Event("input",{bubbles:!0});w.current.dispatchEvent(s),w.current.style.height="48px";const a=w.current.scrollHeight,r=144;a<=r?(w.current.style.height=a+"px",w.current.style.overflowY="hidden"):(w.current.style.height=r+"px",w.current.style.overflowY="auto")}},100)},title:"Cancel edit",children:e.jsx(oe,{className:"w-3 h-3"})})]})}),e.jsxs("div",{className:"flex gap-2 mt-1 px-3 pb-2 flex-shrink-0 bg-gradient-to-b from-transparent to-white pt-2 items-end",children:[e.jsxs("div",{className:"flex-1 relative",children:[Fo&&e.jsx("div",{className:"max-h-32 max-w-full overflow-y-auto mb-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:e.jsx(In,{url:Fo,onRemove:()=>{bs(null),ws(!0)},className:"w-full",showRemoveButton:!0,clickable:!1})}),Vo&&e.jsxs("div",{className:"relative mb-2 animate-slideDown bg-gradient-to-r from-purple-50 to-blue-50 p-3 rounded-lg border border-purple-200 shadow-sm",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700 hover:bg-white hover:bg-opacity-50 rounded-full p-1 transition-colors z-10",onClick:()=>Br(!1),title:"Close text styling panel","aria-label":"Close text styling panel",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 pr-8",children:[e.jsx("button",{type:"button",className:`px-2 py-1 text-xs rounded border ${u?"opacity-50 cursor-not-allowed bg-gray-50":"hover:bg-gray-100"}`,onClick:()=>{if(u){m.info("Formatting disabled for this appointment status. You can view chat history.");return}rt(()=>{const t=w.current;if(!t)return;const s=t.selectionStart||0,a=t.selectionEnd||0,r=B||"",n=r.slice(s,a),l=`**${n||"bold"}**`,d=r.slice(0,s)+l+r.slice(a);U(d),setTimeout(()=>{try{t.focus(),t.setSelectionRange(s+2,s+2+(n||"bold").length)}catch{}},0)})},disabled:u,children:"B"}),e.jsx("button",{type:"button",className:`px-2 py-1 text-xs rounded border italic ${u?"opacity-50 cursor-not-allowed bg-gray-50":"hover:bg-gray-100"}`,onClick:()=>{if(u){m.info("Formatting disabled for this appointment status. You can view chat history.");return}rt(()=>{const t=w.current;if(!t)return;const s=t.selectionStart||0,a=t.selectionEnd||0,r=B||"",n=r.slice(s,a),l=`*${n||"italic"}*`,d=r.slice(0,s)+l+r.slice(a);U(d),setTimeout(()=>{try{t.focus(),t.setSelectionRange(s+1,s+1+(n||"italic").length)}catch{}},0)})},disabled:u,children:"I"}),e.jsx("button",{type:"button",className:`px-2 py-1 text-xs rounded border underline ${u?"opacity-50 cursor-not-allowed bg-gray-50":"hover:bg-gray-100"}`,onClick:()=>{if(u){m.info("Formatting disabled for this appointment status. You can view chat history.");return}rt(()=>{const t=w.current;if(!t)return;const s=t.selectionStart||0,a=t.selectionEnd||0,r=B||"",n=r.slice(s,a),l=`__${n||"underline"}__`,d=r.slice(0,s)+l+r.slice(a);U(d),setTimeout(()=>{try{t.focus(),t.setSelectionRange(s+2,s+2+(n||"underline").length)}catch{}},0)})},disabled:u,children:"U"}),e.jsx("button",{type:"button",className:`px-2 py-1 text-xs rounded border ${u?"opacity-50 cursor-not-allowed bg-gray-50":"hover:bg-gray-100"}`,onClick:()=>{if(u){m.info("Formatting disabled for this appointment status. You can view chat history.");return}rt(()=>{const t=w.current;if(!t)return;const s=t.selectionStart||0,a=t.selectionEnd||0,r=B||"",n=r.slice(s,a),l=`~~${n||"strike"}~~`,d=r.slice(0,s)+l+r.slice(a);U(d),setTimeout(()=>{try{t.focus(),t.setSelectionRange(s+2,s+2+(n||"strike").length)}catch{}},0)})},disabled:u,children:"S"}),e.jsx("button",{type:"button",className:`px-2 py-1 text-xs rounded border ${u?"opacity-50 cursor-not-allowed bg-gray-50":"hover:bg-gray-100"}`,onClick:()=>{if(u){m.info("Formatting disabled for this appointment status. You can view chat history.");return}rt(()=>{const t=w.current;if(!t)return;const s=B||"",a=t.selectionStart||0,r=s.slice(0,a),n=s.slice(a),l=`${r}- ${n}`;U(l),setTimeout(()=>{try{t.focus(),t.setSelectionRange(a+2,a+2)}catch{}},0)})},disabled:u,children:"â€¢ List"}),e.jsx("button",{type:"button",className:`px-2 py-1 text-xs rounded border ${u?"opacity-50 cursor-not-allowed bg-gray-50":"hover:bg-gray-100"}`,onClick:()=>{if(u){m.info("Formatting disabled for this appointment status. You can view chat history.");return}const t=w.current;if(!t)return;const s=B||"",a=t.selectionStart||0,r=s.slice(0,a),n=s.slice(a),l=r.split(`
`);l[l.length-1];let d=1;for(let c=l.length-1;c>=0;c--){const x=l[c].trim(),b=x.match(/^(\d+)\.\s/);if(b){d=parseInt(b[1])+1;break}else if(x&&!x.match(/^\s*$/))break}rt(()=>{const c=`${r}${d}. ${n}`;U(c),setTimeout(()=>{try{t.focus(),t.setSelectionRange(a+d.toString().length+2,a+d.toString().length+2)}catch{}},0)})},disabled:u,children:"1. List"}),e.jsx("button",{type:"button",className:`px-2 py-1 text-xs rounded border ${u?"opacity-50 cursor-not-allowed bg-gray-50":"hover:bg-gray-100"}`,onClick:()=>{if(u){m.info("Formatting disabled for this appointment status. You can view chat history.");return}rt(()=>{const t=w.current;if(!t)return;const s=B||"",a=t.selectionStart||0,r=s.slice(0,a),n=s.slice(a),l=`${r}> ${n}`;U(l),setTimeout(()=>{try{t.focus(),t.setSelectionRange(a+2,a+2)}catch{}},0)})},disabled:u,children:"> Quote"}),e.jsx("button",{type:"button",className:`px-2 py-1 text-xs rounded border ${u?"opacity-50 cursor-not-allowed bg-gray-50":"hover:bg-gray-100"}`,title:"Tag Property",onClick:()=>{if(u){m.info("Formatting disabled for this appointment status. You can view chat history.");return}rt(()=>{const t=w.current;if(!t)return;const s=t.selectionStart||0,a=B||"",n=a.slice(0,s)+"@"+a.slice(s);U(n),setTimeout(()=>{try{t.focus(),t.setSelectionRange(s+1,s+1)}catch{}},0)})},disabled:u,children:"@Prop"}),e.jsx("button",{type:"button",className:`px-2 py-1 text-xs rounded border ${u?"opacity-50 cursor-not-allowed bg-gray-50":"hover:bg-gray-100"}`,title:"Insert appointment card",onClick:()=>{if(u){m.info("Formatting disabled for this appointment status. You can view chat history.");return}rt(()=>{const t=w.current;if(!t)return;const s=t.selectionStart||0,a=B||"",n=a.slice(0,s)+"[Appointment: date â€¢ time â€¢ with]"+a.slice(s);U(n),setTimeout(()=>{try{t.focus(),t.setSelectionRange(s+13,s+13)}catch{}},0)})},disabled:u,children:"Appt"}),e.jsx("button",{type:"button",className:`px-2 py-1 text-xs rounded border ${u?"opacity-50 cursor-not-allowed bg-gray-50":"hover:bg-gray-100"}`,title:"Insert service link",onClick:()=>{if(u){m.info("Formatting disabled for this appointment status. You can view chat history.");return}rt(()=>{const t=w.current;if(!t)return;const s=t.selectionStart||0,a=B||"",n=a.slice(0,s)+"Book Movers: /user/movers"+a.slice(s);U(n),setTimeout(()=>{try{t.focus(),t.setSelectionRange(s,s)}catch{}},0)})},disabled:u,children:"Service"})]})]}),B&&/@[^\s]*$/.test(B)&&e.jsx("div",{className:"absolute bottom-16 left-2 right-2 bg-white border rounded shadow-lg max-h-48 overflow-auto z-30",children:(()=>{var l;const t=(((l=B.match(/@([^\s]*)$/))==null?void 0:l[1])||"").toLowerCase(),r=[...(typeof appointments<"u"&&Array.isArray(appointments)&&appointments.length>0?appointments:[o].filter(Boolean)).map(d=>{var c,x;return{id:((c=d==null?void 0:d.listingId)==null?void 0:c._id)||(d==null?void 0:d.listingId),name:(d==null?void 0:d.propertyName)||((x=d==null?void 0:d.listingId)==null?void 0:x.name)||"Property"}}),...ca],n=Array.from(new Set(r.filter(d=>d.id&&d.name).map(d=>JSON.stringify(d)))).map(d=>JSON.parse(d)).filter(d=>d.name&&d.name.toLowerCase().includes(t));return n.length===0?e.jsx("div",{className:"px-3 py-2 text-sm text-gray-500",children:"No matches"}):n.slice(0,8).map(d=>e.jsx("button",{type:"button",className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-100",onClick:()=>{const c=w.current,x=B||"",b=x.match(/@([^\s]*)$/);if(!b)return;const j=x.lastIndexOf("@"),q=`@[${d.name}](${d.id})`,ie=x.slice(0,j)+q+" "+x.slice(j+b[0].length);U(ie),setTimeout(()=>{try{c==null||c.focus(),c==null||c.setSelectionRange(j+q.length+1,j+q.length+1)}catch{}},0)},children:d.name},d.id))})()}),e.jsx("textarea",{rows:1,className:"w-full pl-4 pr-20 py-3 border-2 border-gray-200 rounded-2xl text-sm focus:ring-2 focus:ring-blue-300 focus:border-blue-400 shadow-lg transition-all duration-300 bg-white resize-none whitespace-pre-wrap break-all hover:border-blue-300 hover:shadow-xl focus:shadow-2xl transform hover:scale-[1.01] overflow-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",style:{minHeight:"48px",maxHeight:"144px",lineHeight:"24px",wordBreak:"break-all",overflowWrap:"break-word"},placeholder:u?"Sending disabled for this appointment status. Chat history is available.":W?"Edit your message...":"Type a message...",value:B,onChange:t=>{if(u)return;const s=t.target.value;U(s);const a=/(https?:\/\/[^\s]+|www\.[^\s]+\.[^\s]{2,}(?:\/[^\s]*)?|[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*\.[a-zA-Z]{2,}(?:\/[^\s]*)?)/gi,r=s.match(a);if(r&&r.length>0?(bs(r[0]),ws(!1)):(bs(null),ws(!1)),W&&V(s),W||O.emit("typing",{toUserId:k._id,fromUserId:h._id,appointmentId:o._id}),(s||"").trim()===""){const c=t.target;c.style.height="48px",c.style.overflowY="hidden";return}const n=t.target;n.style.height="48px";const l=n.scrollHeight,d=144;l<=d?(n.style.height=l+"px",n.style.overflowY="hidden"):(n.style.height=d+"px",n.style.overflowY="auto")},onClick:()=>{xa&&(re(null),m.info("You can hit reply icon in header to reply"))},onScroll:t=>{t.stopPropagation()},onPaste:t=>{const a=Array.from(t.clipboardData.items).filter(r=>r.type.startsWith("image/"));if(a.length>0){t.preventDefault();const n=a[0].getAsFile();n&&Ko([n])}},onKeyDown:t=>{if(u){(t.key==="Enter"||t.key.length===1)&&(t.preventDefault(),m.info("Sending disabled for this appointment status."));return}const s=window.matchMedia("(min-width: 768px)").matches;if(t.ctrlKey&&(t.key==="b"||t.key==="B")&&(t.preventDefault(),document.querySelector('button:contains("B")')),t.ctrlKey&&(t.key==="i"||t.key==="I")){t.preventDefault();const a=w.current;if(!a)return;const r=a.selectionStart||0,n=a.selectionEnd||0,l=B||"",c=`*${l.slice(r,n)||"italic"}*`;U(l.slice(0,r)+c+l.slice(n));return}if(t.ctrlKey&&(t.key==="u"||t.key==="U")){t.preventDefault();const a=w.current;if(!a)return;const r=a.selectionStart||0,n=a.selectionEnd||0,l=B||"",c=`__${l.slice(r,n)||"underline"}__`;U(l.slice(0,r)+c+l.slice(n));return}if(t.shiftKey&&t.altKey&&t.key==="7"){t.preventDefault();const a=w.current;if(!a)return;const r=B||"",n=a.selectionStart||0;U(r.slice(0,n)+"> "+r.slice(n));return}if(t.key==="Enter"){if(t.isComposing||t.keyCode===229)return;(s&&!t.shiftKey||t.ctrlKey||t.metaKey)&&(t.preventDefault(),W?Hr(W):qr())}},ref:w}),e.jsx("div",{className:"absolute right-12 bottom-3",children:e.jsx(aa,{onEmojiClick:t=>{if(u){m.info("Emoji sending disabled for this appointment status. You can view chat history.");return}const s=w==null?void 0:w.current,a=s?s.value:B;let r=a.length,n=a.length;try{s&&typeof s.selectionStart=="number"&&typeof s.selectionEnd=="number"&&(r=s.selectionStart,n=s.selectionEnd)}catch{}const l=a.slice(0,r)+t+a.slice(n);U(l),W&&V(l),setTimeout(()=>{try{if(s){const d=r+t.length;s.focus(),s.setSelectionRange(d,d)}}catch{}},0)},className:"w-8 h-8",inputRef:w,disabled:u})}),e.jsxs("div",{className:"absolute right-3 bottom-3",children:[e.jsx("button",{ref:Bo,type:"button",onClick:()=>Dt(t=>!t),disabled:At||u,className:`flex items-center justify-center w-8 h-8 rounded-full transition-all duration-300 ${At||u?"bg-gray-400 cursor-not-allowed":"bg-gray-100 hover:bg-gray-200 hover:shadow-md active:scale-95"}`,"aria-haspopup":"true","aria-expanded":_a,"aria-label":"Attachments",children:At?e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-gray-600 border-t-transparent rounded-full"}):e.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),_a&&!u&&e.jsxs("div",{ref:zo,className:"absolute bottom-10 right-0 bg-white border border-gray-200 shadow-xl rounded-lg w-48 py-2 z-20",children:[e.jsxs("label",{className:"flex items-center gap-3 px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Photos",e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:t=>{const s=t.target.files;s&&s.length>0&&Wo(s),t.target.value="",Dt(!1)}})]}),e.jsxs("label",{className:"flex items-center gap-3 px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsx("svg",{className:"w-4 h-4 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7a2 2 0 012-2h2l1-2h6l1 2h2a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"})}),"Camera",e.jsx("input",{type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:t=>{t.target.files&&t.target.files[0]&&Wo([t.target.files[0]]),t.target.value="",Dt(!1)}})]}),e.jsxs("label",{className:"flex items-center gap-3 px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsx("svg",{className:"w-4 h-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Videos",e.jsx("input",{ref:ai,type:"file",accept:"video/*",className:"hidden",onChange:t=>{const s=t.target.files&&t.target.files[0];s&&(s.size>5*1024*1024?m.error("Maximum video size is 5MB"):(Ra(s),Aa(!0))),t.target.value="",Dt(!1)}})]}),e.jsxs("label",{className:"flex items-center gap-3 px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Documents",e.jsx("input",{ref:ri,type:"file",className:"hidden",onChange:t=>{const s=t.target.files&&t.target.files[0];s&&(s.size>5*1024*1024?m.error("Maximum document size is 5MB"):(Ma(s),$a(!0))),t.target.value="",Dt(!1)}})]}),e.jsxs("label",{className:"flex items-center gap-3 px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsxs("svg",{className:"w-4 h-4 text-indigo-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 1a3 3 0 00-3 3v8a3 3 0 106 0V4a3 3 0 00-3-3z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 10v2a7 7 0 11-14 0v-2"})]}),"Audio",e.jsx("input",{type:"file",accept:"audio/*",className:"hidden",onChange:t=>{const s=t.target.files&&t.target.files[0];s&&(s.size>5*1024*1024?m.error("Maximum audio size is 5MB"):(js(s),Ws(!0))),t.target.value="",Dt(!1)}})]}),e.jsxs("button",{type:"button",className:"flex items-center gap-3 px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",onClick:()=>{Lr(!0),Dt(!1)},children:[e.jsxs("svg",{className:"w-4 h-4 text-rose-500",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("path",{d:"M12 14a3 3 0 003-3V7a3 3 0 10-6 0v4a3 3 0 003 3z"}),e.jsx("path",{d:"M19 11a7 7 0 11-14 0h2a5 5 0 0010 0h2z"}),e.jsx("path",{d:"M13 19h-2v2h2v-2z"})]}),"Record Audio"]})]})]})]}),e.jsx("button",{onClick:t=>{t.preventDefault(),W?Hr(W):qr()},disabled:W?Pt===W:!B.trim(),className:"bg-gradient-to-r from-blue-600 to-purple-700 text-white w-12 h-12 rounded-full shadow-lg hover:from-blue-700 hover:to-purple-800 hover:shadow-xl transform hover:scale-110 transition-all duration-300 disabled:opacity-50 disabled:transform-none flex items-center justify-center hover:shadow-2xl active:scale-95 group",children:W?Pt===W?e.jsx(Qr,{className:"text-lg text-white animate-editSaving"}):e.jsx(Qr,{className:"text-lg text-white group-hover:scale-110 transition-transform duration-200"}):e.jsx("div",{className:"relative",children:Wn?e.jsx(Oa,{className:"text-lg text-white group-hover:scale-110 transition-all duration-300 send-icon animate-sent"}):e.jsx(gl,{className:`text-lg text-white group-hover:scale-110 transition-all duration-300 send-icon ${pr?"animate-fly":""}`})})})]}),Eo&&e.jsx("div",{className:"px-3 pb-2",children:e.jsx("div",{className:"text-red-500 text-sm bg-red-50 p-2 rounded-lg border border-red-200",children:Eo})}),Xn&&z.length>0&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-lg font-medium text-gray-700",children:["Image Preview (",z.length," image",z.length!==1?"s":"",")"]}),e.jsx("button",{onClick:()=>{Mt([]),Ht({}),et(0),qs(!1)},className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full p-2 transition-colors",children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative mb-4",children:[z.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>et(t=>t>0?t-1:z.length-1),className:"absolute left-2 top-1/2 transform -translate-y-1/2 z-10 bg-black bg-opacity-50 text-white rounded-full p-2 hover:bg-opacity-70 transition-all duration-200",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:()=>et(t=>t<z.length-1?t+1:0),className:"absolute right-2 top-1/2 transform -translate-y-1/2 z-10 bg-black bg-opacity-50 text-white rounded-full p-2 hover:bg-opacity-70 transition-all duration-200",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:URL.createObjectURL(z[Se]),alt:`Preview ${Se+1}`,className:"w-full h-64 object-contain rounded-lg border"})}),e.jsxs("div",{className:"text-center text-sm text-gray-600 mb-3",children:[Se+1," of ",z.length]}),e.jsxs("div",{className:"flex gap-2 mb-3 overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 pb-2 min-w-0 max-w-full",style:{scrollbarWidth:"thin",scrollbarColor:"#d1d5db #f3f4f6"},children:[z.map((t,s)=>e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>et(s),className:`flex-shrink-0 w-12 h-12 rounded-lg border-2 transition-all duration-200 ${s===Se?"border-blue-500 shadow-lg":"border-gray-300 hover:border-gray-400"}`,children:e.jsx("img",{src:URL.createObjectURL(t),alt:`Thumbnail ${s+1}`,className:"w-full h-full object-cover rounded-lg"})}),z.length>1&&e.jsx("button",{onClick:a=>{a.stopPropagation();const r=z.filter((l,d)=>d!==s),n={...Os};delete n[t.name],r.length===0?(Mt([]),Ht({}),qs(!1)):(Mt(r),Ht(n),Se>=r.length?et(r.length-1):Se>s&&et(Se-1))},className:"absolute -top-1 -right-1 bg-red-500 hover:bg-red-600 text-white rounded-full p-1 shadow-lg transition-all duration-200 hover:scale-110 z-10",title:"Remove this image","aria-label":"Remove this image",children:e.jsx(oe,{className:"w-2 h-2"})})]},s)),z.length<10&&e.jsx("div",{className:"relative",children:e.jsxs("label",{className:"flex-shrink-0 w-12 h-12 rounded-lg border-2 border-dashed border-gray-300 hover:border-blue-400 hover:bg-blue-50 transition-all duration-200 cursor-pointer flex items-center justify-center group",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:t=>{const s=t.target.files;if(s&&s.length>0){const a=10-z.length,r=Array.from(s).slice(0,a);if(r.length>0){const n=[...z,...r];Mt(n),r.length<s.length&&m.info(`Added ${r.length} images. Maximum limit of 10 images reached.`)}t.target.value=""}}}),e.jsx("svg",{className:"w-5 h-5 text-gray-400 group-hover:text-blue-500 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})]})})]})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("textarea",{placeholder:`Add a caption for ${(yn=z[Se])==null?void 0:yn.name}...`,value:Os[(bn=z[Se])==null?void 0:bn.name]||"",onChange:t=>Ht(s=>{var a;return{...s,[(a=z[Se])==null?void 0:a.name]:t.target.value}}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg text-sm resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,maxLength:500}),e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx(aa,{onEmojiClick:t=>{var a;if(u){m.info("Emoji sending disabled for this appointment status. You can view chat history.");return}const s=Os[(a=z[Se])==null?void 0:a.name]||"";Ht(r=>{var n;return{...r,[(n=z[Se])==null?void 0:n.name]:s+t}})},className:"w-6 h-6",disabled:u})}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[(Os[(wn=z[Se])==null?void 0:wn.name]||"").length,"/500"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:At&&To>=0?e.jsxs("span",{children:["Uploading ",To+1," / ",z.length,` â€¢ ${ei}%`]}):e.jsxs(e.Fragment,{children:[z.length," image",z.length!==1?"s":""," ready to send",ys.length>0&&e.jsxs("span",{className:"ml-2 text-red-600",children:["â€¢ ",ys.length," failed"]})]})}),e.jsx("div",{className:"flex items-center gap-2",children:At?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:zr,className:"bg-red-600 text-white py-2 px-3 rounded-lg hover:bg-red-700 text-sm font-medium transition-colors",children:"Cancel Upload"}),e.jsx("div",{className:"w-24 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-2 bg-blue-600 rounded-full transition-all",style:{width:`${$t}%`}})}),e.jsxs("span",{className:"text-sm text-gray-700 w-10 text-right",children:[$t,"%"]})]}):e.jsxs(e.Fragment,{children:[ys.length>0&&e.jsxs("button",{onClick:Ci,className:"bg-yellow-500 text-white py-2 px-3 rounded-lg hover:bg-yellow-600 text-sm font-medium transition-colors",children:["Retry Failed (",ys.length,")"]}),e.jsx("button",{onClick:Zo,disabled:u,className:`py-2 px-4 rounded-lg text-sm font-medium transition-colors ${u?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:`Send ${z.length} Image${z.length!==1?"s":""}`})]})})]})]})}),oi&&st&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700",children:"Video Preview"}),e.jsx("button",{onClick:()=>{Ra(null),Aa(!1)},className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full p-2 transition-colors",children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 mb-4 min-h-0",children:e.jsx("video",{controls:!0,className:"w-full h-full max-h-[60vh] rounded-lg border",src:ii})}),e.jsxs("div",{className:"relative mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:_r,placeholder:`Add a caption for ${st.name}...`,value:Vs,onChange:t=>Da(t.target.value),className:"w-full p-3 pr-12 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:2,maxLength:500}),e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx(aa,{onEmojiClick:t=>{const s=_r.current;if(s){const a=s.selectionStart,r=s.selectionEnd,n=Vs.slice(0,a)+t+Vs.slice(r);Da(n),setTimeout(()=>{s.focus(),s.setSelectionRange(a+t.length,a+t.length)},0)}},inputRef:_r})})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[Vs.length,"/500"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600 truncate flex-1 mr-4",children:st.name}),e.jsx("div",{className:"flex gap-2 flex-shrink-0",children:At?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:zr,className:"px-4 py-2 rounded-lg border border-red-300 text-red-600 hover:bg-red-50",children:"Cancel"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-2 bg-blue-600 rounded-full transition-all",style:{width:`${$t}%`}})}),e.jsxs("span",{className:"text-sm text-gray-700 w-10 text-right",children:[$t,"%"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{Ra(null),Aa(!1),Da("")},className:"px-4 py-2 rounded-lg border",children:"Cancel"}),e.jsx("button",{onClick:wi,className:"px-4 py-2 rounded-lg bg-blue-600 text-white",children:"Send"})]})})]})]})}),li&&at&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700",children:"Audio Preview"}),e.jsx("button",{onClick:()=>{js(null),Ws(!1)},className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full p-2 transition-colors",children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"mb-4",children:e.jsx("audio",{controls:!0,className:"w-full",src:di})}),e.jsxs("div",{className:"relative mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:Dr,placeholder:`Add a caption for ${at.name}...`,value:Gs,onChange:t=>Mr(t.target.value),className:"w-full p-3 pr-12 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:2,maxLength:500}),e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx(aa,{onEmojiClick:t=>{const s=Dr.current;if(s){const a=s.selectionStart,r=s.selectionEnd,n=Gs.slice(0,a)+t+Gs.slice(r);Mr(n),setTimeout(()=>{s.focus(),s.setSelectionRange(a+t.length,a+t.length)},0)}},inputRef:Dr})})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[Gs.length,"/500"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600 truncate flex-1 mr-4",children:at.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{js(null),Ws(!1)},className:"py-2 px-4 rounded-lg text-sm font-medium border hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:vi,disabled:u,className:`py-2 px-4 rounded-lg text-sm font-medium transition-colors ${u?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:"Send Audio"})]})]}),At&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${$t}%`}})}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[$t,"%"]})]})]})}),ci&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700",children:"Record Audio"}),e.jsx("button",{onClick:Yo,className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full p-2 transition-colors",children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-4 py-4",children:[e.jsx("div",{className:`w-24 h-24 rounded-full flex items-center justify-center ${vs?"bg-red-100":"bg-gray-100"}`,children:e.jsxs("svg",{className:`w-10 h-10 ${vs?"text-red-600 animate-pulse":"text-gray-600"}`,viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("path",{d:"M12 14a3 3 0 003-3V7a3 3 0 10-6 0v4a3 3 0 003 3z"}),e.jsx("path",{d:"M19 11a7 7 0 11-14 0h2a5 5 0 0010 0h2z"})]})}),e.jsx("div",{className:"text-sm text-gray-600",children:vs?Ea?`${Math.floor(Ks/6e4).toString().padStart(2,"0")}:${Math.floor(Ks%6e4/1e3).toString().padStart(2,"0")} (Paused)`:`${Math.floor(Ks/6e4).toString().padStart(2,"0")}:${Math.floor(Ks%6e4/1e3).toString().padStart(2,"0")}`:"Ready"}),e.jsxs("div",{className:"flex items-center gap-3",children:[vs?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:xi,className:"px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700",children:"Stop & Preview"}),Ea?e.jsx("button",{onClick:pi,className:"px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700",children:"Resume"}):e.jsx("button",{onClick:fi,className:"px-4 py-2 rounded-lg bg-yellow-600 text-white hover:bg-yellow-700",children:"Pause"})]}):e.jsx("button",{onClick:gi,className:"px-4 py-2 rounded-lg bg-rose-600 text-white hover:bg-rose-700",children:"Start"}),e.jsx("button",{onClick:Yo,className:"px-4 py-2 rounded-lg border",children:"Cancel"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Your mic input stays on device until you choose to send."})]})]})}),ni&&Lt&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700",children:"Document Preview"}),e.jsx("button",{onClick:()=>{Ma(null),$a(!1)},className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full p-2 transition-colors",children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded flex items-center justify-center text-gray-600",children:"ðŸ“„"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:Lt.name}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:Lt.type||"Document"})]})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:Rr,placeholder:`Add a caption for ${Lt.name}...`,value:Ys,onChange:t=>La(t.target.value),className:"w-full p-3 pr-12 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:2,maxLength:500}),e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx(aa,{onEmojiClick:t=>{const s=Rr.current;if(s){const a=s.selectionStart,r=s.selectionEnd,n=Ys.slice(0,a)+t+Ys.slice(r);La(n),setTimeout(()=>{s.focus(),s.setSelectionRange(a+t.length,a+t.length)},0)}},inputRef:Rr})})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[Ys.length,"/500"]})]}),e.jsx("div",{className:"flex items-center justify-between",children:At?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:zr,className:"px-4 py-2 rounded-lg border border-red-300 text-red-600 hover:bg-red-50",children:"Cancel"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-2 bg-blue-600 rounded-full transition-all",style:{width:`${$t}%`}})}),e.jsxs("span",{className:"text-sm text-gray-700 w-10 text-right",children:[$t,"%"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{Ma(null),$a(!1),La("")},className:"px-4 py-2 rounded-lg border",children:"Cancel"}),e.jsx("button",{onClick:Ni,className:"px-4 py-2 rounded-lg bg-blue-600 text-white",children:"Send"})]})})]})}),e.jsx("style",{jsx:!0,children:`
                  @keyframes fadeInChatBubble {
                    from { opacity: 0; transform: translateY(20px) scale(0.95); }
                    to { opacity: 1; transform: translateY(0) scale(1); }
                  }
                  .animate-fadeInChatBubble {
                    animation: fadeInChatBubble 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
                  }
                  @keyframes fadeInChat {
                    from { opacity: 0; transform: translateY(10px); }
                    to { opacity: 1; transform: translateY(0); }
                  }
                  .animate-fadeInChat {
                    animation: fadeInChat 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
                  }
                  @keyframes gentlePulse {
                    0%, 100% { opacity: 1; transform: scale(1); }
                    50% { opacity: 0.9; transform: scale(1.01); }
                  }
                  .animate-gentlePulse {
                    animation: gentlePulse 3s ease-in-out infinite;
                  }
                  @keyframes attentionGlow {
                    0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
                    50% { box-shadow: 0 0 30px rgba(59, 130, 246, 0.6); }
                  }
                  .animate-attentionGlow {
                    animation: attentionGlow 2s ease-in-out infinite;
                  }
                  @keyframes slideInFromTop {
                    from { opacity: 0; transform: translateY(-20px) scale(0.95); }
                    to { opacity: 1; transform: translateY(0) scale(1); }
                  }
                  .animate-slideInFromTop {
                    animation: slideInFromTop 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
                  }
                  @keyframes sendIconFly {
                    0% { 
                      transform: translate(0, 0) scale(1); 
                      opacity: 1;
                    }
                    20% { 
                      transform: translate(0, 0) scale(1.2); 
                      opacity: 1;
                    }
                    40% { 
                      transform: translate(15px, -20px) scale(1.3); 
                      opacity: 0.8;
                    }
                    60% { 
                      transform: translate(25px, -35px) scale(1.4); 
                      opacity: 0.6;
                    }
                    80% { 
                      transform: translate(15px, -20px) scale(1.2); 
                      opacity: 0.8;
                    }
                    100% { 
                      transform: translate(0, 0) scale(1); 
                      opacity: 1;
                    }
                  }
                  .send-icon.animate-fly {
                    animation: sendIconFly 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                  }
                  @keyframes sentSuccess {
                    0% { 
                      transform: scale(0.8); 
                      opacity: 0;
                    }
                    50% { 
                      transform: scale(1.2); 
                      opacity: 1;
                    }
                    100% { 
                      transform: scale(1); 
                      opacity: 1;
                    }
                  }
                  .send-icon.animate-sent {
                    animation: sentSuccess 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                  }
                  @keyframes editSaving {
                    0% { 
                      transform: scale(1) rotate(0deg) translate(0, 0); 
                      opacity: 1;
                    }
                    20% { 
                      transform: scale(1.15) rotate(-8deg) translate(-1px, -1px); 
                      opacity: 0.9;
                    }
                    40% { 
                      transform: scale(1.25) rotate(0deg) translate(0, -2px); 
                      opacity: 1;
                    }
                    60% { 
                      transform: scale(1.15) rotate(8deg) translate(1px, -1px); 
                      opacity: 0.9;
                    }
                    80% { 
                      transform: scale(1.1) rotate(-4deg) translate(-1px, 0); 
                      opacity: 0.95;
                    }
                    100% { 
                      transform: scale(1) rotate(0deg) translate(0, 0); 
                      opacity: 1;
                    }
                  }
                  .animate-editSaving {
                    animation: editSaving 1.2s ease-in-out infinite;
                  }
                  .search-highlight {
                    animation: searchHighlight 2s ease-in-out;
                  }
                  @keyframes searchHighlight {
                    0%, 100% { box-shadow: 0 0 0 rgba(59, 130, 246, 0); }
                    50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8); }
                  }
                  .date-highlight {
                    animation: dateHighlight 3s ease-in-out;
                  }
                  @keyframes dateHighlight {
                    0%, 100% { box-shadow: 0 0 0 rgba(168, 85, 247, 0); }
                    50% { box-shadow: 0 0 25px rgba(168, 85, 247, 0.9); }
                  }
                `}),(typeof isChatDisabled<"u"?isChatDisabled:u)&&e.jsxs("div",{className:"px-4 sm:px-6 py-2 bg-blue-50 text-blue-800 text-sm border-b border-blue-200 flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),e.jsx("span",{children:"Chat is read-only for this appointment status"})]})]}),!A&&!(typeof isChatDisabled<"u"?isChatDisabled:u)&&!W&&!we&&e.jsx("div",{className:"absolute bottom-20 right-6 z-20",children:e.jsxs("button",{onClick:()=>{bt(Math.max(Qt,se.length)),setTimeout(()=>cn(),50)},className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-full p-3 shadow-xl transition-all duration-200 hover:scale-110 relative transform hover:shadow-2xl",title:H>0?`${H} new message${H>1?"s":""} - Scroll to bottom`:"Scroll to bottom","aria-label":H>0?`${H} new messages, scroll to bottom`:"Scroll to bottom",children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"transform",children:e.jsx("path",{d:"M12 16l-6-6h12l-6 6z"})}),H>0&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center justify-center px-1 border-2 border-white shadow-lg",children:H>99?"99+":H})]})}),R&&e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 z-30",children:e.jsxs("div",{className:"bg-gray-800 text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 animate-fadeIn",children:[e.jsx(We,{className:"text-white"}),e.jsx("span",{className:"text-sm font-medium",children:"Message deleted for you"}),e.jsx("button",{onClick:Mi,className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm font-medium transition-colors",children:"Undo"})]})})]})]}),er&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 24 24",className:"text-blue-600",children:e.jsx("path",{d:"M18 10v-4c0-3.313-2.687-6-6-6s-6 2.687-6 6v4H4v10h16V10h-2zM8 6c0-2.206 1.794-4 4-4s4 1.794 4 4v4H8V6z"})}),"Lock Chat"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Create a password to lock your chat. You'll need this password to access the chat later."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password (minimum 4 characters)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:ga?"text":"password",value:Ls,onChange:t=>ir(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-10",placeholder:"Enter password"}),e.jsx("button",{type:"button",onClick:()=>oo(!ga),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:ga?"ðŸ‘ï¸":"ðŸ‘ï¸â€ðŸ—¨ï¸"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password"}),e.jsx("input",{type:ga?"text":"password",value:lr,onChange:t=>dr(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Confirm password"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end mt-6",children:[e.jsx("button",{type:"button",onClick:()=>{tr(!1),ir(""),dr(""),oo(!1)},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",onClick:Si,disabled:io,className:"px-4 py-2 rounded bg-blue-600 text-white font-semibold hover:bg-blue-700 transition-colors flex items-center gap-2 disabled:opacity-50",children:io?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Locking..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{width:"16",height:"16",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M18 10v-4c0-3.313-2.687-6-6-6s-6 2.687-6 6v4H4v10h16V10h-2zM8 6c0-2.206 1.794-4 4-4s4 1.794 4 4v4H8V6z"})}),"Lock Chat"]})})]})]})}),sr&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 24 24",className:"text-orange-600",children:e.jsx("path",{d:"M18 10v-4c0-3.313-2.687-6-6-6s-6 2.687-6 6v4H4v10h16V10h-2zM8 6c0-2.206 1.794-4 4-4s4 1.794 4 4v4H8V6z"})}),"Chat is Locked"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"This chat is protected with a password. Enter your password to access the chat."}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:gr?"text":"password",value:cr,onChange:t=>mr(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 pr-10",placeholder:"Enter password",onKeyPress:t=>t.key==="Enter"&&Jo()}),e.jsx("button",{type:"button",onClick:()=>no(!gr),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:gr?"ðŸ‘ï¸":"ðŸ‘ï¸â€ðŸ—¨ï¸"})]})]}),e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("button",{type:"button",onClick:()=>{cs(!1),nr(!0)},className:"text-sm text-blue-600 hover:text-blue-800 underline",children:"Forgot password?"})}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{cs(!1),mr(""),no(!1)},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",onClick:Jo,disabled:co,className:"px-4 py-2 rounded bg-orange-600 text-white font-semibold hover:bg-orange-700 transition-colors flex items-center gap-2 disabled:opacity-50",children:co?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Unlocking..."]}):"Unlock Chat"})]})]})}),or&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 24 24",className:"text-red-600",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"})}),"Forgot Password"]}),e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Warning"}),e.jsxs("div",{className:"mt-2 text-sm text-yellow-700",children:[e.jsx("p",{children:"This action will permanently:"}),e.jsxs("ul",{className:"list-disc list-inside mt-1",children:[e.jsx("li",{children:"Clear all chat messages"}),e.jsx("li",{children:"Remove the chat lock"}),e.jsx("li",{children:"Clear the passcode if set"})]})]})]})]})}),e.jsx("p",{className:"text-gray-600 mb-6",children:"This action cannot be undone. Are you sure you want to proceed?"}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>nr(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",onClick:_i,disabled:go,className:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors flex items-center gap-2 disabled:opacity-50",children:go?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processing..."]}):"Continue"})]})]})}),ar&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 24 24",className:"text-red-600",children:e.jsx("path",{d:"M18 10v-4c0-3.313-2.687-6-6-6s-6 2.687-6 6v4H4v10h16V10h-2zM8 6c0-2.206 1.794-4 4-4s4 1.794 4 4v4H8V6z"})}),"Remove Chat Lock"]}),e.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Permanent Action"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("p",{children:"This will remove the chat lock and disable password protection for this conversation. You can lock this chat again at any time from the options."})})]})]})}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Enter your chat lock password to confirm this action."}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:xr?"text":"password",value:ur,onChange:t=>hr(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 pr-10",placeholder:"Enter your chat lock password",onKeyPress:t=>t.key==="Enter"&&Qo()}),e.jsx("button",{type:"button",onClick:()=>fr(!xr),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:xr?"ðŸ‘ï¸":"ðŸ‘ï¸â€ðŸ—¨ï¸"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{rr(!1),hr(""),fr(!1)},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",onClick:Qo,disabled:uo,className:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors flex items-center gap-2 disabled:opacity-50",children:uo?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Removing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{width:"16",height:"16",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M18 10v-4c0-3.313-2.687-6-6-6s-6 2.687-6 6v4H4v10h16V10h-2zM8 6c0-2.206 1.794-4 4-4s4 1.794 4 4v4H8V6z"})}),"Remove Lock"]})})]})]})}),ma&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Q,{className:"text-red-500"}),Array.isArray(P)?"Delete Selected Messages":"Delete Message"]}),!Array.isArray(P)&&(P!=null&&P.deleted)?e.jsx("p",{className:"text-gray-600 mb-6",children:"Delete this message for me?"}):Array.isArray(P)&&P.every(t=>t.senderEmail===h.email)||!Array.isArray(P)&&(P==null?void 0:P.senderEmail)===h.email?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-gray-600 mb-4",children:Array.isArray(P)?`Are you sure you want to delete ${P.length} messages?`:"Are you sure you want to delete this message?"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:`flex items-center gap-3 ${u?"cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx("input",{type:"checkbox",checked:g,onChange:t=>{if(u){m.info("Delete for everyone is disabled for this appointment status. Only delete for me is allowed.");return}p(t.target.checked)},disabled:u,className:`form-checkbox h-4 w-4 text-red-600 rounded border-gray-300 focus:ring-red-500 ${u?"opacity-50 cursor-not-allowed":""}`}),e.jsxs("span",{className:`text-sm ${u?"text-gray-400":"text-gray-700"}`,children:["Also delete for"," ",e.jsx("span",{className:`font-medium ${u?"text-gray-400":"text-gray-900"}`,children:(k==null?void 0:k.username)||"other user"}),u&&" (Disabled for this appointment status)"]})]}),e.jsx("p",{className:`text-xs mt-1 ml-7 ${u?"text-gray-400":"text-gray-500"}`,children:u?Array.isArray(P)?"The selected messages will only be deleted for you":"The message will only be deleted for you":g?Array.isArray(P)?"The selected messages will be permanently deleted for everyone":"The message will be permanently deleted for everyone":Array.isArray(P)?"The selected messages will only be deleted for you":"The message will only be deleted for you"})]})]}):e.jsx("p",{className:"text-gray-600 mb-6",children:Array.isArray(P)?e.jsxs(e.Fragment,{children:["Delete selected messages from ",e.jsx("span",{className:"font-medium text-gray-900",children:(k==null?void 0:k.username)||"other user"}),"?"]}):e.jsxs(e.Fragment,{children:["Delete message from ",e.jsx("span",{className:"font-medium text-gray-900",children:(k==null?void 0:k.username)||"other user"}),"?"]})}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{it(!1),Xe(null),p(!0)},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Ti,className:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(Q,{size:12}),Array.isArray(P)?P.every(t=>t.senderEmail===h.email)&&g?"Delete for everyone":"Delete for me":P!=null&&P.deleted?"Delete for me":(P==null?void 0:P.senderEmail)===h.email&&g?"Delete for everyone":"Delete for me"]})]})]})}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Q,{className:"text-red-500"}),"Clear Chat"]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to clear chat? This action cannot be undone."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>_(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Pi,className:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(Q,{size:12}),"Clear Chat"]})]})]})}),zn&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Q,{className:"text-red-500"}),"Delete Appointment"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to delete this appointment?"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for deletion (required):"}),e.jsx("textarea",{value:Un,onChange:t=>yo(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",rows:"3",placeholder:"Please provide a reason for deleting this appointment..."})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{On(!1),Hn(null),yo("")},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:confirmAdminDelete,className:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(Q,{size:12}),"Delete Appointment"]})]})]})}),Ka&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Ss,{className:"text-orange-500"}),"Cancel Appointment"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to cancel this appointment?"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for cancellation (required):"}),e.jsx("textarea",{value:ms,onChange:t=>St(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",rows:"3",placeholder:Be?"Please provide a reason for cancelling...":"Optional reason for cancelling..."})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{Za(!1),St("")},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Wi,className:"px-4 py-2 rounded bg-orange-600 text-white font-semibold hover:bg-orange-700 transition-colors flex items-center gap-2",children:[e.jsx(Ss,{size:12}),"Cancel Appointment"]})]})]})}),qn&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Ss,{className:"text-red-500"}),"Admin Cancel Appointment"]}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to cancel this appointment as admin?"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for admin cancellation (required):"}),e.jsx("textarea",{value:ms,onChange:t=>St(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",rows:"3",placeholder:"Please provide a reason for admin cancellation..."})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{Ja(!1),St("")},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Ki,className:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(Ss,{size:12}),"Cancel as Admin"]})]})]})}),Qa&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Q,{className:"text-red-500"}),"Remove Appointment"]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to permanently remove this appointment from your table? This action cannot be undone."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>Xa(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Zi,className:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(Q,{size:12}),"Remove Permanently"]})]})]})}),ve&&mt&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Ha,{className:"text-red-500"})," Report message"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason"}),e.jsxs("select",{value:he,onChange:t=>zt(t.target.value),className:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-red-500 text-gray-900",children:[e.jsx("option",{value:"",children:"-- Select a reason --"}),e.jsx("option",{value:"Spam or scam",children:"Spam or scam"}),e.jsx("option",{value:"Harassment or hate speech",children:"Harassment or hate speech"}),e.jsx("option",{value:"Inappropriate content",children:"Inappropriate content"}),e.jsx("option",{value:"Sensitive or personal data",children:"Sensitive or personal data"}),e.jsx("option",{value:"Fraud or illegal activity",children:"Fraud or illegal activity"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),he&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:he==="Other"?"Additional details *":"Additional details (optional)"}),e.jsx("textarea",{value:dt,onChange:t=>ct(t.target.value),rows:4,placeholder:he==="Other"?"Please provide details about the issue...":"Add any context to help admins review...",className:"w-full p-2 border border-gray-300 rounded resize-y focus:outline-none focus:ring-2 focus:ring-red-500 text-gray-900"})]}),e.jsxs("div",{className:"bg-gray-50 rounded p-3 text-sm text-gray-700",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Message excerpt:"}),e.jsx("div",{className:"line-clamp-4 whitespace-pre-wrap",children:(mt.message||"").slice(0,300)})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{lt(!1),ut(null),zt(""),ct("")},className:"px-4 py-2 rounded border border-gray-300 text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:async()=>{var t,s;if(!he){m.error("Please select a reason");return}Ct(!0);try{const{data:a}=await L.post(`${D}/api/notifications/report-chat`,{appointmentId:o._id,commentId:mt._id,reason:he,details:dt},{withCredentials:!0,headers:{"Content-Type":"application/json"}});m.info("Thank you for reporting."),lt(!1),ut(null),zt(""),ct("")}catch(a){m.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Network error while reporting")}finally{Ct(!1)}},disabled:Nt||!he||he==="Other"&&!dt.trim(),className:"px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",children:Nt?"Reportingâ€¦":"Report"})]})]})}),ua&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 shadow-xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Ha,{className:"text-red-500"})," Report Chat"]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ye,{className:"text-blue-500 text-sm"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"The last 5 messages in this chat will be sent to UrbanSetu. This person won't know you reported them:"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200 max-h-48 overflow-y-auto",children:[se.slice(-5).map((t,s)=>e.jsx("div",{className:"mb-3 last:mb-0",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-xs font-semibold text-blue-600 flex-shrink-0",children:t.senderName?t.senderName.charAt(0).toUpperCase():"U"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-600",children:t.senderName||"Unknown User"}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(t.timestamp).toLocaleString()})]}),e.jsx("div",{className:"text-sm text-gray-700 bg-white rounded p-2 border border-gray-200",children:t.type==="image"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["ðŸ“· Image: ",t.message]}),t.imageUrl&&e.jsx("img",{src:t.imageUrl,alt:"Reported image",className:"w-8 h-8 object-cover rounded",onError:a=>a.target.style.display="none"})]}):e.jsx("span",{className:"whitespace-pre-wrap break-words",children:t.message})})]})]})},t._id||s)),se.length===0&&e.jsx("div",{className:"text-center text-gray-500 text-sm py-4",children:"No messages to report"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason"}),e.jsxs("select",{value:He,onChange:t=>os(t.target.value),className:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-red-500 text-gray-900",children:[e.jsx("option",{value:"",children:"Select a reason"}),e.jsx("option",{value:"harassment",children:"Harassment or bullying"}),e.jsx("option",{value:"spam",children:"Spam or unwanted messages"}),e.jsx("option",{value:"inappropriate",children:"Inappropriate content"}),e.jsx("option",{value:"scam",children:"Scam or fraud"}),e.jsx("option",{value:"threats",children:"Threats or violence"}),e.jsx("option",{value:"privacy",children:"Privacy violation"}),e.jsx("option",{value:"other",children:"Other"})]})]}),He&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:He==="other"?"Additional details *":"Additional details (optional)"}),e.jsx("textarea",{value:ns,onChange:t=>is(t.target.value),rows:4,placeholder:He==="other"?"Please provide details about the issue...":"Provide more context to help admins review this chat...",className:"w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-red-500 text-gray-900"})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-6",children:[e.jsx("button",{onClick:()=>{rs(!1),os(""),is("")},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{onClick:async()=>{var t,s;if(!He){m.error("Please select a reason");return}ao(!0);try{const{data:a}=await L.post(`${D}/api/notifications/report-chat-conversation`,{appointmentId:o._id,reason:He,details:ns},{withCredentials:!0,headers:{"Content-Type":"application/json"}});m.info("Thank you for reporting."),rs(!1),os(""),is("")}catch(a){m.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Network error while reporting")}finally{ao(!1)}},disabled:Ds||!He||He==="other"&&!ns.trim(),className:"px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",children:Ds?"Reportingâ€¦":"Report"})]})]})}),Yn&&Te&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Ye,{className:"text-blue-500"})," Message Info"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded p-3 text-sm text-gray-700",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Message:"}),e.jsxs("div",{className:"whitespace-pre-wrap break-words",children:[(Te.message||"").slice(0,200),(Te.message||"").length>200?"...":""]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Sent:"}),e.jsx("span",{className:"text-sm text-gray-800",children:new Date(Te.timestamp).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),Te.deliveredAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Delivered:"}),e.jsx("span",{className:"text-sm text-gray-800",children:new Date(Te.deliveredAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),Te.readAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Read:"}),e.jsx("span",{className:"text-sm text-gray-800",children:new Date(Te.readAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),!Te.deliveredAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Not delivered yet"})]}),Te.deliveredAt&&!Te.readAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),e.jsx("span",{className:"text-sm text-blue-600",children:"Delivered"})]}),Te.readAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),e.jsx("span",{className:"text-sm text-green-600",children:"Read"})]})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>{bo(!1),wo(null)},className:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Close"})})]})}),yr&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-yellow-50 to-amber-50",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Wt,{className:"text-yellow-500"}),"Starred Messages"]}),e.jsx("button",{onClick:Xo,disabled:br,className:"p-2 text-yellow-600 hover:text-yellow-700 bg-yellow-100 hover:bg-yellow-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Refresh starred messages",children:br?e.jsx("div",{className:"w-4 h-4 border-2 border-yellow-600 border-t-transparent rounded-full animate-spin"}):e.jsx($n,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:br?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-yellow-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading starred messages..."})]}):ht.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Zr,{className:"mx-auto text-6xl text-gray-300 mb-4"}),e.jsx("h4",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No Starred Messages"}),e.jsx("p",{className:"text-gray-500",children:"Star important messages to find them easily later."})]}):e.jsx("div",{className:"space-y-4",children:ht.map((t,s)=>{const a=t.senderEmail===h.email,r=new Date(t.timestamp);return e.jsx("div",{className:`flex w-full ${a?"justify-end":"justify-start"} mb-4`,children:e.jsxs("div",{className:`relative max-w-[80%] ${a?"ml-12":"mr-12"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 mb-1 ${a?"justify-end":"justify-start"}`,children:[e.jsx(Wt,{className:"text-yellow-500 text-xs"}),e.jsx("span",{className:`text-xs font-medium ${a?"text-blue-600":"text-green-600"}`,children:a?"You":t.senderName||"Other Party"}),e.jsx("span",{className:"text-xs text-gray-500",children:r.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx("button",{onClick:async()=>{var n,l;_o(t._id);try{const{data:d}=await L.patch(`${D}/api/bookings/${o._id}/comment/${t._id}/star`,{starred:!1},{withCredentials:!0,headers:{"Content-Type":"application/json"}});$(c=>c.map(x=>x._id===t._id?{...x,starredBy:(x.starredBy||[]).filter(b=>b!==h._id)}:x)),Ot(c=>c.filter(x=>x._id!==t._id)),m.success("Message unstarred.")}catch(d){m.error(((l=(n=d.response)==null?void 0:n.data)==null?void 0:l.message)||"Failed to unstar message")}finally{_o(null)}},className:"text-red-500 hover:text-red-700 text-xs p-1 rounded-full hover:bg-red-50 transition-colors",title:"Remove from starred messages",disabled:So===t._id,children:So===t._id?e.jsx("div",{className:"w-3 h-3 border border-red-500 border-t-transparent rounded-full animate-spin"}):e.jsx(oe,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:`rounded-2xl px-4 py-3 text-sm shadow-lg break-words relative group cursor-pointer hover:shadow-xl transition-all duration-200 ${a?"bg-gradient-to-r from-blue-600 to-purple-700 text-white hover:from-blue-500 hover:to-purple-600":"bg-white text-gray-800 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"}`,onClick:()=>{pa(!1);const n=document.querySelector(`[data-message-id="${t._id}"]`);n&&(n.scrollIntoView({behavior:"smooth",block:"center"}),n.classList.add("starred-highlight"),setTimeout(()=>{n.classList.remove("starred-highlight")},1600))},children:[e.jsx("div",{className:"whitespace-pre-wrap break-words",children:t.deleted?e.jsxs("span",{className:"flex items-center gap-1 text-gray-400 italic",children:[e.jsx(Ss,{className:"inline-block text-lg"})," ",t.senderEmail===h.email?"You deleted this message":"This message was deleted."]}):e.jsxs(e.Fragment,{children:[t.imageUrl&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:t.imageUrl,alt:"Shared image",className:"max-w-full max-h-64 rounded-lg cursor-pointer hover:opacity-90 transition-opacity",onClick:n=>{n.stopPropagation();const l=(E||[]).filter(c=>!!c.imageUrl).map(c=>c.imageUrl),d=Math.max(0,l.indexOf(t.imageUrl));Io(l),et(d),Cr(!0)},onError:n=>{n.target.src="https://via.placeholder.com/300x200?text=Image+Not+Found",n.target.className="max-w-full max-h-64 rounded-lg opacity-50"}})}),e.jsx(En,{text:(t.message||"").replace(/\n+$/,""),isSentMessage:a,className:"whitespace-pre-wrap break-words",searchQuery:Nr})]})}),!t.deleted&&e.jsx("button",{onClick:n=>{n.stopPropagation(),ee(t.message)},className:`absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 p-1.5 rounded-full ${a?"bg-white/20 hover:bg-white/30 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-600"}`,title:"Copy message",children:e.jsx(qa,{className:"w-3 h-3"})}),t.edited&&e.jsx("div",{className:`flex justify-end mt-2 text-xs ${a?"text-blue-200":"text-gray-500"}`,children:e.jsx("span",{className:"italic",children:"(Edited)"})})]})]})},t._id)})})}),e.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[ht.length," starred message",ht.length!==1?"s":""]}),e.jsxs("div",{className:"flex gap-2",children:[ht.length>0&&e.jsx("button",{onClick:Ai,disabled:Ro,className:"px-2 sm:px-4 py-1.5 sm:py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 disabled:bg-red-400 disabled:cursor-not-allowed transition-colors font-medium flex items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:Ro?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Removing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4"}),"Remove All"]})}),e.jsx("button",{onClick:()=>pa(!1),className:"px-2 sm:px-4 py-1.5 sm:py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors font-medium text-xs sm:text-sm",children:"Close"})]})]})})]})}),Gn&&$e&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden",children:[e.jsx("div",{className:"flex items-center p-6 border-b border-gray-200 bg-gradient-to-r from-purple-50 to-blue-50",children:e.jsxs("h3",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Gt,{className:"text-purple-500"}),"Pin Message"]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:Array.isArray($e)?`Choose how long to pin these ${$e.length} messages:`:"Choose how long to pin this message:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"pinDuration",value:"24hrs",checked:Ne==="24hrs",onChange:t=>fs(t.target.value),className:"text-purple-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:"24 Hours"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Pin for 24 hours"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"pinDuration",value:"7days",checked:Ne==="7days",onChange:t=>fs(t.target.value),className:"text-purple-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:"7 Days"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Pin for 7 days"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"pinDuration",value:"30days",checked:Ne==="30days",onChange:t=>fs(t.target.value),className:"text-purple-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:"30 Days"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Pin for 30 days"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"pinDuration",value:"custom",checked:Ne==="custom",onChange:t=>fs(t.target.value),className:"text-purple-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-800",children:"Custom"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Pin for custom hours"})]})]})]}),Ne==="custom"&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Custom Hours"}),e.jsx("input",{type:"number",min:"1",max:"8760",value:wa,onChange:t=>jr(Math.max(1,parseInt(t.target.value)||1)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Enter hours (1-8760)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Maximum: 8760 hours (1 year)"})]}),e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:Array.isArray($e)?"Messages to pin:":"Message to pin:"}),Array.isArray($e)?e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:$e.map((t,s)=>{var a,r;return e.jsxs("div",{className:"text-sm text-gray-800 bg-white p-2 rounded border",children:[e.jsxs("span",{className:"font-medium text-xs text-gray-500",children:["#",s+1,": "]}),(a=t.message)==null?void 0:a.substring(0,80),((r=t.message)==null?void 0:r.length)>80?"...":""]},t._id)})}):e.jsxs("div",{className:"text-sm text-gray-800 bg-white p-2 rounded border",children:[(jn=$e.message)==null?void 0:jn.substring(0,100),((vn=$e.message)==null?void 0:vn.length)>100?"...":""]})]})]})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gray-50 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{gs(!1),xs(null),fs("24hrs"),jr(24)},className:"px-4 py-2 text-gray-600 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors font-medium",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(Array.isArray($e)){ba(!0);try{let t=0,s=0;const a=[],r=[];for(const n of $e)try{const l=await L.patch(`${D}/api/bookings/${o._id}/comment/${n._id}/pin`,{pinned:!0,pinDuration:Ne,customHours:Ne==="custom"?wa:void 0},{withCredentials:!0,headers:{"Content-Type":"application/json"}});t++,r.push(n)}catch(l){console.error(`Failed to pin message ${n._id}:`,l),s++,a.push(n)}if(t>0){const n=new Date;let l;Ne==="24hrs"?l=new Date(n.getTime()+24*60*60*1e3):Ne==="7days"?l=new Date(n.getTime()+7*24*60*60*1e3):Ne==="30days"?l=new Date(n.getTime()+30*24*60*60*1e3):Ne==="custom"&&(l=new Date(n.getTime()+wa*60*60*1e3)),$(c=>c.map(x=>r.find(j=>j._id===x._id)?{...x,pinned:!0,pinnedBy:h._id,pinnedAt:n,pinExpiresAt:l,pinDuration:Ne}:x));const d=r.map(c=>({...c,pinned:!0,pinnedBy:h._id,pinnedAt:n,pinExpiresAt:l,pinDuration:Ne}));Ts(c=>[...c.filter(b=>!r.some(j=>j._id===b._id)),...d]),t>0&&s===0?(m.success(`Successfully pinned ${t} messages`),Pe(!1),xe([])):t>0&&s>0?m.warning(`Partially successful: ${t} messages pinned, ${s} failed`):m.error("Failed to pin any messages. Please try again.")}else m.error("Failed to pin any messages. Please try again.")}catch(t){console.error("Error in bulk pinning operation:",t),t.response&&(console.error("Response data:",t.response.data),console.error("Response status:",t.response.status)),m.error("Failed to pin messages. Please try again.")}finally{ba(!1)}}else Fa($e,!0,Ne,wa);gs(!1),xs(null),fs("24hrs"),jr(24)},disabled:ya,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:ya?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Pinning..."]}):Array.isArray($e)?`Pin ${$e.length} Messages`:"Pin Message"})]})]})}),e.jsx(pl,{isOpen:Jn,onClose:()=>Cr(!1),images:Qn,initialIndex:Se,listingId:null,metadata:{addedFrom:"chat",chatType:"appointment"}})]})}function jl({appointment:o,isBuyer:h}){var te;const[C,Kt]=i.useState(null),[Zt,pt]=i.useState(!0),[Le,Ge]=i.useState(!1),[Oe,X]=i.useState(!1),[ye,ee]=i.useState({reason:"",amount:0,type:"full"}),[Tt,Re]=i.useState(!1),[Y,me]=i.useState(null),[Ee,be]=i.useState(!1),[we,ne]=i.useState({reason:"",text:""}),[B,U]=i.useState(!1);i.useEffect(()=>{E()},[o._id,o.paymentConfirmed]),i.useEffect(()=>(Oe?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[Oe]),i.useEffect(()=>(Ee?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[Ee]),i.useEffect(()=>(Le?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[Le]);const E=async()=>{try{const T=await fetch(`https://urbansetu.onrender.com/api/payments/history?appointmentId=${o._id}`,{credentials:"include"}),A=await T.json();T.ok&&A.payments.length>0&&(Kt(A.payments[0]),await $(A.payments[0].paymentId))}catch(T){console.error("Error fetching payment status:",T)}finally{pt(!1)}},$=async T=>{try{const A=await fetch(`https://urbansetu.onrender.com/api/payments/refund-request-status/${T}`,{credentials:"include"}),fe=await A.json();A.ok&&fe.refundRequest?me(fe.refundRequest):me(null)}catch(A){console.error("Error fetching refund request status:",A),me(null)}};if(Zt)return e.jsx(Ua,{className:"animate-spin text-blue-600"});const oa=()=>{var A;return C?(A=C==null?void 0:C.metadata)!=null&&A.adminMarked?{status:"admin_confirmed",text:"Paid (Admin)",color:"bg-green-100 text-green-800"}:!h&&["refunded","partially_refunded","failed"].includes(C.status)?{status:"completed",text:"Paid",color:"bg-green-100 text-green-800"}:_s(C.status):{status:"pending",text:"Pending",color:"bg-yellow-100 text-yellow-800"}},_s=T=>{switch(T){case"completed":return{status:"completed",text:"Paid",color:"bg-green-100 text-green-800"};case"pending":return{status:"pending",text:"Pending",color:"bg-yellow-100 text-yellow-800"};case"failed":return{status:"failed",text:"Failed",color:"bg-red-100 text-red-800"};case"refunded":return{status:"refunded",text:"Refunded",color:"bg-blue-100 text-blue-800"};case"partially_refunded":return{status:"partially_refunded",text:"Partial Refund",color:"bg-orange-100 text-orange-800"};default:return{status:"unknown",text:T,color:"bg-gray-100 text-gray-800"}}},W=async T=>{if(T.preventDefault(),!!C)try{Re(!0);const A=await fetch("https://urbansetu.onrender.com/api/payments/refund-request",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({paymentId:C.paymentId,appointmentId:o._id,reason:ye.reason,requestedAmount:ye.type==="full"?C.amount:ye.amount,type:ye.type})}),fe=await A.json();A.ok?(m.success("Refund request submitted successfully"),X(!1),ee({reason:"",amount:0,type:"full"}),E()):m.error(fe.message||"Failed to submit refund request")}catch(A){console.error("Error submitting refund request:",A),m.error("An error occurred while submitting refund request")}finally{Re(!1)}},Ke=async T=>{if(T.preventDefault(),!(!Y||!we.reason||!we.text))try{U(!0);const A=await fetch("https://urbansetu.onrender.com/api/payments/refund-appeal",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({refundRequestId:Y._id,appealReason:we.reason,appealText:we.text})}),fe=await A.json();A.ok?(m.success("Appeal submitted successfully. Please wait for response."),be(!1),ne({reason:"",text:""}),E()):m.error(fe.message||"Failed to submit appeal")}catch(A){console.error("Error submitting appeal:",A),m.error("An error occurred while submitting appeal")}finally{U(!1)}},Ae=oa(),V=["rejected","cancelledByBuyer","cancelledBySeller","cancelledByAdmin","outdated"].includes(o.status),Ze=!!((te=C==null?void 0:C.metadata)!=null&&te.adminMarked),ae=!Ze&&(!C||C.status!=="completed")&&!V,Pt=Y&&["pending","rejected","approved","processed"].includes(Y.status),je=Y&&Y.status==="rejected",Jt=Y&&Y.status==="pending",I=Y&&["approved","processed"].includes(Y.status),Je=Y&&Y.caseReopened;return e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Ae.color}`,children:Ae.text}),h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[(!C||C.status!=="completed"&&!Ze)&&(o.status==="pending"||o.status==="accepted")&&e.jsxs("div",{className:"relative group",children:[e.jsx(Ye,{className:"text-blue-500 hover:text-blue-700 cursor-pointer",title:"Pay the advance amount to confirm your booking and unlock full chat features."}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:["Pay the advance amount to confirm your booking and unlock full chat features.",e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-800"})]})]}),(C&&C.status==="completed"||Ze)&&!V?e.jsxs("div",{className:"relative group",children:[e.jsx(Ye,{className:"text-green-500 hover:text-green-700 cursor-pointer",title:"You have unlocked full features of chat. Enjoy seamlessly!"}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-green-800 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:["You have unlocked full features of chat. Enjoy seamlessly!",e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-green-800"})]})]}):null]}),Pt&&Jt&&e.jsxs("div",{className:"relative group mb-1",children:[e.jsx(Ye,{className:"text-orange-500 hover:text-orange-700 cursor-pointer text-xs",title:"Processing Refund Request..."}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-orange-800 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:["Processing Refund Request...",e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-orange-800"})]})]}),ae?e.jsxs("button",{className:"mt-1 inline-flex items-center gap-1 text-white bg-blue-600 hover:bg-blue-700 text-xs font-semibold px-3 py-1 rounded",onClick:()=>Ge(!0),children:[e.jsx(Ln,{})," Pay Now"]}):C&&C.status==="failed"&&!V?e.jsxs("button",{onClick:()=>Ge(!0),className:"mt-1 inline-flex items-center gap-1 text-white bg-red-600 hover:bg-red-700 text-xs font-semibold px-3 py-1 rounded",children:[e.jsx(Ln,{})," Retry Payment"]}):C&&C.status==="completed"&&["rejected","cancelledBySeller","cancelledByAdmin"].includes(o.status)&&(!C.refundAmount||C.refundAmount===0)?e.jsx(e.Fragment,{children:!I&&!Jt&&e.jsx(e.Fragment,{children:je&&Y.isAppealed?e.jsxs("div",{className:"relative group mb-1",children:[e.jsx(Ye,{className:"text-blue-500 hover:text-blue-700 cursor-pointer text-xs",title:"Appeal submitted please wait for response..."}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-blue-800 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:["Appeal submitted please wait for response...",e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-blue-800"})]})]}):je&&!Je?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative group mb-1",children:[e.jsx(Ye,{className:"text-purple-500 hover:text-purple-700 cursor-pointer text-xs",title:"Refund Request Rejected - You can appeal your refund with valid proofs and reason"}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-purple-800 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsx("div",{className:"font-semibold text-red-300",children:"Refund Request Rejected"}),e.jsx("div",{className:"text-purple-200",children:"You can appeal your refund with valid proofs and reason"}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-purple-800"})]})]}),e.jsxs("button",{onClick:()=>be(!0),className:"mt-1 inline-flex items-center gap-1 text-white bg-purple-600 hover:bg-purple-700 text-xs font-semibold px-3 py-1 rounded",children:[e.jsx(We,{})," Appeal"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative group mb-1",children:[e.jsx(Ye,{className:"text-orange-500 hover:text-orange-700 cursor-pointer text-xs",title:"You can raise a refund request now"}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-orange-800 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:["You can raise a refund request now",e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-orange-800"})]})]}),e.jsxs("button",{onClick:()=>X(!0),className:"mt-1 inline-flex items-center gap-1 text-white bg-orange-600 hover:bg-orange-700 text-xs font-semibold px-3 py-1 rounded",children:[e.jsx(We,{})," ","Request Refund"]})]})})}):C&&C.receiptUrl?e.jsxs(e.Fragment,{children:[(C.status==="refunded"||C.status==="partially_refunded")&&e.jsxs("div",{className:"relative group mb-1",children:[e.jsx(Ye,{className:"text-red-500 hover:text-red-700 cursor-pointer text-xs",title:"Refund processed successfully"}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-red-800 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsxs("div",{children:["Refunded: ",C.currency==="INR"?"â‚¹":"$",C.refundAmount.toLocaleString()]}),C.refundedAt&&e.jsxs("div",{className:"text-red-200",children:[new Date(C.refundedAt).toLocaleDateString("en-GB")," ",new Date(C.refundedAt).toLocaleTimeString("en-GB")]}),e.jsx("div",{className:"text-green-300",children:"Refund Request Approved"}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-red-800"})]})]}),e.jsxs("a",{href:C.receiptUrl,target:"_blank",rel:"noreferrer",className:"mt-1 inline-flex items-center gap-1 text-white bg-green-600 hover:bg-green-700 text-xs font-semibold px-3 py-1 rounded",children:[e.jsx(It,{})," Receipt"]})]}):null]}),Ze&&e.jsx("div",{className:"text-[10px] text-green-700 font-semibold",children:"âœ“ Admin Confirmed"}),Le&&h&&e.jsx(wl,{isOpen:Le,onClose:()=>Ge(!1),appointment:{...o,region:"india"},onPaymentSuccess:T=>{Ge(!1),E()}}),Oe&&C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(We,{className:"text-orange-600"}),"Request Refund"]}),e.jsx("button",{onClick:()=>X(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(oe,{className:"text-xl"})})]})}),e.jsxs("form",{onSubmit:W,className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Details"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Property:"}),e.jsx("span",{className:"font-medium",children:o.propertyName})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Amount:"}),e.jsxs("span",{className:"font-medium",children:[C.currency==="INR"?"â‚¹":"$",C.amount.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Payment ID:"}),e.jsx("span",{className:"font-mono text-sm",children:C.paymentId})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Appointment Status:"}),e.jsx("span",{className:"font-medium capitalize",children:o.status.replace(/([A-Z])/g," $1").trim()})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Refund Type"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"type",value:"full",checked:ye.type==="full",onChange:T=>{ee(A=>({...A,type:T.target.value,amount:T.target.value==="full"?C.amount:A.amount}))},className:"mr-2"}),"Full Refund (",C.currency==="INR"?"â‚¹":"$",C.amount.toLocaleString(),")"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"type",value:"partial",checked:ye.type==="partial",onChange:T=>ee(A=>({...A,type:T.target.value})),className:"mr-2"}),"Partial Refund"]})]})]}),ye.type==="partial"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Refund Amount"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 font-semibold",children:C.currency==="INR"?"â‚¹":"$"}),e.jsx("input",{type:"number",value:ye.amount,onChange:T=>ee(A=>({...A,amount:parseFloat(T.target.value)||0})),max:C.amount,min:"1",step:"0.01",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Refund Reason"}),e.jsx("textarea",{value:ye.reason,onChange:T=>ee(A=>({...A,reason:T.target.value})),placeholder:"Please explain why you need a refund...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>X(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:Tt,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:Tt?e.jsxs(e.Fragment,{children:[e.jsx(Ua,{className:"animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{}),"Submit Request"]})})]})]})]})}),Ee&&Y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(We,{className:"text-purple-600"}),"Submit Appeal"]}),e.jsx("button",{onClick:()=>be(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(oe,{className:"text-xl"})})]})}),e.jsxs("form",{onSubmit:Ke,className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Refund Request Details"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Property:"}),e.jsx("span",{className:"font-medium",children:o.propertyName})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Original Reason:"}),e.jsx("span",{className:"font-medium text-sm",children:Y.reason})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Requested Amount:"}),e.jsxs("span",{className:"font-medium",children:[C.currency==="INR"?"â‚¹":"$",Y.requestedAmount.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:"font-medium text-red-600 capitalize",children:Y.status})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Appeal Reason"}),e.jsxs("select",{value:we.reason,onChange:T=>ne(A=>({...A,reason:T.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",required:!0,children:[e.jsx("option",{value:"",children:"Select a reason for your appeal"}),e.jsx("option",{value:"Additional evidence",children:"Additional evidence provided"}),e.jsx("option",{value:"Misunderstanding",children:"Misunderstanding of the situation"}),e.jsx("option",{value:"New information",children:"New information has come to light"}),e.jsx("option",{value:"Service quality",children:"Service quality issues"}),e.jsx("option",{value:"Technical problems",children:"Technical problems encountered"}),e.jsx("option",{value:"Other",children:"Other (please explain in detail)"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Appeal Details"}),e.jsx("textarea",{value:we.text,onChange:T=>ne(A=>({...A,text:T.target.value})),placeholder:"Please provide detailed information about why you believe your refund request should be reconsidered...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",rows:"4",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>be(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:B,className:"flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:B?e.jsxs(e.Fragment,{children:[e.jsx(Ua,{className:"animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{}),"Submit Appeal"]})})]})]})]})})]})}export{zl as default};
