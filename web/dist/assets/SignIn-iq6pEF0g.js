import{u as Be,r as s,i as Ue,p as _e,s as We,o as Ke,t as W,j as e,v as Ye,w as ze,L as Ae,x as m,z as le,A as Ce,B as Re,D as Te,E as Ee}from"./index-D5SGkqik.js";import Je from"./Oauth-muYYXIjU.js";import{R as ne}from"./RecaptchaWidget-BFPvwaVy.js";const oe="https://urbansetu.onrender.com";function Xe({bootstrapped:ie,sessionChecked:ce}){Be("Sign In - Welcome Back");const K=s.useRef(null),Y=s.useRef(null),z=s.useRef(null),J=s.useRef(null),[S,I]=s.useState({email:"",password:""}),[h,L]=s.useState(!1),[q,Z]=s.useState(""),[G,Oe]=s.useState(!1),[P,de]=s.useState("password"),[p,Q]=s.useState({email:"",otp:""}),[o,X]=s.useState(!1),[g,D]=s.useState(!1),[ee,A]=s.useState(""),[C,R]=s.useState(0),[te,T]=s.useState(!0),[H,E]=s.useState(null),[se,x]=s.useState(""),[ue,w]=s.useState(!1),[ke,$]=s.useState(0),[M,V]=s.useState(null),[F,b]=s.useState(""),[me,y]=s.useState(!1),[pe,B]=s.useState(!1),[fe,U]=s.useState(0),ae=s.useRef(null),_=s.useRef(null),[a,j]=s.useState(null),[v,he]=s.useState(!1),{loading:c,error:ge,currentUser:O}=Ue(t=>t.user),f=_e(),i=We(),xe=Ke();s.useEffect(()=>{new URLSearchParams(xe.search).get("error")==="password_change_unsuccessful"&&(Z("Password change unsuccessful! Please try again."),f("/sign-in",{replace:!0}))},[xe.search,f]),s.useEffect(()=>{parseInt(localStorage.getItem("failedLoginAttempts")||"0")>=3&&(w(!0),x("reCAPTCHA verification is required due to multiple failed attempts."))},[]),s.useEffect(()=>{K.current&&W(K.current)},[]),s.useEffect(()=>{P==="otp"&&Y.current&&W(Y.current)},[P]),s.useEffect(()=>{h&&z.current&&W(z.current)},[h]),s.useEffect(()=>{o&&J.current&&W(J.current)},[o]),s.useEffect(()=>{ie&&ce&&O&&(O.role==="admin"||O.role==="rootadmin"?O.isDefaultAdmin?f("/admin",{replace:!0}):f("/admin",{replace:!0}):f("/user",{replace:!0}))},[ie,ce,O,f]),s.useEffect(()=>{let t=null;return C>0&&(t=setInterval(()=>{R(d=>d<=1?(T(!0),0):d-1)},1e3)),()=>{t&&clearInterval(t)}},[C]);const be=t=>{I({...S,[t.target.id]:t.target.value}),q&&Z(""),se&&x("")},Ie=t=>{E(t),x(""),setTimeout(()=>w(!1),1e3)},Le=()=>{E(null),x("reCAPTCHA expired. Please verify again."),$(t=>t+1),w(!0)},qe=t=>{E(null),x("reCAPTCHA verification failed. Please try again."),$(d=>d+1),w(!0)},De=()=>{ae.current&&ae.current.reset(),E(null),x(""),$(t=>t+1)},ye=t=>{V(t),b(""),setTimeout(()=>y(!1),1e3)},we=()=>{V(null),b("reCAPTCHA expired. Please verify again."),U(t=>t+1),y(!0)},ve=t=>{V(null),b("reCAPTCHA verification failed. Please try again."),U(d=>d+1),y(!0)},He=()=>{_.current&&_.current.reset(),V(null),b(""),U(t=>t+1)},je=()=>parseInt(localStorage.getItem("failedLoginAttempts")||"0")>=3,$e=t=>{if(t.preventDefault(),!S.email){i(m("Email is required"));return}L(!0)},Me=()=>{L(!1),I(t=>({...t,password:""}))},Ne=t=>{(o||g)&&t.target.id==="email"||(Q({...p,[t.target.id]:t.target.value}),q&&Z(""),ee&&A(""),t.target.id==="email"&&(R(0),T(!0)))},Se=async t=>{if(t.preventDefault(),!p.email){i(m("Email is required"));return}if(te){if(pe&&!M){i(m("reCAPTCHA verification is required. Please complete the verification.")),y(!0);return}D(!0),b(""),j("otp");try{const d={email:p.email,...M&&{recaptchaToken:M}},u=await le(`${oe}/api/auth/send-login-otp`,{method:"POST",body:JSON.stringify(d)});if(u.status===403){let l="This account is temporarily suspended. Please reach out to support for help.";try{const r=await u.clone().json();if(r&&r.message){const N=r.message.toLowerCase();N.includes("pending approval")?l="Your admin account is pending approval. Please wait for an existing admin to approve your request.":N.includes("rejected")?l="Your admin account request has been rejected. Please contact support for more information.":N.includes("suspended")?l="This account is temporarily suspended. Please reach out to support for help.":l=r.message}}catch{}i(m(l)),D(!1);return}if(u.status===423){let l="Account is temporarily locked due to too many failed attempts. Try again later.";try{const r=await u.clone().json();r&&r.message&&(l=r.message)}catch{}i(m(l)),D(!1);return}const n=await u.json();if(n.success===!1){n.message&&n.message.toLowerCase().includes("too many failed attempts")?(b("Too many failed attempts. Please try again in 15 minutes."),y(!1)):n.message&&n.message.includes("reCAPTCHA")?(b(n.message),U(l=>l+1),y(!0)):n.requiresCaptcha?(B(!0),y(!0),b("reCAPTCHA verification is now required due to multiple attempts.")):i(m(n.message));return}X(!0),A("OTP sent successfully to your email"),B(!1),y(!1),He(),R(30),T(!1)}catch(d){i(m(d.message))}finally{D(!1),j(null)}}},Pe=async t=>{if(t.preventDefault(),!p.email||!p.otp){i(m("Email and OTP are required"));return}he(!0),i(Ce()),j("otp"),Re();try{const d=`${oe}/api/auth/verify-login-otp`,u=await le(d,{method:"POST",body:JSON.stringify(p)});if(u.status===403){let l="This account is temporarily suspended. Please reach out to support for help.";try{const r=await u.clone().json();r&&r.message&&r.message.toLowerCase().includes("suspended")&&(l="This account is temporarily suspended. Please reach out to support for help.")}catch{}i(m(l));return}const n=await u.json();if(n.success===!1){n.message&&n.message.toLowerCase().includes("too many otp requests")?(b("Too many OTP requests. Please try again in 15 minutes."),y(!1),B(!1)):n.requiresCaptcha&&(B(!0),y(!0),b("reCAPTCHA verification is now required due to multiple failed attempts.")),i(m(n.message));return}n.token&&localStorage.setItem("accessToken",n.token),i(Te(n)),await new Promise(l=>setTimeout(l,50)),Ee(),n.role==="admin"||n.role==="rootadmin"?(n.isDefaultAdmin,f("/admin")):f("/user")}catch(d){i(m(d.message))}finally{he(!1),j(null)}},Ve=async t=>{if(t.preventDefault(),je()&&!H){x("reCAPTCHA verification is required due to multiple failed attempts or requests"),w(!0);return}i(Ce()),j("password"),Re();try{const u=`${oe}/api/auth/signin`,n=await le(u,{method:"POST",body:JSON.stringify({...S,...H&&{recaptchaToken:H}})});if(n.status===403){let r="This account is temporarily suspended. Please reach out to support for help.";try{const k=await n.clone().json();if(k&&k.message){const re=k.message.toLowerCase();re.includes("pending approval")?r="Your admin account is pending approval. Please wait for an existing admin to approve your request.":re.includes("rejected")?r="Your admin account request has been rejected. Please contact support for more information.":re.includes("suspended")?r="This account is temporarily suspended. Please reach out to support for help.":r=k.message}}catch{}const Fe=parseInt(localStorage.getItem("failedLoginAttempts")||"0")+1;localStorage.setItem("failedLoginAttempts",Fe.toString()),i(m(r));return}const l=await n.json();if(l.success===!1){if(l.message.includes("reCAPTCHA"))x("reCAPTCHA verification is required due to multiple failed attempts or requests"),De(),$(r=>r+1),w(!0);else{const N=parseInt(localStorage.getItem("failedLoginAttempts")||"0")+1;localStorage.setItem("failedLoginAttempts",N.toString()),N===3&&(w(!0),x("reCAPTCHA verification is now required due to multiple failed attempts."))}i(m(l.message));return}localStorage.removeItem("failedLoginAttempts"),w(!1),E(null),x(""),l.token&&localStorage.setItem("accessToken",l.token),i(Te(l)),await new Promise(r=>setTimeout(r,50)),Ee(),l.role==="admin"||l.role==="rootadmin"?(l.isDefaultAdmin,f("/admin")):f("/user")}catch(u){i(m(u.message))}finally{j(null)}};return e.jsxs("div",{className:"min-h-screen flex",children:[e.jsxs("div",{className:"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-blue-600 to-purple-700 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black opacity-20"}),e.jsx("div",{className:"relative z-10 flex flex-col justify-center items-center text-white p-12",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h1",{className:"text-4xl font-bold mb-6 animate-fade-in",children:"Welcome Back"}),e.jsx("p",{className:"text-xl mb-8 leading-relaxed animate-fade-in-delay",children:`"Home is not a place, it's a feeling. Find your perfect sanctuary with us."`}),e.jsxs("div",{className:"space-y-4 text-lg animate-fade-in-delay-2",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsx("span",{children:"Discover Your Dream Home"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"0.5s"}}),e.jsx("span",{children:"Connect with Trusted Agents"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"1s"}}),e.jsx("span",{children:"Secure & Reliable Platform"})]})]})]})}),e.jsx("div",{className:"absolute top-20 left-20 w-16 h-16 bg-white bg-opacity-10 rounded-full animate-float"}),e.jsx("div",{className:"absolute bottom-32 right-16 w-12 h-12 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute top-1/2 right-24 w-8 h-8 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black bg-opacity-20",children:e.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 100 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M10 2L2 8V18H18V8L10 2Z",fill:"white",fillOpacity:"0.1"}),e.jsx("path",{d:"M8 12H12V18H8V12Z",fill:"white",fillOpacity:"0.2"}),e.jsx("circle",{cx:"10",cy:"5",r:"1",fill:"white",fillOpacity:"0.3"})]})})]}),e.jsx("div",{className:"w-full lg:w-1/2 flex items-center justify-center p-8 bg-gray-50",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Sign In"}),e.jsx("p",{className:"text-gray-600",children:"Welcome back! Please sign in to your account."})]}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1 mb-6",children:[e.jsx("button",{type:"button",disabled:a!==null,onClick:()=>{de("password"),X(!1),Q({email:"",otp:""}),A(""),R(0),T(!0),L(!1),I({email:"",password:""})},className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all duration-200 ${P==="password"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"} ${a!==null?"opacity-50 cursor-not-allowed":""}`,children:"Password Sign In"}),e.jsx("button",{type:"button",disabled:a!==null,onClick:()=>{de("otp"),I({email:"",password:""}),A(""),R(0),T(!0),L(!1)},className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-all duration-200 ${P==="otp"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"} ${a!==null?"opacity-50 cursor-not-allowed":""}`,children:"OTP Sign In"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[P==="password"?e.jsxs("form",{onSubmit:h?Ve:$e,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"email",placeholder:"Enter your email",id:"email",value:S.email,onChange:be,ref:K,readOnly:h||a==="google",disabled:a==="google"||a==="password"&&h||c,className:`w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${h?"pr-12 bg-gray-50":""} ${a==="google"||a==="password"&&h||c?"bg-gray-100 cursor-not-allowed":""}`,required:!0}),h&&e.jsx("button",{type:"button",onClick:Me,disabled:c||a!==null,className:`absolute right-3 top-1/2 transform -translate-y-1/2 text-blue-600 hover:text-blue-800 focus:outline-none ${c||a!==null?"opacity-50 cursor-not-allowed":""}`,title:"Edit email",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]})]}),h&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:G?"text":"password",placeholder:"Enter your password",id:"password",value:S.password,onChange:be,ref:z,disabled:a==="google"||a==="password"||c,className:`w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 pr-12 ${a==="google"||a==="password"||c?"bg-gray-100 cursor-not-allowed":""}`,required:!0}),e.jsx("button",{type:"button",disabled:a==="google"||a==="password"||c,className:`absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-700 focus:outline-none ${a==="google"||a==="password"||c?"opacity-50 cursor-not-allowed":""}`,tabIndex:-1,onClick:()=>Oe(t=>!t),"aria-label":G?"Hide password":"Show password",children:G?e.jsx(Ye,{}):e.jsx(ze,{})})]}),e.jsx("div",{className:"text-right mt-2",children:e.jsx(Ae,{to:`/forgot-password?email=${encodeURIComponent(S.email)}`,className:`text-sm text-blue-600 hover:text-blue-800 hover:underline transition-colors duration-200 ${a==="google"||a==="password"||c?"opacity-50 cursor-not-allowed pointer-events-none":""}`,children:"Forgot Password?"})})]}),ue&&je()&&e.jsx("div",{className:"flex justify-center",children:e.jsx(ne,{ref:ae,onVerify:Ie,onExpire:Le,onError:qe,disabled:c||a==="google",className:"transform scale-90"},ke)}),se&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsx("p",{className:"text-red-600 text-sm",children:se})}),e.jsx("button",{disabled:c||ue&&!H||a!==null,className:"w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105",children:c?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Signing In..."]}):h?"Sign In":"Continue"})]}):e.jsxs("form",{onSubmit:o?Pe:Se,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"otp-email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"email",placeholder:"Enter your email",id:"email",value:p.email,onChange:Ne,ref:Y,readOnly:o||g,disabled:o||g,className:`w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${o||g?"pr-12 bg-gray-50 cursor-not-allowed":""}`,required:!0}),o&&e.jsx("button",{type:"button",onClick:()=>{X(!1),Q({email:p.email,otp:""}),A("")},disabled:c||a!==null,className:`absolute right-3 top-1/2 transform -translate-y-1/2 text-blue-600 hover:text-blue-800 focus:outline-none ${c||a!==null?"opacity-50 cursor-not-allowed":""}`,title:"Edit email",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]})]}),me&&!o&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(ne,{ref:_,onVerify:ye,onExpire:we,onError:ve,disabled:g,className:"transform scale-90"},fe)}),F&&!o&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:e.jsx("p",{className:"text-red-600 text-sm",children:F})}),o&&e.jsxs("div",{children:[ee&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 mb-4",children:e.jsx("p",{className:"text-green-600 text-sm",children:ee})}),e.jsx("label",{htmlFor:"otp",className:"block text-sm font-medium text-gray-700 mb-2",children:"OTP Code"}),e.jsx("input",{type:"text",placeholder:"Enter 6-digit OTP",id:"otp",value:p.otp,ref:J,disabled:v,onChange:t=>{const u={target:{id:"otp",value:t.target.value.replace(/[^0-9]/g,"")}};Ne(u)},onKeyDown:t=>{t.key==="Enter"&&o&&!v&&(t.preventDefault(),p.otp&&p.otp.length===6&&Pe(t))},className:`w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-center text-lg tracking-widest ${v?"opacity-50 cursor-not-allowed bg-gray-100":""}`,maxLength:"6",required:!0}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Enter the 6-digit code sent to your email"})]}),o&&e.jsxs("div",{className:"text-center",children:[C>0?e.jsxs("span",{className:"text-sm text-gray-500",children:["Resend in ",Math.floor(C/60),":",(C%60).toString().padStart(2,"0")]}):e.jsx("button",{type:"button",onClick:Se,disabled:g||!te||v,className:"text-sm text-blue-600 hover:text-blue-800 hover:underline transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Sending...":"Resend OTP"}),me&&e.jsx("div",{className:"flex justify-center mt-2",children:e.jsx(ne,{ref:_,onVerify:ye,onExpire:we,onError:ve,disabled:g,className:"transform scale-90"},fe)}),F&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mt-2",children:e.jsx("p",{className:"text-red-600 text-sm",children:F})})]}),e.jsx("button",{disabled:c||!o&&(g||!te)||pe&&!M||o&&p.otp.length!==6||v,className:"w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105",children:c||!o&&g||v?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),v?"Verifying OTP...":o?"Signing In...":"Sending OTP..."]}):o?"Sign In":"Send OTP"})]}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"OR"})})]}),e.jsx(Je,{pageType:"signIn",disabled:a!==null||o,onAuthStart:j}),(ge||q)&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-600 text-sm",children:q||ge})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Don't have an account?"," ",e.jsx(Ae,{to:"/sign-up",className:`text-blue-600 hover:text-blue-800 font-semibold hover:underline transition-colors duration-200 ${a!==null||c||v||o?"opacity-50 cursor-not-allowed pointer-events-none":""}`,children:"Sign Up"})]})})]})]})})]})}export{Xe as default};
