import{u as C,i as I,r as t,p as _,s as $,j as e,L as i,aS as S,w as U,H as M,S as R,aE as T,C as A,y as O}from"./index-AwWxf1fH.js";import{m as z}from"./addressMasking-3vIUwCOC.js";const u="https://urbansetu.onrender.com";function J(){C("My Listings - My Properties");const{currentUser:l}=I(s=>s.user),[p,h]=t.useState([]),[L,o]=t.useState(!0),[f,d]=t.useState(null),P=_();$();const[E,c]=t.useState(!1),[g,b]=t.useState(""),[y,m]=t.useState(!1),[j,a]=t.useState(""),[w,N]=t.useState(null);t.useEffect(()=>{(async()=>{if(!l){d("Please sign in to view your listings"),o(!1);return}try{o(!0),d(null);const r=await fetch(`${u}/api/listing/user`,{credentials:"include"});if(r.ok){const n=await r.json();h(n)}else throw new Error("Failed to fetch listings")}catch(r){console.error("Error fetching listings:",r),d("Failed to load listings. Please try again.")}finally{o(!1)}})()},[l]);const F=s=>{N(s),c(!0),b(""),a("")},D=async s=>{s.preventDefault(),m(!0),a("");try{if(!(await fetch(`${u}/api/user/verify-password/${l._id}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:g})})).ok){a("Incorrect password. Listing not deleted."),m(!1);return}const n=await fetch(`${u}/api/listing/delete/${w}`,{method:"DELETE",credentials:"include"});if(n.ok)h(x=>x.filter(k=>k._id!==w)),O.success("Listing deleted successfully!"),c(!1),N(null),P("/user/my-listings");else{const x=await n.json();a(x.message||"Failed to delete listing.")}}catch{a("An error occurred. Please try again.")}finally{m(!1)}},v=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0,maximumFractionDigits:0}).format(s);return L?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading your listings..."})]})}):f?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100 py-10 px-2 md:px-8",children:e.jsx("div",{className:"max-w-6xl mx-auto bg-white rounded-xl shadow-lg p-6",children:e.jsx("div",{className:"text-center text-red-600 text-lg",children:f})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100 py-10 px-2 md:px-8",children:[e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl sm:text-3xl font-extrabold text-blue-700 drop-shadow",children:"My Listings"}),e.jsxs(i,{to:"/user/create-listing",className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-3 sm:px-6 py-2 sm:py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-1 sm:gap-2 text-sm sm:text-base w-full sm:w-auto justify-center mt-4 md:mt-0",children:[e.jsx(S,{})," ",e.jsx("span",{children:"Create New Listing"})]})]}),p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"ðŸ "}),e.jsx("h4",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No listings yet"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Start by creating your first property listing"}),e.jsxs(i,{to:"/user/create-listing",className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-3 sm:px-6 py-2 sm:py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold inline-flex items-center gap-1 sm:gap-2 text-sm sm:text-base w-full sm:w-auto justify-center",children:[e.jsx(S,{})," ",e.jsx("span",{children:"Create Your First Listing"})]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map(s=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"relative h-48 bg-gray-200 rounded-t-lg overflow-hidden",children:[s.imageUrls&&s.imageUrls.length>0?e.jsx("img",{src:s.imageUrls[0],alt:s.name,className:"w-full h-full object-cover",onError:r=>{r.target.src="https://via.placeholder.com/400x300?text=No+Image"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:e.jsx("span",{children:"No Image"})}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${s.type==="sale"?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700"}`,children:s.type==="sale"?"For Sale":"For Rent"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"font-semibold text-lg text-gray-800 mb-2 truncate",children:s.name}),e.jsx("p",{className:"text-gray-600 text-sm mb-2 truncate",children:z(s.propertyNumber||s.city?{propertyNumber:s.propertyNumber,landmark:s.landmark,city:s.city,district:s.district,state:s.state,pincode:s.pincode}:s.address,!!l)}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 mb-3",children:[e.jsxs("span",{children:[s.bedrooms," bed"]}),e.jsxs("span",{children:[s.bathrooms," bath"]}),s.parking&&e.jsx("span",{children:"Parking"}),s.furnished&&e.jsx("span",{children:"Furnished"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:[s.offer?v(s.discountPrice):v(s.regularPrice),s.type==="rent"&&e.jsx("span",{className:"text-sm text-gray-500",children:"/month"})]}),s.offer&&e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Offer!"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{to:`/user/listing/${s._id}`,className:"flex-1 bg-blue-500 text-white px-3 py-2 rounded text-sm font-medium hover:bg-blue-600 transition flex items-center justify-center gap-1",children:[e.jsx(U,{})," View"]}),e.jsxs(i,{to:`/user/update-listing/${s._id}`,className:"flex-1 bg-yellow-500 text-white px-3 py-2 rounded text-sm font-medium hover:bg-yellow-600 transition flex items-center justify-center gap-1",children:[e.jsx(M,{})," Edit"]}),e.jsxs("button",{onClick:()=>F(s._id),className:"flex-1 bg-red-500 text-white px-3 py-2 rounded text-sm font-medium hover:bg-red-600 transition flex items-center justify-center gap-1",children:[e.jsx(R,{})," Delete"]})]})]})]},s._id))})]})}),E&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:e.jsxs("form",{onSubmit:D,className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs flex flex-col gap-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[e.jsx(T,{})," Confirm Password"]}),e.jsx("input",{type:"password",className:"border rounded p-2 w-full",placeholder:"Enter your password",value:g,onChange:s=>b(s.target.value),autoFocus:!0}),j&&e.jsx("div",{className:"text-red-600 text-sm",children:j}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-red-600 text-white font-semibold",disabled:y,children:y?"Deleting...":"Confirm & Delete"})]})]})}),e.jsx(A,{})]})}export{J as default};
