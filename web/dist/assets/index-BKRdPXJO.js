const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PublicHome-BSVll3I_.js","assets/create-element-if-not-defined-Di3MmCFt.js","assets/pagination-ZnrETZ_p.js","assets/pagination-B-59Jalc.css","assets/ListingItem-v-p8FNc0.js","assets/addressMasking-3vIUwCOC.js","assets/GeminiAIWrapper-CHcNT9J-.js","assets/linkFormatter-DjBy7uUE.js","assets/Home-Dlds2LZ0.js","assets/PublicSearch-DeoLB7vi.js","assets/countries_states_cities-CCOM4uJJ.js","assets/Search-CGpDTPjj.js","assets/LocationSelector-DzbGvy-z.js","assets/Profile-Cx9yZKDR.js","assets/RecaptchaWidget-C3MKWI1N.js","assets/SignIn-DfNK_Shr.js","assets/Oauth-B1YZJ89D.js","assets/SignUp-C3aFWjQL.js","assets/ForgotPassword-CNAVT50Y.js","assets/CreateListing-C6ekv3EE.js","assets/EditListing-DIII9DnG.js","assets/Listing-CZlp6twd.js","assets/ReviewForm-p7RSx8QR.js","assets/ImagePreview-Urd8OuCW.js","assets/Listing-vHIubPVI.css","assets/WishList-B9U2CWV4.js","assets/Watchlist-DXpgbvly.js","assets/Appointment-CD8-uE6i.js","assets/PaymentModal-CLwg2E9q.js","assets/AdminAppointments-ClhA58DQ.js","assets/ExportChatModal-wtNIYUQa.js","assets/AdminDashboard-Cn8r-foN.js","assets/MyAppointments-B3-6j_KC.js","assets/MyListings-BVGbK4IV.js","assets/AdminExplore-DJzP5osE.js","assets/AdminCreateListing-C4PY3bR4.js","assets/AdminProfile-BFPK-9Tu.js","assets/AdminListings-8x9w4pP0.js","assets/AdminMyListings-SPM7Ju_1.js","assets/AdminEditListing-B8FTB3dQ.js","assets/UserReviews-NfKzOUja.js","assets/Contact-BkxpstF9.js","assets/UserContact-CnIt2Brx.js","assets/AdminSupport-BFgaQ4bp.js","assets/PublicAI-DF_mXxWX.js","assets/UserAI-gR0iv3YO.js","assets/AdminAI-CccWcDQ-.js"])))=>i.map(i=>d[i]);
var oC=Object.defineProperty;var lC=(h,g,b)=>g in h?oC(h,g,{enumerable:!0,configurable:!0,writable:!0,value:b}):h[g]=b;var Wx=(h,g,b)=>lC(h,typeof g!="symbol"?g+"":g,b);function cC(h,g){for(var b=0;b<g.length;b++){const S=g[b];if(typeof S!="string"&&!Array.isArray(S)){for(const I in S)if(I!=="default"&&!(I in h)){const N=Object.getOwnPropertyDescriptor(S,I);N&&Object.defineProperty(h,I,N.get?N:{enumerable:!0,get:()=>S[I]})}}}return Object.freeze(Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}))}(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const I of document.querySelectorAll('link[rel="modulepreload"]'))S(I);new MutationObserver(I=>{for(const N of I)if(N.type==="childList")for(const V of N.addedNodes)V.tagName==="LINK"&&V.rel==="modulepreload"&&S(V)}).observe(document,{childList:!0,subtree:!0});function b(I){const N={};return I.integrity&&(N.integrity=I.integrity),I.referrerPolicy&&(N.referrerPolicy=I.referrerPolicy),I.crossOrigin==="use-credentials"?N.credentials="include":I.crossOrigin==="anonymous"?N.credentials="omit":N.credentials="same-origin",N}function S(I){if(I.ep)return;I.ep=!0;const N=b(I);fetch(I.href,N)}})();var gp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function O2(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}function uC(h){if(Object.prototype.hasOwnProperty.call(h,"__esModule"))return h;var g=h.default;if(typeof g=="function"){var b=function S(){return this instanceof S?Reflect.construct(g,arguments,this.constructor):g.apply(this,arguments)};b.prototype=g.prototype}else b={};return Object.defineProperty(b,"__esModule",{value:!0}),Object.keys(h).forEach(function(S){var I=Object.getOwnPropertyDescriptor(h,S);Object.defineProperty(b,S,I.get?I:{enumerable:!0,get:function(){return h[S]}})}),b}var Xx={exports:{}},$_={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G3;function hC(){if(G3)return $_;G3=1;var h=Symbol.for("react.transitional.element"),g=Symbol.for("react.fragment");function b(S,I,N){var V=null;if(N!==void 0&&(V=""+N),I.key!==void 0&&(V=""+I.key),"key"in I){N={};for(var s in I)s!=="key"&&(N[s]=I[s])}else N=I;return I=N.ref,{$$typeof:h,type:S,key:V,ref:I!==void 0?I:null,props:N}}return $_.Fragment=g,$_.jsx=b,$_.jsxs=b,$_}var $3;function dC(){return $3||($3=1,Xx.exports=hC()),Xx.exports}var _=dC(),Yx={exports:{}},yn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Z3;function fC(){if(Z3)return yn;Z3=1;var h=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),N=Symbol.for("react.consumer"),V=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),q=Symbol.for("react.suspense"),Z=Symbol.for("react.memo"),Q=Symbol.for("react.lazy"),oe=Symbol.iterator;function de(tt){return tt===null||typeof tt!="object"?null:(tt=oe&&tt[oe]||tt["@@iterator"],typeof tt=="function"?tt:null)}var ze={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},le=Object.assign,Se={};function ee(tt,Ht,Pi){this.props=tt,this.context=Ht,this.refs=Se,this.updater=Pi||ze}ee.prototype.isReactComponent={},ee.prototype.setState=function(tt,Ht){if(typeof tt!="object"&&typeof tt!="function"&&tt!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,tt,Ht,"setState")},ee.prototype.forceUpdate=function(tt){this.updater.enqueueForceUpdate(this,tt,"forceUpdate")};function _e(){}_e.prototype=ee.prototype;function ye(tt,Ht,Pi){this.props=tt,this.context=Ht,this.refs=Se,this.updater=Pi||ze}var xe=ye.prototype=new _e;xe.constructor=ye,le(xe,ee.prototype),xe.isPureReactComponent=!0;var Le=Array.isArray,Ae={H:null,A:null,T:null,S:null},Ke=Object.prototype.hasOwnProperty;function it(tt,Ht,Pi,Ui,ii,Wi){return Pi=Wi.ref,{$$typeof:h,type:tt,key:Ht,ref:Pi!==void 0?Pi:null,props:Wi}}function rt(tt,Ht){return it(tt.type,Ht,void 0,void 0,void 0,tt.props)}function lt(tt){return typeof tt=="object"&&tt!==null&&tt.$$typeof===h}function zt(tt){var Ht={"=":"=0",":":"=2"};return"$"+tt.replace(/[=:]/g,function(Pi){return Ht[Pi]})}var xt=/\/+/g;function Ci(tt,Ht){return typeof tt=="object"&&tt!==null&&tt.key!=null?zt(""+tt.key):Ht.toString(36)}function Zi(){}function or(tt){switch(tt.status){case"fulfilled":return tt.value;case"rejected":throw tt.reason;default:switch(typeof tt.status=="string"?tt.then(Zi,Zi):(tt.status="pending",tt.then(function(Ht){tt.status==="pending"&&(tt.status="fulfilled",tt.value=Ht)},function(Ht){tt.status==="pending"&&(tt.status="rejected",tt.reason=Ht)})),tt.status){case"fulfilled":return tt.value;case"rejected":throw tt.reason}}throw tt}function er(tt,Ht,Pi,Ui,ii){var Wi=typeof tt;(Wi==="undefined"||Wi==="boolean")&&(tt=null);var _i=!1;if(tt===null)_i=!0;else switch(Wi){case"bigint":case"string":case"number":_i=!0;break;case"object":switch(tt.$$typeof){case h:case g:_i=!0;break;case Q:return _i=tt._init,er(_i(tt._payload),Ht,Pi,Ui,ii)}}if(_i)return ii=ii(tt),_i=Ui===""?"."+Ci(tt,0):Ui,Le(ii)?(Pi="",_i!=null&&(Pi=_i.replace(xt,"$&/")+"/"),er(ii,Ht,Pi,"",function(gt){return gt})):ii!=null&&(lt(ii)&&(ii=rt(ii,Pi+(ii.key==null||tt&&tt.key===ii.key?"":(""+ii.key).replace(xt,"$&/")+"/")+_i)),Ht.push(ii)),1;_i=0;var Ri=Ui===""?".":Ui+":";if(Le(tt))for(var Ai=0;Ai<tt.length;Ai++)Ui=tt[Ai],Wi=Ri+Ci(Ui,Ai),_i+=er(Ui,Ht,Pi,Wi,ii);else if(Ai=de(tt),typeof Ai=="function")for(tt=Ai.call(tt),Ai=0;!(Ui=tt.next()).done;)Ui=Ui.value,Wi=Ri+Ci(Ui,Ai++),_i+=er(Ui,Ht,Pi,Wi,ii);else if(Wi==="object"){if(typeof tt.then=="function")return er(or(tt),Ht,Pi,Ui,ii);throw Ht=String(tt),Error("Objects are not valid as a React child (found: "+(Ht==="[object Object]"?"object with keys {"+Object.keys(tt).join(", ")+"}":Ht)+"). If you meant to render a collection of children, use an array instead.")}return _i}function Jt(tt,Ht,Pi){if(tt==null)return tt;var Ui=[],ii=0;return er(tt,Ui,"","",function(Wi){return Ht.call(Pi,Wi,ii++)}),Ui}function ji(tt){if(tt._status===-1){var Ht=tt._result;Ht=Ht(),Ht.then(function(Pi){(tt._status===0||tt._status===-1)&&(tt._status=1,tt._result=Pi)},function(Pi){(tt._status===0||tt._status===-1)&&(tt._status=2,tt._result=Pi)}),tt._status===-1&&(tt._status=0,tt._result=Ht)}if(tt._status===1)return tt._result.default;throw tt._result}var Fi=typeof reportError=="function"?reportError:function(tt){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ht=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof tt=="object"&&tt!==null&&typeof tt.message=="string"?String(tt.message):String(tt),error:tt});if(!window.dispatchEvent(Ht))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",tt);return}console.error(tt)};function Pr(){}return yn.Children={map:Jt,forEach:function(tt,Ht,Pi){Jt(tt,function(){Ht.apply(this,arguments)},Pi)},count:function(tt){var Ht=0;return Jt(tt,function(){Ht++}),Ht},toArray:function(tt){return Jt(tt,function(Ht){return Ht})||[]},only:function(tt){if(!lt(tt))throw Error("React.Children.only expected to receive a single React element child.");return tt}},yn.Component=ee,yn.Fragment=b,yn.Profiler=I,yn.PureComponent=ye,yn.StrictMode=S,yn.Suspense=q,yn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ae,yn.act=function(){throw Error("act(...) is not supported in production builds of React.")},yn.cache=function(tt){return function(){return tt.apply(null,arguments)}},yn.cloneElement=function(tt,Ht,Pi){if(tt==null)throw Error("The argument must be a React element, but you passed "+tt+".");var Ui=le({},tt.props),ii=tt.key,Wi=void 0;if(Ht!=null)for(_i in Ht.ref!==void 0&&(Wi=void 0),Ht.key!==void 0&&(ii=""+Ht.key),Ht)!Ke.call(Ht,_i)||_i==="key"||_i==="__self"||_i==="__source"||_i==="ref"&&Ht.ref===void 0||(Ui[_i]=Ht[_i]);var _i=arguments.length-2;if(_i===1)Ui.children=Pi;else if(1<_i){for(var Ri=Array(_i),Ai=0;Ai<_i;Ai++)Ri[Ai]=arguments[Ai+2];Ui.children=Ri}return it(tt.type,ii,void 0,void 0,Wi,Ui)},yn.createContext=function(tt){return tt={$$typeof:V,_currentValue:tt,_currentValue2:tt,_threadCount:0,Provider:null,Consumer:null},tt.Provider=tt,tt.Consumer={$$typeof:N,_context:tt},tt},yn.createElement=function(tt,Ht,Pi){var Ui,ii={},Wi=null;if(Ht!=null)for(Ui in Ht.key!==void 0&&(Wi=""+Ht.key),Ht)Ke.call(Ht,Ui)&&Ui!=="key"&&Ui!=="__self"&&Ui!=="__source"&&(ii[Ui]=Ht[Ui]);var _i=arguments.length-2;if(_i===1)ii.children=Pi;else if(1<_i){for(var Ri=Array(_i),Ai=0;Ai<_i;Ai++)Ri[Ai]=arguments[Ai+2];ii.children=Ri}if(tt&&tt.defaultProps)for(Ui in _i=tt.defaultProps,_i)ii[Ui]===void 0&&(ii[Ui]=_i[Ui]);return it(tt,Wi,void 0,void 0,null,ii)},yn.createRef=function(){return{current:null}},yn.forwardRef=function(tt){return{$$typeof:s,render:tt}},yn.isValidElement=lt,yn.lazy=function(tt){return{$$typeof:Q,_payload:{_status:-1,_result:tt},_init:ji}},yn.memo=function(tt,Ht){return{$$typeof:Z,type:tt,compare:Ht===void 0?null:Ht}},yn.startTransition=function(tt){var Ht=Ae.T,Pi={};Ae.T=Pi;try{var Ui=tt(),ii=Ae.S;ii!==null&&ii(Pi,Ui),typeof Ui=="object"&&Ui!==null&&typeof Ui.then=="function"&&Ui.then(Pr,Fi)}catch(Wi){Fi(Wi)}finally{Ae.T=Ht}},yn.unstable_useCacheRefresh=function(){return Ae.H.useCacheRefresh()},yn.use=function(tt){return Ae.H.use(tt)},yn.useActionState=function(tt,Ht,Pi){return Ae.H.useActionState(tt,Ht,Pi)},yn.useCallback=function(tt,Ht){return Ae.H.useCallback(tt,Ht)},yn.useContext=function(tt){return Ae.H.useContext(tt)},yn.useDebugValue=function(){},yn.useDeferredValue=function(tt,Ht){return Ae.H.useDeferredValue(tt,Ht)},yn.useEffect=function(tt,Ht){return Ae.H.useEffect(tt,Ht)},yn.useId=function(){return Ae.H.useId()},yn.useImperativeHandle=function(tt,Ht,Pi){return Ae.H.useImperativeHandle(tt,Ht,Pi)},yn.useInsertionEffect=function(tt,Ht){return Ae.H.useInsertionEffect(tt,Ht)},yn.useLayoutEffect=function(tt,Ht){return Ae.H.useLayoutEffect(tt,Ht)},yn.useMemo=function(tt,Ht){return Ae.H.useMemo(tt,Ht)},yn.useOptimistic=function(tt,Ht){return Ae.H.useOptimistic(tt,Ht)},yn.useReducer=function(tt,Ht,Pi){return Ae.H.useReducer(tt,Ht,Pi)},yn.useRef=function(tt){return Ae.H.useRef(tt)},yn.useState=function(tt){return Ae.H.useState(tt)},yn.useSyncExternalStore=function(tt,Ht,Pi){return Ae.H.useSyncExternalStore(tt,Ht,Pi)},yn.useTransition=function(){return Ae.H.useTransition()},yn.version="19.0.0",yn}var W3;function y1(){return W3||(W3=1,Yx.exports=fC()),Yx.exports}var ue=y1();const Wn=O2(ue),_j=cC({__proto__:null,default:Wn},[ue]);var Kx={exports:{}},Z_={},Jx={exports:{}},Qx={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X3;function pC(){return X3||(X3=1,function(h){function g(Jt,ji){var Fi=Jt.length;Jt.push(ji);e:for(;0<Fi;){var Pr=Fi-1>>>1,tt=Jt[Pr];if(0<I(tt,ji))Jt[Pr]=ji,Jt[Fi]=tt,Fi=Pr;else break e}}function b(Jt){return Jt.length===0?null:Jt[0]}function S(Jt){if(Jt.length===0)return null;var ji=Jt[0],Fi=Jt.pop();if(Fi!==ji){Jt[0]=Fi;e:for(var Pr=0,tt=Jt.length,Ht=tt>>>1;Pr<Ht;){var Pi=2*(Pr+1)-1,Ui=Jt[Pi],ii=Pi+1,Wi=Jt[ii];if(0>I(Ui,Fi))ii<tt&&0>I(Wi,Ui)?(Jt[Pr]=Wi,Jt[ii]=Fi,Pr=ii):(Jt[Pr]=Ui,Jt[Pi]=Fi,Pr=Pi);else if(ii<tt&&0>I(Wi,Fi))Jt[Pr]=Wi,Jt[ii]=Fi,Pr=ii;else break e}}return ji}function I(Jt,ji){var Fi=Jt.sortIndex-ji.sortIndex;return Fi!==0?Fi:Jt.id-ji.id}if(h.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var N=performance;h.unstable_now=function(){return N.now()}}else{var V=Date,s=V.now();h.unstable_now=function(){return V.now()-s}}var q=[],Z=[],Q=1,oe=null,de=3,ze=!1,le=!1,Se=!1,ee=typeof setTimeout=="function"?setTimeout:null,_e=typeof clearTimeout=="function"?clearTimeout:null,ye=typeof setImmediate<"u"?setImmediate:null;function xe(Jt){for(var ji=b(Z);ji!==null;){if(ji.callback===null)S(Z);else if(ji.startTime<=Jt)S(Z),ji.sortIndex=ji.expirationTime,g(q,ji);else break;ji=b(Z)}}function Le(Jt){if(Se=!1,xe(Jt),!le)if(b(q)!==null)le=!0,or();else{var ji=b(Z);ji!==null&&er(Le,ji.startTime-Jt)}}var Ae=!1,Ke=-1,it=5,rt=-1;function lt(){return!(h.unstable_now()-rt<it)}function zt(){if(Ae){var Jt=h.unstable_now();rt=Jt;var ji=!0;try{e:{le=!1,Se&&(Se=!1,_e(Ke),Ke=-1),ze=!0;var Fi=de;try{t:{for(xe(Jt),oe=b(q);oe!==null&&!(oe.expirationTime>Jt&&lt());){var Pr=oe.callback;if(typeof Pr=="function"){oe.callback=null,de=oe.priorityLevel;var tt=Pr(oe.expirationTime<=Jt);if(Jt=h.unstable_now(),typeof tt=="function"){oe.callback=tt,xe(Jt),ji=!0;break t}oe===b(q)&&S(q),xe(Jt)}else S(q);oe=b(q)}if(oe!==null)ji=!0;else{var Ht=b(Z);Ht!==null&&er(Le,Ht.startTime-Jt),ji=!1}}break e}finally{oe=null,de=Fi,ze=!1}ji=void 0}}finally{ji?xt():Ae=!1}}}var xt;if(typeof ye=="function")xt=function(){ye(zt)};else if(typeof MessageChannel<"u"){var Ci=new MessageChannel,Zi=Ci.port2;Ci.port1.onmessage=zt,xt=function(){Zi.postMessage(null)}}else xt=function(){ee(zt,0)};function or(){Ae||(Ae=!0,xt())}function er(Jt,ji){Ke=ee(function(){Jt(h.unstable_now())},ji)}h.unstable_IdlePriority=5,h.unstable_ImmediatePriority=1,h.unstable_LowPriority=4,h.unstable_NormalPriority=3,h.unstable_Profiling=null,h.unstable_UserBlockingPriority=2,h.unstable_cancelCallback=function(Jt){Jt.callback=null},h.unstable_continueExecution=function(){le||ze||(le=!0,or())},h.unstable_forceFrameRate=function(Jt){0>Jt||125<Jt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):it=0<Jt?Math.floor(1e3/Jt):5},h.unstable_getCurrentPriorityLevel=function(){return de},h.unstable_getFirstCallbackNode=function(){return b(q)},h.unstable_next=function(Jt){switch(de){case 1:case 2:case 3:var ji=3;break;default:ji=de}var Fi=de;de=ji;try{return Jt()}finally{de=Fi}},h.unstable_pauseExecution=function(){},h.unstable_requestPaint=function(){},h.unstable_runWithPriority=function(Jt,ji){switch(Jt){case 1:case 2:case 3:case 4:case 5:break;default:Jt=3}var Fi=de;de=Jt;try{return ji()}finally{de=Fi}},h.unstable_scheduleCallback=function(Jt,ji,Fi){var Pr=h.unstable_now();switch(typeof Fi=="object"&&Fi!==null?(Fi=Fi.delay,Fi=typeof Fi=="number"&&0<Fi?Pr+Fi:Pr):Fi=Pr,Jt){case 1:var tt=-1;break;case 2:tt=250;break;case 5:tt=1073741823;break;case 4:tt=1e4;break;default:tt=5e3}return tt=Fi+tt,Jt={id:Q++,callback:ji,priorityLevel:Jt,startTime:Fi,expirationTime:tt,sortIndex:-1},Fi>Pr?(Jt.sortIndex=Fi,g(Z,Jt),b(q)===null&&Jt===b(Z)&&(Se?(_e(Ke),Ke=-1):Se=!0,er(Le,Fi-Pr))):(Jt.sortIndex=tt,g(q,Jt),le||ze||(le=!0,or())),Jt},h.unstable_shouldYield=lt,h.unstable_wrapCallback=function(Jt){var ji=de;return function(){var Fi=de;de=ji;try{return Jt.apply(this,arguments)}finally{de=Fi}}}}(Qx)),Qx}var Y3;function mC(){return Y3||(Y3=1,Jx.exports=pC()),Jx.exports}var ev={exports:{}},jo={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K3;function gC(){if(K3)return jo;K3=1;var h=y1();function g(q){var Z="https://react.dev/errors/"+q;if(1<arguments.length){Z+="?args[]="+encodeURIComponent(arguments[1]);for(var Q=2;Q<arguments.length;Q++)Z+="&args[]="+encodeURIComponent(arguments[Q])}return"Minified React error #"+q+"; visit "+Z+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function b(){}var S={d:{f:b,r:function(){throw Error(g(522))},D:b,C:b,L:b,m:b,X:b,S:b,M:b},p:0,findDOMNode:null},I=Symbol.for("react.portal");function N(q,Z,Q){var oe=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:I,key:oe==null?null:""+oe,children:q,containerInfo:Z,implementation:Q}}var V=h.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(q,Z){if(q==="font")return"";if(typeof Z=="string")return Z==="use-credentials"?Z:""}return jo.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,jo.createPortal=function(q,Z){var Q=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Z||Z.nodeType!==1&&Z.nodeType!==9&&Z.nodeType!==11)throw Error(g(299));return N(q,Z,null,Q)},jo.flushSync=function(q){var Z=V.T,Q=S.p;try{if(V.T=null,S.p=2,q)return q()}finally{V.T=Z,S.p=Q,S.d.f()}},jo.preconnect=function(q,Z){typeof q=="string"&&(Z?(Z=Z.crossOrigin,Z=typeof Z=="string"?Z==="use-credentials"?Z:"":void 0):Z=null,S.d.C(q,Z))},jo.prefetchDNS=function(q){typeof q=="string"&&S.d.D(q)},jo.preinit=function(q,Z){if(typeof q=="string"&&Z&&typeof Z.as=="string"){var Q=Z.as,oe=s(Q,Z.crossOrigin),de=typeof Z.integrity=="string"?Z.integrity:void 0,ze=typeof Z.fetchPriority=="string"?Z.fetchPriority:void 0;Q==="style"?S.d.S(q,typeof Z.precedence=="string"?Z.precedence:void 0,{crossOrigin:oe,integrity:de,fetchPriority:ze}):Q==="script"&&S.d.X(q,{crossOrigin:oe,integrity:de,fetchPriority:ze,nonce:typeof Z.nonce=="string"?Z.nonce:void 0})}},jo.preinitModule=function(q,Z){if(typeof q=="string")if(typeof Z=="object"&&Z!==null){if(Z.as==null||Z.as==="script"){var Q=s(Z.as,Z.crossOrigin);S.d.M(q,{crossOrigin:Q,integrity:typeof Z.integrity=="string"?Z.integrity:void 0,nonce:typeof Z.nonce=="string"?Z.nonce:void 0})}}else Z==null&&S.d.M(q)},jo.preload=function(q,Z){if(typeof q=="string"&&typeof Z=="object"&&Z!==null&&typeof Z.as=="string"){var Q=Z.as,oe=s(Q,Z.crossOrigin);S.d.L(q,Q,{crossOrigin:oe,integrity:typeof Z.integrity=="string"?Z.integrity:void 0,nonce:typeof Z.nonce=="string"?Z.nonce:void 0,type:typeof Z.type=="string"?Z.type:void 0,fetchPriority:typeof Z.fetchPriority=="string"?Z.fetchPriority:void 0,referrerPolicy:typeof Z.referrerPolicy=="string"?Z.referrerPolicy:void 0,imageSrcSet:typeof Z.imageSrcSet=="string"?Z.imageSrcSet:void 0,imageSizes:typeof Z.imageSizes=="string"?Z.imageSizes:void 0,media:typeof Z.media=="string"?Z.media:void 0})}},jo.preloadModule=function(q,Z){if(typeof q=="string")if(Z){var Q=s(Z.as,Z.crossOrigin);S.d.m(q,{as:typeof Z.as=="string"&&Z.as!=="script"?Z.as:void 0,crossOrigin:Q,integrity:typeof Z.integrity=="string"?Z.integrity:void 0})}else S.d.m(q)},jo.requestFormReset=function(q){S.d.r(q)},jo.unstable_batchedUpdates=function(q,Z){return q(Z)},jo.useFormState=function(q,Z,Q){return V.H.useFormState(q,Z,Q)},jo.useFormStatus=function(){return V.H.useHostTransitionStatus()},jo.version="19.0.0",jo}var J3;function sT(){if(J3)return ev.exports;J3=1;function h(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h)}catch(g){console.error(g)}}return h(),ev.exports=gC(),ev.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q3;function _C(){if(Q3)return Z_;Q3=1;var h=mC(),g=y1(),b=sT();function S(l){var f="https://react.dev/errors/"+l;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var v=2;v<arguments.length;v++)f+="&args[]="+encodeURIComponent(arguments[v])}return"Minified React error #"+l+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function I(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}var N=Symbol.for("react.element"),V=Symbol.for("react.transitional.element"),s=Symbol.for("react.portal"),q=Symbol.for("react.fragment"),Z=Symbol.for("react.strict_mode"),Q=Symbol.for("react.profiler"),oe=Symbol.for("react.provider"),de=Symbol.for("react.consumer"),ze=Symbol.for("react.context"),le=Symbol.for("react.forward_ref"),Se=Symbol.for("react.suspense"),ee=Symbol.for("react.suspense_list"),_e=Symbol.for("react.memo"),ye=Symbol.for("react.lazy"),xe=Symbol.for("react.offscreen"),Le=Symbol.for("react.memo_cache_sentinel"),Ae=Symbol.iterator;function Ke(l){return l===null||typeof l!="object"?null:(l=Ae&&l[Ae]||l["@@iterator"],typeof l=="function"?l:null)}var it=Symbol.for("react.client.reference");function rt(l){if(l==null)return null;if(typeof l=="function")return l.$$typeof===it?null:l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case q:return"Fragment";case s:return"Portal";case Q:return"Profiler";case Z:return"StrictMode";case Se:return"Suspense";case ee:return"SuspenseList"}if(typeof l=="object")switch(l.$$typeof){case ze:return(l.displayName||"Context")+".Provider";case de:return(l._context.displayName||"Context")+".Consumer";case le:var f=l.render;return l=l.displayName,l||(l=f.displayName||f.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case _e:return f=l.displayName||null,f!==null?f:rt(l.type)||"Memo";case ye:f=l._payload,l=l._init;try{return rt(l(f))}catch{}}return null}var lt=g.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,zt=Object.assign,xt,Ci;function Zi(l){if(xt===void 0)try{throw Error()}catch(v){var f=v.stack.trim().match(/\n( *(at )?)/);xt=f&&f[1]||"",Ci=-1<v.stack.indexOf(`
    at`)?" (<anonymous>)":-1<v.stack.indexOf("@")?"@unknown:0:0":""}return`
`+xt+l+Ci}var or=!1;function er(l,f){if(!l||or)return"";or=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var C={DetermineComponentFrameRoot:function(){try{if(f){var xi=function(){throw Error()};if(Object.defineProperty(xi.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(xi,[])}catch(ri){var Ut=ri}Reflect.construct(l,[],xi)}else{try{xi.call()}catch(ri){Ut=ri}l.call(xi.prototype)}}else{try{throw Error()}catch(ri){Ut=ri}(xi=l())&&typeof xi.catch=="function"&&xi.catch(function(){})}}catch(ri){if(ri&&Ut&&typeof ri.stack=="string")return[ri.stack,Ut.stack]}return[null,null]}};C.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var O=Object.getOwnPropertyDescriptor(C.DetermineComponentFrameRoot,"name");O&&O.configurable&&Object.defineProperty(C.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var U=C.DetermineComponentFrameRoot(),ae=U[0],De=U[1];if(ae&&De){var Xe=ae.split(`
`),mt=De.split(`
`);for(O=C=0;C<Xe.length&&!Xe[C].includes("DetermineComponentFrameRoot");)C++;for(;O<mt.length&&!mt[O].includes("DetermineComponentFrameRoot");)O++;if(C===Xe.length||O===mt.length)for(C=Xe.length-1,O=mt.length-1;1<=C&&0<=O&&Xe[C]!==mt[O];)O--;for(;1<=C&&0<=O;C--,O--)if(Xe[C]!==mt[O]){if(C!==1||O!==1)do if(C--,O--,0>O||Xe[C]!==mt[O]){var ai=`
`+Xe[C].replace(" at new "," at ");return l.displayName&&ai.includes("<anonymous>")&&(ai=ai.replace("<anonymous>",l.displayName)),ai}while(1<=C&&0<=O);break}}}finally{or=!1,Error.prepareStackTrace=v}return(v=l?l.displayName||l.name:"")?Zi(v):""}function Jt(l){switch(l.tag){case 26:case 27:case 5:return Zi(l.type);case 16:return Zi("Lazy");case 13:return Zi("Suspense");case 19:return Zi("SuspenseList");case 0:case 15:return l=er(l.type,!1),l;case 11:return l=er(l.type.render,!1),l;case 1:return l=er(l.type,!0),l;default:return""}}function ji(l){try{var f="";do f+=Jt(l),l=l.return;while(l);return f}catch(v){return`
Error generating stack: `+v.message+`
`+v.stack}}function Fi(l){var f=l,v=l;if(l.alternate)for(;f.return;)f=f.return;else{l=f;do f=l,(f.flags&4098)!==0&&(v=f.return),l=f.return;while(l)}return f.tag===3?v:null}function Pr(l){if(l.tag===13){var f=l.memoizedState;if(f===null&&(l=l.alternate,l!==null&&(f=l.memoizedState)),f!==null)return f.dehydrated}return null}function tt(l){if(Fi(l)!==l)throw Error(S(188))}function Ht(l){var f=l.alternate;if(!f){if(f=Fi(l),f===null)throw Error(S(188));return f!==l?null:l}for(var v=l,C=f;;){var O=v.return;if(O===null)break;var U=O.alternate;if(U===null){if(C=O.return,C!==null){v=C;continue}break}if(O.child===U.child){for(U=O.child;U;){if(U===v)return tt(O),l;if(U===C)return tt(O),f;U=U.sibling}throw Error(S(188))}if(v.return!==C.return)v=O,C=U;else{for(var ae=!1,De=O.child;De;){if(De===v){ae=!0,v=O,C=U;break}if(De===C){ae=!0,C=O,v=U;break}De=De.sibling}if(!ae){for(De=U.child;De;){if(De===v){ae=!0,v=U,C=O;break}if(De===C){ae=!0,C=U,v=O;break}De=De.sibling}if(!ae)throw Error(S(189))}}if(v.alternate!==C)throw Error(S(190))}if(v.tag!==3)throw Error(S(188));return v.stateNode.current===v?l:f}function Pi(l){var f=l.tag;if(f===5||f===26||f===27||f===6)return l;for(l=l.child;l!==null;){if(f=Pi(l),f!==null)return f;l=l.sibling}return null}var Ui=Array.isArray,ii=b.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Wi={pending:!1,data:null,method:null,action:null},_i=[],Ri=-1;function Ai(l){return{current:l}}function gt(l){0>Ri||(l.current=_i[Ri],_i[Ri]=null,Ri--)}function Tt(l,f){Ri++,_i[Ri]=l.current,l.current=f}var Si=Ai(null),Sr=Ai(null),Cr=Ai(null),zr=Ai(null);function Er(l,f){switch(Tt(Cr,f),Tt(Sr,l),Tt(Si,null),l=f.nodeType,l){case 9:case 11:f=(f=f.documentElement)&&(f=f.namespaceURI)?A0(f):0;break;default:if(l=l===8?f.parentNode:f,f=l.tagName,l=l.namespaceURI)l=A0(l),f=C0(l,f);else switch(f){case"svg":f=1;break;case"math":f=2;break;default:f=0}}gt(Si),Tt(Si,f)}function Gn(){gt(Si),gt(Sr),gt(Cr)}function ds(l){l.memoizedState!==null&&Tt(zr,l);var f=Si.current,v=C0(f,l.type);f!==v&&(Tt(Sr,l),Tt(Si,v))}function Zs(l){Sr.current===l&&(gt(Si),gt(Sr)),zr.current===l&&(gt(zr),hm._currentValue=Wi)}var Br=Object.prototype.hasOwnProperty,Jn=h.unstable_scheduleCallback,Rs=h.unstable_cancelCallback,za=h.unstable_shouldYield,La=h.unstable_requestPaint,fs=h.unstable_now,ps=h.unstable_getCurrentPriorityLevel,$n=h.unstable_ImmediatePriority,Xn=h.unstable_UserBlockingPriority,Ds=h.unstable_NormalPriority,Ps=h.unstable_LowPriority,Vs=h.unstable_IdlePriority,Pn=h.log,oa=h.unstable_setDisableYieldValue,Da=null,as=null;function va(l){if(as&&typeof as.onCommitFiberRoot=="function")try{as.onCommitFiberRoot(Da,l,void 0,(l.current.flags&128)===128)}catch{}}function Ms(l){if(typeof Pn=="function"&&oa(l),as&&typeof as.setStrictMode=="function")try{as.setStrictMode(Da,l)}catch{}}var os=Math.clz32?Math.clz32:Ti,hn=Math.log,Dt=Math.LN2;function Ti(l){return l>>>=0,l===0?32:31-(hn(l)/Dt|0)|0}var Ar=128,br=4194304;function Rr(l){var f=l&42;if(f!==0)return f;switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return l&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return l}}function xn(l,f){var v=l.pendingLanes;if(v===0)return 0;var C=0,O=l.suspendedLanes,U=l.pingedLanes,ae=l.warmLanes;l=l.finishedLanes!==0;var De=v&134217727;return De!==0?(v=De&~O,v!==0?C=Rr(v):(U&=De,U!==0?C=Rr(U):l||(ae=De&~ae,ae!==0&&(C=Rr(ae))))):(De=v&~O,De!==0?C=Rr(De):U!==0?C=Rr(U):l||(ae=v&~ae,ae!==0&&(C=Rr(ae)))),C===0?0:f!==0&&f!==C&&(f&O)===0&&(O=C&-C,ae=f&-f,O>=ae||O===32&&(ae&4194176)!==0)?f:C}function xs(l,f){return(l.pendingLanes&~(l.suspendedLanes&~l.pingedLanes)&f)===0}function Ct(l,f){switch(l){case 1:case 2:case 4:case 8:return f+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Hs(){var l=Ar;return Ar<<=1,(Ar&4194176)===0&&(Ar=128),l}function Pa(){var l=br;return br<<=1,(br&62914560)===0&&(br=4194304),l}function ba(l){for(var f=[],v=0;31>v;v++)f.push(l);return f}function He(l,f){l.pendingLanes|=f,f!==268435456&&(l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0)}function J(l,f,v,C,O,U){var ae=l.pendingLanes;l.pendingLanes=v,l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0,l.expiredLanes&=v,l.entangledLanes&=v,l.errorRecoveryDisabledLanes&=v,l.shellSuspendCounter=0;var De=l.entanglements,Xe=l.expirationTimes,mt=l.hiddenUpdates;for(v=ae&~v;0<v;){var ai=31-os(v),xi=1<<ai;De[ai]=0,Xe[ai]=-1;var Ut=mt[ai];if(Ut!==null)for(mt[ai]=null,ai=0;ai<Ut.length;ai++){var ri=Ut[ai];ri!==null&&(ri.lane&=-536870913)}v&=~xi}C!==0&&ie(l,C,0),U!==0&&O===0&&l.tag!==0&&(l.suspendedLanes|=U&~(ae&~f))}function ie(l,f,v){l.pendingLanes|=f,l.suspendedLanes&=~f;var C=31-os(f);l.entangledLanes|=f,l.entanglements[C]=l.entanglements[C]|1073741824|v&4194218}function me(l,f){var v=l.entangledLanes|=f;for(l=l.entanglements;v;){var C=31-os(v),O=1<<C;O&f|l[C]&f&&(l[C]|=f),v&=~O}}function je(l){return l&=-l,2<l?8<l?(l&134217727)!==0?32:268435456:8:2}function Pe(){var l=ii.p;return l!==0?l:(l=window.event,l===void 0?32:pg(l.type))}function Ie(l,f){var v=ii.p;try{return ii.p=l,f()}finally{ii.p=v}}var Qe=Math.random().toString(36).slice(2),Be="__reactFiber$"+Qe,Je="__reactProps$"+Qe,Lt="__reactContainer$"+Qe,vt="__reactEvents$"+Qe,pi="__reactListeners$"+Qe,Mi="__reactHandles$"+Qe,Vi="__reactResources$"+Qe,lr="__reactMarker$"+Qe;function nr(l){delete l[Be],delete l[Je],delete l[vt],delete l[pi],delete l[Mi]}function cr(l){var f=l[Be];if(f)return f;for(var v=l.parentNode;v;){if(f=v[Lt]||v[Be]){if(v=f.alternate,f.child!==null||v!==null&&v.child!==null)for(l=I0(l);l!==null;){if(v=l[Be])return v;l=I0(l)}return f}l=v,v=l.parentNode}return null}function Hr(l){if(l=l[Be]||l[Lt]){var f=l.tag;if(f===5||f===6||f===13||f===26||f===27||f===3)return l}return null}function ur(l){var f=l.tag;if(f===5||f===26||f===27||f===6)return l.stateNode;throw Error(S(33))}function mn(l){var f=l[Vi];return f||(f=l[Vi]={hoistableStyles:new Map,hoistableScripts:new Map}),f}function Yr(l){l[lr]=!0}var Ve=new Set,wt={};function Ft(l,f){Qt(l,f),Qt(l+"Capture",f)}function Qt(l,f){for(wt[l]=f,l=0;l<f.length;l++)Ve.add(f[l])}var wi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),$i=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Sn={},tn={};function dn(l){return Br.call(tn,l)?!0:Br.call(Sn,l)?!1:$i.test(l)?tn[l]=!0:(Sn[l]=!0,!1)}function In(l,f,v){if(dn(f))if(v===null)l.removeAttribute(f);else{switch(typeof v){case"undefined":case"function":case"symbol":l.removeAttribute(f);return;case"boolean":var C=f.toLowerCase().slice(0,5);if(C!=="data-"&&C!=="aria-"){l.removeAttribute(f);return}}l.setAttribute(f,""+v)}}function Yn(l,f,v){if(v===null)l.removeAttribute(f);else{switch(typeof v){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(f);return}l.setAttribute(f,""+v)}}function Ga(l,f,v,C){if(C===null)l.removeAttribute(v);else{switch(typeof C){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(v);return}l.setAttributeNS(f,v,""+C)}}function ro(l){switch(typeof l){case"bigint":case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function Ol(l){var f=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function oh(l){var f=Ol(l)?"checked":"value",v=Object.getOwnPropertyDescriptor(l.constructor.prototype,f),C=""+l[f];if(!l.hasOwnProperty(f)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var O=v.get,U=v.set;return Object.defineProperty(l,f,{configurable:!0,get:function(){return O.call(this)},set:function(ae){C=""+ae,U.call(this,ae)}}),Object.defineProperty(l,f,{enumerable:v.enumerable}),{getValue:function(){return C},setValue:function(ae){C=""+ae},stopTracking:function(){l._valueTracker=null,delete l[f]}}}}function wc(l){l._valueTracker||(l._valueTracker=oh(l))}function lh(l){if(!l)return!1;var f=l._valueTracker;if(!f)return!0;var v=f.getValue(),C="";return l&&(C=Ol(l)?l.checked?"true":"false":l.value),l=C,l!==v?(f.setValue(l),!0):!1}function Bo(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var ad=/[\n"\\]/g;function $a(l){return l.replace(ad,function(f){return"\\"+f.charCodeAt(0).toString(16)+" "})}function xo(l,f,v,C,O,U,ae,De){l.name="",ae!=null&&typeof ae!="function"&&typeof ae!="symbol"&&typeof ae!="boolean"?l.type=ae:l.removeAttribute("type"),f!=null?ae==="number"?(f===0&&l.value===""||l.value!=f)&&(l.value=""+ro(f)):l.value!==""+ro(f)&&(l.value=""+ro(f)):ae!=="submit"&&ae!=="reset"||l.removeAttribute("value"),f!=null?ch(l,ae,ro(f)):v!=null?ch(l,ae,ro(v)):C!=null&&l.removeAttribute("value"),O==null&&U!=null&&(l.defaultChecked=!!U),O!=null&&(l.checked=O&&typeof O!="function"&&typeof O!="symbol"),De!=null&&typeof De!="function"&&typeof De!="symbol"&&typeof De!="boolean"?l.name=""+ro(De):l.removeAttribute("name")}function hf(l,f,v,C,O,U,ae,De){if(U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"&&(l.type=U),f!=null||v!=null){if(!(U!=="submit"&&U!=="reset"||f!=null))return;v=v!=null?""+ro(v):"",f=f!=null?""+ro(f):v,De||f===l.value||(l.value=f),l.defaultValue=f}C=C??O,C=typeof C!="function"&&typeof C!="symbol"&&!!C,l.checked=De?l.checked:!!C,l.defaultChecked=!!C,ae!=null&&typeof ae!="function"&&typeof ae!="symbol"&&typeof ae!="boolean"&&(l.name=ae)}function ch(l,f,v){f==="number"&&Bo(l.ownerDocument)===l||l.defaultValue===""+v||(l.defaultValue=""+v)}function Ws(l,f,v,C){if(l=l.options,f){f={};for(var O=0;O<v.length;O++)f["$"+v[O]]=!0;for(v=0;v<l.length;v++)O=f.hasOwnProperty("$"+l[v].value),l[v].selected!==O&&(l[v].selected=O),O&&C&&(l[v].defaultSelected=!0)}else{for(v=""+ro(v),f=null,O=0;O<l.length;O++){if(l[O].value===v){l[O].selected=!0,C&&(l[O].defaultSelected=!0);return}f!==null||l[O].disabled||(f=l[O])}f!==null&&(f.selected=!0)}}function vo(l,f,v){if(f!=null&&(f=""+ro(f),f!==l.value&&(l.value=f),v==null)){l.defaultValue!==f&&(l.defaultValue=f);return}l.defaultValue=v!=null?""+ro(v):""}function cl(l,f,v,C){if(f==null){if(C!=null){if(v!=null)throw Error(S(92));if(Ui(C)){if(1<C.length)throw Error(S(93));C=C[0]}v=C}v==null&&(v=""),f=v}v=ro(f),l.defaultValue=v,C=l.textContent,C===v&&C!==""&&C!==null&&(l.value=C)}function wa(l,f){if(f){var v=l.firstChild;if(v&&v===l.lastChild&&v.nodeType===3){v.nodeValue=f;return}}l.textContent=f}var Ta=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Tc(l,f,v){var C=f.indexOf("--")===0;v==null||typeof v=="boolean"||v===""?C?l.setProperty(f,""):f==="float"?l.cssFloat="":l[f]="":C?l.setProperty(f,v):typeof v!="number"||v===0||Ta.has(f)?f==="float"?l.cssFloat=v:l[f]=(""+v).trim():l[f]=v+"px"}function df(l,f,v){if(f!=null&&typeof f!="object")throw Error(S(62));if(l=l.style,v!=null){for(var C in v)!v.hasOwnProperty(C)||f!=null&&f.hasOwnProperty(C)||(C.indexOf("--")===0?l.setProperty(C,""):C==="float"?l.cssFloat="":l[C]="");for(var O in f)C=f[O],f.hasOwnProperty(O)&&v[O]!==C&&Tc(l,O,C)}else for(var U in f)f.hasOwnProperty(U)&&Tc(l,U,f[U])}function lu(l){if(l.indexOf("-")===-1)return!1;switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Sc=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),od=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ec(l){return od.test(""+l)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":l}var Ac=null;function Oa(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var Cc=null,jl=null;function cu(l){var f=Hr(l);if(f&&(l=f.stateNode)){var v=l[Je]||null;e:switch(l=f.stateNode,f.type){case"input":if(xo(l,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name),f=v.name,v.type==="radio"&&f!=null){for(v=l;v.parentNode;)v=v.parentNode;for(v=v.querySelectorAll('input[name="'+$a(""+f)+'"][type="radio"]'),f=0;f<v.length;f++){var C=v[f];if(C!==l&&C.form===l.form){var O=C[Je]||null;if(!O)throw Error(S(90));xo(C,O.value,O.defaultValue,O.defaultValue,O.checked,O.defaultChecked,O.type,O.name)}}for(f=0;f<v.length;f++)C=v[f],C.form===l.form&&lh(C)}break e;case"textarea":vo(l,v.value,v.defaultValue);break e;case"select":f=v.value,f!=null&&Ws(l,!!v.multiple,f,!1)}}}var uh=!1;function ff(l,f,v){if(uh)return l(f,v);uh=!0;try{var C=l(f);return C}finally{if(uh=!1,(Cc!==null||jl!==null)&&(ga(),Cc&&(f=Cc,l=jl,jl=Cc=null,cu(f),l)))for(f=0;f<l.length;f++)cu(l[f])}}function Rc(l,f){var v=l.stateNode;if(v===null)return null;var C=v[Je]||null;if(C===null)return null;v=C[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(C=!C.disabled)||(l=l.type,C=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!C;break e;default:l=!1}if(l)return null;if(v&&typeof v!="function")throw Error(S(231,f,typeof v));return v}var Mr=!1;if(wi)try{var ul={};Object.defineProperty(ul,"passive",{get:function(){Mr=!0}}),window.addEventListener("test",ul,ul),window.removeEventListener("test",ul,ul)}catch{Mr=!1}var Nl=null,pf=null,uu=null;function kl(){if(uu)return uu;var l,f=pf,v=f.length,C,O="value"in Nl?Nl.value:Nl.textContent,U=O.length;for(l=0;l<v&&f[l]===O[l];l++);var ae=v-l;for(C=1;C<=ae&&f[v-C]===O[U-C];C++);return uu=O.slice(l,1<C?1-C:void 0)}function Bl(l){var f=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&f===13&&(l=13)):l=f,l===10&&(l=13),32<=l||l===13?l:0}function Mc(){return!0}function ld(){return!1}function ja(l){function f(v,C,O,U,ae){this._reactName=v,this._targetInst=O,this.type=C,this.nativeEvent=U,this.target=ae,this.currentTarget=null;for(var De in l)l.hasOwnProperty(De)&&(v=l[De],this[De]=v?v(U):U[De]);return this.isDefaultPrevented=(U.defaultPrevented!=null?U.defaultPrevented:U.returnValue===!1)?Mc:ld,this.isPropagationStopped=ld,this}return zt(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var v=this.nativeEvent;v&&(v.preventDefault?v.preventDefault():typeof v.returnValue!="unknown"&&(v.returnValue=!1),this.isDefaultPrevented=Mc)},stopPropagation:function(){var v=this.nativeEvent;v&&(v.stopPropagation?v.stopPropagation():typeof v.cancelBubble!="unknown"&&(v.cancelBubble=!0),this.isPropagationStopped=Mc)},persist:function(){},isPersistent:Mc}),f}var no={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cd=ja(no),hu=zt({},no,{view:0,detail:0}),hh=ja(hu),dh,so,Fl,du=zt({},hu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:bo,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==Fl&&(Fl&&l.type==="mousemove"?(dh=l.screenX-Fl.screenX,so=l.screenY-Fl.screenY):so=dh=0,Fl=l),dh)},movementY:function(l){return"movementY"in l?l.movementY:so}}),Za=ja(du),fu=zt({},du,{dataTransfer:0}),ao=ja(fu),Tp=zt({},hu,{relatedTarget:0}),fh=ja(Tp),Sp=zt({},no,{animationName:0,elapsedTime:0,pseudoElement:0}),$r=ja(Sp),Ep=zt({},no,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),jm=ja(Ep),mf=zt({},no,{data:0}),Li=ja(mf),Ap={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},oo={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Fo={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gf(l){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(l):(l=Fo[l])?!!f[l]:!1}function bo(){return gf}var yi=zt({},hu,{key:function(l){if(l.key){var f=Ap[l.key]||l.key;if(f!=="Unidentified")return f}return l.type==="keypress"?(l=Bl(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?oo[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:bo,charCode:function(l){return l.type==="keypress"?Bl(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?Bl(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),Zr=ja(yi),Kr=zt({},du,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Na=ja(Kr),pu=zt({},hu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:bo}),qr=ja(pu),_f=zt({},no,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ic=ja(_f),ud=zt({},du,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),la=ja(ud),ls=zt({},no,{newState:0,oldState:0}),Xg=ja(ls),hd=[9,13,27,32],dd=wi&&"CompositionEvent"in window,Ul=null;wi&&"documentMode"in document&&(Ul=document.documentMode);var fd=wi&&"TextEvent"in window&&!Ul,Vl=wi&&(!dd||Ul&&8<Ul&&11>=Ul),pd=" ",ca=!1;function wo(l,f){switch(l){case"keyup":return hd.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Sa(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var mu=!1;function ph(l,f){switch(l){case"compositionend":return Sa(f);case"keypress":return f.which!==32?null:(ca=!0,pd);case"textInput":return l=f.data,l===pd&&ca?null:l;default:return null}}function vs(l,f){if(mu)return l==="compositionend"||!dd&&wo(l,f)?(l=kl(),uu=pf=Nl=null,mu=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return Vl&&f.locale!=="ko"?null:f.data;default:return null}}var ka={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ir(l){var f=l&&l.nodeName&&l.nodeName.toLowerCase();return f==="input"?!!ka[l.type]:f==="textarea"}function ni(l,f,v,C){Cc?jl?jl.push(C):jl=[C]:Cc=C,f=ng(f,"onChange"),0<f.length&&(v=new cd("onChange","change",null,v,C),l.push({event:v,listeners:f}))}var Hl=null,Ii=null;function gu(l){i_(l,0)}function ql(l){var f=ur(l);if(lh(f))return l}function ki(l,f){if(l==="change")return f}var yf=!1;if(wi){var _u;if(wi){var yu="oninput"in document;if(!yu){var xf=document.createElement("div");xf.setAttribute("oninput","return;"),yu=typeof xf.oninput=="function"}_u=yu}else _u=!1;yf=_u&&(!document.documentMode||9<document.documentMode)}function md(){Hl&&(Hl.detachEvent("onpropertychange",Qn),Ii=Hl=null)}function Qn(l){if(l.propertyName==="value"&&ql(Ii)){var f=[];ni(f,Ii,l,Oa(l)),ff(gu,f)}}function Cp(l,f,v){l==="focusin"?(md(),Hl=f,Ii=v,Hl.attachEvent("onpropertychange",Qn)):l==="focusout"&&md()}function Gl(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return ql(Ii)}function Ea(l,f){if(l==="click")return ql(f)}function zc(l,f){if(l==="input"||l==="change")return ql(f)}function qs(l,f){return l===f&&(l!==0||1/l===1/f)||l!==l&&f!==f}var Wa=typeof Object.is=="function"?Object.is:qs;function $l(l,f){if(Wa(l,f))return!0;if(typeof l!="object"||l===null||typeof f!="object"||f===null)return!1;var v=Object.keys(l),C=Object.keys(f);if(v.length!==C.length)return!1;for(C=0;C<v.length;C++){var O=v[C];if(!Br.call(f,O)||!Wa(l[O],f[O]))return!1}return!0}function Nm(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function gd(l,f){var v=Nm(l);l=0;for(var C;v;){if(v.nodeType===3){if(C=l+v.textContent.length,l<=f&&C>=f)return{node:v,offset:f-l};l=C}e:{for(;v;){if(v.nextSibling){v=v.nextSibling;break e}v=v.parentNode}v=void 0}v=Nm(v)}}function xu(l,f){return l&&f?l===f?!0:l&&l.nodeType===3?!1:f&&f.nodeType===3?xu(l,f.parentNode):"contains"in l?l.contains(f):l.compareDocumentPosition?!!(l.compareDocumentPosition(f)&16):!1:!1}function To(l){l=l!=null&&l.ownerDocument!=null&&l.ownerDocument.defaultView!=null?l.ownerDocument.defaultView:window;for(var f=Bo(l.document);f instanceof l.HTMLIFrameElement;){try{var v=typeof f.contentWindow.location.href=="string"}catch{v=!1}if(v)l=f.contentWindow;else break;f=Bo(l.document)}return f}function Rp(l){var f=l&&l.nodeName&&l.nodeName.toLowerCase();return f&&(f==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||f==="textarea"||l.contentEditable==="true")}function mh(l,f){var v=To(f);f=l.focusedElem;var C=l.selectionRange;if(v!==f&&f&&f.ownerDocument&&xu(f.ownerDocument.documentElement,f)){if(C!==null&&Rp(f)){if(l=C.start,v=C.end,v===void 0&&(v=l),"selectionStart"in f)f.selectionStart=l,f.selectionEnd=Math.min(v,f.value.length);else if(v=(l=f.ownerDocument||document)&&l.defaultView||window,v.getSelection){v=v.getSelection();var O=f.textContent.length,U=Math.min(C.start,O);C=C.end===void 0?U:Math.min(C.end,O),!v.extend&&U>C&&(O=C,C=U,U=O),O=gd(f,U);var ae=gd(f,C);O&&ae&&(v.rangeCount!==1||v.anchorNode!==O.node||v.anchorOffset!==O.offset||v.focusNode!==ae.node||v.focusOffset!==ae.offset)&&(l=l.createRange(),l.setStart(O.node,O.offset),v.removeAllRanges(),U>C?(v.addRange(l),v.extend(ae.node,ae.offset)):(l.setEnd(ae.node,ae.offset),v.addRange(l)))}}for(l=[],v=f;v=v.parentNode;)v.nodeType===1&&l.push({element:v,left:v.scrollLeft,top:v.scrollTop});for(typeof f.focus=="function"&&f.focus(),f=0;f<l.length;f++)v=l[f],v.element.scrollLeft=v.left,v.element.scrollTop=v.top}}var km=wi&&"documentMode"in document&&11>=document.documentMode,Zl=null,gh=null,So=null,Wl=!1;function Bm(l,f,v){var C=v.window===v?v.document:v.nodeType===9?v:v.ownerDocument;Wl||Zl==null||Zl!==Bo(C)||(C=Zl,"selectionStart"in C&&Rp(C)?C={start:C.selectionStart,end:C.selectionEnd}:(C=(C.ownerDocument&&C.ownerDocument.defaultView||window).getSelection(),C={anchorNode:C.anchorNode,anchorOffset:C.anchorOffset,focusNode:C.focusNode,focusOffset:C.focusOffset}),So&&$l(So,C)||(So=C,C=ng(gh,"onSelect"),0<C.length&&(f=new cd("onSelect","select",null,f,v),l.push({event:f,listeners:C}),f.target=Zl)))}function vu(l,f){var v={};return v[l.toLowerCase()]=f.toLowerCase(),v["Webkit"+l]="webkit"+f,v["Moz"+l]="moz"+f,v}var Xl={animationend:vu("Animation","AnimationEnd"),animationiteration:vu("Animation","AnimationIteration"),animationstart:vu("Animation","AnimationStart"),transitionrun:vu("Transition","TransitionRun"),transitionstart:vu("Transition","TransitionStart"),transitioncancel:vu("Transition","TransitionCancel"),transitionend:vu("Transition","TransitionEnd")},vf={},_d={};wi&&(_d=document.createElement("div").style,"AnimationEvent"in window||(delete Xl.animationend.animation,delete Xl.animationiteration.animation,delete Xl.animationstart.animation),"TransitionEvent"in window||delete Xl.transitionend.transition);function Xs(l){if(vf[l])return vf[l];if(!Xl[l])return l;var f=Xl[l],v;for(v in f)if(f.hasOwnProperty(v)&&v in _d)return vf[l]=f[v];return l}var Mp=Xs("animationend"),Ip=Xs("animationiteration"),zp=Xs("animationstart"),bu=Xs("transitionrun"),yd=Xs("transitionstart"),Lp=Xs("transitioncancel"),bf=Xs("transitionend"),wu=new Map,Tu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function lo(l,f){wu.set(l,f),Ft(f,[l])}var Ba=[],Ys=0,_h=0;function Vt(){for(var l=Ys,f=_h=Ys=0;f<l;){var v=Ba[f];Ba[f++]=null;var C=Ba[f];Ba[f++]=null;var O=Ba[f];Ba[f++]=null;var U=Ba[f];if(Ba[f++]=null,C!==null&&O!==null){var ae=C.pending;ae===null?O.next=O:(O.next=ae.next,ae.next=O),C.pending=O}U!==0&&xh(v,O,U)}}function yh(l,f,v,C){Ba[Ys++]=l,Ba[Ys++]=f,Ba[Ys++]=v,Ba[Ys++]=C,_h|=C,l.lanes|=C,l=l.alternate,l!==null&&(l.lanes|=C)}function Lc(l,f,v,C){return yh(l,f,v,C),Dc(l)}function co(l,f){return yh(l,null,null,f),Dc(l)}function xh(l,f,v){l.lanes|=v;var C=l.alternate;C!==null&&(C.lanes|=v);for(var O=!1,U=l.return;U!==null;)U.childLanes|=v,C=U.alternate,C!==null&&(C.childLanes|=v),U.tag===22&&(l=U.stateNode,l===null||l._visibility&1||(O=!0)),l=U,U=U.return;O&&f!==null&&l.tag===3&&(U=l.stateNode,O=31-os(v),U=U.hiddenUpdates,l=U[O],l===null?U[O]=[f]:l.push(f),f.lane=v|536870912)}function Dc(l){if(50<Ji)throw Ji=0,Di=null,Error(S(185));for(var f=l.return;f!==null;)l=f,f=l.return;return l.tag===3?l.stateNode:null}var Fa={},xd=new WeakMap;function ms(l,f){if(typeof l=="object"&&l!==null){var v=xd.get(l);return v!==void 0?v:(f={value:l,source:f,stack:ji(f)},xd.set(l,f),f)}return{value:l,source:f,stack:ji(f)}}var mr=[],Uo=0,wf=null,Tf=0,Ua=[],Eo=0,cn=null,hl=1,Vo="";function Su(l,f){mr[Uo++]=Tf,mr[Uo++]=wf,wf=l,Tf=f}function Fm(l,f,v){Ua[Eo++]=hl,Ua[Eo++]=Vo,Ua[Eo++]=cn,cn=l;var C=hl;l=Vo;var O=32-os(C)-1;C&=~(1<<O),v+=1;var U=32-os(f)+O;if(30<U){var ae=O-O%5;U=(C&(1<<ae)-1).toString(32),C>>=ae,O-=ae,hl=1<<32-os(f)+O|v<<O|C,Vo=U+l}else hl=1<<U|v<<O|C,Vo=l}function Dp(l){l.return!==null&&(Su(l,1),Fm(l,1,0))}function Pp(l){for(;l===wf;)wf=mr[--Uo],mr[Uo]=null,Tf=mr[--Uo],mr[Uo]=null;for(;l===cn;)cn=Ua[--Eo],Ua[Eo]=null,Vo=Ua[--Eo],Ua[Eo]=null,hl=Ua[--Eo],Ua[Eo]=null}var Aa=null,ua=null,En=!1,Ho=null,qo=!1,vd=Error(S(519));function dl(l){var f=Error(S(418,""));throw jc(ms(f,l)),vd}function Sf(l){var f=l.stateNode,v=l.type,C=l.memoizedProps;switch(f[Be]=l,f[Je]=C,v){case"dialog":Ln("cancel",f),Ln("close",f);break;case"iframe":case"object":case"embed":Ln("load",f);break;case"video":case"audio":for(v=0;v<Yf.length;v++)Ln(Yf[v],f);break;case"source":Ln("error",f);break;case"img":case"image":case"link":Ln("error",f),Ln("load",f);break;case"details":Ln("toggle",f);break;case"input":Ln("invalid",f),hf(f,C.value,C.defaultValue,C.checked,C.defaultChecked,C.type,C.name,!0),wc(f);break;case"select":Ln("invalid",f);break;case"textarea":Ln("invalid",f),cl(f,C.value,C.defaultValue,C.children),wc(f)}v=C.children,typeof v!="string"&&typeof v!="number"&&typeof v!="bigint"||f.textContent===""+v||C.suppressHydrationWarning===!0||l_(f.textContent,v)?(C.popover!=null&&(Ln("beforetoggle",f),Ln("toggle",f)),C.onScroll!=null&&Ln("scroll",f),C.onScrollEnd!=null&&Ln("scrollend",f),C.onClick!=null&&(f.onclick=sm),f=!0):f=!1,f||dl(l)}function Pc(l){for(Aa=l.return;Aa;)switch(Aa.tag){case 3:case 27:qo=!0;return;case 5:case 13:qo=!1;return;default:Aa=Aa.return}}function fl(l){if(l!==Aa)return!1;if(!En)return Pc(l),En=!0,!1;var f=!1,v;if((v=l.tag!==3&&l.tag!==27)&&((v=l.tag===5)&&(v=l.type,v=!(v!=="form"&&v!=="button")||c_(l.type,l.memoizedProps)),v=!v),v&&(f=!0),f&&ua&&dl(l),Pc(l),l.tag===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(S(317));e:{for(l=l.nextSibling,f=0;l;){if(l.nodeType===8)if(v=l.data,v==="/$"){if(f===0){ua=sl(l.nextSibling);break e}f--}else v!=="$"&&v!=="$!"&&v!=="$?"||f++;l=l.nextSibling}ua=null}}else ua=Aa?sl(l.stateNode.nextSibling):null;return!0}function Oc(){ua=Aa=null,En=!1}function jc(l){Ho===null?Ho=[l]:Ho.push(l)}var pl=Error(S(460)),Op=Error(S(474)),bd={then:function(){}};function jp(l){return l=l.status,l==="fulfilled"||l==="rejected"}function Yl(){}function wd(l,f,v){switch(v=l[v],v===void 0?l.push(f):v!==f&&(f.then(Yl,Yl),f=v),f.status){case"fulfilled":return f.value;case"rejected":throw l=f.reason,l===pl?Error(S(483)):l;default:if(typeof f.status=="string")f.then(Yl,Yl);else{if(l=nt,l!==null&&100<l.shellSuspendCounter)throw Error(S(482));l=f,l.status="pending",l.then(function(C){if(f.status==="pending"){var O=f;O.status="fulfilled",O.value=C}},function(C){if(f.status==="pending"){var O=f;O.status="rejected",O.reason=C}})}switch(f.status){case"fulfilled":return f.value;case"rejected":throw l=f.reason,l===pl?Error(S(483)):l}throw Nc=f,pl}}var Nc=null;function Ef(){if(Nc===null)throw Error(S(459));var l=Nc;return Nc=null,l}var Kl=null,Jl=0;function Td(l){var f=Jl;return Jl+=1,Kl===null&&(Kl=[]),wd(Kl,l,f)}function vh(l,f){f=f.props.ref,l.ref=f!==void 0?f:null}function Sd(l,f){throw f.$$typeof===N?Error(S(525)):(l=Object.prototype.toString.call(f),Error(S(31,l==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":l)))}function Ql(l){var f=l._init;return f(l._payload)}function Np(l){function f(Mt,pt){if(l){var Pt=Mt.deletions;Pt===null?(Mt.deletions=[pt],Mt.flags|=16):Pt.push(pt)}}function v(Mt,pt){if(!l)return null;for(;pt!==null;)f(Mt,pt),pt=pt.sibling;return null}function C(Mt){for(var pt=new Map;Mt!==null;)Mt.key!==null?pt.set(Mt.key,Mt):pt.set(Mt.index,Mt),Mt=Mt.sibling;return pt}function O(Mt,pt){return Mt=X(Mt,pt),Mt.index=0,Mt.sibling=null,Mt}function U(Mt,pt,Pt){return Mt.index=Pt,l?(Pt=Mt.alternate,Pt!==null?(Pt=Pt.index,Pt<pt?(Mt.flags|=33554434,pt):Pt):(Mt.flags|=33554434,pt)):(Mt.flags|=1048576,pt)}function ae(Mt){return l&&Mt.alternate===null&&(Mt.flags|=33554434),Mt}function De(Mt,pt,Pt,di){return pt===null||pt.tag!==6?(pt=we(Pt,Mt.mode,di),pt.return=Mt,pt):(pt=O(pt,Pt),pt.return=Mt,pt)}function Xe(Mt,pt,Pt,di){var hr=Pt.type;return hr===q?ai(Mt,pt,Pt.props.children,di,Pt.key):pt!==null&&(pt.elementType===hr||typeof hr=="object"&&hr!==null&&hr.$$typeof===ye&&Ql(hr)===pt.type)?(pt=O(pt,Pt.props),vh(pt,Pt),pt.return=Mt,pt):(pt=ce(Pt.type,Pt.key,Pt.props,null,Mt.mode,di),vh(pt,Pt),pt.return=Mt,pt)}function mt(Mt,pt,Pt,di){return pt===null||pt.tag!==4||pt.stateNode.containerInfo!==Pt.containerInfo||pt.stateNode.implementation!==Pt.implementation?(pt=Ee(Pt,Mt.mode,di),pt.return=Mt,pt):(pt=O(pt,Pt.children||[]),pt.return=Mt,pt)}function ai(Mt,pt,Pt,di,hr){return pt===null||pt.tag!==7?(pt=fe(Pt,Mt.mode,di,hr),pt.return=Mt,pt):(pt=O(pt,Pt),pt.return=Mt,pt)}function xi(Mt,pt,Pt){if(typeof pt=="string"&&pt!==""||typeof pt=="number"||typeof pt=="bigint")return pt=we(""+pt,Mt.mode,Pt),pt.return=Mt,pt;if(typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case V:return Pt=ce(pt.type,pt.key,pt.props,null,Mt.mode,Pt),vh(Pt,pt),Pt.return=Mt,Pt;case s:return pt=Ee(pt,Mt.mode,Pt),pt.return=Mt,pt;case ye:var di=pt._init;return pt=di(pt._payload),xi(Mt,pt,Pt)}if(Ui(pt)||Ke(pt))return pt=fe(pt,Mt.mode,Pt,null),pt.return=Mt,pt;if(typeof pt.then=="function")return xi(Mt,Td(pt),Pt);if(pt.$$typeof===ze)return xi(Mt,uc(Mt,pt),Pt);Sd(Mt,pt)}return null}function Ut(Mt,pt,Pt,di){var hr=pt!==null?pt.key:null;if(typeof Pt=="string"&&Pt!==""||typeof Pt=="number"||typeof Pt=="bigint")return hr!==null?null:De(Mt,pt,""+Pt,di);if(typeof Pt=="object"&&Pt!==null){switch(Pt.$$typeof){case V:return Pt.key===hr?Xe(Mt,pt,Pt,di):null;case s:return Pt.key===hr?mt(Mt,pt,Pt,di):null;case ye:return hr=Pt._init,Pt=hr(Pt._payload),Ut(Mt,pt,Pt,di)}if(Ui(Pt)||Ke(Pt))return hr!==null?null:ai(Mt,pt,Pt,di,null);if(typeof Pt.then=="function")return Ut(Mt,pt,Td(Pt),di);if(Pt.$$typeof===ze)return Ut(Mt,pt,uc(Mt,Pt),di);Sd(Mt,Pt)}return null}function ri(Mt,pt,Pt,di,hr){if(typeof di=="string"&&di!==""||typeof di=="number"||typeof di=="bigint")return Mt=Mt.get(Pt)||null,De(pt,Mt,""+di,hr);if(typeof di=="object"&&di!==null){switch(di.$$typeof){case V:return Mt=Mt.get(di.key===null?Pt:di.key)||null,Xe(pt,Mt,di,hr);case s:return Mt=Mt.get(di.key===null?Pt:di.key)||null,mt(pt,Mt,di,hr);case ye:var bn=di._init;return di=bn(di._payload),ri(Mt,pt,Pt,di,hr)}if(Ui(di)||Ke(di))return Mt=Mt.get(Pt)||null,ai(pt,Mt,di,hr,null);if(typeof di.then=="function")return ri(Mt,pt,Pt,Td(di),hr);if(di.$$typeof===ze)return ri(Mt,pt,Pt,uc(pt,di),hr);Sd(pt,di)}return null}function vr(Mt,pt,Pt,di){for(var hr=null,bn=null,Ir=pt,Fr=pt=0,ks=null;Ir!==null&&Fr<Pt.length;Fr++){Ir.index>Fr?(ks=Ir,Ir=null):ks=Ir.sibling;var Nn=Ut(Mt,Ir,Pt[Fr],di);if(Nn===null){Ir===null&&(Ir=ks);break}l&&Ir&&Nn.alternate===null&&f(Mt,Ir),pt=U(Nn,pt,Fr),bn===null?hr=Nn:bn.sibling=Nn,bn=Nn,Ir=ks}if(Fr===Pt.length)return v(Mt,Ir),En&&Su(Mt,Fr),hr;if(Ir===null){for(;Fr<Pt.length;Fr++)Ir=xi(Mt,Pt[Fr],di),Ir!==null&&(pt=U(Ir,pt,Fr),bn===null?hr=Ir:bn.sibling=Ir,bn=Ir);return En&&Su(Mt,Fr),hr}for(Ir=C(Ir);Fr<Pt.length;Fr++)ks=ri(Ir,Mt,Fr,Pt[Fr],di),ks!==null&&(l&&ks.alternate!==null&&Ir.delete(ks.key===null?Fr:ks.key),pt=U(ks,pt,Fr),bn===null?hr=ks:bn.sibling=ks,bn=ks);return l&&Ir.forEach(function(Do){return f(Mt,Do)}),En&&Su(Mt,Fr),hr}function Qr(Mt,pt,Pt,di){if(Pt==null)throw Error(S(151));for(var hr=null,bn=null,Ir=pt,Fr=pt=0,ks=null,Nn=Pt.next();Ir!==null&&!Nn.done;Fr++,Nn=Pt.next()){Ir.index>Fr?(ks=Ir,Ir=null):ks=Ir.sibling;var Do=Ut(Mt,Ir,Nn.value,di);if(Do===null){Ir===null&&(Ir=ks);break}l&&Ir&&Do.alternate===null&&f(Mt,Ir),pt=U(Do,pt,Fr),bn===null?hr=Do:bn.sibling=Do,bn=Do,Ir=ks}if(Nn.done)return v(Mt,Ir),En&&Su(Mt,Fr),hr;if(Ir===null){for(;!Nn.done;Fr++,Nn=Pt.next())Nn=xi(Mt,Nn.value,di),Nn!==null&&(pt=U(Nn,pt,Fr),bn===null?hr=Nn:bn.sibling=Nn,bn=Nn);return En&&Su(Mt,Fr),hr}for(Ir=C(Ir);!Nn.done;Fr++,Nn=Pt.next())Nn=ri(Ir,Mt,Fr,Nn.value,di),Nn!==null&&(l&&Nn.alternate!==null&&Ir.delete(Nn.key===null?Fr:Nn.key),pt=U(Nn,pt,Fr),bn===null?hr=Nn:bn.sibling=Nn,bn=Nn);return l&&Ir.forEach(function(lp){return f(Mt,lp)}),En&&Su(Mt,Fr),hr}function _s(Mt,pt,Pt,di){if(typeof Pt=="object"&&Pt!==null&&Pt.type===q&&Pt.key===null&&(Pt=Pt.props.children),typeof Pt=="object"&&Pt!==null){switch(Pt.$$typeof){case V:e:{for(var hr=Pt.key;pt!==null;){if(pt.key===hr){if(hr=Pt.type,hr===q){if(pt.tag===7){v(Mt,pt.sibling),di=O(pt,Pt.props.children),di.return=Mt,Mt=di;break e}}else if(pt.elementType===hr||typeof hr=="object"&&hr!==null&&hr.$$typeof===ye&&Ql(hr)===pt.type){v(Mt,pt.sibling),di=O(pt,Pt.props),vh(di,Pt),di.return=Mt,Mt=di;break e}v(Mt,pt);break}else f(Mt,pt);pt=pt.sibling}Pt.type===q?(di=fe(Pt.props.children,Mt.mode,di,Pt.key),di.return=Mt,Mt=di):(di=ce(Pt.type,Pt.key,Pt.props,null,Mt.mode,di),vh(di,Pt),di.return=Mt,Mt=di)}return ae(Mt);case s:e:{for(hr=Pt.key;pt!==null;){if(pt.key===hr)if(pt.tag===4&&pt.stateNode.containerInfo===Pt.containerInfo&&pt.stateNode.implementation===Pt.implementation){v(Mt,pt.sibling),di=O(pt,Pt.children||[]),di.return=Mt,Mt=di;break e}else{v(Mt,pt);break}else f(Mt,pt);pt=pt.sibling}di=Ee(Pt,Mt.mode,di),di.return=Mt,Mt=di}return ae(Mt);case ye:return hr=Pt._init,Pt=hr(Pt._payload),_s(Mt,pt,Pt,di)}if(Ui(Pt))return vr(Mt,pt,Pt,di);if(Ke(Pt)){if(hr=Ke(Pt),typeof hr!="function")throw Error(S(150));return Pt=hr.call(Pt),Qr(Mt,pt,Pt,di)}if(typeof Pt.then=="function")return _s(Mt,pt,Td(Pt),di);if(Pt.$$typeof===ze)return _s(Mt,pt,uc(Mt,Pt),di);Sd(Mt,Pt)}return typeof Pt=="string"&&Pt!==""||typeof Pt=="number"||typeof Pt=="bigint"?(Pt=""+Pt,pt!==null&&pt.tag===6?(v(Mt,pt.sibling),di=O(pt,Pt),di.return=Mt,Mt=di):(v(Mt,pt),di=we(Pt,Mt.mode,di),di.return=Mt,Mt=di),ae(Mt)):v(Mt,pt)}return function(Mt,pt,Pt,di){try{Jl=0;var hr=_s(Mt,pt,Pt,di);return Kl=null,hr}catch(Ir){if(Ir===pl)throw Ir;var bn=G(29,Ir,null,Mt.mode);return bn.lanes=di,bn.return=Mt,bn}finally{}}}var kc=Np(!0),Um=Np(!1),bh=Ai(null),wh=Ai(0);function Ed(l,f){l=li,Tt(wh,l),Tt(bh,f),li=l|f.baseLanes}function Th(){Tt(wh,li),Tt(bh,bh.current)}function ml(){li=wh.current,gt(bh),gt(wh)}var Xa=Ai(null),Ao=null;function Bc(l){var f=l.alternate;Tt(kn,kn.current&1),Tt(Xa,l),Ao===null&&(f===null||bh.current!==null||f.memoizedState!==null)&&(Ao=l)}function Fc(l){if(l.tag===22){if(Tt(kn,kn.current),Tt(Xa,l),Ao===null){var f=l.alternate;f!==null&&f.memoizedState!==null&&(Ao=l)}}else Ya()}function Ya(){Tt(kn,kn.current),Tt(Xa,Xa.current)}function gl(l){gt(Xa),Ao===l&&(Ao=null),gt(kn)}var kn=Ai(0);function Eu(l){for(var f=l;f!==null;){if(f.tag===13){var v=f.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||v.data==="$?"||v.data==="$!"))return f}else if(f.tag===19&&f.memoizedProps.revealOrder!==void 0){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}var Ad=typeof AbortController<"u"?AbortController:function(){var l=[],f=this.signal={aborted:!1,addEventListener:function(v,C){l.push(C)}};this.abort=function(){f.aborted=!0,l.forEach(function(v){return v()})}},Af=h.unstable_scheduleCallback,kp=h.unstable_NormalPriority,Is={$$typeof:ze,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Sh(){return{controller:new Ad,data:new Map,refCount:0}}function ec(l){l.refCount--,l.refCount===0&&Af(kp,function(){l.controller.abort()})}var _l=null,Cd=0,yl=0,Uc=null;function Vm(l,f){if(_l===null){var v=_l=[];Cd=0,yl=Xf(),Uc={status:"pending",value:void 0,then:function(C){v.push(C)}}}return Cd++,f.then(Cf,Cf),f}function Cf(){if(--Cd===0&&_l!==null){Uc!==null&&(Uc.status="fulfilled");var l=_l;_l=null,yl=0,Uc=null;for(var f=0;f<l.length;f++)(0,l[f])()}}function Au(l,f){var v=[],C={status:"pending",value:null,reason:null,then:function(O){v.push(O)}};return l.then(function(){C.status="fulfilled",C.value=f;for(var O=0;O<v.length;O++)(0,v[O])(f)},function(O){for(C.status="rejected",C.reason=O,O=0;O<v.length;O++)(0,v[O])(void 0)}),C}var Hm=lt.S;lt.S=function(l,f){typeof f=="object"&&f!==null&&typeof f.then=="function"&&Vm(l,f),Hm!==null&&Hm(l,f)};var Cu=Ai(null);function Bp(){var l=Cu.current;return l!==null?l:nt.pooledCache}function Ru(l,f){f===null?Tt(Cu,Cu.current):Tt(Cu,f.pool)}function qm(){var l=Bp();return l===null?null:{parent:Is._currentValue,pool:l}}var Vc=0,rn=null,Vn=null,bs=null,tc=!1,Mu=!1,ic=!1,Eh=0,Hc=0,Co=null,Iu=0;function Kn(){throw Error(S(321))}function Rd(l,f){if(f===null)return!1;for(var v=0;v<f.length&&v<l.length;v++)if(!Wa(l[v],f[v]))return!1;return!0}function Ah(l,f,v,C,O,U){return Vc=U,rn=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,lt.H=l===null||l.memoizedState===null?da:ho,ic=!1,U=v(C,O),ic=!1,Mu&&(U=Mf(f,v,C,O)),Rf(l),U}function Rf(l){lt.H=Xo;var f=Vn!==null&&Vn.next!==null;if(Vc=0,bs=Vn=rn=null,tc=!1,Hc=0,Co=null,f)throw Error(S(300));l===null||gs||(l=l.dependencies,l!==null&&Bu(l)&&(gs=!0))}function Mf(l,f,v,C){rn=l;var O=0;do{if(Mu&&(Co=null),Hc=0,Mu=!1,25<=O)throw Error(S(301));if(O+=1,bs=Vn=null,l.updateQueue!=null){var U=l.updateQueue;U.lastEffect=null,U.events=null,U.stores=null,U.memoCache!=null&&(U.memoCache.index=0)}lt.H=Wc,U=f(v,C)}while(Mu);return U}function If(){var l=lt.H,f=l.useState()[0];return f=typeof f.then=="function"?Mh(f):f,l=l.useState()[0],(Vn!==null?Vn.memoizedState:null)!==l&&(rn.flags|=1024),f}function Ch(){var l=Eh!==0;return Eh=0,l}function Md(l,f,v){f.updateQueue=l.updateQueue,f.flags&=-2053,l.lanes&=~v}function Rh(l){if(tc){for(l=l.memoizedState;l!==null;){var f=l.queue;f!==null&&(f.pending=null),l=l.next}tc=!1}Vc=0,bs=Vn=rn=null,Mu=!1,Hc=Eh=0,Co=null}function Gs(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bs===null?rn.memoizedState=bs=l:bs=bs.next=l,bs}function Os(){if(Vn===null){var l=rn.alternate;l=l!==null?l.memoizedState:null}else l=Vn.next;var f=bs===null?rn.memoizedState:bs.next;if(f!==null)bs=f,Vn=l;else{if(l===null)throw rn.alternate===null?Error(S(467)):Error(S(310));Vn=l,l={memoizedState:Vn.memoizedState,baseState:Vn.baseState,baseQueue:Vn.baseQueue,queue:Vn.queue,next:null},bs===null?rn.memoizedState=bs=l:bs=bs.next=l}return bs}var Go;Go=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function Mh(l){var f=Hc;return Hc+=1,Co===null&&(Co=[]),l=wd(Co,l,f),f=rn,(bs===null?f.memoizedState:bs.next)===null&&(f=f.alternate,lt.H=f===null||f.memoizedState===null?da:ho),l}function zf(l){if(l!==null&&typeof l=="object"){if(typeof l.then=="function")return Mh(l);if(l.$$typeof===ze)return Js(l)}throw Error(S(438,String(l)))}function Ih(l){var f=null,v=rn.updateQueue;if(v!==null&&(f=v.memoCache),f==null){var C=rn.alternate;C!==null&&(C=C.updateQueue,C!==null&&(C=C.memoCache,C!=null&&(f={data:C.data.map(function(O){return O.slice()}),index:0})))}if(f==null&&(f={data:[],index:0}),v===null&&(v=Go(),rn.updateQueue=v),v.memoCache=f,v=f.data[f.index],v===void 0)for(v=f.data[f.index]=Array(l),C=0;C<l;C++)v[C]=Le;return f.index++,v}function $o(l,f){return typeof f=="function"?f(l):f}function uo(l){var f=Os();return zu(f,Vn,l)}function zu(l,f,v){var C=l.queue;if(C===null)throw Error(S(311));C.lastRenderedReducer=v;var O=l.baseQueue,U=C.pending;if(U!==null){if(O!==null){var ae=O.next;O.next=U.next,U.next=ae}f.baseQueue=O=U,C.pending=null}if(U=l.baseState,O===null)l.memoizedState=U;else{f=O.next;var De=ae=null,Xe=null,mt=f,ai=!1;do{var xi=mt.lane&-536870913;if(xi!==mt.lane?(ut&xi)===xi:(Vc&xi)===xi){var Ut=mt.revertLane;if(Ut===0)Xe!==null&&(Xe=Xe.next={lane:0,revertLane:0,action:mt.action,hasEagerState:mt.hasEagerState,eagerState:mt.eagerState,next:null}),xi===yl&&(ai=!0);else if((Vc&Ut)===Ut){mt=mt.next,Ut===yl&&(ai=!0);continue}else xi={lane:0,revertLane:mt.revertLane,action:mt.action,hasEagerState:mt.hasEagerState,eagerState:mt.eagerState,next:null},Xe===null?(De=Xe=xi,ae=U):Xe=Xe.next=xi,rn.lanes|=Ut,ci|=Ut;xi=mt.action,ic&&v(U,xi),U=mt.hasEagerState?mt.eagerState:v(U,xi)}else Ut={lane:xi,revertLane:mt.revertLane,action:mt.action,hasEagerState:mt.hasEagerState,eagerState:mt.eagerState,next:null},Xe===null?(De=Xe=Ut,ae=U):Xe=Xe.next=Ut,rn.lanes|=xi,ci|=xi;mt=mt.next}while(mt!==null&&mt!==f);if(Xe===null?ae=U:Xe.next=De,!Wa(U,l.memoizedState)&&(gs=!0,ai&&(v=Uc,v!==null)))throw v;l.memoizedState=U,l.baseState=ae,l.baseQueue=Xe,C.lastRenderedState=U}return O===null&&(C.lanes=0),[l.memoizedState,C.dispatch]}function xl(l){var f=Os(),v=f.queue;if(v===null)throw Error(S(311));v.lastRenderedReducer=l;var C=v.dispatch,O=v.pending,U=f.memoizedState;if(O!==null){v.pending=null;var ae=O=O.next;do U=l(U,ae.action),ae=ae.next;while(ae!==O);Wa(U,f.memoizedState)||(gs=!0),f.memoizedState=U,f.baseQueue===null&&(f.baseState=U),v.lastRenderedState=U}return[U,C]}function Lf(l,f,v){var C=rn,O=Os(),U=En;if(U){if(v===void 0)throw Error(S(407));v=v()}else v=f();var ae=!Wa((Vn||O).memoizedState,v);if(ae&&(O.memoizedState=v,gs=!0),O=O.queue,Ks(zh.bind(null,C,O,l),[l]),O.getSnapshot!==f||ae||bs!==null&&bs.memoizedState.tag&1){if(C.flags|=2048,Du(9,zd.bind(null,C,O,v,f),{destroy:void 0},null),nt===null)throw Error(S(349));U||(Vc&60)!==0||Id(C,f,v)}return v}function Id(l,f,v){l.flags|=16384,l={getSnapshot:f,value:v},f=rn.updateQueue,f===null?(f=Go(),rn.updateQueue=f,f.stores=[l]):(v=f.stores,v===null?f.stores=[l]:v.push(l))}function zd(l,f,v,C){f.value=v,f.getSnapshot=C,Ld(f)&&Fp(l)}function zh(l,f,v){return v(function(){Ld(f)&&Fp(l)})}function Ld(l){var f=l.getSnapshot;l=l.value;try{var v=f();return!Wa(l,v)}catch{return!0}}function Fp(l){var f=co(l,2);f!==null&&Vr(f,l,2)}function rc(l){var f=Gs();if(typeof l=="function"){var v=l;if(l=v(),ic){Ms(!0);try{v()}finally{Ms(!1)}}}return f.memoizedState=f.baseState=l,f.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$o,lastRenderedState:l},f}function Lu(l,f,v,C){return l.baseState=v,zu(l,Vn,typeof C=="function"?C:$o)}function si(l,f,v,C,O){if(wl(l))throw Error(S(485));if(l=f.action,l!==null){var U={payload:O,action:l,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ae){U.listeners.push(ae)}};lt.T!==null?v(!0):U.isTransition=!1,C(U),v=f.pending,v===null?(U.next=f.pending=U,Df(f,U)):(U.next=v.next,f.pending=v.next=U)}}function Df(l,f){var v=f.action,C=f.payload,O=l.state;if(f.isTransition){var U=lt.T,ae={};lt.T=ae;try{var De=v(O,C),Xe=lt.S;Xe!==null&&Xe(ae,De),vl(l,f,De)}catch(mt){bl(l,f,mt)}finally{lt.T=U}}else try{U=v(O,C),vl(l,f,U)}catch(mt){bl(l,f,mt)}}function vl(l,f,v){v!==null&&typeof v=="object"&&typeof v.then=="function"?v.then(function(C){nc(l,f,C)},function(C){return bl(l,f,C)}):nc(l,f,v)}function nc(l,f,v){f.status="fulfilled",f.value=v,zi(f),l.state=v,f=l.pending,f!==null&&(v=f.next,v===f?l.pending=null:(v=v.next,f.next=v,Df(l,v)))}function bl(l,f,v){var C=l.pending;if(l.pending=null,C!==null){C=C.next;do f.status="rejected",f.reason=v,zi(f),f=f.next;while(f!==C)}l.action=null}function zi(l){l=l.listeners;for(var f=0;f<l.length;f++)(0,l[f])()}function Pf(l,f){return f}function Up(l,f){if(En){var v=nt.formState;if(v!==null){e:{var C=rn;if(En){if(ua){t:{for(var O=ua,U=qo;O.nodeType!==8;){if(!U){O=null;break t}if(O=sl(O.nextSibling),O===null){O=null;break t}}U=O.data,O=U==="F!"||U==="F"?O:null}if(O){ua=sl(O.nextSibling),C=O.data==="F!";break e}}dl(C)}C=!1}C&&(f=v[0])}}return v=Gs(),v.memoizedState=v.baseState=f,C={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Pf,lastRenderedState:f},v.queue=C,v=On.bind(null,rn,C),C.dispatch=v,C=rc(!1),U=Ph.bind(null,rn,!1,C.queue),C=Gs(),O={state:f,dispatch:null,action:l,pending:null},C.queue=O,v=si.bind(null,rn,O,U,v),O.dispatch=v,C.memoizedState=l,[f,v,!1]}function Dd(l){var f=Os();return Pd(f,Vn,l)}function Pd(l,f,v){f=zu(l,f,Pf)[0],l=uo($o)[0],f=typeof f=="object"&&f!==null&&typeof f.then=="function"?Mh(f):f;var C=Os(),O=C.queue,U=O.dispatch;return v!==C.memoizedState&&(rn.flags|=2048,Du(9,Of.bind(null,O,v),{destroy:void 0},null)),[f,U,l]}function Of(l,f){l.action=f}function Gm(l){var f=Os(),v=Vn;if(v!==null)return Pd(f,v,l);Os(),f=f.memoizedState,v=Os();var C=v.queue.dispatch;return v.memoizedState=l,[f,C,!1]}function Du(l,f,v,C){return l={tag:l,create:f,inst:v,deps:C,next:null},f=rn.updateQueue,f===null&&(f=Go(),rn.updateQueue=f),v=f.lastEffect,v===null?f.lastEffect=l.next=l:(C=v.next,v.next=l,l.next=C,f.lastEffect=l),l}function $m(){return Os().memoizedState}function jf(l,f,v,C){var O=Gs();rn.flags|=l,O.memoizedState=Du(1|f,v,{destroy:void 0},C===void 0?null:C)}function ha(l,f,v,C){var O=Os();C=C===void 0?null:C;var U=O.memoizedState.inst;Vn!==null&&C!==null&&Rd(C,Vn.memoizedState.deps)?O.memoizedState=Du(f,v,U,C):(rn.flags|=l,O.memoizedState=Du(1|f,v,U,C))}function Nf(l,f){jf(8390656,8,l,f)}function Ks(l,f){ha(2048,8,l,f)}function sc(l,f){return ha(4,2,l,f)}function Vp(l,f){return ha(4,4,l,f)}function kf(l,f){if(typeof f=="function"){l=l();var v=f(l);return function(){typeof v=="function"?v():f(null)}}if(f!=null)return l=l(),f.current=l,function(){f.current=null}}function Bf(l,f,v){v=v!=null?v.concat([l]):null,ha(4,4,kf.bind(null,f,l),v)}function Lh(){}function qc(l,f){var v=Os();f=f===void 0?null:f;var C=v.memoizedState;return f!==null&&Rd(f,C[1])?C[0]:(v.memoizedState=[l,f],l)}function Zo(l,f){var v=Os();f=f===void 0?null:f;var C=v.memoizedState;if(f!==null&&Rd(f,C[1]))return C[0];if(C=l(),ic){Ms(!0);try{l()}finally{Ms(!1)}}return v.memoizedState=[C,f],C}function on(l,f,v){return v===void 0||(Vc&1073741824)!==0?l.memoizedState=f:(l.memoizedState=v,l=jn(),rn.lanes|=l,ci|=l,v)}function Gc(l,f,v,C){return Wa(v,f)?v:bh.current!==null?(l=on(l,v,C),Wa(l,f)||(gs=!0),l):(Vc&42)===0?(gs=!0,l.memoizedState=v):(l=jn(),rn.lanes|=l,ci|=l,f)}function Ff(l,f,v,C,O){var U=ii.p;ii.p=U!==0&&8>U?U:8;var ae=lt.T,De={};lt.T=De,Ph(l,!1,f,v);try{var Xe=O(),mt=lt.S;if(mt!==null&&mt(De,Xe),Xe!==null&&typeof Xe=="object"&&typeof Xe.then=="function"){var ai=Au(Xe,C);qe(l,f,ai,wr(l))}else qe(l,f,C,wr(l))}catch(xi){qe(l,f,{then:function(){},status:"rejected",reason:xi},wr())}finally{ii.p=U,lt.T=ae}}function Zm(){}function Wo(l,f,v,C){if(l.tag!==5)throw Error(S(476));var O=Uf(l).queue;Ff(l,O,f,Wi,v===null?Zm:function(){return $c(l),v(C)})}function Uf(l){var f=l.memoizedState;if(f!==null)return f;f={memoizedState:Wi,baseState:Wi,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:$o,lastRenderedState:Wi},next:null};var v={};return f.next={memoizedState:v,baseState:v,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:$o,lastRenderedState:v},next:null},l.memoizedState=f,l=l.alternate,l!==null&&(l.memoizedState=f),f}function $c(l){var f=Uf(l).next.queue;qe(l,f,{},wr())}function ac(){return Js(hm)}function Zc(){return Os().memoizedState}function Nt(){return Os().memoizedState}function Yt(l){for(var f=l.return;f!==null;){switch(f.tag){case 24:case 3:var v=wr();l=hc(v);var C=Jo(f,l,v);C!==null&&(Vr(C,f,v),Bh(C,f,v)),f={cache:Sh()},l.payload=f;return}f=f.return}}function Dh(l,f,v){var C=wr();v={lane:C,revertLane:0,action:v,hasEagerState:!1,eagerState:null,next:null},wl(l)?Od(f,v):(v=Lc(l,f,v,C),v!==null&&(Vr(v,l,C),Oh(v,f,C)))}function On(l,f,v){var C=wr();qe(l,f,v,C)}function qe(l,f,v,C){var O={lane:C,revertLane:0,action:v,hasEagerState:!1,eagerState:null,next:null};if(wl(l))Od(f,O);else{var U=l.alternate;if(l.lanes===0&&(U===null||U.lanes===0)&&(U=f.lastRenderedReducer,U!==null))try{var ae=f.lastRenderedState,De=U(ae,v);if(O.hasEagerState=!0,O.eagerState=De,Wa(De,ae))return yh(l,f,O,0),nt===null&&Vt(),!1}catch{}finally{}if(v=Lc(l,f,O,C),v!==null)return Vr(v,l,C),Oh(v,f,C),!0}return!1}function Ph(l,f,v,C){if(C={lane:2,revertLane:Xf(),action:C,hasEagerState:!1,eagerState:null,next:null},wl(l)){if(f)throw Error(S(479))}else f=Lc(l,v,C,2),f!==null&&Vr(f,l,2)}function wl(l){var f=l.alternate;return l===rn||f!==null&&f===rn}function Od(l,f){Mu=tc=!0;var v=l.pending;v===null?f.next=f:(f.next=v.next,v.next=f),l.pending=f}function Oh(l,f,v){if((v&4194176)!==0){var C=f.lanes;C&=l.pendingLanes,v|=C,f.lanes=v,me(l,v)}}var Xo={readContext:Js,use:zf,useCallback:Kn,useContext:Kn,useEffect:Kn,useImperativeHandle:Kn,useLayoutEffect:Kn,useInsertionEffect:Kn,useMemo:Kn,useReducer:Kn,useRef:Kn,useState:Kn,useDebugValue:Kn,useDeferredValue:Kn,useTransition:Kn,useSyncExternalStore:Kn,useId:Kn};Xo.useCacheRefresh=Kn,Xo.useMemoCache=Kn,Xo.useHostTransitionStatus=Kn,Xo.useFormState=Kn,Xo.useActionState=Kn,Xo.useOptimistic=Kn;var da={readContext:Js,use:zf,useCallback:function(l,f){return Gs().memoizedState=[l,f===void 0?null:f],l},useContext:Js,useEffect:Nf,useImperativeHandle:function(l,f,v){v=v!=null?v.concat([l]):null,jf(4194308,4,kf.bind(null,f,l),v)},useLayoutEffect:function(l,f){return jf(4194308,4,l,f)},useInsertionEffect:function(l,f){jf(4,2,l,f)},useMemo:function(l,f){var v=Gs();f=f===void 0?null:f;var C=l();if(ic){Ms(!0);try{l()}finally{Ms(!1)}}return v.memoizedState=[C,f],C},useReducer:function(l,f,v){var C=Gs();if(v!==void 0){var O=v(f);if(ic){Ms(!0);try{v(f)}finally{Ms(!1)}}}else O=f;return C.memoizedState=C.baseState=O,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:O},C.queue=l,l=l.dispatch=Dh.bind(null,rn,l),[C.memoizedState,l]},useRef:function(l){var f=Gs();return l={current:l},f.memoizedState=l},useState:function(l){l=rc(l);var f=l.queue,v=On.bind(null,rn,f);return f.dispatch=v,[l.memoizedState,v]},useDebugValue:Lh,useDeferredValue:function(l,f){var v=Gs();return on(v,l,f)},useTransition:function(){var l=rc(!1);return l=Ff.bind(null,rn,l.queue,!0,!1),Gs().memoizedState=l,[!1,l]},useSyncExternalStore:function(l,f,v){var C=rn,O=Gs();if(En){if(v===void 0)throw Error(S(407));v=v()}else{if(v=f(),nt===null)throw Error(S(349));(ut&60)!==0||Id(C,f,v)}O.memoizedState=v;var U={value:v,getSnapshot:f};return O.queue=U,Nf(zh.bind(null,C,U,l),[l]),C.flags|=2048,Du(9,zd.bind(null,C,U,v,f),{destroy:void 0},null),v},useId:function(){var l=Gs(),f=nt.identifierPrefix;if(En){var v=Vo,C=hl;v=(C&~(1<<32-os(C)-1)).toString(32)+v,f=":"+f+"R"+v,v=Eh++,0<v&&(f+="H"+v.toString(32)),f+=":"}else v=Iu++,f=":"+f+"r"+v.toString(32)+":";return l.memoizedState=f},useCacheRefresh:function(){return Gs().memoizedState=Yt.bind(null,rn)}};da.useMemoCache=Ih,da.useHostTransitionStatus=ac,da.useFormState=Up,da.useActionState=Up,da.useOptimistic=function(l){var f=Gs();f.memoizedState=f.baseState=l;var v={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return f.queue=v,f=Ph.bind(null,rn,!0,v),v.dispatch=f,[l,f]};var ho={readContext:Js,use:zf,useCallback:qc,useContext:Js,useEffect:Ks,useImperativeHandle:Bf,useInsertionEffect:sc,useLayoutEffect:Vp,useMemo:Zo,useReducer:uo,useRef:$m,useState:function(){return uo($o)},useDebugValue:Lh,useDeferredValue:function(l,f){var v=Os();return Gc(v,Vn.memoizedState,l,f)},useTransition:function(){var l=uo($o)[0],f=Os().memoizedState;return[typeof l=="boolean"?l:Mh(l),f]},useSyncExternalStore:Lf,useId:Zc};ho.useCacheRefresh=Nt,ho.useMemoCache=Ih,ho.useHostTransitionStatus=ac,ho.useFormState=Dd,ho.useActionState=Dd,ho.useOptimistic=function(l,f){var v=Os();return Lu(v,Vn,l,f)};var Wc={readContext:Js,use:zf,useCallback:qc,useContext:Js,useEffect:Ks,useImperativeHandle:Bf,useInsertionEffect:sc,useLayoutEffect:Vp,useMemo:Zo,useReducer:xl,useRef:$m,useState:function(){return xl($o)},useDebugValue:Lh,useDeferredValue:function(l,f){var v=Os();return Vn===null?on(v,l,f):Gc(v,Vn.memoizedState,l,f)},useTransition:function(){var l=xl($o)[0],f=Os().memoizedState;return[typeof l=="boolean"?l:Mh(l),f]},useSyncExternalStore:Lf,useId:Zc};Wc.useCacheRefresh=Nt,Wc.useMemoCache=Ih,Wc.useHostTransitionStatus=ac,Wc.useFormState=Gm,Wc.useActionState=Gm,Wc.useOptimistic=function(l,f){var v=Os();return Vn!==null?Lu(v,Vn,l,f):(v.baseState=l,[l,v.queue.dispatch])};function Hp(l,f,v,C){f=l.memoizedState,v=v(C,f),v=v==null?f:zt({},f,v),l.memoizedState=v,l.lanes===0&&(l.updateQueue.baseState=v)}var Vf={isMounted:function(l){return(l=l._reactInternals)?Fi(l)===l:!1},enqueueSetState:function(l,f,v){l=l._reactInternals;var C=wr(),O=hc(C);O.payload=f,v!=null&&(O.callback=v),f=Jo(l,O,C),f!==null&&(Vr(f,l,C),Bh(f,l,C))},enqueueReplaceState:function(l,f,v){l=l._reactInternals;var C=wr(),O=hc(C);O.tag=1,O.payload=f,v!=null&&(O.callback=v),f=Jo(l,O,C),f!==null&&(Vr(f,l,C),Bh(f,l,C))},enqueueForceUpdate:function(l,f){l=l._reactInternals;var v=wr(),C=hc(v);C.tag=2,f!=null&&(C.callback=f),f=Jo(l,C,v),f!==null&&(Vr(f,l,v),Bh(f,l,v))}};function jd(l,f,v,C,O,U,ae){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(C,U,ae):f.prototype&&f.prototype.isPureReactComponent?!$l(v,C)||!$l(O,U):!0}function Hf(l,f,v,C){l=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(v,C),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(v,C),f.state!==l&&Vf.enqueueReplaceState(f,f.state,null)}function Xc(l,f){var v=f;if("ref"in f){v={};for(var C in f)C!=="ref"&&(v[C]=f[C])}if(l=l.defaultProps){v===f&&(v=zt({},v));for(var O in l)v[O]===void 0&&(v[O]=l[O])}return v}var Nd=typeof reportError=="function"?reportError:function(l){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof l=="object"&&l!==null&&typeof l.message=="string"?String(l.message):String(l),error:l});if(!window.dispatchEvent(f))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",l);return}console.error(l)};function kd(l){Nd(l)}function jh(l){console.error(l)}function Pu(l){Nd(l)}function Nh(l,f){try{var v=l.onUncaughtError;v(f.value,{componentStack:f.stack})}catch(C){setTimeout(function(){throw C})}}function qp(l,f,v){try{var C=l.onCaughtError;C(v.value,{componentStack:v.stack,errorBoundary:f.tag===1?f.stateNode:null})}catch(O){setTimeout(function(){throw O})}}function Gp(l,f,v){return v=hc(v),v.tag=3,v.payload={element:null},v.callback=function(){Nh(l,f)},v}function $p(l){return l=hc(l),l.tag=3,l}function Zp(l,f,v,C){var O=v.type.getDerivedStateFromError;if(typeof O=="function"){var U=C.value;l.payload=function(){return O(U)},l.callback=function(){qp(f,v,C)}}var ae=v.stateNode;ae!==null&&typeof ae.componentDidCatch=="function"&&(l.callback=function(){qp(f,v,C),typeof O!="function"&&(Tr===null?Tr=new Set([this]):Tr.add(this));var De=C.stack;this.componentDidCatch(C.value,{componentStack:De!==null?De:""})})}function fa(l,f,v,C,O){if(v.flags|=32768,C!==null&&typeof C=="object"&&typeof C.then=="function"){if(f=v.alternate,f!==null&&Sl(f,v,O,!0),v=Xa.current,v!==null){switch(v.tag){case 13:return Ao===null?vn():v.alternate===null&&ti===0&&(ti=3),v.flags&=-257,v.flags|=65536,v.lanes=O,C===bd?v.flags|=16384:(f=v.updateQueue,f===null?v.updateQueue=new Set([C]):f.add(C),ra(l,C,O)),!1;case 22:return v.flags|=65536,C===bd?v.flags|=16384:(f=v.updateQueue,f===null?(f={transitions:null,markerInstances:null,retryQueue:new Set([C])},v.updateQueue=f):(v=f.retryQueue,v===null?f.retryQueue=new Set([C]):v.add(C)),ra(l,C,O)),!1}throw Error(S(435,v.tag))}return ra(l,C,O),vn(),!1}if(En)return f=Xa.current,f!==null?((f.flags&65536)===0&&(f.flags|=256),f.flags|=65536,f.lanes=O,C!==vd&&(l=Error(S(422),{cause:C}),jc(ms(l,v)))):(C!==vd&&(f=Error(S(423),{cause:C}),jc(ms(f,v))),l=l.current.alternate,l.flags|=65536,O&=-O,l.lanes|=O,C=ms(C,v),O=Gp(l.stateNode,C,O),$f(l,O),ti!==4&&(ti=2)),!1;var U=Error(S(520),{cause:C});if(U=ms(U,v),qi===null?qi=[U]:qi.push(U),ti!==4&&(ti=2),f===null)return!0;C=ms(C,v),v=f;do{switch(v.tag){case 3:return v.flags|=65536,l=O&-O,v.lanes|=l,l=Gp(v.stateNode,C,l),$f(v,l),!1;case 1:if(f=v.type,U=v.stateNode,(v.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||U!==null&&typeof U.componentDidCatch=="function"&&(Tr===null||!Tr.has(U))))return v.flags|=65536,O&=-O,v.lanes|=O,O=$p(O),Zp(O,l,v,C),$f(v,O),!1}v=v.return}while(v!==null);return!1}var oc=Error(S(461)),gs=!1;function Lr(l,f,v,C){f.child=l===null?Um(f,null,v,C):kc(f,l.child,v,C)}function xr(l,f,v,C,O){v=v.render;var U=f.ref;if("ref"in C){var ae={};for(var De in C)De!=="ref"&&(ae[De]=C[De])}else ae=C;return El(f),C=Ah(l,f,v,ae,U,O),De=Ch(),l!==null&&!gs?(Md(l,f,O),Mo(l,f,O)):(En&&De&&Dp(f),f.flags|=1,Lr(l,f,C,O),f.child)}function Wp(l,f,v,C,O){if(l===null){var U=v.type;return typeof U=="function"&&!te(U)&&U.defaultProps===void 0&&v.compare===null?(f.tag=15,f.type=U,lc(l,f,U,C,O)):(l=ce(v.type,null,C,f,f.mode,O),l.ref=f.ref,l.return=f,f.child=l)}if(U=l.child,!Gd(l,O)){var ae=U.memoizedProps;if(v=v.compare,v=v!==null?v:$l,v(ae,C)&&l.ref===f.ref)return Mo(l,f,O)}return f.flags|=1,l=X(U,C),l.ref=f.ref,l.return=f,f.child=l}function lc(l,f,v,C,O){if(l!==null){var U=l.memoizedProps;if($l(U,C)&&l.ref===f.ref)if(gs=!1,f.pendingProps=C=U,Gd(l,O))(l.flags&131072)!==0&&(gs=!0);else return f.lanes=l.lanes,Mo(l,f,O)}return Bd(l,f,v,C,O)}function Yc(l,f,v){var C=f.pendingProps,O=C.children,U=(f.stateNode._pendingVisibility&2)!==0,ae=l!==null?l.memoizedState:null;if(Ro(l,f),C.mode==="hidden"||U){if((f.flags&128)!==0){if(C=ae!==null?ae.baseLanes|v:v,l!==null){for(O=f.child=l.child,U=0;O!==null;)U=U|O.lanes|O.childLanes,O=O.sibling;f.childLanes=U&~C}else f.childLanes=0,f.child=null;return Kc(l,f,C,v)}if((v&536870912)!==0)f.memoizedState={baseLanes:0,cachePool:null},l!==null&&Ru(f,ae!==null?ae.cachePool:null),ae!==null?Ed(f,ae):Th(),Fc(f);else return f.lanes=f.childLanes=536870912,Kc(l,f,ae!==null?ae.baseLanes|v:v,v)}else ae!==null?(Ru(f,ae.cachePool),Ed(f,ae),Ya(),f.memoizedState=null):(l!==null&&Ru(f,null),Th(),Ya());return Lr(l,f,O,v),f.child}function Kc(l,f,v,C){var O=Bp();return O=O===null?null:{parent:Is._currentValue,pool:O},f.memoizedState={baseLanes:v,cachePool:O},l!==null&&Ru(f,null),Th(),Fc(f),l!==null&&Sl(l,f,C,!0),null}function Ro(l,f){var v=f.ref;if(v===null)l!==null&&l.ref!==null&&(f.flags|=2097664);else{if(typeof v!="function"&&typeof v!="object")throw Error(S(284));(l===null||l.ref!==v)&&(f.flags|=2097664)}}function Bd(l,f,v,C,O){return El(f),v=Ah(l,f,v,C,void 0,O),C=Ch(),l!==null&&!gs?(Md(l,f,O),Mo(l,f,O)):(En&&C&&Dp(f),f.flags|=1,Lr(l,f,v,O),f.child)}function Fd(l,f,v,C,O,U){return El(f),f.updateQueue=null,v=Mf(f,C,v,O),Rf(l),C=Ch(),l!==null&&!gs?(Md(l,f,U),Mo(l,f,U)):(En&&C&&Dp(f),f.flags|=1,Lr(l,f,v,U),f.child)}function qf(l,f,v,C,O){if(El(f),f.stateNode===null){var U=Fa,ae=v.contextType;typeof ae=="object"&&ae!==null&&(U=Js(ae)),U=new v(C,U),f.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,U.updater=Vf,f.stateNode=U,U._reactInternals=f,U=f.stateNode,U.props=C,U.state=f.memoizedState,U.refs={},Gf(f),ae=v.contextType,U.context=typeof ae=="object"&&ae!==null?Js(ae):Fa,U.state=f.memoizedState,ae=v.getDerivedStateFromProps,typeof ae=="function"&&(Hp(f,v,ae,C),U.state=f.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(ae=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),ae!==U.state&&Vf.enqueueReplaceState(U,U.state,null),Uu(f,C,U,O),Fh(),U.state=f.memoizedState),typeof U.componentDidMount=="function"&&(f.flags|=4194308),C=!0}else if(l===null){U=f.stateNode;var De=f.memoizedProps,Xe=Xc(v,De);U.props=Xe;var mt=U.context,ai=v.contextType;ae=Fa,typeof ai=="object"&&ai!==null&&(ae=Js(ai));var xi=v.getDerivedStateFromProps;ai=typeof xi=="function"||typeof U.getSnapshotBeforeUpdate=="function",De=f.pendingProps!==De,ai||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(De||mt!==ae)&&Hf(f,U,C,ae),Ko=!1;var Ut=f.memoizedState;U.state=Ut,Uu(f,C,U,O),Fh(),mt=f.memoizedState,De||Ut!==mt||Ko?(typeof xi=="function"&&(Hp(f,v,xi,C),mt=f.memoizedState),(Xe=Ko||jd(f,v,Xe,C,Ut,mt,ae))?(ai||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount()),typeof U.componentDidMount=="function"&&(f.flags|=4194308)):(typeof U.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=C,f.memoizedState=mt),U.props=C,U.state=mt,U.context=ae,C=Xe):(typeof U.componentDidMount=="function"&&(f.flags|=4194308),C=!1)}else{U=f.stateNode,$d(l,f),ae=f.memoizedProps,ai=Xc(v,ae),U.props=ai,xi=f.pendingProps,Ut=U.context,mt=v.contextType,Xe=Fa,typeof mt=="object"&&mt!==null&&(Xe=Js(mt)),De=v.getDerivedStateFromProps,(mt=typeof De=="function"||typeof U.getSnapshotBeforeUpdate=="function")||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(ae!==xi||Ut!==Xe)&&Hf(f,U,C,Xe),Ko=!1,Ut=f.memoizedState,U.state=Ut,Uu(f,C,U,O),Fh();var ri=f.memoizedState;ae!==xi||Ut!==ri||Ko||l!==null&&l.dependencies!==null&&Bu(l.dependencies)?(typeof De=="function"&&(Hp(f,v,De,C),ri=f.memoizedState),(ai=Ko||jd(f,v,ai,C,Ut,ri,Xe)||l!==null&&l.dependencies!==null&&Bu(l.dependencies))?(mt||typeof U.UNSAFE_componentWillUpdate!="function"&&typeof U.componentWillUpdate!="function"||(typeof U.componentWillUpdate=="function"&&U.componentWillUpdate(C,ri,Xe),typeof U.UNSAFE_componentWillUpdate=="function"&&U.UNSAFE_componentWillUpdate(C,ri,Xe)),typeof U.componentDidUpdate=="function"&&(f.flags|=4),typeof U.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof U.componentDidUpdate!="function"||ae===l.memoizedProps&&Ut===l.memoizedState||(f.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||ae===l.memoizedProps&&Ut===l.memoizedState||(f.flags|=1024),f.memoizedProps=C,f.memoizedState=ri),U.props=C,U.state=ri,U.context=Xe,C=ai):(typeof U.componentDidUpdate!="function"||ae===l.memoizedProps&&Ut===l.memoizedState||(f.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||ae===l.memoizedProps&&Ut===l.memoizedState||(f.flags|=1024),C=!1)}return U=C,Ro(l,f),C=(f.flags&128)!==0,U||C?(U=f.stateNode,v=C&&typeof v.getDerivedStateFromError!="function"?null:U.render(),f.flags|=1,l!==null&&C?(f.child=kc(f,l.child,null,O),f.child=kc(f,null,v,O)):Lr(l,f,v,O),f.memoizedState=U.state,l=f.child):l=Mo(l,f,O),l}function Ud(l,f,v,C){return Oc(),f.flags|=256,Lr(l,f,v,C),f.child}var pa={dehydrated:null,treeContext:null,retryLane:0};function Tl(l){return{baseLanes:l,cachePool:qm()}}function Jc(l,f,v){return l=l!==null?l.childLanes&~v:0,f&&(l|=Hi),l}function Vd(l,f,v){var C=f.pendingProps,O=!1,U=(f.flags&128)!==0,ae;if((ae=U)||(ae=l!==null&&l.memoizedState===null?!1:(kn.current&2)!==0),ae&&(O=!0,f.flags&=-129),ae=(f.flags&32)!==0,f.flags&=-33,l===null){if(En){if(O?Bc(f):Ya(),En){var De=ua,Xe;if(Xe=De){e:{for(Xe=De,De=qo;Xe.nodeType!==8;){if(!De){De=null;break e}if(Xe=sl(Xe.nextSibling),Xe===null){De=null;break e}}De=Xe}De!==null?(f.memoizedState={dehydrated:De,treeContext:cn!==null?{id:hl,overflow:Vo}:null,retryLane:536870912},Xe=G(18,null,null,0),Xe.stateNode=De,Xe.return=f,f.child=Xe,Aa=f,ua=null,Xe=!0):Xe=!1}Xe||dl(f)}if(De=f.memoizedState,De!==null&&(De=De.dehydrated,De!==null))return De.data==="$!"?f.lanes=16:f.lanes=536870912,null;gl(f)}return De=C.children,C=C.fallback,O?(Ya(),O=f.mode,De=qd({mode:"hidden",children:De},O),C=fe(C,O,v,null),De.return=f,C.return=f,De.sibling=C,f.child=De,O=f.child,O.memoizedState=Tl(v),O.childLanes=Jc(l,ae,v),f.memoizedState=pa,C):(Bc(f),Hd(f,De))}if(Xe=l.memoizedState,Xe!==null&&(De=Xe.dehydrated,De!==null)){if(U)f.flags&256?(Bc(f),f.flags&=-257,f=fo(l,f,v)):f.memoizedState!==null?(Ya(),f.child=l.child,f.flags|=128,f=null):(Ya(),O=C.fallback,De=f.mode,C=qd({mode:"visible",children:C.children},De),O=fe(O,De,v,null),O.flags|=2,C.return=f,O.return=f,C.sibling=O,f.child=C,kc(f,l.child,null,v),C=f.child,C.memoizedState=Tl(v),C.childLanes=Jc(l,ae,v),f.memoizedState=pa,f=O);else if(Bc(f),De.data==="$!"){if(ae=De.nextSibling&&De.nextSibling.dataset,ae)var mt=ae.dgst;ae=mt,C=Error(S(419)),C.stack="",C.digest=ae,jc({value:C,source:null,stack:null}),f=fo(l,f,v)}else if(gs||Sl(l,f,v,!1),ae=(v&l.childLanes)!==0,gs||ae){if(ae=nt,ae!==null){if(C=v&-v,(C&42)!==0)C=1;else switch(C){case 2:C=1;break;case 8:C=4;break;case 32:C=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:C=64;break;case 268435456:C=134217728;break;default:C=0}if(C=(C&(ae.suspendedLanes|v))!==0?0:C,C!==0&&C!==Xe.retryLane)throw Xe.retryLane=C,co(l,C),Vr(ae,l,C),oc}De.data==="$?"||vn(),f=fo(l,f,v)}else De.data==="$?"?(f.flags|=128,f.child=l.child,f=V1.bind(null,l),De._reactRetry=f,f=null):(l=Xe.treeContext,ua=sl(De.nextSibling),Aa=f,En=!0,Ho=null,qo=!1,l!==null&&(Ua[Eo++]=hl,Ua[Eo++]=Vo,Ua[Eo++]=cn,hl=l.id,Vo=l.overflow,cn=f),f=Hd(f,C.children),f.flags|=4096);return f}return O?(Ya(),O=C.fallback,De=f.mode,Xe=l.child,mt=Xe.sibling,C=X(Xe,{mode:"hidden",children:C.children}),C.subtreeFlags=Xe.subtreeFlags&31457280,mt!==null?O=X(mt,O):(O=fe(O,De,v,null),O.flags|=2),O.return=f,C.return=f,C.sibling=O,f.child=C,C=O,O=f.child,De=l.child.memoizedState,De===null?De=Tl(v):(Xe=De.cachePool,Xe!==null?(mt=Is._currentValue,Xe=Xe.parent!==mt?{parent:mt,pool:mt}:Xe):Xe=qm(),De={baseLanes:De.baseLanes|v,cachePool:Xe}),O.memoizedState=De,O.childLanes=Jc(l,ae,v),f.memoizedState=pa,C):(Bc(f),v=l.child,l=v.sibling,v=X(v,{mode:"visible",children:C.children}),v.return=f,v.sibling=null,l!==null&&(ae=f.deletions,ae===null?(f.deletions=[l],f.flags|=16):ae.push(l)),f.child=v,f.memoizedState=null,v)}function Hd(l,f){return f=qd({mode:"visible",children:f},l.mode),f.return=l,l.child=f}function qd(l,f){return Te(l,f,0,null)}function fo(l,f,v){return kc(f,l.child,null,v),l=Hd(f,f.pendingProps.children),l.flags|=2,f.memoizedState=null,l}function Ou(l,f,v){l.lanes|=f;var C=l.alternate;C!==null&&(C.lanes|=f),kh(l.return,f,v)}function rs(l,f,v,C,O){var U=l.memoizedState;U===null?l.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:C,tail:v,tailMode:O}:(U.isBackwards=f,U.rendering=null,U.renderingStartTime=0,U.last=C,U.tail=v,U.tailMode=O)}function ju(l,f,v){var C=f.pendingProps,O=C.revealOrder,U=C.tail;if(Lr(l,f,C.children,v),C=kn.current,(C&2)!==0)C=C&1|2,f.flags|=128;else{if(l!==null&&(l.flags&128)!==0)e:for(l=f.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&Ou(l,v,f);else if(l.tag===19)Ou(l,v,f);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===f)break e;for(;l.sibling===null;){if(l.return===null||l.return===f)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}C&=1}switch(Tt(kn,C),O){case"forwards":for(v=f.child,O=null;v!==null;)l=v.alternate,l!==null&&Eu(l)===null&&(O=v),v=v.sibling;v=O,v===null?(O=f.child,f.child=null):(O=v.sibling,v.sibling=null),rs(f,!1,O,v,U);break;case"backwards":for(v=null,O=f.child,f.child=null;O!==null;){if(l=O.alternate,l!==null&&Eu(l)===null){f.child=O;break}l=O.sibling,O.sibling=v,v=O,O=l}rs(f,!0,v,null,U);break;case"together":rs(f,!1,null,null,void 0);break;default:f.memoizedState=null}return f.child}function Mo(l,f,v){if(l!==null&&(f.dependencies=l.dependencies),ci|=f.lanes,(v&f.childLanes)===0)if(l!==null){if(Sl(l,f,v,!1),(v&f.childLanes)===0)return null}else return null;if(l!==null&&f.child!==l.child)throw Error(S(153));if(f.child!==null){for(l=f.child,v=X(l,l.pendingProps),f.child=v,v.return=f;l.sibling!==null;)l=l.sibling,v=v.sibling=X(l,l.pendingProps),v.return=f;v.sibling=null}return f.child}function Gd(l,f){return(l.lanes&f)!==0?!0:(l=l.dependencies,!!(l!==null&&Bu(l)))}function Xp(l,f,v){switch(f.tag){case 3:Er(f,f.stateNode.containerInfo),Ka(f,Is,l.memoizedState.cache),Oc();break;case 27:case 5:ds(f);break;case 4:Er(f,f.stateNode.containerInfo);break;case 10:Ka(f,f.type,f.memoizedProps.value);break;case 13:var C=f.memoizedState;if(C!==null)return C.dehydrated!==null?(Bc(f),f.flags|=128,null):(v&f.child.childLanes)!==0?Vd(l,f,v):(Bc(f),l=Mo(l,f,v),l!==null?l.sibling:null);Bc(f);break;case 19:var O=(l.flags&128)!==0;if(C=(v&f.childLanes)!==0,C||(Sl(l,f,v,!1),C=(v&f.childLanes)!==0),O){if(C)return ju(l,f,v);f.flags|=128}if(O=f.memoizedState,O!==null&&(O.rendering=null,O.tail=null,O.lastEffect=null),Tt(kn,kn.current),C)break;return null;case 22:case 23:return f.lanes=0,Yc(l,f,v);case 24:Ka(f,Is,l.memoizedState.cache)}return Mo(l,f,v)}function cs(l,f,v){if(l!==null)if(l.memoizedProps!==f.pendingProps)gs=!0;else{if(!Gd(l,v)&&(f.flags&128)===0)return gs=!1,Xp(l,f,v);gs=(l.flags&131072)!==0}else gs=!1,En&&(f.flags&1048576)!==0&&Fm(f,Tf,f.index);switch(f.lanes=0,f.tag){case 16:e:{l=f.pendingProps;var C=f.elementType,O=C._init;if(C=O(C._payload),f.type=C,typeof C=="function")te(C)?(l=Xc(C,l),f.tag=1,f=qf(null,f,C,l,v)):(f.tag=0,f=Bd(null,f,C,l,v));else{if(C!=null){if(O=C.$$typeof,O===le){f.tag=11,f=xr(null,f,C,l,v);break e}else if(O===_e){f.tag=14,f=Wp(null,f,C,l,v);break e}}throw f=rt(C)||C,Error(S(306,f,""))}}return f;case 0:return Bd(l,f,f.type,f.pendingProps,v);case 1:return C=f.type,O=Xc(C,f.pendingProps),qf(l,f,C,O,v);case 3:e:{if(Er(f,f.stateNode.containerInfo),l===null)throw Error(S(387));var U=f.pendingProps;O=f.memoizedState,C=O.element,$d(l,f),Uu(f,U,null,v);var ae=f.memoizedState;if(U=ae.cache,Ka(f,Is,U),U!==O.cache&&ku(f,[Is],v,!0),Fh(),U=ae.element,O.isDehydrated)if(O={element:U,isDehydrated:!1,cache:ae.cache},f.updateQueue.baseState=O,f.memoizedState=O,f.flags&256){f=Ud(l,f,U,v);break e}else if(U!==C){C=ms(Error(S(424)),f),jc(C),f=Ud(l,f,U,v);break e}else for(ua=sl(f.stateNode.containerInfo.firstChild),Aa=f,En=!0,Ho=null,qo=!0,v=Um(f,null,U,v),f.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling;else{if(Oc(),U===C){f=Mo(l,f,v);break e}Lr(l,f,U,v)}f=f.child}return f;case 26:return Ro(l,f),l===null?(v=lg(f.type,null,f.pendingProps,null))?f.memoizedState=v:En||(v=f.type,l=f.pendingProps,C=ag(Cr.current).createElement(v),C[Be]=f,C[Je]=l,Es(C,v,l),Yr(C),f.stateNode=C):f.memoizedState=lg(f.type,l.memoizedProps,f.pendingProps,l.memoizedState),null;case 27:return ds(f),l===null&&En&&(C=f.stateNode=d_(f.type,f.pendingProps,Cr.current),Aa=f,qo=!0,ua=sl(C.firstChild)),C=f.pendingProps.children,l!==null||En?Lr(l,f,C,v):f.child=kc(f,null,C,v),Ro(l,f),f.child;case 5:return l===null&&En&&((O=C=ua)&&(C=$1(C,f.type,f.pendingProps,qo),C!==null?(f.stateNode=C,Aa=f,ua=sl(C.firstChild),qo=!1,O=!0):O=!1),O||dl(f)),ds(f),O=f.type,U=f.pendingProps,ae=l!==null?l.memoizedProps:null,C=U.children,c_(O,U)?C=null:ae!==null&&c_(O,ae)&&(f.flags|=32),f.memoizedState!==null&&(O=Ah(l,f,If,null,null,v),hm._currentValue=O),Ro(l,f),Lr(l,f,C,v),f.child;case 6:return l===null&&En&&((l=v=ua)&&(v=Z1(v,f.pendingProps,qo),v!==null?(f.stateNode=v,Aa=f,ua=null,l=!0):l=!1),l||dl(f)),null;case 13:return Vd(l,f,v);case 4:return Er(f,f.stateNode.containerInfo),C=f.pendingProps,l===null?f.child=kc(f,null,C,v):Lr(l,f,C,v),f.child;case 11:return xr(l,f,f.type,f.pendingProps,v);case 7:return Lr(l,f,f.pendingProps,v),f.child;case 8:return Lr(l,f,f.pendingProps.children,v),f.child;case 12:return Lr(l,f,f.pendingProps.children,v),f.child;case 10:return C=f.pendingProps,Ka(f,f.type,C.value),Lr(l,f,C.children,v),f.child;case 9:return O=f.type._context,C=f.pendingProps.children,El(f),O=Js(O),C=C(O),f.flags|=1,Lr(l,f,C,v),f.child;case 14:return Wp(l,f,f.type,f.pendingProps,v);case 15:return lc(l,f,f.type,f.pendingProps,v);case 19:return ju(l,f,v);case 22:return Yc(l,f,v);case 24:return El(f),C=Js(Is),l===null?(O=Bp(),O===null&&(O=nt,U=Sh(),O.pooledCache=U,U.refCount++,U!==null&&(O.pooledCacheLanes|=v),O=U),f.memoizedState={parent:C,cache:O},Gf(f),Ka(f,Is,O)):((l.lanes&v)!==0&&($d(l,f),Uu(f,null,null,v),Fh()),O=l.memoizedState,U=f.memoizedState,O.parent!==C?(O={parent:C,cache:C},f.memoizedState=O,f.lanes===0&&(f.memoizedState=f.updateQueue.baseState=O),Ka(f,Is,C)):(C=U.cache,Ka(f,Is,C),C!==O.cache&&ku(f,[Is],v,!0))),Lr(l,f,f.pendingProps.children,v),f.child;case 29:throw f.pendingProps}throw Error(S(156,f.tag))}var Nu=Ai(null),cc=null,po=null;function Ka(l,f,v){Tt(Nu,f._currentValue),f._currentValue=v}function Yo(l){l._currentValue=Nu.current,gt(Nu)}function kh(l,f,v){for(;l!==null;){var C=l.alternate;if((l.childLanes&f)!==f?(l.childLanes|=f,C!==null&&(C.childLanes|=f)):C!==null&&(C.childLanes&f)!==f&&(C.childLanes|=f),l===v)break;l=l.return}}function ku(l,f,v,C){var O=l.child;for(O!==null&&(O.return=l);O!==null;){var U=O.dependencies;if(U!==null){var ae=O.child;U=U.firstContext;e:for(;U!==null;){var De=U;U=O;for(var Xe=0;Xe<f.length;Xe++)if(De.context===f[Xe]){U.lanes|=v,De=U.alternate,De!==null&&(De.lanes|=v),kh(U.return,v,l),C||(ae=null);break e}U=De.next}}else if(O.tag===18){if(ae=O.return,ae===null)throw Error(S(341));ae.lanes|=v,U=ae.alternate,U!==null&&(U.lanes|=v),kh(ae,v,l),ae=null}else ae=O.child;if(ae!==null)ae.return=O;else for(ae=O;ae!==null;){if(ae===l){ae=null;break}if(O=ae.sibling,O!==null){O.return=ae.return,ae=O;break}ae=ae.return}O=ae}}function Sl(l,f,v,C){l=null;for(var O=f,U=!1;O!==null;){if(!U){if((O.flags&524288)!==0)U=!0;else if((O.flags&262144)!==0)break}if(O.tag===10){var ae=O.alternate;if(ae===null)throw Error(S(387));if(ae=ae.memoizedProps,ae!==null){var De=O.type;Wa(O.pendingProps.value,ae.value)||(l!==null?l.push(De):l=[De])}}else if(O===zr.current){if(ae=O.alternate,ae===null)throw Error(S(387));ae.memoizedState.memoizedState!==O.memoizedState.memoizedState&&(l!==null?l.push(hm):l=[hm])}O=O.return}l!==null&&ku(f,l,v,C),f.flags|=262144}function Bu(l){for(l=l.firstContext;l!==null;){if(!Wa(l.context._currentValue,l.memoizedValue))return!0;l=l.next}return!1}function El(l){cc=l,po=null,l=l.dependencies,l!==null&&(l.firstContext=null)}function Js(l){return Fu(cc,l)}function uc(l,f){return cc===null&&El(l),Fu(l,f)}function Fu(l,f){var v=f._currentValue;if(f={context:f,memoizedValue:v,next:null},po===null){if(l===null)throw Error(S(308));po=f,l.dependencies={lanes:0,firstContext:f},l.flags|=524288}else po=po.next=f;return v}var Ko=!1;function Gf(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function $d(l,f){l=l.updateQueue,f.updateQueue===l&&(f.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,callbacks:null})}function hc(l){return{lane:l,tag:0,payload:null,callback:null,next:null}}function Jo(l,f,v){var C=l.updateQueue;if(C===null)return null;if(C=C.shared,(Oe&2)!==0){var O=C.pending;return O===null?f.next=f:(f.next=O.next,O.next=f),C.pending=f,f=Dc(l),xh(l,null,v),f}return yh(l,C,f,v),Dc(l)}function Bh(l,f,v){if(f=f.updateQueue,f!==null&&(f=f.shared,(v&4194176)!==0)){var C=f.lanes;C&=l.pendingLanes,v|=C,f.lanes=v,me(l,v)}}function $f(l,f){var v=l.updateQueue,C=l.alternate;if(C!==null&&(C=C.updateQueue,v===C)){var O=null,U=null;if(v=v.firstBaseUpdate,v!==null){do{var ae={lane:v.lane,tag:v.tag,payload:v.payload,callback:null,next:null};U===null?O=U=ae:U=U.next=ae,v=v.next}while(v!==null);U===null?O=U=f:U=U.next=f}else O=U=f;v={baseState:C.baseState,firstBaseUpdate:O,lastBaseUpdate:U,shared:C.shared,callbacks:C.callbacks},l.updateQueue=v;return}l=v.lastBaseUpdate,l===null?v.firstBaseUpdate=f:l.next=f,v.lastBaseUpdate=f}var Zf=!1;function Fh(){if(Zf){var l=Uc;if(l!==null)throw l}}function Uu(l,f,v,C){Zf=!1;var O=l.updateQueue;Ko=!1;var U=O.firstBaseUpdate,ae=O.lastBaseUpdate,De=O.shared.pending;if(De!==null){O.shared.pending=null;var Xe=De,mt=Xe.next;Xe.next=null,ae===null?U=mt:ae.next=mt,ae=Xe;var ai=l.alternate;ai!==null&&(ai=ai.updateQueue,De=ai.lastBaseUpdate,De!==ae&&(De===null?ai.firstBaseUpdate=mt:De.next=mt,ai.lastBaseUpdate=Xe))}if(U!==null){var xi=O.baseState;ae=0,ai=mt=Xe=null,De=U;do{var Ut=De.lane&-536870913,ri=Ut!==De.lane;if(ri?(ut&Ut)===Ut:(C&Ut)===Ut){Ut!==0&&Ut===yl&&(Zf=!0),ai!==null&&(ai=ai.next={lane:0,tag:De.tag,payload:De.payload,callback:null,next:null});e:{var vr=l,Qr=De;Ut=f;var _s=v;switch(Qr.tag){case 1:if(vr=Qr.payload,typeof vr=="function"){xi=vr.call(_s,xi,Ut);break e}xi=vr;break e;case 3:vr.flags=vr.flags&-65537|128;case 0:if(vr=Qr.payload,Ut=typeof vr=="function"?vr.call(_s,xi,Ut):vr,Ut==null)break e;xi=zt({},xi,Ut);break e;case 2:Ko=!0}}Ut=De.callback,Ut!==null&&(l.flags|=64,ri&&(l.flags|=8192),ri=O.callbacks,ri===null?O.callbacks=[Ut]:ri.push(Ut))}else ri={lane:Ut,tag:De.tag,payload:De.payload,callback:De.callback,next:null},ai===null?(mt=ai=ri,Xe=xi):ai=ai.next=ri,ae|=Ut;if(De=De.next,De===null){if(De=O.shared.pending,De===null)break;ri=De,De=ri.next,ri.next=null,O.lastBaseUpdate=ri,O.shared.pending=null}}while(!0);ai===null&&(Xe=xi),O.baseState=Xe,O.firstBaseUpdate=mt,O.lastBaseUpdate=ai,U===null&&(O.shared.lanes=0),ci|=ae,l.lanes=ae,l.memoizedState=xi}}function Yp(l,f){if(typeof l!="function")throw Error(S(191,l));l.call(f)}function Kp(l,f){var v=l.callbacks;if(v!==null)for(l.callbacks=null,l=0;l<v.length;l++)Yp(v[l],f)}function Uh(l,f){try{var v=f.updateQueue,C=v!==null?v.lastEffect:null;if(C!==null){var O=C.next;v=O;do{if((v.tag&l)===l){C=void 0;var U=v.create,ae=v.inst;C=U(),ae.destroy=C}v=v.next}while(v!==O)}}catch(De){qn(f,f.return,De)}}function dc(l,f,v){try{var C=f.updateQueue,O=C!==null?C.lastEffect:null;if(O!==null){var U=O.next;C=U;do{if((C.tag&l)===l){var ae=C.inst,De=ae.destroy;if(De!==void 0){ae.destroy=void 0,O=f;var Xe=v;try{De()}catch(mt){qn(O,Xe,mt)}}}C=C.next}while(C!==U)}}catch(mt){qn(f,f.return,mt)}}function Wm(l){var f=l.updateQueue;if(f!==null){var v=l.stateNode;try{Kp(f,v)}catch(C){qn(l,l.return,C)}}}function Xm(l,f,v){v.props=Xc(l.type,l.memoizedProps),v.state=l.memoizedState;try{v.componentWillUnmount()}catch(C){qn(l,f,C)}}function Vu(l,f){try{var v=l.ref;if(v!==null){var C=l.stateNode;switch(l.tag){case 26:case 27:case 5:var O=C;break;default:O=C}typeof v=="function"?l.refCleanup=v(O):v.current=O}}catch(U){qn(l,f,U)}}function Wr(l,f){var v=l.ref,C=l.refCleanup;if(v!==null)if(typeof C=="function")try{C()}catch(O){qn(l,f,O)}finally{l.refCleanup=null,l=l.alternate,l!=null&&(l.refCleanup=null)}else if(typeof v=="function")try{v(null)}catch(O){qn(l,f,O)}else v.current=null}function Vh(l){var f=l.type,v=l.memoizedProps,C=l.stateNode;try{e:switch(f){case"button":case"input":case"select":case"textarea":v.autoFocus&&C.focus();break e;case"img":v.src?C.src=v.src:v.srcSet&&(C.srcset=v.srcSet)}}catch(O){qn(l,l.return,O)}}function Ym(l,f,v){try{var C=l.stateNode;na(C,l.type,v,f),C[Je]=f}catch(O){qn(l,l.return,O)}}function Km(l){return l.tag===5||l.tag===3||l.tag===26||l.tag===27||l.tag===4}function Hh(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||Km(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==27&&l.tag!==18;){if(l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function Hu(l,f,v){var C=l.tag;if(C===5||C===6)l=l.stateNode,f?v.nodeType===8?v.parentNode.insertBefore(l,f):v.insertBefore(l,f):(v.nodeType===8?(f=v.parentNode,f.insertBefore(l,v)):(f=v,f.appendChild(l)),v=v._reactRootContainer,v!=null||f.onclick!==null||(f.onclick=sm));else if(C!==4&&C!==27&&(l=l.child,l!==null))for(Hu(l,f,v),l=l.sibling;l!==null;)Hu(l,f,v),l=l.sibling}function qh(l,f,v){var C=l.tag;if(C===5||C===6)l=l.stateNode,f?v.insertBefore(l,f):v.appendChild(l);else if(C!==4&&C!==27&&(l=l.child,l!==null))for(qh(l,f,v),l=l.sibling;l!==null;)qh(l,f,v),l=l.sibling}var Qo=!1,ns=!1,Io=!1,Gh=typeof WeakSet=="function"?WeakSet:Set,Jr=null,el=!1;function Zd(l,f){if(l=l.containerInfo,sg=dm,l=To(l),Rp(l)){if("selectionStart"in l)var v={start:l.selectionStart,end:l.selectionEnd};else e:{v=(v=l.ownerDocument)&&v.defaultView||window;var C=v.getSelection&&v.getSelection();if(C&&C.rangeCount!==0){v=C.anchorNode;var O=C.anchorOffset,U=C.focusNode;C=C.focusOffset;try{v.nodeType,U.nodeType}catch{v=null;break e}var ae=0,De=-1,Xe=-1,mt=0,ai=0,xi=l,Ut=null;t:for(;;){for(var ri;xi!==v||O!==0&&xi.nodeType!==3||(De=ae+O),xi!==U||C!==0&&xi.nodeType!==3||(Xe=ae+C),xi.nodeType===3&&(ae+=xi.nodeValue.length),(ri=xi.firstChild)!==null;)Ut=xi,xi=ri;for(;;){if(xi===l)break t;if(Ut===v&&++mt===O&&(De=ae),Ut===U&&++ai===C&&(Xe=ae),(ri=xi.nextSibling)!==null)break;xi=Ut,Ut=xi.parentNode}xi=ri}v=De===-1||Xe===-1?null:{start:De,end:Xe}}else v=null}v=v||{start:0,end:0}}else v=null;for(Yd={focusedElem:l,selectionRange:v},dm=!1,Jr=f;Jr!==null;)if(f=Jr,l=f.child,(f.subtreeFlags&1028)!==0&&l!==null)l.return=f,Jr=l;else for(;Jr!==null;){switch(f=Jr,U=f.alternate,l=f.flags,f.tag){case 0:break;case 11:case 15:break;case 1:if((l&1024)!==0&&U!==null){l=void 0,v=f,O=U.memoizedProps,U=U.memoizedState,C=v.stateNode;try{var vr=Xc(v.type,O,v.elementType===v.type);l=C.getSnapshotBeforeUpdate(vr,U),C.__reactInternalSnapshotBeforeUpdate=l}catch(Qr){qn(v,v.return,Qr)}}break;case 3:if((l&1024)!==0){if(l=f.stateNode.containerInfo,v=l.nodeType,v===9)h_(l);else if(v===1)switch(l.nodeName){case"HEAD":case"HTML":case"BODY":h_(l);break;default:l.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((l&1024)!==0)throw Error(S(163))}if(l=f.sibling,l!==null){l.return=f.return,Jr=l;break}Jr=f.return}return vr=el,el=!1,vr}function $h(l,f,v){var C=v.flags;switch(v.tag){case 0:case 11:case 15:$s(l,v),C&4&&Uh(5,v);break;case 1:if($s(l,v),C&4)if(l=v.stateNode,f===null)try{l.componentDidMount()}catch(De){qn(v,v.return,De)}else{var O=Xc(v.type,f.memoizedProps);f=f.memoizedState;try{l.componentDidUpdate(O,f,l.__reactInternalSnapshotBeforeUpdate)}catch(De){qn(v,v.return,De)}}C&64&&Wm(v),C&512&&Vu(v,v.return);break;case 3:if($s(l,v),C&64&&(C=v.updateQueue,C!==null)){if(l=null,v.child!==null)switch(v.child.tag){case 27:case 5:l=v.child.stateNode;break;case 1:l=v.child.stateNode}try{Kp(C,l)}catch(De){qn(v,v.return,De)}}break;case 26:$s(l,v),C&512&&Vu(v,v.return);break;case 27:case 5:$s(l,v),f===null&&C&4&&Vh(v),C&512&&Vu(v,v.return);break;case 12:$s(l,v);break;case 13:$s(l,v),C&4&&Wd(l,v);break;case 22:if(O=v.memoizedState!==null||Qo,!O){f=f!==null&&f.memoizedState!==null||ns;var U=Qo,ae=ns;Qo=O,(ns=f)&&!ae?Gu(l,v,(v.subtreeFlags&8772)!==0):$s(l,v),Qo=U,ns=ae}C&512&&(v.memoizedProps.mode==="manual"?Vu(v,v.return):Wr(v,v.return));break;default:$s(l,v)}}function Jp(l){var f=l.alternate;f!==null&&(l.alternate=null,Jp(f)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(f=l.stateNode,f!==null&&nr(f)),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}var js=null,ma=!1;function fc(l,f,v){for(v=v.child;v!==null;)Jm(l,f,v),v=v.sibling}function Jm(l,f,v){if(as&&typeof as.onCommitFiberUnmount=="function")try{as.onCommitFiberUnmount(Da,v)}catch{}switch(v.tag){case 26:ns||Wr(v,f),fc(l,f,v),v.memoizedState?v.memoizedState.count--:v.stateNode&&(v=v.stateNode,v.parentNode.removeChild(v));break;case 27:ns||Wr(v,f);var C=js,O=ma;for(js=v.stateNode,fc(l,f,v),v=v.stateNode,f=v.attributes;f.length;)v.removeAttributeNode(f[0]);nr(v),js=C,ma=O;break;case 5:ns||Wr(v,f);case 6:O=js;var U=ma;if(js=null,fc(l,f,v),js=O,ma=U,js!==null)if(ma)try{l=js,C=v.stateNode,l.nodeType===8?l.parentNode.removeChild(C):l.removeChild(C)}catch(ae){qn(v,f,ae)}else try{js.removeChild(v.stateNode)}catch(ae){qn(v,f,ae)}break;case 18:js!==null&&(ma?(f=js,v=v.stateNode,f.nodeType===8?u_(f.parentNode,v):f.nodeType===1&&u_(f,v),op(f)):u_(js,v.stateNode));break;case 4:C=js,O=ma,js=v.stateNode.containerInfo,ma=!0,fc(l,f,v),js=C,ma=O;break;case 0:case 11:case 14:case 15:ns||dc(2,v,f),ns||dc(4,v,f),fc(l,f,v);break;case 1:ns||(Wr(v,f),C=v.stateNode,typeof C.componentWillUnmount=="function"&&Xm(v,f,C)),fc(l,f,v);break;case 21:fc(l,f,v);break;case 22:ns||Wr(v,f),ns=(C=ns)||v.memoizedState!==null,fc(l,f,v),ns=C;break;default:fc(l,f,v)}}function Wd(l,f){if(f.memoizedState===null&&(l=f.alternate,l!==null&&(l=l.memoizedState,l!==null&&(l=l.dehydrated,l!==null))))try{op(l)}catch(v){qn(f,f.return,v)}}function Xd(l){switch(l.tag){case 13:case 19:var f=l.stateNode;return f===null&&(f=l.stateNode=new Gh),f;case 22:return l=l.stateNode,f=l._retryCache,f===null&&(f=l._retryCache=new Gh),f;default:throw Error(S(435,l.tag))}}function Va(l,f){var v=Xd(l);f.forEach(function(C){var O=Qm.bind(null,l,C);v.has(C)||(v.add(C),C.then(O,O))})}function Qs(l,f){var v=f.deletions;if(v!==null)for(var C=0;C<v.length;C++){var O=v[C],U=l,ae=f,De=ae;e:for(;De!==null;){switch(De.tag){case 27:case 5:js=De.stateNode,ma=!1;break e;case 3:js=De.stateNode.containerInfo,ma=!0;break e;case 4:js=De.stateNode.containerInfo,ma=!0;break e}De=De.return}if(js===null)throw Error(S(160));Jm(U,ae,O),js=null,ma=!1,U=O.alternate,U!==null&&(U.return=null),O.return=null}if(f.subtreeFlags&13878)for(f=f.child;f!==null;)Al(f,l),f=f.sibling}var ea=null;function Al(l,f){var v=l.alternate,C=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:Qs(f,l),Ns(l),C&4&&(dc(3,l,l.return),Uh(3,l),dc(5,l,l.return));break;case 1:Qs(f,l),Ns(l),C&512&&(ns||v===null||Wr(v,v.return)),C&64&&Qo&&(l=l.updateQueue,l!==null&&(C=l.callbacks,C!==null&&(v=l.shared.hiddenCallbacks,l.shared.hiddenCallbacks=v===null?C:v.concat(C))));break;case 26:var O=ea;if(Qs(f,l),Ns(l),C&512&&(ns||v===null||Wr(v,v.return)),C&4){var U=v!==null?v.memoizedState:null;if(C=l.memoizedState,v===null)if(C===null)if(l.stateNode===null){e:{C=l.type,v=l.memoizedProps,O=O.ownerDocument||O;t:switch(C){case"title":U=O.getElementsByTagName("title")[0],(!U||U[lr]||U[Be]||U.namespaceURI==="http://www.w3.org/2000/svg"||U.hasAttribute("itemprop"))&&(U=O.createElement(C),O.head.insertBefore(U,O.querySelector("head > title"))),Es(U,C,v),U[Be]=l,Yr(U),C=U;break e;case"link":var ae=ug("link","href",O).get(C+(v.href||""));if(ae){for(var De=0;De<ae.length;De++)if(U=ae[De],U.getAttribute("href")===(v.href==null?null:v.href)&&U.getAttribute("rel")===(v.rel==null?null:v.rel)&&U.getAttribute("title")===(v.title==null?null:v.title)&&U.getAttribute("crossorigin")===(v.crossOrigin==null?null:v.crossOrigin)){ae.splice(De,1);break t}}U=O.createElement(C),Es(U,C,v),O.head.appendChild(U);break;case"meta":if(ae=ug("meta","content",O).get(C+(v.content||""))){for(De=0;De<ae.length;De++)if(U=ae[De],U.getAttribute("content")===(v.content==null?null:""+v.content)&&U.getAttribute("name")===(v.name==null?null:v.name)&&U.getAttribute("property")===(v.property==null?null:v.property)&&U.getAttribute("http-equiv")===(v.httpEquiv==null?null:v.httpEquiv)&&U.getAttribute("charset")===(v.charSet==null?null:v.charSet)){ae.splice(De,1);break t}}U=O.createElement(C),Es(U,C,v),O.head.appendChild(U);break;default:throw Error(S(468,C))}U[Be]=l,Yr(U),C=U}l.stateNode=C}else g_(O,l.type,l.stateNode);else l.stateNode=p_(O,C,l.memoizedProps);else U!==C?(U===null?v.stateNode!==null&&(v=v.stateNode,v.parentNode.removeChild(v)):U.count--,C===null?g_(O,l.type,l.stateNode):p_(O,C,l.memoizedProps)):C===null&&l.stateNode!==null&&Ym(l,l.memoizedProps,v.memoizedProps)}break;case 27:if(C&4&&l.alternate===null){O=l.stateNode,U=l.memoizedProps;try{for(var Xe=O.firstChild;Xe;){var mt=Xe.nextSibling,ai=Xe.nodeName;Xe[lr]||ai==="HEAD"||ai==="BODY"||ai==="SCRIPT"||ai==="STYLE"||ai==="LINK"&&Xe.rel.toLowerCase()==="stylesheet"||O.removeChild(Xe),Xe=mt}for(var xi=l.type,Ut=O.attributes;Ut.length;)O.removeAttributeNode(Ut[0]);Es(O,xi,U),O[Be]=l,O[Je]=U}catch(vr){qn(l,l.return,vr)}}case 5:if(Qs(f,l),Ns(l),C&512&&(ns||v===null||Wr(v,v.return)),l.flags&32){O=l.stateNode;try{wa(O,"")}catch(vr){qn(l,l.return,vr)}}C&4&&l.stateNode!=null&&(O=l.memoizedProps,Ym(l,O,v!==null?v.memoizedProps:O)),C&1024&&(Io=!0);break;case 6:if(Qs(f,l),Ns(l),C&4){if(l.stateNode===null)throw Error(S(162));C=l.memoizedProps,v=l.stateNode;try{v.nodeValue=C}catch(vr){qn(l,l.return,vr)}}break;case 3:if(cg=null,O=ea,ea=hs(f.containerInfo),Qs(f,l),ea=O,Ns(l),C&4&&v!==null&&v.memoizedState.isDehydrated)try{op(f.containerInfo)}catch(vr){qn(l,l.return,vr)}Io&&(Io=!1,Qc(l));break;case 4:C=ea,ea=hs(l.stateNode.containerInfo),Qs(f,l),Ns(l),ea=C;break;case 12:Qs(f,l),Ns(l);break;case 13:Qs(f,l),Ns(l),l.child.flags&8192&&l.memoizedState!==null!=(v!==null&&v.memoizedState!==null)&&(fn=fs()),C&4&&(C=l.updateQueue,C!==null&&(l.updateQueue=null,Va(l,C)));break;case 22:if(C&512&&(ns||v===null||Wr(v,v.return)),Xe=l.memoizedState!==null,mt=v!==null&&v.memoizedState!==null,ai=Qo,xi=ns,Qo=ai||Xe,ns=xi||mt,Qs(f,l),ns=xi,Qo=ai,Ns(l),f=l.stateNode,f._current=l,f._visibility&=-3,f._visibility|=f._pendingVisibility&2,C&8192&&(f._visibility=Xe?f._visibility&-2:f._visibility|1,Xe&&(f=Qo||ns,v===null||mt||f||qu(l)),l.memoizedProps===null||l.memoizedProps.mode!=="manual"))e:for(v=null,f=l;;){if(f.tag===5||f.tag===26||f.tag===27){if(v===null){mt=v=f;try{if(O=mt.stateNode,Xe)U=O.style,typeof U.setProperty=="function"?U.setProperty("display","none","important"):U.display="none";else{ae=mt.stateNode,De=mt.memoizedProps.style;var ri=De!=null&&De.hasOwnProperty("display")?De.display:null;ae.style.display=ri==null||typeof ri=="boolean"?"":(""+ri).trim()}}catch(vr){qn(mt,mt.return,vr)}}}else if(f.tag===6){if(v===null){mt=f;try{mt.stateNode.nodeValue=Xe?"":mt.memoizedProps}catch(vr){qn(mt,mt.return,vr)}}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===l)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break e;for(;f.sibling===null;){if(f.return===null||f.return===l)break e;v===f&&(v=null),f=f.return}v===f&&(v=null),f.sibling.return=f.return,f=f.sibling}C&4&&(C=l.updateQueue,C!==null&&(v=C.retryQueue,v!==null&&(C.retryQueue=null,Va(l,v))));break;case 19:Qs(f,l),Ns(l),C&4&&(C=l.updateQueue,C!==null&&(l.updateQueue=null,Va(l,C)));break;case 21:break;default:Qs(f,l),Ns(l)}}function Ns(l){var f=l.flags;if(f&2){try{if(l.tag!==27){e:{for(var v=l.return;v!==null;){if(Km(v)){var C=v;break e}v=v.return}throw Error(S(160))}switch(C.tag){case 27:var O=C.stateNode,U=Hh(l);qh(l,U,O);break;case 5:var ae=C.stateNode;C.flags&32&&(wa(ae,""),C.flags&=-33);var De=Hh(l);qh(l,De,ae);break;case 3:case 4:var Xe=C.stateNode.containerInfo,mt=Hh(l);Hu(l,mt,Xe);break;default:throw Error(S(161))}}}catch(ai){qn(l,l.return,ai)}l.flags&=-3}f&4096&&(l.flags&=-4097)}function Qc(l){if(l.subtreeFlags&1024)for(l=l.child;l!==null;){var f=l;Qc(f),f.tag===5&&f.flags&1024&&f.stateNode.reset(),l=l.sibling}}function $s(l,f){if(f.subtreeFlags&8772)for(f=f.child;f!==null;)$h(l,f.alternate,f),f=f.sibling}function qu(l){for(l=l.child;l!==null;){var f=l;switch(f.tag){case 0:case 11:case 14:case 15:dc(4,f,f.return),qu(f);break;case 1:Wr(f,f.return);var v=f.stateNode;typeof v.componentWillUnmount=="function"&&Xm(f,f.return,v),qu(f);break;case 26:case 27:case 5:Wr(f,f.return),qu(f);break;case 22:Wr(f,f.return),f.memoizedState===null&&qu(f);break;default:qu(f)}l=l.sibling}}function Gu(l,f,v){for(v=v&&(f.subtreeFlags&8772)!==0,f=f.child;f!==null;){var C=f.alternate,O=l,U=f,ae=U.flags;switch(U.tag){case 0:case 11:case 15:Gu(O,U,v),Uh(4,U);break;case 1:if(Gu(O,U,v),C=U,O=C.stateNode,typeof O.componentDidMount=="function")try{O.componentDidMount()}catch(mt){qn(C,C.return,mt)}if(C=U,O=C.updateQueue,O!==null){var De=C.stateNode;try{var Xe=O.shared.hiddenCallbacks;if(Xe!==null)for(O.shared.hiddenCallbacks=null,O=0;O<Xe.length;O++)Yp(Xe[O],De)}catch(mt){qn(C,C.return,mt)}}v&&ae&64&&Wm(U),Vu(U,U.return);break;case 26:case 27:case 5:Gu(O,U,v),v&&C===null&&ae&4&&Vh(U),Vu(U,U.return);break;case 12:Gu(O,U,v);break;case 13:Gu(O,U,v),v&&ae&4&&Wd(O,U);break;case 22:U.memoizedState===null&&Gu(O,U,v),Vu(U,U.return);break;default:Gu(O,U,v)}f=f.sibling}}function u(l,f){var v=null;l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(v=l.memoizedState.cachePool.pool),l=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(l=f.memoizedState.cachePool.pool),l!==v&&(l!=null&&l.refCount++,v!=null&&ec(v))}function t(l,f){l=null,f.alternate!==null&&(l=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==l&&(f.refCount++,l!=null&&ec(l))}function n(l,f,v,C){if(f.subtreeFlags&10256)for(f=f.child;f!==null;)c(l,f,v,C),f=f.sibling}function c(l,f,v,C){var O=f.flags;switch(f.tag){case 0:case 11:case 15:n(l,f,v,C),O&2048&&Uh(9,f);break;case 3:n(l,f,v,C),O&2048&&(l=null,f.alternate!==null&&(l=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==l&&(f.refCount++,l!=null&&ec(l)));break;case 12:if(O&2048){n(l,f,v,C),l=f.stateNode;try{var U=f.memoizedProps,ae=U.id,De=U.onPostCommit;typeof De=="function"&&De(ae,f.alternate===null?"mount":"update",l.passiveEffectDuration,-0)}catch(Xe){qn(f,f.return,Xe)}}else n(l,f,v,C);break;case 23:break;case 22:U=f.stateNode,f.memoizedState!==null?U._visibility&4?n(l,f,v,C):y(l,f):U._visibility&4?n(l,f,v,C):(U._visibility|=4,m(l,f,v,C,(f.subtreeFlags&10256)!==0)),O&2048&&u(f.alternate,f);break;case 24:n(l,f,v,C),O&2048&&t(f.alternate,f);break;default:n(l,f,v,C)}}function m(l,f,v,C,O){for(O=O&&(f.subtreeFlags&10256)!==0,f=f.child;f!==null;){var U=l,ae=f,De=v,Xe=C,mt=ae.flags;switch(ae.tag){case 0:case 11:case 15:m(U,ae,De,Xe,O),Uh(8,ae);break;case 23:break;case 22:var ai=ae.stateNode;ae.memoizedState!==null?ai._visibility&4?m(U,ae,De,Xe,O):y(U,ae):(ai._visibility|=4,m(U,ae,De,Xe,O)),O&&mt&2048&&u(ae.alternate,ae);break;case 24:m(U,ae,De,Xe,O),O&&mt&2048&&t(ae.alternate,ae);break;default:m(U,ae,De,Xe,O)}f=f.sibling}}function y(l,f){if(f.subtreeFlags&10256)for(f=f.child;f!==null;){var v=l,C=f,O=C.flags;switch(C.tag){case 22:y(v,C),O&2048&&u(C.alternate,C);break;case 24:y(v,C),O&2048&&t(C.alternate,C);break;default:y(v,C)}f=f.sibling}}var w=8192;function E(l){if(l.subtreeFlags&w)for(l=l.child;l!==null;)R(l),l=l.sibling}function R(l){switch(l.tag){case 26:E(l),l.flags&w&&l.memoizedState!==null&&N0(ea,l.memoizedState,l.memoizedProps);break;case 5:E(l);break;case 3:case 4:var f=ea;ea=hs(l.stateNode.containerInfo),E(l),ea=f;break;case 22:l.memoizedState===null&&(f=l.alternate,f!==null&&f.memoizedState!==null?(f=w,w=16777216,E(l),w=f):E(l));break;default:E(l)}}function L(l){var f=l.alternate;if(f!==null&&(l=f.child,l!==null)){f.child=null;do f=l.sibling,l.sibling=null,l=f;while(l!==null)}}function P(l){var f=l.deletions;if((l.flags&16)!==0){if(f!==null)for(var v=0;v<f.length;v++){var C=f[v];Jr=C,H(C,l)}L(l)}if(l.subtreeFlags&10256)for(l=l.child;l!==null;)F(l),l=l.sibling}function F(l){switch(l.tag){case 0:case 11:case 15:P(l),l.flags&2048&&dc(9,l,l.return);break;case 3:P(l);break;case 12:P(l);break;case 22:var f=l.stateNode;l.memoizedState!==null&&f._visibility&4&&(l.return===null||l.return.tag!==13)?(f._visibility&=-5,j(l)):P(l);break;default:P(l)}}function j(l){var f=l.deletions;if((l.flags&16)!==0){if(f!==null)for(var v=0;v<f.length;v++){var C=f[v];Jr=C,H(C,l)}L(l)}for(l=l.child;l!==null;){switch(f=l,f.tag){case 0:case 11:case 15:dc(8,f,f.return),j(f);break;case 22:v=f.stateNode,v._visibility&4&&(v._visibility&=-5,j(f));break;default:j(f)}l=l.sibling}}function H(l,f){for(;Jr!==null;){var v=Jr;switch(v.tag){case 0:case 11:case 15:dc(8,v,f);break;case 23:case 22:if(v.memoizedState!==null&&v.memoizedState.cachePool!==null){var C=v.memoizedState.cachePool.pool;C!=null&&C.refCount++}break;case 24:ec(v.memoizedState.cache)}if(C=v.child,C!==null)C.return=v,Jr=C;else e:for(v=l;Jr!==null;){C=Jr;var O=C.sibling,U=C.return;if(Jp(C),C===v){Jr=null;break e}if(O!==null){O.return=U,Jr=O;break e}Jr=U}}}function $(l,f,v,C){this.tag=l,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=C,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function G(l,f,v,C){return new $(l,f,v,C)}function te(l){return l=l.prototype,!(!l||!l.isReactComponent)}function X(l,f){var v=l.alternate;return v===null?(v=G(l.tag,f,l.key,l.mode),v.elementType=l.elementType,v.type=l.type,v.stateNode=l.stateNode,v.alternate=l,l.alternate=v):(v.pendingProps=f,v.type=l.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=l.flags&31457280,v.childLanes=l.childLanes,v.lanes=l.lanes,v.child=l.child,v.memoizedProps=l.memoizedProps,v.memoizedState=l.memoizedState,v.updateQueue=l.updateQueue,f=l.dependencies,v.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},v.sibling=l.sibling,v.index=l.index,v.ref=l.ref,v.refCleanup=l.refCleanup,v}function re(l,f){l.flags&=31457282;var v=l.alternate;return v===null?(l.childLanes=0,l.lanes=f,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=v.childLanes,l.lanes=v.lanes,l.child=v.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=v.memoizedProps,l.memoizedState=v.memoizedState,l.updateQueue=v.updateQueue,l.type=v.type,f=v.dependencies,l.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),l}function ce(l,f,v,C,O,U){var ae=0;if(C=l,typeof l=="function")te(l)&&(ae=1);else if(typeof l=="string")ae=__(l,v,Si.current)?26:l==="html"||l==="head"||l==="body"?27:5;else e:switch(l){case q:return fe(v.children,O,U,f);case Z:ae=8,O|=24;break;case Q:return l=G(12,v,f,O|2),l.elementType=Q,l.lanes=U,l;case Se:return l=G(13,v,f,O),l.elementType=Se,l.lanes=U,l;case ee:return l=G(19,v,f,O),l.elementType=ee,l.lanes=U,l;case xe:return Te(v,O,U,f);default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case oe:case ze:ae=10;break e;case de:ae=9;break e;case le:ae=11;break e;case _e:ae=14;break e;case ye:ae=16,C=null;break e}ae=29,v=Error(S(130,l===null?"null":typeof l,"")),C=null}return f=G(ae,v,f,O),f.elementType=l,f.type=C,f.lanes=U,f}function fe(l,f,v,C){return l=G(7,l,C,f),l.lanes=v,l}function Te(l,f,v,C){l=G(22,l,C,f),l.elementType=xe,l.lanes=v;var O={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var U=O._current;if(U===null)throw Error(S(456));if((O._pendingVisibility&2)===0){var ae=co(U,2);ae!==null&&(O._pendingVisibility|=2,Vr(ae,U,2))}},attach:function(){var U=O._current;if(U===null)throw Error(S(456));if((O._pendingVisibility&2)!==0){var ae=co(U,2);ae!==null&&(O._pendingVisibility&=-3,Vr(ae,U,2))}}};return l.stateNode=O,l}function we(l,f,v){return l=G(6,l,null,f),l.lanes=v,l}function Ee(l,f,v){return f=G(4,l.children!==null?l.children:[],l.key,f),f.lanes=v,f.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},f}function ve(l){l.flags|=4}function be(l,f){if(f.type!=="stylesheet"||(f.state.loading&4)!==0)l.flags&=-16777217;else if(l.flags|=16777216,!hg(f)){if(f=Xa.current,f!==null&&((ut&4194176)===ut?Ao!==null:(ut&62914560)!==ut&&(ut&536870912)===0||f!==Ao))throw Nc=bd,Op;l.flags|=8192}}function Ce(l,f){f!==null&&(l.flags|=4),l.flags&16384&&(f=l.tag!==22?Pa():536870912,l.lanes|=f,jr|=f)}function We(l,f){if(!En)switch(l.tailMode){case"hidden":f=l.tail;for(var v=null;f!==null;)f.alternate!==null&&(v=f),f=f.sibling;v===null?l.tail=null:v.sibling=null;break;case"collapsed":v=l.tail;for(var C=null;v!==null;)v.alternate!==null&&(C=v),v=v.sibling;C===null?f||l.tail===null?l.tail=null:l.tail.sibling=null:C.sibling=null}}function ke(l){var f=l.alternate!==null&&l.alternate.child===l.child,v=0,C=0;if(f)for(var O=l.child;O!==null;)v|=O.lanes|O.childLanes,C|=O.subtreeFlags&31457280,C|=O.flags&31457280,O.return=l,O=O.sibling;else for(O=l.child;O!==null;)v|=O.lanes|O.childLanes,C|=O.subtreeFlags,C|=O.flags,O.return=l,O=O.sibling;return l.subtreeFlags|=C,l.childLanes=v,f}function ct(l,f,v){var C=f.pendingProps;switch(Pp(f),f.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ke(f),null;case 1:return ke(f),null;case 3:return v=f.stateNode,C=null,l!==null&&(C=l.memoizedState.cache),f.memoizedState.cache!==C&&(f.flags|=2048),Yo(Is),Gn(),v.pendingContext&&(v.context=v.pendingContext,v.pendingContext=null),(l===null||l.child===null)&&(fl(f)?ve(f):l===null||l.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,Ho!==null&&(ws(Ho),Ho=null))),ke(f),null;case 26:return v=f.memoizedState,l===null?(ve(f),v!==null?(ke(f),be(f,v)):(ke(f),f.flags&=-16777217)):v?v!==l.memoizedState?(ve(f),ke(f),be(f,v)):(ke(f),f.flags&=-16777217):(l.memoizedProps!==C&&ve(f),ke(f),f.flags&=-16777217),null;case 27:Zs(f),v=Cr.current;var O=f.type;if(l!==null&&f.stateNode!=null)l.memoizedProps!==C&&ve(f);else{if(!C){if(f.stateNode===null)throw Error(S(166));return ke(f),null}l=Si.current,fl(f)?Sf(f):(l=d_(O,C,v),f.stateNode=l,ve(f))}return ke(f),null;case 5:if(Zs(f),v=f.type,l!==null&&f.stateNode!=null)l.memoizedProps!==C&&ve(f);else{if(!C){if(f.stateNode===null)throw Error(S(166));return ke(f),null}if(l=Si.current,fl(f))Sf(f);else{switch(O=ag(Cr.current),l){case 1:l=O.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:l=O.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":l=O.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":l=O.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":l=O.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild);break;case"select":l=typeof C.is=="string"?O.createElement("select",{is:C.is}):O.createElement("select"),C.multiple?l.multiple=!0:C.size&&(l.size=C.size);break;default:l=typeof C.is=="string"?O.createElement(v,{is:C.is}):O.createElement(v)}}l[Be]=f,l[Je]=C;e:for(O=f.child;O!==null;){if(O.tag===5||O.tag===6)l.appendChild(O.stateNode);else if(O.tag!==4&&O.tag!==27&&O.child!==null){O.child.return=O,O=O.child;continue}if(O===f)break e;for(;O.sibling===null;){if(O.return===null||O.return===f)break e;O=O.return}O.sibling.return=O.return,O=O.sibling}f.stateNode=l;e:switch(Es(l,v,C),v){case"button":case"input":case"select":case"textarea":l=!!C.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&ve(f)}}return ke(f),f.flags&=-16777217,null;case 6:if(l&&f.stateNode!=null)l.memoizedProps!==C&&ve(f);else{if(typeof C!="string"&&f.stateNode===null)throw Error(S(166));if(l=Cr.current,fl(f)){if(l=f.stateNode,v=f.memoizedProps,C=null,O=Aa,O!==null)switch(O.tag){case 27:case 5:C=O.memoizedProps}l[Be]=f,l=!!(l.nodeValue===v||C!==null&&C.suppressHydrationWarning===!0||l_(l.nodeValue,v)),l||dl(f)}else l=ag(l).createTextNode(C),l[Be]=f,f.stateNode=l}return ke(f),null;case 13:if(C=f.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(O=fl(f),C!==null&&C.dehydrated!==null){if(l===null){if(!O)throw Error(S(318));if(O=f.memoizedState,O=O!==null?O.dehydrated:null,!O)throw Error(S(317));O[Be]=f}else Oc(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;ke(f),O=!1}else Ho!==null&&(ws(Ho),Ho=null),O=!0;if(!O)return f.flags&256?(gl(f),f):(gl(f),null)}if(gl(f),(f.flags&128)!==0)return f.lanes=v,f;if(v=C!==null,l=l!==null&&l.memoizedState!==null,v){C=f.child,O=null,C.alternate!==null&&C.alternate.memoizedState!==null&&C.alternate.memoizedState.cachePool!==null&&(O=C.alternate.memoizedState.cachePool.pool);var U=null;C.memoizedState!==null&&C.memoizedState.cachePool!==null&&(U=C.memoizedState.cachePool.pool),U!==O&&(C.flags|=2048)}return v!==l&&v&&(f.child.flags|=8192),Ce(f,f.updateQueue),ke(f),null;case 4:return Gn(),l===null&&rg(f.stateNode.containerInfo),ke(f),null;case 10:return Yo(f.type),ke(f),null;case 19:if(gt(kn),O=f.memoizedState,O===null)return ke(f),null;if(C=(f.flags&128)!==0,U=O.rendering,U===null)if(C)We(O,!1);else{if(ti!==0||l!==null&&(l.flags&128)!==0)for(l=f.child;l!==null;){if(U=Eu(l),U!==null){for(f.flags|=128,We(O,!1),l=U.updateQueue,f.updateQueue=l,Ce(f,l),f.subtreeFlags=0,l=v,v=f.child;v!==null;)re(v,l),v=v.sibling;return Tt(kn,kn.current&1|2),f.child}l=l.sibling}O.tail!==null&&fs()>Yi&&(f.flags|=128,C=!0,We(O,!1),f.lanes=4194304)}else{if(!C)if(l=Eu(U),l!==null){if(f.flags|=128,C=!0,l=l.updateQueue,f.updateQueue=l,Ce(f,l),We(O,!0),O.tail===null&&O.tailMode==="hidden"&&!U.alternate&&!En)return ke(f),null}else 2*fs()-O.renderingStartTime>Yi&&v!==536870912&&(f.flags|=128,C=!0,We(O,!1),f.lanes=4194304);O.isBackwards?(U.sibling=f.child,f.child=U):(l=O.last,l!==null?l.sibling=U:f.child=U,O.last=U)}return O.tail!==null?(f=O.tail,O.rendering=f,O.tail=f.sibling,O.renderingStartTime=fs(),f.sibling=null,l=kn.current,Tt(kn,C?l&1|2:l&1),f):(ke(f),null);case 22:case 23:return gl(f),ml(),C=f.memoizedState!==null,l!==null?l.memoizedState!==null!==C&&(f.flags|=8192):C&&(f.flags|=8192),C?(v&536870912)!==0&&(f.flags&128)===0&&(ke(f),f.subtreeFlags&6&&(f.flags|=8192)):ke(f),v=f.updateQueue,v!==null&&Ce(f,v.retryQueue),v=null,l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(v=l.memoizedState.cachePool.pool),C=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(C=f.memoizedState.cachePool.pool),C!==v&&(f.flags|=2048),l!==null&&gt(Cu),null;case 24:return v=null,l!==null&&(v=l.memoizedState.cache),f.memoizedState.cache!==v&&(f.flags|=2048),Yo(Is),ke(f),null;case 25:return null}throw Error(S(156,f.tag))}function Ze(l,f){switch(Pp(f),f.tag){case 1:return l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 3:return Yo(Is),Gn(),l=f.flags,(l&65536)!==0&&(l&128)===0?(f.flags=l&-65537|128,f):null;case 26:case 27:case 5:return Zs(f),null;case 13:if(gl(f),l=f.memoizedState,l!==null&&l.dehydrated!==null){if(f.alternate===null)throw Error(S(340));Oc()}return l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 19:return gt(kn),null;case 4:return Gn(),null;case 10:return Yo(f.type),null;case 22:case 23:return gl(f),ml(),l!==null&&gt(Cu),l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 24:return Yo(Is),null;case 25:return null;default:return null}}function ot(l,f){switch(Pp(f),f.tag){case 3:Yo(Is),Gn();break;case 26:case 27:case 5:Zs(f);break;case 4:Gn();break;case 13:gl(f);break;case 19:gt(kn);break;case 10:Yo(f.type);break;case 22:case 23:gl(f),ml(),l!==null&&gt(Cu);break;case 24:Yo(Is)}}var Bt={getCacheForType:function(l){var f=Js(Is),v=f.data.get(l);return v===void 0&&(v=l(),f.data.set(l,v)),v}},Ye=typeof WeakMap=="function"?WeakMap:Map,Oe=0,nt=null,Ge=null,ut=0,_t=0,$t=null,Rt=!1,St=!1,gi=!1,li=0,ti=0,ci=0,Oi=0,Ki=0,Hi=0,jr=0,qi=null,yr=null,Ur=!1,fn=0,Yi=1/0,Or=null,Tr=null,Nr=!1,nn=null,zn=0,us=0,gn=null,Ji=0,Di=null;function wr(){if((Oe&2)!==0&&ut!==0)return ut&-ut;if(lt.T!==null){var l=yl;return l!==0?l:Xf()}return Pe()}function jn(){Hi===0&&(Hi=(ut&536870912)===0||En?Hs():536870912);var l=Xa.current;return l!==null&&(l.flags|=32),Hi}function Vr(l,f,v){(l===nt&&_t===2||l.cancelPendingCommit!==null)&&(_a(l,0),Ts(l,ut,Hi,!1)),He(l,v),((Oe&2)===0||l!==nt)&&(l===nt&&((Oe&2)===0&&(Oi|=v),ti===4&&Ts(l,ut,Hi,!1)),ya(l))}function es(l,f,v){if((Oe&6)!==0)throw Error(S(327));var C=!v&&(f&60)===0&&(f&l.expiredLanes)===0||xs(l,f),O=C?ts(l,f):ss(l,f,!0),U=C;do{if(O===0){St&&!C&&Ts(l,f,0,!1);break}else if(O===6)Ts(l,f,0,!Rt);else{if(v=l.current.alternate,U&&!mo(v)){O=ss(l,f,!1),U=!1;continue}if(O===2){if(U=f,l.errorRecoveryDisabledLanes&U)var ae=0;else ae=l.pendingLanes&-536870913,ae=ae!==0?ae:ae&536870912?536870912:0;if(ae!==0){f=ae;e:{var De=l;O=qi;var Xe=De.current.memoizedState.isDehydrated;if(Xe&&(_a(De,ae).flags|=256),ae=ss(De,ae,!1),ae!==2){if(gi&&!Xe){De.errorRecoveryDisabledLanes|=U,Oi|=U,O=4;break e}U=yr,yr=O,U!==null&&ws(U)}O=ae}if(U=!1,O!==2)continue}}if(O===1){_a(l,0),Ts(l,f,0,!0);break}e:{switch(C=l,O){case 0:case 1:throw Error(S(345));case 4:if((f&4194176)===f){Ts(C,f,Hi,!Rt);break e}break;case 2:yr=null;break;case 3:case 5:break;default:throw Error(S(329))}if(C.finishedWork=v,C.finishedLanes=f,(f&62914560)===f&&(U=fn+300-fs(),10<U)){if(Ts(C,f,Hi,!Rt),xn(C,0)!==0)break e;C.timeoutHandle=Yh(Ja.bind(null,C,v,yr,Or,Ur,f,Hi,Oi,jr,Rt,2,-0,0),U);break e}Ja(C,v,yr,Or,Ur,f,Hi,Oi,jr,Rt,0,-0,0)}}break}while(!0);ya(l)}function ws(l){yr===null?yr=l:yr.push.apply(yr,l)}function Ja(l,f,v,C,O,U,ae,De,Xe,mt,ai,xi,Ut){var ri=f.subtreeFlags;if((ri&8192||(ri&16785408)===16785408)&&(rp={stylesheets:null,count:0,unsuspend:j0},R(f),f=k0(),f!==null)){l.cancelPendingCommit=f(rl.bind(null,l,v,C,O,ae,De,Xe,1,xi,Ut)),Ts(l,U,ae,!mt);return}rl(l,v,C,O,ae,De,Xe,ai,xi,Ut)}function mo(l){for(var f=l;;){var v=f.tag;if((v===0||v===11||v===15)&&f.flags&16384&&(v=f.updateQueue,v!==null&&(v=v.stores,v!==null)))for(var C=0;C<v.length;C++){var O=v[C],U=O.getSnapshot;O=O.value;try{if(!Wa(U(),O))return!1}catch{return!1}}if(v=f.child,f.subtreeFlags&16384&&v!==null)v.return=f,f=v;else{if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function Ts(l,f,v,C){f&=~Ki,f&=~Oi,l.suspendedLanes|=f,l.pingedLanes&=~f,C&&(l.warmLanes|=f),C=l.expirationTimes;for(var O=f;0<O;){var U=31-os(O),ae=1<<U;C[U]=-1,O&=~ae}v!==0&&ie(l,v,f)}function ga(){return(Oe&6)===0?(nl(0),!1):!0}function ta(){if(Ge!==null){if(_t===0)var l=Ge.return;else l=Ge,po=cc=null,Rh(l),Kl=null,Jl=0,l=Ge;for(;l!==null;)ot(l.alternate,l),l=l.return;Ge=null}}function _a(l,f){l.finishedWork=null,l.finishedLanes=0;var v=l.timeoutHandle;v!==-1&&(l.timeoutHandle=-1,om(v)),v=l.cancelPendingCommit,v!==null&&(l.cancelPendingCommit=null,v()),ta(),nt=l,Ge=v=X(l.current,null),ut=f,_t=0,$t=null,Rt=!1,St=xs(l,f),gi=!1,jr=Hi=Ki=Oi=ci=ti=0,yr=qi=null,Ur=!1,(f&8)!==0&&(f|=f&32);var C=l.entangledLanes;if(C!==0)for(l=l.entanglements,C&=f;0<C;){var O=31-os(C),U=1<<O;f|=l[O],C&=~U}return li=f,Vt(),v}function zo(l,f){rn=null,lt.H=Xo,f===pl?(f=Ef(),_t=3):f===Op?(f=Ef(),_t=4):_t=f===oc?8:f!==null&&typeof f=="object"&&typeof f.then=="function"?6:1,$t=f,Ge===null&&(ti=1,Nh(l,ms(f,l.current)))}function Bn(){var l=lt.H;return lt.H=Xo,l===null?Xo:l}function Hn(){var l=lt.A;return lt.A=Bt,l}function vn(){ti=4,Rt||(ut&4194176)!==ut&&Xa.current!==null||(St=!0),(ci&134217727)===0&&(Oi&134217727)===0||nt===null||Ts(nt,ut,Hi,!1)}function ss(l,f,v){var C=Oe;Oe|=2;var O=Bn(),U=Hn();(nt!==l||ut!==f)&&(Or=null,_a(l,f)),f=!1;var ae=ti;e:do try{if(_t!==0&&Ge!==null){var De=Ge,Xe=$t;switch(_t){case 8:ta(),ae=6;break e;case 3:case 2:case 6:Xa.current===null&&(f=!0);var mt=_t;if(_t=0,$t=null,Ca(l,De,Xe,mt),v&&St){ae=0;break e}break;default:mt=_t,_t=0,$t=null,Ca(l,De,Xe,mt)}}Ss(),ae=ti;break}catch(ai){zo(l,ai)}while(!0);return f&&l.shellSuspendCounter++,po=cc=null,Oe=C,lt.H=O,lt.A=U,Ge===null&&(nt=null,ut=0,Vt()),ae}function Ss(){for(;Ge!==null;)tl(Ge)}function ts(l,f){var v=Oe;Oe|=2;var C=Bn(),O=Hn();nt!==l||ut!==f?(Or=null,Yi=fs()+500,_a(l,f)):St=xs(l,f);e:do try{if(_t!==0&&Ge!==null){f=Ge;var U=$t;t:switch(_t){case 1:_t=0,$t=null,Ca(l,f,U,1);break;case 2:if(jp(U)){_t=0,$t=null,Cl(f);break}f=function(){_t===2&&nt===l&&(_t=7),ya(l)},U.then(f,f);break e;case 3:_t=7;break e;case 4:_t=5;break e;case 7:jp(U)?(_t=0,$t=null,Cl(f)):(_t=0,$t=null,Ca(l,f,U,7));break;case 5:var ae=null;switch(Ge.tag){case 26:ae=Ge.memoizedState;case 5:case 27:var De=Ge;if(!ae||hg(ae)){_t=0,$t=null;var Xe=De.sibling;if(Xe!==null)Ge=Xe;else{var mt=De.return;mt!==null?(Ge=mt,il(mt)):Ge=null}break t}}_t=0,$t=null,Ca(l,f,U,5);break;case 6:_t=0,$t=null,Ca(l,f,U,6);break;case 8:ta(),ti=6;break e;default:throw Error(S(462))}}ia();break}catch(ai){zo(l,ai)}while(!0);return po=cc=null,lt.H=C,lt.A=O,Oe=v,Ge!==null?0:(nt=null,ut=0,Vt(),ti)}function ia(){for(;Ge!==null&&!za();)tl(Ge)}function tl(l){var f=cs(l.alternate,l,li);l.memoizedProps=l.pendingProps,f===null?il(l):Ge=f}function Cl(l){var f=l,v=f.alternate;switch(f.tag){case 15:case 0:f=Fd(v,f,f.pendingProps,f.type,void 0,ut);break;case 11:f=Fd(v,f,f.pendingProps,f.type.render,f.ref,ut);break;case 5:Rh(f);default:ot(v,f),f=Ge=re(f,li),f=cs(v,f,li)}l.memoizedProps=l.pendingProps,f===null?il(l):Ge=f}function Ca(l,f,v,C){po=cc=null,Rh(f),Kl=null,Jl=0;var O=f.return;try{if(fa(l,O,f,v,ut)){ti=1,Nh(l,ms(v,l.current)),Ge=null;return}}catch(U){if(O!==null)throw Ge=O,U;ti=1,Nh(l,ms(v,l.current)),Ge=null;return}f.flags&32768?(En||C===1?l=!0:St||(ut&536870912)!==0?l=!1:(Rt=l=!0,(C===2||C===3||C===6)&&(C=Xa.current,C!==null&&C.tag===13&&(C.flags|=16384))),pc(f,l)):il(f)}function il(l){var f=l;do{if((f.flags&32768)!==0){pc(f,Rt);return}l=f.return;var v=ct(f.alternate,f,li);if(v!==null){Ge=v;return}if(f=f.sibling,f!==null){Ge=f;return}Ge=f=l}while(f!==null);ti===0&&(ti=5)}function pc(l,f){do{var v=Ze(l.alternate,l);if(v!==null){v.flags&=32767,Ge=v;return}if(v=l.return,v!==null&&(v.flags|=32768,v.subtreeFlags=0,v.deletions=null),!f&&(l=l.sibling,l!==null)){Ge=l;return}Ge=l=v}while(l!==null);ti=6,Ge=null}function rl(l,f,v,C,O,U,ae,De,Xe,mt){var ai=lt.T,xi=ii.p;try{ii.p=2,lt.T=null,Zh(l,f,v,C,xi,O,U,ae,De,Xe,mt)}finally{lt.T=ai,ii.p=xi}}function Zh(l,f,v,C,O,U,ae,De){do Ha();while(nn!==null);if((Oe&6)!==0)throw Error(S(327));var Xe=l.finishedWork;if(C=l.finishedLanes,Xe===null)return null;if(l.finishedWork=null,l.finishedLanes=0,Xe===l.current)throw Error(S(177));l.callbackNode=null,l.callbackPriority=0,l.cancelPendingCommit=null;var mt=Xe.lanes|Xe.childLanes;if(mt|=_h,J(l,C,mt,U,ae,De),l===nt&&(Ge=nt=null,ut=0),(Xe.subtreeFlags&10256)===0&&(Xe.flags&10256)===0||Nr||(Nr=!0,us=mt,gn=v,H1(Ds,function(){return Ha(),null})),v=(Xe.flags&15990)!==0,(Xe.subtreeFlags&15990)!==0||v?(v=lt.T,lt.T=null,U=ii.p,ii.p=2,ae=Oe,Oe|=4,Zd(l,Xe),Al(Xe,l),mh(Yd,l.containerInfo),dm=!!sg,Yd=sg=null,l.current=Xe,$h(l,Xe.alternate,Xe),La(),Oe=ae,ii.p=U,lt.T=v):l.current=Xe,Nr?(Nr=!1,nn=l,zn=C):Rl(l,mt),mt=l.pendingLanes,mt===0&&(Tr=null),va(Xe.stateNode),ya(l),f!==null)for(O=l.onRecoverableError,Xe=0;Xe<f.length;Xe++)mt=f[Xe],O(mt.value,{componentStack:mt.stack});return(zn&3)!==0&&Ha(),mt=l.pendingLanes,(C&4194218)!==0&&(mt&42)!==0?l===Di?Ji++:(Ji=0,Di=l):Ji=0,nl(0),null}function Rl(l,f){(l.pooledCacheLanes&=f)===0&&(f=l.pooledCache,f!=null&&(l.pooledCache=null,ec(f)))}function Ha(){if(nn!==null){var l=nn,f=us;us=0;var v=je(zn),C=lt.T,O=ii.p;try{if(ii.p=32>v?32:v,lt.T=null,nn===null)var U=!1;else{v=gn,gn=null;var ae=nn,De=zn;if(nn=null,zn=0,(Oe&6)!==0)throw Error(S(331));var Xe=Oe;if(Oe|=4,F(ae.current),c(ae,ae.current,De,v),Oe=Xe,nl(0,!1),as&&typeof as.onPostCommitFiberRoot=="function")try{as.onPostCommitFiberRoot(Da,ae)}catch{}U=!0}return U}finally{ii.p=O,lt.T=C,Rl(l,f)}}return!1}function Ml(l,f,v){f=ms(v,f),f=Gp(l.stateNode,f,2),l=Jo(l,f,2),l!==null&&(He(l,2),ya(l))}function qn(l,f,v){if(l.tag===3)Ml(l,l,v);else for(;f!==null;){if(f.tag===3){Ml(f,l,v);break}else if(f.tag===1){var C=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof C.componentDidCatch=="function"&&(Tr===null||!Tr.has(C))){l=ms(v,l),v=$p(2),C=Jo(f,v,2),C!==null&&(Zp(v,C,f,l),He(C,2),ya(C));break}}f=f.return}}function ra(l,f,v){var C=l.pingCache;if(C===null){C=l.pingCache=new Ye;var O=new Set;C.set(f,O)}else O=C.get(f),O===void 0&&(O=new Set,C.set(f,O));O.has(v)||(gi=!0,O.add(v),l=Wf.bind(null,l,f,v),f.then(l,l))}function Wf(l,f,v){var C=l.pingCache;C!==null&&C.delete(f),l.pingedLanes|=l.suspendedLanes&v,l.warmLanes&=~v,nt===l&&(ut&v)===v&&(ti===4||ti===3&&(ut&62914560)===ut&&300>fs()-fn?(Oe&2)===0&&_a(l,0):Ki|=v,jr===ut&&(jr=0)),ya(l)}function b0(l,f){f===0&&(f=Pa()),l=co(l,f),l!==null&&(He(l,f),ya(l))}function V1(l){var f=l.memoizedState,v=0;f!==null&&(v=f.retryLane),b0(l,v)}function Qm(l,f){var v=0;switch(l.tag){case 13:var C=l.stateNode,O=l.memoizedState;O!==null&&(v=O.retryLane);break;case 19:C=l.stateNode;break;case 22:C=l.stateNode._retryCache;break;default:throw Error(S(314))}C!==null&&C.delete(f),b0(l,v)}function H1(l,f){return Jn(l,f)}var Qp=null,$u=null,Yg=!1,em=!1,Kg=!1,Zu=0;function ya(l){l!==$u&&l.next===null&&($u===null?Qp=$u=l:$u=$u.next=l),em=!0,Yg||(Yg=!0,im(w0))}function nl(l,f){if(!Kg&&em){Kg=!0;do for(var v=!1,C=Qp;C!==null;){if(l!==0){var O=C.pendingLanes;if(O===0)var U=0;else{var ae=C.suspendedLanes,De=C.pingedLanes;U=(1<<31-os(42|l)+1)-1,U&=O&~(ae&~De),U=U&201326677?U&201326677|1:U?U|2:0}U!==0&&(v=!0,eg(C,U))}else U=ut,U=xn(C,C===nt?U:0),(U&3)===0||xs(C,U)||(v=!0,eg(C,U));C=C.next}while(v);Kg=!1}}function w0(){em=Yg=!1;var l=0;Zu!==0&&(R0()&&(l=Zu),Zu=0);for(var f=fs(),v=null,C=Qp;C!==null;){var O=C.next,U=Jg(C,f);U===0?(C.next=null,v===null?Qp=O:v.next=O,O===null&&($u=v)):(v=C,(l!==0||(U&3)!==0)&&(em=!0)),C=O}nl(l)}function Jg(l,f){for(var v=l.suspendedLanes,C=l.pingedLanes,O=l.expirationTimes,U=l.pendingLanes&-62914561;0<U;){var ae=31-os(U),De=1<<ae,Xe=O[ae];Xe===-1?((De&v)===0||(De&C)!==0)&&(O[ae]=Ct(De,f)):Xe<=f&&(l.expiredLanes|=De),U&=~De}if(f=nt,v=ut,v=xn(l,l===f?v:0),C=l.callbackNode,v===0||l===f&&_t===2||l.cancelPendingCommit!==null)return C!==null&&C!==null&&Rs(C),l.callbackNode=null,l.callbackPriority=0;if((v&3)===0||xs(l,v)){if(f=v&-v,f===l.callbackPriority)return f;switch(C!==null&&Rs(C),je(v)){case 2:case 8:v=Xn;break;case 32:v=Ds;break;case 268435456:v=Vs;break;default:v=Ds}return C=tm.bind(null,l),v=Jn(v,C),l.callbackPriority=f,l.callbackNode=v,f}return C!==null&&C!==null&&Rs(C),l.callbackPriority=2,l.callbackNode=null,2}function tm(l,f){var v=l.callbackNode;if(Ha()&&l.callbackNode!==v)return null;var C=ut;return C=xn(l,l===nt?C:0),C===0?null:(es(l,C,f),Jg(l,fs()),l.callbackNode!=null&&l.callbackNode===v?tm.bind(null,l):null)}function eg(l,f){if(Ha())return null;es(l,f,!0)}function im(l){q1(function(){(Oe&6)!==0?Jn($n,l):l()})}function Xf(){return Zu===0&&(Zu=Hs()),Zu}function Qg(l){return l==null||typeof l=="symbol"||typeof l=="boolean"?null:typeof l=="function"?l:Ec(""+l)}function rm(l,f){var v=f.ownerDocument.createElement("input");return v.name=f.name,v.value=f.value,l.id&&v.setAttribute("form",l.id),f.parentNode.insertBefore(v,f),l=new FormData(l),v.parentNode.removeChild(v),l}function e_(l,f,v,C,O){if(f==="submit"&&v&&v.stateNode===O){var U=Qg((O[Je]||null).action),ae=C.submitter;ae&&(f=(f=ae[Je]||null)?Qg(f.formAction):ae.getAttribute("formAction"),f!==null&&(U=f,ae=null));var De=new cd("action","action",null,C,O);l.push({event:De,listeners:[{instance:null,listener:function(){if(C.defaultPrevented){if(Zu!==0){var Xe=ae?rm(O,ae):new FormData(O);Wo(v,{pending:!0,data:Xe,method:O.method,action:U},null,Xe)}}else typeof U=="function"&&(De.preventDefault(),Xe=ae?rm(O,ae):new FormData(O),Wo(v,{pending:!0,data:Xe,method:O.method,action:U},U,Xe))},currentTarget:O}]})}}for(var nm=0;nm<Tu.length;nm++){var tg=Tu[nm],T0=tg.toLowerCase(),Wh=tg[0].toUpperCase()+tg.slice(1);lo(T0,"on"+Wh)}lo(Mp,"onAnimationEnd"),lo(Ip,"onAnimationIteration"),lo(zp,"onAnimationStart"),lo("dblclick","onDoubleClick"),lo("focusin","onFocus"),lo("focusout","onBlur"),lo(bu,"onTransitionRun"),lo(yd,"onTransitionStart"),lo(Lp,"onTransitionCancel"),lo(bf,"onTransitionEnd"),Qt("onMouseEnter",["mouseout","mouseover"]),Qt("onMouseLeave",["mouseout","mouseover"]),Qt("onPointerEnter",["pointerout","pointerover"]),Qt("onPointerLeave",["pointerout","pointerover"]),Ft("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ft("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ft("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ft("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ft("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ft("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),t_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Yf));function i_(l,f){f=(f&4)!==0;for(var v=0;v<l.length;v++){var C=l[v],O=C.event;C=C.listeners;e:{var U=void 0;if(f)for(var ae=C.length-1;0<=ae;ae--){var De=C[ae],Xe=De.instance,mt=De.currentTarget;if(De=De.listener,Xe!==U&&O.isPropagationStopped())break e;U=De,O.currentTarget=mt;try{U(O)}catch(ai){Nd(ai)}O.currentTarget=null,U=Xe}else for(ae=0;ae<C.length;ae++){if(De=C[ae],Xe=De.instance,mt=De.currentTarget,De=De.listener,Xe!==U&&O.isPropagationStopped())break e;U=De,O.currentTarget=mt;try{U(O)}catch(ai){Nd(ai)}O.currentTarget=null,U=Xe}}}}function Ln(l,f){var v=f[vt];v===void 0&&(v=f[vt]=new Set);var C=l+"__bubble";v.has(C)||(n_(f,l,2,!1),v.add(C))}function r_(l,f,v){var C=0;f&&(C|=4),n_(v,l,C,f)}var ig="_reactListening"+Math.random().toString(36).slice(2);function rg(l){if(!l[ig]){l[ig]=!0,Ve.forEach(function(v){v!=="selectionchange"&&(t_.has(v)||r_(v,!1,l),r_(v,!0,l))});var f=l.nodeType===9?l:l.ownerDocument;f===null||f[ig]||(f[ig]=!0,r_("selectionchange",!1,f))}}function n_(l,f,v,C){switch(pg(f)){case 2:var O=fg;break;case 8:O=H0;break;default:O=fm}v=O.bind(null,f,v,l),O=void 0,!Mr||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(O=!0),C?O!==void 0?l.addEventListener(f,v,{capture:!0,passive:O}):l.addEventListener(f,v,!0):O!==void 0?l.addEventListener(f,v,{passive:O}):l.addEventListener(f,v,!1)}function s_(l,f,v,C,O){var U=C;if((f&1)===0&&(f&2)===0&&C!==null)e:for(;;){if(C===null)return;var ae=C.tag;if(ae===3||ae===4){var De=C.stateNode.containerInfo;if(De===O||De.nodeType===8&&De.parentNode===O)break;if(ae===4)for(ae=C.return;ae!==null;){var Xe=ae.tag;if((Xe===3||Xe===4)&&(Xe=ae.stateNode.containerInfo,Xe===O||Xe.nodeType===8&&Xe.parentNode===O))return;ae=ae.return}for(;De!==null;){if(ae=cr(De),ae===null)return;if(Xe=ae.tag,Xe===5||Xe===6||Xe===26||Xe===27){C=U=ae;continue e}De=De.parentNode}}C=C.return}ff(function(){var mt=U,ai=Oa(v),xi=[];e:{var Ut=wu.get(l);if(Ut!==void 0){var ri=cd,vr=l;switch(l){case"keypress":if(Bl(v)===0)break e;case"keydown":case"keyup":ri=Zr;break;case"focusin":vr="focus",ri=fh;break;case"focusout":vr="blur",ri=fh;break;case"beforeblur":case"afterblur":ri=fh;break;case"click":if(v.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ri=Za;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ri=ao;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ri=qr;break;case Mp:case Ip:case zp:ri=$r;break;case bf:ri=Ic;break;case"scroll":case"scrollend":ri=hh;break;case"wheel":ri=la;break;case"copy":case"cut":case"paste":ri=jm;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ri=Na;break;case"toggle":case"beforetoggle":ri=Xg}var Qr=(f&4)!==0,_s=!Qr&&(l==="scroll"||l==="scrollend"),Mt=Qr?Ut!==null?Ut+"Capture":null:Ut;Qr=[];for(var pt=mt,Pt;pt!==null;){var di=pt;if(Pt=di.stateNode,di=di.tag,di!==5&&di!==26&&di!==27||Pt===null||Mt===null||(di=Rc(pt,Mt),di!=null&&Qr.push(Kf(pt,di,Pt))),_s)break;pt=pt.return}0<Qr.length&&(Ut=new ri(Ut,vr,null,v,ai),xi.push({event:Ut,listeners:Qr}))}}if((f&7)===0){e:{if(Ut=l==="mouseover"||l==="pointerover",ri=l==="mouseout"||l==="pointerout",Ut&&v!==Ac&&(vr=v.relatedTarget||v.fromElement)&&(cr(vr)||vr[Lt]))break e;if((ri||Ut)&&(Ut=ai.window===ai?ai:(Ut=ai.ownerDocument)?Ut.defaultView||Ut.parentWindow:window,ri?(vr=v.relatedTarget||v.toElement,ri=mt,vr=vr?cr(vr):null,vr!==null&&(_s=Fi(vr),Qr=vr.tag,vr!==_s||Qr!==5&&Qr!==27&&Qr!==6)&&(vr=null)):(ri=null,vr=mt),ri!==vr)){if(Qr=Za,di="onMouseLeave",Mt="onMouseEnter",pt="mouse",(l==="pointerout"||l==="pointerover")&&(Qr=Na,di="onPointerLeave",Mt="onPointerEnter",pt="pointer"),_s=ri==null?Ut:ur(ri),Pt=vr==null?Ut:ur(vr),Ut=new Qr(di,pt+"leave",ri,v,ai),Ut.target=_s,Ut.relatedTarget=Pt,di=null,cr(ai)===mt&&(Qr=new Qr(Mt,pt+"enter",vr,v,ai),Qr.target=Pt,Qr.relatedTarget=_s,di=Qr),_s=di,ri&&vr)t:{for(Qr=ri,Mt=vr,pt=0,Pt=Qr;Pt;Pt=Jf(Pt))pt++;for(Pt=0,di=Mt;di;di=Jf(di))Pt++;for(;0<pt-Pt;)Qr=Jf(Qr),pt--;for(;0<Pt-pt;)Mt=Jf(Mt),Pt--;for(;pt--;){if(Qr===Mt||Mt!==null&&Qr===Mt.alternate)break t;Qr=Jf(Qr),Mt=Jf(Mt)}Qr=null}else Qr=null;ri!==null&&a_(xi,Ut,ri,Qr,!1),vr!==null&&_s!==null&&a_(xi,_s,vr,Qr,!0)}}e:{if(Ut=mt?ur(mt):window,ri=Ut.nodeName&&Ut.nodeName.toLowerCase(),ri==="select"||ri==="input"&&Ut.type==="file")var hr=ki;else if(ir(Ut))if(yf)hr=zc;else{hr=Gl;var bn=Cp}else ri=Ut.nodeName,!ri||ri.toLowerCase()!=="input"||Ut.type!=="checkbox"&&Ut.type!=="radio"?mt&&lu(mt.elementType)&&(hr=ki):hr=Ea;if(hr&&(hr=hr(l,mt))){ni(xi,hr,v,ai);break e}bn&&bn(l,Ut,mt),l==="focusout"&&mt&&Ut.type==="number"&&mt.memoizedProps.value!=null&&ch(Ut,"number",Ut.value)}switch(bn=mt?ur(mt):window,l){case"focusin":(ir(bn)||bn.contentEditable==="true")&&(Zl=bn,gh=mt,So=null);break;case"focusout":So=gh=Zl=null;break;case"mousedown":Wl=!0;break;case"contextmenu":case"mouseup":case"dragend":Wl=!1,Bm(xi,v,ai);break;case"selectionchange":if(km)break;case"keydown":case"keyup":Bm(xi,v,ai)}var Ir;if(dd)e:{switch(l){case"compositionstart":var Fr="onCompositionStart";break e;case"compositionend":Fr="onCompositionEnd";break e;case"compositionupdate":Fr="onCompositionUpdate";break e}Fr=void 0}else mu?wo(l,v)&&(Fr="onCompositionEnd"):l==="keydown"&&v.keyCode===229&&(Fr="onCompositionStart");Fr&&(Vl&&v.locale!=="ko"&&(mu||Fr!=="onCompositionStart"?Fr==="onCompositionEnd"&&mu&&(Ir=kl()):(Nl=ai,pf="value"in Nl?Nl.value:Nl.textContent,mu=!0)),bn=ng(mt,Fr),0<bn.length&&(Fr=new Li(Fr,l,null,v,ai),xi.push({event:Fr,listeners:bn}),Ir?Fr.data=Ir:(Ir=Sa(v),Ir!==null&&(Fr.data=Ir)))),(Ir=fd?ph(l,v):vs(l,v))&&(Fr=ng(mt,"onBeforeInput"),0<Fr.length&&(bn=new Li("onBeforeInput","beforeinput",null,v,ai),xi.push({event:bn,listeners:Fr}),bn.data=Ir)),e_(xi,l,mt,v,ai)}i_(xi,f)})}function Kf(l,f,v){return{instance:l,listener:f,currentTarget:v}}function ng(l,f){for(var v=f+"Capture",C=[];l!==null;){var O=l,U=O.stateNode;O=O.tag,O!==5&&O!==26&&O!==27||U===null||(O=Rc(l,v),O!=null&&C.unshift(Kf(l,O,U)),O=Rc(l,f),O!=null&&C.push(Kf(l,O,U))),l=l.return}return C}function Jf(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5&&l.tag!==27);return l||null}function a_(l,f,v,C,O){for(var U=f._reactName,ae=[];v!==null&&v!==C;){var De=v,Xe=De.alternate,mt=De.stateNode;if(De=De.tag,Xe!==null&&Xe===C)break;De!==5&&De!==26&&De!==27||mt===null||(Xe=mt,O?(mt=Rc(v,U),mt!=null&&ae.unshift(Kf(v,mt,Xe))):O||(mt=Rc(v,U),mt!=null&&ae.push(Kf(v,mt,Xe)))),v=v.return}ae.length!==0&&l.push({event:f,listeners:ae})}var S0=/\r\n?/g,E0=/\u0000|\uFFFD/g;function o_(l){return(typeof l=="string"?l:""+l).replace(S0,`
`).replace(E0,"")}function l_(l,f){return f=o_(f),o_(l)===f}function sm(){}function is(l,f,v,C,O,U){switch(v){case"children":typeof C=="string"?f==="body"||f==="textarea"&&C===""||wa(l,C):(typeof C=="number"||typeof C=="bigint")&&f!=="body"&&wa(l,""+C);break;case"className":Yn(l,"class",C);break;case"tabIndex":Yn(l,"tabindex",C);break;case"dir":case"role":case"viewBox":case"width":case"height":Yn(l,v,C);break;case"style":df(l,C,U);break;case"data":if(f!=="object"){Yn(l,"data",C);break}case"src":case"href":if(C===""&&(f!=="a"||v!=="href")){l.removeAttribute(v);break}if(C==null||typeof C=="function"||typeof C=="symbol"||typeof C=="boolean"){l.removeAttribute(v);break}C=Ec(""+C),l.setAttribute(v,C);break;case"action":case"formAction":if(typeof C=="function"){l.setAttribute(v,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof U=="function"&&(v==="formAction"?(f!=="input"&&is(l,f,"name",O.name,O,null),is(l,f,"formEncType",O.formEncType,O,null),is(l,f,"formMethod",O.formMethod,O,null),is(l,f,"formTarget",O.formTarget,O,null)):(is(l,f,"encType",O.encType,O,null),is(l,f,"method",O.method,O,null),is(l,f,"target",O.target,O,null)));if(C==null||typeof C=="symbol"||typeof C=="boolean"){l.removeAttribute(v);break}C=Ec(""+C),l.setAttribute(v,C);break;case"onClick":C!=null&&(l.onclick=sm);break;case"onScroll":C!=null&&Ln("scroll",l);break;case"onScrollEnd":C!=null&&Ln("scrollend",l);break;case"dangerouslySetInnerHTML":if(C!=null){if(typeof C!="object"||!("__html"in C))throw Error(S(61));if(v=C.__html,v!=null){if(O.children!=null)throw Error(S(60));l.innerHTML=v}}break;case"multiple":l.multiple=C&&typeof C!="function"&&typeof C!="symbol";break;case"muted":l.muted=C&&typeof C!="function"&&typeof C!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(C==null||typeof C=="function"||typeof C=="boolean"||typeof C=="symbol"){l.removeAttribute("xlink:href");break}v=Ec(""+C),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",v);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":C!=null&&typeof C!="function"&&typeof C!="symbol"?l.setAttribute(v,""+C):l.removeAttribute(v);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":C&&typeof C!="function"&&typeof C!="symbol"?l.setAttribute(v,""):l.removeAttribute(v);break;case"capture":case"download":C===!0?l.setAttribute(v,""):C!==!1&&C!=null&&typeof C!="function"&&typeof C!="symbol"?l.setAttribute(v,C):l.removeAttribute(v);break;case"cols":case"rows":case"size":case"span":C!=null&&typeof C!="function"&&typeof C!="symbol"&&!isNaN(C)&&1<=C?l.setAttribute(v,C):l.removeAttribute(v);break;case"rowSpan":case"start":C==null||typeof C=="function"||typeof C=="symbol"||isNaN(C)?l.removeAttribute(v):l.setAttribute(v,C);break;case"popover":Ln("beforetoggle",l),Ln("toggle",l),In(l,"popover",C);break;case"xlinkActuate":Ga(l,"http://www.w3.org/1999/xlink","xlink:actuate",C);break;case"xlinkArcrole":Ga(l,"http://www.w3.org/1999/xlink","xlink:arcrole",C);break;case"xlinkRole":Ga(l,"http://www.w3.org/1999/xlink","xlink:role",C);break;case"xlinkShow":Ga(l,"http://www.w3.org/1999/xlink","xlink:show",C);break;case"xlinkTitle":Ga(l,"http://www.w3.org/1999/xlink","xlink:title",C);break;case"xlinkType":Ga(l,"http://www.w3.org/1999/xlink","xlink:type",C);break;case"xmlBase":Ga(l,"http://www.w3.org/XML/1998/namespace","xml:base",C);break;case"xmlLang":Ga(l,"http://www.w3.org/XML/1998/namespace","xml:lang",C);break;case"xmlSpace":Ga(l,"http://www.w3.org/XML/1998/namespace","xml:space",C);break;case"is":In(l,"is",C);break;case"innerText":case"textContent":break;default:(!(2<v.length)||v[0]!=="o"&&v[0]!=="O"||v[1]!=="n"&&v[1]!=="N")&&(v=Sc.get(v)||v,In(l,v,C))}}function am(l,f,v,C,O,U){switch(v){case"style":df(l,C,U);break;case"dangerouslySetInnerHTML":if(C!=null){if(typeof C!="object"||!("__html"in C))throw Error(S(61));if(v=C.__html,v!=null){if(O.children!=null)throw Error(S(60));l.innerHTML=v}}break;case"children":typeof C=="string"?wa(l,C):(typeof C=="number"||typeof C=="bigint")&&wa(l,""+C);break;case"onScroll":C!=null&&Ln("scroll",l);break;case"onScrollEnd":C!=null&&Ln("scrollend",l);break;case"onClick":C!=null&&(l.onclick=sm);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!wt.hasOwnProperty(v))e:{if(v[0]==="o"&&v[1]==="n"&&(O=v.endsWith("Capture"),f=v.slice(2,O?v.length-7:void 0),U=l[Je]||null,U=U!=null?U[v]:null,typeof U=="function"&&l.removeEventListener(f,U,O),typeof C=="function")){typeof U!="function"&&U!==null&&(v in l?l[v]=null:l.hasAttribute(v)&&l.removeAttribute(v)),l.addEventListener(f,C,O);break e}v in l?l[v]=C:C===!0?l.setAttribute(v,""):In(l,v,C)}}}function Es(l,f,v){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ln("error",l),Ln("load",l);var C=!1,O=!1,U;for(U in v)if(v.hasOwnProperty(U)){var ae=v[U];if(ae!=null)switch(U){case"src":C=!0;break;case"srcSet":O=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(S(137,f));default:is(l,f,U,ae,v,null)}}O&&is(l,f,"srcSet",v.srcSet,v,null),C&&is(l,f,"src",v.src,v,null);return;case"input":Ln("invalid",l);var De=U=ae=O=null,Xe=null,mt=null;for(C in v)if(v.hasOwnProperty(C)){var ai=v[C];if(ai!=null)switch(C){case"name":O=ai;break;case"type":ae=ai;break;case"checked":Xe=ai;break;case"defaultChecked":mt=ai;break;case"value":U=ai;break;case"defaultValue":De=ai;break;case"children":case"dangerouslySetInnerHTML":if(ai!=null)throw Error(S(137,f));break;default:is(l,f,C,ai,v,null)}}hf(l,U,De,Xe,mt,ae,O,!1),wc(l);return;case"select":Ln("invalid",l),C=ae=U=null;for(O in v)if(v.hasOwnProperty(O)&&(De=v[O],De!=null))switch(O){case"value":U=De;break;case"defaultValue":ae=De;break;case"multiple":C=De;default:is(l,f,O,De,v,null)}f=U,v=ae,l.multiple=!!C,f!=null?Ws(l,!!C,f,!1):v!=null&&Ws(l,!!C,v,!0);return;case"textarea":Ln("invalid",l),U=O=C=null;for(ae in v)if(v.hasOwnProperty(ae)&&(De=v[ae],De!=null))switch(ae){case"value":C=De;break;case"defaultValue":O=De;break;case"children":U=De;break;case"dangerouslySetInnerHTML":if(De!=null)throw Error(S(91));break;default:is(l,f,ae,De,v,null)}cl(l,C,O,U),wc(l);return;case"option":for(Xe in v)if(v.hasOwnProperty(Xe)&&(C=v[Xe],C!=null))switch(Xe){case"selected":l.selected=C&&typeof C!="function"&&typeof C!="symbol";break;default:is(l,f,Xe,C,v,null)}return;case"dialog":Ln("cancel",l),Ln("close",l);break;case"iframe":case"object":Ln("load",l);break;case"video":case"audio":for(C=0;C<Yf.length;C++)Ln(Yf[C],l);break;case"image":Ln("error",l),Ln("load",l);break;case"details":Ln("toggle",l);break;case"embed":case"source":case"link":Ln("error",l),Ln("load",l);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(mt in v)if(v.hasOwnProperty(mt)&&(C=v[mt],C!=null))switch(mt){case"children":case"dangerouslySetInnerHTML":throw Error(S(137,f));default:is(l,f,mt,C,v,null)}return;default:if(lu(f)){for(ai in v)v.hasOwnProperty(ai)&&(C=v[ai],C!==void 0&&am(l,f,ai,C,v,void 0));return}}for(De in v)v.hasOwnProperty(De)&&(C=v[De],C!=null&&is(l,f,De,C,v,null))}function na(l,f,v,C){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var O=null,U=null,ae=null,De=null,Xe=null,mt=null,ai=null;for(ri in v){var xi=v[ri];if(v.hasOwnProperty(ri)&&xi!=null)switch(ri){case"checked":break;case"value":break;case"defaultValue":Xe=xi;default:C.hasOwnProperty(ri)||is(l,f,ri,null,C,xi)}}for(var Ut in C){var ri=C[Ut];if(xi=v[Ut],C.hasOwnProperty(Ut)&&(ri!=null||xi!=null))switch(Ut){case"type":U=ri;break;case"name":O=ri;break;case"checked":mt=ri;break;case"defaultChecked":ai=ri;break;case"value":ae=ri;break;case"defaultValue":De=ri;break;case"children":case"dangerouslySetInnerHTML":if(ri!=null)throw Error(S(137,f));break;default:ri!==xi&&is(l,f,Ut,ri,C,xi)}}xo(l,ae,De,Xe,mt,ai,U,O);return;case"select":ri=ae=De=Ut=null;for(U in v)if(Xe=v[U],v.hasOwnProperty(U)&&Xe!=null)switch(U){case"value":break;case"multiple":ri=Xe;default:C.hasOwnProperty(U)||is(l,f,U,null,C,Xe)}for(O in C)if(U=C[O],Xe=v[O],C.hasOwnProperty(O)&&(U!=null||Xe!=null))switch(O){case"value":Ut=U;break;case"defaultValue":De=U;break;case"multiple":ae=U;default:U!==Xe&&is(l,f,O,U,C,Xe)}f=De,v=ae,C=ri,Ut!=null?Ws(l,!!v,Ut,!1):!!C!=!!v&&(f!=null?Ws(l,!!v,f,!0):Ws(l,!!v,v?[]:"",!1));return;case"textarea":ri=Ut=null;for(De in v)if(O=v[De],v.hasOwnProperty(De)&&O!=null&&!C.hasOwnProperty(De))switch(De){case"value":break;case"children":break;default:is(l,f,De,null,C,O)}for(ae in C)if(O=C[ae],U=v[ae],C.hasOwnProperty(ae)&&(O!=null||U!=null))switch(ae){case"value":Ut=O;break;case"defaultValue":ri=O;break;case"children":break;case"dangerouslySetInnerHTML":if(O!=null)throw Error(S(91));break;default:O!==U&&is(l,f,ae,O,C,U)}vo(l,Ut,ri);return;case"option":for(var vr in v)if(Ut=v[vr],v.hasOwnProperty(vr)&&Ut!=null&&!C.hasOwnProperty(vr))switch(vr){case"selected":l.selected=!1;break;default:is(l,f,vr,null,C,Ut)}for(Xe in C)if(Ut=C[Xe],ri=v[Xe],C.hasOwnProperty(Xe)&&Ut!==ri&&(Ut!=null||ri!=null))switch(Xe){case"selected":l.selected=Ut&&typeof Ut!="function"&&typeof Ut!="symbol";break;default:is(l,f,Xe,Ut,C,ri)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Qr in v)Ut=v[Qr],v.hasOwnProperty(Qr)&&Ut!=null&&!C.hasOwnProperty(Qr)&&is(l,f,Qr,null,C,Ut);for(mt in C)if(Ut=C[mt],ri=v[mt],C.hasOwnProperty(mt)&&Ut!==ri&&(Ut!=null||ri!=null))switch(mt){case"children":case"dangerouslySetInnerHTML":if(Ut!=null)throw Error(S(137,f));break;default:is(l,f,mt,Ut,C,ri)}return;default:if(lu(f)){for(var _s in v)Ut=v[_s],v.hasOwnProperty(_s)&&Ut!==void 0&&!C.hasOwnProperty(_s)&&am(l,f,_s,void 0,C,Ut);for(ai in C)Ut=C[ai],ri=v[ai],!C.hasOwnProperty(ai)||Ut===ri||Ut===void 0&&ri===void 0||am(l,f,ai,Ut,C,ri);return}}for(var Mt in v)Ut=v[Mt],v.hasOwnProperty(Mt)&&Ut!=null&&!C.hasOwnProperty(Mt)&&is(l,f,Mt,null,C,Ut);for(xi in C)Ut=C[xi],ri=v[xi],!C.hasOwnProperty(xi)||Ut===ri||Ut==null&&ri==null||is(l,f,xi,Ut,C,ri)}var sg=null,Yd=null;function ag(l){return l.nodeType===9?l:l.ownerDocument}function A0(l){switch(l){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function C0(l,f){if(l===0)switch(f){case"svg":return 1;case"math":return 2;default:return 0}return l===1&&f==="foreignObject"?0:l}function c_(l,f){return l==="textarea"||l==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.children=="bigint"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var Xh=null;function R0(){var l=window.event;return l&&l.type==="popstate"?l===Xh?!1:(Xh=l,!0):(Xh=null,!1)}var Yh=typeof setTimeout=="function"?setTimeout:void 0,om=typeof clearTimeout=="function"?clearTimeout:void 0,M0=typeof Promise=="function"?Promise:void 0,q1=typeof queueMicrotask=="function"?queueMicrotask:typeof M0<"u"?function(l){return M0.resolve(null).then(l).catch(G1)}:Yh;function G1(l){setTimeout(function(){throw l})}function u_(l,f){var v=f,C=0;do{var O=v.nextSibling;if(l.removeChild(v),O&&O.nodeType===8)if(v=O.data,v==="/$"){if(C===0){l.removeChild(O),op(f);return}C--}else v!=="$"&&v!=="$?"&&v!=="$!"||C++;v=O}while(v);op(f)}function h_(l){var f=l.firstChild;for(f&&f.nodeType===10&&(f=f.nextSibling);f;){var v=f;switch(f=f.nextSibling,v.nodeName){case"HTML":case"HEAD":case"BODY":h_(v),nr(v);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(v.rel.toLowerCase()==="stylesheet")continue}l.removeChild(v)}}function $1(l,f,v,C){for(;l.nodeType===1;){var O=v;if(l.nodeName.toLowerCase()!==f.toLowerCase()){if(!C&&(l.nodeName!=="INPUT"||l.type!=="hidden"))break}else if(C){if(!l[lr])switch(f){case"meta":if(!l.hasAttribute("itemprop"))break;return l;case"link":if(U=l.getAttribute("rel"),U==="stylesheet"&&l.hasAttribute("data-precedence"))break;if(U!==O.rel||l.getAttribute("href")!==(O.href==null?null:O.href)||l.getAttribute("crossorigin")!==(O.crossOrigin==null?null:O.crossOrigin)||l.getAttribute("title")!==(O.title==null?null:O.title))break;return l;case"style":if(l.hasAttribute("data-precedence"))break;return l;case"script":if(U=l.getAttribute("src"),(U!==(O.src==null?null:O.src)||l.getAttribute("type")!==(O.type==null?null:O.type)||l.getAttribute("crossorigin")!==(O.crossOrigin==null?null:O.crossOrigin))&&U&&l.hasAttribute("async")&&!l.hasAttribute("itemprop"))break;return l;default:return l}}else if(f==="input"&&l.type==="hidden"){var U=O.name==null?null:""+O.name;if(O.type==="hidden"&&l.getAttribute("name")===U)return l}else return l;if(l=sl(l.nextSibling),l===null)break}return null}function Z1(l,f,v){if(f==="")return null;for(;l.nodeType!==3;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!v||(l=sl(l.nextSibling),l===null))return null;return l}function sl(l){for(;l!=null;l=l.nextSibling){var f=l.nodeType;if(f===1||f===3)break;if(f===8){if(f=l.data,f==="$"||f==="$!"||f==="$?"||f==="F!"||f==="F")break;if(f==="/$")return null}}return l}function I0(l){l=l.previousSibling;for(var f=0;l;){if(l.nodeType===8){var v=l.data;if(v==="$"||v==="$!"||v==="$?"){if(f===0)return l;f--}else v==="/$"&&f++}l=l.previousSibling}return null}function d_(l,f,v){switch(f=ag(v),l){case"html":if(l=f.documentElement,!l)throw Error(S(452));return l;case"head":if(l=f.head,!l)throw Error(S(453));return l;case"body":if(l=f.body,!l)throw Error(S(454));return l;default:throw Error(S(451))}}var Qa=new Map,z0=new Set;function hs(l){return typeof l.getRootNode=="function"?l.getRootNode():l.ownerDocument}var Lo=ii.d;ii.d={f:L0,r:og,D:D0,C:P0,L:lm,m:f_,X:W1,S:cm,M:O0};function L0(){var l=Lo.f(),f=ga();return l||f}function og(l){var f=Hr(l);f!==null&&f.tag===5&&f.type==="form"?$c(f):Lo.r(l)}var Wu=typeof document>"u"?null:document;function Qf(l,f,v){var C=Wu;if(C&&typeof f=="string"&&f){var O=$a(f);O='link[rel="'+l+'"][href="'+O+'"]',typeof v=="string"&&(O+='[crossorigin="'+v+'"]'),z0.has(O)||(z0.add(O),l={rel:l,crossOrigin:v,href:f},C.querySelector(O)===null&&(f=C.createElement("link"),Es(f,"link",l),Yr(f),C.head.appendChild(f)))}}function D0(l){Lo.D(l),Qf("dns-prefetch",l,null)}function P0(l,f){Lo.C(l,f),Qf("preconnect",l,f)}function lm(l,f,v){Lo.L(l,f,v);var C=Wu;if(C&&l&&f){var O='link[rel="preload"][as="'+$a(f)+'"]';f==="image"&&v&&v.imageSrcSet?(O+='[imagesrcset="'+$a(v.imageSrcSet)+'"]',typeof v.imageSizes=="string"&&(O+='[imagesizes="'+$a(v.imageSizes)+'"]')):O+='[href="'+$a(l)+'"]';var U=O;switch(f){case"style":U=Kh(l);break;case"script":U=sa(l)}Qa.has(U)||(l=zt({rel:"preload",href:f==="image"&&v&&v.imageSrcSet?void 0:l,as:f},v),Qa.set(U,l),C.querySelector(O)!==null||f==="style"&&C.querySelector(ep(U))||f==="script"&&C.querySelector(tp(U))||(f=C.createElement("link"),Es(f,"link",l),Yr(f),C.head.appendChild(f)))}}function f_(l,f){Lo.m(l,f);var v=Wu;if(v&&l){var C=f&&typeof f.as=="string"?f.as:"script",O='link[rel="modulepreload"][as="'+$a(C)+'"][href="'+$a(l)+'"]',U=O;switch(C){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":U=sa(l)}if(!Qa.has(U)&&(l=zt({rel:"modulepreload",href:l},f),Qa.set(U,l),v.querySelector(O)===null)){switch(C){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(v.querySelector(tp(U)))return}C=v.createElement("link"),Es(C,"link",l),Yr(C),v.head.appendChild(C)}}}function cm(l,f,v){Lo.S(l,f,v);var C=Wu;if(C&&l){var O=mn(C).hoistableStyles,U=Kh(l);f=f||"default";var ae=O.get(U);if(!ae){var De={loading:0,preload:null};if(ae=C.querySelector(ep(U)))De.loading=5;else{l=zt({rel:"stylesheet",href:l,"data-precedence":f},v),(v=Qa.get(U))&&ip(l,v);var Xe=ae=C.createElement("link");Yr(Xe),Es(Xe,"link",l),Xe._p=new Promise(function(mt,ai){Xe.onload=mt,Xe.onerror=ai}),Xe.addEventListener("load",function(){De.loading|=1}),Xe.addEventListener("error",function(){De.loading|=2}),De.loading|=4,um(ae,f,C)}ae={type:"stylesheet",instance:ae,count:1,state:De},O.set(U,ae)}}}function W1(l,f){Lo.X(l,f);var v=Wu;if(v&&l){var C=mn(v).hoistableScripts,O=sa(l),U=C.get(O);U||(U=v.querySelector(tp(O)),U||(l=zt({src:l,async:!0},f),(f=Qa.get(O))&&m_(l,f),U=v.createElement("script"),Yr(U),Es(U,"link",l),v.head.appendChild(U)),U={type:"script",instance:U,count:1,state:null},C.set(O,U))}}function O0(l,f){Lo.M(l,f);var v=Wu;if(v&&l){var C=mn(v).hoistableScripts,O=sa(l),U=C.get(O);U||(U=v.querySelector(tp(O)),U||(l=zt({src:l,async:!0,type:"module"},f),(f=Qa.get(O))&&m_(l,f),U=v.createElement("script"),Yr(U),Es(U,"link",l),v.head.appendChild(U)),U={type:"script",instance:U,count:1,state:null},C.set(O,U))}}function lg(l,f,v,C){var O=(O=Cr.current)?hs(O):null;if(!O)throw Error(S(446));switch(l){case"meta":case"title":return null;case"style":return typeof v.precedence=="string"&&typeof v.href=="string"?(f=Kh(v.href),v=mn(O).hoistableStyles,C=v.get(f),C||(C={type:"style",instance:null,count:0,state:null},v.set(f,C)),C):{type:"void",instance:null,count:0,state:null};case"link":if(v.rel==="stylesheet"&&typeof v.href=="string"&&typeof v.precedence=="string"){l=Kh(v.href);var U=mn(O).hoistableStyles,ae=U.get(l);if(ae||(O=O.ownerDocument||O,ae={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},U.set(l,ae),(U=O.querySelector(ep(l)))&&!U._p&&(ae.instance=U,ae.state.loading=5),Qa.has(l)||(v={rel:"preload",as:"style",href:v.href,crossOrigin:v.crossOrigin,integrity:v.integrity,media:v.media,hrefLang:v.hrefLang,referrerPolicy:v.referrerPolicy},Qa.set(l,v),U||X1(O,l,v,ae.state))),f&&C===null)throw Error(S(528,""));return ae}if(f&&C!==null)throw Error(S(529,""));return null;case"script":return f=v.async,v=v.src,typeof v=="string"&&f&&typeof f!="function"&&typeof f!="symbol"?(f=sa(v),v=mn(O).hoistableScripts,C=v.get(f),C||(C={type:"script",instance:null,count:0,state:null},v.set(f,C)),C):{type:"void",instance:null,count:0,state:null};default:throw Error(S(444,l))}}function Kh(l){return'href="'+$a(l)+'"'}function ep(l){return'link[rel="stylesheet"]['+l+"]"}function eu(l){return zt({},l,{"data-precedence":l.precedence,precedence:null})}function X1(l,f,v,C){l.querySelector('link[rel="preload"][as="style"]['+f+"]")?C.loading=1:(f=l.createElement("link"),C.preload=f,f.addEventListener("load",function(){return C.loading|=1}),f.addEventListener("error",function(){return C.loading|=2}),Es(f,"link",v),Yr(f),l.head.appendChild(f))}function sa(l){return'[src="'+$a(l)+'"]'}function tp(l){return"script[async]"+l}function p_(l,f,v){if(f.count++,f.instance===null)switch(f.type){case"style":var C=l.querySelector('style[data-href~="'+$a(v.href)+'"]');if(C)return f.instance=C,Yr(C),C;var O=zt({},v,{"data-href":v.href,"data-precedence":v.precedence,href:null,precedence:null});return C=(l.ownerDocument||l).createElement("style"),Yr(C),Es(C,"style",O),um(C,v.precedence,l),f.instance=C;case"stylesheet":O=Kh(v.href);var U=l.querySelector(ep(O));if(U)return f.state.loading|=4,f.instance=U,Yr(U),U;C=eu(v),(O=Qa.get(O))&&ip(C,O),U=(l.ownerDocument||l).createElement("link"),Yr(U);var ae=U;return ae._p=new Promise(function(De,Xe){ae.onload=De,ae.onerror=Xe}),Es(U,"link",C),f.state.loading|=4,um(U,v.precedence,l),f.instance=U;case"script":return U=sa(v.src),(O=l.querySelector(tp(U)))?(f.instance=O,Yr(O),O):(C=v,(O=Qa.get(U))&&(C=zt({},v),m_(C,O)),l=l.ownerDocument||l,O=l.createElement("script"),Yr(O),Es(O,"link",C),l.head.appendChild(O),f.instance=O);case"void":return null;default:throw Error(S(443,f.type))}else f.type==="stylesheet"&&(f.state.loading&4)===0&&(C=f.instance,f.state.loading|=4,um(C,v.precedence,l));return f.instance}function um(l,f,v){for(var C=v.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),O=C.length?C[C.length-1]:null,U=O,ae=0;ae<C.length;ae++){var De=C[ae];if(De.dataset.precedence===f)U=De;else if(U!==O)break}U?U.parentNode.insertBefore(l,U.nextSibling):(f=v.nodeType===9?v.head:v,f.insertBefore(l,f.firstChild))}function ip(l,f){l.crossOrigin==null&&(l.crossOrigin=f.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=f.referrerPolicy),l.title==null&&(l.title=f.title)}function m_(l,f){l.crossOrigin==null&&(l.crossOrigin=f.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=f.referrerPolicy),l.integrity==null&&(l.integrity=f.integrity)}var cg=null;function ug(l,f,v){if(cg===null){var C=new Map,O=cg=new Map;O.set(v,C)}else O=cg,C=O.get(v),C||(C=new Map,O.set(v,C));if(C.has(l))return C;for(C.set(l,null),v=v.getElementsByTagName(l),O=0;O<v.length;O++){var U=v[O];if(!(U[lr]||U[Be]||l==="link"&&U.getAttribute("rel")==="stylesheet")&&U.namespaceURI!=="http://www.w3.org/2000/svg"){var ae=U.getAttribute(f)||"";ae=l+ae;var De=C.get(ae);De?De.push(U):C.set(ae,[U])}}return C}function g_(l,f,v){l=l.ownerDocument||l,l.head.insertBefore(v,f==="title"?l.querySelector("head > title"):null)}function __(l,f,v){if(v===1||f.itemProp!=null)return!1;switch(l){case"meta":case"title":return!0;case"style":if(typeof f.precedence!="string"||typeof f.href!="string"||f.href==="")break;return!0;case"link":if(typeof f.rel!="string"||typeof f.href!="string"||f.href===""||f.onLoad||f.onError)break;switch(f.rel){case"stylesheet":return l=f.disabled,typeof f.precedence=="string"&&l==null;default:return!0}case"script":if(f.async&&typeof f.async!="function"&&typeof f.async!="symbol"&&!f.onLoad&&!f.onError&&f.src&&typeof f.src=="string")return!0}return!1}function hg(l){return!(l.type==="stylesheet"&&(l.state.loading&3)===0)}var rp=null;function j0(){}function N0(l,f,v){if(rp===null)throw Error(S(475));var C=rp;if(f.type==="stylesheet"&&(typeof v.media!="string"||matchMedia(v.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var O=Kh(v.href),U=l.querySelector(ep(O));if(U){l=U._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(C.count++,C=Kd.bind(C),l.then(C,C)),f.state.loading|=4,f.instance=U,Yr(U);return}U=l.ownerDocument||l,v=eu(v),(O=Qa.get(O))&&ip(v,O),U=U.createElement("link"),Yr(U);var ae=U;ae._p=new Promise(function(De,Xe){ae.onload=De,ae.onerror=Xe}),Es(U,"link",v),f.instance=U}C.stylesheets===null&&(C.stylesheets=new Map),C.stylesheets.set(f,l),(l=f.state.preload)&&(f.state.loading&3)===0&&(C.count++,f=Kd.bind(C),l.addEventListener("load",f),l.addEventListener("error",f))}}function k0(){if(rp===null)throw Error(S(475));var l=rp;return l.stylesheets&&l.count===0&&dg(l,l.stylesheets),0<l.count?function(f){var v=setTimeout(function(){if(l.stylesheets&&dg(l,l.stylesheets),l.unsuspend){var C=l.unsuspend;l.unsuspend=null,C()}},6e4);return l.unsuspend=f,function(){l.unsuspend=null,clearTimeout(v)}}:null}function Kd(){if(this.count--,this.count===0){if(this.stylesheets)dg(this,this.stylesheets);else if(this.unsuspend){var l=this.unsuspend;this.unsuspend=null,l()}}}var al=null;function dg(l,f){l.stylesheets=null,l.unsuspend!==null&&(l.count++,al=new Map,f.forEach(Y1,l),al=null,Kd.call(l))}function Y1(l,f){if(!(f.state.loading&4)){var v=al.get(l);if(v)var C=v.get(null);else{v=new Map,al.set(l,v);for(var O=l.querySelectorAll("link[data-precedence],style[data-precedence]"),U=0;U<O.length;U++){var ae=O[U];(ae.nodeName==="LINK"||ae.getAttribute("media")!=="not all")&&(v.set(ae.dataset.precedence,ae),C=ae)}C&&v.set(null,C)}O=f.instance,ae=O.getAttribute("data-precedence"),U=v.get(ae)||C,U===C&&v.set(null,O),v.set(ae,O),this.count++,C=Kd.bind(this),O.addEventListener("load",C),O.addEventListener("error",C),U?U.parentNode.insertBefore(O,U.nextSibling):(l=l.nodeType===9?l.head:l,l.insertBefore(O,l.firstChild)),f.state.loading|=4}}var hm={$$typeof:ze,Provider:null,Consumer:null,_currentValue:Wi,_currentValue2:Wi,_threadCount:0};function K1(l,f,v,C,O,U,ae,De){this.tag=1,this.containerInfo=l,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ba(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ba(0),this.hiddenUpdates=ba(null),this.identifierPrefix=C,this.onUncaughtError=O,this.onCaughtError=U,this.onRecoverableError=ae,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=De,this.incompleteTransitions=new Map}function B0(l,f,v,C,O,U,ae,De,Xe,mt,ai,xi){return l=new K1(l,f,v,ae,De,Xe,mt,xi),f=1,U===!0&&(f|=24),U=G(3,null,null,f),l.current=U,U.stateNode=l,f=Sh(),f.refCount++,l.pooledCache=f,f.refCount++,U.memoizedState={element:C,isDehydrated:v,cache:f},Gf(U),l}function F0(l){return l?(l=Fa,l):Fa}function U0(l,f,v,C,O,U){O=F0(O),C.context===null?C.context=O:C.pendingContext=O,C=hc(f),C.payload={element:v},U=U===void 0?null:U,U!==null&&(C.callback=U),v=Jo(l,C,f),v!==null&&(Vr(v,l,f),Bh(v,l,f))}function V0(l,f){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var v=l.retryLane;l.retryLane=v!==0&&v<f?v:f}}function Jd(l,f){V0(l,f),(l=l.alternate)&&V0(l,f)}function y_(l){if(l.tag===13){var f=co(l,67108864);f!==null&&Vr(f,l,67108864),Jd(l,67108864)}}var dm=!0;function fg(l,f,v,C){var O=lt.T;lt.T=null;var U=ii.p;try{ii.p=2,fm(l,f,v,C)}finally{ii.p=U,lt.T=O}}function H0(l,f,v,C){var O=lt.T;lt.T=null;var U=ii.p;try{ii.p=8,fm(l,f,v,C)}finally{ii.p=U,lt.T=O}}function fm(l,f,v,C){if(dm){var O=np(C);if(O===null)s_(l,f,C,pm,v),q0(l,C);else if(G0(O,l,f,v,C))C.stopPropagation();else if(q0(l,C),f&4&&-1<J1.indexOf(l)){for(;O!==null;){var U=Hr(O);if(U!==null)switch(U.tag){case 3:if(U=U.stateNode,U.current.memoizedState.isDehydrated){var ae=Rr(U.pendingLanes);if(ae!==0){var De=U;for(De.pendingLanes|=2,De.entangledLanes|=2;ae;){var Xe=1<<31-os(ae);De.entanglements[1]|=Xe,ae&=~Xe}ya(U),(Oe&6)===0&&(Yi=fs()+500,nl(0))}}break;case 13:De=co(U,2),De!==null&&Vr(De,U,2),ga(),Jd(U,2)}if(U=np(C),U===null&&s_(l,f,C,pm,v),U===O)break;O=U}O!==null&&C.stopPropagation()}else s_(l,f,C,null,v)}}function np(l){return l=Oa(l),x_(l)}var pm=null;function x_(l){if(pm=null,l=cr(l),l!==null){var f=Fi(l);if(f===null)l=null;else{var v=f.tag;if(v===13){if(l=Pr(f),l!==null)return l;l=null}else if(v===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;l=null}else f!==l&&(l=null)}}return pm=l,null}function pg(l){switch(l){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ps()){case $n:return 2;case Xn:return 8;case Ds:case Ps:return 32;case Vs:return 268435456;default:return 32}default:return 32}}var mg=!1,Xu=null,tu=null,iu=null,sp=new Map,Qd=new Map,Jh=[],J1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function q0(l,f){switch(l){case"focusin":case"focusout":Xu=null;break;case"dragenter":case"dragleave":tu=null;break;case"mouseover":case"mouseout":iu=null;break;case"pointerover":case"pointerout":sp.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":Qd.delete(f.pointerId)}}function mm(l,f,v,C,O,U){return l===null||l.nativeEvent!==U?(l={blockedOn:f,domEventName:v,eventSystemFlags:C,nativeEvent:U,targetContainers:[O]},f!==null&&(f=Hr(f),f!==null&&y_(f)),l):(l.eventSystemFlags|=C,f=l.targetContainers,O!==null&&f.indexOf(O)===-1&&f.push(O),l)}function G0(l,f,v,C,O){switch(f){case"focusin":return Xu=mm(Xu,l,f,v,C,O),!0;case"dragenter":return tu=mm(tu,l,f,v,C,O),!0;case"mouseover":return iu=mm(iu,l,f,v,C,O),!0;case"pointerover":var U=O.pointerId;return sp.set(U,mm(sp.get(U)||null,l,f,v,C,O)),!0;case"gotpointercapture":return U=O.pointerId,Qd.set(U,mm(Qd.get(U)||null,l,f,v,C,O)),!0}return!1}function Yu(l){var f=cr(l.target);if(f!==null){var v=Fi(f);if(v!==null){if(f=v.tag,f===13){if(f=Pr(v),f!==null){l.blockedOn=f,Ie(l.priority,function(){if(v.tag===13){var C=wr(),O=co(v,C);O!==null&&Vr(O,v,C),Jd(v,C)}});return}}else if(f===3&&v.stateNode.current.memoizedState.isDehydrated){l.blockedOn=v.tag===3?v.stateNode.containerInfo:null;return}}}l.blockedOn=null}function Qh(l){if(l.blockedOn!==null)return!1;for(var f=l.targetContainers;0<f.length;){var v=np(l.nativeEvent);if(v===null){v=l.nativeEvent;var C=new v.constructor(v.type,v);Ac=C,v.target.dispatchEvent(C),Ac=null}else return f=Hr(v),f!==null&&y_(f),l.blockedOn=v,!1;f.shift()}return!0}function ap(l,f,v){Qh(l)&&v.delete(f)}function gg(){mg=!1,Xu!==null&&Qh(Xu)&&(Xu=null),tu!==null&&Qh(tu)&&(tu=null),iu!==null&&Qh(iu)&&(iu=null),sp.forEach(ap),Qd.forEach(ap)}function ed(l,f){l.blockedOn===f&&(l.blockedOn=null,mg||(mg=!0,h.unstable_scheduleCallback(h.unstable_NormalPriority,gg)))}var gm=null;function v_(l){gm!==l&&(gm=l,h.unstable_scheduleCallback(h.unstable_NormalPriority,function(){gm===l&&(gm=null);for(var f=0;f<l.length;f+=3){var v=l[f],C=l[f+1],O=l[f+2];if(typeof C!="function"){if(x_(C||v)===null)continue;break}var U=Hr(v);U!==null&&(l.splice(f,3),f-=3,Wo(U,{pending:!0,data:O,method:v.method,action:C},C,O))}}))}function op(l){function f(Xe){return ed(Xe,l)}Xu!==null&&ed(Xu,l),tu!==null&&ed(tu,l),iu!==null&&ed(iu,l),sp.forEach(f),Qd.forEach(f);for(var v=0;v<Jh.length;v++){var C=Jh[v];C.blockedOn===l&&(C.blockedOn=null)}for(;0<Jh.length&&(v=Jh[0],v.blockedOn===null);)Yu(v),v.blockedOn===null&&Jh.shift();if(v=(l.ownerDocument||l).$$reactFormReplay,v!=null)for(C=0;C<v.length;C+=3){var O=v[C],U=v[C+1],ae=O[Je]||null;if(typeof U=="function")ae||v_(v);else if(ae){var De=null;if(U&&U.hasAttribute("formAction")){if(O=U,ae=U[Je]||null)De=ae.formAction;else if(x_(O)!==null)continue}else De=ae.action;typeof De=="function"?v[C+1]=De:(v.splice(C,3),C-=3),v_(v)}}}function _g(l){this._internalRoot=l}yg.prototype.render=_g.prototype.render=function(l){var f=this._internalRoot;if(f===null)throw Error(S(409));var v=f.current,C=wr();U0(v,C,l,f,null,null)},yg.prototype.unmount=_g.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var f=l.containerInfo;l.tag===0&&Ha(),U0(l.current,2,null,l,null,null),ga(),f[Lt]=null}};function yg(l){this._internalRoot=l}yg.prototype.unstable_scheduleHydration=function(l){if(l){var f=Pe();l={blockedOn:null,target:l,priority:f};for(var v=0;v<Jh.length&&f!==0&&f<Jh[v].priority;v++);Jh.splice(v,0,l),v===0&&Yu(l)}};var $0=g.version;if($0!=="19.0.0")throw Error(S(527,$0,"19.0.0"));ii.findDOMNode=function(l){var f=l._reactInternals;if(f===void 0)throw typeof l.render=="function"?Error(S(188)):(l=Object.keys(l).join(","),Error(S(268,l)));return l=Ht(f),l=l!==null?Pi(l):null,l=l===null?null:l.stateNode,l};var b_={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:lt,findFiberByHostInstance:cr,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ef=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ef.isDisabled&&ef.supportsFiber)try{Da=ef.inject(b_),as=ef}catch{}}return Z_.createRoot=function(l,f){if(!I(l))throw Error(S(299));var v=!1,C="",O=kd,U=jh,ae=Pu,De=null;return f!=null&&(f.unstable_strictMode===!0&&(v=!0),f.identifierPrefix!==void 0&&(C=f.identifierPrefix),f.onUncaughtError!==void 0&&(O=f.onUncaughtError),f.onCaughtError!==void 0&&(U=f.onCaughtError),f.onRecoverableError!==void 0&&(ae=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(De=f.unstable_transitionCallbacks)),f=B0(l,1,!1,null,null,v,C,O,U,ae,De,null),l[Lt]=f.current,rg(l.nodeType===8?l.parentNode:l),new _g(f)},Z_.hydrateRoot=function(l,f,v){if(!I(l))throw Error(S(299));var C=!1,O="",U=kd,ae=jh,De=Pu,Xe=null,mt=null;return v!=null&&(v.unstable_strictMode===!0&&(C=!0),v.identifierPrefix!==void 0&&(O=v.identifierPrefix),v.onUncaughtError!==void 0&&(U=v.onUncaughtError),v.onCaughtError!==void 0&&(ae=v.onCaughtError),v.onRecoverableError!==void 0&&(De=v.onRecoverableError),v.unstable_transitionCallbacks!==void 0&&(Xe=v.unstable_transitionCallbacks),v.formState!==void 0&&(mt=v.formState)),f=B0(l,1,!0,f,v??null,C,O,U,ae,De,Xe,mt),f.context=F0(null),v=f.current,C=wr(),O=hc(C),O.callback=null,Jo(v,O,C),f.current.lanes=C,He(f,C),ya(f),l[Lt]=f.current,rg(l),new yg(f)},Z_.version="19.0.0",Z_}var e4;function yC(){if(e4)return Kx.exports;e4=1;function h(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h)}catch(g){console.error(g)}}return h(),Kx.exports=_C(),Kx.exports}var xC=yC();const vC="modulepreload",bC=function(h){return"/"+h},t4={},Xr=function(g,b,S){let I=Promise.resolve();if(b&&b.length>0){let V=function(Z){return Promise.all(Z.map(Q=>Promise.resolve(Q).then(oe=>({status:"fulfilled",value:oe}),oe=>({status:"rejected",reason:oe}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),q=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));I=V(b.map(Z=>{if(Z=bC(Z),Z in t4)return;t4[Z]=!0;const Q=Z.endsWith(".css"),oe=Q?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${Z}"]${oe}`))return;const de=document.createElement("link");if(de.rel=Q?"stylesheet":vC,Q||(de.as="script"),de.crossOrigin="",de.href=Z,q&&de.setAttribute("nonce",q),document.head.appendChild(de),Q)return new Promise((ze,le)=>{de.addEventListener("load",ze),de.addEventListener("error",()=>le(new Error(`Unable to preload CSS for ${Z}`)))})}))}function N(V){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=V,window.dispatchEvent(s),!s.defaultPrevented)throw V}return I.then(V=>{for(const s of V||[])s.status==="rejected"&&N(s.reason);return g().catch(N)})};var W_={},i4;function wC(){if(i4)return W_;i4=1,Object.defineProperty(W_,"__esModule",{value:!0}),W_.parse=V,W_.serialize=Z;const h=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,g=/^[\u0021-\u003A\u003C-\u007E]*$/,b=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,S=/^[\u0020-\u003A\u003D-\u007E]*$/,I=Object.prototype.toString,N=(()=>{const de=function(){};return de.prototype=Object.create(null),de})();function V(de,ze){const le=new N,Se=de.length;if(Se<2)return le;const ee=(ze==null?void 0:ze.decode)||Q;let _e=0;do{const ye=de.indexOf("=",_e);if(ye===-1)break;const xe=de.indexOf(";",_e),Le=xe===-1?Se:xe;if(ye>Le){_e=de.lastIndexOf(";",ye-1)+1;continue}const Ae=s(de,_e,ye),Ke=q(de,ye,Ae),it=de.slice(Ae,Ke);if(le[it]===void 0){let rt=s(de,ye+1,Le),lt=q(de,Le,rt);const zt=ee(de.slice(rt,lt));le[it]=zt}_e=Le+1}while(_e<Se);return le}function s(de,ze,le){do{const Se=de.charCodeAt(ze);if(Se!==32&&Se!==9)return ze}while(++ze<le);return le}function q(de,ze,le){for(;ze>le;){const Se=de.charCodeAt(--ze);if(Se!==32&&Se!==9)return ze+1}return le}function Z(de,ze,le){const Se=(le==null?void 0:le.encode)||encodeURIComponent;if(!h.test(de))throw new TypeError(`argument name is invalid: ${de}`);const ee=Se(ze);if(!g.test(ee))throw new TypeError(`argument val is invalid: ${ze}`);let _e=de+"="+ee;if(!le)return _e;if(le.maxAge!==void 0){if(!Number.isInteger(le.maxAge))throw new TypeError(`option maxAge is invalid: ${le.maxAge}`);_e+="; Max-Age="+le.maxAge}if(le.domain){if(!b.test(le.domain))throw new TypeError(`option domain is invalid: ${le.domain}`);_e+="; Domain="+le.domain}if(le.path){if(!S.test(le.path))throw new TypeError(`option path is invalid: ${le.path}`);_e+="; Path="+le.path}if(le.expires){if(!oe(le.expires)||!Number.isFinite(le.expires.valueOf()))throw new TypeError(`option expires is invalid: ${le.expires}`);_e+="; Expires="+le.expires.toUTCString()}if(le.httpOnly&&(_e+="; HttpOnly"),le.secure&&(_e+="; Secure"),le.partitioned&&(_e+="; Partitioned"),le.priority)switch(typeof le.priority=="string"?le.priority.toLowerCase():void 0){case"low":_e+="; Priority=Low";break;case"medium":_e+="; Priority=Medium";break;case"high":_e+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${le.priority}`)}if(le.sameSite)switch(typeof le.sameSite=="string"?le.sameSite.toLowerCase():le.sameSite){case!0:case"strict":_e+="; SameSite=Strict";break;case"lax":_e+="; SameSite=Lax";break;case"none":_e+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${le.sameSite}`)}return _e}function Q(de){if(de.indexOf("%")===-1)return de;try{return decodeURIComponent(de)}catch{return de}}function oe(de){return I.call(de)==="[object Date]"}return W_}wC();/**
 * react-router v7.3.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var r4="popstate";function TC(h={}){function g(S,I){let{pathname:N,search:V,hash:s}=S.location;return t2("",{pathname:N,search:V,hash:s},I.state&&I.state.usr||null,I.state&&I.state.key||"default")}function b(S,I){return typeof I=="string"?I:a0(I)}return EC(g,b,null,h)}function Us(h,g){if(h===!1||h===null||typeof h>"u")throw new Error(g)}function nh(h,g){if(!h){typeof console<"u"&&console.warn(g);try{throw new Error(g)}catch{}}}function SC(){return Math.random().toString(36).substring(2,10)}function n4(h,g){return{usr:h.state,key:h.key,idx:g}}function t2(h,g,b=null,S){return{pathname:typeof h=="string"?h:h.pathname,search:"",hash:"",...typeof g=="string"?Vg(g):g,state:b,key:g&&g.key||S||SC()}}function a0({pathname:h="/",search:g="",hash:b=""}){return g&&g!=="?"&&(h+=g.charAt(0)==="?"?g:"?"+g),b&&b!=="#"&&(h+=b.charAt(0)==="#"?b:"#"+b),h}function Vg(h){let g={};if(h){let b=h.indexOf("#");b>=0&&(g.hash=h.substring(b),h=h.substring(0,b));let S=h.indexOf("?");S>=0&&(g.search=h.substring(S),h=h.substring(0,S)),h&&(g.pathname=h)}return g}function EC(h,g,b,S={}){let{window:I=document.defaultView,v5Compat:N=!1}=S,V=I.history,s="POP",q=null,Z=Q();Z==null&&(Z=0,V.replaceState({...V.state,idx:Z},""));function Q(){return(V.state||{idx:null}).idx}function oe(){s="POP";let ee=Q(),_e=ee==null?null:ee-Z;Z=ee,q&&q({action:s,location:Se.location,delta:_e})}function de(ee,_e){s="PUSH";let ye=t2(Se.location,ee,_e);Z=Q()+1;let xe=n4(ye,Z),Le=Se.createHref(ye);try{V.pushState(xe,"",Le)}catch(Ae){if(Ae instanceof DOMException&&Ae.name==="DataCloneError")throw Ae;I.location.assign(Le)}N&&q&&q({action:s,location:Se.location,delta:1})}function ze(ee,_e){s="REPLACE";let ye=t2(Se.location,ee,_e);Z=Q();let xe=n4(ye,Z),Le=Se.createHref(ye);V.replaceState(xe,"",Le),N&&q&&q({action:s,location:Se.location,delta:0})}function le(ee){let _e=I.location.origin!=="null"?I.location.origin:I.location.href,ye=typeof ee=="string"?ee:a0(ee);return ye=ye.replace(/ $/,"%20"),Us(_e,`No window.location.(origin|href) available to create URL for href: ${ye}`),new URL(ye,_e)}let Se={get action(){return s},get location(){return h(I,V)},listen(ee){if(q)throw new Error("A history only accepts one active listener");return I.addEventListener(r4,oe),q=ee,()=>{I.removeEventListener(r4,oe),q=null}},createHref(ee){return g(I,ee)},createURL:le,encodeLocation(ee){let _e=le(ee);return{pathname:_e.pathname,search:_e.search,hash:_e.hash}},push:de,replace:ze,go(ee){return V.go(ee)}};return Se}function aT(h,g,b="/"){return AC(h,g,b,!1)}function AC(h,g,b,S){let I=typeof g=="string"?Vg(g):g,N=of(I.pathname||"/",b);if(N==null)return null;let V=oT(h);CC(V);let s=null;for(let q=0;s==null&&q<V.length;++q){let Z=kC(N);s=jC(V[q],Z,S)}return s}function oT(h,g=[],b=[],S=""){let I=(N,V,s)=>{let q={relativePath:s===void 0?N.path||"":s,caseSensitive:N.caseSensitive===!0,childrenIndex:V,route:N};q.relativePath.startsWith("/")&&(Us(q.relativePath.startsWith(S),`Absolute route path "${q.relativePath}" nested under path "${S}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),q.relativePath=q.relativePath.slice(S.length));let Z=af([S,q.relativePath]),Q=b.concat(q);N.children&&N.children.length>0&&(Us(N.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${Z}".`),oT(N.children,g,Q,Z)),!(N.path==null&&!N.index)&&g.push({path:Z,score:PC(Z,N.index),routesMeta:Q})};return h.forEach((N,V)=>{var s;if(N.path===""||!((s=N.path)!=null&&s.includes("?")))I(N,V);else for(let q of lT(N.path))I(N,V,q)}),g}function lT(h){let g=h.split("/");if(g.length===0)return[];let[b,...S]=g,I=b.endsWith("?"),N=b.replace(/\?$/,"");if(S.length===0)return I?[N,""]:[N];let V=lT(S.join("/")),s=[];return s.push(...V.map(q=>q===""?N:[N,q].join("/"))),I&&s.push(...V),s.map(q=>h.startsWith("/")&&q===""?"/":q)}function CC(h){h.sort((g,b)=>g.score!==b.score?b.score-g.score:OC(g.routesMeta.map(S=>S.childrenIndex),b.routesMeta.map(S=>S.childrenIndex)))}var RC=/^:[\w-]+$/,MC=3,IC=2,zC=1,LC=10,DC=-2,s4=h=>h==="*";function PC(h,g){let b=h.split("/"),S=b.length;return b.some(s4)&&(S+=DC),g&&(S+=IC),b.filter(I=>!s4(I)).reduce((I,N)=>I+(RC.test(N)?MC:N===""?zC:LC),S)}function OC(h,g){return h.length===g.length&&h.slice(0,-1).every((S,I)=>S===g[I])?h[h.length-1]-g[g.length-1]:0}function jC(h,g,b=!1){let{routesMeta:S}=h,I={},N="/",V=[];for(let s=0;s<S.length;++s){let q=S[s],Z=s===S.length-1,Q=N==="/"?g:g.slice(N.length)||"/",oe=i1({path:q.relativePath,caseSensitive:q.caseSensitive,end:Z},Q),de=q.route;if(!oe&&Z&&b&&!S[S.length-1].route.index&&(oe=i1({path:q.relativePath,caseSensitive:q.caseSensitive,end:!1},Q)),!oe)return null;Object.assign(I,oe.params),V.push({params:I,pathname:af([N,oe.pathname]),pathnameBase:VC(af([N,oe.pathnameBase])),route:de}),oe.pathnameBase!=="/"&&(N=af([N,oe.pathnameBase]))}return V}function i1(h,g){typeof h=="string"&&(h={path:h,caseSensitive:!1,end:!0});let[b,S]=NC(h.path,h.caseSensitive,h.end),I=g.match(b);if(!I)return null;let N=I[0],V=N.replace(/(.)\/+$/,"$1"),s=I.slice(1);return{params:S.reduce((Z,{paramName:Q,isOptional:oe},de)=>{if(Q==="*"){let le=s[de]||"";V=N.slice(0,N.length-le.length).replace(/(.)\/+$/,"$1")}const ze=s[de];return oe&&!ze?Z[Q]=void 0:Z[Q]=(ze||"").replace(/%2F/g,"/"),Z},{}),pathname:N,pathnameBase:V,pattern:h}}function NC(h,g=!1,b=!0){nh(h==="*"||!h.endsWith("*")||h.endsWith("/*"),`Route path "${h}" will be treated as if it were "${h.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${h.replace(/\*$/,"/*")}".`);let S=[],I="^"+h.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(V,s,q)=>(S.push({paramName:s,isOptional:q!=null}),q?"/?([^\\/]+)?":"/([^\\/]+)"));return h.endsWith("*")?(S.push({paramName:"*"}),I+=h==="*"||h==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):b?I+="\\/*$":h!==""&&h!=="/"&&(I+="(?:(?=\\/|$))"),[new RegExp(I,g?void 0:"i"),S]}function kC(h){try{return h.split("/").map(g=>decodeURIComponent(g).replace(/\//g,"%2F")).join("/")}catch(g){return nh(!1,`The URL path "${h}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${g}).`),h}}function of(h,g){if(g==="/")return h;if(!h.toLowerCase().startsWith(g.toLowerCase()))return null;let b=g.endsWith("/")?g.length-1:g.length,S=h.charAt(b);return S&&S!=="/"?null:h.slice(b)||"/"}function BC(h,g="/"){let{pathname:b,search:S="",hash:I=""}=typeof h=="string"?Vg(h):h;return{pathname:b?b.startsWith("/")?b:FC(b,g):g,search:HC(S),hash:qC(I)}}function FC(h,g){let b=g.replace(/\/+$/,"").split("/");return h.split("/").forEach(I=>{I===".."?b.length>1&&b.pop():I!=="."&&b.push(I)}),b.length>1?b.join("/"):"/"}function tv(h,g,b,S){return`Cannot include a '${h}' character in a manually specified \`to.${g}\` field [${JSON.stringify(S)}].  Please separate it out to the \`to.${b}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function UC(h){return h.filter((g,b)=>b===0||g.route.path&&g.route.path.length>0)}function j2(h){let g=UC(h);return g.map((b,S)=>S===g.length-1?b.pathname:b.pathnameBase)}function N2(h,g,b,S=!1){let I;typeof h=="string"?I=Vg(h):(I={...h},Us(!I.pathname||!I.pathname.includes("?"),tv("?","pathname","search",I)),Us(!I.pathname||!I.pathname.includes("#"),tv("#","pathname","hash",I)),Us(!I.search||!I.search.includes("#"),tv("#","search","hash",I)));let N=h===""||I.pathname==="",V=N?"/":I.pathname,s;if(V==null)s=b;else{let oe=g.length-1;if(!S&&V.startsWith("..")){let de=V.split("/");for(;de[0]==="..";)de.shift(),oe-=1;I.pathname=de.join("/")}s=oe>=0?g[oe]:"/"}let q=BC(I,s),Z=V&&V!=="/"&&V.endsWith("/"),Q=(N||V===".")&&b.endsWith("/");return!q.pathname.endsWith("/")&&(Z||Q)&&(q.pathname+="/"),q}var af=h=>h.join("/").replace(/\/\/+/g,"/"),VC=h=>h.replace(/\/+$/,"").replace(/^\/*/,"/"),HC=h=>!h||h==="?"?"":h.startsWith("?")?h:"?"+h,qC=h=>!h||h==="#"?"":h.startsWith("#")?h:"#"+h;function GC(h){return h!=null&&typeof h.status=="number"&&typeof h.statusText=="string"&&typeof h.internal=="boolean"&&"data"in h}var cT=["POST","PUT","PATCH","DELETE"];new Set(cT);var $C=["GET",...cT];new Set($C);var Hg=ue.createContext(null);Hg.displayName="DataRouter";var x1=ue.createContext(null);x1.displayName="DataRouterState";var uT=ue.createContext({isTransitioning:!1});uT.displayName="ViewTransition";var ZC=ue.createContext(new Map);ZC.displayName="Fetchers";var WC=ue.createContext(null);WC.displayName="Await";var sh=ue.createContext(null);sh.displayName="Navigation";var d0=ue.createContext(null);d0.displayName="Location";var ou=ue.createContext({outlet:null,matches:[],isDataRoute:!1});ou.displayName="Route";var k2=ue.createContext(null);k2.displayName="RouteError";function XC(h,{relative:g}={}){Us(qg(),"useHref() may be used only in the context of a <Router> component.");let{basename:b,navigator:S}=ue.useContext(sh),{hash:I,pathname:N,search:V}=f0(h,{relative:g}),s=N;return b!=="/"&&(s=N==="/"?b:af([b,N])),S.createHref({pathname:s,search:V,hash:I})}function qg(){return ue.useContext(d0)!=null}function ko(){return Us(qg(),"useLocation() may be used only in the context of a <Router> component."),ue.useContext(d0).location}var hT="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function dT(h){ue.useContext(sh).static||ue.useLayoutEffect(h)}function Pl(){let{isDataRoute:h}=ue.useContext(ou);return h?h8():YC()}function YC(){Us(qg(),"useNavigate() may be used only in the context of a <Router> component.");let h=ue.useContext(Hg),{basename:g,navigator:b}=ue.useContext(sh),{matches:S}=ue.useContext(ou),{pathname:I}=ko(),N=JSON.stringify(j2(S)),V=ue.useRef(!1);return dT(()=>{V.current=!0}),ue.useCallback((q,Z={})=>{if(nh(V.current,hT),!V.current)return;if(typeof q=="number"){b.go(q);return}let Q=N2(q,JSON.parse(N),I,Z.relative==="path");h==null&&g!=="/"&&(Q.pathname=Q.pathname==="/"?g:af([g,Q.pathname])),(Z.replace?b.replace:b.push)(Q,Z.state,Z)},[g,b,N,I,h])}var KC=ue.createContext(null);function JC(h){let g=ue.useContext(ou).outlet;return g&&ue.createElement(KC.Provider,{value:h},g)}function QC(){let{matches:h}=ue.useContext(ou),g=h[h.length-1];return g?g.params:{}}function f0(h,{relative:g}={}){let{matches:b}=ue.useContext(ou),{pathname:S}=ko(),I=JSON.stringify(j2(b));return ue.useMemo(()=>N2(h,JSON.parse(I),S,g==="path"),[h,I,S,g])}function e8(h,g){return fT(h,g)}function fT(h,g,b,S){var ye;Us(qg(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:I,static:N}=ue.useContext(sh),{matches:V}=ue.useContext(ou),s=V[V.length-1],q=s?s.params:{},Z=s?s.pathname:"/",Q=s?s.pathnameBase:"/",oe=s&&s.route;{let xe=oe&&oe.path||"";pT(Z,!oe||xe.endsWith("*")||xe.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${Z}" (under <Route path="${xe}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${xe}"> to <Route path="${xe==="/"?"*":`${xe}/*`}">.`)}let de=ko(),ze;if(g){let xe=typeof g=="string"?Vg(g):g;Us(Q==="/"||((ye=xe.pathname)==null?void 0:ye.startsWith(Q)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${Q}" but pathname "${xe.pathname}" was given in the \`location\` prop.`),ze=xe}else ze=de;let le=ze.pathname||"/",Se=le;if(Q!=="/"){let xe=Q.replace(/^\//,"").split("/");Se="/"+le.replace(/^\//,"").split("/").slice(xe.length).join("/")}let ee=!N&&b&&b.matches&&b.matches.length>0?b.matches:aT(h,{pathname:Se});nh(oe||ee!=null,`No routes matched location "${ze.pathname}${ze.search}${ze.hash}" `),nh(ee==null||ee[ee.length-1].route.element!==void 0||ee[ee.length-1].route.Component!==void 0||ee[ee.length-1].route.lazy!==void 0,`Matched leaf route at location "${ze.pathname}${ze.search}${ze.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let _e=s8(ee&&ee.map(xe=>Object.assign({},xe,{params:Object.assign({},q,xe.params),pathname:af([Q,I.encodeLocation?I.encodeLocation(xe.pathname).pathname:xe.pathname]),pathnameBase:xe.pathnameBase==="/"?Q:af([Q,I.encodeLocation?I.encodeLocation(xe.pathnameBase).pathname:xe.pathnameBase])})),V,b,S);return g&&_e?ue.createElement(d0.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...ze},navigationType:"POP"}},_e):_e}function t8(){let h=u8(),g=GC(h)?`${h.status} ${h.statusText}`:h instanceof Error?h.message:JSON.stringify(h),b=h instanceof Error?h.stack:null,S="rgba(200,200,200, 0.5)",I={padding:"0.5rem",backgroundColor:S},N={padding:"2px 4px",backgroundColor:S},V=null;return console.error("Error handled by React Router default ErrorBoundary:",h),V=ue.createElement(ue.Fragment,null,ue.createElement("p",null," Hey developer "),ue.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ue.createElement("code",{style:N},"ErrorBoundary")," or"," ",ue.createElement("code",{style:N},"errorElement")," prop on your route.")),ue.createElement(ue.Fragment,null,ue.createElement("h2",null,"Unexpected Application Error!"),ue.createElement("h3",{style:{fontStyle:"italic"}},g),b?ue.createElement("pre",{style:I},b):null,V)}var i8=ue.createElement(t8,null),r8=class extends ue.Component{constructor(h){super(h),this.state={location:h.location,revalidation:h.revalidation,error:h.error}}static getDerivedStateFromError(h){return{error:h}}static getDerivedStateFromProps(h,g){return g.location!==h.location||g.revalidation!=="idle"&&h.revalidation==="idle"?{error:h.error,location:h.location,revalidation:h.revalidation}:{error:h.error!==void 0?h.error:g.error,location:g.location,revalidation:h.revalidation||g.revalidation}}componentDidCatch(h,g){console.error("React Router caught the following error during render",h,g)}render(){return this.state.error!==void 0?ue.createElement(ou.Provider,{value:this.props.routeContext},ue.createElement(k2.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function n8({routeContext:h,match:g,children:b}){let S=ue.useContext(Hg);return S&&S.static&&S.staticContext&&(g.route.errorElement||g.route.ErrorBoundary)&&(S.staticContext._deepestRenderedBoundaryId=g.route.id),ue.createElement(ou.Provider,{value:h},b)}function s8(h,g=[],b=null,S=null){if(h==null){if(!b)return null;if(b.errors)h=b.matches;else if(g.length===0&&!b.initialized&&b.matches.length>0)h=b.matches;else return null}let I=h,N=b==null?void 0:b.errors;if(N!=null){let q=I.findIndex(Z=>Z.route.id&&(N==null?void 0:N[Z.route.id])!==void 0);Us(q>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(N).join(",")}`),I=I.slice(0,Math.min(I.length,q+1))}let V=!1,s=-1;if(b)for(let q=0;q<I.length;q++){let Z=I[q];if((Z.route.HydrateFallback||Z.route.hydrateFallbackElement)&&(s=q),Z.route.id){let{loaderData:Q,errors:oe}=b,de=Z.route.loader&&!Q.hasOwnProperty(Z.route.id)&&(!oe||oe[Z.route.id]===void 0);if(Z.route.lazy||de){V=!0,s>=0?I=I.slice(0,s+1):I=[I[0]];break}}}return I.reduceRight((q,Z,Q)=>{let oe,de=!1,ze=null,le=null;b&&(oe=N&&Z.route.id?N[Z.route.id]:void 0,ze=Z.route.errorElement||i8,V&&(s<0&&Q===0?(pT("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),de=!0,le=null):s===Q&&(de=!0,le=Z.route.hydrateFallbackElement||null)));let Se=g.concat(I.slice(0,Q+1)),ee=()=>{let _e;return oe?_e=ze:de?_e=le:Z.route.Component?_e=ue.createElement(Z.route.Component,null):Z.route.element?_e=Z.route.element:_e=q,ue.createElement(n8,{match:Z,routeContext:{outlet:q,matches:Se,isDataRoute:b!=null},children:_e})};return b&&(Z.route.ErrorBoundary||Z.route.errorElement||Q===0)?ue.createElement(r8,{location:b.location,revalidation:b.revalidation,component:ze,error:oe,children:ee(),routeContext:{outlet:null,matches:Se,isDataRoute:!0}}):ee()},null)}function B2(h){return`${h} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function a8(h){let g=ue.useContext(Hg);return Us(g,B2(h)),g}function o8(h){let g=ue.useContext(x1);return Us(g,B2(h)),g}function l8(h){let g=ue.useContext(ou);return Us(g,B2(h)),g}function F2(h){let g=l8(h),b=g.matches[g.matches.length-1];return Us(b.route.id,`${h} can only be used on routes that contain a unique "id"`),b.route.id}function c8(){return F2("useRouteId")}function u8(){var S;let h=ue.useContext(k2),g=o8("useRouteError"),b=F2("useRouteError");return h!==void 0?h:(S=g.errors)==null?void 0:S[b]}function h8(){let{router:h}=a8("useNavigate"),g=F2("useNavigate"),b=ue.useRef(!1);return dT(()=>{b.current=!0}),ue.useCallback(async(I,N={})=>{nh(b.current,hT),b.current&&(typeof I=="number"?h.navigate(I):await h.navigate(I,{fromRouteId:g,...N}))},[h,g])}var a4={};function pT(h,g,b){!g&&!a4[h]&&(a4[h]=!0,nh(!1,b))}ue.memo(d8);function d8({routes:h,future:g,state:b}){return fT(h,void 0,b,g)}function Il({to:h,replace:g,state:b,relative:S}){Us(qg(),"<Navigate> may be used only in the context of a <Router> component.");let{static:I}=ue.useContext(sh);nh(!I,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:N}=ue.useContext(ou),{pathname:V}=ko(),s=Pl(),q=N2(h,j2(N),V,S==="path"),Z=JSON.stringify(q);return ue.useEffect(()=>{s(JSON.parse(Z),{replace:g,state:b,relative:S})},[s,Z,S,g,b]),null}function i2(h){return JC(h.context)}function Xi(h){Us(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function f8({basename:h="/",children:g=null,location:b,navigationType:S="POP",navigator:I,static:N=!1}){Us(!qg(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let V=h.replace(/^\/*/,"/"),s=ue.useMemo(()=>({basename:V,navigator:I,static:N,future:{}}),[V,I,N]);typeof b=="string"&&(b=Vg(b));let{pathname:q="/",search:Z="",hash:Q="",state:oe=null,key:de="default"}=b,ze=ue.useMemo(()=>{let le=of(q,V);return le==null?null:{location:{pathname:le,search:Z,hash:Q,state:oe,key:de},navigationType:S}},[V,q,Z,Q,oe,de,S]);return nh(ze!=null,`<Router basename="${V}"> is not able to match the URL "${q}${Z}${Q}" because it does not start with the basename, so the <Router> won't render anything.`),ze==null?null:ue.createElement(sh.Provider,{value:s},ue.createElement(d0.Provider,{children:g,value:ze}))}function p8({children:h,location:g}){return e8(r2(h),g)}function r2(h,g=[]){let b=[];return ue.Children.forEach(h,(S,I)=>{if(!ue.isValidElement(S))return;let N=[...g,I];if(S.type===ue.Fragment){b.push.apply(b,r2(S.props.children,N));return}Us(S.type===Xi,`[${typeof S.type=="string"?S.type:S.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Us(!S.props.index||!S.props.children,"An index route cannot have child routes.");let V={id:S.props.id||N.join("-"),caseSensitive:S.props.caseSensitive,element:S.props.element,Component:S.props.Component,index:S.props.index,path:S.props.path,loader:S.props.loader,action:S.props.action,hydrateFallbackElement:S.props.hydrateFallbackElement,HydrateFallback:S.props.HydrateFallback,errorElement:S.props.errorElement,ErrorBoundary:S.props.ErrorBoundary,hasErrorBoundary:S.props.hasErrorBoundary===!0||S.props.ErrorBoundary!=null||S.props.errorElement!=null,shouldRevalidate:S.props.shouldRevalidate,handle:S.props.handle,lazy:S.props.lazy};S.props.children&&(V.children=r2(S.props.children,N)),b.push(V)}),b}var ky="get",By="application/x-www-form-urlencoded";function v1(h){return h!=null&&typeof h.tagName=="string"}function m8(h){return v1(h)&&h.tagName.toLowerCase()==="button"}function g8(h){return v1(h)&&h.tagName.toLowerCase()==="form"}function _8(h){return v1(h)&&h.tagName.toLowerCase()==="input"}function y8(h){return!!(h.metaKey||h.altKey||h.ctrlKey||h.shiftKey)}function x8(h,g){return h.button===0&&(!g||g==="_self")&&!y8(h)}var Ry=null;function v8(){if(Ry===null)try{new FormData(document.createElement("form"),0),Ry=!1}catch{Ry=!0}return Ry}var b8=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function iv(h){return h!=null&&!b8.has(h)?(nh(!1,`"${h}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${By}"`),null):h}function w8(h,g){let b,S,I,N,V;if(g8(h)){let s=h.getAttribute("action");S=s?of(s,g):null,b=h.getAttribute("method")||ky,I=iv(h.getAttribute("enctype"))||By,N=new FormData(h)}else if(m8(h)||_8(h)&&(h.type==="submit"||h.type==="image")){let s=h.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let q=h.getAttribute("formaction")||s.getAttribute("action");if(S=q?of(q,g):null,b=h.getAttribute("formmethod")||s.getAttribute("method")||ky,I=iv(h.getAttribute("formenctype"))||iv(s.getAttribute("enctype"))||By,N=new FormData(s,h),!v8()){let{name:Z,type:Q,value:oe}=h;if(Q==="image"){let de=Z?`${Z}.`:"";N.append(`${de}x`,"0"),N.append(`${de}y`,"0")}else Z&&N.append(Z,oe)}}else{if(v1(h))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');b=ky,S=null,I=By,V=h}return N&&I==="text/plain"&&(V=N,N=void 0),{action:S,method:b.toLowerCase(),encType:I,formData:N,body:V}}function U2(h,g){if(h===!1||h===null||typeof h>"u")throw new Error(g)}async function T8(h,g){if(h.id in g)return g[h.id];try{let b=await import(h.module);return g[h.id]=b,b}catch(b){return console.error(`Error loading route module \`${h.module}\`, reloading page...`),console.error(b),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function S8(h){return h==null?!1:h.href==null?h.rel==="preload"&&typeof h.imageSrcSet=="string"&&typeof h.imageSizes=="string":typeof h.rel=="string"&&typeof h.href=="string"}async function E8(h,g,b){let S=await Promise.all(h.map(async I=>{let N=g.routes[I.route.id];if(N){let V=await T8(N,b);return V.links?V.links():[]}return[]}));return M8(S.flat(1).filter(S8).filter(I=>I.rel==="stylesheet"||I.rel==="preload").map(I=>I.rel==="stylesheet"?{...I,rel:"prefetch",as:"style"}:{...I,rel:"prefetch"}))}function o4(h,g,b,S,I,N){let V=(q,Z)=>b[Z]?q.route.id!==b[Z].route.id:!0,s=(q,Z)=>{var Q;return b[Z].pathname!==q.pathname||((Q=b[Z].route.path)==null?void 0:Q.endsWith("*"))&&b[Z].params["*"]!==q.params["*"]};return N==="assets"?g.filter((q,Z)=>V(q,Z)||s(q,Z)):N==="data"?g.filter((q,Z)=>{var oe;let Q=S.routes[q.route.id];if(!Q||!Q.hasLoader)return!1;if(V(q,Z)||s(q,Z))return!0;if(q.route.shouldRevalidate){let de=q.route.shouldRevalidate({currentUrl:new URL(I.pathname+I.search+I.hash,window.origin),currentParams:((oe=b[0])==null?void 0:oe.params)||{},nextUrl:new URL(h,window.origin),nextParams:q.params,defaultShouldRevalidate:!0});if(typeof de=="boolean")return de}return!0}):[]}function A8(h,g,{includeHydrateFallback:b}={}){return C8(h.map(S=>{let I=g.routes[S.route.id];if(!I)return[];let N=[I.module];return I.clientActionModule&&(N=N.concat(I.clientActionModule)),I.clientLoaderModule&&(N=N.concat(I.clientLoaderModule)),b&&I.hydrateFallbackModule&&(N=N.concat(I.hydrateFallbackModule)),I.imports&&(N=N.concat(I.imports)),N}).flat(1))}function C8(h){return[...new Set(h)]}function R8(h){let g={},b=Object.keys(h).sort();for(let S of b)g[S]=h[S];return g}function M8(h,g){let b=new Set;return new Set(g),h.reduce((S,I)=>{let N=JSON.stringify(R8(I));return b.has(N)||(b.add(N),S.push({key:N,link:I})),S},[])}function I8(h,g){let b=typeof h=="string"?new URL(h,typeof window>"u"?"server://singlefetch/":window.location.origin):h;return b.pathname==="/"?b.pathname="_root.data":g&&of(b.pathname,g)==="/"?b.pathname=`${g.replace(/\/$/,"")}/_root.data`:b.pathname=`${b.pathname.replace(/\/$/,"")}.data`,b}function mT(){let h=ue.useContext(Hg);return U2(h,"You must render this element inside a <DataRouterContext.Provider> element"),h}function z8(){let h=ue.useContext(x1);return U2(h,"You must render this element inside a <DataRouterStateContext.Provider> element"),h}var V2=ue.createContext(void 0);V2.displayName="FrameworkContext";function gT(){let h=ue.useContext(V2);return U2(h,"You must render this element inside a <HydratedRouter> element"),h}function L8(h,g){let b=ue.useContext(V2),[S,I]=ue.useState(!1),[N,V]=ue.useState(!1),{onFocus:s,onBlur:q,onMouseEnter:Z,onMouseLeave:Q,onTouchStart:oe}=g,de=ue.useRef(null);ue.useEffect(()=>{if(h==="render"&&V(!0),h==="viewport"){let Se=_e=>{_e.forEach(ye=>{V(ye.isIntersecting)})},ee=new IntersectionObserver(Se,{threshold:.5});return de.current&&ee.observe(de.current),()=>{ee.disconnect()}}},[h]),ue.useEffect(()=>{if(S){let Se=setTimeout(()=>{V(!0)},100);return()=>{clearTimeout(Se)}}},[S]);let ze=()=>{I(!0)},le=()=>{I(!1),V(!1)};return b?h!=="intent"?[N,de,{}]:[N,de,{onFocus:X_(s,ze),onBlur:X_(q,le),onMouseEnter:X_(Z,ze),onMouseLeave:X_(Q,le),onTouchStart:X_(oe,ze)}]:[!1,de,{}]}function X_(h,g){return b=>{h&&h(b),b.defaultPrevented||g(b)}}function D8({page:h,...g}){let{router:b}=mT(),S=ue.useMemo(()=>aT(b.routes,h,b.basename),[b.routes,h,b.basename]);return S?ue.createElement(O8,{page:h,matches:S,...g}):null}function P8(h){let{manifest:g,routeModules:b}=gT(),[S,I]=ue.useState([]);return ue.useEffect(()=>{let N=!1;return E8(h,g,b).then(V=>{N||I(V)}),()=>{N=!0}},[h,g,b]),S}function O8({page:h,matches:g,...b}){let S=ko(),{manifest:I,routeModules:N}=gT(),{basename:V}=mT(),{loaderData:s,matches:q}=z8(),Z=ue.useMemo(()=>o4(h,g,q,I,S,"data"),[h,g,q,I,S]),Q=ue.useMemo(()=>o4(h,g,q,I,S,"assets"),[h,g,q,I,S]),oe=ue.useMemo(()=>{if(h===S.pathname+S.search+S.hash)return[];let le=new Set,Se=!1;if(g.forEach(_e=>{var xe;let ye=I.routes[_e.route.id];!ye||!ye.hasLoader||(!Z.some(Le=>Le.route.id===_e.route.id)&&_e.route.id in s&&((xe=N[_e.route.id])!=null&&xe.shouldRevalidate)||ye.hasClientLoader?Se=!0:le.add(_e.route.id))}),le.size===0)return[];let ee=I8(h,V);return Se&&le.size>0&&ee.searchParams.set("_routes",g.filter(_e=>le.has(_e.route.id)).map(_e=>_e.route.id).join(",")),[ee.pathname+ee.search]},[V,s,S,I,Z,g,h,N]),de=ue.useMemo(()=>A8(Q,I),[Q,I]),ze=P8(Q);return ue.createElement(ue.Fragment,null,oe.map(le=>ue.createElement("link",{key:le,rel:"prefetch",as:"fetch",href:le,...b})),de.map(le=>ue.createElement("link",{key:le,rel:"modulepreload",href:le,...b})),ze.map(({key:le,link:Se})=>ue.createElement("link",{key:le,...Se})))}function j8(...h){return g=>{h.forEach(b=>{typeof b=="function"?b(g):b!=null&&(b.current=g)})}}var _T=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{_T&&(window.__reactRouterVersion="7.3.0")}catch{}function N8({basename:h,children:g,window:b}){let S=ue.useRef();S.current==null&&(S.current=TC({window:b,v5Compat:!0}));let I=S.current,[N,V]=ue.useState({action:I.action,location:I.location}),s=ue.useCallback(q=>{ue.startTransition(()=>V(q))},[V]);return ue.useLayoutEffect(()=>I.listen(s),[I,s]),ue.createElement(f8,{basename:h,children:g,location:N.location,navigationType:N.action,navigator:I})}var yT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Fs=ue.forwardRef(function({onClick:g,discover:b="render",prefetch:S="none",relative:I,reloadDocument:N,replace:V,state:s,target:q,to:Z,preventScrollReset:Q,viewTransition:oe,...de},ze){let{basename:le}=ue.useContext(sh),Se=typeof Z=="string"&&yT.test(Z),ee,_e=!1;if(typeof Z=="string"&&Se&&(ee=Z,_T))try{let lt=new URL(window.location.href),zt=Z.startsWith("//")?new URL(lt.protocol+Z):new URL(Z),xt=of(zt.pathname,le);zt.origin===lt.origin&&xt!=null?Z=xt+zt.search+zt.hash:_e=!0}catch{nh(!1,`<Link to="${Z}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let ye=XC(Z,{relative:I}),[xe,Le,Ae]=L8(S,de),Ke=U8(Z,{replace:V,state:s,target:q,preventScrollReset:Q,relative:I,viewTransition:oe});function it(lt){g&&g(lt),lt.defaultPrevented||Ke(lt)}let rt=ue.createElement("a",{...de,...Ae,href:ee||ye,onClick:_e||N?g:it,ref:j8(ze,Le),target:q,"data-discover":!Se&&b==="render"?"true":void 0});return xe&&!Se?ue.createElement(ue.Fragment,null,rt,ue.createElement(D8,{page:ye})):rt});Fs.displayName="Link";var k8=ue.forwardRef(function({"aria-current":g="page",caseSensitive:b=!1,className:S="",end:I=!1,style:N,to:V,viewTransition:s,children:q,...Z},Q){let oe=f0(V,{relative:Z.relative}),de=ko(),ze=ue.useContext(x1),{navigator:le,basename:Se}=ue.useContext(sh),ee=ze!=null&&$8(oe)&&s===!0,_e=le.encodeLocation?le.encodeLocation(oe).pathname:oe.pathname,ye=de.pathname,xe=ze&&ze.navigation&&ze.navigation.location?ze.navigation.location.pathname:null;b||(ye=ye.toLowerCase(),xe=xe?xe.toLowerCase():null,_e=_e.toLowerCase()),xe&&Se&&(xe=of(xe,Se)||xe);const Le=_e!=="/"&&_e.endsWith("/")?_e.length-1:_e.length;let Ae=ye===_e||!I&&ye.startsWith(_e)&&ye.charAt(Le)==="/",Ke=xe!=null&&(xe===_e||!I&&xe.startsWith(_e)&&xe.charAt(_e.length)==="/"),it={isActive:Ae,isPending:Ke,isTransitioning:ee},rt=Ae?g:void 0,lt;typeof S=="function"?lt=S(it):lt=[S,Ae?"active":null,Ke?"pending":null,ee?"transitioning":null].filter(Boolean).join(" ");let zt=typeof N=="function"?N(it):N;return ue.createElement(Fs,{...Z,"aria-current":rt,className:lt,ref:Q,style:zt,to:V,viewTransition:s},typeof q=="function"?q(it):q)});k8.displayName="NavLink";var B8=ue.forwardRef(({discover:h="render",fetcherKey:g,navigate:b,reloadDocument:S,replace:I,state:N,method:V=ky,action:s,onSubmit:q,relative:Z,preventScrollReset:Q,viewTransition:oe,...de},ze)=>{let le=q8(),Se=G8(s,{relative:Z}),ee=V.toLowerCase()==="get"?"get":"post",_e=typeof s=="string"&&yT.test(s),ye=xe=>{if(q&&q(xe),xe.defaultPrevented)return;xe.preventDefault();let Le=xe.nativeEvent.submitter,Ae=(Le==null?void 0:Le.getAttribute("formmethod"))||V;le(Le||xe.currentTarget,{fetcherKey:g,method:Ae,navigate:b,replace:I,state:N,relative:Z,preventScrollReset:Q,viewTransition:oe})};return ue.createElement("form",{ref:ze,method:ee,action:Se,onSubmit:S?q:ye,...de,"data-discover":!_e&&h==="render"?"true":void 0})});B8.displayName="Form";function F8(h){return`${h} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function xT(h){let g=ue.useContext(Hg);return Us(g,F8(h)),g}function U8(h,{target:g,replace:b,state:S,preventScrollReset:I,relative:N,viewTransition:V}={}){let s=Pl(),q=ko(),Z=f0(h,{relative:N});return ue.useCallback(Q=>{if(x8(Q,g)){Q.preventDefault();let oe=b!==void 0?b:a0(q)===a0(Z);s(h,{replace:oe,state:S,preventScrollReset:I,relative:N,viewTransition:V})}},[q,s,Z,b,S,g,h,I,N,V])}var V8=0,H8=()=>`__${String(++V8)}__`;function q8(){let{router:h}=xT("useSubmit"),{basename:g}=ue.useContext(sh),b=c8();return ue.useCallback(async(S,I={})=>{let{action:N,method:V,encType:s,formData:q,body:Z}=w8(S,g);if(I.navigate===!1){let Q=I.fetcherKey||H8();await h.fetch(Q,b,I.action||N,{preventScrollReset:I.preventScrollReset,formData:q,body:Z,formMethod:I.method||V,formEncType:I.encType||s,flushSync:I.flushSync})}else await h.navigate(I.action||N,{preventScrollReset:I.preventScrollReset,formData:q,body:Z,formMethod:I.method||V,formEncType:I.encType||s,replace:I.replace,state:I.state,fromRouteId:b,flushSync:I.flushSync,viewTransition:I.viewTransition})},[h,g,b])}function G8(h,{relative:g}={}){let{basename:b}=ue.useContext(sh),S=ue.useContext(ou);Us(S,"useFormAction must be used inside a RouteContext");let[I]=S.matches.slice(-1),N={...f0(h||".",{relative:g})},V=ko();if(h==null){N.search=V.search;let s=new URLSearchParams(N.search),q=s.getAll("index");if(q.some(Q=>Q==="")){s.delete("index"),q.filter(oe=>oe).forEach(oe=>s.append("index",oe));let Q=s.toString();N.search=Q?`?${Q}`:""}}return(!h||h===".")&&I.route.index&&(N.search=N.search?N.search.replace(/^\?/,"?index&"):"?index"),b!=="/"&&(N.pathname=N.pathname==="/"?b:af([b,N.pathname])),a0(N)}function $8(h,g={}){let b=ue.useContext(uT);Us(b!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:S}=xT("useViewTransitionState"),I=f0(h,{relative:g.relative});if(!b.isTransitioning)return!1;let N=of(b.currentLocation.pathname,S)||b.currentLocation.pathname,V=of(b.nextLocation.pathname,S)||b.nextLocation.pathname;return i1(I.pathname,V)!=null||i1(I.pathname,N)!=null}new TextEncoder;var l4=sT(),rv={exports:{}},nv={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var c4;function Z8(){if(c4)return nv;c4=1;var h=y1();function g(q,Z){return q===Z&&(q!==0||1/q===1/Z)||q!==q&&Z!==Z}var b=typeof Object.is=="function"?Object.is:g,S=h.useSyncExternalStore,I=h.useRef,N=h.useEffect,V=h.useMemo,s=h.useDebugValue;return nv.useSyncExternalStoreWithSelector=function(q,Z,Q,oe,de){var ze=I(null);if(ze.current===null){var le={hasValue:!1,value:null};ze.current=le}else le=ze.current;ze=V(function(){function ee(Ae){if(!_e){if(_e=!0,ye=Ae,Ae=oe(Ae),de!==void 0&&le.hasValue){var Ke=le.value;if(de(Ke,Ae))return xe=Ke}return xe=Ae}if(Ke=xe,b(ye,Ae))return Ke;var it=oe(Ae);return de!==void 0&&de(Ke,it)?(ye=Ae,Ke):(ye=Ae,xe=it)}var _e=!1,ye,xe,Le=Q===void 0?null:Q;return[function(){return ee(Z())},Le===null?void 0:function(){return ee(Le())}]},[Z,Q,oe,de]);var Se=S(q,ze[0],ze[1]);return N(function(){le.hasValue=!0,le.value=Se},[Se]),s(Se),Se},nv}var u4;function W8(){return u4||(u4=1,rv.exports=Z8()),rv.exports}var X8=W8();function Y8(h){h()}function K8(){let h=null,g=null;return{clear(){h=null,g=null},notify(){Y8(()=>{let b=h;for(;b;)b.callback(),b=b.next})},get(){const b=[];let S=h;for(;S;)b.push(S),S=S.next;return b},subscribe(b){let S=!0;const I=g={callback:b,next:null,prev:g};return I.prev?I.prev.next=I:h=I,function(){!S||h===null||(S=!1,I.next?I.next.prev=I.prev:g=I.prev,I.prev?I.prev.next=I.next:h=I.next)}}}}var h4={notify(){},get:()=>[]};function J8(h,g){let b,S=h4,I=0,N=!1;function V(Se){Q();const ee=S.subscribe(Se);let _e=!1;return()=>{_e||(_e=!0,ee(),oe())}}function s(){S.notify()}function q(){le.onStateChange&&le.onStateChange()}function Z(){return N}function Q(){I++,b||(b=h.subscribe(q),S=K8())}function oe(){I--,b&&I===0&&(b(),b=void 0,S.clear(),S=h4)}function de(){N||(N=!0,Q())}function ze(){N&&(N=!1,oe())}const le={addNestedSub:V,notifyNestedSubs:s,handleChangeWrapper:q,isSubscribed:Z,trySubscribe:de,tryUnsubscribe:ze,getListeners:()=>S};return le}var Q8=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",eR=Q8(),tR=()=>typeof navigator<"u"&&navigator.product==="ReactNative",iR=tR(),rR=()=>eR||iR?ue.useLayoutEffect:ue.useEffect,nR=rR(),sv=Symbol.for("react-redux-context"),av=typeof globalThis<"u"?globalThis:{};function sR(){if(!ue.createContext)return{};const h=av[sv]??(av[sv]=new Map);let g=h.get(ue.createContext);return g||(g=ue.createContext(null),h.set(ue.createContext,g)),g}var xp=sR();function aR(h){const{children:g,context:b,serverState:S,store:I}=h,N=ue.useMemo(()=>{const q=J8(I);return{store:I,subscription:q,getServerState:S?()=>S:void 0}},[I,S]),V=ue.useMemo(()=>I.getState(),[I]);nR(()=>{const{subscription:q}=N;return q.onStateChange=q.notifyNestedSubs,q.trySubscribe(),V!==I.getState()&&q.notifyNestedSubs(),()=>{q.tryUnsubscribe(),q.onStateChange=void 0}},[N,V]);const s=b||xp;return ue.createElement(s.Provider,{value:N},g)}var oR=aR;function H2(h=xp){return function(){return ue.useContext(h)}}var vT=H2();function bT(h=xp){const g=h===xp?vT:H2(h),b=()=>{const{store:S}=g();return S};return Object.assign(b,{withTypes:()=>b}),b}var lR=bT();function cR(h=xp){const g=h===xp?lR:bT(h),b=()=>g().dispatch;return Object.assign(b,{withTypes:()=>b}),b}var bp=cR(),uR=(h,g)=>h===g;function hR(h=xp){const g=h===xp?vT:H2(h),b=(S,I={})=>{const{equalityFn:N=uR}=typeof I=="function"?{equalityFn:I}:I,V=g(),{store:s,subscription:q,getServerState:Z}=V;ue.useRef(!0);const Q=ue.useCallback({[S.name](de){return S(de)}}[S.name],[S]),oe=X8.useSyncExternalStoreWithSelector(q.addNestedSub,s.getState,Z||s.getState,Q,N);return ue.useDebugValue(oe),oe};return Object.assign(b,{withTypes:()=>b}),b}var yo=hR();function go(h){return`Minified Redux error #${h}; visit https://redux.js.org/Errors?code=${h} for the full message or use the non-minified dev environment for full errors. `}var dR=typeof Symbol=="function"&&Symbol.observable||"@@observable",d4=dR,ov=()=>Math.random().toString(36).substring(7).split("").join("."),fR={INIT:`@@redux/INIT${ov()}`,REPLACE:`@@redux/REPLACE${ov()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${ov()}`},r1=fR;function q2(h){if(typeof h!="object"||h===null)return!1;let g=h;for(;Object.getPrototypeOf(g)!==null;)g=Object.getPrototypeOf(g);return Object.getPrototypeOf(h)===g||Object.getPrototypeOf(h)===null}function G2(h,g,b){if(typeof h!="function")throw new Error(go(2));if(typeof g=="function"&&typeof b=="function"||typeof b=="function"&&typeof arguments[3]=="function")throw new Error(go(0));if(typeof g=="function"&&typeof b>"u"&&(b=g,g=void 0),typeof b<"u"){if(typeof b!="function")throw new Error(go(1));return b(G2)(h,g)}let S=h,I=g,N=new Map,V=N,s=0,q=!1;function Z(){V===N&&(V=new Map,N.forEach((ee,_e)=>{V.set(_e,ee)}))}function Q(){if(q)throw new Error(go(3));return I}function oe(ee){if(typeof ee!="function")throw new Error(go(4));if(q)throw new Error(go(5));let _e=!0;Z();const ye=s++;return V.set(ye,ee),function(){if(_e){if(q)throw new Error(go(6));_e=!1,Z(),V.delete(ye),N=null}}}function de(ee){if(!q2(ee))throw new Error(go(7));if(typeof ee.type>"u")throw new Error(go(8));if(typeof ee.type!="string")throw new Error(go(17));if(q)throw new Error(go(9));try{q=!0,I=S(I,ee)}finally{q=!1}return(N=V).forEach(ye=>{ye()}),ee}function ze(ee){if(typeof ee!="function")throw new Error(go(10));S=ee,de({type:r1.REPLACE})}function le(){const ee=oe;return{subscribe(_e){if(typeof _e!="object"||_e===null)throw new Error(go(11));function ye(){const Le=_e;Le.next&&Le.next(Q())}return ye(),{unsubscribe:ee(ye)}},[d4](){return this}}}return de({type:r1.INIT}),{dispatch:de,subscribe:oe,getState:Q,replaceReducer:ze,[d4]:le}}function pR(h){Object.keys(h).forEach(g=>{const b=h[g];if(typeof b(void 0,{type:r1.INIT})>"u")throw new Error(go(12));if(typeof b(void 0,{type:r1.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(go(13))})}function wT(h){const g=Object.keys(h),b={};for(let N=0;N<g.length;N++){const V=g[N];typeof h[V]=="function"&&(b[V]=h[V])}const S=Object.keys(b);let I;try{pR(b)}catch(N){I=N}return function(V={},s){if(I)throw I;let q=!1;const Z={};for(let Q=0;Q<S.length;Q++){const oe=S[Q],de=b[oe],ze=V[oe],le=de(ze,s);if(typeof le>"u")throw s&&s.type,new Error(go(14));Z[oe]=le,q=q||le!==ze}return q=q||S.length!==Object.keys(V).length,q?Z:V}}function n1(...h){return h.length===0?g=>g:h.length===1?h[0]:h.reduce((g,b)=>(...S)=>g(b(...S)))}function mR(...h){return g=>(b,S)=>{const I=g(b,S);let N=()=>{throw new Error(go(15))};const V={getState:I.getState,dispatch:(q,...Z)=>N(q,...Z)},s=h.map(q=>q(V));return N=n1(...s)(I.dispatch),{...I,dispatch:N}}}function TT(h){return q2(h)&&"type"in h&&typeof h.type=="string"}var ST=Symbol.for("immer-nothing"),f4=Symbol.for("immer-draftable"),xc=Symbol.for("immer-state");function rh(h,...g){throw new Error(`[Immer] minified error nr: ${h}. Full error at: https://bit.ly/3cXEKWf`)}var kg=Object.getPrototypeOf;function zm(h){return!!h&&!!h[xc]}function lf(h){var g;return h?ET(h)||Array.isArray(h)||!!h[f4]||!!((g=h.constructor)!=null&&g[f4])||w1(h)||T1(h):!1}var gR=Object.prototype.constructor.toString();function ET(h){if(!h||typeof h!="object")return!1;const g=kg(h);if(g===null)return!0;const b=Object.hasOwnProperty.call(g,"constructor")&&g.constructor;return b===Object?!0:typeof b=="function"&&Function.toString.call(b)===gR}function s1(h,g){b1(h)===0?Reflect.ownKeys(h).forEach(b=>{g(b,h[b],h)}):h.forEach((b,S)=>g(S,b,h))}function b1(h){const g=h[xc];return g?g.type_:Array.isArray(h)?1:w1(h)?2:T1(h)?3:0}function n2(h,g){return b1(h)===2?h.has(g):Object.prototype.hasOwnProperty.call(h,g)}function AT(h,g,b){const S=b1(h);S===2?h.set(g,b):S===3?h.add(b):h[g]=b}function _R(h,g){return h===g?h!==0||1/h===1/g:h!==h&&g!==g}function w1(h){return h instanceof Map}function T1(h){return h instanceof Set}function Tm(h){return h.copy_||h.base_}function s2(h,g){if(w1(h))return new Map(h);if(T1(h))return new Set(h);if(Array.isArray(h))return Array.prototype.slice.call(h);const b=ET(h);if(g===!0||g==="class_only"&&!b){const S=Object.getOwnPropertyDescriptors(h);delete S[xc];let I=Reflect.ownKeys(S);for(let N=0;N<I.length;N++){const V=I[N],s=S[V];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(S[V]={configurable:!0,writable:!0,enumerable:s.enumerable,value:h[V]})}return Object.create(kg(h),S)}else{const S=kg(h);if(S!==null&&b)return{...h};const I=Object.create(S);return Object.assign(I,h)}}function $2(h,g=!1){return S1(h)||zm(h)||!lf(h)||(b1(h)>1&&(h.set=h.add=h.clear=h.delete=yR),Object.freeze(h),g&&Object.entries(h).forEach(([b,S])=>$2(S,!0))),h}function yR(){rh(2)}function S1(h){return Object.isFrozen(h)}var xR={};function Lm(h){const g=xR[h];return g||rh(0,h),g}var o0;function CT(){return o0}function vR(h,g){return{drafts_:[],parent_:h,immer_:g,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function p4(h,g){g&&(Lm("Patches"),h.patches_=[],h.inversePatches_=[],h.patchListener_=g)}function a2(h){o2(h),h.drafts_.forEach(bR),h.drafts_=null}function o2(h){h===o0&&(o0=h.parent_)}function m4(h){return o0=vR(o0,h)}function bR(h){const g=h[xc];g.type_===0||g.type_===1?g.revoke_():g.revoked_=!0}function g4(h,g){g.unfinalizedDrafts_=g.drafts_.length;const b=g.drafts_[0];return h!==void 0&&h!==b?(b[xc].modified_&&(a2(g),rh(4)),lf(h)&&(h=a1(g,h),g.parent_||o1(g,h)),g.patches_&&Lm("Patches").generateReplacementPatches_(b[xc].base_,h,g.patches_,g.inversePatches_)):h=a1(g,b,[]),a2(g),g.patches_&&g.patchListener_(g.patches_,g.inversePatches_),h!==ST?h:void 0}function a1(h,g,b){if(S1(g))return g;const S=g[xc];if(!S)return s1(g,(I,N)=>_4(h,S,g,I,N,b)),g;if(S.scope_!==h)return g;if(!S.modified_)return o1(h,S.base_,!0),S.base_;if(!S.finalized_){S.finalized_=!0,S.scope_.unfinalizedDrafts_--;const I=S.copy_;let N=I,V=!1;S.type_===3&&(N=new Set(I),I.clear(),V=!0),s1(N,(s,q)=>_4(h,S,I,s,q,b,V)),o1(h,I,!1),b&&h.patches_&&Lm("Patches").generatePatches_(S,b,h.patches_,h.inversePatches_)}return S.copy_}function _4(h,g,b,S,I,N,V){if(zm(I)){const s=N&&g&&g.type_!==3&&!n2(g.assigned_,S)?N.concat(S):void 0,q=a1(h,I,s);if(AT(b,S,q),zm(q))h.canAutoFreeze_=!1;else return}else V&&b.add(I);if(lf(I)&&!S1(I)){if(!h.immer_.autoFreeze_&&h.unfinalizedDrafts_<1)return;a1(h,I),(!g||!g.scope_.parent_)&&typeof S!="symbol"&&Object.prototype.propertyIsEnumerable.call(b,S)&&o1(h,I)}}function o1(h,g,b=!1){!h.parent_&&h.immer_.autoFreeze_&&h.canAutoFreeze_&&$2(g,b)}function wR(h,g){const b=Array.isArray(h),S={type_:b?1:0,scope_:g?g.scope_:CT(),modified_:!1,finalized_:!1,assigned_:{},parent_:g,base_:h,draft_:null,copy_:null,revoke_:null,isManual_:!1};let I=S,N=Z2;b&&(I=[S],N=l0);const{revoke:V,proxy:s}=Proxy.revocable(I,N);return S.draft_=s,S.revoke_=V,s}var Z2={get(h,g){if(g===xc)return h;const b=Tm(h);if(!n2(b,g))return TR(h,b,g);const S=b[g];return h.finalized_||!lf(S)?S:S===lv(h.base_,g)?(cv(h),h.copy_[g]=c2(S,h)):S},has(h,g){return g in Tm(h)},ownKeys(h){return Reflect.ownKeys(Tm(h))},set(h,g,b){const S=RT(Tm(h),g);if(S!=null&&S.set)return S.set.call(h.draft_,b),!0;if(!h.modified_){const I=lv(Tm(h),g),N=I==null?void 0:I[xc];if(N&&N.base_===b)return h.copy_[g]=b,h.assigned_[g]=!1,!0;if(_R(b,I)&&(b!==void 0||n2(h.base_,g)))return!0;cv(h),l2(h)}return h.copy_[g]===b&&(b!==void 0||g in h.copy_)||Number.isNaN(b)&&Number.isNaN(h.copy_[g])||(h.copy_[g]=b,h.assigned_[g]=!0),!0},deleteProperty(h,g){return lv(h.base_,g)!==void 0||g in h.base_?(h.assigned_[g]=!1,cv(h),l2(h)):delete h.assigned_[g],h.copy_&&delete h.copy_[g],!0},getOwnPropertyDescriptor(h,g){const b=Tm(h),S=Reflect.getOwnPropertyDescriptor(b,g);return S&&{writable:!0,configurable:h.type_!==1||g!=="length",enumerable:S.enumerable,value:b[g]}},defineProperty(){rh(11)},getPrototypeOf(h){return kg(h.base_)},setPrototypeOf(){rh(12)}},l0={};s1(Z2,(h,g)=>{l0[h]=function(){return arguments[0]=arguments[0][0],g.apply(this,arguments)}});l0.deleteProperty=function(h,g){return l0.set.call(this,h,g,void 0)};l0.set=function(h,g,b){return Z2.set.call(this,h[0],g,b,h[0])};function lv(h,g){const b=h[xc];return(b?Tm(b):h)[g]}function TR(h,g,b){var I;const S=RT(g,b);return S?"value"in S?S.value:(I=S.get)==null?void 0:I.call(h.draft_):void 0}function RT(h,g){if(!(g in h))return;let b=kg(h);for(;b;){const S=Object.getOwnPropertyDescriptor(b,g);if(S)return S;b=kg(b)}}function l2(h){h.modified_||(h.modified_=!0,h.parent_&&l2(h.parent_))}function cv(h){h.copy_||(h.copy_=s2(h.base_,h.scope_.immer_.useStrictShallowCopy_))}var SR=class{constructor(h){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(g,b,S)=>{if(typeof g=="function"&&typeof b!="function"){const N=b;b=g;const V=this;return function(q=N,...Z){return V.produce(q,Q=>b.call(this,Q,...Z))}}typeof b!="function"&&rh(6),S!==void 0&&typeof S!="function"&&rh(7);let I;if(lf(g)){const N=m4(this),V=c2(g,void 0);let s=!0;try{I=b(V),s=!1}finally{s?a2(N):o2(N)}return p4(N,S),g4(I,N)}else if(!g||typeof g!="object"){if(I=b(g),I===void 0&&(I=g),I===ST&&(I=void 0),this.autoFreeze_&&$2(I,!0),S){const N=[],V=[];Lm("Patches").generateReplacementPatches_(g,I,N,V),S(N,V)}return I}else rh(1,g)},this.produceWithPatches=(g,b)=>{if(typeof g=="function")return(V,...s)=>this.produceWithPatches(V,q=>g(q,...s));let S,I;return[this.produce(g,b,(V,s)=>{S=V,I=s}),S,I]},typeof(h==null?void 0:h.autoFreeze)=="boolean"&&this.setAutoFreeze(h.autoFreeze),typeof(h==null?void 0:h.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(h.useStrictShallowCopy)}createDraft(h){lf(h)||rh(8),zm(h)&&(h=ER(h));const g=m4(this),b=c2(h,void 0);return b[xc].isManual_=!0,o2(g),b}finishDraft(h,g){const b=h&&h[xc];(!b||!b.isManual_)&&rh(9);const{scope_:S}=b;return p4(S,g),g4(void 0,S)}setAutoFreeze(h){this.autoFreeze_=h}setUseStrictShallowCopy(h){this.useStrictShallowCopy_=h}applyPatches(h,g){let b;for(b=g.length-1;b>=0;b--){const I=g[b];if(I.path.length===0&&I.op==="replace"){h=I.value;break}}b>-1&&(g=g.slice(b+1));const S=Lm("Patches").applyPatches_;return zm(h)?S(h,g):this.produce(h,I=>S(I,g))}};function c2(h,g){const b=w1(h)?Lm("MapSet").proxyMap_(h,g):T1(h)?Lm("MapSet").proxySet_(h,g):wR(h,g);return(g?g.scope_:CT()).drafts_.push(b),b}function ER(h){return zm(h)||rh(10,h),MT(h)}function MT(h){if(!lf(h)||S1(h))return h;const g=h[xc];let b;if(g){if(!g.modified_)return g.base_;g.finalized_=!0,b=s2(h,g.scope_.immer_.useStrictShallowCopy_)}else b=s2(h,!0);return s1(b,(S,I)=>{AT(b,S,MT(I))}),g&&(g.finalized_=!1),b}var vc=new SR,IT=vc.produce;vc.produceWithPatches.bind(vc);vc.setAutoFreeze.bind(vc);vc.setUseStrictShallowCopy.bind(vc);vc.applyPatches.bind(vc);vc.createDraft.bind(vc);vc.finishDraft.bind(vc);function yj(h){return h}function zT(h){return({dispatch:b,getState:S})=>I=>N=>typeof N=="function"?N(b,S,h):I(N)}var AR=zT(),CR=zT,RR=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?n1:n1.apply(null,arguments)};function Bg(h,g){function b(...S){if(g){let I=g(...S);if(!I)throw new Error(yc(0));return{type:h,payload:I.payload,..."meta"in I&&{meta:I.meta},..."error"in I&&{error:I.error}}}return{type:h,payload:S[0]}}return b.toString=()=>`${h}`,b.type=h,b.match=S=>TT(S)&&S.type===h,b}var LT=class t0 extends Array{constructor(...g){super(...g),Object.setPrototypeOf(this,t0.prototype)}static get[Symbol.species](){return t0}concat(...g){return super.concat.apply(this,g)}prepend(...g){return g.length===1&&Array.isArray(g[0])?new t0(...g[0].concat(this)):new t0(...g.concat(this))}};function y4(h){return lf(h)?IT(h,()=>{}):h}function x4(h,g,b){return h.has(g)?h.get(g):h.set(g,b(g)).get(g)}function MR(h){return typeof h=="boolean"}var IR=()=>function(g){const{thunk:b=!0,immutableCheck:S=!0,serializableCheck:I=!0,actionCreatorCheck:N=!0}=g??{};let V=new LT;return b&&(MR(b)?V.push(AR):V.push(CR(b.extraArgument))),V},zR="RTK_autoBatch",v4=h=>g=>{setTimeout(g,h)},LR=(h={type:"raf"})=>g=>(...b)=>{const S=g(...b);let I=!0,N=!1,V=!1;const s=new Set,q=h.type==="tick"?queueMicrotask:h.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:v4(10):h.type==="callback"?h.queueNotification:v4(h.timeout),Z=()=>{V=!1,N&&(N=!1,s.forEach(Q=>Q()))};return Object.assign({},S,{subscribe(Q){const oe=()=>I&&Q(),de=S.subscribe(oe);return s.add(Q),()=>{de(),s.delete(Q)}},dispatch(Q){var oe;try{return I=!((oe=Q==null?void 0:Q.meta)!=null&&oe[zR]),N=!I,N&&(V||(V=!0,q(Z))),S.dispatch(Q)}finally{I=!0}}})},DR=h=>function(b){const{autoBatch:S=!0}=b??{};let I=new LT(h);return S&&I.push(LR(typeof S=="object"?S:void 0)),I};function PR(h){const g=IR(),{reducer:b=void 0,middleware:S,devTools:I=!0,preloadedState:N=void 0,enhancers:V=void 0}=h||{};let s;if(typeof b=="function")s=b;else if(q2(b))s=wT(b);else throw new Error(yc(1));let q;typeof S=="function"?q=S(g):q=g();let Z=n1;I&&(Z=RR({trace:!1,...typeof I=="object"&&I}));const Q=mR(...q),oe=DR(Q);let de=typeof V=="function"?V(oe):oe();const ze=Z(...de);return G2(s,N,ze)}function DT(h){const g={},b=[];let S;const I={addCase(N,V){const s=typeof N=="string"?N:N.type;if(!s)throw new Error(yc(28));if(s in g)throw new Error(yc(29));return g[s]=V,I},addMatcher(N,V){return b.push({matcher:N,reducer:V}),I},addDefaultCase(N){return S=N,I}};return h(I),[g,b,S]}function OR(h){return typeof h=="function"}function jR(h,g){let[b,S,I]=DT(g),N;if(OR(h))N=()=>y4(h());else{const s=y4(h);N=()=>s}function V(s=N(),q){let Z=[b[q.type],...S.filter(({matcher:Q})=>Q(q)).map(({reducer:Q})=>Q)];return Z.filter(Q=>!!Q).length===0&&(Z=[I]),Z.reduce((Q,oe)=>{if(oe)if(zm(Q)){const ze=oe(Q,q);return ze===void 0?Q:ze}else{if(lf(Q))return IT(Q,de=>oe(de,q));{const de=oe(Q,q);if(de===void 0){if(Q===null)return Q;throw Error("A case reducer on a non-draftable value must not return undefined")}return de}}return Q},s)}return V.getInitialState=N,V}var NR="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",kR=(h=21)=>{let g="",b=h;for(;b--;)g+=NR[Math.random()*64|0];return g},BR=Symbol.for("rtk-slice-createasyncthunk");function FR(h,g){return`${h}/${g}`}function UR({creators:h}={}){var b;const g=(b=h==null?void 0:h.asyncThunk)==null?void 0:b[BR];return function(I){const{name:N,reducerPath:V=N}=I;if(!N)throw new Error(yc(11));const s=(typeof I.reducers=="function"?I.reducers(qR()):I.reducers)||{},q=Object.keys(s),Z={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},Q={addCase(xe,Le){const Ae=typeof xe=="string"?xe:xe.type;if(!Ae)throw new Error(yc(12));if(Ae in Z.sliceCaseReducersByType)throw new Error(yc(13));return Z.sliceCaseReducersByType[Ae]=Le,Q},addMatcher(xe,Le){return Z.sliceMatchers.push({matcher:xe,reducer:Le}),Q},exposeAction(xe,Le){return Z.actionCreators[xe]=Le,Q},exposeCaseReducer(xe,Le){return Z.sliceCaseReducersByName[xe]=Le,Q}};q.forEach(xe=>{const Le=s[xe],Ae={reducerName:xe,type:FR(N,xe),createNotation:typeof I.reducers=="function"};$R(Le)?WR(Ae,Le,Q,g):GR(Ae,Le,Q)});function oe(){const[xe={},Le=[],Ae=void 0]=typeof I.extraReducers=="function"?DT(I.extraReducers):[I.extraReducers],Ke={...xe,...Z.sliceCaseReducersByType};return jR(I.initialState,it=>{for(let rt in Ke)it.addCase(rt,Ke[rt]);for(let rt of Z.sliceMatchers)it.addMatcher(rt.matcher,rt.reducer);for(let rt of Le)it.addMatcher(rt.matcher,rt.reducer);Ae&&it.addDefaultCase(Ae)})}const de=xe=>xe,ze=new Map;let le;function Se(xe,Le){return le||(le=oe()),le(xe,Le)}function ee(){return le||(le=oe()),le.getInitialState()}function _e(xe,Le=!1){function Ae(it){let rt=it[xe];return typeof rt>"u"&&Le&&(rt=ee()),rt}function Ke(it=de){const rt=x4(ze,Le,()=>new WeakMap);return x4(rt,it,()=>{const lt={};for(const[zt,xt]of Object.entries(I.selectors??{}))lt[zt]=VR(xt,it,ee,Le);return lt})}return{reducerPath:xe,getSelectors:Ke,get selectors(){return Ke(Ae)},selectSlice:Ae}}const ye={name:N,reducer:Se,actions:Z.actionCreators,caseReducers:Z.sliceCaseReducersByName,getInitialState:ee,..._e(V),injectInto(xe,{reducerPath:Le,...Ae}={}){const Ke=Le??V;return xe.inject({reducerPath:Ke,reducer:Se},Ae),{...ye,..._e(Ke,!0)}}};return ye}}function VR(h,g,b,S){function I(N,...V){let s=g(N);return typeof s>"u"&&S&&(s=b()),h(s,...V)}return I.unwrapped=h,I}var HR=UR();function qR(){function h(g,b){return{_reducerDefinitionType:"asyncThunk",payloadCreator:g,...b}}return h.withTypes=()=>h,{reducer(g){return Object.assign({[g.name](...b){return g(...b)}}[g.name],{_reducerDefinitionType:"reducer"})},preparedReducer(g,b){return{_reducerDefinitionType:"reducerWithPrepare",prepare:g,reducer:b}},asyncThunk:h}}function GR({type:h,reducerName:g,createNotation:b},S,I){let N,V;if("reducer"in S){if(b&&!ZR(S))throw new Error(yc(17));N=S.reducer,V=S.prepare}else N=S;I.addCase(h,N).exposeCaseReducer(g,N).exposeAction(g,V?Bg(h,V):Bg(h))}function $R(h){return h._reducerDefinitionType==="asyncThunk"}function ZR(h){return h._reducerDefinitionType==="reducerWithPrepare"}function WR({type:h,reducerName:g},b,S,I){if(!I)throw new Error(yc(18));const{payloadCreator:N,fulfilled:V,pending:s,rejected:q,settled:Z,options:Q}=b,oe=I(h,N,Q);S.exposeAction(g,oe),V&&S.addCase(oe.fulfilled,V),s&&S.addCase(oe.pending,s),q&&S.addCase(oe.rejected,q),Z&&S.addMatcher(oe.settled,Z),S.exposeCaseReducer(g,{fulfilled:V||My,pending:s||My,rejected:q||My,settled:Z||My})}function My(){}var XR="task",PT="listener",OT="completed",W2="cancelled",YR=`task-${W2}`,KR=`task-${OT}`,u2=`${PT}-${W2}`,JR=`${PT}-${OT}`,E1=class{constructor(h){Wx(this,"name","TaskAbortError");Wx(this,"message");this.code=h,this.message=`${XR} ${W2} (reason: ${h})`}},X2=(h,g)=>{if(typeof h!="function")throw new TypeError(yc(32))},l1=()=>{},jT=(h,g=l1)=>(h.catch(g),h),NT=(h,g)=>(h.addEventListener("abort",g,{once:!0}),()=>h.removeEventListener("abort",g)),Am=(h,g)=>{const b=h.signal;b.aborted||("reason"in b||Object.defineProperty(b,"reason",{enumerable:!0,value:g,configurable:!0,writable:!0}),h.abort(g))},Cm=h=>{if(h.aborted){const{reason:g}=h;throw new E1(g)}};function kT(h,g){let b=l1;return new Promise((S,I)=>{const N=()=>I(new E1(h.reason));if(h.aborted){N();return}b=NT(h,N),g.finally(()=>b()).then(S,I)}).finally(()=>{b=l1})}var QR=async(h,g)=>{try{return await Promise.resolve(),{status:"ok",value:await h()}}catch(b){return{status:b instanceof E1?"cancelled":"rejected",error:b}}finally{g==null||g()}},c1=h=>g=>jT(kT(h,g).then(b=>(Cm(h),b))),BT=h=>{const g=c1(h);return b=>g(new Promise(S=>setTimeout(S,b)))},{assign:Pg}=Object,b4={},A1="listenerMiddleware",eM=(h,g)=>{const b=S=>NT(h,()=>Am(S,h.reason));return(S,I)=>{X2(S);const N=new AbortController;b(N);const V=QR(async()=>{Cm(h),Cm(N.signal);const s=await S({pause:c1(N.signal),delay:BT(N.signal),signal:N.signal});return Cm(N.signal),s},()=>Am(N,KR));return I!=null&&I.autoJoin&&g.push(V.catch(l1)),{result:c1(h)(V),cancel(){Am(N,YR)}}}},tM=(h,g)=>{const b=async(S,I)=>{Cm(g);let N=()=>{};const s=[new Promise((q,Z)=>{let Q=h({predicate:S,effect:(oe,de)=>{de.unsubscribe(),q([oe,de.getState(),de.getOriginalState()])}});N=()=>{Q(),Z()}})];I!=null&&s.push(new Promise(q=>setTimeout(q,I,null)));try{const q=await kT(g,Promise.race(s));return Cm(g),q}finally{N()}};return(S,I)=>jT(b(S,I))},FT=h=>{let{type:g,actionCreator:b,matcher:S,predicate:I,effect:N}=h;if(g)I=Bg(g).match;else if(b)g=b.type,I=b.match;else if(S)I=S;else if(!I)throw new Error(yc(21));return X2(N),{predicate:I,type:g,effect:N}},UT=Pg(h=>{const{type:g,predicate:b,effect:S}=FT(h);return{id:kR(),effect:S,type:g,predicate:b,pending:new Set,unsubscribe:()=>{throw new Error(yc(22))}}},{withTypes:()=>UT}),w4=(h,g)=>{const{type:b,effect:S,predicate:I}=FT(g);return Array.from(h.values()).find(N=>(typeof b=="string"?N.type===b:N.predicate===I)&&N.effect===S)},h2=h=>{h.pending.forEach(g=>{Am(g,u2)})},iM=h=>()=>{h.forEach(h2),h.clear()},T4=(h,g,b)=>{try{h(g,b)}catch(S){setTimeout(()=>{throw S},0)}},VT=Pg(Bg(`${A1}/add`),{withTypes:()=>VT}),rM=Bg(`${A1}/removeAll`),HT=Pg(Bg(`${A1}/remove`),{withTypes:()=>HT}),nM=(...h)=>{console.error(`${A1}/error`,...h)},xj=(h={})=>{const g=new Map,{extra:b,onError:S=nM}=h;X2(S);const I=Q=>(Q.unsubscribe=()=>g.delete(Q.id),g.set(Q.id,Q),oe=>{Q.unsubscribe(),oe!=null&&oe.cancelActive&&h2(Q)}),N=Q=>{const oe=w4(g,Q)??UT(Q);return I(oe)};Pg(N,{withTypes:()=>N});const V=Q=>{const oe=w4(g,Q);return oe&&(oe.unsubscribe(),Q.cancelActive&&h2(oe)),!!oe};Pg(V,{withTypes:()=>V});const s=async(Q,oe,de,ze)=>{const le=new AbortController,Se=tM(N,le.signal),ee=[];try{Q.pending.add(le),await Promise.resolve(Q.effect(oe,Pg({},de,{getOriginalState:ze,condition:(_e,ye)=>Se(_e,ye).then(Boolean),take:Se,delay:BT(le.signal),pause:c1(le.signal),extra:b,signal:le.signal,fork:eM(le.signal,ee),unsubscribe:Q.unsubscribe,subscribe:()=>{g.set(Q.id,Q)},cancelActiveListeners:()=>{Q.pending.forEach((_e,ye,xe)=>{_e!==le&&(Am(_e,u2),xe.delete(_e))})},cancel:()=>{Am(le,u2),Q.pending.delete(le)},throwIfCancelled:()=>{Cm(le.signal)}})))}catch(_e){_e instanceof E1||T4(S,_e,{raisedBy:"effect"})}finally{await Promise.all(ee),Am(le,JR),Q.pending.delete(le)}},q=iM(g);return{middleware:Q=>oe=>de=>{if(!TT(de))return oe(de);if(VT.match(de))return N(de.payload);if(rM.match(de)){q();return}if(HT.match(de))return V(de.payload);let ze=Q.getState();const le=()=>{if(ze===b4)throw new Error(yc(23));return ze};let Se;try{if(Se=oe(de),g.size>0){const ee=Q.getState(),_e=Array.from(g.values());for(const ye of _e){let xe=!1;try{xe=ye.predicate(de,ee,ze)}catch(Le){xe=!1,T4(S,Le,{raisedBy:"predicate"})}xe&&s(ye,de,Q,le)}}}finally{ze=b4}return Se},startListening:N,stopListening:V,clearListeners:q}};function yc(h){return`Minified Redux Toolkit error #${h}; visit https://redux-toolkit.js.org/Errors?code=${h} for the full message or use the non-minified dev environment for full errors. `}const sM={currentUser:null,error:null,loading:!1},qT=HR({name:"user",initialState:sM,reducers:{signInStart:h=>{h.loading=!0},signInSuccess:(h,g)=>{h.currentUser=g.payload,h.loading=!1,h.error=null},signInFailure:(h,g)=>{h.error=g.payload,h.loading=!1},verifyAuthStart:h=>{h.loading=!0},verifyAuthSuccess:(h,g)=>{h.currentUser=g.payload,h.loading=!1,h.error=null},verifyAuthFailure:(h,g)=>{h.currentUser=null,h.error=g.payload,h.loading=!1},updateUserStart:h=>{h.loading=!0},updateUserSuccess:(h,g)=>{h.currentUser=g.payload,h.loading=!1,h.error=null},updateUserFailure:(h,g)=>{h.error=g.payload,h.loading=!1},deleteUserStart:h=>{h.loading=!0},deleteUserSuccess:(h,g)=>{h.currentUser=null,h.loading=!1,h.error=null},deleteUserFailure:(h,g)=>{h.error=g.payload,h.loading=!1},signoutUserStart:h=>{h.loading=!0},signoutUserSuccess:(h,g)=>{h.currentUser=null,h.loading=!1,h.error=null},signoutUserFailure:(h,g)=>{h.error=g.payload,h.loading=!1}}}),{signInStart:vj,signInSuccess:bj,signInFailure:wj,verifyAuthStart:aM,verifyAuthSuccess:oM,verifyAuthFailure:S4,updateUserStart:Tj,updateUserSuccess:Sj,updateUserFailure:Ej,deleteUserStart:Aj,deleteUserSuccess:Cj,deleteUserFailure:Rj,signoutUserStart:C1,signoutUserSuccess:io,signoutUserFailure:vp}=qT.actions,lM=qT.reducer,sd=Object.create(null);sd.open="0";sd.close="1";sd.ping="2";sd.pong="3";sd.message="4";sd.upgrade="5";sd.noop="6";const Fy=Object.create(null);Object.keys(sd).forEach(h=>{Fy[sd[h]]=h});const d2={type:"error",data:"parser error"},GT=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",$T=typeof ArrayBuffer=="function",ZT=h=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(h):h&&h.buffer instanceof ArrayBuffer,Y2=({type:h,data:g},b,S)=>GT&&g instanceof Blob?b?S(g):E4(g,S):$T&&(g instanceof ArrayBuffer||ZT(g))?b?S(g):E4(new Blob([g]),S):S(sd[h]+(g||"")),E4=(h,g)=>{const b=new FileReader;return b.onload=function(){const S=b.result.split(",")[1];g("b"+(S||""))},b.readAsDataURL(h)};function A4(h){return h instanceof Uint8Array?h:h instanceof ArrayBuffer?new Uint8Array(h):new Uint8Array(h.buffer,h.byteOffset,h.byteLength)}let uv;function cM(h,g){if(GT&&h.data instanceof Blob)return h.data.arrayBuffer().then(A4).then(g);if($T&&(h.data instanceof ArrayBuffer||ZT(h.data)))return g(A4(h.data));Y2(h,!1,b=>{uv||(uv=new TextEncoder),g(uv.encode(b))})}const C4="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i0=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let h=0;h<C4.length;h++)i0[C4.charCodeAt(h)]=h;const uM=h=>{let g=h.length*.75,b=h.length,S,I=0,N,V,s,q;h[h.length-1]==="="&&(g--,h[h.length-2]==="="&&g--);const Z=new ArrayBuffer(g),Q=new Uint8Array(Z);for(S=0;S<b;S+=4)N=i0[h.charCodeAt(S)],V=i0[h.charCodeAt(S+1)],s=i0[h.charCodeAt(S+2)],q=i0[h.charCodeAt(S+3)],Q[I++]=N<<2|V>>4,Q[I++]=(V&15)<<4|s>>2,Q[I++]=(s&3)<<6|q&63;return Z},hM=typeof ArrayBuffer=="function",K2=(h,g)=>{if(typeof h!="string")return{type:"message",data:WT(h,g)};const b=h.charAt(0);return b==="b"?{type:"message",data:dM(h.substring(1),g)}:Fy[b]?h.length>1?{type:Fy[b],data:h.substring(1)}:{type:Fy[b]}:d2},dM=(h,g)=>{if(hM){const b=uM(h);return WT(b,g)}else return{base64:!0,data:h}},WT=(h,g)=>{switch(g){case"blob":return h instanceof Blob?h:new Blob([h]);case"arraybuffer":default:return h instanceof ArrayBuffer?h:h.buffer}},XT="",fM=(h,g)=>{const b=h.length,S=new Array(b);let I=0;h.forEach((N,V)=>{Y2(N,!1,s=>{S[V]=s,++I===b&&g(S.join(XT))})})},pM=(h,g)=>{const b=h.split(XT),S=[];for(let I=0;I<b.length;I++){const N=K2(b[I],g);if(S.push(N),N.type==="error")break}return S};function mM(){return new TransformStream({transform(h,g){cM(h,b=>{const S=b.length;let I;if(S<126)I=new Uint8Array(1),new DataView(I.buffer).setUint8(0,S);else if(S<65536){I=new Uint8Array(3);const N=new DataView(I.buffer);N.setUint8(0,126),N.setUint16(1,S)}else{I=new Uint8Array(9);const N=new DataView(I.buffer);N.setUint8(0,127),N.setBigUint64(1,BigInt(S))}h.data&&typeof h.data!="string"&&(I[0]|=128),g.enqueue(I),g.enqueue(b)})}})}let hv;function Iy(h){return h.reduce((g,b)=>g+b.length,0)}function zy(h,g){if(h[0].length===g)return h.shift();const b=new Uint8Array(g);let S=0;for(let I=0;I<g;I++)b[I]=h[0][S++],S===h[0].length&&(h.shift(),S=0);return h.length&&S<h[0].length&&(h[0]=h[0].slice(S)),b}function gM(h,g){hv||(hv=new TextDecoder);const b=[];let S=0,I=-1,N=!1;return new TransformStream({transform(V,s){for(b.push(V);;){if(S===0){if(Iy(b)<1)break;const q=zy(b,1);N=(q[0]&128)===128,I=q[0]&127,I<126?S=3:I===126?S=1:S=2}else if(S===1){if(Iy(b)<2)break;const q=zy(b,2);I=new DataView(q.buffer,q.byteOffset,q.length).getUint16(0),S=3}else if(S===2){if(Iy(b)<8)break;const q=zy(b,8),Z=new DataView(q.buffer,q.byteOffset,q.length),Q=Z.getUint32(0);if(Q>Math.pow(2,21)-1){s.enqueue(d2);break}I=Q*Math.pow(2,32)+Z.getUint32(4),S=3}else{if(Iy(b)<I)break;const q=zy(b,I);s.enqueue(K2(N?q:hv.decode(q),g)),S=0}if(I===0||I>h){s.enqueue(d2);break}}}})}const YT=4;function Ia(h){if(h)return _M(h)}function _M(h){for(var g in Ia.prototype)h[g]=Ia.prototype[g];return h}Ia.prototype.on=Ia.prototype.addEventListener=function(h,g){return this._callbacks=this._callbacks||{},(this._callbacks["$"+h]=this._callbacks["$"+h]||[]).push(g),this};Ia.prototype.once=function(h,g){function b(){this.off(h,b),g.apply(this,arguments)}return b.fn=g,this.on(h,b),this};Ia.prototype.off=Ia.prototype.removeListener=Ia.prototype.removeAllListeners=Ia.prototype.removeEventListener=function(h,g){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var b=this._callbacks["$"+h];if(!b)return this;if(arguments.length==1)return delete this._callbacks["$"+h],this;for(var S,I=0;I<b.length;I++)if(S=b[I],S===g||S.fn===g){b.splice(I,1);break}return b.length===0&&delete this._callbacks["$"+h],this};Ia.prototype.emit=function(h){this._callbacks=this._callbacks||{};for(var g=new Array(arguments.length-1),b=this._callbacks["$"+h],S=1;S<arguments.length;S++)g[S-1]=arguments[S];if(b){b=b.slice(0);for(var S=0,I=b.length;S<I;++S)b[S].apply(this,g)}return this};Ia.prototype.emitReserved=Ia.prototype.emit;Ia.prototype.listeners=function(h){return this._callbacks=this._callbacks||{},this._callbacks["$"+h]||[]};Ia.prototype.hasListeners=function(h){return!!this.listeners(h).length};const R1=typeof Promise=="function"&&typeof Promise.resolve=="function"?g=>Promise.resolve().then(g):(g,b)=>b(g,0),nu=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),yM="arraybuffer";function KT(h,...g){return g.reduce((b,S)=>(h.hasOwnProperty(S)&&(b[S]=h[S]),b),{})}const xM=nu.setTimeout,vM=nu.clearTimeout;function M1(h,g){g.useNativeTimers?(h.setTimeoutFn=xM.bind(nu),h.clearTimeoutFn=vM.bind(nu)):(h.setTimeoutFn=nu.setTimeout.bind(nu),h.clearTimeoutFn=nu.clearTimeout.bind(nu))}const bM=1.33;function wM(h){return typeof h=="string"?TM(h):Math.ceil((h.byteLength||h.size)*bM)}function TM(h){let g=0,b=0;for(let S=0,I=h.length;S<I;S++)g=h.charCodeAt(S),g<128?b+=1:g<2048?b+=2:g<55296||g>=57344?b+=3:(S++,b+=4);return b}function JT(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function SM(h){let g="";for(let b in h)h.hasOwnProperty(b)&&(g.length&&(g+="&"),g+=encodeURIComponent(b)+"="+encodeURIComponent(h[b]));return g}function EM(h){let g={},b=h.split("&");for(let S=0,I=b.length;S<I;S++){let N=b[S].split("=");g[decodeURIComponent(N[0])]=decodeURIComponent(N[1])}return g}class AM extends Error{constructor(g,b,S){super(g),this.description=b,this.context=S,this.type="TransportError"}}class J2 extends Ia{constructor(g){super(),this.writable=!1,M1(this,g),this.opts=g,this.query=g.query,this.socket=g.socket,this.supportsBinary=!g.forceBase64}onError(g,b,S){return super.emitReserved("error",new AM(g,b,S)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(g){this.readyState==="open"&&this.write(g)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(g){const b=K2(g,this.socket.binaryType);this.onPacket(b)}onPacket(g){super.emitReserved("packet",g)}onClose(g){this.readyState="closed",super.emitReserved("close",g)}pause(g){}createUri(g,b={}){return g+"://"+this._hostname()+this._port()+this.opts.path+this._query(b)}_hostname(){const g=this.opts.hostname;return g.indexOf(":")===-1?g:"["+g+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(g){const b=SM(g);return b.length?"?"+b:""}}class CM extends J2{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(g){this.readyState="pausing";const b=()=>{this.readyState="paused",g()};if(this._polling||!this.writable){let S=0;this._polling&&(S++,this.once("pollComplete",function(){--S||b()})),this.writable||(S++,this.once("drain",function(){--S||b()}))}else b()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(g){const b=S=>{if(this.readyState==="opening"&&S.type==="open"&&this.onOpen(),S.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(S)};pM(g,this.socket.binaryType).forEach(b),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const g=()=>{this.write([{type:"close"}])};this.readyState==="open"?g():this.once("open",g)}write(g){this.writable=!1,fM(g,b=>{this.doWrite(b,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const g=this.opts.secure?"https":"http",b=this.query||{};return this.opts.timestampRequests!==!1&&(b[this.opts.timestampParam]=JT()),!this.supportsBinary&&!b.sid&&(b.b64=1),this.createUri(g,b)}}let QT=!1;try{QT=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const RM=QT;function MM(){}class IM extends CM{constructor(g){if(super(g),typeof location<"u"){const b=location.protocol==="https:";let S=location.port;S||(S=b?"443":"80"),this.xd=typeof location<"u"&&g.hostname!==location.hostname||S!==g.port}}doWrite(g,b){const S=this.request({method:"POST",data:g});S.on("success",b),S.on("error",(I,N)=>{this.onError("xhr post error",I,N)})}doPoll(){const g=this.request();g.on("data",this.onData.bind(this)),g.on("error",(b,S)=>{this.onError("xhr poll error",b,S)}),this.pollXhr=g}}let Og=class Uy extends Ia{constructor(g,b,S){super(),this.createRequest=g,M1(this,S),this._opts=S,this._method=S.method||"GET",this._uri=b,this._data=S.data!==void 0?S.data:null,this._create()}_create(){var g;const b=KT(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");b.xdomain=!!this._opts.xd;const S=this._xhr=this.createRequest(b);try{S.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){S.setDisableHeaderCheck&&S.setDisableHeaderCheck(!0);for(let I in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(I)&&S.setRequestHeader(I,this._opts.extraHeaders[I])}}catch{}if(this._method==="POST")try{S.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{S.setRequestHeader("Accept","*/*")}catch{}(g=this._opts.cookieJar)===null||g===void 0||g.addCookies(S),"withCredentials"in S&&(S.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(S.timeout=this._opts.requestTimeout),S.onreadystatechange=()=>{var I;S.readyState===3&&((I=this._opts.cookieJar)===null||I===void 0||I.parseCookies(S.getResponseHeader("set-cookie"))),S.readyState===4&&(S.status===200||S.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof S.status=="number"?S.status:0)},0))},S.send(this._data)}catch(I){this.setTimeoutFn(()=>{this._onError(I)},0);return}typeof document<"u"&&(this._index=Uy.requestsCount++,Uy.requests[this._index]=this)}_onError(g){this.emitReserved("error",g,this._xhr),this._cleanup(!0)}_cleanup(g){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=MM,g)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Uy.requests[this._index],this._xhr=null}}_onLoad(){const g=this._xhr.responseText;g!==null&&(this.emitReserved("data",g),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};Og.requestsCount=0;Og.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",R4);else if(typeof addEventListener=="function"){const h="onpagehide"in nu?"pagehide":"unload";addEventListener(h,R4,!1)}}function R4(){for(let h in Og.requests)Og.requests.hasOwnProperty(h)&&Og.requests[h].abort()}const zM=function(){const h=eS({xdomain:!1});return h&&h.responseType!==null}();class LM extends IM{constructor(g){super(g);const b=g&&g.forceBase64;this.supportsBinary=zM&&!b}request(g={}){return Object.assign(g,{xd:this.xd},this.opts),new Og(eS,this.uri(),g)}}function eS(h){const g=h.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!g||RM))return new XMLHttpRequest}catch{}if(!g)try{return new nu[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const tS=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class DM extends J2{get name(){return"websocket"}doOpen(){const g=this.uri(),b=this.opts.protocols,S=tS?{}:KT(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(S.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(g,b,S)}catch(I){return this.emitReserved("error",I)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=g=>this.onClose({description:"websocket connection closed",context:g}),this.ws.onmessage=g=>this.onData(g.data),this.ws.onerror=g=>this.onError("websocket error",g)}write(g){this.writable=!1;for(let b=0;b<g.length;b++){const S=g[b],I=b===g.length-1;Y2(S,this.supportsBinary,N=>{try{this.doWrite(S,N)}catch{}I&&R1(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const g=this.opts.secure?"wss":"ws",b=this.query||{};return this.opts.timestampRequests&&(b[this.opts.timestampParam]=JT()),this.supportsBinary||(b.b64=1),this.createUri(g,b)}}const dv=nu.WebSocket||nu.MozWebSocket;class PM extends DM{createSocket(g,b,S){return tS?new dv(g,b,S):b?new dv(g,b):new dv(g)}doWrite(g,b){this.ws.send(b)}}class OM extends J2{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(g){return this.emitReserved("error",g)}this._transport.closed.then(()=>{this.onClose()}).catch(g=>{this.onError("webtransport error",g)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(g=>{const b=gM(Number.MAX_SAFE_INTEGER,this.socket.binaryType),S=g.readable.pipeThrough(b).getReader(),I=mM();I.readable.pipeTo(g.writable),this._writer=I.writable.getWriter();const N=()=>{S.read().then(({done:s,value:q})=>{s||(this.onPacket(q),N())}).catch(s=>{})};N();const V={type:"open"};this.query.sid&&(V.data=`{"sid":"${this.query.sid}"}`),this._writer.write(V).then(()=>this.onOpen())})})}write(g){this.writable=!1;for(let b=0;b<g.length;b++){const S=g[b],I=b===g.length-1;this._writer.write(S).then(()=>{I&&R1(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var g;(g=this._transport)===null||g===void 0||g.close()}}const jM={websocket:PM,webtransport:OM,polling:LM},NM=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,kM=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function f2(h){if(h.length>8e3)throw"URI too long";const g=h,b=h.indexOf("["),S=h.indexOf("]");b!=-1&&S!=-1&&(h=h.substring(0,b)+h.substring(b,S).replace(/:/g,";")+h.substring(S,h.length));let I=NM.exec(h||""),N={},V=14;for(;V--;)N[kM[V]]=I[V]||"";return b!=-1&&S!=-1&&(N.source=g,N.host=N.host.substring(1,N.host.length-1).replace(/;/g,":"),N.authority=N.authority.replace("[","").replace("]","").replace(/;/g,":"),N.ipv6uri=!0),N.pathNames=BM(N,N.path),N.queryKey=FM(N,N.query),N}function BM(h,g){const b=/\/{2,9}/g,S=g.replace(b,"/").split("/");return(g.slice(0,1)=="/"||g.length===0)&&S.splice(0,1),g.slice(-1)=="/"&&S.splice(S.length-1,1),S}function FM(h,g){const b={};return g.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(S,I,N){I&&(b[I]=N)}),b}const p2=typeof addEventListener=="function"&&typeof removeEventListener=="function",Vy=[];p2&&addEventListener("offline",()=>{Vy.forEach(h=>h())},!1);class yp extends Ia{constructor(g,b){if(super(),this.binaryType=yM,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,g&&typeof g=="object"&&(b=g,g=null),g){const S=f2(g);b.hostname=S.host,b.secure=S.protocol==="https"||S.protocol==="wss",b.port=S.port,S.query&&(b.query=S.query)}else b.host&&(b.hostname=f2(b.host).host);M1(this,b),this.secure=b.secure!=null?b.secure:typeof location<"u"&&location.protocol==="https:",b.hostname&&!b.port&&(b.port=this.secure?"443":"80"),this.hostname=b.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=b.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},b.transports.forEach(S=>{const I=S.prototype.name;this.transports.push(I),this._transportsByName[I]=S}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},b),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=EM(this.opts.query)),p2&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Vy.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(g){const b=Object.assign({},this.opts.query);b.EIO=YT,b.transport=g,this.id&&(b.sid=this.id);const S=Object.assign({},this.opts,{query:b,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[g]);return new this._transportsByName[g](S)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const g=this.opts.rememberUpgrade&&yp.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const b=this.createTransport(g);b.open(),this.setTransport(b)}setTransport(g){this.transport&&this.transport.removeAllListeners(),this.transport=g,g.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",b=>this._onClose("transport close",b))}onOpen(){this.readyState="open",yp.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(g){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",g),this.emitReserved("heartbeat"),g.type){case"open":this.onHandshake(JSON.parse(g.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const b=new Error("server error");b.code=g.data,this._onError(b);break;case"message":this.emitReserved("data",g.data),this.emitReserved("message",g.data);break}}onHandshake(g){this.emitReserved("handshake",g),this.id=g.sid,this.transport.query.sid=g.sid,this._pingInterval=g.pingInterval,this._pingTimeout=g.pingTimeout,this._maxPayload=g.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const g=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+g,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},g),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const g=this._getWritablePackets();this.transport.send(g),this._prevBufferLen=g.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let b=1;for(let S=0;S<this.writeBuffer.length;S++){const I=this.writeBuffer[S].data;if(I&&(b+=wM(I)),S>0&&b>this._maxPayload)return this.writeBuffer.slice(0,S);b+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const g=Date.now()>this._pingTimeoutTime;return g&&(this._pingTimeoutTime=0,R1(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),g}write(g,b,S){return this._sendPacket("message",g,b,S),this}send(g,b,S){return this._sendPacket("message",g,b,S),this}_sendPacket(g,b,S,I){if(typeof b=="function"&&(I=b,b=void 0),typeof S=="function"&&(I=S,S=null),this.readyState==="closing"||this.readyState==="closed")return;S=S||{},S.compress=S.compress!==!1;const N={type:g,data:b,options:S};this.emitReserved("packetCreate",N),this.writeBuffer.push(N),I&&this.once("flush",I),this.flush()}close(){const g=()=>{this._onClose("forced close"),this.transport.close()},b=()=>{this.off("upgrade",b),this.off("upgradeError",b),g()},S=()=>{this.once("upgrade",b),this.once("upgradeError",b)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?S():g()}):this.upgrading?S():g()),this}_onError(g){if(yp.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",g),this._onClose("transport error",g)}_onClose(g,b){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),p2&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const S=Vy.indexOf(this._offlineEventListener);S!==-1&&Vy.splice(S,1)}this.readyState="closed",this.id=null,this.emitReserved("close",g,b),this.writeBuffer=[],this._prevBufferLen=0}}}yp.protocol=YT;class UM extends yp{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let g=0;g<this._upgrades.length;g++)this._probe(this._upgrades[g])}_probe(g){let b=this.createTransport(g),S=!1;yp.priorWebsocketSuccess=!1;const I=()=>{S||(b.send([{type:"ping",data:"probe"}]),b.once("packet",oe=>{if(!S)if(oe.type==="pong"&&oe.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",b),!b)return;yp.priorWebsocketSuccess=b.name==="websocket",this.transport.pause(()=>{S||this.readyState!=="closed"&&(Q(),this.setTransport(b),b.send([{type:"upgrade"}]),this.emitReserved("upgrade",b),b=null,this.upgrading=!1,this.flush())})}else{const de=new Error("probe error");de.transport=b.name,this.emitReserved("upgradeError",de)}}))};function N(){S||(S=!0,Q(),b.close(),b=null)}const V=oe=>{const de=new Error("probe error: "+oe);de.transport=b.name,N(),this.emitReserved("upgradeError",de)};function s(){V("transport closed")}function q(){V("socket closed")}function Z(oe){b&&oe.name!==b.name&&N()}const Q=()=>{b.removeListener("open",I),b.removeListener("error",V),b.removeListener("close",s),this.off("close",q),this.off("upgrading",Z)};b.once("open",I),b.once("error",V),b.once("close",s),this.once("close",q),this.once("upgrading",Z),this._upgrades.indexOf("webtransport")!==-1&&g!=="webtransport"?this.setTimeoutFn(()=>{S||b.open()},200):b.open()}onHandshake(g){this._upgrades=this._filterUpgrades(g.upgrades),super.onHandshake(g)}_filterUpgrades(g){const b=[];for(let S=0;S<g.length;S++)~this.transports.indexOf(g[S])&&b.push(g[S]);return b}}let VM=class extends UM{constructor(g,b={}){const S=typeof g=="object"?g:b;(!S.transports||S.transports&&typeof S.transports[0]=="string")&&(S.transports=(S.transports||["polling","websocket","webtransport"]).map(I=>jM[I]).filter(I=>!!I)),super(g,S)}};function HM(h,g="",b){let S=h;b=b||typeof location<"u"&&location,h==null&&(h=b.protocol+"//"+b.host),typeof h=="string"&&(h.charAt(0)==="/"&&(h.charAt(1)==="/"?h=b.protocol+h:h=b.host+h),/^(https?|wss?):\/\//.test(h)||(typeof b<"u"?h=b.protocol+"//"+h:h="https://"+h),S=f2(h)),S.port||(/^(http|ws)$/.test(S.protocol)?S.port="80":/^(http|ws)s$/.test(S.protocol)&&(S.port="443")),S.path=S.path||"/";const N=S.host.indexOf(":")!==-1?"["+S.host+"]":S.host;return S.id=S.protocol+"://"+N+":"+S.port+g,S.href=S.protocol+"://"+N+(b&&b.port===S.port?"":":"+S.port),S}const qM=typeof ArrayBuffer=="function",GM=h=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(h):h.buffer instanceof ArrayBuffer,iS=Object.prototype.toString,$M=typeof Blob=="function"||typeof Blob<"u"&&iS.call(Blob)==="[object BlobConstructor]",ZM=typeof File=="function"||typeof File<"u"&&iS.call(File)==="[object FileConstructor]";function Q2(h){return qM&&(h instanceof ArrayBuffer||GM(h))||$M&&h instanceof Blob||ZM&&h instanceof File}function Hy(h,g){if(!h||typeof h!="object")return!1;if(Array.isArray(h)){for(let b=0,S=h.length;b<S;b++)if(Hy(h[b]))return!0;return!1}if(Q2(h))return!0;if(h.toJSON&&typeof h.toJSON=="function"&&arguments.length===1)return Hy(h.toJSON(),!0);for(const b in h)if(Object.prototype.hasOwnProperty.call(h,b)&&Hy(h[b]))return!0;return!1}function WM(h){const g=[],b=h.data,S=h;return S.data=m2(b,g),S.attachments=g.length,{packet:S,buffers:g}}function m2(h,g){if(!h)return h;if(Q2(h)){const b={_placeholder:!0,num:g.length};return g.push(h),b}else if(Array.isArray(h)){const b=new Array(h.length);for(let S=0;S<h.length;S++)b[S]=m2(h[S],g);return b}else if(typeof h=="object"&&!(h instanceof Date)){const b={};for(const S in h)Object.prototype.hasOwnProperty.call(h,S)&&(b[S]=m2(h[S],g));return b}return h}function XM(h,g){return h.data=g2(h.data,g),delete h.attachments,h}function g2(h,g){if(!h)return h;if(h&&h._placeholder===!0){if(typeof h.num=="number"&&h.num>=0&&h.num<g.length)return g[h.num];throw new Error("illegal attachments")}else if(Array.isArray(h))for(let b=0;b<h.length;b++)h[b]=g2(h[b],g);else if(typeof h=="object")for(const b in h)Object.prototype.hasOwnProperty.call(h,b)&&(h[b]=g2(h[b],g));return h}const YM=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],KM=5;var Un;(function(h){h[h.CONNECT=0]="CONNECT",h[h.DISCONNECT=1]="DISCONNECT",h[h.EVENT=2]="EVENT",h[h.ACK=3]="ACK",h[h.CONNECT_ERROR=4]="CONNECT_ERROR",h[h.BINARY_EVENT=5]="BINARY_EVENT",h[h.BINARY_ACK=6]="BINARY_ACK"})(Un||(Un={}));class JM{constructor(g){this.replacer=g}encode(g){return(g.type===Un.EVENT||g.type===Un.ACK)&&Hy(g)?this.encodeAsBinary({type:g.type===Un.EVENT?Un.BINARY_EVENT:Un.BINARY_ACK,nsp:g.nsp,data:g.data,id:g.id}):[this.encodeAsString(g)]}encodeAsString(g){let b=""+g.type;return(g.type===Un.BINARY_EVENT||g.type===Un.BINARY_ACK)&&(b+=g.attachments+"-"),g.nsp&&g.nsp!=="/"&&(b+=g.nsp+","),g.id!=null&&(b+=g.id),g.data!=null&&(b+=JSON.stringify(g.data,this.replacer)),b}encodeAsBinary(g){const b=WM(g),S=this.encodeAsString(b.packet),I=b.buffers;return I.unshift(S),I}}function M4(h){return Object.prototype.toString.call(h)==="[object Object]"}class eb extends Ia{constructor(g){super(),this.reviver=g}add(g){let b;if(typeof g=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");b=this.decodeString(g);const S=b.type===Un.BINARY_EVENT;S||b.type===Un.BINARY_ACK?(b.type=S?Un.EVENT:Un.ACK,this.reconstructor=new QM(b),b.attachments===0&&super.emitReserved("decoded",b)):super.emitReserved("decoded",b)}else if(Q2(g)||g.base64)if(this.reconstructor)b=this.reconstructor.takeBinaryData(g),b&&(this.reconstructor=null,super.emitReserved("decoded",b));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+g)}decodeString(g){let b=0;const S={type:Number(g.charAt(0))};if(Un[S.type]===void 0)throw new Error("unknown packet type "+S.type);if(S.type===Un.BINARY_EVENT||S.type===Un.BINARY_ACK){const N=b+1;for(;g.charAt(++b)!=="-"&&b!=g.length;);const V=g.substring(N,b);if(V!=Number(V)||g.charAt(b)!=="-")throw new Error("Illegal attachments");S.attachments=Number(V)}if(g.charAt(b+1)==="/"){const N=b+1;for(;++b&&!(g.charAt(b)===","||b===g.length););S.nsp=g.substring(N,b)}else S.nsp="/";const I=g.charAt(b+1);if(I!==""&&Number(I)==I){const N=b+1;for(;++b;){const V=g.charAt(b);if(V==null||Number(V)!=V){--b;break}if(b===g.length)break}S.id=Number(g.substring(N,b+1))}if(g.charAt(++b)){const N=this.tryParse(g.substr(b));if(eb.isPayloadValid(S.type,N))S.data=N;else throw new Error("invalid payload")}return S}tryParse(g){try{return JSON.parse(g,this.reviver)}catch{return!1}}static isPayloadValid(g,b){switch(g){case Un.CONNECT:return M4(b);case Un.DISCONNECT:return b===void 0;case Un.CONNECT_ERROR:return typeof b=="string"||M4(b);case Un.EVENT:case Un.BINARY_EVENT:return Array.isArray(b)&&(typeof b[0]=="number"||typeof b[0]=="string"&&YM.indexOf(b[0])===-1);case Un.ACK:case Un.BINARY_ACK:return Array.isArray(b)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class QM{constructor(g){this.packet=g,this.buffers=[],this.reconPack=g}takeBinaryData(g){if(this.buffers.push(g),this.buffers.length===this.reconPack.attachments){const b=XM(this.reconPack,this.buffers);return this.finishedReconstruction(),b}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const eI=Object.freeze(Object.defineProperty({__proto__:null,Decoder:eb,Encoder:JM,get PacketType(){return Un},protocol:KM},Symbol.toStringTag,{value:"Module"}));function ih(h,g,b){return h.on(g,b),function(){h.off(g,b)}}const tI=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class rS extends Ia{constructor(g,b,S){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=g,this.nsp=b,S&&S.auth&&(this.auth=S.auth),this._opts=Object.assign({},S),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const g=this.io;this.subs=[ih(g,"open",this.onopen.bind(this)),ih(g,"packet",this.onpacket.bind(this)),ih(g,"error",this.onerror.bind(this)),ih(g,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...g){return g.unshift("message"),this.emit.apply(this,g),this}emit(g,...b){var S,I,N;if(tI.hasOwnProperty(g))throw new Error('"'+g.toString()+'" is a reserved event name');if(b.unshift(g),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(b),this;const V={type:Un.EVENT,data:b};if(V.options={},V.options.compress=this.flags.compress!==!1,typeof b[b.length-1]=="function"){const Q=this.ids++,oe=b.pop();this._registerAckCallback(Q,oe),V.id=Q}const s=(I=(S=this.io.engine)===null||S===void 0?void 0:S.transport)===null||I===void 0?void 0:I.writable,q=this.connected&&!(!((N=this.io.engine)===null||N===void 0)&&N._hasPingExpired());return this.flags.volatile&&!s||(q?(this.notifyOutgoingListeners(V),this.packet(V)):this.sendBuffer.push(V)),this.flags={},this}_registerAckCallback(g,b){var S;const I=(S=this.flags.timeout)!==null&&S!==void 0?S:this._opts.ackTimeout;if(I===void 0){this.acks[g]=b;return}const N=this.io.setTimeoutFn(()=>{delete this.acks[g];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===g&&this.sendBuffer.splice(s,1);b.call(this,new Error("operation has timed out"))},I),V=(...s)=>{this.io.clearTimeoutFn(N),b.apply(this,s)};V.withError=!0,this.acks[g]=V}emitWithAck(g,...b){return new Promise((S,I)=>{const N=(V,s)=>V?I(V):S(s);N.withError=!0,b.push(N),this.emit(g,...b)})}_addToQueue(g){let b;typeof g[g.length-1]=="function"&&(b=g.pop());const S={id:this._queueSeq++,tryCount:0,pending:!1,args:g,flags:Object.assign({fromQueue:!0},this.flags)};g.push((I,...N)=>S!==this._queue[0]?void 0:(I!==null?S.tryCount>this._opts.retries&&(this._queue.shift(),b&&b(I)):(this._queue.shift(),b&&b(null,...N)),S.pending=!1,this._drainQueue())),this._queue.push(S),this._drainQueue()}_drainQueue(g=!1){if(!this.connected||this._queue.length===0)return;const b=this._queue[0];b.pending&&!g||(b.pending=!0,b.tryCount++,this.flags=b.flags,this.emit.apply(this,b.args))}packet(g){g.nsp=this.nsp,this.io._packet(g)}onopen(){typeof this.auth=="function"?this.auth(g=>{this._sendConnectPacket(g)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(g){this.packet({type:Un.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},g):g})}onerror(g){this.connected||this.emitReserved("connect_error",g)}onclose(g,b){this.connected=!1,delete this.id,this.emitReserved("disconnect",g,b),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(g=>{if(!this.sendBuffer.some(S=>String(S.id)===g)){const S=this.acks[g];delete this.acks[g],S.withError&&S.call(this,new Error("socket has been disconnected"))}})}onpacket(g){if(g.nsp===this.nsp)switch(g.type){case Un.CONNECT:g.data&&g.data.sid?this.onconnect(g.data.sid,g.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Un.EVENT:case Un.BINARY_EVENT:this.onevent(g);break;case Un.ACK:case Un.BINARY_ACK:this.onack(g);break;case Un.DISCONNECT:this.ondisconnect();break;case Un.CONNECT_ERROR:this.destroy();const S=new Error(g.data.message);S.data=g.data.data,this.emitReserved("connect_error",S);break}}onevent(g){const b=g.data||[];g.id!=null&&b.push(this.ack(g.id)),this.connected?this.emitEvent(b):this.receiveBuffer.push(Object.freeze(b))}emitEvent(g){if(this._anyListeners&&this._anyListeners.length){const b=this._anyListeners.slice();for(const S of b)S.apply(this,g)}super.emit.apply(this,g),this._pid&&g.length&&typeof g[g.length-1]=="string"&&(this._lastOffset=g[g.length-1])}ack(g){const b=this;let S=!1;return function(...I){S||(S=!0,b.packet({type:Un.ACK,id:g,data:I}))}}onack(g){const b=this.acks[g.id];typeof b=="function"&&(delete this.acks[g.id],b.withError&&g.data.unshift(null),b.apply(this,g.data))}onconnect(g,b){this.id=g,this.recovered=b&&this._pid===b,this._pid=b,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(g=>this.emitEvent(g)),this.receiveBuffer=[],this.sendBuffer.forEach(g=>{this.notifyOutgoingListeners(g),this.packet(g)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(g=>g()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Un.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(g){return this.flags.compress=g,this}get volatile(){return this.flags.volatile=!0,this}timeout(g){return this.flags.timeout=g,this}onAny(g){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(g),this}prependAny(g){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(g),this}offAny(g){if(!this._anyListeners)return this;if(g){const b=this._anyListeners;for(let S=0;S<b.length;S++)if(g===b[S])return b.splice(S,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(g){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(g),this}prependAnyOutgoing(g){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(g),this}offAnyOutgoing(g){if(!this._anyOutgoingListeners)return this;if(g){const b=this._anyOutgoingListeners;for(let S=0;S<b.length;S++)if(g===b[S])return b.splice(S,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(g){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const b=this._anyOutgoingListeners.slice();for(const S of b)S.apply(this,g.data)}}}function Gg(h){h=h||{},this.ms=h.min||100,this.max=h.max||1e4,this.factor=h.factor||2,this.jitter=h.jitter>0&&h.jitter<=1?h.jitter:0,this.attempts=0}Gg.prototype.duration=function(){var h=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var g=Math.random(),b=Math.floor(g*this.jitter*h);h=(Math.floor(g*10)&1)==0?h-b:h+b}return Math.min(h,this.max)|0};Gg.prototype.reset=function(){this.attempts=0};Gg.prototype.setMin=function(h){this.ms=h};Gg.prototype.setMax=function(h){this.max=h};Gg.prototype.setJitter=function(h){this.jitter=h};class _2 extends Ia{constructor(g,b){var S;super(),this.nsps={},this.subs=[],g&&typeof g=="object"&&(b=g,g=void 0),b=b||{},b.path=b.path||"/socket.io",this.opts=b,M1(this,b),this.reconnection(b.reconnection!==!1),this.reconnectionAttempts(b.reconnectionAttempts||1/0),this.reconnectionDelay(b.reconnectionDelay||1e3),this.reconnectionDelayMax(b.reconnectionDelayMax||5e3),this.randomizationFactor((S=b.randomizationFactor)!==null&&S!==void 0?S:.5),this.backoff=new Gg({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(b.timeout==null?2e4:b.timeout),this._readyState="closed",this.uri=g;const I=b.parser||eI;this.encoder=new I.Encoder,this.decoder=new I.Decoder,this._autoConnect=b.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(g){return arguments.length?(this._reconnection=!!g,g||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(g){return g===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=g,this)}reconnectionDelay(g){var b;return g===void 0?this._reconnectionDelay:(this._reconnectionDelay=g,(b=this.backoff)===null||b===void 0||b.setMin(g),this)}randomizationFactor(g){var b;return g===void 0?this._randomizationFactor:(this._randomizationFactor=g,(b=this.backoff)===null||b===void 0||b.setJitter(g),this)}reconnectionDelayMax(g){var b;return g===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=g,(b=this.backoff)===null||b===void 0||b.setMax(g),this)}timeout(g){return arguments.length?(this._timeout=g,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(g){if(~this._readyState.indexOf("open"))return this;this.engine=new VM(this.uri,this.opts);const b=this.engine,S=this;this._readyState="opening",this.skipReconnect=!1;const I=ih(b,"open",function(){S.onopen(),g&&g()}),N=s=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",s),g?g(s):this.maybeReconnectOnOpen()},V=ih(b,"error",N);if(this._timeout!==!1){const s=this._timeout,q=this.setTimeoutFn(()=>{I(),N(new Error("timeout")),b.close()},s);this.opts.autoUnref&&q.unref(),this.subs.push(()=>{this.clearTimeoutFn(q)})}return this.subs.push(I),this.subs.push(V),this}connect(g){return this.open(g)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const g=this.engine;this.subs.push(ih(g,"ping",this.onping.bind(this)),ih(g,"data",this.ondata.bind(this)),ih(g,"error",this.onerror.bind(this)),ih(g,"close",this.onclose.bind(this)),ih(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(g){try{this.decoder.add(g)}catch(b){this.onclose("parse error",b)}}ondecoded(g){R1(()=>{this.emitReserved("packet",g)},this.setTimeoutFn)}onerror(g){this.emitReserved("error",g)}socket(g,b){let S=this.nsps[g];return S?this._autoConnect&&!S.active&&S.connect():(S=new rS(this,g,b),this.nsps[g]=S),S}_destroy(g){const b=Object.keys(this.nsps);for(const S of b)if(this.nsps[S].active)return;this._close()}_packet(g){const b=this.encoder.encode(g);for(let S=0;S<b.length;S++)this.engine.write(b[S],g.options)}cleanup(){this.subs.forEach(g=>g()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(g,b){var S;this.cleanup(),(S=this.engine)===null||S===void 0||S.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",g,b),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const g=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const b=this.backoff.duration();this._reconnecting=!0;const S=this.setTimeoutFn(()=>{g.skipReconnect||(this.emitReserved("reconnect_attempt",g.backoff.attempts),!g.skipReconnect&&g.open(I=>{I?(g._reconnecting=!1,g.reconnect(),this.emitReserved("reconnect_error",I)):g.onreconnect()}))},b);this.opts.autoUnref&&S.unref(),this.subs.push(()=>{this.clearTimeoutFn(S)})}}onreconnect(){const g=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",g)}}const Y_={};function s0(h,g){typeof h=="object"&&(g=h,h=void 0),g=g||{};const b=HM(h,g.path||"/socket.io"),S=b.source,I=b.id,N=b.path,V=Y_[I]&&N in Y_[I].nsps,s=g.forceNew||g["force new connection"]||g.multiplex===!1||V;let q;return s?q=new _2(S,g):(Y_[I]||(Y_[I]=new _2(S,g)),q=Y_[I]),b.query&&!g.query&&(g.query=b.queryKey),q.socket(b.path,g)}Object.assign(s0,{Manager:_2,Socket:rS,io:s0,connect:s0});const iI="https://urbansetu.onrender.com",nS=async()=>{try{const h=await fetch(`${iI}/api/auth/csrf-token`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!h.ok){const S=await h.text();throw console.error("CSRF token fetch failed:",h.status,S),new Error(`Failed to fetch CSRF token: ${h.status}`)}const g=h.headers.get("content-type");if(!g||!g.includes("application/json")){const S=await h.text();throw console.error("CSRF token response is not JSON:",S),new Error("Server returned non-JSON response")}const b=await h.json();if(!b.csrfToken)throw new Error("No CSRF token received from server");return b.csrfToken}catch(h){throw console.error("Error fetching CSRF token:",h),h}},rI=async()=>await nS(),nI=async(h={})=>{try{const g=await rI();return{...h,headers:{"Content-Type":"application/json","X-CSRF-Token":g,...h.headers},credentials:"include"}}catch(g){console.error("Error creating authenticated fetch options:",g);try{const b=await nS();return{...h,headers:{"Content-Type":"application/json","X-CSRF-Token":b,...h.headers},credentials:"include"}}catch(b){return console.error("Retry failed for CSRF token:",b),{...h,headers:{"Content-Type":"application/json",...h.headers},credentials:"include"}}}},tb=async(h,g={})=>{try{const b=await nI(g),S=await fetch(h,b);if(!S.ok){const I=S.clone();let N=null;try{const V=S.headers.get("content-type");V&&V.includes("application/json")?N=await I.json():N={message:await I.text()}}catch{try{N={message:await I.text()}}catch{N={message:`HTTP ${S.status}`}}}console.error(`${S.status} response:`,N)}return S}catch(b){throw console.error("Authenticated fetch error:",b),b}},sI=()=>{var h;try{document.cookie="test_cookie=1; path=/; SameSite=None; Secure";const g=(h=document.cookie.split("; ").find(b=>b.startsWith("test_cookie=")))==null?void 0:h.split("=")[1];return document.cookie="test_cookie=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=None; Secure",g==="1"}catch(g){return console.warn("Cookie test failed:",g),!1}},sS=()=>{var g;const h=(g=document.cookie.split("; ").find(b=>b.startsWith("access_token=")))==null?void 0:g.split("=")[1];return h||localStorage.getItem("accessToken")},Ij=(h={})=>{const g=sS(),b=sI(),S={credentials:"include",...h};return(!b||!document.cookie.includes("access_token="))&&g&&(S.headers={...S.headers,Authorization:`Bearer ${g}`}),S},zj=async(h,g={})=>tb(h,g),aS="https://urbansetu.onrender.com";function oS(){const h=sS();return h||console.log("[Socket] getToken: not found"),h}let pr=s0(aS,{auth:{token:oS()},withCredentials:!0,transports:["websocket"]});function aI(){const h=document.cookie.split("; ").find(g=>g.startsWith("session_id="));return h?decodeURIComponent(h.split("=")[1]):null}function lS(){const h=aI();h&&pr&&pr.connected&&pr.emit("registerSession",{sessionId:h})}pr.on("connect",()=>{console.log("[Socket] Connected to server"),lS()});pr.on("disconnect",()=>{console.log("[Socket] Disconnected from server")});pr.on("connect_error",h=>{console.log("[Socket] Connection error:",h)});pr.on("forceLogout",({reason:h})=>{console.log("[Socket] Force logout received:",h);try{localStorage.removeItem("accessToken")}catch{}document.cookie="access_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="refresh_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="session_id=; Max-Age=0; path=/; SameSite=None; Secure",window.location.href="/sign-in?error=forced_logout"});function Dm(){pr&&pr.connected&&pr.disconnect();const h=oS();h&&console.log("[Socket] reconnecting with token"),pr=s0(aS,{auth:{token:h},withCredentials:!0,transports:["websocket"]}),pr.on("connect",()=>{h&&console.log("[Socket] Reconnected to server"),lS()}),pr.on("disconnect",()=>{console.log("[Socket] Disconnected from server")}),pr.on("connect_error",g=>{console.log("[Socket] Connection error:",g)}),pr.on("forceLogout",({reason:g})=>{console.log("[Socket] Force logout received:",g);try{localStorage.removeItem("accessToken")}catch{}document.cookie="access_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="refresh_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="session_id=; Max-Age=0; path=/; SameSite=None; Secure",window.location.href="/sign-in?error=forced_logout"})}var cS={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},I4=Wn.createContext&&Wn.createContext(cS),oI=["attr","size","title"];function lI(h,g){if(h==null)return{};var b=cI(h,g),S,I;if(Object.getOwnPropertySymbols){var N=Object.getOwnPropertySymbols(h);for(I=0;I<N.length;I++)S=N[I],!(g.indexOf(S)>=0)&&Object.prototype.propertyIsEnumerable.call(h,S)&&(b[S]=h[S])}return b}function cI(h,g){if(h==null)return{};var b={};for(var S in h)if(Object.prototype.hasOwnProperty.call(h,S)){if(g.indexOf(S)>=0)continue;b[S]=h[S]}return b}function u1(){return u1=Object.assign?Object.assign.bind():function(h){for(var g=1;g<arguments.length;g++){var b=arguments[g];for(var S in b)Object.prototype.hasOwnProperty.call(b,S)&&(h[S]=b[S])}return h},u1.apply(this,arguments)}function z4(h,g){var b=Object.keys(h);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(h);g&&(S=S.filter(function(I){return Object.getOwnPropertyDescriptor(h,I).enumerable})),b.push.apply(b,S)}return b}function h1(h){for(var g=1;g<arguments.length;g++){var b=arguments[g]!=null?arguments[g]:{};g%2?z4(Object(b),!0).forEach(function(S){uI(h,S,b[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(b)):z4(Object(b)).forEach(function(S){Object.defineProperty(h,S,Object.getOwnPropertyDescriptor(b,S))})}return h}function uI(h,g,b){return g=hI(g),g in h?Object.defineProperty(h,g,{value:b,enumerable:!0,configurable:!0,writable:!0}):h[g]=b,h}function hI(h){var g=dI(h,"string");return typeof g=="symbol"?g:g+""}function dI(h,g){if(typeof h!="object"||!h)return h;var b=h[Symbol.toPrimitive];if(b!==void 0){var S=b.call(h,g);if(typeof S!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(h)}function uS(h){return h&&h.map((g,b)=>Wn.createElement(g.tag,h1({key:b},g.attr),uS(g.child)))}function Gt(h){return g=>Wn.createElement(fI,u1({attr:h1({},h.attr)},g),uS(h.child))}function fI(h){var g=b=>{var{attr:S,size:I,title:N}=h,V=lI(h,oI),s=I||b.size||"1em",q;return b.className&&(q=b.className),h.className&&(q=(q?q+" ":"")+h.className),Wn.createElement("svg",u1({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},b.attr,S,V,{className:q,style:h1(h1({color:h.color||b.color},b.style),h.style),height:s,width:s,xmlns:"http://www.w3.org/2000/svg"}),N&&Wn.createElement("title",null,N),h.children)};return I4!==void 0?Wn.createElement(I4.Consumer,null,b=>g(b)):g(cS)}function Lj(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M420.55,301.93a24,24,0,1,1,24-24,24,24,0,0,1-24,24m-265.1,0a24,24,0,1,1,24-24,24,24,0,0,1-24,24m273.7-144.48,47.94-83a10,10,0,1,0-17.27-10h0l-48.54,84.07a301.25,301.25,0,0,0-246.56,0L116.18,64.45a10,10,0,1,0-17.27,10h0l47.94,83C64.53,202.22,8.24,285.55,0,384H576c-8.24-98.45-64.54-181.78-146.85-226.55"},child:[]}]})(h)}function Dj(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z"},child:[]}]})(h)}function Pj(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"},child:[]}]})(h)}function Oj(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"},child:[]}]})(h)}function jj(h){return Gt({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"},child:[]}]})(h)}function Nj(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"},child:[]}]})(h)}function kj(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"},child:[]}]})(h)}function Bj(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"},child:[]}]})(h)}function Fj(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M32 448c0 17.7 14.3 32 32 32h384c17.7 0 32-14.3 32-32V160H32v288zm160-212c0-6.6 5.4-12 12-12h104c6.6 0 12 5.4 12 12v8c0 6.6-5.4 12-12 12H204c-6.6 0-12-5.4-12-12v-8zM480 32H32C14.3 32 0 46.3 0 64v48c0 8.8 7.2 16 16 16h480c8.8 0 16-7.2 16-16V64c0-17.7-14.3-32-32-32z"},child:[]}]})(h)}function pI(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M413.1 222.5l22.2 22.2c9.4 9.4 9.4 24.6 0 33.9L241 473c-9.4 9.4-24.6 9.4-33.9 0L12.7 278.6c-9.4-9.4-9.4-24.6 0-33.9l22.2-22.2c9.5-9.5 25-9.3 34.3.4L184 343.4V56c0-13.3 10.7-24 24-24h32c13.3 0 24 10.7 24 24v287.4l114.8-120.5c9.3-9.8 24.8-10 34.3-.4z"},child:[]}]})(h)}function Uj(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"},child:[]}]})(h)}function Vj(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"},child:[]}]})(h)}function Hj(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M97.12 362.63c-8.69-8.69-4.16-6.24-25.12-11.85-9.51-2.55-17.87-7.45-25.43-13.32L1.2 448.7c-4.39 10.77 3.81 22.47 15.43 22.03l52.69-2.01L105.56 507c8 8.44 22.04 5.81 26.43-4.96l52.05-127.62c-10.84 6.04-22.87 9.58-35.31 9.58-19.5 0-37.82-7.59-51.61-21.37zM382.8 448.7l-45.37-111.24c-7.56 5.88-15.92 10.77-25.43 13.32-21.07 5.64-16.45 3.18-25.12 11.85-13.79 13.78-32.12 21.37-51.62 21.37-12.44 0-24.47-3.55-35.31-9.58L252 502.04c4.39 10.77 18.44 13.4 26.43 4.96l36.25-38.28 52.69 2.01c11.62.44 19.82-11.27 15.43-22.03zM263 340c15.28-15.55 17.03-14.21 38.79-20.14 13.89-3.79 24.75-14.84 28.47-28.98 7.48-28.4 5.54-24.97 25.95-45.75 10.17-10.35 14.14-25.44 10.42-39.58-7.47-28.38-7.48-24.42 0-52.83 3.72-14.14-.25-29.23-10.42-39.58-20.41-20.78-18.47-17.36-25.95-45.75-3.72-14.14-14.58-25.19-28.47-28.98-27.88-7.61-24.52-5.62-44.95-26.41-10.17-10.35-25-14.4-38.89-10.61-27.87 7.6-23.98 7.61-51.9 0-13.89-3.79-28.72.25-38.89 10.61-20.41 20.78-17.05 18.8-44.94 26.41-13.89 3.79-24.75 14.84-28.47 28.98-7.47 28.39-5.54 24.97-25.95 45.75-10.17 10.35-14.15 25.44-10.42 39.58 7.47 28.36 7.48 24.4 0 52.82-3.72 14.14.25 29.23 10.42 39.59 20.41 20.78 18.47 17.35 25.95 45.75 3.72 14.14 14.58 25.19 28.47 28.98C104.6 325.96 106.27 325 121 340c13.23 13.47 33.84 15.88 49.74 5.82a39.676 39.676 0 0 1 42.53 0c15.89 10.06 36.5 7.65 49.73-5.82zM97.66 175.96c0-53.03 42.24-96.02 94.34-96.02s94.34 42.99 94.34 96.02-42.24 96.02-94.34 96.02-94.34-42.99-94.34-96.02z"},child:[]}]})(h)}function L4(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"},child:[]}]})(h)}function hS(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"},child:[]}]})(h)}function qj(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M32,384a95.4,95.4,0,0,0,32,71.09V496a16,16,0,0,0,16,16h32a16,16,0,0,0,16-16V480H384v16a16,16,0,0,0,16,16h32a16,16,0,0,0,16-16V455.09A95.4,95.4,0,0,0,480,384V336H32ZM496,256H80V69.25a21.26,21.26,0,0,1,36.28-15l19.27,19.26c-13.13,29.88-7.61,59.11,8.62,79.73l-.17.17A16,16,0,0,0,144,176l11.31,11.31a16,16,0,0,0,22.63,0L283.31,81.94a16,16,0,0,0,0-22.63L272,48a16,16,0,0,0-22.62,0l-.17.17c-20.62-16.23-49.83-21.75-79.73-8.62L150.22,20.28A69.25,69.25,0,0,0,32,69.25V256H16A16,16,0,0,0,0,272v16a16,16,0,0,0,16,16H496a16,16,0,0,0,16-16V272A16,16,0,0,0,496,256Z"},child:[]}]})(h)}function Gj(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M176 256c44.11 0 80-35.89 80-80s-35.89-80-80-80-80 35.89-80 80 35.89 80 80 80zm352-128H304c-8.84 0-16 7.16-16 16v144H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v352c0 8.84 7.16 16 16 16h32c8.84 0 16-7.16 16-16v-48h512v48c0 8.84 7.16 16 16 16h32c8.84 0 16-7.16 16-16V240c0-61.86-50.14-112-112-112z"},child:[]}]})(h)}function wm(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 512c35.32 0 63.97-28.65 63.97-64H160.03c0 35.35 28.65 64 63.97 64zm215.39-149.71c-19.32-20.76-55.47-51.99-55.47-154.29 0-77.7-54.48-139.9-127.94-155.16V32c0-17.67-14.32-32-31.98-32s-31.98 14.33-31.98 32v20.84C118.56 68.1 64.08 130.3 64.08 208c0 102.3-36.15 133.53-55.47 154.29-6 6.45-8.66 14.16-8.61 21.71.11 16.4 12.98 32 32.1 32h383.8c19.12 0 32-15.6 32.1-32 .05-7.55-2.61-15.27-8.61-21.71z"},child:[]}]})(h)}function mI(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M512.509 192.001c-16.373-.064-32.03 2.955-46.436 8.495l-77.68-125.153A24 24 0 0 0 368.001 64h-64c-8.837 0-16 7.163-16 16v16c0 8.837 7.163 16 16 16h50.649l14.896 24H256.002v-16c0-8.837-7.163-16-16-16h-87.459c-13.441 0-24.777 10.999-24.536 24.437.232 13.044 10.876 23.563 23.995 23.563h48.726l-29.417 47.52c-13.433-4.83-27.904-7.483-42.992-7.52C58.094 191.83.412 249.012.002 319.236-.413 390.279 57.055 448 128.002 448c59.642 0 109.758-40.793 123.967-96h52.033a24 24 0 0 0 20.406-11.367L410.37 201.77l14.938 24.067c-25.455 23.448-41.385 57.081-41.307 94.437.145 68.833 57.899 127.051 126.729 127.719 70.606.685 128.181-55.803 129.255-125.996 1.086-70.941-56.526-129.72-127.476-129.996zM186.75 265.772c9.727 10.529 16.673 23.661 19.642 38.228h-43.306l23.664-38.228zM128.002 400c-44.112 0-80-35.888-80-80s35.888-80 80-80c5.869 0 11.586.653 17.099 1.859l-45.505 73.509C89.715 331.327 101.213 352 120.002 352h81.3c-12.37 28.225-40.562 48-73.3 48zm162.63-96h-35.624c-3.96-31.756-19.556-59.894-42.383-80.026L237.371 184h127.547l-74.286 120zm217.057 95.886c-41.036-2.165-74.049-35.692-75.627-76.755-.812-21.121 6.633-40.518 19.335-55.263l44.433 71.586c4.66 7.508 14.524 9.816 22.032 5.156l13.594-8.437c7.508-4.66 9.817-14.524 5.156-22.032l-44.468-71.643a79.901 79.901 0 0 1 19.858-2.497c44.112 0 80 35.888 80 80-.001 45.54-38.252 82.316-84.313 79.885z"},child:[]}]})(h)}function $j(h){return Gt({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M296 160H180.6l42.6-129.8C227.2 15 215.7 0 200 0H56C44 0 33.8 8.9 32.2 20.8l-32 240C-1.7 275.2 9.5 288 24 288h118.7L96.6 482.5c-3.6 15.2 8 29.5 23.3 29.5 8.4 0 16.4-4.4 20.8-12l176-304c9.3-15.9-2.2-36-20.7-36z"},child:[]}]})(h)}function D4(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 512V48C0 21.49 21.49 0 48 0h288c26.51 0 48 21.49 48 48v464L192 400 0 512z"},child:[]}]})(h)}function Zj(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M256.47 216.77l86.73 109.18s-16.6 102.36-76.57 150.12C206.66 523.85 0 510.19 0 510.19s3.8-23.14 11-55.43l94.62-112.17c3.97-4.7-.87-11.62-6.65-9.5l-60.4 22.09c14.44-41.66 32.72-80.04 54.6-97.47 59.97-47.76 163.3-40.94 163.3-40.94zM636.53 31.03l-19.86-25c-5.49-6.9-15.52-8.05-22.41-2.56l-232.48 177.8-34.14-42.97c-5.09-6.41-15.14-5.21-18.59 2.21l-25.33 54.55 86.73 109.18 58.8-12.45c8-1.69 11.42-11.2 6.34-17.6l-34.09-42.92 232.48-177.8c6.89-5.48 8.04-15.53 2.55-22.44z"},child:[]}]})(h)}function Wj(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M511.988 288.9c-.478 17.43-15.217 31.1-32.653 31.1H424v16c0 21.864-4.882 42.584-13.6 61.145l60.228 60.228c12.496 12.497 12.496 32.758 0 45.255-12.498 12.497-32.759 12.496-45.256 0l-54.736-54.736C345.886 467.965 314.351 480 280 480V236c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v244c-34.351 0-65.886-12.035-90.636-32.108l-54.736 54.736c-12.498 12.497-32.759 12.496-45.256 0-12.496-12.497-12.496-32.758 0-45.255l60.228-60.228C92.882 378.584 88 357.864 88 336v-16H32.666C15.23 320 .491 306.33.013 288.9-.484 270.816 14.028 256 32 256h56v-58.745l-46.628-46.628c-12.496-12.497-12.496-32.758 0-45.255 12.498-12.497 32.758-12.497 45.256 0L141.255 160h229.489l54.627-54.627c12.498-12.497 32.758-12.497 45.256 0 12.496 12.497 12.496 32.758 0 45.255L424 197.255V256h56c17.972 0 32.484 14.816 31.988 32.9zM257 0c-61.856 0-112 50.144-112 112h224C369 50.144 318.856 0 257 0z"},child:[]}]})(h)}function Xj(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M436 480h-20V24c0-13.255-10.745-24-24-24H56C42.745 0 32 10.745 32 24v456H12c-6.627 0-12 5.373-12 12v20h448v-20c0-6.627-5.373-12-12-12zM128 76c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40c0 6.627-5.373 12-12 12h-40c-6.627 0-12-5.373-12-12V76zm0 96c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40c0 6.627-5.373 12-12 12h-40c-6.627 0-12-5.373-12-12v-40zm52 148h-40c-6.627 0-12-5.373-12-12v-40c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40c0 6.627-5.373 12-12 12zm76 160h-64v-84c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v84zm64-172c0 6.627-5.373 12-12 12h-40c-6.627 0-12-5.373-12-12v-40c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40zm0-96c0 6.627-5.373 12-12 12h-40c-6.627 0-12-5.373-12-12v-40c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40zm0-96c0 6.627-5.373 12-12 12h-40c-6.627 0-12-5.373-12-12V76c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40z"},child:[]}]})(h)}function Yj(h){return Gt({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111.03 8 0 119.03 0 256s111.03 248 248 248 248-111.03 248-248S384.97 8 248 8zm0 432c-101.69 0-184-82.29-184-184 0-101.69 82.29-184 184-184 101.69 0 184 82.29 184 184 0 101.69-82.29 184-184 184zm0-312c-70.69 0-128 57.31-128 128s57.31 128 128 128 128-57.31 128-128-57.31-128-128-128zm0 192c-35.29 0-64-28.71-64-64s28.71-64 64-64 64 28.71 64 64-28.71 64-64 64z"},child:[]}]})(h)}function Kj(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 0H48C22.4 0 0 22.4 0 48v416c0 25.6 22.4 48 48 48h352c25.6 0 48-22.4 48-48V48c0-25.6-22.4-48-48-48zM128 435.2c0 6.4-6.4 12.8-12.8 12.8H76.8c-6.4 0-12.8-6.4-12.8-12.8v-38.4c0-6.4 6.4-12.8 12.8-12.8h38.4c6.4 0 12.8 6.4 12.8 12.8v38.4zm0-128c0 6.4-6.4 12.8-12.8 12.8H76.8c-6.4 0-12.8-6.4-12.8-12.8v-38.4c0-6.4 6.4-12.8 12.8-12.8h38.4c6.4 0 12.8 6.4 12.8 12.8v38.4zm128 128c0 6.4-6.4 12.8-12.8 12.8h-38.4c-6.4 0-12.8-6.4-12.8-12.8v-38.4c0-6.4 6.4-12.8 12.8-12.8h38.4c6.4 0 12.8 6.4 12.8 12.8v38.4zm0-128c0 6.4-6.4 12.8-12.8 12.8h-38.4c-6.4 0-12.8-6.4-12.8-12.8v-38.4c0-6.4 6.4-12.8 12.8-12.8h38.4c6.4 0 12.8 6.4 12.8 12.8v38.4zm128 128c0 6.4-6.4 12.8-12.8 12.8h-38.4c-6.4 0-12.8-6.4-12.8-12.8V268.8c0-6.4 6.4-12.8 12.8-12.8h38.4c6.4 0 12.8 6.4 12.8 12.8v166.4zm0-256c0 6.4-6.4 12.8-12.8 12.8H76.8c-6.4 0-12.8-6.4-12.8-12.8V76.8C64 70.4 70.4 64 76.8 64h294.4c6.4 0 12.8 6.4 12.8 12.8v102.4z"},child:[]}]})(h)}function _p(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V192H0v272zm320-196c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM192 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM64 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM400 64h-48V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H160V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H48C21.5 64 0 85.5 0 112v48h448v-48c0-26.5-21.5-48-48-48z"},child:[]}]})(h)}function gI(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"},child:[]}]})(h)}function P4(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M499.99 176h-59.87l-16.64-41.6C406.38 91.63 365.57 64 319.5 64h-127c-46.06 0-86.88 27.63-103.99 70.4L71.87 176H12.01C4.2 176-1.53 183.34.37 190.91l6 24C7.7 220.25 12.5 224 18.01 224h20.07C24.65 235.73 16 252.78 16 272v48c0 16.12 6.16 30.67 16 41.93V416c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32v-32h256v32c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32v-54.07c9.84-11.25 16-25.8 16-41.93v-48c0-19.22-8.65-36.27-22.07-48H494c5.51 0 10.31-3.75 11.64-9.09l6-24c1.89-7.57-3.84-14.91-11.65-14.91zm-352.06-17.83c7.29-18.22 24.94-30.17 44.57-30.17h127c19.63 0 37.28 11.95 44.57 30.17L384 208H128l19.93-49.83zM96 319.8c-19.2 0-32-12.76-32-31.9S76.8 256 96 256s48 28.71 48 47.85-28.8 15.95-48 15.95zm320 0c-19.2 0-48 3.19-48-15.95S396.8 256 416 256s32 12.76 32 31.9-12.8 31.9-32 31.9z"},child:[]}]})(h)}function Jj(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M112 128c0-29.5 16.2-55 40-68.9V256h48V48h48v208h48V59.1c23.8 13.9 40 39.4 40 68.9v128h48V128C384 57.3 326.7 0 256 0h-64C121.3 0 64 57.3 64 128v128h48zm334.3 213.9l-10.7-32c-4.4-13.1-16.6-21.9-30.4-21.9H42.7c-13.8 0-26 8.8-30.4 21.9l-10.7 32C-5.2 362.6 10.2 384 32 384v112c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V384h256v112c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V384c21.8 0 37.2-21.4 30.3-42.1z"},child:[]}]})(h)}function Qj(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M332.8 320h38.4c6.4 0 12.8-6.4 12.8-12.8V172.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v134.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V76.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v230.4c0 6.4 6.4 12.8 12.8 12.8zm-288 0h38.4c6.4 0 12.8-6.4 12.8-12.8v-70.4c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v70.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V108.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v198.4c0 6.4 6.4 12.8 12.8 12.8zM496 384H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v336c0 17.67 14.33 32 32 32h464c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16z"},child:[]}]})(h)}function eN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M496 384H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v336c0 17.67 14.33 32 32 32h464c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zM464 96H345.94c-21.38 0-32.09 25.85-16.97 40.97l32.4 32.4L288 242.75l-73.37-73.37c-12.5-12.5-32.76-12.5-45.25 0l-68.69 68.69c-6.25 6.25-6.25 16.38 0 22.63l22.62 22.62c6.25 6.25 16.38 6.25 22.63 0L192 237.25l73.37 73.37c12.5 12.5 32.76 12.5 45.25 0l96-96 32.4 32.4c15.12 15.12 40.97 4.41 40.97-16.97V112c.01-8.84-7.15-16-15.99-16z"},child:[]}]})(h)}function tN(h){return Gt({attr:{viewBox:"0 0 544 512"},child:[{tag:"path",attr:{d:"M527.79 288H290.5l158.03 158.03c6.04 6.04 15.98 6.53 22.19.68 38.7-36.46 65.32-85.61 73.13-140.86 1.34-9.46-6.51-17.85-16.06-17.85zm-15.83-64.8C503.72 103.74 408.26 8.28 288.8.04 279.68-.59 272 7.1 272 16.24V240h223.77c9.14 0 16.82-7.68 16.19-16.8zM224 288V50.71c0-9.55-8.39-17.4-17.84-16.06C86.99 51.49-4.1 155.6.14 280.37 4.5 408.51 114.83 513.59 243.03 511.98c50.4-.63 96.97-16.87 135.26-44.03 7.9-5.6 8.42-17.23 1.57-24.08L224 288z"},child:[]}]})(h)}function Sm(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"},child:[]}]})(h)}function iN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505 174.8l-39.6-39.6c-9.4-9.4-24.6-9.4-33.9 0L192 374.7 80.6 263.2c-9.4-9.4-24.6-9.4-33.9 0L7 302.9c-9.4 9.4-9.4 24.6 0 34L175 505c9.4 9.4 24.6 9.4 33.9 0l296-296.2c9.4-9.5 9.4-24.7.1-34zm-324.3 106c6.2 6.3 16.4 6.3 22.6 0l208-208.2c6.2-6.3 6.2-16.4 0-22.6L366.1 4.7c-6.2-6.3-16.4-6.3-22.6 0L192 156.2l-55.4-55.5c-6.2-6.3-16.4-6.3-22.6 0L68.7 146c-6.2 6.3-6.2 16.4 0 22.6l112 112.2z"},child:[]}]})(h)}function rN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 480H48c-26.51 0-48-21.49-48-48V80c0-26.51 21.49-48 48-48h352c26.51 0 48 21.49 48 48v352c0 26.51-21.49 48-48 48zm-204.686-98.059l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.248-16.379-6.249-22.628 0L184 302.745l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.25 16.379 6.25 22.628.001z"},child:[]}]})(h)}function qy(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"},child:[]}]})(h)}function nN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"},child:[]}]})(h)}function I1(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"},child:[]}]})(h)}function sN(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M537.6 226.6c4.1-10.7 6.4-22.4 6.4-34.6 0-53-43-96-96-96-19.7 0-38.1 6-53.3 16.2C367 64.2 315.3 32 256 32c-88.4 0-160 71.6-160 160 0 2.7.1 5.4.2 8.1C40.2 219.8 0 273.2 0 336c0 79.5 64.5 144 144 144h368c70.7 0 128-57.3 128-128 0-61.9-44-113.6-102.4-125.4zM393.4 288H328v112c0 8.8-7.2 16-16 16h-48c-8.8 0-16-7.2-16-16V288h-65.4c-14.3 0-21.4-17.2-11.3-27.3l105.4-105.4c6.2-6.2 16.4-6.2 22.6 0l105.4 105.4c10.1 10.1 2.9 27.3-11.3 27.3z"},child:[]}]})(h)}function aN(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M537.6 226.6c4.1-10.7 6.4-22.4 6.4-34.6 0-53-43-96-96-96-19.7 0-38.1 6-53.3 16.2C367 64.2 315.3 32 256 32c-88.4 0-160 71.6-160 160 0 2.7.1 5.4.2 8.1C40.2 219.8 0 273.2 0 336c0 79.5 64.5 144 144 144h368c70.7 0 128-57.3 128-128 0-61.9-44-113.6-102.4-125.4z"},child:[]}]})(h)}function Ly(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"},child:[]}]})(h)}function oN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32zM128 272c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 0c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 0c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"},child:[]}]})(h)}function lN(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M416 192c0-88.4-93.1-160-208-160S0 103.6 0 192c0 34.3 14.1 65.9 38 92-13.4 30.2-35.5 54.2-35.8 54.5-2.2 2.3-2.8 5.7-1.5 8.7S4.8 352 8 352c36.6 0 66.9-12.3 88.7-25 32.2 15.7 70.3 25 111.3 25 114.9 0 208-71.6 208-160zm122 220c23.9-26 38-57.7 38-92 0-66.9-53.5-124.2-129.3-148.1.9 6.6 1.3 13.3 1.3 20.1 0 105.9-107.7 192-240 192-10.8 0-21.3-.8-31.7-1.9C207.8 439.6 281.8 480 368 480c41 0 79.1-9.2 111.3-25 21.8 12.7 52.1 25 88.7 25 3.2 0 6.1-1.9 7.3-4.8 1.3-2.9.7-6.3-1.5-8.7-.3-.3-22.4-24.2-35.8-54.5z"},child:[]}]})(h)}function dS(h){return Gt({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M225.38 233.37c-12.5 12.5-12.5 32.76 0 45.25 12.49 12.5 32.76 12.5 45.25 0 12.5-12.5 12.5-32.76 0-45.25-12.5-12.49-32.76-12.49-45.25 0zM248 8C111.03 8 0 119.03 0 256s111.03 248 248 248 248-111.03 248-248S384.97 8 248 8zm126.14 148.05L308.17 300.4a31.938 31.938 0 0 1-15.77 15.77l-144.34 65.97c-16.65 7.61-33.81-9.55-26.2-26.2l65.98-144.35a31.938 31.938 0 0 1 15.77-15.77l144.34-65.97c16.65-7.6 33.8 9.55 26.19 26.2z"},child:[]}]})(h)}function cN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z"},child:[]}]})(h)}function uN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"},child:[]}]})(h)}function hN(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M0 432c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V256H0v176zm192-68c0-6.6 5.4-12 12-12h136c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H204c-6.6 0-12-5.4-12-12v-40zm-128 0c0-6.6 5.4-12 12-12h72c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM576 80v48H0V80c0-26.5 21.5-48 48-48h480c26.5 0 48 21.5 48 48z"},child:[]}]})(h)}function _I(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"},child:[]}]})(h)}function dN(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"},child:[]}]})(h)}function yI(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M502.61 233.32L278.68 9.39c-12.52-12.52-32.83-12.52-45.36 0L9.39 233.32c-12.52 12.53-12.52 32.83 0 45.36l223.93 223.93c12.52 12.53 32.83 12.53 45.36 0l223.93-223.93c12.52-12.53 12.52-32.83 0-45.36zm-100.98 12.56l-84.21 77.73c-5.12 4.73-13.43 1.1-13.43-5.88V264h-96v64c0 4.42-3.58 8-8 8h-32c-4.42 0-8-3.58-8-8v-80c0-17.67 14.33-32 32-32h112v-53.73c0-6.97 8.3-10.61 13.43-5.88l84.21 77.73c3.43 3.17 3.43 8.59 0 11.76z"},child:[]}]})(h)}function fN(h){return Gt({attr:{viewBox:"0 0 288 512"},child:[{tag:"path",attr:{d:"M209.2 233.4l-108-31.6C88.7 198.2 80 186.5 80 173.5c0-16.3 13.2-29.5 29.5-29.5h66.3c12.2 0 24.2 3.7 34.2 10.5 6.1 4.1 14.3 3.1 19.5-2l34.8-34c7.1-6.9 6.1-18.4-1.8-24.5C238 74.8 207.4 64.1 176 64V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48h-2.5C45.8 64-5.4 118.7.5 183.6c4.2 46.1 39.4 83.6 83.8 96.6l102.5 30c12.5 3.7 21.2 15.3 21.2 28.3 0 16.3-13.2 29.5-29.5 29.5h-66.3C100 368 88 364.3 78 357.5c-6.1-4.1-14.3-3.1-19.5 2l-34.8 34c-7.1 6.9-6.1 18.4 1.8 24.5 24.5 19.2 55.1 29.9 86.5 30v48c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-48.2c46.6-.9 90.3-28.6 105.7-72.7 21.5-61.6-14.6-124.8-72.5-141.7z"},child:[]}]})(h)}function xI(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"},child:[]}]})(h)}function O4(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"},child:[]}]})(h)}function pN(h){return Gt({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"},child:[]}]})(h)}function nd(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"},child:[]}]})(h)}function fS(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(h)}function mN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z"},child:[]}]})(h)}function gN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"},child:[]}]})(h)}function jg(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"},child:[]}]})(h)}function au(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"},child:[]}]})(h)}function vI(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm64 236c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-64c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-72v8c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm96-114.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(h)}function _N(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(h)}function bI(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.976 0H24.028C2.71 0-8.047 25.866 7.058 40.971L192 225.941V432c0 7.831 3.821 15.17 10.237 19.662l80 55.98C298.02 518.69 320 507.493 320 487.98V225.941l184.947-184.97C520.021 25.896 509.338 0 487.976 0z"},child:[]}]})(h)}function yN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M349.565 98.783C295.978 98.783 251.721 64 184.348 64c-24.955 0-47.309 4.384-68.045 12.013a55.947 55.947 0 0 0 3.586-23.562C118.117 24.015 94.806 1.206 66.338.048 34.345-1.254 8 24.296 8 56c0 19.026 9.497 35.825 24 45.945V488c0 13.255 10.745 24 24 24h16c13.255 0 24-10.745 24-24v-94.4c28.311-12.064 63.582-22.122 114.435-22.122 53.588 0 97.844 34.783 165.217 34.783 48.169 0 86.667-16.294 122.505-40.858C506.84 359.452 512 349.571 512 339.045v-243.1c0-23.393-24.269-38.87-45.485-29.016-34.338 15.948-76.454 31.854-116.95 31.854z"},child:[]}]})(h)}function xN(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M485.5 0L576 160H474.9L405.7 0h79.8zm-128 0l69.2 160H149.3L218.5 0h139zm-267 0h79.8l-69.2 160H0L90.5 0zM0 192h100.7l123 251.7c1.5 3.1-2.7 5.9-5 3.3L0 192zm148.2 0h279.6l-137 318.2c-1 2.4-4.5 2.4-5.5 0L148.2 192zm204.1 251.7l123-251.7H576L357.3 446.9c-2.3 2.7-6.5-.1-5-3.2z"},child:[]}]})(h)}function vN(h){return Gt({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"},child:[]}]})(h)}function bN(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M434.7 64h-85.9c-8 0-15.7 3-21.6 8.4l-98.3 90c-.1.1-.2.3-.3.4-16.6 15.6-16.3 40.5-2.1 56 12.7 13.9 39.4 17.6 56.1 2.7.1-.1.3-.1.4-.2l79.9-73.2c6.5-5.9 16.7-5.5 22.6 1 6 6.5 5.5 16.6-1 22.6l-26.1 23.9L504 313.8c2.9 2.4 5.5 5 7.9 7.7V128l-54.6-54.6c-5.9-6-14.1-9.4-22.6-9.4zM544 128.2v223.9c0 17.7 14.3 32 32 32h64V128.2h-96zm48 223.9c-8.8 0-16-7.2-16-16s7.2-16 16-16 16 7.2 16 16-7.2 16-16 16zM0 384h64c17.7 0 32-14.3 32-32V128.2H0V384zm48-63.9c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16c0-8.9 7.2-16 16-16zm435.9 18.6L334.6 217.5l-30 27.5c-29.7 27.1-75.2 24.5-101.7-4.4-26.9-29.4-24.8-74.9 4.4-101.7L289.1 64h-83.8c-8.5 0-16.6 3.4-22.6 9.4L128 128v223.9h18.3l90.5 81.9c27.4 22.3 67.7 18.1 90-9.3l.2-.2 17.9 15.5c15.9 13 39.4 10.5 52.3-5.4l31.4-38.6 5.4 4.4c13.7 11.1 33.9 9.1 45-4.7l9.5-11.7c11.2-13.8 9.1-33.9-4.6-45.1z"},child:[]}]})(h)}function Ng(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M192 208c0-17.67-14.33-32-32-32h-16c-35.35 0-64 28.65-64 64v48c0 35.35 28.65 64 64 64h16c17.67 0 32-14.33 32-32V208zm176 144c35.35 0 64-28.65 64-64v-48c0-35.35-28.65-64-64-64h-16c-17.67 0-32 14.33-32 32v112c0 17.67 14.33 32 32 32h16zM256 0C113.18 0 4.58 118.83 0 256v16c0 8.84 7.16 16 16 16h16c8.84 0 16-7.16 16-16v-16c0-114.69 93.31-208 208-208s208 93.31 208 208h-.12c.08 2.43.12 165.72.12 165.72 0 23.35-18.93 42.28-42.28 42.28H320c0-26.51-21.49-48-48-48h-32c-26.51 0-48 21.49-48 48s21.49 48 48 48h181.72c49.86 0 90.28-40.42 90.28-90.28V256C507.42 118.83 398.82 0 256 0z"},child:[]}]})(h)}function wI(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"},child:[]}]})(h)}function j4(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 255.531c.253 136.64-111.18 248.372-247.82 248.468-59.015.042-113.223-20.53-155.822-54.911-11.077-8.94-11.905-25.541-1.839-35.607l11.267-11.267c8.609-8.609 22.353-9.551 31.891-1.984C173.062 425.135 212.781 440 256 440c101.705 0 184-82.311 184-184 0-101.705-82.311-184-184-184-48.814 0-93.149 18.969-126.068 49.932l50.754 50.754c10.08 10.08 2.941 27.314-11.313 27.314H24c-8.837 0-16-7.163-16-16V38.627c0-14.254 17.234-21.393 27.314-11.314l49.372 49.372C129.209 34.136 189.552 8 256 8c136.81 0 247.747 110.78 248 247.531zm-180.912 78.784l9.823-12.63c8.138-10.463 6.253-25.542-4.21-33.679L288 256.349V152c0-13.255-10.745-24-24-24h-16c-13.255 0-24 10.745-24 24v135.651l65.409 50.874c10.463 8.137 25.541 6.253 33.679-4.21z"},child:[]}]})(h)}function Fg(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"},child:[]}]})(h)}function wN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M448 492v20H0v-20c0-6.627 5.373-12 12-12h20V120c0-13.255 10.745-24 24-24h88V24c0-13.255 10.745-24 24-24h112c13.255 0 24 10.745 24 24v72h88c13.255 0 24 10.745 24 24v360h20c6.627 0 12 5.373 12 12zM308 192h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12zm-168 64h40c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12zm104 128h-40c-6.627 0-12 5.373-12 12v84h64v-84c0-6.627-5.373-12-12-12zm64-96h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12zm-116 12c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12v-40zM182 96h26v26a6 6 0 0 0 6 6h20a6 6 0 0 0 6-6V96h26a6 6 0 0 0 6-6V70a6 6 0 0 0-6-6h-26V38a6 6 0 0 0-6-6h-20a6 6 0 0 0-6 6v26h-26a6 6 0 0 0-6 6v20a6 6 0 0 0 6 6z"},child:[]}]})(h)}function TN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56zM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48z"},child:[]}]})(h)}function d1(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"},child:[]}]})(h)}function SN(h){return Gt({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"},child:[]}]})(h)}function EN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M512 176.001C512 273.203 433.202 352 336 352c-11.22 0-22.19-1.062-32.827-3.069l-24.012 27.014A23.999 23.999 0 0 1 261.223 384H224v40c0 13.255-10.745 24-24 24h-40v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24v-78.059c0-6.365 2.529-12.47 7.029-16.971l161.802-161.802C163.108 213.814 160 195.271 160 176 160 78.798 238.797.001 335.999 0 433.488-.001 512 78.511 512 176.001zM336 128c0 26.51 21.49 48 48 48s48-21.49 48-48-21.49-48-48-48-48 21.49-48 48z"},child:[]}]})(h)}function AN(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"},child:[]}]})(h)}function CN(h){return Gt({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M96.06 454.35c.01 6.29 1.87 12.45 5.36 17.69l17.09 25.69a31.99 31.99 0 0 0 26.64 14.28h61.71a31.99 31.99 0 0 0 26.64-14.28l17.09-25.69a31.989 31.989 0 0 0 5.36-17.69l.04-38.35H96.01l.05 38.35zM0 176c0 44.37 16.45 84.85 43.56 115.78 16.52 18.85 42.36 58.23 52.21 91.45.04.26.07.52.11.78h160.24c.04-.26.07-.51.11-.78 9.85-33.22 35.69-72.6 52.21-91.45C335.55 260.85 352 220.37 352 176 352 78.61 272.91-.3 175.45 0 73.44.31 0 82.97 0 176zm176-80c-44.11 0-80 35.89-80 80 0 8.84-7.16 16-16 16s-16-7.16-16-16c0-61.76 50.24-112 112-112 8.84 0 16 7.16 16 16s-7.16 16-16 16z"},child:[]}]})(h)}function ib(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M80 368H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm0-320H16A16 16 0 0 0 0 64v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16V64a16 16 0 0 0-16-16zm0 160H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm416 176H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"},child:[]}]})(h)}function TI(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M444.52 3.52L28.74 195.42c-47.97 22.39-31.98 92.75 19.19 92.75h175.91v175.91c0 51.17 70.36 67.17 92.75 19.19l191.9-415.78c15.99-38.39-25.59-79.97-63.97-63.97z"},child:[]}]})(h)}function SI(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"},child:[]}]})(h)}function N4(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"},child:[]}]})(h)}function k4(h){return Gt({attr:{viewBox:"0 0 288 512"},child:[{tag:"path",attr:{d:"M112 316.94v156.69l22.02 33.02c4.75 7.12 15.22 7.12 19.97 0L176 473.63V316.94c-10.39 1.92-21.06 3.06-32 3.06s-21.61-1.14-32-3.06zM144 0C64.47 0 0 64.47 0 144s64.47 144 144 144 144-64.47 144-144S223.53 0 144 0zm0 76c-37.5 0-68 30.5-68 68 0 6.62-5.38 12-12 12s-12-5.38-12-12c0-50.73 41.28-92 92-92 6.62 0 12 5.38 12 12s-5.38 12-12 12z"},child:[]}]})(h)}function RN(h){return Gt({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M272 0H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h224c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zM160 480c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm112-108c0 6.6-5.4 12-12 12H60c-6.6 0-12-5.4-12-12V60c0-6.6 5.4-12 12-12h200c6.6 0 12 5.4 12 12v312z"},child:[]}]})(h)}function B4(h){return Gt({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M272 0H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h224c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zM160 480c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"},child:[]}]})(h)}function MN(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M621.16 54.46C582.37 38.19 543.55 32 504.75 32c-123.17-.01-246.33 62.34-369.5 62.34-30.89 0-61.76-3.92-92.65-13.72-3.47-1.1-6.95-1.62-10.35-1.62C15.04 79 0 92.32 0 110.81v317.26c0 12.63 7.23 24.6 18.84 29.46C57.63 473.81 96.45 480 135.25 480c123.17 0 246.34-62.35 369.51-62.35 30.89 0 61.76 3.92 92.65 13.72 3.47 1.1 6.95 1.62 10.35 1.62 17.21 0 32.25-13.32 32.25-31.81V83.93c-.01-12.64-7.24-24.6-18.85-29.47zM48 132.22c20.12 5.04 41.12 7.57 62.72 8.93C104.84 170.54 79 192.69 48 192.69v-60.47zm0 285v-47.78c34.37 0 62.18 27.27 63.71 61.4-22.53-1.81-43.59-6.31-63.71-13.62zM320 352c-44.19 0-80-42.99-80-96 0-53.02 35.82-96 80-96s80 42.98 80 96c0 53.03-35.83 96-80 96zm272 27.78c-17.52-4.39-35.71-6.85-54.32-8.44 5.87-26.08 27.5-45.88 54.32-49.28v57.72zm0-236.11c-30.89-3.91-54.86-29.7-55.81-61.55 19.54 2.17 38.09 6.23 55.81 12.66v48.89z"},child:[]}]})(h)}function IN(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M608 64H32C14.33 64 0 78.33 0 96v320c0 17.67 14.33 32 32 32h576c17.67 0 32-14.33 32-32V96c0-17.67-14.33-32-32-32zM48 400v-64c35.35 0 64 28.65 64 64H48zm0-224v-64h64c0 35.35-28.65 64-64 64zm272 176c-44.19 0-80-42.99-80-96 0-53.02 35.82-96 80-96s80 42.98 80 96c0 53.03-35.83 96-80 96zm272 48h-64c0-35.35 28.65-64 64-64v64zm0-224c-35.35 0-64-28.65-64-64h64v64z"},child:[]}]})(h)}function f1(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"},child:[]}]})(h)}function zN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM240 320h-48v48c0 8.8-7.2 16-16 16h-32c-8.8 0-16-7.2-16-16V144c0-8.8 7.2-16 16-16h96c52.9 0 96 43.1 96 96s-43.1 96-96 96zm0-128h-48v64h48c17.6 0 32-14.4 32-32s-14.4-32-32-32z"},child:[]}]})(h)}function LN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"},child:[]}]})(h)}function DN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"},child:[]}]})(h)}function PN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M112 224c61.9 0 112-50.1 112-112S173.9 0 112 0 0 50.1 0 112s50.1 112 112 112zm0-160c26.5 0 48 21.5 48 48s-21.5 48-48 48-48-21.5-48-48 21.5-48 48-48zm224 224c-61.9 0-112 50.1-112 112s50.1 112 112 112 112-50.1 112-112-50.1-112-112-112zm0 160c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zM392.3.2l31.6-.1c19.4-.1 30.9 21.8 19.7 37.8L77.4 501.6a23.95 23.95 0 0 1-19.6 10.2l-33.4.1c-19.5 0-30.9-21.9-19.7-37.8l368-463.7C377.2 4 384.5.2 392.3.2z"},child:[]}]})(h)}function ON(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M109.25 173.25c24.99-24.99 24.99-65.52 0-90.51-24.99-24.99-65.52-24.99-90.51 0-24.99 24.99-24.99 65.52 0 90.51 25 25 65.52 25 90.51 0zm256 165.49c-24.99-24.99-65.52-24.99-90.51 0-24.99 24.99-24.99 65.52 0 90.51 24.99 24.99 65.52 24.99 90.51 0 25-24.99 25-65.51 0-90.51zm-1.94-231.43l-22.62-22.62c-12.5-12.5-32.76-12.5-45.25 0L20.69 359.44c-12.5 12.5-12.5 32.76 0 45.25l22.62 22.62c12.5 12.5 32.76 12.5 45.25 0l274.75-274.75c12.5-12.49 12.5-32.75 0-45.25z"},child:[]}]})(h)}function fv(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M493.4 24.6l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-36 76.7-98.9 140.5-177.2 177.2l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48C3.9 366.5-2 378.1.6 389.4l24 104C27.1 504.2 36.7 512 48 512c256.1 0 464-207.5 464-464 0-11.2-7.7-20.9-18.6-23.4z"},child:[]}]})(h)}function jN(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M480 192H365.71L260.61 8.06A16.014 16.014 0 0 0 246.71 0h-65.5c-10.63 0-18.3 10.17-15.38 20.39L214.86 192H112l-43.2-57.6c-3.02-4.03-7.77-6.4-12.8-6.4H16.01C5.6 128-2.04 137.78.49 147.88L32 256 .49 364.12C-2.04 374.22 5.6 384 16.01 384H56c5.04 0 9.78-2.37 12.8-6.4L112 320h102.86l-49.03 171.6c-2.92 10.22 4.75 20.4 15.38 20.4h65.5c5.74 0 11.04-3.08 13.89-8.06L365.71 320H480c35.35 0 96-28.65 96-64s-60.65-64-96-64z"},child:[]}]})(h)}function NN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"},child:[]}]})(h)}function rb(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"},child:[]}]})(h)}function kN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 256h-80v-64c0-35.3 28.7-64 64-64h8c13.3 0 24-10.7 24-24V56c0-13.3-10.7-24-24-24h-8c-88.4 0-160 71.6-160 160v240c0 26.5 21.5 48 48 48h128c26.5 0 48-21.5 48-48V304c0-26.5-21.5-48-48-48zm-288 0H96v-64c0-35.3 28.7-64 64-64h8c13.3 0 24-10.7 24-24V56c0-13.3-10.7-24-24-24h-8C71.6 32 0 103.6 0 192v240c0 26.5 21.5 48 48 48h128c26.5 0 48-21.5 48-48V304c0-26.5-21.5-48-48-48z"},child:[]}]})(h)}function Dy(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M500.33 0h-47.41a12 12 0 0 0-12 12.57l4 82.76A247.42 247.42 0 0 0 256 8C119.34 8 7.9 119.53 8 256.19 8.1 393.07 119.1 504 256 504a247.1 247.1 0 0 0 166.18-63.91 12 12 0 0 0 .48-17.43l-34-34a12 12 0 0 0-16.38-.55A176 176 0 1 1 402.1 157.8l-101.53-4.87a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12h200.33a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12z"},child:[]}]})(h)}function F4(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M8.309 189.836L184.313 37.851C199.719 24.546 224 35.347 224 56.015v80.053c160.629 1.839 288 34.032 288 186.258 0 61.441-39.581 122.309-83.333 154.132-13.653 9.931-33.111-2.533-28.077-18.631 45.344-145.012-21.507-183.51-176.59-185.742V360c0 20.7-24.3 31.453-39.687 18.164l-176.004-152c-11.071-9.562-11.086-26.753 0-36.328z"},child:[]}]})(h)}function BN(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"},child:[]}]})(h)}function FN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505.12019,19.09375c-1.18945-5.53125-6.65819-11-12.207-12.1875C460.716,0,435.507,0,410.40747,0,307.17523,0,245.26909,55.20312,199.05238,128H94.83772c-16.34763.01562-35.55658,11.875-42.88664,26.48438L2.51562,253.29688A28.4,28.4,0,0,0,0,264a24.00867,24.00867,0,0,0,24.00582,24H127.81618l-22.47457,22.46875c-11.36521,11.36133-12.99607,32.25781,0,45.25L156.24582,406.625c11.15623,11.1875,32.15619,13.15625,45.27726,0l22.47457-22.46875V488a24.00867,24.00867,0,0,0,24.00581,24,28.55934,28.55934,0,0,0,10.707-2.51562l98.72834-49.39063c14.62888-7.29687,26.50776-26.5,26.50776-42.85937V312.79688c72.59753-46.3125,128.03493-108.40626,128.03493-211.09376C512.07526,76.5,512.07526,51.29688,505.12019,19.09375ZM384.04033,168A40,40,0,1,1,424.05,128,40.02322,40.02322,0,0,1,384.04033,168Z"},child:[]}]})(h)}function r0(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M416 320h-96c-17.6 0-32-14.4-32-32s14.4-32 32-32h96s96-107 96-160-43-96-96-96-96 43-96 96c0 25.5 22.2 63.4 45.3 96H320c-52.9 0-96 43.1-96 96s43.1 96 96 96h96c17.6 0 32 14.4 32 32s-14.4 32-32 32H185.5c-16 24.8-33.8 47.7-47.3 64H416c52.9 0 96-43.1 96-96s-43.1-96-96-96zm0-256c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zM96 256c-53 0-96 43-96 96s96 160 96 160 96-107 96-160-43-96-96-96zm0 128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"},child:[]}]})(h)}function UN(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M635.7 167.2L556.1 31.7c-8.8-15-28.3-20.1-43.5-11.5l-69 39.1L503.3 161c2.2 3.8.9 8.5-2.9 10.7l-13.8 7.8c-3.8 2.2-8.7.9-10.9-2.9L416 75l-55.2 31.3 27.9 47.4c2.2 3.8.9 8.5-2.9 10.7l-13.8 7.8c-3.8 2.2-8.7.9-10.9-2.9L333.2 122 278 153.3 337.8 255c2.2 3.7.9 8.5-2.9 10.7l-13.8 7.8c-3.8 2.2-8.7.9-10.9-2.9l-59.7-101.7-55.2 31.3 27.9 47.4c2.2 3.8.9 8.5-2.9 10.7l-13.8 7.8c-3.8 2.2-8.7.9-10.9-2.9l-27.9-47.5-55.2 31.3 59.7 101.7c2.2 3.7.9 8.5-2.9 10.7l-13.8 7.8c-3.8 2.2-8.7.9-10.9-2.9L84.9 262.9l-69 39.1C.7 310.7-4.6 329.8 4.2 344.8l79.6 135.6c8.8 15 28.3 20.1 43.5 11.5L624.1 210c15.2-8.6 20.4-27.8 11.6-42.8z"},child:[]}]})(h)}function VN(h){return Gt({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M308 96c6.627 0 12-5.373 12-12V44c0-6.627-5.373-12-12-12H12C5.373 32 0 37.373 0 44v44.748c0 6.627 5.373 12 12 12h85.28c27.308 0 48.261 9.958 60.97 27.252H12c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h158.757c-6.217 36.086-32.961 58.632-74.757 58.632H12c-6.627 0-12 5.373-12 12v53.012c0 3.349 1.4 6.546 3.861 8.818l165.052 152.356a12.001 12.001 0 0 0 8.139 3.182h82.562c10.924 0 16.166-13.408 8.139-20.818L116.871 319.906c76.499-2.34 131.144-53.395 138.318-127.906H308c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-58.69c-3.486-11.541-8.28-22.246-14.252-32H308z"},child:[]}]})(h)}function HN(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M0 224v272c0 8.84 7.16 16 16 16h80V192H32c-17.67 0-32 14.33-32 32zm360-48h-24v-40c0-4.42-3.58-8-8-8h-16c-4.42 0-8 3.58-8 8v64c0 4.42 3.58 8 8 8h48c4.42 0 8-3.58 8-8v-16c0-4.42-3.58-8-8-8zm137.75-63.96l-160-106.67a32.02 32.02 0 0 0-35.5 0l-160 106.67A32.002 32.002 0 0 0 128 138.66V512h128V368c0-8.84 7.16-16 16-16h96c8.84 0 16 7.16 16 16v144h128V138.67c0-10.7-5.35-20.7-14.25-26.63zM320 256c-44.18 0-80-35.82-80-80s35.82-80 80-80 80 35.82 80 80-35.82 80-80 80zm288-64h-64v320h80c8.84 0 16-7.16 16-16V224c0-17.67-14.33-32-32-32z"},child:[]}]})(h)}function qN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M304 192v32c0 6.6-5.4 12-12 12H124c-6.6 0-12-5.4-12-12v-32c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm201 284.7L476.7 505c-9.4 9.4-24.6 9.4-33.9 0L343 405.3c-4.5-4.5-7-10.6-7-17V372c-35.3 27.6-79.7 44-128 44C93.1 416 0 322.9 0 208S93.1 0 208 0s208 93.1 208 208c0 48.3-16.4 92.7-44 128h16.3c6.4 0 12.5 2.5 17 7l99.7 99.7c9.3 9.4 9.3 24.6 0 34zM344 208c0-75.2-60.8-136-136-136S72 132.8 72 208s60.8 136 136 136 136-60.8 136-136z"},child:[]}]})(h)}function GN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M304 192v32c0 6.6-5.4 12-12 12h-56v56c0 6.6-5.4 12-12 12h-32c-6.6 0-12-5.4-12-12v-56h-56c-6.6 0-12-5.4-12-12v-32c0-6.6 5.4-12 12-12h56v-56c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v56h56c6.6 0 12 5.4 12 12zm201 284.7L476.7 505c-9.4 9.4-24.6 9.4-33.9 0L343 405.3c-4.5-4.5-7-10.6-7-17V372c-35.3 27.6-79.7 44-128 44C93.1 416 0 322.9 0 208S93.1 0 208 0s208 93.1 208 208c0 48.3-16.4 92.7-44 128h16.3c6.4 0 12.5 2.5 17 7l99.7 99.7c9.3 9.4 9.3 24.6 0 34zM344 208c0-75.2-60.8-136-136-136S72 132.8 72 208s60.8 136 136 136 136-60.8 136-136z"},child:[]}]})(h)}function Rm(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"},child:[]}]})(h)}function EI(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z"},child:[]}]})(h)}function $N(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"},child:[]}]})(h)}function ZN(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528.12 301.319l47.273-208C578.806 78.301 567.391 64 551.99 64H159.208l-9.166-44.81C147.758 8.021 137.93 0 126.529 0H24C10.745 0 0 10.745 0 24v16c0 13.255 10.745 24 24 24h69.883l70.248 343.435C147.325 417.1 136 435.222 136 456c0 30.928 25.072 56 56 56s56-25.072 56-56c0-15.674-6.447-29.835-16.824-40h209.647C430.447 426.165 424 440.326 424 456c0 30.928 25.072 56 56 56s56-25.072 56-56c0-22.172-12.888-41.332-31.579-50.405l5.517-24.276c3.413-15.018-8.002-29.319-23.403-29.319H218.117l-6.545-32h293.145c11.206 0 20.92-7.754 23.403-18.681z"},child:[]}]})(h)}function c0(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"},child:[]}]})(h)}function WN(h){return Gt({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M41 288h238c21.4 0 32.1 25.9 17 41L177 448c-9.4 9.4-24.6 9.4-33.9 0L24 329c-15.1-15.1-4.4-41 17-41z"},child:[]}]})(h)}function XN(h){return Gt({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M279 224H41c-21.4 0-32.1-25.9-17-41L143 64c9.4-9.4 24.6-9.4 33.9 0l119 119c15.2 15.1 4.5 41-16.9 41z"},child:[]}]})(h)}function YN(h){return Gt({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M41 288h238c21.4 0 32.1 25.9 17 41L177 448c-9.4 9.4-24.6 9.4-33.9 0L24 329c-15.1-15.1-4.4-41 17-41zm255-105L177 64c-9.4-9.4-24.6-9.4-33.9 0L24 183c-15.1 15.1-4.4 41 17 41h238c21.4 0 32.1-25.9 17-41z"},child:[]}]})(h)}function KN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"},child:[]}]})(h)}function JN(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"},child:[]}]})(h)}function QN(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 416h-16c-26.04 0-45.8-8.42-56.09-17.9-8.9-8.21-19.66-14.1-31.77-14.1h-16.3c-12.11 0-22.87 5.89-31.77 14.1C461.8 407.58 442.04 416 416 416s-45.8-8.42-56.09-17.9c-8.9-8.21-19.66-14.1-31.77-14.1h-16.3c-12.11 0-22.87 5.89-31.77 14.1C269.8 407.58 250.04 416 224 416s-45.8-8.42-56.09-17.9c-8.9-8.21-19.66-14.1-31.77-14.1h-16.3c-12.11 0-22.87 5.89-31.77 14.1C77.8 407.58 58.04 416 32 416H16c-8.84 0-16 7.16-16 16v32c0 8.84 7.16 16 16 16h16c38.62 0 72.72-12.19 96-31.84 23.28 19.66 57.38 31.84 96 31.84s72.72-12.19 96-31.84c23.28 19.66 57.38 31.84 96 31.84s72.72-12.19 96-31.84c23.28 19.66 57.38 31.84 96 31.84h16c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zm-400-32v-96h192v96c19.12 0 30.86-6.16 34.39-9.42 9.17-8.46 19.2-14.34 29.61-18.07V128c0-17.64 14.36-32 32-32s32 14.36 32 32v16c0 8.84 7.16 16 16 16h32c8.84 0 16-7.16 16-16v-16c0-52.94-43.06-96-96-96s-96 43.06-96 96v96H224v-96c0-17.64 14.36-32 32-32s32 14.36 32 32v16c0 8.84 7.16 16 16 16h32c8.84 0 16-7.16 16-16v-16c0-52.94-43.06-96-96-96s-96 43.06-96 96v228.5c10.41 3.73 20.44 9.62 29.61 18.07 3.53 3.27 15.27 9.43 34.39 9.43z"},child:[]}]})(h)}function ek(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"},child:[]}]})(h)}function tk(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM224 416H64v-96h160v96zm0-160H64v-96h160v96zm224 160H288v-96h160v96zm0-160H288v-96h160v96z"},child:[]}]})(h)}function ik(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 0H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zM224 480c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"},child:[]}]})(h)}function rk(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M0 56v240c0 13.255 10.745 24 24 24h80c13.255 0 24-10.745 24-24V56c0-13.255-10.745-24-24-24H24C10.745 32 0 42.745 0 56zm40 200c0-13.255 10.745-24 24-24s24 10.745 24 24-10.745 24-24 24-24-10.745-24-24zm272 256c-20.183 0-29.485-39.293-33.931-57.795-5.206-21.666-10.589-44.07-25.393-58.902-32.469-32.524-49.503-73.967-89.117-113.111a11.98 11.98 0 0 1-3.558-8.521V59.901c0-6.541 5.243-11.878 11.783-11.998 15.831-.29 36.694-9.079 52.651-16.178C256.189 17.598 295.709.017 343.995 0h2.844c42.777 0 93.363.413 113.774 29.737 8.392 12.057 10.446 27.034 6.148 44.632 16.312 17.053 25.063 48.863 16.382 74.757 17.544 23.432 19.143 56.132 9.308 79.469l.11.11c11.893 11.949 19.523 31.259 19.439 49.197-.156 30.352-26.157 58.098-59.553 58.098H350.723C358.03 364.34 384 388.132 384 430.548 384 504 336 512 312 512z"},child:[]}]})(h)}function nk(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M104 224H24c-13.255 0-24 10.745-24 24v240c0 13.255 10.745 24 24 24h80c13.255 0 24-10.745 24-24V248c0-13.255-10.745-24-24-24zM64 472c-13.255 0-24-10.745-24-24s10.745-24 24-24 24 10.745 24 24-10.745 24-24 24zM384 81.452c0 42.416-25.97 66.208-33.277 94.548h101.723c33.397 0 59.397 27.746 59.553 58.098.084 17.938-7.546 37.249-19.439 49.197l-.11.11c9.836 23.337 8.237 56.037-9.308 79.469 8.681 25.895-.069 57.704-16.382 74.757 4.298 17.598 2.244 32.575-6.148 44.632C440.202 511.587 389.616 512 346.839 512l-2.845-.001c-48.287-.017-87.806-17.598-119.56-31.725-15.957-7.099-36.821-15.887-52.651-16.178-6.54-.12-11.783-5.457-11.783-11.998v-213.77c0-3.2 1.282-6.271 3.558-8.521 39.614-39.144 56.648-80.587 89.117-113.111 14.804-14.832 20.188-37.236 25.393-58.902C282.515 39.293 291.817 0 312 0c24 0 72 8 72 81.452z"},child:[]}]})(h)}function sk(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M298.028 214.267L285.793 96H328c13.255 0 24-10.745 24-24V24c0-13.255-10.745-24-24-24H56C42.745 0 32 10.745 32 24v48c0 13.255 10.745 24 24 24h42.207L85.972 214.267C37.465 236.82 0 277.261 0 328c0 13.255 10.745 24 24 24h136v104.007c0 1.242.289 2.467.845 3.578l24 48c2.941 5.882 11.364 5.893 14.311 0l24-48a8.008 8.008 0 0 0 .845-3.578V352h136c13.255 0 24-10.745 24-24-.001-51.183-37.983-91.42-85.973-113.733z"},child:[]}]})(h)}function Gy(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"},child:[]}]})(h)}function _o(h){return Gt({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(h)}function pS(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M501.1 395.7L384 278.6c-23.1-23.1-57.6-27.6-85.4-13.9L192 158.1V96L64 0 0 64l96 128h62.1l106.6 106.6c-13.6 27.8-9.2 62.3 13.9 85.4l117.1 117.1c14.6 14.6 38.2 14.6 52.7 0l52.7-52.7c14.5-14.6 14.5-38.2 0-52.7zM331.7 225c28.3 0 54.9 11 74.9 31l19.4 19.4c15.8-6.9 30.8-16.5 43.8-29.5 37.1-37.1 49.7-89.3 37.9-136.7-2.2-9-13.5-12.1-20.1-5.5l-74.4 74.4-67.9-11.3L334 98.9l74.4-74.4c6.6-6.6 3.4-17.9-5.7-20.2-47.4-11.7-99.6.9-136.6 37.9-28.5 28.5-41.9 66.1-41.2 103.6l82.1 82.1c8.1-1.9 16.5-2.9 24.7-2.9zm-103.9 82l-56.7-56.7L18.7 402.8c-25 25-25 65.5 0 90.5s65.5 25 90.5 0l123.6-123.6c-7.6-19.9-9.9-41.6-5-62.7zM64 472c-13.2 0-24-10.8-24-24 0-13.3 10.7-24 24-24s24 10.7 24 24c0 13.2-10.7 24-24 24z"},child:[]}]})(h)}function su(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"},child:[]}]})(h)}function ak(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M378.31 378.49L298.42 288h30.63c9.01 0 16.98-5 20.78-13.06 3.8-8.04 2.55-17.26-3.28-24.05L268.42 160h28.89c9.1 0 17.3-5.35 20.86-13.61 3.52-8.13 1.86-17.59-4.24-24.08L203.66 4.83c-6.03-6.45-17.28-6.45-23.32 0L70.06 122.31c-6.1 6.49-7.75 15.95-4.24 24.08C69.38 154.65 77.59 160 86.69 160h28.89l-78.14 90.91c-5.81 6.78-7.06 15.99-3.27 24.04C37.97 283 45.93 288 54.95 288h30.63L5.69 378.49c-6 6.79-7.36 16.09-3.56 24.26 3.75 8.05 12 13.25 21.01 13.25H160v24.45l-30.29 48.4c-5.32 10.64 2.42 23.16 14.31 23.16h95.96c11.89 0 19.63-12.52 14.31-23.16L224 440.45V416h136.86c9.01 0 17.26-5.2 21.01-13.25 3.8-8.17 2.44-17.47-3.56-24.26z"},child:[]}]})(h)}function ok(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M621.3 237.3l-58.5-58.5c-12-12-28.3-18.7-45.3-18.7H480V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3 0 64v336c0 44.2 35.8 80 80 80 26.3 0 49.4-12.9 64-32.4 14.6 19.6 37.7 32.4 64 32.4 44.2 0 80-35.8 80-80 0-5.5-.6-10.8-1.6-16h163.2c-1.1 5.2-1.6 10.5-1.6 16 0 44.2 35.8 80 80 80s80-35.8 80-80c0-5.5-.6-10.8-1.6-16H624c8.8 0 16-7.2 16-16v-85.5c0-17-6.7-33.2-18.7-45.2zM80 432c-17.6 0-32-14.4-32-32s14.4-32 32-32 32 14.4 32 32-14.4 32-32 32zm128 0c-17.6 0-32-14.4-32-32s14.4-32 32-32 32 14.4 32 32-14.4 32-32 32zm272-224h37.5c4.3 0 8.3 1.7 11.3 4.7l43.3 43.3H480v-48zm48 224c-17.6 0-32-14.4-32-32s14.4-32 32-32 32 14.4 32 32-14.4 32-32 32z"},child:[]}]})(h)}function AI(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M212.333 224.333H12c-6.627 0-12-5.373-12-12V12C0 5.373 5.373 0 12 0h48c6.627 0 12 5.373 12 12v78.112C117.773 39.279 184.26 7.47 258.175 8.007c136.906.994 246.448 111.623 246.157 248.532C504.041 393.258 393.12 504 256.333 504c-64.089 0-122.496-24.313-166.51-64.215-5.099-4.622-5.334-12.554-.467-17.42l33.967-33.967c4.474-4.474 11.662-4.717 16.401-.525C170.76 415.336 211.58 432 256.333 432c97.268 0 176-78.716 176-176 0-97.267-78.716-176-176-176-58.496 0-110.28 28.476-142.274 72.333h98.274c6.627 0 12 5.373 12 12v48c0 6.627-5.373 12-12 12z"},child:[]}]})(h)}function lk(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 256H152V152.9c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v16c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-16C376 68 307.5-.3 223.5 0 139.5.3 72 69.5 72 153.5V256H48c-26.5 0-48 21.5-48 48v160c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V304c0-26.5-21.5-48-48-48zM264 408c0 22.1-17.9 40-40 40s-40-17.9-40-40v-48c0-22.1 17.9-40 40-40s40 17.9 40 40v48z"},child:[]}]})(h)}function ck(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M296 384h-80c-13.3 0-24-10.7-24-24V192h-87.7c-17.8 0-26.7-21.5-14.1-34.1L242.3 5.7c7.5-7.5 19.8-7.5 27.3 0l152.2 152.2c12.6 12.6 3.7 34.1-14.1 34.1H320v168c0 13.3-10.7 24-24 24zm216-8v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h136v8c0 30.9 25.1 56 56 56h80c30.9 0 56-25.1 56-56v-8h136c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"},child:[]}]})(h)}function y2(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4zm323-128.4l-27.8-28.1c-4.6-4.7-12.1-4.7-16.8-.1l-104.8 104-45.5-45.8c-4.6-4.7-12.1-4.7-16.8-.1l-28.1 27.9c-4.7 4.6-4.7 12.1-.1 16.8l81.7 82.3c4.6 4.7 12.1 4.7 16.8.1l141.3-140.2c4.6-4.7 4.7-12.2.1-16.8z"},child:[]}]})(h)}function uk(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M192 256c61.9 0 112-50.1 112-112S253.9 32 192 32 80 82.1 80 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C51.6 288 0 339.6 0 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zM480 256c53 0 96-43 96-96s-43-96-96-96-96 43-96 96 43 96 96 96zm48 32h-3.8c-13.9 4.8-28.6 8-44.2 8s-30.3-3.2-44.2-8H432c-20.4 0-39.2 5.9-55.7 15.4 24.4 26.3 39.7 61.2 39.7 99.8v38.4c0 2.2-.5 4.3-.6 6.4H592c26.5 0 48-21.5 48-48 0-61.9-50.1-112-112-112z"},child:[]}]})(h)}function U4(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M224 256A128 128 0 1 0 96 128a128 128 0 0 0 128 128zm96 64a63.08 63.08 0 0 1 8.1-30.5c-4.8-.5-9.5-1.5-14.5-1.5h-16.7a174.08 174.08 0 0 1-145.8 0h-16.7A134.43 134.43 0 0 0 0 422.4V464a48 48 0 0 0 48 48h280.9a63.54 63.54 0 0 1-8.9-32zm288-32h-32v-80a80 80 0 0 0-160 0v80h-32a32 32 0 0 0-32 32v160a32 32 0 0 0 32 32h224a32 32 0 0 0 32-32V320a32 32 0 0 0-32-32zM496 432a32 32 0 1 1 32-32 32 32 0 0 1-32 32zm32-144h-64v-80a32 32 0 0 1 64 0z"},child:[]}]})(h)}function K_(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M622.3 271.1l-115.2-45c-4.1-1.6-12.6-3.7-22.2 0l-115.2 45c-10.7 4.2-17.7 14-17.7 24.9 0 111.6 68.7 188.8 132.9 213.9 9.6 3.7 18 1.6 22.2 0C558.4 489.9 640 420.5 640 296c0-10.9-7-20.7-17.7-24.9zM496 462.4V273.3l95.5 37.3c-5.6 87.1-60.9 135.4-95.5 151.8zM224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm96 40c0-2.5.8-4.8 1.1-7.2-2.5-.1-4.9-.8-7.5-.8h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c6.8 0 13.3-1.5 19.2-4-54-42.9-99.2-116.7-99.2-212z"},child:[]}]})(h)}function zl(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(h)}function Py(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"},child:[]}]})(h)}function hk(h){return Gt({attr:{viewBox:"0 0 416 512"},child:[{tag:"path",attr:{d:"M207.9 15.2c.8 4.7 16.1 94.5 16.1 128.8 0 52.3-27.8 89.6-68.9 104.6L168 486.7c.7 13.7-10.2 25.3-24 25.3H80c-13.7 0-24.7-11.5-24-25.3l12.9-238.1C27.7 233.6 0 196.2 0 144 0 109.6 15.3 19.9 16.1 15.2 19.3-5.1 61.4-5.4 64 16.3v141.2c1.3 3.4 15.1 3.2 16 0 1.4-25.3 7.9-139.2 8-141.8 3.3-20.8 44.7-20.8 47.9 0 .2 2.7 6.6 116.5 8 141.8.9 3.2 14.8 3.4 16 0V16.3c2.6-21.6 44.8-21.4 48-1.1zm119.2 285.7l-15 185.1c-1.2 14 9.9 26 23.9 26h56c13.3 0 24-10.7 24-24V24c0-13.2-10.7-24-24-24-82.5 0-221.4 178.5-64.9 300.9z"},child:[]}]})(h)}function CI(h){return Gt({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M208 96c26.5 0 48-21.5 48-48S234.5 0 208 0s-48 21.5-48 48 21.5 48 48 48zm94.5 149.1l-23.3-11.8-9.7-29.4c-14.7-44.6-55.7-75.8-102.2-75.9-36-.1-55.9 10.1-93.3 25.2-21.6 8.7-39.3 25.2-49.7 46.2L17.6 213c-7.8 15.8-1.5 35 14.2 42.9 15.6 7.9 34.6 1.5 42.5-14.3L81 228c3.5-7 9.3-12.5 16.5-15.4l26.8-10.8-15.2 60.7c-5.2 20.8.4 42.9 14.9 58.8l59.9 65.4c7.2 7.9 12.3 17.4 14.9 27.7l18.3 73.3c4.3 17.1 21.7 27.6 38.8 23.3 17.1-4.3 27.6-21.7 23.3-38.8l-22.2-89c-2.6-10.3-7.7-19.9-14.9-27.7l-45.5-49.7 17.2-68.7 5.5 16.5c5.3 16.1 16.7 29.4 31.7 37l23.3 11.8c15.6 7.9 34.6 1.5 42.5-14.3 7.7-15.7 1.4-35.1-14.3-43zM73.6 385.8c-3.2 8.1-8 15.4-14.2 21.5l-50 50.1c-12.5 12.5-12.5 32.8 0 45.3s32.7 12.5 45.2 0l59.4-59.4c6.1-6.1 10.9-13.4 14.2-21.5l13.5-33.8c-55.3-60.3-38.7-41.8-47.4-53.7l-20.7 51.5z"},child:[]}]})(h)}function dk(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"},child:[]}]})(h)}function fk(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M507.73 109.1c-2.24-9.03-13.54-12.09-20.12-5.51l-74.36 74.36-67.88-11.31-11.31-67.88 74.36-74.36c6.62-6.62 3.43-17.9-5.66-20.16-47.38-11.74-99.55.91-136.58 37.93-39.64 39.64-50.55 97.1-34.05 147.2L18.74 402.76c-24.99 24.99-24.99 65.51 0 90.5 24.99 24.99 65.51 24.99 90.5 0l213.21-213.21c50.12 16.71 107.47 5.68 147.37-34.22 37.07-37.07 49.7-89.32 37.91-136.73zM64 472c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24z"},child:[]}]})(h)}function pk(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M336 0H48C21.49 0 0 21.49 0 48v464l192-112 192 112V48c0-26.51-21.49-48-48-48zm0 428.43l-144-84-144 84V54a6 6 0 0 1 6-6h276c3.314 0 6 2.683 6 5.996V428.43z"},child:[]}]})(h)}function mk(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"},child:[]}]})(h)}function gk(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528.1 171.5L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3 23.7-138.4-100.6-98 139-20.2 62.2-126 62.2 126 139 20.2-100.6 98z"},child:[]}]})(h)}const p1=({user:h,size:g="w-24 h-24",textSize:b="text-2xl",className:S="",showBorder:I=!0})=>{const N=oe=>{if(!oe)return"U";const de=oe.trim().split(" ");return de.length===1?de[0].charAt(0).toUpperCase():de.length>=2?(de[0].charAt(0)+de[1].charAt(0)).toUpperCase():oe.charAt(0).toUpperCase()},V=oe=>{if(!oe)return"bg-gradient-to-br from-gray-500 to-gray-600";const de=["bg-gradient-to-br from-red-500 to-pink-600","bg-gradient-to-br from-blue-500 to-purple-600","bg-gradient-to-br from-green-500 to-teal-600","bg-gradient-to-br from-yellow-500 to-orange-600","bg-gradient-to-br from-purple-500 to-indigo-600","bg-gradient-to-br from-pink-500 to-rose-600","bg-gradient-to-br from-indigo-500 to-blue-600","bg-gradient-to-br from-teal-500 to-green-600","bg-gradient-to-br from-orange-500 to-red-600","bg-gradient-to-br from-cyan-500 to-blue-600","bg-gradient-to-br from-emerald-500 to-teal-600","bg-gradient-to-br from-violet-500 to-purple-600","bg-gradient-to-br from-fuchsia-500 to-pink-600","bg-gradient-to-br from-sky-500 to-blue-600","bg-gradient-to-br from-lime-500 to-green-600"];let ze=0;for(let le=0;le<oe.length;le++)ze=oe.charCodeAt(le)+((ze<<5)-ze);return de[Math.abs(ze)%de.length]},s=I&&!S.includes("border-")?"border-4 border-blue-200":"",q=`${g} rounded-full ${s} flex items-center justify-center text-white font-bold ${S}`;if(h!=null&&h.avatar)return _.jsx("img",{alt:"avatar",src:h.avatar,className:`${q} object-cover shadow-lg aspect-square`,style:{aspectRatio:"1/1"},onError:oe=>{oe.target.onerror=null,oe.target.src=""}});const Z=N(h==null?void 0:h.username),Q=V(h==null?void 0:h.username);return _.jsx("div",{className:`${q} ${Q} shadow-lg aspect-square`,children:_.jsx("span",{className:`${b} font-semibold`,children:Z})})};function mS(h){var g,b,S="";if(typeof h=="string"||typeof h=="number")S+=h;else if(typeof h=="object")if(Array.isArray(h)){var I=h.length;for(g=0;g<I;g++)h[g]&&(b=mS(h[g]))&&(S&&(S+=" "),S+=b)}else for(b in h)h[b]&&(S&&(S+=" "),S+=b);return S}function Mm(){for(var h,g,b=0,S="",I=arguments.length;b<I;b++)(h=arguments[b])&&(g=mS(h))&&(S&&(S+=" "),S+=g);return S}function RI(h){if(typeof document>"u")return;let g=document.head||document.getElementsByTagName("head")[0],b=document.createElement("style");b.type="text/css",g.firstChild?g.insertBefore(b,g.firstChild):g.appendChild(b),b.styleSheet?b.styleSheet.cssText=h:b.appendChild(document.createTextNode(h))}RI(`:root{--toastify-color-light: #fff;--toastify-color-dark: #121212;--toastify-color-info: #3498db;--toastify-color-success: #07bc0c;--toastify-color-warning: #f1c40f;--toastify-color-error: hsl(6, 78%, 57%);--toastify-color-transparent: rgba(255, 255, 255, .7);--toastify-icon-color-info: var(--toastify-color-info);--toastify-icon-color-success: var(--toastify-color-success);--toastify-icon-color-warning: var(--toastify-color-warning);--toastify-icon-color-error: var(--toastify-color-error);--toastify-container-width: fit-content;--toastify-toast-width: 320px;--toastify-toast-offset: 16px;--toastify-toast-top: max(var(--toastify-toast-offset), env(safe-area-inset-top));--toastify-toast-right: max(var(--toastify-toast-offset), env(safe-area-inset-right));--toastify-toast-left: max(var(--toastify-toast-offset), env(safe-area-inset-left));--toastify-toast-bottom: max(var(--toastify-toast-offset), env(safe-area-inset-bottom));--toastify-toast-background: #fff;--toastify-toast-padding: 14px;--toastify-toast-min-height: 64px;--toastify-toast-max-height: 800px;--toastify-toast-bd-radius: 6px;--toastify-toast-shadow: 0px 4px 12px rgba(0, 0, 0, .1);--toastify-font-family: sans-serif;--toastify-z-index: 9999;--toastify-text-color-light: #757575;--toastify-text-color-dark: #fff;--toastify-text-color-info: #fff;--toastify-text-color-success: #fff;--toastify-text-color-warning: #fff;--toastify-text-color-error: #fff;--toastify-spinner-color: #616161;--toastify-spinner-color-empty-area: #e0e0e0;--toastify-color-progress-light: linear-gradient(to right, #4cd964, #5ac8fa, #007aff, #34aadc, #5856d6, #ff2d55);--toastify-color-progress-dark: #bb86fc;--toastify-color-progress-info: var(--toastify-color-info);--toastify-color-progress-success: var(--toastify-color-success);--toastify-color-progress-warning: var(--toastify-color-warning);--toastify-color-progress-error: var(--toastify-color-error);--toastify-color-progress-bgo: .2}.Toastify__toast-container{z-index:var(--toastify-z-index);-webkit-transform:translate3d(0,0,var(--toastify-z-index));position:fixed;width:var(--toastify-container-width);box-sizing:border-box;color:#fff;display:flex;flex-direction:column}.Toastify__toast-container--top-left{top:var(--toastify-toast-top);left:var(--toastify-toast-left)}.Toastify__toast-container--top-center{top:var(--toastify-toast-top);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--top-right{top:var(--toastify-toast-top);right:var(--toastify-toast-right);align-items:end}.Toastify__toast-container--bottom-left{bottom:var(--toastify-toast-bottom);left:var(--toastify-toast-left)}.Toastify__toast-container--bottom-center{bottom:var(--toastify-toast-bottom);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--bottom-right{bottom:var(--toastify-toast-bottom);right:var(--toastify-toast-right);align-items:end}.Toastify__toast{--y: 0;position:relative;touch-action:none;width:var(--toastify-toast-width);min-height:var(--toastify-toast-min-height);box-sizing:border-box;margin-bottom:1rem;padding:var(--toastify-toast-padding);border-radius:var(--toastify-toast-bd-radius);box-shadow:var(--toastify-toast-shadow);max-height:var(--toastify-toast-max-height);font-family:var(--toastify-font-family);z-index:0;display:flex;flex:1 auto;align-items:center;word-break:break-word}@media only screen and (max-width: 480px){.Toastify__toast-container{width:100vw;left:env(safe-area-inset-left);margin:0}.Toastify__toast-container--top-left,.Toastify__toast-container--top-center,.Toastify__toast-container--top-right{top:env(safe-area-inset-top);transform:translate(0)}.Toastify__toast-container--bottom-left,.Toastify__toast-container--bottom-center,.Toastify__toast-container--bottom-right{bottom:env(safe-area-inset-bottom);transform:translate(0)}.Toastify__toast-container--rtl{right:env(safe-area-inset-right);left:initial}.Toastify__toast{--toastify-toast-width: 100%;margin-bottom:0;border-radius:0}}.Toastify__toast-container[data-stacked=true]{width:var(--toastify-toast-width)}.Toastify__toast--stacked{position:absolute;width:100%;transform:translate3d(0,var(--y),0) scale(var(--s));transition:transform .3s}.Toastify__toast--stacked[data-collapsed] .Toastify__toast-body,.Toastify__toast--stacked[data-collapsed] .Toastify__close-button{transition:opacity .1s}.Toastify__toast--stacked[data-collapsed=false]{overflow:visible}.Toastify__toast--stacked[data-collapsed=true]:not(:last-child)>*{opacity:0}.Toastify__toast--stacked:after{content:"";position:absolute;left:0;right:0;height:calc(var(--g) * 1px);bottom:100%}.Toastify__toast--stacked[data-pos=top]{top:0}.Toastify__toast--stacked[data-pos=bot]{bottom:0}.Toastify__toast--stacked[data-pos=bot].Toastify__toast--stacked:before{transform-origin:top}.Toastify__toast--stacked[data-pos=top].Toastify__toast--stacked:before{transform-origin:bottom}.Toastify__toast--stacked:before{content:"";position:absolute;left:0;right:0;bottom:0;height:100%;transform:scaleY(3);z-index:-1}.Toastify__toast--rtl{direction:rtl}.Toastify__toast--close-on-click{cursor:pointer}.Toastify__toast-icon{margin-inline-end:10px;width:22px;flex-shrink:0;display:flex}.Toastify--animate{animation-fill-mode:both;animation-duration:.5s}.Toastify--animate-icon{animation-fill-mode:both;animation-duration:.3s}.Toastify__toast-theme--dark{background:var(--toastify-color-dark);color:var(--toastify-text-color-dark)}.Toastify__toast-theme--light,.Toastify__toast-theme--colored.Toastify__toast--default{background:var(--toastify-color-light);color:var(--toastify-text-color-light)}.Toastify__toast-theme--colored.Toastify__toast--info{color:var(--toastify-text-color-info);background:var(--toastify-color-info)}.Toastify__toast-theme--colored.Toastify__toast--success{color:var(--toastify-text-color-success);background:var(--toastify-color-success)}.Toastify__toast-theme--colored.Toastify__toast--warning{color:var(--toastify-text-color-warning);background:var(--toastify-color-warning)}.Toastify__toast-theme--colored.Toastify__toast--error{color:var(--toastify-text-color-error);background:var(--toastify-color-error)}.Toastify__progress-bar-theme--light{background:var(--toastify-color-progress-light)}.Toastify__progress-bar-theme--dark{background:var(--toastify-color-progress-dark)}.Toastify__progress-bar--info{background:var(--toastify-color-progress-info)}.Toastify__progress-bar--success{background:var(--toastify-color-progress-success)}.Toastify__progress-bar--warning{background:var(--toastify-color-progress-warning)}.Toastify__progress-bar--error{background:var(--toastify-color-progress-error)}.Toastify__progress-bar-theme--colored.Toastify__progress-bar--info,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--success,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--warning,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--error{background:var(--toastify-color-transparent)}.Toastify__close-button{color:#fff;position:absolute;top:6px;right:6px;background:transparent;outline:none;border:none;padding:0;cursor:pointer;opacity:.7;transition:.3s ease;z-index:1}.Toastify__toast--rtl .Toastify__close-button{left:6px;right:unset}.Toastify__close-button--light{color:#000;opacity:.3}.Toastify__close-button>svg{fill:currentColor;height:16px;width:14px}.Toastify__close-button:hover,.Toastify__close-button:focus{opacity:1}@keyframes Toastify__trackProgress{0%{transform:scaleX(1)}to{transform:scaleX(0)}}.Toastify__progress-bar{position:absolute;bottom:0;left:0;width:100%;height:100%;z-index:1;opacity:.7;transform-origin:left}.Toastify__progress-bar--animated{animation:Toastify__trackProgress linear 1 forwards}.Toastify__progress-bar--controlled{transition:transform .2s}.Toastify__progress-bar--rtl{right:0;left:initial;transform-origin:right;border-bottom-left-radius:initial}.Toastify__progress-bar--wrp{position:absolute;overflow:hidden;bottom:0;left:0;width:100%;height:5px;border-bottom-left-radius:var(--toastify-toast-bd-radius);border-bottom-right-radius:var(--toastify-toast-bd-radius)}.Toastify__progress-bar--wrp[data-hidden=true]{opacity:0}.Toastify__progress-bar--bg{opacity:var(--toastify-color-progress-bgo);width:100%;height:100%}.Toastify__spinner{width:20px;height:20px;box-sizing:border-box;border:2px solid;border-radius:100%;border-color:var(--toastify-spinner-color-empty-area);border-right-color:var(--toastify-spinner-color);animation:Toastify__spin .65s linear infinite}@keyframes Toastify__bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0)}60%{opacity:1;transform:translate3d(-25px,0,0)}75%{transform:translate3d(10px,0,0)}90%{transform:translate3d(-5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutRight{20%{opacity:1;transform:translate3d(-20px,var(--y),0)}to{opacity:0;transform:translate3d(2000px,var(--y),0)}}@keyframes Toastify__bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0)}60%{opacity:1;transform:translate3d(25px,0,0)}75%{transform:translate3d(-10px,0,0)}90%{transform:translate3d(5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutLeft{20%{opacity:1;transform:translate3d(20px,var(--y),0)}to{opacity:0;transform:translate3d(-2000px,var(--y),0)}}@keyframes Toastify__bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0)}60%{opacity:1;transform:translate3d(0,-20px,0)}75%{transform:translate3d(0,10px,0)}90%{transform:translate3d(0,-5px,0)}to{transform:translateZ(0)}}@keyframes Toastify__bounceOutUp{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,-2000px,0)}}@keyframes Toastify__bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0)}60%{opacity:1;transform:translate3d(0,25px,0)}75%{transform:translate3d(0,-10px,0)}90%{transform:translate3d(0,5px,0)}to{transform:none}}@keyframes Toastify__bounceOutDown{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,2000px,0)}}.Toastify__bounce-enter--top-left,.Toastify__bounce-enter--bottom-left{animation-name:Toastify__bounceInLeft}.Toastify__bounce-enter--top-right,.Toastify__bounce-enter--bottom-right{animation-name:Toastify__bounceInRight}.Toastify__bounce-enter--top-center{animation-name:Toastify__bounceInDown}.Toastify__bounce-enter--bottom-center{animation-name:Toastify__bounceInUp}.Toastify__bounce-exit--top-left,.Toastify__bounce-exit--bottom-left{animation-name:Toastify__bounceOutLeft}.Toastify__bounce-exit--top-right,.Toastify__bounce-exit--bottom-right{animation-name:Toastify__bounceOutRight}.Toastify__bounce-exit--top-center{animation-name:Toastify__bounceOutUp}.Toastify__bounce-exit--bottom-center{animation-name:Toastify__bounceOutDown}@keyframes Toastify__zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes Toastify__zoomOut{0%{opacity:1}50%{opacity:0;transform:translate3d(0,var(--y),0) scale3d(.3,.3,.3)}to{opacity:0}}.Toastify__zoom-enter{animation-name:Toastify__zoomIn}.Toastify__zoom-exit{animation-name:Toastify__zoomOut}@keyframes Toastify__flipIn{0%{transform:perspective(400px) rotateX(90deg);animation-timing-function:ease-in;opacity:0}40%{transform:perspective(400px) rotateX(-20deg);animation-timing-function:ease-in}60%{transform:perspective(400px) rotateX(10deg);opacity:1}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}@keyframes Toastify__flipOut{0%{transform:translate3d(0,var(--y),0) perspective(400px)}30%{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(-20deg);opacity:1}to{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(90deg);opacity:0}}.Toastify__flip-enter{animation-name:Toastify__flipIn}.Toastify__flip-exit{animation-name:Toastify__flipOut}@keyframes Toastify__slideInRight{0%{transform:translate3d(110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInLeft{0%{transform:translate3d(-110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInUp{0%{transform:translate3d(0,110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInDown{0%{transform:translate3d(0,-110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideOutRight{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(110%,var(--y),0)}}@keyframes Toastify__slideOutLeft{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(-110%,var(--y),0)}}@keyframes Toastify__slideOutDown{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,500px,0)}}@keyframes Toastify__slideOutUp{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,-500px,0)}}.Toastify__slide-enter--top-left,.Toastify__slide-enter--bottom-left{animation-name:Toastify__slideInLeft}.Toastify__slide-enter--top-right,.Toastify__slide-enter--bottom-right{animation-name:Toastify__slideInRight}.Toastify__slide-enter--top-center{animation-name:Toastify__slideInDown}.Toastify__slide-enter--bottom-center{animation-name:Toastify__slideInUp}.Toastify__slide-exit--top-left,.Toastify__slide-exit--bottom-left{animation-name:Toastify__slideOutLeft;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-right,.Toastify__slide-exit--bottom-right{animation-name:Toastify__slideOutRight;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-center{animation-name:Toastify__slideOutUp;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--bottom-center{animation-name:Toastify__slideOutDown;animation-timing-function:ease-in;animation-duration:.3s}@keyframes Toastify__spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
`);var p0=h=>typeof h=="number"&&!isNaN(h),Pm=h=>typeof h=="string",cf=h=>typeof h=="function",MI=h=>Pm(h)||p0(h),x2=h=>Pm(h)||cf(h)?h:null,II=(h,g)=>h===!1||p0(h)&&h>0?h:g,v2=h=>ue.isValidElement(h)||Pm(h)||cf(h)||p0(h);function zI(h,g,b=300){let{scrollHeight:S,style:I}=h;requestAnimationFrame(()=>{I.minHeight="initial",I.height=S+"px",I.transition=`all ${b}ms`,requestAnimationFrame(()=>{I.height="0",I.padding="0",I.margin="0",setTimeout(g,b)})})}function LI({enter:h,exit:g,appendPosition:b=!1,collapse:S=!0,collapseDuration:I=300}){return function({children:N,position:V,preventExitTransition:s,done:q,nodeRef:Z,isIn:Q,playToast:oe}){let de=b?`${h}--${V}`:h,ze=b?`${g}--${V}`:g,le=ue.useRef(0);return ue.useLayoutEffect(()=>{let Se=Z.current,ee=de.split(" "),_e=ye=>{ye.target===Z.current&&(oe(),Se.removeEventListener("animationend",_e),Se.removeEventListener("animationcancel",_e),le.current===0&&ye.type!=="animationcancel"&&Se.classList.remove(...ee))};Se.classList.add(...ee),Se.addEventListener("animationend",_e),Se.addEventListener("animationcancel",_e)},[]),ue.useEffect(()=>{let Se=Z.current,ee=()=>{Se.removeEventListener("animationend",ee),S?zI(Se,q,I):q()};Q||(s?ee():(le.current=1,Se.className+=` ${ze}`,Se.addEventListener("animationend",ee)))},[Q]),Wn.createElement(Wn.Fragment,null,N)}}function V4(h,g){return{content:gS(h.content,h.props),containerId:h.props.containerId,id:h.props.toastId,theme:h.props.theme,type:h.props.type,data:h.props.data||{},isLoading:h.props.isLoading,icon:h.props.icon,reason:h.removalReason,status:g}}function gS(h,g,b=!1){return ue.isValidElement(h)&&!Pm(h.type)?ue.cloneElement(h,{closeToast:g.closeToast,toastProps:g,data:g.data,isPaused:b}):cf(h)?h({closeToast:g.closeToast,toastProps:g,data:g.data,isPaused:b}):h}function DI({closeToast:h,theme:g,ariaLabel:b="close"}){return Wn.createElement("button",{className:`Toastify__close-button Toastify__close-button--${g}`,type:"button",onClick:S=>{S.stopPropagation(),h(!0)},"aria-label":b},Wn.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},Wn.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function PI({delay:h,isRunning:g,closeToast:b,type:S="default",hide:I,className:N,controlledProgress:V,progress:s,rtl:q,isIn:Z,theme:Q}){let oe=I||V&&s===0,de={animationDuration:`${h}ms`,animationPlayState:g?"running":"paused"};V&&(de.transform=`scaleX(${s})`);let ze=Mm("Toastify__progress-bar",V?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${Q}`,`Toastify__progress-bar--${S}`,{"Toastify__progress-bar--rtl":q}),le=cf(N)?N({rtl:q,type:S,defaultClassName:ze}):Mm(ze,N),Se={[V&&s>=1?"onTransitionEnd":"onAnimationEnd"]:V&&s<1?null:()=>{Z&&b()}};return Wn.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":oe},Wn.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${Q} Toastify__progress-bar--${S}`}),Wn.createElement("div",{role:"progressbar","aria-hidden":oe?"true":"false","aria-label":"notification timer",className:le,style:de,...Se}))}var OI=1,_S=()=>`${OI++}`;function jI(h,g,b){let S=1,I=0,N=[],V=[],s=g,q=new Map,Z=new Set,Q=ye=>(Z.add(ye),()=>Z.delete(ye)),oe=()=>{V=Array.from(q.values()),Z.forEach(ye=>ye())},de=({containerId:ye,toastId:xe,updateId:Le})=>{let Ae=ye?ye!==h:h!==1,Ke=q.has(xe)&&Le==null;return Ae||Ke},ze=(ye,xe)=>{q.forEach(Le=>{var Ae;(xe==null||xe===Le.props.toastId)&&((Ae=Le.toggle)==null||Ae.call(Le,ye))})},le=ye=>{var xe,Le;(Le=(xe=ye.props)==null?void 0:xe.onClose)==null||Le.call(xe,ye.removalReason),ye.isActive=!1},Se=ye=>{if(ye==null)q.forEach(le);else{let xe=q.get(ye);xe&&le(xe)}oe()},ee=()=>{I-=N.length,N=[]},_e=ye=>{var xe,Le;let{toastId:Ae,updateId:Ke}=ye.props,it=Ke==null;ye.staleId&&q.delete(ye.staleId),ye.isActive=!0,q.set(Ae,ye),oe(),b(V4(ye,it?"added":"updated")),it&&((Le=(xe=ye.props).onOpen)==null||Le.call(xe))};return{id:h,props:s,observe:Q,toggle:ze,removeToast:Se,toasts:q,clearQueue:ee,buildToast:(ye,xe)=>{if(de(xe))return;let{toastId:Le,updateId:Ae,data:Ke,staleId:it,delay:rt}=xe,lt=Ae==null;lt&&I++;let zt={...s,style:s.toastStyle,key:S++,...Object.fromEntries(Object.entries(xe).filter(([Ci,Zi])=>Zi!=null)),toastId:Le,updateId:Ae,data:Ke,isIn:!1,className:x2(xe.className||s.toastClassName),progressClassName:x2(xe.progressClassName||s.progressClassName),autoClose:xe.isLoading?!1:II(xe.autoClose,s.autoClose),closeToast(Ci){q.get(Le).removalReason=Ci,Se(Le)},deleteToast(){let Ci=q.get(Le);if(Ci!=null){if(b(V4(Ci,"removed")),q.delete(Le),I--,I<0&&(I=0),N.length>0){_e(N.shift());return}oe()}}};zt.closeButton=s.closeButton,xe.closeButton===!1||v2(xe.closeButton)?zt.closeButton=xe.closeButton:xe.closeButton===!0&&(zt.closeButton=v2(s.closeButton)?s.closeButton:!0);let xt={content:ye,props:zt,staleId:it};s.limit&&s.limit>0&&I>s.limit&&lt?N.push(xt):p0(rt)?setTimeout(()=>{_e(xt)},rt):_e(xt)},setProps(ye){s=ye},setToggle:(ye,xe)=>{let Le=q.get(ye);Le&&(Le.toggle=xe)},isToastActive:ye=>{var xe;return(xe=q.get(ye))==null?void 0:xe.isActive},getSnapshot:()=>V}}var ll=new Map,u0=[],b2=new Set,NI=h=>b2.forEach(g=>g(h)),yS=()=>ll.size>0;function kI(){u0.forEach(h=>vS(h.content,h.options)),u0=[]}var BI=(h,{containerId:g})=>{var b;return(b=ll.get(g||1))==null?void 0:b.toasts.get(h)};function xS(h,g){var b;if(g)return!!((b=ll.get(g))!=null&&b.isToastActive(h));let S=!1;return ll.forEach(I=>{I.isToastActive(h)&&(S=!0)}),S}function FI(h){if(!yS()){u0=u0.filter(g=>h!=null&&g.options.toastId!==h);return}if(h==null||MI(h))ll.forEach(g=>{g.removeToast(h)});else if(h&&("containerId"in h||"id"in h)){let g=ll.get(h.containerId);g?g.removeToast(h.id):ll.forEach(b=>{b.removeToast(h.id)})}}var UI=(h={})=>{ll.forEach(g=>{g.props.limit&&(!h.containerId||g.id===h.containerId)&&g.clearQueue()})};function vS(h,g){v2(h)&&(yS()||u0.push({content:h,options:g}),ll.forEach(b=>{b.buildToast(h,g)}))}function VI(h){var g;(g=ll.get(h.containerId||1))==null||g.setToggle(h.id,h.fn)}function bS(h,g){ll.forEach(b=>{(g==null||!(g!=null&&g.containerId)||(g==null?void 0:g.containerId)===b.id)&&b.toggle(h,g==null?void 0:g.id)})}function HI(h){let g=h.containerId||1;return{subscribe(b){let S=jI(g,h,NI);ll.set(g,S);let I=S.observe(b);return kI(),()=>{I(),ll.delete(g)}},setProps(b){var S;(S=ll.get(g))==null||S.setProps(b)},getSnapshot(){var b;return(b=ll.get(g))==null?void 0:b.getSnapshot()}}}function qI(h){return b2.add(h),()=>{b2.delete(h)}}function GI(h){return h&&(Pm(h.toastId)||p0(h.toastId))?h.toastId:_S()}function m0(h,g){return vS(h,g),g.toastId}function z1(h,g){return{...g,type:g&&g.type||h,toastId:GI(g)}}function L1(h){return(g,b)=>m0(g,z1(h,b))}function ei(h,g){return m0(h,z1("default",g))}ei.loading=(h,g)=>m0(h,z1("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...g}));function $I(h,{pending:g,error:b,success:S},I){let N;g&&(N=Pm(g)?ei.loading(g,I):ei.loading(g.render,{...I,...g}));let V={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},s=(Z,Q,oe)=>{if(Q==null){ei.dismiss(N);return}let de={type:Z,...V,...I,data:oe},ze=Pm(Q)?{render:Q}:Q;return N?ei.update(N,{...de,...ze}):ei(ze.render,{...de,...ze}),oe},q=cf(h)?h():h;return q.then(Z=>s("success",S,Z)).catch(Z=>s("error",b,Z)),q}ei.promise=$I;ei.success=L1("success");ei.info=L1("info");ei.error=L1("error");ei.warning=L1("warning");ei.warn=ei.warning;ei.dark=(h,g)=>m0(h,z1("default",{theme:"dark",...g}));function ZI(h){FI(h)}ei.dismiss=ZI;ei.clearWaitingQueue=UI;ei.isActive=xS;ei.update=(h,g={})=>{let b=BI(h,g);if(b){let{props:S,content:I}=b,N={delay:100,...S,...g,toastId:g.toastId||h,updateId:_S()};N.toastId!==h&&(N.staleId=h);let V=N.render||I;delete N.render,m0(V,N)}};ei.done=h=>{ei.update(h,{progress:1})};ei.onChange=qI;ei.play=h=>bS(!0,h);ei.pause=h=>bS(!1,h);function WI(h){var g;let{subscribe:b,getSnapshot:S,setProps:I}=ue.useRef(HI(h)).current;I(h);let N=(g=ue.useSyncExternalStore(b,S,S))==null?void 0:g.slice();function V(s){if(!N)return[];let q=new Map;return h.newestOnTop&&N.reverse(),N.forEach(Z=>{let{position:Q}=Z.props;q.has(Q)||q.set(Q,[]),q.get(Q).push(Z)}),Array.from(q,Z=>s(Z[0],Z[1]))}return{getToastToRender:V,isToastActive:xS,count:N==null?void 0:N.length}}function XI(h){let[g,b]=ue.useState(!1),[S,I]=ue.useState(!1),N=ue.useRef(null),V=ue.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:s,pauseOnHover:q,closeToast:Z,onClick:Q,closeOnClick:oe}=h;VI({id:h.toastId,containerId:h.containerId,fn:b}),ue.useEffect(()=>{if(h.pauseOnFocusLoss)return de(),()=>{ze()}},[h.pauseOnFocusLoss]);function de(){document.hasFocus()||_e(),window.addEventListener("focus",ee),window.addEventListener("blur",_e)}function ze(){window.removeEventListener("focus",ee),window.removeEventListener("blur",_e)}function le(it){if(h.draggable===!0||h.draggable===it.pointerType){ye();let rt=N.current;V.canCloseOnClick=!0,V.canDrag=!0,rt.style.transition="none",h.draggableDirection==="x"?(V.start=it.clientX,V.removalDistance=rt.offsetWidth*(h.draggablePercent/100)):(V.start=it.clientY,V.removalDistance=rt.offsetHeight*(h.draggablePercent===80?h.draggablePercent*1.5:h.draggablePercent)/100)}}function Se(it){let{top:rt,bottom:lt,left:zt,right:xt}=N.current.getBoundingClientRect();it.nativeEvent.type!=="touchend"&&h.pauseOnHover&&it.clientX>=zt&&it.clientX<=xt&&it.clientY>=rt&&it.clientY<=lt?_e():ee()}function ee(){b(!0)}function _e(){b(!1)}function ye(){V.didMove=!1,document.addEventListener("pointermove",Le),document.addEventListener("pointerup",Ae)}function xe(){document.removeEventListener("pointermove",Le),document.removeEventListener("pointerup",Ae)}function Le(it){let rt=N.current;if(V.canDrag&&rt){V.didMove=!0,g&&_e(),h.draggableDirection==="x"?V.delta=it.clientX-V.start:V.delta=it.clientY-V.start,V.start!==it.clientX&&(V.canCloseOnClick=!1);let lt=h.draggableDirection==="x"?`${V.delta}px, var(--y)`:`0, calc(${V.delta}px + var(--y))`;rt.style.transform=`translate3d(${lt},0)`,rt.style.opacity=`${1-Math.abs(V.delta/V.removalDistance)}`}}function Ae(){xe();let it=N.current;if(V.canDrag&&V.didMove&&it){if(V.canDrag=!1,Math.abs(V.delta)>V.removalDistance){I(!0),h.closeToast(!0),h.collapseAll();return}it.style.transition="transform 0.2s, opacity 0.2s",it.style.removeProperty("transform"),it.style.removeProperty("opacity")}}let Ke={onPointerDown:le,onPointerUp:Se};return s&&q&&(Ke.onMouseEnter=_e,h.stacked||(Ke.onMouseLeave=ee)),oe&&(Ke.onClick=it=>{Q&&Q(it),V.canCloseOnClick&&Z(!0)}),{playToast:ee,pauseToast:_e,isRunning:g,preventExitTransition:S,toastRef:N,eventHandlers:Ke}}var YI=typeof window<"u"?ue.useLayoutEffect:ue.useEffect,D1=({theme:h,type:g,isLoading:b,...S})=>Wn.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:h==="colored"?"currentColor":`var(--toastify-icon-color-${g})`,...S});function KI(h){return Wn.createElement(D1,{...h},Wn.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))}function JI(h){return Wn.createElement(D1,{...h},Wn.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))}function QI(h){return Wn.createElement(D1,{...h},Wn.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))}function ez(h){return Wn.createElement(D1,{...h},Wn.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))}function tz(){return Wn.createElement("div",{className:"Toastify__spinner"})}var w2={info:JI,warning:KI,success:QI,error:ez,spinner:tz},iz=h=>h in w2;function rz({theme:h,type:g,isLoading:b,icon:S}){let I=null,N={theme:h,type:g};return S===!1||(cf(S)?I=S({...N,isLoading:b}):ue.isValidElement(S)?I=ue.cloneElement(S,N):b?I=w2.spinner():iz(g)&&(I=w2[g](N))),I}var nz=h=>{let{isRunning:g,preventExitTransition:b,toastRef:S,eventHandlers:I,playToast:N}=XI(h),{closeButton:V,children:s,autoClose:q,onClick:Z,type:Q,hideProgressBar:oe,closeToast:de,transition:ze,position:le,className:Se,style:ee,progressClassName:_e,updateId:ye,role:xe,progress:Le,rtl:Ae,toastId:Ke,deleteToast:it,isIn:rt,isLoading:lt,closeOnClick:zt,theme:xt,ariaLabel:Ci}=h,Zi=Mm("Toastify__toast",`Toastify__toast-theme--${xt}`,`Toastify__toast--${Q}`,{"Toastify__toast--rtl":Ae},{"Toastify__toast--close-on-click":zt}),or=cf(Se)?Se({rtl:Ae,position:le,type:Q,defaultClassName:Zi}):Mm(Zi,Se),er=rz(h),Jt=!!Le||!q,ji={closeToast:de,type:Q,theme:xt},Fi=null;return V===!1||(cf(V)?Fi=V(ji):ue.isValidElement(V)?Fi=ue.cloneElement(V,ji):Fi=DI(ji)),Wn.createElement(ze,{isIn:rt,done:it,position:le,preventExitTransition:b,nodeRef:S,playToast:N},Wn.createElement("div",{id:Ke,tabIndex:0,onClick:Z,"data-in":rt,className:or,...I,style:ee,ref:S,...rt&&{role:xe,"aria-label":Ci}},er!=null&&Wn.createElement("div",{className:Mm("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!lt})},er),gS(s,h,!g),Fi,!h.customProgressBar&&Wn.createElement(PI,{...ye&&!Jt?{key:`p-${ye}`}:{},rtl:Ae,theme:xt,delay:q,isRunning:g,isIn:rt,closeToast:de,hide:oe,type:Q,className:_e,controlledProgress:Jt,progress:Le||0})))},sz=(h,g=!1)=>({enter:`Toastify--animate Toastify__${h}-enter`,exit:`Toastify--animate Toastify__${h}-exit`,appendPosition:g}),az=LI(sz("bounce",!0)),oz={position:"top-right",transition:az,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light","aria-label":"Notifications Alt+T",hotKeys:h=>h.altKey&&h.code==="KeyT"};function lz(h){let g={...oz,...h},b=h.stacked,[S,I]=ue.useState(!0),N=ue.useRef(null),{getToastToRender:V,isToastActive:s,count:q}=WI(g),{className:Z,style:Q,rtl:oe,containerId:de,hotKeys:ze}=g;function le(ee){let _e=Mm("Toastify__toast-container",`Toastify__toast-container--${ee}`,{"Toastify__toast-container--rtl":oe});return cf(Z)?Z({position:ee,rtl:oe,defaultClassName:_e}):Mm(_e,x2(Z))}function Se(){b&&(I(!0),ei.play())}return YI(()=>{var ee;if(b){let _e=N.current.querySelectorAll('[data-in="true"]'),ye=12,xe=(ee=g.position)==null?void 0:ee.includes("top"),Le=0,Ae=0;Array.from(_e).reverse().forEach((Ke,it)=>{let rt=Ke;rt.classList.add("Toastify__toast--stacked"),it>0&&(rt.dataset.collapsed=`${S}`),rt.dataset.pos||(rt.dataset.pos=xe?"top":"bot");let lt=Le*(S?.2:1)+(S?0:ye*it);rt.style.setProperty("--y",`${xe?lt:lt*-1}px`),rt.style.setProperty("--g",`${ye}`),rt.style.setProperty("--s",`${1-(S?Ae:0)}`),Le+=rt.offsetHeight,Ae+=.025})}},[S,q,b]),ue.useEffect(()=>{function ee(_e){var ye;let xe=N.current;ze(_e)&&((ye=xe.querySelector('[tabIndex="0"]'))==null||ye.focus(),I(!1),ei.pause()),_e.key==="Escape"&&(document.activeElement===xe||xe!=null&&xe.contains(document.activeElement))&&(I(!0),ei.play())}return document.addEventListener("keydown",ee),()=>{document.removeEventListener("keydown",ee)}},[ze]),Wn.createElement("section",{ref:N,className:"Toastify",id:de,onMouseEnter:()=>{b&&(I(!1),ei.pause())},onMouseLeave:Se,"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text","aria-label":g["aria-label"]},V((ee,_e)=>{let ye=_e.length?{...Q}:{...Q,pointerEvents:"none"};return Wn.createElement("div",{tabIndex:-1,className:le(ee),"data-stacked":b,style:ye,key:`c-${ee}`},_e.map(({content:xe,props:Le})=>Wn.createElement(nz,{...Le,stacked:b,collapseAll:Se,isIn:s(Le.toastId,Le.containerId),key:`t-${Le.key}`},xe)))}))}const th="https://urbansetu.onrender.com";function wS({mobile:h=!1}){const{currentUser:g}=yo(gt=>gt.user),[b,S]=ue.useState([]),[I,N]=ue.useState(0),[V,s]=ue.useState(!1),[q,Z]=ue.useState(!1),[Q,oe]=ue.useState(!1),[de,ze]=ue.useState(0),[le,Se]=ue.useState("notifications"),[ee,_e]=ue.useState([]),[ye,xe]=ue.useState(""),[Le,Ae]=ue.useState(""),[Ke,it]=ue.useState(""),[rt,lt]=ue.useState(!1),[zt,xt]=ue.useState(!1),[Ci,Zi]=ue.useState(""),[or,er]=ue.useState(""),Jt=ue.useRef(null);ue.useEffect(()=>{if(V){const gt=document.body.style.overflow,Tt=document.body.style.position,Si=document.body.style.width;return document.body.style.overflow="hidden",h&&(document.body.style.position="fixed",document.body.style.width="100%"),()=>{document.body.style.overflow=gt,document.body.style.position=Tt,document.body.style.width=Si}}else document.body.style.overflow="",document.body.style.position="",document.body.style.width="";return()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width=""}},[V,h]);const ji=async(gt=!1)=>{if(g)try{const Tt=await fetch(`${th}/api/notifications/user/${g._id}`,{credentials:"include"}),Si=await Tt.json();if(Tt.ok)if(gt){const Sr=new Date,Cr=Sr.getFullYear(),zr=Sr.getMonth(),Er=Sr.getDate(),Gn=(Array.isArray(Si)?Si:[]).filter(ds=>{const Zs=new Date(ds.createdAt);return Zs.getFullYear()===Cr&&Zs.getMonth()===zr&&Zs.getDate()===Er});S(Gn.length>0?Gn:Si),ei.info("Notifications list updated")}else S(Si)}catch(Tt){console.error("Error fetching notifications:",Tt)}},Fi=async()=>{if(g)try{const gt=await fetch(`${th}/api/notifications/user/${g._id}/unread-count`,{credentials:"include"}),Tt=await gt.json();if(gt.ok){const Si=Tt.count;Si>de&&de>0&&Pr(),N(Si),ze(Si)}}catch(gt){console.error("Error fetching unread count:",gt)}},Pr=()=>{oe(!0),setTimeout(()=>{oe(!1)},1500)},tt=async()=>{if(!(!g||!Ai())){xt(!0);try{const gt=await fetch(`${th}/api/notifications/admin/users`,{credentials:"include"}),Tt=await gt.json();gt.ok?_e(Tt):(console.error("Failed to fetch users:",Tt),ei.error("Failed to fetch users: "+(Tt.message||"Unknown error")))}catch(gt){console.error("Error fetching users:",gt),ei.error("Failed to fetch users: "+gt.message)}finally{xt(!1)}}},Ht=async gt=>{if(gt.preventDefault(),!ye||!Le.trim()||!Ke.trim()){ei.error("Please fill in all fields");return}lt(!0);try{const Tt=await fetch(`${th}/api/notifications/admin/send`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({userId:ye,title:Le.trim(),message:Ke.trim(),type:"admin_message"})}),Si=await Tt.json();Tt.ok?(ei.success(Si.message),xe(""),Ae(""),it(""),Se("notifications")):ei.error(Si.message||"Failed to send notification")}catch(Tt){console.error("Error sending notification:",Tt),ei.error("Failed to send notification")}finally{lt(!1)}},Pi=async gt=>{if(gt.preventDefault(),!Ci.trim()||!or.trim()){ei.error("Please fill in title and message");return}lt(!0);try{const Tt=await fetch(`${th}/api/notifications/admin/send-all`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({title:Ci.trim(),message:or.trim(),type:"admin_message"})}),Si=await Tt.json();Tt.ok?(ei.success(Si.message),Zi(""),er(""),Se("notifications")):ei.error(Si.message||"Failed to send notification")}catch(Tt){console.error("Error sending notification:",Tt),ei.error("Failed to send notification")}finally{lt(!1)}},Ui=async gt=>{try{(await fetch(`${th}/api/notifications/${gt}/read`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({userId:g._id})})).ok&&(S(Si=>Si.map(Sr=>Sr._id===gt?{...Sr,isRead:!0,readAt:new Date}:Sr)),Fi())}catch(Tt){console.error("Error marking notification as read:",Tt)}},ii=async()=>{try{let gt,Tt;Ai()?(gt=`${th}/api/notifications/admin/read-all`,Tt="All notifications marked as read for all admins"):(gt=`${th}/api/notifications/user/${g._id}/read-all`,Tt="All notifications marked as read");const Si=await fetch(gt,{method:"PUT",credentials:"include"});if(Si.ok){const Sr=await Si.json();S(Cr=>Cr.map(zr=>({...zr,isRead:!0,readAt:new Date}))),N(0),ei.success(Tt)}}catch(gt){console.error("Error marking all notifications as read:",gt)}},Wi=async gt=>{try{(await fetch(`${th}/api/notifications/${gt}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({userId:g._id})})).ok&&(S(Si=>Si.filter(Sr=>Sr._id!==gt)),Fi(),ei.success("Notification deleted"))}catch(Tt){console.error("Error deleting notification:",Tt)}},_i=gt=>{const Tt=new Date(gt),Sr=new Date-Tt,Cr=Math.floor(Sr/(1e3*60)),zr=Math.floor(Sr/(1e3*60*60)),Er=Math.floor(Sr/(1e3*60*60*24));return Cr<1?"Just now":Cr<60?`${Cr}m ago`:zr<24?`${zr}h ago`:Er===1?"Yesterday":Er<7?`${Er} days ago`:Tt.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},Ri=gt=>{switch(gt){case"property_edited":return _.jsx(O4,{className:"w-4 h-4 text-blue-500"});case"property_deleted":return _.jsx(su,{className:"w-4 h-4 text-red-500"});case"appointment_updated":return _.jsx(_p,{className:"w-4 h-4 text-green-500"});case"admin_message":return _.jsx(nd,{className:"w-4 h-4 text-purple-500"});case"admin_booked_appointment":return _.jsx(_p,{className:"w-4 h-4 text-orange-500"});case"appointment_booked":return _.jsx(_p,{className:"w-4 h-4 text-blue-500"});case"appointment_cancelled_by_seller":return _.jsx(_o,{className:"w-4 h-4 text-red-500"});case"appointment_cancelled_by_buyer":return _.jsx(_o,{className:"w-4 h-4 text-yellow-500"});case"appointment_cancelled_by_admin":return _.jsx(_o,{className:"w-4 h-4 text-pink-500"});case"appointment_reinitiated_by_admin":return _.jsx(Dy,{className:"w-4 h-4 text-green-500"});case"appointment_accepted_by_seller":return _.jsx(qy,{className:"w-4 h-4 text-green-500"});case"appointment_rejected_by_seller":return _.jsx(_o,{className:"w-4 h-4 text-red-500"});case"appointment_reinitiated_by_user":return _.jsx(Dy,{className:"w-4 h-4 text-green-500"});case"refund_appeal_submitted":return _.jsx(AI,{className:"w-4 h-4 text-purple-500"});case"watchlist_price_drop":return _.jsx(au,{className:"w-4 h-4 text-green-500"});case"watchlist_price_update":return _.jsx(au,{className:"w-4 h-4 text-blue-500"});case"watchlist_property_sold":return _.jsx(_o,{className:"w-4 h-4 text-red-500"});case"watchlist_property_removed":return _.jsx(su,{className:"w-4 h-4 text-red-500"});case"watchlist_property_trending":return _.jsx(au,{className:"w-4 h-4 text-orange-500"});case"watchlist_status_update":return _.jsx(O4,{className:"w-4 h-4 text-purple-500"});case"watchlist_update":return _.jsx(au,{className:"w-4 h-4 text-indigo-500"});case"email_service_failure":return _.jsx(nd,{className:"w-4 h-4 text-red-500"});default:return _.jsx(wm,{className:"w-4 h-4 text-gray-500"})}};if(ue.useEffect(()=>{if(g){ji(),Fi(),Ai()&&tt();const gt=setInterval(()=>{Fi()},1e4);return()=>clearInterval(gt)}},[g]),ue.useEffect(()=>{V&&le==="send"&&g&&Ai()&&tt()},[V,le,g]),!g)return null;const Ai=()=>g.role==="admin"||g.role==="rootadmin"||g.isDefaultAdmin||g.isAdmin;return ue.useEffect(()=>{const gt=Cr=>{!g||Cr.userId!==g._id||(S(zr=>[Cr,...zr]),N(zr=>zr+1))},Tt=Cr=>{if(!g||Cr.adminId!==g._id)return;S(Er=>Er.map(Gn=>({...Gn,isRead:!0,readAt:new Date}))),N(0);const zr=Cr.markedBy===g._id?"You":"Another admin";ei.info(`${zr} marked all notifications as read for all admins`)},Si=Cr=>{if(!g||Cr.notificationId){S(Er=>Er.map(Gn=>Gn._id===Cr.notificationId?{...Gn,isRead:!0,readAt:new Date}:Gn)),N(Er=>Math.max(0,Er-1));const zr=Cr.markedBy===g._id?"You":Cr.markedByUsername||Cr.markedByEmail||"Another admin";ei.info(`${zr} marked a notification as read`)}},Sr=Cr=>{!g||Cr.userId!==g._id||(S(zr=>[Cr.notification,...zr]),N(zr=>zr+1),Pr())};return pr.on("notificationCreated",gt),pr.on("allNotificationsMarkedAsRead",Tt),pr.on("notificationMarkedAsRead",Si),pr.on("watchlistNotification",Sr),()=>{pr.off("notificationCreated",gt),pr.off("allNotificationsMarkedAsRead",Tt),pr.off("notificationMarkedAsRead",Si),pr.off("watchlistNotification",Sr)}},[g]),_.jsxs("div",{className:"relative",children:[_.jsxs("button",{ref:Jt,onClick:()=>s(!V),className:`relative p-3 text-yellow-500 hover:text-yellow-400 transition-all duration-300 hover:scale-110 bg-yellow-50 hover:bg-yellow-100 rounded-full ${Q?"animate-bell-ring":""} ${V?"bg-yellow-100 text-yellow-600":""}`,title:"Notifications",children:[_.jsx(wm,{className:"w-5 h-5 drop-shadow-lg"}),I>0&&_.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-6 w-6 flex items-center justify-center font-bold shadow-lg animate-pulse",children:I>99?"99+":I})]}),V&&(h?l4.createPortal(_.jsx("div",{className:"fixed inset-0 z-[99999] flex items-center justify-center bg-black bg-opacity-70 backdrop-blur-md",onClick:gt=>{gt.target===gt.currentTarget&&s(!1)},children:_.jsxs("div",{className:"w-full max-w-md mx-auto bg-gradient-to-br from-white via-blue-50 to-purple-50 rounded-3xl shadow-2xl border border-gray-200 max-h-[85vh] overflow-hidden relative animate-fade-in notification-popup transform transition-all duration-300",style:{marginTop:"1rem",marginBottom:"1rem"},children:[_.jsx("button",{onClick:()=>s(!1),className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700 z-10 bg-white rounded-full p-2 shadow-lg hover:shadow-xl transition-all duration-200","aria-label":"Close notifications",children:_.jsx(_o,{className:"w-4 h-4"})}),_.jsxs("div",{className:"pt-12 pb-6 px-6",children:[_.jsxs("div",{className:"border-b border-gray-200 mb-6",children:[_.jsx("h3",{className:"text-2xl font-bold text-gray-800 text-center tracking-wide mb-2",children:"Notifications"}),_.jsx("div",{className:"flex justify-center",children:_.jsx("div",{className:"w-16 h-1 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full"})}),Ai()&&_.jsxs("div",{className:"flex border-b border-gray-200 mt-2",children:[_.jsxs("button",{onClick:()=>Se("notifications"),className:`flex-1 py-2 px-4 text-sm font-medium transition-colors ${le==="notifications"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[_.jsx(wm,{className:"w-4 h-4 inline mr-2"}),"Notifications"]}),_.jsxs("button",{onClick:()=>Se("send"),className:`flex-1 py-2 px-4 text-sm font-medium transition-colors ${le==="send"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[_.jsx(nd,{className:"w-4 h-4 inline mr-2"}),"Send Message"]})]})]}),le==="notifications"?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:_.jsxs("div",{className:"flex items-center gap-2",children:[I>0&&_.jsx("button",{onClick:ii,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:Ai()?"Mark all resolved":"Mark all read"}),_.jsxs("button",{onClick:()=>ji(!0),className:"ml-2 text-sm text-gray-500 hover:text-blue-600 flex items-center gap-1",title:"Refresh notifications",children:[_.jsx(Dy,{className:"w-4 h-4"}),"Refresh"]}),b.length>0&&_.jsxs("button",{onClick:()=>{fetch(`${th}/api/notifications/user/${g._id}/all`,{method:"DELETE",credentials:"include"}).then(()=>{S([]),N(0),ei.success("All notifications cleared")})},className:"ml-2 text-sm text-red-600 hover:text-red-800 font-medium flex items-center gap-1",title:"Clear all notifications",children:[_.jsx(su,{className:"w-4 h-4"}),"Clear all"]})]})}),_.jsx("div",{className:"notification-scroll-area-mobile",children:b.length===0?_.jsxs("div",{className:"p-6 text-center text-gray-500",children:[_.jsx(wm,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),_.jsx("p",{children:"No notifications yet"})]}):_.jsx("div",{className:"divide-y divide-gray-100",children:b.map(gt=>_.jsx("div",{className:`relative group p-4 my-2 rounded-2xl shadow-lg bg-white border transition-all duration-300 flex flex-col gap-2 animate-fadeInNotification
                                  ${gt.isRead?"border border-gray-200 hover:border-gray-300":"border-l-4 border-blue-500 bg-gradient-to-r from-blue-50 to-white shadow-blue-100"}
                                  hover:shadow-xl hover:-translate-y-1 hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 active:scale-[0.98]`,style:{animationDelay:`${.05*b.indexOf(gt)}s`},children:_.jsxs("div",{className:"flex items-start gap-3",children:[_.jsx("div",{className:"flex-shrink-0 mt-1",children:Ri(gt.type)}),_.jsx("div",{className:"flex-1 min-w-0",children:_.jsxs("div",{className:"flex items-start justify-between",children:[_.jsxs("div",{className:"flex-1 min-w-0",children:[_.jsxs("h4",{className:"text-base font-bold text-blue-800 flex items-center gap-2",children:[Ri(gt.type),_.jsx("span",{className:"truncate max-w-[180px] md:max-w-[260px]",title:gt.title,children:gt.title})]}),_.jsx("p",{className:"text-sm text-gray-700 mt-1 whitespace-pre-line break-words max-w-xs md:max-w-md lg:max-w-lg font-medium",children:gt.link?_.jsx("span",{className:"text-blue-600 hover:underline cursor-pointer font-semibold",onClick:()=>{Ui(gt._id),gt.link.startsWith("http")?window.open(gt.link,"_blank"):(s(!1),setTimeout(()=>navigate(gt.link),0))},children:gt.message}):_.jsx("span",{className:"text-blue-600 hover:underline cursor-pointer font-semibold",onClick:()=>{Ui(gt._id),s(!1)},children:gt.message})}),_.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[_.jsx("span",{className:"text-xs text-gray-500",children:_i(gt.createdAt)}),gt.adminId&&!Ai()&&_.jsx("span",{className:"text-xs text-blue-600",children:"by Organization"}),gt.adminId&&Ai()&&_.jsxs("span",{className:"text-xs text-blue-600",children:["by ",gt.adminId.username||gt.adminId.email]})]})]}),_.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[!gt.isRead&&_.jsx("button",{onClick:()=>Ui(gt._id),className:"p-1 text-green-600 hover:text-green-800 transition-colors",title:"Mark as read",children:_.jsx(qy,{className:"w-3 h-3"})}),_.jsx("button",{onClick:()=>Wi(gt._id),className:"p-1 text-red-600 hover:text-red-800 transition-colors",title:"Delete notification",children:_.jsx(su,{className:"w-3 h-3"})})]})]})})]})},gt._id))})})]}):_.jsxs("div",{className:"p-4 space-y-4 max-h-80 overflow-y-auto",children:[_.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[_.jsxs("h4",{className:"font-semibold text-green-800 mb-3 flex items-center gap-2",children:[_.jsx(Py,{className:"w-4 h-4"}),"Send to All Users"]}),_.jsxs("form",{onSubmit:Pi,className:"space-y-3",children:[_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),_.jsx("input",{type:"text",value:Ci,onChange:gt=>Zi(gt.target.value),placeholder:"Enter title...",className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-gray-900",required:!0,maxLength:100})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message"}),_.jsx("textarea",{value:or,onChange:gt=>er(gt.target.value),placeholder:"Enter message...",rows:3,className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none text-gray-900",required:!0,maxLength:500}),_.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[or.length,"/500"]})]}),_.jsx("button",{type:"submit",disabled:rt||!Ci.trim()||!or.trim(),className:"w-full bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:rt?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Sending..."]}):_.jsxs(_.Fragment,{children:[_.jsx(Py,{className:"w-3 h-3"}),"Send to All Users"]})})]})]}),_.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[_.jsxs("h4",{className:"font-semibold text-blue-800 mb-3 flex items-center gap-2",children:[_.jsx(zl,{className:"w-4 h-4"}),"Send to Specific User"]}),_.jsxs("form",{onSubmit:Ht,className:"space-y-3",children:[_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select User"}),_.jsxs("div",{className:"relative",children:[_.jsxs("select",{value:ye,onChange:gt=>xe(gt.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-gray-900",required:!0,disabled:zt,children:[_.jsx("option",{value:"",disabled:!0,children:"-- Select a user --"}),ee.length===0&&!zt&&_.jsx("option",{value:"",disabled:!0,children:'No users found. Click "Refresh Users" to load.'}),ee.map(gt=>_.jsxs("option",{value:gt._id,children:[gt.email," ",gt.username&&`(${gt.username})`]},gt._id))]}),zt&&_.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:_.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-500"})})]}),_.jsxs("div",{className:"flex items-center justify-between mt-1",children:[_.jsxs("span",{className:"text-xs text-gray-500",children:[ee.length," users available"]}),_.jsx("button",{type:"button",onClick:tt,disabled:zt,className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:zt?"Loading...":"Refresh Users"})]})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),_.jsx("input",{type:"text",value:Le,onChange:gt=>Ae(gt.target.value),placeholder:"Enter title...",className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",required:!0,maxLength:100})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message"}),_.jsx("textarea",{value:Ke,onChange:gt=>it(gt.target.value),placeholder:"Enter message...",rows:3,className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-gray-900",required:!0,maxLength:500}),_.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[Ke.length,"/500"]})]}),_.jsx("button",{type:"submit",disabled:rt||!ye||!Le.trim()||!Ke.trim(),className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:rt?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Sending..."]}):_.jsxs(_.Fragment,{children:[_.jsx(f1,{className:"w-3 h-3"}),"Send to User"]})})]})]})]})]})]})}),document.body):l4.createPortal(_.jsx("div",{className:"fixed inset-0 z-[9998] bg-black bg-opacity-30 backdrop-blur-sm",onClick:()=>s(!1),style:{pointerEvents:"auto"},children:_.jsxs("div",{className:"fixed w-96 bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-2xl border border-gray-200 z-[9999] max-h-96 overflow-hidden notification-popup transform transition-all duration-300",onClick:gt=>gt.stopPropagation(),style:{top:"80px",right:"20px",maxHeight:"calc(100vh - 120px)",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.05)",position:"fixed",zIndex:9999},children:[_.jsxs("div",{className:"border-b border-gray-200 bg-gradient-to-r from-gray-50 to-white",children:[_.jsxs("div",{className:"flex items-center justify-between p-5",children:[_.jsxs("div",{className:"flex items-center gap-3",children:[_.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center",children:_.jsx(wm,{className:"w-4 h-4 text-white"})}),_.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Notifications"}),I>0&&_.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full px-2 py-1 font-bold",children:I})]}),_.jsx("button",{onClick:()=>s(!1),className:"text-gray-500 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors",children:_.jsx(_o,{className:"w-4 h-4"})})]}),Ai()&&_.jsxs("div",{className:"flex border-b border-gray-200",children:[_.jsxs("button",{onClick:()=>Se("notifications"),className:`flex-1 py-2 px-4 text-sm font-medium transition-colors ${le==="notifications"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[_.jsx(wm,{className:"w-4 h-4 inline mr-2"}),"Notifications"]}),_.jsxs("button",{onClick:()=>Se("send"),className:`flex-1 py-2 px-4 text-sm font-medium transition-colors ${le==="send"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[_.jsx(nd,{className:"w-4 h-4 inline mr-2"}),"Send Message"]})]})]}),le==="notifications"?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:_.jsxs("div",{className:"flex items-center gap-2",children:[I>0&&_.jsx("button",{onClick:ii,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:Ai()?"Mark all resolved":"Mark all read"}),_.jsxs("button",{onClick:()=>ji(!0),className:"ml-2 text-sm text-gray-500 hover:text-blue-600 flex items-center gap-1",title:"Refresh notifications",children:[_.jsx(Dy,{className:"w-4 h-4"}),"Refresh"]}),b.length>0&&_.jsxs("button",{onClick:()=>{fetch(`${th}/api/notifications/user/${g._id}/all`,{method:"DELETE",credentials:"include"}).then(()=>{S([]),N(0),ei.success("All notifications cleared")})},className:"ml-2 text-sm text-red-600 hover:text-red-800 font-medium flex items-center gap-1",title:"Clear all notifications",children:[_.jsx(su,{className:"w-4 h-4"}),"Clear all"]})]})}),_.jsx("div",{className:"notification-scroll-area-desktop",children:b.length===0?_.jsxs("div",{className:"p-6 text-center text-gray-500",children:[_.jsx(wm,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),_.jsx("p",{children:"No notifications yet"})]}):_.jsx("div",{className:"divide-y divide-gray-100",children:b.map(gt=>_.jsx("div",{className:`p-4 hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 transition-all duration-200 border-l-4 ${gt.isRead?"border-transparent hover:border-gray-200":"bg-blue-50 border-blue-500"}`,children:_.jsxs("div",{className:"flex items-start gap-3",children:[_.jsx("div",{className:"flex-shrink-0 mt-1",children:Ri(gt.type)}),_.jsx("div",{className:"flex-1 min-w-0",children:_.jsxs("div",{className:"flex items-start justify-between",children:[_.jsxs("div",{className:"flex-1",children:[_.jsx("h4",{className:"text-sm font-medium text-gray-900",children:gt.title}),_.jsx("p",{className:"text-sm text-gray-600 mt-1 whitespace-pre-line break-words max-w-xs md:max-w-md lg:max-w-lg",children:gt.link?_.jsx("span",{className:"text-blue-600 hover:underline cursor-pointer",onClick:()=>{Ui(gt._id),gt.link.startsWith("http")?window.open(gt.link,"_blank"):(s(!1),setTimeout(()=>navigate(gt.link),0))},children:gt.message}):_.jsx("span",{className:"text-blue-600 hover:underline cursor-pointer",onClick:()=>{Ui(gt._id),s(!1)},children:gt.message})}),_.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[_.jsx("span",{className:"text-xs text-gray-500",children:_i(gt.createdAt)}),gt.adminId&&!Ai()&&_.jsx("span",{className:"text-xs text-blue-600",children:"by Organization"}),gt.adminId&&Ai()&&_.jsxs("span",{className:"text-xs text-blue-600",children:["by ",gt.adminId.username||gt.adminId.email]})]})]}),_.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[!gt.isRead&&_.jsx("button",{onClick:()=>Ui(gt._id),className:"p-1 text-green-600 hover:text-green-800 transition-colors",title:"Mark as read",children:_.jsx(qy,{className:"w-3 h-3"})}),_.jsx("button",{onClick:()=>Wi(gt._id),className:"p-1 text-red-600 hover:text-red-800 transition-colors",title:"Delete notification",children:_.jsx(su,{className:"w-3 h-3"})})]})]})})]})},gt._id))})})]}):_.jsxs("div",{className:"p-4 space-y-4 max-h-80 overflow-y-auto",children:[_.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[_.jsxs("h4",{className:"font-semibold text-green-800 mb-3 flex items-center gap-2",children:[_.jsx(Py,{className:"w-4 h-4"}),"Send to All Users"]}),_.jsxs("form",{onSubmit:Pi,className:"space-y-3",children:[_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),_.jsx("input",{type:"text",value:Ci,onChange:gt=>Zi(gt.target.value),placeholder:"Enter title...",className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-gray-900",required:!0,maxLength:100})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message"}),_.jsx("textarea",{value:or,onChange:gt=>er(gt.target.value),placeholder:"Enter message...",rows:3,className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none text-gray-900",required:!0,maxLength:500}),_.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[or.length,"/500"]})]}),_.jsx("button",{type:"submit",disabled:rt||!Ci.trim()||!or.trim(),className:"w-full bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:rt?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Sending..."]}):_.jsxs(_.Fragment,{children:[_.jsx(Py,{className:"w-3 h-3"}),"Send to All Users"]})})]})]}),_.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[_.jsxs("h4",{className:"font-semibold text-blue-800 mb-3 flex items-center gap-2",children:[_.jsx(zl,{className:"w-4 h-4"}),"Send to Specific User"]}),_.jsxs("form",{onSubmit:Ht,className:"space-y-3",children:[_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select User"}),_.jsxs("div",{className:"relative",children:[_.jsxs("select",{value:ye,onChange:gt=>xe(gt.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-gray-900",required:!0,disabled:zt,children:[_.jsx("option",{value:"",disabled:!0,children:"-- Select a user --"}),ee.length===0&&!zt&&_.jsx("option",{value:"",disabled:!0,children:'No users found. Click "Refresh Users" to load.'}),ee.map(gt=>_.jsxs("option",{value:gt._id,children:[gt.email," ",gt.username&&`(${gt.username})`]},gt._id))]}),zt&&_.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:_.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-500"})})]}),_.jsxs("div",{className:"flex items-center justify-between mt-1",children:[_.jsxs("span",{className:"text-xs text-gray-500",children:[ee.length," users available"]}),_.jsx("button",{type:"button",onClick:tt,disabled:zt,className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:zt?"Loading...":"Refresh Users"})]})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),_.jsx("input",{type:"text",value:Le,onChange:gt=>Ae(gt.target.value),placeholder:"Enter title...",className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",required:!0,maxLength:100})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message"}),_.jsx("textarea",{value:Ke,onChange:gt=>it(gt.target.value),placeholder:"Enter message...",rows:3,className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-gray-900",required:!0,maxLength:500}),_.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[Ke.length,"/500"]})]}),_.jsx("button",{type:"submit",disabled:rt||!ye||!Le.trim()||!Ke.trim(),className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:rt?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Sending..."]}):_.jsxs(_.Fragment,{children:[_.jsx(f1,{className:"w-3 h-3"}),"Send to User"]})})]})]})]})]})}),document.body)),_.jsx("style",{jsx:!0,children:`
        @keyframes fadeInNotification {
          from { 
            opacity: 0; 
            transform: translateY(20px) scale(0.95); 
          }
          to { 
            opacity: 1; 
            transform: translateY(0) scale(1); 
          }
        }
        
        @keyframes slideInFromTop {
          from { 
            opacity: 0; 
            transform: translateY(-20px) scale(0.95); 
          }
          to { 
            opacity: 1; 
            transform: translateY(0) scale(1); 
          }
        }
        
        @keyframes bellRing {
          0%, 100% { transform: rotate(0deg); }
          10%, 30%, 50%, 70%, 90% { transform: rotate(10deg); }
          20%, 40%, 60%, 80% { transform: rotate(-10deg); }
        }
        
        .animate-fadeInNotification {
          animation: fadeInNotification 0.5s cubic-bezier(0.4,0,0.2,1) both;
        }
        
        .animate-fade-in {
          animation: slideInFromTop 0.4s cubic-bezier(0.4,0,0.2,1) both;
        }
        
        .animate-bell-ring {
          animation: bellRing 0.5s ease-in-out;
        }
        
        .notification-popup {
          backdrop-filter: blur(10px);
        }
        
        .notification-scroll-area-mobile {
          max-height: calc(85vh - 320px);
          overflow-y: auto;
          scrollbar-width: thin;
          scrollbar-color: #cbd5e0 #f7fafc;
          padding-bottom: 1rem;
          -webkit-overflow-scrolling: touch;
        }
        
        .notification-scroll-area-mobile::-webkit-scrollbar {
          width: 6px;
        }
        
        .notification-scroll-area-mobile::-webkit-scrollbar-track {
          background: #f7fafc;
          border-radius: 3px;
        }
        
        .notification-scroll-area-mobile::-webkit-scrollbar-thumb {
          background: #cbd5e0;
          border-radius: 3px;
        }
        
        .notification-scroll-area-desktop {
          max-height: calc(100vh - 200px);
          overflow-y: auto;
          scrollbar-width: thin;
          scrollbar-color: #cbd5e0 #f7fafc;
        }
        
        .notification-scroll-area-desktop::-webkit-scrollbar {
          width: 6px;
        }
        
        .notification-scroll-area-desktop::-webkit-scrollbar-track {
          background: #f7fafc;
          border-radius: 3px;
        }
        
        .notification-scroll-area-desktop::-webkit-scrollbar-thumb {
          background: #cbd5e0;
          border-radius: 3px;
        }
      `})]})}var nb="persist:",TS="persist/FLUSH",sb="persist/REHYDRATE",SS="persist/PAUSE",ES="persist/PERSIST",AS="persist/PURGE",CS="persist/REGISTER",cz=-1;function $y(h){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?$y=function(b){return typeof b}:$y=function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},$y(h)}function H4(h,g){var b=Object.keys(h);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(h);g&&(S=S.filter(function(I){return Object.getOwnPropertyDescriptor(h,I).enumerable})),b.push.apply(b,S)}return b}function uz(h){for(var g=1;g<arguments.length;g++){var b=arguments[g]!=null?arguments[g]:{};g%2?H4(b,!0).forEach(function(S){hz(h,S,b[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(b)):H4(b).forEach(function(S){Object.defineProperty(h,S,Object.getOwnPropertyDescriptor(b,S))})}return h}function hz(h,g,b){return g in h?Object.defineProperty(h,g,{value:b,enumerable:!0,configurable:!0,writable:!0}):h[g]=b,h}function dz(h,g,b,S){S.debug;var I=uz({},b);return h&&$y(h)==="object"&&Object.keys(h).forEach(function(N){N!=="_persist"&&g[N]===b[N]&&(I[N]=h[N])}),I}function fz(h){var g=h.blacklist||null,b=h.whitelist||null,S=h.transforms||[],I=h.throttle||0,N="".concat(h.keyPrefix!==void 0?h.keyPrefix:nb).concat(h.key),V=h.storage,s;h.serialize===!1?s=function(Ae){return Ae}:typeof h.serialize=="function"?s=h.serialize:s=pz;var q=h.writeFailHandler||null,Z={},Q={},oe=[],de=null,ze=null,le=function(Ae){Object.keys(Ae).forEach(function(Ke){_e(Ke)&&Z[Ke]!==Ae[Ke]&&oe.indexOf(Ke)===-1&&oe.push(Ke)}),Object.keys(Z).forEach(function(Ke){Ae[Ke]===void 0&&_e(Ke)&&oe.indexOf(Ke)===-1&&Z[Ke]!==void 0&&oe.push(Ke)}),de===null&&(de=setInterval(Se,I)),Z=Ae};function Se(){if(oe.length===0){de&&clearInterval(de),de=null;return}var Le=oe.shift(),Ae=S.reduce(function(Ke,it){return it.in(Ke,Le,Z)},Z[Le]);if(Ae!==void 0)try{Q[Le]=s(Ae)}catch(Ke){console.error("redux-persist/createPersistoid: error serializing state",Ke)}else delete Q[Le];oe.length===0&&ee()}function ee(){Object.keys(Q).forEach(function(Le){Z[Le]===void 0&&delete Q[Le]}),ze=V.setItem(N,s(Q)).catch(ye)}function _e(Le){return!(b&&b.indexOf(Le)===-1&&Le!=="_persist"||g&&g.indexOf(Le)!==-1)}function ye(Le){q&&q(Le)}var xe=function(){for(;oe.length!==0;)Se();return ze||Promise.resolve()};return{update:le,flush:xe}}function pz(h){return JSON.stringify(h)}function mz(h){var g=h.transforms||[],b="".concat(h.keyPrefix!==void 0?h.keyPrefix:nb).concat(h.key),S=h.storage;h.debug;var I;return h.deserialize===!1?I=function(V){return V}:typeof h.deserialize=="function"?I=h.deserialize:I=gz,S.getItem(b).then(function(N){if(N)try{var V={},s=I(N);return Object.keys(s).forEach(function(q){V[q]=g.reduceRight(function(Z,Q){return Q.out(Z,q,s)},I(s[q]))}),V}catch(q){throw q}else return})}function gz(h){return JSON.parse(h)}function _z(h){var g=h.storage,b="".concat(h.keyPrefix!==void 0?h.keyPrefix:nb).concat(h.key);return g.removeItem(b,yz)}function yz(h){}function q4(h,g){var b=Object.keys(h);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(h);g&&(S=S.filter(function(I){return Object.getOwnPropertyDescriptor(h,I).enumerable})),b.push.apply(b,S)}return b}function rf(h){for(var g=1;g<arguments.length;g++){var b=arguments[g]!=null?arguments[g]:{};g%2?q4(b,!0).forEach(function(S){xz(h,S,b[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(b)):q4(b).forEach(function(S){Object.defineProperty(h,S,Object.getOwnPropertyDescriptor(b,S))})}return h}function xz(h,g,b){return g in h?Object.defineProperty(h,g,{value:b,enumerable:!0,configurable:!0,writable:!0}):h[g]=b,h}function vz(h,g){if(h==null)return{};var b=bz(h,g),S,I;if(Object.getOwnPropertySymbols){var N=Object.getOwnPropertySymbols(h);for(I=0;I<N.length;I++)S=N[I],!(g.indexOf(S)>=0)&&Object.prototype.propertyIsEnumerable.call(h,S)&&(b[S]=h[S])}return b}function bz(h,g){if(h==null)return{};var b={},S=Object.keys(h),I,N;for(N=0;N<S.length;N++)I=S[N],!(g.indexOf(I)>=0)&&(b[I]=h[I]);return b}var wz=5e3;function Tz(h,g){var b=h.version!==void 0?h.version:cz;h.debug;var S=h.stateReconciler===void 0?dz:h.stateReconciler,I=h.getStoredState||mz,N=h.timeout!==void 0?h.timeout:wz,V=null,s=!1,q=!0,Z=function(oe){return oe._persist.rehydrated&&V&&!q&&V.update(oe),oe};return function(Q,oe){var de=Q||{},ze=de._persist,le=vz(de,["_persist"]),Se=le;if(oe.type===ES){var ee=!1,_e=function(rt,lt){ee||(oe.rehydrate(h.key,rt,lt),ee=!0)};if(N&&setTimeout(function(){!ee&&_e(void 0,new Error('redux-persist: persist timed out for persist key "'.concat(h.key,'"')))},N),q=!1,V||(V=fz(h)),ze)return rf({},g(Se,oe),{_persist:ze});if(typeof oe.rehydrate!="function"||typeof oe.register!="function")throw new Error("redux-persist: either rehydrate or register is not a function on the PERSIST action. This can happen if the action is being replayed. This is an unexplored use case, please open an issue and we will figure out a resolution.");return oe.register(h.key),I(h).then(function(it){var rt=h.migrate||function(lt,zt){return Promise.resolve(lt)};rt(it,b).then(function(lt){_e(lt)},function(lt){_e(void 0,lt)})},function(it){_e(void 0,it)}),rf({},g(Se,oe),{_persist:{version:b,rehydrated:!1}})}else{if(oe.type===AS)return s=!0,oe.result(_z(h)),rf({},g(Se,oe),{_persist:ze});if(oe.type===TS)return oe.result(V&&V.flush()),rf({},g(Se,oe),{_persist:ze});if(oe.type===SS)q=!0;else if(oe.type===sb){if(s)return rf({},Se,{_persist:rf({},ze,{rehydrated:!0})});if(oe.key===h.key){var ye=g(Se,oe),xe=oe.payload,Le=S!==!1&&xe!==void 0?S(xe,Q,ye,h):ye,Ae=rf({},Le,{_persist:rf({},ze,{rehydrated:!0})});return Z(Ae)}}}if(!ze)return g(Q,oe);var Ke=g(Se,oe);return Ke===Se?Q:Z(rf({},Ke,{_persist:ze}))}}function G4(h){return Az(h)||Ez(h)||Sz()}function Sz(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function Ez(h){if(Symbol.iterator in Object(h)||Object.prototype.toString.call(h)==="[object Arguments]")return Array.from(h)}function Az(h){if(Array.isArray(h)){for(var g=0,b=new Array(h.length);g<h.length;g++)b[g]=h[g];return b}}function $4(h,g){var b=Object.keys(h);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(h);g&&(S=S.filter(function(I){return Object.getOwnPropertyDescriptor(h,I).enumerable})),b.push.apply(b,S)}return b}function T2(h){for(var g=1;g<arguments.length;g++){var b=arguments[g]!=null?arguments[g]:{};g%2?$4(b,!0).forEach(function(S){Cz(h,S,b[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(b)):$4(b).forEach(function(S){Object.defineProperty(h,S,Object.getOwnPropertyDescriptor(b,S))})}return h}function Cz(h,g,b){return g in h?Object.defineProperty(h,g,{value:b,enumerable:!0,configurable:!0,writable:!0}):h[g]=b,h}var RS={registry:[],bootstrapped:!1},Rz=function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:RS,b=arguments.length>1?arguments[1]:void 0;switch(b.type){case CS:return T2({},g,{registry:[].concat(G4(g.registry),[b.key])});case sb:var S=g.registry.indexOf(b.key),I=G4(g.registry);return I.splice(S,1),T2({},g,{registry:I,bootstrapped:I.length===0});default:return g}};function Mz(h,g,b){var S=G2(Rz,RS,void 0),I=function(q){S.dispatch({type:CS,key:q})},N=function(q,Z,Q){var oe={type:sb,payload:Z,err:Q,key:q};h.dispatch(oe),S.dispatch(oe)},V=T2({},S,{purge:function(){var q=[];return h.dispatch({type:AS,result:function(Q){q.push(Q)}}),Promise.all(q)},flush:function(){var q=[];return h.dispatch({type:TS,result:function(Q){q.push(Q)}}),Promise.all(q)},pause:function(){h.dispatch({type:SS})},persist:function(){h.dispatch({type:ES,register:I,rehydrate:N})}});return V.persist(),V}var J_={},Oy={},jy={},Z4;function Iz(){if(Z4)return jy;Z4=1,jy.__esModule=!0,jy.default=I;function h(N){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?h=function(s){return typeof s}:h=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},h(N)}function g(){}var b={getItem:g,setItem:g,removeItem:g};function S(N){if((typeof self>"u"?"undefined":h(self))!=="object"||!(N in self))return!1;try{var V=self[N],s="redux-persist ".concat(N," test");V.setItem(s,"test"),V.getItem(s),V.removeItem(s)}catch{return!1}return!0}function I(N){var V="".concat(N,"Storage");return S(V)?self[V]:b}return jy}var W4;function zz(){if(W4)return Oy;W4=1,Oy.__esModule=!0,Oy.default=b;var h=g(Iz());function g(S){return S&&S.__esModule?S:{default:S}}function b(S){var I=(0,h.default)(S);return{getItem:function(V){return new Promise(function(s,q){s(I.getItem(V))})},setItem:function(V,s){return new Promise(function(q,Z){q(I.setItem(V,s))})},removeItem:function(V){return new Promise(function(s,q){s(I.removeItem(V))})}}}return Oy}var X4;function Lz(){if(X4)return J_;X4=1,J_.__esModule=!0,J_.default=void 0;var h=g(zz());function g(S){return S&&S.__esModule?S:{default:S}}var b=(0,h.default)("local");return J_.default=b,J_}var Dz=Lz();const Pz=O2(Dz),Oz=wT({user:lM}),jz={key:"root",storage:Pz,version:1},Nz=Tz(jz,Oz),MS=PR({reducer:Nz,middleware:h=>h({serializableCheck:!1})}),Ug=Mz(MS),IS="https://urbansetu.onrender.com";let pv=null,Y4=0;const kz=5*60*1e3,Bz=async()=>{const h=Date.now();if(pv&&h-Y4<kz)return pv;try{const b=await(await fetch(`${IS}/api/deployment/active`)).json();if(b.success)return pv=b.data,Y4=h,b.data}catch(g){console.error("Error fetching active deployments:",g)}return[]},Fz=async()=>{try{const g=await(await fetch(`${IS}/api/deployment`,{credentials:"include"})).json();if(g.success)return g.data}catch(h){console.error("Error fetching all deployments:",h)}return[]},Uz=async()=>{try{const h=await Bz();console.log("Active deployments:",h);const g=h.find(I=>I.platform==="android"&&I.format==="apk");if(g)return console.log("Found active Android APK:",g),g.url;console.log("No active Android APK found, checking all deployments...");const S=(await Fz()).filter(I=>I.platform==="android"&&I.format==="apk").sort((I,N)=>new Date(N.createdAt)-new Date(I.createdAt))[0];if(S)return console.log("Found latest Android APK:",S),S.url}catch(h){console.error("Error getting latest Android APK:",h)}return console.warn("No Android APK found in deployments"),null},Vz="/downloads/UrbanSetu_debug.apk",K4=async(h="UrbanSetu_debug.apk")=>{try{const g=await Uz();if(!g)return{success:!1,message:"No Android app is currently available for download. Please contact support or check back later."};const b=document.createElement("a");return b.href=g,b.download=h,b.style.display="none",document.body.appendChild(b),b.click(),document.body.removeChild(b),{success:!0,message:"Android app download started!"}}catch(g){console.error("Download failed:",g);try{const b=document.createElement("a");return b.href=Vz,b.download=h,b.style.display="none",document.body.appendChild(b),b.click(),document.body.removeChild(b),{success:!0,message:"Android app download started!"}}catch(b){return console.error("Fallback download failed:",b),{success:!1,message:"Download failed. Please try again or contact support."}}}},Hz=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),qz=()=>/Android/i.test(navigator.userAgent),Gz=()=>qz()?" Download Android App":Hz()?" Download for Android":" Download Android App";function $z(){const{currentUser:h}=yo(ye=>ye.user),g=bp(),[b,S]=ue.useState(""),[I,N]=ue.useState(!1),V=Pl(),s=ko(),[q,Z]=ue.useState(!1),[Q,oe]=ue.useState(!1),de=ue.useRef(null);ue.useEffect(()=>{N(!0);const xe=new URLSearchParams(s.search).get("searchTerm");xe&&S(xe)},[s.search]),ue.useEffect(()=>{Q&&de.current&&de.current.focus()},[Q]),ue.useEffect(()=>{if(q){const ye=document.body.style.overflow,xe=document.body.style.position,Le=document.body.style.width,Ae=document.body.style.top;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top=`-${window.scrollY}px`,document.body.classList.add("mobile-menu-open"),()=>{const Ke=document.body.style.top;document.body.style.overflow=ye,document.body.style.position=xe,document.body.style.width=Le,document.body.style.top=Ae,document.body.classList.remove("mobile-menu-open"),Ke&&window.scrollTo(0,parseInt(Ke||"0")*-1)}}return()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.top="",document.body.classList.remove("mobile-menu-open")}},[q]);const ze=()=>{const ye=s.pathname,xe=new URLSearchParams(s.search);if(!["/sign-in","/sign-up","/forgot-password","/about","/search","/oauth","/user","/user/home","/user/about","/user/search","/user/profile","/user/create-listing","/user/update-listing","/user/listing","/user/wishlist","/user/appointment","/user/my-appointments","/user/my-listings","/user/change-password","/admin","/admin/appointments","/admin/about","/admin/explore","/admin/create-listing","/admin/listings","/admin/my-listings","/admin/update-listing","/admin/profile","/admin/change-password","/admin/requests","/admin/listing","/admin/appointmentlisting","/listing"].some(Ae=>ye===Ae||ye.startsWith(Ae+"/")||ye===Ae.replace(/\/$/,"")))return"bg-gradient-to-r from-blue-700 to-purple-700";if(ye==="/forgot-password"&&xe.get("step")==="2")return"bg-gradient-to-r from-green-600 to-green-700";switch(ye){case"/sign-in":return"bg-gradient-to-r from-blue-600 to-blue-700";case"/sign-up":return"bg-gradient-to-r from-green-600 to-green-700";case"/forgot-password":return"bg-gradient-to-r from-red-600 to-red-700";case"/change-password":case"/user/change-password":return"bg-gradient-to-r from-blue-600 to-blue-700";default:return"bg-gradient-to-r from-blue-700 to-purple-700"}},le=()=>{const ye=s.pathname,xe=new URLSearchParams(s.search);if(!["/sign-in","/sign-up","/forgot-password","/about","/search","/oauth","/user","/user/home","/user/about","/user/search","/user/profile","/user/create-listing","/user/update-listing","/user/listing","/user/wishlist","/user/appointment","/user/my-appointments","/user/my-listings","/user/change-password","/admin","/admin/appointments","/admin/about","/admin/explore","/admin/create-listing","/admin/listings","/admin/my-listings","/admin/update-listing","/admin/profile","/admin/change-password","/admin/requests","/admin/listing","/admin/appointmentlisting","/listing"].some(Ae=>ye===Ae||ye.startsWith(Ae+"/")||ye===Ae.replace(/\/$/,"")))return"bg-blue-500 hover:bg-blue-600";if(ye==="/forgot-password"&&xe.get("step")==="2")return"bg-green-500 hover:bg-green-600";switch(ye){case"/sign-in":return"bg-blue-500 hover:bg-blue-600";case"/sign-up":return"bg-green-500 hover:bg-green-600";case"/forgot-password":return"bg-red-500 hover:bg-red-600";case"/change-password":case"/user/change-password":return"bg-blue-500 hover:bg-blue-600";default:return"bg-blue-500 hover:bg-blue-600"}},Se=()=>{const ye=s.pathname,xe=new URLSearchParams(s.search);if(ye==="/forgot-password"&&xe.get("step")==="2")return"focus-within:ring-green-500";switch(ye){case"/sign-up":return"focus-within:ring-green-500";case"/forgot-password":return"focus-within:ring-red-500";default:return"focus-within:ring-blue-500"}},ee=ye=>{ye.preventDefault();const xe=new URLSearchParams(s.search);xe.set("searchTerm",b);const Le=xe.toString();V(h?`/user/search?${Le}`:`/search?${Le}`),Z(!1),S("")},_e=async()=>{try{const xe=await(await fetch("/api/auth/signout",{method:"GET",credentials:"include"})).json();if(xe.success===!1){console.log(xe.message);return}g(io()),await Ug.purge(),localStorage.removeItem("accessToken"),document.cookie="access_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="refresh_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="session_id=; Max-Age=0; path=/; SameSite=None; Secure",pr&&pr.connected&&pr.disconnect(),Dm(),ei.info("You have been signed out."),V("/",{replace:!0})}catch(ye){console.log(ye.message),g(io()),await Ug.purge(),localStorage.removeItem("accessToken"),document.cookie="access_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="refresh_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="session_id=; Max-Age=0; path=/; SameSite=None; Secure",pr&&pr.connected&&pr.disconnect(),Dm(),ei.info("You have been signed out."),V("/",{replace:!0})}};return _.jsxs("header",{className:`relative ${ze()} shadow-xl border-b border-white/20 sticky top-0 z-50 transition-all duration-300 ${I?"opacity-100":"opacity-0"}`,children:[_.jsx("div",{className:"bg-black/10 border-b border-white/10",children:_.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:_.jsxs("div",{className:"flex items-center justify-between py-1 text-sm text-white/80",children:[_.jsx("div",{className:"flex items-center gap-4",children:_.jsxs("span",{className:"flex items-center gap-2",children:[_.jsx(Fg,{className:"text-yellow-400"}),_.jsx("span",{children:"Premium Real Estate Platform"})]})}),_.jsxs("div",{className:"flex items-center gap-4",children:[_.jsxs("div",{className:"hidden md:flex items-center gap-4",children:[_.jsx("span",{children:" +1 (555) 123-4567"}),_.jsx("span",{children:" info@urbansetu.com"}),_.jsxs("button",{onClick:async()=>{const ye=await K4();ye.success?ei.success(ye.message):ei.error(ye.message)},className:"flex items-center gap-1 px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-sm rounded-lg transition-colors duration-200 font-medium",title:"Download Android App",children:[_.jsx(B4,{className:"text-xs"}),_.jsx("span",{children:"Download App"})]})]}),!h&&_.jsxs("div",{className:"md:hidden flex items-center gap-3",children:[_.jsxs(Fs,{to:"/sign-up",className:"flex items-center gap-1 text-white/80 hover:text-white text-sm",title:"Sign Up",children:[_.jsx(zl,{className:"text-xs"}),_.jsx("span",{children:"Sign Up"})]}),_.jsx("span",{className:"text-white/40",children:"|"}),_.jsxs(Fs,{to:"/sign-in",className:"flex items-center gap-1 text-white/80 hover:text-white text-sm",title:"Sign In",children:[_.jsx(c0,{className:"text-xs rotate-180"}),_.jsx("span",{children:"Sign In"})]})]}),h&&_.jsxs("button",{onClick:_e,className:"md:hidden flex items-center gap-1 text-white/80 hover:text-white transition-colors text-sm",title:"Sign Out",children:[_.jsx(c0,{className:"text-xs"}),_.jsx("span",{className:"text-xs",children:"Sign Out"})]})]})]})})}),_.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:_.jsxs("div",{className:"flex items-center justify-between py-2",children:[_.jsx(Fs,{to:s.pathname.startsWith("/user")?"/user":"/",className:"flex-shrink-0 group",children:_.jsxs("div",{className:"flex items-center gap-3",children:[_.jsxs("div",{className:"relative",children:[_.jsx("div",{className:"p-2 bg-white/10 backdrop-blur-sm rounded-xl border border-white/20 shadow-lg group-hover:shadow-xl transition-all duration-300 group-hover:scale-105",children:_.jsx(Fg,{className:"text-xl sm:text-2xl text-yellow-400 drop-shadow-lg"})}),_.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-xl blur opacity-30 group-hover:opacity-50 transition-opacity duration-300"})]}),_.jsxs("div",{children:[_.jsxs("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-white drop-shadow-lg",children:[_.jsx("span",{className:"bg-gradient-to-r from-yellow-400 via-orange-400 to-red-400 bg-clip-text text-transparent",children:"Urban"}),_.jsx("span",{className:"bg-gradient-to-r from-blue-400 via-purple-400 to-indigo-400 bg-clip-text text-transparent ml-1",children:"Setu"})]}),_.jsx("p",{className:"text-xs text-white/70 font-medium tracking-wider uppercase",children:"Real Estate Excellence"})]})]})}),_.jsx("nav",{className:"hidden lg:flex items-center space-x-2",children:_.jsx(J4,{})}),_.jsx("div",{className:"lg:hidden",children:_.jsx("button",{className:"p-2 text-white hover:text-yellow-300 focus:outline-none transition-all duration-300 hover:bg-white/10 rounded-lg",onClick:()=>Z(ye=>!ye),"aria-label":"Open navigation menu",children:_.jsx("div",{className:`transition-transform duration-300 ${q?"animate-hamburger-to-x":"animate-x-to-hamburger"}`,children:q?_.jsx(_o,{className:"text-lg"}):_.jsx(hS,{className:"text-lg"})})})})]})}),q&&_.jsx("div",{className:"lg:hidden",children:_.jsxs("div",{className:"fixed inset-0 z-50",children:[_.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-md animate-mobile-backdrop-in",onClick:()=>Z(!1)}),_.jsx("div",{className:"relative ml-auto w-80 max-w-sm h-full bg-white shadow-2xl transform transition-transform duration-300 ease-in-out animate-mobile-menu-in",children:_.jsxs("div",{className:"flex flex-col h-full",children:[_.jsx("div",{className:`${ze()} p-6 text-white`,children:_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsx("h2",{className:"text-xl font-bold",children:"Menu"}),_.jsx("button",{className:"p-2 hover:bg-white/20 rounded-lg transition-colors",onClick:()=>Z(!1),"aria-label":"Close menu",children:_.jsx(_o,{className:"text-xl"})})]})}),_.jsx("div",{className:"p-6 border-b border-gray-200",children:_.jsxs("form",{onSubmit:ee,className:`flex items-center bg-gray-50 rounded-xl overflow-hidden focus-within:ring-2 ${Se()} focus-within:bg-white transition-all`,children:[_.jsx("input",{type:"text",placeholder:"Search properties...",value:b,onChange:ye=>S(ye.target.value),className:"px-4 py-3 outline-none w-full text-gray-800 bg-transparent"}),_.jsx("button",{className:`${le()} text-white p-3 transition-colors`,type:"submit",children:_.jsx(Rm,{})})]})}),_.jsxs("div",{className:"p-6 border-b border-gray-200",children:[_.jsxs("button",{onClick:async()=>{const ye=await K4();ye.success?ei.success(ye.message):ei.error(ye.message),Z(!1)},className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors duration-200 font-medium",children:[_.jsx(B4,{className:"text-lg"}),_.jsx("span",{children:Gz()})]}),_.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:"Download our Android app for the best mobile experience!"})]}),_.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:_.jsx(J4,{mobile:!0,onNavigate:()=>Z(!1)})})]})})]})})]})}function J4({mobile:h=!1,onNavigate:g}){const{currentUser:b}=yo(ze=>ze.user),S=Pl(),I=bp(),N=ko(),[V,s]=ue.useState(!1),[q,Z]=ue.useState(""),Q=ue.useRef(null);ue.useEffect(()=>{V&&Q.current&&Q.current.focus()},[V]);const oe=ze=>{ze.preventDefault();const le=new URLSearchParams(N.search);le.set("searchTerm",q);const Se=le.toString();S(b?`/user/search?${Se}`:`/search?${Se}`),g&&g(),Z(""),s(!1)},de=async()=>{try{const le=await(await fetch("/api/auth/signout",{method:"GET",credentials:"include"})).json();if(le.success===!1){console.log(le.message);return}I(io()),await Ug.purge(),localStorage.removeItem("accessToken"),document.cookie="access_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="refresh_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="session_id=; Max-Age=0; path=/; SameSite=None; Secure",pr&&pr.connected&&pr.disconnect(),Dm(),ei.info("You have been signed out."),S("/",{replace:!0})}catch(ze){console.log(ze.message),I(io()),await Ug.purge(),localStorage.removeItem("accessToken"),document.cookie="access_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="refresh_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="session_id=; Max-Age=0; path=/; SameSite=None; Secure",pr&&pr.connected&&pr.disconnect(),Dm(),ei.info("You have been signed out."),S("/",{replace:!0})}};return _.jsxs("ul",{className:`${h?"flex flex-col gap-1":"flex items-center space-x-1"}`,children:[!h&&_.jsx("li",{className:"flex items-center",children:V?_.jsxs("form",{onSubmit:oe,className:"flex items-center bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg overflow-hidden focus-within:ring-2 focus-within:ring-yellow-300 focus-within:bg-white/20 transition-all duration-300 w-48",children:[_.jsx("input",{ref:Q,type:"text",placeholder:"Search...",value:q,onChange:ze=>Z(ze.target.value),onBlur:()=>s(!1),className:"px-3 py-2 outline-none w-full text-white placeholder-white/70 bg-transparent text-sm"}),_.jsx("button",{className:"bg-yellow-400 hover:bg-yellow-500 text-gray-800 p-2 transition-colors",type:"submit",children:_.jsx(Rm,{className:"text-sm"})})]}):_.jsx("button",{className:"p-2 text-white hover:text-yellow-300 focus:outline-none transition-all duration-300 hover:bg-white/10 rounded-lg",onClick:()=>s(!0),"aria-label":"Open search",children:_.jsx(Rm,{className:"text-base"})})}),_.jsx(Fs,{to:N.pathname.startsWith("/user")?"/user":"/",onClick:g,children:_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[_.jsx(Fg,{className:`${h?"text-lg text-blue-500":"text-base text-blue-500"}`}),_.jsx("span",{children:"Home"})]})}),_.jsx(Fs,{to:"/about",onClick:g,children:_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-1":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[_.jsx(d1,{className:`${h?"text-lg text-green-500":"text-base text-green-500"}`}),_.jsx("span",{children:"About"})]})}),_.jsx(Fs,{to:"/search",onClick:g,children:_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-2":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[_.jsx(dS,{className:`${h?"text-lg text-purple-500":"text-base text-purple-500"}`}),_.jsx("span",{children:"Explore"})]})}),b&&_.jsxs(_.Fragment,{children:[_.jsx(Fs,{to:"/user/services",onClick:g,children:_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-3":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[_.jsx(pS,{className:`${h?"text-lg text-purple-600":"text-base text-purple-600"}`}),_.jsx("span",{children:"Services"})]})}),_.jsx(Fs,{to:"/user/route-planner",onClick:g,children:_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-3":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[_.jsx(r0,{className:`${h?"text-lg text-green-600":"text-base text-green-600"}`}),_.jsx("span",{children:h?"Route Planner":"Route"})]})})]}),b&&_.jsxs(_.Fragment,{children:[_.jsx(Fs,{to:"/user/create-listing",onClick:g,children:_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[_.jsx(rb,{className:`${h?"text-lg text-orange-500":"text-base text-orange-500"}`}),_.jsx("span",{children:"Add Property"})]})}),_.jsx(Fs,{to:"/user/my-listings",onClick:g,children:_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-1":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[_.jsx(ib,{className:`${h?"text-lg text-indigo-500":"text-base text-indigo-500"}`}),_.jsx("span",{children:"My Listings"})]})}),_.jsx(Fs,{to:"/user/wishlist",onClick:g,children:_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-2":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[_.jsx(wI,{className:`${h?"text-lg text-red-500":"text-base text-red-500"}`}),_.jsx("span",{children:"Wish List"})]})}),_.jsx(Fs,{to:"/user/my-appointments",onClick:g,children:_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-3":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[_.jsx(_p,{className:`${h?"text-lg text-teal-500":"text-base text-teal-500"}`}),_.jsx("span",{children:"My Appointments"})]})})]}),b?_.jsxs(_.Fragment,{children:[_.jsx("li",{className:`${h?"flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium":"flex items-center relative"}`,children:_.jsx(wS,{mobile:h})}),_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium cursor-pointer animate-mobile-item-in":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base cursor-pointer flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,onClick:()=>{de(),g&&g()},children:[_.jsx(c0,{className:`${h?"text-lg text-red-500":"text-base text-red-500"}`}),_.jsx("span",{children:"Sign Out"})]}),!h&&_.jsx("li",{children:_.jsx("div",{className:"cursor-pointer transition-transform duration-300 hover:scale-110",onClick:()=>{b.role==="admin"||b.role==="rootadmin"?S("/admin/profile"):S("/user/profile"),g&&g()},title:"Profile",children:_.jsx(p1,{user:b,size:"h-7 w-7",textSize:"text-xs",showBorder:!0})})}),h&&_.jsx("li",{children:_.jsxs("div",{className:"cursor-pointer transition-transform duration-300 hover:scale-110 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 flex items-center gap-3 text-gray-700 font-medium",onClick:()=>{S("/user/profile"),g&&g()},title:"Profile",children:[_.jsx(p1,{user:b,size:"h-7 w-7",textSize:"text-xs",showBorder:!0}),_.jsx("span",{children:"Profile"})]})})]}):_.jsx(Fs,{to:"/sign-in",onClick:g,children:_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[_.jsx(zl,{className:`${h?"text-lg text-blue-500":"text-base text-blue-500"}`}),_.jsx("span",{children:"Sign In"})]})})]})}function Zz(){const{currentUser:h}=yo(lt=>lt.user),g=bp(),b=Pl(),S=ko(),[I,N]=ue.useState(""),[V,s]=ue.useState(!1),[q,Z]=ue.useState(0),[Q,oe]=ue.useState(0),de="https://urbansetu.onrender.com",[ze,le]=ue.useState(!1),[Se,ee]=ue.useState(!1),_e=ue.useRef(null);ue.useEffect(()=>{s(!0),h&&(h.role==="admin"||h.role==="rootadmin")&&h.adminApprovalStatus==="approved"&&(Ae(),Ke())},[h]),ue.useEffect(()=>{Se&&_e.current&&_e.current.focus()},[Se]),ue.useEffect(()=>{if(ze){const lt=document.body.style.overflow,zt=document.body.style.position,xt=document.body.style.width,Ci=document.body.style.top;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top=`-${window.scrollY}px`,document.body.classList.add("mobile-menu-open"),()=>{const Zi=document.body.style.top;document.body.style.overflow=lt,document.body.style.position=zt,document.body.style.width=xt,document.body.style.top=Ci,document.body.classList.remove("mobile-menu-open"),Zi&&window.scrollTo(0,parseInt(Zi||"0")*-1)}}return()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.top="",document.body.classList.remove("mobile-menu-open")}},[ze]);const ye=()=>{const lt=S.pathname,zt=new URLSearchParams(S.search);if(lt==="/forgot-password"&&zt.get("step")==="2")return"bg-gradient-to-r from-green-600 to-green-700";switch(lt){case"/sign-in":return"bg-gradient-to-r from-blue-600 to-blue-700";case"/sign-up":return"bg-gradient-to-r from-green-600 to-green-700";case"/forgot-password":return"bg-gradient-to-r from-red-600 to-red-700";case"/change-password":case"/admin/change-password":return"bg-gradient-to-r from-blue-600 to-blue-700";default:return"bg-gradient-to-r from-blue-700 to-purple-700"}},xe=()=>{const lt=S.pathname,zt=new URLSearchParams(S.search);if(lt==="/forgot-password"&&zt.get("step")==="2")return"bg-green-500 hover:bg-green-600";switch(lt){case"/sign-in":return"bg-blue-500 hover:bg-blue-600";case"/sign-up":return"bg-green-500 hover:bg-green-600";case"/forgot-password":return"bg-red-500 hover:bg-red-600";case"/change-password":case"/admin/change-password":return"bg-blue-500 hover:bg-blue-600";default:return"bg-blue-500 hover:bg-blue-600"}},Le=()=>{const lt=S.pathname,zt=new URLSearchParams(S.search);if(lt==="/forgot-password"&&zt.get("step")==="2")return"focus-within:ring-green-500";switch(lt){case"/sign-up":return"focus-within:ring-green-500";case"/forgot-password":return"focus-within:ring-red-500";default:return"focus-within:ring-blue-500"}},Ae=async()=>{try{const lt=await fetch(`${de}/api/admin/pending-requests`,{headers:{"Content-Type":"application/json"},credentials:"include"});if(lt.ok){const zt=await lt.json();Z(zt.length)}}catch(lt){console.error("Failed to fetch pending count:",lt)}},Ke=async()=>{try{const lt=await fetch(`${de}/api/bookings`,{headers:{"Content-Type":"application/json"},credentials:"include"});if(lt.ok){const zt=await lt.json();oe(zt.length)}}catch(lt){console.error("Failed to fetch appointment count:",lt)}},it=async()=>{try{g(C1());const zt=await(await fetch(`${de}/api/auth/signout`,{credentials:"include"})).json();zt.success===!1?g(vp(zt.message)):(g(io()),await Ug.purge(),Dm(),localStorage.removeItem("accessToken"),document.cookie="access_token=; Max-Age=0; path=/; domain="+window.location.hostname+"; secure; samesite=None",ei.info("You have been signed out."),b("/"))}catch(lt){g(vp(lt.message))}},rt=lt=>{lt.preventDefault(),I.trim()&&(b(`/admin/explore?searchTerm=${encodeURIComponent(I)}`),N("")),le(!1),ee(!1)};return _.jsxs("header",{className:`relative ${ye()} shadow-xl border-b border-white/20 sticky top-0 z-50 transition-all duration-300 ${V?"opacity-100":"opacity-0"}`,children:[_.jsx("div",{className:"bg-black/20 border-b border-white/10",children:_.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:_.jsxs("div",{className:"flex items-center justify-between py-1 text-sm text-white/80",children:[_.jsxs("div",{className:"flex items-center gap-4",children:[_.jsxs("span",{className:"flex items-center gap-2",children:[_.jsx(y2,{className:"text-yellow-400"}),_.jsx("span",{children:"Admin Control Panel"})]}),h&&_.jsx("span",{className:"text-xs bg-white/20 px-2 py-1 rounded-full",children:h.role==="rootadmin"?"Super Admin":"Administrator"})]}),_.jsxs("div",{className:"flex items-center gap-4",children:[_.jsxs("div",{className:"hidden md:flex items-center gap-4",children:[_.jsx("span",{children:" Secure Admin Access"}),_.jsx("span",{children:" Real-time Analytics"})]}),h&&_.jsxs("button",{onClick:it,className:"md:hidden flex items-center gap-1 text-white/80 hover:text-white transition-colors text-sm",title:"Sign Out",children:[_.jsx(c0,{className:"text-xs"}),_.jsx("span",{className:"text-xs",children:"Sign Out"})]})]})]})})}),_.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:_.jsxs("div",{className:"flex items-center justify-between py-2",children:[_.jsx(Fs,{to:"/admin",className:"flex-shrink-0 group",children:_.jsxs("div",{className:"flex items-center gap-3",children:[_.jsxs("div",{className:"relative",children:[_.jsx("div",{className:"p-2 bg-white/10 backdrop-blur-sm rounded-xl border border-white/20 shadow-lg group-hover:shadow-xl transition-all duration-300 group-hover:scale-105",children:_.jsx(y2,{className:"text-xl sm:text-2xl text-yellow-400 drop-shadow-lg"})}),_.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-xl blur opacity-30 group-hover:opacity-50 transition-opacity duration-300"})]}),_.jsxs("div",{children:[_.jsxs("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-white drop-shadow-lg",children:[_.jsx("span",{className:"bg-gradient-to-r from-yellow-400 via-orange-400 to-red-400 bg-clip-text text-transparent",children:"Admin"}),_.jsx("span",{className:"bg-gradient-to-r from-blue-400 via-purple-400 to-indigo-400 bg-clip-text text-transparent ml-1",children:"Panel"})]}),_.jsx("p",{className:"text-xs text-white/70 font-medium tracking-wider uppercase",children:"Management Dashboard"})]})]})}),_.jsxs("nav",{className:"hidden lg:flex items-center space-x-2",children:[_.jsx("div",{className:"flex items-center",children:Se?_.jsxs("form",{onSubmit:rt,className:"flex items-center bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg overflow-hidden focus-within:ring-2 focus-within:ring-yellow-300 focus-within:bg-white/20 transition-all duration-300 w-48",children:[_.jsx("input",{ref:_e,type:"text",placeholder:"Search...",value:I,onChange:lt=>N(lt.target.value),onBlur:()=>ee(!1),className:"px-3 py-2 outline-none w-full text-white placeholder-white/70 bg-transparent text-sm"}),_.jsx("button",{className:"bg-yellow-400 hover:bg-yellow-500 text-gray-800 p-2 transition-colors",type:"submit",children:_.jsx(Rm,{className:"text-sm"})})]}):_.jsx("button",{className:"p-2 text-white hover:text-yellow-300 focus:outline-none transition-all duration-300 hover:bg-white/10 rounded-lg",onClick:()=>ee(!0),"aria-label":"Open search",children:_.jsx(Rm,{className:"text-base"})})}),_.jsx(Q4,{pendingCount:q,handleSignout:it,currentUser:h})]}),_.jsx("div",{className:"lg:hidden",children:_.jsx("button",{className:"p-2 text-white hover:text-yellow-300 focus:outline-none transition-all duration-300 hover:bg-white/10 rounded-lg",onClick:()=>le(lt=>!lt),"aria-label":"Open navigation menu",children:_.jsx("div",{className:`transition-transform duration-300 ${ze?"animate-hamburger-to-x":"animate-x-to-hamburger"}`,children:ze?_.jsx(_o,{className:"text-lg"}):_.jsx(hS,{className:"text-lg"})})})})]})}),ze&&_.jsx("div",{className:"lg:hidden",children:_.jsxs("div",{className:"fixed inset-0 z-50",children:[_.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-md animate-mobile-backdrop-in",onClick:()=>le(!1)}),_.jsx("div",{className:"relative ml-auto w-80 max-w-sm h-full bg-white shadow-2xl transform transition-transform duration-300 ease-in-out animate-mobile-menu-in",children:_.jsxs("div",{className:"flex flex-col h-full",children:[_.jsx("div",{className:`${ye()} p-6 text-white`,children:_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsx("h2",{className:"text-xl font-bold",children:"Admin Menu"}),_.jsx("button",{className:"p-2 hover:bg-white/20 rounded-lg transition-colors",onClick:()=>le(!1),"aria-label":"Close menu",children:_.jsx(_o,{className:"text-xl"})})]})}),_.jsx("div",{className:"p-6 border-b border-gray-200",children:_.jsxs("form",{onSubmit:rt,className:`flex items-center bg-gray-50 rounded-xl overflow-hidden focus-within:ring-2 ${Le()} focus-within:bg-white transition-all`,children:[_.jsx("input",{type:"text",placeholder:"Search properties...",value:I,onChange:lt=>N(lt.target.value),className:"px-4 py-3 outline-none w-full text-gray-800 bg-transparent"}),_.jsx("button",{className:`${xe()} text-white p-3 transition-colors`,type:"submit",children:_.jsx(Rm,{})})]})}),_.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:_.jsx(Q4,{mobile:!0,onNavigate:()=>le(!1),pendingCount:q,handleSignout:it,currentUser:h})})]})})]})})]})}function Q4({mobile:h=!1,onNavigate:g,pendingCount:b,handleSignout:S,currentUser:I}){const N=Pl();return _.jsxs("ul",{className:`${h?"flex flex-col gap-1":"flex items-center space-x-1"}`,children:[_.jsx(Fs,{to:"/admin",onClick:g,children:_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[_.jsx(Fg,{className:`${h?"text-lg text-blue-500":"text-base text-blue-500"}`}),_.jsx("span",{children:"Dashboard"})]})}),_.jsx(Fs,{to:"/admin/create-listing",onClick:g,children:_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-1":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[_.jsx(rb,{className:`${h?"text-lg text-green-500":"text-base text-green-500"}`}),_.jsx("span",{children:"Add Property"})]})}),_.jsx(Fs,{to:"/admin/listings",onClick:g,children:_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-2":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[_.jsx(ib,{className:`${h?"text-lg text-purple-500":"text-base text-purple-500"}`}),_.jsx("span",{children:"All Listings"})]})}),_.jsx(Fs,{to:"/admin/services",onClick:g,children:_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-3":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[_.jsx(pS,{className:`${h?"text-lg text-purple-600":"text-base text-purple-600"}`}),_.jsx("span",{children:"Services"})]})}),I&&(I.role==="admin"||I.role==="rootadmin")&&I.adminApprovalStatus==="approved"&&_.jsx(Fs,{to:"/admin/requests",onClick:g,children:_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium relative animate-mobile-item-in":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base relative flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[_.jsx(y2,{className:`${h?"text-lg text-orange-500":"text-base text-orange-500"}`}),_.jsx("span",{children:"Requests"}),b>0&&_.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center",children:b})]})}),_.jsx(Fs,{to:"/admin/about",onClick:g,children:_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-1":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[_.jsx(d1,{className:`${h?"text-lg text-indigo-500":"text-base text-indigo-500"}`}),_.jsx("span",{children:"About"})]})}),_.jsx(Fs,{to:"/admin/explore",onClick:g,children:_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-2":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[_.jsx(dS,{className:`${h?"text-lg text-teal-500":"text-base text-teal-500"}`}),_.jsx("span",{children:"Explore"})]})}),_.jsx("li",{className:`${h?"flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium":"flex items-center"}`,children:_.jsx(wS,{mobile:h})}),_.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium cursor-pointer animate-mobile-item-in":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base cursor-pointer flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,onClick:()=>{S(),g&&g()},children:[_.jsx(c0,{className:`${h?"text-lg text-red-500":"text-base text-red-500"}`}),_.jsx("span",{children:"Sign Out"})]}),I&&!h&&_.jsx("li",{children:_.jsx("div",{className:"cursor-pointer transition-transform duration-300 hover:scale-110",onClick:()=>{N("/admin/profile"),g&&g()},title:"Profile",children:_.jsx(p1,{user:I,size:"h-7 w-7",textSize:"text-xs",showBorder:!0})})}),I&&h&&_.jsx("li",{children:_.jsxs("div",{className:"cursor-pointer transition-transform duration-300 hover:scale-110 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 flex items-center gap-3 text-gray-700 font-medium",onClick:()=>{N("/admin/profile"),g&&g()},title:"Profile",children:[_.jsx(p1,{user:I,size:"h-7 w-7",textSize:"text-xs",showBorder:!0}),_.jsx("span",{children:"Profile"})]})})]})}const Wz="/assets/duck-go-final-B0lh_5LI.gif",bc=(h,g="UrbanSetu")=>{ue.useEffect(()=>{const b=h?`${h}  ${g}`:g;return document.title=b,()=>{document.title="UrbanSetu  Smart Real Estate Platform for Buying, Selling & Renting Properties"}},[h,g])};function sf(){bc("404 Not Found - Page Not Found");const{currentUser:h}=yo(b=>b.user);let g="/";return h&&(h.role==="admin"||h.role==="rootadmin"?g="/admin":g="/user"),_.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-blue-50 to-purple-100 p-8",children:_.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-10 flex flex-col items-center",children:[_.jsx("img",{src:Wz,alt:"Lost duck",className:"w-100 h-100 lg:w-72 lg:h-72 object-contain mb-0"}),_.jsx("h1",{className:"text-4xl font-extrabold text-blue-700 mb-2",children:"404"}),_.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Page Not Found"}),_.jsx("p",{className:"text-gray-600 mb-6 text-center max-w-md",children:"Sorry, the page you are looking for does not exist or has been moved."}),_.jsx(Fs,{to:g,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all font-semibold",children:"Go to Home"})]})})}function Xz({bootstrapped:h}){const{currentUser:g,loading:b}=yo(S=>S.user);return!h||b?_.jsx("div",{className:"flex items-center justify-center min-h-screen",children:_.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):g&&g.role==="user"?_.jsx(i2,{}):_.jsx(sf,{})}function Yz({bootstrapped:h}){const{currentUser:g,loading:b}=yo(S=>S.user);if(!h||b)return _.jsx("div",{className:"flex items-center justify-center min-h-screen",children:_.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});if(g&&(g.role==="admin"||g.role==="rootadmin")){if(g.isDefaultAdmin)return _.jsx(i2,{});if(g.adminApprovalStatus==="approved")return _.jsx(i2,{})}return _.jsx(sf,{})}const zS=ue.createContext(),mv="https://urbansetu.onrender.com",Kz=({children:h})=>{const{currentUser:g}=yo(Q=>Q.user),[b,S]=ue.useState([]),[I,N]=ue.useState(!1),V=async()=>{if(!g){S([]);return}N(!0);try{const Q=await fetch(`${mv}/api/wishlist/user/${g._id}`,{credentials:"include"});if(Q.ok){const oe=await Q.json();if(!Array.isArray(oe)){S([]),ei.error("Session expired or unauthorized. Please sign in again."),window.location.href="/sign-in";return}const de=oe.map(ze=>ze.listingId).filter(ze=>ze!==null);S(de)}else Q.status===401?(S([]),ei.error("Session expired or unauthorized. Please sign in again."),window.location.href="/sign-in"):(console.error("Failed to fetch wishlist"),S([]))}catch(Q){console.error("Error fetching wishlist:",Q),S([])}finally{N(!1)}};ue.useEffect(()=>{function Q({type:oe,listing:de}){S(ze=>oe==="add"?ze.find(le=>le._id===de._id)?ze:[...ze,de]:oe==="remove"?ze.filter(le=>le._id!==de._id):ze)}return pr.on("wishlist_update",Q),()=>{pr.off("wishlist_update",Q)}},[]);const s=async Q=>{if(!g){console.error("User must be logged in to add to wishlist");return}S(oe=>oe.find(de=>de._id===Q._id)?oe:(ei.success("Property added to your wishlist!"),[...oe,Q])),pr.emit("wishlist_update",{type:"add",listing:Q});try{const oe=await fetch(`${mv}/api/wishlist/add`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({listingId:Q._id})});if(!oe.ok){S(ze=>ze.filter(le=>le._id!==Q._id));const de=await oe.json();console.error("Failed to add to wishlist:",de.message)}}catch(oe){S(de=>de.filter(ze=>ze._id!==Q._id)),console.error("Error adding to wishlist:",oe)}},q=async Q=>{if(!g)return console.error("User must be logged in to remove from wishlist"),{success:!1,message:"User must be logged in to remove from wishlist"};S(oe=>oe.filter(de=>de._id!==Q)),pr.emit("wishlist_update",{type:"remove",listing:{_id:Q}});try{const oe=await fetch(`${mv}/api/wishlist/remove/${Q}`,{method:"DELETE",credentials:"include"});if(!oe.ok){V();const de=await oe.json();return console.error("Failed to remove from wishlist:",de.message),{success:!1,message:"Failed to remove property. Please try again."}}return ei.success("Property removed from your wishlist."),{success:!0}}catch(oe){return V(),console.error("Error removing from wishlist:",oe),{success:!1,message:"Failed to remove property. Please try again."}}},Z=Q=>b.some(oe=>oe._id===Q);return ue.useEffect(()=>{V()},[g]),_.jsx(zS.Provider,{value:{wishlist:b,addToWishlist:s,removeFromWishlist:q,isInWishlist:Z,loading:I},children:h})},_k=()=>ue.useContext(zS);function LS(h,g){return function(){return h.apply(g,arguments)}}const{toString:Jz}=Object.prototype,{getPrototypeOf:ab}=Object,{iterator:P1,toStringTag:DS}=Symbol,O1=(h=>g=>{const b=Jz.call(g);return h[b]||(h[b]=b.slice(8,-1).toLowerCase())})(Object.create(null)),ah=h=>(h=h.toLowerCase(),g=>O1(g)===h),j1=h=>g=>typeof g===h,{isArray:$g}=Array,h0=j1("undefined");function g0(h){return h!==null&&!h0(h)&&h.constructor!==null&&!h0(h.constructor)&&Ll(h.constructor.isBuffer)&&h.constructor.isBuffer(h)}const PS=ah("ArrayBuffer");function Qz(h){let g;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?g=ArrayBuffer.isView(h):g=h&&h.buffer&&PS(h.buffer),g}const eL=j1("string"),Ll=j1("function"),OS=j1("number"),_0=h=>h!==null&&typeof h=="object",tL=h=>h===!0||h===!1,Zy=h=>{if(O1(h)!=="object")return!1;const g=ab(h);return(g===null||g===Object.prototype||Object.getPrototypeOf(g)===null)&&!(DS in h)&&!(P1 in h)},iL=h=>{if(!_0(h)||g0(h))return!1;try{return Object.keys(h).length===0&&Object.getPrototypeOf(h)===Object.prototype}catch{return!1}},rL=ah("Date"),nL=ah("File"),sL=ah("Blob"),aL=ah("FileList"),oL=h=>_0(h)&&Ll(h.pipe),lL=h=>{let g;return h&&(typeof FormData=="function"&&h instanceof FormData||Ll(h.append)&&((g=O1(h))==="formdata"||g==="object"&&Ll(h.toString)&&h.toString()==="[object FormData]"))},cL=ah("URLSearchParams"),[uL,hL,dL,fL]=["ReadableStream","Request","Response","Headers"].map(ah),pL=h=>h.trim?h.trim():h.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function y0(h,g,{allOwnKeys:b=!1}={}){if(h===null||typeof h>"u")return;let S,I;if(typeof h!="object"&&(h=[h]),$g(h))for(S=0,I=h.length;S<I;S++)g.call(null,h[S],S,h);else{if(g0(h))return;const N=b?Object.getOwnPropertyNames(h):Object.keys(h),V=N.length;let s;for(S=0;S<V;S++)s=N[S],g.call(null,h[s],s,h)}}function jS(h,g){if(g0(h))return null;g=g.toLowerCase();const b=Object.keys(h);let S=b.length,I;for(;S-- >0;)if(I=b[S],g===I.toLowerCase())return I;return null}const Em=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,NS=h=>!h0(h)&&h!==Em;function S2(){const{caseless:h}=NS(this)&&this||{},g={},b=(S,I)=>{const N=h&&jS(g,I)||I;Zy(g[N])&&Zy(S)?g[N]=S2(g[N],S):Zy(S)?g[N]=S2({},S):$g(S)?g[N]=S.slice():g[N]=S};for(let S=0,I=arguments.length;S<I;S++)arguments[S]&&y0(arguments[S],b);return g}const mL=(h,g,b,{allOwnKeys:S}={})=>(y0(g,(I,N)=>{b&&Ll(I)?h[N]=LS(I,b):h[N]=I},{allOwnKeys:S}),h),gL=h=>(h.charCodeAt(0)===65279&&(h=h.slice(1)),h),_L=(h,g,b,S)=>{h.prototype=Object.create(g.prototype,S),h.prototype.constructor=h,Object.defineProperty(h,"super",{value:g.prototype}),b&&Object.assign(h.prototype,b)},yL=(h,g,b,S)=>{let I,N,V;const s={};if(g=g||{},h==null)return g;do{for(I=Object.getOwnPropertyNames(h),N=I.length;N-- >0;)V=I[N],(!S||S(V,h,g))&&!s[V]&&(g[V]=h[V],s[V]=!0);h=b!==!1&&ab(h)}while(h&&(!b||b(h,g))&&h!==Object.prototype);return g},xL=(h,g,b)=>{h=String(h),(b===void 0||b>h.length)&&(b=h.length),b-=g.length;const S=h.indexOf(g,b);return S!==-1&&S===b},vL=h=>{if(!h)return null;if($g(h))return h;let g=h.length;if(!OS(g))return null;const b=new Array(g);for(;g-- >0;)b[g]=h[g];return b},bL=(h=>g=>h&&g instanceof h)(typeof Uint8Array<"u"&&ab(Uint8Array)),wL=(h,g)=>{const S=(h&&h[P1]).call(h);let I;for(;(I=S.next())&&!I.done;){const N=I.value;g.call(h,N[0],N[1])}},TL=(h,g)=>{let b;const S=[];for(;(b=h.exec(g))!==null;)S.push(b);return S},SL=ah("HTMLFormElement"),EL=h=>h.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(b,S,I){return S.toUpperCase()+I}),e6=(({hasOwnProperty:h})=>(g,b)=>h.call(g,b))(Object.prototype),AL=ah("RegExp"),kS=(h,g)=>{const b=Object.getOwnPropertyDescriptors(h),S={};y0(b,(I,N)=>{let V;(V=g(I,N,h))!==!1&&(S[N]=V||I)}),Object.defineProperties(h,S)},CL=h=>{kS(h,(g,b)=>{if(Ll(h)&&["arguments","caller","callee"].indexOf(b)!==-1)return!1;const S=h[b];if(Ll(S)){if(g.enumerable=!1,"writable"in g){g.writable=!1;return}g.set||(g.set=()=>{throw Error("Can not rewrite read-only method '"+b+"'")})}})},RL=(h,g)=>{const b={},S=I=>{I.forEach(N=>{b[N]=!0})};return $g(h)?S(h):S(String(h).split(g)),b},ML=()=>{},IL=(h,g)=>h!=null&&Number.isFinite(h=+h)?h:g;function zL(h){return!!(h&&Ll(h.append)&&h[DS]==="FormData"&&h[P1])}const LL=h=>{const g=new Array(10),b=(S,I)=>{if(_0(S)){if(g.indexOf(S)>=0)return;if(g0(S))return S;if(!("toJSON"in S)){g[I]=S;const N=$g(S)?[]:{};return y0(S,(V,s)=>{const q=b(V,I+1);!h0(q)&&(N[s]=q)}),g[I]=void 0,N}}return S};return b(h,0)},DL=ah("AsyncFunction"),PL=h=>h&&(_0(h)||Ll(h))&&Ll(h.then)&&Ll(h.catch),BS=((h,g)=>h?setImmediate:g?((b,S)=>(Em.addEventListener("message",({source:I,data:N})=>{I===Em&&N===b&&S.length&&S.shift()()},!1),I=>{S.push(I),Em.postMessage(b,"*")}))(`axios@${Math.random()}`,[]):b=>setTimeout(b))(typeof setImmediate=="function",Ll(Em.postMessage)),OL=typeof queueMicrotask<"u"?queueMicrotask.bind(Em):typeof process<"u"&&process.nextTick||BS,jL=h=>h!=null&&Ll(h[P1]),Kt={isArray:$g,isArrayBuffer:PS,isBuffer:g0,isFormData:lL,isArrayBufferView:Qz,isString:eL,isNumber:OS,isBoolean:tL,isObject:_0,isPlainObject:Zy,isEmptyObject:iL,isReadableStream:uL,isRequest:hL,isResponse:dL,isHeaders:fL,isUndefined:h0,isDate:rL,isFile:nL,isBlob:sL,isRegExp:AL,isFunction:Ll,isStream:oL,isURLSearchParams:cL,isTypedArray:bL,isFileList:aL,forEach:y0,merge:S2,extend:mL,trim:pL,stripBOM:gL,inherits:_L,toFlatObject:yL,kindOf:O1,kindOfTest:ah,endsWith:xL,toArray:vL,forEachEntry:wL,matchAll:TL,isHTMLForm:SL,hasOwnProperty:e6,hasOwnProp:e6,reduceDescriptors:kS,freezeMethods:CL,toObjectSet:RL,toCamelCase:EL,noop:ML,toFiniteNumber:IL,findKey:jS,global:Em,isContextDefined:NS,isSpecCompliantForm:zL,toJSONObject:LL,isAsyncFn:DL,isThenable:PL,setImmediate:BS,asap:OL,isIterable:jL};function pn(h,g,b,S,I){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=h,this.name="AxiosError",g&&(this.code=g),b&&(this.config=b),S&&(this.request=S),I&&(this.response=I,this.status=I.status?I.status:null)}Kt.inherits(pn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Kt.toJSONObject(this.config),code:this.code,status:this.status}}});const FS=pn.prototype,US={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(h=>{US[h]={value:h}});Object.defineProperties(pn,US);Object.defineProperty(FS,"isAxiosError",{value:!0});pn.from=(h,g,b,S,I,N)=>{const V=Object.create(FS);return Kt.toFlatObject(h,V,function(q){return q!==Error.prototype},s=>s!=="isAxiosError"),pn.call(V,h.message,g,b,S,I),V.cause=h,V.name=h.name,N&&Object.assign(V,N),V};const NL=null;function E2(h){return Kt.isPlainObject(h)||Kt.isArray(h)}function VS(h){return Kt.endsWith(h,"[]")?h.slice(0,-2):h}function t6(h,g,b){return h?h.concat(g).map(function(I,N){return I=VS(I),!b&&N?"["+I+"]":I}).join(b?".":""):g}function kL(h){return Kt.isArray(h)&&!h.some(E2)}const BL=Kt.toFlatObject(Kt,{},null,function(g){return/^is[A-Z]/.test(g)});function N1(h,g,b){if(!Kt.isObject(h))throw new TypeError("target must be an object");g=g||new FormData,b=Kt.toFlatObject(b,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Se,ee){return!Kt.isUndefined(ee[Se])});const S=b.metaTokens,I=b.visitor||Q,N=b.dots,V=b.indexes,q=(b.Blob||typeof Blob<"u"&&Blob)&&Kt.isSpecCompliantForm(g);if(!Kt.isFunction(I))throw new TypeError("visitor must be a function");function Z(le){if(le===null)return"";if(Kt.isDate(le))return le.toISOString();if(Kt.isBoolean(le))return le.toString();if(!q&&Kt.isBlob(le))throw new pn("Blob is not supported. Use a Buffer instead.");return Kt.isArrayBuffer(le)||Kt.isTypedArray(le)?q&&typeof Blob=="function"?new Blob([le]):Buffer.from(le):le}function Q(le,Se,ee){let _e=le;if(le&&!ee&&typeof le=="object"){if(Kt.endsWith(Se,"{}"))Se=S?Se:Se.slice(0,-2),le=JSON.stringify(le);else if(Kt.isArray(le)&&kL(le)||(Kt.isFileList(le)||Kt.endsWith(Se,"[]"))&&(_e=Kt.toArray(le)))return Se=VS(Se),_e.forEach(function(xe,Le){!(Kt.isUndefined(xe)||xe===null)&&g.append(V===!0?t6([Se],Le,N):V===null?Se:Se+"[]",Z(xe))}),!1}return E2(le)?!0:(g.append(t6(ee,Se,N),Z(le)),!1)}const oe=[],de=Object.assign(BL,{defaultVisitor:Q,convertValue:Z,isVisitable:E2});function ze(le,Se){if(!Kt.isUndefined(le)){if(oe.indexOf(le)!==-1)throw Error("Circular reference detected in "+Se.join("."));oe.push(le),Kt.forEach(le,function(_e,ye){(!(Kt.isUndefined(_e)||_e===null)&&I.call(g,_e,Kt.isString(ye)?ye.trim():ye,Se,de))===!0&&ze(_e,Se?Se.concat(ye):[ye])}),oe.pop()}}if(!Kt.isObject(h))throw new TypeError("data must be an object");return ze(h),g}function i6(h){const g={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(h).replace(/[!'()~]|%20|%00/g,function(S){return g[S]})}function ob(h,g){this._pairs=[],h&&N1(h,this,g)}const HS=ob.prototype;HS.append=function(g,b){this._pairs.push([g,b])};HS.toString=function(g){const b=g?function(S){return g.call(this,S,i6)}:i6;return this._pairs.map(function(I){return b(I[0])+"="+b(I[1])},"").join("&")};function FL(h){return encodeURIComponent(h).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function qS(h,g,b){if(!g)return h;const S=b&&b.encode||FL;Kt.isFunction(b)&&(b={serialize:b});const I=b&&b.serialize;let N;if(I?N=I(g,b):N=Kt.isURLSearchParams(g)?g.toString():new ob(g,b).toString(S),N){const V=h.indexOf("#");V!==-1&&(h=h.slice(0,V)),h+=(h.indexOf("?")===-1?"?":"&")+N}return h}class r6{constructor(){this.handlers=[]}use(g,b,S){return this.handlers.push({fulfilled:g,rejected:b,synchronous:S?S.synchronous:!1,runWhen:S?S.runWhen:null}),this.handlers.length-1}eject(g){this.handlers[g]&&(this.handlers[g]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(g){Kt.forEach(this.handlers,function(S){S!==null&&g(S)})}}const GS={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},UL=typeof URLSearchParams<"u"?URLSearchParams:ob,VL=typeof FormData<"u"?FormData:null,HL=typeof Blob<"u"?Blob:null,qL={isBrowser:!0,classes:{URLSearchParams:UL,FormData:VL,Blob:HL},protocols:["http","https","file","blob","url","data"]},lb=typeof window<"u"&&typeof document<"u",A2=typeof navigator=="object"&&navigator||void 0,GL=lb&&(!A2||["ReactNative","NativeScript","NS"].indexOf(A2.product)<0),$L=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ZL=lb&&window.location.href||"http://localhost",WL=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:lb,hasStandardBrowserEnv:GL,hasStandardBrowserWebWorkerEnv:$L,navigator:A2,origin:ZL},Symbol.toStringTag,{value:"Module"})),No={...WL,...qL};function XL(h,g){return N1(h,new No.classes.URLSearchParams,{visitor:function(b,S,I,N){return No.isNode&&Kt.isBuffer(b)?(this.append(S,b.toString("base64")),!1):N.defaultVisitor.apply(this,arguments)},...g})}function YL(h){return Kt.matchAll(/\w+|\[(\w*)]/g,h).map(g=>g[0]==="[]"?"":g[1]||g[0])}function KL(h){const g={},b=Object.keys(h);let S;const I=b.length;let N;for(S=0;S<I;S++)N=b[S],g[N]=h[N];return g}function $S(h){function g(b,S,I,N){let V=b[N++];if(V==="__proto__")return!0;const s=Number.isFinite(+V),q=N>=b.length;return V=!V&&Kt.isArray(I)?I.length:V,q?(Kt.hasOwnProp(I,V)?I[V]=[I[V],S]:I[V]=S,!s):((!I[V]||!Kt.isObject(I[V]))&&(I[V]=[]),g(b,S,I[V],N)&&Kt.isArray(I[V])&&(I[V]=KL(I[V])),!s)}if(Kt.isFormData(h)&&Kt.isFunction(h.entries)){const b={};return Kt.forEachEntry(h,(S,I)=>{g(YL(S),I,b,0)}),b}return null}function JL(h,g,b){if(Kt.isString(h))try{return(g||JSON.parse)(h),Kt.trim(h)}catch(S){if(S.name!=="SyntaxError")throw S}return(b||JSON.stringify)(h)}const x0={transitional:GS,adapter:["xhr","http","fetch"],transformRequest:[function(g,b){const S=b.getContentType()||"",I=S.indexOf("application/json")>-1,N=Kt.isObject(g);if(N&&Kt.isHTMLForm(g)&&(g=new FormData(g)),Kt.isFormData(g))return I?JSON.stringify($S(g)):g;if(Kt.isArrayBuffer(g)||Kt.isBuffer(g)||Kt.isStream(g)||Kt.isFile(g)||Kt.isBlob(g)||Kt.isReadableStream(g))return g;if(Kt.isArrayBufferView(g))return g.buffer;if(Kt.isURLSearchParams(g))return b.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),g.toString();let s;if(N){if(S.indexOf("application/x-www-form-urlencoded")>-1)return XL(g,this.formSerializer).toString();if((s=Kt.isFileList(g))||S.indexOf("multipart/form-data")>-1){const q=this.env&&this.env.FormData;return N1(s?{"files[]":g}:g,q&&new q,this.formSerializer)}}return N||I?(b.setContentType("application/json",!1),JL(g)):g}],transformResponse:[function(g){const b=this.transitional||x0.transitional,S=b&&b.forcedJSONParsing,I=this.responseType==="json";if(Kt.isResponse(g)||Kt.isReadableStream(g))return g;if(g&&Kt.isString(g)&&(S&&!this.responseType||I)){const V=!(b&&b.silentJSONParsing)&&I;try{return JSON.parse(g)}catch(s){if(V)throw s.name==="SyntaxError"?pn.from(s,pn.ERR_BAD_RESPONSE,this,null,this.response):s}}return g}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:No.classes.FormData,Blob:No.classes.Blob},validateStatus:function(g){return g>=200&&g<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Kt.forEach(["delete","get","head","post","put","patch"],h=>{x0.headers[h]={}});const QL=Kt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),eD=h=>{const g={};let b,S,I;return h&&h.split(`
`).forEach(function(V){I=V.indexOf(":"),b=V.substring(0,I).trim().toLowerCase(),S=V.substring(I+1).trim(),!(!b||g[b]&&QL[b])&&(b==="set-cookie"?g[b]?g[b].push(S):g[b]=[S]:g[b]=g[b]?g[b]+", "+S:S)}),g},n6=Symbol("internals");function Q_(h){return h&&String(h).trim().toLowerCase()}function Wy(h){return h===!1||h==null?h:Kt.isArray(h)?h.map(Wy):String(h)}function tD(h){const g=Object.create(null),b=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let S;for(;S=b.exec(h);)g[S[1]]=S[2];return g}const iD=h=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(h.trim());function gv(h,g,b,S,I){if(Kt.isFunction(S))return S.call(this,g,b);if(I&&(g=b),!!Kt.isString(g)){if(Kt.isString(S))return g.indexOf(S)!==-1;if(Kt.isRegExp(S))return S.test(g)}}function rD(h){return h.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(g,b,S)=>b.toUpperCase()+S)}function nD(h,g){const b=Kt.toCamelCase(" "+g);["get","set","has"].forEach(S=>{Object.defineProperty(h,S+b,{value:function(I,N,V){return this[S].call(this,g,I,N,V)},configurable:!0})})}let Dl=class{constructor(g){g&&this.set(g)}set(g,b,S){const I=this;function N(s,q,Z){const Q=Q_(q);if(!Q)throw new Error("header name must be a non-empty string");const oe=Kt.findKey(I,Q);(!oe||I[oe]===void 0||Z===!0||Z===void 0&&I[oe]!==!1)&&(I[oe||q]=Wy(s))}const V=(s,q)=>Kt.forEach(s,(Z,Q)=>N(Z,Q,q));if(Kt.isPlainObject(g)||g instanceof this.constructor)V(g,b);else if(Kt.isString(g)&&(g=g.trim())&&!iD(g))V(eD(g),b);else if(Kt.isObject(g)&&Kt.isIterable(g)){let s={},q,Z;for(const Q of g){if(!Kt.isArray(Q))throw TypeError("Object iterator must return a key-value pair");s[Z=Q[0]]=(q=s[Z])?Kt.isArray(q)?[...q,Q[1]]:[q,Q[1]]:Q[1]}V(s,b)}else g!=null&&N(b,g,S);return this}get(g,b){if(g=Q_(g),g){const S=Kt.findKey(this,g);if(S){const I=this[S];if(!b)return I;if(b===!0)return tD(I);if(Kt.isFunction(b))return b.call(this,I,S);if(Kt.isRegExp(b))return b.exec(I);throw new TypeError("parser must be boolean|regexp|function")}}}has(g,b){if(g=Q_(g),g){const S=Kt.findKey(this,g);return!!(S&&this[S]!==void 0&&(!b||gv(this,this[S],S,b)))}return!1}delete(g,b){const S=this;let I=!1;function N(V){if(V=Q_(V),V){const s=Kt.findKey(S,V);s&&(!b||gv(S,S[s],s,b))&&(delete S[s],I=!0)}}return Kt.isArray(g)?g.forEach(N):N(g),I}clear(g){const b=Object.keys(this);let S=b.length,I=!1;for(;S--;){const N=b[S];(!g||gv(this,this[N],N,g,!0))&&(delete this[N],I=!0)}return I}normalize(g){const b=this,S={};return Kt.forEach(this,(I,N)=>{const V=Kt.findKey(S,N);if(V){b[V]=Wy(I),delete b[N];return}const s=g?rD(N):String(N).trim();s!==N&&delete b[N],b[s]=Wy(I),S[s]=!0}),this}concat(...g){return this.constructor.concat(this,...g)}toJSON(g){const b=Object.create(null);return Kt.forEach(this,(S,I)=>{S!=null&&S!==!1&&(b[I]=g&&Kt.isArray(S)?S.join(", "):S)}),b}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([g,b])=>g+": "+b).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(g){return g instanceof this?g:new this(g)}static concat(g,...b){const S=new this(g);return b.forEach(I=>S.set(I)),S}static accessor(g){const S=(this[n6]=this[n6]={accessors:{}}).accessors,I=this.prototype;function N(V){const s=Q_(V);S[s]||(nD(I,V),S[s]=!0)}return Kt.isArray(g)?g.forEach(N):N(g),this}};Dl.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Kt.reduceDescriptors(Dl.prototype,({value:h},g)=>{let b=g[0].toUpperCase()+g.slice(1);return{get:()=>h,set(S){this[b]=S}}});Kt.freezeMethods(Dl);function _v(h,g){const b=this||x0,S=g||b,I=Dl.from(S.headers);let N=S.data;return Kt.forEach(h,function(s){N=s.call(b,N,I.normalize(),g?g.status:void 0)}),I.normalize(),N}function ZS(h){return!!(h&&h.__CANCEL__)}function Zg(h,g,b){pn.call(this,h??"canceled",pn.ERR_CANCELED,g,b),this.name="CanceledError"}Kt.inherits(Zg,pn,{__CANCEL__:!0});function WS(h,g,b){const S=b.config.validateStatus;!b.status||!S||S(b.status)?h(b):g(new pn("Request failed with status code "+b.status,[pn.ERR_BAD_REQUEST,pn.ERR_BAD_RESPONSE][Math.floor(b.status/100)-4],b.config,b.request,b))}function sD(h){const g=/^([-+\w]{1,25})(:?\/\/|:)/.exec(h);return g&&g[1]||""}function aD(h,g){h=h||10;const b=new Array(h),S=new Array(h);let I=0,N=0,V;return g=g!==void 0?g:1e3,function(q){const Z=Date.now(),Q=S[N];V||(V=Z),b[I]=q,S[I]=Z;let oe=N,de=0;for(;oe!==I;)de+=b[oe++],oe=oe%h;if(I=(I+1)%h,I===N&&(N=(N+1)%h),Z-V<g)return;const ze=Q&&Z-Q;return ze?Math.round(de*1e3/ze):void 0}}function oD(h,g){let b=0,S=1e3/g,I,N;const V=(Z,Q=Date.now())=>{b=Q,I=null,N&&(clearTimeout(N),N=null),h(...Z)};return[(...Z)=>{const Q=Date.now(),oe=Q-b;oe>=S?V(Z,Q):(I=Z,N||(N=setTimeout(()=>{N=null,V(I)},S-oe)))},()=>I&&V(I)]}const m1=(h,g,b=3)=>{let S=0;const I=aD(50,250);return oD(N=>{const V=N.loaded,s=N.lengthComputable?N.total:void 0,q=V-S,Z=I(q),Q=V<=s;S=V;const oe={loaded:V,total:s,progress:s?V/s:void 0,bytes:q,rate:Z||void 0,estimated:Z&&s&&Q?(s-V)/Z:void 0,event:N,lengthComputable:s!=null,[g?"download":"upload"]:!0};h(oe)},b)},s6=(h,g)=>{const b=h!=null;return[S=>g[0]({lengthComputable:b,total:h,loaded:S}),g[1]]},a6=h=>(...g)=>Kt.asap(()=>h(...g)),lD=No.hasStandardBrowserEnv?((h,g)=>b=>(b=new URL(b,No.origin),h.protocol===b.protocol&&h.host===b.host&&(g||h.port===b.port)))(new URL(No.origin),No.navigator&&/(msie|trident)/i.test(No.navigator.userAgent)):()=>!0,cD=No.hasStandardBrowserEnv?{write(h,g,b,S,I,N){const V=[h+"="+encodeURIComponent(g)];Kt.isNumber(b)&&V.push("expires="+new Date(b).toGMTString()),Kt.isString(S)&&V.push("path="+S),Kt.isString(I)&&V.push("domain="+I),N===!0&&V.push("secure"),document.cookie=V.join("; ")},read(h){const g=document.cookie.match(new RegExp("(^|;\\s*)("+h+")=([^;]*)"));return g?decodeURIComponent(g[3]):null},remove(h){this.write(h,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function uD(h){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(h)}function hD(h,g){return g?h.replace(/\/?\/$/,"")+"/"+g.replace(/^\/+/,""):h}function XS(h,g,b){let S=!uD(g);return h&&(S||b==!1)?hD(h,g):g}const o6=h=>h instanceof Dl?{...h}:h;function Om(h,g){g=g||{};const b={};function S(Z,Q,oe,de){return Kt.isPlainObject(Z)&&Kt.isPlainObject(Q)?Kt.merge.call({caseless:de},Z,Q):Kt.isPlainObject(Q)?Kt.merge({},Q):Kt.isArray(Q)?Q.slice():Q}function I(Z,Q,oe,de){if(Kt.isUndefined(Q)){if(!Kt.isUndefined(Z))return S(void 0,Z,oe,de)}else return S(Z,Q,oe,de)}function N(Z,Q){if(!Kt.isUndefined(Q))return S(void 0,Q)}function V(Z,Q){if(Kt.isUndefined(Q)){if(!Kt.isUndefined(Z))return S(void 0,Z)}else return S(void 0,Q)}function s(Z,Q,oe){if(oe in g)return S(Z,Q);if(oe in h)return S(void 0,Z)}const q={url:N,method:N,data:N,baseURL:V,transformRequest:V,transformResponse:V,paramsSerializer:V,timeout:V,timeoutMessage:V,withCredentials:V,withXSRFToken:V,adapter:V,responseType:V,xsrfCookieName:V,xsrfHeaderName:V,onUploadProgress:V,onDownloadProgress:V,decompress:V,maxContentLength:V,maxBodyLength:V,beforeRedirect:V,transport:V,httpAgent:V,httpsAgent:V,cancelToken:V,socketPath:V,responseEncoding:V,validateStatus:s,headers:(Z,Q,oe)=>I(o6(Z),o6(Q),oe,!0)};return Kt.forEach(Object.keys({...h,...g}),function(Q){const oe=q[Q]||I,de=oe(h[Q],g[Q],Q);Kt.isUndefined(de)&&oe!==s||(b[Q]=de)}),b}const YS=h=>{const g=Om({},h);let{data:b,withXSRFToken:S,xsrfHeaderName:I,xsrfCookieName:N,headers:V,auth:s}=g;g.headers=V=Dl.from(V),g.url=qS(XS(g.baseURL,g.url,g.allowAbsoluteUrls),h.params,h.paramsSerializer),s&&V.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):"")));let q;if(Kt.isFormData(b)){if(No.hasStandardBrowserEnv||No.hasStandardBrowserWebWorkerEnv)V.setContentType(void 0);else if((q=V.getContentType())!==!1){const[Z,...Q]=q?q.split(";").map(oe=>oe.trim()).filter(Boolean):[];V.setContentType([Z||"multipart/form-data",...Q].join("; "))}}if(No.hasStandardBrowserEnv&&(S&&Kt.isFunction(S)&&(S=S(g)),S||S!==!1&&lD(g.url))){const Z=I&&N&&cD.read(N);Z&&V.set(I,Z)}return g},dD=typeof XMLHttpRequest<"u",fD=dD&&function(h){return new Promise(function(b,S){const I=YS(h);let N=I.data;const V=Dl.from(I.headers).normalize();let{responseType:s,onUploadProgress:q,onDownloadProgress:Z}=I,Q,oe,de,ze,le;function Se(){ze&&ze(),le&&le(),I.cancelToken&&I.cancelToken.unsubscribe(Q),I.signal&&I.signal.removeEventListener("abort",Q)}let ee=new XMLHttpRequest;ee.open(I.method.toUpperCase(),I.url,!0),ee.timeout=I.timeout;function _e(){if(!ee)return;const xe=Dl.from("getAllResponseHeaders"in ee&&ee.getAllResponseHeaders()),Ae={data:!s||s==="text"||s==="json"?ee.responseText:ee.response,status:ee.status,statusText:ee.statusText,headers:xe,config:h,request:ee};WS(function(it){b(it),Se()},function(it){S(it),Se()},Ae),ee=null}"onloadend"in ee?ee.onloadend=_e:ee.onreadystatechange=function(){!ee||ee.readyState!==4||ee.status===0&&!(ee.responseURL&&ee.responseURL.indexOf("file:")===0)||setTimeout(_e)},ee.onabort=function(){ee&&(S(new pn("Request aborted",pn.ECONNABORTED,h,ee)),ee=null)},ee.onerror=function(){S(new pn("Network Error",pn.ERR_NETWORK,h,ee)),ee=null},ee.ontimeout=function(){let Le=I.timeout?"timeout of "+I.timeout+"ms exceeded":"timeout exceeded";const Ae=I.transitional||GS;I.timeoutErrorMessage&&(Le=I.timeoutErrorMessage),S(new pn(Le,Ae.clarifyTimeoutError?pn.ETIMEDOUT:pn.ECONNABORTED,h,ee)),ee=null},N===void 0&&V.setContentType(null),"setRequestHeader"in ee&&Kt.forEach(V.toJSON(),function(Le,Ae){ee.setRequestHeader(Ae,Le)}),Kt.isUndefined(I.withCredentials)||(ee.withCredentials=!!I.withCredentials),s&&s!=="json"&&(ee.responseType=I.responseType),Z&&([de,le]=m1(Z,!0),ee.addEventListener("progress",de)),q&&ee.upload&&([oe,ze]=m1(q),ee.upload.addEventListener("progress",oe),ee.upload.addEventListener("loadend",ze)),(I.cancelToken||I.signal)&&(Q=xe=>{ee&&(S(!xe||xe.type?new Zg(null,h,ee):xe),ee.abort(),ee=null)},I.cancelToken&&I.cancelToken.subscribe(Q),I.signal&&(I.signal.aborted?Q():I.signal.addEventListener("abort",Q)));const ye=sD(I.url);if(ye&&No.protocols.indexOf(ye)===-1){S(new pn("Unsupported protocol "+ye+":",pn.ERR_BAD_REQUEST,h));return}ee.send(N||null)})},pD=(h,g)=>{const{length:b}=h=h?h.filter(Boolean):[];if(g||b){let S=new AbortController,I;const N=function(Z){if(!I){I=!0,s();const Q=Z instanceof Error?Z:this.reason;S.abort(Q instanceof pn?Q:new Zg(Q instanceof Error?Q.message:Q))}};let V=g&&setTimeout(()=>{V=null,N(new pn(`timeout ${g} of ms exceeded`,pn.ETIMEDOUT))},g);const s=()=>{h&&(V&&clearTimeout(V),V=null,h.forEach(Z=>{Z.unsubscribe?Z.unsubscribe(N):Z.removeEventListener("abort",N)}),h=null)};h.forEach(Z=>Z.addEventListener("abort",N));const{signal:q}=S;return q.unsubscribe=()=>Kt.asap(s),q}},mD=function*(h,g){let b=h.byteLength;if(b<g){yield h;return}let S=0,I;for(;S<b;)I=S+g,yield h.slice(S,I),S=I},gD=async function*(h,g){for await(const b of _D(h))yield*mD(b,g)},_D=async function*(h){if(h[Symbol.asyncIterator]){yield*h;return}const g=h.getReader();try{for(;;){const{done:b,value:S}=await g.read();if(b)break;yield S}}finally{await g.cancel()}},l6=(h,g,b,S)=>{const I=gD(h,g);let N=0,V,s=q=>{V||(V=!0,S&&S(q))};return new ReadableStream({async pull(q){try{const{done:Z,value:Q}=await I.next();if(Z){s(),q.close();return}let oe=Q.byteLength;if(b){let de=N+=oe;b(de)}q.enqueue(new Uint8Array(Q))}catch(Z){throw s(Z),Z}},cancel(q){return s(q),I.return()}},{highWaterMark:2})},k1=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",KS=k1&&typeof ReadableStream=="function",yD=k1&&(typeof TextEncoder=="function"?(h=>g=>h.encode(g))(new TextEncoder):async h=>new Uint8Array(await new Response(h).arrayBuffer())),JS=(h,...g)=>{try{return!!h(...g)}catch{return!1}},xD=KS&&JS(()=>{let h=!1;const g=new Request(No.origin,{body:new ReadableStream,method:"POST",get duplex(){return h=!0,"half"}}).headers.has("Content-Type");return h&&!g}),c6=64*1024,C2=KS&&JS(()=>Kt.isReadableStream(new Response("").body)),g1={stream:C2&&(h=>h.body)};k1&&(h=>{["text","arrayBuffer","blob","formData","stream"].forEach(g=>{!g1[g]&&(g1[g]=Kt.isFunction(h[g])?b=>b[g]():(b,S)=>{throw new pn(`Response type '${g}' is not supported`,pn.ERR_NOT_SUPPORT,S)})})})(new Response);const vD=async h=>{if(h==null)return 0;if(Kt.isBlob(h))return h.size;if(Kt.isSpecCompliantForm(h))return(await new Request(No.origin,{method:"POST",body:h}).arrayBuffer()).byteLength;if(Kt.isArrayBufferView(h)||Kt.isArrayBuffer(h))return h.byteLength;if(Kt.isURLSearchParams(h)&&(h=h+""),Kt.isString(h))return(await yD(h)).byteLength},bD=async(h,g)=>{const b=Kt.toFiniteNumber(h.getContentLength());return b??vD(g)},wD=k1&&(async h=>{let{url:g,method:b,data:S,signal:I,cancelToken:N,timeout:V,onDownloadProgress:s,onUploadProgress:q,responseType:Z,headers:Q,withCredentials:oe="same-origin",fetchOptions:de}=YS(h);Z=Z?(Z+"").toLowerCase():"text";let ze=pD([I,N&&N.toAbortSignal()],V),le;const Se=ze&&ze.unsubscribe&&(()=>{ze.unsubscribe()});let ee;try{if(q&&xD&&b!=="get"&&b!=="head"&&(ee=await bD(Q,S))!==0){let Ae=new Request(g,{method:"POST",body:S,duplex:"half"}),Ke;if(Kt.isFormData(S)&&(Ke=Ae.headers.get("content-type"))&&Q.setContentType(Ke),Ae.body){const[it,rt]=s6(ee,m1(a6(q)));S=l6(Ae.body,c6,it,rt)}}Kt.isString(oe)||(oe=oe?"include":"omit");const _e="credentials"in Request.prototype;le=new Request(g,{...de,signal:ze,method:b.toUpperCase(),headers:Q.normalize().toJSON(),body:S,duplex:"half",credentials:_e?oe:void 0});let ye=await fetch(le,de);const xe=C2&&(Z==="stream"||Z==="response");if(C2&&(s||xe&&Se)){const Ae={};["status","statusText","headers"].forEach(lt=>{Ae[lt]=ye[lt]});const Ke=Kt.toFiniteNumber(ye.headers.get("content-length")),[it,rt]=s&&s6(Ke,m1(a6(s),!0))||[];ye=new Response(l6(ye.body,c6,it,()=>{rt&&rt(),Se&&Se()}),Ae)}Z=Z||"text";let Le=await g1[Kt.findKey(g1,Z)||"text"](ye,h);return!xe&&Se&&Se(),await new Promise((Ae,Ke)=>{WS(Ae,Ke,{data:Le,headers:Dl.from(ye.headers),status:ye.status,statusText:ye.statusText,config:h,request:le})})}catch(_e){throw Se&&Se(),_e&&_e.name==="TypeError"&&/Load failed|fetch/i.test(_e.message)?Object.assign(new pn("Network Error",pn.ERR_NETWORK,h,le),{cause:_e.cause||_e}):pn.from(_e,_e&&_e.code,h,le)}}),R2={http:NL,xhr:fD,fetch:wD};Kt.forEach(R2,(h,g)=>{if(h){try{Object.defineProperty(h,"name",{value:g})}catch{}Object.defineProperty(h,"adapterName",{value:g})}});const u6=h=>`- ${h}`,TD=h=>Kt.isFunction(h)||h===null||h===!1,QS={getAdapter:h=>{h=Kt.isArray(h)?h:[h];const{length:g}=h;let b,S;const I={};for(let N=0;N<g;N++){b=h[N];let V;if(S=b,!TD(b)&&(S=R2[(V=String(b)).toLowerCase()],S===void 0))throw new pn(`Unknown adapter '${V}'`);if(S)break;I[V||"#"+N]=S}if(!S){const N=Object.entries(I).map(([s,q])=>`adapter ${s} `+(q===!1?"is not supported by the environment":"is not available in the build"));let V=g?N.length>1?`since :
`+N.map(u6).join(`
`):" "+u6(N[0]):"as no adapter specified";throw new pn("There is no suitable adapter to dispatch the request "+V,"ERR_NOT_SUPPORT")}return S},adapters:R2};function yv(h){if(h.cancelToken&&h.cancelToken.throwIfRequested(),h.signal&&h.signal.aborted)throw new Zg(null,h)}function h6(h){return yv(h),h.headers=Dl.from(h.headers),h.data=_v.call(h,h.transformRequest),["post","put","patch"].indexOf(h.method)!==-1&&h.headers.setContentType("application/x-www-form-urlencoded",!1),QS.getAdapter(h.adapter||x0.adapter)(h).then(function(S){return yv(h),S.data=_v.call(h,h.transformResponse,S),S.headers=Dl.from(S.headers),S},function(S){return ZS(S)||(yv(h),S&&S.response&&(S.response.data=_v.call(h,h.transformResponse,S.response),S.response.headers=Dl.from(S.response.headers))),Promise.reject(S)})}const e5="1.11.0",B1={};["object","boolean","number","function","string","symbol"].forEach((h,g)=>{B1[h]=function(S){return typeof S===h||"a"+(g<1?"n ":" ")+h}});const d6={};B1.transitional=function(g,b,S){function I(N,V){return"[Axios v"+e5+"] Transitional option '"+N+"'"+V+(S?". "+S:"")}return(N,V,s)=>{if(g===!1)throw new pn(I(V," has been removed"+(b?" in "+b:"")),pn.ERR_DEPRECATED);return b&&!d6[V]&&(d6[V]=!0,console.warn(I(V," has been deprecated since v"+b+" and will be removed in the near future"))),g?g(N,V,s):!0}};B1.spelling=function(g){return(b,S)=>(console.warn(`${S} is likely a misspelling of ${g}`),!0)};function SD(h,g,b){if(typeof h!="object")throw new pn("options must be an object",pn.ERR_BAD_OPTION_VALUE);const S=Object.keys(h);let I=S.length;for(;I-- >0;){const N=S[I],V=g[N];if(V){const s=h[N],q=s===void 0||V(s,N,h);if(q!==!0)throw new pn("option "+N+" must be "+q,pn.ERR_BAD_OPTION_VALUE);continue}if(b!==!0)throw new pn("Unknown option "+N,pn.ERR_BAD_OPTION)}}const Xy={assertOptions:SD,validators:B1},rd=Xy.validators;let Im=class{constructor(g){this.defaults=g||{},this.interceptors={request:new r6,response:new r6}}async request(g,b){try{return await this._request(g,b)}catch(S){if(S instanceof Error){let I={};Error.captureStackTrace?Error.captureStackTrace(I):I=new Error;const N=I.stack?I.stack.replace(/^.+\n/,""):"";try{S.stack?N&&!String(S.stack).endsWith(N.replace(/^.+\n.+\n/,""))&&(S.stack+=`
`+N):S.stack=N}catch{}}throw S}}_request(g,b){typeof g=="string"?(b=b||{},b.url=g):b=g||{},b=Om(this.defaults,b);const{transitional:S,paramsSerializer:I,headers:N}=b;S!==void 0&&Xy.assertOptions(S,{silentJSONParsing:rd.transitional(rd.boolean),forcedJSONParsing:rd.transitional(rd.boolean),clarifyTimeoutError:rd.transitional(rd.boolean)},!1),I!=null&&(Kt.isFunction(I)?b.paramsSerializer={serialize:I}:Xy.assertOptions(I,{encode:rd.function,serialize:rd.function},!0)),b.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?b.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:b.allowAbsoluteUrls=!0),Xy.assertOptions(b,{baseUrl:rd.spelling("baseURL"),withXsrfToken:rd.spelling("withXSRFToken")},!0),b.method=(b.method||this.defaults.method||"get").toLowerCase();let V=N&&Kt.merge(N.common,N[b.method]);N&&Kt.forEach(["delete","get","head","post","put","patch","common"],le=>{delete N[le]}),b.headers=Dl.concat(V,N);const s=[];let q=!0;this.interceptors.request.forEach(function(Se){typeof Se.runWhen=="function"&&Se.runWhen(b)===!1||(q=q&&Se.synchronous,s.unshift(Se.fulfilled,Se.rejected))});const Z=[];this.interceptors.response.forEach(function(Se){Z.push(Se.fulfilled,Se.rejected)});let Q,oe=0,de;if(!q){const le=[h6.bind(this),void 0];for(le.unshift(...s),le.push(...Z),de=le.length,Q=Promise.resolve(b);oe<de;)Q=Q.then(le[oe++],le[oe++]);return Q}de=s.length;let ze=b;for(oe=0;oe<de;){const le=s[oe++],Se=s[oe++];try{ze=le(ze)}catch(ee){Se.call(this,ee);break}}try{Q=h6.call(this,ze)}catch(le){return Promise.reject(le)}for(oe=0,de=Z.length;oe<de;)Q=Q.then(Z[oe++],Z[oe++]);return Q}getUri(g){g=Om(this.defaults,g);const b=XS(g.baseURL,g.url,g.allowAbsoluteUrls);return qS(b,g.params,g.paramsSerializer)}};Kt.forEach(["delete","get","head","options"],function(g){Im.prototype[g]=function(b,S){return this.request(Om(S||{},{method:g,url:b,data:(S||{}).data}))}});Kt.forEach(["post","put","patch"],function(g){function b(S){return function(N,V,s){return this.request(Om(s||{},{method:g,headers:S?{"Content-Type":"multipart/form-data"}:{},url:N,data:V}))}}Im.prototype[g]=b(),Im.prototype[g+"Form"]=b(!0)});let ED=class t5{constructor(g){if(typeof g!="function")throw new TypeError("executor must be a function.");let b;this.promise=new Promise(function(N){b=N});const S=this;this.promise.then(I=>{if(!S._listeners)return;let N=S._listeners.length;for(;N-- >0;)S._listeners[N](I);S._listeners=null}),this.promise.then=I=>{let N;const V=new Promise(s=>{S.subscribe(s),N=s}).then(I);return V.cancel=function(){S.unsubscribe(N)},V},g(function(N,V,s){S.reason||(S.reason=new Zg(N,V,s),b(S.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(g){if(this.reason){g(this.reason);return}this._listeners?this._listeners.push(g):this._listeners=[g]}unsubscribe(g){if(!this._listeners)return;const b=this._listeners.indexOf(g);b!==-1&&this._listeners.splice(b,1)}toAbortSignal(){const g=new AbortController,b=S=>{g.abort(S)};return this.subscribe(b),g.signal.unsubscribe=()=>this.unsubscribe(b),g.signal}static source(){let g;return{token:new t5(function(I){g=I}),cancel:g}}};function AD(h){return function(b){return h.apply(null,b)}}function CD(h){return Kt.isObject(h)&&h.isAxiosError===!0}const M2={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(M2).forEach(([h,g])=>{M2[g]=h});function i5(h){const g=new Im(h),b=LS(Im.prototype.request,g);return Kt.extend(b,Im.prototype,g,{allOwnKeys:!0}),Kt.extend(b,g,null,{allOwnKeys:!0}),b.create=function(I){return i5(Om(h,I))},b}const Ls=i5(x0);Ls.Axios=Im;Ls.CanceledError=Zg;Ls.CancelToken=ED;Ls.isCancel=ZS;Ls.VERSION=e5;Ls.toFormData=N1;Ls.AxiosError=pn;Ls.Cancel=Ls.CanceledError;Ls.all=function(g){return Promise.all(g)};Ls.spread=AD;Ls.isAxiosError=CD;Ls.mergeConfig=Om;Ls.AxiosHeaders=Dl;Ls.formToJSON=h=>$S(Kt.isHTMLForm(h)?new FormData(h):h);Ls.getAdapter=QS.getAdapter;Ls.HttpStatusCode=M2;Ls.default=Ls;const{Axios:vk,AxiosError:bk,CanceledError:wk,isCancel:Tk,CancelToken:Sk,VERSION:Ek,all:Ak,Cancel:Ck,isAxiosError:Rk,spread:Mk,toFormData:Ik,AxiosHeaders:zk,HttpStatusCode:Lk,formToJSON:Dk,getAdapter:Pk,mergeConfig:Ok}=Ls;let RD={data:""},MD=h=>typeof window=="object"?((h?h.querySelector("#_goober"):window._goober)||Object.assign((h||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:h||RD,ID=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,zD=/\/\*[^]*?\*\/|  +/g,f6=/\n+/g,mp=(h,g)=>{let b="",S="",I="";for(let N in h){let V=h[N];N[0]=="@"?N[1]=="i"?b=N+" "+V+";":S+=N[1]=="f"?mp(V,N):N+"{"+mp(V,N[1]=="k"?"":g)+"}":typeof V=="object"?S+=mp(V,g?g.replace(/([^,])+/g,s=>N.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,q=>/&/.test(q)?q.replace(/&/g,s):s?s+" "+q:q)):N):V!=null&&(N=/^--/.test(N)?N:N.replace(/[A-Z]/g,"-$&").toLowerCase(),I+=mp.p?mp.p(N,V):N+":"+V+";")}return b+(g&&I?g+"{"+I+"}":I)+S},nf={},r5=h=>{if(typeof h=="object"){let g="";for(let b in h)g+=b+r5(h[b]);return g}return h},LD=(h,g,b,S,I)=>{let N=r5(h),V=nf[N]||(nf[N]=(q=>{let Z=0,Q=11;for(;Z<q.length;)Q=101*Q+q.charCodeAt(Z++)>>>0;return"go"+Q})(N));if(!nf[V]){let q=N!==h?h:(Z=>{let Q,oe,de=[{}];for(;Q=ID.exec(Z.replace(zD,""));)Q[4]?de.shift():Q[3]?(oe=Q[3].replace(f6," ").trim(),de.unshift(de[0][oe]=de[0][oe]||{})):de[0][Q[1]]=Q[2].replace(f6," ").trim();return de[0]})(h);nf[V]=mp(I?{["@keyframes "+V]:q}:q,b?"":"."+V)}let s=b&&nf.g?nf.g:null;return b&&(nf.g=nf[V]),((q,Z,Q,oe)=>{oe?Z.data=Z.data.replace(oe,q):Z.data.indexOf(q)===-1&&(Z.data=Q?q+Z.data:Z.data+q)})(nf[V],g,S,s),V},DD=(h,g,b)=>h.reduce((S,I,N)=>{let V=g[N];if(V&&V.call){let s=V(b),q=s&&s.props&&s.props.className||/^go/.test(s)&&s;V=q?"."+q:s&&typeof s=="object"?s.props?"":mp(s,""):s===!1?"":s}return S+I+(V??"")},"");function F1(h){let g=this||{},b=h.call?h(g.p):h;return LD(b.unshift?b.raw?DD(b,[].slice.call(arguments,1),g.p):b.reduce((S,I)=>Object.assign(S,I&&I.call?I(g.p):I),{}):b,MD(g.target),g.g,g.o,g.k)}let n5,I2,z2;F1.bind({g:1});let uf=F1.bind({k:1});function PD(h,g,b,S){mp.p=g,n5=h,I2=b,z2=S}function wp(h,g){let b=this||{};return function(){let S=arguments;function I(N,V){let s=Object.assign({},N),q=s.className||I.className;b.p=Object.assign({theme:I2&&I2()},s),b.o=/ *go\d+/.test(q),s.className=F1.apply(b,S)+(q?" "+q:"");let Z=h;return h[0]&&(Z=s.as||h,delete s.as),z2&&Z[0]&&z2(s),n5(Z,s)}return I}}var OD=h=>typeof h=="function",L2=(h,g)=>OD(h)?h(g):h,jD=(()=>{let h=0;return()=>(++h).toString()})(),ND=(()=>{let h;return()=>{if(h===void 0&&typeof window<"u"){let g=matchMedia("(prefers-reduced-motion: reduce)");h=!g||g.matches}return h}})(),kD=20,s5=(h,g)=>{switch(g.type){case 0:return{...h,toasts:[g.toast,...h.toasts].slice(0,kD)};case 1:return{...h,toasts:h.toasts.map(N=>N.id===g.toast.id?{...N,...g.toast}:N)};case 2:let{toast:b}=g;return s5(h,{type:h.toasts.find(N=>N.id===b.id)?1:0,toast:b});case 3:let{toastId:S}=g;return{...h,toasts:h.toasts.map(N=>N.id===S||S===void 0?{...N,dismissed:!0,visible:!1}:N)};case 4:return g.toastId===void 0?{...h,toasts:[]}:{...h,toasts:h.toasts.filter(N=>N.id!==g.toastId)};case 5:return{...h,pausedAt:g.time};case 6:let I=g.time-(h.pausedAt||0);return{...h,pausedAt:void 0,toasts:h.toasts.map(N=>({...N,pauseDuration:N.pauseDuration+I}))}}},BD=[],xv={toasts:[],pausedAt:void 0},cb=h=>{xv=s5(xv,h),BD.forEach(g=>{g(xv)})},FD=(h,g="blank",b)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:g,ariaProps:{role:"status","aria-live":"polite"},message:h,pauseDuration:0,...b,id:(b==null?void 0:b.id)||jD()}),v0=h=>(g,b)=>{let S=FD(g,h,b);return cb({type:2,toast:S}),S.id},_c=(h,g)=>v0("blank")(h,g);_c.error=v0("error");_c.success=v0("success");_c.loading=v0("loading");_c.custom=v0("custom");_c.dismiss=h=>{cb({type:3,toastId:h})};_c.remove=h=>cb({type:4,toastId:h});_c.promise=(h,g,b)=>{let S=_c.loading(g.loading,{...b,...b==null?void 0:b.loading});return typeof h=="function"&&(h=h()),h.then(I=>{let N=g.success?L2(g.success,I):void 0;return N?_c.success(N,{id:S,...b,...b==null?void 0:b.success}):_c.dismiss(S),I}).catch(I=>{let N=g.error?L2(g.error,I):void 0;N?_c.error(N,{id:S,...b,...b==null?void 0:b.error}):_c.dismiss(S)}),h};var UD=uf`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,VD=uf`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,HD=uf`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,qD=wp("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${h=>h.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${UD} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${VD} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${h=>h.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${HD} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,GD=uf`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,$D=wp("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${h=>h.secondary||"#e0e0e0"};
  border-right-color: ${h=>h.primary||"#616161"};
  animation: ${GD} 1s linear infinite;
`,ZD=uf`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,WD=uf`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,XD=wp("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${h=>h.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${ZD} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${WD} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${h=>h.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,YD=wp("div")`
  position: absolute;
`,KD=wp("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,JD=uf`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,QD=wp("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${JD} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,eP=({toast:h})=>{let{icon:g,type:b,iconTheme:S}=h;return g!==void 0?typeof g=="string"?ue.createElement(QD,null,g):g:b==="blank"?null:ue.createElement(KD,null,ue.createElement($D,{...S}),b!=="loading"&&ue.createElement(YD,null,b==="error"?ue.createElement(qD,{...S}):ue.createElement(XD,{...S})))},tP=h=>`
0% {transform: translate3d(0,${h*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,iP=h=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${h*-150}%,-1px) scale(.6); opacity:0;}
`,rP="0%{opacity:0;} 100%{opacity:1;}",nP="0%{opacity:1;} 100%{opacity:0;}",sP=wp("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,aP=wp("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,oP=(h,g)=>{let b=h.includes("top")?1:-1,[S,I]=ND()?[rP,nP]:[tP(b),iP(b)];return{animation:g?`${uf(S)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${uf(I)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}};ue.memo(({toast:h,position:g,style:b,children:S})=>{let I=h.height?oP(h.position||g||"top-center",h.visible):{opacity:0},N=ue.createElement(eP,{toast:h}),V=ue.createElement(aP,{...h.ariaProps},L2(h.message,h));return ue.createElement(sP,{className:h.className,style:{...I,...b,...h.style}},typeof S=="function"?S({icon:N,message:V}):ue.createElement(ue.Fragment,null,N,V))});PD(ue.createElement);F1`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`;var gc=_c;const e0="https://urbansetu.onrender.com",a5=ue.createContext(),jk=()=>{const h=ue.useContext(a5);if(!h)throw new Error("useImageFavorites must be used within an ImageFavoritesProvider");return h},lP=({children:h})=>{const{currentUser:g}=yo(ye=>ye.user),[b,S]=ue.useState(new Set),[I,N]=ue.useState(!1),[V,s]=ue.useState([]);ue.useEffect(()=>{g?q():(S(new Set),s([]))},[g]);const q=async()=>{var ye;if(g)try{N(!0);const xe=await Ls.get(`${e0}/api/image-favorites/user/${g._id}`,{withCredentials:!0});if(xe.data.success){const Le=new Set(xe.data.favorites.map(Ae=>Ae.imageId));S(Le),s(xe.data.favorites)}}catch(xe){console.error("Failed to load favorites:",xe),((ye=xe.response)==null?void 0:ye.status)!==401&&gc.error("Failed to load favorites")}finally{N(!1)}},Z=ye=>{if(!ye)return null;const xe=ye.split("/");return xe[xe.length-1].split("?")[0]||btoa(ye).slice(0,20)},_e={favorites:b,favoritesData:V,loading:I,isFavorite:ye=>{const xe=Z(ye);return xe?b.has(xe):!1},toggleFavorite:async(ye,xe={})=>{var Ke,it,rt;if(!g)return gc.error("Please login to save favorites"),!1;if(!ye)return gc.error("Invalid image URL"),!1;const Le=Z(ye);if(!Le)return gc.error("Unable to process image"),!1;const Ae=b.has(Le);try{if(Ae)return await Ls.delete(`${e0}/api/image-favorites/remove/${Le}`,{withCredentials:!0}),S(lt=>{const zt=new Set(lt);return zt.delete(Le),zt}),s(lt=>lt.filter(zt=>zt.imageId!==Le)),gc.success("Removed from favorites"),!1;{const lt={imageUrl:ye,imageId:Le,listingId:xe.listingId||null,metadata:{imageName:xe.imageName||`image-${Date.now()}`,imageType:xe.imageType||"image",imageSize:xe.imageSize||0,addedFrom:xe.addedFrom||"preview"}},zt=await Ls.post(`${e0}/api/image-favorites/add`,lt,{withCredentials:!0});if(zt.data.success)return S(xt=>new Set([...xt,Le])),s(xt=>[...xt,zt.data.favorite]),gc.success("Added to favorites"),!0}}catch(lt){console.error("Failed to toggle favorite:",lt);const zt=((it=(Ke=lt.response)==null?void 0:Ke.data)==null?void 0:it.message)||"Failed to update favorites";return((rt=lt.response)==null?void 0:rt.status)===400&&zt.includes("already")?(Ae||S(xt=>new Set([...xt,Le])),gc.success("Added to favorites"),!0):(gc.error(zt),Ae)}},loadFavorites:q,getFavoritesCount:()=>b.size,getAllFavorites:()=>V,checkMultipleFavorites:ye=>{const xe={};return ye.forEach(Le=>{const Ae=Z(Le);Ae&&(xe[Le]=b.has(Ae))}),xe},bulkAddToFavorites:async ye=>{if(!g){gc.error("Please login to save favorites");return}try{const xe=ye.map(Ae=>({imageUrl:Ae.url,imageId:Z(Ae.url),listingId:Ae.listingId||null,metadata:{imageName:Ae.name||`image-${Date.now()}`,imageType:Ae.type||"image",imageSize:Ae.size||0,addedFrom:Ae.addedFrom||"bulk"}})).filter(Ae=>Ae.imageId),Le=await Ls.post(`${e0}/api/image-favorites/bulk/add`,{images:xe},{withCredentials:!0});Le.data.success&&(await q(),gc.success(`${Le.data.addedCount} images added to favorites`))}catch(xe){console.error("Failed to bulk add favorites:",xe),gc.error("Failed to add images to favorites")}},bulkRemoveFromFavorites:async ye=>{if(g)try{const xe=ye.map(Ae=>Z(Ae)).filter(Boolean),Le=await Ls.post(`${e0}/api/image-favorites/bulk/remove`,{imageIds:xe},{withCredentials:!0});if(Le.data.success){const Ae=new Set(xe);S(Ke=>{const it=new Set;return Ke.forEach(rt=>{Ae.has(rt)||it.add(rt)}),it}),s(Ke=>Ke.filter(it=>!Ae.has(it.imageId))),gc.success(`${Le.data.removedCount} images removed from favorites`)}}catch(xe){console.error("Failed to bulk remove favorites:",xe),gc.error("Failed to remove images from favorites")}},generateImageId:Z};return _.jsx(a5.Provider,{value:_e,children:h})};function o5({isOpen:h,onClose:g,onConfirm:b,title:S="Confirm Action",message:I="Are you sure you want to proceed?",confirmText:N="Confirm",cancelText:V="Cancel",confirmButtonColor:s="bg-blue-600 hover:bg-blue-700",isDestructive:q=!1,isLoading:Z=!1}){if(!h)return null;const Q=()=>{b(),Z||g()},oe=()=>q?_.jsx(fS,{className:"w-6 h-6 text-red-500"}):_.jsx(qy,{className:"w-6 h-6 text-blue-500"}),de=()=>q?"bg-red-600 hover:bg-red-700 focus:ring-red-500":s+" focus:ring-blue-500";return _.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-[10000] p-4 animate-fadeIn",children:[_.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full animate-slideUp",children:[_.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[_.jsxs("div",{className:"flex items-center gap-3",children:[oe(),_.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:S})]}),_.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 hover:bg-gray-100 rounded-full",disabled:Z,children:_.jsx(_o,{className:"w-4 h-4"})})]}),_.jsx("div",{className:"p-6",children:_.jsx("p",{className:"text-gray-700 leading-relaxed",children:I})}),_.jsxs("div",{className:"flex gap-3 p-6 pt-0",children:[_.jsx("button",{onClick:g,disabled:Z,className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:V}),_.jsx("button",{onClick:Q,disabled:Z,className:`flex-1 px-4 py-2 text-white rounded-lg transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 ${de()}`,children:Z?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processing..."]}):_.jsxs(_.Fragment,{children:[q&&_.jsx(su,{className:"w-4 h-4"}),N]})})]})]}),_.jsx("style",{jsx:!0,children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes slideUp {
          from { 
            opacity: 0; 
            transform: translateY(20px) scale(0.95);
          }
          to { 
            opacity: 1; 
            transform: translateY(0) scale(1);
          }
        }
        
        .animate-fadeIn {
          animation: fadeIn 0.3s ease-out;
        }
        
        .animate-slideUp {
          animation: slideUp 0.3s ease-out;
        }
      `})]})}const vv="https://urbansetu.onrender.com";function cP({forceModalOpen:h=!1,onModalClose:g=null}){const{currentUser:b}=yo(ii=>ii.user),[S,I]=ue.useState(h);Pl();const N=ko(),[V,s]=ue.useState([]),[q,Z]=ue.useState(!1),[Q,oe]=ue.useState(0),[de,ze]=ue.useState("send"),[le,Se]=ue.useState({subject:"",message:"",email:"",name:""}),[ee,_e]=ue.useState(!1),[ye,xe]=ue.useState(""),[Le,Ae]=ue.useState(!0),Ke=ue.useRef(null),it=ue.useRef(null),[rt,lt]=ue.useState(!1),[zt,xt]=ue.useState(null),[Ci,Zi]=ue.useState(!1);ue.useEffect(()=>{h&&I(!0)},[h]),ue.useEffect(()=>{S&&b&&Se(ii=>({...ii,name:b.username||"",email:b.email||""})),S||Se({subject:"",message:"",email:"",name:""})},[S,b]),ue.useEffect(()=>{b!=null&&b.email&&Jt()},[b]),ue.useEffect(()=>{b!=null&&b.email&&de==="messages"&&Jt()},[b,de]),ue.useEffect(()=>(S?(document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%"):(document.body.style.overflow="",document.body.style.position="",document.body.style.width=""),()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width=""}),[S]);const or=ue.useCallback(()=>{if(Ke.current){const{scrollTop:ii,scrollHeight:Wi,clientHeight:_i}=Ke.current,Ri=Wi-ii-_i<5;Ae(Ri)}},[]);ue.useEffect(()=>{const ii=Ke.current;if(ii&&de==="messages")return ii.addEventListener("scroll",or),or(),()=>{ii.removeEventListener("scroll",or)}},[de,or]);const er=ue.useCallback(()=>{it.current&&it.current.scrollIntoView({behavior:"smooth"})},[]),Jt=async()=>{Z(!0);try{const Wi=await(await fetch(`${vv}/api/contact/user-messages/${encodeURIComponent(b.email)}`,{credentials:"include"})).json();if(!Array.isArray(Wi)){s([]),oe(0);return}s(Wi);const _i=Wi.filter(Ri=>Ri.adminReply&&Ri.status==="unread").length;oe(_i)}catch(ii){console.error("Error fetching user messages:",ii),s([]),oe(0)}finally{Z(!1)}},ji=ii=>{const Wi=new Date(ii),Ri=new Date-Wi,Ai=Math.floor(Ri/(1e3*60)),gt=Math.floor(Ri/(1e3*60*60)),Tt=Math.floor(Ri/(1e3*60*60*24));return Ai<1?"Just now":Ai<60?`${Ai}m ago`:gt<24?`${gt}h ago`:Tt<7?`${Tt}d ago`:Wi.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})},Fi=async ii=>{xt(ii),lt(!0)},Pr=async()=>{if(zt){Zi(!0);try{const ii=await fetch(`${vv}/api/contact/user-messages/${zt}?email=${encodeURIComponent(b.email)}`,{method:"DELETE",credentials:"include"});if(ii.ok){s(Ri=>Ri.filter(Ai=>Ai._id!==zt));const _i=V.filter(Ri=>Ri._id!==zt).filter(Ri=>Ri.adminReply&&Ri.status==="unread").length;oe(_i),ei.success("Message deleted successfully!")}else{const Wi=await ii.json();ei.error(Wi.message||"Failed to delete message. Please try again.")}}catch(ii){console.error("Error deleting message:",ii),ei.error("Failed to delete message. Please try again.")}finally{Zi(!1),lt(!1),xt(null)}}},tt=()=>{const ii=N.pathname,Wi=new URLSearchParams(N.search);if(ii==="/forgot-password"&&Wi.get("step")==="2")return"#059669";switch(ii){case"/sign-in":return"#6366f1";case"/sign-up":return"#0891b2";case"/forgot-password":return"#dc2626";default:return"#3b82f6"}},Ht=()=>{I(!1),g&&g()},Pi=ii=>{Se({...le,[ii.target.name]:ii.target.value})},Ui=async ii=>{ii.preventDefault(),_e(!0),xe("");try{(await(await fetch(`${vv}/api/contact/support`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(le)})).json()).success?(xe("success"),Se({subject:"",message:"",email:"",name:""}),ei.success("Message sent successfully!"),setTimeout(()=>{Ht(),xe("")},3e3)):(xe("error"),ei.error("Failed to send message. Please try again or contact us directly."))}catch{xe("error"),ei.error("Failed to send message. Please try again or contact us directly.")}finally{_e(!1)}};return _.jsxs(_.Fragment,{children:[_.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:_.jsxs("button",{onClick:()=>I(!0),className:"relative group w-12 h-12 rounded-full shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:scale-110 hover:rotate-12 flex items-center justify-center",style:{background:`linear-gradient(135deg, ${tt()}, ${tt()}dd)`,boxShadow:`0 10px 25px ${tt()}40`},title:"Need help? Contact our support team!",children:[_.jsx("div",{className:"absolute inset-0 rounded-full animate-ping",style:{border:`3px solid ${tt()}55`}}),_.jsx(Ng,{className:"w-5 h-5 text-white drop-shadow-lg"}),b&&Q>0&&_.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-6 w-6 flex items-center justify-center font-bold animate-pulse",children:Q>99?"99+":Q}),_.jsxs("div",{className:"absolute bottom-full right-0 mb-3 bg-white text-gray-800 text-sm px-4 py-2 rounded-xl shadow-2xl hidden group-hover:block z-10 whitespace-nowrap border border-gray-100 transform -translate-y-1 transition-all duration-200",children:[_.jsxs("div",{className:"flex items-center gap-2",children:[_.jsx("span",{className:"text-lg",children:""}),_.jsx("span",{className:"font-medium",children:b&&Q>0?`${Q} new repl${Q!==1?"ies":"y"}`:"Need help? Contact us!"})]}),_.jsx("div",{className:"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"})]})]})}),S&&_.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn",children:_.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto animate-slideUp",children:[_.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white rounded-t-2xl",children:[_.jsxs("div",{className:"flex items-center gap-3",children:[_.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:tt()},children:_.jsx(Ng,{className:"w-5 h-5 text-white"})}),_.jsxs("div",{children:[_.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Contact Support"}),_.jsx("p",{className:"text-sm text-gray-600",children:"We're here to help you!"})]})]}),_.jsx("button",{onClick:Ht,className:"text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-100 rounded-full",children:_.jsx(_o,{className:"w-5 h-5"})})]}),b&&_.jsxs("div",{className:"flex border-b border-gray-200",children:[_.jsx("button",{onClick:()=>ze("send"),className:`flex-1 px-6 py-3 text-sm font-medium transition-colors ${de==="send"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:"Send Message"}),_.jsxs("button",{onClick:()=>ze("messages"),className:`flex-1 px-6 py-3 text-sm font-medium transition-colors relative ${de==="messages"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:["My Messages",Q>0&&_.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold",children:Q>99?"99+":Q})]})]}),!b||de==="send"?_.jsxs("form",{onSubmit:Ui,className:"p-6 space-y-6",children:[ye==="success"&&_.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 text-green-800 rounded-xl flex items-center gap-3 animate-bounce",children:[_.jsx("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:_.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),_.jsxs("div",{children:[_.jsx("p",{className:"font-medium",children:"Message sent successfully!"}),_.jsx("p",{className:"text-sm",children:"We'll get back to you within 24 hours."})]})]}),ye==="error"&&_.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 text-red-800 rounded-xl flex items-center gap-3",children:[_.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center",children:_.jsx(_o,{className:"w-3 h-3 text-white"})}),_.jsxs("div",{children:[_.jsx("p",{className:"font-medium",children:"Failed to send message"}),_.jsx("p",{className:"text-sm",children:"Please try again or contact us directly."})]})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsxs("label",{htmlFor:"name",className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[_.jsx(zl,{className:"w-4 h-4"}),"Your Name *"]}),_.jsx("input",{type:"text",id:"name",name:"name",value:le.name,onChange:Pi,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Enter your full name"})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsxs("label",{htmlFor:"email",className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[_.jsx(nd,{className:"w-4 h-4"}),"Email Address *"]}),_.jsx("input",{type:"email",id:"email",name:"email",value:le.email,onChange:Pi,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"your@email.com"})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsxs("label",{htmlFor:"subject",className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[_.jsx(vI,{className:"w-4 h-4"}),"Subject *"]}),_.jsx("input",{type:"text",id:"subject",name:"subject",value:le.subject,onChange:Pi,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Brief description of your issue"})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsxs("label",{htmlFor:"message",className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[_.jsx(Ng,{className:"w-4 h-4"}),"Message *"]}),_.jsx("textarea",{id:"message",name:"message",value:le.message,onChange:Pi,required:!0,rows:5,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 resize-none",placeholder:"Please describe your issue or question in detail..."})]}),_.jsxs("div",{className:"flex gap-3 pt-4",children:[_.jsx("button",{type:"button",onClick:Ht,className:"flex-1 px-6 py-3 text-gray-700 bg-gray-100 rounded-xl hover:bg-gray-200 transition-all duration-200 font-medium contact-support-action-btn",children:"Cancel"}),_.jsx("button",{type:"submit",disabled:ee,className:"flex-1 px-6 py-3 text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-medium flex items-center justify-center gap-2 contact-support-action-btn",style:{backgroundColor:tt(),boxShadow:`0 4px 14px ${tt()}40`},children:ee?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Sending..."]}):_.jsxs(_.Fragment,{children:[_.jsx(f1,{className:"w-4 h-4"}),"Send Message"]})})]})]}):_.jsx("div",{className:"p-6",children:q?_.jsxs("div",{className:"text-center py-8",children:[_.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),_.jsx("p",{className:"text-gray-500 font-medium",children:"Loading your messages..."})]}):V.length===0?_.jsxs("div",{className:"text-center py-8 text-gray-500",children:[_.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:_.jsx(nd,{className:"w-10 h-10 text-gray-400"})}),_.jsx("h4",{className:"text-lg font-medium mb-2",children:"No messages yet"}),_.jsx("p",{className:"text-sm mb-4",children:"Send a support message to get started"}),_.jsx("button",{onClick:()=>ze("send"),className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Send Message"})]}):_.jsxs("div",{ref:Ke,className:"space-y-4 max-h-96 overflow-y-auto relative",children:[V.map(ii=>_.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[_.jsx("div",{className:"flex items-start justify-between mb-3",children:_.jsxs("div",{className:"flex-1",children:[_.jsx("h4",{className:"font-semibold text-gray-900",children:ii.subject}),_.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500",children:[_.jsx(I1,{className:"w-3 h-3"}),ji(ii.createdAt),_.jsx("span",{className:"text-gray-400",children:""}),_.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${ii.status==="replied"?"bg-green-100 text-green-800":ii.status==="read"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:ii.status==="replied"?"Replied":ii.status==="read"?"Read":"Unread"})]})]})}),_.jsx("div",{className:"bg-gray-50 p-3 rounded-lg mb-3",children:_.jsx("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed text-sm",children:ii.message})}),ii.adminReply&&_.jsxs("div",{className:"bg-green-50 p-3 rounded-lg border border-green-200",children:[_.jsxs("div",{className:"flex items-center justify-between mb-2",children:[_.jsx("h6",{className:"font-medium text-green-700 text-sm",children:"Admin Reply"}),_.jsx("span",{className:"text-xs text-gray-500",children:ji(ii.adminReplyAt)})]}),_.jsx("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed text-sm",children:ii.adminReply})]}),_.jsx("div",{className:"flex items-center justify-end mt-2",children:_.jsx("button",{onClick:()=>Fi(ii._id),className:"text-red-500 hover:text-red-700 transition-colors p-2 rounded-full hover:bg-red-50",title:"Delete this message",children:_.jsx(su,{className:"w-4 h-4"})})})]},ii._id)),_.jsx("div",{ref:it})]})}),!Le&&V.length>0&&de==="messages"&&_.jsx("div",{className:"absolute bottom-6 right-6 z-20",children:_.jsx("button",{onClick:er,className:"bg-blue-500 hover:bg-blue-600 text-white rounded-full p-3 shadow-lg transition-all duration-200 hover:scale-110 animate-pulse",title:"Scroll to bottom","aria-label":"Scroll to bottom",children:_.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"transform",children:_.jsx("path",{d:"M12 16l-6-6h12l-6 6z"})})})})]})}),_.jsx("style",{jsx:!0,children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from { 
            opacity: 0; 
            transform: translateY(20px) scale(0.95);
          }
          to { 
            opacity: 1; 
            transform: translateY(0) scale(1);
          }
        }
        @keyframes slideDown {
          from { 
            opacity: 0; 
            transform: translateY(-10px);
          }
          to { 
            opacity: 1; 
            transform: translateY(0);
          }
        }
        .animate-fadeIn {
          animation: fadeIn 0.3s ease-out;
        }
        .animate-slideUp {
          animation: slideUp 0.3s ease-out;
        }
        .animate-slideDown {
          animation: slideDown 0.2s ease-out;
        }
        .shadow-3xl {
          box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        /* Mobile button size reduction for Send Message and Cancel */
        @media (max-width: 640px) {
          .contact-support-action-btn {
            padding: 0.5rem 0.75rem !important;
            font-size: 0.95rem !important;
            border-radius: 0.75rem !important;
          }
        }
      `}),_.jsx(o5,{isOpen:rt,onClose:()=>{lt(!1),xt(null)},onConfirm:Pr,title:"Delete Message",message:"Are you sure you want to delete this message? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",isDestructive:!0,isLoading:Ci})]})}const Dg="https://urbansetu.onrender.com";function uP({forceModalOpen:h=!1,onModalClose:g=null}){const[b,S]=ue.useState(h),[I,N]=ue.useState([]),[V,s]=ue.useState(!1),[q,Z]=ue.useState(0),[Q,oe]=ue.useState(null),[de,ze]=ue.useState(""),[le,Se]=ue.useState(null),[ee,_e]=ue.useState(!1),{currentUser:ye}=yo(Tt=>Tt.user),xe=ko();Pl();const[Le,Ae]=ue.useState(""),[Ke,it]=ue.useState(!0),rt=ue.useRef(null),lt=ue.useRef(null),[zt,xt]=ue.useState(!1),[Ci,Zi]=ue.useState(null),[or,er]=ue.useState(!1);ue.useEffect(()=>{h&&S(!0)},[h]);const Jt=ye&&(ye.role==="admin"||ye.role==="rootadmin"),ji=()=>{const Tt=xe.pathname,Si=new URLSearchParams(xe.search);if(Tt==="/forgot-password"&&Si.get("step")==="2")return"#059669";switch(Tt){case"/sign-in":return"#6366f1";case"/sign-up":return"#0891b2";case"/forgot-password":return"#dc2626";default:return"#3b82f6"}};ue.useEffect(()=>{let Tt;return Jt&&(Ht(),Tt=setInterval(Ht,3e4)),()=>Tt&&clearInterval(Tt)},[Jt]),ue.useEffect(()=>{b&&Jt&&(tt(),Ht())},[b,Jt]),ue.useEffect(()=>(b?(document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%"):(document.body.style.overflow="",document.body.style.position="",document.body.style.width=""),()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width=""}),[b]);const Fi=ue.useCallback(()=>{if(rt.current){const{scrollTop:Tt,scrollHeight:Si,clientHeight:Sr}=rt.current,Cr=Si-Tt-Sr<5;it(Cr)}},[]);ue.useEffect(()=>{const Tt=rt.current;if(Tt&&b)return Tt.addEventListener("scroll",Fi),Fi(),()=>{Tt.removeEventListener("scroll",Fi)}},[b,Fi]);const Pr=ue.useCallback(()=>{lt.current&&lt.current.scrollIntoView({behavior:"smooth"})},[]),tt=async()=>{s(!0),Ae("");try{const Tt=await fetch(`${Dg}/api/contact/messages`,{credentials:"include"});if(!Tt.ok){const Sr=await Tt.json();Ae(Sr.message||"Failed to fetch messages."),N([]);return}const Si=await Tt.json();N(Si)}catch(Tt){Ae("Network error or server unavailable."),N([]),console.error("Error fetching messages:",Tt)}finally{s(!1)}},Ht=async()=>{try{const Si=await(await fetch(`${Dg}/api/contact/unread-count`,{credentials:"include"})).json();Z(Si.count)}catch(Tt){console.error("Error fetching unread count:",Tt)}},Pi=async Tt=>{try{await fetch(`${Dg}/api/contact/messages/${Tt}/read`,{method:"PUT",credentials:"include"}),N(Si=>Si.map(Sr=>Sr._id===Tt?{...Sr,status:"read"}:Sr)),Ht(),ei.success("Message marked as read")}catch(Si){console.error("Error marking message as read:",Si),ei.error("Failed to mark message as read")}},Ui=async Tt=>{try{await fetch(`${Dg}/api/contact/messages/${Tt}/replied`,{method:"PUT",credentials:"include"}),N(Si=>Si.map(Sr=>Sr._id===Tt?{...Sr,status:"replied"}:Sr)),Ht(),ei.success("Message marked as replied")}catch(Si){console.error("Error marking message as replied:",Si),ei.error("Failed to mark message as replied")}},ii=async Tt=>{Zi(Tt),xt(!0)},Wi=async()=>{if(Ci){er(!0);try{await fetch(`${Dg}/api/contact/messages/${Ci}`,{method:"DELETE",credentials:"include"}),N(Tt=>Tt.filter(Si=>Si._id!==Ci)),Ht(),ei.success("Message deleted successfully!")}catch(Tt){console.error("Error deleting message:",Tt),ei.error("Failed to delete message. Please try again.")}finally{er(!1),xt(!1),Zi(null)}}},_i=async Tt=>{if(!de.trim()){ei.error("Please enter a reply message");return}_e(!0);try{(await(await fetch(`${Dg}/api/contact/messages/${Tt}/reply`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({replyMessage:de.trim()})})).json()).success?(ze(""),Se(null),N(Cr=>Cr.map(zr=>zr._id===Tt?{...zr,adminReply:de.trim(),status:"replied"}:zr)),Ht(),ei.success("Reply sent successfully!")):ei.error("Failed to send reply. Please try again.")}catch(Si){console.error("Error sending reply:",Si),ei.error("Failed to send reply. Please try again.")}finally{_e(!1)}},Ri=Tt=>{const Si={unread:{color:"bg-red-100 text-red-800 border-red-200",text:"Unread",icon:_.jsx(nd,{className:"w-3 h-3"})},read:{color:"bg-blue-100 text-blue-800 border-blue-200",text:"Read",icon:_.jsx(au,{className:"w-3 h-3"})},replied:{color:"bg-green-100 text-green-800 border-green-200",text:"Replied",icon:_.jsx(F4,{className:"w-3 h-3"})}},Sr=Si[Tt]||Si.unread;return _.jsxs("span",{className:`px-3 py-1 text-xs font-medium rounded-full border flex items-center gap-1 ${Sr.color}`,children:[Sr.icon,Sr.text]})},Ai=()=>{S(!1),g&&g()},gt=Tt=>{const Si=new Date(Tt),Cr=new Date-Si,zr=Math.floor(Cr/(1e3*60)),Er=Math.floor(Cr/(1e3*60*60)),Gn=Math.floor(Cr/(1e3*60*60*24));return zr<1?"Just now":zr<60?`${zr}m ago`:Er<24?`${Er}h ago`:Gn===1?"Yesterday":Gn<7?`${Gn} days ago`:Si.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})};return Jt?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"fixed bottom-6 right-6 z-[9999]",children:_.jsxs("button",{onClick:()=>S(!0),className:"relative group w-12 h-12 rounded-full shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:scale-110 hover:rotate-12 flex items-center justify-center",style:{background:`linear-gradient(135deg, ${ji()}, ${ji()}dd)`,boxShadow:`0 10px 25px ${ji()}40`},title:"View support messages",children:[_.jsx("div",{className:"absolute inset-0 rounded-full animate-ping",style:{border:`3px solid ${ji()}55`}}),_.jsx(Ng,{className:"w-5 h-5 text-white drop-shadow-lg"}),q>0&&_.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-6 w-6 flex items-center justify-center font-bold animate-pulse",children:q>99?"99+":q}),_.jsxs("div",{className:"absolute bottom-full right-0 mb-3 bg-white text-gray-800 text-sm px-4 py-2 rounded-xl shadow-2xl hidden group-hover:block z-10 whitespace-nowrap border border-gray-100 transform -translate-y-1 transition-all duration-200",children:[_.jsxs("div",{className:"flex items-center gap-2",children:[_.jsx("span",{className:"text-lg",children:""}),_.jsx("span",{className:"font-medium",children:q>0?`${q} new message${q!==1?"s":""}`:"Support Messages"})]}),_.jsx("div",{className:"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"})]})]})}),b&&_.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-[9999] p-4 animate-fadeIn",children:_.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden animate-slideUp",children:[_.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white rounded-t-2xl",children:[_.jsxs("div",{className:"flex items-center gap-3",children:[_.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:ji()},children:_.jsx(Ng,{className:"w-5 h-5 text-white"})}),_.jsxs("div",{children:[_.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Support Messages"}),_.jsxs("p",{className:"text-sm text-gray-600",children:[q," unread message",q!==1?"s":"","  ",I.length," total"]})]})]}),_.jsx("button",{onClick:Ai,className:"text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-100 rounded-full",children:_.jsx(_o,{className:"w-5 h-5"})})]}),_.jsxs("div",{ref:rt,className:"overflow-y-auto max-h-[calc(90vh-120px)] relative",children:[Le&&_.jsx("div",{className:"p-6 text-center text-red-600 font-semibold bg-red-50 border border-red-200 rounded-xl mb-4",children:Le}),V?_.jsxs("div",{className:"p-12 text-center",children:[_.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),_.jsx("p",{className:"text-gray-500 font-medium",children:"Loading messages..."})]}):I.length===0?_.jsxs("div",{className:"p-12 text-center text-gray-500",children:[_.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:_.jsx(Ng,{className:"w-10 h-10 text-gray-400"})}),_.jsx("h4",{className:"text-lg font-medium mb-2",children:"No messages yet"}),_.jsx("p",{className:"text-sm",children:"Support messages from users will appear here"})]}):_.jsxs("div",{className:"divide-y divide-gray-100",children:[I.map(Tt=>_.jsxs("div",{className:`p-6 hover:bg-gray-50 transition-all duration-200 cursor-pointer ${Tt.status==="unread"?"bg-blue-50 border-l-4 border-blue-500":""} ${(Q==null?void 0:Q._id)===Tt._id?"bg-blue-100":""}`,onClick:()=>oe((Q==null?void 0:Q._id)===Tt._id?null:Tt),children:[_.jsx("div",{className:"flex items-start justify-between",children:_.jsxs("div",{className:"flex-1 min-w-0",children:[_.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[_.jsxs("div",{className:"flex-1 min-w-0",children:[_.jsx("h4",{className:"font-semibold text-gray-900 truncate",children:Tt.subject}),_.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[_.jsx(zl,{className:"w-3 h-3 text-gray-400"}),_.jsx("span",{className:"text-sm text-gray-600",children:Tt.name||"Anonymous"}),_.jsx("span",{className:"text-gray-400",children:""}),_.jsx(nd,{className:"w-3 h-3 text-gray-400"}),_.jsx("span",{className:"text-sm text-gray-600",children:Tt.email})]})]}),Ri(Tt.status)]}),_.jsx("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:_.jsxs("div",{className:"flex items-center gap-1",children:[_.jsx(I1,{className:"w-3 h-3"}),gt(Tt.createdAt)]})}),_.jsx("p",{className:"text-gray-700 mt-3 line-clamp-2",children:Tt.message})]})}),_.jsxs("div",{className:"flex gap-2 mt-4",children:[Tt.status==="unread"&&_.jsxs("button",{onClick:Si=>{Si.stopPropagation(),Pi(Tt._id)},className:"px-3 py-1 text-xs text-white rounded-lg transition-all duration-200 flex items-center gap-1 hover:scale-105",style:{backgroundColor:ji()},children:[_.jsx(au,{className:"w-3 h-3"}),"Mark Read"]}),Tt.status!=="replied"&&_.jsxs("button",{onClick:Si=>{Si.stopPropagation(),Ui(Tt._id)},className:"px-3 py-1 text-xs text-white rounded-lg transition-all duration-200 flex items-center gap-1 hover:scale-105",style:{backgroundColor:ji()},children:[_.jsx(F4,{className:"w-3 h-3"}),"Mark Replied"]}),_.jsxs("button",{onClick:Si=>{Si.stopPropagation(),ii(Tt._id)},className:"px-3 py-1 text-xs text-white bg-red-500 rounded-lg transition-all duration-200 flex items-center gap-1 hover:scale-105 hover:bg-red-700",children:[_.jsx(su,{className:"w-3 h-3"}),"Delete"]})]}),(Q==null?void 0:Q._id)===Tt._id&&_.jsxs("div",{className:"mt-4 p-4 bg-gray-100 rounded-xl animate-slideDown",children:[_.jsxs("div",{className:"flex items-center justify-between mb-3",children:[_.jsx("h5",{className:"font-medium text-gray-900",children:"Full Message"}),_.jsx("span",{className:"text-xs text-gray-500",children:new Date(Tt.createdAt).toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),_.jsx("div",{className:"bg-white p-4 rounded-lg border mb-4",children:_.jsx("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed",children:Tt.message})}),Tt.adminReply&&_.jsxs("div",{className:"mb-4",children:[_.jsxs("div",{className:"flex items-center justify-between mb-2",children:[_.jsx("h6",{className:"font-medium text-green-700",children:"Admin Reply"}),_.jsx("span",{className:"text-xs text-gray-500",children:new Date(Tt.adminReplyAt).toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),_.jsx("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:_.jsx("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed",children:Tt.adminReply})})]}),!Tt.adminReply&&_.jsxs("div",{className:"space-y-3",onClick:Si=>Si.stopPropagation(),children:[_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsx("h6",{className:"font-medium text-blue-700",children:"Send Reply"}),_.jsx("button",{onClick:Si=>{Si.stopPropagation(),Se(le===Tt._id?null:Tt._id)},className:"text-sm text-blue-600 hover:text-blue-800",children:le===Tt._id?"Cancel":"Reply"})]}),le===Tt._id&&_.jsxs("div",{className:"space-y-3",children:[_.jsx("textarea",{value:de,onChange:Si=>ze(Si.target.value),onClick:Si=>Si.stopPropagation(),onFocus:Si=>Si.stopPropagation(),placeholder:"Type your reply here...",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:"4"}),_.jsxs("div",{className:"flex gap-2",children:[_.jsx("button",{onClick:Si=>{Si.stopPropagation(),_i(Tt._id)},disabled:ee,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 admin-contact-support-action-btn",children:ee?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Sending..."]}):_.jsxs(_.Fragment,{children:[_.jsx(f1,{className:"w-4 h-4"}),"Send Reply"]})}),_.jsx("button",{onClick:Si=>{Si.stopPropagation(),Se(null),ze("")},className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 admin-contact-support-action-btn",children:"Cancel"})]})]})]})]})]},Tt._id)),_.jsx("div",{ref:lt})]})]}),!Ke&&I.length>0&&_.jsx("div",{className:"absolute bottom-6 right-6 z-20",children:_.jsx("button",{onClick:Pr,className:"bg-blue-500 hover:bg-blue-600 text-white rounded-full p-3 shadow-lg transition-all duration-200 hover:scale-110 animate-pulse",title:"Scroll to bottom","aria-label":"Scroll to bottom",children:_.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"transform",children:_.jsx("path",{d:"M12 16l-6-6h12l-6 6z"})})})})]})}),_.jsx("style",{jsx:!0,children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes slideUp {
          from { 
            opacity: 0; 
            transform: translateY(20px) scale(0.95);
          }
          to { 
            opacity: 1; 
            transform: translateY(0) scale(1);
          }
        }

        @keyframes slideDown {
          from { 
            opacity: 0; 
            transform: translateY(-10px);
          }
          to { 
            opacity: 1; 
            transform: translateY(0);
          }
        }
        
        .animate-fadeIn {
          animation: fadeIn 0.3s ease-out;
        }
        
        .animate-slideUp {
          animation: slideUp 0.3s ease-out;
        }

        .animate-slideDown {
          animation: slideDown 0.2s ease-out;
        }
        
        .shadow-3xl {
          box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        /* Mobile button size reduction for Send/Cancel in admin contact support */
        @media (max-width: 640px) {
          .admin-contact-support-action-btn {
            padding: 0.5rem 0.75rem !important;
            font-size: 0.95rem !important;
            border-radius: 0.75rem !important;
          }
        }
      `}),_.jsx(o5,{isOpen:zt,onClose:()=>{xt(!1),Zi(null)},onConfirm:Wi,title:"Delete Message",message:"Are you sure you want to delete this message? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",isDestructive:!0,isLoading:or})]}):null}function l5(){const{currentUser:h}=yo(I=>I.user),[g,b]=ue.useState(!1);Pl(),ko(),ue.useEffect(()=>{const I=N=>{b(N.detail.isOpen)};return window.addEventListener("geminiChatboxToggle",I),()=>{window.removeEventListener("geminiChatboxToggle",I)}},[]);const S=h&&(h.role==="admin"||h.role==="rootadmin")&&(h.adminApprovalStatus==="approved"||h.isDefaultAdmin);return g?null:S?_.jsx(uP,{}):_.jsx(cP,{})}const hP=()=>{const[h,g]=ue.useState(navigator.onLine),[b,S]=ue.useState(!1);return ue.useEffect(()=>{const I=()=>{g(!0),b&&setTimeout(()=>S(!1),3e3)},N=()=>{g(!1),S(!0)};return window.addEventListener("online",I),window.addEventListener("offline",N),()=>{window.removeEventListener("online",I),window.removeEventListener("offline",N)}},[b]),{isOnline:h,wasOffline:b}},dP=()=>{const{isOnline:h,wasOffline:g}=hP();return h&&!g?null:h&&g?_.jsx("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-[100] animate-fade-in",children:_.jsxs("div",{className:"bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3 animate-slide-down",children:[_.jsx(Sm,{className:"text-xl animate-pulse"}),_.jsxs("div",{className:"text-center",children:[_.jsx("p",{className:"font-semibold text-sm",children:"Connection Restored!"}),_.jsx("p",{className:"text-xs opacity-90",children:"You're back online"})]})]})}):_.jsx("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-[100] animate-fade-in",children:_.jsxs("div",{className:"bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3 animate-slide-down",children:[_.jsx(Gy,{className:"text-xl animate-pulse"}),_.jsxs("div",{className:"text-center",children:[_.jsxs("p",{className:"font-semibold text-sm flex items-center gap-2",children:[_.jsx(fS,{className:"text-yellow-300"}),"Internet Not Available"]}),_.jsx("p",{className:"text-xs opacity-90",children:"Please check your connection"})]})]})})},fP=()=>{const h="ontouchstart"in window||navigator.maxTouchPoints>0,g=window.innerWidth<=768,b=navigator.userAgent.toLowerCase(),S=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(b);return h&&(g||S)},c5=(h,g=null)=>{if(h){if(fP()){if(h.focus({preventScroll:!0}),g!==null&&h.setSelectionRange)try{h.setSelectionRange(g,g)}catch{h.focus()}setTimeout(()=>{h.blur(),h.focus({preventScroll:!0})},0)}else if(h.focus(),g!==null&&h.setSelectionRange)try{h.setSelectionRange(g,g)}catch{h.focus()}}},Nk=(h,g=null)=>{if(h&&(h.focus(),g!==null&&h.setSelectionRange))try{h.setSelectionRange(g,g)}catch{h.focus()}},ub=h=>{if(!h)return{score:0,level:"very-weak",feedback:[]};let g=0;const b=[];h.length>=8?g+=1:b.push("At least 8 characters"),h.length>=12&&(g+=1),h.length>=16&&(g+=1),/[a-z]/.test(h)?g+=1:b.push("Lowercase letters"),/[A-Z]/.test(h)?g+=1:b.push("Uppercase letters"),/[0-9]/.test(h)?g+=1:b.push("Numbers"),/[^A-Za-z0-9]/.test(h)?g+=1:b.push("Special characters"),/(.)\1{2,}/.test(h)?b.push("Avoid repeated characters"):g+=1,/123|abc|qwe|asd|zxc/i.test(h)?b.push("Avoid common sequences"):g+=1,/password|123456|qwerty|admin|login/i.test(h)?b.push("Avoid common passwords"):g+=1;let S;return g<=3?S="very-weak":g<=5?S="weak":g<=7?S="medium":g<=9?S="strong":S="very-strong",{score:g,level:S,feedback:b}},u5=h=>({"very-weak":"text-red-600",weak:"text-red-500",medium:"text-yellow-500",strong:"text-green-500","very-strong":"text-green-600"})[h]||"text-gray-500",h5=h=>({"very-weak":"bg-red-100",weak:"bg-red-50",medium:"bg-yellow-50",strong:"bg-green-50","very-strong":"bg-green-100"})[h]||"bg-gray-50",d5=h=>({"very-weak":"Very Weak",weak:"Weak",medium:"Medium",strong:"Strong","very-strong":"Very Strong"})[h]||"Unknown",_1=h=>{const{score:g}=ub(h);return g>=5},p6="https://urbansetu.onrender.com";function pP(){bc("Change Password - Security Settings");const{currentUser:h}=yo(it=>it.user),g=Pl(),b=bp(),S=ue.useRef(null),[I,N]=ue.useState({previousPassword:"",newPassword:"",confirmNewPassword:""}),[V,s]=ue.useState(!1),[q,Z]=ue.useState(!1),[Q,oe]=ue.useState(!1),[de,ze]=ue.useState(""),[le,Se]=ue.useState(!1),[ee,_e]=ue.useState(""),[ye,xe]=ue.useState({score:0,level:"very-weak",feedback:[]});ue.useEffect(()=>{S.current&&c5(S.current)},[]);const Le=it=>{const rt=ub(it);xe(rt)},Ae=it=>{const{name:rt,value:lt}=it.target;N({...I,[rt]:lt}),rt==="newPassword"&&Le(lt)},Ke=async it=>{if(it.preventDefault(),ze(""),_e(""),I.newPassword!==I.confirmNewPassword){ze("New passwords do not match");return}if(!_1(I.newPassword)){ze("Password does not meet minimum strength requirements");return}if(I.previousPassword===I.newPassword){ze("New password must be different from current password");return}Se(!0);try{const rt=await tb(`${p6}/api/user/change-password/${h._id}`,{method:"POST",body:JSON.stringify({previousPassword:I.previousPassword,newPassword:I.newPassword})}),lt=await rt.json();if(Se(!1),rt.status===401){ze("Session expired or unauthorized. Please sign in again."),b(C1());try{const xt=await(await fetch(`${p6}/api/auth/signout`,{credentials:"include"})).json();xt.success===!1?b(vp(xt.message)):(b(io(xt)),window.persistor&&window.persistor.purge&&await window.persistor.purge(),Dm(),localStorage.removeItem("accessToken"),document.cookie="access_token=; Max-Age=0; path=/; domain="+window.location.hostname+"; secure; samesite=None")}catch(zt){b(vp(zt.message))}ei.error("Session expired or unauthorized. Please sign in again."),setTimeout(()=>{g("/sign-in",{replace:!0})},1500);return}!rt.ok||lt.success===!1?ze(lt.message||"Failed to change password"):(_e("Password changed successfully"),setTimeout(()=>{g("/user")},1200))}catch{Se(!1),ze("An error occurred. Please try again.")}};return _.jsxs("div",{className:"min-h-screen flex",children:[_.jsxs("div",{className:"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-blue-600 to-purple-700 relative overflow-hidden",children:[_.jsx("div",{className:"absolute inset-0 bg-black opacity-20"}),_.jsx("div",{className:"relative z-10 flex flex-col justify-center items-center text-white p-12",children:_.jsxs("div",{className:"text-center max-w-md",children:[_.jsx("h1",{className:"text-4xl font-bold mb-6 animate-fade-in",children:"Change Password"}),_.jsx("p",{className:"text-xl mb-8 leading-relaxed animate-fade-in-delay",children:'"Security is not a product, but a process. Keep your account safe with a strong password."'}),_.jsxs("div",{className:"space-y-4 text-lg animate-fade-in-delay-2",children:[_.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[_.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),_.jsx("span",{children:"Secure & Strong"})]}),_.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[_.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"0.5s"}}),_.jsx("span",{children:"Easy to Remember"})]}),_.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[_.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"1s"}}),_.jsx("span",{children:"Keep Your Account Safe"})]})]})]})}),_.jsx("div",{className:"absolute top-20 left-20 w-16 h-16 bg-white bg-opacity-10 rounded-full animate-float"}),_.jsx("div",{className:"absolute bottom-32 right-16 w-12 h-12 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"2s"}}),_.jsx("div",{className:"absolute top-1/2 right-24 w-8 h-8 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"1s"}}),_.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black bg-opacity-20 flex items-center justify-center",children:_.jsx("svg",{className:"w-16 h-16 text-white opacity-30",fill:"currentColor",viewBox:"0 0 20 20",children:_.jsx("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})]}),_.jsx("div",{className:"w-full lg:w-1/2 flex items-center justify-center p-8 bg-gray-50",children:_.jsxs("div",{className:"w-full max-w-md",children:[_.jsxs("div",{className:"text-center mb-8",children:[_.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:" Change Password"}),_.jsx("p",{className:"text-gray-600",children:"Keep your account secure by updating your password regularly."})]}),_.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[_.jsxs("form",{onSubmit:Ke,className:"space-y-6",children:[_.jsxs("div",{children:[_.jsx("label",{htmlFor:"previousPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password"}),_.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"(Enter your existing password)"}),_.jsxs("div",{className:"relative",children:[_.jsx("input",{type:V?"text":"password",placeholder:"Enter your current password",id:"previousPassword",name:"previousPassword",value:I.previousPassword,onChange:Ae,ref:S,disabled:le,className:`w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${le?"bg-gray-100 cursor-not-allowed":""}`,required:!0}),_.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:()=>s(!V),children:V?_.jsx(jg,{className:"text-gray-600"}):_.jsx(au,{className:"text-gray-600"})})]})]}),_.jsxs("div",{children:[_.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),_.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"(Create a strong new password)"}),_.jsxs("div",{className:"relative",children:[_.jsx("input",{type:q?"text":"password",placeholder:"Create a strong password",id:"newPassword",name:"newPassword",value:I.newPassword,onChange:Ae,disabled:le,className:`w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${le?"bg-gray-100 cursor-not-allowed":""}`,required:!0}),_.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:()=>Z(!q),children:q?_.jsx(jg,{className:"text-gray-600"}):_.jsx(au,{className:"text-gray-600"})})]})]}),I.newPassword&&_.jsxs("div",{className:"space-y-3",children:[_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Password Strength:"}),_.jsx("span",{className:`text-sm font-semibold ${u5(ye.level)}`,children:d5(ye.level)})]}),_.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:_.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${ye.level==="very-weak"?"bg-red-500 w-1/5":ye.level==="weak"?"bg-red-400 w-2/5":ye.level==="medium"?"bg-yellow-400 w-3/5":ye.level==="strong"?"bg-green-400 w-4/5":"bg-green-500 w-full"}`})}),ye.feedback.length>0&&_.jsxs("div",{className:`p-3 rounded-lg ${h5(ye.level)}`,children:[_.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"To improve your password:"}),_.jsx("ul",{className:"text-xs space-y-1",children:ye.feedback.map((it,rt)=>_.jsxs("li",{className:"flex items-center",children:[_.jsx("span",{className:"mr-2",children:""}),it]},rt))})]}),_.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[_.jsxs("p",{children:[" ",_.jsx("strong",{children:"Tip:"})," Use a unique password for this account"]}),_.jsxs("p",{children:[" ",_.jsx("strong",{children:"Security:"})," Consider using a password manager"]})]})]}),_.jsxs("div",{children:[_.jsx("label",{htmlFor:"confirmNewPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),_.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"(Re-enter your new password)"}),_.jsxs("div",{className:"relative",children:[_.jsx("input",{type:Q?"text":"password",placeholder:"Confirm your new password",id:"confirmNewPassword",name:"confirmNewPassword",value:I.confirmNewPassword,onChange:Ae,disabled:le,className:`w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${le?"bg-gray-100 cursor-not-allowed":""}`,required:!0}),_.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:()=>oe(!Q),children:Q?_.jsx(jg,{className:"text-gray-600"}):_.jsx(au,{className:"text-gray-600"})})]})]}),_.jsx("button",{disabled:le||!_1(I.newPassword)||I.previousPassword===I.newPassword,className:"w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105",children:le?_.jsxs("div",{className:"flex items-center justify-center",children:[_.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Updating..."]}):" Update Password"}),de&&_.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:_.jsx("p",{className:"text-red-600 text-sm",children:de})}),ee&&_.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:_.jsx("p",{className:"text-blue-600 text-sm",children:ee})})]}),_.jsx("div",{className:"mt-6 text-center",children:_.jsxs("p",{className:"text-gray-600",children:["Changed your mind?"," ",_.jsx("button",{onClick:()=>g("/user/profile"),disabled:le,className:`text-blue-600 hover:text-blue-800 font-semibold hover:underline transition-colors duration-200 ${le?"opacity-50 cursor-not-allowed pointer-events-none":""}`,children:"Back to Profile"})]})})]})]})}),_.jsx(l5,{})]})}function mP(){bc("Change Password - Security Settings");const{currentUser:h}=yo(it=>it.user),g=Pl(),b=bp(),S=ue.useRef(null),[I,N]=ue.useState({previousPassword:"",newPassword:"",confirmNewPassword:""}),[V,s]=ue.useState(!1),[q,Z]=ue.useState(!1),[Q,oe]=ue.useState(!1),[de,ze]=ue.useState(""),[le,Se]=ue.useState(!1),[ee,_e]=ue.useState(""),[ye,xe]=ue.useState({score:0,level:"very-weak",feedback:[]});ue.useEffect(()=>{S.current&&c5(S.current)},[]);const Le=it=>{const rt=ub(it);xe(rt)},Ae=it=>{const{name:rt,value:lt}=it.target;N({...I,[rt]:lt}),rt==="newPassword"&&Le(lt)},Ke=async it=>{if(it.preventDefault(),ze(""),_e(""),I.newPassword!==I.confirmNewPassword){ze("New passwords do not match");return}if(!_1(I.newPassword)){ze("Password does not meet minimum strength requirements");return}if(I.previousPassword===I.newPassword){ze("New password must be different from current password");return}Se(!0);try{const rt=await tb(`https://urbansetu.onrender.com/api/user/change-password/${h._id}`,{method:"POST",body:JSON.stringify({previousPassword:I.previousPassword,newPassword:I.newPassword})}),lt=await rt.json();if(Se(!1),rt.status===401){ze("Session expired or unauthorized. Please sign in again."),b(C1());try{const xt=await(await fetch("https://urbansetu.onrender.com/api/auth/signout",{credentials:"include"})).json();xt.success===!1?b(vp(xt.message)):(b(io(xt)),window.persistor&&window.persistor.purge&&await window.persistor.purge(),Dm(),localStorage.removeItem("accessToken"),document.cookie="access_token=; Max-Age=0; path=/; domain="+window.location.hostname+"; secure; samesite=None")}catch(zt){b(vp(zt.message))}ei.error("Session expired or unauthorized. Please sign in again."),setTimeout(()=>{g("/sign-in",{replace:!0})},1500);return}!rt.ok||lt.success===!1?ze(lt.message||"Failed to change password"):(_e("Password changed successfully"),setTimeout(()=>{g("/admin")},1200))}catch{Se(!1),ze("An error occurred. Please try again.")}};return _.jsxs("div",{className:"min-h-screen flex",children:[_.jsxs("div",{className:"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-blue-600 to-purple-700 relative overflow-hidden",children:[_.jsx("div",{className:"absolute inset-0 bg-black opacity-20"}),_.jsx("div",{className:"relative z-10 flex flex-col justify-center items-center text-white p-12",children:_.jsxs("div",{className:"text-center max-w-md",children:[_.jsx("h1",{className:"text-4xl font-bold mb-6 animate-fade-in",children:"Change Password"}),_.jsx("p",{className:"text-xl mb-8 leading-relaxed animate-fade-in-delay",children:'"Security is not a product, but a process. Keep your account safe with a strong password."'}),_.jsxs("div",{className:"space-y-4 text-lg animate-fade-in-delay-2",children:[_.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[_.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),_.jsx("span",{children:"Secure & Strong"})]}),_.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[_.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"0.5s"}}),_.jsx("span",{children:"Easy to Remember"})]}),_.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[_.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"1s"}}),_.jsx("span",{children:"Keep Your Account Safe"})]})]})]})}),_.jsx("div",{className:"absolute top-20 left-20 w-16 h-16 bg-white bg-opacity-10 rounded-full animate-float"}),_.jsx("div",{className:"absolute bottom-32 right-16 w-12 h-12 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"2s"}}),_.jsx("div",{className:"absolute top-1/2 right-24 w-8 h-8 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"1s"}}),_.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black bg-opacity-20 flex items-center justify-center",children:_.jsx("svg",{className:"w-16 h-16 text-white opacity-30",fill:"currentColor",viewBox:"0 0 20 20",children:_.jsx("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})]}),_.jsx("div",{className:"w-full lg:w-1/2 flex items-center justify-center p-8 bg-gray-50",children:_.jsxs("div",{className:"w-full max-w-md",children:[_.jsxs("div",{className:"text-center mb-8",children:[_.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:" Change Password"}),_.jsx("p",{className:"text-gray-600",children:"Keep your account secure by updating your password regularly."})]}),_.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[_.jsxs("form",{onSubmit:Ke,className:"space-y-6",children:[_.jsxs("div",{children:[_.jsx("label",{htmlFor:"previousPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password"}),_.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"(Enter your existing password)"}),_.jsxs("div",{className:"relative",children:[_.jsx("input",{type:V?"text":"password",placeholder:"Enter your current password",id:"previousPassword",name:"previousPassword",value:I.previousPassword,onChange:Ae,ref:S,disabled:le,className:`w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${le?"bg-gray-100 cursor-not-allowed":""}`,required:!0}),_.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:()=>s(!V),children:V?_.jsx(jg,{className:"text-gray-600"}):_.jsx(au,{className:"text-gray-600"})})]})]}),_.jsxs("div",{children:[_.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),_.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"(Create a strong new password)"}),_.jsxs("div",{className:"relative",children:[_.jsx("input",{type:q?"text":"password",placeholder:"Create a strong password",id:"newPassword",name:"newPassword",value:I.newPassword,onChange:Ae,disabled:le,className:`w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${le?"bg-gray-100 cursor-not-allowed":""}`,required:!0}),_.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:()=>Z(!q),children:q?_.jsx(jg,{className:"text-gray-600"}):_.jsx(au,{className:"text-gray-600"})})]})]}),I.newPassword&&_.jsxs("div",{className:"space-y-3",children:[_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Password Strength:"}),_.jsx("span",{className:`text-sm font-semibold ${u5(ye.level)}`,children:d5(ye.level)})]}),_.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:_.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${ye.level==="very-weak"?"bg-red-500 w-1/5":ye.level==="weak"?"bg-red-400 w-2/5":ye.level==="medium"?"bg-yellow-400 w-3/5":ye.level==="strong"?"bg-green-400 w-4/5":"bg-green-500 w-full"}`})}),ye.feedback.length>0&&_.jsxs("div",{className:`p-3 rounded-lg ${h5(ye.level)}`,children:[_.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"To improve your password:"}),_.jsx("ul",{className:"text-xs space-y-1",children:ye.feedback.map((it,rt)=>_.jsxs("li",{className:"flex items-center",children:[_.jsx("span",{className:"mr-2",children:""}),it]},rt))})]}),_.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[_.jsxs("p",{children:[" ",_.jsx("strong",{children:"Tip:"})," Use a unique password for this account"]}),_.jsxs("p",{children:[" ",_.jsx("strong",{children:"Security:"})," Consider using a password manager"]})]})]}),_.jsxs("div",{children:[_.jsx("label",{htmlFor:"confirmNewPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),_.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"(Re-enter your new password)"}),_.jsxs("div",{className:"relative",children:[_.jsx("input",{type:Q?"text":"password",placeholder:"Confirm your new password",id:"confirmNewPassword",name:"confirmNewPassword",value:I.confirmNewPassword,onChange:Ae,disabled:le,className:`w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${le?"bg-gray-100 cursor-not-allowed":""}`,required:!0}),_.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:()=>oe(!Q),children:Q?_.jsx(jg,{className:"text-gray-600"}):_.jsx(au,{className:"text-gray-600"})})]})]}),_.jsx("button",{disabled:le||!_1(I.newPassword)||I.previousPassword===I.newPassword,className:"w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105",children:le?_.jsxs("div",{className:"flex items-center justify-center",children:[_.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Updating..."]}):" Update Password"}),de&&_.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:_.jsx("p",{className:"text-red-600 text-sm",children:de})}),ee&&_.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:_.jsx("p",{className:"text-blue-600 text-sm",children:ee})})]}),_.jsx("div",{className:"mt-6 text-center",children:_.jsxs("p",{className:"text-gray-600",children:["Changed your mind?"," ",_.jsx("button",{onClick:()=>g("/admin/profile"),disabled:le,className:`text-blue-600 hover:text-blue-800 font-semibold hover:underline transition-colors duration-200 ${le?"opacity-50 cursor-not-allowed pointer-events-none":""}`,children:"Back to Profile"})]})})]})]})}),_.jsx(l5,{})]})}const m6="https://urbansetu.onrender.com";function gP(){bc("Account Recovery - Restore Account");const{token:h}=QC(),g=Pl(),[b,S]=ue.useState(!0),[I,N]=ue.useState(""),[V,s]=ue.useState(!1),[q,Z]=ue.useState(null),[Q,oe]=ue.useState(!1),[de,ze]=ue.useState(!1),[le,Se]=ue.useState(null);ue.useEffect(()=>{h?ee():(N("Invalid or missing token"),S(!1))},[h]);const ee=async()=>{try{const ye=await fetch(`${m6}/api/auth/verify-revocation-token/${h}`,{method:"GET",headers:{"Content-Type":"application/json"}}),xe=await ye.json();ye.ok&&xe.success?(Z(xe.accountData),S(!1)):ye.status===410&&xe.error==="PURGED_ACCOUNT"?(ze(!0),Se(xe.details),S(!1)):(N(xe.message||"Invalid or expired token"),S(!1))}catch(ye){console.error("Error verifying token:",ye),N("Failed to verify token. Please try again."),S(!1)}},_e=async()=>{try{oe(!0);const ye=await fetch(`${m6}/api/auth/restore-account`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:h})}),xe=await ye.json();ye.ok&&xe.success?(s(!0),setTimeout(()=>{g("/sign-in")},3e3)):N(xe.message||"Failed to restore account")}catch(ye){console.error("Error restoring account:",ye),N("Failed to restore account. Please try again.")}finally{oe(!1)}};return b?_.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:_.jsxs("div",{className:"text-center",children:[_.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),_.jsx("p",{className:"text-gray-600",children:"Verifying your account restoration link..."})]})}):I?_.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:_.jsxs("div",{className:"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center",children:[_.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:_.jsx(Gy,{className:"w-8 h-8 text-red-600"})}),_.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Invalid Link"}),_.jsx("p",{className:"text-gray-600 mb-6",children:I}),_.jsxs("div",{className:"space-y-3",children:[_.jsx("button",{onClick:()=>g("/"),className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:"Go to Home"}),_.jsx("button",{onClick:()=>g("/sign-in"),className:"w-full bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors",children:"Sign In"})]})]})}):V?_.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:_.jsxs("div",{className:"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center",children:[_.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:_.jsx(Sm,{className:"w-8 h-8 text-green-600"})}),_.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Account Restored!"}),_.jsx("p",{className:"text-gray-600 mb-6",children:"Your account has been successfully restored. You will be redirected to the sign-in page shortly."}),_.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})]})}):de?_.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:_.jsxs("div",{className:"max-w-lg w-full bg-white rounded-xl shadow-lg overflow-hidden",children:[_.jsxs("div",{className:"bg-gradient-to-r from-red-600 to-red-700 px-8 py-6 text-white text-center",children:[_.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Account Permanently Deleted"}),_.jsx("p",{className:"text-red-100",children:"This account can no longer be restored"})]}),_.jsxs("div",{className:"p-8",children:[_.jsxs("div",{className:"text-center mb-6",children:[_.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:_.jsx(Gy,{className:"w-8 h-8 text-red-600"})}),_.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Account No Longer Available"}),_.jsx("p",{className:"text-gray-600",children:"This account has been permanently deleted and cannot be restored. However, you can create a new account to continue using our services."})]}),le&&_.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[_.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[_.jsx(zl,{className:"w-4 h-4 mr-2"}),"Previous Account Information"]}),_.jsxs("div",{className:"space-y-3",children:[_.jsxs("div",{className:"flex justify-between",children:[_.jsx("span",{className:"text-gray-600",children:"Username:"}),_.jsx("span",{className:"font-medium",children:le.username})]}),_.jsxs("div",{className:"flex justify-between",children:[_.jsx("span",{className:"text-gray-600",children:"Email:"}),_.jsx("span",{className:"font-medium",children:le.email})]}),_.jsxs("div",{className:"flex justify-between",children:[_.jsx("span",{className:"text-gray-600",children:"Permanently Deleted:"}),_.jsx("span",{className:"font-medium text-red-600",children:new Date(le.purgedAt).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),_.jsxs("div",{className:"flex justify-between",children:[_.jsx("span",{className:"text-gray-600",children:"Days Since Purge:"}),_.jsxs("span",{className:"font-medium text-red-600",children:[Math.ceil((new Date-new Date(le.purgedAt))/(1e3*60*60*24))," days"]})]})]})]}),_.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[_.jsxs("div",{className:"flex items-center mb-2",children:[_.jsx(Gy,{className:"w-4 h-4 text-red-600 mr-2"}),_.jsx("span",{className:"font-semibold text-red-800",children:"Important Notice"})]}),_.jsx("p",{className:"text-red-700 text-sm",children:"This account has been permanently deleted and cannot be restored. All data associated with this account has been permanently removed from our systems."})]}),_.jsxs("div",{className:"space-y-3",children:[_.jsxs("button",{onClick:()=>g("/sign-up"),className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center",children:[_.jsx(zl,{className:"w-4 h-4 mr-2"}),"Create New Account"]}),_.jsx("button",{onClick:()=>g("/sign-in"),className:"w-full bg-gray-600 text-white py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors flex items-center justify-center",children:"Sign In to Existing Account"}),_.jsx("button",{onClick:()=>g("/"),className:"w-full bg-gray-200 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-300 transition-colors",children:"Go to Home"})]}),_.jsx("div",{className:"mt-6 text-center",children:_.jsx("p",{className:"text-sm text-gray-500",children:"By creating a new account, you agree to our Terms of Service and Privacy Policy."})})]})]})}):_.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:_.jsxs("div",{className:"max-w-lg w-full bg-white rounded-xl shadow-lg overflow-hidden",children:[_.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 px-8 py-6 text-white text-center",children:[_.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Restore Your Account"}),_.jsx("p",{className:"text-blue-100",children:"Welcome back to UrbanSetu!"})]}),_.jsxs("div",{className:"p-8",children:[_.jsxs("div",{className:"text-center mb-6",children:[_.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:_.jsx(zl,{className:"w-8 h-8 text-blue-600"})}),_.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Account Found"}),_.jsx("p",{className:"text-gray-600",children:"We found your deleted account. You can restore it with all your previous data intact."})]}),q&&_.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[_.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[_.jsx(zl,{className:"w-4 h-4 mr-2"}),"Account Information"]}),_.jsxs("div",{className:"space-y-3",children:[_.jsxs("div",{className:"flex justify-between",children:[_.jsx("span",{className:"text-gray-600",children:"Username:"}),_.jsx("span",{className:"font-medium",children:q.username})]}),_.jsxs("div",{className:"flex justify-between",children:[_.jsx("span",{className:"text-gray-600",children:"Email:"}),_.jsx("span",{className:"font-medium",children:q.email})]}),_.jsxs("div",{className:"flex justify-between",children:[_.jsx("span",{className:"text-gray-600",children:"Role:"}),_.jsx("span",{className:"font-medium flex items-center",children:q.role==="admin"?_.jsxs(_.Fragment,{children:[_.jsx(_I,{className:"w-3 h-3 mr-1 text-purple-600"}),"Administrator"]}):"User"})]}),_.jsxs("div",{className:"flex justify-between",children:[_.jsx("span",{className:"text-gray-600",children:"Account Deleted:"}),_.jsx("span",{className:"font-medium",children:new Date(q.deletedAt).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),_.jsxs("div",{className:"flex justify-between",children:[_.jsx("span",{className:"text-gray-600",children:"Days Since Deletion:"}),_.jsxs("span",{className:"font-medium",children:[Math.ceil((new Date-new Date(q.deletedAt))/(1e3*60*60*24))," days"]})]}),_.jsxs("div",{className:"flex justify-between",children:[_.jsx("span",{className:"text-gray-600",children:"Link Valid Until:"}),_.jsx("span",{className:"font-medium text-green-600",children:new Date(q.expiresAt).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),_.jsxs("div",{className:"flex justify-between",children:[_.jsx("span",{className:"text-gray-600",children:"Days Remaining:"}),_.jsxs("span",{className:"font-medium text-green-600",children:[Math.max(0,Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24)))," days"]})]})]})]}),q&&_.jsxs("div",{className:`rounded-lg p-4 mb-6 ${Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=3?"bg-red-50 border border-red-200":Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=7?"bg-orange-50 border border-orange-200":"bg-green-50 border border-green-200"}`,children:[_.jsxs("div",{className:"flex items-center mb-2",children:[_.jsx("div",{className:`w-3 h-3 rounded-full mr-2 ${Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=3?"bg-red-500":Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=7?"bg-orange-500":"bg-green-500"}`}),_.jsx("span",{className:`font-semibold ${Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=3?"text-red-800":Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=7?"text-orange-800":"text-green-800"}`,children:Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=3?"URGENT: Link expires soon!":Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=7?"WARNING: Link expires in less than a week":"Status: Link is valid"})]}),_.jsx("p",{className:`text-sm ${Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=3?"text-red-700":Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=7?"text-orange-700":"text-green-700"}`,children:Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=3?"Please restore your account immediately to avoid permanent data loss.":Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=7?"Consider restoring your account soon to avoid missing the deadline.":"You have plenty of time to restore your account when convenient."})]}),_.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:[_.jsxs("div",{className:"flex items-center mb-2",children:[_.jsx(I1,{className:"w-4 h-4 text-yellow-600 mr-2"}),_.jsx("span",{className:"font-semibold text-yellow-800",children:"Important Notice"})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsxs("p",{className:"text-yellow-700 text-sm",children:["This restoration link will expire on ",_.jsx("strong",{children:q&&new Date(q.expiresAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})," (30 days from deletion)."]}),_.jsxs("p",{className:"text-yellow-700 text-sm",children:["You have ",_.jsxs("strong",{className:"text-yellow-800",children:[q&&Math.max(0,Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24)))," days"]})," remaining to restore your account."]}),_.jsx("p",{className:"text-yellow-700 text-sm",children:"After expiration, your account will be permanently removed and cannot be restored."})]})]}),_.jsx("button",{onClick:_e,disabled:Q,className:"w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:Q?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Restoring Account..."]}):_.jsxs(_.Fragment,{children:[_.jsx(Sm,{className:"w-4 h-4 mr-2"}),"Restore My Account"]})}),_.jsx("div",{className:"mt-6 text-center",children:_.jsx("p",{className:"text-sm text-gray-500",children:"By restoring your account, you agree to our Terms of Service and Privacy Policy."})})]})]})})}function _P(){return bc("Terms & Conditions - Legal Information"),_.jsxs("div",{className:"max-w-4xl mx-auto py-10 px-4",children:[_.jsx("h1",{className:"text-4xl font-bold mb-6 text-blue-700",children:"Terms & Conditions"}),_.jsxs("div",{className:"space-y-6 text-gray-800 text-base",children:[_.jsx("p",{className:"text-lg",children:"Welcome to UrbanSetu, our comprehensive real estate platform. By using our services, you agree to the following terms and conditions. Please read them carefully. By registering, you must select a role (user or admin) and provide explicit consent to our Terms & Privacy Policy."}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"1. Platform Overview & Services"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Real Estate Marketplace:"})," We provide a platform for buying, selling, and renting properties with advanced search and matching capabilities."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Smart Features:"})," AI-powered search, price monitoring, fraud detection, and intelligent property recommendations."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"User Roles:"})," Users can register as buyers, sellers, or administrators with different access levels and responsibilities."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Communication Tools:"})," Built-in messaging, appointment scheduling, and notification systems."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Analytics & Insights:"})," Market data, price trends, and property analytics for informed decision-making."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"2. User Registration & Account Management"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Account Creation:"})," You must provide accurate information including name, email, unique mobile number (10 digits), and select an appropriate role."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Verification:"})," Mobile number verification via OTP is required for account activation and security."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Password Security:"})," Strong password requirements are enforced. You are responsible for maintaining account security."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Account Deletion:"})," You may delete your account at any time. Data will be removed except where retention is legally required."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Multiple Accounts:"})," Creating multiple accounts to circumvent restrictions is prohibited."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"3. Property Listings & Content"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Accurate Information:"})," All property details, images, and descriptions must be truthful and current."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Image Rights:"})," You must own or have permission to use all uploaded images and content."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Pricing:"})," Property prices must be accurate and include all applicable fees and taxes."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Availability:"})," You must promptly update listing status (available, sold, rented) to maintain platform integrity."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Content Moderation:"})," We reserve the right to review, edit, or remove content that violates our guidelines."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"4. Smart Features & AI Services"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Natural Language Search:"})," Our AI processes search queries to provide relevant property recommendations."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Price Monitoring:"})," Watchlist features track price changes and send notifications about market movements."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Fraud Detection:"})," Automated systems monitor for suspicious activities and fraudulent listings."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Recommendations:"})," AI-powered suggestions based on your preferences and browsing history."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Data Usage:"})," Your interaction data helps improve our AI algorithms and service quality."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"5. User Responsibilities & Conduct"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Fair Dealing:"})," All users must act honestly and fairly in all transactions and communications."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"No Discrimination:"})," Discrimination based on race, gender, religion, or any protected status is strictly prohibited."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Respectful Communication:"})," Maintain professional and respectful communication with other users."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Legal Compliance:"})," All activities must comply with applicable local, state, and federal laws."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Prohibited Activities:"})," No spam, harassment, fraud, or misuse of platform features."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"6. Admin Responsibilities"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Impartial Review:"})," Admins must review listings and requests without bias or personal interest."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Platform Integrity:"})," Maintain platform quality by enforcing rules and removing inappropriate content."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"User Support:"})," Provide timely assistance and resolve disputes fairly."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Data Protection:"})," Handle user data responsibly and in accordance with privacy policies."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Security Monitoring:"})," Monitor for security threats and take appropriate action."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"7. Transactions & Payments"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Direct Transactions:"})," Property transactions occur directly between users. We facilitate connections but are not party to transactions."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Payment Processing:"})," Any payment features are provided by third-party services with their own terms."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Transaction Records:"})," We may maintain records of communications and appointments for dispute resolution."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Dispute Resolution:"})," Users are responsible for resolving transaction disputes. We may provide mediation services."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"8. Privacy & Data Protection"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Consent:"})," Explicit consent is required for data processing and certain platform features."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Data Usage:"})," Your data is used to provide services, improve platform functionality, and ensure security."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Third-Party Sharing:"})," We may share data with service providers but do not sell personal information."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Security Measures:"})," We implement industry-standard security measures to protect your data."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"9. Platform Rules & Enforcement"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Content Standards:"})," All content must be appropriate, legal, and relevant to real estate."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Account Suspension:"})," We may suspend or terminate accounts for violations of these terms."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Appeal Process:"})," Users may appeal account actions through our support system."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Platform Modifications:"})," We reserve the right to modify or discontinue features with notice."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"10. Intellectual Property"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Platform Rights:"})," We own all rights to the platform, including software, design, and content."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"User Content:"})," You retain rights to your content but grant us license to use it on the platform."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Prohibited Use:"})," No copying, reverse engineering, or unauthorized use of platform features."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"11. Limitation of Liability"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Service Availability:"})," We strive for uptime but do not guarantee uninterrupted service."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Third-Party Actions:"})," We are not responsible for actions of other users or third parties."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Property Transactions:"})," All property transactions are the responsibility of the involved parties."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Damages:"})," Our liability is limited to the maximum extent permitted by law."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"12. Changes to Terms"}),_.jsx("p",{className:"ml-6",children:"We may update these terms from time to time. Significant changes will be communicated through email or platform notifications. Continued use of the platform constitutes acceptance of the updated terms."}),_.jsxs("div",{className:"mt-8 p-6 bg-blue-50 rounded-lg border border-blue-200",children:[_.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"Contact Information"}),_.jsx("p",{className:"text-gray-700",children:"For questions about these terms or our services, please contact us:"}),_.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[_.jsx("li",{children:" Email: legal@urbansetu.com"}),_.jsx("li",{children:" Phone: +1 (555) 123-4567"}),_.jsx("li",{children:" Address: UrbanSetu Legal Team, Real Estate Platform"})]})]}),_.jsxs("p",{className:"mt-6 text-sm text-gray-600",children:["Last updated: ",new Date().toLocaleDateString()]})]})]})}function yP(){return bc("Privacy Policy - Data Protection"),_.jsxs("div",{className:"max-w-4xl mx-auto py-10 px-4",children:[_.jsx("h1",{className:"text-4xl font-bold mb-6 text-blue-700",children:"Privacy Policy"}),_.jsxs("div",{className:"space-y-6 text-gray-800 text-base",children:[_.jsx("p",{className:"text-lg",children:"Your privacy is important to us. This policy explains how we collect, use, and protect your information as a user or admin of our UrbanSetu real estate platform."}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"1. Information We Collect"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Account Information:"})," Name, email, validated mobile number (unique 10 digits), role selection (user/admin), profile picture, and authentication credentials."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Property Data:"})," Property listings, images, descriptions, pricing, location details, property specifications, and availability status."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Transaction Data:"})," Appointments, bookings, communications, payment information, and transaction history."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Platform Usage:"})," Search queries, watchlist items, wishlist preferences, browsing behavior, and interaction patterns."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Communication Data:"})," Messages, reviews, ratings, support tickets, and feedback."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Technical Data:"})," IP address, browser type, device information, location data, and usage analytics."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Security Data:"})," Login attempts, security events, OTP verification, and fraud prevention data."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"2. How We Use Your Information"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Service Provision:"})," To provide, maintain, and improve our real estate platform services."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"User Experience:"})," To personalize content, provide smart search results, and recommend relevant properties."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Communication:"})," To send notifications about price changes, new listings, appointments, and platform updates."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Security:"})," To prevent fraud, detect suspicious activities, and protect user accounts."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Analytics:"})," To understand user behavior, improve platform performance, and develop new features."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Compliance:"})," To comply with legal obligations and enforce platform terms."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"3. Smart Features & AI Integration"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Natural Language Processing:"})," We use AI to process search queries and provide intelligent property recommendations."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Price Monitoring:"})," We track property prices in your watchlist and notify you of changes."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Smart Notifications:"})," AI-powered alerts for price drops, new listings matching your preferences, and market insights."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Fraud Detection:"})," Automated systems to detect and prevent fraudulent activities and suspicious listings."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Content Moderation:"})," AI-assisted review of listings, images, and user-generated content for quality and compliance."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"4. Data Sharing & Third Parties"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"No Sale Policy:"})," We do not sell your personal information to third parties."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Service Providers:"})," We may share data with trusted partners for payment processing, email services, and analytics."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Legal Requirements:"})," We may disclose information when required by law or to protect our rights and users."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Business Transfers:"})," In case of merger or acquisition, user data may be transferred as part of business assets."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Public Information:"})," Property listings and reviews may be publicly visible as part of the platform's core functionality."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"5. Your Rights & Control"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Access:"})," You can view and download your personal data through your account settings."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Correction:"})," You can update your profile information, preferences, and account settings at any time."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Deletion:"})," You can delete your account, which will remove your personal data (except where retention is legally required)."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Portability:"})," You can export your data in a machine-readable format."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Opt-out:"})," You can unsubscribe from marketing communications while maintaining essential service notifications."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Consent Withdrawal:"})," You can withdraw consent for data processing where applicable."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"6. Data Security & Protection"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Encryption:"})," All data is encrypted in transit and at rest using industry-standard protocols."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Access Controls:"})," Strict access controls and authentication mechanisms protect your data."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Regular Audits:"})," We conduct regular security assessments and vulnerability testing."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Incident Response:"})," We have procedures in place to respond to and notify users of any data breaches."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Staff Training:"})," Our team is trained on data protection and privacy best practices."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"7. Data Retention"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Account Data:"})," Retained while your account is active and for a reasonable period after deletion."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Transaction Records:"})," Kept for legal and accounting purposes as required by law."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Communication Data:"})," Retained for customer service and dispute resolution purposes."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Analytics Data:"})," Aggregated and anonymized data may be retained for business insights."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"8. International Data Transfers"}),_.jsx("p",{className:"ml-6",children:"Your data may be processed and stored in servers located outside your country. We ensure appropriate safeguards are in place to protect your data in accordance with applicable privacy laws."}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"9. Children's Privacy"}),_.jsx("p",{className:"ml-6",children:"Our platform is not intended for users under 18 years of age. We do not knowingly collect personal information from children."}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"10. Changes to This Policy"}),_.jsx("p",{className:"ml-6",children:"We may update this privacy policy from time to time. We will notify you of significant changes through email or platform notifications. Continued use of the platform constitutes acceptance of the updated policy."}),_.jsxs("div",{className:"mt-8 p-6 bg-blue-50 rounded-lg border border-blue-200",children:[_.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"Contact Us"}),_.jsx("p",{className:"text-gray-700",children:"If you have any questions about this privacy policy or our data practices, please contact us:"}),_.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[_.jsx("li",{children:" Email: privacy@urbansetu.com"}),_.jsx("li",{children:" Phone: +1 (555) 123-4567"}),_.jsx("li",{children:" Address: UrbanSetu Privacy Team, Real Estate Platform"})]})]}),_.jsxs("p",{className:"mt-6 text-sm text-gray-600",children:["Last updated: ",new Date().toLocaleDateString()]})]})]})}function xP(){return bc("User Terms & Conditions - Legal Information"),_.jsxs("div",{className:"max-w-4xl mx-auto py-10 px-4",children:[_.jsx("h1",{className:"text-4xl font-bold mb-6 text-blue-700",children:"User Terms & Conditions"}),_.jsxs("div",{className:"space-y-6 text-gray-800 text-base",children:[_.jsx("p",{className:"text-lg",children:"By using UrbanSetu, you agree to these user terms. Please read them carefully."}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"1. Your Responsibilities"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsx("li",{children:"Provide accurate information. Mobile number must be unique and valid."}),_.jsx("li",{children:"Respect privacy and rights of others. No harassment or fraud."}),_.jsx("li",{children:"Ensure your listings are truthful and updated. False listings may lead to action."})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"2. Account & Consent"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsx("li",{children:"Explicit consent is required for our Terms and Privacy Policy."}),_.jsx("li",{children:"You may delete your account; data retention applies where required by law."}),_.jsx("li",{children:"Use strong passwords and keep your account secure."})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"3. Platform Use"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsx("li",{children:"Follow applicable laws and platform rules."}),_.jsx("li",{children:"We may remove content that violates guidelines."}),_.jsx("li",{children:"Admins may suspend accounts for serious violations."})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"4. Smart & AI Features"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsx("li",{children:"Natural language search, recommendations, and watchlist price monitoring."}),_.jsx("li",{children:"Notifications for price drops, new listings, and appointments."})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"5. Liability"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsx("li",{children:"We are not party to property transactions between users."}),_.jsx("li",{children:"We are not responsible for third-party actions."})]}),_.jsxs("p",{className:"mt-6 text-sm text-gray-600",children:["Last updated: ",new Date().toLocaleDateString()]})]})]})}function vP(){return bc("Admin Terms & Conditions - Legal Information"),_.jsxs("div",{className:"max-w-4xl mx-auto py-10 px-4",children:[_.jsx("h1",{className:"text-4xl font-bold mb-6 text-blue-700",children:"Admin Terms & Conditions"}),_.jsxs("div",{className:"space-y-6 text-gray-800 text-base",children:[_.jsx("p",{className:"text-lg",children:"By using UrbanSetu admin tools, you agree to these admin terms."}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"1. Admin Responsibilities"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsx("li",{children:"Act impartially and in users' best interests."}),_.jsx("li",{children:"Do not abuse admin privileges for personal gain."}),_.jsx("li",{children:"Maintain confidentiality of sensitive user and business data."}),_.jsx("li",{children:"Default admin privileges may have additional constraints."})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"2. Security & Compliance"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsx("li",{children:"Use strong authentication and keep sessions secure."}),_.jsx("li",{children:"Follow audit and logging practices for critical actions."}),_.jsx("li",{children:"Comply with applicable laws, regulations, and company policies."})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"3. Platform Rules"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsx("li",{children:"We may revoke admin access for violations."}),_.jsx("li",{children:"Admins must not bypass safeguards or manipulate data improperly."})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"4. Smart & AI Features"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsx("li",{children:"Use AI insights responsibly; verify results for critical actions."}),_.jsx("li",{children:"Do not rely solely on AI for compliance or legal decisions."})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"5. Liability"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsx("li",{children:"Admin actions are traceable; misuse can result in suspension or legal action."}),_.jsx("li",{children:"UrbanSetu is not responsible for third-party actions."})]}),_.jsxs("p",{className:"mt-6 text-sm text-gray-600",children:["Last updated: ",new Date().toLocaleDateString()]})]})]})}function bP(){return bc("User Privacy Policy - Data Protection"),_.jsxs("div",{className:"max-w-4xl mx-auto py-10 px-4",children:[_.jsx("h1",{className:"text-4xl font-bold mb-6 text-blue-700",children:"User Privacy Policy"}),_.jsxs("div",{className:"space-y-6 text-gray-800 text-base",children:[_.jsx("p",{className:"text-lg",children:"Your privacy is important to us. This policy explains how we collect, use, and protect your information as a user of UrbanSetu."}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"1. Information We Collect"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Account Information:"})," Name, email, validated mobile number (unique 10 digits), role (user), profile picture, and authentication credentials."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Property Data:"})," Listings you create, save, watch, or interact with; images and descriptions you upload."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Activity Data:"})," Search queries, wishlist and watchlist items, appointments, messages, and reviews."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Technical Data:"})," IP address, device and browser details, and usage analytics."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Security Data:"})," Login attempts, OTP verification, and fraud prevention signals."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"2. How We Use Your Information"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Provide Services:"})," Enable listings, search, watchlist, wishlist, and appointments."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Personalize Experience:"})," Smart search, recommendations, and relevant suggestions."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Notify:"})," Price-drop alerts, property updates, booking confirmations."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Protect:"})," Security monitoring, fraud detection, and abuse prevention."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Improve:"})," Analytics for product improvements and feature development."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"3. Your Rights"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Access & Correction:"})," View and update your profile data."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Deletion:"})," Delete your account to remove personal data (subject to legal retention)."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Opt-out:"})," Unsubscribe from marketing while keeping essential notifications."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Consent:"})," Withdraw consent for processing where applicable."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"4. Sharing & Third Parties"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"No Sale:"})," We do not sell personal information."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Service Providers:"})," Payments, email and analytics providers under strict agreements."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Legal:"})," Disclosures required by law or to protect rights and users."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"5. Security"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsx("li",{children:"Encryption in transit, access controls, regular audits, and incident response."}),_.jsx("li",{children:"Despite safeguards, no system is perfectuse the platform responsibly."})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"6. AI & Smart Features"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsx("li",{children:"We use NLP for search and recommendations."}),_.jsx("li",{children:"We monitor watchlist prices to send helpful alerts."})]}),_.jsxs("p",{className:"mt-6 text-sm text-gray-600",children:["Last updated: ",new Date().toLocaleDateString()]})]})]})}function wP(){return bc("Admin Privacy Policy - Data Protection"),_.jsxs("div",{className:"max-w-4xl mx-auto py-10 px-4",children:[_.jsx("h1",{className:"text-4xl font-bold mb-6 text-blue-700",children:"Admin Privacy Policy"}),_.jsxs("div",{className:"space-y-6 text-gray-800 text-base",children:[_.jsx("p",{className:"text-lg",children:"This policy explains how we collect, use, and protect your information as an admin on UrbanSetu."}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"1. Information We Collect"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Admin Profile:"})," Name, email, validated mobile number (unique 10 digits), role (admin/rootadmin), and authentication credentials."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Admin Activity:"})," Listing approvals, edits, removals, reviews, unlocks, and other moderation actions."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Operational Data:"})," Security events, OTP lockouts handling, system notices, and audit logs."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Technical Data:"})," IP address, device and browser details, usage analytics, and error logs."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"2. How We Use Admin Information"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"Operations:"})," Perform admin duties and maintain platform integrity."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Security:"})," Monitor threats, manage lockouts, and prevent abuse."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Compliance:"})," Maintain audit trails and follow legal obligations."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Improvement:"})," Use analytics and feedback to improve tooling."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"3. Admin Rights"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsx("li",{children:"Access your data and request corrections."}),_.jsx("li",{children:"Request account deletion (may be limited for default admins)."}),_.jsx("li",{children:"Receive important operational and security notifications."})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"4. Sharing & Third Parties"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsxs("li",{children:[_.jsx("strong",{children:"No Sale:"})," We do not sell admin information."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Service Providers:"})," Infrastructure, monitoring, analytics under strict agreements."]}),_.jsxs("li",{children:[_.jsx("strong",{children:"Legal:"})," Disclosures required by law or to protect our users and platform."]})]}),_.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"5. Security"}),_.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[_.jsx("li",{children:"Role-based access, encryption, audit logging, and incident response."}),_.jsx("li",{children:"Despite safeguards, no system is perfectuse admin tools responsibly."})]}),_.jsxs("p",{className:"mt-6 text-sm text-gray-600",children:["Last updated: ",new Date().toLocaleDateString()]})]})]})}const to="https://urbansetu.onrender.com";function TP(){var mn,Yr;bc("Account Management - User & Admin Control");const{currentUser:h}=yo(Ve=>Ve.user),g=Pl(),b=bp(),[S,I]=ue.useState([]),[N,V]=ue.useState([]),[s,q]=ue.useState(!0),[Z,Q]=ue.useState("users"),[oe,de]=ue.useState([]),[ze,le]=ue.useState({q:"",role:"all",softbannedBy:"",from:"",to:""}),[Se,ee]=ue.useState(!1),[_e,ye]=ue.useState([]),[xe,Le]=ue.useState({q:"",role:"all",purgedBy:"",from:"",to:""}),[Ae,Ke]=ue.useState(!1),[it,rt]=ue.useState({}),[lt,zt]=ue.useState(!1),[xt,Ci]=ue.useState(null),[Zi,or]=ue.useState(!1),[er,Jt]=ue.useState(""),[ji,Fi]=ue.useState(""),[Pr,tt]=ue.useState({category:"",banType:"allow",allowResignupAfterDays:0,notes:""}),[Ht,Pi]=ue.useState(!1),[Ui,ii]=ue.useState(!1),[Wi,_i]=ue.useState(""),[Ri,Ai]=ue.useState(""),[gt,Tt]=ue.useState(null),[Si,Sr]=ue.useState(!1),[Cr,zr]=ue.useState(""),[Er,Gn]=ue.useState(""),[ds,Zs]=ue.useState(null),[Br,Jn]=ue.useState({suspend:{},promote:{},demote:{},softban:!1,restore:!1,purge:!1}),[Rs,za]=ue.useState(!1),[La,fs]=ue.useState({listings:0,appointments:0}),[ps,$n]=ue.useState(""),[Xn,Ds]=ue.useState("all"),[Ps,Vs]=ue.useState("all"),[Pn,oa]=ue.useState([]),[Da,as]=ue.useState(!0),[va,Ms]=ue.useState(""),[os,hn]=ue.useState(""),[Dt,Ti]=ue.useState(!1),[Ar,br]=ue.useState(!1),[Rr,xn]=ue.useState({title:"",message:"",onConfirm:null,confirmText:"Confirm",cancelText:"Cancel",confirmButtonClass:"bg-red-500 hover:bg-red-600"}),xs=ue.useRef(null),Ct=ue.useRef(null);ue.useEffect(()=>{h&&Hs()},[h]),ue.useEffect(()=>{function Ve({type:Ft,user:Qt}){I(wi=>Ft==="delete"?wi.filter($i=>$i._id!==Qt._id):Ft==="update"?wi.map($i=>$i._id===Qt._id?Qt:$i):Ft==="add"?[Qt,...wi]:wi)}function wt({type:Ft,admin:Qt}){V(wi=>Ft==="delete"?wi.filter($i=>$i._id!==Qt._id):Ft==="update"?wi.map($i=>$i._id===Qt._id?Qt:$i):Ft==="add"?[Qt,...wi]:wi)}return pr.on("user_update",Ve),pr.on("admin_update",wt),()=>{pr.off("user_update",Ve),pr.off("admin_update",wt)}},[]),ue.useEffect(()=>{const Ve=wt=>{if((wt.ctrlKey||wt.metaKey)&&wt.key==="f"){wt.preventDefault();const Ft=document.getElementById("admin-management-search");Ft&&Ft.focus()}};return document.addEventListener("keydown",Ve),()=>document.removeEventListener("keydown",Ve)},[]);const Hs=async()=>{q(!0);try{const wt=await(await fetch(`${to}/api/admin/management/users`,{credentials:"include"})).json();if(I(wt),h.isDefaultAdmin){const Qt=await(await fetch(`${to}/api/admin/management/admins`,{credentials:"include"})).json();V(Qt)}try{const Ft=await fetch(`${to}/api/auth/password-lockouts`,{credentials:"include"}),Qt=await Ft.json();Ft.ok&&Qt&&Array.isArray(Qt.items)?oa(Qt.items):oa([])}catch{oa([])}try{await Pa()}catch{}try{await ba()}catch{}}catch{ei.error("Failed to fetch accounts")}finally{q(!1)}},Pa=async()=>{ee(!0);try{const Ve=new URLSearchParams;ze.q&&Ve.set("q",ze.q),ze.role&&ze.role!=="all"&&Ve.set("role",ze.role),ze.softbannedBy&&Ve.set("softbannedBy",ze.softbannedBy),ze.from&&Ve.set("from",ze.from),ze.to&&Ve.set("to",ze.to);const wt=await fetch(`${to}/api/admin/deleted-accounts?${Ve.toString()}`,{credentials:"include"}),Ft=await wt.json();wt.ok&&Ft&&Array.isArray(Ft.items)?de(Ft.items.filter(Qt=>!Qt.purgedAt)):de([])}catch{de([])}finally{ee(!1)}},ba=async()=>{Ke(!0);try{const Ve=new URLSearchParams;xe.q&&Ve.set("q",xe.q),xe.role&&xe.role!=="all"&&Ve.set("role",xe.role),xe.purgedBy&&Ve.set("purgedBy",xe.purgedBy),xe.from&&Ve.set("from",xe.from),xe.to&&Ve.set("to",xe.to);const wt=await fetch(`${to}/api/admin/deleted-accounts?${Ve.toString()}`,{credentials:"include"}),Ft=await wt.json();wt.ok&&Ft&&Array.isArray(Ft.items)?ye(Ft.items.filter(Qt=>Qt.purgedAt)):ye([])}catch{ye([])}finally{Ke(!1)}},He=async(Ve,wt)=>{const Ft=wt==="user"?S.find(tn=>tn._id===Ve):N.find(tn=>tn._id===Ve),Qt=(Ft==null?void 0:Ft.status)==="active",wi=Qt?"suspend":"activate",$i=Qt?"Suspend":"Activate";if(Qt){Tt({id:Ve,type:wt}),_i(""),ii(!0);return}const Sn=async()=>{Jn(tn=>({...tn,suspend:{...tn.suspend,[Ve]:!0}})),wt==="user"?I(tn=>tn.map(dn=>dn._id===Ve?{...dn,status:dn.status==="active"?"suspended":"active"}:dn)):V(tn=>tn.map(dn=>dn._id===Ve?{...dn,status:dn.status==="active"?"suspended":"active"}:dn));try{const tn=await fetch(`${to}/api/admin/management/suspend/${wt}/${Ve}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:Qt?Wi||"Policy violation":null})}),dn=await tn.json();tn.ok?(ei.success(`${wt==="user"?"User":"Admin"} status updated`),rt(In=>({...In,[Ve]:void 0})),pr.emit(wt==="user"?"user_update":"admin_update",{type:"update",[wt]:dn,userId:Ve}),pr.emit("force_signout",{userId:Ve,action:"suspend",message:`Your account has been ${dn.status==="suspended"?"suspended":"activated"}. You have been signed out.`}),br(!1)):(Hs(),ei.error(dn.message||"Failed to update status"),rt(In=>({...In,[Ve]:"Can't able to suspend account, may be softbanned or moved"})),setTimeout(()=>rt(In=>({...In,[Ve]:void 0})),4e3))}catch{Hs(),ei.error("Failed to update status"),rt(dn=>({...dn,[Ve]:"Can't able to suspend account, may be deleted or moved"})),setTimeout(()=>rt(dn=>({...dn,[Ve]:void 0})),4e3)}finally{Jn(tn=>({...tn,suspend:{...tn.suspend,[Ve]:!1}}))}};Mi(`${$i} ${wt==="user"?"User":"Admin"}`,`Are you sure you want to ${wi} this ${wt}? ${Qt?"They will be signed out and unable to access their account.":"They will regain access to their account."}`,Sn,{confirmText:$i,confirmButtonClass:Qt?"bg-yellow-500 hover:bg-yellow-600":"bg-green-500 hover:bg-green-600",userId:Ve})},J=async()=>{if(!gt)return;const{id:Ve,type:wt}=gt;Jn(Ft=>({...Ft,suspend:{...Ft.suspend,[Ve]:!0}})),wt==="user"?I(Ft=>Ft.map(Qt=>Qt._id===Ve?{...Qt,status:"suspended"}:Qt)):V(Ft=>Ft.map(Qt=>Qt._id===Ve?{...Qt,status:"suspended"}:Qt));try{const Ft=await fetch(`${to}/api/admin/management/suspend/${wt}/${Ve}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:Wi==="other"?Ri:Wi||"Policy violation"})}),Qt=await Ft.json();Ft.ok?(ei.success(`${wt==="user"?"User":"Admin"} suspended successfully`),rt(wi=>({...wi,[Ve]:void 0})),pr.emit(wt==="user"?"user_update":"admin_update",{type:"update",[wt]:Qt,userId:Ve}),pr.emit("force_signout",{userId:Ve,action:"suspend",message:"Your account has been suspended. You have been signed out."}),ii(!1),Tt(null),_i(""),Ai("")):(Hs(),ei.error(Qt.message||"Failed to suspend account"),rt(wi=>({...wi,[Ve]:"Can't able to suspend account, may be softbanned or moved"})),setTimeout(()=>rt(wi=>({...wi,[Ve]:void 0})),4e3))}catch{Hs(),ei.error("Failed to suspend account"),rt(Qt=>({...Qt,[Ve]:"Can't able to suspend account, may be deleted or moved"})),setTimeout(()=>rt(Qt=>({...Qt,[Ve]:void 0})),4e3)}finally{Jn(Ft=>({...Ft,suspend:{...Ft.suspend,[Ve]:!1}}))}},ie=async(Ve,wt)=>{Ci({_id:Ve,type:wt}),Jt(""),Fi(""),tt({category:"",banType:"allow",allowResignupAfterDays:0,notes:""}),or(!0)},me=async()=>{const Ve=xt;if(!Ve)return;const wt=Ve._id,Ft=Ve.type,Qt=er==="other"?ji||"":er,$i={...Pr,category:er==="other"?"other":er},Sn=async()=>{Jn(In=>({...In,softban:!0}));const tn=[...S],dn=[...N];Ft==="user"?I(In=>In.filter(Yn=>Yn._id!==wt)):V(In=>In.filter(Yn=>Yn._id!==wt));try{const In=await fetch(`${to}/api/admin/management/delete/${Ft}/${wt}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:Qt,policy:$i})}),Yn=await In.json();In.ok?(ei.success(`${Ft==="user"?"User":"Admin"} softbanned successfully`),pr.emit(Ft==="user"?"user_update":"admin_update",{type:"delete",[Ft]:{_id:wt},userId:wt}),pr.emit("force_signout",{userId:wt,action:"softban",message:"Your account has been softbanned. You have been signed out."}),Z==="softbanned"&&Pa(),br(!1),or(!1),Ci(null),Jt(""),Fi("")):(Ft==="user"?I(tn):V(dn),In.status===404||Yn.message&&Yn.message.toLowerCase().includes("not found")?ei.error("Account not found. It may have been already softbanned or moved."):ei.error(Yn.message||"Failed to softban account"))}catch(In){Ft==="user"?I(tn):V(dn),In.name==="TypeError"&&In.message.includes("fetch")?ei.error("Network error. Please check your connection and try again."):ei.error("Failed to softban account. Please try again.")}finally{Jn(In=>({...In,softban:!1}))}};Mi("Confirm Softban",`Are you sure you want to softban this ${Ft}? This can be restored later.`,Sn,{confirmText:"Softban",confirmButtonClass:"bg-red-500 hover:bg-red-600",accountId:wt})},je=async(Ve,wt)=>{Pi(!0),za(!0),Ci(null),fs({listings:0,appointments:0});try{const Ft=await fetch(`${to}/api/user/id/${Ve._id}`),Qt=await Ft.json();if(Ft.ok){Ci({...Qt,type:wt});try{const[wi,$i]=await Promise.all([fetch(`${to}/api/listing/user/${Ve._id}`,{credentials:"include"}),fetch(`${to}/api/bookings/user/${Ve._id}`,{credentials:"include"})]);let Sn=0,tn=0;if(wi.ok){const dn=await wi.json();Sn=Array.isArray(dn)?dn.length:0}$i.ok&&(tn=(await $i.json()).count||0),fs({listings:Sn,appointments:tn})}catch(wi){console.error("Error fetching account stats:",wi),fs({listings:0,appointments:0})}}else console.error("Failed to fetch account details:",Qt.message),Ci(null)}catch(Ft){console.error("Error in handleAccountClick:",Ft),Ci(null)}za(!1)},Pe=async Ve=>{const wt=S.find(Qt=>Qt._id===Ve);if(wt&&wt.status==="suspended"){ei.error("Cannot promote suspended account. Please remove suspension first.");return}Mi("Promote User to Admin","Are you sure you want to promote this user to admin? They will gain administrative privileges.",async()=>{Jn($i=>({...$i,promote:{...$i.promote,[Ve]:!0}}));const Qt=[...S],wi=[...N];wt&&(I($i=>$i.filter(Sn=>Sn._id!==Ve)),V($i=>[{...wt,role:"admin",adminApprovalStatus:"approved"},...$i]));try{const $i=await fetch(`${to}/api/admin/management/promote/${Ve}`,{method:"PATCH",credentials:"include"}),Sn=await $i.json();$i.ok?(ei.success("User promoted to admin successfully"),pr.emit("admin_update",{type:"add",admin:{...wt,...Sn},userId:Ve}),pr.emit("user_update",{type:"delete",user:{_id:Ve},userId:Ve}),pr.emit("force_signout",{userId:Ve,action:"promote",message:"Your account has been promoted to admin. You have been signed out. Please sign in again to access admin features."}),br(!1)):(I(Qt),V(wi),ei.error(Sn.message||"Failed to promote user"))}catch{I(Qt),V(wi),ei.error("Failed to promote user")}finally{Jn($i=>({...$i,promote:{...$i.promote,[Ve]:!1}}))}},{confirmText:"Promote",confirmButtonClass:"bg-purple-500 hover:bg-purple-600",userId:Ve})},Ie=async Ve=>{const wt=N.find(Ft=>Ft._id===Ve);if(wt&&wt.status==="suspended"){ei.error("Cannot demote suspended account. Please remove suspension first.");return}Zs({id:Ve}),zr(""),Sr(!0)},Qe=async()=>{if(!ds)return;const{id:Ve}=ds,wt=N.find(wi=>wi._id===Ve);Jn(wi=>({...wi,demote:{...wi.demote,[Ve]:!0}}));const Ft=[...S],Qt=[...N];wt&&(V(wi=>wi.filter($i=>$i._id!==Ve)),I(wi=>[{...wt,role:"user",adminApprovalStatus:void 0},...wi]));try{const wi=await fetch(`${to}/api/admin/management/demote/${Ve}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:Cr==="other"?Er:Cr||"Administrative decision"})}),$i=await wi.json();wi.ok?(ei.success("Admin demoted to user successfully"),pr.emit("user_update",{type:"add",user:{...wt,...$i},userId:Ve}),pr.emit("admin_update",{type:"delete",admin:{_id:Ve},userId:Ve}),pr.emit("force_signout",{userId:Ve,action:"demote",message:"Your admin privileges have been revoked. You have been signed out. Please sign in again as a regular user."}),Sr(!1),Zs(null),zr(""),Gn("")):(I(Ft),V(Qt),ei.error($i.message||"Failed to demote admin"))}catch{I(Ft),V(Qt),ei.error("Failed to demote admin")}finally{Jn(wi=>({...wi,demote:{...wi.demote,[Ve]:!1}}))}},Be=async Ve=>{try{const wt=await fetch(`${to}/api/admin/management/reapprove/${Ve}`,{method:"PATCH",credentials:"include"}),Ft=await wt.json();wt.ok?(V(Qt=>Qt.map(wi=>wi._id===Ve?{...wi,adminApprovalStatus:"approved",status:"active"}:wi)),ei.success("Admin re-approved successfully!"),pr.emit("admin_update",{type:"update",admin:{...Ft},userId:Ve}),pr.emit("force_signout",{userId:Ve,action:"reapprove",message:"Your admin account has been re-approved. You have been signed out. Please sign in again to access admin features."})):ei.error(Ft.message||"Failed to re-approve admin")}catch{ei.error("Failed to re-approve admin")}},Je=Ve=>{let wt=Ve;if(ps.trim()){const Ft=ps.toLowerCase();wt=wt.filter(Qt=>{var wi,$i,Sn;return((wi=Qt.username)==null?void 0:wi.toLowerCase().includes(Ft))||(($i=Qt.email)==null?void 0:$i.toLowerCase().includes(Ft))||((Sn=Qt.mobileNumber)==null?void 0:Sn.toLowerCase().includes(Ft))})}if(Xn!=="all")if(Xn==="locked"){const Ft=new Set(Pn.filter(Qt=>new Date(Qt.unlockAt)>new Date).map(Qt=>(Qt.email||"").toLowerCase()));wt=wt.filter(Qt=>Ft.has((Qt.email||"").toLowerCase()))}else wt=wt.filter(Ft=>Ft.status===Xn);return Z==="admins"&&Ps!=="all"&&(wt=wt.filter(Ft=>Ft.adminApprovalStatus===Ps)),wt},Lt=Je(S),vt=Je(N),pi=Ve=>{if(!ps.trim()||!Ve)return Ve;const wt=new RegExp(`(${ps})`,"gi");return Ve.split(wt).map((Qt,wi)=>wt.test(Qt)?_.jsx("span",{className:"bg-yellow-200 font-semibold rounded px-1",children:Qt},wi):Qt)},Mi=(Ve,wt,Ft,Qt={})=>{xn({title:Ve,message:wt,onConfirm:Ft,confirmText:Qt.confirmText||"Confirm",cancelText:Qt.cancelText||"Cancel",confirmButtonClass:Qt.confirmButtonClass||"bg-red-500 hover:bg-red-600",userId:Qt.userId,accountId:Qt.accountId}),br(!0)},Vi=()=>{br(!1),xn({title:"",message:"",onConfirm:null,confirmText:"Confirm",cancelText:"Cancel",confirmButtonClass:"bg-red-500 hover:bg-red-600"})},lr=()=>{Rr.onConfirm&&Rr.onConfirm()},nr=async Ve=>{Mi("Restore Account","Are you sure you want to restore this account? The user will be able to sign in again.",async()=>{Jn(Ft=>({...Ft,restore:!0}));try{const Ft=await fetch(`${to}/api/admin/deleted-accounts/restore/${Ve}`,{method:"POST",credentials:"include"}),Qt=await Ft.json();Ft.ok?(ei.success("Account restored"),Pa(),br(!1)):ei.error(Qt.message||"Restore failed")}catch{ei.error("Failed to restore account")}finally{Jn(Ft=>({...Ft,restore:!1}))}},{confirmText:"Restore",confirmButtonClass:"bg-green-500 hover:bg-green-600",accountId:Ve})},cr=async Ve=>{Mi("Permanently Purge Account","Are you sure you want to permanently purge this account? This action cannot be undone.",async()=>{Jn(Ft=>({...Ft,purge:!0}));try{const Ft=await fetch(`${to}/api/admin/deleted-accounts/purge/${Ve}`,{method:"DELETE",credentials:"include"}),Qt=await Ft.json();Ft.ok?(ei.success("Account purged"),Pa(),ba(),br(!1)):ei.error(Qt.message||"Purge failed")}catch{ei.error("Failed to purge account")}finally{Jn(Ft=>({...Ft,purge:!1}))}},{confirmText:"Purge",confirmButtonClass:"bg-red-500 hover:bg-red-600",accountId:Ve})},Hr=()=>{xs.current&&clearTimeout(xs.current),Ct.current&&clearTimeout(Ct.current),Ct.current=setTimeout(()=>{ei.info("For security reasons, you will be asked to re-enter your password in 1 minute.")},4*60*1e3),xs.current=setTimeout(()=>{as(!0),ei.info("Session expired for security. Please re-enter your password.")},5*60*1e3)};if(ue.useEffect(()=>(Da?(xs.current&&clearTimeout(xs.current),Ct.current&&clearTimeout(Ct.current)):Hr(),()=>{xs.current&&clearTimeout(xs.current),Ct.current&&clearTimeout(Ct.current)}),[Da]),ue.useEffect(()=>(Ht||Ar||Zi?(document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%"):(document.body.style.overflow="",document.body.style.position="",document.body.style.width=""),()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width=""}),[Ht,Ar,Zi]),!Array.isArray(S)||Z==="admins"&&!Array.isArray(N)&&h.isDefaultAdmin)return _.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-purple-100",children:_.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[_.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Session expired or unauthorized"}),_.jsx("p",{className:"text-gray-700 mb-4",children:"Please sign in again to access admin management."}),_.jsx("a",{href:"/sign-in",className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:"Go to Sign In"})]})});if(!h)return null;const ur=async Ve=>{Ve.preventDefault(),Ti(!0),hn("");try{const wt=await fetch(`${to}/api/admin/management/verify-password`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:va})});if(wt.ok)as(!1),Ms(""),hn(""),Hr();else{const Ft=await wt.json();ei.error("For security reasons, you have been signed out. Please sign in again."),b(C1());try{const wi=await(await fetch(`${to}/api/auth/signout`)).json();wi.success===!1?b(vp(wi.message)):b(io(wi))}catch(Qt){b(vp(Qt.message))}setTimeout(()=>{g("/sign-in")},800);return}}catch{hn("Network error")}finally{Ti(!1)}};return Da?_.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:_.jsxs("form",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs flex flex-col gap-4",onSubmit:ur,children:[_.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[_.jsx(SI,{})," Confirm Password"]}),_.jsx("input",{type:"password",className:"border rounded p-2 w-full",placeholder:"Enter your password",value:va,onChange:Ve=>Ms(Ve.target.value),autoFocus:!0}),os&&_.jsx("div",{className:"text-red-600 text-sm",children:os}),_.jsxs("div",{className:"flex gap-2 justify-end",children:[_.jsx("button",{type:"button",className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",onClick:()=>g(-1),children:"Cancel"}),_.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-700 text-white font-semibold",disabled:Dt,children:Dt?"Verifying...":"Confirm"})]})]})}):_.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100 py-10 px-2 md:px-8 animate-fadeIn",children:[_.jsxs("div",{className:"max-w-6xl mx-auto bg-white rounded-2xl shadow-2xl p-8 animate-slideUp",children:[_.jsxs("div",{className:"flex items-center justify-between mb-8",children:[_.jsx("h1",{className:"text-4xl font-extrabold text-blue-700 drop-shadow animate-fade-in",children:"Accounts Management"}),_.jsxs("button",{onClick:()=>Hs(),className:"px-3 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold shadow inline-flex items-center gap-2",title:"Refresh data",children:[_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4 h-4",children:_.jsx("path",{d:"M12 6V3L8 7l4 4V8c2.757 0 5 2.243 5 5a5 5 0 11-9.9-1H5.026A7 7 0 1019 13c0-3.86-3.141-7-7-7z"})}),"Refresh"]})]}),_.jsxs("div",{className:"flex flex-wrap gap-2 sm:gap-4 mb-8 animate-fadeIn",children:[_.jsxs("button",{className:`px-3 sm:px-6 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-lg shadow transition-all duration-200 ${Z==="users"?"bg-gradient-to-r from-blue-500 to-purple-500 text-white scale-105":"bg-gray-100 text-gray-700 hover:bg-blue-50"}`,onClick:()=>{Q("users"),zt(!1),$n(""),Ds("all"),Vs("all")},children:["Users (",S.length,")"]}),_.jsxs("button",{className:`px-3 sm:px-6 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-lg shadow transition-all duration-200 ${Z==="admins"?"bg-gradient-to-r from-blue-500 to-purple-500 text-white scale-105":"bg-gray-100 text-gray-700 hover:bg-purple-50"}`,onClick:()=>{h.isDefaultAdmin?(zt(!1),Q("admins"),$n(""),Ds("all"),Vs("all")):(zt(!0),Q("admins"),$n(""),Ds("all"))},children:["Admins (",N.length,")"]}),_.jsxs("button",{className:`px-3 sm:px-6 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-lg shadow transition-all duration-200 ${Z==="softbanned"?"bg-gradient-to-r from-red-500 to-red-600 text-white scale-105":"bg-gray-100 text-gray-700 hover:bg-rose-50"}`,onClick:()=>{Q("softbanned"),$n(""),Ds("all"),Vs("all"),Pa()},children:[_.jsxs("span",{className:"hidden sm:inline",children:["Softbanned Accounts (",oe.length,")"]}),_.jsxs("span",{className:"sm:hidden",children:["Softbanned (",oe.length,")"]})]}),_.jsxs("button",{className:`px-3 sm:px-6 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-lg shadow transition-all duration-200 ${Z==="purged"?"bg-gradient-to-r from-red-500 to-orange-500 text-white scale-105":"bg-gray-100 text-gray-700 hover:bg-red-50"}`,onClick:()=>{Q("purged"),$n(""),Ds("all"),Vs("all"),ba()},children:[_.jsxs("span",{className:"hidden sm:inline",children:["Purged Accounts (",_e.length,")"]}),_.jsxs("span",{className:"sm:hidden",children:["Purged (",_e.length,")"]})]})]}),_.jsxs("div",{className:"mb-6 animate-fadeIn",children:[Z!=="softbanned"&&Z!=="purged"?_.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[_.jsxs("div",{className:"relative",children:[_.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:_.jsx(Rm,{className:"h-5 w-5 text-gray-400 group-hover:text-blue-500 transition-colors duration-200"})}),_.jsx("input",{id:"admin-management-search",type:"text",placeholder:`Search ${Z==="users"?"users":"admins"} by name, email...`,value:ps,onChange:Ve=>$n(Ve.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-xl leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 shadow-sm"}),ps&&_.jsx("button",{onClick:()=>$n(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:_.jsx("span",{className:"text-xl",children:""})})]}),_.jsxs("div",{className:"relative",children:[_.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:_.jsx(Sm,{className:"h-5 w-5 text-gray-400 group-hover:text-green-500 transition-colors duration-200"})}),_.jsxs("select",{value:Xn,onChange:Ve=>Ds(Ve.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-xl leading-5 bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 shadow-sm appearance-none cursor-pointer",children:[_.jsx("option",{value:"all",children:"All Status"}),_.jsx("option",{value:"active",children:"Active"}),_.jsx("option",{value:"suspended",children:"Suspended"}),_.jsx("option",{value:"locked",children:"Locked"})]}),_.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:_.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),Z==="admins"&&_.jsxs("div",{className:"relative",children:[_.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:_.jsx(K_,{className:"h-5 w-5 text-gray-400 group-hover:text-purple-500 transition-colors duration-200"})}),_.jsxs("select",{value:Ps,onChange:Ve=>Vs(Ve.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-xl leading-5 bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 shadow-sm appearance-none cursor-pointer",children:[_.jsx("option",{value:"all",children:"All Approval Status"}),_.jsx("option",{value:"pending",children:"Pending"}),_.jsx("option",{value:"approved",children:"Approved"}),_.jsx("option",{value:"rejected",children:"Rejected"})]}),_.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:_.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:_.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),_.jsx("div",{className:"flex items-center",children:_.jsxs("button",{onClick:()=>{$n(""),Ds("all"),Vs("all")},className:"w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-medium transition-colors duration-200 flex items-center justify-center gap-2",children:[_.jsx(_o,{className:"text-sm"}),"Clear All Filters"]})})]}):Z==="softbanned"?_.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[_.jsx("input",{value:ze.q,onChange:Ve=>le(wt=>({...wt,q:Ve.target.value})),placeholder:"Search name/email",className:"px-3 py-3 border rounded-xl"}),_.jsxs("select",{value:ze.role,onChange:Ve=>le(wt=>({...wt,role:Ve.target.value})),className:"px-3 py-3 border rounded-xl",children:[_.jsx("option",{value:"all",children:"All Roles"}),_.jsx("option",{value:"user",children:"User"}),h.isDefaultAdmin&&_.jsx("option",{value:"admin",children:"Admin"})]}),_.jsx("input",{type:"date",value:ze.from,onChange:Ve=>le(wt=>({...wt,from:Ve.target.value})),className:"px-3 py-3 border rounded-xl"}),_.jsx("input",{type:"date",value:ze.to,onChange:Ve=>le(wt=>({...wt,to:Ve.target.value})),className:"px-3 py-3 border rounded-xl"}),_.jsx("input",{value:ze.softbannedBy,onChange:Ve=>le(wt=>({...wt,softbannedBy:Ve.target.value})),placeholder:"Softbanned by (id or self)",className:"px-3 py-3 border rounded-xl"}),_.jsxs("div",{className:"flex items-center gap-2",children:[_.jsx("button",{onClick:Pa,className:"px-4 py-3 bg-red-600 text-white rounded-xl",children:"Apply"}),_.jsx("button",{onClick:()=>{le({q:"",role:"all",softbannedBy:"",from:"",to:""}),setTimeout(Pa,0)},className:"px-4 py-3 bg-gray-100 rounded-xl",children:"Clear"})]}),_.jsx("div",{className:"col-span-full text-sm text-gray-600",children:h.isDefaultAdmin?"You are viewing all softbanned accounts (users + admins).":"You are viewing only softbanned user accounts."})]}):_.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[_.jsx("input",{value:xe.q,onChange:Ve=>Le(wt=>({...wt,q:Ve.target.value})),placeholder:"Search name/email",className:"px-3 py-3 border rounded-xl"}),_.jsxs("select",{value:xe.role,onChange:Ve=>Le(wt=>({...wt,role:Ve.target.value})),className:"px-3 py-3 border rounded-xl",children:[_.jsx("option",{value:"all",children:"All Roles"}),_.jsx("option",{value:"user",children:"User"}),h.isDefaultAdmin&&_.jsx("option",{value:"admin",children:"Admin"})]}),_.jsx("input",{type:"date",value:xe.from,onChange:Ve=>Le(wt=>({...wt,from:Ve.target.value})),className:"px-3 py-3 border rounded-xl"}),_.jsx("input",{type:"date",value:xe.to,onChange:Ve=>Le(wt=>({...wt,to:Ve.target.value})),className:"px-3 py-3 border rounded-xl"}),_.jsx("input",{value:xe.purgedBy,onChange:Ve=>Le(wt=>({...wt,purgedBy:Ve.target.value})),placeholder:"Purged by (id)",className:"px-3 py-3 border rounded-xl"}),_.jsxs("div",{className:"flex items-center gap-2",children:[_.jsx("button",{onClick:ba,className:"px-4 py-3 bg-red-600 text-white rounded-xl",children:"Apply"}),_.jsx("button",{onClick:()=>{Le({q:"",role:"all",purgedBy:"",from:"",to:""}),setTimeout(ba,0)},className:"px-4 py-3 bg-gray-100 rounded-xl",children:"Clear"})]}),_.jsx("div",{className:"col-span-full text-sm text-gray-600",children:h.isDefaultAdmin?"You are viewing all purged accounts (users + admins). These accounts are permanently removed.":"You are viewing only purged user accounts. These accounts are permanently removed."})]}),Z!=="softbanned"&&Z!=="purged"&&(ps||Xn!=="all"||Ps!=="all")&&_.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[_.jsxs("div",{className:"text-sm text-blue-800",children:[_.jsx("span",{className:"font-semibold",children:"Active Filters:"}),ps&&_.jsxs("span",{className:"ml-2 px-2 py-1 bg-blue-200 rounded text-xs",children:['Search: "',ps,'"']}),Xn!=="all"&&_.jsxs("span",{className:"ml-2 px-2 py-1 bg-green-200 rounded text-xs",children:["Status: ",Xn]}),Z==="admins"&&Ps!=="all"&&_.jsxs("span",{className:"ml-2 px-2 py-1 bg-purple-200 rounded text-xs",children:["Approval: ",Ps]})]}),_.jsxs("div",{className:"mt-2 text-sm text-blue-700",children:["Found ",Z==="users"?Lt.length:vt.length," ",Z==="users"?"user":"admin",Z==="users"?Lt.length!==1?"s":"":vt.length!==1?"s":""," matching your filters"]})]}),_.jsx("div",{className:"mt-2 text-xs text-gray-400",children:" Tip: Press Ctrl+F to quickly focus the search box  Use status filter to view active or suspended accounts"})]}),s?_.jsxs("div",{className:"flex flex-col items-center justify-center h-64 animate-fadeIn",children:[_.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mb-4"}),_.jsx("p",{className:"text-lg text-gray-500 font-semibold",children:"Loading accounts..."})]}):_.jsxs(_.Fragment,{children:[Z==="users"&&_.jsxs("div",{children:[_.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2 animate-fadeIn",children:[_.jsx(zl,{className:"text-blue-500"})," Users (",S.length,")"]}),Lt.length===0?_.jsxs("div",{className:"flex flex-col items-center justify-center py-16 animate-fadeIn",children:[_.jsx(U4,{className:"text-6xl text-gray-300 mb-4"}),_.jsx("p",{className:"text-gray-500 text-lg font-medium",children:ps||Xn!=="all"?"No users found matching your filters":"No users found."}),(ps||Xn!=="all")&&_.jsx("button",{onClick:()=>{$n(""),Ds("all")},className:"mt-4 text-blue-500 hover:text-blue-600 underline",children:"Clear all filters"})]}):_.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 animate-fadeIn",children:Lt.map(Ve=>_.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 rounded-2xl shadow-lg p-6 flex flex-col gap-4 hover:scale-105 transition-transform duration-200 animate-slideUp cursor-pointer",onClick:()=>je(Ve,"user"),title:"Click to view full details",children:[_.jsxs("div",{className:"flex items-center gap-4",children:[_.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-200 flex items-center justify-center text-2xl font-bold text-blue-700 shadow-inner",children:_.jsx(zl,{})}),_.jsxs("div",{children:[_.jsxs("div",{className:"flex flex-wrap items-center gap-2 min-w-0",children:[_.jsx("span",{className:"text-lg font-semibold text-gray-800 truncate max-w-[120px] sm:max-w-[180px] md:max-w-[220px]",title:Ve.username,children:pi(Ve.username)}),_.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-bold break-words whitespace-nowrap mt-1 sm:mt-0 ${Ve.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:Ve.status})]}),_.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm mt-1",children:[_.jsx(nd,{})," ",pi(Ve.email)]}),(()=>{if(!Pn||!Array.isArray(Pn))return null;const wt=Pn.find(wi=>(wi.email||"").toLowerCase()===(Ve.email||"").toLowerCase()&&new Date(wi.unlockAt)>new Date);if(!wt)return null;const Ft=new Date(wt.unlockAt).getTime()-Date.now(),Qt=Math.max(1,Math.ceil(Ft/6e4));return _.jsxs("div",{className:"mt-1 text-xs text-orange-700 bg-orange-50 border border-orange-200 rounded px-2 py-1 inline-block",children:["Locked: about ",Qt," minute",Qt>1?"s":""," left"]})})(),Ve.mobileNumber&&_.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm mt-1",children:[_.jsx(fv,{})," ",pi(Ve.mobileNumber)]}),_.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-xs mt-1",children:[_.jsx(_p,{})," ",new Date(Ve.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})]})]})]}),_.jsxs("div",{className:"flex flex-col gap-2 mt-4 sm:flex-row sm:gap-2",children:[_.jsx("button",{className:`flex-1 px-2 py-1 rounded-lg font-semibold text-sm transition-all duration-200 flex items-center justify-center gap-2 ${Ve.status==="active"?"bg-yellow-400 text-white hover:bg-yellow-500":"bg-green-500 text-white hover:bg-green-600"}`,onClick:wt=>{wt.stopPropagation(),He(Ve._id,"user")},children:Br.suspend[Ve._id]?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),Ve.status==="active"?"Suspending...":"Activating..."]}):_.jsxs(_.Fragment,{children:[Ve.status==="active"?_.jsx(L4,{}):_.jsx(Sm,{}),Ve.status==="active"?"Suspend":"Activate"]})}),_.jsxs("button",{className:"flex-1 px-2 py-1 rounded-lg font-semibold text-sm bg-red-500 text-white hover:bg-red-600 transition-all duration-200 flex items-center justify-center gap-2",onClick:wt=>{wt.stopPropagation(),ie(Ve._id,"user")},children:[_.jsx(su,{})," Softban"]}),h.isDefaultAdmin&&_.jsx("button",{className:"flex-1 px-2 py-1 rounded-lg font-semibold text-sm bg-purple-500 text-white hover:bg-purple-600 transition-all duration-200 flex items-center justify-center gap-2",onClick:wt=>{wt.stopPropagation(),Pe(Ve._id)},children:Br.promote[Ve._id]?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Promoting..."]}):_.jsxs(_.Fragment,{children:[_.jsx(K_,{})," Promote to Admin"]})})]}),it[Ve._id]&&_.jsx("div",{className:"text-red-500 text-xs mt-2 animate-fadeIn",children:it[Ve._id]})]},Ve._id))})]}),Z==="admins"&&!h.isDefaultAdmin&&lt&&_.jsxs("div",{className:"flex flex-col items-center justify-center py-16 animate-fadeIn",children:[_.jsx("div",{className:"text-6xl mb-4",children:""}),_.jsx("p",{className:"text-red-500 text-lg font-medium",children:"Only the current default admin can access admin account management."})]}),Z==="admins"&&h.isDefaultAdmin&&!lt&&_.jsxs("div",{className:"mt-10",children:[_.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2 animate-fadeIn",children:[_.jsx(K_,{className:"text-purple-500"})," Admins (",N.length,")"]}),vt.length===0?_.jsxs("div",{className:"flex flex-col items-center justify-center py-16 animate-fadeIn",children:[_.jsx(U4,{className:"text-6xl text-gray-300 mb-4"}),_.jsx("p",{className:"text-gray-500 text-lg font-medium",children:ps||Xn!=="all"||Ps!=="all"?"No admins found matching your filters":"No admins found."}),(ps||Xn!=="all"||Ps!=="all")&&_.jsx("button",{onClick:()=>{$n(""),Ds("all"),Vs("all")},className:"mt-4 text-blue-500 hover:text-blue-600 underline",children:"Clear all filters"})]}):_.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 animate-fadeIn",children:vt.map(Ve=>_.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-100 rounded-2xl shadow-lg p-6 flex flex-col gap-4 hover:scale-105 transition-transform duration-200 animate-slideUp cursor-pointer",onClick:()=>je(Ve,"admin"),title:"Click to view full details",children:[_.jsxs("div",{className:"flex items-center gap-4",children:[_.jsx("div",{className:"w-16 h-16 rounded-full bg-purple-200 flex items-center justify-center text-2xl font-bold text-purple-700 shadow-inner",children:_.jsx(K_,{})}),_.jsxs("div",{children:[_.jsxs("div",{className:"flex flex-wrap items-center gap-2 min-w-0",children:[_.jsx("span",{className:"text-lg font-semibold text-gray-800 truncate max-w-[120px] sm:max-w-[180px] md:max-w-[220px]",title:Ve.username,children:pi(Ve.username)}),_.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-bold break-words whitespace-nowrap mt-1 sm:mt-0 ${Ve.adminApprovalStatus==="rejected"?"bg-gray-300 text-gray-700":Ve.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:Ve.adminApprovalStatus==="rejected"?"rejected":Ve.status})]}),_.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm mt-1",children:[_.jsx(nd,{})," ",pi(Ve.email)]}),(()=>{if(!Pn||!Array.isArray(Pn))return null;const wt=Pn.find(wi=>(wi.email||"").toLowerCase()===(Ve.email||"").toLowerCase()&&new Date(wi.unlockAt)>new Date);if(!wt)return null;const Ft=new Date(wt.unlockAt).getTime()-Date.now(),Qt=Math.max(1,Math.ceil(Ft/6e4));return _.jsxs("div",{className:"mt-1 text-xs text-orange-700 bg-orange-50 border border-orange-200 rounded px-2 py-1 inline-block",children:["Locked: about ",Qt," minute",Qt>1?"s":""," left"]})})(),Ve.mobileNumber&&_.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm mt-1",children:[_.jsx(fv,{})," ",pi(Ve.mobileNumber)]}),_.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-xs mt-1",children:[_.jsx(_p,{})," ",new Date(Ve.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})]})]})]}),_.jsxs("div",{className:"flex flex-col gap-2 mt-4 sm:flex-row sm:gap-2",children:[_.jsx("button",{className:`flex-1 px-2 py-1 rounded-lg font-semibold text-sm transition-all duration-200 flex items-center justify-center gap-2 ${Ve.status==="active"?"bg-yellow-400 text-white hover:bg-yellow-500":"bg-green-500 text-white hover:bg-green-600"}`,onClick:wt=>{wt.stopPropagation(),He(Ve._id,"admin")},children:Br.suspend[Ve._id]?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),Ve.status==="active"?"Suspending...":"Activating..."]}):_.jsxs(_.Fragment,{children:[Ve.status==="active"?_.jsx(L4,{}):_.jsx(Sm,{}),Ve.status==="active"?"Suspend":"Activate"]})}),_.jsxs("button",{className:"flex-1 px-2 py-1 rounded-lg font-semibold text-sm bg-red-500 text-white hover:bg-red-600 transition-all duration-200 flex items-center justify-center gap-2",onClick:wt=>{wt.stopPropagation(),ie(Ve._id,"admin")},children:[_.jsx(su,{})," Softban"]}),_.jsx("button",{className:"flex-1 px-2 py-1 rounded-lg font-semibold text-sm bg-blue-500 text-white hover:bg-blue-600 transition-all duration-200 flex items-center justify-center gap-2",onClick:wt=>{wt.stopPropagation(),Ie(Ve._id)},children:Br.demote[Ve._id]?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Demoting..."]}):_.jsxs(_.Fragment,{children:[_.jsx(pI,{})," Demote to User"]})}),h.isDefaultAdmin&&Ve.adminApprovalStatus==="rejected"&&_.jsxs("button",{className:"flex-1 px-2 py-1 rounded-lg font-semibold text-sm bg-green-600 text-white hover:bg-green-700 transition-all duration-200 flex items-center justify-center gap-2",onClick:wt=>{wt.stopPropagation(),Be(Ve._id)},children:[_.jsx(Sm,{})," Re-Approve"]})]}),it[Ve._id]&&_.jsx("div",{className:"text-red-500 text-xs mt-2 animate-fadeIn",children:it[Ve._id]})]},Ve._id))})]}),Z==="softbanned"&&_.jsxs("div",{className:"mt-6",children:[_.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:["Softbanned Accounts (",oe.length,")"]}),Se?_.jsxs("div",{className:"flex items-center justify-center p-8",children:[_.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),_.jsx("span",{className:"ml-3 text-gray-600",children:"Loading..."})]}):oe.length===0?_.jsx("div",{className:"p-6 text-center text-gray-500 border rounded-xl",children:"No softbanned accounts found"}):_.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-200",children:_.jsxs("table",{className:"min-w-full text-sm",children:[_.jsx("thead",{className:"bg-gray-50",children:_.jsxs("tr",{className:"text-left text-gray-700",children:[_.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Name"}),_.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Email"}),_.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Role"}),_.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Date Softbanned"}),_.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Softbanned By"}),_.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Reason"}),_.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Policy"}),_.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Actions"})]})}),_.jsx("tbody",{className:"divide-y divide-gray-200",children:oe.map(Ve=>{var wt;return _.jsxs("tr",{className:"hover:bg-gray-50",children:[_.jsx("td",{className:"px-4 py-2 font-medium text-gray-800 whitespace-nowrap",children:Ve.name}),_.jsx("td",{className:"px-4 py-2 text-gray-700 whitespace-nowrap",children:Ve.email}),_.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:_.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${Ve.role==="admin"?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:Ve.role})}),_.jsx("td",{className:"px-4 py-2 text-gray-600 whitespace-nowrap",children:Ve.deletedAt?new Date(Ve.deletedAt).toLocaleString("en-GB"):"-"}),_.jsx("td",{className:"px-4 py-2 text-gray-600 whitespace-nowrap",children:typeof Ve.deletedBy=="string"?Ve.deletedBy:((wt=Ve.deletedBy)==null?void 0:wt._id)||Ve.deletedBy}),_.jsx("td",{className:"px-4 py-2 text-gray-600 whitespace-nowrap",children:Ve.reason||"-"}),_.jsx("td",{className:"px-4 py-2 text-gray-600",children:Ve.policy?_.jsxs("div",{className:"text-xs",children:[_.jsxs("div",{children:[_.jsx("strong",{children:"Category:"})," ",Ve.policy.category||"-"]}),_.jsxs("div",{children:[_.jsx("strong",{children:"Ban Type:"})," ",Ve.policy.banType||"-"]}),Ve.policy.allowResignupAfterDays>0&&_.jsxs("div",{children:[_.jsx("strong",{children:"Resignup After:"})," ",Ve.policy.allowResignupAfterDays," days"]})]}):"-"}),_.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:h.isDefaultAdmin?_.jsxs("div",{className:"flex gap-2",children:[_.jsx("button",{onClick:()=>nr(Ve._id),className:"px-3 py-1 bg-green-600 text-white rounded-lg text-xs",children:"Restore"}),_.jsx("button",{onClick:()=>cr(Ve._id),className:"px-3 py-1 bg-red-600 text-white rounded-lg text-xs",children:"Purge"})]}):_.jsx("div",{className:"flex gap-2",children:Ve.role==="user"?_.jsx("button",{onClick:()=>nr(Ve._id),className:"px-3 py-1 bg-green-600 text-white rounded-lg text-xs",children:"Restore"}):_.jsx("span",{className:"text-xs text-gray-500",children:"View only"})})})]},Ve._id)})})]})})]}),Z==="purged"&&_.jsxs("div",{className:"mt-6",children:[_.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:["Purged Accounts (Permanently Removed) (",_e.length,")"]}),Ae?_.jsxs("div",{className:"flex items-center justify-center p-8",children:[_.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),_.jsx("span",{className:"ml-3 text-gray-600",children:"Loading..."})]}):_e.length===0?_.jsx("div",{className:"p-6 text-center text-gray-500 border rounded-xl",children:"No purged accounts found"}):_.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-200",children:_.jsxs("table",{className:"min-w-full text-sm",children:[_.jsx("thead",{className:"bg-red-50",children:_.jsxs("tr",{className:"text-left text-gray-700",children:[_.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Name"}),_.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Email"}),_.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Role"}),_.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Date Softbanned"}),_.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Date Purged"}),_.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Purged By"}),_.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Reason"}),_.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Policy"})]})}),_.jsx("tbody",{className:"divide-y divide-gray-200",children:_e.map(Ve=>_.jsxs("tr",{className:"hover:bg-red-50",children:[_.jsx("td",{className:"px-4 py-2 font-medium text-gray-800 whitespace-nowrap",children:Ve.name}),_.jsx("td",{className:"px-4 py-2 text-gray-700 whitespace-nowrap",children:Ve.email}),_.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:_.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${Ve.role==="admin"?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:Ve.role})}),_.jsx("td",{className:"px-4 py-2 text-gray-600 whitespace-nowrap",children:Ve.deletedAt?new Date(Ve.deletedAt).toLocaleString("en-GB"):"-"}),_.jsx("td",{className:"px-4 py-2 text-red-600 font-semibold whitespace-nowrap",children:Ve.purgedAt?new Date(Ve.purgedAt).toLocaleString("en-GB"):"-"}),_.jsx("td",{className:"px-4 py-2 text-gray-600 whitespace-nowrap",children:Ve.purgedBy?typeof Ve.purgedBy=="string"?Ve.purgedBy:Ve.purgedBy._id:"-"}),_.jsx("td",{className:"px-4 py-2 text-gray-600 whitespace-nowrap",children:Ve.reason||"-"}),_.jsx("td",{className:"px-4 py-2 text-gray-600",children:Ve.policy?_.jsxs("div",{className:"text-xs",children:[_.jsxs("div",{children:[_.jsx("strong",{children:"Category:"})," ",Ve.policy.category||"-"]}),_.jsxs("div",{children:[_.jsx("strong",{children:"Ban Type:"})," ",Ve.policy.banType||"-"]}),Ve.policy.allowResignupAfterDays>0&&_.jsxs("div",{children:[_.jsx("strong",{children:"Resignup After:"})," ",Ve.policy.allowResignupAfterDays," days"]})]}):"-"})]},Ve._id))})]})})]})]})]}),Ht&&_.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:_.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-xs sm:max-w-md mx-2 sm:mx-4 max-h-[90vh] overflow-y-auto p-0 sm:p-0 relative animate-fadeIn",children:[_.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>Pi(!1),title:"Close","aria-label":"Close",children:_.jsx(_o,{className:"w-4 h-4"})}),_.jsxs("div",{className:"flex flex-col items-center justify-center bg-gradient-to-r from-blue-100 to-purple-100 rounded-t-2xl px-6 py-5 border-b border-gray-200",children:[_.jsxs("div",{className:"flex items-center gap-3",children:[_.jsx("img",{src:(xt==null?void 0:xt.avatar)||"https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png",alt:"avatar",className:"w-16 h-16 rounded-full object-cover border-4 border-white shadow-lg",onError:Ve=>{Ve.target.onerror=null,Ve.target.src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png"}}),_.jsxs("div",{children:[_.jsx("h2",{className:"text-xl font-bold text-blue-800 flex items-center gap-2",children:xt==null?void 0:xt.username}),_.jsx("p",{className:"text-xs text-gray-500",children:xt==null?void 0:xt.email})]})]}),_.jsx("div",{className:"mt-2 flex flex-col items-center",children:_.jsxs("span",{className:"inline-flex items-center gap-1 text-sm text-purple-700 font-semibold",children:[(xt==null?void 0:xt.type)==="admin"?_.jsx(K_,{className:"text-purple-500"}):_.jsx(zl,{className:"text-blue-500"}),(xt==null?void 0:xt.type)==="admin"?"Admin":"User"]})})]}),_.jsx("div",{className:"px-4 sm:px-8 py-4 space-y-4",children:Rs?_.jsx("div",{className:"flex justify-center items-center h-32",children:_.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):xt?_.jsxs(_.Fragment,{children:[_.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[_.jsxs("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:[_.jsx(fv,{className:"text-blue-400"}),_.jsxs("span",{children:[_.jsx("strong",{children:"Mobile:"})," ",xt.mobileNumber||"Not provided"]})]}),_.jsxs("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:[_.jsx(zl,{className:"text-purple-400"}),_.jsxs("span",{children:[_.jsx("strong",{children:"Gender:"})," ",xt.gender?xt.gender.charAt(0).toUpperCase()+xt.gender.slice(1):"Not provided"]})]}),_.jsxs("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:[_.jsx(Fg,{className:"text-green-400"}),_.jsxs("span",{children:[_.jsx("strong",{children:"Address:"})," ",xt.address||"Not provided"]})]}),_.jsxs("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:[_.jsx(_p,{className:"text-purple-400"}),_.jsxs("span",{children:[_.jsx("strong",{children:"Member Since:"})," ",xt.createdAt?new Date(xt.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):""]})]}),_.jsxs("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:[_.jsx(_p,{className:"text-blue-400"}),_.jsxs("span",{children:[_.jsx("strong",{children:"Last Updated Profile:"})," ",xt.updatedAt?new Date(xt.updatedAt).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})+" "+new Date(xt.updatedAt).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):"Never"]})]}),_.jsxs("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:[_.jsx(ib,{className:"text-green-400"}),_.jsxs("span",{children:[_.jsx("strong",{children:"Listings:"})," ",La.listings]})]}),_.jsxs("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:[_.jsx(gI,{className:"text-pink-400"}),_.jsxs("span",{children:[_.jsx("strong",{children:"Appointments:"})," ",La.appointments]})]})]}),_.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-2",children:[_.jsx("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:_.jsxs("span",{children:[_.jsx("strong",{children:"Status:"})," ",xt.status||"active"]})}),(()=>{if(!Pn||!Array.isArray(Pn))return null;const Ve=Pn.find(Qt=>(Qt.email||"").toLowerCase()===(xt.email||"").toLowerCase()&&new Date(Qt.unlockAt)>new Date);if(!Ve)return null;const wt=new Date(Ve.unlockAt).getTime()-Date.now(),Ft=Math.max(1,Math.ceil(wt/6e4));return _.jsx("div",{className:"flex items-center gap-2 text-orange-700 text-sm",children:_.jsxs("span",{children:[_.jsx("strong",{children:"Time left to unlock:"})," about ",Ft," minute",Ft>1?"s":""]})})})(),xt.status==="suspended"&&_.jsxs("div",{className:"space-y-1",children:[_.jsx("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:_.jsxs("span",{children:[_.jsx("strong",{children:"Suspended on:"})," ",xt.suspendedAt?new Date(xt.suspendedAt).toLocaleString("en-GB",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit",year:"numeric"}):"N/A"]})}),xt.suspendedBy&&_.jsx("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:_.jsxs("span",{children:[_.jsx("strong",{children:"Suspended by:"})," ",((mn=xt.suspendedBy)==null?void 0:mn.username)||((Yr=xt.suspendedBy)==null?void 0:Yr.email)||xt.suspendedBy]})})]}),xt.type==="admin"&&_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:_.jsxs("span",{children:[_.jsx("strong",{children:"Admin Status:"})," ",xt.adminApprovalStatus]})}),_.jsx("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:_.jsxs("span",{children:[_.jsx("strong",{children:"Admin Approval Date:"})," ",xt.adminApprovalDate?new Date(xt.adminApprovalDate).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A"]})}),_.jsx("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:_.jsxs("span",{children:[_.jsx("strong",{children:"Approved By:"})," ",xt.approvedBy?xt.approvedBy.username||xt.approvedBy.email||xt.approvedBy:"N/A"]})}),_.jsx("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:_.jsxs("span",{children:[_.jsx("strong",{children:"Admin Request Date:"})," ",xt.adminRequestDate?new Date(xt.adminRequestDate).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A"]})}),_.jsx("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:_.jsxs("span",{children:[_.jsx("strong",{children:"Is Default Admin:"})," ",xt.isDefaultAdmin?"Yes":"No"]})})]})]})]}):_.jsx("p",{className:"text-red-500",children:"Failed to load details."})})]})}),Ar&&_.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:_.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 animate-fadeIn",children:_.jsxs("div",{className:"p-6",children:[_.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:Rr.title}),_.jsx("p",{className:"text-gray-600 mb-6",children:Rr.message}),_.jsxs("div",{className:"flex gap-3 justify-end",children:[_.jsx("button",{onClick:Vi,className:"px-4 py-2 rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300 font-semibold transition-colors",children:Rr.cancelText}),_.jsx("button",{onClick:lr,className:`px-4 py-2 rounded-lg text-white font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 ${Rr.confirmButtonClass}`,disabled:Br.promote[Rr.userId]||Br.demote[Rr.userId]||Br.restore||Br.purge||Br.suspend[Rr.userId]||Br.softban,children:Br.promote[Rr.userId]||Br.demote[Rr.userId]||Br.restore||Br.purge||Br.suspend[Rr.userId]||Br.softban?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),Br.promote[Rr.userId]?"Promoting...":Br.demote[Rr.userId]?"Demoting...":Br.suspend[Rr.userId]?"Activating...":Br.softban?"Processing...":Br.restore?"Restoring...":"Purging..."]}):Rr.confirmText})]})]})})}),Zi&&_.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:_.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto",children:[_.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Reason for Softban"}),_.jsx("p",{className:"text-gray-600 mb-3",children:"Please select a reason and configure policy to proceed."}),_.jsxs("div",{className:"mb-4",children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason"}),_.jsxs("select",{className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500",value:er,onChange:Ve=>Jt(Ve.target.value),children:[_.jsx("option",{value:"",children:"Select a reason"}),(xt==null?void 0:xt.type)==="user"?_.jsxs(_.Fragment,{children:[_.jsx("option",{value:"fraud",children:"Fraudulent activity"}),_.jsx("option",{value:"duplicate",children:"Fake or duplicate account"}),_.jsx("option",{value:"inappropriate",children:"Inappropriate content or behavior"}),_.jsx("option",{value:"policy_violation",children:"Violation of terms & policies"}),_.jsx("option",{value:"requested_by_user",children:"Requested by user (support request)"}),_.jsx("option",{value:"other",children:"Other (textbox optional)"})]}):_.jsxs(_.Fragment,{children:[_.jsx("option",{value:"misuse_privileges",children:"Misuse of admin privileges"}),_.jsx("option",{value:"inactive_admin",children:"Inactive admin account"}),_.jsx("option",{value:"violation_trust",children:"Violation of policies or trust"}),_.jsx("option",{value:"role_restructure",children:"Role restructuring / reassigning"}),_.jsx("option",{value:"other",children:"Other (textbox optional)"})]})]})]}),er==="other"&&_.jsxs("div",{className:"mb-4",children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Details"}),_.jsx("input",{type:"text",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500",placeholder:"Optional details",value:ji,onChange:Ve=>Fi(Ve.target.value)})]}),_.jsxs("div",{className:"mb-4",children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ban Type"}),_.jsxs("select",{className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:Pr.banType,onChange:Ve=>tt(wt=>({...wt,banType:Ve.target.value})),children:[_.jsx("option",{value:"allow",children:"Allow re-signup (default)"}),_.jsx("option",{value:"ban",children:"Permanent ban"})]})]}),Pr.banType==="allow"&&_.jsxs("div",{className:"mb-4",children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cooling-off Period (days)"}),_.jsx("input",{type:"number",min:"0",max:"365",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0 for immediate re-signup",value:Pr.allowResignupAfterDays,onChange:Ve=>tt(wt=>({...wt,allowResignupAfterDays:parseInt(Ve.target.value)||0}))}),_.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Set to 0 for immediate re-signup, or specify days to wait"})]}),_.jsxs("div",{className:"mb-4",children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Policy Notes (Optional)"}),_.jsx("textarea",{className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"2",placeholder:"Additional policy notes...",value:Pr.notes,onChange:Ve=>tt(wt=>({...wt,notes:Ve.target.value}))})]}),_.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[_.jsx("button",{className:"px-4 py-2 rounded-lg bg-gray-500 text-white hover:bg-gray-600",onClick:()=>{or(!1),Ci(null),tt({category:"",banType:"allow",allowResignupAfterDays:0,notes:""})},children:"Cancel"}),_.jsx("button",{className:"px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",onClick:async()=>{or(!1),await me()},disabled:Br.softban,children:Br.softban?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processing..."]}):"Confirm Softban"})]})]})}),Ui&&_.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:_.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto",children:[_.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Reason for Suspension"}),_.jsx("p",{className:"text-gray-600 mb-3",children:"Please provide a reason for suspending this account. This will be included in the notification email."}),_.jsxs("div",{className:"mb-4",children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Suspension Reason"}),_.jsxs("select",{className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 mb-3",value:Wi,onChange:Ve=>_i(Ve.target.value),children:[_.jsx("option",{value:"",children:"Select a reason"}),(gt==null?void 0:gt.type)==="user"?_.jsxs(_.Fragment,{children:[_.jsx("option",{value:"inappropriate_content",children:"Inappropriate content or behavior"}),_.jsx("option",{value:"policy_violation",children:"Violation of terms & policies"}),_.jsx("option",{value:"spam_activity",children:"Spam or suspicious activity"}),_.jsx("option",{value:"fraudulent_activity",children:"Fraudulent activity"}),_.jsx("option",{value:"harassment",children:"Harassment or abuse"}),_.jsx("option",{value:"fake_account",children:"Fake or duplicate account"}),_.jsx("option",{value:"other",children:"Other (specify below)"})]}):_.jsxs(_.Fragment,{children:[_.jsx("option",{value:"misuse_privileges",children:"Misuse of admin privileges"}),_.jsx("option",{value:"policy_violation",children:"Violation of admin policies"}),_.jsx("option",{value:"inappropriate_behavior",children:"Inappropriate behavior"}),_.jsx("option",{value:"security_concern",children:"Security concern"}),_.jsx("option",{value:"inactive_admin",children:"Inactive admin account"}),_.jsx("option",{value:"other",children:"Other (specify below)"})]})]}),Wi==="other"&&_.jsx("input",{type:"text",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"Please specify the reason...",value:Ri,onChange:Ve=>Ai(Ve.target.value)})]}),_.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[_.jsx("button",{className:"px-4 py-2 rounded-lg bg-gray-500 text-white hover:bg-gray-600",onClick:()=>{ii(!1),Tt(null),_i(""),Ai("")},children:"Cancel"}),_.jsx("button",{className:"px-4 py-2 rounded-lg bg-yellow-500 text-white hover:bg-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",onClick:J,disabled:!Wi||Wi==="other"&&!Ri.trim()||Br.suspend[gt==null?void 0:gt.id],children:Br.suspend[gt==null?void 0:gt.id]?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Suspending..."]}):"Suspend Account"})]})]})}),Si&&_.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:_.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto",children:[_.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Reason for Demotion"}),_.jsx("p",{className:"text-gray-600 mb-3",children:"Please provide a reason for demoting this admin to user. This will be included in the notification email."}),_.jsxs("div",{className:"mb-4",children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Demotion Reason"}),_.jsxs("select",{className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-3",value:Cr,onChange:Ve=>zr(Ve.target.value),children:[_.jsx("option",{value:"",children:"Select a reason"}),_.jsx("option",{value:"misuse_privileges",children:"Misuse of admin privileges"}),_.jsx("option",{value:"policy_violation",children:"Violation of admin policies"}),_.jsx("option",{value:"inappropriate_behavior",children:"Inappropriate behavior"}),_.jsx("option",{value:"security_concern",children:"Security concern"}),_.jsx("option",{value:"inactive_admin",children:"Inactive admin account"}),_.jsx("option",{value:"performance_issues",children:"Performance issues"}),_.jsx("option",{value:"organizational_changes",children:"Organizational changes"}),_.jsx("option",{value:"other",children:"Other (specify below)"})]}),Cr==="other"&&_.jsx("input",{type:"text",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Please specify the reason...",value:Er,onChange:Ve=>Gn(Ve.target.value)})]}),_.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[_.jsx("button",{className:"px-4 py-2 rounded-lg bg-gray-500 text-white hover:bg-gray-600",onClick:()=>{Sr(!1),Zs(null),zr(""),Gn("")},children:"Cancel"}),_.jsx("button",{className:"px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",onClick:Qe,disabled:!Cr||Cr==="other"&&!Er.trim()||Br.demote[ds==null?void 0:ds.id],children:Br.demote[ds==null?void 0:ds.id]?_.jsxs(_.Fragment,{children:[_.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Demoting..."]}):"Demote Admin"})]})]})}),_.jsx("style",{jsx:!0,children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from { opacity: 0; transform: translateY(20px) scale(0.95); }
          to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .animate-fadeIn { animation: fadeIn 0.4s ease-out; }
        .animate-slideUp { animation: slideUp 0.4s cubic-bezier(0.4,0,0.2,1); }
      `})]})}const g6={messageSent:"/sounds/message-sent.mp3",messageReceived:"/sounds/message-received.mp3",notification:"/sounds/notification.mp3",typing:"/sounds/typing.mp3"},SP=()=>{const h=new(window.AudioContext||window.webkitAudioContext),g=(b,S,I="sine")=>{const N=h.createOscillator(),V=h.createGain();N.connect(V),V.connect(h.destination),N.frequency.setValueAtTime(b,h.currentTime),N.type=I,V.gain.setValueAtTime(.3,h.currentTime),V.gain.exponentialRampToValueAtTime(.01,h.currentTime+S),N.start(h.currentTime),N.stop(h.currentTime+S)};return{messageSent:()=>g(800,.1,"sine"),messageReceived:()=>g(600,.15,"sine"),notification:()=>{g(800,.1,"sine"),setTimeout(()=>g(1e3,.1,"sine"),100)},typing:()=>g(400,.05,"square")}},EP=()=>{const h=ue.useRef({}),g=ue.useRef(null),b=ue.useRef(!1),S=ue.useRef(1);ue.useEffect(()=>(Object.keys(g6).forEach(s=>{const q=new Audio(g6[s]);q.preload="auto",q.volume=1,h.current[s]=q}),g.current=SP(),()=>{Object.values(h.current).forEach(s=>{s&&(s.pause(),s.src="")})}),[]);const I=s=>{if(!b.current)try{const q=h.current[s];q&&q.readyState>=2?(q.currentTime=0,q.play().catch(()=>{g.current&&g.current[s]&&g.current[s]()})):g.current&&g.current[s]&&g.current[s]()}catch(q){console.warn("Sound playback failed:",q),g.current&&g.current[s]&&g.current[s]()}};return{playMessageSent:()=>I("messageSent"),playMessageReceived:()=>I("messageReceived"),playNotification:()=>I("notification"),playTyping:()=>I("typing"),toggleMute:(s=!1)=>(b.current=!b.current,s||document.querySelectorAll("audio[data-audio-id]").forEach(q=>{q&&(q.muted=b.current)}),b.current),setVolume:(s,q=!1)=>{const Z=Math.max(0,Math.min(1,s));S.current=Z,Object.values(h.current).forEach(Q=>{Q&&(Q.volume=Z)}),q||document.querySelectorAll("audio[data-audio-id]").forEach(Q=>{Q&&(Q.volume=Z)})},isMuted:()=>b.current,getCurrentVolume:()=>S.current}},kk=({onToggleMute:h,isMuted:g,onVolumeChange:b,currentVolume:S=1})=>_.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white/10 backdrop-blur-sm rounded-lg",children:[_.jsx("button",{onClick:h,className:`p-2 rounded-full transition-colors ${g?"bg-red-500/20 text-red-300 hover:bg-red-500/30":"bg-white/20 text-white hover:bg-white/30"}`,title:g?"Unmute all sounds (notifications & audio messages)":"Mute all sounds (notifications & audio messages)",children:g?_.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:_.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z",clipRule:"evenodd"})}):_.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:_.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 8.929a1 1 0 010 1.414A1.5 1.5 0 0116 12a1 1 0 102 0 3.5 3.5 0 00-1.929-3.071z",clipRule:"evenodd"})})}),_.jsxs("div",{className:"flex flex-col items-center gap-1",children:[_.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S,onChange:I=>b(parseFloat(I.target.value)),className:"w-20 h-2 bg-white/20 rounded-lg appearance-none cursor-pointer slider accent-white",disabled:g,title:`Volume: ${Math.round(S*100)}% (affects notifications & audio messages)`}),_.jsxs("span",{className:"text-xs text-white/80 font-medium",children:[Math.round(S*100),"%"]})]})]});var Yy={exports:{}},AP=Yy.exports,_6;function CP(){return _6||(_6=1,function(h,g){(function(b,S){h.exports=S()})(AP,function(){var b,S,I;function N(s,q){if(!b)b=q;else if(!S)S=q;else{var Z="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+b+")(sharedChunk); ("+S+")(sharedChunk); self.onerror = null;",Q={};b(Q),I=q(Q),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(I.workerUrl=window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"})))}}N(["exports"],function(s){var q=1e-6,Z=typeof Float32Array<"u"?Float32Array:Array;function Q(r,e){var i=e[0],a=e[1],o=e[2],d=e[3],p=i*d-o*a;return p?(r[0]=d*(p=1/p),r[1]=-a*p,r[2]=-o*p,r[3]=i*p,r):null}function oe(){var r=new Z(9);return Z!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function de(r,e){var i=e[0],a=e[1],o=e[2],d=e[3],p=e[4],x=e[5],T=e[6],A=e[7],M=e[8];return r[0]=p*M-x*A,r[1]=o*A-a*M,r[2]=a*x-o*p,r[3]=x*T-d*M,r[4]=i*M-o*T,r[5]=o*d-i*x,r[6]=d*A-p*T,r[7]=a*T-i*A,r[8]=i*p-a*d,r}function ze(r,e,i){var a=e[0],o=e[1],d=e[2],p=e[3],x=e[4],T=e[5],A=e[6],M=e[7],z=e[8],D=i[0],k=i[1],B=i[2],W=i[3],Y=i[4],K=i[5],ne=i[6],se=i[7],he=i[8];return r[0]=D*a+k*p+B*A,r[1]=D*o+k*x+B*M,r[2]=D*d+k*T+B*z,r[3]=W*a+Y*p+K*A,r[4]=W*o+Y*x+K*M,r[5]=W*d+Y*T+K*z,r[6]=ne*a+se*p+he*A,r[7]=ne*o+se*x+he*M,r[8]=ne*d+se*T+he*z,r}function le(){var r=new Z(16);return Z!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Se(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function ee(r,e){var i=e[0],a=e[1],o=e[2],d=e[3],p=e[4],x=e[5],T=e[6],A=e[7],M=e[8],z=e[9],D=e[10],k=e[11],B=e[12],W=e[13],Y=e[14],K=e[15],ne=i*x-a*p,se=i*T-o*p,he=i*A-d*p,Re=a*T-o*x,Me=a*A-d*x,Ne=o*A-d*T,Fe=M*W-z*B,Ue=M*Y-D*B,ft=M*K-k*B,$e=z*Y-D*W,yt=z*K-k*W,It=D*K-k*Y,bt=ne*It-se*yt+he*$e+Re*ft-Me*Ue+Ne*Fe;return bt?(r[0]=(x*It-T*yt+A*$e)*(bt=1/bt),r[1]=(o*yt-a*It-d*$e)*bt,r[2]=(W*Ne-Y*Me+K*Re)*bt,r[3]=(D*Me-z*Ne-k*Re)*bt,r[4]=(T*ft-p*It-A*Ue)*bt,r[5]=(i*It-o*ft+d*Ue)*bt,r[6]=(Y*he-B*Ne-K*se)*bt,r[7]=(M*Ne-D*he+k*se)*bt,r[8]=(p*yt-x*ft+A*Fe)*bt,r[9]=(a*ft-i*yt-d*Fe)*bt,r[10]=(B*Me-W*he+K*ne)*bt,r[11]=(z*he-M*Me-k*ne)*bt,r[12]=(x*Ue-p*$e-T*Fe)*bt,r[13]=(i*$e-a*Ue+o*Fe)*bt,r[14]=(W*se-B*Re-Y*ne)*bt,r[15]=(M*Re-z*se+D*ne)*bt,r):null}function _e(r,e,i){var a=e[0],o=e[1],d=e[2],p=e[3],x=e[4],T=e[5],A=e[6],M=e[7],z=e[8],D=e[9],k=e[10],B=e[11],W=e[12],Y=e[13],K=e[14],ne=e[15],se=i[0],he=i[1],Re=i[2],Me=i[3];return r[0]=se*a+he*x+Re*z+Me*W,r[1]=se*o+he*T+Re*D+Me*Y,r[2]=se*d+he*A+Re*k+Me*K,r[3]=se*p+he*M+Re*B+Me*ne,r[4]=(se=i[4])*a+(he=i[5])*x+(Re=i[6])*z+(Me=i[7])*W,r[5]=se*o+he*T+Re*D+Me*Y,r[6]=se*d+he*A+Re*k+Me*K,r[7]=se*p+he*M+Re*B+Me*ne,r[8]=(se=i[8])*a+(he=i[9])*x+(Re=i[10])*z+(Me=i[11])*W,r[9]=se*o+he*T+Re*D+Me*Y,r[10]=se*d+he*A+Re*k+Me*K,r[11]=se*p+he*M+Re*B+Me*ne,r[12]=(se=i[12])*a+(he=i[13])*x+(Re=i[14])*z+(Me=i[15])*W,r[13]=se*o+he*T+Re*D+Me*Y,r[14]=se*d+he*A+Re*k+Me*K,r[15]=se*p+he*M+Re*B+Me*ne,r}function ye(r,e,i){var a,o,d,p,x,T,A,M,z,D,k,B,W=i[0],Y=i[1],K=i[2];return e===r?(r[12]=e[0]*W+e[4]*Y+e[8]*K+e[12],r[13]=e[1]*W+e[5]*Y+e[9]*K+e[13],r[14]=e[2]*W+e[6]*Y+e[10]*K+e[14],r[15]=e[3]*W+e[7]*Y+e[11]*K+e[15]):(o=e[1],d=e[2],p=e[3],x=e[4],T=e[5],A=e[6],M=e[7],z=e[8],D=e[9],k=e[10],B=e[11],r[0]=a=e[0],r[1]=o,r[2]=d,r[3]=p,r[4]=x,r[5]=T,r[6]=A,r[7]=M,r[8]=z,r[9]=D,r[10]=k,r[11]=B,r[12]=a*W+x*Y+z*K+e[12],r[13]=o*W+T*Y+D*K+e[13],r[14]=d*W+A*Y+k*K+e[14],r[15]=p*W+M*Y+B*K+e[15]),r}function xe(r,e,i){var a=i[0],o=i[1],d=i[2];return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r[3]=e[3]*a,r[4]=e[4]*o,r[5]=e[5]*o,r[6]=e[6]*o,r[7]=e[7]*o,r[8]=e[8]*d,r[9]=e[9]*d,r[10]=e[10]*d,r[11]=e[11]*d,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Le(r,e,i){var a=Math.sin(i),o=Math.cos(i),d=e[4],p=e[5],x=e[6],T=e[7],A=e[8],M=e[9],z=e[10],D=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=d*o+A*a,r[5]=p*o+M*a,r[6]=x*o+z*a,r[7]=T*o+D*a,r[8]=A*o-d*a,r[9]=M*o-p*a,r[10]=z*o-x*a,r[11]=D*o-T*a,r}function Ae(r,e,i){var a=Math.sin(i),o=Math.cos(i),d=e[0],p=e[1],x=e[2],T=e[3],A=e[8],M=e[9],z=e[10],D=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=d*o-A*a,r[1]=p*o-M*a,r[2]=x*o-z*a,r[3]=T*o-D*a,r[8]=d*a+A*o,r[9]=p*a+M*o,r[10]=x*a+z*o,r[11]=T*a+D*o,r}function Ke(r,e,i){var a=Math.sin(i),o=Math.cos(i),d=e[0],p=e[1],x=e[2],T=e[3],A=e[4],M=e[5],z=e[6],D=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=d*o+A*a,r[1]=p*o+M*a,r[2]=x*o+z*a,r[3]=T*o+D*a,r[4]=A*o-d*a,r[5]=M*o-p*a,r[6]=z*o-x*a,r[7]=D*o-T*a,r}function it(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function rt(r,e,i){var a,o,d,p=i[0],x=i[1],T=i[2],A=Math.sqrt(p*p+x*x+T*T);return A<q?null:(p*=A=1/A,x*=A,T*=A,a=Math.sin(e),o=Math.cos(e),r[0]=p*p*(d=1-o)+o,r[1]=x*p*d+T*a,r[2]=T*p*d-x*a,r[3]=0,r[4]=p*x*d-T*a,r[5]=x*x*d+o,r[6]=T*x*d+p*a,r[7]=0,r[8]=p*T*d+x*a,r[9]=x*T*d-p*a,r[10]=T*T*d+o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function lt(r,e){var i=e[0],a=e[1],o=e[2],d=e[3],p=i+i,x=a+a,T=o+o,A=i*p,M=a*p,z=a*x,D=o*p,k=o*x,B=o*T,W=d*p,Y=d*x,K=d*T;return r[0]=1-z-B,r[1]=M+K,r[2]=D-Y,r[3]=0,r[4]=M-K,r[5]=1-A-B,r[6]=k+W,r[7]=0,r[8]=D+Y,r[9]=k-W,r[10]=1-A-z,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}var zt=_e;function xt(){var r=new Z(3);return Z!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Ci(r){var e=new Z(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function Zi(r){var e=r[0],i=r[1],a=r[2];return Math.sqrt(e*e+i*i+a*a)}function or(r,e,i){var a=new Z(3);return a[0]=r,a[1]=e,a[2]=i,a}function er(r,e,i,a){return r[0]=e,r[1]=i,r[2]=a,r}function Jt(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r}function ji(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r}function Fi(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r}function Pr(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r}function tt(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r}function Ht(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r}function Pi(r,e,i,a){return r[0]=e[0]+i[0]*a,r[1]=e[1]+i[1]*a,r[2]=e[2]+i[2]*a,r}function Ui(r,e){var i=e[0]-r[0],a=e[1]-r[1],o=e[2]-r[2];return i*i+a*a+o*o}function ii(r){var e=r[0],i=r[1],a=r[2];return e*e+i*i+a*a}function Wi(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function _i(r,e){var i=e[0],a=e[1],o=e[2],d=i*i+a*a+o*o;return d>0&&(d=1/Math.sqrt(d)),r[0]=e[0]*d,r[1]=e[1]*d,r[2]=e[2]*d,r}function Ri(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Ai(r,e,i){var a=e[0],o=e[1],d=e[2],p=i[0],x=i[1],T=i[2];return r[0]=o*T-d*x,r[1]=d*p-a*T,r[2]=a*x-o*p,r}function gt(r,e,i,a){var o=e[0],d=e[1],p=e[2];return r[0]=o+a*(i[0]-o),r[1]=d+a*(i[1]-d),r[2]=p+a*(i[2]-p),r}function Tt(r,e,i){var a=e[0],o=e[1],d=e[2],p=i[3]*a+i[7]*o+i[11]*d+i[15];return r[0]=(i[0]*a+i[4]*o+i[8]*d+i[12])/(p=p||1),r[1]=(i[1]*a+i[5]*o+i[9]*d+i[13])/p,r[2]=(i[2]*a+i[6]*o+i[10]*d+i[14])/p,r}function Si(r,e,i){var a=e[0],o=e[1],d=e[2];return r[0]=a*i[0]+o*i[3]+d*i[6],r[1]=a*i[1]+o*i[4]+d*i[7],r[2]=a*i[2]+o*i[5]+d*i[8],r}function Sr(r,e,i){var a=i[0],o=i[1],d=i[2],p=i[3],x=e[0],T=e[1],A=e[2],M=o*A-d*T,z=d*x-a*A,D=a*T-o*x;return r[0]=x+p*(M+=M)+o*(D+=D)-d*(z+=z),r[1]=T+p*z+d*M-a*D,r[2]=A+p*D+a*z-o*M,r}function Cr(r){return r[0]=0,r[1]=0,r[2]=0,r}function zr(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}var Er=ji,Gn=Fi,ds=Zi;function Zs(){var r=new Z(4);return Z!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Br(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r}function Jn(r,e){var i=e[0],a=e[1],o=e[2],d=e[3],p=i*i+a*a+o*o+d*d;return p>0&&(p=1/Math.sqrt(p)),r[0]=i*p,r[1]=a*p,r[2]=o*p,r[3]=d*p,r}function Rs(r,e,i){var a=e[0],o=e[1],d=e[2],p=e[3];return r[0]=i[0]*a+i[4]*o+i[8]*d+i[12]*p,r[1]=i[1]*a+i[5]*o+i[9]*d+i[13]*p,r[2]=i[2]*a+i[6]*o+i[10]*d+i[14]*p,r[3]=i[3]*a+i[7]*o+i[11]*d+i[15]*p,r}function za(){var r=new Z(4);return Z!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function La(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function fs(r,e,i){i*=.5;var a=e[0],o=e[1],d=e[2],p=e[3],x=Math.sin(i),T=Math.cos(i);return r[0]=a*T+p*x,r[1]=o*T+d*x,r[2]=d*T-o*x,r[3]=p*T-a*x,r}function ps(r,e,i){i*=.5;var a=e[0],o=e[1],d=e[2],p=e[3],x=Math.sin(i),T=Math.cos(i);return r[0]=a*T-d*x,r[1]=o*T+p*x,r[2]=d*T+a*x,r[3]=p*T-o*x,r}xt(),Zs();var $n,Xn,Ds,Ps=Jn,Vs=($n=xt(),Xn=or(1,0,0),Ds=or(0,1,0),function(r,e,i){var a=Ri(e,i);return a<-.999999?(Ai($n,Xn,e),ds($n)<1e-6&&Ai($n,Ds,e),_i($n,$n),function(o,d,p){p*=.5;var x=Math.sin(p);o[0]=x*d[0],o[1]=x*d[1],o[2]=x*d[2],o[3]=Math.cos(p)}(r,$n,Math.PI),r):a>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Ai($n,e,i),r[0]=$n[0],r[1]=$n[1],r[2]=$n[2],r[3]=1+a,Ps(r,r))});function Pn(){var r=new Z(2);return Z!=Float32Array&&(r[0]=0,r[1]=0),r}function oa(r,e){var i=new Z(2);return i[0]=r,i[1]=e,i}function Da(r,e,i){return r[0]=e,r[1]=i,r}function as(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r}function va(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r}function Ms(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r}function os(r){var e=r[0],i=r[1];return Math.sqrt(e*e+i*i)}function hn(r,e){var i=e[0],a=e[1],o=i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),r[0]=e[0]*o,r[1]=e[1]*o,r}function Dt(r,e){return r[0]*e[0]+r[1]*e[1]}za(),za(),oe();var Ti,Ar,br=va;function Rr(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}Pn();var xn=function(){if(Ar)return Ti;function r(e,i,a,o){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(o-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=a,this.p2y=o}return Ar=1,Ti=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,o=0;o<8;o++){var d=this.sampleCurveX(a)-e;if(Math.abs(d)<i)return a;var p=this.sampleCurveDerivativeX(a);if(Math.abs(p)<1e-6)break;a-=d/p}var x=0,T=1;for(a=e,o=0;o<20&&(d=this.sampleCurveX(a),!(Math.abs(d-e)<i));o++)e>d?x=a:T=a,a=.5*(T-x)+x;return a},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Ti}(),xs=Rr(xn);function Ct(r,e){this.x=r,this.y=e}function Hs(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!Hs(r[i],e[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const i in r)if(!Hs(r[i],e[i]))return!1;return!0}return r===e}Ct.prototype={clone(){return new Ct(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,e){return this.clone()._rotateAround(r,e)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const e=r.x-this.x,i=r.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult(r){const e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const e=Math.cos(r),i=Math.sin(r),a=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=a,this},_rotateAround(r,e){const i=Math.cos(r),a=Math.sin(r),o=e.y+a*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-a*(this.y-e.y),this.y=o,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Ct},Ct.convert=function(r){if(r instanceof Ct)return r;if(Array.isArray(r))return new Ct(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new Ct(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};const Pa=Math.PI/180,ba=180/Math.PI;function He(r){return r*Pa}function J(r){return r*ba}const ie=[[0,0],[1,0],[1,1],[0,1]];function me(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function je(r,e,i,a){const o=new xs(r,e,i,a);return function(d){return o.solve(d)}}const Pe=je(.25,.1,.25,1);function Ie(r,e,i){return Math.min(i,Math.max(e,r))}function Qe(r,e,i){return(i=Ie((i-r)/(e-r),0,1))*i*(3-2*i)}function Be(r,e,i){const a=i-e,o=((r-e)%a+a)%a+e;return o===e?i:o}function Je(r,e,i){if(!r.length)return i(null,[]);let a=r.length;const o=new Array(r.length);let d=null;r.forEach((p,x)=>{e(p,(T,A)=>{T&&(d=T),o[x]=A,--a==0&&i(d,o)})})}let Lt=1;function vt(){return Lt++}function pi(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log2(r)))}function Mi(r,e){r.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Vi(r,e,i){const a={};for(const o in r)a[o]=e.call(this,r[o],o,r);return a}function lr(r,e,i){const a={};for(const o in r)e.call(this,r[o],o,r)&&(a[o]=r[o]);return a}function nr(r){return Array.isArray(r)?r.map(nr):typeof r=="object"&&r?Vi(r,nr):r}function cr(r,e){for(let i=0;i<r.length;i++)if(e.indexOf(r[i])>=0)return!0;return!1}const Hr={};function ur(r){Hr[r]||(typeof console<"u"&&console.warn(r),Hr[r]=!0)}function mn(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function Yr(r){let e=0;for(let i,a,o=0,d=r.length,p=d-1;o<d;p=o++)i=r[o],a=r[p],e+=(a.x-i.x)*(i.y+a.y);return e}function Ve([r,e,i]){const a=He(e+90),o=He(i);return{x:r*Math.cos(a)*Math.sin(o),y:r*Math.sin(a)*Math.sin(o),z:r*Math.cos(o),azimuthal:e,polar:i}}function wt(r){return(typeof self<"u"||r!==void 0)&&typeof WorkerGlobalScope<"u"&&(r!==void 0?r:self)instanceof WorkerGlobalScope}function Ft(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,o,d)=>{const p=o||d;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Qt=null;function wi(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function $i(r,e,i,a){for(;e<i;){const o=e+i>>1;r[o]<a?e=o+1:i=o}return e}function Sn(r,e,i,a){for(;e<i;){const o=e+i>>1;r[o]<=a?e=o+1:i=o}return e}function tn(r){return r>0?1/(1.001-r):1+r}function dn(r){return r>0?1-1/(1.001-r):-r}function In(r,e,i){return(r-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Yn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Yn.API_URL)return null;try{const r=new URL(Yn.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ga(r){return Yn.API_URL_REGEX.test(r)}function ro(r){return Yn.API_SPRITE_REGEX.test(r)}let Ol,oh,wc,lh,Bo,ad;function $a(){return Ol==null&&(Ol=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ol}const xo={now:()=>lh!==void 0?lh:performance.now(),setNow(r){lh=r},restoreNow(){lh=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:i,height:a}=r;Bo||(Bo=document.createElement("canvas"));const o=Bo.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return(i>Bo.width||a>Bo.height)&&(Bo.width=i,Bo.height=a),o.clearRect(-e,-e,i+2*e,a+2*e),o.drawImage(r,0,0,i,a),o.getImageData(-e,-e,i+2*e,a+2*e)},resolveURL:r=>(oh||(oh=document.createElement("a")),oh.href=r,oh.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(wc==null&&(wc=window.matchMedia("(prefers-reduced-motion: reduce)")),wc.matches)},hasCanvasFingerprintNoise(){if(ad!==void 0)return ad;if(!$a())return ad=!1,!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let i=0;for(let o=0;o<r.width;++o)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(o,0,1,1);const a=e.getImageData(0,0,r.width,r.height);i=0;for(let o=0;o<a.data.length;++o)if(o%4!=3&&i++!==a.data[o])return ad=!0,!0;return ad=!1,!1}};function hf(r,e){const i=r.indexOf("?");if(i<0)return`${r}?${new URLSearchParams(e).toString()}`;const a=new URLSearchParams(r.slice(i));for(const o in e)a.set(o,e[o]);return`${r.slice(0,i)}?${a.toString()}`}function ch(r,e={persistentParams:[]}){const i=r.indexOf("?");if(i<0)return r;const a=new URLSearchParams,o=new URLSearchParams(r.slice(i));for(const p of e.persistentParams){const x=o.get(p);x&&a.set(p,x)}const d=a.toString();return`${r.slice(0,i)}${d.length>0?`?${d}`:""}`}const Ws="mapbox-tiles";let vo=500,cl=50;const wa=["language","worldview","jobid"];let Ta,Tc;function df(){try{return caches}catch{}}function lu(){const r=df();r&&Ta==null&&(Ta=r.open(Ws))}let Sc=1/0;const od={supported:!1,testSupport:function(r){!Oa&&Ac&&(Cc?cu(r):Ec=r)}};let Ec,Ac,Oa=!1,Cc=!1;const jl=typeof self<"u"?self:{};function cu(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Ac),r.isContextLost())return;od.supported=!0}catch{}r.deleteTexture(e),Oa=!0}jl.document&&(Ac=jl.document.createElement("img"),Ac.onload=function(){Ec&&cu(Ec),Ec=null,Cc=!0},Ac.onerror=function(){Oa=!0,Ec=null},Ac.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const uh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(uh);class ff extends Error{constructor(e,i,a){i===401&&Ga(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Rc=wt()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Mr=function(r,e){if(!(/^file:/.test(i=r.url)||/^file:/.test(Rc())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,o){const d=new AbortController,p=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Rc(),referrerPolicy:a.referrerPolicy,signal:d.signal});let x=!1,T=!1;const A=(M=p.url).indexOf("sku=")>0&&Ga(M);var M;a.type==="json"&&p.headers.set("Accept","application/json");const z=(k,B,W)=>{if(T)return;if(k&&k.message!=="SecurityError"&&ur(k.toString()),B&&W)return D(B);const Y=Date.now();fetch(p).then(K=>{if(K.ok){const ne=A?K.clone():null;return D(K,ne,Y)}return o(new ff(K.statusText,K.status,a.url))}).catch(K=>{K.name!=="AbortError"&&o(new Error(`${K.message} ${a.url}`))})},D=(k,B,W)=>{(a.type==="arrayBuffer"?k.arrayBuffer():a.type==="json"?k.json():k.text()).then(Y=>{T||(B&&W&&function(K,ne,se){if(lu(),Ta==null)return;const he=Ft(ne.headers.get("Cache-Control")||"");if(he["no-store"])return;const Re={status:ne.status,statusText:ne.statusText,headers:new Headers};ne.headers.forEach((Fe,Ue)=>Re.headers.set(Ue,Fe)),he["max-age"]&&Re.headers.set("Expires",new Date(se+1e3*he["max-age"]).toUTCString());const Me=Re.headers.get("Expires");if(!Me||new Date(Me).getTime()-se<42e4)return;let Ne=ch(K.url,{persistentParams:wa});if(ne.status===206){const Fe=K.headers.get("Range");if(!Fe)return;Re.status=200,Ne=hf(Ne,{range:Fe})}(function(Fe,Ue){if(Tc===void 0)try{new Response(new ReadableStream),Tc=!0}catch{Tc=!1}Tc?Ue(Fe.body):Fe.blob().then(Ue).catch(ft=>ur(ft.message))})(ne,Fe=>{const Ue=new Response((ft=ne.status)!==200&&ft!==404&&[101,103,204,205,304].includes(ft)?null:Fe,Re);var ft;lu(),Ta!=null&&Ta.then($e=>$e.put(Ne,Ue)).catch($e=>ur($e.message))})}(p,B,W),x=!0,o(null,Y,k.headers.get("Cache-Control"),k.headers.get("Expires")))}).catch(Y=>{T||o(new Error(Y.message))})};return A?function(k,B){if(lu(),Ta==null)return B(null);Ta.then(W=>{let Y=ch(k.url,{persistentParams:wa});const K=k.headers.get("Range");K&&(Y=hf(Y,{range:K})),W.match(Y).then(ne=>{const se=function(he){if(!he)return!1;const Re=new Date(he.headers.get("Expires")||0),Me=Ft(he.headers.get("Cache-Control")||"");return Number(Re)>Date.now()&&!Me["no-cache"]}(ne);W.delete(Y).catch(B),se&&W.put(Y,ne.clone()).catch(B),B(null,ne,se)}).catch(B)}).catch(B)}(p,z):z(null,null),{cancel:()=>{T=!0,x||d.abort()}}}(r,e);if(wt(self)&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return function(a,o){const d=new XMLHttpRequest;d.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const p in a.headers)d.setRequestHeader(p,a.headers[p]);return a.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=a.credentials==="include",d.onerror=()=>{o(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let p=d.response;if(a.type==="json")try{p=JSON.parse(d.response)}catch(x){return o(x)}o(null,p,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else o(new ff(d.statusText,d.status,a.url))},d.send(a.body),{cancel:()=>d.abort()}}(r,e)},ul=function(r,e){return Mr(Object.assign(r,{type:"arrayBuffer"}),e)};function Nl(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const pf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let uu,kl;uu=[],kl=0;const Bl=function(r,e){if(od.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),kl>=Yn.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return uu.push(d),d}kl++;let i=!1;const a=()=>{if(!i)for(i=!0,kl--;uu.length&&kl<Yn.MAX_PARALLEL_IMAGE_REQUESTS;){const d=uu.shift(),{requestParameters:p,callback:x,cancelled:T}=d;T||(d.cancel=Bl(p,x).cancel)}},o=ul(r,(d,p,x,T)=>{a(),d?e(d):p&&(self.createImageBitmap?function(A,M){const z=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(z).then(D=>{M(null,D)}).catch(D=>{M(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(A,M)=>e(A,M,x,T)):function(A,M){const z=new Image;z.onload=()=>{M(null,z),URL.revokeObjectURL(z.src),z.onload=null,requestAnimationFrame(()=>{z.src=pf})},z.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new Blob([new Uint8Array(A)],{type:"image/png"});z.src=A.byteLength?URL.createObjectURL(D):pf}(p,(A,M)=>e(A,M,x,T)))});return{cancel:()=>{o.cancel(),a()}}};var Mc,ld,ja,no={exports:{}},cd={exports:{}},hu={exports:{}},hh=function(){if(ja)return no.exports;ja=1;var r=(Mc||(Mc=1,cd.exports=function(i,a){var o,d,p,x,T,A,M,z;for(d=i.length-(o=3&i.length),p=a,T=3432918353,A=461845907,z=0;z<d;)M=255&i.charCodeAt(z)|(255&i.charCodeAt(++z))<<8|(255&i.charCodeAt(++z))<<16|(255&i.charCodeAt(++z))<<24,++z,p=27492+(65535&(x=5*(65535&(p=(p^=M=(65535&(M=(M=(65535&M)*T+(((M>>>16)*T&65535)<<16)&4294967295)<<15|M>>>17))*A+(((M>>>16)*A&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(M=0,o){case 3:M^=(255&i.charCodeAt(z+2))<<16;case 2:M^=(255&i.charCodeAt(z+1))<<8;case 1:p^=M=(65535&(M=(M=(65535&(M^=255&i.charCodeAt(z)))*T+(((M>>>16)*T&65535)<<16)&4294967295)<<15|M>>>17))*A+(((M>>>16)*A&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),cd.exports),e=(ld||(ld=1,hu.exports=function(i,a){for(var o,d=i.length,p=a^d,x=0;d>=4;)o=1540483477*(65535&(o=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24))+((1540483477*(o>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),d-=4,++x;switch(d){case 3:p^=(255&i.charCodeAt(x+2))<<16;case 2:p^=(255&i.charCodeAt(x+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(x)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),hu.exports);return no.exports=r,no.exports.murmur3=r,no.exports.murmur2=e,no.exports}(),dh=Rr(hh);class so{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class Fl extends so{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function du(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function Za(r,e,i){if(i&&i[r]){const a=i[r].indexOf(e);a!==-1&&i[r].splice(a,1)}}class fu{on(e,i){return this._listeners=this._listeners||{},du(e,i,this._listeners),this}off(e,i){return Za(e,i,this._listeners),Za(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},du(e,i,this._oneTimeListeners),this):new Promise(a=>{this.once(e,a)})}fire(e,i){const a=typeof e=="string"?new so(e,i):e,o=a.type;if(this.listens(o)){a.target=this;const d=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const T of d)T.call(this,a);const p=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const T of p)Za(o,T,this._oneTimeListeners),T.call(this,a);const x=this._eventedParent;if(x){const T=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(a,T),x.fire(a)}}else a instanceof Fl&&console.error(a.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class ao{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new ao(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,a]=e.split("");return new ao({name:i,iconsetId:a})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return ao.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Tp,fh={},Sp=function(){if(Tp)return fh;Tp=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(d){return(d=Math.round(d))<0?0:d>255?255:d}function i(d){return e(d[d.length-1]==="%"?parseFloat(d)/100*255:parseInt(d))}function a(d){return(p=d[d.length-1]==="%"?parseFloat(d)/100:parseFloat(d))<0?0:p>1?1:p;var p}function o(d,p,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?d+(p-d)*x*6:2*x<1?p:3*x<2?d+(p-d)*(2/3-x)*6:d}try{fh.parseCSSColor=function(d){var p,x=d.replace(/ /g,"").toLowerCase();if(x in r)return r[x].slice();if(x[0]==="#")return x.length===4?(p=parseInt(x.substr(1),16))>=0&&p<=4095?[(3840&p)>>4|(3840&p)>>8,240&p|(240&p)>>4,15&p|(15&p)<<4,1]:null:x.length===7&&(p=parseInt(x.substr(1),16))>=0&&p<=16777215?[(16711680&p)>>16,(65280&p)>>8,255&p,1]:null;var T=x.indexOf("("),A=x.indexOf(")");if(T!==-1&&A+1===x.length){var M=x.substr(0,T),z=x.substr(T+1,A-(T+1)).split(","),D=1;switch(M){case"rgba":if(z.length!==4)return null;D=a(z.pop());case"rgb":return z.length!==3?null:[i(z[0]),i(z[1]),i(z[2]),D];case"hsla":if(z.length!==4)return null;D=a(z.pop());case"hsl":if(z.length!==3)return null;var k=(parseFloat(z[0])%360+360)%360/360,B=a(z[1]),W=a(z[2]),Y=W<=.5?W*(B+1):W+B-W*B,K=2*W-Y;return[e(255*o(K,Y,k+1/3)),e(255*o(K,Y,k)),e(255*o(K,Y,k-1/3)),D];default:return null}}return null}}catch{}return fh}();class $r{constructor(e,i,a,o=1){this.r=e,this.g=i,this.b=a,this.a=o}static parse(e){if(!e)return;if(e instanceof $r)return e;if(typeof e!="string")return;const i=Sp.parseCSSColor(e);return i?new $r(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,a,o]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*a)},${o})`}toNonPremultipliedRenderColor(e){const{r:i,g:a,b:o,a:d}=this;return new jm(e,i,a,o,d)}toPremultipliedRenderColor(e){const{r:i,g:a,b:o,a:d}=this;return new mf(e,i*d,a*d,o*d,d)}clone(){return new $r(this.r,this.g,this.b,this.a)}}class Ep{constructor(e,i,a,o,d,p=!1){if(this.premultiplied=!1,this.premultiplied=p,e){const x=e.image.height,T=x*x;this.premultiplied?(i=d===0?0:i/d*(x-1),a=d===0?0:a/d*(x-1),o=d===0?0:o/d*(x-1)):(i*=x-1,a*=x-1,o*=x-1);const A=Math.floor(i),M=Math.floor(a),z=Math.floor(o),D=Math.ceil(i),k=Math.ceil(a),B=Math.ceil(o),W=i-A,Y=a-M,K=o-z,ne=e.image.data,se=4*(A+M*T+z*x),he=4*(A+M*T+B*x),Re=4*(A+k*T+z*x),Me=4*(A+k*T+B*x),Ne=4*(D+M*T+z*x),Fe=4*(D+M*T+B*x),Ue=4*(D+k*T+z*x),ft=4*(D+k*T+B*x);if(se<0||ft>=ne.length)throw new Error("out of range");this.r=Li(Li(Li(ne[se],ne[he],K),Li(ne[Re],ne[Me],K),Y),Li(Li(ne[Ne],ne[Fe],K),Li(ne[Ue],ne[ft],K),Y),W)/255*(this.premultiplied?d:1),this.g=Li(Li(Li(ne[se+1],ne[he+1],K),Li(ne[Re+1],ne[Me+1],K),Y),Li(Li(ne[Ne+1],ne[Fe+1],K),Li(ne[Ue+1],ne[ft+1],K),Y),W)/255*(this.premultiplied?d:1),this.b=Li(Li(Li(ne[se+2],ne[he+2],K),Li(ne[Re+2],ne[Me+2],K),Y),Li(Li(ne[Ne+2],ne[Fe+2],K),Li(ne[Ue+2],ne[ft+2],K),Y),W)/255*(this.premultiplied?d:1),this.a=d}else this.r=i,this.g=a,this.b=o,this.a=d}toArray(){const{r:e,g:i,b:a,a:o}=this;return[255*e,255*i,255*a,o]}toHslaArray(){let{r:e,g:i,b:a,a:o}=this;if(this.premultiplied){if(o===0)return[0,0,0,0];const B=1/o;e*=B,i*=B,a*=B}const d=Math.min(Math.max(e,0),1),p=Math.min(Math.max(i,0),1),x=Math.min(Math.max(a,0),1),T=Math.min(d,p,x),A=Math.max(d,p,x),M=A-T,z=.5*(T+A);if(M===0)return[0,0,100*z,o];const D=z>.5?M/(2-A-T):M/(A+T);let k;switch(A){case d:k=60*((p-x)/M+(p<x?6:0));break;case p:k=60*((x-d)/M+2);break;default:k=60*((d-p)/M+4)}return[k,100*D,100*z,o]}toArray01(){const{r:e,g:i,b:a,a:o}=this;return[e,i,a,o]}toArray01Scaled(e){const{r:i,g:a,b:o}=this;return[i*e,a*e,o*e]}toArray01Linear(){const{r:e,g:i,b:a,a:o}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(a,2.2),o]}}class jm extends Ep{constructor(e,i,a,o,d){super(e,i,a,o,d,!1)}}class mf extends Ep{constructor(e,i,a,o,d){super(e,i,a,o,d,!0)}}function Li(r,e,i){return r*(1-i)+e*i}function Ap(r,e,i){return r.map((a,o)=>Li(a,e[o],i))}$r.black=new $r(0,0,0,1),$r.white=new $r(1,1,1,1),$r.transparent=new $r(0,0,0,0),$r.red=new $r(1,0,0,1),$r.blue=new $r(0,0,1,1);var oo=Object.freeze({__proto__:null,array:Ap,color:function(r,e,i){return new $r(Li(r.r,e.r,i),Li(r.g,e.g,i),Li(r.b,e.b,i),Li(r.a,e.a,i))},number:Li});class Fo extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class gf{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[a,o]of i)this.bindings[a]=o}concat(e){return new gf(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const bo={kind:"null"},yi={kind:"number"},Zr={kind:"string"},Kr={kind:"boolean"},Na={kind:"color"},pu={kind:"object"},qr={kind:"value"},_f={kind:"collator"},Ic={kind:"formatted"},ud={kind:"resolvedImage"};function la(r,e){return{kind:"array",itemType:r,N:e}}function ls(r){if(r.kind==="array"){const e=ls(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Xg=[bo,yi,Zr,Kr,Na,Ic,pu,la(qr),ud];function hd(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!hd(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of Xg)if(!hd(i,e))return null}}return`Expected ${ls(r)} but found ${ls(e)} instead.`}function dd(r,e){return e.some(i=>i.kind===r.kind)}function Ul(r,e){return e.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}function fd(r,e){return r.kind==="array"&&e.kind==="array"?r.N===e.N&&fd(r.itemType,e.itemType):r.kind===e.kind}class Vl{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class pd{constructor(e,i,a,o,d){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=a,this.fontStack=o,this.textColor=d}}class ca{constructor(e){this.sections=e}static fromString(e){return new ca([new pd(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof ca?e:ca.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const o=i.image.getPrimary().id.toString();e.push(["image",o]);continue}e.push(i.text);const a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(a)}return e}}class wo{constructor(e,i={}){if(this.id=ao.from(e),this.options=Object.assign({},i),i.transform){const{a,b:o,c:d,d:p,e:x,f:T}=i.transform;this.options.transform=new DOMMatrix([a,o,d,p,x,T])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:a,d:o,e:d,f:p}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:a,d:o,e:d,f:p}})}static parse(e){let i,a,o,d;try{({name:i,iconsetId:a,params:o,transform:d}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:p,b:x,c:T,d:A,e:M,f:z}=d||{};return new wo({name:i,iconsetId:a},{params:o,transform:new DOMMatrix([p,x,T,A,M,z])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class Sa{constructor(e,i,a,o,d=!1){this.primaryId=ao.from(e),this.primaryOptions=i,a&&(this.secondaryId=ao.from(a)),this.secondaryOptions=o,this.available=d}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new wo(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new wo(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Sa.build({name:e}):e}static build(e,i,a,o){return!e||typeof e=="object"&&!("name"in e)?null:new Sa(e,a,i,o)}}function mu(r,e,i,a){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,e,i,a]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ph(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof $r||r instanceof Vl||r instanceof ca||r instanceof Sa)return!0;if(Array.isArray(r)){for(const e of r)if(!ph(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!ph(r[e]))return!1;return!0}return!1}function vs(r){if(r===null)return bo;if(typeof r=="string")return Zr;if(typeof r=="boolean")return Kr;if(typeof r=="number")return yi;if(r instanceof $r)return Na;if(r instanceof Vl)return _f;if(r instanceof ca)return Ic;if(r instanceof Sa)return ud;if(Array.isArray(r)){const e=r.length;let i;for(const a of r){const o=vs(a);if(i){if(i===o)continue;i=qr;break}i=o}return la(i||qr,e)}return pu}function ka(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof ca||r instanceof Sa||r instanceof $r?r.toString():JSON.stringify(r)}class ir{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ph(e[1]))return i.error("invalid value");const a=e[1];let o=vs(a);const d=i.expectedType;return o.kind!=="array"||o.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(o=d),new ir(o,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof $r?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ca?this.value.serialize():this.value}}class ni{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Hl={string:Zr,number:yi,boolean:Kr,object:pu};class Ii{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,o=1;const d=e[0];if(d==="array"){let x,T;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in Hl)||A==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=Hl[A],o++}else x=qr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);T=e[2],o++}a=la(x,T)}else a=Hl[d];const p=[];for(;o<e.length;o++){const x=i.parse(e[o],o,qr);if(!x)return null;p.push(x)}return new Ii(a,p)}evaluate(e){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(e);if(!hd(this.type,vs(a)))return a;if(i===this.args.length-1)throw new ni(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${ls(vs(a))} but was expected to be of type ${ls(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){i.push(a.kind);const o=e.N;(typeof o=="number"||this.args.length>1)&&i.push(o)}}return i.concat(this.args.map(a=>a.serialize()))}}class gu{constructor(e){this.type=Ic,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const o=[];let d=!1;for(let p=1;p<=e.length-1;++p){const x=e[p];if(d&&typeof x=="object"&&!Array.isArray(x)){d=!1;let T=null;if(x["font-scale"]&&(T=i.parseObjectValue(x["font-scale"],p,"font-scale",yi),!T))return null;let A=null;if(x["text-font"]&&(A=i.parseObjectValue(x["text-font"],p,"text-font",la(Zr)),!A))return null;let M=null;if(x["text-color"]&&(M=i.parseObjectValue(x["text-color"],p,"text-color",Na),!M))return null;const z=o[o.length-1];z.scale=T,z.font=A,z.textColor=M}else{const T=i.parse(e[p],p,qr);if(!T)return null;const A=T.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,o.push({content:T,scale:null,font:null,textColor:null})}}return new gu(o)}evaluate(e){return new ca(this.sections.map(i=>{const a=i.content.evaluate(e);return fd(vs(a),ud)?new pd("",a,null,null,null):new pd(ka(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),e.push(a)}return e}}class ql{constructor(e,i,a,o){this._imageWarnHistory={},this.type=ud,this.namePrimary=e,this.nameSecondary=i,a&&(this.paramsPrimary=a.params,this.iconsetIdPrimary=a.iconset?a.iconset.id:void 0),o&&(this.paramsSecondary=o.params,this.iconsetIdSecondary=o.iconset?o.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let a=1;const o=[];function d(){if(a<e.length){const x=i.parse(e[a],a++,Zr);return x?(o.push({image:x,options:{}}),!0):(i.error(o.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function p(){if(a<e.length){const T=e[a];if((x=T)===null||typeof x!="object"||Array.isArray(x))return!0;const A=T.params,M=T.iconset,z=i.concat(a);if(!A&&!M)return a++,!0;if(A){if(typeof A!="object"||A.constructor!==Object)return z.error('Image options "params" should be an object'),!1;const D={},k=z.concat(void 0,"params");for(const B in A){if(!B)return k.error("Image parameter name should be non-empty"),!1;const W=k.concat(void 0,B).parse(A[B],void 0,Na,void 0,{typeAnnotation:"coerce"});if(!W)return!1;D[B]=W}o[o.length-1].options.params=D}if(M){if(typeof M!="object"||M.constructor!==Object)return z.error('Image options "iconset" should be an object'),!1;if(!M.id)return z.error('Image options "iconset" should have an "id" property'),!1;o[o.length-1].options.iconset=M}return a++,!0}var x;return!0}for(let x=0;x<2;x++)if(!d()||!p())return;return new ql(o[0].image,o[1]?o[1].image:void 0,o[0].options,o[1]?o[1].options:void 0)}evaluateParams(e,i){const a={};if(i){for(const o in i)if(i[o])try{a[o]=i[o].evaluate(e)}catch{continue}if(Object.keys(a).length!==0)return{params:a}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},a=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,o=Sa.build(i,a,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(o&&e.availableImages){const d=o.getPrimary().id;if(o.available=e.availableImages.some(p=>ao.isEqual(p,d)),o.available){const p=o.getSecondary()?o.getSecondary().id:null;p&&(o.available=e.availableImages.some(x=>ao.isEqual(x,p)))}}return o}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const a={};if(i&&(a.iconset={id:i}),e){a.params={};for(const o in e)e[o]&&(a.params[o]=e[o].serialize())}return Object.keys(a).length>0?a:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function ki(r){return _u(r)?"string":yu(r)?"number":xf(r)?"boolean":Array.isArray(r)?"array":r===null?"null":yf(r)?"object":typeof r}function yf(r){return r!=null&&!Array.isArray(r)&&typeof r!="function"&&!(r instanceof String||r instanceof Number||r instanceof Boolean)&&typeof r=="object"}function _u(r){return typeof r=="string"||r instanceof String}function yu(r){return typeof r=="number"||r instanceof Number}function xf(r){return typeof r=="boolean"||r instanceof Boolean}const md={"to-boolean":Kr,"to-color":Na,"to-number":yi,"to-string":Zr};class Qn{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[0],o=[];let d=bo;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const p=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);d=la(i.expectedType.itemType,p)}else{if(!(p>0&&ph(e[1][0])))return null;d=la(vs(e[1][0]),p)}for(let x=0;x<p;x++){const T=e[1][x];let A;if(Array.isArray(T))A=i.parse(T,void 0,d.itemType);else{const M=ki(T);if(M!==d.itemType.kind)return i.error(`Expected ${d.itemType.kind} but found ${M}.`);A=i.registry.literal.parse(["literal",T===void 0?null:T],i)}if(!A)return null;o.push(A)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return i.error("Expected one argument.");d=md[a];for(let p=1;p<e.length;p++){const x=i.parse(e[p],p,qr);if(!x)return null;o.push(x)}}return new Qn(d,o)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,a;for(const o of this.args){if(i=o.evaluate(e),a=null,i instanceof $r)return i;if(typeof i=="string"){const d=e.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:mu(i[0],i[1],i[2],i[3]),!a))return new $r(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new ni(a||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const a of this.args){if(i=a.evaluate(e),i===null)return 0;const o=Number(i);if(!isNaN(o))return o}throw new ni(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ca.fromString(ka(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Sa.build(ka(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):ka(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new gu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ql(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Cp=["Unknown","Point","LineString","Polygon"];class Gl{constructor(e,i,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=a}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Cp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:a,y:o}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*i-e[0])+this.featureDistanceData.bearing[1]*(o*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=$r.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Ea{constructor(e,i,a,o,d){this.name=e,this.type=i,this._evaluate=a,this.args=o,this._overloadIndex=d}evaluate(e){if(!this._evaluate){const i=Ea.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const a=e[0],o=Ea.definitions[a];if(!o)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(o)?o[0]:o.type,p=Array.isArray(o)?[[o[1],o[2]]]:o.overloads,x=[];let T=null,A=-1;for(const[M,z]of p){if(Array.isArray(M)&&M.length!==e.length-1)continue;x.push(M),A++,T=new Nc(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const D=[];let k=!1;for(let B=1;B<e.length;B++){const W=e[B],Y=Array.isArray(M)?M[B-1]:M.type,K=T.parse(W,1+D.length,Y);if(!K){k=!0;break}D.push(K)}if(!k)if(Array.isArray(M)&&M.length!==D.length)T.error(`Expected ${M.length} arguments, but found ${D.length} instead.`);else{for(let B=0;B<D.length;B++){const W=Array.isArray(M)?M[B]:M.type,Y=D[B];T.concat(B+1).checkSubtype(W,Y.type)}if(T.errors.length===0)return new Ea(a,d,z,D,A)}}if(x.length===1)i.errors.push(...T.errors);else{const M=(x.length?x:p.map(([D])=>D)).map(zc).join(" | "),z=[];for(let D=1;D<e.length;D++){const k=i.parse(e[D],1+z.length);if(!k)return null;z.push(ls(k.type))}i.error(`Expected arguments of type ${M}, but found (${z.join(", ")}) instead.`)}return null}static register(e,i){Ea.definitions=i;for(const a in i)e[a]=Ea}}function zc(r){return Array.isArray(r)?`(${r.map(ls).join(", ")})`:`(${ls(r.type)}...)`}class qs{constructor(e,i,a){this.type=_f,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const o=a["case-sensitive"]===void 0?i.parse(!1,1,Kr):i.parseObjectValue(a["case-sensitive"],1,"case-sensitive",Kr);if(!o)return null;const d=a["diacritic-sensitive"]===void 0?i.parse(!1,1,Kr):i.parseObjectValue(a["diacritic-sensitive"],1,"diacritic-sensitive",Kr);if(!d)return null;let p=null;return a.locale&&(p=i.parseObjectValue(a.locale,1,"locale",Zr),!p)?null:new qs(o,d,p)}evaluate(e){return new Vl(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Wa(r,e,i=0,a=r.length-1,o=Nm){for(;a>i;){if(a-i>600){const T=a-i+1,A=e-i+1,M=Math.log(T),z=.5*Math.exp(2*M/3),D=.5*Math.sqrt(M*z*(T-z)/T)*(A-T/2<0?-1:1);Wa(r,e,Math.max(i,Math.floor(e-A*z/T+D)),Math.min(a,Math.floor(e+(T-A)*z/T+D)),o)}const d=r[e];let p=i,x=a;for($l(r,i,e),o(r[a],d)>0&&$l(r,i,a);p<x;){for($l(r,p,x),p++,x--;o(r[p],d)<0;)p++;for(;o(r[x],d)>0;)x--}o(r[i],d)===0?$l(r,i,x):(x++,$l(r,x,a)),x<=e&&(i=x+1),e<=x&&(a=x-1)}}function $l(r,e,i){const a=r[e];r[e]=r[i],r[i]=a}function Nm(r,e){return r<e?-1:r>e?1:0}function gd(r){let e=0;for(let i,a,o=0,d=r.length,p=d-1;o<d;p=o++)i=r[o],a=r[p],e+=(a.x-i.x)*(i.y+a.y);return e}function xu(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function To(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Rp(r,e,i){const a=r[0]-e[0],o=r[1]-e[1],d=r[0]-i[0],p=r[1]-i[1];return a*p-d*o==0&&a*d<=0&&o*p<=0}function mh(r,e,i=!1){let a=!1;for(let x=0,T=e.length;x<T;x++){const A=e[x];for(let M=0,z=A.length,D=z-1;M<z;D=M++){const k=A[D],B=A[M];if(Rp(r,k,B))return i;(d=k)[1]>(o=r)[1]!=(p=B)[1]>o[1]&&o[0]<(p[0]-d[0])*(o[1]-d[1])/(p[1]-d[1])+d[0]&&(a=!a)}}var o,d,p;return a}function km(r,e,i,a){const o=a[0]-i[0],d=a[1]-i[1],p=(r[0]-i[0])*d-o*(r[1]-i[1]),x=(e[0]-i[0])*d-o*(e[1]-i[1]);return p>0&&x<0||p<0&&x>0}function Zl(r,e,i,a){return(o=[a[0]-i[0],a[1]-i[1]])[0]*(d=[e[0]-r[0],e[1]-r[1]])[1]-o[1]*d[0]!=0&&!(!km(r,e,i,a)||!km(i,a,r,e));var o,d}function gh(r){const e=new Ct(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Ct(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const a of r[0])e.x>a.x&&(e.x=a.x),e.y>a.y&&(e.y=a.y),i.x<a.x&&(i.x=a.x),i.y<a.y&&(i.y=a.y);return{min:e,max:i}}const So=8192;function Wl(r,e){const i=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,o=Math.pow(2,e.z);return[Math.round(i*o*So),Math.round(a*o*So)]}function Bm(r,e){for(let i=0;i<e.length;i++)if(mh(r,e[i]))return!0;return!1}function vu(r,e,i){for(const a of i)for(let o=0,d=a.length,p=d-1;o<d;p=o++)if(Zl(r,e,a[p],a[o]))return!0;return!1}function Xl(r,e){for(let i=0;i<r.length;++i)if(!mh(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(vu(r[i],r[i+1],e))return!1;return!0}function vf(r,e){for(let i=0;i<e.length;i++)if(Xl(r,e[i]))return!0;return!1}function _d(r,e,i){const a=[];for(let o=0;o<r.length;o++){const d=[];for(let p=0;p<r[o].length;p++){const x=Wl(r[o][p],i);xu(e,x),d.push(x)}a.push(d)}return a}function Xs(r,e,i){const a=[];for(let o=0;o<r.length;o++){const d=_d(r[o],e,i);a.push(d)}return a}function Mp(r,e,i,a){if(r[0]<i[0]||r[0]>i[2]){const o=.5*a;let d=r[0]-i[0]>o?-a:i[0]-r[0]>o?a:0;d===0&&(d=r[0]-i[2]>o?-a:i[2]-r[0]>o?a:0),r[0]+=d}xu(e,r)}function Ip(r,e,i,a){const o=Math.pow(2,a.z)*So,d=[a.x*So,a.y*So],p=[];if(!r)return p;for(const x of r)for(const T of x){const A=[T.x+d[0],T.y+d[1]];Mp(A,e,i,o),p.push(A)}return p}function zp(r,e,i,a){const o=Math.pow(2,a.z)*So,d=[a.x*So,a.y*So],p=[];if(!r)return p;for(const T of r){const A=[];for(const M of T){const z=[M.x+d[0],M.y+d[1]];xu(e,z),A.push(z)}p.push(A)}if(e[2]-e[0]<=o/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const T of p)for(const A of T)Mp(A,e,i,o)}var x;return p}class bu{constructor(e,i){this.type=Kr,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ph(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let o=0;o<a.features.length;++o){const d=a.features[o].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new bu(a,a.features[o].geometry)}else if(a.type==="Feature"){const o=a.geometry.type;if(o==="Polygon"||o==="MultiPolygon")return new bu(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new bu(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,a){const o=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const x=_d(a.coordinates,d,p),T=Ip(i.geometry(),o,d,p);if(!To(o,d))return!1;for(const A of T)if(!mh(A,x))return!1}if(a.type==="MultiPolygon"){const x=Xs(a.coordinates,d,p),T=Ip(i.geometry(),o,d,p);if(!To(o,d))return!1;for(const A of T)if(!Bm(A,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,a){const o=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const x=_d(a.coordinates,d,p),T=zp(i.geometry(),o,d,p);if(!To(o,d))return!1;for(const A of T)if(!Xl(A,x))return!1}if(a.type==="MultiPolygon"){const x=Xs(a.coordinates,d,p),T=zp(i.geometry(),o,d,p);if(!To(o,d))return!1;for(const A of T)if(!vf(A,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const yd={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Lp=1/298.257223563,bf=Lp*(2-Lp),wu=Math.PI/180;class Tu{static fromTile(e,i,a){const o=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),d=Math.atan(.5*(Math.exp(o)-Math.exp(-o)))/wu;return new Tu(d,a)}static get units(){return yd}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!yd[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(yd).join(", ")}`);const a=6378.137*wu*(i?yd[i]:1),o=Math.cos(e*wu),d=1/(1-bf*(1-o*o)),p=Math.sqrt(d);this.kx=a*p*o,this.ky=a*p*d*(1-bf)}distance(e,i){const a=Ys(e[0]-i[0])*this.kx,o=(e[1]-i[1])*this.ky;return Math.sqrt(a*a+o*o)}bearing(e,i){const a=Ys(i[0]-e[0])*this.kx;return Math.atan2(a,(i[1]-e[1])*this.ky)/wu}destination(e,i,a){const o=a*wu;return this.offset(e,Math.sin(o)*i,Math.cos(o)*i)}offset(e,i,a){return[e[0]+i/this.kx,e[1]+a/this.ky]}lineDistance(e){let i=0;for(let a=0;a<e.length-1;a++)i+=this.distance(e[a],e[a+1]);return i}area(e){let i=0;for(let a=0;a<e.length;a++){const o=e[a];for(let d=0,p=o.length,x=p-1;d<p;x=d++)i+=Ys(o[d][0]-o[x][0])*(o[d][1]+o[x][1])*(a?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let a=0;if(i<=0)return e[0];for(let o=0;o<e.length-1;o++){const d=e[o],p=e[o+1],x=this.distance(d,p);if(a+=x,a>i)return Ba(d,p,(i-(a-x))/x)}return e[e.length-1]}pointToSegmentDistance(e,i,a){let[o,d]=i,p=Ys(a[0]-o)*this.kx,x=(a[1]-d)*this.ky;if(p!==0||x!==0){const T=(Ys(e[0]-o)*this.kx*p+(e[1]-d)*this.ky*x)/(p*p+x*x);T>1?(o=a[0],d=a[1]):T>0&&(o+=p/this.kx*T,d+=x/this.ky*T)}return p=Ys(e[0]-o)*this.kx,x=(e[1]-d)*this.ky,Math.sqrt(p*p+x*x)}pointOnLine(e,i){let a=1/0,o=e[0][0],d=e[0][1],p=0,x=0;for(let T=0;T<e.length-1;T++){let A=e[T][0],M=e[T][1],z=Ys(e[T+1][0]-A)*this.kx,D=(e[T+1][1]-M)*this.ky,k=0;z===0&&D===0||(k=(Ys(i[0]-A)*this.kx*z+(i[1]-M)*this.ky*D)/(z*z+D*D),k>1?(A=e[T+1][0],M=e[T+1][1]):k>0&&(A+=z/this.kx*k,M+=D/this.ky*k)),z=Ys(i[0]-A)*this.kx,D=(i[1]-M)*this.ky;const B=z*z+D*D;B<a&&(a=B,o=A,d=M,p=T,x=k)}return{point:[o,d],index:p,t:Math.max(0,Math.min(1,x))}}lineSlice(e,i,a){let o=this.pointOnLine(a,e),d=this.pointOnLine(a,i);if(o.index>d.index||o.index===d.index&&o.t>d.t){const A=o;o=d,d=A}const p=[o.point],x=o.index+1,T=d.index;!lo(a[x],p[0])&&x<=T&&p.push(a[x]);for(let A=x+1;A<=T;A++)p.push(a[A]);return lo(a[T],d.point)||p.push(d.point),p}lineSliceAlong(e,i,a){let o=0;const d=[];for(let p=0;p<a.length-1;p++){const x=a[p],T=a[p+1],A=this.distance(x,T);if(o+=A,o>e&&d.length===0&&d.push(Ba(x,T,(e-(o-A))/A)),o>=i)return d.push(Ba(x,T,(i-(o-A))/A)),d;o>e&&d.push(T)}return d}bufferPoint(e,i){const a=i/this.ky,o=i/this.kx;return[e[0]-o,e[1]-a,e[0]+o,e[1]+a]}bufferBBox(e,i){const a=i/this.ky,o=i/this.kx;return[e[0]-o,e[1]-a,e[2]+o,e[3]+a]}insideBBox(e,i){return Ys(e[0]-i[0])>=0&&Ys(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function lo(r,e){return r[0]===e[0]&&r[1]===e[1]}function Ba(r,e,i){const a=Ys(e[0]-r[0]);return[r[0]+a*i,r[1]+(e[1]-r[1])*i]}function Ys(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class _h{constructor(e=[],i=(a,o)=>a<o?-1:a>o?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:a}=this,o=i[e];for(;e>0;){const d=e-1>>1,p=i[d];if(a(o,p)>=0)break;i[e]=p,e=d}i[e]=o}_down(e){const{data:i,compare:a}=this,o=this.length>>1,d=i[e];for(;e<o;){let p=1+(e<<1);const x=p+1;if(x<this.length&&a(i[x],i[p])<0&&(p=x),a(i[p],d)>=0)break;i[e]=i[p],e=p}i[e]=d}}var Vt=8192;function yh(r,e){return e.dist-r.dist}const Lc=100,co=50;function xh(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}function Dc(r){return r[1]-r[0]+1}function Fa(r,e){const i=r[1]>=r[0]&&r[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function xd(r,e){if(r[0]>r[1])return[null,null];const i=Dc(r);if(e){if(i===2)return[r,null];const a=Math.floor(i/2);return[[r[0],r[0]+a],[r[0]+a,r[1]]]}{if(i===1)return[r,null];const a=Math.floor(i/2)-1;return[[r[0],r[0]+a],[r[0]+a+1,r[1]]]}}function ms(r,e){const i=[1/0,1/0,-1/0,-1/0];if(!Fa(e,r.length))return i;for(let a=e[0];a<=e[1];++a)xu(i,r[a]);return i}function mr(r){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<r.length;++i)for(let a=0;a<r[i].length;++a)xu(e,r[i][a]);return e}function Uo(r,e,i){if(xh(r)||xh(e))return NaN;let a=0,o=0;return r[2]<e[0]&&(a=e[0]-r[2]),r[0]>e[2]&&(a=r[0]-e[2]),r[1]>e[3]&&(o=r[1]-e[3]),r[3]<e[1]&&(o=e[1]-r[3]),i.distance([0,0],[a,o])}function wf(r){return 360*r-180}function Tf(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Ua(r,e){const i=Math.pow(2,e.z),a=(r.y/Vt+e.y)/i;return[wf((r.x/Vt+e.x)/i),Tf(a)]}function Eo(r,e){const i=[];for(let a=0;a<r.length;++a)i.push(Ua(r[a],e));return i}function cn(r,e,i){const a=i.pointOnLine(e,r).point;return i.distance(r,a)}function hl(r,e,i,a,o){const d=i.slice(a[0],a[1]+1);let p=1/0;for(let x=e[0];x<=e[1];++x)if((p=Math.min(p,cn(r[x],d,o)))===0)return 0;return p}function Vo(r,e,i,a,o){const d=Math.min(o.pointToSegmentDistance(r,i,a),o.pointToSegmentDistance(e,i,a)),p=Math.min(o.pointToSegmentDistance(i,r,e),o.pointToSegmentDistance(a,r,e));return Math.min(d,p)}function Su(r,e,i,a,o){if(!Fa(e,r.length)||!Fa(a,i.length))return NaN;let d=1/0;for(let p=e[0];p<e[1];++p)for(let x=a[0];x<a[1];++x){if(Zl(r[p],r[p+1],i[x],i[x+1]))return 0;d=Math.min(d,Vo(r[p],r[p+1],i[x],i[x+1],o))}return d}function Fm(r,e,i,a,o){if(!Fa(e,r.length)||!Fa(a,i.length))return NaN;let d=1/0;for(let p=e[0];p<=e[1];++p)for(let x=a[0];x<=a[1];++x)if((d=Math.min(d,o.distance(r[p],i[x])))===0)return d;return d}function Dp(r,e,i){if(mh(r,e,!0))return 0;let a=1/0;for(const o of e){const d=o.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(o[0]!==o[d-1]&&(a=Math.min(a,i.pointToSegmentDistance(r,o[d-1],o[0])))===0||(a=Math.min(a,cn(r,o,i)))===0)return a}return a}function Pp(r,e,i,a){if(!Fa(e,r.length))return NaN;for(let d=e[0];d<=e[1];++d)if(mh(r[d],i,!0))return 0;let o=1/0;for(let d=e[0];d<e[1];++d)for(const p of i)for(let x=0,T=p.length,A=T-1;x<T;A=x++){if(Zl(r[d],r[d+1],p[A],p[x]))return 0;o=Math.min(o,Vo(r[d],r[d+1],p[A],p[x],a))}return o}function Aa(r,e){for(const i of r)for(let a=0;a<=i.length-1;++a)if(mh(i[a],e,!0))return!0;return!1}function ua(r,e,i,a=1/0){const o=mr(r),d=mr(e);if(a!==1/0&&Uo(o,d,i)>=a)return a;if(To(o,d)){if(Aa(r,e))return 0}else if(Aa(e,r))return 0;let p=a;for(const x of r)for(let T=0,A=x.length,M=A-1;T<A;M=T++)for(const z of e)for(let D=0,k=z.length,B=k-1;D<k;B=D++){if(Zl(x[M],x[T],z[B],z[D]))return 0;p=Math.min(p,Vo(x[M],x[T],z[B],z[D],i))}return p}function En(r,e,i,a,o,d,p){if(d===null||p===null)return;const x=Uo(ms(a,d),ms(o,p),i);x<e&&r.push({dist:x,range1:d,range2:p})}function Ho(r,e,i,a,o=1/0){let d=Math.min(a.distance(r[0],i[0][0]),o);if(d===0)return d;const p=new _h([{dist:0,range1:[0,r.length-1],range2:[0,0]}],yh),x=e?co:Lc,T=mr(i);for(;p.length;){const A=p.pop();if(A.dist>=d)continue;const M=A.range1;if(Dc(M)<=x){if(!Fa(M,r.length))return NaN;if(e){const z=Pp(r,M,i,a);if((d=Math.min(d,z))===0)return d}else for(let z=M[0];z<=M[1];++z){const D=Dp(r[z],i,a);if((d=Math.min(d,D))===0)return d}}else{const z=xd(M,e);if(z[0]!==null){const D=Uo(ms(r,z[0]),T,a);D<d&&p.push({dist:D,range1:z[0],range2:[0,0]})}if(z[1]!==null){const D=Uo(ms(r,z[1]),T,a);D<d&&p.push({dist:D,range1:z[1],range2:[0,0]})}}}return d}function qo(r,e,i,a,o,d=1/0){let p=Math.min(d,o.distance(r[0],i[0]));if(p===0)return p;const x=new _h([{dist:0,range1:[0,r.length-1],range2:[0,i.length-1]}],yh),T=e?co:Lc,A=a?co:Lc;for(;x.length;){const M=x.pop();if(M.dist>=p)continue;const z=M.range1,D=M.range2;if(Dc(z)<=T&&Dc(D)<=A){if(!Fa(z,r.length)||!Fa(D,i.length))return NaN;if(e&&a?p=Math.min(p,Su(r,z,i,D,o)):e||a?e&&!a?p=Math.min(p,hl(i,D,r,z,o)):!e&&a&&(p=Math.min(p,hl(r,z,i,D,o))):p=Math.min(p,Fm(r,z,i,D,o)),p===0)return p}else{const k=xd(z,e),B=xd(D,a);En(x,p,o,r,i,k[0],B[0]),En(x,p,o,r,i,k[0],B[1]),En(x,p,o,r,i,k[1],B[0]),En(x,p,o,r,i,k[1],B[1])}}return p}function vd(r,e,i,a,o=1/0){let d=o;const p=ms(r,[0,r.length-1]);for(const x of i)if(!(d!==1/0&&Uo(p,ms(x,[0,x.length-1]),a)>=d)&&(d=Math.min(d,qo(r,e,x,!0,a,d)),d===0))return d;return d}function dl(r,e,i,a,o=1/0){let d=o;const p=ms(r,[0,r.length-1]);for(const x of i){if(d!==1/0&&Uo(p,mr(x),a)>=d)continue;const T=Ho(r,e,x,a,d);if(isNaN(T))return T;if((d=Math.min(d,T))===0)return d}return d}function Sf(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class Pc{constructor(e,i){this.type=yi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ph(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let o=0;o<a.features.length;++o)if(Sf(a.features[o].geometry.type))return new Pc(a,a.features[o].geometry)}else if(a.type==="Feature"){if(Sf(a.geometry.type))return new Pc(a,a.geometry)}else if(Sf(a.type))return new Pc(a,a)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),a=e.canonicalID();if(i!=null&&a!=null){if(e.geometryType()==="Point")return function(o,d,p){const x=[];for(const A of o)for(const M of A)x.push(Ua(M,d));const T=new Tu(x[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?qo(x,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",T):p.type==="MultiLineString"?vd(x,!1,p.coordinates,T):p.type==="Polygon"||p.type==="MultiPolygon"?dl(x,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,T):null}(i,a,this.geometries);if(e.geometryType()==="LineString")return function(o,d,p){const x=[];for(const A of o){const M=[];for(const z of A)M.push(Ua(z,d));x.push(M)}const T=new Tu(x[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return vd(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",x,T);if(p.type==="MultiLineString"){let A=1/0;for(let M=0;M<p.coordinates.length;M++){const z=vd(p.coordinates[M],!0,x,T,A);if(isNaN(z))return z;if((A=Math.min(A,z))===0)return A}return A}if(p.type==="Polygon"||p.type==="MultiPolygon"){let A=1/0;for(let M=0;M<x.length;M++){const z=dl(x[M],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,T,A);if(isNaN(z))return z;if((A=Math.min(A,z))===0)return A}return A}return null}(i,a,this.geometries);if(e.geometryType()==="Polygon")return function(o,d,p){const x=[];for(const A of function(M,z){const D=M.length;if(D<=1)return[M];const k=[];let B,W;for(let Y=0;Y<D;Y++){const K=gd(M[Y]);K!==0&&(M[Y].area=Math.abs(K),W===void 0&&(W=K<0),W===K<0?(B&&k.push(B),B=[M[Y]]):B.push(M[Y]))}return B&&k.push(B),k}(o)){const M=[];for(let z=0;z<A.length;++z)M.push(Eo(A[z],d));x.push(M)}const T=new Tu(x[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return dl(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",x,T);if(p.type==="MultiLineString"){let A=1/0;for(let M=0;M<p.coordinates.length;M++){const z=dl(p.coordinates[M],!0,x,T,A);if(isNaN(z))return z;if((A=Math.min(A,z))===0)return A}return A}return p.type==="Polygon"||p.type==="MultiPolygon"?function(A,M,z){let D=1/0;for(const k of A)for(const B of M){const W=ua(k,B,z,D);if(isNaN(W))return W;if((D=Math.min(D,W))===0)return D}return D}(p.type==="Polygon"?[p.coordinates]:p.coordinates,x,T):null}(i,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function fl(r){if(r instanceof Ea&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof bu||r instanceof Pc)return!1;if(r instanceof Yl)return r.featureConstant;let e=!0;return r.eachChild(i=>{e&&!fl(i)&&(e=!1)}),e}function Oc(r){if(r instanceof Ea&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(i=>{e&&!Oc(i)&&(e=!1)}),e}function jc(r){if(r instanceof Yl)return new Set([r.key]);let e=new Set;return r.eachChild(i=>{e=new Set([...e,...jc(i)])}),e}function pl(r,e){if(r instanceof Ea&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(a=>{i&&!pl(a,e)&&(i=!1)}),i}function Op(r,e,i){return[r,e,i].filter(Boolean).join("")}function bd(r,e){switch(r){case"string":return ka(e);case"number":return+e;case"boolean":return!!e;case"color":return $r.parse(e);case"formatted":return ca.fromString(ka(e));case"resolvedImage":return Sa.build(ka(e))}return e}function jp(r,e,i,a){return a!==void 0&&(r=a*Math.round(r/a)),e!==void 0&&r<e&&(r=e),i!==void 0&&r>i&&(r=i),r}class Yl{constructor(e,i,a,o=!1){this.type=e,this.key=i,this.scope=a,this.featureConstant=o}static parse(e,i){let a=i.expectedType;if(a==null&&(a=qr),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const o=i.parse(e[1],1);if(!(o instanceof ir))return i.error("Key name of 'config' expression must be a string literal.");let d,p=!0;const x=ka(o.value);if(e.length>=3){const T=i.parse(e[2],2);if(!(T instanceof ir))return i.error("Scope of 'config' expression must be a string literal.");d=ka(T.value)}if(i.options){const T=Op(x,d,i._scope),A=i.options.get(T);A&&(p=fl(A.value||A.default))}return new Yl(a,x,d,p)}evaluate(e){const i=Op(this.key,this.scope,e.scope),a=e.getConfig(i);if(!a)return null;const{type:o,value:d,values:p,minValue:x,maxValue:T,stepValue:A}=a,M=a.default.evaluate(e);let z=M;if(d){const D=e.scope;e.scope=(D||"").split("").slice(1).join(""),z=d.evaluate(e),e.scope=D}return o&&(z=bd(o,z)),z===void 0||x===void 0&&T===void 0&&A===void 0||(typeof z=="number"?z=jp(z,x,T,A):Array.isArray(z)&&(z=z.map(D=>typeof D=="number"?jp(D,x,T,A):D))),d!==void 0&&z!==void 0&&p&&!p.includes(z)&&(z=M,o&&(z=bd(o,z))),(o&&o!==this.type||z!==void 0&&!fd(vs(z),this.type))&&(z=bd(this.type.kind,z)),z}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class wd{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=e[1];return i.scope.has(a)?new wd(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Nc{constructor(e,i=[],a,o=new gf,d=[],p,x,T){this.registry=e,this.path=i,this.key=i.map(A=>typeof A=="string"?`['${A}']`:`[${A}]`).join(""),this.scope=o,this.errors=d,this.expectedType=a,this._scope=p,this.options=x,this.iconImageUseTheme=T}parse(e,i,a,o,d={}){return i||a?this.concat(i,null,a,o)._parse(e,d):this._parse(e,d)}parseObjectValue(e,i,a,o,d,p={}){return this.concat(i,a,o,d)._parse(e,p)}_parse(e,i){function a(o,d,p){return p==="assert"?new Ii(d,[o]):p==="coerce"?new Qn(d,[o]):o}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const o=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(o){let d=o.parse(e,this);if(!d)return null;if(this.expectedType){const p=this.expectedType,x=d.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||x.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(p,x))return null}else d=a(d,p,i.typeAnnotation||"coerce");else d=a(d,p,i.typeAnnotation||"assert")}if(!(d instanceof ir)&&d.type.kind!=="resolvedImage"&&Ef(d)){const p=new Gl(this._scope,this.options,this.iconImageUseTheme);try{d=new ir(d.type,d.evaluate(p))}catch(x){return this.error(x.message),null}}return d}return Qn.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a,o){let d=typeof e=="number"?this.path.concat(e):this.path;d=typeof i=="string"?d.concat(i):d;const p=o?this.scope.concat(o):this.scope;return new Nc(this.registry,d,a||null,p,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const a=`${this.key}${i.map(o=>`[${o}]`).join("")}`;this.errors.push(new Fo(a,e))}checkSubtype(e,i){const a=hd(e,i);return a&&this.error(a),a}}function Ef(r){if(r instanceof wd)return Ef(r.boundExpression);if(r instanceof Ea&&r.name==="error"||r instanceof qs||r instanceof bu||r instanceof Pc||r instanceof Yl)return!1;const e=r instanceof Qn||r instanceof Ii;let i=!0;return r.eachChild(a=>{i=e?i&&Ef(a):i&&a instanceof ir}),!!i&&fl(r)&&pl(r,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Kl(r,e){const i=r.length-1;let a,o,d=0,p=i,x=0;for(;d<=p;)if(x=Math.floor((d+p)/2),a=r[x],o=r[x+1],a<=e){if(x===i||e<o)return x;d=x+1}else{if(!(a>e))throw new ni("Input is not a number.");p=x-1}return 0}class Jl{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[o,d]of a)this.labels.push(o),this.outputs.push(d)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(e[1],1,yi);if(!a)return null;const o=[];let d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let p=1;p<e.length;p+=2){const x=p===1?-1/0:e[p],T=e[p+1],A=p,M=p+1;if(typeof x!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(o.length&&o[o.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const z=i.parse(T,M,d);if(!z)return null;d=d||z.type,o.push([x,z])}return new Jl(d,a,o)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const o=this.input.evaluate(e);if(o<=i[0])return a[0].evaluate(e);const d=i.length;return o>=i[d-1]?a[d-1].evaluate(e):a[Kl(i,o)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Td=.95047,vh=1.08883,Sd=4/29,Ql=6/29,Np=3*Ql*Ql,kc=Ql*Ql*Ql,Um=Math.PI/180,bh=180/Math.PI;function wh(r){return r>kc?Math.pow(r,1/3):r/Np+Sd}function Ed(r){return r>Ql?r*r*r:Np*(r-Sd)}function Th(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function ml(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Xa(r){const e=ml(r.r),i=ml(r.g),a=ml(r.b),o=wh((.4124564*e+.3575761*i+.1804375*a)/Td),d=wh((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*d-16,a:500*(o-d),b:200*(d-wh((.0193339*e+.119192*i+.9503041*a)/vh)),alpha:r.a}}function Ao(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,a=isNaN(r.b)?e:e-r.b/200;return e=1*Ed(e),i=Td*Ed(i),a=vh*Ed(a),new $r(Th(3.2404542*i-1.5371385*e-.4985314*a),Th(-.969266*i+1.8760108*e+.041556*a),Th(.0556434*i-.2040259*e+1.0572252*a),r.alpha)}function Bc(r,e,i){const a=e-r;return r+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const Fc={forward:Xa,reverse:Ao,interpolate:function(r,e,i){return{l:Li(r.l,e.l,i),a:Li(r.a,e.a,i),b:Li(r.b,e.b,i),alpha:Li(r.alpha,e.alpha,i)}}},Ya={forward:function(r){const{l:e,a:i,b:a}=Xa(r),o=Math.atan2(a,i)*bh;return{h:o<0?o+360:o,c:Math.sqrt(i*i+a*a),l:e,alpha:r.a}},reverse:function(r){const e=r.h*Um,i=r.c;return Ao({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:Bc(r.h,e.h,i),c:Li(r.c,e.c,i),l:Li(r.l,e.l,i),alpha:Li(r.alpha,e.alpha,i)}}};var gl=Object.freeze({__proto__:null,hcl:Ya,lab:Fc});class kn{constructor(e,i,a,o,d){this.type=e,this.operator=i,this.interpolation=a,this.input=o,this.labels=[],this.outputs=[];for(const[p,x]of d)this.labels.push(p),this.outputs.push(x)}static interpolationFactor(e,i,a,o){let d=0;if(e.name==="exponential")d=Eu(i,e.base,a,o);else if(e.name==="linear")d=Eu(i,1,a,o);else if(e.name==="cubic-bezier"){const p=e.controlPoints;d=new xs(p[0],p[1],p[2],p[3]).solve(Eu(i,1,a,o))}return d}static parse(e,i){let[a,o,d,...p]=e;if(!Array.isArray(o)||o.length===0)return i.error("Expected an interpolation type expression.",1);if(o[0]==="linear")o={name:"linear"};else if(o[0]==="exponential"){const A=o[1];if(typeof A!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);o={name:"exponential",base:A}}else{if(o[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(o[0])}`,1,0);{const A=o.slice(1);if(A.length!==4||A.some(M=>typeof M!="number"||M<0||M>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);o={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,yi),!d)return null;const x=[];let T=null;a==="interpolate-hcl"||a==="interpolate-lab"?T=Na:i.expectedType&&i.expectedType.kind!=="value"&&(T=i.expectedType);for(let A=0;A<p.length;A+=2){const M=p[A],z=p[A+1],D=A+3,k=A+4;if(typeof M!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(x.length&&x[x.length-1][0]>=M)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const B=i.parse(z,k,T);if(!B)return null;T=T||B.type,x.push([M,B])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new kn(T,a,o,d,x):i.error(`Type ${ls(T)} is not interpolatable.`)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const o=this.input.evaluate(e);if(o<=i[0])return a[0].evaluate(e);const d=i.length;if(o>=i[d-1])return a[d-1].evaluate(e);const p=Kl(i,o),x=kn.interpolationFactor(this.interpolation,o,i[p],i[p+1]),T=a[p].evaluate(e),A=a[p+1].evaluate(e);return this.operator==="interpolate"?oo[this.type.kind.toLowerCase()](T,A,x):this.operator==="interpolate-hcl"?Ya.reverse(Ya.interpolate(Ya.forward(T),Ya.forward(A),x)):Fc.reverse(Fc.interpolate(Fc.forward(T),Fc.forward(A),x))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function Eu(r,e,i,a){const o=a-i,d=r-i;return o===0?0:e===1?d/o:(Math.pow(e,d)-1)/(Math.pow(e,o)-1)}class Ad{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null;const o=i.expectedType;o&&o.kind!=="value"&&(a=o);const d=[];for(const x of e.slice(1)){const T=i.parse(x,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!T)return null;a=a||T.type,d.push(T)}const p=o&&d.some(x=>hd(o,x.type));return new Ad(p?qr:a,d)}evaluate(e){let i,a=null,o=0;for(const d of this.args){if(o++,a=d.evaluate(e),a&&a instanceof Sa&&!a.available&&(i||(i=a),a=null,o===this.args.length))return i;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Af{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let d=1;d<e.length-1;d+=2){const p=e[d];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,d);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);const x=i.parse(e[d+1],d+1);if(!x)return null;a.push([p,x])}const o=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return o?new Af(a,o):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,a]of this.bindings)e.push(i,a.serialize());return e.push(this.result.serialize()),e}}class kp{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,yi),o=i.parse(e[2],2,la(i.expectedType||qr));return a&&o?new kp(o.type.itemType,a,o):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new ni("Array index out of bounds: negative index");if(i>=a.length)throw new ni("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new ni("Array index must be an integer. Use at-interpolated for fractional indices");return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Is{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,yi),o=i.parse(e[2],2,la(i.expectedType||qr));return a&&o?new Is(o.type.itemType,a,o):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new ni(`Array index out of bounds: ${i} < 0.`);if(i>a.length-1)throw new ni(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i===Math.floor(i))return a[i];const o=Math.floor(i),d=Math.ceil(i),p=a[o],x=a[d];if(typeof p!="number"||typeof x!="number")throw new ni(`Cannot interpolate between non-number values at index ${i}.`);const T=i-o;return p*(1-T)+x*T}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Sh{constructor(e,i){this.type=Kr,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,qr),o=i.parse(e[2],2,qr);return a&&o?dd(a.type,[Kr,Zr,yi,bo,qr])?new Sh(a,o):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ls(a.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Ul(i,["boolean","string","number","null"]))throw new ni(`Expected first argument to be of type boolean, string, number or null, but found ${ls(vs(i))} instead.`);if(!Ul(a,["string","array"]))throw new ni(`Expected second argument to be of type array or string, but found ${ls(vs(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ec{constructor(e,i,a){this.type=yi,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,qr),o=i.parse(e[2],2,qr);if(!a||!o)return null;if(!dd(a.type,[Kr,Zr,yi,bo,qr]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ls(a.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,yi);return d?new ec(a,o,d):null}return new ec(a,o)}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Ul(i,["boolean","string","number","null"]))throw new ni(`Expected first argument to be of type boolean, string, number or null, but found ${ls(vs(i))} instead.`);if(!Ul(a,["string","array"]))throw new ni(`Expected second argument to be of type array or string, but found ${ls(vs(a))} instead.`);if(this.fromIndex){const o=this.fromIndex.evaluate(e);return a.indexOf(i,o)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class _l{constructor(e,i,a,o,d,p){this.inputType=e,this.type=i,this.input=a,this.cases=o,this.outputs=d,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const d={},p=[];for(let A=2;A<e.length-1;A+=2){let M=e[A];const z=e[A+1];Array.isArray(M)||(M=[M]);const D=i.concat(A);if(M.length===0)return D.error("Expected at least one branch label.");for(const B of M){if(typeof B!="number"&&typeof B!="string")return D.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return D.error("Numeric branch labels must be integer values.");if(a){if(D.checkSubtype(a,vs(B)))return null}else a=vs(B);if(d[String(B)]!==void 0)return D.error("Branch labels must be unique.");d[String(B)]=p.length}const k=i.parse(z,A,o);if(!k)return null;o=o||k.type,p.push(k)}const x=i.parse(e[1],1,qr);if(!x)return null;const T=i.parse(e[e.length-1],e.length-1,o);return T?x.type.kind!=="value"&&i.concat(1).checkSubtype(a,x.type)?null:new _l(a,o,x,d,p,T):null}evaluate(e){const i=this.input.evaluate(e);return(fd(vs(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],o={};for(const p of i){const x=o[this.cases[p]];x===void 0?(o[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[x][1].push(p)}const d=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,x]of a)e.push(x.length===1?d(x[0]):x.map(d)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class Cd{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const o=[];for(let p=1;p<e.length-1;p+=2){const x=i.parse(e[p],p,Kr);if(!x)return null;const T=i.parse(e[p+1],p+1,a);if(!T)return null;o.push([x,T]),a=a||T.type}const d=i.parse(e[e.length-1],e.length-1,a);return d?new Cd(a,o,d):null}evaluate(e){for(const[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class yl{constructor(e,i,a,o){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,qr),o=i.parse(e[2],2,yi);if(!a||!o)return null;if(!dd(a.type,[la(qr),Zr,qr]))return i.error(`Expected first argument to be of type array or string, but found ${ls(a.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,yi);return d?new yl(a.type,a,o,d):null}return new yl(a.type,a,o)}evaluate(e){const i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Ul(i,["string","array"]))throw new ni(`Expected first argument to be of type array or string, but found ${ls(vs(i))} instead.`);if(this.endIndex){const o=this.endIndex.evaluate(e);return i.slice(a,o)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Uc{constructor(e,i){this.type=la(Zr),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Zr),o=i.parse(e[2],2,Zr);return a&&o?new Uc(a,o):void 0}evaluate(e){const i=this.str.evaluate(e),a=this.delimiter.evaluate(e);return i.split(a)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Vm(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Cf(r,e,i,a){return a.compare(e,i)===0}function Au(r,e,i){const a=r!=="=="&&r!=="!=";return class f5{constructor(d,p,x){this.type=Kr,this.lhs=d,this.rhs=p,this.collator=x,this.hasUntypedArgument=d.type.kind==="value"||p.type.kind==="value"}static parse(d,p){if(d.length!==3&&d.length!==4)return p.error("Expected two or three arguments.");const x=d[0];let T=p.parse(d[1],1,qr);if(!T)return null;if(!Vm(x,T.type))return p.concat(1).error(`"${x}" comparisons are not supported for type '${ls(T.type)}'.`);let A=p.parse(d[2],2,qr);if(!A)return null;if(!Vm(x,A.type))return p.concat(2).error(`"${x}" comparisons are not supported for type '${ls(A.type)}'.`);if(T.type.kind!==A.type.kind&&T.type.kind!=="value"&&A.type.kind!=="value")return p.error(`Cannot compare types '${ls(T.type)}' and '${ls(A.type)}'.`);a&&(T.type.kind==="value"&&A.type.kind!=="value"?T=new Ii(A.type,[T]):T.type.kind!=="value"&&A.type.kind==="value"&&(A=new Ii(T.type,[A])));let M=null;if(d.length===4){if(T.type.kind!=="string"&&A.type.kind!=="string"&&T.type.kind!=="value"&&A.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(M=p.parse(d[3],3,_f),!M)return null}return new f5(T,A,M)}evaluate(d){const p=this.lhs.evaluate(d),x=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){const T=vs(p),A=vs(x);if(T.kind!==A.kind||T.kind!=="string"&&T.kind!=="number")throw new ni(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${T.kind}, ${A.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const T=vs(p),A=vs(x);if(T.kind!=="string"||A.kind!=="string")return e(d,p,x)}return this.collator?i(d,p,x,this.collator.evaluate(d)):e(d,p,x)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[r];return this.eachChild(p=>{d.push(p.serialize())}),d}}}const Hm=Au("==",function(r,e,i){return e===i},Cf),Cu=Au("!=",function(r,e,i){return e!==i},function(r,e,i,a){return!Cf(0,e,i,a)}),Bp=Au("<",function(r,e,i){return e<i},function(r,e,i,a){return a.compare(e,i)<0}),Ru=Au(">",function(r,e,i){return e>i},function(r,e,i,a){return a.compare(e,i)>0}),qm=Au("<=",function(r,e,i){return e<=i},function(r,e,i,a){return a.compare(e,i)<=0}),Vc=Au(">=",function(r,e,i){return e>=i},function(r,e,i,a){return a.compare(e,i)>=0});class rn{constructor(e,i,a,o,d,p){this.type=Zr,this.number=e,this.locale=i,this.currency=a,this.unit=o,this.minFractionDigits=d,this.maxFractionDigits=p}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const a=i.parse(e[1],1,yi);if(!a)return null;const o=e[2];if(typeof o!="object"||Array.isArray(o))return i.error("NumberFormat options argument must be an object.");let d=null;if(o.locale&&(d=i.parseObjectValue(o.locale,2,"locale",Zr),!d))return null;let p=null;if(o.currency&&(p=i.parseObjectValue(o.currency,2,"currency",Zr),!p))return null;let x=null;if(o.unit&&(x=i.parseObjectValue(o.unit,2,"unit",Zr),!x))return null;let T=null;if(o["min-fraction-digits"]&&(T=i.parseObjectValue(o["min-fraction-digits"],2,"min-fraction-digits",yi),!T))return null;let A=null;return o["max-fraction-digits"]&&(A=i.parseObjectValue(o["max-fraction-digits"],2,"max-fraction-digits",yi),!A)?null:new rn(a,d,p,x,T,A)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Vn{constructor(e){this.type=yi,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=i.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${ls(a.type)} instead.`):new Vn(a):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new ni(`Expected value to be of type string or array, but found ${ls(vs(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function bs(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const tc={"==":Hm,"!=":Cu,">":Ru,"<":Bp,">=":Vc,"<=":qm,array:Ii,at:kp,"at-interpolated":Is,boolean:Ii,case:Cd,coalesce:Ad,collator:qs,format:gu,image:ql,in:Sh,"index-of":ec,interpolate:kn,"interpolate-hcl":kn,"interpolate-lab":kn,length:Vn,let:Af,literal:ir,match:_l,number:Ii,"number-format":rn,object:Ii,slice:yl,step:Jl,string:Ii,"to-boolean":Qn,"to-color":Qn,"to-number":Qn,"to-string":Qn,var:wd,within:bu,distance:Pc,config:Yl,split:Uc};function Mu(r,[e,i,a,o]){e=e.evaluate(r),i=i.evaluate(r),a=a.evaluate(r);const d=o?o.evaluate(r):1,p=mu(e,i,a,d);if(p)throw new ni(p);return new $r(e/255,i/255,a/255,d)}function ic(r,[e,i,a,o]){e=e.evaluate(r),i=i.evaluate(r),a=a.evaluate(r);const d=o?o.evaluate(r):1,p=function(A,M,z,D){return typeof A=="number"&&A>=0&&A<=360?typeof M=="number"&&M>=0&&M<=100&&typeof z=="number"&&z>=0&&z<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[A,M,z,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[A,M,z,D]:[A,M,z]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[A,M,z,D]:[A,M,z]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,a,d);if(p)throw new ni(p);const x=`hsla(${e}, ${i}%, ${a}%, ${d})`,T=$r.parse(x);if(!T)throw new ni(`Failed to parse HSLA color: ${x}`);return T}function Eh(r,e){return r in e}function Hc(r,e){const i=e[r];return i===void 0?null:i}function Co(r){return{type:r}}function Iu(r){return{result:"success",value:r}}function Kn(r){return{result:"error",value:r}}function Rd(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function Ah(r){return r["property-type"]==="data-driven"}function Rf(r){return Rd(r.expression,"measure-light")}function Mf(r){return Rd(r.expression,"zoom")}function If(r){return!!r.expression&&r.expression.interpolated}function Ch(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Md(r){return r}function Rh(r,e){const i=e.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",o=a||!(a||r.property!==void 0),d=r.type||(If(e)?"exponential":"interval");if(i&&((r=Object.assign({},r)).stops&&(r.stops=r.stops.map(A=>[A[0],$r.parse(A[1])])),r.default=$r.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!gl[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let p,x,T;if(d==="exponential")p=Mh;else if(d==="interval")p=Go;else if(d==="categorical"){p=Os,x=Object.create(null);for(const A of r.stops)x[A[0]]=A[1];T=typeof r.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);p=zf}if(a){const A={},M=[];for(let k=0;k<r.stops.length;k++){const B=r.stops[k],W=B[0].zoom;A[W]===void 0&&(A[W]={zoom:W,type:r.type,property:r.property,default:r.default,stops:[]},M.push(W)),A[W].stops.push([B[0].value,B[1]])}const z=[];for(const k of M)z.push([A[k].zoom,Rh(A[k],e)]);const D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:kn.interpolationFactor.bind(void 0,D),zoomStops:z.map(k=>k[0]),evaluate:({zoom:k},B)=>Mh({stops:z,base:r.base},e,k).evaluate(k,B)}}if(o){const A=d==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:kn.interpolationFactor.bind(void 0,A),zoomStops:r.stops.map(M=>M[0]),evaluate:({zoom:M})=>p(r,e,M,x,T)}}return{kind:"source",evaluate(A,M){const z=M&&M.properties?M.properties[r.property]:void 0;return z===void 0?Gs(r.default,e.default):p(r,e,z,x,T)}}}function Gs(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function Os(r,e,i,a,o){return Gs(typeof i===o?a[i]:void 0,r.default,e.default)}function Go(r,e,i){if(!yu(i))return Gs(r.default,e.default);const a=r.stops.length;if(a===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[a-1][0])return r.stops[a-1][1];const o=Kl(r.stops.map(d=>d[0]),i);return r.stops[o][1]}function Mh(r,e,i){const a=r.base!==void 0?r.base:1;if(!yu(i))return Gs(r.default,e.default);const o=r.stops.length;if(o===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[o-1][0])return r.stops[o-1][1];const d=Kl(r.stops.map(M=>M[0]),i),p=function(M,z,D,k){const B=k-D,W=M-D;return B===0?0:z===1?W/B:(Math.pow(z,W)-1)/(Math.pow(z,B)-1)}(i,a,r.stops[d][0],r.stops[d+1][0]),x=r.stops[d][1],T=r.stops[d+1][1];let A=oo[e.type]||Md;if(r.colorSpace&&r.colorSpace!=="rgb"){const M=gl[r.colorSpace];A=(z,D)=>M.reverse(M.interpolate(M.forward(z),M.forward(D),p))}return typeof x.evaluate=="function"?{evaluate(...M){const z=x.evaluate.apply(void 0,M),D=T.evaluate.apply(void 0,M);if(z!==void 0&&D!==void 0)return A(z,D,p)}}:A(x,T,p)}function zf(r,e,i){return e.type==="color"?i=$r.parse(i):e.type==="formatted"?i=ca.fromString(i.toString()):e.type==="resolvedImage"?i=Sa.build(i.toString()):ki(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Gs(i,r.default,e.default)}Ea.register(tc,{error:[{kind:"error"},[Zr],(r,[e])=>{throw new ni(e.evaluate(r))}],typeof:[Zr,[qr],(r,[e])=>ls(vs(e.evaluate(r)))],"to-rgba":[la(yi,4),[Na],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[la(yi,4),[Na],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Na,[yi,yi,yi],Mu],rgba:[Na,[yi,yi,yi,yi],Mu],hsl:[Na,[yi,yi,yi],ic],hsla:[Na,[yi,yi,yi,yi],ic],has:{type:Kr,overloads:[[[Zr],(r,[e])=>Eh(e.evaluate(r),r.properties())],[[Zr,pu],(r,[e,i])=>Eh(e.evaluate(r),i.evaluate(r))]]},get:{type:qr,overloads:[[[Zr],(r,[e])=>Hc(e.evaluate(r),r.properties())],[[Zr,pu],(r,[e,i])=>Hc(e.evaluate(r),i.evaluate(r))]]},"feature-state":[qr,[Zr],(r,[e])=>Hc(e.evaluate(r),r.featureState||{})],properties:[pu,[],r=>r.properties()],"geometry-type":[Zr,[],r=>r.geometryType()],worldview:[Zr,[],r=>r.globals.worldview||""],id:[qr,[],r=>r.id()],zoom:[yi,[],r=>r.globals.zoom],pitch:[yi,[],r=>r.globals.pitch||0],"distance-from-center":[yi,[],r=>r.distanceFromCenter()],"measure-light":[yi,[Zr],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[yi,[],r=>r.globals.heatmapDensity||0],"line-progress":[yi,[],r=>r.globals.lineProgress||0],"raster-value":[yi,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[yi,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[yi,[],r=>r.globals.skyRadialProgress||0],accumulated:[qr,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[yi,Co(yi),(r,e)=>{let i=0;for(const a of e)i+=a.evaluate(r);return i}],"*":[yi,Co(yi),(r,e)=>{let i=1;for(const a of e)i*=a.evaluate(r);return i}],"-":{type:yi,overloads:[[[yi,yi],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[yi],(r,[e])=>-e.evaluate(r)]]},"/":[yi,[yi,yi],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[yi,[yi,yi],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[yi,[],()=>Math.LN2],pi:[yi,[],()=>Math.PI],e:[yi,[],()=>Math.E],"^":[yi,[yi,yi],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[yi,[yi],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[yi,[yi],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[yi,[yi],(r,[e])=>Math.log(e.evaluate(r))],log2:[yi,[yi],(r,[e])=>Math.log2(e.evaluate(r))],sin:[yi,[yi],(r,[e])=>Math.sin(e.evaluate(r))],cos:[yi,[yi],(r,[e])=>Math.cos(e.evaluate(r))],tan:[yi,[yi],(r,[e])=>Math.tan(e.evaluate(r))],asin:[yi,[yi],(r,[e])=>Math.asin(e.evaluate(r))],acos:[yi,[yi],(r,[e])=>Math.acos(e.evaluate(r))],atan:[yi,[yi],(r,[e])=>Math.atan(e.evaluate(r))],min:[yi,Co(yi),(r,e)=>Math.min(...e.map(i=>i.evaluate(r)))],max:[yi,Co(yi),(r,e)=>Math.max(...e.map(i=>i.evaluate(r)))],abs:[yi,[yi],(r,[e])=>Math.abs(e.evaluate(r))],round:[yi,[yi],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[yi,[yi],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[yi,[yi],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Kr,[Zr,qr],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[Kr,[qr],(r,[e])=>r.id()===e.value],"filter-type-==":[Kr,[Zr],(r,[e])=>r.geometryType()===e.value],"filter-<":[Kr,[Zr,qr],(r,[e,i])=>{const a=r.properties()[e.value],o=i.value;return typeof a==typeof o&&a<o}],"filter-id-<":[Kr,[qr],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[Kr,[Zr,qr],(r,[e,i])=>{const a=r.properties()[e.value],o=i.value;return typeof a==typeof o&&a>o}],"filter-id->":[Kr,[qr],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[Kr,[Zr,qr],(r,[e,i])=>{const a=r.properties()[e.value],o=i.value;return typeof a==typeof o&&a<=o}],"filter-id-<=":[Kr,[qr],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[Kr,[Zr,qr],(r,[e,i])=>{const a=r.properties()[e.value],o=i.value;return typeof a==typeof o&&a>=o}],"filter-id->=":[Kr,[qr],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[Kr,[qr],(r,[e])=>e.value in r.properties()],"filter-has-id":[Kr,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Kr,[la(Zr)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Kr,[la(qr)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Kr,[Zr,la(qr)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Kr,[Zr,la(qr)],(r,[e,i])=>function(a,o,d,p){for(;d<=p;){const x=d+p>>1;if(o[x]===a)return!0;o[x]>a?p=x-1:d=x+1}return!1}(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Kr,overloads:[[[Kr,Kr],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[Co(Kr),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:Kr,overloads:[[[Kr,Kr],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[Co(Kr),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[Kr,[Kr],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Kr,[Zr],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[Zr,[Zr],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Zr,[Zr],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Zr,Co(qr),(r,e)=>e.map(i=>ka(i.evaluate(r))).join("")],"resolved-locale":[Zr,[_f],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[yi,[yi,yi,qr],(r,e)=>{const[i,a,o]=e.map(p=>p.evaluate(r));if(i>a||i===a)return i;let d;if(typeof o=="string")d=function(p){let x=0;if(p.length===0)return x;for(let T=0;T<p.length;T++)x=(x<<5)-x+p.charCodeAt(T),x|=0;return x}(o);else{if(typeof o!="number")throw new ni(`Invalid seed input: ${o}`);d=o}return i+bs(d)()*(a-i)}]});class Ih{constructor(e,i,a,o,d){this.expression=e,this._warningHistory={},this._evaluator=new Gl(a,o,d),this._defaultValue=i?function(p){return p.type==="color"&&(Ch(p.default)||Array.isArray(p.default))?new $r(0,0,0,0):p.type==="color"?$r.parse(p.default)||null:p.default===void 0?null:p.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=jc(e)}evaluateWithoutErrorHandling(e,i,a,o,d,p,x,T){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=o||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,o,d,p,x,T,A){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=o||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=T||null,this._evaluator.iconImageUseTheme=A||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new ni(`Expected value to be one of ${Object.keys(this._enumValues).map(z=>JSON.stringify(z)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${M.message}`)),this._defaultValue}}}function $o(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in tc}function uo(r,e,i,a,o){const d=new Nc(tc,[],e?function(x){const T={color:Na,string:Zr,number:yi,enum:Zr,boolean:Kr,formatted:Ic,resolvedImage:ud};return x.type==="array"?la(T[x.value]||qr,x.length):T[x.type]}(e):void 0,void 0,void 0,i,a,o),p=d.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Iu(new Ih(p,e,i,a,o)):Kn(d.errors)}class zu{constructor(e,i,a,o){this.kind=e,this._styleExpression=i,this.isLightConstant=a,this.isLineProgressConstant=o,this.isStateDependent=e!=="constant"&&!Oc(i.expression),this.configDependencies=jc(i.expression)}evaluateWithoutErrorHandling(e,i,a,o,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,o,d,p)}evaluate(e,i,a,o,d,p,x){return this._styleExpression.evaluate(e,i,a,o,d,p,void 0,void 0,x)}}class xl{constructor(e,i,a,o,d,p){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Oc(i.expression),this.isLightConstant=d,this.isLineProgressConstant=p,this.configDependencies=jc(i.expression),this.interpolationType=o}evaluateWithoutErrorHandling(e,i,a,o,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,o,d,p)}evaluate(e,i,a,o,d,p){return this._styleExpression.evaluate(e,i,a,o,d,p)}interpolationFactor(e,i,a){return this.interpolationType?kn.interpolationFactor(this.interpolationType,e,i,a):0}}function Lf(r,e,i,a,o){if((r=uo(r,e,i,a,o)).result==="error")return r;const d=r.value.expression,p=fl(d);if(!p&&!Ah(e))return Kn([new Fo("","data expressions not supported")]);const x=pl(d,["zoom","pitch","distance-from-center"]);if(!x&&!Mf(e))return Kn([new Fo("","zoom expressions not supported")]);const T=pl(d,["measure-light"]);if(!T&&!Rf(e))return Kn([new Fo("","measure-light expression not supported")]);const A=pl(d,["line-progress"]);if(!A&&!function(D){return Rd(D.expression,"line-progress")}(e))return Kn([new Fo("","line-progress expression not supported")]);const M=e.expression&&e.expression.relaxZoomRestriction,z=zd(d);return z||x||M?z instanceof Fo?Kn([z]):z instanceof kn&&!If(e)?Kn([new Fo("",'"interpolate" expressions cannot be used with this property')]):Iu(z?new xl(p&&A?"camera":"composite",r.value,z.labels,z instanceof kn?z.interpolation:void 0,T,A):new zu(p&&A?"constant":"source",r.value,T,A)):Kn([new Fo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Id{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,Rh(this._parameters,this._specification))}static deserialize(e){return new Id(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function zd(r){let e=null;if(r instanceof Af)e=zd(r.result);else if(r instanceof Ad){for(const i of r.args)if(e=zd(i),e)break}else(r instanceof Jl||r instanceof kn)&&r.input instanceof Ea&&r.input.name==="zoom"&&(e=r);return e instanceof Fo||r.eachChild(i=>{const a=zd(i);a instanceof Fo?e=a:e&&a&&e!==a&&(e=new Fo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var zh,Ld,Fp=function(){if(Ld)return zh;Ld=1,zh=e;var r=3;function e(i,a,o){var d=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var p=new Int32Array(this.arrayBuffer);i=p[0],this.d=(a=p[1])+2*(o=p[2]);for(var x=0;x<this.d*this.d;x++){var T=p[r+x],A=p[r+x+1];d.push(T===A?null:p.subarray(T,A))}var M=p[r+d.length+1];this.keys=p.subarray(p[r+d.length],M),this.bboxes=p.subarray(M),this.insert=this._insertReadonly}else{this.d=a+2*o;for(var z=0;z<this.d*this.d;z++)d.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=i,this.padding=o,this.scale=a/i,this.uid=0;var D=o/a*i;this.min=-D,this.max=i+D}return e.prototype.insert=function(i,a,o,d,p){this._forEachCell(a,o,d,p,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(a),this.bboxes.push(o),this.bboxes.push(d),this.bboxes.push(p)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,a,o,d,p,x){this.cells[p].push(x)},e.prototype.query=function(i,a,o,d,p){var x=this.min,T=this.max;if(i<=x&&a<=x&&T<=o&&T<=d&&!p)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(i,a,o,d,this._queryCell,A,{},p),A},e.prototype._queryCell=function(i,a,o,d,p,x,T,A){var M=this.cells[p];if(M!==null)for(var z=this.keys,D=this.bboxes,k=0;k<M.length;k++){var B=M[k];if(T[B]===void 0){var W=4*B;(A?A(D[W+0],D[W+1],D[W+2],D[W+3]):i<=D[W+2]&&a<=D[W+3]&&o>=D[W+0]&&d>=D[W+1])?(T[B]=!0,x.push(z[B])):T[B]=!1}}},e.prototype._forEachCell=function(i,a,o,d,p,x,T,A){for(var M=this._convertToCellCoord(i),z=this._convertToCellCoord(a),D=this._convertToCellCoord(o),k=this._convertToCellCoord(d),B=M;B<=D;B++)for(var W=z;W<=k;W++){var Y=this.d*W+B;if((!A||A(this._convertFromCellCoord(B),this._convertFromCellCoord(W),this._convertFromCellCoord(B+1),this._convertFromCellCoord(W+1)))&&p.call(this,i,a,o,d,Y,x,T,A))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,a=r+this.cells.length+1+1,o=0,d=0;d<this.cells.length;d++)o+=this.cells[d].length;var p=new Int32Array(a+o+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var x=a,T=0;T<i.length;T++){var A=i[T];p[r+T]=x,p.set(A,x),x+=A.length}return p[r+i.length]=x,p.set(this.keys,x),p[r+i.length+1]=x+=this.keys.length,p.set(this.bboxes,x),x+=this.bboxes.length,p.buffer},zh}(),rc=Rr(Fp);const Lu={};function si(r,e,i={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),Lu[e]={klass:r,omit:i.omit||[]}}si(Object,"Object"),rc.serialize=function(r,e){const i=r.toArrayBuffer();return e&&e.add(i),{buffer:i}},rc.deserialize=function(r){return new rc(r.buffer)},Object.defineProperty(rc,"name",{value:"Grid"}),si(rc,"Grid"),delete Ct.prototype.constructor,typeof DOMMatrix<"u"&&si(DOMMatrix,"DOMMatrix"),si($r,"Color"),si(Error,"Error"),si(ca,"Formatted"),si(pd,"FormattedSection"),si(ff,"AJAXError"),si(Sa,"ResolvedImage"),si(Id,"StylePropertyFunction"),si(Ih,"StyleExpression",{omit:["_evaluator"]}),si(ao,"ImageId"),si(wo,"ImageVariant"),si(xl,"ZoomDependentExpression"),si(zu,"ZoomConstantExpression"),si(Ea,"CompoundExpression",{omit:["_evaluate"]});for(const r in tc)Lu[tc[r]._classRegistryKey]||si(tc[r],`Expression${r}`);function Df(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function vl(r){return self.ImageBitmap&&r instanceof ImageBitmap}function nc(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(Df(r)||vl(r))return e&&e.add(r),r;if(ArrayBuffer.isView(r))return e&&e.add(r.buffer),r;if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const a of r)i.push(nc(a,e));return i}if(r instanceof Map){const i={$name:"Map",entries:[]};for(const[a,o]of r.entries())i.entries.push(nc(a),nc(o,e));return i}if(r instanceof Set){const i={$name:"Set"};let a=0;for(const o of r.values())i[++a]=nc(o);return i}if(r instanceof DOMMatrix){const i={$name:"DOMMatrix"},a=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const o of a)i[o]=r[o];return i}if(typeof r=="bigint")return{$name:"BigInt",value:r.toString()};if(typeof r=="object"){const i=r.constructor,a=i._classRegistryKey;if(!a)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const o=i.serialize?i.serialize(r,e):{};if(!i.serialize){for(const d in r)r.hasOwnProperty(d)&&(Lu[a].omit.indexOf(d)>=0||(o[d]=nc(r[d],e)));r instanceof Error&&(o.message=r.message)}if(o.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(o.$name=a),o}throw new Error("can't serialize object of type "+typeof r)}function bl(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||Df(r)||vl(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(bl);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const o=r.entries||[],d=new Map;for(let p=0;p<o.length;p+=2)d.set(bl(o[p]),bl(o[p+1]));return d}if(e==="Set"){const o=new Set;for(const d of Object.keys(r))d!=="$name"&&o.add(bl(r[d]));return o}if(e==="DOMMatrix"){let o;return o=r.is2D?[r.a,r.b,r.c,r.d,r.e,r.f]:[r.m11,r.m12,r.m13,r.m14,r.m21,r.m22,r.m23,r.m24,r.m31,r.m32,r.m33,r.m34,r.m41,r.m42,r.m43,r.m44],new DOMMatrix(o)}if(e==="BigInt")return BigInt(r.value);const{klass:i}=Lu[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(r);const a=Object.create(i.prototype);for(const o of Object.keys(r))o!=="$name"&&(a[o]=bl(r[o]));return a}throw new Error("can't deserialize object of type "+typeof r)}const zi={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,Osage:r=>r>=66736&&r<=66815,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function Pf(r){for(const e of r)if(Pd(e.charCodeAt(0)))return!0;return!1}function Up(r){for(const e of r)if(!Dd(e.charCodeAt(0)))return!1;return!0}function Dd(r){return!(zi.Arabic(r)||zi["Arabic Supplement"](r)||zi["Arabic Extended-A"](r)||zi["Arabic Presentation Forms-A"](r)||zi["Arabic Presentation Forms-B"](r))}function Pd(r){return!(r!==746&&r!==747&&(r<4352||!(zi["Bopomofo Extended"](r)||zi.Bopomofo(r)||zi["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||zi["CJK Compatibility Ideographs"](r)||zi["CJK Compatibility"](r)||zi["CJK Radicals Supplement"](r)||zi["CJK Strokes"](r)||!(!zi["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||zi["CJK Unified Ideographs Extension A"](r)||zi["CJK Unified Ideographs"](r)||zi["Enclosed CJK Letters and Months"](r)||zi["Hangul Compatibility Jamo"](r)||zi["Hangul Jamo Extended-A"](r)||zi["Hangul Jamo Extended-B"](r)||zi["Hangul Jamo"](r)||zi["Hangul Syllables"](r)||zi.Hiragana(r)||zi["Ideographic Description Characters"](r)||zi.Kanbun(r)||zi["Kangxi Radicals"](r)||zi["Katakana Phonetic Extensions"](r)||zi.Katakana(r)&&r!==12540||!(!zi["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!zi["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||zi["Unified Canadian Aboriginal Syllabics"](r)||zi["Unified Canadian Aboriginal Syllabics Extended"](r)||zi["Vertical Forms"](r)||zi["Yijing Hexagram Symbols"](r)||zi["Yi Syllables"](r)||zi["Yi Radicals"](r))))}function Of(r){return!(Pd(r)||function(e){return!!(zi["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||zi["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||zi["Letterlike Symbols"](e)||zi["Number Forms"](e)||zi["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||zi["Control Pictures"](e)&&e!==9251||zi["Optical Character Recognition"](e)||zi["Enclosed Alphanumerics"](e)||zi["Geometric Shapes"](e)||zi["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||zi["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||zi["CJK Symbols and Punctuation"](e)||zi.Katakana(e)||zi["Private Use Area"](e)||zi["CJK Compatibility Forms"](e)||zi["Small Form Variants"](e)||zi["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function Gm(r){return zi.Arabic(r)||zi["Arabic Supplement"](r)||zi["Arabic Extended-A"](r)||zi["Arabic Presentation Forms-A"](r)||zi["Arabic Presentation Forms-B"](r)}function Du(r){return r>=1424&&r<=2303||zi["Arabic Presentation Forms-A"](r)||zi["Arabic Presentation Forms-B"](r)}function $m(r,e){return!(!e&&Du(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||zi.Khmer(r))}function jf(r){for(const e of r)if(Du(e.charCodeAt(0)))return!0;return!1}const ha={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Nf=null,Ks=ha.unavailable,sc=null;const Vp=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(Ks=ha.error),Nf&&Nf(r)};function kf(){Bf.fire(new so("pluginStateChange",{pluginStatus:Ks,pluginURL:sc}))}const Bf=new fu,Lh=function(){return Ks},qc=function(){if(Ks!==ha.deferred||!sc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ks=ha.loading,kf(),sc&&ul({url:sc},r=>{r?Vp(r):(Ks=ha.loaded,kf())})},Zo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ks===ha.loaded||Zo.applyArabicShaping!=null,isLoading:()=>Ks===ha.loading,setState(r){Ks=r.pluginStatus,sc=r.pluginURL},isParsing:()=>Ks===ha.parsing,isParsed:()=>Ks===ha.parsed,getPluginURL:()=>sc};class on{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,a){for(const o of i)if(!$m(o.charCodeAt(0),a))return!1;return!0}(e,Zo.isLoaded())}}class Gc{constructor(e,i,a,o,d){this.property=e,this.value=i,this.expression=function(p,x,T,A,M){if(Ch(p))return new Id(p,x);if($o(p)||Array.isArray(p)&&p.length>0){const z=Lf(p,x,T,A,M);if(z.result==="error")throw new Error(z.value.map(D=>`${D.key}: ${D.message}`).join(", "));return z.value}{let z=p;return typeof p=="string"&&x.type==="color"&&(z=$r.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>z}}}(i===void 0?e.specification.default:i,e.specification,a,o,d)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,a,o){return this.property.possiblyEvaluate(this,e,i,a,o)}}class Ff{constructor(e,i,a,o){this.property=e,this.value=new Gc(e,void 0,i,a,o)}transitioned(e,i){return new Wo(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Wo(this.property,this.value,null,{},0)}}class Zm{constructor(e,i,a,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=a,this._iconImageUseTheme=o,this.configDependencies=new Set}getValue(e){return nr(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ff(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Gc(this._values[e].property,i===null?void 0:nr(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const a=this._properties.properties;if(e)for(const o in e){const d=e[o];if(o.endsWith("-transition")){const p=o.slice(0,-11);a[p]&&this.setTransition(p,d)}else a.hasOwnProperty(o)&&this.setValue(o,d)}}getTransition(e){return nr(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ff(this._values[e].property)),this._values[e].transition=nr(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a);const o=this.getTransition(i);o!==void 0&&(e[`${i}-transition`]=o)}return e}transitioned(e,i){const a=new Uf(this._properties);for(const o of Object.keys(this._values))a._values[o]=this._values[o].transitioned(e,i._values[o]);return a}untransitioned(){const e=new Uf(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Wo{constructor(e,i,a,o,d){const p=o.delay||0,x=o.duration||0;d=d||0,this.property=e,this.value=i,this.begin=d+p,this.end=this.begin+x,e.specification.transition&&(o.delay||o.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){const o=e.now||0,d=this.value.possiblyEvaluate(e,i,a),p=this.prior;if(p){if(o>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(o<this.begin)return p.possiblyEvaluate(e,i,a);{const x=(o-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,a),d,me(x))}}return d}}class Uf{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){const o=new Zc(this._properties);for(const d of Object.keys(this._values))o._values[d]=this._values[d].possiblyEvaluate(e,i,a);return o}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class $c{constructor(e,i,a,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=a,this._iconImageUseTheme=o,this.configDependencies=new Set}getValue(e){return nr(this._values[e].value)}setValue(e,i){this._values[e]=new Gc(this._values[e].property,i===null?void 0:nr(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a)}return e}possiblyEvaluate(e,i,a,o){const d=new Zc(this._properties);for(const p of Object.keys(this._values))d._values[p]=this._values[p].possiblyEvaluate(e,i,a,o);return d}}class ac{constructor(e,i,a,o){this.property=e,this.value=i,this.parameters=a,this.iconImageUseTheme=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,a,o){return this.property.evaluate(this.value,this.parameters,e,i,a,o,this.iconImageUseTheme)}}class Zc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Nt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,a){const o=oo[this.specification.type];return o?o(e,i,a):e}}class Yt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,o,d){return e.expression.kind==="constant"||e.expression.kind==="camera"?new ac(this,{kind:"constant",value:e.expression.evaluate(i,null,{},a,o,void 0,d)},i):new ac(this,e.expression,i,d)}interpolate(e,i,a){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new ac(this,{kind:"constant",value:void 0},e.parameters);const o=oo[this.specification.type];return o?new ac(this,{kind:"constant",value:o(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,o,d,p,x){return e.kind==="constant"?e.value:e.evaluate(i,a,o,d,p,void 0,x)}}class Dh{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,o){return!!e.expression.evaluate(i,null,{},a,o)}interpolate(){return!1}}class On{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new on(0,{});for(const a in e){const o=e[a];o.specification.overridable&&this.overridableProperties.push(a);const d=this.defaultPropertyValues[a]=new Gc(o,void 0),p=this.defaultTransitionablePropertyValues[a]=new Ff(o);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate(i)}}}si(Yt,"DataDrivenProperty"),si(Nt,"DataConstantProperty"),si(Dh,"ColorRampProperty");var qe=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Ph(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function wl(r){if(Array.isArray(r))return r.map(wl);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=wl(r[i]);return e}return Ph(r)}function Od(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Od(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Oh(r,e="",i=null,a="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Od(r)||(r=jd(r));const o=r;let d=!0;try{d=function(M){if(!ho(M))return M;let z=wl(M);return da(z),z=Xo(z),z}(o)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(o,null,2)}
        `)}let p=null,x=null;if(a!=="background"&&a!=="sky"&&a!=="slot"){x=qe[`filter_${a}`];const M=uo(d,x,e,i);if(M.result==="error")throw new Error(M.value.map(z=>`${z.key}: ${z.message}`).join(", "));p=(z,D,k)=>M.value.evaluate(z,D,{},k)}let T=null,A=null;if(d!==o){const M=uo(o,x,e,i);if(M.result==="error")throw new Error(M.value.map(z=>`${z.key}: ${z.message}`).join(", "));T=(z,D,k,B,W)=>M.value.evaluate(z,D,{},k,void 0,void 0,B,W),A=!fl(M.value.expression)}return{filter:p,dynamicFilter:T||void 0,needGeometry:Vf(d),needFeature:!!A}}function Xo(r){if(!Array.isArray(r))return r;const e=function(i){if(Wc.has(i[0])){for(let a=1;a<i.length;a++)if(ho(i[a]))return!0}return i}(r);return e===!0?e:e.map(i=>Xo(i))}function da(r){let e=!1;const i=[];if(r[0]==="case"){for(let a=1;a<r.length-1;a+=2)e=e||ho(r[a]),i.push(r[a+1]);i.push(r[r.length-1])}else if(r[0]==="match"){e=e||ho(r[1]);for(let a=2;a<r.length-1;a+=2)i.push(r[a+1]);i.push(r[r.length-1])}else if(r[0]==="step"){e=e||ho(r[1]);for(let a=1;a<r.length-1;a+=2)i.push(r[a+1])}e&&(r.length=0,r.push("any",...i));for(let a=1;a<r.length;a++)da(r[a])}function ho(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<r.length;i++)if(ho(r[i]))return!0;return!1}const Wc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Hp(r,e){return r<e?-1:r>e?1:0}function Vf(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(Vf(r[e]))return!0;return!1}function jd(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Hf(r[1],r[2],"=="):e==="!="?kd(Hf(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Hf(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(jd))):e==="all"?["all"].concat(r.slice(1).map(jd)):e==="none"?["all"].concat(r.slice(1).map(jd).map(kd)):e==="in"?Xc(r[1],r.slice(2)):e==="!in"?kd(Xc(r[1],r.slice(2))):e==="has"?Nd(r[1]):e!=="!has"||kd(Nd(r[1]));var i}function Hf(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function Xc(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",r,["literal",e.sort(Hp)]]:["filter-in-small",r,["literal",e]]}}function Nd(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function kd(r){return["!",r]}const jh="";function Pu(r,e){return e?`${r}${jh}${e}`:r}let Nh;const qp=()=>Nh||(Nh=new On({"icon-size":new Yt(qe.layout_symbol["icon-size"]),"icon-image":new Yt(qe.layout_symbol["icon-image"]),"icon-rotate":new Yt(qe.layout_symbol["icon-rotate"]),"icon-offset":new Yt(qe.layout_symbol["icon-offset"])}));class Gp{constructor(e,i,a,o,d,p){const x=uo(e,qe.appearance.condition);if(x.result==="success"&&(this.condition=x.value),this.name=i,a){this.properties=new Zc(qp()),this.unevaluatedLayout=new $c(qp(),o,d,p);for(const T in a)this.unevaluatedLayout.setValue(T,a[T])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.properties&&(e.properties=this.properties),e}}const $p="-transition",Zp=new Set(["fill","line","background","hillshade","raster"]);class fa extends fu{constructor(e,i,a,o,d,p){if(super(),this.id=e.id,this.fqid=Pu(this.id,a),this.type=e.type,this.scope=a,this.lut=o,this.options=d,this.iconImageUseTheme=p,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const x=uo(this.filter,qe[`filter_${e.type}`]);x.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...x.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),e.appearances&&e.appearances.forEach(x=>{this.appearances.push(new Gp(x.condition,x.name,x.properties,this.scope,d,this.iconImageUseTheme))}),i.layout&&(this._unevaluatedLayout=new $c(i.layout,this.scope,d,this.iconImageUseTheme),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new Zm(i.paint,this.scope,d);for(const x in e.paint)this.setPaintProperty(x,e.paint[x]);for(const x in e.layout)this.setLayoutProperty(x,e.layout[x]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Zc(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Zp.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith($p)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const a=this._transitionablePaint,o=a._properties.properties;if(e.endsWith($p)){const z=e.slice(0,-11);return o[z]&&a.setTransition(z,i||void 0),!1}if(!o[e])return!1;const d=a._values[e],p=d.value.isDataDriven(),x=d.value;a.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const T=a._values[e].value,A=T.isDataDriven(),M=e.endsWith("pattern")||e==="line-dasharray";return A||p||M||this._handleOverridablePaintPropertyUpdate(e,x,T)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,a){return null}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(i=>i.serialize())),lr(e,(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof ac&&Ah(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Oh(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRadius(e){}queryIntersectsFeature(e,i,a,o,d,p,x,T,A){}}const oc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class gs{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Lr{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function xr(r,e=1){let i=0,a=0;return{members:r.map(o=>{const d=oc[o.type].BYTES_PER_ELEMENT,p=i=Wp(i,Math.max(e,d)),x=o.components||1;return a=Math.max(a,d),i+=d*x,{name:o.name,type:o.type,components:x,offset:p}}),size:Wp(i,Math.max(a,e)),alignment:e}}function Wp(r,e){return Math.ceil(r/e)*e}class lc extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const o=2*e;return this.int16[o+0]=i,this.int16[o+1]=a,e}}lc.prototype.bytesPerElement=4,si(lc,"StructArrayLayout2i4");class Yc extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,i,a)}emplace(e,i,a,o){const d=3*e;return this.int16[d+0]=i,this.int16[d+1]=a,this.int16[d+2]=o,e}}Yc.prototype.bytesPerElement=6,si(Yc,"StructArrayLayout3i6");class Kc extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,o){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,o)}emplace(e,i,a,o,d){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=a,this.int16[p+2]=o,this.int16[p+3]=d,e}}Kc.prototype.bytesPerElement=8,si(Kc,"StructArrayLayout4i8");class Ro extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Ro.prototype.bytesPerElement=4,si(Ro,"StructArrayLayout1f4");class Bd extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,i,a)}emplace(e,i,a,o){const d=4*e,p=2*e;return this.int16[d+0]=i,this.int16[d+1]=a,this.float32[p+1]=o,e}}Bd.prototype.bytesPerElement=8,si(Bd,"StructArrayLayout2i1f8");class Fd extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,i,a)}emplace(e,i,a,o){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=a,this.int16[d+2]=o,e}}Fd.prototype.bytesPerElement=8,si(Fd,"StructArrayLayout3i8");class qf extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,o,d)}emplace(e,i,a,o,d,p){const x=5*e;return this.int16[x+0]=i,this.int16[x+1]=a,this.int16[x+2]=o,this.int16[x+3]=d,this.int16[x+4]=p,e}}qf.prototype.bytesPerElement=10,si(qf,"StructArrayLayout5i10");class Ud extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,a,o,d,p,x)}emplace(e,i,a,o,d,p,x,T){const A=6*e,M=12*e,z=3*e;return this.int16[A+0]=i,this.int16[A+1]=a,this.uint8[M+4]=o,this.uint8[M+5]=d,this.uint8[M+6]=p,this.uint8[M+7]=x,this.float32[z+2]=T,e}}Ud.prototype.bytesPerElement=12,si(Ud,"StructArrayLayout2i4ub1f12");class pa extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,i,a)}emplace(e,i,a,o){const d=3*e;return this.float32[d+0]=i,this.float32[d+1]=a,this.float32[d+2]=o,e}}pa.prototype.bytesPerElement=12,si(pa,"StructArrayLayout3f12");class Tl extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,o,d)}emplace(e,i,a,o,d,p){const x=6*e,T=3*e;return this.uint16[x+0]=i,this.uint16[x+1]=a,this.uint16[x+2]=o,this.uint16[x+3]=d,this.float32[T+2]=p,e}}Tl.prototype.bytesPerElement=12,si(Tl,"StructArrayLayout4ui1f12");class Jc extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,o){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,o)}emplace(e,i,a,o,d){const p=4*e;return this.uint16[p+0]=i,this.uint16[p+1]=a,this.uint16[p+2]=o,this.uint16[p+3]=d,e}}Jc.prototype.bytesPerElement=8,si(Jc,"StructArrayLayout4ui8");class Vd extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,o,d,p)}emplace(e,i,a,o,d,p,x){const T=6*e;return this.int16[T+0]=i,this.int16[T+1]=a,this.int16[T+2]=o,this.int16[T+3]=d,this.int16[T+4]=p,this.int16[T+5]=x,e}}Vd.prototype.bytesPerElement=12,si(Vd,"StructArrayLayout6i12");class Hd extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,x,T,A,M,z,D){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,a,o,d,p,x,T,A,M,z,D)}emplace(e,i,a,o,d,p,x,T,A,M,z,D,k){const B=12*e;return this.int16[B+0]=i,this.int16[B+1]=a,this.int16[B+2]=o,this.int16[B+3]=d,this.uint16[B+4]=p,this.uint16[B+5]=x,this.uint16[B+6]=T,this.uint16[B+7]=A,this.int16[B+8]=M,this.int16[B+9]=z,this.int16[B+10]=D,this.int16[B+11]=k,e}}Hd.prototype.bytesPerElement=24,si(Hd,"StructArrayLayout4i4ui4i24");class qd extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,o,d,p)}emplace(e,i,a,o,d,p,x){const T=10*e,A=5*e;return this.int16[T+0]=i,this.int16[T+1]=a,this.int16[T+2]=o,this.float32[A+2]=d,this.float32[A+3]=p,this.float32[A+4]=x,e}}qd.prototype.bytesPerElement=20,si(qd,"StructArrayLayout3i3f20");class fo extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,o)}emplace(e,i,a,o,d){const p=4*e;return this.float32[p+0]=i,this.float32[p+1]=a,this.float32[p+2]=o,this.float32[p+3]=d,e}}fo.prototype.bytesPerElement=16,si(fo,"StructArrayLayout4f16");class Ou extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Ou.prototype.bytesPerElement=4,si(Ou,"StructArrayLayout1ul4");class rs extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const o=2*e;return this.uint16[o+0]=i,this.uint16[o+1]=a,e}}rs.prototype.bytesPerElement=4,si(rs,"StructArrayLayout2ui4");class ju extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,x,T,A,M,z,D,k){const B=this.length;return this.resize(B+1),this.emplace(B,e,i,a,o,d,p,x,T,A,M,z,D,k)}emplace(e,i,a,o,d,p,x,T,A,M,z,D,k,B){const W=20*e,Y=10*e;return this.int16[W+0]=i,this.int16[W+1]=a,this.int16[W+2]=o,this.int16[W+3]=d,this.int16[W+4]=p,this.float32[Y+3]=x,this.float32[Y+4]=T,this.float32[Y+5]=A,this.float32[Y+6]=M,this.int16[W+14]=z,this.uint32[Y+8]=D,this.uint16[W+18]=k,this.uint16[W+19]=B,e}}ju.prototype.bytesPerElement=40,si(ju,"StructArrayLayout5i4f1i1ul2ui40");class Mo extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,a,o,d,p,x)}emplace(e,i,a,o,d,p,x,T){const A=8*e;return this.int16[A+0]=i,this.int16[A+1]=a,this.int16[A+2]=o,this.int16[A+4]=d,this.int16[A+5]=p,this.int16[A+6]=x,this.int16[A+7]=T,e}}Mo.prototype.bytesPerElement=16,si(Mo,"StructArrayLayout3i2i2i16");class Gd extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,o,d)}emplace(e,i,a,o,d,p){const x=4*e,T=8*e;return this.float32[x+0]=i,this.float32[x+1]=a,this.float32[x+2]=o,this.int16[T+6]=d,this.int16[T+7]=p,e}}Gd.prototype.bytesPerElement=16,si(Gd,"StructArrayLayout2f1f2i16");class Xp extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,o,d,p)}emplace(e,i,a,o,d,p,x){const T=20*e,A=5*e;return this.uint8[T+0]=i,this.uint8[T+1]=a,this.float32[A+1]=o,this.float32[A+2]=d,this.float32[A+3]=p,this.float32[A+4]=x,e}}Xp.prototype.bytesPerElement=20,si(Xp,"StructArrayLayout2ub4f20");class cs extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,i,a)}emplace(e,i,a,o){const d=3*e;return this.uint16[d+0]=i,this.uint16[d+1]=a,this.uint16[d+2]=o,e}}cs.prototype.bytesPerElement=6,si(cs,"StructArrayLayout3ui6");class Nu extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,x,T,A,M,z,D,k,B,W,Y,K,ne,se,he,Re){const Me=this.length;return this.resize(Me+1),this.emplace(Me,e,i,a,o,d,p,x,T,A,M,z,D,k,B,W,Y,K,ne,se,he,Re)}emplace(e,i,a,o,d,p,x,T,A,M,z,D,k,B,W,Y,K,ne,se,he,Re,Me){const Ne=30*e,Fe=15*e,Ue=60*e;return this.int16[Ne+0]=i,this.int16[Ne+1]=a,this.int16[Ne+2]=o,this.float32[Fe+2]=d,this.float32[Fe+3]=p,this.uint16[Ne+8]=x,this.uint16[Ne+9]=T,this.uint32[Fe+5]=A,this.uint32[Fe+6]=M,this.uint32[Fe+7]=z,this.uint16[Ne+16]=D,this.uint16[Ne+17]=k,this.uint16[Ne+18]=B,this.float32[Fe+10]=W,this.float32[Fe+11]=Y,this.uint8[Ue+48]=K,this.uint8[Ue+49]=ne,this.uint8[Ue+50]=se,this.uint32[Fe+13]=he,this.int16[Ne+28]=Re,this.uint8[Ue+58]=Me,e}}Nu.prototype.bytesPerElement=60,si(Nu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class cc extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,x,T,A,M,z,D,k,B,W,Y,K,ne,se,he,Re,Me,Ne,Fe,Ue,ft,$e,yt,It,bt,Et,jt,ht){const At=this.length;return this.resize(At+1),this.emplace(At,e,i,a,o,d,p,x,T,A,M,z,D,k,B,W,Y,K,ne,se,he,Re,Me,Ne,Fe,Ue,ft,$e,yt,It,bt,Et,jt,ht)}emplace(e,i,a,o,d,p,x,T,A,M,z,D,k,B,W,Y,K,ne,se,he,Re,Me,Ne,Fe,Ue,ft,$e,yt,It,bt,Et,jt,ht,At){const at=20*e,et=40*e,kt=80*e;return this.float32[at+0]=i,this.float32[at+1]=a,this.int16[et+4]=o,this.int16[et+5]=d,this.int16[et+6]=p,this.int16[et+7]=x,this.int16[et+8]=T,this.int16[et+9]=A,this.int16[et+10]=M,this.int16[et+11]=z,this.int16[et+12]=D,this.uint16[et+13]=k,this.uint16[et+14]=B,this.uint16[et+15]=W,this.uint16[et+16]=Y,this.uint16[et+17]=K,this.uint16[et+18]=ne,this.uint16[et+19]=se,this.uint16[et+20]=he,this.uint16[et+21]=Re,this.uint16[et+22]=Me,this.uint16[et+23]=Ne,this.uint16[et+24]=Fe,this.uint16[et+25]=Ue,this.uint16[et+26]=ft,this.uint16[et+27]=$e,this.uint32[at+14]=yt,this.float32[at+15]=It,this.float32[at+16]=bt,this.float32[at+17]=Et,this.float32[at+18]=jt,this.uint8[kt+76]=ht,this.uint16[et+39]=At,e}}cc.prototype.bytesPerElement=80,si(cc,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class po extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,o,d,p)}emplace(e,i,a,o,d,p,x){const T=6*e;return this.float32[T+0]=i,this.float32[T+1]=a,this.float32[T+2]=o,this.float32[T+3]=d,this.float32[T+4]=p,this.float32[T+5]=x,e}}po.prototype.bytesPerElement=24,si(po,"StructArrayLayout6f24");class Ka extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,o,d)}emplace(e,i,a,o,d,p){const x=5*e;return this.float32[x+0]=i,this.float32[x+1]=a,this.float32[x+2]=o,this.float32[x+3]=d,this.float32[x+4]=p,e}}Ka.prototype.bytesPerElement=20,si(Ka,"StructArrayLayout5f20");class Yo extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,a,o,d,p,x)}emplace(e,i,a,o,d,p,x,T){const A=7*e;return this.float32[A+0]=i,this.float32[A+1]=a,this.float32[A+2]=o,this.float32[A+3]=d,this.float32[A+4]=p,this.float32[A+5]=x,this.float32[A+6]=T,e}}Yo.prototype.bytesPerElement=28,si(Yo,"StructArrayLayout7f28");class kh extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,x,T,A,M,z){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,a,o,d,p,x,T,A,M,z)}emplace(e,i,a,o,d,p,x,T,A,M,z,D){const k=11*e;return this.float32[k+0]=i,this.float32[k+1]=a,this.float32[k+2]=o,this.float32[k+3]=d,this.float32[k+4]=p,this.float32[k+5]=x,this.float32[k+6]=T,this.float32[k+7]=A,this.float32[k+8]=M,this.float32[k+9]=z,this.float32[k+10]=D,e}}kh.prototype.bytesPerElement=44,si(kh,"StructArrayLayout11f44");class ku extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,x,T,A){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,a,o,d,p,x,T,A)}emplace(e,i,a,o,d,p,x,T,A,M){const z=9*e;return this.float32[z+0]=i,this.float32[z+1]=a,this.float32[z+2]=o,this.float32[z+3]=d,this.float32[z+4]=p,this.float32[z+5]=x,this.float32[z+6]=T,this.float32[z+7]=A,this.float32[z+8]=M,e}}ku.prototype.bytesPerElement=36,si(ku,"StructArrayLayout9f36");class Sl extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const o=2*e;return this.float32[o+0]=i,this.float32[o+1]=a,e}}Sl.prototype.bytesPerElement=8,si(Sl,"StructArrayLayout2f8");class Bu extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,o){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,o)}emplace(e,i,a,o,d){const p=6*e;return this.uint32[3*e+0]=i,this.uint16[p+2]=a,this.uint16[p+3]=o,this.uint16[p+4]=d,e}}Bu.prototype.bytesPerElement=12,si(Bu,"StructArrayLayout1ul3ui12");class El extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}El.prototype.bytesPerElement=2,si(El,"StructArrayLayout1ui2");class Js extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,x,T,A,M,z,D,k,B,W,Y){const K=this.length;return this.resize(K+1),this.emplace(K,e,i,a,o,d,p,x,T,A,M,z,D,k,B,W,Y)}emplace(e,i,a,o,d,p,x,T,A,M,z,D,k,B,W,Y,K){const ne=16*e;return this.float32[ne+0]=i,this.float32[ne+1]=a,this.float32[ne+2]=o,this.float32[ne+3]=d,this.float32[ne+4]=p,this.float32[ne+5]=x,this.float32[ne+6]=T,this.float32[ne+7]=A,this.float32[ne+8]=M,this.float32[ne+9]=z,this.float32[ne+10]=D,this.float32[ne+11]=k,this.float32[ne+12]=B,this.float32[ne+13]=W,this.float32[ne+14]=Y,this.float32[ne+15]=K,e}}Js.prototype.bytesPerElement=64,si(Js,"StructArrayLayout16f64");class uc extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,a,o,d,p,x)}emplace(e,i,a,o,d,p,x,T){const A=10*e,M=5*e;return this.uint16[A+0]=i,this.uint16[A+1]=a,this.uint16[A+2]=o,this.uint16[A+3]=d,this.float32[M+2]=p,this.float32[M+3]=x,this.float32[M+4]=T,e}}uc.prototype.bytesPerElement=20,si(uc,"StructArrayLayout4ui3f20");class Fu extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Fu.prototype.bytesPerElement=2,si(Fu,"StructArrayLayout1i2");class Ko extends Lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Ko.prototype.bytesPerElement=1,si(Ko,"StructArrayLayout1ub1");class Gf extends gs{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Gf.prototype.size=40;class $d extends ju{get(e){return new Gf(this,e)}}si($d,"CollisionBoxArray");class hc extends gs{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}hc.prototype.size=60;class Jo extends Nu{get(e){return new hc(this,e)}}si(Jo,"PlacedSymbolArray");class Bh extends gs{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Bh.prototype.size=80;class $f extends cc{get(e){return new Bh(this,e)}}si($f,"SymbolInstanceArray");class Zf extends Ro{getoffsetX(e){return this.float32[1*e+0]}}si(Zf,"GlyphOffsetArray");class Fh extends lc{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}si(Fh,"SymbolLineVertexArray");class Uu extends gs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Uu.prototype.size=12;class Yp extends Bu{get(e){return new Uu(this,e)}}si(Yp,"FeatureIndexArray");class Kp extends rs{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}si(Kp,"FillExtrusionCentroidArray");class Uh extends gs{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Uh.prototype.size=6;class dc extends Yc{get(e){return new Uh(this,e)}}si(dc,"FillExtrusionWallArray");const Wm=xr([{name:"a_pos",components:2,type:"Int16"}],4),Xm=xr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Vu=xr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Wr{constructor(e=[]){this.segments=e}_prepareSegment(e,i,a,o){let d=this.segments[this.segments.length-1];return e>Wr.MAX_VERTEX_ARRAY_LENGTH&&ur(`Max vertices per segment is ${Wr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>Wr.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==o)&&(d={vertexOffset:i,primitiveOffset:a,vertexLength:0,primitiveLength:0},o!==void 0&&(d.sortKey=o),this.segments.push(d)),d}prepareSegment(e,i,a,o){return this._prepareSegment(e,i.length,a.length,o)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,o){return new Wr([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:o,vaos:{},sortKey:0}])}}function Vh(r,e){return 256*(r=Ie(Math.floor(r),0,255))+Ie(Math.floor(e),0,255)}Wr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,si(Wr,"SegmentVector");const Ym=xr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Km=xr([{name:"a_pattern_b",components:4,type:"Uint16"}]),Hh=xr([{name:"a_dash",components:4,type:"Uint16"}]);class Hu{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,a,o){this.ids.push(qh(e)),this.positions.push(i,a,o)}eachPosition(e,i){const a=qh(e);let o=0,d=this.ids.length-1;for(;o<d;){const p=o+d>>1;this.ids[p]>=a?d=p:o=p+1}for(;this.ids[o]===a;)i(this.positions[3*o],this.positions[3*o+1],this.positions[3*o+2]),o++}static serialize(e,i){const a=new Float64Array(e.ids),o=new Uint32Array(e.positions);return Qo(a,o,0,a.length-1),i&&(i.add(a.buffer),i.add(o.buffer)),{ids:a,positions:o}}static deserialize(e){const i=new Hu;let a;i.ids=e.ids,i.positions=e.positions;for(const o of i.ids)o!==a&&i.uniqueIds.push(o),a=o;return i.indexed=!0,i}}function qh(r){const e=+r;return Number.isSafeInteger(e)?e:dh(String(r))}function Qo(r,e,i,a){for(;i<a;){const o=r[i+a>>1];let d=i-1,p=a+1;for(;;){do d++;while(r[d]<o);do p--;while(r[p]>o);if(d>=p)break;ns(r,d,p),ns(e,3*d,3*p),ns(e,3*d+1,3*p+1),ns(e,3*d+2,3*p+2)}p-i<a-p?(Qo(r,e,i,p),i=p+1):(Qo(r,e,p+1,a),a=p)}}function ns(r,e,i){const a=r[e];r[e]=r[i],r[i]=a}si(Hu,"FeaturePositionMap");class Io{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Gh extends Io{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class Jr extends Io{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class el extends Io{constructor(e){super(e),this.current=[0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class Zd extends Io{constructor(e){super(e),this.current=[0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class $h extends Io{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class Jp extends Io{constructor(e){super(e),this.current=$r.transparent.toPremultipliedRenderColor(null)}set(e,i,a){this.fetchUniformLocation(e,i)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const js=new Float32Array(16);class ma extends Io{constructor(e){super(e),this.current=js}set(e,i,a){if(this.fetchUniformLocation(e,i)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let o=1;o<16;o++)if(a[o]!==this.current[o]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const fc=new Float32Array(9),Jm=new Float32Array(4);class Wd extends Io{constructor(e){super(e),this.current=Jm}set(e,i,a){if(this.fetchUniformLocation(e,i)){for(let o=0;o<4;o++)if(a[o]!==this.current[o]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function Xd(r){return[Vh(255*r.r,255*r.g),Vh(255*r.b,255*r.a)]}class Va{constructor(e,i,a,o){this.value=e,this.uniformNames=i.map(d=>`u_${d}`),this.type=a,this.context=o}setUniform(e,i,a,o,d){const p=o.constantOr(this.value);i.set(e,d,p instanceof $r?p.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):p)}getBinding(e,i){return this.type==="color"?new Jp(e):new Jr(e)}}class Qs{constructor(e,i){this.uniformNames=i.map(a=>`u_${a}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,a,o,d){let p=null;d!=="u_pattern"&&d!=="u_dash"||(p=this.pattern),d==="u_pattern_b"&&(p=this.patternTransition),d==="u_pixel_ratio"&&(p=this.pixelRatio),p&&i.set(e,d,p)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new $h(e):new Jr(e)}}class ea{constructor(e,i,a,o){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new o}populatePaintArray(e,i,a,o,d,p,x,T){const A=this.paintVertexArray.length,M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new on(0,{brightness:p,worldview:T}),i,{},d,o,x):this.expression.kind==="constant"&&this.expression.value,z=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new on(0,{brightness:p,worldview:T}),i,{},d,o,x):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(A,e,M,z?null:this.context.lut)}updatePaintArray(e,i,a,o,d,p,x,T){const A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:x,worldview:T},a,o,void 0,d):this.expression.kind==="constant"&&this.expression.value,M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new on(0,{brightness:x,worldview:T}),a,o,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(e,i,A,M?null:this.context.lut)}_setPaintValue(e,i,a,o){if(this.type==="color"){const d=Xd(a.toPremultipliedRenderColor(o));for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,d[0],d[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Al{constructor(e,i,a,o,d,p){this.expression=e,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=a,this.useIntegerZoom=o,this.context=d,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,i,a,o,d,p,x,T){const A=this.expression.evaluate(new on(this.context.zoom,{brightness:p,worldview:T}),i,{},d,o,x),M=this.expression.evaluate(new on(this.context.zoom+1,{brightness:p,worldview:T}),i,{},d,o,x),z=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new on(0,{brightness:p,worldview:T}),i,{},d,o,x):this.lutExpression.value)==="none",D=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(D,e,A,M,z?null:this.context.lut)}updatePaintArray(e,i,a,o,d,p,x,T){const A=this.expression.evaluate({zoom:this.context.zoom,brightness:x,worldview:T},a,o,void 0,d),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x,worldview:T},a,o,void 0,d),z=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new on(0,{brightness:x,worldview:T}),a,o,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(e,i,A,M,z?null:this.context.lut)}_setPaintValue(e,i,a,o,d){if(this.type==="color"){const p=Xd(a.toPremultipliedRenderColor(d)),x=Xd(a.toPremultipliedRenderColor(d));for(let T=e;T<i;T++)this.paintVertexArray.emplace(T,p[0],p[1],x[0],x[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,a,o);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,a,o,d){const p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,x=Ie(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);i.set(e,d,x)}getBinding(e,i){return new Jr(e)}}class Ns{constructor(e,i,a,o,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(a==="array"?Hh:Ym).members;for(let p=0;p<i.length;++p);this.paintVertexArray=new o,this.paintTransitionVertexArray=new Jc}populatePaintArray(e,i,a,o){const d=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(d,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,o,d,p,x){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,i,a,o){if(!o||!a)return;const d=o[a[0]],p=o[a[1]];if(d){if(d){const{tl:x,br:T,pixelRatio:A}=d;for(let M=e;M<i;M++)this.paintVertexArray.emplace(M,x[0],x[1],T[0],T[1],A)}if(p){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:x,br:T}=p;for(let A=e;A<i;A++)this.paintTransitionVertexArray.emplace(A,x[0],x[1],T[0],T[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Km.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Qc{constructor(e,i,a=()=>!0){this.binders={},this._buffers=[],this.context=i;const o=[];for(const d in e.paint._values){const p=e.paint.get(d);if(d.endsWith("-use-theme")||!a(d)||!(p instanceof ac&&Ah(p.property.specification)))continue;const x=Gu(d,e.type),T=p.value,A=p.property.specification.type,M=!!p.property.useIntegerZoom,z=d==="line-dasharray"||d.endsWith("pattern"),D=e.paint.get(`${d}-use-theme`),k=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||D&&D.value.kind!=="constant";if(T.kind!=="constant"||k)if(T.kind==="source"||k||z){const B=n(d,A,"source");this.binders[d]=z?new Ns(T,x,A,B,e.id):new ea(T,x,A,B),o.push(`/a_${d}`)}else{const B=n(d,A,"composite");this.binders[d]=new Al(T,x,A,M,i,B),o.push(`/z_${d}`)}else this.binders[d]=z?new Qs(T.value,x):new Va(T.value,x,A,i),o.push(`/u_${d}`);D&&(this.binders[d].lutExpression=D.value)}this.cacheKey=o.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof ea||i instanceof Al?i.maxValue:0}populatePaintArrays(e,i,a,o,d,p,x,T){for(const A in this.binders){const M=this.binders[A];M.context=this.context,(M instanceof ea||M instanceof Al||M instanceof Ns)&&M.populatePaintArray(e,i,a,o,d,p,x,T)}}setConstantPatternPositions(e,i){for(const a in this.binders){const o=this.binders[a];o instanceof Qs&&o.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof Ns?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,a,o,d,p,x,T,A,M){let z=!1;const D=Object.keys(e),k=D.length!==0&&!T,B=k?D:i.uniqueIds;this.context.lut=d.lut;for(const W in this.binders){const Y=this.binders[W];if(Y.context=this.context,(Y instanceof ea||Y instanceof Al||Y instanceof Ns)&&Y.expression&&Y.expression.kind&&Y.expression.kind!=="constant"&&(Y.expression.isStateDependent===!0||Y.expression.isLightConstant===!1)){const K=d.paint.get(W);Y.expression=K.value;for(const ne of B){const se=e[ne.toString()];i.eachPosition(ne,(he,Re,Me)=>{const Ne=o.feature(he);Y.updatePaintArray(Re,Me,Ne,se,p,x,A,M)})}if(!k)for(const ne of a.uniqueIds){const se=e[ne.toString()];a.eachPosition(ne,(he,Re,Me)=>{const Ne=o.feature(he);Y.updatePaintArray(Re,Me,Ne,se,p,x,A,M)})}z=!0}}return z}defines(){const e=[];for(const i in this.binders){const a=this.binders[i];(a instanceof Va||a instanceof Qs)&&e.push(...a.uniformNames.map(o=>`#define HAS_UNIFORM_${o}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const a in this.binders){const o=this.binders[a];if(o instanceof Va||o instanceof Qs||o instanceof Al)for(const d of o.uniformNames)i.push({name:d,property:a,binding:o.getBinding(e,d)})}return i}setUniforms(e,i,a,o,d){for(const{name:p,property:x,binding:T}of a)this.binders[x].setUniform(e,T,d,o.get(x),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof ea||i instanceof Al||i instanceof Ns)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof Ns&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const a=this.binders[i];(a instanceof ea||a instanceof Al||a instanceof Ns)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof ea||i instanceof Al||i instanceof Ns)&&i.destroy()}}}class $s{constructor(e,i,a=()=>!0){this.programConfigurations={};for(const o of e)this.programConfigurations[o.id]=new Qc(o,i,a);this.needsUpload=!1,this._featureMap=new Hu,this._featureMapWithoutIds=new Hu,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,a,o,d,p,x,T,A){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(e,i,o,d,p,x,T,A);i.id!==void 0?this._featureMap.add(i.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,o,d,p,x,T){for(const A of a)this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,A,o,d,p,x||0,T)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const qu={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Gu(r,e){return qu[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const u={"line-pattern":{source:Tl,composite:Tl},"fill-pattern":{source:Tl,composite:Tl},"fill-extrusion-pattern":{source:Tl,composite:Tl},"line-dasharray":{source:Jc,composite:Jc}},t={color:{source:Sl,composite:fo},number:{source:Ro,composite:Sl}};function n(r,e,i){const a=u[r];return a&&a[i]||t[e][i]}si(Va,"ConstantBinder"),si(Qs,"PatternConstantBinder"),si(ea,"SourceExpressionBinder"),si(Ns,"PatternCompositeBinder"),si(Al,"CompositeExpressionBinder"),si(Qc,"ProgramConfiguration",{omit:["_buffers"]}),si($s,"ProgramConfigurationSet");const c=Vt/Math.PI/2,m=5,y=6,w=16383,E=64,R=[E,32,16],L=-c,P=c;function F(r,e,i,a=c){return i=He(i),[r*Math.sin(i)*a,-e*a,r*Math.cos(i)*a]}function j(r,e,i){return F(Math.cos(He(r)),Math.sin(He(r)),e,i)}const H=63710088e-1,$=2*Math.PI*H;class G{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new G(Be(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,a=this.lat*i,o=e.lat*i,d=Math.sin(a)*Math.sin(o)+Math.cos(a)*Math.cos(o)*Math.cos((e.lng-this.lng)*i);return H*Math.acos(Math.min(d,1))}toBounds(e=0){const i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new te({lng:this.lng-a,lat:this.lat-i},{lng:this.lng+a,lat:this.lat+i})}toEcef(e){return j(this.lat,this.lng,c+e*c/H)}static convert(e){if(e instanceof G)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new G(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new G(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class te{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof G?new G(e.lng,e.lat):G.convert(e),this}setSouthWest(e){return this._sw=e instanceof G?new G(e.lng,e.lat):G.convert(e),this}extend(e){const i=this._sw,a=this._ne;let o,d;if(e instanceof G)o=e,d=e;else{if(!(e instanceof te))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(te.convert(e)):this.extend(G.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(G.convert(e)):this;if(o=e._sw,d=e._ne,!o||!d)return this}return i||a?(i.lng=Math.min(o.lng,i.lng),i.lat=Math.min(o.lat,i.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new G(o.lng,o.lat),this._ne=new G(d.lng,d.lat)),this}getCenter(){return new G((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new G(this.getWest(),this.getNorth())}getSouthEast(){return new G(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=G.convert(e);let o=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(o=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&o}static convert(e){if(e)return e instanceof te?e:new te(e)}}const X=0,re=25.5;function ce(r){return $*Math.cos(r*Math.PI/180)}function fe(r){return(180+r)/360}function Te(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function we(r,e){return r/ce(e)}function Ee(r){return 360*r-180}function ve(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function be(r,e){return r*ce(ve(e))}const Ce=85.051129;function We(r){return Math.cos(He(Ie(r,-85.051129,Ce)))}function ke(r,e){const i=Ie(e,X,re),a=Math.pow(2,i);return We(r)*$/(512*a)}function ct(r){return 1/Math.cos(r*Math.PI/180)}function Ze(r,e=0){const i=Math.exp(Math.PI*(1-(r.y+e/Vt)/(1<<r.z)*2));return 80150034*i/(i*i+1)/Vt/(1<<r.z)}class ot{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){const a=G.convert(e);return new ot(fe(a.lng),Te(a.lat),we(i,a.lat))}toLngLat(){return new G(Ee(this.x),ve(this.y))}toAltitude(){return be(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/$*ct(ve(this.y))}}function Bt(r,e,i,a,o,d,p,x,T){const A=(e+a)/2,M=(i+o)/2,z=new Ct(A,M);x(z),function(D,k,B,W,Y,K){const ne=B-Y,se=W-K;return Math.abs((W-k)*ne-(B-D)*se)/Math.hypot(ne,se)}(z.x,z.y,d.x,d.y,p.x,p.y)>=T?(Bt(r,e,i,A,M,d,z,x,T),Bt(r,A,M,a,o,z,p,x,T)):r.push(p)}function Ye(r,e,i){let a=r[0],o=a.x,d=a.y;e(a);const p=[a];for(let x=1;x<r.length;x++){const T=r[x],{x:A,y:M}=T;e(T),Bt(p,o,d,A,M,a,T,e,i),o=A,d=M,a=T}return p}function Oe(r,e,i,a){if(a(e,i)){const o=e.add(i)._mult(.5);Oe(r,e,o,a),Oe(r,o,i,a)}else r.push(i)}function nt(r,e){let i=r[0];const a=[i];for(let o=1;o<r.length;o++){const d=r[o];Oe(a,i,d,e),i=d}return a}const Ge=Math.pow(2,14)-1,ut=-Ge-1;function _t(r,e){const i=Math.round(r.x*e),a=Math.round(r.y*e);return r.x=Ie(i,ut,Ge),r.y=Ie(a,ut,Ge),(i<r.x||i>r.x+1||a<r.y||a>r.y+1)&&ur("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function $t(r,e,i){const a=r.loadGeometry(),o=r.extent,d=Vt/o;if(e&&i&&i.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:x,x:T,y:A,projection:M}=i,z=D=>{const k=Ee((e.x+D.x/o)/p),B=ve((e.y+D.y/o)/p),W=M.project(k,B);D.x=(W.x*x-T)*o,D.y=(W.y*x-A)*o};for(let D=0;D<a.length;D++)if(r.type!==1)a[D]=Ye(a[D],z,1);else{const k=[];for(const B of a[D])B.x<0||B.x>=o||B.y<0||B.y>=o||(z(B),k.push(B));a[D]=k}}for(const p of a)for(const x of p)_t(x,d);return a}function Rt(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?$t(r):[]}}class St{constructor(e,i,a,o,d){this.properties={},this.extent=a,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=o,this._values=d,e.readFields(gi,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,a=[];let o,d=1,p=0,x=0,T=0;for(;e.pos<i;){if(p<=0){const A=e.readVarint();d=7&A,p=A>>3}if(p--,d===1||d===2)x+=e.readSVarint(),T+=e.readSVarint(),d===1&&(o&&a.push(o),o=[]),o&&o.push(new Ct(x,T));else{if(d!==7)throw new Error(`unknown command ${d}`);o&&o.push(o[0].clone())}}return o&&a.push(o),a}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let a=1,o=0,d=0,p=0,x=1/0,T=-1/0,A=1/0,M=-1/0;for(;e.pos<i;){if(o<=0){const z=e.readVarint();a=7&z,o=z>>3}if(o--,a===1||a===2)d+=e.readSVarint(),p+=e.readSVarint(),d<x&&(x=d),d>T&&(T=d),p<A&&(A=p),p>M&&(M=p);else if(a!==7)throw new Error(`unknown command ${a}`)}return[x,A,T,M]}toGeoJSON(e,i,a){const o=this.extent*Math.pow(2,a),d=this.extent*e,p=this.extent*i,x=this.loadGeometry();function T(D){return[360*(D.x+d)/o-180,360/Math.PI*Math.atan(Math.exp((1-2*(D.y+p)/o)*Math.PI))-90]}function A(D){return D.map(T)}let M;if(this.type===1){const D=[];for(const B of x)D.push(B[0]);const k=A(D);M=D.length===1?{type:"Point",coordinates:k[0]}:{type:"MultiPoint",coordinates:k}}else if(this.type===2){const D=x.map(A);M=D.length===1?{type:"LineString",coordinates:D[0]}:{type:"MultiLineString",coordinates:D}}else{if(this.type!==3)throw new Error("unknown feature type");{const D=function(B){const W=B.length;if(W<=1)return[B];const Y=[];let K,ne;for(let se=0;se<W;se++){const he=li(B[se]);he!==0&&(ne===void 0&&(ne=he<0),ne===he<0?(K&&Y.push(K),K=[B[se]]):K&&K.push(B[se]))}return K&&Y.push(K),Y}(x),k=[];for(const B of D)k.push(B.map(A));M=k.length===1?{type:"Polygon",coordinates:k[0]}:{type:"MultiPolygon",coordinates:k}}}const z={type:"Feature",geometry:M,properties:this.properties};return this.id!=null&&(z.id=this.id),z}}function gi(r,e,i){r===1?e.id=i.readVarint():r===2?function(a,o){const d=a.readVarint()+a.pos;for(;a.pos<d;){const p=o._keys[a.readVarint()],x=o._values[a.readVarint()];o.properties[p]=x}}(i,e):r===3?e.type=i.readVarint():r===4&&(e._geometry=i.pos)}function li(r){let e=0;for(let i,a,o=0,d=r.length,p=d-1;o<d;p=o++)i=r[o],a=r[p],e+=(a.x-i.x)*(i.y+a.y);return e}St.types=["Unknown","Point","LineString","Polygon"];class ti{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(ci,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new St(this._pbf,i,this.extent,this._keys,this._values)}}function ci(r,e,i){r===15?e.version=i.readVarint():r===1?e.name=i.readString():r===5?e.extent=i.readVarint():r===2?e._features.push(i.pos):r===3?e._keys.push(i.readString()):r===4&&e._values.push(function(a){let o=null;const d=a.readVarint()+a.pos;for(;a.pos<d;){const p=a.readVarint()>>3;o=p===1?a.readString():p===2?a.readFloat():p===3?a.readDouble():p===4?a.readVarint64():p===5?a.readVarint():p===6?a.readSVarint():p===7?a.readBoolean():null}if(o==null)throw new Error("unknown feature value");return o}(i))}class Oi{constructor(e,i){this.layers=e.readFields(Ki,{},i)}}function Ki(r,e,i){if(r===3){const a=new ti(i,i.readVarint()+i.pos);a.length&&(e[a.name]=a)}}const Hi="3d_elevation_id",jr="level";class qi{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,a){return this.get(e,!0,i,a)}optional(e,i,a){return this.get(e,!1,i,a)}success(){return this._valid}get(e,i,a,o){const d=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&d!==void 0&&!Number.isNaN(d)?a(o?o(d):d):i&&(this._valid=!1),this}}class yr{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,a){return this.featureFunc(e,i,a)}parseVertex(e,i,a){return this.vertexFunc(e,i,a)}}const Ur=new yr((r,e,i)=>r.reset(e).require(Hi,a=>{i.id=a}).optional("fixed_height_relative",a=>{i.constantHeight=a},Yi.decodeRelativeHeight).geometry(a=>{i.bounds=a},gh).success(),(r,e,i)=>r.reset(e).require(Hi,a=>{i.id=a}).require("elevation_idx",a=>{i.idx=a}).require("extent",a=>{i.extent=a}).require("height_relative",a=>{i.height=a},Yi.decodeRelativeHeight).geometry(a=>{i.position=a},Yi.getPoint).success()),fn=new yr((r,e,i)=>r.reset(e).require(Hi,a=>{i.id=a}).optional("fixed_height",a=>{i.constantHeight=a},Yi.decodeMetricHeight).geometry(a=>{i.bounds=a},gh).success(),(r,e,i)=>r.reset(e).require(Hi,a=>{i.id=a}).require("elevation_idx",a=>{i.idx=a}).require("extent",a=>{i.extent=a}).require("height",a=>{i.height=a},Yi.decodeMetricHeight).geometry(a=>{i.position=a},Yi.getPoint).success());class Yi{static getPoint(e){return oa(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?fn:void 0:Ur}static parse(e){const i=[],a=[],o=e.length,d=new qi;for(let p=0;p<o;p++){const x=e.feature(p),T=x.properties.version,A=Yi.getVersionSchema(T);if(A===void 0){ur(`Unknown elevation feature version number ${T||"(unknown)"}`);continue}const M=x.properties.type;if(!M)continue;const z=St.types[x.type];if(z==="Point"&&M==="curve_point"){const D={};A.parseVertex(d,x,D)&&i.push(D)}else if(z==="Polygon"&&M==="curve_meta"){const D={};A.parseFeature(d,x,D)&&a.push(D)}}return{vertices:i,features:a}}}class Or{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const o=Dt(i,this.dir);if(Math.abs(o)<1e-6)return!1;const d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/o;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,!0}}class Tr{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const o=Ri(i,this.dir);if(Math.abs(o)<1e-6)return!1;const d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/o;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,a[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,i,a){if(function(k,B){var W=k[0],Y=k[1],K=k[2],ne=B[0],se=B[1],he=B[2];return Math.abs(W-ne)<=q*Math.max(1,Math.abs(W),Math.abs(ne))&&Math.abs(Y-se)<=q*Math.max(1,Math.abs(Y),Math.abs(se))&&Math.abs(K-he)<=q*Math.max(1,Math.abs(K),Math.abs(he))}(this.pos,e)||i===0)return a[0]=a[1]=a[2]=0,!1;const[o,d,p]=this.dir,x=this.pos[0]-e[0],T=this.pos[1]-e[1],A=this.pos[2]-e[2],M=o*o+d*d+p*p,z=2*(x*o+T*d+A*p),D=z*z-4*M*(x*x+T*T+A*A-i*i);if(D<0){const k=Math.max(-z/2,0),B=x+o*k,W=T+d*k,Y=A+p*k,K=Math.hypot(B,W,Y);return a[0]=B*i/K,a[1]=W*i/K,a[2]=Y*i/K,!1}{const k=(-z-Math.sqrt(D))/(2*M);if(k<0){const B=Math.hypot(x,T,A);return a[0]=x*i/B,a[1]=T*i/B,a[2]=A*i/B,!1}return a[0]=x+o*k,a[1]=T+d*k,a[2]=A+p*k,!0}}}class Nr{constructor(e,i,a,o,d){this.TL=e,this.TR=i,this.BR=a,this.BL=o,this.horizon=d}static fromInvProjectionMatrix(e,i,a){const o=[-1,1,1],d=[1,1,1],p=[1,-1,1],x=[-1,-1,1],T=Tt(o,o,e),A=Tt(d,d,e),M=Tt(p,p,e),z=Tt(x,x,e);return new Nr(T,A,M,z,i/a)}}function nn(r,e,i){let a=1/0,o=-1/0;const d=[];for(const p of r){Er(d,p,e);const x=Ri(d,i);a=Math.min(a,x),o=Math.max(o,x)}return[a,o]}function zn(r,e){let i=!0;for(let a=0;a<r.planes.length;a++){const o=r.planes[a];let d=0;for(let p=0;p<e.length;p++)d+=+(Ri(o,e[p])+o[3]>=0);if(d===0)return 0;d!==e.length&&(i=!1)}return i?2:1}function us(r,e){for(const i of r.projections){const a=nn(e,r.points[0],i.axis);if(i.projection[1]<a[0]||i.projection[0]>a[1])return 0}return 1}function gn(r,e){let i=0;const a=[0,0,0,0];for(let p=0;p<r.length;p++)a[0]=r[p][0],a[1]=r[p][1],a[2]=r[p][2],a[3]=1,(o=a)[0]*(d=e)[0]+o[1]*d[1]+o[2]*d[2]+o[3]*d[3]>=0&&i++;var o,d;return i}class Ji{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Di.fromPoints(this.points),this.projections=[],this.frustumEdges=[Er([],this.points[2],this.points[3]),Er([],this.points[0],this.points[3]),Er([],this.points[4],this.points[0]),Er([],this.points[5],this.points[1]),Er([],this.points[6],this.points[2]),Er([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const o=[0,-a[2],a[1]],d=[a[2],0,-a[0]];this.projections.push({axis:o,projection:nn(this.points,this.points[0],o)}),this.projections.push({axis:d,projection:nn(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(e,i,a,o){const d=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const M=Rs([],A,e),z=1/M[3]/i*d;return(D=M)[0]=(k=M)[0]*(B=[z,z,o?1/M[3]:z,z])[0],D[1]=k[1]*B[1],D[2]=k[2]*B[2],D[3]=k[3]*B[3],D;var D,k,B}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const M=_i([],Ai([],Er([],p[A[0]],p[A[1]]),Er([],p[A[2]],p[A[1]]))),z=-Ri(M,p[A[1]]);return M.concat(z)}),T=[];for(let A=0;A<p.length;A++)T.push([p[A][0],p[A][1],p[A][2]]);return new Ji(T,x)}intersectsPrecise(e,i,a){for(let o=0;o<i.length;o++)if(!gn(e,i[o]))return 0;for(let o=0;o<this.planes.length;o++)if(!gn(e,this.planes[o]))return 0;for(const o of a)for(const d of this.frustumEdges){const p=Ai([],o,d),x=Zi(p);if(x===0)continue;Ht(p,p,1/x);const T=nn(this.points,this.points[0],p),A=nn(e,this.points[0],p);if(T[0]>A[1]||A[0]>T[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const a=i[3];if(Ri([i[0],i[1],i[2]],e)+a<0)return!1}return!0}}class Di{static fromPoints(e){const i=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const o of e)Pr(i,i,o),tt(a,a,o);return new Di(i,a)}static fromTileIdAndHeight(e,i,a){const o=1<<e.canonical.z,d=e.canonical.x,p=e.canonical.y;return new Di([d/o,p/o,i],[(d+1)/o,(p+1)/o,a])}static applyTransform(e,i){const a=e.getCorners();for(let o=0;o<a.length;++o)Tt(a[o],a[o],i);return Di.fromPoints(a)}static applyTransformFast(e,i){const a=[i[12],i[13],i[14]],o=[...a];for(let d=0;d<3;d++)for(let p=0;p<3;p++){const x=i[4*p+d],T=x*e.min[p],A=x*e.max[p];a[d]+=Math.min(T,A),o[d]+=Math.max(T,A)}return new Di(a,o)}static projectAabbCorners(e,i){const a=e.getCorners();for(let o=0;o<a.length;++o)Tt(a[o],a[o],i);return a}constructor(e,i){this.min=e,this.max=i,this.center=Ht([],Jt([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],a=Ci(this.min),o=Ci(this.max);for(let d=0;d<i.length;d++)a[d]=i[d]?this.min[d]:this.center[d],o[d]=i[d]?this.center[d]:this.max[d];return o[2]=this.max[2],new Di(a,o)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?zn(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?zn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?us(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?us(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}si(Di,"Aabb");class wr{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,a=i[1],o=-i[0],d=(e.extent+1)*this.metersToTile;return[new Ct(Math.trunc(e.position[0]+a*d),Math.trunc(e.position[1]+o*d)),new Ct(Math.trunc(e.position[0]-a*d),Math.trunc(e.position[1]-o*d))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class jn{constructor(e,i,a,o,d,p){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Pn(),Pn(),Pn(),Pn(),Pn(),Pn(),Pn()],this.id=e,this.heightRange={min:a,max:a},this.safeArea=i,this.constantHeight=a,this.constantHeight==null&&(this.constantHeight!=null||o.length!==0)){this.vertices=o,this.edges=d,this.edges=this.edges.filter(x=>{return x.a<this.vertices.length&&x.b<this.vertices.length&&!((T=this.vertices[x.a].position)[0]===(A=this.vertices[x.b].position)[0]&&T[1]===A[1]);var T,A}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const x of this.vertices)this.vertexProps.push({dir:oa(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,x.height),this.heightRange.max=Math.max(this.heightRange.max,x.height);for(const x of this.edges){const T=this.vertices[x.a].position,A=this.vertices[x.b].position,M=va(Pn(),A,T),z=os(M),D=Ms(Pn(),M,1/z);this.edgeProps.push({vec:M,dir:D,len:z});const k=this.vertexProps[x.a].dir,B=this.vertexProps[x.b].dir;as(k,k,D),as(B,B,D)}for(const x of this.vertexProps)x.dir[0]===0&&x.dir[1]===0||hn(x.dir,x.dir);this.tessellate(p)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[a,o]=i;return Li(this.vertices[this.edges[a].a].height,this.vertices[this.edges[a].b].height,o)}computeSlopeNormal(e,i){const a=this.getClosestEdge(e);if(!a)return or(0,0,1);const o=a[0],d=this.edges[o],p=this.edgeProps[o].vec,x=or(p[0],p[1],(this.vertices[d.b].height-this.vertices[d.a].height)*i),T=or(x[1],-x[0],0);Ai(T,T,x);const A=Zi(T);return A>0?Ht(T,T,1/A):er(T,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,a=Number.POSITIVE_INFINITY,o=0;const[d,p,x,T,A,M,z]=this._tmpVec2;Da(z,e.x,e.y);const D=new Or(z,null);for(let k=0;k<this.edges.length;k++){const B=this.edges[k],W=this.edgeProps[k].dir;D.dir=W;const Y=this.vertices[B.a].position,K=this.vertices[B.b].position,ne=D.intersectsPlane(Y,this.vertexProps[B.a].dir,d),se=D.intersectsPlane(K,this.vertexProps[B.b].dir,p);if(!ne||!se)continue;va(x,p,d),va(T,z,d);const he=Dt(x,x),Re=he>0?Dt(T,x)/he:0,Me=Ie(Re,0,1),Ne=Math.abs((Re-Me)*this.edgeProps[k].len);va(A,z,Y),Da(M,W[1],-W[0]);const Fe=Ne+Math.abs(Dt(A,M));Fe<a&&(i=k,a=Fe,o=Me)}return[i,o]}tessellate(e){const i=xt(),a=xt(),o=xt(),d=xt();for(let p=this.edges.length-1;p>=0;--p){const x=this.edges[p].a,T=this.edges[p].b,{position:A,height:M,extent:z}=this.vertices[x],{position:D,height:k,extent:B}=this.vertices[T],W=this.vertexProps[x].dir,Y=this.vertexProps[T].dir;if(er(i,A[0]/e,A[1]/e,M),er(a,D[0]/e,D[1]/e,k),er(o,W[1],-W[0],0),Ht(o,o,z),er(d,Y[1],-Y[0],0),Ht(d,d,B),this.distSqLines(or(i[0]+.5*o[0],i[1]+.5*o[1],i[2]+.5*o[2]),or(a[0]-.5*d[0],a[1]-.5*d[1],a[2]-.5*d[2]),or(i[0]-.5*o[0],i[1]-.5*o[1],i[2]-.5*o[2]),or(a[0]+.5*d[0],a[1]+.5*d[1],a[2]+.5*d[2]))<=.0025000000000000005)continue;const K=this.vertices.length,ne=as(Pn(),A,D);this.vertices.push({position:Ms(ne,ne,.5),height:.5*(M+k),extent:.5*(z+B)});const se=as(Pn(),W,Y);this.vertexProps.push({dir:hn(se,se)}),this.edges.splice(p,1),this.edgeProps.splice(p,1),this.edges.push({a:x,b:K}),this.edges.push({a:K,b:T});const he=va(Pn(),this.vertices[K].position,A),Re=os(he),Me={vec:he,dir:Ms(Pn(),he,1/Re),len:Re};this.edgeProps.push(Me),this.edgeProps.push(Me)}}distSqLines(e,i,a,o){const d=ji(xt(),i,e),p=ji(xt(),o,a),x=ji(xt(),e,a),T=Ri(d,d),A=Ri(d,p),M=Ri(d,x),z=Ri(p,p),D=Ri(p,x),k=T*z-A*A;if(k===0)return Ui(gt(d,a,o,Ri(x,p)/Ri(p,p)),e);const B=(T*D-A*M)/k;return Ui(gt(d,e,i,(A*D-M*z)/k),gt(p,a,o,B))}}class Vr{static parseFrom(e,i){const a=Yi.parse(e);if(!a)return[];let{vertices:o,features:d}=a;const p=1/Ze(i);d.sort((M,z)=>M.id-z.id),o.sort((M,z)=>M.id-z.id||M.idx-z.idx),o=o.filter((M,z,D)=>z===D.findIndex(k=>k.id===M.id&&k.idx===M.idx));const x=new Array;let T=0;const A=o.length;for(const M of d){if(M.constantHeight){x.push(new jn(M.id,M.bounds,M.constantHeight));continue}for(;T!==A&&o[T].id<M.id;)T++;if(T===A||o[T].id!==M.id)continue;const z=new Array,D=new Array,k=T;for(;T!==A&&o[T].id===M.id;){const B=o[T];if(z.push({position:B.position,height:B.height,extent:B.extent}),T!==k&&o[T-1].idx===B.idx-1){const W=T-k;D.push({a:W-1,b:W})}T++}x.push(new jn(M.id,M.bounds,void 0,z,D,p))}return x}static getElevationFeature(e,i){if(!i)return;const a=+e.properties[Hi];return Number.isNaN(a)?void 0:i.find(o=>o.id===a)}}class es{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*Vt,this.yOffset=(e.y*this.zScale-i.y)*Vt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,a){const o=this.constantElevation(i,a);return o??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),a))}computeBiasedHeight(e,i){return i<=0?e:e+i*Qe(0,i,e>=0?e:Math.abs(.5*e))}}si(jn,"ElevationFeature");class ws{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new lc,this.indexArray=new cs,this.segments=new Wr,this.programConfigurations=new $s(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Ro),this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,a,o){const d=this.layers[0],p=[];let x=null;d.type==="circle"&&(x=d.layout.get("circle-sort-key"));for(const{feature:A,id:M,index:z,sourceLayerIndex:D}of e){const k=this.layers[0]._featureFilter.needGeometry,B=Rt(A,k);if(!this.layers[0]._featureFilter.filter(new on(this.zoom,{worldview:this.worldview}),B,a))continue;const W=x?x.evaluate(B,{},a):void 0,Y={id:M,properties:A.properties,type:A.type,sourceLayerIndex:D,index:z,geometry:k?B.geometry:$t(A,a,o),patterns:{},sortKey:W};p.push(Y)}x&&p.sort((A,M)=>A.sortKey-M.sortKey);let T=null;o.projection.name==="globe"&&(this.globeExtVertexArray=new Vd,T=o.projection);for(const A of p){const{geometry:M,index:z,sourceLayerIndex:D}=A,k=e[z].feature;this.addFeature(A,M,z,i.availableImages,a,T,i.brightness,i.elevationFeatures),i.featureIndex.insert(k,M,z,D,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,a,o,d,p,x){this.programConfigurations.updatePaintArrays(e,i,d,a,o,p,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Vu.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Xm.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,a,o,d,p,x,T){let A;this.elevationMode!=="none"&&(A=Vr.getElevationFeature(e,T));for(const M of i)for(const z of M){const D=z.x,k=z.y;if(D<0||D>=Vt||k<0||k>=Vt)continue;if(p){const Y=p.projectTilePoint(D,k,d),K=p.upVector(d,D,k);this.addGlobeExtVertex(Y,K),this.addGlobeExtVertex(Y,K),this.addGlobeExtVertex(Y,K),this.addGlobeExtVertex(Y,K)}const B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),W=B.vertexLength;if(this.addCircleVertex(D,k,-1,-1),this.addCircleVertex(D,k,1,-1),this.addCircleVertex(D,k,1,1),this.addCircleVertex(D,k,-1,1),this.elevationMode!=="none"){const Y=A?A.pointElevation(new Ct(D,k)):0;this.hasElevation=this.hasElevation||Y!==0;for(let K=0;K<4;K++)this.elevatedLayoutVertexArray.emplaceBack(Y)}this.indexArray.emplaceBack(W,W+1,W+2),this.indexArray.emplaceBack(W,W+2,W+3),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},o,d,x,void 0,this.worldview)}addCircleVertex(e,i,a,o){this.layoutVertexArray.emplaceBack(2*e+(a+1)/2,2*i+(o+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function Ja(r,e){for(let i=0;i<r.length;i++)if(Ss(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Ss(r,e[i]))return!0;return!!ta(r,e)}function mo(r,e,i){return!!Ss(r,e)||!!Hn(e,r,i)}function Ts(r,e){if(r.length===1)return ss(e,r[0]);for(let i=0;i<e.length;i++){const a=e[i];for(let o=0;o<a.length;o++)if(Ss(r,a[o]))return!0}for(let i=0;i<r.length;i++)if(ss(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(ta(r,e[i]))return!0;return!1}function ga(r,e,i){if(r.length>1){if(ta(r,e))return!0;for(let a=0;a<e.length;a++)if(Hn(e[a],r,i))return!0}for(let a=0;a<r.length;a++)if(Hn(r[a],e,i))return!0;return!1}function ta(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const a=r[i],o=r[i+1];for(let d=0;d<e.length-1;d++)if(_a(a,o,e[d],e[d+1]))return!0}return!1}function _a(r,e,i,a){return mn(r,i,a)!==mn(e,i,a)&&mn(r,e,i)!==mn(r,e,a)}function zo(r,e,i){return(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x)}function Bn(r,e,i,a){const o=zo(r,e,a),d=zo(r,e,i);if(Math.sign(o)===Math.sign(d))return;const p=zo(i,a,r),x=p+d-o;return Math.sign(p)!==Math.sign(x)?[p/(p-x),d/(d-o)]:void 0}function Hn(r,e,i){const a=i*i;if(e.length===1)return r.distSqr(e[0])<a;for(let o=1;o<e.length;o++)if(vn(r,e[o-1],e[o])<a)return!0;return!1}function vn(r,e,i){const a=e.distSqr(i);if(a===0)return r.distSqr(e);const o=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/a;return r.distSqr(o<0?e:o>1?i:i.sub(e)._mult(o)._add(e))}function ss(r,e){let i,a,o,d=!1;for(let p=0;p<r.length;p++){i=r[p];for(let x=0,T=i.length-1;x<i.length;T=x++)a=i[x],o=i[T],a.y>e.y!=o.y>e.y&&e.x<(o.x-a.x)*(e.y-a.y)/(o.y-a.y)+a.x&&(d=!d)}return d}function Ss(r,e){let i=!1;for(let a=0,o=r.length-1;a<r.length;o=a++){const d=r[a],p=r[o];d.y>e.y!=p.y>e.y&&e.x<(p.x-d.x)*(e.y-d.y)/(p.y-d.y)+d.x&&(i=!i)}return i}function ts(r,e,i,a,o){for(const p of r)if(e<=p.x&&i<=p.y&&a>=p.x&&o>=p.y)return!0;const d=[new Ct(e,i),new Ct(e,o),new Ct(a,o),new Ct(a,i)];if(r.length>2){for(const p of d)if(Ss(r,p))return!0}for(let p=0;p<r.length-1;p++)if(ia(r[p],r[p+1],d))return!0;return!1}function ia(r,e,i){const a=i[0],o=i[2];if(r.x<a.x&&e.x<a.x||r.x>o.x&&e.x>o.x||r.y<a.y&&e.y<a.y||r.y>o.y&&e.y>o.y)return!1;const d=mn(r,e,i[0]);return d!==mn(r,e,i[1])||d!==mn(r,e,i[2])||d!==mn(r,e,i[3])}function tl(r,e,i,a,o,d){let p=e.y-r.y,x=r.x-e.x;if(d=d||0){const T=p*p+x*x;if(T===0)return!0;const A=Math.sqrt(T);p/=A,x/=A}return!((i.x-r.x)*p+(i.y-r.y)*x-d<0||(a.x-r.x)*p+(a.y-r.y)*x-d<0||(o.x-r.x)*p+(o.y-r.y)*x-d<0)}function Cl(r,e,i,a,o,d,p){return!(tl(r,e,a,o,d,p)||tl(e,i,a,o,d,p)||tl(i,r,a,o,d,p)||tl(a,o,r,e,i,p)||tl(o,d,r,e,i,p)||tl(d,a,r,e,i,p))}function Ca(r,e,i){const a=e.paint.get(r).value;return a.kind==="constant"?a.value:i.programConfigurations.get(e.id).getMaxValue(r)}function il(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function pc(r,e,i,a,o){if(!e[0]&&!e[1])return r;const d=Ct.convert(e)._mult(o);i==="viewport"&&d._rotate(-a);const p=[];for(let x=0;x<r.length;x++)p.push(r[x].sub(d));return p}function rl(r,e,i,a){const o=Ct.convert(r)._mult(a);return e==="viewport"&&o._rotate(-i),o}let Zh,Rl;function Ha(r,e,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[r*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}si(ws,"CircleBucket",{omit:["layers"]});class Ml{constructor(e,i,a){this.z=e,this.x=i,this.y=a,this.key=Wf(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const a=function(d,p,x){var T=Ha(256*d,256*(p=Math.pow(2,x)-p-1),x),A=Ha(256*(d+1),256*(p+1),x);return T[0]+","+T[1]+","+A[0]+","+A[1]}(this.x,this.y,this.z),o=function(d,p,x){let T,A="";for(let M=d;M>0;M--)T=1<<M-1,A+=(p&T?1:0)+(x&T?2:0);return A}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",o).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class qn{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Wf(e,i.z,i.z,i.x,i.y)}}class ra{constructor(e,i,a,o,d){this.overscaledZ=e,this.wrap=i,this.canonical=new Ml(a,+o,+d),this.key=i===0&&e===a?this.canonical.key:Wf(i,e,a,o,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new ra(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ra(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Wf(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Wf(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new ra(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,o=2*this.canonical.y;return[new ra(i,this.wrap,i,a,o),new ra(i,this.wrap,i,a+1,o),new ra(i,this.wrap,i,a,o+1),new ra(i,this.wrap,i,a+1,o+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ra(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ra(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new qn(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Wf(r,e,i,a,o){const d=1<<Math.min(i,22);let p=d*(o%d)+a%d;return r&&i<22&&(p+=d*d*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*p+i)+(e-i)}const b0=[r=>{let e=r.canonical.x-1,i=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,i--),new ra(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,i=r.wrap;return e===1<<r.canonical.z&&(e=0,i++),new ra(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>new ra(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new ra(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];si(Ml,"CanonicalTileID"),si(ra,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const V1=xr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Qm}=V1,H1=xr([{name:"a_pos_3",components:3,type:"Int16"}]);var Qp=xr([{name:"a_pos",type:"Int16",components:2}]);function $u(r){return r*c/H}const Yg=[new Di([L,L,L],[P,P,P]),new Di([L,L,L],[0,0,P]),new Di([0,L,L],[P,0,P]),new Di([L,0,L],[0,P,P]),new Di([0,0,L],[P,P,P])];function em(r,e,i,a=!0){const o=Ht([],r._camera.position,r.worldSize),d=[e,i,1,1];Rs(d,d,r.pixelMatrixInverse),Br(d,d,1/d[3]);const p=_i([],Er([],d,o)),x=r.globeMatrix,T=[x[12],x[13],x[14]],A=Er([],T,o),M=Zi(A),z=_i([],A),D=r.worldSize/(2*Math.PI),k=Ri(z,p),B=Math.asin(D/M);if(B<Math.acos(k)){if(!a)return null;const ft=[],$e=[];Ht(ft,p,M/k),_i($e,Er($e,ft,A)),_i(p,Jt(p,A,Ht(p,$e,Math.tan(B)*M)))}const W=[];new Tr(o,p).closestPointOnSphere(T,D,W);const Y=_i([],wi(x,0)),K=_i([],wi(x,1)),ne=_i([],wi(x,2)),se=Ri(Y,W),he=Ri(K,W),Re=Ri(ne,W),Me=J(Math.asin(-he/D));let Ne=J(Math.atan2(se,Re));Ne=r.center.lng+function(ft,$e){const yt=($e-ft+180)%360-180;return yt<-180?yt+360:yt}(r.center.lng,Ne);const Fe=fe(Ne),Ue=Ie(Te(Me),0,1);return new ot(Fe,Ue)}class Kg{constructor(e,i,a){this.a=Er([],e,a),this.b=Er([],i,a),this.center=a;const o=_i([],this.a),d=_i([],this.b);this.angle=Math.acos(Ri(o,d))}}function Zu(r,e){if(r.angle===0)return null;let i;return i=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:function(a,o,d,p){const x=Math.sin(d);return a*(Math.sin((1-p)*d)/x)+o*(Math.sin(p*d)/x)}(r.a[e],r.b[e],r.angle,Ie(i,0,1))+r.center[e]}function ya(r){if(r.z<=1)return Yg[r.z+2*r.y+r.x];const e=eg(tm(r));return Di.fromPoints(e)}function nl(r,e,i){return Ht(r,r,1-i),Pi(r,r,e,i)}function w0(r,e,i){for(const a of r)Tt(a,a,e),Ht(a,a,i)}function Jg(r,e,i,a){const o=e/r.worldSize,d=r.globeMatrix;if(i.z<=1){const Ue=ya(i).getCorners();return w0(Ue,d,o),Di.fromPoints(Ue)}const p=tm(i,a),x=eg(p,c+$u(r._tileCoverLift));w0(x,d,o);const T=Number.MAX_VALUE,A=[-T,-T,-T],M=[T,T,T];if(p.contains(r.center)){for(const $e of x)Pr(M,M,$e),tt(A,A,$e);A[2]=0;const Ue=r.point,ft=[Ue.x*o,Ue.y*o,0];return Pr(M,M,ft),tt(A,A,ft),new Di(M,A)}if(r._tileCoverLift>0){for(const Ue of x)Pr(M,M,Ue),tt(A,A,Ue);return new Di(M,A)}const z=[d[12]*o,d[13]*o,d[14]*o],D=p.getCenter(),k=Ie(r.center.lat,-85.051129,Ce),B=Ie(D.lat,-85.051129,Ce),W=fe(r.center.lng),Y=Te(k);let K=W-fe(D.lng);const ne=Y-Te(B);K>.5?K-=1:K<-.5&&(K+=1);let se=0;Math.abs(K)>Math.abs(ne)?se=K>=0?1:3:(se=ne>=0?0:2,Pi(z,z,[d[4]*o,d[5]*o,d[6]*o],-Math.sin(He(ne>=0?p.getSouth():p.getNorth()))*c));const he=x[se],Re=x[(se+1)%4],Me=new Kg(he,Re,z),Ne=[Zu(Me,0)||he[0],Zu(Me,1)||he[1],Zu(Me,2)||he[2]],Fe=Wh(r.zoom);if(Fe>0){const Ue=function({x:$e,y:yt,z:It},bt,Et,jt,ht){const At=1/(1<<It);let at=$e*At,et=at+At,kt=yt*At,Ot=kt+At,bi=0;const oi=(at+et)/2-jt;return oi>.5?bi=-1:oi<-.5&&(bi=1),at=((at+bi)*bt-(jt*=bt))*Et+jt,et=((et+bi)*bt-jt)*Et+jt,kt=(kt*bt-(ht*=bt))*Et+ht,Ot=(Ot*bt-ht)*Et+ht,[[at,Ot,0],[et,Ot,0],[et,kt,0],[at,kt,0]]}(i,e,r._pixelsPerMercatorPixel,W,Y);for(let $e=0;$e<x.length;$e++)nl(x[$e],Ue[$e],Fe);const ft=Jt([],Ue[se],Ue[(se+1)%4]);Ht(ft,ft,.5),nl(Ne,ft,Fe)}for(const Ue of x)Pr(M,M,Ue),tt(A,A,Ue);return M[2]=Math.min(he[2],Re[2]),Pr(M,M,Ne),tt(A,A,Ne),new Di(M,A)}function tm({x:r,y:e,z:i},a=!1){const o=1/(1<<i),d=new G(Ee(r*o),e===(1<<i)-1&&a?-90:ve((e+1)*o)),p=new G(Ee((r+1)*o),e===0&&a?90:ve(e*o));return new te(d,p)}function eg(r,e=c){const i=He(r.getNorth()),a=He(r.getSouth()),o=Math.cos(i),d=Math.cos(a),p=Math.sin(i),x=Math.sin(a),T=r.getWest(),A=r.getEast();return[F(d,x,T,e),F(d,x,A,e),F(o,p,A,e),F(o,p,T,e)]}function im(r,e,i,a){const o=1<<i.z,d=(r/Vt+i.x)/o;return j(ve((e/Vt+i.y)/o),Ee(d),a)}function Xf({min:r,max:e}){return w/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const Qg=new Float64Array(16);function rm(r){const e=Xf(r),i=it(Qg,[e,e,e]);return ye(i,i,Wi([],r.min))}function e_(r){const e=(a=r.min,(i=Qg)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=a[0],i[13]=a[1],i[14]=a[2],i[15]=1,i);var i,a;const o=1/Xf(r);return xe(e,e,[o,o,o])}function nm(r){const e=Vt/(2*Math.PI);return r/(2*Math.PI)/e}function tg(r,e){return Vt/(512*Math.pow(2,r))*Xf(ya(e))}function T0(r,e,i,a,o){const d=nm(i),p=[r,e,-i/(2*Math.PI)],x=Se(new Float64Array(16));return ye(x,x,p),xe(x,x,[d,d,d]),Le(x,x,He(-o)),Ae(x,x,He(-a)),x}function Wh(r){return Qe(m,y,r)}function Yf(r,e){const i=j(e.lat,e.lng),a=function(B){const W=j(B._center.lat,B._center.lng);let Y=Ai([],or(0,1,0),W);const K=rt([],-B.angle,W);Y=Tt(Y,Y,K),rt(K,-B._pitch,Y);const ne=_i([],W);return Ht(ne,ne,$u(B.cameraToCenterDistance/B.pixelsPerMeter)),Tt(ne,ne,K),Jt([],W,ne)}(r);return p=(o=ji([],a,i))[0],x=o[1],T=o[2],A=(d=i)[0],M=d[1],z=d[2],k=(D=Math.sqrt((p*p+x*x+T*T)*(A*A+M*M+z*z)))&&Ri(o,d)/D,Math.acos(Math.min(Math.max(k,-1),1));var o,d,p,x,T,A,M,z,D,k}function t_(r,e){return Yf(r,e)>Math.PI/2*1.01}const i_=He(85),Ln=Math.cos(i_),r_=Math.sin(i_),ig=le(),rg=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function n_(r,e,i,a,o,d,p,x,T){if(d&&r.queryGeometry.isAboveHorizon)return!1;d&&(T*=r.pixelToTileUnitsFactor);const A=r.tileID.canonical,M=i.projection.upVectorScale(A,i.center.lat,i.worldSize).metersToTile;for(const z of e)for(const D of z){const k=D.add(x),B=o&&i.elevation?i.elevation.exaggeration()*o.getElevationAt(k.x,k.y,!0):0,W=i.projection.projectTilePoint(k.x,k.y,A);if(B>0){const se=i.projection.upVector(A,k.x,k.y);W.x+=se[0]*M*B,W.y+=se[1]*M*B,W.z+=se[2]*M*B}const Y=d?k:s_(W.x,W.y,W.z,a),K=d?r.tilespaceRays.map(se=>Jf(se,B)):r.queryGeometry.screenGeometry,ne=Rs([],[W.x,W.y,W.z,1],a);if(!p&&d?T*=ne[3]/i.cameraToCenterDistance:p&&!d&&(T*=i.cameraToCenterDistance/ne[3]),d){const se=ve((D.y/Vt+A.y)/(1<<A.z));T/=i.projection.pixelsPerMeter(se,1)/we(1,se)}if(mo(K,Y,T))return!0}return!1}function s_(r,e,i,a){const o=Rs([],[r,e,i,1],a);return new Ct(o[0]/o[3],o[1]/o[3])}const Kf=or(0,0,0),ng=or(0,0,1);function Jf(r,e){const i=xt();return Kf[2]=e,r.intersectsPlane(Kf,ng,i),new Ct(i[0],i[1])}class a_ extends ws{}let S0,E0,o_,l_;function sm(r,{width:e,height:i},a,o){if(o){if(o instanceof Uint8ClampedArray)o=new Uint8Array(o.buffer);else if(o.length!==e*i*a)throw new RangeError("mismatched image size")}else o=new Uint8Array(e*i*a);return r.width=e,r.height=i,r.data=o,r}function is(r,e,i){const{width:a,height:o}=e;a===r.width&&o===r.height||(am(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,a),height:Math.min(r.height,o)},i,null),r.width=a,r.height=o,r.data=e.data)}function am(r,e,i,a,o,d,p,x){if(o.width===0||o.height===0)return e;if(o.width>r.width||o.height>r.height||i.x>r.width-o.width||i.y>r.height-o.height)throw new RangeError("out of range source coordinates for image copy");if(o.width>e.width||o.height>e.height||a.x>e.width-o.width||a.y>e.height-o.height)throw new RangeError("out of range destination coordinates for image copy");const T=r.data,A=e.data,M=d===4&&x;for(let z=0;z<o.height;z++){const D=((i.y+z)*r.width+i.x)*d,k=((a.y+z)*e.width+a.x)*d;if(M)for(let B=0;B<o.width;B++){const W=D+B*d+3,Y=k+B*d;A[Y+0]=255,A[Y+1]=255,A[Y+2]=255,A[Y+3]=T[W]}else if(p)for(let B=0;B<o.width;B++){const W=D+B*d,Y=k+B*d,K=new $r(T[W+0]/255,T[W+1]/255,T[W+2]/255,T[W+3]).toNonPremultipliedRenderColor(p).toArray();A[Y+0]=K[0],A[Y+1]=K[1],A[Y+2]=K[2],A[Y+3]=K[3]}else for(let B=0;B<o.width*d;B++)A[k+B]=T[D+B]}return e}si(a_,"HeatmapBucket",{omit:["layers"]});class Es{constructor(e,i){sm(this,e,1,i)}resize(e){is(this,new Es(e),1)}clone(){return new Es({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,o,d){am(e,i,a,o,d,1,null)}}class na{constructor(e,i){sm(this,e,4,i)}resize(e){is(this,new na(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new na({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,o,d,p,x){am(e,i,a,o,d,4,p,x)}}class sg{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Yd(r){const e={},i=r.resolution||256,a=r.clips?r.clips.length:1,o=r.image||new na({width:i,height:a}),d=(p,x,T)=>{e[r.evaluationKey]=T;const A=r.expression.evaluate(e),M=A?A.toNonPremultipliedRenderColor(null):null;M&&(o.data[p+x+0]=Math.floor(255*M.r),o.data[p+x+1]=Math.floor(255*M.g),o.data[p+x+2]=Math.floor(255*M.b),o.data[p+x+3]=Math.floor(255*M.a))};if(r.clips)for(let p=0,x=0;p<a;++p,x+=4*i)for(let T=0,A=0;T<i;T++,A+=4){const M=T/(i-1),{start:z,end:D}=r.clips[p];d(x,A,z*(1-M)+D*M)}else for(let p=0,x=0;p<i;p++,x+=4)d(0,x,p/(i-1));return o}si(Es,"AlphaImage"),si(na,"RGBAImage");const ag=xr([{name:"a_pos",components:2,type:"Int16"}],4),A0=xr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),C0=xr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),c_=xr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Xh(r,e,i=2){const a=e&&e.length,o=a?e[0]*i:r.length;let d=R0(r,0,o,i,!0);const p=[];if(!d||d.next===d.prev)return p;let x,T,A;if(a&&(d=function(M,z,D,k){const B=[];for(let W=0,Y=z.length;W<Y;W++){const K=R0(M,z[W]*k,W<Y-1?z[W+1]*k:M.length,k,!1);K===K.next&&(K.steiner=!0),B.push(I0(K))}B.sort(h_);for(let W=0;W<B.length;W++)D=$1(B[W],D);return D}(r,e,d,i)),r.length>80*i){x=r[0],T=r[1];let M=x,z=T;for(let D=i;D<o;D+=i){const k=r[D],B=r[D+1];k<x&&(x=k),B<T&&(T=B),k>M&&(M=k),B>z&&(z=B)}A=Math.max(M-x,z-T),A=A!==0?32767/A:0}return om(d,p,i,x,T,A,0),p}function R0(r,e,i,a,o){let d;if(o===function(p,x,T,A){let M=0;for(let z=x,D=T-A;z<T;z+=A)M+=(p[D]-p[z])*(p[z+1]+p[D+1]),D=z;return M}(r,e,i,a)>0)for(let p=e;p<i;p+=a)d=P0(p/a|0,r[p],r[p+1],d);else for(let p=i-a;p>=e;p-=a)d=P0(p/a|0,r[p],r[p+1],d);return d&&Lo(d,d.next)&&(lm(d),d=d.next),d}function Yh(r,e){if(!r)return r;e||(e=r);let i,a=r;do if(i=!1,a.steiner||!Lo(a,a.next)&&hs(a.prev,a,a.next)!==0)a=a.next;else{if(lm(a),a=e=a.prev,a===a.next)break;i=!0}while(i||a!==e);return e}function om(r,e,i,a,o,d,p){if(!r)return;!p&&d&&function(T,A,M,z){let D=T;do D.z===0&&(D.z=sl(D.x,D.y,A,M,z)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==T);D.prevZ.nextZ=null,D.prevZ=null,function(k){let B,W=1;do{let Y,K=k;k=null;let ne=null;for(B=0;K;){B++;let se=K,he=0;for(let Me=0;Me<W&&(he++,se=se.nextZ,se);Me++);let Re=W;for(;he>0||Re>0&&se;)he!==0&&(Re===0||!se||K.z<=se.z)?(Y=K,K=K.nextZ,he--):(Y=se,se=se.nextZ,Re--),ne?ne.nextZ=Y:k=Y,Y.prevZ=ne,ne=Y;K=se}ne.nextZ=null,W*=2}while(B>1)}(D)}(r,a,o,d);let x=r;for(;r.prev!==r.next;){const T=r.prev,A=r.next;if(d?q1(r,a,o,d):M0(r))e.push(T.i,r.i,A.i),lm(r),r=A.next,x=A.next;else if((r=A)===x){p?p===1?om(r=G1(Yh(r),e),e,i,a,o,d,2):p===2&&u_(r,e,i,a,o,d):om(Yh(r),e,i,a,o,d,1);break}}}function M0(r){const e=r.prev,i=r,a=r.next;if(hs(e,i,a)>=0)return!1;const o=e.x,d=i.x,p=a.x,x=e.y,T=i.y,A=a.y,M=Math.min(o,d,p),z=Math.min(x,T,A),D=Math.max(o,d,p),k=Math.max(x,T,A);let B=a.next;for(;B!==e;){if(B.x>=M&&B.x<=D&&B.y>=z&&B.y<=k&&Qa(o,x,d,T,p,A,B.x,B.y)&&hs(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function q1(r,e,i,a){const o=r.prev,d=r,p=r.next;if(hs(o,d,p)>=0)return!1;const x=o.x,T=d.x,A=p.x,M=o.y,z=d.y,D=p.y,k=Math.min(x,T,A),B=Math.min(M,z,D),W=Math.max(x,T,A),Y=Math.max(M,z,D),K=sl(k,B,e,i,a),ne=sl(W,Y,e,i,a);let se=r.prevZ,he=r.nextZ;for(;se&&se.z>=K&&he&&he.z<=ne;){if(se.x>=k&&se.x<=W&&se.y>=B&&se.y<=Y&&se!==o&&se!==p&&Qa(x,M,T,z,A,D,se.x,se.y)&&hs(se.prev,se,se.next)>=0||(se=se.prevZ,he.x>=k&&he.x<=W&&he.y>=B&&he.y<=Y&&he!==o&&he!==p&&Qa(x,M,T,z,A,D,he.x,he.y)&&hs(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;se&&se.z>=K;){if(se.x>=k&&se.x<=W&&se.y>=B&&se.y<=Y&&se!==o&&se!==p&&Qa(x,M,T,z,A,D,se.x,se.y)&&hs(se.prev,se,se.next)>=0)return!1;se=se.prevZ}for(;he&&he.z<=ne;){if(he.x>=k&&he.x<=W&&he.y>=B&&he.y<=Y&&he!==o&&he!==p&&Qa(x,M,T,z,A,D,he.x,he.y)&&hs(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function G1(r,e){let i=r;do{const a=i.prev,o=i.next.next;!Lo(a,o)&&L0(a,i,i.next,o)&&Qf(a,o)&&Qf(o,a)&&(e.push(a.i,i.i,o.i),lm(i),lm(i.next),i=r=o),i=i.next}while(i!==r);return Yh(i)}function u_(r,e,i,a,o,d){let p=r;do{let x=p.next.next;for(;x!==p.prev;){if(p.i!==x.i&&z0(p,x)){let T=D0(p,x);return p=Yh(p,p.next),T=Yh(T,T.next),om(p,e,i,a,o,d,0),void om(T,e,i,a,o,d,0)}x=x.next}p=p.next}while(p!==r)}function h_(r,e){let i=r.x-e.x;return i===0&&(i=r.y-e.y,i===0)&&(i=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function $1(r,e){const i=function(o,d){let p=d;const x=o.x,T=o.y;let A,M=-1/0;if(Lo(o,p))return p;do{if(Lo(o,p.next))return p.next;if(T<=p.y&&T>=p.next.y&&p.next.y!==p.y){const W=p.x+(T-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(W<=x&&W>M&&(M=W,A=p.x<p.next.x?p:p.next,W===x))return A}p=p.next}while(p!==d);if(!A)return null;const z=A,D=A.x,k=A.y;let B=1/0;p=A;do{if(x>=p.x&&p.x>=D&&x!==p.x&&d_(T<k?x:M,T,D,k,T<k?M:x,T,p.x,p.y)){const W=Math.abs(T-p.y)/(x-p.x);Qf(p,o)&&(W<B||W===B&&(p.x>A.x||p.x===A.x&&Z1(A,p)))&&(A=p,B=W)}p=p.next}while(p!==z);return A}(r,e);if(!i)return e;const a=D0(i,r);return Yh(a,a.next),Yh(i,i.next)}function Z1(r,e){return hs(r.prev,r,e.prev)<0&&hs(e.next,r,r.next)<0}function sl(r,e,i,a,o){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*o|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function I0(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function d_(r,e,i,a,o,d,p,x){return(o-p)*(e-x)>=(r-p)*(d-x)&&(r-p)*(a-x)>=(i-p)*(e-x)&&(i-p)*(d-x)>=(o-p)*(a-x)}function Qa(r,e,i,a,o,d,p,x){return!(r===p&&e===x)&&d_(r,e,i,a,o,d,p,x)}function z0(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(i,a){let o=i;do{if(o.i!==i.i&&o.next.i!==i.i&&o.i!==a.i&&o.next.i!==a.i&&L0(o,o.next,i,a))return!0;o=o.next}while(o!==i);return!1}(r,e)&&(Qf(r,e)&&Qf(e,r)&&function(i,a){let o=i,d=!1;const p=(i.x+a.x)/2,x=(i.y+a.y)/2;do o.y>x!=o.next.y>x&&o.next.y!==o.y&&p<(o.next.x-o.x)*(x-o.y)/(o.next.y-o.y)+o.x&&(d=!d),o=o.next;while(o!==i);return d}(r,e)&&(hs(r.prev,r,e.prev)||hs(r,e.prev,e))||Lo(r,e)&&hs(r.prev,r,r.next)>0&&hs(e.prev,e,e.next)>0)}function hs(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function Lo(r,e){return r.x===e.x&&r.y===e.y}function L0(r,e,i,a){const o=Wu(hs(r,e,i)),d=Wu(hs(r,e,a)),p=Wu(hs(i,a,r)),x=Wu(hs(i,a,e));return o!==d&&p!==x||!(o!==0||!og(r,i,e))||!(d!==0||!og(r,a,e))||!(p!==0||!og(i,r,a))||!(x!==0||!og(i,e,a))}function og(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function Wu(r){return r>0?1:r<0?-1:0}function Qf(r,e){return hs(r.prev,r,r.next)<0?hs(r,e,r.next)>=0&&hs(r,r.prev,e)>=0:hs(r,e,r.prev)<0||hs(r,r.next,e)<0}function D0(r,e){const i=f_(r.i,r.x,r.y),a=f_(e.i,e.x,e.y),o=r.next,d=e.prev;return r.next=e,e.prev=r,i.next=o,o.prev=i,a.next=i,i.prev=a,d.next=a,a.prev=d,a}function P0(r,e,i,a){const o=f_(r,e,i);return a?(o.next=a.next,o.prev=a,a.next.prev=o,a.next=o):(o.prev=o,o.next=o),o}function lm(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function f_(r,e,i){return{i:r,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function cm(r,e){const i=r.length;if(i<=1)return[r];const a=[];let o,d;for(let p=0;p<i;p++){const x=Yr(r[p]);x!==0&&(r[p].area=Math.abs(x),d===void 0&&(d=x<0),d===x<0?(o&&a.push(o),o=[r[p]]):o.push(r[p]))}if(o&&a.push(o),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(Wa(a[p],e,1,a[p].length-1,W1),a[p]=a[p].slice(0,e));return a}function W1(r,e){return e.area-r.area}function O0(r,e,i=1){if(!r)return null;const a=typeof r=="string"?Sa.from(r).getPrimary():r.getPrimary(),o=typeof r=="string"?null:r.getSecondary();for(const d of[a,o]){if(!d)continue;const p=d.id.toString();e.has(p)||e.set(p,[]),d.scaleSelf(i),e.get(p).push(d)}return{primary:a.toString(),secondary:o?o.toString():null}}function lg(r,e,i,a){const o=a.patternDependencies;let d=!1;for(const p of e){const x=p.paint.get(`${r}-pattern`);x.isConstant()||(d=!0),O0(x.constantOr(null),o,i)&&(d=!0)}return d}function Kh(r,e,i,a,o,d){const p=d.patternDependencies;for(const x of e){const T=x.paint.get(`${r}-pattern`).value;if(T.kind!=="constant"){let A=T.evaluate({zoom:a},i,{},d.availableImages);A=A&&A.name?A.name:A;const M=O0(A,p,o);if(!M)continue;const{primary:z,secondary:D}=M;z&&(i.patterns[x.id]=[z,D].filter(Boolean))}}return i}class ep{constructor(){this.polygons=new Map}add(e,...i){const a=this.polygons.get(e);a?a.push(...i):this.polygons.set(e,i)}merge(e){for(const[i,a]of e.polygons)this.add(i,...a)}}class eu{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=Vt&&i>=Vt}static evaluate(e){if(e.length===0)return new eu;let i=[];for(const T of e)i.push(...T.portals);if(i.length===0)return new eu;for(const T of i){const A=T.va,M=T.vb;(eu.isOnBorder(A.x,M.x)||eu.isOnBorder(A.y,M.y))&&(T.type="border")}const a=i.filter(T=>T.type!=="unevaluated"),o=i.filter(T=>T.type==="unevaluated");if(o.length===0)return new eu;o.sort((T,A)=>T.hash===A.hash?T.isTunnel===A.isTunnel?0:T.isTunnel?-1:1:T.hash<A.hash?1:-1),i=a.concat(o);let d=a.length,p=d,x=d;do if(p++,p===i.length||i[d].hash!==i[p].hash){if(p-d==2){x<d&&(i[x]=i[d],i[d]=null);const T=i[x],A=i[p-1];T.type=T.isTunnel!==A.isTunnel?"tunnel":"polygon",T.connection={a:T.connection.a,b:A.connection.a},x++}d=p}while(d!==i.length);return i.splice(x),i.sort((T,A)=>T.hash<A.hash?1:-1),{portals:i}}}si(eu,"ElevationPortalGraph"),si(ep,"ElevationPolygons");class X1{constructor(e,i,a){this.outPositions=e,this.outNormals=i,this.outIndices=a,this.vertexLookup=new Map}addVertex(e,i,a){let o=e[2];a!=null&&(o*=a);const d=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,p=this.vertexLookup.get(d);if(p!=null)return p;const x=this.outPositions.length;this.vertexLookup.set(d,x);const T=Math.trunc(16384*i[0]),A=Math.trunc(16384*i[1]),M=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],o),this.outNormals.emplaceBack(T,A,M),x}addTriangle(e,i,a){this.outIndices.emplaceBack(e,i,a)}addTriangles(e,i,a){if(e.length===0)return;const o=a.length===1,d=xt(),p=xt();for(let x=0;x<e.length;x+=3){const T=i[e[x+0]],A=i[e[x+1]],M=i[e[x+2]],z=o?a[0]:a[e[x+1]],D=o?a[0]:a[e[x+2]];er(d,T.x,T.y,o?a[0]:a[e[x+0]]);const k=this.addVertex(d,p);er(d,A.x,A.y,z);const B=this.addVertex(d,p);er(d,M.x,M.y,D);const W=this.addVertex(d,p);this.outIndices.emplaceBack(k,B,W)}}addQuad(e,i,a,o,d,p){const x=this.addVertex(e,d,p),T=this.addVertex(i,d,p),A=this.addVertex(a,d,p),M=this.addVertex(o,d,p);this.addTriangle(x,T,A),this.addTriangle(A,M,x)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class sa{constructor(e,i,a,o){this.unevaluatedPortals=new eu,this.portalPolygons=new ep,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Bd,this.vertexNormals=new Fd,this.indexArray=new cs,this.tileToMeters=Ze(e),this.bridgeProgramConfigurations=new $s(i,{zoom:a,lut:o},d=>d!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new $s(i,{zoom:a,lut:o},d=>d!=="fill-bridge-guard-rail-color")}addVertices(e,i){const a=this.unevalVertices.length;for(let o=0;o<e.length;o++)this.unevalVertices.push(e[o]),this.unevalHeights.push(i[o]);return a}addTriangles(e,i,a){const o=a?this.unevalTunnelTriangles:this.unevalTriangles;for(const d of e)o.push(d+i)}addRenderableRing(e,i,a,o,d,p){const x=[new Ct(d.min.x,d.min.y),new Ct(d.max.x,d.min.y),new Ct(d.max.x,d.max.y),new Ct(d.min.x,d.max.y)];for(let T=0;T<a-1;T++){const A=i+T,M=A+1,z=this.unevalVertices[A],D=this.unevalVertices[M];if(!(z.x>=d.min.x&&z.x<=d.max.x&&z.y>=d.min.y&&z.y<=d.max.y||D.x>=d.min.x&&D.x<=d.max.x&&D.y>=d.min.y&&D.y<=d.max.y||ia(z,D,x))||this.isOnBorder(z.x,D.x)||this.isOnBorder(z.y,D.y))continue;const k=sa.computeEdgeHash(this.unevalVertices[A],this.unevalVertices[M]);let B,W=this.vertexHashLookup.get(sa.computePosHash(z));W!=null?B=W.next:(W=this.vertexHashLookup.get(sa.computePosHash(D)),B=W!=null?W.prev:k),this.unevalEdges.push({polygonIdx:e,a:A,b:M,hash:k,portalHash:B,isTunnel:o,type:"unevaluated",featureInfo:p})}}addPortalCandidates(e,i,a,o,d){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:d});const p=i[0];this.vertexHashLookup.clear();let x=sa.computeEdgeHash(p[p.length-2],p[p.length-1]);for(let T=0;T<p.length-1;T++){const A=p[T+0],M=p[T+1],z=oa(M.x-A.x,M.y-A.y),D=os(z);if(D===0)continue;let k="unevaluated";const B=o.pointElevation(A),W=o.pointElevation(M);Math.abs(B)<.01&&Math.abs(W)<.01?k="entrance":(this.isOnBorder(A.x,M.x)||this.isOnBorder(A.y,M.y))&&(k="border");const Y=sa.computeEdgeHash(A,M);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:A,vb:M,vab:z,length:D,hash:Y,isTunnel:a,type:k});const K=sa.computePosHash(A);this.vertexHashLookup.set(K,{prev:x,next:Y}),x=Y}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),a=D=>{D.primitiveLength=this.indexArray.length-D.primitiveOffset},o=new X1(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const d=i(),p=i(),x=i(),T=(D,k)=>{D.sort((W,Y)=>W.type===k&&Y.type!==k?-1:W.type!==k&&Y.type===k?1:0);const B=D.findIndex(W=>W.type!==k);return B>=0?B:D.length};let A=0;this.unevalEdges.length>0&&(A=T(this.unevalEdges,"none"),this.constructBridgeStructures(o,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},this.tileToMeters)),a(x);const M=i(),z=i();if(this.unevalEdges.length>0){const D=this.unevalEdges.splice(A),k=T(D,"tunnel")+A;this.unevalEdges.push(...D),this.constructTunnelStructures(o,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},{min:A,max:k})}a(M),o.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),a(z),o.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),a(p),o.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),a(d),this.maskSegments=Wr.simpleSegment(0,z.primitiveOffset,0,z.primitiveLength),this.depthSegments=Wr.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength),this.renderableBridgeSegments=Wr.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableTunnelSegments=Wr.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.shadowCasterSegments=Wr.simpleSegment(0,d.primitiveOffset,0,d.primitiveLength)}update(e,i,a,o,d,p,x,T){this.bridgeProgramConfigurations.updatePaintArrays(e,i,d,a,o,p,x,T),this.tunnelProgramConfigurations.updatePaintArrays(e,i,d,a,o,p,x,T)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,C0.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,c_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,a,o,d){const p=(x,T)=>{for(let A=0;A<T.length-1;A++){const M=T[A].featureIndex,z=T[A+1].vertexStart,D=e.feature(M);x.populatePaintArrays(z,D,M,{},a,i,o,void 0,d)}};p(this.bridgeProgramConfigurations,this.bridgeFeatureSections),p(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,a,o,d){const p=new Map;for(let x=o;x<d;x++){const T=a[x],A=T.a,M=T.b,z=sa.computePosHash(e[A]),D=sa.computePosHash(e[M]);let k=p.get(z);k||(k={},p.set(z,k));let B=p.get(D);B||(B={},p.set(D,B)),i[A]<=0&&i[M]<=0||(k.to=M,B.from=A)}return p}isTerminalVertex(e,i){const a=sa.computePosHash(this.unevalVertices[e]),o=i.get(a);return!o||!o.from||!o.to}constructBridgeStructures(e,i,a,o,d,p){e.clearVertexLookup();const x=this.computeVertexConnections(i,a,o,d.min,d.max),T=1/p,A=.5*T,M=(Et,jt)=>er(Et,i[jt].x,i[jt].y,a[jt]*T),z=xt(),D=xt(),k=xt(),B=xt(),W=xt(),Y=(Et,jt)=>{const ht=x.get(sa.computePosHash(i[jt])),At=ht.from,at=ht.to;if(!At||!at)return;M(z,At),M(D,jt),M(k,at),Cr(B),zr(z,D)||(Er(W,D,z),_i(B,W)),zr(k,D)||(Er(W,k,D),Jt(B,B,_i(W,W)));const et=ds(B);return et>0?Ht(Et,B,1/et):void 0};let K=Number.POSITIVE_INFINITY;this.sortSubarray(o,d.min,d.max,(Et,jt)=>Et.featureInfo.featureIndex-jt.featureInfo.featureIndex);const ne=xt(),se=xt(),he=xt(),Re=xt(),Me=xt(),Ne=xt(),Fe=xt(),Ue=xt(),ft=xt(),$e=[xt(),xt(),xt(),xt()],yt=[xt(),xt(),xt(),xt()],It=[{coord:new Ct(0,0),height:0},{coord:new Ct(0,0),height:0}],bt=(Et,jt)=>Et>jt;for(let Et=d.min;Et<d.max;Et++){const jt=o[Et];if(!jt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(It,i,a,jt,bt))continue;const[ht,At]=It;if(er(ne,ht.coord.x,ht.coord.y,T*ht.height),er(se,At.coord.x,At.coord.y,T*At.height),zr(ne,se))continue;Er(he,se,ne),_i(he,he);const at=Y(Ue,jt.a)||he,et=Y(ft,jt.b)||he;er(Re,at[1],-at[0],0),_i(Re,Re),er(Me,et[1],-et[0],0),_i(Me,Me),Ai(Ue,Re,at),_i(Ne,Ue),Ai(Ue,Me,et),_i(Fe,Ue),Jt($e[0],ne,Ht(Ue,Er(Ue,Re,Ne),A)),Jt($e[1],ne,Ht(Ue,Jt(Ue,Re,Ne),A)),Jt($e[2],ne,Ht(Ue,Ne,A)),$e[3]=ne,Jt(yt[0],se,Ht(Ue,Er(Ue,Me,Fe),A)),Jt(yt[1],se,Ht(Ue,Jt(Ue,Me,Fe),A)),Jt(yt[2],se,Ht(Ue,Fe,A)),yt[3]=se,K=this.addFeatureSection(jt.featureInfo.featureIndex,K,this.bridgeFeatureSections,e);const kt=e.addVertex($e[0],Re,p),Ot=e.addVertex($e[1],Re,p),bi=e.addVertex(yt[0],Me,p),oi=e.addVertex(yt[1],Me,p);e.addTriangle(kt,Ot,bi),e.addTriangle(Ot,oi,bi);const fi=e.addVertex($e[1],Ne,p),qt=e.addVertex($e[2],Ne,p),vi=e.addVertex(yt[1],Fe,p),Gi=e.addVertex(yt[2],Fe,p);e.addTriangle(fi,qt,vi),e.addTriangle(qt,Gi,vi),Wi(Re,Re),Wi(Me,Me);const Xt=e.addVertex($e[2],Re,p),mi=e.addVertex($e[3],Re,p),Ni=e.addVertex(yt[2],Me,p),Qi=e.addVertex(yt[3],Me,p);e.addTriangle(Xt,mi,Ni),e.addTriangle(mi,Qi,Ni);const dr=this.isTerminalVertex(jt.a,x),rr=this.isTerminalVertex(jt.b,x);ht.height<.01&&dr&&e.addQuad($e[3],$e[2],$e[1],$e[0],Wi(at,at),p),At.height<.01&&rr&&e.addQuad(yt[0],yt[1],yt[2],yt[3],et,p)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,a,o,d,p){e.clearVertexLookup();let x=Number.POSITIVE_INFINITY;const T=(K,ne)=>K.featureInfo.featureIndex-ne.featureInfo.featureIndex;this.sortSubarray(o,d.min,d.max,T),this.sortSubarray(o,p.min,p.max,T);const A=K=>_i(K,K),M=[{coord:new Ct(0,0),height:0},{coord:new Ct(0,0),height:0}],z=(K,ne)=>K<ne,D=xt(),k=xt(),B=xt(),W=xt(),Y=xt();for(let K=d.min;K<d.max;K++){if(!this.prepareEdgePoints(M,i,a,o[K],z))continue;const[ne,se]=M,he=A(er(Y,-(se.coord.y-ne.coord.y),se.coord.x-ne.coord.x,0));x=this.addFeatureSection(o[K].featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad(er(D,ne.coord.x,ne.coord.y,ne.height),er(k,se.coord.x,se.coord.y,se.height),er(B,se.coord.x,se.coord.y,o[K].isTunnel?-.1:0),er(W,ne.coord.x,ne.coord.y,o[K].isTunnel?-.1:0),he)}for(let K=p.min;K<p.max;K++){const ne=o[K];ne.isTunnel&&([ne.a,ne.b]=[ne.b,ne.a]);const se=i[ne.a],he=i[ne.b],Re=A(er(Y,-(he.y-se.y),he.x-se.x,0));x=this.addFeatureSection(ne.featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad(er(D,he.x,he.y,0),er(k,se.x,se.y,0),er(B,se.x,se.y,a[ne.a]+4),er(W,he.x,he.y,a[ne.b]+4),Re),e.addQuad(er(D,se.x,se.y,0),er(k,he.x,he.y,0),er(B,he.x,he.y,a[ne.b]+4),er(W,se.x,se.y,a[ne.a]+4),Re)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,a,o){e.coord.x=i,e.coord.y=a,e.height=o}prepareEdgePoints(e,i,a,o,d){let p=i[o.a].x,x=i[o.a].y,T=i[o.b].x,A=i[o.b].y,M=a[o.a],z=a[o.b];const D=d(M,0),k=d(z,0);if(D&&k)return this.setElevatedPoint(e[0],p,x,M),this.setElevatedPoint(e[1],T,A,z),!0;if(!D&&!k)return!1;if(D){if(!k){const B=z/(z-M);T=Li(T,p,B),A=Li(A,x,B),z=Li(z,M,B)}}else{const B=M/(M-z);p=Li(p,T,B),x=Li(x,A,B),M=Li(M,z,B)}return this.setElevatedPoint(e[0],p,x,M),this.setElevatedPoint(e[1],T,A,z),!0}prepareEdges(e,i){if(i.length===0)return;i.sort((x,T)=>x.hash===T.hash?T.polygonIdx-x.polygonIdx:T.hash>x.hash?1:-1);let a=0,o=0,d=0,p=i[a].polygonIdx;do o++,(o===i.length||i[a].hash!==i[o].hash)&&((o-a==1||i[o-1].polygonIdx!==p)&&(d<a&&(i[d]=i[a],i[a]=null),i[d].type="none",d++),a=o,a!==i.length&&(p=i[a].polygonIdx));while(a!==i.length);if(i.splice(d),i.length!==0&&e.length!==0){i.sort((A,M)=>A.portalHash<M.portalHash?1:-1);let x=0,T=0;for(;x!==i.length&&T!==e.length;){const A=i[x],M=e[T];A.portalHash>M.hash?x++:M.hash>A.portalHash?T++:(A.type=M.type,x++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=Vt&&i>=Vt}addFeatureSection(e,i,a,o){return e!==i&&(i=e,a.push({featureIndex:e,vertexStart:o.getVertexCount()}),o.clearVertexLookup()),i}sortSubarray(e,i,a,o){const d=e.slice(i,a);d.sort(o),e.splice(i,d.length,...d)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(sa.computePosHash(e))<<32n|BigInt(sa.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var tp,p_={exports:{}},um=(tp||(tp=1,function(r,e){(function(i){function a(pe,ge){return pe>ge?1:pe<ge?-1:0}var o=function(pe,ge){pe===void 0&&(pe=a),ge===void 0&&(ge=!1),this._compare=pe,this._root=null,this._size=0,this._noDuplicates=!!ge},d={size:{configurable:!0}};function p(pe,ge,st,dt,Wt){var Zt=Wt-dt;if(Zt>0){var ui=dt+Math.floor(Zt/2),Ei={key:ge[ui],data:st[ui],parent:pe};return Ei.left=p(Ei,ge,st,dt,ui),Ei.right=p(Ei,ge,st,ui+1,Wt),Ei}return null}function x(pe,ge,st,dt,Wt){if(!(st>=dt)){for(var Zt=pe[st+dt>>1],ui=st-1,Ei=dt+1;;){do ui++;while(Wt(pe[ui],Zt)<0);do Ei--;while(Wt(pe[Ei],Zt)>0);if(ui>=Ei)break;var fr=pe[ui];pe[ui]=pe[Ei],pe[Ei]=fr,fr=ge[ui],ge[ui]=ge[Ei],ge[Ei]=fr}x(pe,ge,st,Ei,Wt),x(pe,ge,Ei+1,dt,Wt)}}o.prototype.rotateLeft=function(pe){var ge=pe.right;ge&&(pe.right=ge.left,ge.left&&(ge.left.parent=pe),ge.parent=pe.parent),pe.parent?pe===pe.parent.left?pe.parent.left=ge:pe.parent.right=ge:this._root=ge,ge&&(ge.left=pe),pe.parent=ge},o.prototype.rotateRight=function(pe){var ge=pe.left;ge&&(pe.left=ge.right,ge.right&&(ge.right.parent=pe),ge.parent=pe.parent),pe.parent?pe===pe.parent.left?pe.parent.left=ge:pe.parent.right=ge:this._root=ge,ge&&(ge.right=pe),pe.parent=ge},o.prototype._splay=function(pe){for(;pe.parent;){var ge=pe.parent;ge.parent?ge.left===pe&&ge.parent.left===ge?(this.rotateRight(ge.parent),this.rotateRight(ge)):ge.right===pe&&ge.parent.right===ge?(this.rotateLeft(ge.parent),this.rotateLeft(ge)):ge.left===pe&&ge.parent.right===ge?(this.rotateRight(ge),this.rotateLeft(ge)):(this.rotateLeft(ge),this.rotateRight(ge)):ge.left===pe?this.rotateRight(ge):this.rotateLeft(ge)}},o.prototype.splay=function(pe){for(var ge,st,dt,Wt,Zt;pe.parent;)(st=(ge=pe.parent).parent)&&st.parent?((dt=st.parent).left===st?dt.left=pe:dt.right=pe,pe.parent=dt):(pe.parent=null,this._root=pe),Wt=pe.left,Zt=pe.right,pe===ge.left?(st&&(st.left===ge?(ge.right?(st.left=ge.right,st.left.parent=st):st.left=null,ge.right=st,st.parent=ge):(Wt?(st.right=Wt,Wt.parent=st):st.right=null,pe.left=st,st.parent=pe)),Zt?(ge.left=Zt,Zt.parent=ge):ge.left=null,pe.right=ge,ge.parent=pe):(st&&(st.right===ge?(ge.left?(st.right=ge.left,st.right.parent=st):st.right=null,ge.left=st,st.parent=ge):(Zt?(st.left=Zt,Zt.parent=st):st.left=null,pe.right=st,st.parent=pe)),Wt?(ge.right=Wt,Wt.parent=ge):ge.right=null,pe.left=ge,ge.parent=pe)},o.prototype.replace=function(pe,ge){pe.parent?pe===pe.parent.left?pe.parent.left=ge:pe.parent.right=ge:this._root=ge,ge&&(ge.parent=pe.parent)},o.prototype.minNode=function(pe){if(pe===void 0&&(pe=this._root),pe)for(;pe.left;)pe=pe.left;return pe},o.prototype.maxNode=function(pe){if(pe===void 0&&(pe=this._root),pe)for(;pe.right;)pe=pe.right;return pe},o.prototype.insert=function(pe,ge){var st=this._root,dt=null,Wt=this._compare;if(this._noDuplicates)for(;st;){if(dt=st,Wt(st.key,pe)===0)return;st=Wt(st.key,pe)<0?st.right:st.left}else for(;st;)dt=st,st=Wt(st.key,pe)<0?st.right:st.left;return st={key:pe,data:ge,left:null,right:null,parent:dt},dt?Wt(dt.key,st.key)<0?dt.right=st:dt.left=st:this._root=st,this.splay(st),this._size++,st},o.prototype.find=function(pe){for(var ge=this._root,st=this._compare;ge;){var dt=st(ge.key,pe);if(dt<0)ge=ge.right;else{if(!(dt>0))return ge;ge=ge.left}}return null},o.prototype.contains=function(pe){for(var ge=this._root,st=this._compare;ge;){var dt=st(pe,ge.key);if(dt===0)return!0;ge=dt<0?ge.left:ge.right}return!1},o.prototype.remove=function(pe){var ge=this.find(pe);if(!ge)return!1;if(this.splay(ge),ge.left)if(ge.right){var st=this.minNode(ge.right);st.parent!==ge&&(this.replace(st,st.right),st.right=ge.right,st.right.parent=st),this.replace(ge,st),st.left=ge.left,st.left.parent=st}else this.replace(ge,ge.left);else this.replace(ge,ge.right);return this._size--,!0},o.prototype.removeNode=function(pe){if(!pe)return!1;if(this.splay(pe),pe.left)if(pe.right){var ge=this.minNode(pe.right);ge.parent!==pe&&(this.replace(ge,ge.right),ge.right=pe.right,ge.right.parent=ge),this.replace(pe,ge),ge.left=pe.left,ge.left.parent=ge}else this.replace(pe,pe.left);else this.replace(pe,pe.right);return this._size--,!0},o.prototype.erase=function(pe){var ge=this.find(pe);if(ge){this.splay(ge);var st=ge.left,dt=ge.right,Wt=null;st&&(st.parent=null,Wt=this.maxNode(st),this.splay(Wt),this._root=Wt),dt&&(st?Wt.right=dt:this._root=dt,dt.parent=Wt),this._size--}},o.prototype.pop=function(){var pe=this._root,ge=null;if(pe){for(;pe.left;)pe=pe.left;ge={key:pe.key,data:pe.data},this.remove(pe.key)}return ge},o.prototype.next=function(pe){var ge=pe;if(ge)if(ge.right)for(ge=ge.right;ge&&ge.left;)ge=ge.left;else for(ge=pe.parent;ge&&ge.right===pe;)pe=ge,ge=ge.parent;return ge},o.prototype.prev=function(pe){var ge=pe;if(ge)if(ge.left)for(ge=ge.left;ge&&ge.right;)ge=ge.right;else for(ge=pe.parent;ge&&ge.left===pe;)pe=ge,ge=ge.parent;return ge},o.prototype.forEach=function(pe){for(var ge=this._root,st=[],dt=!1,Wt=0;!dt;)ge?(st.push(ge),ge=ge.left):st.length>0?(pe(ge=st.pop(),Wt++),ge=ge.right):dt=!0;return this},o.prototype.range=function(pe,ge,st,dt){for(var Wt=[],Zt=this._compare,ui=this._root;Wt.length!==0||ui;)if(ui)Wt.push(ui),ui=ui.left;else{if(Zt((ui=Wt.pop()).key,ge)>0)break;if(Zt(ui.key,pe)>=0&&st.call(dt,ui))return this;ui=ui.right}return this},o.prototype.keys=function(){for(var pe=this._root,ge=[],st=[],dt=!1;!dt;)pe?(ge.push(pe),pe=pe.left):ge.length>0?(pe=ge.pop(),st.push(pe.key),pe=pe.right):dt=!0;return st},o.prototype.values=function(){for(var pe=this._root,ge=[],st=[],dt=!1;!dt;)pe?(ge.push(pe),pe=pe.left):ge.length>0?(pe=ge.pop(),st.push(pe.data),pe=pe.right):dt=!0;return st},o.prototype.at=function(pe){for(var ge=this._root,st=[],dt=!1,Wt=0;!dt;)if(ge)st.push(ge),ge=ge.left;else if(st.length>0){if(ge=st.pop(),Wt===pe)return ge;Wt++,ge=ge.right}else dt=!0;return null},o.prototype.load=function(pe,ge,st){if(pe===void 0&&(pe=[]),ge===void 0&&(ge=[]),st===void 0&&(st=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var dt=pe.length;return st&&x(pe,ge,0,dt-1,this._compare),this._root=p(null,pe,ge,0,dt),this._size=dt,this},o.prototype.min=function(){var pe=this.minNode(this._root);return pe?pe.key:null},o.prototype.max=function(){var pe=this.maxNode(this._root);return pe?pe.key:null},o.prototype.isEmpty=function(){return this._root===null},d.size.get=function(){return this._size},o.createTree=function(pe,ge,st,dt,Wt){return new o(st,Wt).load(pe,ge,dt)},Object.defineProperties(o.prototype,d);var T=0,A=1,M=2,z=3,D=0,k=1,B=2,W=3;function Y(pe,ge,st){ge===null?(pe.inOut=!1,pe.otherInOut=!0):(pe.isSubject===ge.isSubject?(pe.inOut=!ge.inOut,pe.otherInOut=ge.otherInOut):(pe.inOut=!ge.otherInOut,pe.otherInOut=ge.isVertical()?!ge.inOut:ge.inOut),ge&&(pe.prevInResult=!K(ge,st)||ge.isVertical()?ge.prevInResult:ge));var dt=K(pe,st);pe.resultTransition=dt?function(Wt,Zt){var ui,Ei=!Wt.inOut,fr=!Wt.otherInOut;switch(Zt){case D:ui=Ei&&fr;break;case k:ui=Ei||fr;break;case W:ui=Ei^fr;break;case B:ui=Wt.isSubject?Ei&&!fr:fr&&!Ei}return ui?1:-1}(pe,st):0}function K(pe,ge){switch(pe.type){case T:switch(ge){case D:return!pe.otherInOut;case k:return pe.otherInOut;case B:return pe.isSubject&&pe.otherInOut||!pe.isSubject&&!pe.otherInOut;case W:return!0}break;case M:return ge===D||ge===k;case z:return ge===B;case A:return!1}return!1}var ne=function(pe,ge,st,dt,Wt){this.left=ge,this.point=pe,this.otherEvent=st,this.isSubject=dt,this.type=Wt||T,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},se={inResult:{configurable:!0}};function he(pe,ge){return pe[0]===ge[0]&&pe[1]===ge[1]}ne.prototype.isBelow=function(pe){var ge=this.point,st=this.otherEvent.point;return this.left?(ge[0]-pe[0])*(st[1]-pe[1])-(st[0]-pe[0])*(ge[1]-pe[1])>0:(st[0]-pe[0])*(ge[1]-pe[1])-(ge[0]-pe[0])*(st[1]-pe[1])>0},ne.prototype.isAbove=function(pe){return!this.isBelow(pe)},ne.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},se.inResult.get=function(){return this.resultTransition!==0},ne.prototype.clone=function(){var pe=new ne(this.point,this.left,this.otherEvent,this.isSubject,this.type);return pe.contourId=this.contourId,pe.resultTransition=this.resultTransition,pe.prevInResult=this.prevInResult,pe.isExteriorRing=this.isExteriorRing,pe.inOut=this.inOut,pe.otherInOut=this.otherInOut,pe},Object.defineProperties(ne.prototype,se);var Re=11102230246251565e-32,Me=134217729,Ne=(3+8*Re)*Re;function Fe(pe,ge,st,dt,Wt){var Zt,ui,Ei,fr,gr=ge[0],ar=dt[0],en=0,Dn=0;ar>gr==ar>-gr?(Zt=gr,gr=ge[++en]):(Zt=ar,ar=dt[++Dn]);var sr=0;if(en<pe&&Dn<st)for(ar>gr==ar>-gr?(Ei=Zt-((ui=gr+Zt)-gr),gr=ge[++en]):(Ei=Zt-((ui=ar+Zt)-ar),ar=dt[++Dn]),Zt=ui,Ei!==0&&(Wt[sr++]=Ei);en<pe&&Dn<st;)ar>gr==ar>-gr?(Ei=Zt-((ui=Zt+gr)-(fr=ui-Zt))+(gr-fr),gr=ge[++en]):(Ei=Zt-((ui=Zt+ar)-(fr=ui-Zt))+(ar-fr),ar=dt[++Dn]),Zt=ui,Ei!==0&&(Wt[sr++]=Ei);for(;en<pe;)Ei=Zt-((ui=Zt+gr)-(fr=ui-Zt))+(gr-fr),gr=ge[++en],Zt=ui,Ei!==0&&(Wt[sr++]=Ei);for(;Dn<st;)Ei=Zt-((ui=Zt+ar)-(fr=ui-Zt))+(ar-fr),ar=dt[++Dn],Zt=ui,Ei!==0&&(Wt[sr++]=Ei);return Zt===0&&sr!==0||(Wt[sr++]=Zt),sr}function Ue(pe){return new Float64Array(pe)}var ft=33306690738754716e-32,$e=22204460492503146e-32,yt=11093356479670487e-47,It=Ue(4),bt=Ue(8),Et=Ue(12),jt=Ue(16),ht=Ue(4);function At(pe,ge,st){var dt=function(Wt,Zt,ui,Ei,fr,gr){var ar=(Zt-gr)*(ui-fr),en=(Wt-fr)*(Ei-gr),Dn=ar-en;if(ar===0||en===0||ar>0!=en>0)return Dn;var sr=Math.abs(ar+en);return Math.abs(Dn)>=ft*sr?Dn:-function(wn,sn,Gr,An,Cn,_n,Tn){var an,_r,ln,Fn,Bi,kr,Rn,Zn,Mn,As,un,ys,Po,Ra,xa,Oo,id,Cs,Bs=wn-Cn,Ma=Gr-Cn,eo=sn-_n,qa=An-_n;It[0]=(xa=(Zn=Bs-(Rn=(kr=Me*Bs)-(kr-Bs)))*(As=qa-(Mn=(kr=Me*qa)-(kr-qa)))-((Ra=Bs*qa)-Rn*Mn-Zn*Mn-Rn*As))-((un=xa-(id=(Zn=eo-(Rn=(kr=Me*eo)-(kr-eo)))*(As=Ma-(Mn=(kr=Me*Ma)-(kr-Ma)))-((Oo=eo*Ma)-Rn*Mn-Zn*Mn-Rn*As)))+(Bi=xa-un))+(Bi-id),It[1]=(Po=Ra-((ys=Ra+un)-(Bi=ys-Ra))+(un-Bi))-((un=Po-Oo)+(Bi=Po-un))+(Bi-Oo),It[2]=ys-((Cs=ys+un)-(Bi=Cs-ys))+(un-Bi),It[3]=Cs;var fp=function(mj,H3){for(var q3=H3[0],Zx=1;Zx<4;Zx++)q3+=H3[Zx];return q3}(0,It),G_=$e*Tn;if(fp>=G_||-fp>=G_||(an=wn-(Bs+(Bi=wn-Bs))+(Bi-Cn),ln=Gr-(Ma+(Bi=Gr-Ma))+(Bi-Cn),_r=sn-(eo+(Bi=sn-eo))+(Bi-_n),Fn=An-(qa+(Bi=An-qa))+(Bi-_n),an===0&&_r===0&&ln===0&&Fn===0)||(G_=yt*Tn+Ne*Math.abs(fp),(fp+=Bs*Fn+qa*an-(eo*ln+Ma*_r))>=G_||-fp>=G_))return fp;ht[0]=(xa=(Zn=an-(Rn=(kr=Me*an)-(kr-an)))*(As=qa-(Mn=(kr=Me*qa)-(kr-qa)))-((Ra=an*qa)-Rn*Mn-Zn*Mn-Rn*As))-((un=xa-(id=(Zn=_r-(Rn=(kr=Me*_r)-(kr-_r)))*(As=Ma-(Mn=(kr=Me*Ma)-(kr-Ma)))-((Oo=_r*Ma)-Rn*Mn-Zn*Mn-Rn*As)))+(Bi=xa-un))+(Bi-id),ht[1]=(Po=Ra-((ys=Ra+un)-(Bi=ys-Ra))+(un-Bi))-((un=Po-Oo)+(Bi=Po-un))+(Bi-Oo),ht[2]=ys-((Cs=ys+un)-(Bi=Cs-ys))+(un-Bi),ht[3]=Cs;var nC=Fe(4,It,4,ht,bt);ht[0]=(xa=(Zn=Bs-(Rn=(kr=Me*Bs)-(kr-Bs)))*(As=Fn-(Mn=(kr=Me*Fn)-(kr-Fn)))-((Ra=Bs*Fn)-Rn*Mn-Zn*Mn-Rn*As))-((un=xa-(id=(Zn=eo-(Rn=(kr=Me*eo)-(kr-eo)))*(As=ln-(Mn=(kr=Me*ln)-(kr-ln)))-((Oo=eo*ln)-Rn*Mn-Zn*Mn-Rn*As)))+(Bi=xa-un))+(Bi-id),ht[1]=(Po=Ra-((ys=Ra+un)-(Bi=ys-Ra))+(un-Bi))-((un=Po-Oo)+(Bi=Po-un))+(Bi-Oo),ht[2]=ys-((Cs=ys+un)-(Bi=Cs-ys))+(un-Bi),ht[3]=Cs;var sC=Fe(nC,bt,4,ht,Et);ht[0]=(xa=(Zn=an-(Rn=(kr=Me*an)-(kr-an)))*(As=Fn-(Mn=(kr=Me*Fn)-(kr-Fn)))-((Ra=an*Fn)-Rn*Mn-Zn*Mn-Rn*As))-((un=xa-(id=(Zn=_r-(Rn=(kr=Me*_r)-(kr-_r)))*(As=ln-(Mn=(kr=Me*ln)-(kr-ln)))-((Oo=_r*ln)-Rn*Mn-Zn*Mn-Rn*As)))+(Bi=xa-un))+(Bi-id),ht[1]=(Po=Ra-((ys=Ra+un)-(Bi=ys-Ra))+(un-Bi))-((un=Po-Oo)+(Bi=Po-un))+(Bi-Oo),ht[2]=ys-((Cs=ys+un)-(Bi=Cs-ys))+(un-Bi),ht[3]=Cs;var aC=Fe(sC,Et,4,ht,jt);return jt[aC-1]}(Wt,Zt,ui,Ei,fr,gr,sr)}(pe[0],pe[1],ge[0],ge[1],st[0],st[1]);return dt>0?-1:dt<0?1:0}function at(pe,ge){var st=pe.point,dt=ge.point;return st[0]>dt[0]?1:st[0]<dt[0]?-1:st[1]!==dt[1]?st[1]>dt[1]?1:-1:function(Wt,Zt,ui,Ei){return Wt.left!==Zt.left?Wt.left?1:-1:At(ui,Wt.otherEvent.point,Zt.otherEvent.point)!==0?Wt.isBelow(Zt.otherEvent.point)?-1:1:!Wt.isSubject&&Zt.isSubject?1:-1}(pe,ge,st)}function et(pe,ge,st){var dt=new ne(ge,!1,pe,pe.isSubject),Wt=new ne(ge,!0,pe.otherEvent,pe.isSubject);return he(pe.point,pe.otherEvent.point)&&console.warn("what is that, a collapsed segment?",pe),dt.contourId=Wt.contourId=pe.contourId,at(Wt,pe.otherEvent)>0&&(pe.otherEvent.left=!0,Wt.left=!1),pe.otherEvent.otherEvent=Wt,pe.otherEvent=dt,st.push(Wt),st.push(dt),st}function kt(pe,ge){return pe[0]*ge[1]-pe[1]*ge[0]}function Ot(pe,ge){return pe[0]*ge[0]+pe[1]*ge[1]}function bi(pe,ge,st){var dt=function(fr,gr,ar,en,Dn){var sr=[gr[0]-fr[0],gr[1]-fr[1]],wn=[en[0]-ar[0],en[1]-ar[1]];function sn(kr,Rn,Zn){return[kr[0]+Rn*Zn[0],kr[1]+Rn*Zn[1]]}var Gr=[ar[0]-fr[0],ar[1]-fr[1]],An=kt(sr,wn),Cn=An*An,_n=Ot(sr,sr);if(Cn>0){var Tn=kt(Gr,wn)/An;if(Tn<0||Tn>1)return null;var an=kt(Gr,sr)/An;return an<0||an>1?null:Tn===0||Tn===1?[sn(fr,Tn,sr)]:an===0||an===1?[sn(ar,an,wn)]:[sn(fr,Tn,sr)]}if((Cn=(An=kt(Gr,sr))*An)>0)return null;var _r=Ot(sr,Gr)/_n,ln=_r+Ot(sr,wn)/_n,Fn=Math.min(_r,ln),Bi=Math.max(_r,ln);return Fn<=1&&Bi>=0?Fn===1?[sn(fr,Fn>0?Fn:0,sr)]:Bi===0?[sn(fr,Bi<1?Bi:1,sr)]:[sn(fr,Fn>0?Fn:0,sr),sn(fr,Bi<1?Bi:1,sr)]:null}(pe.point,pe.otherEvent.point,ge.point,ge.otherEvent.point),Wt=dt?dt.length:0;if(Wt===0||Wt===1&&(he(pe.point,ge.point)||he(pe.otherEvent.point,ge.otherEvent.point))||Wt===2&&pe.isSubject===ge.isSubject)return 0;if(Wt===1)return he(pe.point,dt[0])||he(pe.otherEvent.point,dt[0])||et(pe,dt[0],st),he(ge.point,dt[0])||he(ge.otherEvent.point,dt[0])||et(ge,dt[0],st),1;var Zt=[],ui=!1,Ei=!1;return he(pe.point,ge.point)?ui=!0:at(pe,ge)===1?Zt.push(ge,pe):Zt.push(pe,ge),he(pe.otherEvent.point,ge.otherEvent.point)?Ei=!0:at(pe.otherEvent,ge.otherEvent)===1?Zt.push(ge.otherEvent,pe.otherEvent):Zt.push(pe.otherEvent,ge.otherEvent),ui&&Ei||ui?(ge.type=A,pe.type=ge.inOut===pe.inOut?M:z,ui&&!Ei&&et(Zt[1].otherEvent,Zt[0].point,st),2):Ei?(et(Zt[0],Zt[1].point,st),3):Zt[0]!==Zt[3].otherEvent?(et(Zt[0],Zt[1].point,st),et(Zt[1],Zt[2].point,st),3):(et(Zt[0],Zt[1].point,st),et(Zt[3].otherEvent,Zt[2].point,st),3)}function oi(pe,ge){if(pe===ge)return 0;if(At(pe.point,pe.otherEvent.point,ge.point)!==0||At(pe.point,pe.otherEvent.point,ge.otherEvent.point)!==0)return he(pe.point,ge.point)?pe.isBelow(ge.otherEvent.point)?-1:1:pe.point[0]===ge.point[0]?pe.point[1]<ge.point[1]?-1:1:at(pe,ge)===1?ge.isAbove(pe.point)?-1:1:pe.isBelow(ge.point)?-1:1;if(pe.isSubject!==ge.isSubject)return pe.isSubject?-1:1;var st=pe.point,dt=ge.point;return st[0]===dt[0]&&st[1]===dt[1]?(st=pe.otherEvent.point)[0]===(dt=ge.otherEvent.point)[0]&&st[1]===dt[1]?0:pe.contourId>ge.contourId?1:-1:at(pe,ge)===1?1:-1}var fi=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function qt(pe,ge,st,dt){var Wt,Zt=pe+1,ui=ge[pe].point,Ei=ge.length;for(Zt<Ei&&(Wt=ge[Zt].point);Zt<Ei&&Wt[0]===ui[0]&&Wt[1]===ui[1];){if(!st[Zt])return Zt;++Zt<Ei&&(Wt=ge[Zt].point)}for(Zt=pe-1;st[Zt]&&Zt>dt;)Zt--;return Zt}fi.prototype.isExterior=function(){return this.holeOf==null};var vi=Xt,Gi=Xt;function Xt(pe,ge){if(!(this instanceof Xt))return new Xt(pe,ge);if(this.data=pe||[],this.length=this.data.length,this.compare=ge||mi,this.length>0)for(var st=(this.length>>1)-1;st>=0;st--)this._down(st)}function mi(pe,ge){return pe<ge?-1:pe>ge?1:0}Xt.prototype={push:function(pe){this.data.push(pe),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var pe=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),pe}},peek:function(){return this.data[0]},_up:function(pe){for(var ge=this.data,st=this.compare,dt=ge[pe];pe>0;){var Wt=pe-1>>1,Zt=ge[Wt];if(st(dt,Zt)>=0)break;ge[pe]=Zt,pe=Wt}ge[pe]=dt},_down:function(pe){for(var ge=this.data,st=this.compare,dt=this.length>>1,Wt=ge[pe];pe<dt;){var Zt=1+(pe<<1),ui=Zt+1,Ei=ge[Zt];if(ui<this.length&&st(ge[ui],Ei)<0&&(Zt=ui,Ei=ge[ui]),st(Ei,Wt)>=0)break;ge[pe]=Ei,pe=Zt}ge[pe]=Wt}},vi.default=Gi;var Ni=Math.max,Qi=Math.min,dr=0;function rr(pe,ge,st,dt,Wt,Zt){var ui,Ei,fr,gr,ar,en;for(ui=0,Ei=pe.length-1;ui<Ei;ui++)if(gr=pe[ui+1],ar=new ne(fr=pe[ui],!1,void 0,ge),en=new ne(gr,!1,ar,ge),ar.otherEvent=en,fr[0]!==gr[0]||fr[1]!==gr[1]){ar.contourId=en.contourId=st,Zt||(ar.isExteriorRing=!1,en.isExteriorRing=!1),at(ar,en)>0?en.left=!0:ar.left=!0;var Dn=fr[0],sr=fr[1];Wt[0]=Qi(Wt[0],Dn),Wt[1]=Qi(Wt[1],sr),Wt[2]=Ni(Wt[2],Dn),Wt[3]=Ni(Wt[3],sr),dt.push(ar),dt.push(en)}}var hi=[];function tr(pe,ge,st){typeof pe[0][0][0]=="number"&&(pe=[pe]),typeof ge[0][0][0]=="number"&&(ge=[ge]);var dt=function(sr,wn,sn){var Gr=null;return sr.length*wn.length==0&&(sn===D?Gr=hi:sn===B?Gr=sr:sn!==k&&sn!==W||(Gr=sr.length===0?wn:sr)),Gr}(pe,ge,st);if(dt)return dt===hi?null:dt;var Wt=[1/0,1/0,-1/0,-1/0],Zt=[1/0,1/0,-1/0,-1/0],ui=function(sr,wn,sn,Gr,An){var Cn,_n,Tn,an,_r,ln,Fn=new vi(null,at);for(Tn=0,an=sr.length;Tn<an;Tn++)for(_r=0,ln=(Cn=sr[Tn]).length;_r<ln;_r++)(_n=_r===0)&&dr++,rr(Cn[_r],!0,dr,Fn,sn,_n);for(Tn=0,an=wn.length;Tn<an;Tn++)for(_r=0,ln=(Cn=wn[Tn]).length;_r<ln;_r++)_n=_r===0,An===B&&(_n=!1),_n&&dr++,rr(Cn[_r],!1,dr,Fn,Gr,_n);return Fn}(pe,ge,Wt,Zt,st);if(dt=function(sr,wn,sn,Gr,An){var Cn=null;return(sn[0]>Gr[2]||Gr[0]>sn[2]||sn[1]>Gr[3]||Gr[1]>sn[3])&&(An===D?Cn=hi:An===B?Cn=sr:An!==k&&An!==W||(Cn=sr.concat(wn))),Cn}(pe,ge,Wt,Zt,st))return dt===hi?null:dt;for(var Ei=function(sr){var wn,sn,Gr=function(Tn){var an,_r,ln,Fn,Bi=[];for(_r=0,ln=Tn.length;_r<ln;_r++)((an=Tn[_r]).left&&an.inResult||!an.left&&an.otherEvent.inResult)&&Bi.push(an);for(var kr=!1;!kr;)for(kr=!0,_r=0,ln=Bi.length;_r<ln;_r++)_r+1<ln&&at(Bi[_r],Bi[_r+1])===1&&(Fn=Bi[_r],Bi[_r]=Bi[_r+1],Bi[_r+1]=Fn,kr=!1);for(_r=0,ln=Bi.length;_r<ln;_r++)(an=Bi[_r]).otherPos=_r;for(_r=0,ln=Bi.length;_r<ln;_r++)(an=Bi[_r]).left||(Fn=an.otherPos,an.otherPos=an.otherEvent.otherPos,an.otherEvent.otherPos=Fn);return Bi}(sr),An={},Cn=[],_n=function(){if(!An[wn]){var Tn=Cn.length,an=function(Bi,kr,Rn){var Zn=new fi;if(Bi.prevInResult!=null){var Mn=Bi.prevInResult,As=Mn.outputContourId;if(Mn.resultTransition>0){var un=kr[As];if(un.holeOf!=null){var ys=un.holeOf;kr[ys].holeIds.push(Rn),Zn.holeOf=ys,Zn.depth=kr[As].depth}else kr[As].holeIds.push(Rn),Zn.holeOf=As,Zn.depth=kr[As].depth+1}else Zn.holeOf=null,Zn.depth=kr[As].depth}else Zn.holeOf=null,Zn.depth=0;return Zn}(Gr[wn],Cn,Tn),_r=function(Bi){An[Bi]=!0,Bi<Gr.length&&Gr[Bi]&&(Gr[Bi].outputContourId=Tn)},ln=wn,Fn=wn;for(an.points.push(Gr[wn].point);_r(ln),_r(ln=Gr[ln].otherPos),an.points.push(Gr[ln].point),!((ln=qt(ln,Gr,An,Fn))==Fn||ln>=Gr.length)&&Gr[ln];);Cn.push(an)}};for(wn=0,sn=Gr.length;wn<sn;wn++)_n();return Cn}(function(sr,wn,sn,Gr,An,Cn){for(var _n,Tn,an,_r=new o(oi),ln=[],Fn=Math.min(Gr[2],An[2]);sr.length!==0;){var Bi=sr.pop();if(ln.push(Bi),Cn===D&&Bi.point[0]>Fn||Cn===B&&Bi.point[0]>Gr[2])break;if(Bi.left){Tn=_n=_r.insert(Bi),_n=_n!==(an=_r.minNode())?_r.prev(_n):null,Tn=_r.next(Tn);var kr=_n?_n.key:null;if(Y(Bi,kr,Cn),Tn&&bi(Bi,Tn.key,sr)===2&&(Y(Bi,kr,Cn),Y(Tn.key,Bi,Cn)),_n&&bi(_n.key,Bi,sr)===2){var Rn=_n;Y(kr,(Rn=Rn!==an?_r.prev(Rn):null)?Rn.key:null,Cn),Y(Bi,kr,Cn)}}else Tn=_n=_r.find(Bi=Bi.otherEvent),_n&&Tn&&(_n=_n!==an?_r.prev(_n):null,Tn=_r.next(Tn),_r.remove(Bi),Tn&&_n&&bi(_n.key,Tn.key,sr))}return ln}(ui,0,0,Wt,Zt,st)),fr=[],gr=0;gr<Ei.length;gr++){var ar=Ei[gr];if(ar.isExterior()){for(var en=[ar.points],Dn=0;Dn<ar.holeIds.length;Dn++)en.push(Ei[ar.holeIds[Dn]].points);fr.push(en)}}return fr}var Dr={UNION:k,DIFFERENCE:B,INTERSECTION:D,XOR:W};i.diff=function(pe,ge){return tr(pe,ge,B)},i.intersection=function(pe,ge){return tr(pe,ge,D)},i.operations=Dr,i.union=function(pe,ge){return tr(pe,ge,k)},i.xor=function(pe,ge){return tr(pe,ge,W)},Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,p_.exports)),p_.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function ip(r,e,i,a){const o=[],d=a===0?(p,x,T,A,M,z)=>{p.push(new Ct(z,T+(z-x)/(A-x)*(M-T)))}:(p,x,T,A,M,z)=>{p.push(new Ct(x+(z-T)/(M-T)*(A-x),z))};for(const p of r){const x=[];for(const T of p){if(T.length<=2)continue;const A=[];for(let D=0;D<T.length-1;D++){const k=T[D].x,B=T[D].y,W=T[D+1].x,Y=T[D+1].y,K=a===0?k:B,ne=a===0?W:Y;K<e?ne>e&&d(A,k,B,W,Y,e):K>i?ne<i&&d(A,k,B,W,Y,i):A.push(T[D]),ne<e&&K>=e&&d(A,k,B,W,Y,e),ne>i&&K<=i&&d(A,k,B,W,Y,i)}let M=T[T.length-1];const z=a===0?M.x:M.y;z>=e&&z<=i&&A.push(M),A.length&&(M=A[A.length-1],A[0].x===M.x&&A[0].y===M.y||A.push(A[0]),x.push(A))}x.length&&o.push(x)}return o}function m_(r,e){const i=ug(r),a=ug([e]),o=um.intersection(i,a);return o==null?[]:g_(o)}function cg(r,e){let a=ug(r,65536);const o=[];for(;e.valid();e.next()){const[d,p]=e.get(),x=d.x*65536,T=d.y*65536,A=p.x*65536,M=p.y*65536,z=A-x,D=M-T,k=Math.hypot(z,D);if(k===0)continue;const B=Math.trunc(D/k*3),W=-Math.trunc(z/k*3);o.push([[[x,T],[A,M],[A+B,M+W],[x+B,T+W],[x,T]]])}return o.length>0&&(a=um.diff(a,o)),g_(a,1/65536)}function ug(r,e=1){return[r.map(i=>i.map(a=>[a.x*e,a.y*e]))]}function g_(r,e=1){return r.map(i=>i.map((a,o)=>{const d=a.map(p=>new Ct(p[0]*e,p[1]*e).round());return o>0&&d.reverse(),d}))}class __{constructor(e,i){this.layoutVertexArray=new lc,this.indexArray=new cs,this.lineIndexArray=new rs,this.triangleSegments=new Wr,this.lineSegments=new Wr,this.programConfigurations=new $s(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Ro)}update(e,i,a,o,d,p,x,T){this.programConfigurations.updatePaintArrays(e,i,d,a,o,p,x,T)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ag.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,A0.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,a,o,d,p,x){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,a,o,d,p,void 0,x)}}class hg{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new __(e,!1),this.elevationBufferData=new __(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,a,o){this.hasPattern=lg("fill",this.layers,this.pixelRatio,i);const d=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:x,id:T,index:A,sourceLayerIndex:M}of e){const z=this.layers[0]._featureFilter.needGeometry,D=Rt(x,z);if(!this.layers[0]._featureFilter.filter(new on(this.zoom,{worldview:this.worldview}),D,a))continue;const k=d?d.evaluate(D,{},a,i.availableImages):void 0,B={id:T,properties:x.properties,type:x.type,sourceLayerIndex:M,index:A,geometry:z?D.geometry:$t(x,a,o),patterns:{},sortKey:k};p.push(B)}d&&p.sort((x,T)=>x.sortKey-T.sortKey);for(const x of p){const{geometry:T,index:A,sourceLayerIndex:M}=x;if(this.hasPattern){const z=Kh("fill",this.layers,x,this.zoom,this.pixelRatio,i);this.patternFeatures.push(z)}else this.addFeature(x,T,A,a,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[A].feature,T,A,M,this.index)}}update(e,i,a,o,d,p,x){this.bufferData.update(e,i,a,o,d,p,x,this.worldview),this.elevationBufferData.update(e,i,a,o,d,p,x,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,a,o,d,p,x,this.worldview)}addFeatures(e,i,a,o,d,p){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,a,o,p,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,a,o,d,p=[],x,T){const A=cm(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,A,o,a,T):this.addGeometry(A,this.bufferData),this.bufferData.populatePaintArrays(e,a,d,p,o,x,this.worldview),this.elevationBufferData.populatePaintArrays(e,a,d,p,o,x,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,a,o,d){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,a,o,d,this.worldview))}addElevatedRoadFeature(e,i,a,o,d){const p=new Array,x=Vr.getElevationFeature(e,d);if(!x)return void this.addGeometry(i,this.bufferData);{const A=this.clipPolygonsToTile(i,1);A.length>0&&p.push({polygons:A,elevationFeature:x,elevationTileID:a})}const T={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},a),featureIndex:o};for(const A of p)if(A.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new sa(A.elevationTileID,this.layers,this.zoom,this.lut));const z=A.elevationFeature.isTunnel();let D=0;e.properties.hasOwnProperty(jr)&&(D=+e.properties[jr]);for(const k of A.polygons)this.elevatedStructures.addPortalCandidates(A.elevationFeature.id,k,z,A.elevationFeature,D)}A.elevationFeature.constantHeight==null&&(A.polygons=this.prepareElevatedPolygons(A.polygons,A.elevationFeature,A.elevationTileID));const M=new es(a,A.elevationTileID);this.addElevatedGeometry(A.polygons,M,A.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,o,T)}}addElevatedGeometry(e,i,a,o,d,p){const x={elevation:a,elevationSampler:i,bias:o,index:d,featureInfo:p},[T,A]=this.addGeometry(e,this.elevationBufferData,x);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:T,max:A}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,T),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,A))}addGeometry(e,i,a){let o=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,p=null;a&&(p=a.elevationSampler.constantElevation(a.elevation,a.bias),p!=null&&(o=p,d=p));const x=(T,A,M)=>{if(a!=null)if(A.push(T),p!=null)i.elevatedLayoutVertexArray.emplaceBack(p),M.push(p);else{const z=a.elevationSampler.pointElevation(T,a.elevation,a.bias);i.elevatedLayoutVertexArray.emplaceBack(z),M.push(z),o=Math.min(o,z),d=Math.max(d,z)}};for(const T of e){let A=0;for(const se of T)A+=se.length;const M=i.triangleSegments.prepareSegment(A,i.layoutVertexArray,i.indexArray),z=M.vertexLength,D=[],k=[],B=[],W=[],Y=[],K=i.layoutVertexArray.length;for(const se of T){if(se.length===0)continue;se!==T[0]&&k.push(D.length/2);const he=i.lineSegments.prepareSegment(se.length,i.layoutVertexArray,i.lineIndexArray),Re=he.vertexLength;a&&Y.push(i.layoutVertexArray.length-K),x(se[0],B,W),i.layoutVertexArray.emplaceBack(se[0].x,se[0].y),i.lineIndexArray.emplaceBack(Re+se.length-1,Re),D.push(se[0].x),D.push(se[0].y);for(let Me=1;Me<se.length;Me++)x(se[Me],B,W),i.layoutVertexArray.emplaceBack(se[Me].x,se[Me].y),i.lineIndexArray.emplaceBack(Re+Me-1,Re+Me),D.push(se[Me].x),D.push(se[Me].y);he.vertexLength+=se.length,he.primitiveLength+=se.length}const ne=Xh(D,k);for(let se=0;se<ne.length;se+=3)i.indexArray.emplaceBack(z+ne[se],z+ne[se+1],z+ne[se+2]);if(ne.length>0&&a&&this.elevationMode==="hd-road-base"){const se=a.elevation.isTunnel(),he=a.elevation.safeArea,Re=this.elevatedStructures.addVertices(B,W);this.elevatedStructures.addTriangles(ne,Re,se);const Me=Y.length;if(Me>0){for(let Ne=0;Ne<Me-1;Ne++)this.elevatedStructures.addRenderableRing(a.index,Y[Ne]+Re,Y[Ne+1]-Y[Ne],se,he,a.featureInfo);this.elevatedStructures.addRenderableRing(a.index,Y[Me-1]+Re,B.length-Y[Me-1],se,he,a.featureInfo)}}M.vertexLength+=A,M.primitiveLength+=ne.length/3}return[o,d]}prepareElevatedPolygons(e,i,a){const o=1/Ze(a),d=[];for(const p of e){const x=cg(p,new wr(i,o));d.push(...x)}return d}clipPolygonsToTile(e,i){const a=-i,o=-i,d=Vt+i,p=Vt+i;let x=0;const T=[],A=[];for(;x<e.length;x++){const D=e[x],k=gh(D);(k.min.x>=a&&k.max.x<=d&&k.min.y>=o&&k.max.y<=p?T:A).push(D)}if(T.length===e.length)return e;const M=[new Ct(a,o),new Ct(d,o),new Ct(d,p),new Ct(a,p),new Ct(a,o)],z=T;for(const D of A)z.push(...m_(D,M));return z}}let rp,j0,N0,k0;si(hg,"FillBucket",{omit:["layers","patternFeatures"]}),si(__,"FillBufferData"),si(sa,"ElevatedStructures");class Kd{constructor(e,i,a,o){if(this.triangleCount=i.length/3,this.min=new Ct(0,0),this.max=new Ct(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[d,p]=[e[0].clone(),e[0].clone()];for(let z=1;z<e.length;++z){const D=e[z];d.x=Math.min(d.x,D.x),d.y=Math.min(d.y,D.y),p.x=Math.max(p.x,D.x),p.y=Math.max(p.y,D.y)}if(o){const z=Math.ceil(Math.max(p.x-d.x,p.y-d.y)/o);a=Math.max(a,z)}if(a===0)return;this.min=d,this.max=p;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const T=Math.max(x.x,x.y)/a;this.cellsX=Math.max(1,Math.ceil(x.x/T)),this.cellsY=Math.max(1,Math.ceil(x.y/T)),this.xScale=1/T,this.yScale=1/T;const A=[];for(let z=0;z<this.triangleCount;z++){const D=e[i[3*z+0]].sub(this.min),k=e[i[3*z+1]].sub(this.min),B=e[i[3*z+2]].sub(this.min),W=al(Math.floor(Math.min(D.x,k.x,B.x)),this.xScale,this.cellsX),Y=al(Math.floor(Math.max(D.x,k.x,B.x)),this.xScale,this.cellsX),K=al(Math.floor(Math.min(D.y,k.y,B.y)),this.yScale,this.cellsY),ne=al(Math.floor(Math.max(D.y,k.y,B.y)),this.yScale,this.cellsY),se=new Ct(0,0),he=new Ct(0,0),Re=new Ct(0,0),Me=new Ct(0,0);for(let Ne=K;Ne<=ne;++Ne){se.y=he.y=Ne*T,Re.y=Me.y=(Ne+1)*T;for(let Fe=W;Fe<=Y;++Fe)se.x=Re.x=Fe*T,he.x=Me.x=(Fe+1)*T,(Cl(D,k,B,se,he,Me)||Cl(D,k,B,se,Me,Re))&&A.push({cellIdx:Ne*this.cellsX+Fe,triIdx:z})}}if(A.length===0)return;A.sort((z,D)=>z.cellIdx-D.cellIdx||z.triIdx-D.triIdx);let M=0;for(;M<A.length;){const z=A[M].cellIdx,D={start:this.payload.length,len:0};for(;M<A.length&&A[M].cellIdx===z;)++D.len,this.payload.push(A[M++].triIdx);this.cells[z]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const a=al(e.x-this.min.x,this.xScale,this.cellsX),o=al(e.y-this.min.y,this.yScale,this.cellsY),d=this.cells[o*this.cellsX+a];if(d){this._lazyInitLookup();for(let p=0;p<d.len;p++){const x=this.payload[d.start+p],T=Math.floor(x/8),A=1<<x%8;if(!(this.lookup[T]&A)&&(this.lookup[T]|=A,i.push(x),i.length===this.triangleCount))return}}}query(e,i,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const o=al(e.x-this.min.x,this.xScale,this.cellsX),d=al(i.x-this.min.x,this.xScale,this.cellsX),p=al(e.y-this.min.y,this.yScale,this.cellsY),x=al(i.y-this.min.y,this.yScale,this.cellsY);for(let T=p;T<=x;T++)for(let A=o;A<=d;A++){const M=this.cells[T*this.cellsX+A];if(M)for(let z=0;z<M.len;z++){const D=this.payload[M.start+z],k=Math.floor(D/8),B=1<<D%8;if(!(this.lookup[k]&B)&&(this.lookup[k]|=B,a.push(D),a.length===this.triangleCount))return}}}}function al(r,e,i){return Math.max(0,Math.min(i-1,Math.floor(r*e)))}si(Kd,"TriangleGridIndex");class dg{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,i){for(const a of this.footprints)i.push({footprint:a,id:e})}populate(e,i,a,o){const d=[];for(const{feature:p,id:x,index:T,sourceLayerIndex:A}of e){const M=this.layers[0]._featureFilter.needGeometry,z=Rt(p,M);if(!this.layers[0]._featureFilter.filter(new on(this.zoom,{worldview:this.worldview}),z,a))continue;const D={id:x,properties:p.properties,type:p.type,sourceLayerIndex:A,index:T,geometry:M?z.geometry:$t(p,a,o),patterns:{}};d.push(D)}for(const p of d){const{geometry:x,index:T,sourceLayerIndex:A}=p;this.addFeature(p,x,T,a,{},i.availableImages,i.brightness),i.featureIndex.insert(e[T].feature,x,T,A,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,a,o,d,p,x){}destroy(){}addFeature(e,i,a,o,d,p=[],x){for(const T of cm(i,2)){const A=[],M=[],z=[],D=new Ct(1/0,1/0),k=new Ct(-1/0,-1/0);for(const Y of T)if(Y.length!==0){Y!==T[0]&&z.push(M.length/2);for(let K=0;K<Y.length;K++)M.push(Y[K].x),M.push(Y[K].y),A.push(Y[K]),D.x=Math.min(D.x,Y[K].x),D.y=Math.min(D.y,Y[K].y),k.x=Math.max(k.x,Y[K].x),k.y=Math.max(k.y,Y[K].y)}const B=Xh(M,z),W=new Kd(A,B,8,256);this.footprints.push({vertices:A,indices:B,grid:W,min:D,max:k})}}}si(dg,"ClipBucket",{omit:["layers"]});const Y1=xr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),hm=xr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),K1=xr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),B0=xr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),F0=xr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),U0=xr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:V0}=Y1,Jd=Number.MAX_SAFE_INTEGER,y_=Jd-1;function dm(r,e,i,a){return r.order<e||r.order===Jd||!(r.clipMask&i)||function(o,d){return d.length!==0&&d.find(p=>p===o)===void 0}(a,r.clipScope)}function fg(r,e){return r.x-e.x||r.y-e.y}function H0(r,e){return fg(r.min,e.min)===0&&fg(r.max,e.max)===0}function fm(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function np(r,e){if(r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(r[i].sourceId!==e[i].sourceId||!H0(r[i],e[i])||r[i].order!==e[i].order||r[i].clipMask!==e[i].clipMask||!Hs(r[i].clipScope,e[i].clipScope))return!1;return!0}function pm(r,e,i){const a=1/Vt,o=1/(1<<i.canonical.z),d=(e.x*a+i.canonical.x)*o+i.wrap,p=(e.y*a+i.canonical.y)*o;return{min:new Ct((r.x*a+i.canonical.x)*o+i.wrap,(r.y*a+i.canonical.y)*o),max:new Ct(d,p)}}function x_(r,e,i){const a=1<<i.canonical.z,o=((e.x-i.wrap)*a-i.canonical.x)*Vt,d=(e.y*a-i.canonical.y)*Vt;return{min:new Ct(((r.x-i.wrap)*a-i.canonical.x)*Vt,(r.y*a-i.canonical.y)*Vt),max:new Ct(o,d)}}function pg(r,e,i,a,o,d,p){const x=r.indices,T=r.vertices,A=[];for(let M=a;M<a+o;M+=3){const z=e[i[M+0]+d],D=e[i[M+1]+d],k=e[i[M+2]+d],B=Math.min(z.x,D.x,k.x),W=Math.max(z.x,D.x,k.x),Y=Math.min(z.y,D.y,k.y),K=Math.max(z.y,D.y,k.y);A.length=0,r.grid.query(new Ct(B,Y),new Ct(W,K),A);for(let ne=0;ne<A.length;ne++){const se=A[ne];if(Cl(T[x[3*se+0]],T[x[3*se+1]],T[x[3*se+2]],z,D,k,p))return!0}}return!1}function mg(r,e,i,a){if(!r||!i)return!1;let o=r.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(i.vertices.length<r.vertices.length)return mg(i,a,r,e);const d=e.canonical,p=a.canonical,x=Math.pow(2,p.z-d.z);o=r.vertices.map(T=>new Ct((T.x+d.x*Vt)*x-p.x*Vt,(T.y+d.y*Vt)*x-p.y*Vt))}return pg(i,o,r.indices,0,r.indices.length,0,0)}function Xu(r,e,i,a){const o=Math.pow(2,a.z-i.z);return new Ct((r+i.x*Vt)*o-a.x*Vt,(e+i.y*Vt)*o-a.y*Vt)}function tu(r,e){const i=[];e.grid.queryPoint(r,i);const a=e.indices,o=e.vertices;for(let d=0;d<i.length;d++){const p=i[d];if(Ss([o[a[3*p+0]],o[a[3*p+1]],o[a[3*p+2]]],r))return!0}return!1}const iu=[new Ct(0,0),new Ct(Vt,0),new Ct(Vt,Vt),new Ct(0,Vt)];function sp(r,e){const i=[];let a=[];if(!e||r.length<2)return[r];if(r.length===2)return ia(r[0],r[1],iu)?[r]:[];for(let o=0;o<r.length+2;o++){const d=r[o%r.length],p=r[(o+1)%r.length],x=ia(o===0?r[r.length-1]:r[(o-1)%r.length],d,iu),T=ia(d,p,iu),A=x||T;A&&a.push(d),A&&T||a.length>0&&(a.length>1&&i.push(a),a=[])}return a.length>1&&i.push(a),i}const Qd=St.types,Jh=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],J1=["fill-extrusion-flood-light-ground-radius"],q0=Math.pow(2,13),mm=Math.pow(2,15)-1,G0=new Ct(0,1),Yu=2147483648;function Qh(r,e,i,a,o,d,p,x){r.emplaceBack((e<<1)+p,(i<<1)+d,(Math.floor(a*q0)<<1)+o,Math.round(x))}function ap(r,e,i){r.emplaceBack(e.x*Vt,e.y*Vt,i?1:0)}function gg(r,e,i,a,o,d){r.emplaceBack(e.x,e.y,(i.x<<1)+a,(i.y<<1)+o,d)}function ed(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class gm{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class v_{constructor(){this.centroidXY=new Ct(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ct(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ct(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Ct(this.max.x-this.min.x,this.max.y-this.min.y)}}class op{constructor(){this.acc=new Ct(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,a){this.accCount++,this.acc._add(i);let o=!!this.borders;i.x<e.min.x?(e.min.x=i.x,o=!0):i.x>e.max.x&&(e.max.x=i.x,o=!0),i.y<e.min.y?(e.min.y=i.y,o=!0):i.y>e.max.y&&(e.max.y=i.y,o=!0),((i.x===0||i.x===Vt)&&i.x===a.x)!=((i.y===0||i.y===Vt)&&i.y===a.y)&&this.processBorderOverlap(i,a),o&&this.checkBorderIntersection(i,a)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Li(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Vt!=e.x>Vt&&this.addBorderIntersection(1,Li(i.y,e.y,(Vt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Li(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Vt!=e.y>Vt&&this.addBorderIntersection(3,Li(i.x,e.x,(Vt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new Ct(0,0):new Ct(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function _g(r,e){const i=r.add(e)._unit(),a=Ie(r.x*i.x+r.y*i.y,-1,1);var o,d,p;return o=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(o)))/4*mm*((d=r).x*(p=e).y-d.y*p.x<0?-1:1)}const yg=[r=>r.x<0,r=>r.x>Vt,r=>r.y<0,r=>r.y>Vt];function $0(r,e,i,a){const o=[4];if(a===0)return o;i._mult(a);const d=r.sub(i),p=e.sub(i),x=[r,e,d,p];for(let T=0;T<4;T++)for(const A of x)if(yg[T](A)){o.push(T);break}return o}class b_{constructor(e){this.vertexArray=new qf,this.indexArray=new cs,this.programConfigurations=new $s(e.layers,{zoom:e.zoom,lut:e.lut},i=>J1.includes(i)),this._segments=new Wr,this.hiddenByLandmarkVertexArray=new Ko,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Wr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,a,o=!1){const d=e.length;if(d>2){let p=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[p].length);let T;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{const A=e[0],M=e[1];T=_g(A.sub(e[d-1])._perp()._unit(),M.sub(A)._perp()._unit())}for(let A=0;A<d;A++){const M=A===d-1?0:A+1,z=e[A],D=e[M],k=e[M===d-1?0:M+1],B=D.sub(z)._perp()._unit(),W=_g(B,k.sub(D)._perp()._unit()),Y=T,K=W;if(C(z,D,i)||o&&O(z,i)&&O(D,i)){T=W;continue}const ne=x.vertexLength;gg(this.vertexArray,z,D,1,1,Y),gg(this.vertexArray,z,D,1,0,Y),gg(this.vertexArray,z,D,0,1,K),gg(this.vertexArray,z,D,0,0,K),x.vertexLength+=4;const se=$0(z,D,B,a);for(const he of se)this._segmentToGroundQuads[p].push({id:ne,region:he}),this._segmentToRegionTriCounts[p][he]+=2,x.primitiveLength+=2;T=W}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let a=0;a<i;a++)this._segmentToGroundQuads[a].sort((o,d)=>o.region-d.region);for(let a=0;a<i;a++){const o=this._segmentToGroundQuads[a],d=e[a],p=this._segmentToRegionTriCounts[a];p.reduce((T,A)=>T+A,0);let x=0;for(let T=0;T<=4;T++){const A=p[T];if(A!==0){let M=this.regionSegments[T];M||(M=this.regionSegments[T]=new Wr);const z={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+x,vertexLength:d.vertexLength,primitiveLength:A};M.get().push(z)}x+=A}for(let T=0;T<o.length;T++){const A=o[T].id;this.indexArray.emplaceBack(A,A+1,A+3),this.indexArray.emplaceBack(A,A+3,A+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,a,o,d,p,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,a,o,d,p,void 0,x)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,hm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,a,o,d,p,x,T){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,a,o,d,p,x,T)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Yu))}updateHiddenByLandmarkRange(e,i,a){if(!this.hasData())return;const o=i+e;if(i!==0){for(let d=e;d<o;++d)this.hiddenByLandmarkVertexArray.emplace(d,a?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,F0.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class ef{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new cs,this.footprintVertices=new lc,this.footprintSegments=[],this.layoutVertexArray=new Kc,this.centroidVertexArray=new Kp,this.wallVertexArray=new dc,this.indexArray=new cs,this.programConfigurations=new $s(e.layers,{zoom:e.zoom,lut:e.lut},i=>Jh.includes(i)),this.segments=new Wr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new b_(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,a,o){this.features=[],this.hasPattern=lg("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Ze(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:d,id:p,index:x,sourceLayerIndex:T}of e){const A=this.layers[0]._featureFilter.needGeometry,M=Rt(d,A);if(!this.layers[0]._featureFilter.filter(new on(this.zoom,{worldview:this.worldview}),M,a))continue;const z={id:p,sourceLayerIndex:T,index:x,geometry:A?M.geometry:$t(d,a,o),properties:d.properties,type:d.type,patterns:{}},D=this.layoutVertexArray.length,k=Qd[z.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:d.id,feature:Kh("fill-extrusion",this.layers,z,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const B of z.geometry)for(const W of sp(B,k))this.addFeature(d.id,z,[W],x,a,{},i.availableImages,o,i.brightness);else this.addFeature(d.id,z,z.geometry,x,a,{},i.availableImages,o,i.brightness);i.featureIndex.insert(d,z.geometry,x,T,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,a,o,d,p){for(const{featureId:x,feature:T}of this.features){const A=Qd[T.type]==="Polygon",{geometry:M}=T;if(this.wallMode)for(const z of M)for(const D of sp(z,A))this.addFeature(x,T,[D],T.index,i,a,o,d,p);else this.addFeature(x,T,M,T.index,i,a,o,d,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,a,o,d,p,x){this.programConfigurations.updatePaintArrays(e,i,d,a,o,p,x,this.worldview),this.groundEffect.update(e,i,d,a,o,p,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,V0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,B0.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,U0.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,K1.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,o,d,p,x,T,A){const M=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,z=[new Ct(0,0),new Ct(Vt,Vt)],D=T.projection,k=D.name==="globe",B=this.wallMode||Qd[i.type]==="Polygon",W=new op;W.centroidDataIndex=this.centroidData.length;const Y=new v_;Y.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(Y.buildingId=i.properties.building_id);const K=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},d)<=0,ne=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},d);let se;if(Y.height=ne,Y.vertexArrayOffset=this.layoutVertexArray.length,Y.groundVertexArrayOffset=this.groundEffect.vertexArray.length,k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Vd),this.wallMode){if(k)return void ur("Non zero fill-extrusion-line-width is not yet supported on globe.");if(a.length!==1)return;se=function($e){const yt=$e[0].x===$e[$e.length-1].x&&$e[0].y===$e[$e.length-1].y;(function(qt){let vi=0;const Gi=qt.length;for(let Xt=0;Xt<Gi;Xt++)vi+=(qt[(Xt+1)%Gi].x-qt[Xt].x)*(qt[(Xt+1)%Gi].y+qt[Xt].y);return vi>=0})($e)||($e=$e.reverse());const bt={geometry:[],joinNormals:[],indices:[]},Et=[],jt=[],ht=[];let At=$e.length;for(;At>=2&&$e[At-1].equals($e[At-2]);)At--;if(At<(yt?3:2))return bt;let at,et,kt,Ot,bi,oi=0;for(;oi<At-1&&$e[oi].equals($e[oi+1]);)oi++;yt&&(at=$e[At-2],bi=$e[oi].sub(at)._unit()._perp());for(let qt=oi;qt<At;qt++){if(kt=qt===At-1?yt?$e[oi+1]:void 0:$e[qt+1],kt&&$e[qt].equals(kt))continue;bi&&(Ot=bi),at&&(et=at),at=$e[qt],bi=kt?kt.sub(at)._unit()._perp():Ot,Ot=Ot||bi;let vi=Ot.add(bi);vi.x===0&&vi.y===0||vi._unit();const Gi=vi.x*bi.x+vi.y*bi.y,Xt=Gi!==0?1/Gi:1/0,mi=Ot.x*bi.y-Ot.y*bi.x>0;let Ni="miter";const Qi=2;Ni==="miter"&&Xt>Qi&&(Ni="bevel"),Ni==="bevel"&&(Xt>100&&(Ni="flipbevel"),Xt<Qi&&(Ni="miter"));const dr=(rr,hi,tr,Dr)=>{const pe=new Ct(rr.x,rr.y),ge=new Ct(rr.x,rr.y);pe.x+=hi.x*Dr,pe.y+=hi.y*Dr,ge.x-=hi.x*Math.max(tr,1),ge.y-=hi.y*Math.max(tr,1),ht.push(hi),Et.push(pe),jt.push(ge)};if(Ni==="miter")vi._mult(Xt),dr(at,vi,0,0);else if(Ni==="flipbevel")vi=bi.mult(-1),dr(at,vi,0,0),dr(at,vi.mult(-1),0,0);else{const rr=-Math.sqrt(Xt*Xt-1),hi=mi?rr:0,tr=mi?0:rr;et&&dr(at,Ot,hi,tr),kt&&dr(at,bi,hi,tr)}}bt.geometry=[...Et,...jt.reverse(),Et[0]],bt.joinNormals=[...ht,...ht.reverse(),ht[ht.length-1]];const fi=bt.geometry.length-1;for(let qt=0;qt<fi/2;qt++)if(qt+1<fi/2){let vi=qt,Gi=qt+1,Xt=fi-1-qt,mi=fi-2-qt;vi=vi===0?fi-1:vi-1,Gi=Gi===0?fi-1:Gi-1,Xt=Xt===0?fi-1:Xt-1,mi=mi===0?fi-1:mi-1,bt.indices.push(Xt),bt.indices.push(Gi),bt.indices.push(vi),bt.indices.push(Xt),bt.indices.push(mi),bt.indices.push(Gi)}return bt}(a[0]),a=[se.geometry]}const he=($e,yt)=>$e<(yt.length-1)/2||$e===yt.length-1,Re=this.wallMode?[a]:cm(a,500);for(let $e=Re.length-1;$e>=0;$e--){const yt=Re[$e];(yt.length===0||(Me=yt[0]).every(It=>It.x<=0)||Me.every(It=>It.x>=Vt)||Me.every(It=>It.y<=0)||Me.every(It=>It.y>=Vt))&&Re.splice($e,1)}var Me;let Ne;if(k)Ne=Xe(Re,z,d);else{Ne=[];for(const $e of Re)Ne.push({polygon:$e,bounds:z})}const Fe=B?this.edgeRadius:0,Ue=Fe>0&&this.zoom<17,ft=($e,yt)=>{if($e.length===0)return!1;const It=$e[$e.length-1];return yt.x===It.x&&yt.y===It.y};for(const{polygon:$e,bounds:yt}of Ne){let It=0,bt=0;for(const At of $e)B&&!At[0].equals(At[At.length-1])&&At.push(At[0]),bt+=B?At.length-1:At.length;const Et=this.segments.prepareSegment((B?5:4)*bt,this.layoutVertexArray,this.indexArray);Y.footprintSegIdx<0&&(Y.footprintSegIdx=this.footprintSegments.length),Y.polygonSegIdx<0&&(Y.polygonSegIdx=this.polygonSegments.length);const jt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ht=new gm;if(ht.vertexOffset=this.footprintVertices.length,ht.indexOffset=3*this.footprintIndices.length,ht.ringIndices=[],B){const At=[],at=[];It=Et.vertexLength;for(let kt=0;kt<$e.length;kt++){const Ot=$e[kt];Ot.length&&kt!==0&&at.push(At.length/2);const bi=[];let oi,fi;oi=Ot[1].sub(Ot[0])._perp()._unit(),ht.ringIndices.push(Ot.length-1);for(let qt=1;qt<Ot.length;qt++){const vi=Ot[qt],Gi=Ot[qt===Ot.length-1?1:qt+1],Xt=vi.clone();if(Fe){fi=Gi.sub(vi)._perp()._unit();const mi=oi.add(fi)._unit(),Ni=Fe*Math.min(4,1/(oi.x*mi.x+oi.y*mi.y));Xt.x+=Ni*mi.x,Xt.y+=Ni*mi.y,Xt.x=Math.round(Xt.x),Xt.y=Math.round(Xt.y),oi=fi}if(!K||Fe!==0&&!Ue||ft(bi,Xt)||bi.push(Xt),Qh(this.layoutVertexArray,Xt.x,Xt.y,0,0,1,1,0),this.wallMode){const mi=he(qt,Ot);ap(this.wallVertexArray,se.joinNormals[qt],!mi)}Et.vertexLength++,this.footprintVertices.emplaceBack(vi.x,vi.y),At.push(vi.x,vi.y),k&&ed(this.layoutVertexExtArray,D.projectTilePoint(Xt.x,Xt.y,d),D.upVector(d,Xt.x,Xt.y))}K&&(Fe===0||Ue)&&(bi.length!==0&&ft(bi,bi[0])&&bi.pop(),this.groundEffect.addData(bi,yt,M))}const et=this.wallMode?se.indices:Xh(At,at);for(let kt=0;kt<et.length;kt+=3)this.footprintIndices.emplaceBack(ht.vertexOffset+et[kt+0],ht.vertexOffset+et[kt+1],ht.vertexOffset+et[kt+2]),this.indexArray.emplaceBack(It+et[kt],It+et[kt+2],It+et[kt+1]),Et.primitiveLength++;ht.indexCount+=et.length,ht.vertexCount+=this.footprintVertices.length-ht.vertexOffset}for(let At=0;At<$e.length;At++){const at=$e[At];W.startRing(Y,at[0]);let et=at.length>4&&U(at[at.length-2],at[0],at[1]),kt=Fe?f(at[at.length-2],at[0],at[1],Fe):0;const Ot=[];let bi,oi,fi;oi=at[1].sub(at[0])._perp()._unit();let qt=!0;for(let vi=1,Gi=0;vi<at.length;vi++){let Xt=at[vi-1],mi=at[vi];const Ni=at[vi===at.length-1?1:vi+1];if(W.appendEdge(Y,mi,Xt),C(mi,Xt,yt)){Fe&&(oi=Ni.sub(mi)._perp()._unit(),qt=!qt);continue}const Qi=mi.sub(Xt)._perp(),dr=Qi.x/(Math.abs(Qi.x)+Math.abs(Qi.y)),rr=Qi.y>0?1:0,hi=Xt.dist(mi);if(Gi+hi>32768&&(Gi=0),Fe){fi=Ni.sub(mi)._perp()._unit();let ge=v(Xt,mi,Ni,l(oi,fi),Fe);isNaN(ge)&&(ge=0);const st=mi.sub(Xt)._unit();Xt=Xt.add(st.mult(kt))._round(),mi=mi.add(st.mult(-ge))._round(),kt=ge,oi=fi,K&&this.zoom>=17&&(ft(Ot,Xt)||Ot.push(Xt),ft(Ot,mi)||Ot.push(mi))}const tr=Et.vertexLength,Dr=at.length>4&&U(Xt,mi,Ni);let pe=ae(Gi,et,qt);if(Qh(this.layoutVertexArray,Xt.x,Xt.y,dr,rr,0,0,pe),Qh(this.layoutVertexArray,Xt.x,Xt.y,dr,rr,0,1,pe),this.wallMode){const ge=he(vi-1,at),st=se.joinNormals[vi-1];ap(this.wallVertexArray,st,ge),ap(this.wallVertexArray,st,ge)}if(Gi+=hi,pe=ae(Gi,Dr,!qt),et=Dr,Qh(this.layoutVertexArray,mi.x,mi.y,dr,rr,0,0,pe),Qh(this.layoutVertexArray,mi.x,mi.y,dr,rr,0,1,pe),this.wallMode){const ge=he(vi,at),st=se.joinNormals[vi];ap(this.wallVertexArray,st,ge),ap(this.wallVertexArray,st,ge)}if(Et.vertexLength+=4,this.indexArray.emplaceBack(tr+0,tr+1,tr+2),this.indexArray.emplaceBack(tr+1,tr+3,tr+2),Et.primitiveLength+=2,Fe){const ge=It+(vi===1?at.length-2:vi-2),st=vi===1?It:ge+1;if(this.indexArray.emplaceBack(tr+1,ge,tr+3),this.indexArray.emplaceBack(ge,st,tr+3),Et.primitiveLength+=2,bi===void 0&&(bi=tr),!C(Ni,at[vi],yt)){const dt=vi===at.length-1?bi:Et.vertexLength;this.indexArray.emplaceBack(tr+2,tr+3,dt),this.indexArray.emplaceBack(tr+3,dt+1,dt),this.indexArray.emplaceBack(tr+3,st,dt+1),Et.primitiveLength+=3}qt=!qt}if(k){const ge=this.layoutVertexExtArray,st=D.projectTilePoint(Xt.x,Xt.y,d),dt=D.projectTilePoint(mi.x,mi.y,d),Wt=D.upVector(d,Xt.x,Xt.y),Zt=D.upVector(d,mi.x,mi.y);ed(ge,st,Wt),ed(ge,st,Wt),ed(ge,dt,Zt),ed(ge,dt,Zt)}}B&&(It+=at.length-1),K&&Fe&&this.zoom>=17&&(Ot.length!==0&&ft(Ot,Ot[0])&&Ot.pop(),this.groundEffect.addData(Ot,yt,M,Fe>0))}this.footprintSegments.push(ht),jt.triangleCount=this.indexArray.length-jt.triangleArrayOffset,this.polygonSegments.push(jt),++Y.footprintSegLen,++Y.polygonSegLen}if(Y.vertexCount=this.layoutVertexArray.length-Y.vertexArrayOffset,Y.groundVertexCount=this.groundEffect.vertexArray.length-Y.groundVertexArrayOffset,Y.vertexCount!==0){if(Y.centroidXY=W.borders?G0:this.encodeCentroid(W,Y),this.centroidData.push(Y),W.borders){this.featuresOnBorder.push(W);const $e=this.featuresOnBorder.length-1;for(let yt=0;yt<W.borders.length;yt++)W.borders[yt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[yt].push($e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,o,p,x,d,A,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,o,p,x,d,A,this.worldview),this.maxHeight=Math.max(this.maxHeight,ne)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,a)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){const e=[];for(let x=0;x<this.centroidData.length;x++){const T=this.centroidData[x],A=+(T.min.y+T.max.y>Vt),M=2*A+(+(T.min.x+T.max.x>Vt)^A);for(let z=0;z<T.polygonSegLen;z++){const D=T.polygonSegIdx+z;e.push({centroidIdx:x,subtile:M,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}const i=new cs;e.sort((x,T)=>x.triangleSegmentIdx===T.triangleSegmentIdx?x.subtile-T.subtile:x.triangleSegmentIdx-T.triangleSegmentIdx);let a=0,o=0,d=0;for(const x of e){if(x.triangleSegmentIdx!==a)break;d++}const p=e.length;for(;o!==e.length;){a=e[o].triangleSegmentIdx;let x=0,T=o,A=o;for(let M=T;M<d&&e[M].subtile===x;M++)A++;for(;T!==d;){const M=e[T];x=M.subtile;const z=this.centroidData[M.centroidIdx].min.clone(),D=this.centroidData[M.centroidIdx].max.clone(),k={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let B=T;B<A;B++){const W=e[B],Y=this.polygonSegments[W.polygonSegmentIdx],K=this.centroidData[W.centroidIdx].min,ne=this.centroidData[W.centroidIdx].max,se=this.indexArray.uint16;for(let he=Y.triangleArrayOffset;he<Y.triangleArrayOffset+Y.triangleCount;he++)i.emplaceBack(se[3*he],se[3*he+1],se[3*he+2]);k.primitiveLength+=Y.triangleCount,z.x=Math.min(z.x,K.x),z.y=Math.min(z.y,K.y),D.x=Math.max(D.x,ne.x),D.y=Math.max(D.y,ne.y)}k.primitiveLength>0&&this.triangleSubSegments.push({segment:k,min:z,max:D}),T=A;for(let B=T;B<d&&e[B].subtile===e[T].subtile;B++)A++}o=d;for(let M=o;M<p&&e[M].triangleSegmentIdx===e[o].triangleSegmentIdx;M++)d++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,a){const o=new Wr;if(this.wallMode){for(const W of this.triangleSubSegments)o.segments.push(W.segment);return o}let d=0,p=0;const x=1<<e.canonical.z;if(i){const W=i.getMinMaxForTile(e);W&&(d=W.min,p=W.max)}p+=this.maxHeight;const T=e.toUnwrapped();let A;const M=[T.canonical.x/x+T.wrap,T.canonical.y/x],z=[(T.canonical.x+1)/x+T.wrap,(T.canonical.y+1)/x],D=(W,Y,K)=>[W[0]*(1-K[0])+Y[0]*K[0],W[1]*(1-K[1])+Y[1]*K[1]],k=[],B=[];for(const W of this.triangleSubSegments){k[0]=W.min.x/Vt,k[1]=W.min.y/Vt,B[0]=W.max.x/Vt,B[1]=W.max.y/Vt;const Y=D(M,z,k),K=D(M,z,B);if(new Di([Y[0],Y[1],d],[K[0],K[1],p]).intersectsPrecise(a)===0){A&&(o.segments.push(A),A=void 0);continue}const ne=W.segment;A&&A.vertexOffset!==ne.vertexOffset&&(o.segments.push(A),A=void 0),A?(A.vertexLength+=ne.vertexLength,A.primitiveLength+=ne.primitiveLength):A={vertexOffset:ne.vertexOffset,primitiveLength:ne.primitiveLength,vertexLength:ne.vertexLength,primitiveOffset:ne.primitiveOffset,sortKey:void 0,vaos:{}}}return A&&o.segments.push(A),o}encodeCentroid(e,i){const a=e.centroid(),o=i.span(),d=Math.min(7,Math.round(o.x*this.tileToMeter/10)),p=Math.min(7,Math.round(o.y*this.tileToMeter/10));return new Ct(Ie(a.x,1,Vt-1)<<3|d,Ie(a.y,1,Vt-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new Ct(0,0);const i=e.borders,a=Number.MAX_VALUE;if(i[0][0]!==a||i[1][0]!==a){const o=i[0][0]!==a?0:1;return new Ct(6|(i[0][0]!==a?0:65528),(i[o][0]+i[o][1])/2<<3|6)}{const o=i[2][0]!==a?2:3;return new Ct((i[o][0]+i[o][1])/2<<3|6,6|(i[2][0]!==a?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,o=e.flags&Yu?G0:e.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==o.y||d!==o.x){for(let p=i;p<a;++p)this.centroidVertexArray.emplace(p,o.x,o.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped());if(np(this.activeReplacements,o))return;if(this.activeReplacements=o,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const p of this.centroidData)p.flags&=2147483647;const d=[];for(const p of this.activeReplacements){if(p.order<a)continue;const x=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));if(p.footprint.buildingId){const T=p.footprint.buildingId;for(const A of this.centroidData)A.buildingId===T&&(A.flags|=Yu)}else for(const T of this.centroidData)if(!(T.flags&Yu||p.min.x>T.max.x||T.min.x>p.max.x||p.min.y>T.max.y||T.min.y>p.max.y))for(let A=0;A<T.footprintSegLen;A++){const M=this.footprintSegments[T.footprintSegIdx+A];if(d.length=0,mt(this.footprintVertices,M.vertexOffset,M.vertexCount,p.footprintTileId.canonical,e.canonical,d),pg(p.footprint,d,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-x)){T.flags|=Yu;break}}}for(const p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,a){let o=!1;for(let d=0;d<a.footprintSegLen;d++){const p=this.footprintSegments[a.footprintSegIdx+d];let x=0;for(const T of p.ringIndices){for(let A=x,M=T+x-1;A<T+x;M=A++){const z=this.footprintVertices.int16[2*(A+p.vertexOffset)+0],D=this.footprintVertices.int16[2*(A+p.vertexOffset)+1],k=this.footprintVertices.int16[2*(M+p.vertexOffset)+1];D>i!=k>i&&e<(this.footprintVertices.int16[2*(M+p.vertexOffset)+0]-z)*(i-D)/(k-D)+z&&(o=!o)}x=T}}return o}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,o=!0;const d=4*(e+Vt)*Vt+(i+Vt);if(this.partLookup.hasOwnProperty(d)){const p=this.partLookup[d];return p?{height:p.height,hidden:!!(p.flags&Yu)}:void 0}for(const p of this.centroidData)e>p.max.x||p.min.x>e||i>p.max.y||p.min.y>i||p.height<=a||this.footprintContainsPoint(e,i,p)&&(a=p.height,this.partLookup[d]=p,o=!!(p.flags&Yu));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:o};this.partLookup[d]=void 0}}function l(r,e){const i=r.add(e)._unit();return r.x*i.x+r.y*i.y}function f(r,e,i,a){const o=e.sub(r)._perp()._unit(),d=i.sub(e)._perp()._unit();return v(r,e,i,l(o,d),a)}function v(r,e,i,a,o){const d=Math.sqrt(1-a*a);return Math.min(r.dist(e)/3,e.dist(i)/3,o*d/a)}function C(r,e,i){return r.x<i[0].x&&e.x<i[0].x||r.x>i[1].x&&e.x>i[1].x||r.y<i[0].y&&e.y<i[0].y||r.y>i[1].y&&e.y>i[1].y}function O(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function U(r,e,i){if(r.x<0||r.x>=Vt||e.x<0||e.x>=Vt||i.x<0||i.x>=Vt)return!1;const a=i.sub(e),o=a.perp(),d=r.sub(e);return(a.x*d.x+a.y*d.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(d.x*d.x+d.y*d.y))>-.866&&o.x*d.x+o.y*d.y<0}function ae(r,e,i){const a=e?2|r:-3&r;return i?1|a:-2&a}function De(){const r=Math.PI/32,e=Math.tan(r),i=H;return i*Math.sqrt(1+2*e*e)-i}function Xe(r,e,i){const a=1<<i.z,o=Ee(i.x/a),d=Ee((i.x+1)/a),p=ve(i.y/a),x=ve((i.y+1)/a);return function(T,A,M,z,D=0,k){const B=[];if(!T.length||!M||!z)return B;const W=(Me,Ne)=>{for(const Fe of Me)B.push({polygon:Fe,bounds:Ne})},Y=Math.ceil(Math.log2(M)),K=Math.ceil(Math.log2(z)),ne=Y-K,se=[];for(let Me=0;Me<Math.abs(ne);Me++)se.push(ne>0?0:1);for(let Me=0;Me<Math.min(Y,K);Me++)se.push(0),se.push(1);let he=T;if(he=ip(he,A[0].y-D,A[1].y+D,1),he=ip(he,A[0].x-D,A[1].x+D,0),!he.length)return B;const Re=[];for(se.length?Re.push({polygons:he,bounds:A,depth:0}):W(he,A);Re.length;){const Me=Re.pop(),Ne=Me.depth,Fe=se[Ne],Ue=Me.bounds[0],ft=Me.bounds[1],$e=Fe===0?Ue.x:Ue.y,yt=Fe===0?ft.x:ft.y,It=k?k(Fe,$e,yt):.5*($e+yt),bt=ip(Me.polygons,$e-D,It+D,Fe),Et=ip(Me.polygons,It-D,yt+D,Fe);if(bt.length){const jt=[Ue,new Ct(Fe===0?It:ft.x,Fe===1?It:ft.y)];se.length>Ne+1?Re.push({polygons:bt,bounds:jt,depth:Ne+1}):W(bt,jt)}if(Et.length){const jt=[new Ct(Fe===0?It:Ue.x,Fe===1?It:Ue.y),ft];se.length>Ne+1?Re.push({polygons:Et,bounds:jt,depth:Ne+1}):W(Et,jt)}}return B}(r,e,Math.ceil((d-o)/11.25),Math.ceil((p-x)/11.25),1,(T,A,M)=>{if(T===0)return .5*(A+M);{const z=ve((i.y+A/Vt)/a);return(Te(.5*(ve((i.y+M/Vt)/a)+z))*a-i.y)*Vt}})}function mt(r,e,i,a,o,d){const p=Math.pow(2,a.z-o.z);for(let x=0;x<i;x++){let T=r.int16[2*(x+e)+0],A=r.int16[2*(x+e)+1];T=(T+o.x*Vt)*p-a.x*Vt,A=(A+o.y*Vt)*p-a.y*Vt,d.push(new Ct(T,A))}}let ai,xi;si(ef,"FillExtrusionBucket",{omit:["layers","features"]}),si(v_,"PartData"),si(gm,"FootprintSegment"),si(op,"BorderCentroidData"),si(b_,"GroundEffect");class Ut extends Ct{constructor(e,i,a){super(e,i),this.z=a}}class ri extends Ut{constructor(e,i,a,o){super(e,i,a),this.w=o}}function vr(r,e,i,a){const o=i==="x"?"y":"x",d=(a-r[i])/(e[i]-r[i]);r[o]=Math.round(r[o]+(e[o]-r[o])*d),r[i]=a,r.hasOwnProperty("z")&&(r.z=Li(r.z,e.z,d)),r.hasOwnProperty("w")&&(r.w=Li(r.w,e.w,d))}function Qr(r,e,i,a){const o=i,d=a;for(const p of["x","y"]){let x=r,T=e;x[p]>=T[p]&&(x=e,T=r),x[p]<o&&T[p]>o&&vr(x,T,p,o),x[p]<d&&T[p]>d&&vr(T,x,p,d)}}function _s(r,e,i,a,o,d){const p=[];for(let x=0;x<r.length;x++){const T=r[x];let A;const M=p.length;let z=0;for(let D=0;D<T.length-1;D++){let k=T[D],B=T[D+1],W=0;const Y=z;let K,ne;d&&(W=Math.hypot(B.x-k.x,B.y-k.y),z+=W,K=k,ne=B),k.x<e&&B.x<e||(k.x<e?k=new Ct(e,k.y+(e-k.x)/(B.x-k.x)*(B.y-k.y))._round():B.x<e&&(B=new Ct(e,k.y+(e-k.x)/(B.x-k.x)*(B.y-k.y))._round()),k.y<i&&B.y<i||(k.y<i?k=new Ct(k.x+(i-k.y)/(B.y-k.y)*(B.x-k.x),i)._round():B.y<i&&(B=new Ct(k.x+(i-k.y)/(B.y-k.y)*(B.x-k.x),i)._round()),k.x>=a&&B.x>=a||(k.x>=a?k=new Ct(a,k.y+(a-k.x)/(B.x-k.x)*(B.y-k.y))._round():B.x>=a&&(B=new Ct(a,k.y+(a-k.x)/(B.x-k.x)*(B.y-k.y))._round()),k.y>=o&&B.y>=o||(k.y>=o?k=new Ct(k.x+(o-k.y)/(B.y-k.y)*(B.x-k.x),o)._round():B.y>=o&&(B=new Ct(k.x+(o-k.y)/(B.y-k.y)*(B.x-k.x),o)._round()),A&&k.equals(A[A.length-1])||(A=[k],p.push(A),d&&d.push({progress:{min:Y+pt(K,ne,k)*W,max:1},parentIndex:x,prevPoint:K,nextPoint:ne})),A.push(B),d&&(d[d.length-1].progress.max=Y+pt(K,ne,B)*W,d[d.length-1].nextPoint=ne)))))}if(d&&z>0)for(let D=M;D<p.length;D++)d[D].progress.min/=z,d[D].progress.max/=z}return p}function Mt(r,e,i,a,o){if(r.length<2)return void a.push(r);const d=[];for(;e.valid();){const[A,M]=e.get();for(let z=0;z<r.length-1;z++){const D=r[z],k=r[z+1],B=Bn(D,k,A,M);if(B){const[W]=B,Y=new Ct(Li(D.x,k.x,W),Li(D.y,k.y,W));d.push({t:z+W,distance:0,point:Y})}}e.next()}if(d.length===0)return void a.push(r);d.sort((A,M)=>A.t-M.t);let p=0,x=0,T=[];for(a.push(T);p!==r.length;){if(x===d.length){for(;p!==r.length;)T.length!==0&&T[T.length-1].equals(r[p])||T.push(r[p]),p++;break}d[x].t<=p?(T.length!==0&&T[T.length-1].equals(d[x].point)||T.push(d[x].point),Math.trunc(d[x].t),x++):(T.length!==0&&T[T.length-1].equals(r[p])||T.push(r[p]),p++)}}function pt(r,e,i){return r.x!==e.x?(i.x-r.x)/(e.x-r.x):r.y!==e.y?(i.y-r.y)/(e.y-r.y):0}function Pt(r,e){return r.x*e.x+r.y*e.y}function di(r,e){if(r.length===1){let i=0;const a=e[i++];let o;for(;!o||a.equals(o);)if(o=e[i++],!o)return 1/0;for(;i<e.length;i++){const d=e[i],p=r[0],x=o.sub(a),T=d.sub(a),A=p.sub(a),M=Pt(x,x),z=Pt(x,T),D=Pt(T,T),k=Pt(A,x),B=Pt(A,T),W=M*D-z*z,Y=(D*k-z*B)/W,K=(M*B-z*k)/W,ne=a.z*(1-Y-K)+o.z*Y+d.z*K;if(isFinite(ne))return ne}return 1/0}{let i=1/0;for(const a of e)i=Math.min(i,a.z);return i}}function hr(r,e,i,a,o,d,p,x){const T=p*o.getElevationAt(r,e,!0,!0),A=d[0]!==0,M=A?d[1]===0?p*(d[0]/7-450):p*function(z,D,k){const B=Math.floor(D[0]/8),W=Math.floor(D[1]/8),Y=10*(D[0]-8*B),K=10*(D[1]-8*W),ne=z.getElevationAt(B,W,!0,!0),se=z.getMeterToDEM(k),he=Math.floor(.5*(Y*se-1)),Re=Math.floor(.5*(K*se-1)),Me=z.tileCoordToPixel(B,W),Ne=2*he+1,Fe=2*Re+1,Ue=function(Et,jt,ht,At,at){return[Et.getElevationAtPixel(jt,ht,!0),Et.getElevationAtPixel(jt+at,ht,!0),Et.getElevationAtPixel(jt,ht+at,!0),Et.getElevationAtPixel(jt+At,ht+at,!0)]}(z,Me.x-he,Me.y-Re,Ne,Fe),ft=Math.abs(Ue[0]-Ue[1]),$e=Math.abs(Ue[2]-Ue[3]),yt=Math.abs(Ue[0]-Ue[2])+Math.abs(Ue[1]-Ue[3]),It=Math.min(.25,.5*se*(ft+$e)/Ne),bt=Math.min(.25,.5*se*yt/Fe);return ne+Math.max(It*Y,bt*K)}(o,d,x):T;return{base:T+(i===0?-1:i),top:A?Math.max(M+a,T+i+2):T+a}}class bn{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Ir{constructor(){this.tasks={},this.taskQueue=[],Mi(["process"],this),this.invoker=new bn(this.process),this.nextId=0}add(e,i){const a=this.nextId++,o=function({type:d,isSymbolTile:p,zoom:x}){return x=x||0,d==="message"?0:d!=="maybePrepare"||p?d!=="parseTile"||p?d==="parseTile"&&p?300-x:d==="maybePrepare"&&p?400-x:500:200-x:100-x}(i);if(o===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:i,priority:o,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let o=0;o<this.taskQueue.length;o++){const d=this.tasks[this.taskQueue[o]];d.priority<i&&(i=d.priority,e=o)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class Fr{constructor(e,i,a){this.target=e,this.parent=i,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Mi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Ir}send(e,i,a,o,d=!1,p){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=p,this.callbacks[x]=a);const T=new Set;return this.target.postMessage({id:x,type:e,hasCallback:!!a,targetMapId:o,mustQueue:d,sourceMapId:this.mapId,data:nc(i,T)},T),{cancel:()=>{a&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const a=i.id;if(a&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const o=this.cancelCallbacks[a];delete this.cancelCallbacks[a],o&&o.cancel()}else if(i.mustQueue||wt(self)){const o=this.callbacks[a],d=this.scheduler.add(()=>this.processTask(a,i),o&&o.metadata||{type:"message"});d&&(this.cancelCallbacks[a]=d)}else this.processTask(a,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(i.error?a(bl(i.error)):a(null,bl(i.data)))}else{const a=new Set,o=i.hasCallback?(p,x)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?nc(p):null,data:nc(x,a)},a)}:()=>{},d=bl(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,d,o);else if(this.parent.getWorkerSource){const p=i.type.split("."),{source:x,scope:T}=d;this.parent.getWorkerSource(i.sourceMapId,p[0],x,T)[p[1]](d,o)}else o(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var ks={workerUrl:"",workerClass:null,workerParams:void 0};const Nn="mapboxgl_preloaded_worker_pool";class Do{constructor(){this.active={}}acquire(e,i=Do.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(ks.workerClass!=null?new ks.workerClass:new self.Worker(ks.workerUrl,ks.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Nn]}numActive(){return Object.keys(this.active).length}}Do.workerCount=2;class lp{constructor(e,i,a="Worker",o=Do.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=vt();const d=this.workerPool.acquire(this.id,o);for(let p=0;p<d.length;p++){const x=new lp.Actor(d[p],i,this.id);x.name=`${a} ${p}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,a){Je(this.actors,(o,d)=>{o.send(e,i,d)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let w_,Q1;function Z0(){return w_||(w_=new Do),w_}lp.Actor=Fr;class b5{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),a=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,a/i.BYTES_PER_ELEMENT),a}createFloatArray(e){const i=new Float32Array(e),a=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,a/i.BYTES_PER_ELEMENT),a}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let a=0;a<e.length;++a)this.module.heapU8[i+a]=e.charCodeAt(a);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,a=e.facadeGlazingColorRgb,o=e.roofColorRgb,d=e.wallColorRgb,p=e.normalScale;this.module.setStyle(i[0],i[1],i[2],a[0],a[1],a[2],o[0],o[1],o[2],d[0],d[1],d[2],p[0],p[1],p[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,a){this.module.setFauxFacadeOptions(e?1:0,i?1:0,a)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){for(const x of e){const T=this.createStringBuffer(x.roofType),A=[0],M=[];for(const k of x.coordinates)if(Array.isArray(k)){for(const B of k)M.push(B.x),M.push(B.y);A.push(M.length)}const z=this.createIntArray(A),D=this.createFloatArray(M);this.module.addFeature(x.id,x.sourceId,x.minHeight,x.height,T,x.roofType.length,D,z,A.length-1),this.module.free(T),this.module.free(z),this.module.free(D)}for(const x of i){let T;T=x.entrances?JSON.parse(x.entrances):[];const A=this.createFloatArray(T),M=[];for(const D of x.coordinates)M.push(D.x),M.push(D.y);const z=this.createFloatArray(M);this.module.addFacade(x.sourceId,x.crossPerc,x.distanceToRoad,A,T.length,z,M.length),this.module.free(A),this.module.free(z)}if(!this.module.generateMesh()){const x=this.module.getLastError();return this.readStringBuffer(x)}const a=this.module.getMeshCount(),o=new Array(a);for(let x=0;x<a;x++){const T=this.module.getPositionsPtr(x),A=this.module.getPositionsLength(x),M=new Float32Array(this.module.heapF32.buffer,T,A),z=this.module.getNormalsPtr(x),D=this.module.getNormalsLength(x),k=new Float32Array(this.module.heapF32.buffer,z,D),B=this.module.getColorsPtr(x),W=this.module.getColorsLength(x),Y=new Uint8Array(this.module.heapU8.buffer,B,W),K=this.module.getAOPtr(x),ne=this.module.getAOLength(x),se=new Float32Array(this.module.heapF32.buffer,K,ne),he=this.module.getUVPtr(x),Re=this.module.getUVLength(x),Me=new Float32Array(this.module.heapF32.buffer,he,Re),Ne=this.module.getFauxFacadePtr(x),Fe=this.module.getFauxFacadeLength(x),Ue=new Uint8Array(this.module.heapU8.buffer,Ne,Fe),ft=this.module.getIndicesPtr(x),$e=this.module.getIndicesLength(x),yt=new Int32Array(this.module.heap32.buffer,ft,$e),It=this.module.getBuildingPart(x),bt=this.readStringBuffer(It);o[x]={positions:M,normals:k,colors:Y,ao:se,uv:Me,isFauxFacade:Ue,indices:yt,buildingPart:bt}}const d=this.module.getRingCount(),p=[];for(let x=0;x<d;x++){const T=this.module.getRingPtr(x),A=this.module.getRingLength(x),M=new Float32Array(this.module.heapF32.buffer,T,A);p.push(M)}return{meshes:o,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:p}}}let T_,ex,Ku,xg,tx,vg=null,bg=null,hb=null,W0=null;function db(){return wt(self)&&self.worker.dracoUrl?self.worker.dracoUrl:ex||Yn.DRACO_URL}function fb(){if(wt(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(xg)return xg;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return xg=WebAssembly.validate(r)?Yn.MESHOPT_SIMD_URL:Yn.MESHOPT_URL,xg}function w5(){return W0}const X0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},T5={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},S_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function pb(r,e,i){const a=i.json.bufferViews.length,o=i.buffers.length;e.bufferView=a,i.json.bufferViews[a]={buffer:o,byteLength:r.byteLength},i.buffers[o]=r}const ix="KHR_draco_mesh_compression";function S5(r,e){const i=r.extensions&&r.extensions[ix];if(!i)return;const a=new Ku.Decoder,o=yb(e,i.bufferView),d=new Ku.Mesh;if(!a.DecodeArrayToMesh(o,o.byteLength,d))throw new Error("Failed to decode Draco mesh");const p=e.json.accessors[r.indices],x=X0[p.componentType],T=p.count*x.BYTES_PER_ELEMENT,A=Ku._malloc(T);x===Uint16Array?a.GetTrianglesUInt16Array(d,T,A):a.GetTrianglesUInt32Array(d,T,A),pb(Ku.memory.buffer.slice(A,A+T),p,e),Ku._free(A);for(const M of Object.keys(i.attributes)){const z=a.GetAttributeByUniqueId(d,i.attributes[M]),D=e.json.accessors[r.attributes[M]],k=T5[D.componentType],B=D.count*S_[D.type]*X0[D.componentType].BYTES_PER_ELEMENT,W=Ku._malloc(B);a.GetAttributeDataArrayForAllPoints(d,z,Ku[k],B,W),pb(Ku.memory.buffer.slice(W,W+B),D,e),Ku._free(W)}a.destroy(),d.destroy(),delete r.extensions[ix]}const Y0="EXT_meshopt_compression";function E5(r,e){if(!r.extensions||!r.extensions[Y0])return;const i=r.extensions[Y0],a=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),o=new Uint8Array(i.count*i.byteStride);tx.decodeGltfBuffer(o,i.count,i.byteStride,a,i.mode,i.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=o.buffer,delete r.extensions[Y0]}const mb=1179937895,gb=new TextDecoder("utf8");function _b(r,e){return new URL(r,e).href}function A5(r,e,i,a){return fetch(_b(r.uri,a)).then(o=>o.arrayBuffer()).then(o=>{e.buffers[i]=o})}function yb(r,e){const i=r.json.bufferViews[e];return new Uint8Array(r.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function C5(r,e,i,a){if(r.uri){const o=_b(r.uri,a);return fetch(o).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{e.images[i]=d})}if(r.bufferView!==void 0){const o=yb(e,r.bufferView),d=new Blob([o],{type:r.mimeType});return createImageBitmap(d).then(p=>{e.images[i]=p})}}function xb(r,e=0,i){const a={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===mb){const M=new Uint32Array(r,e);let z=2;const D=(M[z++]>>2)-3,k=M[z++]>>2;if(z++,a.json=JSON.parse(gb.decode(M.subarray(z,z+k))),z+=k,z<D){const B=M[z++];z++;const W=e+(z<<2);a.buffers[0]=r.slice(W,W+B)}}else a.json=JSON.parse(gb.decode(new Uint8Array(r,e)));const{buffers:o,images:d,meshes:p,extensionsUsed:x,bufferViews:T}=a.json;let A=Promise.resolve();if(o){const M=[];for(let z=0;z<o.length;z++){const D=o[z];D.uri?M.push(A5(D,a,z,i)):a.buffers[z]||(a.buffers[z]=null)}A=Promise.all(M)}return A.then(()=>{const M=[],z=x&&x.includes(ix),D=x&&x.includes(Y0);if(z&&M.push(function(){if(!Ku)return T_??(T_=function(k){let B,W=null;function Y(){B=new Uint8Array(W.buffer)}function K(){throw new Error("Unexpected Draco error.")}const ne={a:{a:K,d:function(se,he,Re){return B.copyWithin(se,he,he+Re)},c:function(se){const he=B.length,Re=Math.max(se>>>0,Math.ceil(1.2*he)),Me=Math.ceil((Re-he)/65536);try{return W.grow(Me),Y(),!0}catch{return!1}},b:K}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(k,ne):k.then(se=>se.arrayBuffer()).then(se=>WebAssembly.instantiate(se,ne))).then(se=>{const{Rb:he,Qb:Re,P:Me,T:Ne,X:Fe,Ja:Ue,La:ft,Qa:$e,Va:yt,Wa:It,eb:bt,jb:Et,f:jt,e:ht,yb:At,zb:at,Ab:et,Bb:kt,Db:Ot,Gb:bi}=se.instance.exports;W=ht;const oi=(()=>{let fi=0,qt=0,vi=0,Gi=0;return Xt=>{vi&&(he(Gi),he(fi),qt+=vi,vi=fi=0),fi||(qt+=128,fi=Re(qt));const mi=Xt.length+7&-8;let Ni=fi;mi>=qt&&(vi=mi,Ni=Gi=Re(mi));for(let Qi=0;Qi<Xt.length;Qi++)B[Ni+Qi]=Xt[Qi];return Ni}})();return Y(),jt(),{memory:ht,_free:he,_malloc:Re,Mesh:class{constructor(){this.ptr=Me()}destroy(){Ne(this.ptr)}},Decoder:class{constructor(){this.ptr=Ue()}destroy(){Et(this.ptr)}DecodeArrayToMesh(fi,qt,vi){const Gi=oi(fi),Xt=ft(this.ptr,Gi,qt,vi.ptr);return!!Fe(Xt)}GetAttributeByUniqueId(fi,qt){return{ptr:$e(this.ptr,fi.ptr,qt)}}GetTrianglesUInt16Array(fi,qt,vi){yt(this.ptr,fi.ptr,qt,vi)}GetTrianglesUInt32Array(fi,qt,vi){It(this.ptr,fi.ptr,qt,vi)}GetAttributeDataArrayForAllPoints(fi,qt,vi,Gi,Xt){bt(this.ptr,fi.ptr,qt.ptr,vi,Gi,Xt)}},DT_INT8:At(),DT_UINT8:at(),DT_INT16:et(),DT_UINT16:kt(),DT_UINT32:Ot(),DT_FLOAT32:bi()}})}(fetch(db())),T_.then(k=>{Ku=k,T_=void 0}))}()),D&&M.push(function(){if(tx)return;const k=function(B){let W;const Y=WebAssembly.instantiateStreaming(B,{}).then(se=>{W=se.instance,W.exports.__wasm_call_ctors()}),K={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ne={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Y,supported:!0,decodeGltfBuffer(se,he,Re,Me,Ne,Fe){(function(Ue,ft,$e,yt,It,bt,Et){const jt=Ue.exports.sbrk,ht=yt+3&-4,At=jt(ht*It),at=jt(bt.length),et=new Uint8Array(Ue.exports.memory.buffer);et.set(bt,at);const kt=ft(At,yt,It,at,bt.length);if(kt===0&&Et&&Et(At,ht,It),$e.set(et.subarray(At,At+yt*It)),jt(At-jt(0)),kt!==0)throw new Error(`Malformed buffer data: ${kt}`)})(W,W.exports[ne[Ne]],se,he,Re,Me,W.exports[K[Fe]])}}}(fetch(fb()));return k.ready.then(()=>{tx=k})}()),d)for(let k=0;k<d.length;k++)M.push(C5(d[k],a,k,i));return(M.length?Promise.all(M):Promise.resolve()).then(()=>{if(z&&p)for(const{primitives:k}of p)for(const B of k)S5(B,a);if(D&&p&&T)for(const k of T)E5(k,a);return a})})}function rx(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function nx(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class sx{constructor(e,i,a,o){this.context=e,this.format=a,this.useMipmap=o&&o.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:o&&o.premultiply})}update(e,i){const a=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,o=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:d}=this,{gl:p}=d,{x,y:T}=i&&i.position?i.position:{x:0,y:0},A=x+a,M=T+o;!this.size||this.size[0]===A&&this.size[1]===M||(p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(this.texture),this.texture=p.createTexture(),this.size=null),p.bindTexture(p.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA8&&(!i||i.premultiply!==!1));const z=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&A>0&&M>0){const D=this.useMipmap?Math.floor(Math.log2(Math.max(A,M)))+1:1;p.texStorage2D(p.TEXTURE_2D,D,this.format,A,M),this.size=[A,M]}this.size&&(z?p.texSubImage2D(p.TEXTURE_2D,0,x,T,rx(this.format),nx(this.format),e):"data"in e&&e.data&&p.texSubImage2D(p.TEXTURE_2D,0,x,T,a,o,rx(this.format),nx(this.format),e.data)),this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,i,a=!1){const{context:o}=this,{gl:d}=o;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,a,o,d){const{context:p}=this,{gl:x}=p;x.bindTexture(x.TEXTURE_2D,this.texture),i!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?e===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,a),this.wrapS=a),o!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,o),this.wrapT=o),d!==this.compareMode&&(d?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.COMPARE_REF_TO_TEXTURE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_FUNC,d)):x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.NONE),this.compareMode=d)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class E_{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:a}=this,{gl:o}=a;o.bindTexture(o.TEXTURE_2D,this.texture),e!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,e),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,i),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,i),this.wrapS=i)}}const R5=xr([{name:"a_pos_3f",components:3,type:"Float32"}]),M5=xr([{name:"a_color_3f",components:3,type:"Float32"}]),I5=xr([{name:"a_color_4f",components:4,type:"Float32"}]),z5=xr([{name:"a_uv_2f",components:2,type:"Float32"}]),L5=xr([{name:"a_normal_3f",components:3,type:"Float32"}]),D5=xr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),P5=xr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function vb(r,e){const i=K0(r.projection,r.zoom,r.width,r.height),a=function(d,p,x,T,A){const M=new G(x.lng-180*cp,x.lat),z=new G(x.lng+180*cp,x.lat),D=d.project(M.lng,M.lat),k=d.project(z.lng,z.lat),B=-Math.atan2(k.y-D.y,k.x-D.x),W=ot.fromLngLat(x);W.y=Ie(W.y,-1+cp,1-cp);const Y=W.toLngLat(),K=d.project(Y.lng,Y.lat),ne=ot.fromLngLat(Y);ne.x+=cp;const se=ne.toLngLat(),he=d.project(se.lng,se.lat),Re=wb(he.x-K.x,he.y-K.y,B),Me=ot.fromLngLat(Y);Me.y+=cp;const Ne=Me.toLngLat(),Fe=d.project(Ne.lng,Ne.lat),Ue=wb(Fe.x-K.x,Fe.y-K.y,B),ft=Math.abs(Re.x)/Math.abs(Ue.y),$e=Se([]);Ke($e,$e,-B*(1-(A?0:T)));const yt=Se([]);return xe(yt,yt,[1,1-(1-ft)*T,1]),yt[4]=-Ue.x/Ue.y*T,Ke(yt,yt,B),_e(yt,$e,yt),yt}(r.projection,0,r.center,i,e),o=bb(r);return xe(a,a,[o,o,1]),a}function bb(r){const e=r.projection,i=K0(r.projection,r.zoom,r.width,r.height),a=ax(e,r.center),o=ax(e,G.convert(e.center));return Math.pow(2,a*i+(1-i)*o)}function K0(r,e,i,a,o=1/0){const d=r.range;if(!d)return 0;const p=Math.min(o,Math.max(i,a)),x=Math.log2(p/1024);return Qe(d[0]+x,d[1]+x,e)}const cp=1/4e4;function ax(r,e){const i=Ie(e.lat,-85.051129,Ce),a=new G(e.lng-180*cp,i),o=new G(e.lng+180*cp,i),d=r.project(a.lng,i),p=r.project(o.lng,i),x=ot.fromLngLat(a),T=ot.fromLngLat(o),A=p.x-d.x,M=p.y-d.y,z=T.x-x.x,D=T.y-x.y,k=Math.sqrt((z*z+D*D)/(A*A+M*M));return Math.log2(k)}function wb(r,e,i){const a=Math.cos(i),o=Math.sin(i);return{x:r*a-e*o,y:r*o+e*a}}function Tb(r,e,i){Se(r),Ke(r,r,He(e[2])),Le(r,r,He(e[0])),Ae(r,r,He(e[1])),xe(r,r,i),_e(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function J0(r,e,i,a,o,d,p,x){const T=[i[0]-e[0],i[1]-e[1],0],A=[a[0]-e[0],a[1]-e[1],0];if(Zi(T)<1e-12||Zi(A)<1e-12)return La(r);const M=Ai([],T,A);_i(M,M),ji(A,a,e),T[2]=(d-o)*x,A[2]=(p-o)*x;const z=T;return Ai(z,T,A),_i(z,z),Vs(r,M,z)}function ox(r,e,i=!1){const a=Wh(e.zoom),o=function(d,p,x){const T=p.worldSize,A=[d[12],d[13],d[14]],M=ve(A[1]/T),z=Ee(A[0]/T),D=Se([]),k=we(1,M)*T,B=we(1,0)*T*ke(M,p.zoom),W=1/nm(T);let Y=B*W;if(x){const he=K0(p.projection,p.zoom,p.width,p.height,1024);Y=W*p.projection.pixelSpaceConversion(p.center.lat,T,he)}const K=j(M,z);Jt(K,K,Ht([],_i([],K),k*Y*A[2]));const ne=function(he){const Re=[he[0],he[1],he[2]];let Me=[0,1,0];const Ne=Ai([],Me,Re);return Ai(Me,Re,Ne),ii(Me)===0&&(Me=[0,1,0],Ai(Ne,Re,Me)),_i(Ne,Ne),_i(Me,Me),_i(Re,Re),[Ne[0],Ne[1],Ne[2],0,Me[0],Me[1],Me[2],0,Re[0],Re[1],Re[2],0,he[0],he[1],he[2],1]}(K);xe(D,D,[Y,Y,Y*k]),ye(D,D,[-A[0],-A[1],-A[2]]);const se=_e([],p.globeMatrix,ne);return _e(se,se,D),_e(se,se,d),se}(r,e,i);if(a>0){const d=function(p,x){const T=x.worldSize,A=we(1,0)*T*ke(x.center.lat,x.zoom)/nm(T),M=we(1,x.center.lat)*T,z=Se([]);Ae(z,z,He(x.center.lng)),Le(z,z,He(x.center.lat)),ye(z,z,[0,0,c]),xe(z,z,[A,A,A*M]);const D=x.point;return ye(z,z,[-D.x,-D.y,0]),_e(z,z,p),_e(z,x.globeMatrix,z)}(r,e);return function(p,x,T){const A=(B,W,Y)=>{const K=Zi(B),ne=Zi(W),se=nl(B,W,Y);return Ht(se,se,1/Zi(se)*Li(K,ne,Y))},M=A([p[0],p[1],p[2]],[x[0],x[1],x[2]],T),z=A([p[4],p[5],p[6]],[x[4],x[5],x[6]],T),D=A([p[8],p[9],p[10]],[x[8],x[9],x[10]],T),k=nl([p[12],p[13],p[14]],[x[12],x[13],x[14]],T);return[M[0],M[1],M[2],0,z[0],z[1],z[2],0,D[0],D[1],D[2],0,k[0],k[1],k[2],1]}(o,d,a)}return o}function Sb(r,e,i,a){const o=Di.projectAabbCorners(a,i);let d=Number.MAX_VALUE,p=-1;for(let A=0;A<o.length;++A){const M=o[A];M[0]=(.5*M[0]+.5)*e.width,M[1]=(.5-.5*M[1])*e.height,M[2]<d&&(p=A,d=M[2])}const x=A=>new Ct(o[A][0],o[A][1]);let T;switch(p){case 0:case 6:T=[x(1),x(5),x(4),x(7),x(3),x(2),x(1)];break;case 1:case 7:T=[x(0),x(4),x(5),x(6),x(2),x(3),x(0)];break;case 3:case 5:T=[x(1),x(0),x(4),x(7),x(6),x(2),x(1)];break;default:T=[x(1),x(5),x(6),x(7),x(3),x(0),x(1)]}if(Ja(r,T))return d}const _m=64,wg={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Eb(r,e,i,a,o,d,p,x,T,A=!1){const M=i.zoom,z=i.project(a),D=ke(a.lat,M),k=1/D;Se(r),ye(r,r,[z.x+p[0]*k,z.y+p[1]*k,p[2]]);let B=1,W=1;const Y=i.worldSize;if(A){if(i.projection.name==="mercator"){let he=0;i.elevation&&(he=i.elevation.getAtPointOrZero(new ot(z.x/Y,z.y/Y),0));const Re=Rs([],[z.x,z.y,he,1],i.projMatrix)[3]/i.cameraToCenterDistance;B=Re,W=Re*ke(i.center.lat,M)}else if(i.projection.name==="globe"){const he=ox(r,i),Re=[0,0,0,1];Rs(Re,Re,_e([],i.projMatrix,he));const Me=Re[3]/i.cameraToCenterDistance,Ne=Wh(M),Fe=i.projection.pixelsPerMeter(a.lat,Y)*ke(a.lat,M),Ue=i.projection.pixelsPerMeter(i.center.lat,Y)*ke(i.center.lat,M);B=Me/Li(Fe,We(i.center.lat),Ne),W=Me*D/Fe,B*=Ue,W*=Ue}}else B=k;xe(r,r,[B,B,W]);const K=[...r],ne=e.orientation,se=[];if(Tb(se,[ne[0]+o[0],ne[1]+o[1],ne[2]+o[2]],d),_e(r,K,se),x&&i.elevation){let he=0;const Re=[];if(T&&i.elevation){he=function(Ne,Fe,Ue,ft,$e){const yt=Fe.elevation;if(!yt)return 0;const It=Di.projectAabbCorners(Ue,ft),bt=we(1,$e.lat)*Fe.worldSize,Et=function(qt,vi){const Gi=[0,0,1],Xt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const mi of Xt){const Ni=qt[mi.corners[0]],Qi=qt[mi.corners[1]],dr=qt[mi.corners[2]],rr=[Qi[0]-Ni[0],Qi[1]-Ni[1],vi*(Qi[2]-Ni[2])],hi=Ai(rr,rr,[dr[0]-Ni[0],dr[1]-Ni[1],vi*(dr[2]-Ni[2])]);_i(hi,hi),mi.dotProductWithUp=Ri(hi,Gi)}return Xt.sort((mi,Ni)=>mi.dotProductWithUp-Ni.dotProductWithUp),Xt[0].corners}(It,bt),jt=It[Et[0]],ht=It[Et[1]],At=It[Et[2]],at=It[Et[3]],et=yt.getAtPointOrZero(new ot(jt[0]/Fe.worldSize,jt[1]/Fe.worldSize),0),kt=yt.getAtPointOrZero(new ot(ht[0]/Fe.worldSize,ht[1]/Fe.worldSize),0),Ot=yt.getAtPointOrZero(new ot(At[0]/Fe.worldSize,At[1]/Fe.worldSize),0),bi=yt.getAtPointOrZero(new ot(at[0]/Fe.worldSize,at[1]/Fe.worldSize),0),oi=(et+bi)/2,fi=(kt+Ot)/2;return oi>fi?kt<Ot?J0(Ne,ht,at,jt,kt,bi,et,bt):J0(Ne,At,jt,at,Ot,et,bi,bt):et<bi?J0(Ne,jt,ht,At,et,kt,Ot,bt):J0(Ne,at,At,ht,bi,Ot,kt,bt),Math.max(oi,fi)}(Re,i,e.aabb,r,a);const Me=_e([],lt([],Re),se);_e(r,K,Me)}else he=i.elevation.getAtPointOrZero(new ot(z.x/Y,z.y/Y),0);he!==0&&(r[14]+=he)}}function A_(r,e,i=!1){r.uploaded||(r.gfxTexture=new sx(e,r.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function O5(r,e,i){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,R5.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,L5.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,z5.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?M5:I5).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,P5.members,!0)),r.segments=Wr.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const a=r.material;a.pbrMetallicRoughness.baseColorTexture&&A_(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&A_(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&A_(a.normalTexture,e),a.occlusionTexture&&A_(a.occlusionTexture,e,i),a.emissionTexture&&A_(a.emissionTexture,e)}function lx(r,e,i){if(r.meshes)for(const a of r.meshes)O5(a,e,i);if(r.children)for(const a of r.children)lx(a,e,i)}function Q0(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)Q0(e)}function cx(r){if(r.meshes)for(const i of r.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(r.children)for(const i of r.children)cx(i)}function ym(r,e){const i=r.json.bufferViews[e.bufferView],a=X0[e.componentType];return new a(r.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==S_[e.type]*a.BYTES_PER_ELEMENT?i.byteStride/a.BYTES_PER_ELEMENT:S_[e.type]))}function ux(r,e,i,a){const o=X0[e.componentType],d=function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(o),p=r.json.bufferViews[e.bufferView],x=p.byteStride?p.byteStride/o.BYTES_PER_ELEMENT:S_[e.type],T=i.float32,A=T.length/i.capacity;for(let M=0,z=0;M<e.count*x;M+=x,z+=A)for(let D=0;D<A;D++)T[z+D]=a[M+D]*d;i._trim()}function j5(r,e,i){const a=r.indices,o=r.attributes,d={};d.indexArray=new cs;const p=e.json.accessors[a],x=p.count/3;d.indexArray.reserve(x);const T=ym(e,p);for(let D=0;D<x;D++)d.indexArray.emplaceBack(T[3*D],T[3*D+1],T[3*D+2]);d.indexArray._trim(),d.vertexArray=new pa;const A=e.json.accessors[o.POSITION];d.vertexArray.reserve(A.count);const M=ym(e,A);for(let D=0;D<A.count;D++)d.vertexArray.emplaceBack(M[3*D],M[3*D+1],M[3*D+2]);if(d.vertexArray._trim(),d.aabb=new Di(A.min,A.max),d.centroid=function(D,k){const B=[0,0,0],W=D.length;if(W>0){for(let Y=0;Y<W;Y++){const K=3*D[Y];B[0]+=k[K],B[1]+=k[K+1],B[2]+=k[K+2]}B[0]/=W,B[1]/=W,B[2]/=W}return B}(T,M),o.COLOR_0!==void 0){const D=e.json.accessors[o.COLOR_0],k=S_[D.type],B=ym(e,D);d.colorArray=k===3?new pa:new fo,d.colorArray.resize(D.count),ux(e,D,d.colorArray,B)}if(o.NORMAL!==void 0){d.normalArray=new pa;const D=e.json.accessors[o.NORMAL];d.normalArray.resize(D.count);const k=ym(e,D);ux(e,D,d.normalArray,k)}if(o.TEXCOORD_0!==void 0&&i.length>0){d.texcoordArray=new Sl;const D=e.json.accessors[o.TEXCOORD_0];d.texcoordArray.resize(D.count);const k=ym(e,D);ux(e,D,d.texcoordArray,k)}if(o._FEATURE_ID_RGBA4444!==void 0){const D=e.json.accessors[o._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=ym(e,D))}o._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(ym(e,e.json.accessors[o._FEATURE_RGBA4444]).buffer));const z=r.material;return d.material=function(D,k){const{emissiveFactor:B=[0,0,0],alphaMode:W="OPAQUE",alphaCutoff:Y=.5,normalTexture:K,occlusionTexture:ne,emissiveTexture:se,doubleSided:he}=D,{baseColorFactor:Re=[1,1,1,1],metallicFactor:Me=1,roughnessFactor:Ne=1,baseColorTexture:Fe,metallicRoughnessTexture:Ue}=D.pbrMetallicRoughness||{},ft=ne?k[ne.index]:void 0;if(ne&&ne.extensions&&ne.extensions.KHR_texture_transform&&ft){const $e=ne.extensions.KHR_texture_transform;ft.offsetScale=[$e.offset[0],$e.offset[1],$e.scale[0],$e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new $r(...Re),metallicFactor:Me,roughnessFactor:Ne,baseColorTexture:Fe?k[Fe.index]:void 0,metallicRoughnessTexture:Ue?k[Ue.index]:void 0},doubleSided:he,emissiveFactor:new $r(...B),alphaMode:W,alphaCutoff:Y,normalTexture:K?k[K.index]:void 0,occlusionTexture:ft,emissionTexture:se?k[se.index]:void 0,defined:D.defined===void 0}}(z!==void 0?e.json.materials[z]:{defined:!1},i),d}function Ab(r,e,i){const{matrix:a,rotation:o,translation:d,scale:p,mesh:x,extras:T,children:A}=r,M={};if(M.matrix=a||function(z,D,k,B){var W=D[0],Y=D[1],K=D[2],ne=D[3],se=W+W,he=Y+Y,Re=K+K,Me=W*se,Ne=W*he,Fe=W*Re,Ue=Y*he,ft=Y*Re,$e=K*Re,yt=ne*se,It=ne*he,bt=ne*Re,Et=B[0],jt=B[1],ht=B[2];return z[0]=(1-(Ue+$e))*Et,z[1]=(Ne+bt)*Et,z[2]=(Fe-It)*Et,z[3]=0,z[4]=(Ne-bt)*jt,z[5]=(1-(Me+$e))*jt,z[6]=(ft+yt)*jt,z[7]=0,z[8]=(Fe+It)*ht,z[9]=(ft-yt)*ht,z[10]=(1-(Me+Ue))*ht,z[11]=0,z[12]=k[0],z[13]=k[1],z[14]=k[2],z[15]=1,z}([],o||[0,0,0,1],d||[0,0,0],p||[1,1,1]),x!==void 0){M.meshes=i[x];const z=M.anchor=[0,0];for(const D of M.meshes){const{min:k,max:B}=D.aabb;z[0]+=k[0]+B[0],z[1]+=k[1]+B[1]}z[0]=Math.floor(z[0]/M.meshes.length/2),z[1]=Math.floor(z[1]/M.meshes.length/2)}if(T&&(T.id&&(M.id=T.id),T.lights&&(M.lights=function(z){if(!z.length)return[];const D=function(K){const ne=atob(K),se=new Uint8Array(ne.length);for(let he=0;he<ne.length;he++)se[he]=ne.codePointAt(he);return se}(z),k=[],B=D.length/24,W=new Uint16Array(D.buffer),Y=new Float32Array(D.buffer);for(let K=0;K<B;K++){const ne=W[2*K*6]/30,se=W[2*K*6+1]/30,he=W[2*K*6+10]/100,Re=Y[6*K+1],Me=Y[6*K+2],Ne=Y[6*K+3],Fe=Y[6*K+4],Ue=Ne-Re,ft=Fe-Me,$e=Math.hypot(Ue,ft);k.push({pos:[Re+.5*Ue,Me+.5*ft,se],normal:[ft/$e,-Ue/$e,0],width:$e,height:ne,depth:he,points:[Re,Me,Ne,Fe]})}return k}(T.lights))),A){const z=[];for(const D of A)z.push(Ab(e.json.nodes[D],e,i));M.children=z}return M}function N5(r){if(r.vertices.length===0||r.indices.length===0)return null;const e=new Kd(r.vertices,r.indices,8,256),[i,a]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:i,max:a}}function k5(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const a=[];for(const p of i){if(!Array.isArray(p)||p.length!==2)continue;const x=p[0],T=p[1];typeof x=="number"&&typeof T=="number"&&a.push(new Ct(x,T))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let o=0;for(let p=0;p<a.length;p++){const x=a[p],T=a[(p+1)%a.length],A=a[(p+2)%a.length];o+=(x.x-T.x)*(A.y-T.y)-(A.x-T.x)*(x.y-T.y)}o>0&&a.reverse();const d=Xh(a.flatMap(p=>[p.x,p.y]),[]);return d.length===0?null:{vertices:a,indices:d}}function B5(r,e){const i=[],a=[];let o=0;const d=[];for(const p of r){o=i.length;const x=p.vertexArray.float32,T=p.indexArray.uint16;for(let A=0;A<p.vertexArray.length;A++)d[0]=x[3*A+0],d[1]=x[3*A+1],d[2]=x[3*A+2],Tt(d,d,e),i.push(new Ct(d[0],d[1]));for(let A=0;A<3*p.indexArray.length;A++)a.push(T[A]+o)}if(a.length%3!=0)return null;for(let p=0;p<a.length;p+=3){const x=i[a[p+0]],T=i[a[p+1]],A=i[a[p+2]];(x.x-T.x)*(A.y-T.y)-(A.x-T.x)*(x.y-T.y)>0&&([a[p+1],a[p+2]]=[a[p+2],a[p+1]])}return{vertices:i,indices:a}}function Cb(r){const e=function(T,A){const M=[],z=WebGL2RenderingContext;if(T.json.textures)for(const D of T.json.textures){const k={magFilter:z.LINEAR,minFilter:z.NEAREST,wrapS:z.REPEAT,wrapT:z.REPEAT};D.sampler!==void 0&&Object.assign(k,T.json.samplers[D.sampler]),M.push({image:A[D.source],sampler:k,uploaded:!1})}return M}(r,r.images),i=function(T,A){const M=[];for(const z of T.json.meshes){const D=[];for(const k of z.primitives)D.push(j5(k,T,A));M.push(D)}return M}(r,e),{scenes:a,scene:o,nodes:d}=r.json,p=a?a[o||0].nodes:[...d.keys()],x=[];for(const T of p)x.push(Ab(d[T],r,i));return function(T,A,M){const z={},D=new Set;for(let k=0;k<T.length;k++){const B=M[A[k]];if(!B.extras)continue;const W=B.extras["mapbox:footprint:version"],Y=B.extras["mapbox:footprint:id"];(W||Y)&&D.add(k),W==="1.0.0"&&Y&&(z[Y]=k)}for(let k=0;k<T.length;k++){if(D.has(k))continue;const B=T[k],W=M[A[k]];if(!W.extras)continue;let Y=null;B.id in z&&(Y=B5(T[z[B.id]].meshes,B.matrix)),Y||(Y=k5(W)),Y&&(B.footprint=N5(Y))}if(D.size>0){const k=Array.from(D.values()).sort((B,W)=>B-W);for(let B=k.length-1;B>=0;B--)T.splice(k[B],1)}}(x,p,r.json.nodes),x}function F5(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,i=r.aabb.min[0]-1,a=r.aabb.min[1]-1,o=_m/(r.aabb.max[0]-i+2),d=_m/(r.aabb.max[1]-a+2);for(let p=0;p<e.length;p+=3){const x=e[p+2],T=(e[p+0]-i)*o|0,A=(e[p+1]-a)*d|0;x>r.heightmap[A*_m+T]&&(r.heightmap[A*_m+T]=x)}}function Rb(r,e,i,a,o){i.reserve(i.length+4*r.length),a.reserve(a.length+10*r.length),o.reserve(o.length+10*r.length);let d=a.length;for(const p of r){const x=Math.min(10,Math.max(4,1.3*p.height))*e,T=[-p.normal[1],p.normal[0],0],A=Math.min(.29,.1*p.width/p.depth),M=p.width-2*p.depth*e*(A+.01),z=Pi([],p.pos,T,M/2),D=Pi([],p.pos,T,-M/2),k=[z[0],z[1],z[2]+p.height],B=[D[0],D[1],D[2]+p.height],W=Pi([],p.normal,T,A);Ht(W,W,x);const Y=Pi([],p.normal,T,-A);Ht(Y,Y,x),Jt(W,z,W),Jt(Y,D,Y),z[2]+=.1,D[2]+=.1,a.emplaceBack(W[0],W[1],W[2]),a.emplaceBack(Y[0],Y[1],Y[2]),a.emplaceBack(z[0],z[1],z[2]),a.emplaceBack(D[0],D[1],D[2]),a.emplaceBack(k[0],k[1],k[2]),a.emplaceBack(B[0],B[1],B[2]),a.emplaceBack(z[0],z[1],z[2]),a.emplaceBack(D[0],D[1],D[2]),a.emplaceBack(W[0],W[1],W[2]),a.emplaceBack(Y[0],Y[1],Y[2]);const K=M/x/2;o.emplaceBack(-K-A,-1,K,.8),o.emplaceBack(K+A,-1,K,.8),o.emplaceBack(-K,0,K,1.3),o.emplaceBack(K,0,K,1.3),o.emplaceBack(K+A,-.8,K,.7),o.emplaceBack(K+A,-.8,K,.7),o.emplaceBack(0,0,K,1.3),o.emplaceBack(0,0,K,1.3),o.emplaceBack(K+A,-1.2,K,.8),o.emplaceBack(K+A,-1.2,K,.8),i.emplaceBack(6+d,4+d,8+d),i.emplaceBack(7+d,9+d,5+d),i.emplaceBack(0+d,1+d,2+d),i.emplaceBack(1+d,3+d,2+d),d+=10}}function U5(r,e){const i={};i.indexArray=new cs,i.vertexArray=new pa,i.colorArray=new fo,Rb(r,e,i.indexArray,i.vertexArray,i.colorArray);const a={defined:!0};a.emissiveFactor=$r.black;const o={};return o.baseColorFactor=$r.white,a.pbrMetallicRoughness=o,i.material=a,i.aabb=new Di([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const Mb=xr([{name:"a_pos_3f",components:3,type:"Float32"}]),V5=xr([{name:"a_normal_3",components:3,type:"Int16"}]),H5=xr([{name:"a_centroid_3",components:3,type:"Int16"}]),Ib=xr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),q5=xr([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),G5=xr([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),$5=xr([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),Z5=xr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),zb=St.types,hx=32767;function W5(r,e){const i=Vt+e;for(const a of r)for(const o of a)if(o.x<-163||o.x>i||o.y<-163||o.y>i)return!1;return!0}class Lb{constructor(){this.layoutVertexArray=new pa,this.layoutAttenuationArray=new fo,this.layoutColorArray=new rs,this.indexArray=new cs,this.indexArrayForConflation=new cs,this.segmentsBucket=new Wr}}class dx{constructor(){this.layoutVertexArray=new pa,this.layoutNormalArray=new Yc,this.layoutCentroidArray=new Yc,this.layoutColorArray=new rs,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutAOArray=[],this.indexArray=new cs,this.indexArrayForConflation=new cs,this.segmentsBucket=new Wr,this.entranceBloom=new Lb}}class Db{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new dx,this.buildingWithFacade=new dx,this.indexArrayForConflationUploaded=!1,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new rs,this.buildingWithFacade.layoutFacadeDataArray=new Jc,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new rs,this.programConfigurations=new $s(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.groundEffect=new b_(e)}updateFootprints(e,i){for(const a of this.footprints)i.push({footprint:a,id:e})}prepare(){return function(){if(W0!=null||hb!=null)return null;if(bg!=null)return bg;const e=fetch(Yn.BUILDING_GEN_URL);return bg=function(i){let a,o,d,p;function x(){a=new Uint8Array(p.buffer),o=new Int32Array(p.buffer),d=new Float32Array(p.buffer)}function T(){throw new Error("Unexpected BuildingGen error.")}const A=()=>{},M={a:{a:T,f:function(z){const D=a.length,k=Math.max(z>>>0,Math.ceil(1.2*D)),B=Math.ceil((k-D)/65536);try{return p.grow(B),x(),!0}catch{return!1}},g:T,b:A,c:A,d:A,e:A}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,M):i.then(z=>z.arrayBuffer()).then(z=>WebAssembly.instantiate(z,M))).then(z=>{const D=z.instance.exports;return(0,D.g)(),p=D.f,x(),new b5({setStyle:D.h,setAOOptions:D.i,setMetricOptions:D.j,setStructuralOptions:D.k,setFacadeOptions:D.l,setFauxFacadeOptions:D.m,setFacadeClassifierOptions:D.n,addFeature:D.o,addFacade:D.p,generateMesh:D.q,getLastError:D.r,getOuterRingLength:D.s,getMeshCount:D.t,getPositionsPtr:D.u,getPositionsLength:D.v,getNormalsPtr:D.w,getNormalsLength:D.x,getColorsPtr:D.y,getColorsLength:D.z,getAOPtr:D.A,getAOLength:D.B,getUVPtr:D.C,getUVLength:D.D,getFauxFacadePtr:D.E,getFauxFacadeLength:D.F,getIndicesPtr:D.G,getIndicesLength:D.H,getBuildingPart:D.I,getRingCount:D.J,getRingPtr:D.K,getRingLength:D.L,free:D.M,malloc:D.N,heapU8:a,heap32:o,heapF32:d})})}(e).then(i=>(bg=null,W0=i,W0)).catch(i=>{ur("Could not load building-gen"),bg=null,hb=i}),bg}()}populate(e,i,a,o){const d=w5();if(!d)return;const p=Ze(a);this.tileToMeter=p,this.brightness=i.brightness,d.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,p],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:p,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),d.setAOOptions(!1,.3),d.setMetricOptions(!1,16),d.setStructuralOptions(!0),d.setFacadeClassifierOptions(3);const x=new Map;for(const{feature:T}of e){if(zb[T.type]!=="LineString")continue;const A=this.layers[0]._featureFilter.needGeometry,M=Rt(T,A);if(!this.layers[0]._featureFilter.filter(new on(this.zoom),M,a))continue;const z=A?M.geometry:$t(T,a,o),D=[];for(const Y of z)for(const K of Y)D.push({x:K.x,y:K.y});const k={coordinates:D,crossPerc:T.properties.cross_perc,distanceToRoad:T.properties.distance_to_road,entrances:T.properties.entrances,sourceId:0},B=T.properties.source_id;let W=x.get(B);W||(W=[],x.set(B,W)),W.push(k)}this.maxHeight=0;for(const{feature:T,index:A}of e){if(zb[T.type]==="LineString")continue;const M=this.layers[0]._featureFilter.needGeometry,z=Rt(T,M);if(!this.layers[0]._featureFilter.filter(new on(this.zoom),z,a))continue;const D=M?z.geometry:$t(T,a,o),k=cm(D,500);if(!W5(D,163))continue;const B=this.layers[0],W=B.layout.get("building-base").evaluate(T,{},a),Y=B.layout.get("building-height").evaluate(T,{},a),K=B.layout.get("building-roof-shape").evaluate(T,{},a),ne=B.paint.get("building-ambient-occlusion-intensity"),se=B.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(K==="flat")continue;const he=B.layout.get("building-facade").evaluate(T,{},a);d.setFacadeOptions(4,!0),d.setFauxFacadeOptions(he,!1,1);const Re=T.properties.source_id;let Me;Me=x.has(Re)?x.get(Re):[];let Ne=0,Fe=0,Ue=0,ft=0,$e=0,yt=0;if(he){let hi=Math.round(B.layout.get("building-facade-floors").evaluate(T,{},a));if(W===0){hi=Math.max(1,hi-(Me.length>0?1:0));let Dr=4;if(Y>100){const pe=[10,13,15];Dr=pe[T.id?T.id%pe.length:0],d.setFacadeOptions(Dr,!0)}$e=1.6803*Dr/p}else $e=W/p;yt=Y/p,$e=Math.min($e,yt),Ue=B.layout.get("building-facade-unit-width").evaluate(T,{},a)/p,ft=(yt-$e)/hi,d.setFauxFacadeOptions(!0,!0,Ue);const tr=B.layout.get("building-facade-window").evaluate(T,{},a);Ne=tr[0],Fe=tr[1]}const It=[],bt=new Ct(1/0,1/0),Et=new Ct(-1/0,-1/0),jt=new Ct(0,0);let ht=0;for(const hi of k)if(hi.length>0){const tr=[];for(const Dr of hi){const pe=[];for(let ge=Dr.length-1;ge>=0;ge--){const st=Dr[ge];pe.push({x:st.x,y:st.y}),bt.x=Math.min(bt.x,st.x),bt.y=Math.min(bt.y,st.y),Et.x=Math.max(Et.x,st.x),Et.y=Math.max(Et.y,st.y),jt.x+=st.x,jt.y+=st.y,ht++}tr.push(pe)}It.push({id:T.id?T.id:0,height:Y,minHeight:W,sourceId:0,roofType:K,coordinates:tr})}jt.x/=ht||1,jt.y/=ht||1;const At=d.generateMesh(It,Me);if(typeof At=="string"){ur(`Unable to generate building ${T.id}: ${At}`);continue}if(At.meshes.length===0||At.modifiedPolygonRings.length===0)continue;let at=0;for(const hi of At.meshes)at+=hi.positions.length/3;const et=he?this.buildingWithFacade:this.buildingWithoutFacade,kt=et.segmentsBucket.prepareSegment(at,et.layoutVertexArray,et.indexArray),Ot=[];let bi=null,oi=0,fi=-1;const qt=et.indexArray.length;let vi=0;for(const hi of At.meshes){const tr=et.layoutVertexArray.length;if(hi.buildingPart==="entrance"){const dt=new Array;for(let Ei=0;Ei<hi.indices.length;Ei+=12){const fr=hi.positions[Ei+0],gr=hi.positions[Ei+1],ar=hi.positions[Ei+3],en=hi.positions[Ei+4],Dn=hi.positions[Ei+2],sr=hi.positions[Ei+8]-Dn,wn=1,sn=ar-fr,Gr=en-gr,An=Math.hypot(sn,Gr);dt.push({pos:[fr+.5*sn,gr+.5*Gr,Dn],normal:[Gr/An,-sn/An,0],width:An,height:sr,depth:wn,points:[fr,gr,ar,en]})}const Wt=et.entranceBloom.segmentsBucket.prepareSegment(10*dt.length,et.entranceBloom.layoutVertexArray,et.entranceBloom.indexArray),Zt=et.entranceBloom.layoutVertexArray.length;oi=et.entranceBloom.indexArray.length,Rb(dt,.5/this.tileToMeter,et.entranceBloom.indexArray,et.entranceBloom.layoutVertexArray,et.entranceBloom.layoutAttenuationArray);const ui=et.entranceBloom.layoutVertexArray.length-Zt;fi=et.entranceBloom.indexArray.length-oi;for(let Ei=0;Ei<ui;Ei++)et.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Wt.vertexLength+=ui,Wt.primitiveLength+=fi,bi={part:hi.buildingPart,vertexOffset:Zt,vertexLength:ui}}for(let dt=0;dt<hi.positions.length;dt+=3)vi=Math.max(vi,hi.positions[dt+2]),et.layoutVertexArray.emplaceBack(hi.positions[dt],hi.positions[dt+1],hi.positions[dt+2]);const Dr=Math.floor(jt.x),pe=Math.floor(jt.y),ge=Math.floor(vi);for(let dt=0;dt<hi.positions.length;dt+=3)et.layoutCentroidArray.emplaceBack(Dr,pe,ge);for(let dt=0;dt<hi.normals.length;dt+=3)et.layoutNormalArray.emplaceBack(hi.normals[dt+0]*hx,hi.normals[dt+1]*hx,hi.normals[dt+2]*hx);for(let dt=0;dt<hi.ao.length;dt++)et.layoutAOArray.push(hi.ao[dt]);for(let dt=0;dt<hi.colors.length;dt+=3){const Wt=1+(hi.ao[dt/3]-1)*ne;et.layoutColorArray.emplaceBack(hi.colors[dt]*Wt<<8|hi.colors[dt+1]*Wt,hi.colors[dt+2]*Wt<<8)}if(he){for(let dt=0;dt<hi.positions.length;dt+=3)et.layoutFacadePaintArray.emplaceBack(65535,255);for(let dt=0;dt<hi.isFauxFacade.length;dt++)if(hi.isFauxFacade[dt]){const Wt=1|Math.min(65535,Math.floor(hi.uv[2*dt]*At.outerRingLength)),Zt=Math.floor(255*Ne)<<8|Math.floor(255*Fe),ui=Math.floor(65535*Math.min(1,Ue/Vt)),Ei=Math.floor(65535*Math.min(1,ft/Vt));et.layoutFacadeDataArray.emplaceBack(Wt,Zt,ui,Ei);const fr=Math.floor(65535*Math.min(1,$e/Vt)),gr=Math.floor(65535*Math.min(1,yt/Vt));et.layoutFacadeVerticalRangeArray.emplaceBack(fr,gr)}else et.layoutFacadeDataArray.emplaceBack(0,0,0,0),et.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const st=kt.vertexLength;for(let dt=0;dt<hi.indices.length;dt+=3)et.indexArray.emplaceBack(st+hi.indices[dt],st+hi.indices[dt+1],st+hi.indices[dt+2]);kt.vertexLength+=hi.positions.length/3,kt.primitiveLength+=hi.indices.length/3,(hi.buildingPart==="roof"||hi.buildingPart==="wall"||hi.buildingPart==="facade_glazing"||hi.buildingPart==="entrance")&&Ot.push({part:hi.buildingPart,vertexOffset:tr,vertexLength:hi.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,vi),this.buildingFeatures.push({feature:z,hasFauxFacade:he,segment:kt,parts:Ot,buildingBloom:bi});const Gi=et.indexArray.length-qt,Xt=[],mi=[],Ni=new Ct(1/0,1/0),Qi=new Ct(-1/0,-1/0),dr=this.groundEffect.vertexArray.length;for(const hi of At.modifiedPolygonRings){const tr=[],Dr=new Ct(1/0,1/0),pe=new Ct(-1/0,-1/0);for(let ge=0;ge<hi.length;ge+=2){const st=hi.length-ge-2;Dr.x=Math.min(Dr.x,hi[st]),Dr.y=Math.min(Dr.y,hi[st+1]),pe.x=Math.max(pe.x,hi[st]),pe.y=Math.max(pe.y,hi[st+1]);const dt=new Ct(hi[st],hi[st+1]);tr.push(dt),Xt.push(dt.x,dt.y),mi.push(dt.clone())}Ni.x=Math.min(Ni.x,Dr.x),Ni.y=Math.min(Ni.y,Dr.y),Qi.x=Math.max(Qi.x,pe.x),Qi.y=Math.max(Qi.y,pe.y),this.groundEffect.addData(tr,[Dr,pe],se)}const rr=this.groundEffect.vertexArray.length-dr;(bt.x<0||Et.x>Vt||bt.y<0||Et.y>Vt)&&this.featuresOnBorder.push({featureId:T.id,footprintIndex:this.footprints.length});{const hi=Xh(Xt,null,2),tr=new Kd(mi,hi,8,256);let Dr=T.id;T.properties&&T.properties.hasOwnProperty("building_id")&&(Dr=T.properties.building_id),this.footprints.push({vertices:mi,indices:hi,grid:tr,min:Ni,max:Qi,buildingId:Dr,hiddenFlags:0,indicesOffset:qt,indicesLength:Gi,bloomIndicesOffset:oi,bloomIndicesLength:fi,groundEffectVertexOffset:dr,groundEffectVertexLength:rr,hasFauxFacade:he,segment:kt,height:vi})}this.programConfigurations.populatePaintArrays(et.layoutVertexArray.length,T,A,{},i.availableImages,a,i.brightness),this.groundEffect.addPaintPropertiesData(T,A,{},i.availableImages,a,i.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,i,a,o,d,p,x){this.programConfigurations.updatePaintArrays(e,i,d,a,o,p,x),this.groundEffect.update(e,i,d,a,o,p,x),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=a=>{a.layoutVertexBuffer=e.createVertexBuffer(a.layoutVertexArray,Mb.members),a.layoutNormalBuffer=e.createVertexBuffer(a.layoutNormalArray,V5.members),a.layoutCentroidBuffer=e.createVertexBuffer(a.layoutCentroidArray,H5.members),a.layoutFacadeDataArray&&a.layoutFacadeDataArray.length&&(a.layoutFacadeDataBuffer=e.createVertexBuffer(a.layoutFacadeDataArray,G5.members)),a.layoutFacadeVerticalRangeArray&&a.layoutFacadeVerticalRangeArray.length&&(a.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(a.layoutFacadeVerticalRangeArray,$5.members)),a.entranceBloom.layoutVertexArray.length&&(a.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(a.entranceBloom.layoutVertexArray,Mb.members),a.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(a.entranceBloom.layoutAttenuationArray,Z5.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,a=!0){let o=!1;const d=a?i:0,p=0|(a?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const x of e){const T=this.footprints[x],A=T.hiddenFlags&p|d;T.hiddenFlags!==A&&(T.hiddenFlags=A,o=!0,this.groundEffect.updateHiddenByLandmarkRange(T.groundEffectVertexOffset,T.groundEffectVertexLength,T.hiddenFlags!==0))}return o&&(this.indexArrayForConflationUploaded=!1),o}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=o=>{o.indexArray.length!==0&&(o.indexArrayForConflation.resize(o.indexArray.length),o.indexArrayForConflation.uint16.set(o.indexArray.uint16),o.entranceBloom.indexArrayForConflation.resize(o.entranceBloom.indexArray.length),o.entranceBloom.indexArrayForConflation.uint16.set(o.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const o of this.footprints){const d=o.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,p=o.indicesOffset+o.indicesLength;if(o.hiddenFlags!==0){for(let T=o.indicesOffset;T<p;T++)d.indexArrayForConflation.uint16[3*T+0]=0,d.indexArrayForConflation.uint16[3*T+1]=0,d.indexArrayForConflation.uint16[3*T+2]=0;const x=o.bloomIndicesOffset+o.bloomIndicesLength;for(let T=o.bloomIndicesOffset;T<x;T++)d.entranceBloom.indexArrayForConflation.uint16[3*T+0]=0,d.entranceBloom.indexArrayForConflation.uint16[3*T+1]=0,d.entranceBloom.indexArrayForConflation.uint16[3*T+2]=0}}const a=o=>{o.indexArray.length!==0&&(o.indexBuffer?o.indexBuffer.updateData(o.indexArrayForConflation):o.indexBuffer=e.createIndexBuffer(o.indexArrayForConflation,!0),o.entranceBloom.indexBuffer?o.entranceBloom.indexBuffer.updateData(o.entranceBloom.indexArrayForConflation):o.entranceBloom.indexBuffer=e.createIndexBuffer(o.entranceBloom.indexArrayForConflation,!0))};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=a=>{a.layoutColorBuffer?a.layoutColorBuffer.updateData(a.layoutColorArray):a.layoutColorBuffer=e.createVertexBuffer(a.layoutColorArray,Ib.members,!0),a.layoutFacadePaintArray&&(a.layoutFacadePaintBuffer?a.layoutFacadePaintBuffer.updateData(a.layoutFacadePaintArray):a.layoutFacadePaintBuffer=e.createVertexBuffer(a.layoutFacadePaintArray,q5.members,!0)),a.entranceBloom.layoutColorBuffer?a.entranceBloom.layoutColorBuffer.updateData(a.entranceBloom.layoutColorArray):a.entranceBloom.layoutColorBuffer=e.createVertexBuffer(a.entranceBloom.layoutColorArray,Ib.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const a=e.paint.get("building-ambient-occlusion-intensity");for(const o of this.buildingFeatures){const d=i[o.feature.id],p=o.feature;p.properties["building-part"]="roof";const x=e.paint.get("building-color").evaluate(p,d,this.canonical).toPremultipliedRenderColor(this.lut),T=e.paint.get("building-emissive-strength").evaluate(p,d,this.canonical);p.properties["building-part"]="wall";const A=e.paint.get("building-color").evaluate(p,d,this.canonical).toPremultipliedRenderColor(this.lut),M=e.paint.get("building-emissive-strength").evaluate(p,d,this.canonical);p.properties["building-part"]="window";const z=e.paint.get("building-color").evaluate(p,d,this.canonical).toPremultipliedRenderColor(this.lut),D=e.paint.get("building-emissive-strength").evaluate(p,d,this.canonical);p.properties["building-part"]="door";const k=e.paint.get("building-color").evaluate(p,d,this.canonical).toPremultipliedRenderColor(this.lut),B=e.paint.get("building-emissive-strength").evaluate(p,d,this.canonical),W=o.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const K of o.parts){let ne,se=x;K.part==="roof"?(se=x,ne=T):K.part==="wall"?(se=A,ne=M):K.part==="facade_glazing"?(se=z,ne=D):K.part==="entrance"&&(se=k,ne=B),ne=Ie(ne,0,1);for(let he=0;he<K.vertexLength;he++){const Re=K.vertexOffset+he,Me=1+(W.layoutAOArray[Re]-1)*a;W.layoutColorArray.emplace(Re,se.r*Me*255<<8|se.g*Me*255,se.b*Me*255<<8|255*ne),o.hasFauxFacade&&W.layoutFacadePaintArray.emplace(Re,255*z.r<<8|255*z.g,255*z.b<<8|255*D)}}const Y=o.buildingBloom;if(Y)for(let K=0;K<Y.vertexLength;K++)W.entranceBloom.layoutColorArray.emplace(Y.vertexOffset+K,255*k.r<<8|255*k.g,255*k.b<<8|51*B)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped());if(np(this.activeReplacements,o))return;this.activeReplacements=o;for(const p of this.footprints)p.hiddenFlags&=-2;const d=[];for(const p of this.activeReplacements){if(p.order<=y_)continue;const x=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));for(const T of this.footprints)T.min.x>p.max.x||T.max.x<p.min.x||T.min.y>p.max.y||T.max.y<p.min.y||(d.length=0,X5(T.vertices,0,T.vertices.length,p.footprintTileId.canonical,e.canonical,d),pg(p.footprint,d,T.indices,0,T.indices.length,0,-x)&&(T.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const p of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(p.groundEffectVertexOffset,p.groundEffectVertexLength,p.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,o=!0;const d=4*(e+Vt)*Vt+(i+Vt);if(this.footprintLookup.hasOwnProperty(d)){const x=this.footprintLookup[d];return x?{height:x.height,hidden:x.hiddenFlags!==0}:void 0}const p=new Ct(e,i);for(const x of this.footprints)e>x.max.x||x.min.x>e||i>x.max.y||x.min.y>i||x.height<=a||tu(p,x)&&(a=x.height,this.footprintLookup[d]=x,o=x.hiddenFlags!==0);if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:o};this.footprintLookup[d]=void 0}}function X5(r,e,i,a,o,d){const p=Math.pow(2,a.z-o.z);for(let x=0;x<i;x++){let T=r[x+e].x,A=r[x+e].y;T=(T+o.x*Vt)*p-a.x*Vt,A=(A+o.y*Vt)*p-a.y*Vt,d.push(new Ct(T,A))}}let Pb,Ob;si(Db,"BuildingBucket",{omit:["layers"]}),si(dx,"BuildingGeometry"),si(Lb,"BuildingBloomGeometry");const Y5=xr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),K5=xr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:J5}=Y5,Q5=xr([{name:"a_packed",components:3,type:"Float32"}]),{members:eE}=Q5,tE=xr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:iE}=tE;class jb{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Es({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const a=this.getKey(e,i);return this.positions[a]}trim(){const e=this.width,i=this.height=pi(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,a){const o=[];let d=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,x=!0;o.push({left:d,right:p,isDash:x,zeroLength:e[0]===0});let T=e[0];for(let A=1;A<e.length;A++){x=!x;const M=e[A];d=T*a,T+=M,p=T*a,o.push({left:d,right:p,isDash:x,zeroLength:M===0})}return o}addRoundDash(e,i,a){const o=i/2;for(let d=-a;d<=a;d++){const p=this.width*(this.nextRow+a+d);let x=0,T=e[x];for(let A=0;A<this.width;A++){A/T.right>1&&(T=e[++x]);const M=Math.abs(A-T.left),z=Math.abs(A-T.right),D=Math.min(M,z);let k;const B=d/a*(o+1);if(T.isDash){const W=o-Math.abs(B);k=Math.sqrt(D*D+W*W)}else k=o-Math.sqrt(D*D+B*B);this.image.data[p+A]=Math.max(0,Math.min(255,k+128))}}}addRegularDash(e,i){for(let T=e.length-1;T>=0;--T){const A=e[T],M=e[T+1];A.zeroLength?e.splice(T,1):M&&M.isDash===A.isDash&&(M.left=A.left,e.splice(T,1))}const a=e[0],o=e[e.length-1];a.isDash===o.isDash&&(a.left=o.left-this.width,o.right=a.right+this.width);const d=this.width*this.nextRow;let p=0,x=e[p];for(let T=0;T<this.width;T++){T/x.right>1&&(x=e[++p]);const A=Math.abs(T-x.left),M=Math.abs(T-x.right),z=Math.min(A,M);this.image.data[d+T]=Math.max(0,Math.min(255,(x.isDash?z:-z)+i+128))}}addDash(e,i){const a=this.getKey(e,i);if(this.positions[a])return this.positions[a];const o=i==="round",d=o?7:0,p=2*d+1;if(this.nextRow+p>this.height)return ur("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let M=0;M<e.length;M++)e[M]<0&&(ur("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),x+=e[M];if(x!==0){const M=this.width/x,z=this.getDashRanges(e,this.width,M);o?this.addRoundDash(z,M,d):this.addRegularDash(z,i==="square"?.5*M:0)}const T=this.nextRow+d;this.nextRow+=p;const A={tl:[T,d],br:[x,0]};return this.positions[a]=A,A}}si(jb,"LineAtlas");const rE=St.types,nE=Math.cos(Math.PI/180*37.5),sE=Math.cos(Math.PI/180*5);class fx{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Ud,this.layoutVertexArray2=new pa,this.patternVertexArray=new pa,this.indexArray=new cs,this.programConfigurations=new $s(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Wr,this.maxLineLength=0,this.zOffsetVertexArray=new pa,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Vt/64,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,a,o){this.hasPattern=lg("line",this.layers,this.pixelRatio,i);const d=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Ze(a);const p=this.layers[0].layout.get("line-elevation-reference");if(p==="hd-road-markup")this.elevationType="road";else{const D=this.layers[0].layout.get("line-z-offset"),k=D.isConstant()&&!D.constantOr(0);this.elevationType=p!=="sea"&&p!=="ground"&&k?"none":"offset",this.elevationType==="offset"&&p==="none"&&ur(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const x=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&x!==void 0;const T=[];for(const{feature:D,id:k,index:B,sourceLayerIndex:W}of e){const Y=this.layers[0]._featureFilter.needGeometry,K=Rt(D,Y);if(!this.layers[0]._featureFilter.filter(new on(this.zoom,{worldview:this.worldview}),K,a))continue;const ne=d?d.evaluate(K,{},a):void 0,se={id:k,properties:D.properties,type:D.type,sourceLayerIndex:W,index:B,geometry:Y?K.geometry:$t(D,a,o),patterns:{},sortKey:ne};T.push(se)}d&&T.sort((D,k)=>D.sortKey-k.sortKey);const{lineAtlas:A,featureIndex:M}=i,z=this.addConstantDashes(A);for(const D of T){const{geometry:k,index:B,sourceLayerIndex:W}=D;if(z&&this.addFeatureDashes(D,A),this.hasPattern){const Y=Kh("line",this.layers,D,this.zoom,this.pixelRatio,i);this.patternFeatures.push(Y)}else this.addFeature(D,k,B,a,A.positions,i.availableImages,i.brightness,i.elevationFeatures);M.insert(e[B].feature,k,B,W,this.index)}}addConstantDashes(e){let i=!1;for(const a of this.layers){const o=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(o.kind!=="constant"||d.kind!=="constant")i=!0;else{const p=d.value,x=o.value;if(!x)continue;e.addDash(x,p)}}return i}addFeatureDashes(e,i){const a=this.zoom;for(const o of this.layers){const d=o.paint.get("line-dasharray").value,p=o.layout.get("line-cap").value;if(d.kind==="constant"&&p.kind==="constant")continue;let x,T;if(d.kind==="constant"){if(x=d.value,!x)continue}else x=d.evaluate({zoom:a},e);T=p.kind==="constant"?p.value:p.evaluate({zoom:a},e),i.addDash(x,T),e.patterns[o.id]=[i.getKey(x,T)]}}update(e,i,a,o,d,p,x,T){this.programConfigurations.updatePaintArrays(e,i,d,a,o,p,x,T)}addFeatures(e,i,a,o,d,p){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,a,o,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,eE)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,iE)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,K5.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,J5),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let a,o;if(i&&i>0?(a=`mapbox_clip_start_${i}`,o=`mapbox_clip_end_${i}`):(a="mapbox_clip_start",o="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(a)&&e.properties.hasOwnProperty(o))return{start:+e.properties[a],end:+e.properties[o]}}addFeature(e,i,a,o,d,p,x,T){const A=this.layers[0].layout,M=A.get("line-join").evaluate(e,{}),z=A.get("line-cap").evaluate(e,{}),D=A.get("line-miter-limit"),k=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const B=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=A.get("line-z-offset").value;const W=this.layers[0].paint.get("line-width").value;if(W.kind!=="constant"&&W.isLineProgressConstant===!1&&(this.variableWidthValue=W),this.elevationType==="road"){const Y=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,o,T,M,z,D,k)){const[K,ne]=this.clipRuntimeLinesToTile(i,1);for(let se=0;se<K.length;se++){const he=K[se],Re=ne[se],Me={progress:{min:Re.progress.min,max:Re.progress.max},nextDir:this.computeSegNextDir(Re,he),prevDir:this.computeSegPrevDir(Re,he)};this.addLine(he,e,o,M,z,D,k,Me,B&&Re.parentIndex>0?Re.parentIndex:null)}this.fillNonElevatedRoadSegment(Y)}}else for(let Y=0;Y<i.length;Y++)this.addLine(i[Y],e,o,M,z,D,k,void 0,B&&Y>0?Y:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,p,o,x,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return _s(e,-i,-i,Vt+i,Vt+i)}clipRuntimeLinesToTile(e,i){const a=[];return[_s(e,-i,-i,Vt+i,Vt+i,a),a]}addElevatedRoadFeature(e,i,a,o,d,p,x,T){const A=[],M=Vr.getElevationFeature(e,o);if(M){const z=this.clipLinesToTile(i,1),D=this.prepareElevatedLines(z,M,a);for(const k of D)A.push({geometry:k,elevation:M,elevationTileID:a,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(A.length===0)return!1;for(const z of A){const D=this.layoutVertexArray.length;this.addLine(z.geometry,e,a,d,p,x,T);const k=new es(a,z.elevationTileID);if(z.elevation)for(let B=D;B<this.layoutVertexArray.length;B++){const W=new Ct(this.layoutVertexArray.int16[6*B]>>1,this.layoutVertexArray.int16[6*B+1]>>1),Y=k.pointElevation(W,z.elevation,.05);this.updateHeightRange(Y),this.zOffsetVertexArray.emplaceBack(Y,0,0)}else this.fillNonElevatedRoadSegment(D)}return!0}prepareElevatedLines(e,i,a){if(i.constantHeight!=null)return e;const o=[],d=1/Ze(a);for(const p of e)Mt(p,new wr(i,d),0,o);return o}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,a,o,d,p,x,T,A){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=A?this.lineFeatureClips(i,A):this.lineClips;const M=o==="none";this.patternJoinNone=this.hasPattern&&M,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const z=T&&T.progress.min>0,D=T&&T.progress.max<1;if(this.lineClips){let Ue={min:this.lineClips.start,max:this.lineClips.end},ft=1;if(T){const It=this.lineClips.end-this.lineClips.start;Ue=function(bt,Et,jt){return{min:In(bt.min,Et,jt),max:In(bt.max,Et,jt)}}(T.progress,{min:0,max:1},Ue),It>0&&(ft=(Ue.max-Ue.min)/It)}const $e=+i.properties.mapbox_clip_feature_len,yt=+i.properties.mapbox_clip_seg_len;if(Number.isNaN($e)||Number.isNaN(yt)){for(let bt=0;bt<e.length-1;bt++)this.totalDistance+=e[bt].dist(e[bt+1]);const It=this.totalDistance/(Ue.max-Ue.min);this.totalFeatureLength=Number.isFinite(It)?It:0,this.lineClips.start=Ue.min,this.lineClips.end=Ue.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=$e,this.distance=yt*ft,this.lineClips.start=Ue.min,this.lineClips.end=Ue.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const k=rE[i.type]==="Polygon";let B=e.length;for(;B>=2&&e[B-1].equals(e[B-2]);)B--;let W=0;for(;W<B-1&&e[W].equals(e[W+1]);)W++;if(B<(k?3:2))return;o==="bevel"&&(p=1.05);const Y=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray);let K,ne,se,he,Re,Me,Ne,Fe;T&&T.prevDir&&(Me=T.prevDir.perp()),T&&T.nextDir&&(Ne=T.nextDir.perp()),this.e1=this.e2=-1,k&&(K=e[B-2],Re=e[W].sub(K)._unit()._perp());for(let Ue=W;Ue<B;Ue++){if(se=Ue===B-1?k?e[W+1]:void 0:e[Ue+1],se&&e[Ue].equals(se))continue;Re&&(he=Re),K&&(ne=K),K=e[Ue],Fe=this.evaluateLineProgressFeatures(ne?ne.dist(K):0),Re=se?se.sub(K)._unit()._perp():he,he=he||Re;const ft=ne&&se;let $e=ft?o:k||M?"butt":d;const yt=he.x*Re.x+he.y*Re.y;if(M){const et=function(kt){if(kt.patternJoinNone){const Ot=kt.segmentPoints.length/2,bi=kt.lineSoFar-kt.segmentStart;for(let oi=0;oi<Ot;++oi){const fi=kt.segmentPoints[2*oi+1],qt=Math.round(kt.segmentPoints[2*oi])+.5+.25*fi;kt.patternVertexArray.emplaceBack(qt,bi,kt.segmentStart),kt.patternVertexArray.emplaceBack(qt,bi,kt.segmentStart)}kt.segmentPoints.length=0}kt.e1=kt.e2=-1};if(ft&&yt<sE){this.updateDistance(ne,K),this.addCurrentVertex(K,he,1,1,Y,Fe),et(this),this.addCurrentVertex(K,Re,-1,-1,Y,Fe);continue}if(ne){if(!se){this.updateDistance(ne,K),this.addCurrentVertex(K,he,1,1,Y,Fe),et(this);continue}$e="miter"}}let It=he.add(Re);It.x===0&&It.y===0||It._unit();const bt=It.x*Re.x+It.y*Re.y,Et=bt!==0?1/bt:1/0,jt=2*Math.sqrt(2-2*bt),ht=bt<nE&&ne&&se,At=he.x*Re.y-he.y*Re.x>0,at=this.overscaling<=16?15*Vt/(512*this.overscaling):0;if(ft&&$e==="round"){if(Et<x)$e="miter";else if(Et<=2){const et=px(K,-10,Vt+10);$e=this.elevationType==="offset"&&(et||this.hasCrossSlope)?"miter":"fakeround"}}if($e==="miter"&&Et>p&&($e="bevel"),$e==="bevel"&&(Et>2&&($e="flipbevel"),Et<p&&($e="miter")),ne&&!($e==="miter"&&ht)&&this.updateDistance(ne,K),$e==="miter")if(ht){const et=K.dist(ne);if(et>2*at){const Ot=K.sub(K.sub(ne)._mult(at/et)._round());this.updateDistance(ne,Ot),this.addCurrentVertex(Ot,he,0,0,Y,Fe),ne=Ot}this.updateDistance(ne,K),It._mult(Et),this.addCurrentVertex(K,It,0,0,Y,Fe);const kt=K.dist(se);if(kt>2*at){const Ot=K.add(se.sub(K)._mult(at/kt)._round());this.updateDistance(K,Ot),this.addCurrentVertex(Ot,Re,0,0,Y,Fe),K=Ot}}else It._mult(Et),this.addCurrentVertex(K,It,0,0,Y,Fe);else if($e==="flipbevel"){if(Et>100)It=Re.mult(-1);else{const et=Et*he.add(Re).mag()/he.sub(Re).mag();It._perp()._mult(et*(At?-1:1))}this.addCurrentVertex(K,It,0,0,Y,Fe),this.addCurrentVertex(K,It.mult(-1),0,0,Y,Fe)}else if($e==="bevel"||$e==="fakeround"){Fe!=null&&ne&&this.addCurrentVertex(K,Ne||he,-1,-1,Y,Fe);const et=K.dist(ne)<=2*at&&$e!=="bevel",kt=It.mult(At?1:-1);kt._mult(Et);const Ot=Re.mult(At?-1:1),bi=he.mult(At?-1:1),oi=this.evaluateLineProgressFeatures(this.distance);if(Fe==null&&(this.addHalfVertex(K,kt.x,kt.y,!1,!At,0,Y,oi),et||this.addHalfVertex(K,kt.x+2*bi.x,kt.y+2*bi.y,!1,At,0,Y,oi)),$e==="fakeround"){const fi=Math.round(180*jt/Math.PI/20);this.addHalfVertex(K,bi.x,bi.y,!1,At,0,Y,oi);for(let qt=0;qt<fi;qt++){let vi=qt/fi;if(vi!==.5){const Xt=vi-.5;vi+=vi*Xt*(vi-1)*((1.0904+yt*(yt*(3.55645-1.43519*yt)-3.2452))*Xt*Xt+(.848013+yt*(.215638*yt-1.06021)))}const Gi=Ot.sub(bi)._mult(vi)._add(bi)._unit();this.addHalfVertex(K,Gi.x,Gi.y,!1,At,0,Y,oi)}this.addHalfVertex(K,Ot.x,Ot.y,!1,At,0,Y,oi)}et||Fe!=null||this.addHalfVertex(K,kt.x+2*Ot.x,kt.y+2*Ot.y,!1,At,0,Y,oi),Fe!=null&&se&&this.addCurrentVertex(K,Me||Re,1,1,Y,Fe)}else if($e==="butt")this.addCurrentVertex(K,It,0,0,Y,Fe);else if($e==="square"){if(!ne){const et=z?0:-1;this.addCurrentVertex(K,It,et,et,Y,Fe)}if(this.addCurrentVertex(K,It,0,0,Y,Fe),ne){const et=D?0:1;this.addCurrentVertex(K,It,et,et,Y,Fe)}}else if($e==="round"){if(ne){const et=!ft&&Ne?Ne:he;this.addCurrentVertex(K,et,0,0,Y,Fe),!ft&&D||this.addCurrentVertex(K,et,1,1,Y,Fe,!0)}if(se){const et=!ft&&Me?Me:Re;!ft&&z||this.addCurrentVertex(K,et,-1,-1,Y,Fe,!0),this.addCurrentVertex(K,et,0,0,Y,Fe)}}}}addVerticesTo(e,i,a,o,d,p,x,T,A,M){const z=(i.w-e.w)/this.tessellationStep|0;let D=0;const k=this.scaledDistance;if(z>1){this.lineSoFar=e.w;const W=(i.x-e.x)/z,Y=(i.y-e.y)/z,K=(i.z-e.z)/z,ne=(i.w-e.w)/z;for(let se=1;se<z;++se){e.x+=W,e.y+=Y,e.z+=K,this.lineSoFar+=ne,D+=ne;const he=this.evaluateLineProgressFeatures(this.prevDistance+D);this.scaledDistance=(this.prevDistance+D)/this.totalDistance,this.addHalfVertex(e,a,o,M,!1,x,A,he),this.addHalfVertex(e,d,p,M,!0,-T,A,he)}}this.lineSoFar=i.w,this.scaledDistance=k;const B=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,a,o,M,!1,x,A,B),this.addHalfVertex(i,d,p,M,!0,-T,A,B)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):ur(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,a,o,d,p,x=!1){const T=i.x+i.y*a,A=i.y-i.x*a,M=i.y*o-i.x,z=-i.y-i.x*o;if(p!=null){const D=this.elevationType==="offset",k=-10,B=Vt+10,W=p.zOffset,Y=new ri(e.x,e.y,W,this.lineSoFar),K=!!D&&px(e,k,B),ne=this.lineSoFar,se=this.distance;if(this.currentVertex)if(K){const he=this.currentVertexIsOutside,Re=this.currentVertex,Me=new ri(e.x,e.y,W,this.lineSoFar);if(Qr(Re,Me,k,B),!px(Me,k,B)){if(he){this.e1=this.e2=-1,this.distance-=Re.dist(Y),this.lineSoFar=Re.w;const Ne=this.evaluateLineProgressFeatures(Re.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Re,T,A,x,!1,a,d,Ne),this.addHalfVertex(Re,M,z,x,!0,-o,d,Ne),this.prevDistance=this.distance}this.distance=this.prevDistance+Re.dist(Me),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Re,Me,T,A,M,z,a,o,d,x),this.distance=se,this.scaledDistance=this.distance/this.totalDistance}}else{const he=this.currentVertex;if(this.currentVertexIsOutside){Qr(he,Y,k,B),this.e1=this.e2=-1,this.distance-=he.dist(Y),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=he.w;const Re=this.evaluateLineProgressFeatures(he.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(he,T,A,x,!1,a,d,Re),this.addHalfVertex(he,M,z,x,!0,-o,d,Re),this.prevDistance=this.distance,this.distance=se,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(he,Y,T,A,M,z,a,o,d,x)}else K||(this.addHalfVertex(e,T,A,x,!1,a,d,p),this.addHalfVertex(e,M,z,x,!0,-o,d,p));this.currentVertex=Y,this.currentVertexIsOutside=K,this.lineSoFar=ne}else this.addHalfVertex(e,T,A,x,!1,a,d,p),this.addHalfVertex(e,M,z,x,!0,-o,d,p)}addHalfVertex({x:e,y:i},a,o,d,p,x,T,A){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(i<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*o)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const z=Li(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,z)}const M=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),T.primitiveLength++),p?this.e2=M:this.e1=M,A!=null&&this.zOffsetVertexArray.emplaceBack(A.zOffset,A.variableWidth,A.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function px(r,e,i){return r.x<e||r.x>i||r.y<e||r.y>i}let Nb,kb;function Bb(r,e,i){return e*(Vt/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}si(fx,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Fb=(r,e,i)=>(1-i)*r+i*e;function Ub(r,e){return 1/Bb(r,1,e.tileZoom)}function Vb(r,e,i,a){return r.translatePosMatrix(a||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Hb=r=>{const e=[];qb(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=r.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const a=r.layout.get("line-join").constantOr("miter")==="none",o=!!r.paint.get("line-pattern").constantOr(1);return a&&o&&e.push("LINE_JOIN_NONE"),e};function qb(r){const e=r.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let mx;const Gb=()=>mx||(mx={layout:Nb||(Nb=new On({"line-cap":new Yt(qe.layout_line["line-cap"]),"line-join":new Yt(qe.layout_line["line-join"]),"line-miter-limit":new Nt(qe.layout_line["line-miter-limit"]),"line-round-limit":new Nt(qe.layout_line["line-round-limit"]),"line-sort-key":new Yt(qe.layout_line["line-sort-key"]),"line-z-offset":new Yt(qe.layout_line["line-z-offset"]),"line-elevation-reference":new Nt(qe.layout_line["line-elevation-reference"]),"line-cross-slope":new Nt(qe.layout_line["line-cross-slope"]),visibility:new Nt(qe.layout_line.visibility),"line-width-unit":new Nt(qe.layout_line["line-width-unit"])})),paint:kb||(kb=new On({"line-opacity":new Yt(qe.paint_line["line-opacity"]),"line-color":new Yt(qe.paint_line["line-color"]),"line-translate":new Nt(qe.paint_line["line-translate"]),"line-translate-anchor":new Nt(qe.paint_line["line-translate-anchor"]),"line-width":new Yt(qe.paint_line["line-width"]),"line-gap-width":new Yt(qe.paint_line["line-gap-width"]),"line-offset":new Yt(qe.paint_line["line-offset"]),"line-blur":new Yt(qe.paint_line["line-blur"]),"line-dasharray":new Yt(qe.paint_line["line-dasharray"]),"line-pattern":new Yt(qe.paint_line["line-pattern"]),"line-pattern-cross-fade":new Nt(qe.paint_line["line-pattern-cross-fade"]),"line-gradient":new Dh(qe.paint_line["line-gradient"]),"line-trim-offset":new Nt(qe.paint_line["line-trim-offset"]),"line-trim-fade-range":new Nt(qe.paint_line["line-trim-fade-range"]),"line-trim-color":new Nt(qe.paint_line["line-trim-color"]),"line-emissive-strength":new Nt(qe.paint_line["line-emissive-strength"]),"line-border-width":new Yt(qe.paint_line["line-border-width"]),"line-border-color":new Yt(qe.paint_line["line-border-color"]),"line-occlusion-opacity":new Nt(qe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},mx);class aE extends Yt{possiblyEvaluate(e,i){return i=new on(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,a,o){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,a,o)}}let C_;function $b(r,e){return e>0?e+2*r:r}const oE=xr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),lE=xr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),cE=xr([{name:"a_projected_pos",components:4,type:"Float32"}],4);xr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const uE=xr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),hE=xr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),dE=xr([{name:"a_texb",components:2,type:"Uint16"}]),fE=xr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),pE=xr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);xr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Zb=xr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),mE=xr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);xr([{name:"triangle",components:3,type:"Uint16"}]),xr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),xr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),xr([{type:"Float32",name:"offsetX"}]),xr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var aa=24;function gE(r,e,i){return r.sections.forEach(a=>{a.text=function(o,d,p){const x=d.layout.get("text-transform").evaluate(p,{});return x==="uppercase"?o=o.toLocaleUpperCase():x==="lowercase"&&(o=o.toLocaleLowerCase()),Zo.applyArabicShaping&&(o=Zo.applyArabicShaping(o)),o}(a.text,e,i)}),r}const R_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function _E(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}function yE(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}const gx=4294967296,Wb=1/gx,Xb=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let ey=class{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,e,i=this.length){for(;this.pos<i;){const a=this.readVarint(),o=a>>3,d=this.pos;this.type=7&a,r(o,e,this),this.pos===d&&this.skip(a)}return e}readMessage(r,e){return this.readFields(r,e,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*gx;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*gx;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const e=this.buf;let i,a;return a=e[this.pos++],i=127&a,a<128?i:(a=e[this.pos++],i|=(127&a)<<7,a<128?i:(a=e[this.pos++],i|=(127&a)<<14,a<128?i:(a=e[this.pos++],i|=(127&a)<<21,a<128?i:(a=e[this.pos],i|=(15&a)<<28,function(o,d,p){const x=p.buf;let T,A;if(A=x[p.pos++],T=(112&A)>>4,A<128||(A=x[p.pos++],T|=(127&A)<<3,A<128)||(A=x[p.pos++],T|=(127&A)<<10,A<128)||(A=x[p.pos++],T|=(127&A)<<17,A<128)||(A=x[p.pos++],T|=(127&A)<<24,A<128)||(A=x[p.pos++],T|=(1&A)<<31,A<128))return Tg(o,T,d);throw new Error("Expected varint not more than 10 bytes")}(i,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&Xb?Xb.decode(this.buf.subarray(e,r)):function(i,a,o){let d="",p=a;for(;p<o;){const x=i[p];let T,A,M,z=null,D=x>239?4:x>223?3:x>191?2:1;if(p+D>o)break;D===1?x<128&&(z=x):D===2?(T=i[p+1],(192&T)==128&&(z=(31&x)<<6|63&T,z<=127&&(z=null))):D===3?(T=i[p+1],A=i[p+2],(192&T)==128&&(192&A)==128&&(z=(15&x)<<12|(63&T)<<6|63&A,(z<=2047||z>=55296&&z<=57343)&&(z=null))):D===4&&(T=i[p+1],A=i[p+2],M=i[p+3],(192&T)==128&&(192&A)==128&&(192&M)==128&&(z=(15&x)<<18|(63&T)<<12|(63&A)<<6|63&M,(z<=65535||z>=1114112)&&(z=null))),z===null?(z=65533,D=1):z>65535&&(z-=65536,d+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),d+=String.fromCharCode(z),p+=D}return d}(this.buf,e,r)}readBytes(){const r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e}readPackedVarint(r=[],e){const i=this.readPackedEnd();for(;this.pos<i;)r.push(this.readVarint(e));return r}readPackedSVarint(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){const e=7&r;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(r,e){this.writeVarint(r<<3|e)}realloc(r){let e=this.length||16;for(;e<this.pos+r;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*Wb),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*Wb),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?function(e,i){let a,o;if(e>=0?(a=e%4294967296|0,o=e/4294967296|0):(a=~(-e%4294967296),o=~(-e/4294967296),4294967295^a?a=a+1|0:(a=0,o=o+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(d,p,x){x.buf[x.pos++]=127&d|128,d>>>=7,x.buf[x.pos++]=127&d|128,d>>>=7,x.buf[x.pos++]=127&d|128,d>>>=7,x.buf[x.pos++]=127&d|128,x.buf[x.pos]=127&(d>>>=7)}(a,0,i),function(d,p){const x=(7&d)<<4;p.buf[p.pos++]|=x|((d>>>=3)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d)))))}(o,i)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const e=this.pos;this.pos=function(a,o,d){for(let p,x,T=0;T<o.length;T++){if(p=o.charCodeAt(T),p>55295&&p<57344){if(!x){p>56319||T+1===o.length?(a[d++]=239,a[d++]=191,a[d++]=189):x=p;continue}if(p<56320){a[d++]=239,a[d++]=191,a[d++]=189,x=p;continue}p=x-55296<<10|p-56320|65536,x=null}else x&&(a[d++]=239,a[d++]=191,a[d++]=189,x=null);p<128?a[d++]=p:(p<2048?a[d++]=p>>6|192:(p<65536?a[d++]=p>>12|224:(a[d++]=p>>18|240,a[d++]=p>>12&63|128),a[d++]=p>>6&63|128),a[d++]=63&p|128)}return d}(this.buf,r,this.pos);const i=this.pos-e;i>=128&&Yb(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const e=r.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=r[i]}writeRawMessage(r,e){this.pos++;const i=this.pos;r(e,this);const a=this.pos-i;a>=128&&Yb(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a}writeMessage(r,e,i){this.writeTag(r,2),this.writeRawMessage(e,i)}writePackedVarint(r,e){e.length&&this.writeMessage(r,xE,e)}writePackedSVarint(r,e){e.length&&this.writeMessage(r,vE,e)}writePackedBoolean(r,e){e.length&&this.writeMessage(r,TE,e)}writePackedFloat(r,e){e.length&&this.writeMessage(r,bE,e)}writePackedDouble(r,e){e.length&&this.writeMessage(r,wE,e)}writePackedFixed32(r,e){e.length&&this.writeMessage(r,SE,e)}writePackedSFixed32(r,e){e.length&&this.writeMessage(r,EE,e)}writePackedFixed64(r,e){e.length&&this.writeMessage(r,AE,e)}writePackedSFixed64(r,e){e.length&&this.writeMessage(r,CE,e)}writeBytesField(r,e){this.writeTag(r,2),this.writeBytes(e)}writeFixed32Field(r,e){this.writeTag(r,5),this.writeFixed32(e)}writeSFixed32Field(r,e){this.writeTag(r,5),this.writeSFixed32(e)}writeFixed64Field(r,e){this.writeTag(r,1),this.writeFixed64(e)}writeSFixed64Field(r,e){this.writeTag(r,1),this.writeSFixed64(e)}writeVarintField(r,e){this.writeTag(r,0),this.writeVarint(e)}writeSVarintField(r,e){this.writeTag(r,0),this.writeSVarint(e)}writeStringField(r,e){this.writeTag(r,2),this.writeString(e)}writeFloatField(r,e){this.writeTag(r,5),this.writeFloat(e)}writeDoubleField(r,e){this.writeTag(r,1),this.writeDouble(e)}writeBooleanField(r,e){this.writeVarintField(r,+e)}};function Tg(r,e,i){return i?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function Yb(r,e,i){const a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(a);for(let o=i.pos-1;o>=r;o--)i.buf[o+a]=i.buf[o]}function xE(r,e){for(let i=0;i<r.length;i++)e.writeVarint(r[i])}function vE(r,e){for(let i=0;i<r.length;i++)e.writeSVarint(r[i])}function bE(r,e){for(let i=0;i<r.length;i++)e.writeFloat(r[i])}function wE(r,e){for(let i=0;i<r.length;i++)e.writeDouble(r[i])}function TE(r,e){for(let i=0;i<r.length;i++)e.writeBoolean(r[i])}function SE(r,e){for(let i=0;i<r.length;i++)e.writeFixed32(r[i])}function EE(r,e){for(let i=0;i<r.length;i++)e.writeSFixed32(r[i])}function AE(r,e){for(let i=0;i<r.length;i++)e.writeFixed64(r[i])}function CE(r,e){for(let i=0;i<r.length;i++)e.writeSFixed64(r[i])}const _x=3;function RE(r,e,i){e.glyphs=[],r===1&&i.readMessage(ME,e)}function ME(r,e,i){if(r===3){const{id:a,bitmap:o,width:d,height:p,left:x,top:T,advance:A}=i.readMessage(IE,{});e.glyphs.push({id:a,bitmap:new Es({width:d+2*_x,height:p+2*_x},o),metrics:{width:d,height:p,left:x,top:T,advance:A}})}else r===4?e.ascender=i.readSVarint():r===5&&(e.descender=i.readSVarint())}function IE(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}const zE=_x,ol={horizontal:1,vertical:2,horizontalOnly:3};class M_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const a=new M_;return a.scale=e||1,a.fontStack=i,a}static forImage(e){const i=new M_;return i.image=e,i}}class Sg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,a){const o=new Sg;for(let d=0;d<e.sections.length;d++){const p=e.sections[d];p.image?o.addImageSection(p,a):o.addTextSection(p,i)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,a){let o="";for(let d=0;d<i.length;d++){const p=i.charCodeAt(d+1)||null,x=i.charCodeAt(d-1)||null;o+=!a&&(p&&Of(p)&&!R_[i[d+1]]||x&&Of(x)&&!R_[i[d-1]])||!R_[i[d]]?i[d]:R_[i[d]]}return o}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&ty[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&ty[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const a=new Sg;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(M_.forText(e.scale,e.fontStack||i));const a=this.sections.length-1;for(let o=0;o<e.text.length;++o)this.sectionIndex.push(a)}addImageSection(e,i){const a=e.image?e.image.getPrimary():null;if(!a)return void ur("Can't add FormattedSection with an empty image.");a.scaleSelf(i);const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push(M_.forImage(a)),this.sectionIndex.push(this.sections.length-1)):ur("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yx(r,e,i,a,o,d,p,x,T,A,M,z,D,k,B,W=1){const Y=Sg.fromFeature(r,o,W);z===ol.vertical&&Y.verticalizePunctuation(D);let K=[];const ne=function(Ne,Fe,Ue,ft,$e,yt){if(!Ne)return[];const It=[],bt=function(At,at,et,kt,Ot,bi){let oi=0;for(let fi=0;fi<At.length();fi++){const qt=At.getSection(fi);oi+=Kb(At.getCodePoint(fi),qt,kt,Ot,at,bi)}return oi/Math.max(1,Math.ceil(oi/et))}(Ne,Fe,Ue,ft,$e,yt),Et=Ne.text.indexOf("")>=0;let jt=0;for(let At=0;At<Ne.length();At++){const at=Ne.getSection(At),et=Ne.getCodePoint(At);if(ty[et]||(jt+=Kb(et,at,ft,$e,Fe,yt)),At<Ne.length()-1){const kt=!((ht=et)<11904||!(zi["Bopomofo Extended"](ht)||zi.Bopomofo(ht)||zi["CJK Compatibility Forms"](ht)||zi["CJK Compatibility Ideographs"](ht)||zi["CJK Compatibility"](ht)||zi["CJK Radicals Supplement"](ht)||zi["CJK Strokes"](ht)||zi["CJK Symbols and Punctuation"](ht)||zi["CJK Unified Ideographs Extension A"](ht)||zi["CJK Unified Ideographs"](ht)||zi["Enclosed CJK Letters and Months"](ht)||zi["Halfwidth and Fullwidth Forms"](ht)||zi.Hiragana(ht)||zi["Ideographic Description Characters"](ht)||zi["Kangxi Radicals"](ht)||zi["Katakana Phonetic Extensions"](ht)||zi.Katakana(ht)||zi["Vertical Forms"](ht)||zi["Yi Radicals"](ht)||zi["Yi Syllables"](ht)));(LE[et]||kt||at.image)&&It.push(Qb(At+1,jt,bt,It,DE(et,Ne.getCodePoint(At+1),kt&&Et),!1))}}var ht;return ew(Qb(Ne.length(),jt,bt,It,0,!0))}(Y,A,d,e,a,k),{processBidirectionalText:se,processStyledBidirectionalText:he}=Zo;if(se&&Y.sections.length===1){const Ne=se(Y.toString(),ne);for(const Fe of Ne){const Ue=new Sg;Ue.text=Fe,Ue.sections=Y.sections;for(let ft=0;ft<Fe.length;ft++)Ue.sectionIndex.push(0);K.push(Ue)}}else if(he){const Ne=he(Y.text,Y.sectionIndex,ne);for(const Fe of Ne){const Ue=new Sg;Ue.text=Fe[0],Ue.sectionIndex=Fe[1],Ue.sections=Y.sections,K.push(Ue)}}else K=function(Ne,Fe){const Ue=[],ft=Ne.text;let $e=0;for(const yt of Fe)Ue.push(Ne.substring($e,yt)),$e=yt;return $e<ft.length&&Ue.push(Ne.substring($e,ft.length)),Ue}(Y,ne);const Re=[],Me={positionedLines:Re,text:Y.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:z,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Ne,Fe,Ue,ft,$e,yt,It,bt,Et,jt,ht,At){let at=0,et=0,kt=0;const Ot=bt==="right"?1:bt==="left"?0:.5;let bi=!1;for(const Xt of $e){const mi=Xt.getSections();for(const Ni of mi){if(Ni.image)continue;const Qi=Fe[Ni.fontStack];if(Qi&&(bi=Qi.ascender!==void 0&&Qi.descender!==void 0,!bi))break}if(!bi)break}let oi=0;for(const Xt of $e){Xt.trim();const mi=Xt.getMaxScale(),Ni=(mi-1)*aa,Qi={positionedGlyphs:[],lineOffset:0};Ne.positionedLines[oi]=Qi;const dr=Qi.positionedGlyphs;let rr=0;if(!Xt.length()){et+=yt,++oi;continue}let hi=0,tr=0;for(let pe=0;pe<Xt.length();pe++){const ge=Xt.getSection(pe),st=Xt.getSectionIndex(pe),dt=Xt.getCodePoint(pe);let Wt=ge.scale,Zt=null,ui=null,Ei=null,fr=aa,gr=0,ar=Et;ar===ol.vertical&&((fi=dt)===12312||fi===12313||fi===12316||fi===12540||fi===12448)&&(ar=ol.horizontal);const en=!(ar===ol.horizontal||!ht&&!Pd(dt)||ht&&(ty[dt]||Gm(dt)));if(ge.image){const Dn=ft.get(ge.image.toString());if(!Dn)continue;Ei=ge.image,Ne.iconsInText=Ne.iconsInText||!0,ui=Dn.paddedRect;const sr=Dn.displaySize;Wt=Wt*aa/At,Zt={width:sr[0],height:sr[1],left:0,top:-3,advance:en?sr[1]:sr[0],localGlyph:!1},gr=bi?-Zt.height*Wt:mi*aa-17-sr[1]*Wt,fr=Zt.advance;const wn=(en?sr[0]:sr[1])*Wt-aa*mi;wn>0&&wn>rr&&(rr=wn)}else{const Dn=Ue[ge.fontStack];if(!Dn)continue;Dn[dt]&&(ui=Dn[dt]);const sr=Fe[ge.fontStack];if(!sr)continue;const wn=sr.glyphs[dt];if(!wn)continue;if(Zt=wn.metrics,fr=dt!==8203?aa:0,bi){const sn=sr.ascender!==void 0?Math.abs(sr.ascender):0,Gr=sr.descender!==void 0?Math.abs(sr.descender):0,An=(sn+Gr)*Wt;hi<An&&(hi=An,tr=(sn-Gr)/2*Wt),gr=-sn*Wt}else gr=(mi-Wt)*aa-17}en?(Ne.verticalizable=!0,dr.push({glyph:dt,image:Ei,x:at,y:et+gr,vertical:en,scale:Wt,localGlyph:Zt.localGlyph,fontStack:ge.fontStack,sectionIndex:st,metrics:Zt,rect:ui}),at+=fr*Wt+jt):(dr.push({glyph:dt,image:Ei,x:at,y:et+gr,vertical:en,scale:Wt,localGlyph:Zt.localGlyph,fontStack:ge.fontStack,sectionIndex:st,metrics:Zt,rect:ui}),at+=Zt.advance*Wt+jt)}dr.length!==0&&(kt=Math.max(at-jt,kt),bi?tw(dr,Ot,rr,tr,yt*mi/2):tw(dr,Ot,rr,0,yt/2)),at=0;const Dr=yt*mi+rr;Qi.lineOffset=Math.max(rr,Ni),et+=Dr,++oi}var fi;const qt=et,{horizontalAlign:vi,verticalAlign:Gi}=xx(It);(function(Xt,mi,Ni,Qi,dr,rr){const hi=(mi-Ni)*dr,tr=-rr*Qi;for(const Dr of Xt)for(const pe of Dr.positionedGlyphs)pe.x+=hi,pe.y+=tr})(Ne.positionedLines,Ot,vi,Gi,kt,qt),Ne.top+=-Gi*qt,Ne.bottom=Ne.top+qt,Ne.left+=-vi*kt,Ne.right=Ne.left+kt,Ne.hasBaseline=bi}(Me,e,i,a,K,p,x,T,z,A,D,B),!function(Ne){for(const Fe of Ne)if(Fe.positionedGlyphs.length!==0)return!1;return!0}(Re))return Me}const ty={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},LE={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Kb(r,e,i,a,o,d){if(e.image){const p=a.get(e.image.toString());return p?p.displaySize[0]*e.scale*aa/d+o:0}{const p=i[e.fontStack],x=p&&p.glyphs[r];return x?x.metrics.advance*e.scale+o:0}}function Jb(r,e,i,a){const o=Math.pow(r-e,2);return a?r<e?o/2:2*o:o+Math.abs(i)*i}function DE(r,e,i){let a=0;return r===10&&(a-=1e4),i&&(a+=150),r!==40&&r!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Qb(r,e,i,a,o,d){let p=null,x=Jb(e,i,o,d);for(const T of a){const A=Jb(e-T.x,i,o,d)+T.badness;A<=x&&(p=T,x=A)}return{index:r,x:e,priorBreak:p,badness:x}}function ew(r){return r?ew(r.priorBreak).concat(r.index):[]}function xx(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function tw(r,e,i,a,o){if(!(e||i||a||o))return;const d=r.length-1,p=r[d],x=(p.x+p.metrics.advance*p.scale)*e;for(let T=0;T<=d;T++)r[T].x-=x,r[T].y+=i+a+o}function iw(r){return r.imagePrimary!==void 0&&r.top!==void 0&&r.bottom!==void 0&&r.left!==void 0&&r.right!==void 0}function PE(r,e,i,a){const{horizontalAlign:o,verticalAlign:d}=xx(a),p=i[0]-r.displaySize[0]*o,x=i[1]-r.displaySize[1]*d;return{imagePrimary:r,imageSecondary:e,top:x,bottom:x+r.displaySize[1],left:p,right:p+r.displaySize[0]}}function rw(r,e,i,a,o,d){const p=r.imagePrimary;let x;if(p.content){const Y=p.content,K=p.pixelRatio||1;x=[Y[0]/K,Y[1]/K,p.displaySize[0]-Y[2]/K,p.displaySize[1]-Y[3]/K]}const T=e.left*d,A=e.right*d;let M,z,D,k;i==="width"||i==="both"?(k=o[0]+T-a[3],z=o[0]+A+a[1]):(k=o[0]+(T+A-p.displaySize[0])/2,z=k+p.displaySize[0]);const B=e.top*d,W=e.bottom*d;return i==="height"||i==="both"?(M=o[1]+B-a[0],D=o[1]+W+a[2]):(M=o[1]+(B+W-p.displaySize[1])/2,D=M+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:M,right:z,bottom:D,left:k,collisionPadding:x}}function nw(r){return!r.imagePrimary.stretchX}function sw(r){return!r.imagePrimary.stretchY}function aw(r){return{width:r.right-r.left,height:r.bottom-r.top}}const td=128;function ow(r,e,i){const{expression:a}=e;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new on(r+1,{worldview:i}))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:d}=a;let p=0;for(;p<o.length&&o[p]<=r;)p++;p=Math.max(0,p-1);let x=p;for(;x<o.length&&o[x]<r+1;)x++;x=Math.min(o.length-1,x);const T=o[p],A=o[x];return a.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:A,interpolationType:d}:{kind:"camera",minZoom:T,maxZoom:A,minSize:a.evaluate(new on(T,{worldview:i})),maxSize:a.evaluate(new on(A,{worldview:i})),interpolationType:d}}}function vx(r,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:o}){return r.kind==="source"?a/td:r.kind==="composite"?Li(a/td,o/td,i):e}function I_(r,e,i=1){let a=0,o=0;if(r.kind==="constant")o=r.layoutSize*i;else if(r.kind!=="source"){const{interpolationType:d,minZoom:p,maxZoom:x}=r,T=d?Ie(kn.interpolationFactor(d,e,p,x),0,1):0;r.kind==="camera"?o=Li(r.minSize,r.maxSize,T)*i:a=T*i}return{uSizeT:a,uSize:o}}class tf extends Ct{constructor(e,i,a,o,d){super(e,i),this.angle=o,this.z=a,d!==void 0&&(this.segment=d)}clone(){return new tf(this.x,this.y,this.z,this.angle,this.segment)}}function lw(r,e,i,a,o){if(e.segment===void 0)return!0;let d=e,p=e.segment+1,x=0;for(;x>-i/2;){if(p--,p<0)return!1;x-=r[p].dist(d),d=r[p]}x+=r[p].dist(r[p+1]),p++;const T=[];let A=0;for(;x<i/2;){const M=r[p],z=r[p+1];if(!z)return!1;let D=r[p-1].angleTo(M)-M.angleTo(z);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:x,angleDelta:D}),A+=D;x-T[0].distance>a;)A-=T.shift().angleDelta;if(A>o)return!1;p++,x+=M.dist(z)}return!0}function cw(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function uw(r,e,i){return r?.6*e*i:0}function hw(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function OE(r,e,i,a,o,d){const p=uw(i,o,d),x=hw(i,a)*d;let T=0;const A=cw(r)/2;for(let M=0;M<r.length-1;M++){const z=r[M],D=r[M+1],k=z.dist(D);if(T+k>A){const B=(A-T)/k,W=Li(z.x,D.x,B),Y=Li(z.y,D.y,B),K=new tf(W,Y,0,D.angleTo(z),M);return!p||lw(r,K,x,p,e)?K:void 0}T+=k}}function jE(r,e,i,a,o,d,p,x,T){const A=uw(a,d,p),M=hw(a,o),z=M*p,D=r[0].x===0||r[0].x===T||r[0].y===0||r[0].y===T;return e-z<e/4&&(e=z+e/4),dw(r,D?e/2*x%e:(M/2+2*d)*p*x%e,e,A,i,z,D,!1,T)}function dw(r,e,i,a,o,d,p,x,T){const A=d/2,M=cw(r);let z=0,D=e-i,k=[];for(let B=0;B<r.length-1;B++){const W=r[B],Y=r[B+1],K=W.dist(Y),ne=Y.angleTo(W);for(;D+i<z+K;){D+=i;const se=(D-z)/K,he=Li(W.x,Y.x,se),Re=Li(W.y,Y.y,se);if(he>=0&&he<T&&Re>=0&&Re<T&&D-A>=0&&D+A<=M){const Me=new tf(he,Re,0,ne,B);a&&!lw(r,Me,d,a,o)||k.push(Me)}}z+=K}return x||k.length||p||(k=dw(r,z/2,i,a,o,d,p,!0,T)),k}function fw(r){let e=0,i=0;for(const p of r)e+=p.w*p.h,i=Math.max(i,p.w);r.sort((p,x)=>x.h-p.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let o=0,d=0;for(const p of r)for(let x=a.length-1;x>=0;x--){const T=a[x];if(!(p.w>T.w||p.h>T.h)){if(p.x=T.x,p.y=T.y,d=Math.max(d,p.y+p.h),o=Math.max(o,p.x+p.w),p.w===T.w&&p.h===T.h){const A=a.pop();A&&x<a.length&&(a[x]=A)}else p.h===T.h?(T.x+=p.w,T.w-=p.w):p.w===T.w?(T.y+=p.h,T.h-=p.h):(a.push({x:T.x+p.w,y:T.y,w:T.w-p.w,h:p.h}),T.y+=p.h,T.h-=p.h);break}}return{w:o,h:d,fill:e/(o*d)||0}}si(tf,"Anchor");const xm=1;class z_{static getImagePositionScale(e,i,a){if(i&&e&&e.options&&e.options.transform){const o=e.options.transform;return{x:o.a,y:o.d}}return{x:a,y:a}}constructor(e,i,a,o){this.paddedRect=e;const{pixelRatio:d,version:p,stretchX:x,stretchY:T,content:A,sdf:M,usvg:z}=i;this.pixelRatio=d,this.stretchX=x,this.stretchY=T,this.content=A,this.version=p,this.padding=a,this.sdf=M,this.usvg=z,this.scale=z_.getImagePositionScale(o,z,d)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function bx(r,e,i){const a=wo.parse(r),o=function(d,p,x=[1,1]){return{x:0,y:0,w:(d.data?d.data.width:d.width*x[0])+2*p,h:(d.data?d.data.height:d.height*x[1])+2*p}}(e,i,[a.options.transform.a,a.options.transform.d]);return{bin:o,imagePosition:new z_(o,e,i,a),imageVariant:a}}class pw{constructor(e,i,a){const o=new Map,d=new Map;this.haveRenderCallbacks=[];const p=[];this.addImages(e,o,xm,p),this.addImages(i,d,2,p);const{w:x,h:T}=fw(p),A=new na({width:x||1,height:T||1});for(const[M,z]of e.entries()){const D=o.get(M).paddedRect;na.copy(z.data,A,{x:0,y:0},{x:D.x+xm,y:D.y+xm},z.data,null,z.sdf)}for(const[M,z]of i.entries()){const D=d.get(M),k=D.paddedRect;let B=D.padding;const W=k.x+B,Y=k.y+B,K=z.data.width,ne=z.data.height;B=B>1?B-1:B,na.copy(z.data,A,{x:0,y:0},{x:W,y:Y},z.data,a),na.copy(z.data,A,{x:0,y:ne-B},{x:W,y:Y-B},{width:K,height:B},a),na.copy(z.data,A,{x:0,y:0},{x:W,y:Y+ne},{width:K,height:B},a),na.copy(z.data,A,{x:K-B,y:0},{x:W-B,y:Y},{width:B,height:ne},a),na.copy(z.data,A,{x:0,y:0},{x:W+K,y:Y},{width:B,height:ne},a),na.copy(z.data,A,{x:K-B,y:ne-B},{x:W-B,y:Y-B},{width:B,height:B},a),na.copy(z.data,A,{x:0,y:ne-B},{x:W+K,y:Y-B},{width:B,height:B},a),na.copy(z.data,A,{x:0,y:0},{x:W+K,y:Y+ne},{width:B,height:B},a),na.copy(z.data,A,{x:K-B,y:0},{x:W-B,y:Y+ne},{width:B,height:B},a)}this.lut=a,this.image=A,this.iconPositions=o,this.patternPositions=d}addImages(e,i,a,o){for(const[d,p]of e.entries()){const{bin:x,imagePosition:T,imageVariant:A}=bx(d,p,a);i.set(d,T),o.push(x),p.hasRenderCallback&&this.haveRenderCallbacks.push(A.id)}}patchUpdatedImages(e,i,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(o=>e.hasImage(o,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const o of e.getUpdatedImages(a)){for(const d of this.iconPositions.keys()){const p=wo.parse(d);if(ao.isEqual(p.id,o)){const x=e.getImage(o,a);this.patchUpdatedImage(this.iconPositions.get(d),x,i,null)}}for(const d of this.patternPositions.keys()){const p=wo.parse(d);if(ao.isEqual(p.id,o)){const x=e.getImage(o,a);this.patchUpdatedImage(this.patternPositions.get(d),x,i,this.lut)}}}}patchUpdatedImage(e,i,a,o=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[d,p]=e.tl,x=e.sdf;if(this.lut||x){const T={width:i.data.width,height:i.data.height},A=new na(T);na.copy(i.data,A,{x:0,y:0},{x:0,y:0},T,o,x),a.update(A,{position:{x:d,y:p}})}else a.update(i.data,{position:{x:d,y:p}})}}si(z_,"ImagePosition"),si(pw,"ImageAtlas");const iy=1e20;function mw(r,e,i,a,o,d,p,x,T){for(let A=e;A<e+a;A++)gw(r,i*d+A,d,o,p,x,T);for(let A=i;A<i+o;A++)gw(r,A*d+e,1,a,p,x,T)}function gw(r,e,i,a,o,d,p){d[0]=0,p[0]=-1e20,p[1]=iy,o[0]=r[e];for(let x=1,T=0,A=0;x<a;x++){o[x]=r[e+x*i];const M=x*x;do{const z=d[T];A=(o[x]-o[z]+M-z*z)/(x-z)/2}while(A<=p[T]&&--T>-1);T++,d[T]=x,p[T]=A,p[T+1]=iy}for(let x=0,T=0;x<a;x++){for(;p[T+1]<x;)T++;const A=d[T],M=x-A;r[e+x*i]=o[A]+M*M}}const Ju=2,wx={none:0,ideographs:1,all:2};class Eg{constructor(e,i,a){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=a,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const a=[],o=this.url||Yn.GLYPHS_URL;for(const d in e)for(const p of e[d])a.push({stack:d,id:p});Je(a,({stack:d,id:p},x)=>{let T=this.entries[d];T||(T=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=T.glyphs[p];if(A!==void 0)return void x(null,{stack:d,id:p,glyph:A});if(A=this._tinySDF(T,d,p),A)return T.glyphs[p]=A,void x(null,{stack:d,id:p,glyph:A});const M=Math.floor(p/256);if(256*M>65535)return ur("glyphs > 65535 not supported"),void x(null,{stack:d,id:p,glyph:A});if(T.ranges[M])return void x(null,{stack:d,id:p,glyph:A});let z=T.requests[M];z||(z=T.requests[M]=[],Eg.loadGlyphRange(d,M,o,this.requestManager,(D,k)=>{if(k){T.ascender=k.ascender,T.descender=k.descender;for(const B in k.glyphs)this._doesCharSupportLocalGlyph(+B)||(T.glyphs[+B]=k.glyphs[+B]);T.ranges[M]=!0}for(const B of z)B(D,k);delete T.requests[M]})),z.push((D,k)=>{D?x(D):k&&x(null,{stack:d,id:p,glyph:k.glyphs[p]||null})})},(d,p)=>{if(d)i(d);else if(p){const x={};for(const{stack:T,id:A,glyph:M}of p)x[T]===void 0&&(x[T]={}),x[T].glyphs===void 0&&(x[T].glyphs={}),x[T].glyphs[A]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},x[T].ascender=this.entries[T].ascender,x[T].descender=this.entries[T].descender;i(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==wx.none&&(this.localGlyphMode===wx.all?!!this.localFontFamily:!!this.localFontFamily&&(zi["CJK Unified Ideographs"](e)||zi["Hangul Syllables"](e)||zi.Hiragana(e)||zi.Katakana(e)||zi["CJK Symbols and Punctuation"](e)||zi["CJK Unified Ideographs Extension A"](e)||zi["CJK Unified Ideographs Extension B"](e)||zi.Osage(e)))}_tinySDF(e,i,a){const o=this.localFontFamily;if(!o||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let W="400";/bold/i.test(i)?W="900":/medium/i.test(i)?W="500":/light/i.test(i)&&(W="200"),d=e.tinySDF=new Eg.TinySDF({fontFamily:o,fontWeight:W,fontSize:24*Ju,buffer:3*Ju,radius:8*Ju}),d.fontWeight=W}if(this.localGlyphs[d.fontWeight][a])return this.localGlyphs[d.fontWeight][a];const p=String.fromCodePoint(a),{data:x,width:T,height:A,glyphWidth:M,glyphHeight:z,glyphLeft:D,glyphTop:k,glyphAdvance:B}=d.draw(p);return this.localGlyphs[d.fontWeight][a]={id:a,bitmap:new Es({width:T,height:A},x),metrics:{width:M/Ju,height:z/Ju,left:D/Ju,top:k/Ju-27,advance:B/Ju,localGlyph:!0}}}}Eg.loadGlyphRange=function(r,e,i,a,o){const d=256*e,p=d+255,x=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${d}-${p}`),uh.Glyphs);ul(x,(T,A)=>{if(T)o(T);else if(A){const M={},z=function(D){return new ey(D).readFields(RE,{})}(A);for(const D of z.glyphs)M[D.id]=D;o(null,{glyphs:M,ascender:z.ascender,descender:z.descender})}})},Eg.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:o="sans-serif",fontWeight:d="normal",fontStyle:p="normal",lang:x=null}={}){this.buffer=e,this.cutoff=a,this.radius=i,this.lang=x;const T=this.size=r+4*e,A=this._createCanvas(T),M=this.ctx=A.getContext("2d",{willReadFrequently:!0});M.font=`${p} ${d} ${r}px ${o}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:o,actualBoundingBoxRight:d}=this.ctx.measureText(r),p=Math.ceil(i),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-o))),T=Math.min(this.size-this.buffer,p+Math.ceil(a)),A=x+2*this.buffer,M=T+2*this.buffer,z=Math.max(A*M,0),D=new Uint8ClampedArray(z),k={data:D,width:A,height:M,glyphWidth:x,glyphHeight:T,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(x===0||T===0)return k;const{ctx:B,buffer:W,gridInner:Y,gridOuter:K}=this;this.lang&&(B.lang=this.lang),B.clearRect(W,W,x,T),B.fillText(r,W,W+p);const ne=B.getImageData(W,W,x,T);K.fill(iy,0,z),Y.fill(0,0,z);for(let se=0;se<T;se++)for(let he=0;he<x;he++){const Re=ne.data[4*(se*x+he)+3]/255;if(Re===0)continue;const Me=(se+W)*A+he+W;if(Re===1)K[Me]=0,Y[Me]=iy;else{const Ne=.5-Re;K[Me]=Ne>0?Ne*Ne:0,Y[Me]=Ne<0?Ne*Ne:0}}mw(K,0,0,A,M,A,this.f,this.v,this.z),mw(Y,W,W,x,T,A,this.f,this.v,this.z);for(let se=0;se<z;se++){const he=Math.sqrt(K[se])-Math.sqrt(Y[se]);D[se]=Math.round(255-255*(he/this.radius+this.cutoff))}return k}};const vm=xm;function _w(r,e){return r+e[1]-e[0]}function yw(r,e,i,a,o=1){const d=[],p=r.imagePrimary,x=p.pixelRatio,T=p.paddedRect.w-2*vm,A=p.paddedRect.h-2*vm,M=(r.right-r.left)*o,z=(r.bottom-r.top)*o,D=p.stretchX||[[0,T]],k=p.stretchY||[[0,A]],B=D.reduce(_w,0),W=k.reduce(_w,0),Y=T-B,K=A-W;let ne=0,se=B,he=0,Re=W,Me=0,Ne=Y,Fe=0,Ue=K;if(p.content&&a){const $e=p.content;ne=ry(D,0,$e[0]),he=ry(k,0,$e[1]),se=ry(D,$e[0],$e[2]),Re=ry(k,$e[1],$e[3]),Me=$e[0]-ne,Fe=$e[1]-he,Ne=$e[2]-$e[0]-se,Ue=$e[3]-$e[1]-Re}const ft=($e,yt,It,bt)=>{const Et=ny($e.stretch-ne,se,M,r.left*o),jt=sy($e.fixed-Me,Ne,$e.stretch,B),ht=ny(yt.stretch-he,Re,z,r.top*o),At=sy(yt.fixed-Fe,Ue,yt.stretch,W),at=ny(It.stretch-ne,se,M,r.left*o),et=sy(It.fixed-Me,Ne,It.stretch,B),kt=ny(bt.stretch-he,Re,z,r.top*o),Ot=sy(bt.fixed-Fe,Ue,bt.stretch,W),bi=new Ct(Et,ht),oi=new Ct(at,ht),fi=new Ct(at,kt),qt=new Ct(Et,kt),vi=new Ct(jt/x,At/x),Gi=new Ct(et/x,Ot/x),Xt=e*Math.PI/180;if(Xt){const hi=Math.sin(Xt),tr=Math.cos(Xt),Dr=[tr,-hi,hi,tr];bi._matMult(Dr),oi._matMult(Dr),qt._matMult(Dr),fi._matMult(Dr)}const mi=$e.stretch+$e.fixed,Ni=It.stretch+It.fixed,Qi=yt.stretch+yt.fixed,dr=bt.stretch+bt.fixed,rr=r.imageSecondary;return{tl:bi,tr:oi,bl:qt,br:fi,texPrimary:{x:p.paddedRect.x+vm+mi,y:p.paddedRect.y+vm+Qi,w:Ni-mi,h:dr-Qi},texSecondary:rr?{x:rr.paddedRect.x+vm+mi,y:rr.paddedRect.y+vm+Qi,w:Ni-mi,h:dr-Qi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:vi,pixelOffsetBR:Gi,minFontScaleX:Ne/x/M,minFontScaleY:Ue/x/z,isSDF:i}};if(a&&(p.stretchX||p.stretchY)){const $e=xw(D,Y,B),yt=xw(k,K,W);for(let It=0;It<$e.length-1;It++){const bt=$e[It],Et=$e[It+1];for(let jt=0;jt<yt.length-1;jt++)d.push(ft(bt,yt[jt],Et,yt[jt+1]))}}else d.push(ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:A+1}));return d}function ry(r,e,i){let a=0;for(const o of r)a+=Math.max(e,Math.min(i,o[1]))-Math.max(e,Math.min(i,o[0]));return a}function xw(r,e,i){const a=[{fixed:-1,stretch:0}];for(const[o,d]of r){const p=a[a.length-1];a.push({fixed:o-p.stretch,stretch:p.stretch}),a.push({fixed:o-p.stretch,stretch:p.stretch+(d-o)})}return a.push({fixed:e+vm,stretch:i}),a}function ny(r,e,i,a){return r/e*i+a}function sy(r,e,i,a){return r-e*i/a}function NE(r,e,i,a){const o=e+r.positionedLines[a].lineOffset;return a===0?i+o/2:i+(o+(e+r.positionedLines[a-1].lineOffset))/2}function kE(r,e=1,i=!1){let a=1/0,o=1/0,d=-1/0,p=-1/0;const x=r[0];for(let k=0;k<x.length;k++){const B=x[k];(!k||B.x<a)&&(a=B.x),(!k||B.y<o)&&(o=B.y),(!k||B.x>d)&&(d=B.x),(!k||B.y>p)&&(p=B.y)}const T=Math.min(d-a,p-o);let A=T/2;const M=new _h([],BE);if(T===0)return new Ct(a,o);for(let k=a;k<d;k+=T)for(let B=o;B<p;B+=T)M.push(new Ag(k+A,B+A,A,r));let z=function(k){let B=0,W=0,Y=0;const K=k[0];for(let ne=0,se=K.length,he=se-1;ne<se;he=ne++){const Re=K[ne],Me=K[he],Ne=Re.x*Me.y-Me.x*Re.y;W+=(Re.x+Me.x)*Ne,Y+=(Re.y+Me.y)*Ne,B+=3*Ne}return new Ag(W/B,Y/B,0,k)}(r),D=M.length;for(;M.length;){const k=M.pop();(k.d>z.d||!z.d)&&(z=k,i&&console.log("found best %d after %d probes",Math.round(1e4*k.d)/1e4,D)),k.max-z.d<=e||(A=k.h/2,M.push(new Ag(k.p.x-A,k.p.y-A,A,r)),M.push(new Ag(k.p.x+A,k.p.y-A,A,r)),M.push(new Ag(k.p.x-A,k.p.y+A,A,r)),M.push(new Ag(k.p.x+A,k.p.y+A,A,r)),D+=4)}return i&&(console.log(`num probes: ${D}`),console.log(`best distance: ${z.d}`)),z.p}function BE(r,e){return e.max-r.max}class Ag{constructor(e,i,a,o){this.p=new Ct(e,i),this.h=a,this.d=function(d,p){let x=!1,T=1/0;for(let A=0;A<p.length;A++){const M=p[A];for(let z=0,D=M.length,k=D-1;z<D;k=z++){const B=M[z],W=M[k];B.y>d.y!=W.y>d.y&&d.x<(W.x-B.x)*(d.y-B.y)/(W.y-B.y)+B.x&&(x=!x),T=Math.min(T,vn(d,B,W))}}return(x?1:-1)*Math.sqrt(T)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}}const FE=Object.keys,Tx=Number.POSITIVE_INFINITY,UE=Math.sqrt(2);function vw(r,[e,i]){let a=0,o=0;if(i===Tx){e<0&&(e=0);const d=e/UE;switch(r){case"top-right":case"top-left":o=d-7;break;case"bottom-right":case"bottom-left":o=7-d;break;case"bottom":o=7-e;break;case"top":o=e-7}switch(r){case"top-right":case"bottom-right":a=-d;break;case"top-left":case"bottom-left":a=d;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),r){case"top-right":case"top-left":case"top":o=i-7;break;case"bottom-right":case"bottom-left":case"bottom":o=7-i}switch(r){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,o]}function ay(r,e,i,a,o,d,p,x,T){if(!e||!e.usvg)return;const A=aw(a),M=aw(o),z=d!=="both"&&d!=="width"||!nw(a)?1:M.width/A.width,D=d!=="both"&&d!=="height"||!sw(a)?1:M.height/A.height;i.scaleSelf(z,D);const k=i.toString();p.set(k,i),x.set(k,e);const{imagePosition:B}=bx(k,e,xm);T.set(k,B)}function bw(r,e,i,a,o,d,p,x,T){if(!r)return;const A=function(M,z,D,k,B,W){if(M.kind==="camera")return M.maxSize;if(M.kind==="composite"){const Y=z.possiblyEvaluate(new on(M.maxZoom,{worldview:W}),D).evaluate(B,{},D),K=z.possiblyEvaluate(new on(M.minZoom,{worldview:W}),D).evaluate(B,{},D);return Math.max(Y,K)}return z.possiblyEvaluate(new on(k,{worldview:W})).evaluate(B,{},D)}(e,i,a,o,d,T);return r.scaleSelf(A*x*p)}function ww(r,e,i,a,o,d,p,x,T){return{iconPrimary:bw(r.getPrimary(),e,i,a,o,d,p,x,T),iconSecondary:bw(r.getSecondary(),e,i,a,o,d,p,x,T)}}function VE(r,e,i){if(!e)return;const a=i.get(r.toString()),o=i.get(e.toString());a&&o&&(a.paddedRect.w===o.paddedRect.w&&a.paddedRect.h===o.paddedRect.h||ur(`Mismatch in icon variant sizes: ${r.toString()} and ${e.toString()}`),a.usvg!==o.usvg&&ur(`Mismatch in icon variant image types: ${r.id} and ${e.id}`))}function Tw(r,e,i,a){if(!r)return;const o=e.get(i.toString());if(r.imagePrimary=o,a){const d=e.get(a.toString());r.imageSecondary=d}}function HE(r,e){for(const i in r.horizontal)Sw(r.horizontal[i],e);Sw(r.vertical,e)}function Sw(r,e){if(r){for(const i of r.positionedLines)for(const a of i.positionedGlyphs)if(a.image!==null){const o=a.image.toString();a.rect=e.get(o).paddedRect}}}function Sx(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qE(r,e,i,a,o,d,p,x,T){const A=Ex(d.horizontal)||d.vertical,M=i.get("icon-text-fit-padding").evaluate(a,{},o);let z,D=e;return e&&T!=="none"&&(r.allowVerticalPlacement&&d.vertical&&(z=rw(e,d.vertical,T,M,x,p)),A&&(D=rw(e,A,T,M,x,p))),{defaultShapedIcon:D,verticallyShapedIcon:z}}function GE(r,e,i,a,o,d,p,x,T,A,M,z,D,k,B,W,Y,K,ne,se){let he=p.textMaxSize.evaluate(e,{},D);he===void 0?he=x*p.textScaleFactor:he*=p.textScaleFactor;const Re=r.layers[0].layout,Me=Ex(i.horizontal)||i.vertical,Ne=k.name==="globe",Fe=aa,Ue=r.tilePixelRatio*he/Fe,ft=(jt=r.overscaling,r.zoom>18&&jt>2&&(jt>>=1),Math.max(Vt/(512*jt),1)*Re.get("symbol-spacing")),$e=Re.get("text-padding")*r.tilePixelRatio,yt=Re.get("icon-padding")*r.tilePixelRatio,It=He(Re.get("text-max-angle")),bt=Re.get("icon-rotation-alignment")==="map"&&se!=="point",Et=ft/2;var jt;r.hasAnyIconTextFit===!1&&Y!=="none"&&(r.hasAnyIconTextFit=!0);const ht=e.properties?+e.properties[Hi]:null,At=ht&&r.elevationFeatureIdToIndex?r.elevationFeatureIdToIndex.get(ht):65535,at=(et,kt,Ot)=>{if(kt.x<0||kt.x>=Vt||kt.y<0||kt.y>=Vt)return;let bi=null;if(Ne){const{x:oi,y:fi,z:qt}=k.projectTilePoint(kt.x,kt.y,Ot);bi={anchor:new tf(oi,fi,qt,0,void 0),up:k.upVector(Ot,kt.x,kt.y)}}(function(oi,fi,qt,vi,Gi,Xt,mi,Ni,Qi,dr,rr,hi,tr,Dr,pe,ge,st,dt,Wt,Zt,ui,Ei,fr,gr,ar,en,Dn,sr,wn){const sn=oi.addToLineVertexArray(fi,vi);let Gr,An,Cn,_n,Tn,an,_r,ln=0,Fn=0,Bi=0,kr=0,Rn=-1,Zn=-1;const Mn={};let As=dh("");const un=qt?qt.anchor:fi,ys=sr!=="none";let Po=0,Ra=0;if(Qi._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Cs=Qi.layout.get("text-offset").evaluate(ui,{},ar);Po=Cs[0]*aa,Ra=Cs[1]*aa}else Po=Qi.layout.get("text-radial-offset").evaluate(ui,{},ar)*aa,Ra=Tx;if(oi.allowVerticalPlacement&&Gi.vertical){const Cs=Gi.vertical;if(pe)an=Ax(Cs),Ni&&(_r=Ax(Ni));else{const Bs=Qi.layout.get("text-rotate").evaluate(ui,{},ar)+90;Cn=oy(dr,un,fi,rr,hi,tr,Cs,Dr,Bs,ge),Ni&&(_n=oy(dr,un,fi,rr,hi,tr,Ni,dt,Bs))}}if(Xt){const Cs=oi.iconSizeData,Bs=Qi.layout.get("icon-rotate").evaluate(ui,{},ar),Ma=yw(Xt,Bs,fr,ys,Ei.iconScaleFactor),eo=Ni?yw(Ni,Bs,fr,ys,Ei.iconScaleFactor):void 0;An=oy(dr,un,fi,rr,hi,tr,Xt,dt,Bs,null),ln=4*Ma.length;let qa=null;Cs.kind==="source"?(qa=[td*Qi.layout.get("icon-size").evaluate(ui,{},ar)*Ei.iconScaleFactor],qa[0]>up&&ur(`${oi.layerIds[0]}: Value for "icon-size" is >= ${L_}. Reduce your "icon-size".`)):Cs.kind==="composite"&&(qa=[td*Ei.compositeIconSizes[0].evaluate(ui,{},ar)*Ei.iconScaleFactor,td*Ei.compositeIconSizes[1].evaluate(ui,{},ar)*Ei.iconScaleFactor],(qa[0]>up||qa[1]>up)&&ur(`${oi.layerIds[0]}: Value for "icon-size" is >= ${L_}. Reduce your "icon-size".`)),oi.addSymbols(oi.icon,Ma,qa,Zt,Wt,ui,void 0,qt,fi,sn.lineStartIndex,sn.lineLength,-1,gr,ar,en,Dn),Rn=oi.icon.placedSymbolArray.length-1,eo&&(Fn=4*eo.length,oi.addSymbols(oi.icon,eo,qa,Zt,Wt,ui,ol.vertical,qt,fi,sn.lineStartIndex,sn.lineLength,-1,gr,ar,en,Dn),Zn=oi.icon.placedSymbolArray.length-1)}for(const Cs in Gi.horizontal){const Bs=Cs,Ma=Gi.horizontal[Bs];Gr||(As=dh(Ma.text),pe?Tn=Ax(Ma):Gr=oy(dr,un,fi,rr,hi,tr,Ma,Dr,Qi.layout.get("text-rotate").evaluate(ui,{},ar),ge));const eo=Ma.positionedLines.length===1;if(Bi+=Ew(oi,qt,fi,Ma,mi,Qi,pe,ui,ge,sn,Gi.vertical?ol.horizontal:ol.horizontalOnly,eo?FE(Gi.horizontal):[Bs],Mn,Rn,Ei,gr,ar,en),eo)break}Gi.vertical&&(kr+=Ew(oi,qt,fi,Gi.vertical,mi,Qi,pe,ui,ge,sn,ol.vertical,["vertical"],Mn,Zn,Ei,gr,ar,en));let xa=-1;const Oo=(Cs,Bs)=>Cs?Math.max(Cs,Bs):Bs;xa=Oo(Tn,xa),xa=Oo(an,xa),xa=Oo(_r,xa);const id=xa>-1?1:0;oi.glyphOffsetArray.length>=65535&&ur("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ui.sortKey!==void 0&&oi.addToSortKeyRanges(oi.symbolInstances.length,ui.sortKey),oi.symbolInstances.emplaceBack(fi.x,fi.y,un.x,un.y,un.z,Mn.right>=0?Mn.right:-1,Mn.center>=0?Mn.center:-1,Mn.left>=0?Mn.left:-1,Mn.vertical>=0?Mn.vertical:-1,Rn,Zn,As,Gr!==void 0?Gr:oi.collisionBoxArray.length,Gr!==void 0?Gr+1:oi.collisionBoxArray.length,Cn!==void 0?Cn:oi.collisionBoxArray.length,Cn!==void 0?Cn+1:oi.collisionBoxArray.length,An!==void 0?An:oi.collisionBoxArray.length,An!==void 0?An+1:oi.collisionBoxArray.length,_n||oi.collisionBoxArray.length,_n?_n+1:oi.collisionBoxArray.length,rr,Bi,kr,ln,Fn,id,0,Po,Ra,xa,0,ys?1:0,wn)})(r,kt,bi,et,i,a,d,o,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,$e,ne,A,0,yt,bt,K,e,p,M,z,D,B,W,Y,At)};if(se==="line")for(const et of _s(e.geometry,0,0,Vt,Vt)){const kt=jE(et,ft,It,i.vertical||Me,a,Fe,Ue,r.overscaling,Vt);for(const Ot of kt)Me&&$E(r,Me.text,Et,Ot)||at(et,Ot,D)}else if(se==="line-center"){for(const et of e.geometry)if(et.length>1){const kt=OE(et,It,i.vertical||Me,a,Fe,Ue);kt&&at(et,kt,D)}}else if(e.type==="Polygon")for(const et of cm(e.geometry,0)){const kt=kE(et,16);at(et[0],new tf(kt.x,kt.y,0,0,void 0),D)}else if(e.type==="LineString")for(const et of e.geometry)at(et,new tf(et[0].x,et[0].y,0,0,void 0),D);else if(e.type==="Point")for(const et of e.geometry)for(const kt of et)at([kt],new tf(kt.x,kt.y,0,0,void 0),D)}const L_=255,up=L_*td;function Ew(r,e,i,a,o,d,p,x,T,A,M,z,D,k,B,W,Y,K){const ne=function(Re,Me,Ne,Fe,Ue,ft,$e,yt){const It=[];if(Me.positionedLines.length===0)return It;const bt=Fe.layout.get("text-rotate").evaluate(ft,{})*Math.PI/180,Et=function(et){const kt=et[0],Ot=et[1],bi=kt*Ot;return bi>0?[kt,-Ot]:bi<0?[-kt,Ot]:kt===0?[Ot,kt]:[Ot,-kt]}(Ne);let jt=Math.abs(Me.top-Me.bottom);for(const et of Me.positionedLines)jt-=et.lineOffset;const ht=Me.positionedLines.length,At=jt/ht;let at=Me.top-Ne[1];for(let et=0;et<ht;++et){const kt=Me.positionedLines[et];at=NE(Me,At,at,et);for(const Ot of kt.positionedGlyphs){if(!Ot.rect)continue;const bi=Ot.rect||{};let oi=zE+1,fi=!0,qt=1,vi=0;if(Ot.image){const ui=$e.get(Ot.image.toString());if(!ui)continue;if(ui.sdf){ur("SDF images are not supported in formatted text and will be ignored.");continue}fi=!1,qt=ui.pixelRatio,oi=xm/qt}const Gi=(Ue||yt)&&Ot.vertical,Xt=Ot.metrics.advance*Ot.scale/2,mi=Ot.metrics,Ni=Ot.rect;if(Ni===null)continue;yt&&Me.verticalizable&&(vi=Ot.image?Xt-Ot.metrics.width*Ot.scale/2:0);const Qi=Ue?[Ot.x+Xt,Ot.y]:[0,0];let dr=[0,0],rr=[0,0],hi=!1;Ue||(Gi?(rr=[Ot.x+Xt+Et[0],Ot.y+Et[1]-vi],hi=!0):dr=[Ot.x+Xt+Ne[0],Ot.y+Ne[1]-vi]);const tr=Ni.w*Ot.scale/(qt*(Ot.localGlyph?Ju:1)),Dr=Ni.h*Ot.scale/(qt*(Ot.localGlyph?Ju:1));let pe,ge,st,dt;if(Gi){const ui=Ot.y-at,Ei=new Ct(-Xt,Xt-ui),fr=-Math.PI/2,gr=new Ct(...rr);pe=new Ct(-Xt+dr[0],dr[1]),pe._rotateAround(fr,Ei)._add(gr),pe.x+=-ui+Xt,pe.y-=(mi.left-oi)*Ot.scale;const ar=Ot.image?mi.advance*Ot.scale:aa*Ot.scale,en=String.fromCodePoint(Ot.glyph);_E(en)?pe.x+=(1-oi)*Ot.scale:yE(en)?pe.x+=ar-mi.height*Ot.scale+(-oi-1)*Ot.scale:pe.x+=Ot.image||mi.width+2*oi===Ni.w&&mi.height+2*oi===Ni.h?(ar-Dr)/2:(ar-(mi.height+2*oi)*Ot.scale)/2,ge=new Ct(pe.x,pe.y-tr),st=new Ct(pe.x+Dr,pe.y),dt=new Ct(pe.x+Dr,pe.y-tr)}else{const ui=(mi.left-oi)*Ot.scale-Xt+dr[0],Ei=(-mi.top-oi)*Ot.scale+dr[1],fr=ui+tr,gr=Ei+Dr;pe=new Ct(ui,Ei),ge=new Ct(fr,Ei),st=new Ct(ui,gr),dt=new Ct(fr,gr)}if(bt){let ui;ui=Ue?new Ct(0,0):hi?new Ct(Et[0],Et[1]):new Ct(Ne[0],Ne[1]),pe._rotateAround(bt,ui),ge._rotateAround(bt,ui),st._rotateAround(bt,ui),dt._rotateAround(bt,ui)}const Wt=new Ct(0,0),Zt=new Ct(0,0);It.push({tl:pe,tr:ge,bl:st,br:dt,texPrimary:bi,texSecondary:void 0,writingMode:Me.writingMode,glyphOffset:Qi,sectionIndex:Ot.sectionIndex,isSDF:fi,pixelOffsetTL:Wt,pixelOffsetBR:Zt,minFontScaleX:0,minFontScaleY:0})}}return It}(0,a,T,d,p,x,o,r.allowVerticalPlacement),se=r.textSizeData;let he=null;se.kind==="source"?(he=[td*d.layout.get("text-size").evaluate(x,{},Y)*B.textScaleFactor],he[0]>up&&ur(`${r.layerIds[0]}: Value for "text-size" is >= ${L_}. Reduce your "text-size".`)):se.kind==="composite"&&(he=[td*B.compositeTextSizes[0].evaluate(x,{},Y)*B.textScaleFactor,td*B.compositeTextSizes[1].evaluate(x,{},Y)*B.textScaleFactor],(he[0]>up||he[1]>up)&&ur(`${r.layerIds[0]}: Value for "text-size" is >= ${L_}. Reduce your "text-size".`)),r.addSymbols(r.text,ne,he,T,p,x,M,e,i,A.lineStartIndex,A.lineLength,k,W,Y,K,!1);for(const Re of z)D[Re]=r.text.placedSymbolArray.length-1;return 4*ne.length}function Ex(r){for(const e in r)return r[e];return null}function oy(r,e,i,a,o,d,p,x,T,A){let M=p.top,z=p.bottom,D=p.left,k=p.right;if(iw(p)&&p.collisionPadding){const B=p.collisionPadding;D-=B[0],M-=B[1],k+=B[2],z+=B[3]}if(T){const B=new Ct(D,M),W=new Ct(k,M),Y=new Ct(D,z),K=new Ct(k,z),ne=He(T);let se=new Ct(0,0);A&&(se=new Ct(A[0],A[1])),B._rotateAround(ne,se),W._rotateAround(ne,se),Y._rotateAround(ne,se),K._rotateAround(ne,se),D=Math.min(B.x,W.x,Y.x,K.x),k=Math.max(B.x,W.x,Y.x,K.x),M=Math.min(B.y,W.y,Y.y,K.y),z=Math.max(B.y,W.y,Y.y,K.y)}return r.emplaceBack(e.x,e.y,e.z,i.x,i.y,D,M,k,z,x,a,o,d),r.length-1}function Ax(r){iw(r)&&r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function $E(r,e,i,a){const o=r.compareText;if(e in o){const d=o[e];for(let p=d.length-1;p>=0;p--)if(a.dist(d[p])<i)return!0}else o[e]=[];return o[e].push(a),!1}function Aw(r,e){const i=r.fovAboveCenter,a=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,o=(r._camera.position[2]*r.worldSize-a)/Math.cos(r._pitch),d=Math.sin(i)*o/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01));let p=Math.sin(r._pitch)*d+o;const x=o*(1/r._horizonShift);if(!r.elevation||r.elevation.exaggeration()===0){let T=Math.max(r.zoom-17,0);r.isOrthographic&&(T/=10),p*=1+T}return Math.min(1.01*p,x)}function D_(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const i=Math.pow(2,-r.z),a=r.x*i,o=(r.x+1)*i,d=r.y*i,p=(r.y+1)*i,x=Ee(a),T=Ee(o),A=ve(d),M=ve(p),z=e.project(x,A),D=e.project(T,A),k=e.project(T,M),B=e.project(x,M);let W=Math.min(z.x,D.x,k.x,B.x),Y=Math.min(z.y,D.y,k.y,B.y),K=Math.max(z.x,D.x,k.x,B.x),ne=Math.max(z.y,D.y,k.y,B.y);const se=i/16;function he(Me,Ne,Fe,Ue,ft,$e){const yt=(Fe+ft)/2,It=(Ue+$e)/2,bt=e.project(Ee(yt),ve(It)),Et=Math.max(0,W-bt.x,Y-bt.y,bt.x-K,bt.y-ne);W=Math.min(W,bt.x),K=Math.max(K,bt.x),Y=Math.min(Y,bt.y),ne=Math.max(ne,bt.y),Et>se&&(he(Me,bt,Fe,Ue,yt,It),he(bt,Ne,yt,It,ft,$e))}he(z,D,a,d,o,d),he(D,k,o,d,o,p),he(k,B,o,p,a,p),he(B,z,a,p,a,d),W-=se,Y-=se,K+=se,ne+=se;const Re=1/Math.max(K-W,ne-Y);return{scale:Re,x:W*Re,y:Y*Re,x2:K*Re,y2:ne*Re,projection:e}}function Cw(r,{x:e,y:i},a=0){return new Ct(((e-a)*r.scale-r.x)*Vt,(i*r.scale-r.y)*Vt)}const ZE=Se(new Float32Array(16));class hp{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new G(0,0)}projectTilePoint(e,i,a){return{x:e,y:i,z:0}}locationPoint(e,i,a,o=!0){return e._coordinatePoint(e.locationCoordinate(i,a),o)}pixelsPerMeter(e,i){return we(1,e)*i}pixelSpaceConversion(e,i,a){return 1}farthestPixelDistance(e){return Aw(e,e.pixelsPerMeter)}pointCoordinate(e,i,a,o){const d=e.horizonLineFromTop(!1),p=new Ct(i,Math.max(d,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,o))}pointCoordinate3D(e,i,a){const o=new Ct(i,a);if(e.elevation)return e.elevation.pointCoordinate(o);{const d=this.pointCoordinate(e,o.x,o.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const a=e.horizonLineFromTop();return i.y<a}createInversionMatrix(e,i){return ZE}createTileMatrix(e,i,a){let o,d,p;const x=a.canonical,T=Se(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=D_(x,this);o=1,d=A.x+a.wrap*A.scale,p=A.y,xe(T,T,[o/A.scale,o/A.scale,e.pixelsPerMeter/i])}else o=i/e.zoomScale(x.z),d=(x.x+Math.pow(2,x.z)*a.wrap)*o,p=x.y*o;return ye(T,T,[d,p,0]),xe(T,T,[o/Vt,o/Vt,1]),T}upVector(e,i,a){return[0,0,1]}upVectorScale(e,i,a){return{metersToTile:1}}}class WE extends hp{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,a]=this.parallels=e.parallels||[29.5,45.5],o=Math.sin(He(i));this.n=(o+Math.sin(He(a)))/2,this.c=1+o*(2*this.n-o),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:a,c:o,r0:d}=this,p=He(e-this.center[0]),x=He(i),T=Math.sqrt(o-2*a*Math.sin(x))/a;return{x:T*Math.sin(p*a),y:T*Math.cos(p*a)-d,z:0}}unproject(e,i){const{n:a,c:o,r0:d}=this,p=d+i;let x=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(x-=Math.PI*Math.sign(e)*Math.sign(p));const T=He(this.center[0])*a;x=Be(x,-Math.PI-T,Math.PI-T);const A=Ie(J(x/a)+this.center[0],-180,180),M=Math.asin(Ie((o-(e*e+p*p)*a*a)/(2*a),-1,1)),z=Ie(J(M),-85.051129,Ce);return new G(A,z)}}const P_=1.340264,O_=-.081106,j_=893e-6,N_=.003796,ly=Math.sqrt(3)/2;class XE extends hp{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(ly*Math.sin(i)),o=a*a,d=o*o*o;return{x:.5*(e*Math.cos(a)/(ly*(P_+3*O_*o+d*(7*j_+9*N_*o)))/Math.PI+.5),y:1-.5*(a*(P_+O_*o+d*(j_+N_*o))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,o=a*a,d=o*o*o;for(let M,z,D,k=0;k<12&&(z=a*(P_+O_*o+d*(j_+N_*o))-i,D=P_+3*O_*o+d*(7*j_+9*N_*o),M=z/D,a=Ie(a-M,-Math.PI/3,Math.PI/3),o=a*a,d=o*o*o,!(Math.abs(M)<1e-12));++k);const p=ly*e*(P_+3*O_*o+d*(7*j_+9*N_*o))/Math.cos(a),x=Math.asin(Math.sin(a)/ly),T=Ie(180*p/Math.PI,-180,180),A=Ie(180*x/Math.PI,-85.051129,Ce);return new G(T,A)}}class YE extends hp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const a=360*(e-.5),o=Ie(360*(.5-i),-85.051129,Ce);return new G(a,o)}}const Cg=Math.PI/2;function cy(r){return Math.tan((Cg+r)/2)}class KE extends hp{constructor(e){super(e),this.center=e.center||[0,30];const[i,a]=this.parallels=e.parallels||[30,30];let o=He(i),d=He(a);this.southernCenter=o+d<0,this.southernCenter&&(o=-o,d=-d);const p=Math.cos(o),x=cy(o);this.n=o===d?Math.sin(o):Math.log(p/Math.cos(d))/Math.log(cy(d)/x),this.f=p*Math.pow(cy(o),this.n)/this.n}project(e,i){i=He(i),this.southernCenter&&(i=-i),e=He(e-this.center[0]);const a=1e-6,{n:o,f:d}=this;d>0?i<-Cg+a&&(i=-Cg+a):i>Cg-a&&(i=Cg-a);const p=d/Math.pow(cy(i),o);let x=p*Math.sin(o*e),T=d-p*Math.cos(o*e);return x=.5*(x/Math.PI+.5),T=.5*(T/Math.PI+.5),{x,y:this.southernCenter?T:1-T,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:a,f:o}=this,d=o-i,p=Math.sign(d),x=Math.sign(a)*Math.sqrt(e*e+d*d);let T=Math.atan2(e,Math.abs(d))*p;d*a<0&&(T-=Math.PI*Math.sign(e)*p);const A=Ie(J(T/a)+this.center[0],-180,180),M=Ie(J(2*Math.atan(Math.pow(o/x,1/a))-Cg),-85.051129,Ce);return new G(A,this.southernCenter?-M:M)}}class Rw extends hp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:fe(e),y:Te(i),z:0}}unproject(e,i){const a=Ee(e),o=ve(i);return new G(a,o)}}const Mw=He(Ce);class JE extends hp{project(e,i){const a=(i=He(i))*i,o=a*a;return{x:.5*((e=He(e))*(.8707-.131979*a+o*(o*(.003971*a-.001529*o)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+a*(.015085+o*(.028874*a-.044475-.005916*o)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,o=25,d=0,p=a*a;do{p=a*a;const A=p*p;d=(a*(1.007226+p*(.015085+A*(.028874*p-.044475-.005916*A)))-i)/(1.007226+p*(.045255+A*(.259866*p-.311325-.005916*11*A))),a=Ie(a-d,-Mw,Mw)}while(Math.abs(d)>1e-6&&--o>0);p=a*a;const x=Ie(J(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),T=J(a);return new G(x,T)}}const Iw=He(Ce);class QE extends hp{project(e,i){i=He(i),e=He(e);const a=Math.cos(i),o=2/Math.PI,d=Math.acos(a*Math.cos(e/2)),p=Math.sin(d)/d,x=.5*(e*o+2*a*Math.sin(e/2)/p)||0,T=.5*(i+Math.sin(i)/p)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(e,i){let a=e=(2*e-.5)*Math.PI,o=i=(2*(1-i)-1)*Math.PI,d=25;const p=1e-6;let x=0,T=0;do{const A=Math.cos(o),M=Math.sin(o),z=2*M*A,D=M*M,k=A*A,B=Math.cos(a/2),W=Math.sin(a/2),Y=2*B*W,K=W*W,ne=1-k*B*B,se=ne?1/ne:0,he=ne?Math.acos(A*B)*Math.sqrt(1/ne):0,Re=.5*(2*he*A*W+2*a/Math.PI)-e,Me=.5*(he*M+o)-i,Ne=.5*se*(k*K+he*A*B*D)+1/Math.PI,Fe=se*(Y*z/4-he*M*W),Ue=.125*se*(z*W-he*M*k*Y),ft=.5*se*(D*B+he*K*A)+.5,$e=Fe*Ue-ft*Ne;x=(Me*Fe-Re*ft)/$e,T=(Re*Ue-Me*Ne)/$e,a=Ie(a-x,-Math.PI,Math.PI),o=Ie(o-T,-Iw,Iw)}while((Math.abs(x)>p||Math.abs(T)>p)&&--d>0);return new G(J(a),J(o))}}class zw extends hp{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(He(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:a,cosPhi:o}=this;return{x:He(e)*o*a+.5,y:-Math.sin(He(i))/o*a+.5,z:0}}unproject(e,i){const{scale:a,cosPhi:o}=this,d=-(i-.5)/a,p=Ie(J((e-.5)/a)/o,-180,180),x=Math.asin(Ie(d*o,-1,1)),T=Ie(J(x),-85.051129,Ce);return new G(p,T)}}class eA extends Rw{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,a){const o=im(e,i,a);return Tt(o,o,rm(ya(a))),{x:o[0],y:o[1],z:o[2]}}locationPoint(e,i,a){const o=j(i.lat,i.lng),d=_i([],o),p=a?e._centerAltitude+a:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Pi(o,o,d,we(1,0)*Vt*p);const x=Se(new Float64Array(16));return _e(x,e.pixelMatrix,e.globeMatrix),Tt(o,o,x),new Ct(o[0],o[1])}pixelsPerMeter(e,i){return we(1,0)*i}pixelSpaceConversion(e,i,a){const o=we(1,e)*i,d=Li(we(1,45)*i,o,a);return this.pixelsPerMeter(e,i)/d}createTileMatrix(e,i,a){const o=e_(ya(a.canonical));return _e(new Float64Array(16),e.globeMatrix,o)}createInversionMatrix(e,i){const{center:a}=e,o=rm(ya(i));return Ae(o,o,He(a.lng)),Le(o,o,He(a.lat)),xe(o,o,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(o)}pointCoordinate(e,i,a,o){return em(e,i,a,!0)||new ot(0,0)}pointCoordinate3D(e,i,a){const o=this.pointCoordinate(e,i,a,0);return[o.x,o.y,o.z]}isPointAboveHorizon(e,i){return!em(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(o,d){const p=o.cameraToCenterDistance,x=o._centerAltitude*d,T=o._camera,A=o._camera.forward(),M=Jt([],Ht([],A,-p),[0,0,x]),z=o.worldSize/(2*Math.PI),D=[0,0,-z],k=o.width/o.height,B=Math.tan(o.fovAboveCenter),W=Ht([],T.up(),B),Y=Ht([],T.right(),B*k),K=_i([],Jt([],Jt([],A,W),Y)),ne=[];let se;if(new Tr(M,K).closestPointOnSphere(D,z,ne)){const he=Jt([],ne,D),Re=Er([],he,M);se=Math.cos(o.fovAboveCenter)*Zi(Re)}else{const he=Er([],M,D),Re=Er([],D,M);_i(Re,Re);const Me=Zi(he)-z;se=Math.sqrt(Me*(Me+2*z));const Ne=Math.acos(se/(z+Me))-Math.acos(Ri(A,Re));se*=Math.cos(Ne)}return 1.01*se}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Wh(e.zoom);if(a>0){const o=Aw(e,we(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Li(i,o+d*(1-Math.cos(p)),Math.pow(a,10))}return i}upVector(e,i,a){return im(i,a,e,1)}upVectorScale(e){return{metersToTile:$u(Xf(ya(e)))}}}function Lw(r){const e=r.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new Rw(r);case"equirectangular":return new YE(r);case"naturalEarth":return new JE(r);case"equalEarth":return new XE(r);case"winkelTripel":return new QE(r);case"albers":return i?new zw(r):new WE(r);case"lambertConformalConic":return i?new zw(r):new KE(r);case"globe":return new eA(r)}throw new Error(`Invalid projection name: ${r.name}`)}const tA=St.types,iA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function uy(r,e,i,a,o,d,p,x,T,A,M,z,D){const k=x?Math.min(up,Math.round(x[0])):0,B=x?Math.min(up,Math.round(x[1])):0;r.emplaceBack(e,i,Math.round(32*a),Math.round(32*o),d,p,(k<<1)+(T?1:0),B,16*A,16*M,256*z,256*D)}function hy(r,e,i){r.emplaceBack(e,i)}function dy(r,e,i,a,o,d,p){r.emplaceBack(e,i,a,o,d,p)}const fy=(r,e,i,a)=>{for(let o=0;o<e;o++)r.emplaceBack(i[0],i[1],i[2],a[0],a[1],a[2])};function py(r,e,i,a,o){r.emplaceBack(e,i,a,o),r.emplaceBack(e,i,a,o),r.emplaceBack(e,i,a,o),r.emplaceBack(e,i,a,o)}function rA(r){for(const e of r.sections)if(jf(e.text))return!0;return!1}class Cx{constructor(e){this.layoutVertexArray=new Hd,this.indexArray=new cs,this.programConfigurations=e,this.segments=new Wr,this.dynamicLayoutVertexArray=new fo,this.opacityVertexArray=new Ou,this.placedSymbolArray=new Jo,this.iconTransitioningVertexArray=new rs,this.globeExtVertexArray=new qd,this.zOffsetVertexArray=new Ro,this.orientationVertexArray=new po}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,a,o,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,cE.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,iA,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,dE.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,lE.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,uE.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,hE.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||o)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}si(Cx,"SymbolBuffers");class Rx{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new Wr,this.collisionVertexArray=new Xp,this.collisionVertexArrayExt=new fo}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,fE.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,pE.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}si(Rx,"CollisionBuffers");class my{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Se([]),this.placementViewportMatrix=Se([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=ow(this.zoom,i["text-size"],this.worldview),this.iconSizeData=ow(this.zoom,i["icon-size"],this.worldview);const a=this.layers[0].layout,o=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.lut=e.lut,this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&o.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>ol[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new Cx(new $s(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Cx(new $s(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Zf,this.lineVertexArray=new Fh,this.symbolInstances=new $f}calculateGlyphDependencies(e,i,a,o,d){for(const p of e){const x=p.codePointAt(0);if(x===void 0)break;if(i[x]=!0,o&&d&&x<=65535){const T=R_[p];T&&(i[T.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!np(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,i,a,o){const d=this.layers[0],p=d.layout,x=this.projection.name==="globe",T=p.get("text-font"),A=p.get("text-field"),M=p.get("icon-image"),[z,D]=p.get("icon-size-scale-range"),k=Ie(i.scaleFactor||1,z,D),B=(A.value.kind!=="constant"||A.value.value instanceof ca&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),W=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,Y=p.get("symbol-sort-key");if(this.features=[],!B&&!W)return;const K=i.iconDependencies,ne=i.glyphDependencies,se=i.availableImages,he=new on(this.zoom,{worldview:this.worldview});for(const{feature:Re,id:Me,index:Ne,sourceLayerIndex:Fe}of e){const Ue=d._featureFilter.needGeometry,ft=Rt(Re,Ue);if(!d._featureFilter.filter(he,ft,a))continue;if(Ue||(ft.geometry=$t(Re,a,o)),x&&Re.type!==1&&a.z<=5){const Et=ft.geometry,jt=.98078528056,ht=(At,at)=>Ri(im(At.x,At.y,a,1),im(at.x,at.y,a,1))<jt;for(let At=0;At<Et.length;At++)Et[At]=nt(Et[At],ht)}let $e,yt;if(B){const Et=d.getValueAndResolveTokens("text-field",ft,a,se),jt=ca.factory(Et);rA(jt)&&(this.hasRTLText=!0),(!this.hasRTLText||Lh()==="unavailable"||this.hasRTLText&&Zo.isParsed())&&($e=gE(jt,d,ft))}if(W){const Et=d.getValueAndResolveTokens("icon-image",ft,a,se);yt=typeof Et=="string"?Sa.build(Et):Et}if(!$e&&!yt)continue;const It=this.sortFeaturesByKey?Y.evaluate(ft,{},a):void 0,bt={id:Me,text:$e,icon:yt,index:Ne,sourceLayerIndex:Fe,geometry:ft.geometry,properties:Re.properties,type:tA[Re.type],sortKey:It};if(this.features.push(bt),yt){const Et=this.layers[0]._unevaluatedLayout._values,{iconPrimary:jt,iconSecondary:ht}=ww(yt,this.iconSizeData,Et["icon-size"],a,this.zoom,bt,this.pixelRatio,k,this.worldview),At=jt.id.toString();if(K.has(At)?K.get(At).push(jt):K.set(At,[jt]),ht){this.hasAnySecondaryIcon=!0;const at=ht.id.toString();K.has(at)?K.get(at).push(ht):K.set(at,[ht])}}if($e){const Et=T.evaluate(ft,{},a).join(","),jt=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ol.vertical)>=0;for(const ht of $e.sections)if(ht.image){const At=ht.image.getPrimary().scaleSelf(this.pixelRatio),at=At.id.toString(),et=K.get(at)||[];et.push(At),K.set(at,et)}else{const At=Pf($e.toString()),at=ht.fontStack||Et,et=ne[at]=ne[at]||{};this.calculateGlyphDependencies(ht.text,et,jt,this.allowVerticalPlacement,At)}}}if(p.get("symbol-placement")==="line"&&(this.features=function(Re){const Me={},Ne={},Fe=[];let Ue=0;function ft(bt){Fe.push(Re[bt]),Ue++}function $e(bt,Et,jt){const ht=Ne[bt];return delete Ne[bt],Ne[Et]=ht,Fe[ht].geometry[0].pop(),Fe[ht].geometry[0]=Fe[ht].geometry[0].concat(jt[0]),ht}function yt(bt,Et,jt){const ht=Me[Et];return delete Me[Et],Me[bt]=ht,Fe[ht].geometry[0].shift(),Fe[ht].geometry[0]=jt[0].concat(Fe[ht].geometry[0]),ht}function It(bt,Et,jt){const ht=jt?Et[0][Et[0].length-1]:Et[0][0];return`${bt}:${ht.x}:${ht.y}`}for(let bt=0;bt<Re.length;bt++){const Et=Re[bt],jt=Et.geometry,ht=Et.text?Et.text.toString():null;if(!ht){ft(bt);continue}const At=It(ht,jt),at=It(ht,jt,!0);if(At in Ne&&at in Me&&Ne[At]!==Me[at]){const et=yt(At,at,jt),kt=$e(At,at,Fe[et].geometry);delete Me[At],delete Ne[at],Ne[It(ht,Fe[kt].geometry,!0)]=kt,Fe[et].geometry=null}else At in Ne?$e(At,at,jt):at in Me?yt(At,at,jt):(ft(bt),Me[At]=Ue-1,Ne[at]=Ue-1)}return Fe.filter(bt=>bt.geometry)}(this.features)),p.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Re of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Re.id,this.elevationFeatures.length),this.elevationFeatures.push(Re)}}else p.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Re,Me)=>Re.sortKey-Me.sortKey)}update(e,i,a,o,d,p,x){this.text.programConfigurations.updatePaintArrays(e,i,d,a,o,p,x,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,d,a,o,p,x,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const a=Ze(e),o=1/a;let d=!1,p=!1;for(let x=0;x<this.symbolInstances.length;x++){const T=this.symbolInstances.get(x),A=or(1,0,0),M=or(0,1,0),{numHorizontalGlyphVertices:z,numVerticalGlyphVertices:D,numIconVertices:k,numVerticalIconVertices:B}=T,W=z>0||D>0,Y=k>0,K=this.elevationFeatures[T.elevationFeatureIndex];if(K){const ne=new Ct(T.tileAnchorX,T.tileAnchorY),se=.075+K.pointElevation(ne);T.zOffset!==se&&(i=!0,T.zOffset=se);const he=K.computeSlopeNormal(ne,o),Re=Vs(za(),or(0,0,1),he);Sr(A,A,Re),Sr(M,M,Re),A[2]*=a,M[2]*=a,A[0]===1&&A[1]===0&&A[2]===0&&M[0]===0&&M[1]===1&&M[2]===0||(d=d||W,p=p||Y)}if(W&&(fy(this.text.orientationVertexArray,z,A,M),fy(this.text.orientationVertexArray,D,A,M)),Y){const{placedIconSymbolIndex:ne,verticalPlacedIconSymbolIndex:se}=T;ne>=0&&fy(this.icon.orientationVertexArray,k,A,M),se>=0&&fy(this.icon.orientationVertexArray,B,A,M)}}d||(this.text.orientationVertexArray=void 0),p||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(d,p,x)=>{a+=p,a>d.length&&d.resize(a);for(let T=-p;T<0;T++)d.emplace(T+a,x)},i=(d,p,x)=>{o+=p,o>d.length&&d.resize(o);for(let T=-p;T<0;T++)d.emplace(T+o,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,o=0;for(let d=0;d<this.symbolInstances.length;d++){const p=this.symbolInstances.get(d),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:T,numIconVertices:A}=p,M=p.zOffset,z=A>0;if((x>0||T>0)&&(e(this.text.zOffsetVertexArray,x,M),e(this.text.zOffsetVertexArray,T,M)),z){const{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:k}=p;D>=0&&i(this.icon.zOffsetVertexArray,A,M),k>=0&&i(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Lw(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:o,y:d}of i)this.lineVertexArray.emplaceBack(o,d);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,o,d,p,x,T,A,M,z,D,k,B,W,Y){const K=e.indexArray,ne=e.layoutVertexArray,se=e.globeExtVertexArray,he=e.segments.prepareSegment(4*i.length,ne,K,this.canOverlap?p.sortKey:void 0),Re=this.glyphOffsetArray.length,Me=he.vertexLength,Ne=this.allowVerticalPlacement&&x===ol.vertical?Math.PI/2:0,Fe=p.text&&p.text.sections;for(let ft=0;ft<i.length;ft++){const{tl:$e,tr:yt,bl:It,br:bt,texPrimary:Et,texSecondary:jt,pixelOffsetTL:ht,pixelOffsetBR:At,minFontScaleX:at,minFontScaleY:et,glyphOffset:kt,isSDF:Ot,sectionIndex:bi}=i[ft],oi=he.vertexLength,fi=kt[1];if(uy(ne,A.x,A.y,$e.x,fi+$e.y,Et.x,Et.y,a,Ot,ht.x,ht.y,at,et),uy(ne,A.x,A.y,yt.x,fi+yt.y,Et.x+Et.w,Et.y,a,Ot,At.x,ht.y,at,et),uy(ne,A.x,A.y,It.x,fi+It.y,Et.x,Et.y+Et.h,a,Ot,ht.x,At.y,at,et),uy(ne,A.x,A.y,bt.x,fi+bt.y,Et.x+Et.w,Et.y+Et.h,a,Ot,At.x,At.y,at,et),T){const{x:qt,y:vi,z:Gi}=T.anchor,[Xt,mi,Ni]=T.up;dy(se,qt,vi,Gi,Xt,mi,Ni),dy(se,qt,vi,Gi,Xt,mi,Ni),dy(se,qt,vi,Gi,Xt,mi,Ni),dy(se,qt,vi,Gi,Xt,mi,Ni),py(e.dynamicLayoutVertexArray,qt,vi,Gi,Ne)}else py(e.dynamicLayoutVertexArray,A.x,A.y,A.z,Ne);if(Y){const qt=jt||Et;hy(e.iconTransitioningVertexArray,qt.x,qt.y),hy(e.iconTransitioningVertexArray,qt.x+qt.w,qt.y),hy(e.iconTransitioningVertexArray,qt.x,qt.y+qt.h),hy(e.iconTransitioningVertexArray,qt.x+qt.w,qt.y+qt.h)}K.emplaceBack(oi,oi+1,oi+2),K.emplaceBack(oi+1,oi+2,oi+3),he.vertexLength+=4,he.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(kt[0]),ft!==i.length-1&&bi===i[ft+1].sectionIndex||e.programConfigurations.populatePaintArrays(ne.length,p,p.index,{},k,B,W,Fe&&Fe[bi],this.worldview)}const Ue=T?T.anchor:A;e.placedSymbolArray.emplaceBack(Ue.x,Ue.y,Ue.z,A.x,A.y,Re,this.glyphOffsetArray.length-Re,Me,M,z,A.segment,a?a[0]:0,a?a[1]:0,o[0],o[1],x,0,0,0,D,0)}_commitLayoutVertex(e,i,a,o,d,p,x){e.emplaceBack(i,a,o,d,p,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,i,a,o,d,p,x){const T=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),A=T.vertexLength,M=x.tileAnchorX,z=x.tileAnchorY;for(let k=0;k<4;k++)a.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,i,e.padding,x.zOffset),this._commitLayoutVertex(a.layoutVertexArray,o,d,p,M,z,new Ct(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,o,d,p,M,z,new Ct(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,o,d,p,M,z,new Ct(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,o,d,p,M,z,new Ct(e.x1,e.y2)),T.vertexLength+=4;const D=a.indexArray;D.emplaceBack(A,A+1),D.emplaceBack(A+1,A+2),D.emplaceBack(A+2,A+3),D.emplaceBack(A+3,A),T.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,a,o,d,p){for(let x=o;x<d;x++){const T=a.get(x),A=this.getSymbolInstanceTextSize(e,p,i,x);this._addCollisionDebugVertices(T,A,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,i,a,o,d,p){for(let x=o;x<d;x++){const T=a.get(x),A=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._addCollisionDebugVertices(T,A,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,i,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Rx(Mo,Zb.members,rs),this.iconCollisionBox=new Rx(Mo,Zb.members,rs);const o=I_(this.iconSizeData,e),d=I_(this.textSizeData,e,a);for(let p=0;p<this.symbolInstances.length;p++){const x=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(d,e,i,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(d,e,i,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(o,e,i,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(o,e,i,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,i,a,o){const d=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:o),p=vx(this.textSizeData,e,d)/aa;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,i,a){const o=this.icon.placedSymbolArray.get(a),d=vx(this.iconSizeData,e,o);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,i,a,o){e.emplaceBack(i,-a,-a,o),e.emplaceBack(i,a,-a,o),e.emplaceBack(i,a,a,o),e.emplaceBack(i,-a,a,o)}_updateTextDebugCollisionBoxes(e,i,a,o,d,p,x){for(let T=o;T<d;T++){const A=a.get(T),M=this.getSymbolInstanceTextSize(e,p,i,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,A.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,i,a,o,d,p,x){for(let T=o;T<d;T++){const A=a.get(T),M=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,A.padding,p.zOffset)}}updateCollisionDebugBuffers(e,i,a,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=I_(this.iconSizeData,e,o),p=I_(this.textSizeData,e,a);for(let x=0;x<this.symbolInstances.length;x++){const T=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(p,e,i,T.textBoxStartIndex,T.textBoxEndIndex,T,a),this._updateTextDebugCollisionBoxes(p,e,i,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T,a),this._updateIconDebugCollisionBoxes(d,e,i,T.iconBoxStartIndex,T.iconBoxEndIndex,T,o),this._updateIconDebugCollisionBoxes(d,e,i,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T,o)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,a,o,d,p,x,T,A){const M={};if(i<a){const{x1:z,y1:D,x2:k,y2:B,padding:W,projectedAnchorX:Y,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:he,featureIndex:Re}=e.get(i);M.textBox={x1:z,y1:D,x2:k,y2:B,padding:W,projectedAnchorX:Y,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:he},M.textFeatureIndex=Re}if(o<d){const{x1:z,y1:D,x2:k,y2:B,padding:W,projectedAnchorX:Y,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:he,featureIndex:Re}=e.get(o);M.verticalTextBox={x1:z,y1:D,x2:k,y2:B,padding:W,projectedAnchorX:Y,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:he},M.verticalTextFeatureIndex=Re}if(p<x){const{x1:z,y1:D,x2:k,y2:B,padding:W,projectedAnchorX:Y,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:he,featureIndex:Re}=e.get(p);M.iconBox={x1:z,y1:D,x2:k,y2:B,padding:W,projectedAnchorX:Y,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:he},M.iconFeatureIndex=Re}if(T<A){const{x1:z,y1:D,x2:k,y2:B,padding:W,projectedAnchorX:Y,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:he,featureIndex:Re}=e.get(T);M.verticalIconBox={x1:z,y1:D,x2:k,y2:B,padding:W,projectedAnchorX:Y,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:se,tileAnchorY:he},M.verticalIconFeatureIndex=Re}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const a=e.placedSymbolArray.get(i),o=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<o;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),a=Math.cos(e),o=[],d=[],p=[];for(let x=0;x<this.symbolInstances.length;++x){p.push(x);const T=this.symbolInstances.get(x);o.push(0|Math.round(i*T.tileAnchorX+a*T.tileAnchorY)),d.push(T.featureIndex)}return p.sort((x,T)=>o[x]-o[T]||d[T]-d[x]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:A}=a;o>=0&&this.addIndicesForPlacedSymbol(this.text,o),d>=0&&d!==o&&this.addIndicesForPlacedSymbol(this.text,d),p>=0&&p!==d&&p!==o&&this.addIndicesForPlacedSymbol(this.text,p),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Dw,Pw,Mx;si(my,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),my.addDynamicAttributes=py;class Ow{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:bo,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}si(Ow,"FormatSectionOverride",{omit:["defaultValue"]});const Ix=()=>Mx||(Mx={layout:Dw||(Dw=new On({"symbol-placement":new Nt(qe.layout_symbol["symbol-placement"]),"symbol-spacing":new Nt(qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Nt(qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Yt(qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Nt(qe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Nt(qe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Nt(qe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Nt(qe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Nt(qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Nt(qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Nt(qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Yt(qe.layout_symbol["icon-size"]),"icon-size-scale-range":new Nt(qe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Yt(qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Yt(qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Yt(qe.layout_symbol["icon-image"]),"icon-image-use-theme":new Nt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Yt(qe.layout_symbol["icon-rotate"]),"icon-padding":new Nt(qe.layout_symbol["icon-padding"]),"icon-keep-upright":new Nt(qe.layout_symbol["icon-keep-upright"]),"icon-offset":new Yt(qe.layout_symbol["icon-offset"]),"icon-anchor":new Yt(qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Nt(qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Nt(qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Nt(qe.layout_symbol["text-rotation-alignment"]),"text-field":new Yt(qe.layout_symbol["text-field"]),"text-font":new Yt(qe.layout_symbol["text-font"]),"text-size":new Yt(qe.layout_symbol["text-size"]),"text-size-scale-range":new Nt(qe.layout_symbol["text-size-scale-range"]),"text-max-width":new Yt(qe.layout_symbol["text-max-width"]),"text-line-height":new Yt(qe.layout_symbol["text-line-height"]),"text-letter-spacing":new Yt(qe.layout_symbol["text-letter-spacing"]),"text-justify":new Yt(qe.layout_symbol["text-justify"]),"text-radial-offset":new Yt(qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Nt(qe.layout_symbol["text-variable-anchor"]),"text-anchor":new Yt(qe.layout_symbol["text-anchor"]),"text-max-angle":new Nt(qe.layout_symbol["text-max-angle"]),"text-writing-mode":new Nt(qe.layout_symbol["text-writing-mode"]),"text-rotate":new Yt(qe.layout_symbol["text-rotate"]),"text-padding":new Nt(qe.layout_symbol["text-padding"]),"text-keep-upright":new Nt(qe.layout_symbol["text-keep-upright"]),"text-transform":new Yt(qe.layout_symbol["text-transform"]),"text-offset":new Yt(qe.layout_symbol["text-offset"]),"text-allow-overlap":new Nt(qe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Nt(qe.layout_symbol["text-ignore-placement"]),"text-optional":new Nt(qe.layout_symbol["text-optional"]),visibility:new Nt(qe.layout_symbol.visibility)})),paint:Pw||(Pw=new On({"icon-opacity":new Yt(qe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Yt(qe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Yt(qe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Yt(qe.paint_symbol["text-emissive-strength"]),"icon-color":new Yt(qe.paint_symbol["icon-color"]),"icon-halo-color":new Yt(qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Yt(qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Yt(qe.paint_symbol["icon-halo-blur"]),"icon-translate":new Nt(qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Nt(qe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Nt(qe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Yt(qe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Yt(qe.paint_symbol["text-occlusion-opacity"]),"text-color":new Yt(qe.paint_symbol["text-color"],{runtimeType:Na,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Yt(qe.paint_symbol["text-halo-color"]),"text-halo-width":new Yt(qe.paint_symbol["text-halo-width"]),"text-halo-blur":new Yt(qe.paint_symbol["text-halo-blur"]),"text-translate":new Nt(qe.paint_symbol["text-translate"]),"text-translate-anchor":new Nt(qe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Nt(qe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Nt(qe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Nt(qe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Nt(qe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Yt(qe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},Mx);class gy extends fa{constructor(e,i,a,o){super(e,Ix(),i,a,o,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Se([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const o=[];for(const d of a)o.indexOf(d)<0&&o.push(d);this.layout._values["text-writing-mode"]=o}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,a,o){return this._saturation===e&&this._contrast===i&&this._brightnessMin===a&&this._brightnessMax===o||(this._colorAdjustmentMatrix=function(d,p,x,T){d=dn(d),p=tn(p);const A=le(),M=d/3,z=1-2*M,D=[z,M,M,0,M,z,M,0,M,M,z,0,0,0,0,1],k=.5-.5*p,B=T-x;return _e(A,[B,0,0,0,0,B,0,0,0,0,B,0,x,x,x,1],[p,0,0,0,0,p,0,0,0,0,p,0,k,k,k,1]),_e(A,A,D),A}(e,i,a,o),this._saturation=e,this._contrast=i,this._brightnessMin=a,this._brightnessMax=o),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,a,o){const d=this.layout.get(e).evaluate(i,{},a,o),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||$o(p.value)||!d?d:function(x,T){return T.replace(/{([^{}]+)}/g,(A,M)=>M in x?String(x[M]):"")}(i.properties,d)}createBucket(e){return new my(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Ix().paint.overridableProperties){if(!gy.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),a=new Ow(i),o=new Ih(a,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new zu("source",o):new xl("composite",o,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new ac(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&gy.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const a=e.get("text-field"),o=Ix().paint.properties[i];let d=!1;const p=x=>{for(const T of x)if(o.overrides&&o.overrides.hasOverride(T))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof ca)p(a.value.value.sections);else if(a.value.kind==="source"){const x=A=>{d||(A instanceof ir&&vs(A.value)===Ic?p(A.value.sections):A instanceof gu?p(A.sections):A.eachChild(x))},T=a.value;T._styleExpression&&x(T._styleExpression.expression)}return d}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,a){return{config:new Qc(this,{zoom:i,lut:a}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let jw,Nw,kw,Bw;var zx=xr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function _y(r,e,i,a,o,d,p,x){const T=[r,e,1,i,a,1,o,d,1],A=[p,x,1],M=de([],T),[z,D,k]=Si(A,A,M);return ze(T,T,[z,0,0,0,D,0,0,0,k])}function Fw(r,e,i,a,o,d,p,x){const T=function(A,M,z,D,k,B,W,Y){const K=_y(0,0,1,0,1,1,0,1),ne=_y(A,M,z,D,k,B,W,Y);return ze(ne,ne,de([],K))}(r,e,i,a,o,d,p,x);return[T[2]/T[8]/Vt,T[5]/T[8]/Vt]}function yy(r){return[r[0],Math.min(Math.max(r[1],-85.051129),Ce)]}class Uw extends fu{constructor(e,i,a,o){super(),this.id=e,this.dispatcher=a,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(o),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new so("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Bl(this.map._requestManager.transformRequest(this.url,uh.Image),(a,o)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Fl(a)):o&&(this.image=o instanceof HTMLImageElement?xo.getImageData(o):o,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new E_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new so("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof E_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],a=e[0][1];for(const d of e)d[1]>a&&(a=d[1]),d[1]<i&&(i=d[1]);const o=(a+i)/2;if(o>Ce?this.onNorthPole=!0:o<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const d=e.map(ot.fromLngLat);this.tileID=function(p){let x=1/0,T=1/0,A=-1/0,M=-1/0;for(const W of p)x=Math.min(x,W.x),T=Math.min(T,W.y),A=Math.max(A,W.x),M=Math.max(M,W.y);const z=Math.max(A-x,M-T),D=Math.max(0,Math.floor(-Math.log2(z))),k=Math.pow(2,D);let B=Math.floor((x+A)/2*k);return B>1&&(B-=1),new Ml(D,B,Math.floor((T+M)/2*k))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new so("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof E_||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const K in this.tiles){const ne=this.tiles[K];ne.state!=="loaded"&&(ne.state="loaded",ne.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=D_(new Ml(0,0,0),this.map.transform.projection),a=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(K){const ne=K[1].x-K[0].x,se=K[1].y-K[0].y,he=K[2].x-K[1].x,Re=K[2].y-K[1].y,Me=K[3].x-K[2].x,Ne=K[3].y-K[2].y,Fe=K[0].x-K[3].x,Ue=K[0].y-K[3].y,ft=ne*Re-he*se,$e=he*Ne-Me*Re,yt=Me*Ue-Fe*Ne,It=Fe*se-ne*Ue;return ft>0&&$e>0&&yt>0&&It>0||ft<0&&$e<0&&yt<0&&It<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const o=D_(this.tileID,this.map.transform.projection),[d,p,x,T]=this.coordinates.map(K=>{const ne=o.projection.project(K[0],K[1]);return Cw(o,ne)._round()});this.perspectiveTransform=Fw(d.x,d.y,p.x,p.y,x.x,x.y,T.x,T.y);const A=this._boundsArray=new Kc;A.emplaceBack(d.x,d.y,0,0),A.emplaceBack(p.x,p.y,Vt,0),A.emplaceBack(T.x,T.y,0,Vt),A.emplaceBack(x.x,x.y,Vt,Vt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(A,zx.members),this.boundsSegments=Wr.simpleSegment(0,0,4,2);const M=[],z=[yy((D=this.coordinates)[0]),yy(D[1]),yy(D[2]),yy(D[3])];var D;const[k,B,W,Y]=function(K){let ne=K[0][0],se=ne,he=K[0][1],Re=he;for(let Me=1;Me<K.length;Me++)K[Me][0]<ne?ne=K[Me][0]:K[Me][0]>se&&(se=K[Me][0]),K[Me][1]<he?he=K[Me][1]:K[Me][1]>Re&&(Re=K[Me][1]);return[ne,he,se-ne,Re-he]}(z);{const K=new Kc,[ne,se,he,Re]=function(ht){let At=ht[0].x,at=At,et=ht[0].y,kt=et;for(let Ot=1;Ot<ht.length;Ot++)ht[Ot].x<At?At=ht[Ot].x:ht[Ot].x>at&&(at=ht[Ot].x),ht[Ot].y<et?et=ht[Ot].y:ht[Ot].y>kt&&(kt=ht[Ot].y);return[At,et,at-At,kt-et]}(a),Me=ht=>[(ht.x-ne)/he,(ht.y-se)/Re],[Ne,Fe,Ue,ft]=a.map(Me),$e=function(ht,At,at,et,kt,Ot,bi,oi){const fi=_y(0,0,1,0,1,1,0,1);return ze(fi,fi,de([],_y(ht,At,at,et,kt,Ot,bi,oi)))}(Ne[0],Ne[1],Fe[0],Fe[1],Ue[0],Ue[1],ft[0],ft[1]);this.elevatedGlobePerspectiveTransform=Fw(Ne[0],Ne[1],Fe[0],Fe[1],Ue[0],Ue[1],ft[0],ft[1]);const yt=(ht,At)=>{M.push(ht.lng);const at=Math.round((ht.lng-k)/W*Vt),et=Math.round((ht.lat-B)/Y*Vt),kt=Me(At),Ot=Si([],[kt[0],kt[1],1],$e),bi=Math.round(Ot[0]/Ot[2]*Vt),oi=Math.round(Ot[1]/Ot[2]*Vt);K.emplaceBack(at,et,bi,oi)},It=a[3].x-a[0].x,bt=a[3].y-a[0].y,Et=a[2].x-a[1].x,jt=a[2].y-a[1].y;for(let ht=0;ht<65;ht++){const At=ht/64,at=[a[0].x+At*It,a[0].y+At*bt],et=[a[1].x+At*Et,a[1].y+At*jt],kt=et[0]-at[0],Ot=et[1]-at[1];for(let bi=0;bi<65;bi++){const oi=bi/64,fi={x:at[0]+kt*oi,y:at[1]+Ot*oi};yt(i.projection.unproject(fi.x,fi.y),fi)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(K,zx.members)}{this.maxLongitudeTriangleSize=0;let K=[],ne=new cs;const se=(he,Re,Me)=>{ne.emplaceBack(he,Re,Me);const Ne=M[he],Fe=M[Re],Ue=M[Me],ft=Math.min(Math.min(Ne,Fe),Ue),$e=Math.max(Math.max(Ne,Fe),Ue)-ft;$e>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=$e),K.push(ft+$e/2)};for(let he=0;he<64;he++)for(let Re=0;Re<64;Re++){const Me=65*he+Re,Ne=Me+1,Fe=Me+65,Ue=Fe+1;se(Me,Fe,Ne),se(Ne,Fe,Ue)}[K,ne]=function(he,Re){const Me=Array.from({length:he.length},(Ue,ft)=>ft);Me.sort((Ue,ft)=>he[Ue]-he[ft]);const Ne=[],Fe=new cs;for(let Ue=0;Ue<Me.length;Ue++){const ft=Me[Ue];Ne.push(he[ft]);const $e=3*ft,yt=$e+1;Fe.emplaceBack(Re.uint16[$e],Re.uint16[yt],Re.uint16[yt+1])}return[Ne,Fe]}(K,ne),this.elevatedGlobeTrianglesCenterLongitudes=K,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(ne)}this.elevatedGlobeSegments=Wr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,W/Vt,0,Y/Vt,0,0,B,k,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,a=i.gl;!this._dirty||this.texture instanceof E_||(this.texture?this.texture.update(this.image):(this.texture=new sx(i,this.image,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let o=(d=e+180)+360*Math.round((a[0]-d)/360);var d;const p=new Wr,x=(z,D)=>{p.segments.push({vertexOffset:0,primitiveOffset:z,vertexLength:i.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-o)<=T){const z=Sn(a,0,a.length,o+T);return z===a.length||x(z,$i(a,z+1,a.length,o+360-T)-z),p}o<a[0]&&(o+=360);const A=$i(a,0,a.length,o-T);if(A===a.length)return x(0,a.length),p;x(0,A-0);const M=Sn(a,A+1,a.length,o+T);return M!==a.length&&x(M,a.length-M),p}}const nA=(Math.pow(256,2)-1)/16907520;class Vw extends fa{constructor(e,i,a,o){super(e,{layout:kw||(kw=new On({visibility:new Nt(qe.layout_raster.visibility)})),paint:Bw||(Bw=new On({"raster-opacity":new Nt(qe.paint_raster["raster-opacity"]),"raster-color":new Dh(qe.paint_raster["raster-color"]),"raster-color-mix":new Nt(qe.paint_raster["raster-color-mix"]),"raster-color-range":new Nt(qe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Nt(qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Nt(qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Nt(qe.paint_raster["raster-brightness-max"]),"raster-saturation":new Nt(qe.paint_raster["raster-saturation"]),"raster-contrast":new Nt(qe.paint_raster["raster-contrast"]),"raster-resampling":new Nt(qe.paint_raster["raster-resampling"]),"raster-fade-duration":new Nt(qe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Nt(qe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Nt(qe.paint_raster["raster-array-band"]),"raster-elevation":new Nt(qe.paint_raster["raster-elevation"]),"raster-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,o),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Uw&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[a,o]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(o)||a===this._curRampRange[0]&&o===this._curRampRange[1]||(this.colorRamp=Yd({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:o}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,o])}}let Hw,qw,Gw,$w,Zw;class Ww extends fa{constructor(e,i,a,o){super(e,{layout:Hw||(Hw=new On({visibility:new Nt(qe["layout_raster-particle"].visibility)})),paint:qw||(qw=new On({"raster-particle-array-band":new Nt(qe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Nt(qe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Dh(qe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Nt(qe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Nt(qe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Nt(qe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Nt(qe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Nt(qe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,o),this._updateColorRamp(),this.lastInvalidatedAt=xo.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Yd({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=xo.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class sA extends fa{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Lx(r,e,i){const a=[0,0,1],o=La([]);return ps(o,o,i?-He(r)+Math.PI:He(r)),fs(o,o,-He(e)),Sr(a,a,o),_i(a,a)}const Xw={None:0,Model:1,Symbol:2,FillExtrusion:4};class xy{constructor(e,i,a,o){this.message=(e?`${e}: `:"")+a,o&&(this.identifier=o),i!=null&&i.__line__&&(this.line=i.__line__)}}function Dx(r,e){const i=r.indexOf("://")===-1;try{return new URL(r,i&&e?"http://example.com":void 0),!0}catch{return!1}}class Yw{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Kw{constructor(){this.instancedDataArray=new Js,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Px{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,a,o){this.tileToMeter=Ze(a);const d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:p,id:x,index:T,sourceLayerIndex:A}of e){const M=x??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),z=Rt(p,d);if(!this.layers[0]._featureFilter.filter(new on(this.zoom,{worldview:this.worldview}),z,a))continue;const D={id:M,sourceLayerIndex:A,index:T,geometry:d?z.geometry:$t(p,a,o),properties:p.properties,type:p.type,patterns:{}},k=this.addFeature(D,D.geometry,z);k&&i.featureIndex.insert(p,D.geometry,T,A,this.index,this.instancesPerModel[k].instancedDataArray.length,Vt/32)}this.lookup=null}update(e,i,a,o){for(const d in this.instancesPerModel){const p=this.instancesPerModel[d];for(const x in e)p.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(p.features[p.idToFeaturesIndex[x]],e[x],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];for(const o of a.features){const d=this.layers[0],p=o.feature,x=this.canonical,T=d.paint.get("model-rotation").evaluate(p,{},x),A=d.paint.get("model-scale").evaluate(p,{},x),M=d.paint.get("model-translation").evaluate(p,{},x);zr(o.rotation,T)&&zr(o.scale,A)&&zr(o.translation,M)||(this.evaluate(o,o.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,i,a,o){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const d=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(np(this.activeReplacements,d))return!1;this.activeReplacements=d;let p=!1;for(const x in this.instancesPerModel){const T=this.instancesPerModel[x],A=T.instancedDataArray;for(const M of T.features){const z=M.instancedDataOffset,D=M.instancedDataCount;for(let k=0;k<D;k++){const B=16*(k+z);let W=A.float32[B+0];const Y=W>Vt;W=Y?W-Vt:W;const K=Math.floor(W),ne=A.float32[B+1];let se=!1;for(const he of this.activeReplacements)if(!dm(he,a,Xw.Model,o)&&!(he.min.x>K||K>he.max.x||he.min.y>ne||ne>he.max.y)&&(se=tu(Xu(K,ne,e.canonical,he.footprintTileId.canonical),he.footprint),se))break;A.float32[B]=se?W+Vt:W,p=p||se!==Y}}}return p}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,D5.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,a){const o=this.layers[0],d=o.layout.get("model-id").evaluate(a,{},this.canonical);if(!d)return ur(`modelId is not evaluated for layer ${o.id} and it is not going to get rendered.`),d;(Dx(d,!1)||this.styleDefinedModelURLs[d]!==void 0)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new Kw);const p=this.instancesPerModel[d],x=p.instancedDataArray,T=new Yw(a,x.length);for(const A of i)for(const M of A){if(M.x<0||M.x>=Vt||M.y<0||M.y>=Vt)continue;if(this.lookupDim!==0){const D=(this.lookupDim-1)/Vt,k=this.lookupDim*(M.y*D|0)+M.x*D|0;if(this.lookup){if(this.lookup[k]!==0)continue;this.lookup[k]=1}}this.instanceCount++;const z=x.length;x.resize(z+1),p.instancesEvaluatedElevation.push(0),x.float32[16*z]=M.x,x.float32[16*z+1]=M.y}return T.instancedDataCount=p.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(T),this.evaluate(T,{},p,!1)),d}getModelUris(){return this.modelUris}evaluate(e,i,a,o){const d=this.layers[0],p=e.feature,x=this.canonical,T=e.rotation=d.paint.get("model-rotation").evaluate(p,i,x),A=e.scale=d.paint.get("model-scale").evaluate(p,i,x),M=e.translation=d.paint.get("model-translation").evaluate(p,i,x),z=d.paint.get("model-color").evaluate(p,i,x);z.a=d.paint.get("model-color-mix-intensity").evaluate(p,i,x);const D=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]),this.maxScale=Math.max(Math.max(this.maxScale,A[0]),Math.max(A[1],A[2])),Tb(D,T,A);const k=Math.round(100*z.a)+z.b/1.05;for(let B=0;B<e.instancedDataCount;++B){const W=e.instancedDataOffset+B,Y=16*W,K=a.instancedDataArray.float32;let ne=0;o&&(ne=K[Y+6]-a.instancesEvaluatedElevation[W]);const se=0|K[Y+1];K[Y]=(0|K[Y])+z.r/1.05,K[Y+1]=se+z.g/1.05,K[Y+2]=k,K[Y+3]=1/(x.z>10?this.tileToMeter:Ze(x,se)),K[Y+4]=M[0],K[Y+5]=M[1],K[Y+6]=M[2]+ne,K[Y+7]=D[0],K[Y+8]=D[1],K[Y+9]=D[2],K[Y+10]=D[4],K[Y+11]=D[5],K[Y+12]=D[6],K[Y+13]=D[8],K[Y+14]=D[9],K[Y+15]=D[10],a.instancesEvaluatedElevation[W]=M[2]}}}let Jw,Qw;si(Px,"ModelBucket",{omit:["layers"]}),si(Kw,"PerModelAttributes"),si(Yw,"ModelFeature");class Rg{constructor(e,i,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(e,i,a){const o=a||e.findDEMTileFor(i);if(!o||!o.dem)return;const d=o.dem,p=o.tileID,x=1<<i.canonical.z-p.canonical.z;return new Rg(o,d.dim/Vt/x,[(i.canonical.x/x-p.canonical.x)*d.dim,(i.canonical.y/x-p.canonical.y)*d.dim])}tileCoordToPixel(e,i){const a=i*this._scale+this._offset[1];return new Ct(Math.floor(e*this._scale+this._offset[0]),Math.floor(a))}getElevationAt(e,i,a,o){const d=e*this._scale+this._offset[0],p=i*this._scale+this._offset[1],x=Math.floor(d),T=Math.floor(p),A=this._dem;return o=!!o,a?Li(Li(A.get(x,T,o),A.get(x,T+1,o),p-T),Li(A.get(x+1,T,o),A.get(x+1,T+1,o),p-T),d-x):A.get(x,T,o)}getElevationAtPixel(e,i,a){return this._dem.get(e,i,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*we(1,e)*this._dem.stride}}const Ox=new Float32Array(262144),bm=new Uint8Array(262144);function e3(r){let e=0;if(r.meshes)for(const i of r.meshes)e=Math.max(e,i.aabb.max[2]);if(r.children)for(const i of r.children)e=Math.max(e,e3(i));return e}function t3(r,e,i){if(r.meshes)for(const a of r.meshes){if(a.aabb.min[0]===1/0)continue;const o=Di.applyTransform(a.aabb,r.matrix);i.insert(e,o.min[0],o.min[1],o.max[0],o.max[1])}if(r.children)for(const a of r.children)t3(a,e,i)}const i3=["","wall","door","roof","window","lamp","logo"];class r3{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:e3(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Di([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Di([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=Di.applyTransformFast(a.aabb,this.node.matrix),i.encapsulate(a.transformedAabb)),e++;this.aabb=i}return this.aabb}}class vy{constructor(e,i,a,o,d,p,x,T){this.id=a,this.layers=e,this.layerIds=this.layers.map(A=>A.fqid),this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id),this.modelTraits|=wg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,o&&(this.modelTraits|=wg.HasMapboxMeshFeatures),d&&(this.modelTraits|=wg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.worldview=T,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const A of i)this.nodesInfo.push(new r3(A)),t3(A,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const a of this.getNodesInfo()){const o=a.node;o.footprint&&i.push({footprint:o.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const a=i?this.stateDependentLayers:this.layers;if(!Hs(e,this.states))for(const o of a)this.evaluate(o,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const a of i){const o=a.node;this.uploaded?this.updatePbrBuffer(o):lx(o,e,!0)}for(const a of i)Q0(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),i=!0);return i}needsReEvaluation(e,i,a){const o=e.transform.projectionOptions,d=e.style.getBrightness(),p=this.brightness!==d;if(!this.uploaded||this.dirty||o.name!==this.projection.name||k_(a.paint.get("model-color").value,p)||k_(a.paint.get("model-color-mix-intensity").value,p)||k_(a.paint.get("model-roughness").value,p)||k_(a.paint.get("model-emissive-strength").value,p)||k_(a.paint.get("model-height-based-emissive-strength-multiplier").value,p)){this.projection=o,this.brightness=d;const x=this.getNodesInfo();for(const T of x)T.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),o=this.id.canonical;for(const d of a){const p=d.feature;d.evaluatedTranslation=i.paint.get("model-translation").evaluate(p,{},o),d.evaluatedScale=i.paint.get("model-scale").evaluate(p,{},o)}}evaluate(e,i){const a=this.getNodesInfo();for(const o of a){if(!o.node.meshes)continue;const d=o.feature,p=i&&i[d.id];if(Hs(p,o.state))continue;o.state=structuredClone(p);const x=o.node.meshes&&o.node.meshes[0].featureData,T=o.evaluatedColor[2],A=o.evaluatedRMEA[2],M=this.id.canonical;if(o.hasTranslucentParts=!1,x){for(let z=0;z<i3.length;z++){const D=i3[z];D.length&&(d.properties.part=D);const k=e.paint.get("model-color").evaluate(d,p,M).toPremultipliedRenderColor(null),B=e.paint.get("model-color-mix-intensity").evaluate(d,p,M);o.evaluatedColor[z]=[k.r,k.g,k.b,B],o.evaluatedRMEA[z][0]=e.paint.get("model-roughness").evaluate(d,p,M),o.evaluatedRMEA[z][2]=e.paint.get("model-emissive-strength").evaluate(d,p,M),o.evaluatedRMEA[z][3]=k.a,o.emissionHeightBasedParams[z]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(d,p,M),!o.hasTranslucentParts&&k.a<1&&(o.hasTranslucentParts=!0)}delete d.properties.part,oA(o,T!==o.evaluatedColor[2]||A!==o.evaluatedRMEA[2],this.modelTraits)}else o.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(d,p,M);o.evaluatedTranslation=e.paint.get("model-translation").evaluate(d,p,M),o.evaluatedScale=e.paint.get("model-scale").evaluate(d,p,M),this.updatePbrBuffer(o.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,a,o){const d=e.findDEMTileFor(a);if(d&&(d.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;const p=Rg.create(e,a,d);if(!p)return;this.modelTraits&wg.HasMapboxMeshFeatures&&this.updateDEM(e,p,a,o);for(const x of this.getNodesInfo()){const T=x.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const A=T.footprint.vertices;let M=p.getElevationAt(A[0].x,A[0].y,!0,!0);for(let z=1;z<A.length;z++)M=Math.min(M,p.getElevationAt(A[z].x,A[z].y,!0,!0));T.elevation=M}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,a,o){let d=i._dem._modifiedForSources[o];if(d===void 0&&(i._dem._modifiedForSources[o]=[],d=i._dem._modifiedForSources[o]),d.includes(a.canonical))return;const p=i._dem.dim;d.push(a.canonical);let x=!1;for(const T of this.getNodesInfo()){const A=T.node;if(!A.footprint||!A.footprint.grid)continue;const M=A.footprint.grid,z=i.tileCoordToPixel(M.min.x,M.min.y),D=i.tileCoordToPixel(M.max.x,M.max.y),k=Math.min(Math.min(p-D.y,z.x),Math.min(z.y,p-D.x));if(k<0)continue;const B=Ie(k,2,5);let W=Math.max(0,z.x-B),Y=Math.max(0,z.y-B),K=Math.min(D.x+B,p-1),ne=Math.min(D.y+B,p-1);for(let Me=Y;Me<=ne;++Me)for(let Ne=W;Ne<=K;++Ne)bm[Me*p+Ne]=255;let se=0,he=0;for(let Me=0;Me<M.cellsY;++Me)for(let Ne=0;Ne<M.cellsX;++Ne){if(!M.cells[Me*M.cellsX+Ne])continue;const Fe=i.tileCoordToPixel(M.min.x+Ne/M.xScale,M.min.y+Me/M.yScale),Ue=i.tileCoordToPixel(M.min.x+(Ne+1)/M.xScale,M.min.y+(Me+1)/M.yScale);for(let ft=Fe.y;ft<=Math.min(Ue.y+1,p-1);++ft)for(let $e=Fe.x;$e<=Math.min(Ue.x+1,p-1);++$e)bm[ft*p+$e]===255&&(bm[ft*p+$e]=0,se+=i.getElevationAtPixel($e,ft),he++)}const Re=se/he;W=Math.max(1,z.x-B),Y=Math.max(1,z.y-B),K=Math.min(D.x+B,p-2),ne=Math.min(D.y+B,p-2),x=!0;for(let Me=Y;Me<=ne;++Me)for(let Ne=W;Ne<=K;++Ne)bm[Me*p+Ne]===0&&(Ox[Me*p+Ne]=i._dem.set(Ne,Me,Re));for(let Me=1;Me<B;++Me){W=Math.max(1,z.x-Me),Y=Math.max(1,z.y-Me),K=Math.min(D.x+Me,p-2),ne=Math.min(D.y+Me,p-2);for(let Ne=Y;Ne<=ne;++Ne)for(let Fe=W;Fe<=K;++Fe){const Ue=Ne*p+Fe;if(bm[Ue]===255){let ft=0,$e=0,yt=-1,It=-1;for(let bt=-1;bt<=1;++bt)for(let Et=-1;Et<=1;++Et){const jt=(Ne+bt)*p+Fe+Et;if(bm[jt]>=Me)continue;const ht=Ox[jt],At=Math.abs(ht);At>$e&&(ft=ht,$e=At,yt=Et,It=bt)}if($e>.1){const bt=1-(Me+.5*Math.abs(yt*It))/B;let Et=i._dem.get(Fe,Ne)+ft*bt;const jt=i._dem.get(Fe+yt,Ne+It),ht=i._dem.get(Fe-yt,Ne-It,!0);(Et-jt)*(Et-ht)>0&&(Et=(jt+ht)/2),Ox[Ue]=i._dem.set(Fe,Ne,Et),bm[Ue]=Me}}}}}x&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=xo.now())}setFilter(e){this.filter=e?Oh(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new on(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)Q0(i.node),cx(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped());for(const o of this.getNodesInfo()){const d=o.node.footprint;o.hiddenByReplacement=!!d&&!a.find(p=>p.footprint===d)}}getHeightAtTileCoord(e,i){const a=[],o=[0,0,0],d=Se([]);for(const p of this.getNodesInfo()){const x=p.node.meshes[0],T=x.transformedAabb;if(e<T.min[0]||i<T.min[1]||e>T.max[0]||i>T.max[1])continue;if(p.node.hidden===!0)return{height:1/0,maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};ee(d,p.node.matrix),o[0]=e,o[1]=i,Tt(o,o,d);const A=(o[0]-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*_m|0,M=Math.min(63,(o[1]-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*_m|0)*_m+Math.min(63,A),z=x.heightmap[M];if(!(z<0&&p.node.footprint))return p.hiddenByReplacement?void 0:{height:z,maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};if(p.node.footprint.grid.query(new Ct(e,i),new Ct(e,i),a),a.length>0)return{height:void 0,maxHeight:p.feature.properties.height,hidden:p.hiddenByReplacement,verticalScale:p.evaluatedScale[2]}}}}function k_(r,e){return r instanceof zu&&!r.isLightConstant&&e}function aA(r,e,i,a,o,d,p,x){let T=(61440&e|(61440&e)>>4)>>8,A=(3840&e|(3840&e)>>4)>>4,M=240&e|(240&e)>>4;i[3]>0&&(T=Li(T,255*i[0],i[3]),A=Li(A,255*i[1],i[3]),M=Li(M,255*i[2],i[3]));const z=T<<8|A,D=M<<8|Math.floor(255*a[3]),k=function(Me){const Ne=Ie(Me,0,2);return Math.min(Math.round(.5*Ne*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],B=Ie(o[0],0,1),W=Ie(o[1],0,1),Y=Ie(o[2],0,1),K=Ie(o[3],0,1);let ne,se,he,Re;if(B!==W&&p!==d&&W!==B){const Me=p-d;se=1/(Me*(W-B)),he=-(d+Me*B)/(Me*(W-B));const Ne=Ie(o[4],-1,1);Re=Math.pow(10,Ne),ne=255*Y<<8|255*K}else ne=65535,se=0,he=1,Re=1;if(r.emplaceBack(z,D,k,ne,se,he,Re),x){const Me=x.length;x.clear();for(let Ne=0;Ne<Me;Ne++)x.emplaceBack(z,D,k,ne,se,he,Re)}}function oA(r,e,i){const a=r.node;let o=0;const d=i&wg.HasMeshoptCompression;for(const p of a.meshes){if(a.lights&&a.lightMeshIndex===o||!p.featureData)continue;p.featureArray=new uc,p.featureArray.reserve(p.featureData.length);let x=e;for(const T of p.featureData){const A=d?65535&T:T>>16&65535,M=d?T>>16&65535:65535&T,z=(15&M)<8?15&M:0,D=r.evaluatedRMEA[z],k=r.evaluatedColor[z],B=r.emissionHeightBasedParams[z];let W;if(x&&z===2&&a.lights&&(W=new uc,W.resize(10*a.lights.length)),aA(p.featureArray,A,k,D,B,p.aabb.min[2],p.aabb.max[2],W),W&&x){x=!1;const Y=a.meshes[a.lightMeshIndex];Y.featureArray=W,Y.featureArray._trim()}}p.featureArray._trim(),o++}}function n3(r,e,i,a){const o=1<<r.z;e.lat=ve((a/Vt+r.y)/o),e.lng=Ee((i/Vt+r.x)/o)}function lA(r,e,i,a){const o=r.getNodesInfo()[e];if(!o||o.hiddenByReplacement||!o.node.meshes)return;let d=Number.MAX_VALUE;const p=o.node,x=i.tile,T=a.calculatePosMatrix(x.tileID.toUnwrapped(),a.worldSize),A=o.evaluatedScale;let M=0;a.elevation&&p.elevation&&(M=p.elevation*a.elevation.exaggeration()),ye(T,T,[(p.anchor?p.anchor[0]:0)*(A[0]-1),(p.anchor?p.anchor[1]:0)*(A[1]-1),M]),xe(T,T,A);const z=i.queryGeometry,D=z.isPointQuery()?z.screenBounds:z.screenGeometry,k=function(W){const Y=_e([],T,W.matrix);_e(Y,a.expandedFarZProjMatrix,Y);for(let K=0;K<W.meshes.length;++K){const ne=W.meshes[K];if(K===W.lightMeshIndex)continue;const se=Sb(D,a,Y,ne.aabb);se!=null&&(d=Math.min(se,d))}if(W.children)for(const K of W.children)k(K)};if(k(p),d===Number.MAX_VALUE)return;const B=new G(0,0);return n3(x.tileID.canonical,B,o.node.anchor[0],o.node.anchor[1]),{intersectionZ:d,position:B,feature:o.feature}}si(vy,"Tiled3dModelBucket",{omit:["layers"]}),si(r3,"Tiled3dModelFeature");const cA={circle:class extends fa{constructor(r,e,i,a){super(r,{layout:Zh||(Zh=new On({"circle-sort-key":new Yt(qe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Nt(qe.layout_circle["circle-elevation-reference"]),visibility:new Nt(qe.layout_circle.visibility)})),paint:Rl||(Rl=new On({"circle-radius":new Yt(qe.paint_circle["circle-radius"]),"circle-color":new Yt(qe.paint_circle["circle-color"]),"circle-blur":new Yt(qe.paint_circle["circle-blur"]),"circle-opacity":new Yt(qe.paint_circle["circle-opacity"]),"circle-translate":new Nt(qe.paint_circle["circle-translate"]),"circle-translate-anchor":new Nt(qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Nt(qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Nt(qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Yt(qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Yt(qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Yt(qe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Nt(qe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}createBucket(r){return new ws(r)}queryRadius(r){const e=r;return Ca("circle-radius",this,e)+Ca("circle-stroke-width",this,e)+il(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,a,o,d,p,x){const T=rl(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return n_(r,a,d,p,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,A)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,i){const a=rg(this);return{config:new Qc(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}is3D(r){return!r&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends fa{createBucket(r){return new a_(r)}constructor(r,e,i,a){super(r,{layout:S0||(S0=new On({visibility:new Nt(qe.layout_heatmap.visibility)})),paint:E0||(E0=new On({"heatmap-radius":new Yt(qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Yt(qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Nt(qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Dh(qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Nt(qe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Yd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(r){return Ca("heatmap-radius",this,r)}queryIntersectsFeature(r,e,i,a,o,d,p,x){const T=this.paint.get("heatmap-radius").evaluate(e,i);return n_(r,a,d,p,x,!0,!0,new Ct(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,i){return r==="heatmap"?{config:new Qc(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends fa{constructor(r,e,i,a){super(r,{layout:o_||(o_=new On({visibility:new Nt(qe.layout_hillshade.visibility)})),paint:l_||(l_=new On({"hillshade-illumination-direction":new Nt(qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Nt(qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Nt(qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Nt(qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Nt(qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Nt(qe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Nt(qe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}},fill:class extends fa{constructor(r,e,i,a){super(r,{layout:rp||(rp=new On({"fill-sort-key":new Yt(qe.layout_fill["fill-sort-key"]),visibility:new Nt(qe.layout_fill.visibility),"fill-elevation-reference":new Nt(qe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Yt(qe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:j0||(j0=new On({"fill-antialias":new Nt(qe.paint_fill["fill-antialias"]),"fill-opacity":new Yt(qe.paint_fill["fill-opacity"]),"fill-color":new Yt(qe.paint_fill["fill-color"]),"fill-outline-color":new Yt(qe.paint_fill["fill-outline-color"]),"fill-translate":new Nt(qe.paint_fill["fill-translate"]),"fill-translate-anchor":new Nt(qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Yt(qe.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Nt(qe.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Nt(qe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Yt(qe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Yt(qe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Yt(qe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(r,e,i){return{config:new Qc(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new hg(r)}queryRadius(){return il(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,a,o,d){return!r.queryGeometry.isAboveHorizon&&Ts(pc(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),a)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(r){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return r!=null?e&&!r:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends fa{constructor(r,e,i,a){super(r,{layout:ai||(ai=new On({visibility:new Nt(qe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Nt(qe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:xi||(xi=new On({"fill-extrusion-opacity":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Yt(qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Yt(qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Yt(qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Yt(qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Yt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Yt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Yt(qe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Yt(qe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Nt(qe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new ef(r)}queryRadius(){return il(this.paint.get("fill-extrusion-translate"))}is3D(r){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,i,a,o,d,p,x,T){const A=rl(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,i),z=this.paint.get("fill-extrusion-base").evaluate(e,i),D=[0,0],k=x&&d.elevation,B=d.elevation?d.elevation.exaggeration():1,W=r.tile.getBucket(this);if(k&&W instanceof ef){const he=W.centroidVertexArray,Re=T+1;Re<he.length&&(D[0]=he.geta_centroid_pos0(Re),D[1]=he.geta_centroid_pos1(Re))}if(D[0]===0&&D[1]===1)return!1;d.projection.name==="globe"&&(a=Xe([a],[new Ct(0,0),new Ct(Vt,Vt)],r.tileID.canonical).map(he=>he.polygon).flat());const Y=k?x:null,[K,ne]=function(he,Re,Me,Ne,Fe,Ue,ft,$e,yt,It,bt){return he.projection.name==="globe"?function(Et,jt,ht,At,at,et,kt,Ot,bi,oi,fi){const qt=[],vi=[],Gi=Et.projection.upVectorScale(fi,Et.center.lat,Et.worldSize).metersToTile,Xt=[0,0,0,1],mi=[0,0,0,1],Ni=(dr,rr,hi,tr)=>{dr[0]=rr,dr[1]=hi,dr[2]=tr,dr[3]=1},Qi=De();ht>0&&(ht+=Qi),At+=Qi;for(const dr of jt){const rr=[],hi=[];for(const tr of dr){const Dr=tr.x+at.x,pe=tr.y+at.y,ge=Et.projection.projectTilePoint(Dr,pe,fi),st=Et.projection.upVector(fi,tr.x,tr.y);let dt=ht,Wt=At;if(kt){const Zt=hr(Dr,pe,ht,At,kt,Ot,bi,oi);dt+=Zt.base,Wt+=Zt.top}ht!==0?Ni(Xt,ge.x+st[0]*Gi*dt,ge.y+st[1]*Gi*dt,ge.z+st[2]*Gi*dt):Ni(Xt,ge.x,ge.y,ge.z),Ni(mi,ge.x+st[0]*Gi*Wt,ge.y+st[1]*Gi*Wt,ge.z+st[2]*Gi*Wt),Tt(Xt,Xt,et),Tt(mi,mi,et),rr.push(new Ut(Xt[0],Xt[1],Xt[2])),hi.push(new Ut(mi[0],mi[1],mi[2]))}qt.push(rr),vi.push(hi)}return[qt,vi]}(he,Re,Me,Ne,Fe,Ue,ft,$e,yt,It,bt):ft?function(Et,jt,ht,At,at,et,kt,Ot,bi){const oi=[],fi=[],qt=[0,0,0,1];for(const vi of Et){const Gi=[],Xt=[];for(const mi of vi){const Ni=mi.x+At.x,Qi=mi.y+At.y,dr=hr(Ni,Qi,jt,ht,et,kt,Ot,bi);qt[0]=Ni,qt[1]=Qi,qt[2]=dr.base,qt[3]=1,Rs(qt,qt,at),qt[3]=Math.max(qt[3],1e-5);const rr=new Ut(qt[0]/qt[3],qt[1]/qt[3],qt[2]/qt[3]);qt[0]=Ni,qt[1]=Qi,qt[2]=dr.top,qt[3]=1,Rs(qt,qt,at),qt[3]=Math.max(qt[3],1e-5);const hi=new Ut(qt[0]/qt[3],qt[1]/qt[3],qt[2]/qt[3]);Gi.push(rr),Xt.push(hi)}oi.push(Gi),fi.push(Xt)}return[oi,fi]}(Re,Me,Ne,Fe,Ue,ft,$e,yt,It):function(Et,jt,ht,At,at){const et=[],kt=[],Ot=at[8]*jt,bi=at[9]*jt,oi=at[10]*jt,fi=at[11]*jt,qt=at[8]*ht,vi=at[9]*ht,Gi=at[10]*ht,Xt=at[11]*ht;for(const mi of Et){const Ni=[],Qi=[];for(const dr of mi){const rr=dr.x+At.x,hi=dr.y+At.y,tr=at[0]*rr+at[4]*hi+at[12],Dr=at[1]*rr+at[5]*hi+at[13],pe=at[2]*rr+at[6]*hi+at[14],ge=at[3]*rr+at[7]*hi+at[15],st=tr+Ot,dt=Dr+bi,Wt=pe+oi,Zt=Math.max(ge+fi,1e-5),ui=tr+qt,Ei=Dr+vi,fr=pe+Gi,gr=Math.max(ge+Xt,1e-5);Ni.push(new Ut(st/Zt,dt/Zt,Wt/Zt)),Qi.push(new Ut(ui/gr,Ei/gr,fr/gr))}et.push(Ni),kt.push(Qi)}return[et,kt]}(Re,Me,Ne,Fe,Ue)}(d,a,z,M,A,p,Y,D,B,d.center.lat,r.tileID.canonical),se=r.queryGeometry;return function(he,Re,Me){let Ne=1/0;Ts(Me,Re)&&(Ne=di(Me,Re[0]));for(let Fe=0;Fe<Re.length;Fe++){const Ue=Re[Fe],ft=he[Fe];for(let $e=0;$e<Ue.length-1;$e++){const yt=Ue[$e],It=[yt,Ue[$e+1],ft[$e+1],ft[$e],yt];Ja(Me,It)&&(Ne=Math.min(Ne,di(Me,It)))}}return Ne!==1/0&&Ne}(K,ne,se.isPointQuery()?se.screenBounds:se.screenGeometry)}},building:class extends fa{constructor(r,e,i,a){super(r,{layout:Pb||(Pb=new On({visibility:new Nt(qe.layout_building.visibility),"building-facade":new Yt(qe.layout_building["building-facade"]),"building-facade-floors":new Yt(qe.layout_building["building-facade-floors"]),"building-facade-unit-width":new Yt(qe.layout_building["building-facade-unit-width"]),"building-facade-window":new Yt(qe.layout_building["building-facade-window"]),"building-roof-shape":new Yt(qe.layout_building["building-roof-shape"]),"building-height":new Yt(qe.layout_building["building-height"]),"building-base":new Yt(qe.layout_building["building-base"]),"building-flood-light-wall-radius":new Yt(qe.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Yt(qe.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Yt(qe.layout_building["building-flip-roof-orientation"])})),paint:Ob||(Ob=new On({"building-opacity":new Nt(qe.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Nt(qe.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Nt(qe.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Nt(qe.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Nt(qe.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Nt(qe.paint_building["building-vertical-scale"]),"building-cast-shadows":new Nt(qe.paint_building["building-cast-shadows"]),"building-color":new Yt(qe.paint_building["building-color"]),"building-emissive-strength":new Yt(qe.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Nt(qe.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Nt(qe.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Nt(qe.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Nt(qe.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Nt(qe.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new Db(r)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(r){return!0}},line:class extends fa{constructor(r,e,i,a){const o=Gb();super(r,o,e,i,a),o.layout&&(this.layout=new Zc(o.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Jl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(C_)return C_;const i=Gb();return C_=new aE(i.paint.properties["line-width"].specification),C_.useIntegerZoom=!0,C_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new fx(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,i){const a=Hb(this);return{config:new Qc(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}queryRadius(r){const e=r,i=$b(Ca("line-width",this,e),Ca("line-gap-width",this,e)),a=Ca("line-offset",this,e);return i/2+Math.abs(a)+il(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,a,o,d){if(r.queryGeometry.isAboveHorizon)return!1;const p=pc(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),x=r.pixelToTileUnitsFactor/2*$b(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),T=this.paint.get("line-offset").evaluate(e,i);return T&&(a=function(A,M){const z=[],D=new Ct(0,0);for(let k=0;k<A.length;k++){const B=A[k],W=[];for(let Y=0;Y<B.length;Y++){const K=B[Y],ne=B[Y+1],se=Y===0?D:K.sub(B[Y-1])._unit()._perp(),he=Y===B.length-1?D:ne.sub(K)._unit()._perp(),Re=se._add(he)._unit();Re._mult(1/(Re.x*he.x+Re.y*he.y)),W.push(Re._mult(M)._add(K))}z.push(W)}return z}(a,T*r.pixelToTileUnitsFactor)),function(A,M,z){for(let D=0;D<M.length;D++){const k=M[D];if(A.length>=3){for(let B=0;B<k.length;B++)if(Ss(A,k[B]))return!0}if(ga(A,k,z))return!0}return!1}(p,a,x)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(r){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:gy,background:class extends fa{constructor(r,e,i,a){super(r,{layout:jw||(jw=new On({visibility:new Nt(qe.layout_background.visibility)})),paint:Nw||(Nw=new On({"background-pitch-alignment":new Nt(qe.paint_background["background-pitch-alignment"]),"background-color":new Nt(qe.paint_background["background-color"]),"background-pattern":new Nt(qe.paint_background["background-pattern"]),"background-opacity":new Nt(qe.paint_background["background-opacity"]),"background-emissive-strength":new Nt(qe.paint_background["background-emissive-strength"]),"background-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}is3D(r){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Vw,"raster-particle":Ww,sky:class extends fa{constructor(r,e,i,a){super(r,{layout:Gw||(Gw=new On({visibility:new Nt(qe.layout_sky.visibility)})),paint:$w||($w=new On({"sky-type":new Nt(qe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Nt(qe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Nt(qe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Nt(qe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Nt(qe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Dh(qe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Nt(qe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Nt(qe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Nt(qe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Yd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),o=!a,d=r.style.light,p=d.properties.get("position");return o&&d.properties.get("anchor")==="viewport"&&ur("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),o?Lx(p.azimuthal,90-p.polar,e):Lx(a[0],90-a[1],e)}const i=this.paint.get("sky-gradient-center");return Lx(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends fa{constructor(r,e,i,a){super(r,{paint:Zw||(Zw=new On({}))},e,null)}},model:class extends fa{constructor(r,e,i,a){super(r,{layout:Jw||(Jw=new On({visibility:new Nt(qe.layout_model.visibility),"model-id":new Yt(qe.layout_model["model-id"])})),paint:Qw||(Qw=new On({"model-opacity":new Yt(qe.paint_model["model-opacity"]),"model-rotation":new Yt(qe.paint_model["model-rotation"]),"model-scale":new Yt(qe.paint_model["model-scale"]),"model-translation":new Yt(qe.paint_model["model-translation"]),"model-color":new Yt(qe.paint_model["model-color"]),"model-color-mix-intensity":new Yt(qe.paint_model["model-color-mix-intensity"]),"model-type":new Nt(qe.paint_model["model-type"]),"model-cast-shadows":new Nt(qe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Nt(qe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Nt(qe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Yt(qe.paint_model["model-emissive-strength"]),"model-roughness":new Yt(qe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Yt(qe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Nt(qe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Nt(qe.paint_model["model-front-cutoff"]),"model-elevation-reference":new Nt(qe.paint_model["model-elevation-reference"]),"model-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new Px(r)}getProgramIds(){return["model"]}is3D(r){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof vy?Vt-1:0}queryIntersectsFeature(r,e,i,a,o,d){if(!this.modelManager)return!1;const p=this.modelManager,x=r.tile.getBucket(this);if(!(x&&x instanceof Px))return!1;for(const T in x.instancesPerModel){const A=x.instancesPerModel[T],M=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(A.idToFeaturesIndex.hasOwnProperty(M)){const z=A.features[A.idToFeaturesIndex[M]],D=p.getModel(T,this.scope);if(!D)return!1;let k=le();const B=new G(0,0),W=x.canonical;let Y=Number.MAX_VALUE;for(let K=0;K<z.instancedDataCount;++K){const ne=16*(z.instancedDataOffset+K),se=A.instancedDataArray.float32,he=[se[ne+4],se[ne+5],se[ne+6]];n3(W,B,se[ne],0|se[ne+1]),Eb(k,D,d,B,z.rotation,z.scale,he,!1,!1,!1),d.projection.name==="globe"&&(k=ox(k,d));const Re=_e([],d.projMatrix,k),Me=r.queryGeometry,Ne=Sb(Me.isPointQuery()?Me.screenBounds:Me.screenGeometry,d,Re,D.aabb);Ne!=null&&(Y=Math.min(Ne,Y))}return Y!==Number.MAX_VALUE&&Y}}return!1}_handleOverridablePaintPropertyUpdate(r,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof xl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends fa{constructor(r,e,i,a){super(r,{layout:N0||(N0=new On({"clip-layer-types":new Nt(qe.layout_clip["clip-layer-types"]),"clip-layer-scope":new Nt(qe.layout_clip["clip-layer-scope"])})),paint:k0||(k0=new On({}))},e,i,a)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new dg(r)}is3D(r){return!0}}},jx=new $r(0,0,0),Nx={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},kx={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},by={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},uA={PAINT_ORDER_FILL_AND_STROKE:1},B_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},s3={MASK_TYPE_LUMINANCE:1};function hA(r,e,i){r===1&&e.icons.push(function(a,o){return function(d){if(d.usvg_tree.height||(d.usvg_tree.height=d.usvg_tree.width),!d.metadata)return d;const{metadata:p}=d;if(p.content_area){const{content_area:x}=p;x.left==null&&(x.left=0),x.top==null&&(x.top=x.left),x.width==null&&(x.width=d.usvg_tree.width),x.height==null&&(x.height=x.width)}if(p.text_placeholder){const{text_placeholder:x}=p;x.top==null&&(x.top=x.left),x.height==null&&(x.height=x.width)}return p.stretch_x&&p.stretch_x.length&&a3(p,"x"),p.stretch_y&&p.stretch_y.length&&a3(p,"y"),d}(a.readFields(dA,{name:void 0},o))}(i,i.readVarint()+i.pos))}function a3(r,e){const i=[],a=r[`stretch_${e}`];let o=null;for(let d=0;d<a.length;d++)o===null?o=i.length===0?a[0]:i[i.length-1][1]+a[d]:(i.push([o,o+a[d]]),o=null);r[`stretch_${e}_areas`]=i}function dA(r,e,i){r===1?e.name=i.readString():r===2?e.metadata=function(a,o){return a.readFields(fA,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},o)}(i,i.readVarint()+i.pos):r===3&&(e.usvg_tree=function(a,o){return a.readFields(gA,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},o)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function fA(r,e,i){r===1?e.stretch_x=i.readPackedVarint():r===2?e.stretch_y=i.readPackedVarint():r===3?e.content_area=o3(i,i.readVarint()+i.pos):r===4?e.variables.push(function(a,o){return a.readFields(mA,{name:void 0},o)}(i,i.readVarint()+i.pos)):r===5&&(e.text_placeholder=o3(i,i.readVarint()+i.pos))}function o3(r,e){return r.readFields(pA,{},e)}function pA(r,e,i){r===1?e.left=i.readVarint():r===2?e.width=i.readVarint():r===3?e.top=i.readVarint():r===4&&(e.height=i.readVarint())}function mA(r,e,i){r===1?e.name=i.readString():r===2&&(e.rgb_color=Sy(i.readVarint()),e.value="rgb_color")}function gA(r,e,i){r===1?e.width=e.height=i.readVarint():r===2?e.height=i.readVarint():r===3?e.children.push(wy(i,i.readVarint()+i.pos)):r===4?e.linear_gradients.push(function(a,o){return a.readFields(TA,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},o)}(i,i.readVarint()+i.pos)):r===5?e.radial_gradients.push(function(a,o){return a.readFields(EA,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},o)}(i,i.readVarint()+i.pos)):r===7?e.clip_paths.push(function(a,o){return a.readFields(AA,{children:[]},o)}(i,i.readVarint()+i.pos)):r===8&&e.masks.push(function(a,o){const d=a.readFields(CA,{left:0,width:20,mask_type:s3.MASK_TYPE_LUMINANCE,children:[]},o);return d.height==null&&(d.height=d.width),d.top==null&&(d.top=d.left),d}(i,i.readVarint()+i.pos))}function wy(r,e){return r.readFields(_A,{},e)}function _A(r,e,i){r===1?(e.group=function(a,o){return a.readFields(yA,{opacity:255,children:[]},o)}(i,i.readVarint()+i.pos),e.node="group"):r===2&&(e.path=function(a,o){return a.readFields(vA,{paint_order:1,commands:[],step:1,diffs:[],rule:Nx.PATH_RULE_NON_ZERO},o)}(i,i.readVarint()+i.pos),e.node="path")}function yA(r,e,i){r===1?e.transform=Ty(i,i.readVarint()+i.pos):r===2?e.opacity=i.readVarint():r===5?e.clip_path_idx=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(wy(i,i.readVarint()+i.pos))}function Ty(r,e){return r.readFields(xA,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function xA(r,e,i){r===1?e.sx=i.readFloat():r===2?e.ky=i.readFloat():r===3?e.kx=i.readFloat():r===4?e.sy=i.readFloat():r===5?e.tx=i.readFloat():r===6&&(e.ty=i.readFloat())}function vA(r,e,i){r===1?e.fill=function(a,o){return a.readFields(bA,{rgb_color:jx,paint:"rgb_color",opacity:255},o)}(i,i.readVarint()+i.pos):r===2?e.stroke=function(a,o){return a.readFields(wA,{rgb_color:jx,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},o)}(i,i.readVarint()+i.pos):r===3?e.paint_order=i.readVarint():r===5?i.readPackedVarint(e.commands):r===6?e.step=i.readFloat():r===7?i.readPackedSVarint(e.diffs):r===8&&(e.rule=i.readVarint())}function bA(r,e,i){r===1?(e.rgb_color=Sy(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5&&(e.opacity=i.readVarint())}function Sy(r){return new $r((r>>16&255)/255,(r>>8&255)/255,(255&r)/255,1)}function wA(r,e,i){r===1?(e.rgb_color=Sy(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5?i.readPackedFloat(e.dasharray):r===6?e.dashoffset=i.readFloat():r===7?e.miterlimit=i.readFloat():r===8?e.opacity=i.readVarint():r===9?e.width=i.readFloat():r===10?e.linecap=i.readVarint():r===11&&(e.linejoin=i.readVarint())}function TA(r,e,i){r===1?e.transform=Ty(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(l3(i,i.readVarint()+i.pos)):r===4?e.x1=i.readFloat():r===5?e.y1=i.readFloat():r===6?e.x2=i.readFloat():r===7&&(e.y2=i.readFloat())}function l3(r,e){return r.readFields(SA,{offset:0,opacity:255,rgb_color:jx},e)}function SA(r,e,i){r===1?e.offset=i.readFloat():r===2?e.opacity=i.readVarint():r===3&&(e.rgb_color=Sy(i.readVarint()))}function EA(r,e,i){r===1?e.transform=Ty(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(l3(i,i.readVarint()+i.pos)):r===4?e.cx=i.readFloat():r===5?e.cy=i.readFloat():r===6?e.r=i.readFloat():r===7?e.fx=i.readFloat():r===8?e.fy=i.readFloat():r===9&&(e.fr=i.readFloat())}function AA(r,e,i){r===1?e.transform=Ty(i,i.readVarint()+i.pos):r===2?e.clip_path_idx=i.readVarint():r===3&&e.children.push(wy(i,i.readVarint()+i.pos))}function CA(r,e,i){r===1?e.left=e.top=i.readFloat():r===2?e.width=e.height=i.readFloat():r===3?e.top=i.readFloat():r===4?e.height=i.readFloat():r===5?e.mask_type=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(wy(i,i.readVarint()+i.pos))}class RA{static calculate(e={},i=[]){const a=new Map,o=new Map;if(Object.keys(e).length===0)return a;i.forEach(d=>{o.set(d.name,d.rgb_color||new $r(0,0,0))});for(const[d,p]of Object.entries(e))o.has(d)?a.set(o.get(d).toString(),p):console.warn(`Ignoring unknown image variable "${d}"`);return a}}function Mg(r,e=255,i){const a=e/255,o=r.toString(),d=i.has(o)?i.get(o).clone():r.clone();return d.a*=a,d.toString()}function F_(r,e){if(!$a()){const i=document.createElement("canvas");return i.width=r,i.height=e,i}return new OffscreenCanvas(r,e)}function MA(r,e){const i=RA.calculate(e.params,r.metadata?r.metadata.variables:[]),a=r.usvg_tree,o=a.width,d=a.height,p=e.transform?e.transform:new DOMMatrix,x=Math.max(1,Math.round(o*p.a)),T=Math.max(1,Math.round(d*p.d)),A=new DOMMatrix([x/o,0,0,T/d,0,0]),M=F_(x,T).getContext("2d");return Bx(M,A,a,a,i),M.getImageData(0,0,x,T)}function Bx(r,e,i,a,o){for(const d of a.children)c3(r,e,i,d,o)}function c3(r,e,i,a,o){a.group?(r.save(),function(d,p,x,T,A){const M=T.mask_idx!=null?x.masks[T.mask_idx]:null,z=T.clip_path_idx!=null?x.clip_paths[T.clip_path_idx]:null;if(T.transform&&(p=Ig(T.transform).preMultiplySelf(p)),!function(B,W,Y){return B.opacity!==255||W||Y}(T,z!=null,M!=null))return void Bx(d,p,x,T,A);const D=F_(d.canvas.width,d.canvas.height),k=D.getContext("2d");Bx(k,p,x,T,A),z&&g3(k,p,x,z),M&&_3(k,p,x,M,A),d.globalAlpha=T.opacity/255,d.drawImage(D,0,0)}(r,e,i,a.group,o),r.restore()):a.path&&(r.save(),function(d,p,x,T,A){d.setTransform(p),T.paint_order===uA.PAINT_ORDER_FILL_AND_STROKE?(u3(d,x,T,A),d3(d,x,T,A)):(d3(d,x,T,A),u3(d,x,T,A))}(r,e,i,a.path,o),r.restore())}function u3(r,e,i,a){const o=i.fill;if(!o)return;const d=o.opacity/255;switch(r.save(),r.beginPath(),y3(i,r),o.paint){case"rgb_color":r.fillStyle=Mg(o.rgb_color,o.opacity,a);break;case"linear_gradient_idx":{const p=e.linear_gradients[o.linear_gradient_idx];p.transform&&r.setTransform(Ig(p.transform).preMultiplySelf(r.getTransform())),r.fillStyle=f3(r,p,d,a);break}case"radial_gradient_idx":{const p=e.radial_gradients[o.radial_gradient_idx];p.transform&&r.setTransform(Ig(p.transform).preMultiplySelf(r.getTransform())),r.fillStyle=p3(r,p,d,a)}}r.fill(h3(i)),r.restore()}function h3(r){return r.rule===Nx.PATH_RULE_NON_ZERO?"nonzero":r.rule===Nx.PATH_RULE_EVEN_ODD?"evenodd":void 0}function d3(r,e,i,a){const o=i.stroke;if(!o)return;const d=x3(i);r.lineWidth=o.width,r.miterLimit=o.miterlimit,r.setLineDash(o.dasharray),r.lineDashOffset=o.dashoffset;const p=o.opacity/255;switch(o.paint){case"rgb_color":r.strokeStyle=Mg(o.rgb_color,o.opacity,a);break;case"linear_gradient_idx":r.strokeStyle=f3(r,e.linear_gradients[o.linear_gradient_idx],p,a,!0);break;case"radial_gradient_idx":r.strokeStyle=p3(r,e.radial_gradients[o.radial_gradient_idx],p,a,!0)}switch(o.linejoin){case by.LINE_JOIN_MITER_CLIP:case by.LINE_JOIN_MITER:r.lineJoin="miter";break;case by.LINE_JOIN_ROUND:r.lineJoin="round";break;case by.LINE_JOIN_BEVEL:r.lineJoin="bevel"}switch(o.linecap){case kx.LINE_CAP_BUTT:r.lineCap="butt";break;case kx.LINE_CAP_ROUND:r.lineCap="round";break;case kx.LINE_CAP_SQUARE:r.lineCap="square"}r.stroke(d)}function f3(r,e,i,a,o=!1){if(e.stops.length===1){const D=e.stops[0];return Mg(D.rgb_color,D.opacity*i,a)}const{x1:d,y1:p,x2:x,y2:T}=e;let A=new DOMPoint(d,p),M=new DOMPoint(x,T);if(o){const D=Ig(e.transform);A=D.transformPoint(A),M=D.transformPoint(M)}const z=r.createLinearGradient(A.x,A.y,M.x,M.y);for(const D of e.stops)z.addColorStop(D.offset,Mg(D.rgb_color,D.opacity*i,a));return z}function p3(r,e,i,a,o=!1){if(e.stops.length===1){const K=e.stops[0];return Mg(K.rgb_color,K.opacity*i,a)}const d=Ig(e.transform),{fx:p,fy:x,fr:T,cx:A,cy:M,r:z}=e;let D=new DOMPoint(p,x),k=new DOMPoint(A,M),B=T,W=z;if(o){D=d.transformPoint(D),k=d.transformPoint(k);const K=(d.a+d.d)/2;B=T*K,W=e.r*K}const Y=r.createRadialGradient(D.x,D.y,B,k.x,k.y,W);for(const K of e.stops)Y.addColorStop(K.offset,Mg(K.rgb_color,K.opacity*i,a));return Y}function m3(r,e,i,a){const o=a.transform?Ig(a.transform).preMultiplySelf(e):e,d=F_(r.canvas.width,r.canvas.height),p=d.getContext("2d");for(const T of a.children)if(T.group)m3(p,o,i,T.group);else if(T.path){const A=T.path,M=new Path2D;M.addPath(x3(A),o),p.fill(M,h3(A))}const x=a.clip_path_idx!=null?i.clip_paths[a.clip_path_idx]:null;x&&g3(p,o,i,x),r.globalCompositeOperation="source-over",r.drawImage(d,0,0)}function g3(r,e,i,a){const o=F_(r.canvas.width,r.canvas.height);m3(o.getContext("2d"),e,i,a),r.globalCompositeOperation="destination-in",r.drawImage(o,0,0)}function _3(r,e,i,a,o){if(a.children.length===0)return;const d=a.mask_idx!=null?i.masks[a.mask_idx]:null;d&&_3(r,e,i,d,o);const p=r.canvas.width,x=r.canvas.height,T=F_(p,x),A=T.getContext("2d"),M=a.width,z=a.height,D=a.left,k=a.top,B=new Path2D,W=new Path2D;W.rect(D,k,M,z),B.addPath(W,e),A.clip(B);for(const ne of a.children)c3(A,e,i,ne,o);const Y=A.getImageData(0,0,p,x),K=Y.data;if(a.mask_type===s3.MASK_TYPE_LUMINANCE)for(let ne=0;ne<K.length;ne+=4)K[ne+3]=K[ne+3]/255*(.2126*K[ne]+.7152*K[ne+1]+.0722*K[ne+2]);A.putImageData(Y,0,0),r.globalCompositeOperation="destination-in",r.drawImage(T,0,0)}function Ig(r){return r?new DOMMatrix([r.sx,r.ky,r.kx,r.sy,r.tx,r.ty]):new DOMMatrix}function y3(r,e){const i=r.step;let a=r.diffs[0]*i,o=r.diffs[1]*i;e.moveTo(a,o);for(let d=0,p=2;d<r.commands.length;d++)switch(r.commands[d]){case B_.PATH_COMMAND_MOVE:a+=r.diffs[p++]*i,o+=r.diffs[p++]*i,e.moveTo(a,o);break;case B_.PATH_COMMAND_LINE:a+=r.diffs[p++]*i,o+=r.diffs[p++]*i,e.lineTo(a,o);break;case B_.PATH_COMMAND_QUAD:{const x=a+r.diffs[p++]*i,T=o+r.diffs[p++]*i;a=x+r.diffs[p++]*i,o=T+r.diffs[p++]*i,e.quadraticCurveTo(x,T,a,o);break}case B_.PATH_COMMAND_CUBIC:{const x=a+r.diffs[p++]*i,T=o+r.diffs[p++]*i,A=x+r.diffs[p++]*i,M=T+r.diffs[p++]*i;a=A+r.diffs[p++]*i,o=M+r.diffs[p++]*i,e.bezierCurveTo(x,T,A,M,a,o);break}case B_.PATH_COMMAND_CLOSE:e.closePath()}return e}function x3(r){return y3(r,new Path2D)}class Ey{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}si(Ey,"LRUCache");class Fx{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new na(e,e.data)}getFromCache(e,i,a){return this.cacheMap.has(a)||this.cacheMap.set(a,new Ey(150)),this.cacheMap.get(a).get(Pu(e.toString(),i))}setInCache(e,i,a,o){this.cacheDependenciesMap.has(o)||this.cacheDependenciesMap.set(o,new Map),this.cacheMap.has(o)||this.cacheMap.set(o,new Ey(150));const d=this.cacheDependenciesMap.get(o),p=Pu(e.id.toString(),a);d.get(p)||d.set(p,new Set);const x=this.cacheMap.get(o),T=e.toString();d.get(p).add(T),x.put(Pu(e.toString(),a),i)}removeImagesFromCacheByIds(e,i,a=0){if(!this.cacheMap.has(a)||!this.cacheDependenciesMap.has(a))return;const o=this.cacheMap.get(a),d=this.cacheDependenciesMap.get(a);for(const p of e){const x=Pu(p.toString(),i);if(d.has(x)){for(const T of d.get(x))o.delete(T);d.delete(x)}}}rasterize(e,i,a,o,d=MA){const p=this.getFromCache(e,a,o);if(p)return p.clone();const x=d(i.icon,e.options),T=Fx._getImage(x);return this.setInCache(e,T,a,o),T.clone()}}class v3{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const a=this.toIdx(e,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function b3(r,e,i,a){let o=0,d=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(i[p]<r[p]||i[p]>e[p])return null}else{const x=1/a[p];let T=(r[p]-i[p])*x,A=(e[p]-i[p])*x;if(T>A){const M=T;T=A,A=M}if(T>o&&(o=T),A<d&&(d=A),o>d)return null}return o}function w3(r,e,i,a,o,d,p,x,T,A,M){const z=a-r,D=o-e,k=d-i,B=p-r,W=x-e,Y=T-i,K=M[1]*Y-M[2]*W,ne=M[2]*B-M[0]*Y,se=M[0]*W-M[1]*B,he=z*K+D*ne+k*se;if(Math.abs(he)<1e-15)return null;const Re=1/he,Me=A[0]-r,Ne=A[1]-e,Fe=A[2]-i,Ue=(Me*K+Ne*ne+Fe*se)*Re;if(Ue<0||Ue>1)return null;const ft=Ne*k-Fe*D,$e=Fe*z-Me*k,yt=Me*D-Ne*z,It=(M[0]*ft+M[1]*$e+M[2]*yt)*Re;return It<0||Ue+It>1?null:(B*ft+W*$e+Y*yt)*Re}function T3(r,e,i){return(r-e)/(i-e)}function S3(r,e,i,a,o,d,p,x,T){const A=1<<i,M=d-a,z=p-o,D=(r+1)/A*M+a,k=(e+0)/A*z+o,B=(e+1)/A*z+o;x[0]=(r+0)/A*M+a,x[1]=k,T[0]=D,T[1]=B}class E3{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(d){const p=Math.ceil(Math.log2(d.dim/8)),x=[];let T=Math.ceil(Math.pow(2,p));const A=1/T,M=(k,B,W,Y,K)=>{const ne=Y?1:0,se=(k+1)*W-ne,he=B*W,Re=(B+1)*W-ne;K[0]=k*W,K[1]=he,K[2]=se,K[3]=Re};let z=new v3(T);const D=[];for(let k=0;k<T*T;k++){M(k%T,Math.floor(k/T),A,!1,D);const B=dp(D[0],D[1],d),W=dp(D[2],D[1],d),Y=dp(D[2],D[3],d),K=dp(D[0],D[3],d);z.minimums.push(Math.min(B,W,Y,K)),z.maximums.push(Math.max(B,W,Y,K)),z.leaves.push(1)}for(x.push(z),T/=2;T>=1;T/=2){const k=x[x.length-1];z=new v3(T);for(let B=0;B<T*T;B++){M(B%T,Math.floor(B/T),2,!0,D);const W=k.getElevation(D[0],D[1]),Y=k.getElevation(D[2],D[1]),K=k.getElevation(D[2],D[3]),ne=k.getElevation(D[0],D[3]),se=k.isLeaf(D[0],D[1]),he=k.isLeaf(D[2],D[1]),Re=k.isLeaf(D[2],D[3]),Me=k.isLeaf(D[0],D[3]),Ne=Math.min(W.min,Y.min,K.min,ne.min),Fe=Math.max(W.max,Y.max,K.max,ne.max),Ue=se&&he&&Re&&Me;z.maximums.push(Fe),z.minimums.push(Ne),z.leaves.push(Fe-Ne<=5&&Ue?1:0)}x.push(z)}return x}(this.dem),a=i.length-1,o=i[a];this._addNode(o.minimums[0],o.maximums[0],o.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(e,i,a,o,d,p,x=1){return b3([e,i,-100],[a,o,this.maximums[0]*x],d,p)}raycast(e,i,a,o,d,p,x=1){if(!this.nodeCount)return null;const T=this.raycastRoot(e,i,a,o,d,p,x);if(T==null)return null;const A=[],M=[],z=[],D=[],k=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;k.length>0;){const{idx:B,t:W,nodex:Y,nodey:K,depth:ne}=k.pop();if(this.leaves[B]){S3(Y,K,ne,e,i,a,o,z,D);const he=1<<ne,Re=(Y+0)/he,Me=(Y+1)/he,Ne=(K+0)/he,Fe=(K+1)/he,Ue=dp(Re,Ne,this.dem)*x,ft=dp(Me,Ne,this.dem)*x,$e=dp(Me,Fe,this.dem)*x,yt=dp(Re,Fe,this.dem)*x,It=w3(z[0],z[1],Ue,D[0],z[1],ft,D[0],D[1],$e,d,p),bt=w3(D[0],D[1],$e,z[0],D[1],yt,z[0],z[1],Ue,d,p),Et=Math.min(It!==null?It:Number.MAX_VALUE,bt!==null?bt:Number.MAX_VALUE);if(Et!==Number.MAX_VALUE)return Et;{const jt=Pi([],d,p,W);if(A3(Ue,ft,yt,$e,T3(jt[0],z[0],D[0]),T3(jt[1],z[1],D[1]))>=jt[2])return W}continue}let se=0;for(let he=0;he<this._siblingOffset.length;he++){S3((Y<<1)+this._siblingOffset[he][0],(K<<1)+this._siblingOffset[he][1],ne+1,e,i,a,o,z,D),z[2]=-100,D[2]=this.maximums[this.childOffsets[B]+he]*x;const Re=b3(z,D,d,p);if(Re!=null){const Me=Re;A[he]=Me;let Ne=!1;for(let Fe=0;Fe<se&&!Ne;Fe++)Me>=A[M[Fe]]&&(M.splice(Fe,0,he),Ne=!0);Ne||(M[se]=he),se++}}for(let he=0;he<se;he++){const Re=M[he];k.push({idx:this.childOffsets[B]+Re,t:A[Re],nodex:(Y<<1)+this._siblingOffset[Re][0],nodey:(K<<1)+this._siblingOffset[Re][1],depth:ne+1})}}return null}_addNode(e,i,a){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,a,o,d){if(e[o].isLeaf(i,a)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const p=o-1,x=e[p];let T=0,A=0;for(let M=0;M<this._siblingOffset.length;M++){const z=2*i+this._siblingOffset[M][0],D=2*a+this._siblingOffset[M][1],k=x.getElevation(z,D),B=x.isLeaf(z,D),W=this._addNode(k.min,k.max,B);B&&(T|=1<<M),A||(A=W)}for(let M=0;M<this._siblingOffset.length;M++)T&1<<M||this._construct(e,2*i+this._siblingOffset[M][0],2*a+this._siblingOffset[M][1],p,A+M)}}function A3(r,e,i,a,o,d){return Li(Li(r,i,d),Li(e,a,d),o)}function dp(r,e,i){const a=i.dim,o=Ie(r*a-.5,0,a-1),d=Ie(e*a-.5,0,a-1),p=Math.floor(o),x=Math.floor(d),T=Math.min(p+1,a-1),A=Math.min(x+1,a-1);return A3(i.get(p,x),i.get(T,x),i.get(p,A),i.get(T,A),o-p,d-x)}const IA={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function zA(r,e,i){return(256*r*256+256*e+i)/10-1e4}function LA(r,e,i){return 256*r+e+i/256-32768}class Ay{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,a,o=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void ur(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const d=this.dim=i.height-2,p=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=o,this._modifiedForSources={},!o){for(let T=0;T<d;T++)p[this._idx(-1,T)]=p[this._idx(0,T)],p[this._idx(d,T)]=p[this._idx(d-1,T)],p[this._idx(T,-1)]=p[this._idx(T,0)],p[this._idx(T,d)]=p[this._idx(T,d-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(d,-1)]=p[this._idx(d-1,0)],p[this._idx(-1,d)]=p[this._idx(0,d-1)],p[this._idx(d,d)]=p[this._idx(d-1,d-1)]}const x=a==="terrarium"?LA:zA;for(let T=0;T<p.length;++T){const A=4*T;this.floatView[T]=x(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}this._timestamp=xo.now()}_buildQuadTree(){this._tree=new E3(this)}get(e,i,a=!1){a&&(e=Ie(e,-1,this.dim),i=Ie(i,-1,this.dim));const o=this._idx(e,i);return this.floatView[o]}set(e,i,a){const o=this._idx(e,i),d=this.floatView[o];return this.floatView[o]=a,a-d}static getUnpackVector(e){return IA[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const a=[0,0,0,0],o=Ay.getUnpackVector(i);let d=Math.floor((e+o[3])/o[2]);return a[2]=d%256,d=Math.floor(d/256),a[1]=d%256,d=Math.floor(d/256),a[0]=d,a}getPixels(){return new sg({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let o=i*this.dim,d=i*this.dim+this.dim,p=a*this.dim,x=a*this.dim+this.dim;switch(i){case-1:o=d-1;break;case 1:d=o+1}switch(a){case-1:p=x-1;break;case 1:x=p+1}const T=-i*this.dim,A=-a*this.dim;for(let M=p;M<x;M++)for(let z=o;z<d;z++){const D=4*this._idx(z,M),k=4*this._idx(z+T,M+A);this.pixels[D+0]=e.pixels[k+0],this.pixels[D+1]=e.pixels[k+1],this.pixels[D+2]=e.pixels[k+2],this.pixels[D+3]=e.pixels[k+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function DA(r,e,i){r===1?e.headerLength=i.readFixed32():r===2?e.x=i.readVarint():r===3?e.y=i.readVarint():r===4?e.z=i.readVarint():r===5&&e.layers.push(function(a,o){return a.readFields(kA,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},o)}(i,i.readVarint()+i.pos))}function PA(r,e,i){r===1?(e.delta_filter=function(a,o){return a.readFields(OA,{blockSize:0},o)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):r===2?(i.readVarint(),e.filter="zigzag_filter"):r===3?(i.readVarint(),e.filter="bitshuffle_filter"):r===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function OA(r,e,i){r===1&&(e.blockSize=i.readVarint())}function jA(r,e,i){r===1?(i.readVarint(),e.codec="gzip_data"):r===2?(i.readVarint(),e.codec="jpeg_image"):r===3?(i.readVarint(),e.codec="webp_image"):r===4&&(i.readVarint(),e.codec="png_image")}function NA(r,e,i){let a=0,o=0;r===1?e.firstByte=i.readFixed64():r===2?e.lastByte=i.readFixed64():r===3?e.filters.push(function(d,p){return d.readFields(PA,{},p)}(i,i.readVarint()+i.pos)):r===4?e.codec=function(d,p){return d.readFields(jA,{},p)}(i,i.readVarint()+i.pos):r===5?o=i.readFloat():r===6?a=i.readFloat():r===7?e.bands.push(i.readString()):r===8?e.offset=i.readDouble():r===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=o),e.scale===0&&(e.scale=a)}function kA(r,e,i){r===1?e.version=i.readVarint():r===2?e.name=i.readString():r===3?e.units=i.readString():r===4?e.tileSize=i.readVarint():r===5?e.buffer=i.readVarint():r===6?e.pixelFormat=i.readVarint():r===7&&e.dataIndex.push(function(a,o){return a.readFields(NA,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},o)}(i,i.readVarint()+i.pos))}function BA(r,e,i){if(r===2)(function(a,o,d){a.readFields(FA,d,o)})(i,i.readVarint()+i.pos,e);else if(r===3)throw new Error("Not implemented")}function FA(r,e,i){if(r===1){let a=0;const o=i.readVarint()+i.pos;for(;i.pos<o;)e[a++]=i.readVarint()}}function UA(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let a=2;a>=1;a--){const o=a===1?1:0,d=a===2?1:0;for(let p=0;p<e[0];p++){const x=e[1]*p;for(let T=o;T<e[1];T++){const A=e[2]*(T+x);for(let M=d;M<e[2];M++){const z=e[3]*(M+A);for(let D=0;D<e[3];D++){const k=z+D;r[k]+=r[k-i]}}}}i*=e[a]}return r}function VA(r){for(let e=0,i=r.length;e<i;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function HA(r,e){switch(e){case"uint32":return r;case"uint16":for(let i=0;i<r.length;i+=2){const a=r[i],o=r[i+1];r[i]=(240&a)>>4|(61440&a)>>8|(240&o)<<4|61440&o,r[i+1]=15&a|(3840&a)>>4|(15&o)<<8|(3840&o)<<4}return r;case"uint8":for(let i=0;i<r.length;i+=4){const a=r[i],o=r[i+1],d=r[i+2],p=r[i+3];r[i+0]=(192&a)>>6|(192&o)>>4|(192&d)>>2|192&p,r[i+1]=(48&a)>>4|(48&o)>>2|48&d|(48&p)<<2,r[i+2]=(12&a)>>2|12&o|(12&d)<<2|(12&p)<<4,r[i+3]=3&a|(3&o)<<2|(3&d)<<4|(3&p)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}si(Ay,"DEMData"),si(E3,"DemMinMaxQuadTree",{omit:["dem"]});var mc=Uint8Array,U_=Uint16Array,qA=Int32Array,C3=new mc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),R3=new mc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),GA=new mc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),M3=function(r,e){for(var i=new U_(31),a=0;a<31;++a)i[a]=e+=1<<r[a-1];var o=new qA(i[30]);for(a=1;a<30;++a)for(var d=i[a];d<i[a+1];++d)o[d]=d-i[a]<<5|a;return{b:i,r:o}},I3=M3(C3,2),z3=I3.b,$A=I3.r;z3[28]=258,$A[258]=28;for(var ZA=M3(R3,0).b,L3=new U_(32768),zs=0;zs<32768;++zs){var zg=(43690&zs)>>1|(21845&zs)<<1;L3[zs]=((65280&(zg=(61680&(zg=(52428&zg)>>2|(13107&zg)<<2))>>4|(3855&zg)<<4))>>8|(255&zg)<<8)>>1}var V_=function(r,e,i){for(var a=r.length,o=0,d=new U_(e);o<a;++o)r[o]&&++d[r[o]-1];var p,x=new U_(e);for(o=1;o<e;++o)x[o]=x[o-1]+d[o-1]<<1;p=new U_(1<<e);var T=15-e;for(o=0;o<a;++o)if(r[o])for(var A=o<<4|r[o],M=e-r[o],z=x[r[o]-1]++<<M,D=z|(1<<M)-1;z<=D;++z)p[L3[z]>>T]=A;return p},H_=new mc(288);for(zs=0;zs<144;++zs)H_[zs]=8;for(zs=144;zs<256;++zs)H_[zs]=9;for(zs=256;zs<280;++zs)H_[zs]=7;for(zs=280;zs<288;++zs)H_[zs]=8;var D3=new mc(32);for(zs=0;zs<32;++zs)D3[zs]=5;var WA=V_(H_,9),XA=V_(D3,5),Ux=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},Qu=function(r,e,i){var a=e/8|0;return(r[a]|r[a+1]<<8)>>(7&e)&i},Vx=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(7&e)},YA=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],eh=function(r,e,i){var a=new Error(e||YA[r]);if(a.code=r,Error.captureStackTrace&&Error.captureStackTrace(a,eh),!i)throw a;return a},KA=new mc(0),JA=typeof TextDecoder<"u"&&new TextDecoder;try{JA.decode(KA,{stream:!0})}catch{}const QA={gzip_data:"gzip"};class ru extends Error{constructor(e){super(e),this.name="MRTError"}}const eC={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},P3={uint32:1,uint16:2,uint8:4},tC={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Hx;class Cy{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new ru(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),a=new DataView(e);if(i[0]!==13)throw new ru("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),a=this.getHeaderLength(e);if(i.length<a)throw new ru(`Expected header with length >= ${a} but got buffer of length ${i.length}`);const o=new Hx(i.subarray(0,a)).readFields(DA,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==o.x||this.y!==o.y||this.z!==o.z))throw new ru(`Invalid attempt to parse header ${o.z}/${o.x}/${o.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=o.x,this.y=o.y,this.z=o.z;for(const d of o.layers)this.layers[d.name]=new O3(d,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],a=this.getLayer(e.layerName);for(let o of e.blockIndices){const d=a.dataIndex[o],p=d.firstByte-e.firstByte,x=d.lastByte-e.firstByte;if(a._blocksInProgress.has(o))continue;const T={layerName:a.name,firstByte:p,lastByte:x,pixelFormat:a.pixelFormat,blockIndex:o,blockShape:[d.bands.length].concat(a.bandShape),buffer:a.buffer,codec:d.codec.codec,filters:d.filters.map(A=>A.filter)};a._blocksInProgress.add(o),i.push(T)}return new j3(i,()=>{i.forEach(o=>a._blocksInProgress.delete(o.blockIndex))},(o,d)=>{if(i.forEach(p=>a._blocksInProgress.delete(p.blockIndex)),o)throw o;d.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class O3{constructor({version:e,name:i,units:a,tileSize:o,pixelFormat:d,buffer:p,dataIndex:x},T){if(this.version=e,this.version!==1)throw new ru(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=a,this.tileSize=o,this.buffer=p,this.pixelFormat=eC[d],this.dataIndex=x,this.bandShape=[o+2*p,o+2*p,P3[this.pixelFormat]],this._decodedBlocks=new Ey(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return P3[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[a,o]of this.dataIndex.entries()){for(const[d,p]of o.bands.entries())if(p===e)return{bandIndex:i+d,blockIndex:a,blockBandIndex:d};i+=o.bands.length}break;case"number":for(const[a,o]of this.dataIndex.entries()){if(e>=i&&e<i+o.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-i};i+=o.bands.length}break;default:throw new ru(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,a=-1/0;const o=[],d=new Set;for(const p of e){const{blockIndex:x}=this.getBlockForBand(p);if(x<0)throw new ru(`Invalid band: ${JSON.stringify(p)}`);const T=this.dataIndex[x];o.includes(x)||o.push(x),d.add(x),i=Math.min(i,T.firstByte),a=Math.max(a,T.lastByte)}if(d.size>this.cacheSize)throw new ru(`Number of blocks to decode (${d.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:a,blockIndices:o}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:a}=this.getBlockForBand(e);if(i<0)throw new ru(`Band not found: ${JSON.stringify(e)}`);const o=this._decodedBlocks.get(i.toString());if(!o)throw new ru(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const d=this.dataIndex[i],p=this.bandShape.reduce((A,M)=>A*M,1),x=a*p,T=o.subarray(x,x+p);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:d.offset,scale:d.scale}}}Cy.setPbf=function(r){Hx=r};class j3{constructor(e,i,a){this.tasks=e,this._onCancel=i,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}Cy.performDecoding=function(r,e){const i=new Uint8Array(r);return Promise.all(e.tasks.map(a=>{const{layerName:o,firstByte:d,lastByte:p,pixelFormat:x,blockShape:T,blockIndex:A,filters:M,codec:z}=a,D=i.subarray(d,p+1),k=new Uint32Array(T[0]*T[1]*T[2]);let B;if(z!=="gzip_data")throw new ru(`Unhandled codec: ${z}`);return B=function(W,Y){if(!globalThis.DecompressionStream&&Y==="gzip_data")return Promise.resolve(((he=function(Ne){Ne[0]==31&&Ne[1]==139&&Ne[2]==8||eh(6,"invalid gzip data");var Fe=Ne[3],Ue=10;4&Fe&&(Ue+=2+(Ne[10]|Ne[11]<<8));for(var ft=(Fe>>3&1)+(Fe>>4&1);ft>0;ft-=!Ne[Ue++]);return Ue+(2&Fe)}(se=W))+8>se.length&&eh(6,"invalid gzip data"),function(Ne,Fe,Ue,ft){var $e=Ne.length;if(!$e||Fe.f&&!Fe.l)return Ue||new mc(0);var yt=!Ue,It=yt||Fe.i!=2,bt=Fe.i;yt&&(Ue=new mc(3*$e));var Et,jt,ht=function(An){var Cn=Ue.length;if(An>Cn){var _n=new mc(Math.max(2*Cn,An));_n.set(Ue),Ue=_n}},At=Fe.f||0,at=Fe.p||0,et=Fe.b||0,kt=Fe.l,Ot=Fe.d,bi=Fe.m,oi=Fe.n,fi=8*$e;do{if(!kt){At=Qu(Ne,at,1);var qt=Qu(Ne,at+1,3);if(at+=3,!qt){var vi=Ne[(pe=4+((at+7)/8|0))-4]|Ne[pe-3]<<8,Gi=pe+vi;if(Gi>$e){bt&&eh(0);break}It&&ht(et+vi),Ue.set(Ne.subarray(pe,Gi),et),Fe.b=et+=vi,Fe.p=at=8*Gi,Fe.f=At;continue}if(qt==1)kt=WA,Ot=XA,bi=9,oi=5;else if(qt==2){var Xt=Qu(Ne,at,31)+257,mi=Qu(Ne,at+10,15)+4,Ni=Xt+Qu(Ne,at+5,31)+1;at+=14;for(var Qi=new mc(Ni),dr=new mc(19),rr=0;rr<mi;++rr)dr[GA[rr]]=Qu(Ne,at+3*rr,7);at+=3*mi;var hi=Ux(dr),tr=(1<<hi)-1,Dr=V_(dr,hi);for(rr=0;rr<Ni;){var pe,ge=Dr[Qu(Ne,at,tr)];if(at+=15&ge,(pe=ge>>4)<16)Qi[rr++]=pe;else{var st=0,dt=0;for(pe==16?(dt=3+Qu(Ne,at,3),at+=2,st=Qi[rr-1]):pe==17?(dt=3+Qu(Ne,at,7),at+=3):pe==18&&(dt=11+Qu(Ne,at,127),at+=7);dt--;)Qi[rr++]=st}}var Wt=Qi.subarray(0,Xt),Zt=Qi.subarray(Xt);bi=Ux(Wt),oi=Ux(Zt),kt=V_(Wt,bi),Ot=V_(Zt,oi)}else eh(1);if(at>fi){bt&&eh(0);break}}It&&ht(et+131072);for(var ui=(1<<bi)-1,Ei=(1<<oi)-1,fr=at;;fr=at){var gr=(st=kt[Vx(Ne,at)&ui])>>4;if((at+=15&st)>fi){bt&&eh(0);break}if(st||eh(2),gr<256)Ue[et++]=gr;else{if(gr==256){fr=at,kt=null;break}var ar=gr-254;gr>264&&(ar=Qu(Ne,at,(1<<(sr=C3[rr=gr-257]))-1)+z3[rr],at+=sr);var en=Ot[Vx(Ne,at)&Ei],Dn=en>>4;if(en||eh(3),at+=15&en,Zt=ZA[Dn],Dn>3){var sr=R3[Dn];Zt+=Vx(Ne,at)&(1<<sr)-1,at+=sr}if(at>fi){bt&&eh(0);break}It&&ht(et+131072);var wn=et+ar;if(et<Zt){var sn=0-Zt,Gr=Math.min(Zt,wn);for(sn+et<0&&eh(3);et<Gr;++et)Ue[et]=(void 0)[sn+et]}for(;et<wn;++et)Ue[et]=Ue[et-Zt]}}Fe.l=kt,Fe.p=fr,Fe.b=et,Fe.f=At,kt&&(At=1,Fe.m=bi,Fe.d=Ot,Fe.n=oi)}while(!At);return et!=Ue.length&&yt?(Et=Ue,((jt=et)==null||jt>Et.length)&&(jt=Et.length),new mc(Et.subarray(0,jt))):Ue.subarray(0,et)}(se.subarray(he,-8),{i:2},new mc(((K=se)[(ne=K.length)-4]|K[ne-3]<<8|K[ne-2]<<16|K[ne-1]<<24)>>>0))));var K,ne,se,he;const Re=QA[Y];if(!Re)throw new Error(`Unhandled codec: ${Y}`);const Me=new globalThis.DecompressionStream(Re);return new Response(new Blob([W]).stream().pipeThrough(Me)).arrayBuffer().then(Ne=>new Uint8Array(Ne))}(D,z).then(W=>(function(Y,K){Y.readFields(BA,K)}(new Hx(W),k),new tC[x](k.buffer))),B.then(W=>{for(let Y=M.length-1;Y>=0;Y--)switch(M[Y]){case"delta_filter":UA(W,T);break;case"zigzag_filter":VA(W);break;case"bitshuffle_filter":HA(W,x);break;default:throw new ru(`Unhandled filter "${M[Y]}"`)}return{layerName:o,blockIndex:A,data:W}}).catch(W=>{throw W})}))},si(j3,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),si(Cy,"MapboxRasterTile"),si(O3,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class N3{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const iC=["id","tile","layer","source","sourceLayer","state"];class Lg{constructor(e,i,a,o,d){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=a,this._y=o,this.properties=e.properties,this.id=d}clone(){const e=new Lg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of iC)this[i]!==void 0&&(e[i]=this[i]);return e}}class k3{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new rc(Vt,16,0),this.featureIndexArray=new Yp,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,a,o,d,p=0,x=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,o,d,p);const A=this.grid;for(let M=0;M<i.length;M++){const z=i[M],D=[1/0,1/0,-1/0,-1/0];for(let k=0;k<z.length;k++){const B=z[k];D[0]=Math.min(D[0],B.x),D[1]=Math.min(D[1],B.y),D[2]=Math.max(D[2],B.x),D[3]=Math.max(D[3],B.y)}x!==0&&(D[0]-=x,D[1]-=x,D[2]+=x,D[3]+=x),D[0]<Vt&&D[1]<Vt&&D[2]>=0&&D[3]>=0&&A.insert(T,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Oi(new ey(this.rawTileData)).layers,this.sourceLayerCoder=new N3(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:a,transform:o,tileTransform:d,pixelPosMatrix:p,availableImages:x,worldview:T}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const A=a.bufferedTilespaceBounds,M=this.grid.query(A.min.x,A.min.y,A.max.x,A.max.y,(B,W,Y,K)=>ts(a.bufferedTilespaceGeometry,B,W,Y,K));M.sort(rC);let z=null;o.elevation&&M.length>0&&(z=Rg.create(o.elevation,this.tileID));const D={};let k;for(let B=0;B<M.length;B++){const W=M[B];if(W===k)continue;k=W;const Y=this.featureIndexArray.get(W);let K=null;this.is3DTile?this.loadMatchingModelFeature(D,Y,e,a,o,T):this.loadMatchingFeature(D,Y,e,x,T,(ne,se,he,Re=0)=>(K||(K=$t(ne,this.tileID.canonical,d)),se.queryIntersectsFeature(a,ne,he,K,this.z,o,p,z,Re)))}return D}loadMatchingFeature(e,i,a,o,d,p){const{featureIndex:x,bucketIndex:T,sourceLayerIndex:A,layoutVertexArrayOffset:M}=i,z=this.bucketLayerIDs[T],D=a.layers,k=Object.keys(D);if(k.length&&!cr(k,z))return;const B=a.sourceCache,W=this.sourceLayerCoder.decode(A),Y=this.vtLayers[W].feature(x),K=this.getId(Y,W);for(let ne=0;ne<z.length;ne++){const se=z[ne];if(!D[se])continue;const{styleLayer:he,targets:Re}=D[se];let Me={};K!==void 0&&(Me=B.getFeatureState(he.sourceLayer,K));const Ne=!p||p(Y,he,Me,M);if(!Ne)continue;const Fe=new Lg(Y,this.z,this.x,this.y,K);Fe.tile=this.tileID.canonical,Fe.state=Me;let Ue=this.serializedLayersCache.get(se);Ue||(Ue=he.serialize(),Ue.id=se,this.serializedLayersCache.set(se,Ue)),Fe.source=Ue.source,Fe.sourceLayer=Ue["source-layer"],Fe.layer=Object.assign({},Ue),Fe.layer.paint=B3(Ue.paint,he.paint,Y,Me,o),Fe.layer.layout=B3(Ue.layout,he.layout,Y,Me,o);let ft=!1;for(const $e of Re){this.updateFeatureProperties(Fe,$e);const{filter:yt}=$e;if(yt){if(Y.properties=Fe.properties,yt.needGeometry){const It=Rt(Y,!0);if(!yt.filter(new on(this.tileID.overscaledZ,{worldview:d}),It,this.tileID.canonical))continue}else if(!yt.filter(new on(this.tileID.overscaledZ,{worldview:d}),Y))continue}ft=!0,$e.targetId&&this.addFeatureVariant(Fe,$e)}ft&&this.appendToResult(e,se,x,Fe,Ne)}}loadMatchingModelFeature(e,i,a,o,d,p){const{featureIndex:x,bucketIndex:T}=i,A=this.bucketLayerIDs[T],M=a.layers,z=Object.keys(M);if(!z.length||cr(z,A))for(let D=0;D<A.length;D++){const k=A[D],{styleLayer:B,targets:W}=M[k];if(B.type!=="model")continue;const Y=o.tile,K=Y.getBucket(B);if(!(K&&K instanceof vy))continue;const ne=lA(K,x,o,d);if(!ne)continue;const{z:se,x:he,y:Re}=Y.tileID.canonical,{feature:Me,intersectionZ:Ne,position:Fe}=ne;let Ue={};Me.id!==void 0&&(Ue=a.sourceCache.getFeatureState(B.sourceLayer,Me.id));const ft=new Lg({},se,he,Re,Me.id);ft.tile=this.tileID.canonical,ft.state=Ue,ft.properties=Me.properties,ft.geometry={type:"Point",coordinates:[Fe.lng,Fe.lat]};let $e=this.serializedLayersCache.get(k);$e||($e=B.serialize(),$e.id=k,this.serializedLayersCache.set(k,$e)),ft.source=$e.source,ft.sourceLayer=$e["source-layer"],ft.layer=Object.assign({},$e);let yt=!1;for(const It of W){this.updateFeatureProperties(ft,It);const{filter:bt}=It;if(bt){if(Me.properties=ft.properties,bt.needGeometry){if(!bt.filter(new on(this.tileID.overscaledZ,{worldview:p}),Me,this.tileID.canonical))continue}else if(!bt.filter(new on(this.tileID.overscaledZ,{worldview:p}),Me))continue}yt=!0,It.targetId&&this.addFeatureVariant(ft,It)}yt&&this.appendToResult(e,k,x,ft,Ne)}}updateFeatureProperties(e,i,a){if(i.properties){const o={};for(const d in i.properties){const p=i.properties[d].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,a);p!=null&&(o[d]=p)}e.properties=o}}addFeatureVariant(e,i,a){const o={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(o.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(o)}appendToResult(e,i,a,o,d){let p=e[i];p===void 0&&(p=e[i]=[]),p.push({featureIndex:a,feature:o,intersectionZ:d})}lookupSymbolFeatures(e,i,a,o,d,p){const x={};this.loadVTLayers();for(const T of e)this.loadMatchingFeature(x,{bucketIndex:i,sourceLayerIndex:a,featureIndex:T,layoutVertexArrayOffset:0},o,d,p);return x}loadFeature(e){const{featureIndex:i,sourceLayerIndex:a}=e;this.loadVTLayers();const o=this.sourceLayerCoder.decode(a),d=this.vtFeatures[o];if(d[i])return d[i];const p=this.vtLayers[o].feature(i);return d[i]=p,p}hasLayer(e){for(const i of this.bucketLayerIDs)for(const a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;if(this.promoteId){const o=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(o!=null)if(Array.isArray(o)){if(!this.promoteIdExpression){const d=uo(o);if(d.result!=="success"){const p=d.value.map(x=>`${x.key}: ${x.message}`).join(", ");return void ur(`Failed to create expression for promoteId: ${p}`)}this.promoteIdExpression=d.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Gl),a=this.promoteIdExpression.evaluate({zoom:0},e)}else a=e.properties[o];typeof a=="boolean"&&(a=Number(a))}return a}}function B3(r,e,i,a,o){return Vi(r,(d,p)=>{const x=e instanceof Zc?e.get(p):null;return x&&x.evaluate?x.evaluate(i,a,void 0,o):x})}function rC(r,e){return e-r}si(k3,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const F3=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,a]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const o=a>>4;if(o!==1)throw new Error(`Got v${o} data when expected v1.`);const d=F3[15&a];if(!d)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new qx(x,p,d,e)}constructor(e,i=64,a=Float64Array,o){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=F3.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-x%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${a}.`);o&&o instanceof ArrayBuffer?(this.data=o,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+x+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=i,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Gx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,a,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:p,nodeSize:x}=this,T=[0,d.length-1,0],A=[];for(;T.length;){const M=T.pop()||0,z=T.pop()||0,D=T.pop()||0;if(z-D<=x){for(let Y=D;Y<=z;Y++){const K=p[2*Y],ne=p[2*Y+1];K>=e&&K<=a&&ne>=i&&ne<=o&&A.push(d[Y])}continue}const k=D+z>>1,B=p[2*k],W=p[2*k+1];B>=e&&B<=a&&W>=i&&W<=o&&A.push(d[k]),(M===0?e<=B:i<=W)&&(T.push(D),T.push(k-1),T.push(1-M)),(M===0?a>=B:o>=W)&&(T.push(k+1),T.push(z),T.push(1-M))}return A}within(e,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:d,nodeSize:p}=this,x=[0,o.length-1,0],T=[],A=a*a;for(;x.length;){const M=x.pop()||0,z=x.pop()||0,D=x.pop()||0;if(z-D<=p){for(let Y=D;Y<=z;Y++)V3(d[2*Y],d[2*Y+1],e,i)<=A&&T.push(o[Y]);continue}const k=D+z>>1,B=d[2*k],W=d[2*k+1];V3(B,W,e,i)<=A&&T.push(o[k]),(M===0?e-a<=B:i-a<=W)&&(x.push(D),x.push(k-1),x.push(1-M)),(M===0?e+a>=B:i+a>=W)&&(x.push(k+1),x.push(z),x.push(1-M))}return T}}function Gx(r,e,i,a,o,d){if(o-a<=i)return;const p=a+o>>1;U3(r,e,p,a,o,d),Gx(r,e,i,a,p-1,1-d),Gx(r,e,i,p+1,o,1-d)}function U3(r,e,i,a,o,d){for(;o>a;){if(o-a>600){const A=o-a+1,M=i-a+1,z=Math.log(A),D=.5*Math.exp(2*z/3),k=.5*Math.sqrt(z*D*(A-D)/A)*(M-A/2<0?-1:1);U3(r,e,i,Math.max(a,Math.floor(i-M*D/A+k)),Math.min(o,Math.floor(i+(A-M)*D/A+k)),d)}const p=e[2*i+d];let x=a,T=o;for(q_(r,e,a,i),e[2*o+d]>p&&q_(r,e,a,o);x<T;){for(q_(r,e,x,T),x++,T--;e[2*x+d]<p;)x++;for(;e[2*T+d]>p;)T--}e[2*a+d]===p?q_(r,e,a,T):(T++,q_(r,e,T,o)),T<=i&&(a=T+1),i<=T&&(o=T-1)}}function q_(r,e,i,a){$x(r,i,a),$x(e,2*i,2*a),$x(e,2*i+1,2*a+1)}function $x(r,e,i){const a=r[e];r[e]=r[i],r[i]=a}function V3(r,e,i,a){const o=r-i,d=e-a;return o*o+d*d}s.$=xf,s.A=wo,s.B=Pu,s.C=2,s.D=lp,s.E=fu,s.F=z_,s.G=fw,s.H=yf,s.I=ao,s.J=Ph,s.K=ki,s.L=yu,s.M=If,s.N=Ah,s.O=Mf,s.P=Ct,s.Q=$o,s.R=uh,s.S=wl,s.T=sx,s.U=uo,s.V=xy,s.W=Lf,s.X=pl,s.Y=fl,s.Z=Oc,s._=Ea,s.a=function(r){return Yn.API_CDN_URL_REGEX.test(r)},s.a$=ve,s.a0=_u,s.a1=Sp,s.a2=Od,s.a3=class extends xy{},s.a4=Ch,s.a5=Rf,s.a6=qe,s.a7=function(r){const e=r.value;return e?_u(e)?Dx(e,!0)?[]:[new xy(r.key,e,`invalid url "${e}"`)]:[new xy(r.key,e,`string expected, "${ki(e)}" found`)]:[]},s.a8=Zm,s.a9=On,s.aA=Ie,s.aB=_e,s.aC=Rs,s.aD=c,s.aE=Ss,s.aF=fe,s.aG=Ye,s.aH=function(r,e){const i={};for(let a=0;a<e.length;a++){const o=e[a];o in r&&(i[o]=r[o])}return i},s.aI=te,s.aJ=Te,s.aK=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,i,a){const o=this.entries[r]=this.entries[r]||{callbacks:[]};if(o.result){const[d,p]=o.result;return this.scheduler?this.scheduler.add(()=>{a(d,p)},e):a(d,p),()=>{}}return o.callbacks.push(a),o.cancel||(o.cancel=i((d,p)=>{o.result=[d,p];for(const x of o.callbacks)this.scheduler?this.scheduler.add(()=>{x(d,p)},e):x(d,p);setTimeout(()=>delete this.entries[r],3e3)})),()=>{o.result||(o.callbacks=o.callbacks.filter(d=>d!==a),o.callbacks.length||(o.cancel(),delete this.entries[r]))}}},s.aL=function(r,e,i){const a=JSON.stringify(r.request);return r.data&&(this.deduped.entries[a]={result:[null,r.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},o=>{const d=ul(r.request,(p,x,T,A)=>{p?o(p):x&&o(null,{vectorTile:i?void 0:new Oi(new ey(x)),rawData:x,cacheControl:T,expires:A})});return()=>{d.cancel(),o()}},e)},s.aM=function(r){Sc++,Sc>cl&&(r.getActor().send("enforceCacheSizeLimit",vo),Sc=0)},s.aN=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log2(r)))},s.aO=ra,s.aP=Vw,s.aQ=Ww,s.aR=G,s.aS=Uw,s.aT=function(r,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<r.length;a++){const o=document.createElement("source");Nl(r[a])||(i.crossOrigin="Anonymous"),o.src=r[a],i.appendChild(o)}return{cancel:()=>{}}},s.aU=E_,s.aV=function(r){return fetch(r).then(e=>e.arrayBuffer()).then(e=>xb(e,0,r))},s.aW=Cb,s.aX=class{constructor(r,e,i,a){this.id=r,this.position=e!=null?new G(e[0],e[1]):new G(0,0),this.orientation=i??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new Di([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(r,e){if(_e(r.matrix,e,r.matrix),r.meshes)for(const i of r.meshes){const a=Di.applyTransformFast(i.aabb,r.matrix);this.aabb.encapsulate(a)}if(r.children)for(const i of r.children)this._applyTransformations(i,r.matrix)}computeBoundsAndApplyParent(){const r=Se([]);for(const e of this.nodes)this._applyTransformations(e,r)}computeModelMatrix(r,e,i,a,o,d,p=!1){Eb(this.matrix,this,r.transform,this.position,e,i,a,o,d,p)}upload(r){if(!this.uploaded){for(const e of this.nodes)lx(e,r);for(const e of this.nodes)Q0(e);this.uploaded=!0}}destroy(){for(const r of this.nodes)cx(r)}},s.aY=Mi,s.aZ=D_,s.a_=Ee,s.aa=Nt,s.ab=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return Ve(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Li(r.x,e.x,i),y:Li(r.y,e.y,i),z:Li(r.z,e.z,i),azimuthal:Li(r.azimuthal,e.azimuthal,i),polar:Li(r.polar,e.polar,i)}}},s.ac=on,s.ad=xl,s.ae=ot,s.af=Tt,s.ag=Zi,s.ah=Qe,s.ai=Zc,s.aj=Wh,s.ak=Li,s.al=Vt,s.am=Ap,s.an=He,s.ao=$r,s.ap=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return function([i,a]){const o=Ve([1,i,a]);return{x:o.x,y:o.y,z:o.z}}(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Li(r.x,e.x,i),y:Li(r.y,e.y,i),z:Li(r.z,e.z,i)}}},s.aq=function(r,e,i=0,a=!0){const o=new Ct(i,i),d=r.sub(o),p=e.add(o),x=[d,new Ct(p.x,d.y),p,new Ct(d.x,p.y)];return a&&x.push(d.clone()),x},s.ar=function(r,e){const i=[];for(let a=0;a<r.length;a++){const o=Be(a-1,-1,r.length-1),d=Be(a+1,-1,r.length-1),p=r[a],x=r[d],T=r[o].sub(p).unit(),A=x.sub(p).unit(),M=A.angleWithSep(T.x,T.y),z=T.add(A).unit().mult(-1*e/Math.sin(M/2));i.push(p.add(z))}return i},s.as=Cw,s.at=ts,s.au=function(r,e,i=0){return or(((e.x-i)*r.scale-r.x)*Vt,(e.y*r.scale-r.y)*Vt,be(e.z,e.y))},s.av=Er,s.aw=_i,s.ax=Tr,s.ay=Bb,s.az=function(r){let e=1/0,i=1/0,a=-1/0,o=-1/0;for(const d of r)e=Math.min(e,d.x),i=Math.min(i,d.y),a=Math.max(a,d.x),o=Math.max(o,d.y);return{min:new Ct(e,i),max:new Ct(a,o)}},s.b=function(r){return Yn.API_FONTS_REGEX.test(r)},s.b$=tu,s.b0=Kc,s.b1=cs,s.b2=vt,s.b3=$d,s.b4=my,s.b5=function(){Zo.isLoading()||Zo.isLoaded()||Lh()!=="deferred"||qc()},s.b6=Oh,s.b7=Rt,s.b8=Lg,s.b9=Ft,s.bA=Se,s.bB=Ke,s.bC=le,s.bD=function(r,e){const{x:i,y:a}=r.point,o=T0(i,a,r.worldSize/r._pixelsPerMercatorPixel,0,0);return _e(o,o,e_(ya(e)))},s.bE=Q,s.bF=Cr,s.bG=function(r,e){var i=e[0]-r[0],a=e[1]-r[1],o=e[2]-r[2];return Math.sqrt(i*i+a*a+o*o)},s.bH=Pi,s.bI=Ai,s.bJ=Ri,s.bK=I_,s.bL=ol,s.bM=vx,s.bN=function(r,e,i,a,o){const d=5*e+2;r.float32[d+0]=i,r.float32[d+1]=a,r.float32[d+2]=o},s.bO=py,s.bP=oa,s.bQ=Ms,s.bR=as,s.bS=br,s.bT=Be,s.bU=function(r,e,i,a){var o=new Z(4);return o[0]=r,o[1]=e,o[2]=i,o[3]=a,o},s.bV=_s,s.bW=Ja,s.bX=aa,s.bY=dm,s.bZ=Xw,s.b_=Xu,s.ba=fx,s.bb=hg,s.bc=$t,s.bd=lc,s.be=El,s.bf=Qp,s.bg=Wr,s.bh=Xh,s.bi=zx,s.bj=function(r,e){const i=Wh(e.zoom);if(i===0)return ya(r);const a=tm(r),o=eg(a),d=fe(a.getWest())*e.worldSize,p=fe(a.getEast())*e.worldSize,x=Te(a.getNorth())*e.worldSize,T=Te(a.getSouth())*e.worldSize,A=[d,x,0],M=[p,x,0],z=[d,T,0],D=[p,T,0],k=ee([],e.globeMatrix);return Tt(A,A,k),Tt(M,M,k),Tt(z,z,k),Tt(D,D,k),o[0]=nl(o[0],z,i),o[1]=nl(o[1],D,i),o[2]=nl(o[2],M,i),o[3]=nl(o[3],A,i),Di.fromPoints(o)},s.bk=rm,s.bl=ee,s.bm=im,s.bn=nl,s.bo=Yc,s.bp=H1,s.bq=it,s.br=ye,s.bs=Cy,s.bt=ey,s.bu=ul,s.bv=function(r,e){const i=[];for(const a in r)a in e||i.push(a);return i},s.bw=Je,s.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.by=Hs,s.bz=function(r){var e=new Z(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},s.c=ro,s.c$=function(r){return r*r*r*r*r},s.c0=xx,s.c1=vw,s.c2=Sx,s.c3=qx,s.c4=Ht,s.c5=ds,s.c6=La,s.c7=function(r,e,i){i*=.5;var a=e[0],o=e[1],d=e[2],p=e[3],x=Math.sin(i),T=Math.cos(i);return r[0]=a*T+o*x,r[1]=o*T-a*x,r[2]=d*T+p*x,r[3]=p*T-d*x,r},s.c8=fs,s.c9=wi,s.cA=Ji,s.cB=bb,s.cC=Ml,s.cD=Jg,s.cE=function(r,e,i,a,o,d,p,x,T){if(T.name==="globe")return Jg(r,e,new Ml(i,a,o),!1);const A=D_({z:i,x:a,y:o},T);return new Di([(d+A.x/A.scale)*e,e*(A.y/A.scale),p],[(d+A.x2/A.scale)*e,e*(A.y2/A.scale),x])},s.cF=function(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r[3]=Math.min(e[3],i[3]),r},s.cG=function(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r[3]=Math.max(e[3],i[3]),r},s.cH=function(r){const e=Math.round((r+45+360)%360/90)%4;return ie[e]},s.cI=Ce,s.cJ=Br,s.cK=y,s.cL=function(r){const e=Se(new Float64Array(16));_e(e,r.pixelMatrix,r.globeMatrix);const i=[0,L,0],a=[0,P,0];return Tt(i,i,e),Tt(a,a,e),[i[0]>0&&i[0]<=r.width&&i[1]>0&&i[1]<=r.height&&!t_(r,new G(r.center.lat,90)),a[0]>0&&a[0]<=r.width&&a[1]>0&&a[1]<=r.height&&!t_(r,new G(r.center.lat,-90))]},s.cM=function(r,e){const{scale:i}=r.tileTransform,a=i*Vt/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return function(o,d,p){var x=d[1],T=d[2],A=d[3],M=p[0],z=p[1];return o[0]=d[0]*M,o[1]=x*M,o[2]=T*z,o[3]=A*z,o}(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},s.cN=K0,s.cO=zt,s.cP=vb,s.cQ=function(r){const e=vb(r,!0);return Q([],[e[0],e[1],e[4],e[5]])},s.cR=xe,s.cS=Nr,s.cT=Le,s.cU=function(r){const{x:e,y:i}=r.point,{lng:a,lat:o}=r._center;return T0(e,i,r.worldSize,a,o)},s.cV=Fi,s.cW=J,s.cX=Wf,s.cY=ia,s.cZ=m,s.c_=function(r,e,i){let a=0;for(let o=0;o<2;++o)r[o]>0&&(a+=(r[o]-0)*(r[o]-0)),e[o]<0&&(a+=(0-e[o])*(0-e[o]));return a},s.ca=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},s.cb=lt,s.cc=function(r,e,i,a,o){var d=1/Math.tan(e/2);if(r[0]=d/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=d,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,o!=null&&o!==1/0){var p=1/(a-o);r[10]=(o+a)*p,r[14]=2*o*a*p}else r[10]=-1,r[14]=-2*a;return r},s.cd=function(r,e,i,a,o,d,p){var x=1/(e-i),T=1/(a-o),A=1/(d-p);return r[0]=-2*x,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*T,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*A,r[11]=0,r[12]=(e+i)*x,r[13]=(o+a)*T,r[14]=(p+d)*A,r[15]=1,r},s.ce=we,s.cf=function(r,e,i){r[4*e+0]=i[0],r[4*e+1]=i[1],r[4*e+2]=i[2],r[4*e+3]=i[3]},s.cg=Gh,s.ch=Zd,s.ci=Jr,s.cj=el,s.ck=ma,s.cl=Lw,s.cm=function(){var r=new Z(4);return Z!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},s.cn=function(r,e,i){var a=e[0],o=e[1],d=e[2],p=e[3],x=Math.sin(i),T=Math.cos(i);return r[0]=a*T+d*x,r[1]=o*T+p*x,r[2]=a*-x+d*T,r[3]=o*-x+p*T,r},s.co=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},s.cp=zr,s.cq=function(r){var e=r[0],i=r[1],a=r[2],o=r[3];return Math.sqrt(e*e+i*i+a*a+o*o)},s.cr=Ps,s.cs=Sr,s.ct=qn,s.cu=3,s.cv=2,s.cw=7,s.cx=6,s.cy=gt,s.cz=xt,s.d=function(r){return Yn.API_TILEJSON_REGEX.test(r)},s.d$=Hb,s.d0=ce,s.d1=45,s.d2=$h,s.d3=function(r,e,i){const a=Math.sqrt(r*r+e*e+i*i),o=a>0?Math.acos(i/a)*ba:0;let d=r!==0||e!==0?Math.atan2(-e,-r)*ba+90:0;return d<0&&(d+=360),[a,d,o]},s.d4=or,s.d5=Ve,s.d6=Ze,s.d7=Jt,s.d8=Di,s.d9=ji,s.dA=function(r,e,i){const a=Wh(i.zoom),o=r.style.map._antialias,d=r.terrain&&r.terrain.exaggeration()>0;return a===0&&!o&&!d},s.dB=function(r){const e=r.pixelsPerMeter,i=e/we(1,r.center.lat),a=Se(new Float64Array(16));return ye(a,a,[r.point.x,r.point.y,0]),xe(a,a,[i,i,e]),Float32Array.from(a)},s.dC=tm,s.dD=function(r){const e=Ce-5;r=Ie(r,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(He(r))),3);return Math.round(i*(R.length-1))},s.dE=function(r,e,i,a){const o=e.getNorth(),d=e.getSouth(),p=e.getWest(),x=e.getEast(),T=1<<r.z,A=x-p,M=o-d,z=A/E,D=-M/R[i],k=[0,z,0,D,0,0,o,p,0];if(r.z>0){const B=180/a;ze(k,k,[B/A+1,0,0,0,B/M+1,0,-.5*B/z,.5*B/D,1])}return k[2]=T,k[5]=r.x,k[8]=r.y,k},s.dF=ya,s.dG=function(r,e,i){const a=Se(new Float64Array(16)),o=(e/(1<<r)-.5)*Math.PI*2;return Ae(a,i.globeMatrix,o),Float32Array.from(a)},s.dH=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const i=e.getSource().maxzoom,a=1<<i,o=Math.floor(r.x),d=Math.floor((r.x-o)*a),p=Math.floor(r.y*a),x=this.findDEMTileFor(new ra(i,o,i,d,p));return!(!x||!x.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||r.y<0||r.y>1)return e;const o=a.getSource().maxzoom,d=1<<o,p=Math.floor(r.x),x=r.x-p,T=new ra(o,p,o,Math.floor(x*d),Math.floor(r.y*d)),A=this.findDEMTileFor(T);if(!A||!A.dem)return e;const M=A.dem,z=1<<A.tileID.canonical.z,D=(x*z-A.tileID.canonical.x)*M.dim,k=(r.y*z-A.tileID.canonical.y)*M.dim,B=Math.floor(D),W=Math.floor(k);return(i?this.exaggeration():1)*Li(Li(M.get(B,W),M.get(B,W+1),k-W),Li(M.get(B+1,W),M.get(B+1,W+1),k-W),D-B)}getAtTileOffset(r,e,i){const a=1<<r.canonical.z;return this.getAtPointOrZero(new ot(r.wrap+(r.canonical.x+e/Vt)/a,(r.canonical.y+i/Vt)/a))}getAtTileOffsetFunc(r,e,i,a){return o=>{const d=this.getAtTileOffset(r,o.x,o.y),p=a.upVector(r.canonical,o.x,o.y);return Ht(p,p,d*a.upVectorScale(r.canonical,e,i).metersToTile),p}}getForTilePoints(r,e,i,a){if(this.isUsingMockSource())return!1;const o=Rg.create(this,r,a);return!!o&&(e.forEach(d=>{d[2]=this.exaggeration()*o.getElevationAt(d[0],d[1],i)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const i=e.dem.tree,a=e.tileID,o=1<<r.canonical.z-a.canonical.z;let d=r.canonical.x/o-a.canonical.x,p=r.canonical.y/o-a.canonical.y,x=0;for(let T=0;T<r.canonical.z-a.canonical.z&&!i.leaves[x];T++){d*=2,p*=2;const A=2*Math.floor(p)+Math.floor(d);x=i.childOffsets[x]+A,d%=1,p%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,i=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const o of r){const d=this.getMinMaxForTile(o.tileID);d&&(i=Math.min(i,d.min),a=Math.max(a,d.max),e=!0)}return e?{min:i,max:a}:null}},s.dI=sg,s.dJ=$u,s.dK=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},s.dL=oe,s.dM=function(r,e){var i=Math.sin(e),a=Math.cos(e);return r[0]=a,r[1]=i,r[2]=0,r[3]=-i,r[4]=a,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},s.dN=Si,s.dO=tg,s.dP=tn,s.dQ=dn,s.dR=256,s.dS=function(r,e){const i=[0,0,0];return Tt(i,i,rm(ya(e.canonical))),Tt(i,i,r),i},s.dT=r=>({u_matrix:new ma(r),u_texsize:new el(r),u_pixels_to_tile_units:new Wd(r),u_device_pixel_ratio:new Jr(r),u_width_scale:new Jr(r),u_floor_width_scale:new Jr(r),u_image:new Gh(r),u_units_to_pixels:new el(r),u_tile_units_to_pixels:new Jr(r),u_alpha_discard_threshold:new Jr(r),u_trim_offset:new el(r),u_trim_fade_range:new el(r),u_trim_color:new $h(r),u_emissive_strength:new Jr(r),u_zbias_factor:new Jr(r),u_tile_to_meter:new Jr(r),u_ground_shadow_factor:new Zd(r),u_pattern_transition:new Jr(r)}),s.dU=r=>({u_matrix:new ma(r),u_pixels_to_tile_units:new Wd(r),u_device_pixel_ratio:new Jr(r),u_width_scale:new Jr(r),u_floor_width_scale:new Jr(r),u_units_to_pixels:new el(r),u_dash_image:new Gh(r),u_gradient_image:new Gh(r),u_image_height:new Jr(r),u_texsize:new el(r),u_tile_units_to_pixels:new Jr(r),u_alpha_discard_threshold:new Jr(r),u_trim_offset:new el(r),u_trim_fade_range:new el(r),u_trim_color:new $h(r),u_emissive_strength:new Jr(r),u_zbias_factor:new Jr(r),u_tile_to_meter:new Jr(r),u_ground_shadow_factor:new Zd(r)}),s.dV=r=>({u_camera_to_center_distance:new Jr(r),u_extrude_scale:new Wd(r),u_device_pixel_ratio:new Jr(r),u_matrix:new ma(r),u_inv_rot_matrix:new ma(r),u_merc_center:new el(r),u_tile_id:new Zd(r),u_zoom_transition:new Jr(r),u_up_dir:new Zd(r),u_emissive_strength:new Jr(r)}),s.dW=Gd,s.dX=mE,s.dY=class{constructor(r,e,i,a){this.context=r,this.format=a,this.size=i,this.texture=r.gl.createTexture();const[o,d,p]=this.size,{gl:x}=r;x.bindTexture(x.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&x.texImage3D(x.TEXTURE_3D,0,this.format,o,d,p,0,rx(this.format),nx(this.format),e.data)}bind(r,e){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_3D,this.texture),r!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,r),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},s.dZ=rg,s.d_=(r,e,i,a,o,d)=>{const p=r.transform,x=p.projection.name==="globe";let T;if(d.paint.get("circle-pitch-alignment")==="map")if(x){const M=tg(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;T=Float32Array.from([M,0,0,M])}else T=p.calculatePixelsToTileUnitsMatrix(i);else T=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(p.projection),u_matrix:r.translatePosMatrix(e.projMatrix,i,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:xo.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:ig,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(x){A.u_inv_rot_matrix=a,A.u_merc_center=o,A.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],A.u_zoom_transition=Wh(p.zoom);const M=o[0]*Vt,z=o[1]*Vt;A.u_up_dir=p.projection.upVector(new Ml(0,0,0),M,z)}return A},s.da=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},s.db=Dx,s.dc=function(r,e){return r.readFields(hA,{icons:[]},e)},s.dd=Z0,s.de=Eg,s.df=wx,s.dg=Rc,s.dh=Vp,s.di=ch,s.dj=dh,s.dk=nr,s.dl=function(r){const e=r.indexOf(jh);return e>=0?r.slice(0,e):r},s.dm=function(r){return r.indexOf(jh)>=0},s.dn=function(r){const e=r.lastIndexOf(jh);return e>=0?r.slice(e+1):""},s.dp=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},s.dq=function(r,e,i,a){return r.type==="custom"?new sA(r,e):new cA[r.type](r,e,i,a)},s.dr=lr,s.ds=function(r){const e=r.indexOf(jh);return e>=0?r.slice(e+1):""},s.dt=class extends Lg{constructor(r,e){super(r._vectorTileFeature,r._z,r._x,r._y,r.id),r.state&&(this.state=Object.assign({},r.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=r.source,this.sourceLayer=r.sourceLayer,this.layer=r.layer)}toJSON(){const r=super.toJSON();return r.target=this.target,r.namespace=this.namespace,r}},s.du=Bf,s.dv=Mr,s.dw=function(r){return r({pluginStatus:Ks,pluginURL:sc}),Bf.on("pluginStateChange",r),r},s.dx=Jp,s.dy=class extends Io{constructor(r){super(r),this.current=fc}set(r,e,i){if(this.fetchUniformLocation(r,e)){for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},s.dz=me,s.e=Yn,s.e$=function(){const r=w_;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(Nn),w_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.e0=Sa,s.e1=(r,e,i,a,o,d,p,x,T,A)=>{const M=r.transform,z=M.pitch<15?Fb(.07,.7,Ie((14-M.zoom)/5,0,1)):.07,D=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Vb(r,e,i,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:o,u_width_scale:d,u_floor_width_scale:p,u_image:0,u_tile_units_to_pixels:Ub(e,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(D?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:z,u_tile_to_meter:Ze(e.tileID.canonical,0),u_ground_shadow_factor:T,u_pattern_transition:A}},s.e2=(r,e,i,a,o,d,p,x,T,A)=>{const M=r.transform,z=M.calculatePixelsToTileUnitsMatrix(e),D=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",k=M.pitch<15?Fb(.07,.7,Ie((14-M.zoom)/5,0,1)):.07;return{u_matrix:Vb(r,e,i,a),u_pixels_to_tile_units:z,u_device_pixel_ratio:d,u_width_scale:p,u_floor_width_scale:x,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:o,u_texsize:qb(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ub(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(D?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:k,u_tile_to_meter:Ze(e.tileID.canonical,0),u_ground_shadow_factor:A}},s.e3=pi,s.e4=Yd,s.e5=be,s.e6=b0,s.e7=ef,s.e8=De,s.e9=Yu,s.eA=rs,s.eB=Sl,s.eC=function(r,e,i,a,o,d,p,x,T,A,M,z,D,k,B,W){var Y=new Z(16);return Y[0]=r,Y[1]=e,Y[2]=i,Y[3]=a,Y[4]=o,Y[5]=d,Y[6]=p,Y[7]=x,Y[8]=T,Y[9]=A,Y[10]=M,Y[11]=z,Y[12]=D,Y[13]=k,Y[14]=B,Y[15]=W,Y},s.eD=H,s.eE=ku,s.eF=kh,s.eG=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ct(1/0,1/0),max:new Ct(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){const i=pm(new Ct(0,0),new Ct(Vt,Vt),r),a=[];if(e&&!fm(i,this._globalClipBounds))return a;for(const o of this._activeRegions){if(o.hiddenByOverlap||!fm(i,o))continue;const d=x_(o.min,o.max,r);a.push({min:d.min,max:d.max,sourceId:this._sourceIds[o.priority],footprint:o.footprint,footprintTileId:o.tileId,order:o.order,clipMask:o.clipMask,clipScope:o.clipScope})}return a}setSources(r){this._setSources(r.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const a of e.cache.getVisibleCoordinates()){const o=e.cache.getTile(a).buckets[e.layer];o&&o.updateFootprints(a.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(r){const e=r.getFootprints();if(e.length===0)return;const i=r.getOrder(),a=r.getClipMask(),o=r.getClipScope();for(const d of e){if(!d.footprint)continue;const p=pm(d.footprint.min,d.footprint.max,d.id);this._activeRegions.push({min:p.min,max:p.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:d.id,footprint:d.footprint,order:i,clipMask:a,clipScope:o})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||fg(e.min,i.min)||fg(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(a,o){const d=(p,x)=>p+x;return a.length-o.length||a.reduce(d,"").localeCompare(o.reduce(d,""))}(e.clipScope,i.clipScope));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){const i=this._activeRegions[e],a=this._prevRegions[e];r=i.priority!==a.priority||!H0(i,a)||i.order!==a.order||i.clipMask!==a.clipMask||!Hs(i.clipScope,a.clipScope),++e}}if(r){++this._updateTime;for(const i of this._activeRegions)i.order!==Jd&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const a=this._activeRegions;if(i>=a.length)return i;const o=a[i].priority;for(;i<a.length&&a[i].priority===o;)++i;return i};if(this._sourceIds.length>1){let i=0,a=e(i);for(;i!==a;){let o=i;const d=i;for(;o!==a;){const p=this._activeRegions[o];p.hiddenByOverlap=!1;for(let x=0;x<d;x++){const T=this._activeRegions[x];if(!T.hiddenByOverlap&&p.order===Jd&&fm(p,T)&&(p.hiddenByOverlap=mg(p.footprint,p.tileId,T.footprint,T.tileId),p.hiddenByOverlap))break}++o}i=a,a=e(i)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},s.eH=Jd,s.eI=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const i=new lc,a=new cs,o=[],d=r+1+2,p=e[0]+1,x=e[0]+1+(1+e.length),T=(A,M,z)=>{let D=A===d-1?A-2:A===0?A:A-1;return D+=z?24575:0,[D,M]};for(let A=0;A<d;++A)i.emplaceBack(...T(A,0,!0));for(let A=0;A<p;++A)for(let M=0;M<d;++M)i.emplaceBack(...T(M,A,(M===0||M===d-1)&&!0));for(let A=0;A<e.length;++A){const M=e[A];for(let z=0;z<d;++z)i.emplaceBack(...T(z,M,!0))}for(let A=0;A<e.length;++A){const M=a.length,z=e[A]+1+2,D=new cs;for(let W=0;W<z-1;W++){const Y=W===z-2,K=Y?d*(x-e.length+A-W):d;for(let ne=0;ne<d-1;ne++){const se=W*d+ne;W===0||Y||ne===0||ne===d-2?(D.emplaceBack(se+1,se,se+K),D.emplaceBack(se+K,se+K+1,se+1)):(a.emplaceBack(se+1,se,se+K),a.emplaceBack(se+K,se+K+1,se+1))}}const k=Wr.simpleSegment(0,M,i.length,a.length-M);for(let W=0;W<D.uint16.length;W+=3)a.emplaceBack(D.uint16[W],D.uint16[W+1],D.uint16[W+2]);const B=Wr.simpleSegment(0,M,i.length,a.length-M);o.push({withoutSkirts:k,withSkirts:B})}return{vertices:i,indices:a,segments:o}}_createGrid(r){const e=this._fillGridMeshWithLods(E,R);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,Qp.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new cs;for(let p=0;p<=E;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const i=new Ka,a=new Ka,o=new Ka,d=new Ka;this._poleSegments=[];for(let p=0,x=0;p<m;p++){const T=360/(1<<p);i.emplaceBack(0,-c,0,.5,0),a.emplaceBack(0,-c,0,.5,1),o.emplaceBack(0,-c,0,.5,.5),d.emplaceBack(0,-c,0,.5,.5);for(let A=0;A<=E;A++){let M=A/E,z=0;const D=Li(0,T,M),[k,B,W]=F(Ln,r_,D,c);i.emplaceBack(k,B,W,M,z),a.emplaceBack(k,B,W,M,1-z);const Y=He(D);M=.5+.5*Math.sin(Y),z=.5+.5*Math.cos(Y),o.emplaceBack(k,B,W,M,z),d.emplaceBack(k,B,W,M,1-z)}this._poleSegments.push(Wr.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,Qm,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(a,Qm,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(o,Qm,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(d,Qm,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},s.eJ=y_,s.eK=je,s.eL=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.eM=Pe,s.eN=ct,s.eO=function(r,e,i){return r[0]=e[0]/i[0],r[1]=e[1]/i[1],r[2]=e[2]/i[2],r},s.eP=Gn,s.eQ=j,s.eR=ii,s.eS=er,s.eT=function([r,e,i]){const a=Math.hypot(r,e,i),o=Math.atan2(r,i),d=.5*Math.PI-Math.acos(-e/a);return new G(J(o),J(d))},s.eU=Jn,s.eV=ax,s.eW=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!function(i){if(Qt==null){const a=i.navigator?i.navigator.userAgent:null;Qt=!!i.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Qt}(r)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.eX=function(r,e){vo=r,cl=e},s.eY=t_,s.eZ=Yf,s.e_=function(r){const e=[0,0,0],i=Se(new Float64Array(16));return _e(i,r.pixelMatrix,r.globeMatrix),Tt(e,e,i),new Ct(e[0],e[1])},s.ea=450,s.eb=7,s.ec=ke,s.ed=function(r,e){if(r===e){var i=e[1],a=e[2],o=e[3],d=e[6],p=e[7],x=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=i,r[6]=e[9],r[7]=e[13],r[8]=a,r[9]=d,r[11]=e[14],r[12]=o,r[13]=p,r[14]=x}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r},s.ee=nA,s.ef=xr,s.eg=Fu,s.eh=256,s.ei=e_,s.ej=pa,s.ek=Ae,s.el=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},s.em=Ka,s.en=Yo,s.eo=bs,s.ep=function(r,e,i,a,o){return Ie((r-e)/(i-e)*(o-a)+a,a,o)},s.eq=ps,s.er=function(r,e){var i=e[0],a=e[1],o=e[2],d=e[3],p=e[4],x=e[5],T=e[6],A=e[7],M=e[8],z=M*p-x*A,D=-M*d+x*T,k=A*d-p*T,B=i*z+a*D+o*k;return B?(r[0]=z*(B=1/B),r[1]=(-M*a+o*A)*B,r[2]=(x*a-o*p)*B,r[3]=D*B,r[4]=(M*i-o*T)*B,r[5]=(-x*i+o*d)*B,r[6]=k*B,r[7]=(-A*i+a*T)*B,r[8]=(p*i-a*d)*B,r):null},s.es=2,s.et=Wi,s.eu=ox,s.ev=[1,1,1],s.ew=Rg,s.ex=Zs,s.ey=function(r,e,i,a){var o=e[0],d=e[1],p=e[2],x=e[3];return r[0]=o+a*(i[0]-o),r[1]=d+a*(i[1]-d),r[2]=p+a*(i[2]-p),r[3]=x+a*(i[3]-x),r},s.ez=wg,s.f=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},s.f0=function(){Z0().acquire(Nn)},s.f1=Lh,s.f2=function(r,e,i=!1){if(Ks===ha.deferred||Ks===ha.loading||Ks===ha.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");sc=xo.resolveURL(r),Ks=ha.deferred,Nf=e,kf(),i||qc()},s.f3=function(r){xg=xo.resolveURL(r),vg||(vg=new lp(Z0(),new fu)),vg.broadcast("setMeshoptUrl",xg)},s.f4=fb,s.f5=function(r){ex=xo.resolveURL(r),vg||(vg=new lp(Z0(),new fu)),vg.broadcast("setDracoUrl",ex)},s.f6=db,s.f7=ks,s.f8=function(r){const e=df();if(!e)return;const i=e.delete(Ws);r&&i.then(()=>r()).catch(r)},s.f9=Do,s.fA=function(r){lu(),Ta!=null&&Ta.then(e=>{e.keys().then(i=>{for(let a=0;a<i.length-r;a++)e.delete(i[a]).catch(o=>ur(o.message))}).catch(i=>ur(i.message))}).catch(e=>ur(e.message))},s.fa=si,s.fb=Es,s.fc=Ju,s.fd=N3,s.fe=k3,s.ff=jb,s.fg=Hi,s.fh="hd_road_elevation",s.fi=Vr,s.fj=Vi,s.fk=eu,s.fl=bx,s.fm=xm,s.fn=function(r,e,i,a,o,d,p,x=1,T,A,M){r.createArrays(),r.tilePixelRatio=Vt/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const z=r.layers[0].layout,D=r.layers[0]._unevaluatedLayout._values,k={};k.scaleFactor=x,k.textSizeScaleRange=z.get("text-size-scale-range"),k.iconSizeScaleRange=z.get("icon-size-scale-range");const[B,W]=k.textSizeScaleRange,[Y,K]=k.iconSizeScaleRange;k.textScaleFactor=Ie(k.scaleFactor,B,W),k.iconScaleFactor=Ie(k.scaleFactor,Y,K);const ne=D["text-size"],se=D["icon-size"];if(r.textSizeData.kind==="composite"){const{minZoom:Ue,maxZoom:ft}=r.textSizeData;k.compositeTextSizes=[ne.possiblyEvaluate(new on(Ue,{worldview:M}),d),ne.possiblyEvaluate(new on(ft,{worldview:M}),d)]}if(r.iconSizeData.kind==="composite"){const{minZoom:Ue,maxZoom:ft}=r.iconSizeData;k.compositeIconSizes=[se.possiblyEvaluate(new on(Ue,{worldview:M}),d),se.possiblyEvaluate(new on(ft,{worldview:M}),d)]}k.layoutTextSize=ne.possiblyEvaluate(new on(p+1,{worldview:M}),d),k.layoutIconSize=se.possiblyEvaluate(new on(p+1,{worldview:M}),d),k.textMaxSize=ne.possiblyEvaluate(new on(18,{worldview:M}),d);const he=z.get("symbol-placement"),Re=z.get("text-rotation-alignment")==="map"&&he!=="point",Me=z.get("text-size");let Ne=!1;const Fe=[];for(const Ue of r.features){const ft=z.get("text-font").evaluate(Ue,{},d).join(","),$e=Me.evaluate(Ue,{},d)*k.textScaleFactor,yt=k.layoutTextSize.evaluate(Ue,{},d)*k.textScaleFactor,It=k.layoutIconSize.evaluate(Ue,{},d)*k.iconScaleFactor,bt={horizontal:{},vertical:void 0},Et=Ue.text;let jt,ht=[0,0];if(Et){const mi=Et.toString(),Ni=z.get("text-letter-spacing").evaluate(Ue,{},d)*aa,Qi=z.get("text-line-height").evaluate(Ue,{},d)*aa,dr=Up(mi)?Ni:0,rr=z.get("text-anchor").evaluate(Ue,{},d),hi=z.get("text-variable-anchor");if(!hi){const st=z.get("text-radial-offset").evaluate(Ue,{},d);if(st)ht=vw(rr,[st*aa,Tx]);else{const dt=z.get("text-offset").evaluate(Ue,{},d);ht=[dt[0]*aa,dt[1]*aa]}}let tr=Re?"center":z.get("text-justify").evaluate(Ue,{},d);const Dr=he==="point",pe=Dr?z.get("text-max-width").evaluate(Ue,{},d)*aa:1/0,ge=st=>{r.allowVerticalPlacement&&Pf(mi)&&(bt.vertical=yx(Et,e,i,o,ft,pe,Qi,rr,st,dr,ht,ol.vertical,!0,yt,$e,T))};if(!Re&&hi){const st=tr==="auto"?hi.map(Wt=>Sx(Wt)):[tr];let dt=!1;for(let Wt=0;Wt<st.length;Wt++){const Zt=st[Wt];if(!bt.horizontal[Zt])if(dt)bt.horizontal[Zt]=bt.horizontal[0];else{const ui=yx(Et,e,i,o,ft,pe,Qi,"center",Zt,dr,ht,ol.horizontal,!1,yt,$e,T);ui&&(bt.horizontal[Zt]=ui,dt=ui.positionedLines.length===1)}}ge("left")}else{if(tr==="auto"&&(tr=Sx(rr)),Dr||z.get("text-writing-mode").indexOf("horizontal")>=0||!Pf(mi)){const st=yx(Et,e,i,o,ft,pe,Qi,rr,tr,dr,ht,ol.horizontal,!1,yt,$e,T);st&&(bt.horizontal[tr]=st)}ge(Dr?"left":tr)}}let At,at,et,kt,Ot,bi,oi=!1;const fi=z.get("icon-text-fit").evaluate(Ue,{},d);if(Ue.icon&&Ue.icon.hasPrimary()){const mi=ww(Ue.icon,r.iconSizeData,D["icon-size"],d,r.zoom,Ue,T,k.iconScaleFactor,M);At=mi.iconPrimary,et=mi.iconSecondary;const Ni=At.toString();if(at=a.get(Ni),at&&(Ot=z.get("icon-offset").evaluate(Ue,{},d),bi=z.get("icon-anchor").evaluate(Ue,{},d),jt=PE(o.get(Ni),et?o.get(et.toString()):void 0,Ot,bi),oi=at.sdf,r.sdfIcons===void 0?r.sdfIcons=at.sdf:r.sdfIcons!==at.sdf&&ur("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(at.pixelRatio!==r.pixelRatio||z.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0)),et){const Qi=et.toString();kt=a.get(Qi)}}Ne=Ne||!(!Ue.icon||!Ue.icon.hasSecondary());const qt=Ex(bt.horizontal)||bt.vertical;r.iconsInText||(r.iconsInText=!!qt&&qt.iconsInText);const vi=yt*k.textScaleFactor/aa,{defaultShapedIcon:Gi,verticallyShapedIcon:Xt}=qE(r,jt,z,Ue,d,bt,vi,Ot,fi);fi!=="none"&&jt&&(nw(jt)||sw(jt))&&(ay(0,at,At,jt,Gi,fi,A,a,o),ay(0,kt,et,jt,Gi,fi,A,a,o),Xt&&(ay(0,at,At,jt,Xt,fi,A,a,o),ay(0,kt,et,jt,Xt,fi,A,a,o))),jt=Gi,Fe.push({feature:Ue,shapedTextOrientations:bt,shapedText:qt,shapedIcon:jt,iconPrimary:At,iconSecondary:et,iconOffset:Ot,iconAnchor:bi,verticallyShapedIcon:Xt,layoutTextSize:yt,layoutIconSize:It,textOffset:ht,isSDFIcon:oi,iconTextFit:fi})}return{featureData:Fe,sizes:k,hasAnySecondaryIcon:Ne,textAlongLine:Re,symbolPlacement:he}},s.fo=pw,s.fp=function(r,e,i,a,o,d,p,x,T,A){const{featureData:M,hasAnySecondaryIcon:z,sizes:D,textAlongLine:k,symbolPlacement:B}=e;for(const W of M){const{shapedIcon:Y,verticallyShapedIcon:K,feature:ne,shapedTextOrientations:se,shapedText:he,layoutTextSize:Re,textOffset:Me,isSDFIcon:Ne,iconPrimary:Fe,iconSecondary:Ue,iconTextFit:ft,iconOffset:$e}=W;Tw(Y,A.iconPositions,Fe,Ue),Tw(K,A.iconPositions,Fe,Ue),HE(se,A.iconPositions),VE(Fe,Ue,A.iconPositions),(he||Y)&&GE(r,ne,se,Y,K,T,D,Re,0,Me,Ne,a,o,p,x,z,ft,$e,k,B)}i&&r.generateCollisionDebugBuffers(d,r.collisionBoxArray,D.textScaleFactor)},s.fq=Oi,s.fr=Ay,s.fs=St,s.ft=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==mb){const i=new Uint32Array(r,0,7),[,,a,o,d,p]=i;e=i.byteLength+o+d+p+d,(a!==r.byteLength||e>=r.byteLength)&&ur("Invalid b3dm header information.")}return xb(r,e)},s.fu=function(r,e){const i=Cb(r);for(const a of i){for(const o of a.meshes)F5(o);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(U5(a.lights,e)))}return i},s.fv=vy,s.fw=wt,s.fx=Fr,s.fy=Zo,s.fz=ha,s.g=function(r,e){return Mr(Object.assign(r,{method:"GET"}),e)},s.h=function(r){return r.indexOf("mapbox:")===0},s.i=function(r){return Yn.API_STYLE_REGEX.test(r)&&!ro(r)},s.j=Ga,s.k=od,s.l=function(r){return decodeURIComponent(atob(r).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.m=function(r,e){return Mr(Object.assign(r,{type:"json"}),e)},s.n=Bl,s.o=xo,s.p=function(r,e){return Mr(Object.assign(r,{method:"POST"}),e)},s.q=na,s.r=$a,s.s=function(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=function(){return Q1||(Q1=new Do),Q1},s.u=function(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()},s.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},s.w=ur,s.x=Fx,s.y=Fl,s.z=so}),N(["./shared"],function(s){function q(He){const J=He?He.url.toString():void 0;return J?performance.getEntriesByName(J):[]}function Z(He){if(typeof He=="number"||typeof He=="boolean"||typeof He=="string"||He==null)return JSON.stringify(He);if(Array.isArray(He)){let ie="[";for(const me of He)ie+=`${Z(me)},`;return`${ie}]`}let J="{";for(const ie of Object.keys(He).sort())J+=`${ie}:${Z(He[ie])},`;return`${J}}`}function Q(He){let J="";for(const ie of s.bx)J+=`/${Z(He[ie])}`;return J}class oe{constructor(J){this.keyCache={},this._layers={},this._layerConfigs={},J&&this.replace(J)}replace(J,ie){this._layerConfigs={},this._layers={},this.update(J,[],ie)}update(J,ie,me){this._options=me;for(const Pe of J)this._layerConfigs[Pe.id]=Pe,(this._layers[Pe.id]=s.dq(Pe,this.scope,null,this._options)).compileFilter(me),this.keyCache[Pe.id]&&delete this.keyCache[Pe.id];for(const Pe of ie)delete this.keyCache[Pe],delete this._layerConfigs[Pe],delete this._layers[Pe];this.familiesBySource={};const je=function(Pe,Ie){const Qe={};for(let Je=0;Je<Pe.length;Je++){const Lt=Pe[Je];let vt=Ie&&Ie[Lt.id];vt||(Lt.type==="symbol"?vt=Lt.id:(vt=Q(Lt),Lt.type==="line"&&Lt.paint&&function Mi(Vi){return typeof Vi=="string"&&Vi==="line-progress"||(Array.isArray(Vi)?Vi.some(Mi):!(!Vi||typeof Vi!="object")&&Object.values(Vi).some(Mi))}(Lt.paint["line-width"])&&(vt+=`/${Z(Lt.paint["line-width"])}`))),Ie&&(Ie[Lt.id]=vt);let pi=Qe[vt];pi||(pi=Qe[vt]=[]),pi.push(Lt)}const Be=[];for(const Je in Qe)Be.push(Qe[Je]);return Be}(Object.values(this._layerConfigs),this.keyCache);for(const Pe of je){const Ie=Pe.map(pi=>this._layers[pi.id]),Qe=Ie[0];if(Qe.visibility==="none")continue;const Be=Qe.source||"";let Je=this.familiesBySource[Be];Je||(Je=this.familiesBySource[Be]={});const Lt=Qe.sourceLayer||"_geojsonTileLayer";let vt=Je[Lt];vt||(vt=Je[Lt]=[]),vt.push(Ie)}}}const de=1*s.fc;class ze{constructor(J){const ie={},me=[];for(const Qe in J){const Be=J[Qe],Je=ie[Qe]={};for(const Lt in Be.glyphs){const vt=Be.glyphs[+Lt];if(!vt||vt.bitmap.width===0||vt.bitmap.height===0)continue;const pi=vt.metrics.localGlyph?de:1,Mi={x:0,y:0,w:vt.bitmap.width+2*pi,h:vt.bitmap.height+2*pi};me.push(Mi),Je[Lt]=Mi}}const{w:je,h:Pe}=s.G(me),Ie=new s.fb({width:je||1,height:Pe||1});for(const Qe in J){const Be=J[Qe];for(const Je in Be.glyphs){const Lt=Be.glyphs[+Je];if(!Lt||Lt.bitmap.width===0||Lt.bitmap.height===0)continue;const vt=ie[Qe][Je],pi=Lt.metrics.localGlyph?de:1;s.fb.copy(Lt.bitmap,Ie,{x:0,y:0},{x:vt.x+pi,y:vt.y+pi},Lt.bitmap)}}this.image=Ie,this.positions=ie}}s.fa(ze,"GlyphAtlas");class le{constructor(J){this.tileID=new s.aO(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.tileZoom=J.tileZoom,this.uid=J.uid,this.zoom=J.zoom,this.lut=J.lut,this.canonical=J.tileID.canonical,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.scope=J.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.request&&J.request.collectResourceTiming,this.promoteId=J.promoteId,this.isSymbolTile=J.isSymbolTile,this.tileTransform=s.aZ(J.tileID.canonical,J.projection),this.projection=J.projection,this.worldview=J.worldview,this.localizableLayerIds=J.localizableLayerIds,this.brightness=J.brightness,this.extraShadowCaster=!!J.extraShadowCaster,this.tessellationStep=J.tessellationStep,this.scaleFactor=J.scaleFactor,this.worldview=J.worldview}parse(J,ie,me,je,Pe,Ie){this.status="parsing",this.data=J,this.collisionBoxArray=new s.b3;const Qe=new s.fd(Object.keys(J.layers).sort()),Be=new s.fe(this.tileID,this.promoteId);Be.bucketLayerIDs=[];const Je={},Lt=new s.ff(256,256),vt={featureIndex:Be,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Lt,availableImages:me,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},pi=[],Mi=ie.familiesBySource[this.source];for(const lr in Mi){const nr=J.layers[lr];if(!nr)continue;let cr=!1,Hr=!1,ur=!1;for(const wt of Mi[lr])wt[0].type==="symbol"?cr=!0:Hr=!0,wt[0].is3D()&&wt[0].type!=="model"&&(ur=!0);if(this.extraShadowCaster&&!ur||this.isSymbolTile===!0&&!cr||this.isSymbolTile===!1&&!Hr)continue;nr.version===1&&s.w(`Vector tile source "${this.source}" layer "${lr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const mn=Qe.encode(lr),Yr=[];let Ve=!1;for(let wt=0,Ft=0;wt<nr.length;wt++){const Qt=nr.feature(wt),wi=Be.getId(Qt,lr);if(this.localizableLayerIds&&this.localizableLayerIds.has(lr)){const $i=Qt.properties?Qt.properties.worldview:null;if(this.worldview&&typeof $i=="string")if($i==="all")Qt.properties.$localized=!0;else{if(!$i.split(",").includes(this.worldview))continue;Qt.properties.$localized=!0,Qt.properties.worldview=this.worldview}}!Ve&&Qt.properties&&Qt.properties.hasOwnProperty(s.fg)&&(Ve=!0),Yr.push({feature:Qt,id:wi,index:Ft,sourceLayerIndex:mn}),Ft++}Ve&&!vt.elevationFeatures&&J.layers.hasOwnProperty(s.fh)&&(vt.elevationFeatures=s.fi.parseFrom(J.layers[s.fh],this.canonical));for(const wt of Mi[lr]){const Ft=wt[0];if(this.extraShadowCaster&&(!Ft.is3D()||Ft.type==="model")||this.isSymbolTile!==void 0&&Ft.type==="symbol"!==this.isSymbolTile||Ft.minzoom&&this.zoom<Math.floor(Ft.minzoom)||Ft.maxzoom&&this.zoom>=Ft.maxzoom||Ft.visibility==="none")continue;Se(wt,this.zoom,vt.brightness,me,this.worldview);const Qt=Je[Ft.id]=Ft.createBucket({index:Be.bucketLayerIDs.length,layers:wt,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:mn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:je,worldview:this.worldview});Be.bucketLayerIDs.push(wt.map($i=>s.B($i.id,$i.scope)));let wi=Qt.prepare?Qt.prepare():null;wi!=null?(wi=wi.then(()=>Qt.populate(Yr,vt,this.tileID.canonical,this.tileTransform)),pi.push(wi)):Qt.populate(Yr,vt,this.tileID.canonical,this.tileTransform)}}const Vi=()=>{let lr,nr,cr,Hr,ur,mn;Lt.trim();const Yr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ve=()=>{if(lr)return this.status="done",Ie(lr);if(this.extraShadowCaster)this.status="done",Ie(null,{buckets:Object.values(Je).filter(Ft=>!Ft.isEmpty()),featureIndex:Be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:vt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(nr&&cr&&Hr){const Ft=new ze(nr),Qt=new Map;for(const[Sn,tn]of cr.entries()){const{imagePosition:dn}=s.fl(Sn,tn,s.fm);Qt.set(Sn,dn)}const wi={};for(const Sn in Je){const tn=Je[Sn];tn instanceof s.b4&&(Se(tn.layers,this.zoom,vt.brightness,me,this.worldview),wi[Sn]=s.fn(tn,nr,Ft.positions,cr,Qt,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,ur,this.worldview))}const $i={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Pe,cr,ur,()=>{$i.iconsPending=!1,wt(wi,Ft,$i)}),this.rasterizeIfNeeded(Pe,Hr,mn,()=>{$i.patternsPending=!1,wt(wi,Ft,$i)})}},wt=(Ft,Qt,wi,$i)=>{if(wi.iconsPending||wi.patternsPending)return;const Sn=new s.fo(cr,Hr,this.lut);for(const tn in Je){const dn=Je[tn];if(tn in Ft)s.fp(dn,Ft[tn],this.showCollisionBoxes,me,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,cr,Sn);else if(dn.hasPattern&&(dn instanceof s.ba||dn instanceof s.bb||dn instanceof s.e7)){Se(dn.layers,this.zoom,vt.brightness,me,this.worldview);const In=Object.fromEntries(Sn.patternPositions);dn.addFeatures(vt,this.tileID.canonical,In,me,this.tileTransform,this.brightness)}}this.status="done",Ie(null,{buckets:Object.values(Je).filter(tn=>!tn.isEmpty()),featureIndex:Be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Qt.image,lineAtlas:Lt,imageAtlas:Sn,brightness:vt.brightness})};if(!this.extraShadowCaster){const Ft=s.fj(vt.glyphDependencies,$i=>Object.keys($i).map(Number));Object.keys(Ft).length?Pe.send("getGlyphs",{uid:this.uid,stacks:Ft},($i,Sn)=>{lr||(lr=$i,nr=Sn,Ve())},void 0,!1,Yr):nr={};const Qt=Array.from(vt.iconDependencies.keys()).map($i=>s.I.parse($i));Qt.length?Pe.send("getImages",{images:Qt,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},($i,Sn)=>{lr||(lr=$i,cr=new Map,ur=this.updateImageMapAndGetImageTaskQueue(cr,Sn,vt.iconDependencies),Ve())},void 0,!1,Yr):(cr=new Map,ur=new Map);const wi=Array.from(vt.patternDependencies.keys()).map($i=>s.I.parse($i));wi.length?Pe.send("getImages",{images:wi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},($i,Sn)=>{lr||(lr=$i,Hr=new Map,mn=this.updateImageMapAndGetImageTaskQueue(Hr,Sn,vt.patternDependencies),Ve())},void 0,!1,Yr):(Hr=new Map,mn=new Map)}if(vt.elevationFeatures&&vt.elevationFeatures.length>0){const Ft=[];for(const wi of Object.values(Je))if(wi instanceof s.bb){const $i=wi.getUnevaluatedPortalGraph();$i&&Ft.push($i)}const Qt=s.fk.evaluate(Ft);for(const wi of Object.values(Je))if(wi instanceof s.bb){const $i=J.layers[Qe.decode(wi.sourceLayerIndex)];wi.setEvaluatedPortalGraph(Qt,$i,this.tileID.canonical,vt.availableImages,vt.brightness)}}Ve()};pi.length>0?Promise.allSettled(pi).then(Vi).catch(Ie):Vi()}rasterizeIfNeeded(J,ie,me,je){Array.from(ie.values()).some(Pe=>Pe.usvg)?this.rasterize(J,ie,me,je):je()}updateImageMapAndGetImageTaskQueue(J,ie,me){const je=new Map;for(const Pe of ie.keys()){const Ie=me.get(Pe)||[];for(const Qe of Ie){const Be=Qe.toString(),Je=ie.get(Qe.id.toString());Je.usvg?je.has(Be)||(je.set(Be,Qe),J.set(Be,Object.assign({},Je))):J.set(Be,Je)}}return je}rasterize(J,ie,me,je){this.rasterizeTask=J.send("rasterizeImages",{scope:this.scope,tasks:me},(Pe,Ie)=>{if(!Pe)for(const[Qe,Be]of Ie.entries()){const Je=Object.assign(ie.get(Qe),{data:Be});ie.set(Qe,Je)}je()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Se(He,J,ie,me,je){const Pe=new s.ac(J,{brightness:ie,worldview:je});for(const Ie of He)Ie.recalculate(Pe,me)}class ee extends s.E{constructor(J,ie,me,je,Pe,Ie,Qe){super(),this.actor=J,this.layerIndex=ie,this.availableImages=me,this.availableModels=je,this.loadVectorData=Ie||s.aL,this.loading={},this.loaded={},this.deduped=new s.aK(J.scheduler),this.isSpriteLoaded=Pe,this.scheduler=J.scheduler,this.brightness=Qe}loadTile(J,ie){const me=J.uid,je=J&&J.request,Pe=je&&je.collectResourceTiming,Ie=this.loading[me]=new le(J);Ie.abort=this.loadVectorData(J,(Qe,Be)=>{const Je=!this.loading[me];if(delete this.loading[me],Ie.cancelRasterize(),Je||Qe||!Be)return Ie.status="done",Je||(this.loaded[me]=Ie),ie(Qe);const Lt=Be.rawData,vt={};Be.expires&&(vt.expires=Be.expires),Be.cacheControl&&(vt.cacheControl=Be.cacheControl),Ie.vectorTile=Be.vectorTile||new s.fq(new s.bt(Lt));const pi=()=>{Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Mi,Vi)=>{if(Mi||!Vi)return ie(Mi);const lr={};if(Pe){const nr=q(je);nr.length>0&&(lr.resourceTiming=JSON.parse(JSON.stringify(nr)))}ie(null,Object.assign({rawTileData:Lt.slice(0)},Vi,vt,lr))})};this.isSpriteLoaded?pi():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(pi,{type:"parseTile",isSymbolTile:J.isSymbolTile,zoom:J.tileZoom}):pi()}),this.loaded=this.loaded||{},this.loaded[me]=Ie})}reloadTile(J,ie){const me=this.loaded,je=J.uid;if(me&&me[je]){const Pe=me[je];Pe.scaleFactor=J.scaleFactor,Pe.showCollisionBoxes=J.showCollisionBoxes,Pe.projection=J.projection,Pe.brightness=J.brightness,Pe.tileTransform=s.aZ(J.tileID.canonical,J.projection),Pe.extraShadowCaster=J.extraShadowCaster,Pe.lut=J.lut,Pe.worldview=J.worldview;const Ie=(Qe,Be)=>{const Je=Pe.reloadCallback;Je&&(delete Pe.reloadCallback,Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Je)),ie(Qe,Be)};Pe.status==="parsing"?Pe.reloadCallback=Ie:Pe.status==="done"&&(Pe.vectorTile?Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ie):Ie())}else ie(null,void 0)}abortTile(J,ie){const me=J.uid,je=this.loading[me];je&&(je.abort&&je.abort(),delete this.loading[me]),ie()}removeTile(J,ie){const me=this.loaded,je=J.uid;me&&me[je]&&delete me[je],ie()}}class _e{loadTile(J,ie){const{uid:me,encoding:je,rawImageData:Pe,padding:Ie}=J,Qe=ImageBitmap&&Pe instanceof ImageBitmap?this.getImageData(Pe,Ie):Pe;ie(null,new s.fr(me,Qe,je,Ie<1))}reloadTile(J,ie){ie(null,null)}abortTile(J,ie){ie()}removeTile(J,ie){ie()}getImageData(J,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(J.width,J.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=J.width,this.offscreenCanvas.height=J.height,this.offscreenCanvasContext.drawImage(J,0,0,J.width,J.height);const me=this.offscreenCanvasContext.getImageData(-ie,-ie,J.width+2*ie,J.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),me}}s.bs.setPbf(s.bt);class ye{constructor(J){this._mrt=new s.bs(J.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=J.uid,this.tileID=J.tileID,this.source=J.source}parse(J,ie){const me=this._mrt;this.status="parsing",this._entireBuffer=J;try{me.parseHeader(J),this._isHeaderLoaded=!0;const je=[];for(const Pe in me.layers){const Ie=me.getLayer(Pe),Qe=Ie.getDataRange(Ie.getBandList()),Be=me.createDecodingTask(Qe),Je=J.slice(Qe.firstByte,Qe.lastByte+1),Lt=s.bs.performDecoding(Je,Be).then(vt=>Be.complete(null,vt)).catch(vt=>Be.complete(vt,null));je.push(Lt)}Promise.allSettled(je).then(()=>ie(null,me)).catch(Pe=>ie(Pe))}catch(je){ie(je)}}}class xe{constructor(J){this.actor=J,this.loading={},this.loaded={}}loadTile(J,ie){const me=J.uid,je=J.request,Pe=this.loading[me]=new ye(J),{cancel:Ie}=s.bu(je,(Qe,Be,Je,Lt)=>{const vt=!this.loading[me];if(delete this.loading[me],vt||Qe||!Be)return Pe.status="done",vt||(this.loaded[me]=Pe),ie(Qe);Pe.parse(Be,(pi,Mi)=>{if(pi||!Mi)return ie(pi);ie(null,Mi,Je,Lt)}),this.loaded[me]=Pe});Pe.abort=Ie}reloadTile(J,ie){ie(null,void 0)}abortTile(J,ie){const me=J.uid,je=this.loading[me];je&&(je.abort&&je.abort(),delete this.loading[me]),ie()}removeTile(J,ie){const me=J.uid;this.loaded[me]&&delete this.loaded[me],ie()}decodeRasterArray(J,ie){s.bs.performDecoding(J.buffer,J.task).then(me=>ie(null,me)).catch(me=>ie(me))}}const Le=s.fs.prototype.toGeoJSON;class Ae{constructor(J){this._feature=J,this.extent=s.al,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))}loadGeometry(){if(this._feature.type===1){const J=[];for(const ie of this._feature.geometry)J.push([new s.P(ie[0],ie[1])]);return J}{const J=[];for(const ie of this._feature.geometry){const me=[];for(const je of ie)me.push(new s.P(je[0],je[1]));J.push(me)}return J}}toGeoJSON(J,ie,me){return Le.call(this,J,ie,me)}}class Ke{constructor(J,ie){this.name=J,this.extent=s.al,this.length=ie.length,this._jsonFeatures=ie}feature(J){return new Ae(this._jsonFeatures[J])}}class it{constructor(J){this.layers={},this.extent=s.al;for(const ie of Object.keys(J))this.layers[ie]=new Ke(ie,J[ie])}}const rt=64/4096,lt=128;class zt{constructor(){this.features=new Map}clear(){this.features.clear()}load(J=[],ie){for(const me of J){const je=me.id;if(je==null)continue;let Pe=this.features.get(je);Pe&&this.updateCache(Pe,ie),me.geometry?(Pe=Ci(me),this.updateCache(Pe,ie),this.features.set(je,Pe)):this.features.delete(je),this.updateCache(Pe,ie)}}updateCache(J,ie){for(const{canonical:me,uid:je}of Object.values(ie)){const{z:Pe,x:Ie,y:Qe}=me;xt(J,Math.pow(2,Pe),Ie,Qe)&&delete ie[je]}}getTile(J,ie,me){const je=Math.pow(2,J),Pe=[];for(const Ie of this.features.values())xt(Ie,je,ie,me)&&Pe.push(Jt(Ie,je,ie,me));return{features:Pe}}getFeatures(){return[...this.features.values()]}}function xt({minX:He,minY:J,maxX:ie,maxY:me},je,Pe,Ie){return He<(Pe+1+rt)/je&&J<(Ie+1+rt)/je&&ie>(Pe-rt)/je&&me>(Ie-rt)/je}function Ci(He){const{id:J,geometry:ie,properties:me}=He;if(!ie)return;if(ie.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:je,coordinates:Pe}=ie,Ie={id:J,type:1,geometry:[],tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Qe=Ie.geometry;if(je==="Point")Zi(Pe,Qe,Ie);else if(je==="MultiPoint")for(const Be of Pe)Zi(Be,Qe,Ie);else if(je==="LineString")Ie.type=2,or(Pe,Qe,Ie);else if(je==="MultiLineString")Ie.type=2,er(Pe,Qe,Ie);else if(je==="Polygon")Ie.type=3,er(Pe,Qe,Ie,!0);else{if(je!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ie.type=3;for(const Be of Pe)er(Be,Qe,Ie,!0)}return Ie}function Zi([He,J],ie,me){const je=s.aF(He);let Pe=s.aJ(J);Pe=Pe<0?0:Pe>1?1:Pe,ie.push(je,Pe),me.minX=Math.min(me.minX,je),me.minY=Math.min(me.minY,Pe),me.maxX=Math.max(me.maxX,je),me.maxY=Math.max(me.maxY,Pe)}function or(He,J,ie,me=!1,je=!1){const Pe=[];for(const Ie of He)Zi(Ie,Pe,ie);J.push(Pe),me&&function(Ie,Qe){let Be=0;for(let Je=0,Lt=Ie.length,vt=Lt-2;Je<Lt;vt=Je,Je+=2)Be+=(Ie[Je]-Ie[vt])*(Ie[Je+1]+Ie[vt+1]);if(Be>0===Qe)for(let Je=0,Lt=Ie.length;Je<Lt/2;Je+=2){const vt=Ie[Je],pi=Ie[Je+1];Ie[Je]=Ie[Lt-2-Je],Ie[Je+1]=Ie[Lt-1-Je],Ie[Lt-2-Je]=vt,Ie[Lt-1-Je]=pi}}(Pe,je)}function er(He,J,ie,me=!1){for(let je=0;je<He.length;je++)or(He[je],J,ie,me,je===0)}function Jt(He,J,ie,me){const{id:je,type:Pe,geometry:Ie,tags:Qe}=He,Be=[];if(Pe===1)(function(Je,Lt,vt,pi,Mi){for(let Vi=0;Vi<Je.length;Vi+=2){const lr=Math.round(s.al*(Je[Vi+0]*Lt-vt)),nr=Math.round(s.al*(Je[Vi+1]*Lt-pi));Mi.push([lr,nr])}})(Ie,J,ie,me,Be);else for(const Je of Ie)ji(Je,J,ie,me,Be);return{id:je,type:Pe,geometry:Be,tags:Qe}}function ji(He,J,ie,me,je){const Ie=s.al+lt;let Qe;for(let Be=0;Be<He.length-2;Be+=2){let Je=Math.round(s.al*(He[Be+0]*J-ie)),Lt=Math.round(s.al*(He[Be+1]*J-me)),vt=Math.round(s.al*(He[Be+2]*J-ie)),pi=Math.round(s.al*(He[Be+3]*J-me));const Mi=vt-Je,Vi=pi-Lt;Je<-128&&vt<-128||(Je<-128?(Lt+=Math.round(Vi*((-128-Je)/Mi)),Je=-128):vt<-128&&(pi=Lt+Math.round(Vi*((-128-Je)/Mi)),vt=-128),Lt<-128&&pi<-128||(Lt<-128?(Je+=Math.round(Mi*((-128-Lt)/Vi)),Lt=-128):pi<-128&&(vt=Je+Math.round(Mi*((-128-Lt)/Vi)),pi=-128),Je>=Ie&&vt>=Ie||(Je>=Ie?(Lt+=Math.round(Vi*((Ie-Je)/Mi)),Je=Ie):vt>=Ie&&(pi=Lt+Math.round(Vi*((Ie-Je)/Mi)),vt=Ie),Lt>=Ie&&pi>=Ie||(Lt>=Ie?(Je+=Math.round(Mi*((Ie-Lt)/Vi)),Lt=Ie):pi>=Ie&&(vt=Je+Math.round(Mi*((Ie-Lt)/Vi)),pi=Ie),Qe&&Je===Qe[Qe.length-1][0]&&Lt===Qe[Qe.length-1][1]||(Qe=[[Je,Lt]],je.push(Qe)),Qe.push([vt,pi])))))}}function Fi({name:He,features:J},ie){ie.writeStringField(1,He),ie.writeVarintField(5,s.al);const me=new Map,je=new Map,Pe={keys:me,values:je,feature:null};for(const Ie of J)Pe.feature=Ie,ie.writeMessage(2,Pr,Pe);for(const Ie of me.keys())ie.writeStringField(3,Ie);for(const Ie of je.keys())ie.writeMessage(4,ii,Ie)}function Pr(He,J){const ie=He.feature;ie.id!==void 0&&Number.isSafeInteger(+ie.id)&&J.writeVarintField(1,+ie.id),ie.tags&&J.writeMessage(2,tt,He),J.writeVarintField(3,ie.type),J.writeMessage(4,Ui,ie)}function tt({keys:He,values:J,feature:ie},me){for(const je of Object.keys(ie.tags)){let Pe=ie.tags[je];if(Pe===null)continue;let Ie=He.get(je);Ie===void 0&&(Ie=He.size,He.set(je,Ie)),me.writeVarint(Ie);const Qe=typeof Pe;Qe!=="string"&&Qe!=="boolean"&&Qe!=="number"&&(Pe=JSON.stringify(Pe));let Be=J.get(Pe);Be===void 0&&(Be=J.size,J.set(Pe,Be)),me.writeVarint(Be)}}function Ht(He,J){return(J<<3)+(7&He)}function Pi(He){return He<<1^He>>31}function Ui(He,J){const{geometry:ie,type:me}=He;let je=0,Pe=0;if(me===1){J.writeVarint(Ht(1,ie.length));for(const Ie of ie){const Qe=Ie[0]-je,Be=Ie[1]-Pe;J.writeVarint(Pi(Qe)),J.writeVarint(Pi(Be)),je+=Qe,Pe+=Be}}else for(const Ie of ie){J.writeVarint(Ht(1,1));const Qe=Ie.length-(me===3?1:0);for(let Be=0;Be<Qe;Be++){Be===1&&J.writeVarint(Ht(2,Qe-1));const Je=Ie[Be][0]-je,Lt=Ie[Be][1]-Pe;J.writeVarint(Pi(Je)),J.writeVarint(Pi(Lt)),je+=Je,Pe+=Lt}me===3&&J.writeVarint(Ht(7,1))}}function ii(He,J){const ie=typeof He;ie==="string"?J.writeStringField(1,He):ie==="boolean"?J.writeBooleanField(7,He):ie==="number"&&(He%1!=0?J.writeDoubleField(3,He):He<0?J.writeSVarintField(6,He):J.writeVarintField(5,He))}const Wi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:He=>He},_i=Math.fround||(Ri=new Float32Array(1),He=>(Ri[0]=+He,Ri[0]));var Ri;const Ai=3,gt=5,Tt=6;class Si{constructor(J){this.options=Object.assign(Object.create(Wi),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){const{log:ie,minZoom:me,maxZoom:je}=this.options;ie&&console.time("total time");const Pe=`prepare ${J.length} points`;ie&&console.time(Pe),this.points=J;const Ie=[];for(let Be=0;Be<J.length;Be++){const Je=J[Be];if(!Je.geometry)continue;const[Lt,vt]=Je.geometry.coordinates,pi=_i(zr(Lt)),Mi=_i(Er(vt));Ie.push(pi,Mi,1/0,Be,-1,1),this.options.reduce&&Ie.push(0)}let Qe=this.trees[je+1]=this._createTree(Ie);ie&&console.timeEnd(Pe);for(let Be=je;Be>=me;Be--){const Je=+Date.now();Qe=this.trees[Be]=this._createTree(this._cluster(Qe,Be)),ie&&console.log("z%d: %d clusters in %dms",Be,Qe.numItems,+Date.now()-Je)}return ie&&console.timeEnd("total time"),this}getClusters(J,ie){let me=((J[0]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,J[1]));let Pe=J[2]===180?180:((J[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)me=-180,Pe=180;else if(me>Pe){const vt=this.getClusters([me,je,180,Ie],ie),pi=this.getClusters([-180,je,Pe,Ie],ie);return vt.concat(pi)}const Qe=this.trees[this._limitZoom(ie)],Be=Qe.range(zr(me),Er(Ie),zr(Pe),Er(je)),Je=Qe.data,Lt=[];for(const vt of Be){const pi=this.stride*vt;Lt.push(Je[pi+gt]>1?Sr(Je,pi,this.clusterProps):this.points[Je[pi+Ai]])}return Lt}getChildren(J){const ie=this._getOriginId(J),me=this._getOriginZoom(J),je="No cluster with the specified id.",Pe=this.trees[me];if(!Pe)throw new Error(je);const Ie=Pe.data;if(ie*this.stride>=Ie.length)throw new Error(je);const Qe=this.options.radius/(this.options.extent*Math.pow(2,me-1)),Be=Pe.within(Ie[ie*this.stride],Ie[ie*this.stride+1],Qe),Je=[];for(const Lt of Be){const vt=Lt*this.stride;Ie[vt+4]===J&&Je.push(Ie[vt+gt]>1?Sr(Ie,vt,this.clusterProps):this.points[Ie[vt+Ai]])}if(Je.length===0)throw new Error(je);return Je}getLeaves(J,ie,me){const je=[];return this._appendLeaves(je,J,ie=ie||10,me=me||0,0),je}getTile(J,ie,me){const je=this.trees[this._limitZoom(J)],Pe=Math.pow(2,J),{extent:Ie,radius:Qe}=this.options,Be=Qe/Ie,Je=(me-Be)/Pe,Lt=(me+1+Be)/Pe,vt={features:[]};return this._addTileFeatures(je.range((ie-Be)/Pe,Je,(ie+1+Be)/Pe,Lt),je.data,ie,me,Pe,vt),ie===0&&this._addTileFeatures(je.range(1-Be/Pe,Je,1,Lt),je.data,Pe,me,Pe,vt),ie===Pe-1&&this._addTileFeatures(je.range(0,Je,Be/Pe,Lt),je.data,-1,me,Pe,vt),vt.features.length?vt:null}getClusterExpansionZoom(J){let ie=this._getOriginZoom(J)-1;for(;ie<=this.options.maxZoom;){const me=this.getChildren(J);if(ie++,me.length!==1)break;J=me[0].properties.cluster_id}return ie}_appendLeaves(J,ie,me,je,Pe){const Ie=this.getChildren(ie);for(const Qe of Ie){const Be=Qe.properties;if(Be&&Be.cluster?Pe+Be.point_count<=je?Pe+=Be.point_count:Pe=this._appendLeaves(J,Be.cluster_id,me,je,Pe):Pe<je?Pe++:J.push(Qe),J.length===me)break}return Pe}_createTree(J){const ie=new s.c3(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let me=0;me<J.length;me+=this.stride)ie.add(J[me],J[me+1]);return ie.finish(),ie.data=J,ie}_addTileFeatures(J,ie,me,je,Pe,Ie){for(const Qe of J){const Be=Qe*this.stride,Je=ie[Be+gt]>1;let Lt,vt,pi;if(Je)Lt=Cr(ie,Be,this.clusterProps),vt=ie[Be],pi=ie[Be+1];else{const lr=this.points[ie[Be+Ai]];Lt=lr.properties;const[nr,cr]=lr.geometry.coordinates;vt=zr(nr),pi=Er(cr)}const Mi={type:1,geometry:[[Math.round(this.options.extent*(vt*Pe-me)),Math.round(this.options.extent*(pi*Pe-je))]],tags:Lt};let Vi;Vi=Je||this.options.generateId?ie[Be+Ai]:this.points[ie[Be+Ai]].id,Vi!==void 0&&(Mi.id=Vi),Ie.features.push(Mi)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,ie){const{radius:me,extent:je,reduce:Pe,minPoints:Ie}=this.options,Qe=me/(je*Math.pow(2,ie)),Be=J.data,Je=[],Lt=this.stride;for(let vt=0;vt<Be.length;vt+=Lt){if(Be[vt+2]<=ie)continue;Be[vt+2]=ie;const pi=Be[vt],Mi=Be[vt+1],Vi=J.within(Be[vt],Be[vt+1],Qe),lr=Be[vt+gt];let nr=lr;for(const cr of Vi){const Hr=cr*Lt;Be[Hr+2]>ie&&(nr+=Be[Hr+gt])}if(nr>lr&&nr>=Ie){let cr,Hr=pi*lr,ur=Mi*lr,mn=-1;const Yr=(vt/Lt<<5)+(ie+1)+this.points.length;for(const Ve of Vi){const wt=Ve*Lt;if(Be[wt+2]<=ie)continue;Be[wt+2]=ie;const Ft=Be[wt+gt];Hr+=Be[wt]*Ft,ur+=Be[wt+1]*Ft,Be[wt+4]=Yr,Pe&&(cr||(cr=this._map(Be,vt,!0),mn=this.clusterProps.length,this.clusterProps.push(cr)),Pe(cr,this._map(Be,wt)))}Be[vt+4]=Yr,Je.push(Hr/nr,ur/nr,1/0,Yr,-1,nr),Pe&&Je.push(mn)}else{for(let cr=0;cr<Lt;cr++)Je.push(Be[vt+cr]);if(nr>1)for(const cr of Vi){const Hr=cr*Lt;if(!(Be[Hr+2]<=ie)){Be[Hr+2]=ie;for(let ur=0;ur<Lt;ur++)Je.push(Be[Hr+ur])}}}}return Je}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,ie,me){if(J[ie+gt]>1){const Ie=this.clusterProps[J[ie+Tt]];return me?Object.assign({},Ie):Ie}const je=this.points[J[ie+Ai]].properties,Pe=this.options.map(je);return me&&Pe===je?Object.assign({},Pe):Pe}}function Sr(He,J,ie){return{type:"Feature",id:He[J+Ai],properties:Cr(He,J,ie),geometry:{type:"Point",coordinates:[(me=He[J],360*(me-.5)),Gn(He[J+1])]}};var me}function Cr(He,J,ie){const me=He[J+gt],je=me>=1e4?`${Math.round(me/1e3)}k`:me>=1e3?Math.round(me/100)/10+"k":me,Pe=He[J+Tt],Ie=Pe===-1?{}:Object.assign({},ie[Pe]);return Object.assign(Ie,{cluster:!0,cluster_id:He[J+Ai],point_count:me,point_count_abbreviated:je})}function zr(He){return He/360+.5}function Er(He){const J=Math.sin(He*Math.PI/180),ie=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return ie<0?0:ie>1?1:ie}function Gn(He){const J=(180-360*He)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function ds(He,J,ie,me){let je=me;const Pe=J+(ie-J>>1);let Ie,Qe=ie-J;const Be=He[J],Je=He[J+1],Lt=He[ie],vt=He[ie+1];for(let pi=J+3;pi<ie;pi+=3){const Mi=Zs(He[pi],He[pi+1],Be,Je,Lt,vt);if(Mi>je)Ie=pi,je=Mi;else if(Mi===je){const Vi=Math.abs(pi-Pe);Vi<Qe&&(Ie=pi,Qe=Vi)}}je>me&&(Ie-J>3&&ds(He,J,Ie,me),He[Ie+2]=je,ie-Ie>3&&ds(He,Ie,ie,me))}function Zs(He,J,ie,me,je,Pe){let Ie=je-ie,Qe=Pe-me;if(Ie!==0||Qe!==0){const Be=((He-ie)*Ie+(J-me)*Qe)/(Ie*Ie+Qe*Qe);Be>1?(ie=je,me=Pe):Be>0&&(ie+=Ie*Be,me+=Qe*Be)}return Ie=He-ie,Qe=J-me,Ie*Ie+Qe*Qe}function Br(He,J,ie,me){const je={id:He??null,type:J,geometry:ie,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(J==="Point"||J==="MultiPoint"||J==="LineString")Jn(je,ie);else if(J==="Polygon")Jn(je,ie[0]);else if(J==="MultiLineString")for(const Pe of ie)Jn(je,Pe);else if(J==="MultiPolygon")for(const Pe of ie)Jn(je,Pe[0]);return je}function Jn(He,J){for(let ie=0;ie<J.length;ie+=3)He.minX=Math.min(He.minX,J[ie]),He.minY=Math.min(He.minY,J[ie+1]),He.maxX=Math.max(He.maxX,J[ie]),He.maxY=Math.max(He.maxY,J[ie+1])}function Rs(He,J,ie,me){if(!J.geometry)return;const je=J.geometry.coordinates;if(je&&je.length===0)return;const Pe=J.geometry.type,Ie=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2);let Qe=[],Be=J.id;if(ie.promoteId?Be=J.properties[ie.promoteId]:ie.generateId&&(Be=me||0),Pe==="Point")za(je,Qe);else if(Pe==="MultiPoint")for(const Je of je)za(Je,Qe);else if(Pe==="LineString")La(je,Qe,Ie,!1);else if(Pe==="MultiLineString"){if(ie.lineMetrics){for(const Je of je)Qe=[],La(Je,Qe,Ie,!1),He.push(Br(Be,"LineString",Qe,J.properties));return}fs(je,Qe,Ie,!1)}else if(Pe==="Polygon")fs(je,Qe,Ie,!0);else{if(Pe!=="MultiPolygon"){if(Pe==="GeometryCollection"){for(const Je of J.geometry.geometries)Rs(He,{id:Be,geometry:Je,properties:J.properties},ie,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Je of je){const Lt=[];fs(Je,Lt,Ie,!0),Qe.push(Lt)}}He.push(Br(Be,Pe,Qe,J.properties))}function za(He,J){J.push(ps(He[0]),$n(He[1]),0)}function La(He,J,ie,me){let je,Pe,Ie=0;for(let Be=0;Be<He.length;Be++){const Je=ps(He[Be][0]),Lt=$n(He[Be][1]);J.push(Je,Lt,0),Be>0&&(Ie+=me?(je*Lt-Je*Pe)/2:Math.sqrt(Math.pow(Je-je,2)+Math.pow(Lt-Pe,2))),je=Je,Pe=Lt}const Qe=J.length-3;J[2]=1,ds(J,0,Qe,ie),J[Qe+2]=1,J.size=Math.abs(Ie),J.start=0,J.end=J.size}function fs(He,J,ie,me){for(let je=0;je<He.length;je++){const Pe=[];La(He[je],Pe,ie,me),J.push(Pe)}}function ps(He){return He/360+.5}function $n(He){const J=Math.sin(He*Math.PI/180),ie=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return ie<0?0:ie>1?1:ie}function Xn(He,J,ie,me,je,Pe,Ie,Qe){if(me/=J,Pe>=(ie/=J)&&Ie<me)return He;if(Ie<ie||Pe>=me)return null;const Be=[];for(const Je of He){const Lt=Je.geometry;let vt=Je.type;const pi=je===0?Je.minX:Je.minY,Mi=je===0?Je.maxX:Je.maxY;if(pi>=ie&&Mi<me){Be.push(Je);continue}if(Mi<ie||pi>=me)continue;let Vi=[];if(vt==="Point"||vt==="MultiPoint")Ds(Lt,Vi,ie,me,je);else if(vt==="LineString")Ps(Lt,Vi,ie,me,je,!1,Qe.lineMetrics);else if(vt==="MultiLineString")Pn(Lt,Vi,ie,me,je,!1);else if(vt==="Polygon")Pn(Lt,Vi,ie,me,je,!0);else if(vt==="MultiPolygon")for(const lr of Lt){const nr=[];Pn(lr,nr,ie,me,je,!0),nr.length&&Vi.push(nr)}if(Vi.length){if(Qe.lineMetrics&&vt==="LineString"){for(const lr of Vi)Be.push(Br(Je.id,vt,lr,Je.tags));continue}vt!=="LineString"&&vt!=="MultiLineString"||(Vi.length===1?(vt="LineString",Vi=Vi[0]):vt="MultiLineString"),vt!=="Point"&&vt!=="MultiPoint"||(vt=Vi.length===3?"Point":"MultiPoint"),Be.push(Br(Je.id,vt,Vi,Je.tags))}}return Be.length?Be:null}function Ds(He,J,ie,me,je){for(let Pe=0;Pe<He.length;Pe+=3){const Ie=He[Pe+je];Ie>=ie&&Ie<=me&&oa(J,He[Pe],He[Pe+1],He[Pe+2])}}function Ps(He,J,ie,me,je,Pe,Ie){let Qe=Vs(He);const Be=je===0?Da:as;let Je,Lt,vt=He.start;for(let nr=0;nr<He.length-3;nr+=3){const cr=He[nr],Hr=He[nr+1],ur=He[nr+2],mn=He[nr+3],Yr=He[nr+4],Ve=je===0?cr:Hr,wt=je===0?mn:Yr;let Ft=!1;Ie&&(Je=Math.sqrt(Math.pow(cr-mn,2)+Math.pow(Hr-Yr,2))),Ve<ie?wt>ie&&(Lt=Be(Qe,cr,Hr,mn,Yr,ie),Ie&&(Qe.start=vt+Je*Lt)):Ve>me?wt<me&&(Lt=Be(Qe,cr,Hr,mn,Yr,me),Ie&&(Qe.start=vt+Je*Lt)):oa(Qe,cr,Hr,ur),wt<ie&&Ve>=ie&&(Lt=Be(Qe,cr,Hr,mn,Yr,ie),Ft=!0),wt>me&&Ve<=me&&(Lt=Be(Qe,cr,Hr,mn,Yr,me),Ft=!0),!Pe&&Ft&&(Ie&&(Qe.end=vt+Je*Lt),J.push(Qe),Qe=Vs(He)),Ie&&(vt+=Je)}let pi=He.length-3;const Mi=He[pi],Vi=He[pi+1],lr=je===0?Mi:Vi;lr>=ie&&lr<=me&&oa(Qe,Mi,Vi,He[pi+2]),pi=Qe.length-3,Pe&&pi>=3&&(Qe[pi]!==Qe[0]||Qe[pi+1]!==Qe[1])&&oa(Qe,Qe[0],Qe[1],Qe[2]),Qe.length&&J.push(Qe)}function Vs(He){const J=[];return J.size=He.size,J.start=He.start,J.end=He.end,J}function Pn(He,J,ie,me,je,Pe){for(const Ie of He)Ps(Ie,J,ie,me,je,Pe,!1)}function oa(He,J,ie,me){He.push(J,ie,me)}function Da(He,J,ie,me,je,Pe){const Ie=(Pe-J)/(me-J);return oa(He,Pe,ie+(je-ie)*Ie,1),Ie}function as(He,J,ie,me,je,Pe){const Ie=(Pe-ie)/(je-ie);return oa(He,J+(me-J)*Ie,Pe,1),Ie}function va(He,J){const ie=[];for(let me=0;me<He.length;me++){const je=He[me],Pe=je.type;let Ie;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")Ie=Ms(je.geometry,J);else if(Pe==="MultiLineString"||Pe==="Polygon"){Ie=[];for(const Qe of je.geometry)Ie.push(Ms(Qe,J))}else if(Pe==="MultiPolygon"){Ie=[];for(const Qe of je.geometry){const Be=[];for(const Je of Qe)Be.push(Ms(Je,J));Ie.push(Be)}}ie.push(Br(je.id,Pe,Ie,je.tags))}return ie}function Ms(He,J){const ie=[];ie.size=He.size,He.start!==void 0&&(ie.start=He.start,ie.end=He.end);for(let me=0;me<He.length;me+=3)ie.push(He[me]+J,He[me+1],He[me+2]);return ie}function os(He,J){if(He.transformed)return He;const ie=1<<He.z,me=He.x,je=He.y;for(const Pe of He.features){const Ie=Pe.geometry,Qe=Pe.type;if(Pe.geometry=[],Qe===1)for(let Be=0;Be<Ie.length;Be+=2)Pe.geometry.push(hn(Ie[Be],Ie[Be+1],J,ie,me,je));else for(let Be=0;Be<Ie.length;Be++){const Je=[];for(let Lt=0;Lt<Ie[Be].length;Lt+=2)Je.push(hn(Ie[Be][Lt],Ie[Be][Lt+1],J,ie,me,je));Pe.geometry.push(Je)}}return He.transformed=!0,He}function hn(He,J,ie,me,je,Pe){return[Math.round(ie*(He*me-je)),Math.round(ie*(J*me-Pe))]}function Dt(He,J,ie,me,je){const Pe=J===je.maxZoom?0:je.tolerance/((1<<J)*je.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:He.length,source:null,x:ie,y:me,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Qe of He)Ti(Ie,Qe,Pe,je);return Ie}function Ti(He,J,ie,me){const je=J.geometry,Pe=J.type,Ie=[];if(He.minX=Math.min(He.minX,J.minX),He.minY=Math.min(He.minY,J.minY),He.maxX=Math.max(He.maxX,J.maxX),He.maxY=Math.max(He.maxY,J.maxY),Pe==="Point"||Pe==="MultiPoint")for(let Qe=0;Qe<je.length;Qe+=3)Ie.push(je[Qe],je[Qe+1]),He.numPoints++,He.numSimplified++;else if(Pe==="LineString")Ar(Ie,je,He,ie,!1,!1);else if(Pe==="MultiLineString"||Pe==="Polygon")for(let Qe=0;Qe<je.length;Qe++)Ar(Ie,je[Qe],He,ie,Pe==="Polygon",Qe===0);else if(Pe==="MultiPolygon")for(let Qe=0;Qe<je.length;Qe++){const Be=je[Qe];for(let Je=0;Je<Be.length;Je++)Ar(Ie,Be[Je],He,ie,!0,Je===0)}if(Ie.length){let Qe=J.tags||null;if(Pe==="LineString"&&me.lineMetrics){Qe={};for(const Je in J.tags)Qe[Je]=J.tags[Je];Qe.mapbox_clip_start=je.start/je.size,Qe.mapbox_clip_end=je.end/je.size}const Be={geometry:Ie,type:Pe==="Polygon"||Pe==="MultiPolygon"?3:Pe==="LineString"||Pe==="MultiLineString"?2:1,tags:Qe};J.id!==null&&(Be.id=J.id),He.features.push(Be)}}function Ar(He,J,ie,me,je,Pe){const Ie=me*me;if(me>0&&J.size<(je?Ie:me))return void(ie.numPoints+=J.length/3);const Qe=[];for(let Be=0;Be<J.length;Be+=3)(me===0||J[Be+2]>Ie)&&(ie.numSimplified++,Qe.push(J[Be],J[Be+1])),ie.numPoints++;je&&function(Be,Je){let Lt=0;for(let vt=0,pi=Be.length,Mi=pi-2;vt<pi;Mi=vt,vt+=2)Lt+=(Be[vt]-Be[Mi])*(Be[vt+1]+Be[Mi+1]);if(Lt>0===Je)for(let vt=0,pi=Be.length;vt<pi/2;vt+=2){const Mi=Be[vt],Vi=Be[vt+1];Be[vt]=Be[pi-2-vt],Be[vt+1]=Be[pi-1-vt],Be[pi-2-vt]=Mi,Be[pi-1-vt]=Vi}}(Qe,Pe),He.push(Qe)}const br={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Rr{constructor(J,ie){const me=(ie=this.options=function(Pe,Ie){for(const Qe in Ie)Pe[Qe]=Ie[Qe];return Pe}(Object.create(br),ie)).debug;if(me&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let je=function(Pe,Ie){const Qe=[];if(Pe.type==="FeatureCollection")for(let Be=0;Be<Pe.features.length;Be++)Rs(Qe,Pe.features[Be],Ie,Be);else Rs(Qe,Pe.type==="Feature"?Pe:{geometry:Pe},Ie);return Qe}(J,ie);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),je=function(Pe,Ie){const Qe=Ie.buffer/Ie.extent;let Be=Pe;const Je=Xn(Pe,1,-1-Qe,Qe,0,-1,2,Ie),Lt=Xn(Pe,1,1-Qe,2+Qe,0,-1,2,Ie);return(Je||Lt)&&(Be=Xn(Pe,1,-Qe,1+Qe,0,-1,2,Ie)||[],Je&&(Be=va(Je,1).concat(Be)),Lt&&(Be=Be.concat(va(Lt,-1)))),Be}(je,ie),je.length&&this.splitTile(je,0,0,0),me&&(je.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(J,ie,me,je,Pe,Ie,Qe){const Be=[J,ie,me,je],Je=this.options,Lt=Je.debug;for(;Be.length;){je=Be.pop(),me=Be.pop(),ie=Be.pop(),J=Be.pop();const vt=1<<ie,pi=xn(ie,me,je);let Mi=this.tiles[pi];if(!Mi&&(Lt>1&&console.time("creation"),Mi=this.tiles[pi]=Dt(J,ie,me,je,Je),this.tileCoords.push({z:ie,x:me,y:je}),Lt)){Lt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,me,je,Mi.numFeatures,Mi.numPoints,Mi.numSimplified),console.timeEnd("creation"));const Ft=`z${ie}`;this.stats[Ft]=(this.stats[Ft]||0)+1,this.total++}if(Mi.source=J,Pe==null){if(ie===Je.indexMaxZoom||Mi.numPoints<=Je.indexMaxPoints)continue}else{if(ie===Je.maxZoom||ie===Pe)continue;if(Pe!=null){const Ft=Pe-ie;if(me!==Ie>>Ft||je!==Qe>>Ft)continue}}if(Mi.source=null,J.length===0)continue;Lt>1&&console.time("clipping");const Vi=.5*Je.buffer/Je.extent,lr=.5-Vi,nr=.5+Vi,cr=1+Vi;let Hr=null,ur=null,mn=null,Yr=null,Ve=Xn(J,vt,me-Vi,me+nr,0,Mi.minX,Mi.maxX,Je),wt=Xn(J,vt,me+lr,me+cr,0,Mi.minX,Mi.maxX,Je);J=null,Ve&&(Hr=Xn(Ve,vt,je-Vi,je+nr,1,Mi.minY,Mi.maxY,Je),ur=Xn(Ve,vt,je+lr,je+cr,1,Mi.minY,Mi.maxY,Je),Ve=null),wt&&(mn=Xn(wt,vt,je-Vi,je+nr,1,Mi.minY,Mi.maxY,Je),Yr=Xn(wt,vt,je+lr,je+cr,1,Mi.minY,Mi.maxY,Je),wt=null),Lt>1&&console.timeEnd("clipping"),Be.push(Hr||[],ie+1,2*me,2*je),Be.push(ur||[],ie+1,2*me,2*je+1),Be.push(mn||[],ie+1,2*me+1,2*je),Be.push(Yr||[],ie+1,2*me+1,2*je+1)}}getTile(J,ie,me){J=+J,ie=+ie,me=+me;const je=this.options,{extent:Pe,debug:Ie}=je;if(J<0||J>24)return null;const Qe=1<<J,Be=xn(J,ie=ie+Qe&Qe-1,me);if(this.tiles[Be])return os(this.tiles[Be],Pe);Ie>1&&console.log("drilling down to z%d-%d-%d",J,ie,me);let Je,Lt=J,vt=ie,pi=me;for(;!Je&&Lt>0;)Lt--,vt>>=1,pi>>=1,Je=this.tiles[xn(Lt,vt,pi)];return Je&&Je.source?(Ie>1&&(console.log("found parent tile z%d-%d-%d",Lt,vt,pi),console.time("drilling down")),this.splitTile(Je.source,Lt,vt,pi,J,ie,me),Ie>1&&console.timeEnd("drilling down"),this.tiles[Be]?os(this.tiles[Be],Pe):null):null}}function xn(He,J,ie){return 32*((1<<He)*ie+J)+He}function xs(He,J){const ie=He.tileID.canonical;if(!this._geoJSONIndex)return void J(null,null);const me=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!me)return void J(null,null);const je=Je=>Je.tags&&"3d_elevation_id"in Je.tags&&"source"in Je.tags&&Je.tags.source==="elevation",Pe=me.features.filter(Je=>je(Je));let Ie={_geojsonTileLayer:me.features};Pe.length>0&&(Ie={_geojsonTileLayer:me.features.filter(Je=>!je(Je)),hd_road_elevation:Pe});const Qe=new it(Ie),Be=function(Je){const Lt=new s.bt;for(const vt of Object.keys(Je))Lt.writeMessage(3,Fi,{name:vt,features:Je[vt]});return Lt.finish()}(Ie).buffer;J(null,{vectorTile:Qe,rawData:Be})}class Ct extends ee{constructor(J,ie,me,je,Pe,Ie,Qe){super(J,ie,me,je,Pe,xs,Qe),Ie&&(this.loadGeoJSON=Ie),this._dynamicIndex=new zt}loadData(J,ie){const me=J&&J.request,je=me&&me.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(J,(Pe,Ie)=>{if(Pe||!Ie)return ie(Pe);if(typeof Ie!="object")return ie(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));{try{if(J.filter){const Be=s.U(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map(Je=>`${Je.key}: ${Je.message}`).join(", "));Ie.features=Ie.features.filter(Je=>Be.value.evaluate({zoom:0},Je))}J.dynamic?(Ie.type==="Feature"&&(Ie={type:"FeatureCollection",features:[Ie]}),J.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ie.features,this.loaded),J.cluster&&(Ie.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=J.cluster?new Si(function({superclusterOptions:Be,clusterProperties:Je}){if(!Je||!Be)return Be;const Lt={},vt={},pi={accumulated:null,zoom:0},Mi={properties:null},Vi=Object.keys(Je);for(const lr of Vi){const[nr,cr]=Je[lr],Hr=s.U(cr),ur=s.U(typeof nr=="string"?[nr,["accumulated"],["get",lr]]:nr);Lt[lr]=Hr.value,vt[lr]=ur.value}return Be.map=lr=>{Mi.properties=lr;const nr={};for(const cr of Vi)nr[cr]=Lt[cr].evaluate(pi,Mi);return nr},Be.reduce=(lr,nr)=>{Mi.properties=nr;for(const cr of Vi)pi.accumulated=lr[cr],lr[cr]=vt[cr].evaluate(pi,Mi)},Be}(J)).load(Ie.features):J.dynamic?this._dynamicIndex:function(Be,Je){return new Rr(Be,Je)}(Ie,J.geojsonVtOptions)}catch(Be){return ie(Be)}const Qe={};if(je){const Be=q(me);Be&&(Qe.resourceTiming={},Qe.resourceTiming[J.source]=JSON.parse(JSON.stringify(Be)))}ie(null,Qe)}})}reloadTile(J,ie){const me=this.loaded;return me&&me[J.uid]?J.partial?ie(null,void 0):super.reloadTile(J,ie):this.loadTile(J,ie)}loadGeoJSON(J,ie){if(J.request)s.m(J.request,ie);else{if(typeof J.data!="string")return ie(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ie(null,JSON.parse(J.data))}catch{return ie(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(J,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(J.clusterId))}catch(me){ie(me)}}getClusterChildren(J,ie){try{ie(null,this._geoJSONIndex.getChildren(J.clusterId))}catch(me){ie(me)}}getClusterLeaves(J,ie){try{ie(null,this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset))}catch(me){ie(me)}}}class Hs{constructor(J,ie,me){this.tileID=new s.aO(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.tileZoom=J.tileZoom,this.uid=J.uid,this.zoom=J.zoom,this.canonical=J.tileID.canonical,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=J.projection,this.brightness=ie,this.worldview=me}parse(J,ie,me,je){this.status="parsing";const Pe=new s.aO(me.tileID.overscaledZ,me.tileID.wrap,me.tileID.canonical.z,me.tileID.canonical.x,me.tileID.canonical.y),Ie=[],Qe=ie.familiesBySource[me.source],Be=new s.fe(Pe,me.promoteId);Be.bucketLayerIDs=[],Be.is3DTile=!0,s.ft(J).then(Je=>{if(!Je)return je(new Error("Could not parse tile"));const Lt=Je.json.extensionsUsed&&Je.json.extensionsUsed.includes("MAPBOX_mesh_features")||Je.json.asset.extras&&Je.json.asset.extras.MAPBOX_mesh_features,vt=Je.json.extensionsUsed&&Je.json.extensionsUsed.includes("EXT_meshopt_compression"),pi=new s.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Mi in Qe)for(const Vi of Qe[Mi]){const lr=Vi[0];Be.bucketLayerIDs.push(Vi.map(Hr=>s.B(Hr.id,Hr.scope))),lr.recalculate(pi,[]);const nr=s.fu(Je,1/s.d6(me.tileID.canonical)),cr=new s.fv(Vi,nr,Pe,Lt,vt,this.brightness,Be,this.worldview);Lt||(cr.needsUpload=!0),Ie.push(cr),cr.evaluate(lr)}this.status="done",je(null,{buckets:Ie,featureIndex:Be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Je=>je(new Error(Je.message)))}}class Pa{constructor(J,ie,me,je,Pe,Ie,Qe,Be){this.actor=J,this.layerIndex=ie,this.availableImages=me,this.availableModels=je,this.brightness=Qe,this.loading={},this.loaded={},this.worldview=Be}loadTile(J,ie){const me=J.uid,je=this.loading[me]=new Hs(J,this.brightness,this.worldview);s.bu(J.request,(Pe,Ie)=>{const Qe=!this.loading[me];return delete this.loading[me],Qe||Pe?(je.status="done",Qe||(this.loaded[me]=je),ie(Pe)):Ie&&Ie.byteLength!==0?void je.parse(Ie,this.layerIndex,J,(Be,Je)=>{je.status="done",this.loaded=this.loaded||{},this.loaded[me]=je,Be||!Je?ie(Be):ie(null,Je)}):(je.status="done",this.loaded[me]=je,ie())})}reloadTile(J,ie){const me=this.loaded,je=J.uid;if(me&&me[je]){const Pe=me[je];Pe.projection=J.projection,Pe.brightness=J.brightness;const Ie=(Qe,Be)=>{Pe.reloadCallback&&(delete Pe.reloadCallback,this.loadTile(J,ie)),ie(Qe,Be)};Pe.status==="parsing"?Pe.reloadCallback=Ie:Pe.status==="done"&&this.loadTile(J,ie)}}abortTile(J,ie){const me=J.uid;this.loading[me]&&delete this.loading[me],ie()}removeTile(J,ie){const me=this.loaded,je=J.uid;me&&me[je]&&delete me[je],ie()}}class ba{constructor(J){this.self=J,this.actor=new s.fx(J,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.cl({name:"mercator"}),this.workerSourceTypes={vector:ee,geojson:Ct,"raster-dem":_e,"raster-array":xe,"batched-model":Pa},this.workerSources={},this.self.registerWorkerSource=(ie,me)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=me},this.self.registerRTLTextPlugin=ie=>{if(s.fy.isParsed())throw new Error("RTL text plugin already registered.");s.fy.setState({pluginStatus:s.fz.parsed,pluginURL:s.fy.getPluginURL()}),s.fy.applyArabicShaping=ie.applyArabicShaping,s.fy.processBidirectionalText=ie.processBidirectionalText,s.fy.processStyledBidirectionalText=ie.processStyledBidirectionalText;for(const me of this.rtlPluginParsingListeners)me(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(J,ie,me){delete this.layerIndexes[J],delete this.availableImages[J],delete this.availableModels[J],delete this.workerSources[J],me()}checkIfReady(J,ie,me){me()}setReferrer(J,ie){this.referrer=ie}spriteLoaded(J,ie){this.isSpriteLoaded[J]||(this.isSpriteLoaded[J]={});const{scope:me,isLoaded:je}=ie;if(this.isSpriteLoaded[J][me]=je,this.workerSources[J]&&this.workerSources[J][me])for(const Pe in this.workerSources[J][me]){const Ie=this.workerSources[J][me][Pe];for(const Qe in Ie){const Be=Ie[Qe];Be instanceof ee&&(Be.isSpriteLoaded=je,Be.fire(new s.z("isSpriteLoaded")))}}}setImages(J,ie,me){this.availableImages[J]||(this.availableImages[J]={});const{scope:je,images:Pe}=ie;if(this.availableImages[J][je]=Pe,this.workerSources[J]&&this.workerSources[J][je]){for(const Ie in this.workerSources[J][je]){const Qe=this.workerSources[J][je][Ie];for(const Be in Qe)Qe[Be].availableImages=Pe}me()}else me()}setModels(J,{scope:ie,models:me},je){if(this.availableModels[J]||(this.availableModels[J]={}),this.availableModels[J][ie]=me,this.workerSources[J]&&this.workerSources[J][ie]){for(const Pe in this.workerSources[J][ie]){const Ie=this.workerSources[J][ie][Pe];for(const Qe in Ie)Ie[Qe].availableModels=me}je()}else je()}setProjection(J,ie){this.projections[J]=s.cl(ie)}setBrightness(J,ie,me){this.brightness=ie,me()}setWorldview(J,ie,me){this.worldview=ie,me()}setLayers(J,ie,me){this.getLayerIndex(J,ie.scope).replace(ie.layers,ie.options),me()}updateLayers(J,ie,me){this.getLayerIndex(J,ie.scope).update(ie.layers,ie.removedIds,ie.options),me()}loadTile(J,ie,me){ie.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,ie.type,ie.source,ie.scope).loadTile(ie,me)}decodeRasterArray(J,ie,me){this.getWorkerSource(J,ie.type,ie.source,ie.scope).decodeRasterArray(ie,me)}reloadTile(J,ie,me){ie.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,ie.type,ie.source,ie.scope).reloadTile(ie,me)}abortTile(J,ie,me){this.getWorkerSource(J,ie.type,ie.source,ie.scope).abortTile(ie,me)}removeTile(J,ie,me){this.getWorkerSource(J,ie.type,ie.source,ie.scope).removeTile(ie,me)}removeSource(J,ie,me){if(!(this.workerSources[J]&&this.workerSources[J][ie.scope]&&this.workerSources[J][ie.scope][ie.type]&&this.workerSources[J][ie.scope][ie.type][ie.source]))return;const je=this.workerSources[J][ie.scope][ie.type][ie.source];delete this.workerSources[J][ie.scope][ie.type][ie.source],je.removeSource!==void 0?je.removeSource(ie,me):me()}loadWorkerSource(J,ie,me){try{this.self.importScripts(ie.url),me()}catch(je){me(je.toString())}}syncRTLPluginState(J,ie,me){if(s.fy.isParsed())me(null,!0);else if(s.fy.isParsing())this.rtlPluginParsingListeners.push(me);else try{s.fy.setState(ie);const je=s.fy.getPluginURL();!s.fy.isLoaded()||s.fy.isParsed()||s.fy.isParsing()||je==null||(s.fy.setState({pluginStatus:s.fz.parsing,pluginURL:s.fy.getPluginURL()}),this.self.importScripts(je),s.fy.isParsed()?me(null,!0):this.rtlPluginParsingListeners.push(me))}catch(je){me(je.toString())}}setDracoUrl(J,ie){this.dracoUrl=ie}getAvailableImages(J,ie){this.availableImages[J]||(this.availableImages[J]={});let me=this.availableImages[J][ie];return me||(me=[]),me}getAvailableModels(J,ie){this.availableModels[J]||(this.availableModels[J]={});let me=this.availableModels[J][ie];return me||(me={}),me}getLayerIndex(J,ie){this.layerIndexes[J]||(this.layerIndexes[J]={});let me=this.layerIndexes[J][ie];return me||(me=this.layerIndexes[J][ie]=new oe,me.scope=ie),me}getWorkerSource(J,ie,me,je){const Pe=this.workerSources;return Pe[J]||(Pe[J]={}),Pe[J][je]||(Pe[J][je]={}),Pe[J][je][ie]||(Pe[J][je][ie]={}),this.isSpriteLoaded[J]||(this.isSpriteLoaded[J]={}),Pe[J][je][ie][me]||(Pe[J][je][ie][me]=new this.workerSourceTypes[ie]({send:(Ie,Qe,Be,Je,Lt,vt)=>this.actor.send(Ie,Qe,Be,J,Lt,vt),scheduler:this.actor.scheduler},this.getLayerIndex(J,je),this.getAvailableImages(J,je),this.getAvailableModels(J,je),this.isSpriteLoaded[J][je],void 0,this.brightness,this.worldview)),Pe[J][je][ie][me]}rasterizeImagesWorker(J,ie,me){const je=new Map;for(const[Pe,{image:Ie,imageVariant:Qe}]of ie.tasks.entries()){const Be=this.imageRasterizer.rasterize(Qe,Ie,ie.scope,J);je.set(Pe,Be)}me(void 0,je)}removeRasterizedImages(J,ie,me){this.imageRasterizer.removeImagesFromCacheByIds(ie.imageIds,ie.scope,J),me()}enforceCacheSizeLimit(J,ie){s.fA(ie)}getWorkerPerformanceMetrics(J,ie,me){me(void 0,void 0)}}return s.fw(self)&&(self.worker=new ba(self)),ba}),N(["./shared"],function(s){var q="3.15.0";const Z={create:"create",load:"load",fullLoad:"fullLoad"},Q={mark(u){performance.mark(u)},measure(u,t,n){performance.measure(u,t,n)}};function oe(u){const t=u.name.split("?")[0];return s.a(t)&&t.includes("mapbox-gl.js")?"javascript":s.a(t)&&t.includes("mapbox-gl.css")?"css":s.b(t)?"fontRange":s.c(t)?"sprite":s.i(t)?"style":s.d(t)?"tilejson":"other"}var de,ze={},le=function(){if(de)return ze;function u(c){return!t(c)}function t(c){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,w,E=new Blob([""],{type:"text/javascript"}),R=URL.createObjectURL(E);try{w=new Worker(R),y=!0}catch{y=!1}return w&&w.terminate(),URL.revokeObjectURL(R),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var w=y.getContext("2d");if(!w)return!1;var E=w.getImageData(0,0,1,1);return E&&E.width===y.width}()?(n[m=c&&c.failIfMajorPerformanceCaveat]===void 0&&(n[m]=function(y){var w,E=function(R){var L=document.createElement("canvas"),P=Object.create(u.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=R,L.getContext("webgl2",P)}(y);if(!E)return!1;try{w=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!w||E.isContextLost())&&(E.shaderSource(w,"void main() {}"),E.compileShader(w),E.getShaderParameter(w,E.COMPILE_STATUS)===!0)}(m)),n[m]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var m}de=1,ze.supported=u,ze.notSupportedReason=t;var n={};return u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ze}();function Se(u,t,n){const c=document.createElement(u);return t!=null&&(c.className=t),n&&n.appendChild(c),c}function ee(u,t,n){const c=document.createElementNS("http://www.w3.org/2000/svg",u);for(const m of Object.keys(t))c.setAttributeNS(null,m,String(t[m]));return n&&n.appendChild(c),c}const _e=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ye=_e&&_e.userSelect!==void 0?"userSelect":"WebkitUserSelect";let xe;function Le(){_e&&ye&&(xe=_e[ye],_e[ye]="none")}function Ae(){_e&&ye&&(_e[ye]=xe)}function Ke(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",Ke,!0)}function it(){window.addEventListener("click",Ke,!0),window.setTimeout(()=>{window.removeEventListener("click",Ke,!0)},0)}function rt(u,t){const n=u.getBoundingClientRect();return xt(u,n,t)}function lt(u,t){const n=u.getBoundingClientRect(),c=[];for(let m=0;m<t.length;m++)c.push(xt(u,n,t[m]));return c}function zt(u){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&u.button===2&&u.ctrlKey?0:u.button}function xt(u,t,n){const c=u.offsetWidth===t.width?1:u.offsetWidth/t.width;return new s.P((n.clientX-t.left)*c,(n.clientY-t.top)*c)}const Ci="01",Zi="NO_ACCESS_TOKEN";class or{constructor(t,n,c){this._transformRequestFn=t,this._customAccessToken=n,this._silenceAuthErrors=!!c,this._createSkuToken()}_createSkuToken(){const t=function(){let n="";for(let c=0;c<10;c++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ci,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeStyleURL(t,n){if(!s.h(t))return t;const c=Jt(t);return c.params.push(`sdk=js-${q}`),c.path=`/styles/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||n)}normalizeGlyphsURL(t,n){if(!s.h(t))return t;const c=Jt(t);return c.path=`/fonts/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||n)}normalizeModelURL(t,n){if(!s.h(t))return t;const c=Jt(t);return c.path=`/models/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||n)}normalizeSourceURL(t,n,c,m){if(!s.h(t))return t;const y=Jt(t);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),c&&y.params.push(`language=${c}`),m&&y.params.push(`worldview=${m}`),this._makeAPIURL(y,this._customAccessToken||n)}normalizeIconsetURL(t,n){const c=Jt(t);return s.h(t)?(c.path=`/styles/v1${c.path}/iconset.pbf`,this._makeAPIURL(c,this._customAccessToken||n)):ji(c)}normalizeSpriteURL(t,n,c,m){const y=Jt(t);return s.h(t)?(y.path=`/styles/v1${y.path}/sprite${n}${c}`,this._makeAPIURL(y,this._customAccessToken||m)):(y.path+=`${n}${c}`,ji(y))}normalizeTileURL(t,n,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!s.h(t))return t;const m=Jt(t);m.path=m.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||c&&m.authority!=="raster"&&c===512?"@2x":""}${s.k.supported?".webp":"$1"}`),m.authority==="raster"?m.path=`/${s.e.RASTER_URL_PREFIX}${m.path}`:m.authority==="rasterarrays"?m.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${m.path}`:m.authority==="3dtiles"?m.path=`/${s.e.TILES3D_URL_PREFIX}${m.path}`:(m.path=m.path.replace(/^.+\/v4\//,"/"),m.path=`/${s.e.TILE_URL_VERSION}${m.path}`);const y=this._customAccessToken||function(w){for(const E of w){const R=E.match(/^access_token=(.*)$/);if(R)return R[1]}return null}(m.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&m.params.push(`sku=${this._skuToken}`),this._makeAPIURL(m,y)}canonicalizeTileURL(t,n){const c=Jt(t);if(!c.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!c.path.match(/\.[\w]+$/))return t;let m="mapbox://";c.path.match(/^\/raster\/v1\//)?m+=`raster/${c.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:c.path.match(/^\/rasterarrays\/v1\//)?m+=`rasterarrays/${c.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:m+=`tiles/${c.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let y=c.params;return n&&(y=y.filter(w=>!w.match(/^access_token=/))),y.length&&(m+=`?${y.join("&")}`),m}canonicalizeTileset(t,n){const c=!!n&&s.h(n),m=[];for(const y of t.tiles||[])s.j(y)?m.push(this.canonicalizeTileURL(y,c)):m.push(y);return m}_makeAPIURL(t,n){const c="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",m=Jt(s.e.API_URL);if(t.protocol=m.protocol,t.authority=m.authority,t.protocol==="http"){const y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(m.path!=="/"&&(t.path=`${m.path}${t.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return ji(t);if(n=n||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${c}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${c}`)}return t.params=t.params.filter(y=>y.indexOf("access_token")===-1),t.params.push(`access_token=${n||""}`),ji(t)}}const er=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Jt(u){const t=u.match(er);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ji(u){const t=u.params.length?`?${u.params.join("&")}`:"";return`${u.protocol}://${u.authority}${u.path}${t}`}const Fi="mapbox.eventData";function Pr(u){if(!u)return null;const t=u.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(s.l(t[1]))}catch{return null}}class tt{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=Pr(s.e.ACCESS_TOKEN);let c="";return c=n&&n.u?s.f(n.u):s.e.ACCESS_TOKEN||"",t?`${Fi}.${t}:${c}`:`${Fi}:${c}`}fetchEventData(){const t=s.s("localStorage"),n=this.getStorageKey(),c=this.getStorageKey("uuid");if(t)try{const m=localStorage.getItem(n);m&&(this.eventData=JSON.parse(m));const y=localStorage.getItem(c);y&&(this.anonId=y)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const t=s.s("localStorage"),n=this.getStorageKey(),c=this.getStorageKey("uuid"),m=this.anonId;if(t&&m)try{localStorage.setItem(c,m),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,c,m){if(!s.e.EVENTS_URL)return;const y=Jt(s.e.EVENTS_URL);y.params.push(`access_token=${m||s.e.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(t).toISOString()},E=n?Object.assign(w,n):w,R={url:ji(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([E])};this.pendingRequest=s.p(R,L=>{this.pendingRequest=null,c(L),this.saveEventData(),this.processRequests(m)})}queueRequest(t,n){this.queue.push(t),this.processRequests(n)}}const Ht=new class extends tt{constructor(u){super("appUserTurnstile"),this._customAccessToken=u}postTurnstileEvent(u,t){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(u)&&u.some(n=>s.h(n)||s.j(n))&&this.queueRequest(Date.now(),t)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Pr(s.e.ACCESS_TOKEN),n=t?t.u:s.e.ACCESS_TOKEN;let c=n!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),c=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),w=new Date(m),E=(m-this.eventData.lastSuccess)/864e5;c=c||E>=1||E<-1||y.getDate()!==w.getDate()}else c=!0;c?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:q,skuId:Ci,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=m,this.eventData.tokenU=n)},u):this.processRequests()}},Pi=Ht.postTurnstileEvent.bind(Ht),Ui=new class extends tt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(u,t,n,c){this.skuToken=t,this.errorCb=c,s.e.EVENTS_URL&&(n||s.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},n):this.errorCb(new Error(Zi)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:q,skuId:Ci,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},u))}remove(){this.errorCb=null}},ii=Ui.postMapLoadEvent.bind(Ui),Wi=new class extends tt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(u){let t=this.mapInstanceIdMap.get(u);return t||(t=s.u(),this.mapInstanceIdMap.set(u,t)),t}getEventId(u){const t=this.eventIdPerMapInstanceMap.get(u)||0;return this.eventIdPerMapInstanceMap.set(u,t+1),t}postStyleLoadEvent(u,t){const{map:n,style:c,importedStyles:m}=t;if(!s.e.EVENTS_URL||!u&&!s.e.ACCESS_TOKEN)return;const y=this.getMapInstanceId(n),w={mapInstanceId:y,eventId:this.getEventId(y),style:c};m.length&&(w.importedStyles=m),this.queueRequest({timestamp:Date.now(),payload:w},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:n}=this.queue.shift();this.postEvent(t,n,()=>{},u)}},_i=Wi.postStyleLoadEvent.bind(Wi),Ri=new class extends tt{constructor(){super("gljs.performance")}postPerformanceEvent(u,t){s.e.EVENTS_URL&&(u||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:n}=this.queue.shift(),c=function(m){const y=performance.getEntriesByType("resource"),w=performance.getEntriesByType("mark"),E=function(H){const $={};if(H){for(const G in H)if(G!=="other")for(const te of H[G]){const X=`${G}ResolveRangeMin`,re=`${G}ResolveRangeMax`,ce=`${G}RequestCount`,fe=`${G}RequestCachedCount`;$[X]=Math.min($[X]||1/0,te.startTime),$[re]=Math.max($[re]||-1/0,te.responseEnd);const Te=we=>{$[we]===void 0&&($[we]=0),++$[we]};te.transferSize!==void 0&&te.transferSize===0&&Te(fe),Te(ce)}}return $}(function(H,$){const G={};if(H)for(const te of H){const X=$(te);G[X]===void 0&&(G[X]=[]),G[X].push(te)}return G}(y,oe)),R=window.devicePixelRatio,L=navigator.connection||navigator.mozConnection||navigator.webkitConnection,P=L?L.effectiveType:void 0,F={counters:[],metadata:[],attributes:[]},j=(H,$,G)=>{G!=null&&H.push({name:$,value:G.toString()})};for(const H in E)j(F.counters,H,E[H]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(j(F.counters,"interactionRangeMin",m.interactionRange[0]),j(F.counters,"interactionRangeMax",m.interactionRange[1])),w)for(const H of Object.keys(Z)){const $=Z[H],G=w.find(te=>te.name===$);G&&j(F.counters,$,G.startTime)}return j(F.counters,"visibilityHidden",m.visibilityHidden),j(F.attributes,"style",function(H){if(H)for(const $ of H){const G=$.name.split("?")[0];if(s.i(G)){const te=G.split("/").slice(-2);if(te.length===2)return`mapbox://styles/${te[0]}/${te[1]}`}}}(y)),j(F.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),j(F.attributes,"fogEnabled",m.fogEnabled?"true":"false"),j(F.attributes,"projection",m.projection),j(F.attributes,"zoom",m.zoom),j(F.metadata,"devicePixelRatio",R),j(F.metadata,"connectionEffectiveType",P),j(F.metadata,"navigatorUserAgent",navigator.userAgent),j(F.metadata,"screenWidth",window.screen.width),j(F.metadata,"screenHeight",window.screen.height),j(F.metadata,"windowWidth",window.innerWidth),j(F.metadata,"windowHeight",window.innerHeight),j(F.metadata,"mapWidth",m.width/R),j(F.metadata,"mapHeight",m.height/R),j(F.metadata,"webglRenderer",m.renderer),j(F.metadata,"webglVendor",m.vendor),j(F.metadata,"sdkVersion",q),j(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(n);for(const m of c.metadata);for(const m of c.counters);for(const m of c.attributes);this.postEvent(t,c,()=>{},u)}},Ai=Ri.postPerformanceEvent.bind(Ri),gt=new class extends tt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(u,t,n,c){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const m=Jt(s.e.API_URL+s.e.SESSION_PATH);m.params.push(`sku=${t||""}`),m.params.push(`access_token=${c||s.e.ACCESS_TOKEN||""}`);const y={url:ji(m),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(y,w=>{this.pendingRequest=null,n(w),this.saveEventData(),this.processRequests(c)})}getSessionAPI(u,t,n,c){this.skuToken=t,this.errorCb=c,s.e.SESSION_PATH&&s.e.API_URL&&(n||s.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},n):this.errorCb(new Error(Zi)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},u)}remove(){this.errorCb=null}},Tt=gt.getSessionAPI.bind(gt),Si=new Set;function Sr(u,t){t?Si.add(u):Si.delete(u)}class Cr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,n){this._updatedSourceCaches[t]=n,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const n=t.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(t.id),this.setDirty()}removeLayer(t){const n=t.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][t.id]=t,this._updatedLayers[n].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const n in this._updatedLayers)t[n]=t[n]||{},t[n].updatedIds=Array.from(this._updatedLayers[n].values());for(const n in this._removedLayers)t[n]=t[n]||{},t[n].removedIds=Object.keys(this._removedLayers[n]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,n){this._updatedImages[n]=this._updatedImages[n]||new Set,this._updatedImages[n].add(s.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function zr(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class Er extends s.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&s.r()&&(this.imageRasterizerDispatcher=new s.D(s.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new s.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const n=this.atlasTexture.get(t);n&&(n.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,n){this.imageProviders.has(n)||this.imageProviders.set(n,new Map),this.imageProviders.get(n).set(t.id,t)}removeImageProvider(t,n){this.imageProviders.has(n)&&this.imageProviders.get(n).delete(t)}getPendingImageProviders(){const t=[];for(const n of this.imageProviders.values())for(const c of n.values())c.hasPendingRequests()&&t.push(c);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,n){if(this.loaded.get(n)!==t&&(this.loaded.set(n,t),t)){for(const{ids:c,callback:m}of this.requestors)this._notify(c,n,m);this.requestors=[]}}hasImage(t,n){return!!this.getImage(t,n)}getImage(t,n){return this.images.get(n).get(t.toString())}addImage(t,n,c){this._validate(t,c)&&this.images.get(n).set(t.toString(),c)}_validate(t,n){let c=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),c=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),c=!1),this._validateContent(n.content,n)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "content" value`))),c=!1),c}_validateStretch(t,n){if(!t)return!0;let c=0;for(const m of t){if(m[0]<c||m[1]<m[0]||n<m[1])return!1;c=m[1]}return!0}_validateContent(t,n){return t?t.length!==4||!n.usvg&&(t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,n,c){const m=this.images.get(n).get(t.toString());c.version=m.version+1,this.images.get(n).set(t.toString(),c),this.updatedImages.get(n).add(t),this.removeFromImageRasterizerCache(t,n)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,n){this.spriteFormat!=="raster"&&(s.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:n}):this.imageRasterizer.removeImagesFromCacheByIds([t],n))}removeImage(t,n){const c=this.images.get(n),m=c.get(t.toString());c.delete(t.toString()),this.patterns.get(n).delete(t.toString()),this.removeFromImageRasterizerCache(t,n),m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(n=>s.I.from(n))}getImages(t,n,c){const m=[],y=[],w=this.imageProviders.get(n);for(const P of t){if(!P.iconsetId){m.push(P);continue}const F=w.get(P.iconsetId);F&&(this.getImage(P,n)?y.push(P):F.addPendingRequest(P))}if(m.length===0)return void this._notify(y,n,c);let E=!0;const R=!!this.loaded.get(n),L=this.images.get(n);if(!R)for(const P of m)L.has(P.toString())||(E=!1);R||E?this._notify(m,n,c):this.requestors.push({ids:m,scope:n,callback:c})}rasterizeImages(t,n){const c=new Map,{tasks:m,scope:y}=t;for(const[w,E]of m.entries()){const R=this.getImage(E.id,y);R&&c.set(w,{image:R,imageVariant:E})}this._rasterizeImages(y,c,n)}_rasterizeImages(t,n,c){if(s.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:n,scope:t},c);else{const m=new Map;for(const[y,{image:w,imageVariant:E}]of n.entries())m.set(y,this.imageRasterizer.rasterize(E,w,t,0));c(void 0,m)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,n,c){const m=this.images.get(n),y=new Map;for(const w of t){if(!m.get(w.toString())){if(w.iconsetId)continue;this.fire(new s.z("styleimagemissing",{id:w.name}))}const E=m.get(w.toString());if(!E){s.w(`Image "${w.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const R={data:E.usvg?null:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,usvg:E.usvg,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)};E.usvg&&Object.assign(R,{width:E.icon.usvg_tree.width,height:E.icon.usvg_tree.height}),y.set(s.I.toString(w),R)}c(null,y)}getPixelSize(t){const{width:n,height:c}=this.atlasImage.get(t);return{width:n,height:c}}getPattern(t,n,c){const m=t.toString(),y=this.patterns.get(n),w=y.get(m),E=this.getImage(t,n);if(!E)return null;if(w){if(w.position.version===E.version)return w.position;w.position.version=E.version}else{if(E.usvg&&!E.data){const R=this.getPatternInFlightId(m,n);if(this.patternsInFlight.has(R))return null;this.patternsInFlight.add(R);const L=new s.A(t).scaleSelf(s.o.devicePixelRatio),P=new Map([[L.toString(),{image:E,imageVariant:L}]]);return this._rasterizeImages(n,P,(F,j)=>this.storePatternImage(L,n,E,c,j)),null}this.storePattern(t,n,E)}return this._updatePatternAtlas(n,c),y.get(m).position}getPatternInFlightId(t,n){return s.B(t,n)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,n,c,m,y){const w=t.toString(),E=y?y.get(w):void 0;E&&(c.data=E,this.storePattern(t.id,n,c),this._updatePatternAtlas(n,m),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),n)))}storePattern(t,n,c){const m={w:c.data.width+2*s.C,h:c.data.height+2*s.C,x:0,y:0},y=new s.F(m,c,s.C);this.patterns.get(n).set(t.toString(),{bin:m,position:y})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,n){const c=t.gl;let m=this.atlasTexture.get(n);m?this.dirty&&(m.update(this.atlasImage.get(n)),this.dirty=!1):(m=new s.T(t,this.atlasImage.get(n),c.RGBA8),this.atlasTexture.set(n,m)),m.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(t,n){const c=this.patterns.get(t),m=Array.from(c.values()).map(({bin:L})=>L),{w:y,h:w}=s.G(m),E=this.atlasImage.get(t);E.resize({width:y||1,height:w||1});const R=this.images.get(t);for(const[L,{bin:P,position:F}]of c.entries()){let j=F.padding;const H=P.x+j,$=P.y+j,G=R.get(L).data,te=G.width,X=G.height;j=j>1?j-1:j,s.q.copy(G,E,{x:0,y:0},{x:H,y:$},{width:te,height:X},n),s.q.copy(G,E,{x:0,y:X-j},{x:H,y:$-j},{width:te,height:j},n),s.q.copy(G,E,{x:0,y:0},{x:H,y:$+X},{width:te,height:j},n),s.q.copy(G,E,{x:te-j,y:0},{x:H-j,y:$},{width:j,height:X},n),s.q.copy(G,E,{x:0,y:0},{x:H+te,y:$},{width:j,height:X},n),s.q.copy(G,E,{x:te-j,y:X-j},{x:H-j,y:$-j},{width:j,height:j},n),s.q.copy(G,E,{x:0,y:X-j},{x:H+te,y:$-j},{width:j,height:j},n),s.q.copy(G,E,{x:0,y:0},{x:H+te,y:$+X},{width:j,height:j},n),s.q.copy(G,E,{x:te-j,y:0},{x:H-j,y:$+X},{width:j,height:j},n)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,n){const c=this.images.get(n);for(const m of t){if(this.callbackDispatchedThisFrame.get(n).has(m.toString()))continue;this.callbackDispatchedThisFrame.get(n).add(m.toString());const y=c.get(m.toString());zr(y)&&this.updateImage(m,n,y)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Gn(u){const t=u.value,n=u.valueSpec,c=u.style,m=u.styleSpec,y=u.key,w=u.arrayElementValidator||hn;if(!Array.isArray(t))return[new s.V(y,t,`array expected, ${s.K(t)} found`)];if(n.length&&t.length!==n.length)return[new s.V(y,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new s.V(y,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let E={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};m.$version<7&&(E.function=n.function),s.H(n.value)&&(E=n.value);let R=[];for(let L=0;L<t.length;L++)R=R.concat(w({array:t,arrayIndex:L,value:t[L],valueSpec:E,style:c,styleSpec:m,key:`${y}[${L}]`},!0));return R}function ds(u){const t=u.key,n=u.value,c=u.valueSpec;if(!s.L(n))return[new s.V(t,n,`number expected, ${s.K(n)} found`)];if(n!=n)return[new s.V(t,n,"number expected, NaN found")];if("minimum"in c){let m=c.minimum;if(Array.isArray(c.minimum)&&(m=c.minimum[u.arrayIndex]),n<m)return[new s.V(t,n,`${n} is less than the minimum value ${m}`)]}if("maximum"in c){let m=c.maximum;if(Array.isArray(c.maximum)&&(m=c.maximum[u.arrayIndex]),n>m)return[new s.V(t,n,`${n} is greater than the maximum value ${m}`)]}return[]}function Zs(u){const t=u.key,n=u.value;if(!s.H(n))return[new s.V(t,n,`object expected, ${s.K(n)} found`)];const c=u.valueSpec,m=s.J(n.type);let y,w,E,R={};const L=m!=="categorical"&&n.property===void 0,P=!L,F=function(G){const te=G.stops;return Array.isArray(te)&&Array.isArray(te[0])&&s.H(te[0][0])}(n),j=Dt({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(G){if(m==="identity")return[new s.V(G.key,G.value,'identity function may not have a "stops" property')];let te=[];const X=G.value;return te=te.concat(Gn({key:G.key,value:X,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:H})),Array.isArray(X)&&X.length===0&&te.push(new s.V(G.key,X,"array must have at least one stop")),te},default:function(G){return hn({key:G.key,value:G.value,valueSpec:c,style:G.style,styleSpec:G.styleSpec})}}});return m==="identity"&&L&&j.push(new s.V(u.key,u.value,'missing required property "property"')),m==="identity"||n.stops||j.push(new s.V(u.key,u.value,'missing required property "stops"')),m==="exponential"&&c.expression&&!s.M(c)&&j.push(new s.V(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(P&&!s.N(c)?j.push(new s.V(u.key,u.value,"property functions not supported")):L&&!s.O(c)&&j.push(new s.V(u.key,u.value,"zoom functions not supported"))),m!=="categorical"&&!F||n.property!==void 0||j.push(new s.V(u.key,u.value,'"property" property is required')),j;function H(G){let te=[];const X=G.value,re=G.key;if(!Array.isArray(X))return[new s.V(re,X,`array expected, ${s.K(X)} found`)];if(X.length!==2)return[new s.V(re,X,`array length 2 expected, length ${X.length} found`)];if(F){if(!s.H(X[0]))return[new s.V(re,X,`object expected, ${s.K(X[0])} found`)];const ce=X[0];if(ce.zoom===void 0)return[new s.V(re,X,"object stop key must have zoom")];if(ce.value===void 0)return[new s.V(re,X,"object stop key must have value")];const fe=s.J(ce.zoom);if(typeof fe!="number")return[new s.V(re,ce.zoom,"stop zoom values must be numbers")];if(E&&E>fe)return[new s.V(re,ce.zoom,"stop zoom values must appear in ascending order")];fe!==E&&(E=fe,w=void 0,R={}),te=te.concat(Dt({key:`${re}[0]`,value:X[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:ds,value:$}}))}else te=te.concat($({key:`${re}[0]`,value:X[0],style:G.style,styleSpec:G.styleSpec},X));return s.Q(s.S(X[1]))?te.concat([new s.V(`${re}[1]`,X[1],"expressions are not allowed in function stops.")]):te.concat(hn({key:`${re}[1]`,value:X[1],valueSpec:c,style:G.style,styleSpec:G.styleSpec}))}function $(G,te){const X=s.K(G.value),re=s.J(G.value),ce=G.value!==null?G.value:te;if(y){if(X!==y)return[new s.V(G.key,ce,`${X} stop domain type must match previous stop domain type ${y}`)]}else y=X;if(X!=="number"&&X!=="string"&&X!=="boolean"&&typeof re!="number"&&typeof re!="string"&&typeof re!="boolean")return[new s.V(G.key,ce,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&m!=="categorical"){let fe=`number expected, ${X} found`;return s.N(c)&&m===void 0&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(G.key,ce,fe)]}return m!=="categorical"||X!=="number"||typeof re=="number"&&isFinite(re)&&Math.floor(re)===re?m!=="categorical"&&X==="number"&&typeof re=="number"&&typeof w=="number"&&w!==void 0&&re<w?[new s.V(G.key,ce,"stop domain values must appear in ascending order")]:(w=re,m==="categorical"&&re in R?[new s.V(G.key,ce,"stop domain values must be unique")]:(R[re]=!0,[])):[new s.V(G.key,ce,`integer expected, found ${String(re)}`)]}}function Br(u){const t=(u.expressionContext==="property"?s.W:s.U)(s.S(u.value),u.valueSpec);if(t.result==="error")return t.value.map(c=>new s.V(`${u.key}${c.key}`,u.value,c.message));const n=t.value.expression||t.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!n.outputDefined())return[new s.V(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!s.Z(n))return[new s.V(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter")return Jn(n,u);if(u.expressionContext==="appearance")return Rs(n,u);if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!s.X(n,["zoom","feature-state"]))return[new s.V(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!s.Y(n))return[new s.V(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jn(u,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const m of t.valueSpec.expression.parameters)n.delete(m);if(n.size===0)return[];const c=[];return u instanceof s._&&n.has(u.name)?[new s.V(t.key,t.value,`["${u.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(u.eachChild(m=>{c.push(...Jn(m,t))}),c)}function Rs(u,t){const n=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const m of t.valueSpec.expression.parameters)n.add(m);if(n.size===0)return[];const c=[];return u instanceof s._&&!n.has(u.name)?[new s.V(t.key,t.value,`["${u.name}"] is not an allowed parameter`)]:(u.eachChild(m=>{c.push(...Rs(m,t))}),c)}function za(u){const t=u.key,n=u.value,c=u.valueSpec,m=[];return Array.isArray(c.values)?c.values.indexOf(s.J(n))===-1&&m.push(new s.V(t,n,`expected one of [${c.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(c.values).indexOf(s.J(n))===-1&&m.push(new s.V(t,n,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(n)} found`)),m}function La(u){return s.a2(s.S(u.value))?Br(Object.assign({},u,{expressionContext:"filter",valueSpec:u.styleSpec[`filter_${u.layerType||"fill"}`]})):fs(u)}function fs(u){const t=u.value,n=u.key;if(!Array.isArray(t))return[new s.V(n,t,`array expected, ${s.K(t)} found`)];if(t.length<1)return[new s.V(n,t,"filter array must have at least 1 element")];const c=u.styleSpec;let m=za({key:`${n}[0]`,value:t[0],valueSpec:c.filter_operator});switch(s.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&s.J(t[1])==="$type"&&m.push(new s.V(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new s.V(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(s.a0(t[1])||m.push(new s.V(`${n}[1]`,t[1],`string expected, ${s.K(t[1])} found`)));for(let y=2;y<t.length;y++)s.J(t[1])==="$type"?m=m.concat(za({key:`${n}[${y}]`,value:t[y],valueSpec:c.geometry_type})):s.a0(t[y])||s.L(t[y])||s.$(t[y])||m.push(new s.V(`${n}[${y}]`,t[y],`string, number, or boolean expected, ${s.K(t[y])} found.`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)m=m.concat(fs({key:`${n}[${y}]`,value:t[y],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":t.length!==2?m.push(new s.V(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):s.a0(t[1])||m.push(new s.V(`${n}[1]`,t[1],`string expected, ${s.K(t[1])} found`))}return m}function ps(u,t){const n=u.key,c=u.style,m=u.layer,y=u.styleSpec,w=u.value,E=u.objectKey,R=y[`${t}_${u.layerType}`];if(!R)return[];const L=E.match(/^(.*)-use-theme$/);if(L&&R[L[1]])return s.Q(w)?[].concat(hn({key:u.key,value:w,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:c,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:E})):hn({key:n,value:w,valueSpec:{type:"string"},style:c,styleSpec:y});const P=E.match(/^(.*)-transition$/);if(t==="paint"&&P&&R[P[1]]&&R[P[1]].transition)return hn({key:n,value:w,valueSpec:y.transition,style:c,styleSpec:y});const F=u.valueSpec||R[E];if(!F)return[new s.a3(n,w,`unknown property "${E}"`)];let j;if(s.a0(w)&&s.N(F)&&!F.tokens&&(j=/^{([^}]+)}$/.exec(w))){const $=`\`{ "type": "identity", "property": ${j?JSON.stringify(j[1]):'"_"'} }\``;return[new s.V(n,w,`"${E}" does not support interpolation syntax
Use an identity property function instead: ${$}.`)]}const H=[];if(u.layerType==="symbol")E!=="text-field"||!c||c.glyphs||c.imports||H.push(new s.V(n,w,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&s.a4(s.S(w))&&s.J(w.type)==="identity"&&H.push(new s.V(n,w,'"text-font" does not support identity functions'));else if(u.layerType==="model"&&t==="paint"&&m&&m.layout&&m.layout.hasOwnProperty("model-id")&&s.N(F)&&(s.a5(F)||s.O(F))){const $=s.W(s.S(w),F),G=$.value.expression||$.value._styleExpression.expression;G&&!s.X(G,["measure-light"])&&(E==="model-emissive-strength"&&s.Y(G)&&s.Z(G)||H.push(new s.V(n,w,`${E} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return H.concat(hn({key:u.key,value:w,valueSpec:F,style:c,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:E}))}function $n(u){return ps(u,"paint")}function Xn(u){return ps(u,"layout")}function Ds(u){let t=[];const n=u.value,c=u.key,m=u.style,y=u.styleSpec;if(!s.H(n))return[new s.V(c,n,"object expected")];n.type||n.ref||t.push(new s.V(c,n,'either "type" or "ref" is required'));let w=s.J(n.type);const E=s.J(n.ref);if(n.id){const R=s.J(n.id);for(let L=0;L<u.arrayIndex;L++){const P=m.layers[L];s.J(P.id)===R&&t.push(new s.V(c,n.id,`duplicate layer id "${R}", previously used at line ${P.id.__line__}`))}}if("ref"in n){let R;["type","source","source-layer","filter","layout"].forEach(L=>{L in n&&t.push(new s.V(c,n[L],`"${L}" is prohibited for ref layers`))}),m.layers.forEach(L=>{s.J(L.id)===E&&(R=L)}),R?R.ref?t.push(new s.V(c,n.ref,"ref cannot reference another ref layer")):w=s.J(R.type):typeof E=="string"&&t.push(new s.V(c,n.ref,`ref layer "${E}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(n.source)if(s.a0(n.source)){const R=m.sources&&m.sources[n.source],L=R&&s.J(R.type);R?L==="vector"&&w==="raster"?t.push(new s.V(c,n.source,`layer "${n.id}" requires a raster source`)):L==="raster"&&w!=="raster"?t.push(new s.V(c,n.source,`layer "${n.id}" requires a vector source`)):L!=="vector"||n["source-layer"]?L==="raster-dem"&&w!=="hillshade"?t.push(new s.V(c,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(w)?w==="line"&&n.paint&&(n.paint["line-gradient"]||n.paint["line-trim-offset"])&&L==="geojson"&&!R.lineMetrics?t.push(new s.V(c,n,`layer "${n.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):w==="raster-particle"&&L!=="raster-array"&&t.push(new s.V(c,n.source,`layer "${n.id}" requires a 'raster-array' source.`)):t.push(new s.V(c,n.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new s.V(c,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new s.V(c,n.source,`source "${n.source}" not found`))}else t.push(new s.V(`${c}.source`,n.source,'"source" must be a string'));else t.push(new s.V(c,n,'missing required property "source"'));return t=t.concat(Dt({key:c,value:n,valueSpec:y.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>hn({key:`${c}.type`,value:n.type,valueSpec:y.layer.type,style:u.style,styleSpec:u.styleSpec,object:n,objectKey:"type"}),filter:R=>La(Object.assign({layerType:w},R)),layout:R=>Dt({layer:n,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":L=>Xn(Object.assign({layerType:w},L))}}),paint:R=>Dt({layer:n,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":L=>$n(Object.assign({layerType:w,layer:n},L))}}),appearances(R){const L=Gn({key:R.key,value:R.value,valueSpec:R.valueSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:j=>function(H){const{key:$,layer:G,layerType:te}=H,X=s.J(H.value),re=s.J(X.name),ce=s.J(X.condition),fe=Dt({key:$,value:X,valueSpec:H.styleSpec.appearance,style:H.style,styleSpec:H.styleSpec,objectElementValidators:{condition:Te=>function(we){const Ee=[];return Ee.push(...Br({key:we.key,value:we.object.condition,valueSpec:s.a6.appearance.condition,expressionContext:"appearance"})),Ee}(Object.assign({layer:G,layerType:te},Te)),properties:Te=>function(we){const Ee=[],{styleSpec:ve,layer:be,layerType:Ce}=we,We=ve[`paint_${Ce}`],ke=ve[`layout_${Ce}`],ct=we.object[we.objectKey];for(const Ze in ct){const ot=Ze in We?"paint":Ze in ke?"layout":void 0;if(!ot){Ee.push(new s.V(we.key,Ze,`unknown property "${Ze}" for layer type "${Ce}"`));continue}const Bt=Object.assign({},we,{key:`${we.key}.${Ze}`,object:ct,objectKey:Ze,layer:be,layerType:Ce,value:ct[Ze],valueSpec:ot==="paint"?We[Ze]:ke[Ze]});Ee.push(...ps(Bt,ot))}return Ee}(Object.assign({layer:G,layerType:te},Te))}});return re==="hidden"||ce||fe.push(new s.V(H.key,"name",'Appearance with name different than "hidden" must have a condition')),fe}(Object.assign({layerType:w,layer:n},j))}),P=Array.isArray(R.value)?R.value:[],F=new Set;return P.forEach((j,H)=>{const $=s.J(j.name);if($)if(F.has($)){const G=s.J(n.id);L.push(new s.V(R.key,$,`Duplicated appearance name "${$}" for layer "${G}"`))}else F.add($)}),L}}})),t}function Ps({key:u,value:t}){return s.a0(t)?[]:[new s.V(u,t,`string expected, ${s.K(t)} found`)]}const Vs={promoteId:function u({key:t,value:n}){if(s.a0(n))return Ps({key:t,value:n});if(Array.isArray(n)){const m=[],y=s.S(n),w=s.U(y);return w.result==="error"&&w.value.forEach(E=>{m.push(new s.V(`${t}${E.key}`,null,`${E.message}`))}),s.X(w.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||m.push(new s.V(`${t}`,null,"promoteId expression should be only feature dependent")),m}if(!s.H(n))return[new s.V(t,n,`string, expression or object expected, "${s.K(n)}" found`)];const c=[];for(const m in n)c.push(...u({key:`${t}.${m}`,value:n[m]}));return c}};function Pn(u){const t=u.value,n=u.key,c=u.styleSpec,m=u.style;if(!s.H(t))return[new s.V(n,t,`object expected, ${s.K(t)} found`)];if(!("type"in t))return[new s.V(n,t,'"type" is required')];const y=s.J(t.type);let w=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&("url"in t||"tiles"in t||w.push(new s.a3(n,t,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(Dt({key:n,value:t,valueSpec:c[`source_${y.replace("-","_")}`],style:u.style,styleSpec:c,objectElementValidators:Vs})),w;case"geojson":if(w=Dt({key:n,value:t,valueSpec:c.source_geojson,style:m,styleSpec:c,objectElementValidators:Vs}),"cluster"in t&&"clusterProperties"in t){if(!s.H(t.clusterProperties))return[new s.V(`${n}.clusterProperties`,t,`object expected, ${s.K(t)} found`)];for(const E in t.clusterProperties){const R=t.clusterProperties[E];if(!Array.isArray(R))return[new s.V(`${n}.clusterProperties.${E}`,R,"array expected")];const[L,P]=R,F=typeof L=="string"?[L,["accumulated"],["get",E]]:L;w.push(...Br({key:`${n}.${E}.map`,value:P,expressionContext:"cluster-map"})),w.push(...Br({key:`${n}.${E}.reduce`,value:F,expressionContext:"cluster-reduce"}))}}return w;case"video":return Dt({key:n,value:t,valueSpec:c.source_video,style:m,styleSpec:c});case"image":return Dt({key:n,value:t,valueSpec:c.source_image,style:m,styleSpec:c});case"canvas":return[new s.V(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return za({key:`${n}.type`,value:t.type,valueSpec:{values:oa(c)}})}}function oa(u){return u.source.reduce((t,n)=>{const c=u[n];return c.type.type==="enum"&&(t=t.concat(Object.keys(c.type.values))),t},[])}function Da(u){const t=u.value,n=u.styleSpec,c=n.light,m=u.style;if(t===void 0)return[];if(!s.H(t))return[new s.V("light",t,`object expected, ${s.K(t)} found`)];let y=[];for(const w in t){const E=w.match(/^(.*)-transition$/),R=w.match(/^(.*)-use-theme$/);y=y.concat(R&&c[R[1]]?hn({key:w,value:t[w],valueSpec:{type:"string"},style:m,styleSpec:n}):E&&c[E[1]]&&c[E[1]].transition?hn({key:w,value:t[w],valueSpec:n.transition,style:m,styleSpec:n}):c[w]?hn({key:w,value:t[w],valueSpec:c[w],style:m,styleSpec:n}):[new s.V(w,t[w],`unknown property "${w}"`)])}return y}function as(u){const t=u.value;if(!t)return[];const n=u.key;if(!s.H(t))return[new s.V(n,t,`object expected, ${s.K(t)} found`)];let c=[];const m=u.styleSpec,y=m["light-3d"],w=u.style,E=u.style.lights;for(const P of["type","id"])if(!(P in t))return c=c.concat([new s.V(n,t,`missing property "${P}"`)]),c;if(!s.a0(t.type))return c=c.concat([new s.V(`${n}.type`,t.type,"string expected")]),c;if(E)for(let P=0;P<u.arrayIndex;P++){const F=s.J(t.type),j=E[P];s.J(j.type)===F&&c.push(new s.V(n,t.id,`duplicate light type "${t.type}", previously defined at line ${j.id.__line__}`))}const R=`properties_light_${t.type}`;if(!(R in m))return c=c.concat([new s.V(`${n}.type`,t,`Invalid light type ${t.type}`)]),c;const L=m[R];for(const P in t)if(P==="properties"){const F=t[P];if(!s.H(F))return c=c.concat([new s.V("properties",F,`object expected, ${s.K(F)} found`)]),c;for(const j in F){const H=j.match(/^(.*)-transition$/),$=j.match(/^(.*)-use-theme$/);c=c.concat($&&L[$[1]]?hn({key:P,value:F[j],valueSpec:{type:"string"},style:w,styleSpec:m}):H&&L[H[1]]&&L[H[1]].transition?hn({key:P,value:t[P],valueSpec:m.transition,style:w,styleSpec:m}):L[j]?hn({key:j,value:F[j],valueSpec:L[j],style:w,styleSpec:m}):[new s.a3(u.key,F[j],`unknown property "${j}"`)])}}else c=c.concat(y[P]?hn({key:P,value:t[P],valueSpec:y[P],style:w,styleSpec:m}):[new s.a3(P,t[P],`unknown property "${P}"`)]);return c}function va(u){const t=u.value,n=u.key,c=u.style,m=u.styleSpec,y=m.terrain;if(t==null)return[];if(!s.H(t))return[new s.V("terrain",t,`object expected, ${s.K(t)} found`)];let w=[];for(const E in t){const R=E.match(/^(.*)-transition$/),L=E.match(/^(.*)-use-theme$/);w=w.concat(L&&y[L[1]]?hn({key:E,value:t[E],valueSpec:{type:"string"},style:c,styleSpec:m}):R&&y[R[1]]&&y[R[1]].transition?hn({key:E,value:t[E],valueSpec:m.transition,style:c,styleSpec:m}):y[E]?hn({key:E,value:t[E],valueSpec:y[E],style:c,styleSpec:m}):[new s.a3(E,t[E],`unknown property "${E}"`)])}if(t.source)if(s.a0(t.source)){const E=c.sources&&c.sources[t.source],R=E&&s.J(E.type);E?R!=="raster-dem"&&w.push(new s.V(`${n}.source`,t.source,`terrain cannot be used with a source of type ${R}, it only be used with a "raster-dem" source type`)):w.push(new s.V(`${n}.source`,t.source,`source "${t.source}" not found`))}else w.push(new s.V(`${n}.source`,t.source,"source must be a string"));else w.push(new s.V(n,t,'terrain is missing required property "source"'));return w}function Ms(u){const t=u.value,n=u.style,c=u.styleSpec,m=c.fog;if(t===void 0)return[];if(!s.H(t))return[new s.V("fog",t,`object expected, ${s.K(t)} found`)];let y=[];for(const w in t){const E=w.match(/^(.*)-transition$/),R=w.match(/^(.*)-use-theme$/);y=y.concat(R&&m[R[1]]?hn({key:w,value:t[w],valueSpec:{type:"string"},style:n,styleSpec:c}):E&&m[E[1]]&&m[E[1]].transition?hn({key:w,value:t[w],valueSpec:c.transition,style:n,styleSpec:c}):m[w]?hn({key:w,value:t[w],valueSpec:m[w],style:n,styleSpec:c}):[new s.a3(w,t[w],`unknown property "${w}"`)])}return y}const os={"*":()=>[],array:Gn,boolean:function(u){const t=u.value,n=u.key;return s.$(t)?[]:[new s.V(n,t,`boolean expected, ${s.K(t)} found`)]},number:ds,color:function({key:u,value:t}){return s.a0(t)?s.a1.parseCSSColor(t)===null?[new s.V(u,t,`color expected, "${t}" found`)]:[]:[new s.V(u,t,`color expected, ${s.K(t)} found`)]},enum:za,filter:La,function:Zs,layer:Ds,object:Dt,source:Pn,model:s.a7,light:Da,"light-3d":as,terrain:va,fog:Ms,string:Ps,formatted:function(u){return Ps(u).length===0?[]:Br(u)},resolvedImage:function(u){return Ps(u).length===0?[]:Br(u)},projection:function(u){const t=u.value,n=u.styleSpec,c=n.projection,m=u.style;if(s.H(t)){let y=[];for(const w in t)y=y.concat(hn({key:w,value:t[w],valueSpec:c[w],style:m,styleSpec:n}));return y}return s.a0(t)?[]:[new s.V("projection",t,`object or string expected, ${s.K(t)} found`)]},import:function(u){const t=u.key,{value:n,styleSpec:c}=u;if(!s.H(n))return[new s.V(t,n,"import must be an object")];const{data:m,...y}=n;Object.defineProperty(y,"__line__",{value:n.__line__,enumerable:!1});let w=Dt(Object.assign({},u,{value:y,valueSpec:c.import}));return s.J(y.id)===""&&w.push(new s.V(`${u.key}.id`,y,"import id can't be an empty string")),m&&(w=w.concat(Ar(m,c,{key:`${u.key}.data`}))),w},iconset:function(u){const t=u.value,n=u.key,c=u.styleSpec,m=u.style;if(!s.H(t))return[new s.V(n,t,"object expected")];if(!t.type)return[new s.V(n,t,'"type" is required')];const y=s.J(t.type);let w=[];if(w=w.concat(Dt({key:n,value:t,valueSpec:c[`iconset_${y}`],style:m,styleSpec:c})),function(E,R){return!(E!=="source"||!R.source)}(y,t)){const E=m.sources&&m.sources[t.source],R=E&&s.J(E.type);E?R!=="raster-array"&&w.push(new s.V(n,t.source,`iconset cannot be used with a source of type ${String(R)}, it only be used with a "raster-array" source type`)):w.push(new s.V(n,t.source,`source "${t.source}" not found`))}return w}};function hn(u,t=!1){const n=u.value,c=u.valueSpec,m=u.styleSpec;if(c.expression){if(s.a4(s.J(n)))return Zs(u);if(s.Q(s.S(n)))return Br(u)}if(c.type&&os[c.type]){const y=os[c.type](u);return t===!0&&y.length>0&&Array.isArray(u.value)?Br(u):y}return Dt(Object.assign({},u,{valueSpec:c.type?m[c.type]:c}))}function Dt(u){const t=u.key,n=u.value,c=u.valueSpec||{},m=u.objectElementValidators||{},y=u.style,w=u.styleSpec;if(!s.H(n))return[new s.V(t,n,`object expected, ${s.K(n)} found`)];let E=[];for(const R in n){const L=R.split(".")[0];let P;m[L]?P=m[L]:c[L]?P=hn:m["*"]?P=m["*"]:c["*"]&&(P=hn),P?E=E.concat(P({key:(t&&`${t}.`)+R,value:n[R],valueSpec:c[L]||c["*"],style:y,styleSpec:w,object:n,objectKey:R},n)):E.push(new s.a3(t,n[R],`unknown property "${R}"`))}for(const R in c)m[R]||c[R].required&&c[R].default===void 0&&n[R]===void 0&&E.push(new s.V(t,n,`missing required property "${R}"`));return E}function Ti({key:u,value:t}){const n=Ps({key:u,value:t});if(n.length)return n;const c=t;return c.indexOf("{fontstack}")===-1&&n.push(new s.V(u,t,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&n.push(new s.V(u,t,'"glyphs" url must include a "{range}" token')),n}function Ar(u,t=s.a6,n={}){return Dt({key:n.key||"",value:u,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:u,objectElementValidators:{glyphs:Ti}})}function br(u,t=s.a6){return Pe(Ar(u,t))}const Rr=u=>Pe(Pn(u)),xn=u=>Pe(Da(u)),xs=u=>Pe(as(u)),Ct=u=>Pe(va(u)),Hs=u=>Pe(Ms(u)),Pa=u=>Pe(function(t){const n=t.value,c=t.style,m=t.styleSpec,y=m.snow;if(n===void 0)return[];if(!s.H(n))return[new s.V("snow",n,`object expected, ${s.K(n)} found`)];let w=[];for(const E in n){const R=E.match(/^(.*)-transition$/);w=w.concat(R&&y[R[1]]&&y[R[1]].transition?hn({key:E,value:n[E],valueSpec:m.transition,style:c,styleSpec:m}):y[E]?hn({key:E,value:n[E],valueSpec:y[E],style:c,styleSpec:m}):[new s.a3(E,n[E],`unknown property "${E}"`)])}return w}(u)),ba=u=>Pe(function(t){const n=t.value,c=t.style,m=t.styleSpec,y=m.rain;if(n===void 0)return[];if(!s.H(n))return[new s.V("rain",n,`object expected, ${s.K(n)} found`)];let w=[];for(const E in n){const R=E.match(/^(.*)-transition$/);w=w.concat(R&&y[R[1]]&&y[R[1]].transition?hn({key:E,value:n[E],valueSpec:m.transition,style:c,styleSpec:m}):y[E]?hn({key:E,value:n[E],valueSpec:y[E],style:c,styleSpec:m}):[new s.a3(E,n[E],`unknown property "${E}"`)])}return w}(u)),He=u=>Pe(Ds(u)),J=u=>Pe(La(u)),ie=u=>Pe($n(u)),me=u=>Pe(Xn(u)),je=u=>Pe(s.a7(u));function Pe(u){return u.slice().sort((t,n)=>t.line&&n.line?t.line-n.line:0)}function Ie(u,t){let n=!1;if(t&&t.length)for(const c of t)c instanceof s.a3?s.w(c.message):(u.fire(new s.y(new Error(c.message))),n=!0);return n}let Qe;class Be extends s.E{constructor(t,n="flat"){super(),this._transitionable=new s.a8(Qe||(Qe=new s.a9({anchor:new s.aa(s.a6.light.anchor),position:new s.ab(s.a6.light.position),color:new s.aa(s.a6.light.color),intensity:new s.aa(s.a6.light.intensity)}))),this.setLight(t,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n,c={}){this._validate(xn,t,c)||(this._transitionable.setTransitionOrValue(t),this.id=n)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,c){return(!c||c.validate!==!1)&&Ie(this,t.call(br,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let Je=class extends s.E{constructor(u,t,n,c,m){super(),this.scope=n,this._transitionable=new s.a8(new s.a9({source:new s.aa(s.a6.terrain.source),exaggeration:new s.aa(s.a6.terrain.exaggeration)}),n,c),this._transitionable.setTransitionOrValue(u,c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=m}get(){return this._transitionable.serialize()}set(u,t){this._transitionable.setTransitionOrValue(u,t)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}getExaggeration(u){return this._transitioning.possiblyEvaluate(new s.ac(u,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const u=this._transitionable._values.exaggeration;if(!u)return null;const t=u.value.expression;if(!t)return null;let n=-1,c=-1,m=1;for(const y of t.zoomStops)m=t.evaluate(new s.ac(y,{worldview:this.worldview})),m>.01?(n=y,c=-1):c=y;return m<.01&&n>0&&c>n?[n,c]:null}isZoomDependent(){const u=this._transitionable._values.exaggeration;return u!=null&&u.value!=null&&u.value.expression!=null&&u.value.expression instanceof s.ad}};const Lt=45,vt=65,pi=.05;function Mi(u,t,n,c){const m=s.ah(Lt,vt,n),[y,w]=Vi(u,c);let E=1-Math.min(1,Math.exp((t-y)/(w-y)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*m*u.alpha}function Vi(u,t){const n=.5/Math.tan(.5*t);return[u.range[0]+n,u.range[1]+n]}function lr(u,t,n,c,m){const y=s.af([],[t,n,c],m.mercatorFogMatrix);return Mi(u,s.ag(y),m.pitch,m._fov)}function nr(u,t,n,c,m,y,w){const E=[[n,c,0],[m,c,0],[m,y,0],[n,y,0]];let R=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const P of E){const F=s.af([],P,t),j=s.ag(F);R=Math.min(R,j),L=Math.max(L,j)}return[Mi(u,R,w.pitch,w._fov),Mi(u,L,w.pitch,w._fov)]}class cr extends s.E{constructor(t,n,c,m){super();const y=new s.a9({range:new s.aa(s.a6.fog.range),color:new s.aa(s.a6.fog.color),"color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.aa(s.a6.fog["high-color"]),"high-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.aa(s.a6.fog["space-color"]),"space-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.aa(s.a6.fog["horizon-blend"]),"star-intensity":new s.aa(s.a6.fog["star-intensity"]),"vertical-range":new s.aa(s.a6.fog["vertical-range"])});this._transitionable=new s.a8(y,c,new Map(m)),this.set(t,m),this._transitioning=this._transitionable.untransitioned(),this._transform=n,this.properties=new s.ai(y),this.scope=c}get state(){const t=this._transform,n=t.projection.name==="globe",c=s.aj(t.zoom),m=this.properties.get("range"),y=[.5,3];return{range:n?[s.ak(y[0],m[0],c),s.ak(y[1],m[1],c)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,n,c={}){if(this._validate(Hs,t,c))return;const m=Object.assign({},t);for(const y of Object.keys(s.a6.fog))m[y]===void 0&&(m[y]=s.a6.fog[y].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,n)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ah(Lt,vt,t))*n.a}getOpacityAtLatLng(t,n){return this._transform.projection.supportsFog?function(c,m,y){const w=s.ae.fromLngLat(m),E=y.elevation?y.elevation.getAtPointOrZero(w):0;return lr(c,w.x,w.y,E,y)}(this.state,t,n):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(t.toUnwrapped());return nr(this.state,n,0,0,s.al,s.al,this._transform)}getOpacityForBounds(t,n,c,m,y){return this._transform.projection.supportsFog?nr(this.state,t,n,c,m,y,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Vi(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const c of n){const m=t.points[c];let y;if(m[2]>=0)y=m;else{const w=t.points[c-4];y=s.am(w,m,w[2]/(w[2]-m[2]))}if(lr(this.state,y[0],y[1],0,this._transform)>=pi)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,c){return(!c||c.validate!==!1)&&Ie(this,t.call(br,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let Hr,ur,mn,Yr,Ve=class extends s.E{constructor(u,t,n,c){super();const m=Hr||(Hr=new s.a9({density:new s.aa(s.a6.snow.density),intensity:new s.aa(s.a6.snow.intensity),color:new s.aa(s.a6.snow.color),opacity:new s.aa(s.a6.snow.opacity),vignette:new s.aa(s.a6.snow.vignette),"vignette-color":new s.aa(s.a6.snow["vignette-color"]),"center-thinning":new s.aa(s.a6.snow["center-thinning"]),direction:new s.aa(s.a6.snow.direction),"flake-size":new s.aa(s.a6.snow["flake-size"])}));this._transitionable=new s.a8(m,n,new Map(c)),this.set(u,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(m),this.scope=n}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),c=s.an(n[0]),m=-Math.max(s.an(n[1]),.01),y=[Math.cos(c)*Math.cos(m),Math.sin(c)*Math.cos(m),Math.sin(m)],w=this.properties.get("vignette"),E=this.properties.get("vignette-color");return E.a=w,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(t.r,t.g,t.b,t.a*u),direction:y,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(u,t,n={}){if(this._validate(Pa,u,n))return;const c=Object.assign({},u);for(const m of Object.keys(s.a6.snow))c[m]===void 0&&(c[m]=s.a6.snow[m].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,n){return(!n||n.validate!==!1)&&Ie(this,u.call(br,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}},wt=class extends s.E{constructor(u,t,n,c){super();const m=ur||(ur=new s.a9({density:new s.aa(s.a6.rain.density),intensity:new s.aa(s.a6.rain.intensity),color:new s.aa(s.a6.rain.color),opacity:new s.aa(s.a6.rain.opacity),vignette:new s.aa(s.a6.rain.vignette),"vignette-color":new s.aa(s.a6.rain["vignette-color"]),"center-thinning":new s.aa(s.a6.rain["center-thinning"]),direction:new s.aa(s.a6.rain.direction),"droplet-size":new s.aa(s.a6.rain["droplet-size"]),"distortion-strength":new s.aa(s.a6.rain["distortion-strength"])}));this._transitionable=new s.a8(m,n,new Map(c)),this.set(u,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(m),this.scope=n}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),c=s.an(n[0]),m=-Math.max(s.an(n[1]),.01),y=[Math.cos(c)*Math.cos(m),Math.sin(c)*Math.cos(m),Math.sin(m)],w=this.properties.get("vignette-color");return w.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(t.r,t.g,t.b,t.a*u),direction:y,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(u,t,n={}){if(this._validate(ba,u,n))return;const c=Object.assign({},u);for(const m of Object.keys(s.a6.rain))c[m]===void 0&&(c[m]=s.a6.rain[m].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,n){return(!n||n.validate!==!1)&&Ie(this,u.call(br,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}};class Ft extends s.E{constructor(t,n,c,m){super(),this.scope=c,this._options=t,this.properties=new s.ai(n),this._transitionable=new s.a8(n,c,new Map(m)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,n){this._options=t,this._transitionable.setTransitionOrValue(t.properties,n)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Qt{constructor(t,n,c){this.screenBounds=t,this.cameraPoint=c.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=n,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,c)}static createFromScreenPoints(t,n){let c,m;if(t instanceof s.P||typeof t[0]=="number"){const y=s.P.convert(t);c=[y],m=n.isPointAboveHorizon(y)}else{const y=s.P.convert(t[0]),w=s.P.convert(t[1]),E=y.add(w)._div(2);c=[y,w],m=s.aq(y,w).every(R=>n.isPointAboveHorizon(R))&&n.isPointAboveHorizon(E)}return new Qt(c,m,n)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return s.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],m=s.aq(n,c,0,!1);return this.cameraPoint.y>c.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<c.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=c.x?m[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(m[3]=this.cameraPoint)),s.ar(m,t)}bufferedCameraGeometryGlobe(t){const n=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],m=s.aq(n,c,t),y=this.cameraPoint.clone();switch(3*((y.y>n.y)+(y.y>c.y))+((y.x>n.x)+(y.x>c.x))){case 0:m[0]=y,m[4]=y.clone();break;case 1:m.splice(1,0,y);break;case 2:m[1]=y;break;case 3:m.splice(4,0,y);break;case 5:m.splice(2,0,y);break;case 6:m[3]=y;break;case 7:m.splice(3,0,y);break;case 8:m[2]=y}return m}containsTile(t,n,c,m=0){const y=t.queryPadding/n._pixelsPerMercatorPixel+1,w=c?this._bufferedCameraMercator(y,n):this._bufferedScreenMercator(y,n);let E=t.tileID.wrap+(w.unwrapped?m:0);const R=w.polygon.map(te=>s.as(t.tileTransform,te,E));if(!s.at(R,0,0,s.al,s.al))return;E=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const L=this.screenGeometryMercator.polygon.map(te=>s.au(t.tileTransform,te,E)),P=L.map(te=>new s.P(te[0],te[1])),F=n.getFreeCameraOptions().position||new s.ae(0,0,0),j=s.au(t.tileTransform,F,E),H=L.map(te=>{const X=s.av(te,te,j);return s.aw(X,X),new s.ax(j,X)}),$=s.ay(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:H,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(G=s.az(R),G.min.x=s.aA(G.min.x,0,s.al),G.min.y=s.aA(G.min.y,0,s.al),G.max.x=s.aA(G.max.x,0,s.al),G.max.y=s.aA(G.max.y,0,s.al),G),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:$};var G}_bufferedScreenMercator(t,n){const c=Sn(t);if(this._screenRaycastCache[c])return this._screenRaycastCache[c];{let m;return m=n.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),n):{polygon:this.bufferedScreenGeometry(t).map(y=>n.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[c]=m,m}}_bufferedCameraMercator(t,n){const c=Sn(t);if(this._cameraRaycastCache[c])return this._cameraRaycastCache[c];{let m;return m=n.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),n):{polygon:this.bufferedCameraGeometry(t).map(y=>n.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[c]=m,m}}_projectAndResample(t,n){const c=function(y,w){const E=s.aB([],w.pixelMatrix,w.globeMatrix),R=[0,-s.aD,0,1],L=[0,s.aD,0,1],P=[0,0,0,1];s.aC(R,R,E),s.aC(L,L,E),s.aC(P,P,E);const F=new s.P(R[0]/R[3],R[1]/R[3]),j=new s.P(L[0]/L[3],L[1]/L[3]),H=s.aE(y,F)&&R[3]<P[3],$=s.aE(y,j)&&L[3]<P[3];if(!H&&!$)return null;const G=function(Ee,ve,be){for(let Ce=1;Ce<Ee.length;Ce++){const We=$i(ve.pointCoordinate3D(Ee[Ce-1]).x),ke=$i(ve.pointCoordinate3D(Ee[Ce]).x);if(be<0){if(We<ke)return{idx:Ce,t:-We/(ke-1-We)}}else if(ke<We)return{idx:Ce,t:(1-We)/(ke+1-We)}}return null}(y,w,H?-1:1);if(!G)return null;const{idx:te,t:X}=G;let re=te>1?wi(y.slice(0,te),w):[],ce=te<y.length?wi(y.slice(te),w):[];re=re.map(Ee=>new s.P($i(Ee.x),Ee.y)),ce=ce.map(Ee=>new s.P($i(Ee.x),Ee.y));const fe=[...re];fe.length===0&&fe.push(ce[ce.length-1]);const Te=s.ak(fe[fe.length-1].y,(ce.length===0?re[0]:ce[0]).y,X);let we;return we=H?[new s.P(0,Te),new s.P(0,0),new s.P(1,0),new s.P(1,Te)]:[new s.P(1,Te),new s.P(1,1),new s.P(0,1),new s.P(0,Te)],fe.push(...we),ce.length===0?fe.push(re[0]):fe.push(...ce),{polygon:fe.map(Ee=>new s.ae(Ee.x,Ee.y)),unwrapped:!1}}(t,n);if(c)return c;const m=function(y,w){let E=!1,R=-1/0,L=0;for(let F=0;F<y.length-1;F++)y[F].x>R&&(R=y[F].x,L=F);for(let F=0;F<y.length-1;F++){const j=(L+F)%(y.length-1),H=y[j],$=y[j+1];Math.abs(H.x-$.x)>.5&&(H.x<$.x?(H.x+=1,j===0&&(y[y.length-1].x+=1)):($.x+=1,j+1===y.length-1&&(y[0].x+=1)),E=!0)}const P=s.aF(w.center.lng);return E&&P<Math.abs(P-1)&&y.forEach(F=>{F.x-=1}),{polygon:y,unwrapped:E}}(wi(t,n).map(y=>new s.P($i(y.x),y.y)),n);return{polygon:m.polygon.map(y=>new s.ae(y.x,y.y)),unwrapped:m.unwrapped}}}function wi(u,t){return s.aG(u,n=>{const c=t.pointCoordinate3D(n);n.x=c.x,n.y=c.y},1/256)}function $i(u){return u<0?1+u%1:u%1}function Sn(u){return 100*u|0}function tn(u,t,n,c,m){const y=function(E,R){if(E)return m(E);if(R){if(u.url&&R.tiles&&u.tiles&&delete u.tiles,R.variants){if(!Array.isArray(R.variants))return m(new Error("variants must be an array"));for(const P of R.variants){if(P==null||typeof P!="object"||P.constructor!==Object)return m(new Error("variant must be an object"));if(!Array.isArray(P.capabilities))return m(new Error("capabilities must be an array"));if(P.capabilities.length===1&&P.capabilities[0]==="meshopt"){R=Object.assign(R,P);break}}}const L=s.aH(Object.assign({},R,u),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);L.tiles=t.canonicalizeTileset(L,u.url),m(null,L)}},w=function(E,R,L){if(!E)return null;if(!R&&!L)return E;L=L||E.worldview_default;const P=Object.values(E.language||{});if(P.length===0)return null;const F=Object.values(E.worldview||{});if(F.length===0)return null;const j=P.every($=>$===R),H=F.every($=>$===L);return j&&H?E:R in(E.language_options||{})||L in(E.worldview_options||{})?null:E.language_options&&E.worldview_options?E:null}(u.data,n,c);return w?s.o.frame(()=>y(null,w)):u.url?s.m(t.transformRequest(t.normalizeSourceURL(u.url,null,n,c),s.R.Source),y):s.o.frame(()=>{const{data:E,...R}=u;y(null,R)})}function dn(u,t){const n=Math.pow(2,t.z),c=Math.floor(s.aF(u.getWest())*n),m=Math.floor(s.aJ(u.getNorth())*n),y=Math.ceil(s.aF(u.getEast())*n),w=Math.ceil(s.aJ(u.getSouth())*n);return t.x>=c&&t.x<y&&t.y>=m&&t.y<w}class In{constructor(t,n,c){this.bounds=t?s.aI.convert(this.validateBounds(t)):null,this.minzoom=n||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const n of t)this.extraBounds.push(s.aI.convert(this.validateBounds(n)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!dn(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const n of this.extraBounds)if(dn(n,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const n=new In(t.bounds,t.minzoom,t.maxzoom);return n.addExtraBounds(t.extra_bounds),n}}class Yn extends s.E{constructor(t,n,c,m){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,s.aH(n,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new s.aK}load(t){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=tn(this._options,this.map._requestManager,n,c,(m,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,m)n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),c&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new s.y(m));else if(y){if(Object.assign(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const w of y.vector_layers)this.vectorLayerIds.push(w.id),y.worldview&&y.worldview[w.source]&&this.localizableLayerIds.add(w.id)}this.tileBounds=In.fromTileJSON(y),Pi(y.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(m)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,n){const c=t.tileID.canonical.url(this.tiles,this.scheme),m=this.map._requestManager.normalizeTileURL(c),y=this.map._requestManager.transformRequest(m,s.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,E=w?{image:w.image.clone()}:null,R={request:y,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:E,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&s.h(c)&&(R.localizableLayerIds=this.localizableLayerIds),R.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",R,L.bind(this));else if(t.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",R,L.bind(this),void 0,!0);else{const P=s.aL.call({deduped:this._deduped},R,(F,j)=>{F||!j?L.call(this,F):(R.data={cacheControl:j.cacheControl,expires:j.expires,rawData:j.rawData.slice(0)},t.actor&&t.actor.send("loadTile",R,L.bind(this),void 0,!0))},!0);t.request={cancel:P}}function L(P,F){return delete t.request,t.aborted?n(null):P&&P.status!==404?n(P):(F&&F.resourceTiming&&(t.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&t.setExpiryData(F),t.loadVectorData(F,this.map.painter),s.aM(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,n){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ga extends s.E{constructor(t,n,c,m){super(),this.id=t,this.dispatcher=c,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},n),Object.assign(this,s.aH(n,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const n=this.map.getWorldview();this._tileJSONRequest=tn(this._options,this.map._requestManager,null,n,(c,m)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new s.y(c)):m&&(Object.assign(this,m),m.raster_layers&&(this.rasterLayers=m.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),this.tileBounds=In.fromTileJSON(m),Pi(m.tiles),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(c)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const c=s.o.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),c,this.tileSize);t.request=s.n(this.map._requestManager.transformRequest(m,s.R.Tile),(y,w,E,R)=>(delete t.request,t.aborted?(t.state="unloaded",n(null)):y?(t.state="errored",n(y)):w?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:E,expires:R}),t.setTexture(w,this.map.painter),t.state="loaded",s.aM(this.dispatcher),void n(null)):n(null)))}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n&&n()}unloadTile(t,n){t.texture&&t.texture instanceof s.T?(t.destroy(!0),t.texture&&t.texture instanceof s.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),n&&n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function ro([u,t],n,c,{scaled:m=!0}={}){const{tileSize:y,buffer:w}=c,{x:E,y:R,z:L}=n;if(!isFinite(E)||!isFinite(R)||!isFinite(L))throw new Error("Invalid MRT header");const P=2**L,F=P*s.aF(u),j=P*s.aJ(t);return function([H,$],G,{scaled:te=!0}={}){if(!G)throw new Error("bandView is undefined");const{data:X,tileSize:re,buffer:ce,offset:fe,scale:Te,dimension:we}=G;if(H<-ce||H>re+ce||$<-ce||$>re+ce)throw new Error(`Point (${H}, ${$}) out of bounds for tileSize=${re}, buffer=${ce}`);const Ee=($+ce)*(re+2*ce)+(H+ce);if(new Uint32Array(X.buffer)[Ee]===4294967295)return null;let ve=[];ve=te?[]:new G.data.constructor(we);for(let be=0;be<we;be++)ve[be]=Math.round(1e12*(X[we*Ee+be]*Te+fe))/1e12;return ve}([Math.min(Math.max(-w,Math.floor((F-E)*y)),y-1+w),Math.min(Math.max(-w,Math.floor((j-R)*y)),y-1+w)],c,{scaled:m})}class Ol extends Ga{constructor(t,n,c,m){super(t,n,c,m),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},n)}triggerRepaint(t){const n=this.map.painter._terrain,c=this.map.style.getSourceCache(this.id);n&&n.enabled&&c&&n._clearRenderCacheForTile(c.id,t.tileID),this.map.triggerRepaint()}loadTile(t,n){const c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(c,s.R.Tile),y={request:m,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=m,t.actor||(t.actor=this.dispatcher.getActor());const w=(E,R,L,P)=>{if(delete t.request,t.aborted)return t.state="unloaded",n(null);if(E)return E.name==="AbortError"?void 0:(t.state="errored",n(E));if(this.map._refreshExpiredTiles&&R&&t.setExpiryData({cacheControl:L,expires:P}),this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!R)return n(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=R}n(null)};t.request=this.partial?t.fetchHeader(void 0,w.bind(this)):t.actor.send("loadTile",y,w.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,n){const c=t.texturePerLayer;if(t.flushAllQueues(),c.size){t.destroy(!0);for(const m of c.values())this.map.painter.saveTileTexture(m)}else t.destroy()}prepareTile(t,n,c,m){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(n,c,m,(y,w)=>{if(y)return t.state="errored",this.fire(new s.y(y)),void this.triggerRepaint(t);w&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(c,w,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const n=this.rasterLayers.find(({id:y})=>y===t),c=n&&n.fields,m=c&&c.bands&&c.bands;return m?m[0]:0}getTextureDescriptor(t,n,c){if(!t)return;const m=n.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!m)return;let y=null;n instanceof s.aP?y=n.paint.get("raster-array-band"):n instanceof s.aQ&&(y=n.paint.get("raster-particle-array-band"));const w=y||this.getInitialBand(m);if(w==null)return;if(!t.textureDescriptorPerLayer.get(n.id))return void this.prepareTile(t,m,n.id,w);if(t.updateNeeded(n.id,w)&&!c)return;const E=t.textureDescriptorPerLayer.get(n.id);return Object.assign({},E,{texture:t.texturePerLayer.get(n.id)})}getImages(t,n){const c=new Map;for(const m of t)for(const y of n){const[w,E]=y.split("/"),R=m.getLayer(w);if(!R||!R.hasBand(E)||!R.hasDataForBand(E))continue;const{bytes:L,tileSize:P,buffer:F}=R.getBandView(E),j=P+2*F,H={data:new s.q({width:j,height:j},L),pixelRatio:2,sdf:!1,usvg:!1,version:0};c.set(y,H)}return c}queryRasterArrayValueByBandId(t,n,c){const m=n._mrt;return new Promise(y=>{const w={},E=new Set;for(const[R,L]of Object.entries(m.layers)){if(c.layerName&&R!==c.layerName)continue;const P={};w[R]=P;for(const{bands:F}of L.dataIndex)for(const j of F)c.bands&&!c.bands.includes(j)||(E.add(s.B(R,j)),n.fetchBand(R,null,j,H=>{s.o.frame(()=>{P[j]=H?null:ro([t.lng,t.lat],m,L.getBandView(j)),E.delete(s.B(R,j)),E.size===0&&y(w)})},!1))}E.size===0&&y(w)})}_loadTileForQuery(t,n){if(this._loadTileLoaded[t.uid])return void n(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(n);this._loadTilePending[t.uid]=[n];const c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(c,s.R.Tile);t.actor.send("loadTile",{request:m,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(y,w,E,R)=>y?(this._loadTilePending[t.uid].forEach(L=>L(y,null)),void delete this._loadTilePending[t.uid]):w?(this.map._refreshExpiredTiles&&w&&t.setExpiryData({cacheControl:E,expires:R}),t._mrt=w,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach(L=>L(null,w)),this._loadTileLoaded[t.uid]=!0,void delete this._loadTilePending[t.uid]):(this._loadTilePending[t.uid].forEach(L=>L(null,null)),void delete this._loadTilePending[t.uid]),void 0,!0)}queryRasterArrayValueByAllBands(t,n,c){return new Promise((m,y)=>{this._loadTileForQuery(n,(w,E)=>{w?y(w):m(E?this.queryRasterArrayValueByBandId(t,n,c):null)})})}queryRasterArrayValue(t,n){const c=s.aR.convert(t),m=this.findLoadedParent(c);return m&&m._mrt?n.bands||!this.partial?this.queryRasterArrayValueByBandId(c,m,n):this.queryRasterArrayValueByAllBands(c,m,n):Promise.resolve(null)}findLoadedParent(t){const n=s.ae.fromLngLat(t,this.map.transform.tileSize),c=this.maxzoom+1,m=1<<c,y=Math.floor(n.x),w=Math.floor((n.x-y)*m),E=Math.floor(n.y*m),R=this.map.style.getSourceCache(this.id),L=new s.aO(c,y,c,w,E);return R.findLoadedParent(L,this.minzoom)}}const oh={vector:Yn,raster:Ga,"raster-dem":class extends Ga{constructor(u,t,n,c){super(u,t,n,c),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(u,t){const n=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function c(m,y){m&&(u.state="errored",t(m)),y&&(u.dem=y,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",t(null))}u.request=s.n(this.map._requestManager.transformRequest(n,s.R.Tile),(function(m,y,w,E){if(delete u.request,u.aborted)u.state="unloaded",t(null);else if(m)u.state="errored",t(m);else if(y){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:w,expires:E});const R=ImageBitmap&&y instanceof ImageBitmap&&s.r(),L=1-(y.width-s.aN(y.width))/2;L<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const P=R?y:s.o.getImageData(y,L),F={uid:u.uid,tileID:u.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:P,encoding:this.encoding,padding:L};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadTile",F,c.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(u){const t=u.canonical,n=Math.pow(2,t.z),c=(t.x-1+n)%n,m=t.x===0?u.wrap-1:u.wrap,y=(t.x+1+n)%n,w=t.x+1===n?u.wrap+1:u.wrap,E={};return E[new s.aO(u.overscaledZ,m,t.z,c,t.y).key]={backfilled:!1},E[new s.aO(u.overscaledZ,w,t.z,y,t.y).key]={backfilled:!1},t.y>0&&(E[new s.aO(u.overscaledZ,m,t.z,c,t.y-1).key]={backfilled:!1},E[new s.aO(u.overscaledZ,u.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},E[new s.aO(u.overscaledZ,w,t.z,y,t.y-1).key]={backfilled:!1}),t.y+1<n&&(E[new s.aO(u.overscaledZ,m,t.z,c,t.y+1).key]={backfilled:!1},E[new s.aO(u.overscaledZ,u.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},E[new s.aO(u.overscaledZ,w,t.z,y,t.y+1).key]={backfilled:!1}),E}},"raster-array":Ol,geojson:class extends s.E{constructor(u,t,n,c){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(c),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const m=s.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*m,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*m,extent:s.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:s.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*m,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}updateData(u){if(!this._options.dynamic)return this.fire(new s.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof u!="string"&&(u.type==="Feature"&&(u={type:"FeatureCollection",features:[u]}),u.type!=="FeatureCollection"))return this.fire(new s.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof u!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const n of this._data.features)t.set(n.id,n);for(const n of u.features)t.set(n.id,n);this._data.features=[...t.values()]}else this._data=u;return this._updateWorkerData(!0),this}getClusterExpansionZoom(u,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterChildren(u,t){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterLeaves(u,t,n,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:u,limit:t,offset:n},c),this}_updateWorkerData(u=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:u},this.workerOptions);t.scope=this.scope;const n=this._data;typeof n=="string"?(t.request=this.map._requestManager.transformRequest(s.o.resolveURL(n),s.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(c,m)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new s.y(c));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(y.resourceTiming=m.resourceTiming[this.id]),u&&(this._partialReload=!0),this.fire(new s.z("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(u),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const u=s.B(this.id,this.scope);this.map.style.clearSource(u),this._updateWorkerData()}loadTile(u,t){const n=u.actor?"reloadTile":"loadTile";u.actor=this.actor;const c=this.map.style?this.map.style.getLut(this.scope):null,m=c?{image:c.image.clone()}:null,y=this._partialReload,w={type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:m,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:u.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:y,worldview:this.map.getWorldview()};u.request=this.actor.send(n,w,(E,R)=>y&&!R?(u.state="loaded",t(null)):(delete u.request,u.destroy(),u.aborted?t(null):E?t(E):(u.loadVectorData(R,this.map.painter,n==="reloadTile"),t(null))),void 0,n==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u,t){this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}onRemove(u){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aS{constructor(u,t,n,c){super(u,t,n,c),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const t of u.urls)this.urls.push(this.map._requestManager.transformRequest(t,s.R.Source).url);s.aT(this.urls,(t,n)=>{this._loaded=!0,t?this.fire(new s.y(t)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const t=this.video.seekable;u<t.start(0)||u>t.end(0)?this.fire(new s.y(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,t=u.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(u,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aS,model:class extends s.E{constructor(u,t,n,c){super(),this.id=u,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const u=[];for(const t in this._options.models){const n=this._options.models[t],c=s.aV(this.map._requestManager.transformRequest(n.uri,s.R.Model).url).then(m=>{if(!m)return;const y=s.aW(m),w=new s.aX(t,n.position,n.orientation,y);w.computeBoundsAndApplyParent(),this.models.push(w)}).catch(m=>{this.fire(new s.y(new Error(`Could not load model ${t} from ${n.uri}: ${m.message}`)))});u.push(c)}Promise.allSettled(u).then(()=>{this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new s.y(new Error(`Could not load models: ${t.message}`)))})}onAdd(u){this.map=u,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(u,t){}serialize(){return this._options}},"batched-model":class extends s.E{constructor(u,t,n,c){super(),this.type="batched-model",this.id=u,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(c)}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest();const u=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(u))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(u){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=tn(this._options,this.map._requestManager,t,n,(c,m)=>{this._tileJSONRequest=null,this._loaded=!0,c?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),n&&n.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new s.y(c))):m&&(Object.assign(this,m),m.bounds&&(this.tileBounds=new In(m.bounds,this.minzoom,this.maxzoom)),Pi(m.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),u&&u(c)})}hasTransition(){return!1}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loaded(){return this._loaded}loadTile(u,t){const n=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),c={request:this.map._requestManager.transformRequest(n,s.R.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.o.devicePixelRatio,promoteId:this.promoteId};if(u.actor&&u.state!=="expired")if(u.state==="loading")u.reloadCallback=t;else{if(u.buckets){const y=Object.values(u.buckets);for(const w of y)w.dirty=!0;return void(u.state="loaded")}u.request=u.actor.send("reloadTile",c,m.bind(this))}else u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",c,m.bind(this),void 0,!0);function m(y,w){return u.aborted?t(null):y&&y.status!==404?t(y):(this.map._refreshExpiredTiles&&w&&u.setExpiryData(w),u.loadModelData(w,this.map.painter),u.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends s.aS{constructor(u,t,n,c){super(u,t,n,c),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(y=>typeof y!="number"))||this.fire(new s.y(new s.V(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.y(new s.V(`sources.${u}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new s.y(new s.V(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new s.y(new s.V(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.y(new s.V(`sources.${u}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(u){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!u&&!this._playing||this.texture instanceof s.aU||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends s.E{constructor(u,t,n,c){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=t,this.setEventedParent(c),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new In(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,s.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this.map=u,this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:t,y:n,z:c}=u.canonical;return this._implementation.hasTile({x:t,y:n,z:c})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,t){const{x:n,y:c,z:m}=u.tileID.canonical,y=new AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:n,y:c,z:m},{signal:y.signal})).then((function(w){return delete u.request,u.aborted?(u.state="unloaded",t(null)):w===void 0?(u.state="errored",t(null)):w===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",t(null)):function(E){return E instanceof ImageData||E instanceof HTMLCanvasElement||E instanceof ImageBitmap||E instanceof HTMLImageElement}(w)?(this.loadTileData(u,w),u.state="loaded",void t(null)):(u.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.name!=="AbortError"&&(u.state="errored",t(w))}),u.request.cancel=()=>y.abort()}loadTileData(u,t){u.setTexture(t,this.map.painter)}unloadTile(u,t){if(u.texture&&u.texture instanceof s.T?(u.destroy(!0),u.texture&&u.texture instanceof s.T&&this.map.painter.saveTileTexture(u.texture)):u.destroy(),this._implementation.unloadTile){const{x:n,y:c,z:m}=u.tileID.canonical;this._implementation.unloadTile({x:n,y:c,z:m})}t&&t()}abortTile(u,t){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){const u=s.B(this.id,this.scope);this.map.style.clearSource(u)}_update(){this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}}},wc=function(u,t,n,c){const m=new oh[t.type](u,t,n,c);if(m.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${m.id}`);return s.aY(["load","abort","unload","serialize","prepare"],m),m};function lh(u,t,n=""){return`${n}:${t.id||""}:${t.layer.id}:${function(c){if("layerId"in c)return`layer:${c.layerId}`;{const{featuresetId:m,importId:y}=c;return`featureset:${m}${y?`:import:${y}`:""}`}}(u.target)}`}function Bo(u,t,n,c=""){if(u.uniqueFeatureID){const m=lh(u,t,c);if(n.has(m))return!0;n.add(m)}return!1}function ad(u,t,n,c,m=!1){const y=t.sourceCache.transform,w=t.sourceCache.tilesIn(u,t.has3DLayers,m);w.sort(hf);const E=[];for(const R of w){const L=R.tile.queryRenderedFeatures(t,R,n,c,y,m);Object.keys(L).length&&E.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:L})}return E.length===0?{}:function(R){const L={},P={};for(const F of R){const j=F.queryResults,H=F.wrappedTileID,$=P[H]=P[H]||{};for(const G in j){const te=j[G],X=$[G]=$[G]||{},re=L[G]=L[G]||[];for(const ce of te)X[ce.featureIndex]||(X[ce.featureIndex]=!0,re.push(ce))}}return L}(E)}function $a(u,t,n,c,m,y){const w={},E=c.queryRenderedSymbols(u),R=[];for(const L of Object.keys(E).map(Number))R.push(m[L]);R.sort(hf);for(const L of R){const P=L.featureIndex.lookupSymbolFeatures(E[L.bucketInstanceId],L.bucketIndex,L.sourceLayerIndex,t,n,y);for(const F in P){const j=w[F]=w[F]||[],H=P[F];H.sort(($,G)=>{const te=L.featureSortOrder;if(te){const X=te.indexOf($.featureIndex);return te.indexOf(G.featureIndex)-X}return G.featureIndex-$.featureIndex});for(const $ of H)j.push($)}}return w}function xo(u,t){const n=u.getRenderableIds().map(y=>u.getTileByID(y)),c=[],m={};for(let y=0;y<n.length;y++){const w=n[y],E=w.tileID.canonical.key;m[E]||(m[E]=!0,w.querySourceFeatures(c,t))}return c}function hf(u,t){const n=u.tileID,c=t.tileID;return n.overscaledZ-c.overscaledZ||n.canonical.y-c.canonical.y||n.wrap-c.wrap||n.canonical.x-c.canonical.x}function ch(u,t){const n={};if(!t)return n;for(const c of u){const m=c.layerIds.map(y=>t.getLayer(y)).filter(Boolean);if(m.length!==0){c.layers=m,c.stateDependentLayerIds&&(c.stateDependentLayers=c.stateDependentLayerIds.map(y=>m.filter(w=>w.id===y)[0]));for(const y of m)n[y.fqid]=c}}return n}const Ws=32,vo=33,cl=new Uint16Array(8184);for(let u=0;u<2046;u++){let t=u+2,n=0,c=0,m=0,y=0,w=0,E=0;for(1&t?m=y=w=Ws:n=c=E=Ws;(t>>=1)>1;){const L=n+m>>1,P=c+y>>1;1&t?(m=n,y=c,n=w,c=E):(n=m,c=y,m=w,y=E),w=L,E=P}const R=4*u;cl[R+0]=n,cl[R+1]=c,cl[R+2]=m,cl[R+3]=y}const wa=new Uint16Array(2178),Ta=new Uint8Array(1089),Tc=new Uint16Array(1089);function df(u){return u===0?-.03125:u===32?.03125:0}const lu={type:2,extent:s.al,loadGeometry:()=>[[new s.P(0,0),new s.P(s.al+1,0),new s.P(s.al+1,s.al+1),new s.P(0,s.al+1),new s.P(0,0)]]};class Sc{constructor(t,n,c,m,y,w){this.tileID=t,this.uid=s.b2(),this.uses=0,this.tileSize=n,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,m&&m.style&&(this._lastUpdatedBrightness=m.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection),this.worldview=w}registerFadeDuration(t){const n=t+this.timeAdded;n<s.o.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,c){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=ch(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const y=this.buckets[m];if(y instanceof s.b4){if(this.hasSymbolBuckets=!0,!c)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const y=this.buckets[m];if(y instanceof s.b4&&y.hasRTLText){this.hasRTLText=!0,s.b5();break}}this.queryPadding=0;for(const m in this.buckets){const y=this.buckets[m],w=n.style.getOwnLayer(m);if(!w)continue;const E=w.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,E)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new s.b3}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,n,c){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,ch(t.buckets,n.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const m in this.buckets){const y=this.buckets[m];y.uploadPending()&&y.upload(t)}const n=t.gl,c=this.imageAtlas;c&&!c.uploaded&&(this.imageAtlasTexture=new s.T(t,c.image,n.RGBA8,{useMipmap:!!c.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(t,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(t,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(t,n,c){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,c),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const m=n.style.getBrightness();(this._lastUpdatedBrightness||m)&&(this._lastUpdatedBrightness&&m&&Math.abs(this._lastUpdatedBrightness-m)<.001||(this.updateBuckets(n,this._lastUpdatedBrightness!==m),this._lastUpdatedBrightness=m))}queryRenderedFeatures(t,n,c,m,y,w){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const E=function(R,L){const P=s.bq([],[.5*R.width,.5*-R.height,1]);return s.br(P,P,[1,-1,0]),s.aB(P,P,R.calculateProjMatrix(L.toUnwrapped())),Float32Array.from(P)}(y,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:n,pixelPosMatrix:E,transform:m,availableImages:c,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,n){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const m=c.loadVTLayers(),y=n?n.sourceLayer:"",w=m._geojsonTileLayer||m[y];if(!w)return;const E=s.b6(n&&n.filter),{z:R,x:L,y:P}=this.tileID.canonical,F={z:R,x:L,y:P};for(let j=0;j<w.length;j++){const H=w.feature(j);if(E.needGeometry){const te=s.b7(H,!0);if(!E.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),te,this.tileID.canonical))continue}else if(!E.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),H))continue;const $=c.getId(H,y),G=new s.b8(H,R,L,P,$);G.tile=F,t.push(G)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const c=s.b9(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let m=!1;if(this.expirationTime>c)m=!1;else if(n)if(this.expirationTime<n)m=!0;else{const y=this.expirationTime-n;y?this.expirationTime=c+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,n){if(!this.latestFeatureIndex||!t.style)return;const c=this.latestFeatureIndex.loadVTLayers(),m=t.style.listImages(),y=t.style.getBrightness();for(const w in this.buckets){if(!t.style.hasLayer(w))continue;const E=this.buckets[w],R=E.layers[0],L=R.sourceLayer||"_geojsonTileLayer",P=c[L],F=t.style.getLayerSourceCache(R);let j={};F&&(j=F._state.getState(L,void 0));const H=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},$=Object.keys(j).length>0&&!n;($&&E.stateDependentLayers.length!==0||n)&&E.update(j,P,m,H,$?E.stateDependentLayers:E.layers,n,y),(E instanceof s.ba||E instanceof s.bb)&&t._terrain&&t._terrain.enabled&&F&&E.uploadPending()&&t._terrain._clearRenderCacheForTile(F.id,this.tileID);const G=t&&t.style&&t.style.getOwnLayer(w);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.o.now()+t}setTexture(t,n){const c=n.context,m=c.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t):(this.texture=new s.T(c,t,m.RGBA8,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(t,n){const c={};for(const m of n)c[m]=!0;this.dependencies[t]=c}hasDependency(t,n){for(const c of t){const m=this.dependencies[c];if(m){for(const y of n)if(m[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const c=s.bc(lu,this.tileID.canonical,this.tileTransform)[0],m=new s.bd,y=new s.be;for(let w=0;w<c.length;w++){const{x:E,y:R}=c[w];m.emplaceBack(E,R),y.emplaceBack(w)}y.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(y),this._tileDebugBuffer=t.createVertexBuffer(m,s.bf.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,m.length,y.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const c=s.bc(lu,this.tileID.canonical,this.tileTransform)[0];let m,y;if(this.isRaster){const w=function(E,R){const L=s.aZ(E,R),P=Math.pow(2,E.z);for(let te=0;te<vo;te++)for(let X=0;X<vo;X++){const re=s.a_((E.x+(X+df(X))/Ws)/P),ce=s.a$((E.y+(te+df(te))/Ws)/P),fe=R.project(re,ce),Te=te*vo+X;wa[2*Te+0]=Math.round((fe.x*L.scale-L.x)*s.al),wa[2*Te+1]=Math.round((fe.y*L.scale-L.y)*s.al)}Ta.fill(0),Tc.fill(0);for(let te=2045;te>=0;te--){const X=4*te,re=cl[X+0],ce=cl[X+1],fe=cl[X+2],Te=cl[X+3],we=re+fe>>1,Ee=ce+Te>>1,ve=we+Ee-ce,be=Ee+re-we,Ce=ce*vo+re,We=Te*vo+fe,ke=Ee*vo+we,ct=Math.hypot((wa[2*Ce+0]+wa[2*We+0])/2-wa[2*ke+0],(wa[2*Ce+1]+wa[2*We+1])/2-wa[2*ke+1])>=16;Ta[ke]=Ta[ke]||(ct?1:0),te<1022&&(Ta[ke]=Ta[ke]||Ta[(ce+be>>1)*vo+(re+ve>>1)]||Ta[(Te+be>>1)*vo+(fe+ve>>1)])}const F=new s.b0,j=new s.b1;let H=0;function $(te,X){const re=X*vo+te;return Tc[re]===0&&(F.emplaceBack(wa[2*re+0],wa[2*re+1],te*s.al/Ws,X*s.al/Ws),Tc[re]=++H),Tc[re]-1}function G(te,X,re,ce,fe,Te){const we=te+re>>1,Ee=X+ce>>1;if(Math.abs(te-fe)+Math.abs(X-Te)>1&&Ta[Ee*vo+we])G(fe,Te,te,X,we,Ee),G(re,ce,fe,Te,we,Ee);else{const ve=$(te,X),be=$(re,ce),Ce=$(fe,Te);j.emplaceBack(ve,be,Ce)}}return G(0,0,Ws,Ws,Ws,0),G(Ws,Ws,0,0,0,Ws),{vertices:F,indices:j}}(this.tileID.canonical,n);m=w.vertices,y=w.indices}else{m=new s.b0,y=new s.b1;for(const{x:E,y:R}of c)m.emplaceBack(E,R,0,0);const w=s.bh(m.int16.subarray(0,4*m.length),void 0,4);for(let E=0;E<w.length;E+=3)y.emplaceBack(w[E],w[E+1],w[E+2])}this._tileBoundsBuffer=t.createVertexBuffer(m,s.bi.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(y),this._tileBoundsSegments=s.bg.simpleSegment(0,0,m.length,y.length)}_makeGlobeTileDebugBuffers(t,n){const c=n.projection;if(!c||c.name!=="globe"||n.freezeTileCoverage)return;const m=this.tileID.canonical,y=s.bj(m,n),w=s.bk(y),E=s.aj(n.zoom);let R;E>0&&(R=s.bl(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,m,n,w,R,E),this._makeGlobeTileDebugTextBuffer(t,m,n,w,R,E)}_globePoint(t,n,c,m,y,w,E){let R=s.bm(t,n,c);if(w){const L=1<<c.z,P=s.aF(m.center.lng),F=s.aJ(m.center.lat),j=(c.x+.5)/L-P;let H=0;j>.5?H=-1:j<-.5&&(H=1);let $=(t/s.al+c.x)/L+H,G=(n/s.al+c.y)/L;$=($-P)*m._pixelsPerMercatorPixel+P,G=(G-F)*m._pixelsPerMercatorPixel+F;const te=[$*m.worldSize,G*m.worldSize,0];s.af(te,te,w),R=s.bn(R,te,E)}return s.af(R,R,y)}_makeGlobeTileDebugBorderBuffer(t,n,c,m,y,w){const E=new s.bd,R=new s.be,L=new s.bo,P=(j,H,$,G,te)=>{const X=($-j)/(te-1),re=(G-H)/(te-1),ce=E.length;for(let fe=0;fe<te;fe++){const Te=j+fe*X,we=H+fe*re;E.emplaceBack(Te,we);const Ee=this._globePoint(Te,we,n,c,m,y,w);L.emplaceBack(Ee[0],Ee[1],Ee[2]),R.emplaceBack(ce+fe)}},F=s.al;P(0,0,F,0,16),P(F,0,F,F,16),P(F,F,0,F,16),P(0,F,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(R),this._tileDebugBuffer=t.createVertexBuffer(E,s.bf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(L,s.bp.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,E.length,R.length)}_makeGlobeTileDebugTextBuffer(t,n,c,m,y,w){const E=s.al/4,R=new s.bd,L=new s.b1,P=new s.bo,F=25;L.reserve(32),R.reserve(F),P.reserve(F);const j=(H,$)=>F*H+$;for(let H=0;H<F;H++){const $=H*E;for(let G=0;G<F;G++){const te=G*E;R.emplaceBack(te,$);const X=this._globePoint(te,$,n,c,m,y,w);P.emplaceBack(X[0],X[1],X[2])}}for(let H=0;H<4;H++)for(let $=0;$<4;$++){const G=j(H,$),te=j(H,$+1),X=j(H+1,$),re=j(H+1,$+1);L.emplaceBack(G,te,X),L.emplaceBack(X,te,re)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(L),this._tileDebugTextBuffer=t.createVertexBuffer(R,s.bf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(P,s.bp.members),this._tileDebugTextSegments=s.bg.simpleSegment(0,0,F,32)}destroy(t=!1){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bs.setPbf(s.bt);class od extends Sc{constructor(t,n,c,m,y){super(t,n,c,m,y),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,n,c){const m=c.context,y=m.gl;let w=this.texturePerLayer.get(t)||c.getTileTexture(n.width);w&&w instanceof s.T?w.update(n,{premultiply:!1}):w=new s.T(m,n,y.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,w)}flushQueues(t){const n=this._workQueuePerLayer.get(t)||[],c=this._fetchQueuePerLayer.get(t)||[];for(;n.length;)n.pop()();for(;c.length;)c.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const n=this._workQueuePerLayer.get(t)||[];for(;n.length;)n.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const n=this._fetchQueuePerLayer.get(t)||[];for(;n.length;)n.pop()()}}fetchHeader(t=16384,n){const c=this._mrt=new s.bs(30),m=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=s.bu(m,(y,w,E,R)=>{if(y)n(y);else try{const L=c.getHeaderLength(w);if(L>t)return void(this.request=this.fetchHeader(L,n));c.parseHeader(w),this._isHeaderLoaded=!0;let P=0;for(const F of Object.values(c.layers))P=Math.max(P,F.dataIndex[F.dataIndex.length-1].lastByte);w.byteLength>=P&&(this.entireBuffer=w),n(null,this.entireBuffer||w,E,R)}catch(L){n(L)}}),this.request}fetchBandForRender(t,n,c,m){this.fetchBand(t,n,c,y=>{if(y)return void m(y);this.updateTextureDescriptor(t,n,c);const w=this.textureDescriptorPerLayer.get(n);m(null,w?w.img:null)})}fetchBand(t,n,c,m,y=!0){const w=this._mrt;if(!this._isHeaderLoaded||!w)return void m(new Error("Tile header is not ready"));const E=this.actor;if(!E)return void m(new Error("Can't fetch tile band without an actor"));let R;const L=s.B(String(c),s.B(this.tileID.key,t));let P=this._taskQueue.get(L);P?P.add(m):(P=new Set,P.add(m),this._taskQueue.set(L,P));const F=(G,te)=>{R.complete(G,te),G?m(G):(P.values().forEach(X=>X(null,te)),this._taskQueue.delete(L))},j=(G,te)=>{if(G)return m(G);const X=E.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:te,task:R},F,void 0,!0);if(n!==null){const re=this._workQueuePerLayer.get(n)||[];re.push(()=>{X&&X.cancel(),R.cancel()}),this._workQueuePerLayer.has(n)||this._workQueuePerLayer.set(n,re)}};let H;try{H=w.getLayer(t)}catch(G){if(this.state==="reloading")return;throw G}if(!H)return void m(new Error(`Unknown sourceLayer "${t}"`));if(H.hasDataForBand(c))return P.values().forEach(G=>G(null,null)),void this._taskQueue.delete(L);const $=H.getDataRange([c]);if(R=w.createDecodingTask($),!R||R.tasks.length)if(n!==null&&this.flushQueues(n),this.entireBuffer)j(null,this.entireBuffer.slice($.firstByte,$.lastByte+1));else{const G=Object.assign({},this.requestParams,{headers:{Range:`bytes=${$.firstByte}-${$.lastByte}`}}),te=s.bu(G,j);if(n!==null){const X=this._fetchQueuePerLayer.get(n)||[];X.push(()=>{te.cancel(),R.cancel()}),this._fetchQueuePerLayer.has(n)||this._fetchQueuePerLayer.set(n,X)}}}updateNeeded(t,n){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==n||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,n,c){if(!this._mrt)return;const m=this._mrt.getLayer(t);if(!m||!m.hasBand(c)||!m.hasDataForBand(c))return;const{bytes:y,tileSize:w,buffer:E,offset:R,scale:L}=m.getBandView(c),P=w+2*E,F=new s.q({width:P,height:P},y),j=this.texturePerLayer.get(n);j&&j instanceof s.T&&j.update(F,{premultiply:!1}),this.textureDescriptorPerLayer.set(n,{layer:t,band:c,img:F,buffer:E,offset:R,tileSize:w,format:m.pixelFormat,mix:[L,256*L,65536*L,16777216*L]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const n of this.texturePerLayer.values())n&&n instanceof s.T&&n.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Ec{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,c){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const y={value:n,timeout:void 0};if(c!==void 0&&(y.timeout=setTimeout(()=>{this.remove(t,y)},c)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const c=t.wrapped().key,m=n===void 0?0:this.data[c].indexOf(n),y=this.data[c][m];return this.data[c].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(y.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const c in this.data)for(const m of this.data[c])t(m.value)||n.push(m);for(const c of n)this.remove(c.value.tileID,c)}}class Ac{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,c){const m=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},Object.assign(this.stateChanges[t][m],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const y in this.state[t])y!==m&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const y in this.state[t][m])c[y]||(this.deletedStates[t][m][y]=null)}else for(const y in c)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][y]===null&&delete this.deletedStates[t][m][y]}removeFeatureState(t,n,c){if(this.deletedStates[t]===null)return;const m=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&n!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][c]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(c in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][c]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,n){const c=this.state[t]||{},m=this.stateChanges[t]||{},y=this.deletedStates[t];if(y===null)return{};if(n!==void 0){const E=String(n),R=Object.assign({},c[E],m[E]);if(y){const L=y[n];if(L===null)return{};for(const P in L)delete R[P]}return R}const w=Object.assign({},c,m);if(y)for(const E in y)delete w[E];return w}initializeTileState(t,n){t.refreshFeatureState(n)}coalesceChanges(t,n){const c={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const y={};for(const w in this.stateChanges[m])this.state[m][w]||(this.state[m][w]={}),Object.assign(this.state[m][w],this.stateChanges[m][w]),y[w]=this.state[m][w];c[m]=y}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const y={};if(this.deletedStates[m]===null)for(const w in this.state[m])y[w]={},this.state[m][w]={};else for(const w in this.deletedStates[m]){if(this.deletedStates[m][w]===null)this.state[m][w]={};else if(this.state[m][w])for(const E of Object.keys(this.deletedStates[m][w]))delete this.state[m][w][E];y[w]=this.state[m][w]}c[m]=c[m]||{},Object.assign(c[m],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const m in t)t[m].refreshFeatureState(n)}}class Oa extends s.E{constructor(t,n,c){super(),this.id=t,this._onlySymbols=c,n.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new Ec(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Ac,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const c=this._tiles[n];c.upload(t),c.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Cc).map(t=>t.key)}getRenderableIds(t,n){const c=[];for(const m in this._tiles)this._isIdRenderable(+m,t,n)&&c.push(this._tiles[m]);return t?c.sort((m,y)=>{const w=m.tileID,E=y.tileID,R=new s.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),L=new s.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-E.overscaledZ||L.y-R.y||L.x-R.x}).map(m=>m.tileID.key):c.map(m=>m.tileID).sort(Cc).map(m=>m.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n,c){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())&&(c||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,n){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=n),this._loadTile(c,this._tileLoaded.bind(this,c,t,n)))}_tileLoaded(t,n,c,m){if(m)if(t.state="errored",m.status!==404)this._source.fire(new s.y(m,{tile:t}));else{if(this._source.fire(new s.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=s.o.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new s.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const n=this.getRenderableIds();for(let m=0;m<n.length;m++){const y=n[m];if(t.neighboringTiles&&t.neighboringTiles[y]){const w=this.getTileByID(y);c(t,w),c(w,t)}}function c(m,y){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let w=y.tileID.canonical.x-m.tileID.canonical.x;const E=y.tileID.canonical.y-m.tileID.canonical.y,R=Math.pow(2,m.tileID.canonical.z),L=y.tileID.key;w===0&&E===0||Math.abs(E)>1||(Math.abs(w)>1&&(Math.abs(w+R)===1?w+=R:Math.abs(w-R)===1&&(w-=R)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,w,E),m.neighboringTiles&&m.neighboringTiles[L]&&(m.neighboringTiles[L].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,c,m){for(const y in this._tiles){let w=this._tiles[y];if(m[y]||!w.hasData()||w.tileID.overscaledZ<=n||w.tileID.overscaledZ>c)continue;let E=w.tileID;for(;w&&w.tileID.overscaledZ>n+1;){const L=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[L.key],w&&w.hasData()&&(E=L)}let R=E;for(;R.overscaledZ>n;)if(R=R.scaledTo(R.overscaledZ-1),t[R.key]){m[E.key]=E;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=n?c:null}for(let c=t.overscaledZ-1;c>=n;c--){const m=t.scaledTo(c),y=this._getLoadedTile(m);if(y)return y}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,n){n=n||this._source.tileSize;const c=Math.ceil(t.width/n)+1,m=Math.ceil(t.height/n)+1,y=Math.floor(c*m*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(E)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const c={};for(const m in this._tiles){const y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+n),c[y.tileID.key]=y}this._tiles=c;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(t,n,c,m,y){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;this.updateCacheSize(t,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const w=this._source.type==="batched-model";let E,R=this._source.maxzoom;const L=this.map&&this.map.painter?this.map.painter._terrain:null;if(L&&L.sourceCache===this&&L.attenuationRange()){const j=L.attenuationRange()[0],H=Math.floor(j)-Math.log2(L.getDemUpscale());R>H&&(R=H)}if(this.used||this.usedForTerrain){if(this._source.tileID)E=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(j=>new s.aO(j.canonical.z,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y));else if(this.tileCoverLift!==0){const j=t.clone();j.tileCoverLift=this.tileCoverLift,E=j.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.minzoom<=1&&t.projection.name==="globe"&&(E.push(new s.aO(1,0,1,0,0)),E.push(new s.aO(1,0,1,1,0)),E.push(new s.aO(1,0,1,0,1)),E.push(new s.aO(1,0,1,1,1)))}else if(E=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.hasTile){const j=this._source.hasTile.bind(this._source);E=E.filter(H=>j(H))}}else E=[];if(E.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!jl(this._source.type)){const j=t.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!c}),H=Math.min(j,this._source.maxzoom);if(w){const $=t.extendTileCover(E,H);for(const G of $)E.push(G)}else if(y){const $=t.extendTileCoverToNearPlane(E,this.transform.getFrustum(H),H);for(const G of $)E.push(G)}else if(this.castsShadows&&m){const $=t.extendTileCover(E,H,m);for(const G of $)this._shadowCasterTiles[G.key]=!0,E.push(G)}}const P=this._updateRetainedTiles(E);if(jl(this._source.type)&&E.length!==0){const j={},H={},$=Object.keys(P);for(const te of $){const X=P[te],re=this._tiles[te];if(!re||re.fadeEndTime&&re.fadeEndTime<=s.o.now())continue;const ce=this.findLoadedParent(X,Math.max(X.overscaledZ-Oa.maxOverzooming,this._source.minzoom));ce&&(this._addTile(ce.tileID),j[ce.tileID.key]=ce.tileID),H[te]=X}const G=E[E.length-1].overscaledZ;for(const te in this._tiles){const X=this._tiles[te];if(P[te]||!X.hasData())continue;let re=X.tileID;for(;re.overscaledZ>G;){re=re.scaledTo(re.overscaledZ-1);const ce=this._tiles[re.key];if(ce&&ce.hasData()&&H[re.key]){P[te]=X.tileID;break}}}for(const te in j)P[te]||(this._coveredTiles[te]=!0,P[te]=j[te])}for(const j in P)this._tiles[j].clearFadeHold();const F=s.bv(this._tiles,P);for(const j of F){const H=this._tiles[j];H.hasSymbolBuckets&&!H.holdingForFade()?H.setHoldDuration(this.map._fadeDuration):H.hasSymbolBuckets&&!H.symbolFadeFinished()||this._removeTile(+j)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const n={};if(t.length===0)return n;const c={},m=t.reduce((L,P)=>Math.min(L,P.overscaledZ),1/0),y=t[0].overscaledZ,w=Math.max(y-Oa.maxOverzooming,this._source.minzoom),E=Math.max(y+Oa.maxUnderzooming,this._source.minzoom),R={};for(const L of t){const P=this._addTile(L);n[L.key]=L,P.hasData()||m<this._source.maxzoom&&(R[L.key]=L)}this._retainLoadedChildren(R,m,E,n);for(const L of t){let P=this._tiles[L.key];if(P.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const j=L.children(this._source.maxzoom)[0],H=this.getTile(j);if(H&&H.hasData()){n[j.key]=j;continue}}else{const j=L.children(this._source.maxzoom);if(n[j[0].key]&&n[j[1].key]&&n[j[2].key]&&n[j[3].key])continue}let F=P.wasRequested();for(let j=L.overscaledZ-1;j>=w;--j){const H=L.scaledTo(j);if(c[H.key]||(c[H.key]=!0,P=this.getTile(H),!P&&F&&(P=this._addTile(H)),P&&(n[H.key]=H,F=P.wasRequested(),P.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let c,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){c=this._loadedParentTiles[m.key];break}n.push(m.key);const y=m.scaledTo(m.overscaledZ-1);if(c=this._getLoadedTile(y),c)break;m=y}for(const y of n)this._loadedParentTiles[y]=c}}_addTile(t){let n=this._tiles[t.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const c=!!n;if(!c){const m=this.map?this.map.painter:null,y=this._source.tileSize*t.overscaleFactor();n=this._source.type==="raster-array"?new od(t,y,this.transform.tileZoom,m,this._isRaster):new Sc(t,y,this.transform.tileZoom,m,this._isRaster,this._source.worldview),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n.uses++,this._tiles[t.key]=n,c||this._source.fire(new s.z("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=n.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,c){const m=[],y=this.transform;if(!y)return m;const w=y.projection.name==="globe",E=s.aF(y.center.lng);for(const R in this._tiles){const L=this._tiles[R];if(c&&L.clearQueryDebugViz(),L.holdingForFade())continue;let P;if(w){const F=L.tileID.canonical;if(F.z===0){const j=[Math.abs(s.aA(E,...cu(F,-1))-E),Math.abs(s.aA(E,...cu(F,1))-E)];P=[0,2*j.indexOf(Math.min(...j))-1]}else{const j=[Math.abs(s.aA(E,...cu(F,-1))-E),Math.abs(s.aA(E,...cu(F,0))-E),Math.abs(s.aA(E,...cu(F,1))-E)];P=[j.indexOf(Math.min(...j))-1]}}else P=[0];for(const F of P){const j=t.containsTile(L,y,n,F);j&&m.push(j)}}return m}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,n){const c=this.getRenderableIds(t,n).map(y=>this._tiles[y].tileID),m=this.transform.projection.name==="globe";for(const y of c)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=m?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return c}sortCoordinatesByDistance(t){const n=t.slice(),c=this.transform._camera.position,m=this.transform._camera.forward(),y={};for(const w of n){const E=1/(1<<w.canonical.z);y[w.key]=((w.canonical.x+.5)*E+w.wrap-c[0])*m[0]+((w.canonical.y+.5)*E-c[1])*m[1]-c[2]*m[2]}return n.sort((w,E)=>y[w.key]-y[E.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(jl(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=s.o.now())return!0}return!1}setFeatureState(t,n,c){this._state.updateState(t=t||"_geojsonTileLayer",n,c)}removeFeatureState(t,n,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,c)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,c){const m=this._tiles[t];m&&m.setDependencies(n,c)}reloadTilesForDependencies(t,n){for(const c in this._tiles)this._tiles[c].hasDependency(t,n)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(t,n))}_preloadTiles(t,n){if(!this._sourceLoaded){const R=()=>{this._sourceLoaded&&(this._source.off("data",R),this._preloadTiles(t,n))};return void this._source.on("data",R)}const c=new Map,m=Array.isArray(t)?t:[t],y=this.map.painter.terrain,w=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const R of m){const L=R.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const P of L)c.set(P.key,P);this.usedForTerrain&&R.updateElevation(!1)}const E=Array.from(c.values());s.bw(E,(R,L)=>{const P=new Sc(R,this._source.tileSize*R.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(P,F=>{this._source.type==="raster-dem"&&P.dem&&this._backfillDEM(P),L(F,P)})},n)}}function Cc(u,t){const n=Math.abs(2*u.wrap)-+(u.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return u.overscaledZ-t.overscaledZ||c-n||t.canonical.y-u.canonical.y||t.canonical.x-u.canonical.x}function jl(u){return u==="raster"||u==="image"||u==="video"||u==="custom"}function cu(u,t){const n=1<<u.z;return[u.x/n+t,(u.x+1)/n+t]}Oa.maxOverzooming=10,Oa.maxUnderzooming=3;class uh{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,n=!1;for(const c in this.style._mergedLayers){const m=this.style._mergedLayers[c];if(m.type==="fill-extrusion"||m.type==="building")this.layers.push({layer:m,visible:t,visibilityChanged:n});else if(m.type==="model"){const y=this.style.getLayerSource(m);y&&y.type==="batched-model"&&this.layers.push({layer:m,visible:t,visibilityChanged:n})}}}onNewFrame(t){this.layersGotHidden=!1;for(const n of this.layers){const c=n.layer;let m=!1;c.type==="fill-extrusion"?m=!c.isHidden(t)&&c.paint.get("fill-extrusion-opacity")>0:c.type==="building"?m=!c.isHidden(t)&&c.paint.get("building-opacity")>0:c.type==="model"&&(m=!c.isHidden(t)&&c.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!m&&n.visible,n.visible=m}}updateZOffset(t,n){this.currentBuildingBuckets=[];for(const m of this.layers){const y=m.layer,w=this.style.getLayerSourceCache(y);let E=1;y.type==="fill-extrusion"?E=m.visible?y.paint.get("fill-extrusion-vertical-scale"):0:y.type==="building"&&(E=m.visible?y.paint.get("building-vertical-scale"):0);let R=w?w.getTile(n):null;if(!R&&w)for(const L in w._tiles){const P=w._tiles[L];if(n.canonical.isChildOf(P.tileID.canonical)){R=P;break}}this.currentBuildingBuckets.push({bucket:R?R.getBucket(y):null,tileID:R?R.tileID:n,verticalScale:E})}t.hasAnyZOffset=!1;let c=!1;for(let m=0;m<t.symbolInstances.length;m++){const y=t.symbolInstances.get(m),w=y.zOffset,E=this._getHeightAtTileOffset(n,y.tileAnchorX,y.tileAnchorY);y.zOffset=E!==Number.NEGATIVE_INFINITY?E:w,c||w===y.zOffset||(c=!0),t.hasAnyZOffset||y.zOffset===0||(t.hasAnyZOffset=!0)}c&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,n,c,m){let y=n,w=c;if(t.canonical.z!==m.canonical.z){const E=m.canonical,R=1/(1<<t.canonical.z-E.z);y=(n+t.canonical.x*s.al)*R-E.x*s.al|0,w=(c+t.canonical.y*s.al)*R-E.y*s.al|0}return{tileX:y,tileY:w}}_getHeightAtTileOffset(t,n,c){let m,y;for(let w=0;w<this.layers.length;++w){const E=this.layers[w].layer;if(E.type!=="fill-extrusion"&&E.type!=="building")continue;const{bucket:R,tileID:L,verticalScale:P}=this.currentBuildingBuckets[w];if(!R)continue;const{tileX:F,tileY:j}=this._mapCoordToOverlappingTile(t,n,c,L),H=R.getHeightAtTileCoord(F,j);H&&H.height!==void 0&&(H.hidden?m=H.height:y=Math.max(H.height*P,y||0))}if(y!==void 0)return y;for(let w=0;w<this.layers.length;++w){const E=this.layers[w];if(E.layer.type!=="model"||!E.visible)continue;const{bucket:R,tileID:L}=this.currentBuildingBuckets[w];if(!R)continue;const{tileX:P,tileY:F}=this._mapCoordToOverlappingTile(t,n,c,L),j=R.getHeightAtTileCoord(P,F);if(j&&!j.hidden)return j.height===void 0&&m!==void 0?Math.min(j.maxHeight,m)*j.verticalScale:j.height?j.height*j.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ff(u,t){const n={};for(const c in u)c!=="ref"&&(n[c]=u[c]);return s.bx.forEach(c=>{c in t&&(n[c]=t[c])}),n}function Rc(u){u=u.slice();const t=Object.create(null);for(let n=0;n<u.length;n++)t[u[n].id]=u[n];for(let n=0;n<u.length;n++)"ref"in u[n]&&(u[n]=ff(u[n],t[u[n].ref]));return u}const Mr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function ul(u,t,n){n.push({command:Mr.addSource,args:[u,t[u]]})}function Nl(u,t,n){t.push({command:Mr.removeSource,args:[u]}),n[u]=!0}function pf(u,t,n,c){Nl(u,n,c),ul(u,t,n)}function uu(u,t,n){let c;for(c in u[n])if(u[n].hasOwnProperty(c)&&c!=="data"&&!s.by(u[n][c],t[n][c]))return!1;for(c in t[n])if(t[n].hasOwnProperty(c)&&c!=="data"&&!s.by(u[n][c],t[n][c]))return!1;return!0}function kl(u,t,n,c,m,y){let w;for(w in t=t||{},u=u||{})u.hasOwnProperty(w)&&(s.by(u[w],t[w])||n.push({command:y,args:[c,w,t[w],m]}));for(w in t)t.hasOwnProperty(w)&&!u.hasOwnProperty(w)&&(s.by(u[w],t[w])||n.push({command:y,args:[c,w,t[w],m]}))}function Bl(u){return u.id}function Mc(u,t){return u[t.id]=t,u}function ld(u,t,n){const c=t.createTileMatrix(u,u.worldSize,n.toUnwrapped());return s.aB(new Float32Array(16),u.projMatrix,c)}function ja(u,t,n){if(t.projection.name===n.projection.name)return u.projMatrix;const c=n.clone();return c.setProjection(t.projection),ld(c,t.getProjection(),u)}function no(u,t,n){return t.name===n.projection.name?u.projMatrix:ld(n,t,u)}class cd{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.aA(t,0,1);let n=1,c=this._distances[n];const m=t*this.paddedLength+this.padding;for(;c<m&&n<this._distances.length;)c=this._distances[++n];const y=n-1,w=this._distances[y],E=c-w,R=E>0?(m-w)/E:0;return this.points[y].mult(1-R).add(this.points[n].mult(R))}}class hu{constructor(t,n,c){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(n/c);for(let w=0;w<this.xCellCount*this.yCellCount;w++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,c,m,y){this._forEachCell(n,c,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(t,n,c,m){this._forEachCell(n-m,c-m,n+m,c+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(c),this.circles.push(m)}_insertBoxCell(t,n,c,m,y,w){this.boxCells[y].push(w)}_insertCircleCell(t,n,c,m,y,w){this.circleCells[y].push(w)}_query(t,n,c,m,y,w){if(c<0||t>this.width||m<0||n>this.height)return!y&&[];const E=[];if(t<=0&&n<=0&&this.width<=c&&this.height<=m){if(y)return!0;for(let R=0;R<this.boxKeys.length;R++)E.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const L=this.circles[3*R],P=this.circles[3*R+1],F=this.circles[3*R+2];E.push({key:this.circleKeys[R],x1:L-F,y1:P-F,x2:L+F,y2:P+F})}return w?E.filter(w):E}return this._forEachCell(t,n,c,m,this._queryCell,E,{hitTest:y,seenUids:{box:{},circle:{}}},w),y?E.length>0:E}_queryCircle(t,n,c,m,y){const w=t-c,E=t+c,R=n-c,L=n+c;if(E<0||w>this.width||L<0||R>this.height)return!m&&[];const P=[];return this._forEachCell(w,R,E,L,this._queryCellCircle,P,{hitTest:m,circle:{x:t,y:n,radius:c},seenUids:{box:{},circle:{}}},y),m?P.length>0:P}query(t,n,c,m,y){return this._query(t,n,c,m,!1,y)}hitTest(t,n,c,m,y){return this._query(t,n,c,m,!0,y)}hitTestCircle(t,n,c,m){return this._queryCircle(t,n,c,!0,m)}_queryCell(t,n,c,m,y,w,E,R){const L=E.seenUids,P=this.boxCells[y];if(P!==null){const j=this.bboxes;for(const H of P)if(!L.box[H]){L.box[H]=!0;const $=4*H;if(t<=j[$+2]&&n<=j[$+3]&&c>=j[$+0]&&m>=j[$+1]&&(!R||R(this.boxKeys[H]))){if(E.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[H],x1:j[$],y1:j[$+1],x2:j[$+2],y2:j[$+3]})}}}const F=this.circleCells[y];if(F!==null){const j=this.circles;for(const H of F)if(!L.circle[H]){L.circle[H]=!0;const $=3*H;if(this._circleAndRectCollide(j[$],j[$+1],j[$+2],t,n,c,m)&&(!R||R(this.circleKeys[H]))){if(E.hitTest)return w.push(!0),!0;{const G=j[$],te=j[$+1],X=j[$+2];w.push({key:this.circleKeys[H],x1:G-X,y1:te-X,x2:G+X,y2:te+X})}}}}}_queryCellCircle(t,n,c,m,y,w,E,R){const L=E.circle,P=E.seenUids,F=this.boxCells[y];if(F!==null){const H=this.bboxes;for(const $ of F)if(!P.box[$]){P.box[$]=!0;const G=4*$;if(this._circleAndRectCollide(L.x,L.y,L.radius,H[G+0],H[G+1],H[G+2],H[G+3])&&(!R||R(this.boxKeys[$])))return w.push(!0),!0}}const j=this.circleCells[y];if(j!==null){const H=this.circles;for(const $ of j)if(!P.circle[$]){P.circle[$]=!0;const G=3*$;if(this._circlesCollide(H[G],H[G+1],H[G+2],L.x,L.y,L.radius)&&(!R||R(this.circleKeys[$])))return w.push(!0),!0}}}_forEachCell(t,n,c,m,y,w,E,R){const L=this._convertToXCellCoord(t),P=this._convertToYCellCoord(n),F=this._convertToXCellCoord(c),j=this._convertToYCellCoord(m);for(let H=L;H<=F;H++)for(let $=P;$<=j;$++)if(y.call(this,t,n,c,m,this.xCellCount*$+H,w,E,R))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,c,m,y,w){const E=m-t,R=y-n,L=c+w;return L*L>E*E+R*R}_circleAndRectCollide(t,n,c,m,y,w,E){const R=(w-m)/2,L=Math.abs(t-(m+R));if(L>R+c)return!1;const P=(E-y)/2,F=Math.abs(n-(y+P));if(F>P+c)return!1;if(L<=R||F<=P)return!0;const j=L-R,H=F-P;return j*j+H*H<=c*c}}const hh={unknown:0,flipRequired:1,flipNotRequired:2},dh=Math.tan(85*Math.PI/180);function so(u,t,n,c,m,y,w){const E=s.bC();if(n)if(y.name==="globe"){const R=s.bD(m,t);s.aB(E,E,R)}else{const R=s.bE([],w);E[0]=R[0],E[1]=R[1],E[4]=R[2],E[5]=R[3],c||s.bB(E,E,m.angle)}else s.aB(E,m.labelPlaneMatrix,u);return E}function Fl(u,t,n,c,m,y,w){const E=so(u,t,n,c,m,y,w);return y.name==="globe"&&n||(E[2]=E[6]=E[10]=E[14]=0),E}function du(u,t,n,c,m,y,w){if(n){if(y.name==="globe"){const E=so(u,t,n,c,m,y,w);return s.bl(E,E),s.aB(E,u,E),E}{const E=s.bz(u),R=s.bA([]);return R[0]=w[0],R[1]=w[1],R[4]=w[2],R[5]=w[3],s.aB(E,E,R),c||s.bB(E,E,-m.angle),E}}return m.glCoordMatrix}function Za(u,t,n,c){const m=[u,t,n,1];n?s.aC(m,m,c):Ap(m,m,c);const y=m[3];return m[0]/=y,m[1]/=y,m[2]/=y,m}function fu(u,t){return Math.min(.5+u/t*.5,1.5)}function ao(u,t){const n=u[0]/u[3],c=u[1]/u[3];return n>=-t[0]&&n<=t[0]&&c>=-t[1]&&c<=t[1]}function Tp(u,t,n,c,m,y,w,E,R,L){const P=n.transform,F=c?u.textSizeData:u.iconSizeData,j=s.bK(F,n.transform.zoom),H=P.projection.name==="globe",$=[256/n.width*2+1,256/n.height*2+1],G=c?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;G.clear();let te=null;H&&(te=c?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const X=u.lineVertexArray,re=c?u.text.placedSymbolArray:u.icon.placedSymbolArray,ce=n.transform.width/n.transform.height;let fe,Te=!1;for(let we=0;we<re.length;we++){const Ee=re.get(we),{numGlyphs:ve,writingMode:be}=Ee;if(be!==s.bL.vertical||Te||fe===s.bL.horizontal||(Te=!0),fe=be,(Ee.hidden||be===s.bL.vertical)&&!Te){Li(ve,G);continue}Te=!1;const Ce=new s.P(Ee.tileAnchorX,Ee.tileAnchorY);let{x:We,y:ke,z:ct}=P.projection.projectTilePoint(Ce.x,Ce.y,L.canonical);if(R){const[St,gi,li]=R(Ce);We+=St,ke+=gi,ct+=li}const Ze=[We,ke,ct,1];if(s.aC(Ze,Ze,t),!ao(Ze,$)){Li(ve,G);continue}const ot=Ze[3],Bt=fu(n.transform.getCameraToCenterDistance(P.projection),ot),Ye=s.bM(F,j,Ee),Oe=w?Ye/Bt:Ye*Bt,nt=Za(We,ke,ct,m);if(nt[3]<=0){Li(ve,G);continue}let Ge={};const ut=s.an(u.layers[0].layout.get("text-max-angle")),_t=Math.cos(ut),$t=w?null:R,Rt=$r(Ee,Oe,!1,E,t,m,y,u.glyphOffsetArray,X,G,te,nt,Ce,Ge,ce,$t,P.projection,L,w,_t);Te=Rt.useVertical,$t&&Rt.needsFlipping&&(Ge={}),(Rt.notEnoughRoom||Te||Rt.needsFlipping&&$r(Ee,Oe,!0,E,t,m,y,u.glyphOffsetArray,X,G,te,nt,Ce,Ge,ce,$t,P.projection,L,w,_t).notEnoughRoom)&&Li(ve,G)}c?(u.text.dynamicLayoutVertexBuffer.updateData(G),te&&u.text.globeExtVertexBuffer&&u.text.globeExtVertexBuffer.updateData(te)):(u.icon.dynamicLayoutVertexBuffer.updateData(G),te&&u.icon.globeExtVertexBuffer&&u.icon.globeExtVertexBuffer.updateData(te))}function fh(u,t,n,c,m,y,w,E,R,L,P,F,j,H,$,G,te){const{lineStartIndex:X,glyphStartIndex:re,segment:ce}=E,fe=re+E.numGlyphs,Te=X+E.lineLength,we=t.getoffsetX(re),Ee=t.getoffsetX(fe-1),ve=mf(u*we,n,c,m,y,w,ce,X,Te,R,L,P,F,j,!0,H,$,G,te);if(!ve)return null;const be=mf(u*Ee,n,c,m,y,w,ce,X,Te,R,L,P,F,j,!0,H,$,G,te);return be?{first:ve,last:be}:null}function Sp(u,t,n,c){return u===s.bL.horizontal&&Math.abs(c)>Math.abs(n)?{useVertical:!0}:u===s.bL.vertical?c>0?{needsFlipping:!0}:null:t!==hh.unknown&&function(m,y){return m===0||Math.abs(y/m)>dh}(n,c)?t===hh.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function $r(u,t,n,c,m,y,w,E,R,L,P,F,j,H,$,G,te,X,re,ce){const fe=t/24,Te=u.lineOffsetX*fe,we=u.lineOffsetY*fe,{lineStartIndex:Ee,glyphStartIndex:ve,numGlyphs:be,segment:Ce,writingMode:We,flipState:ke}=u,ct=Ee+u.lineLength,Ze=ot=>{if(P){const[nt,Ge,ut]=ot.up,_t=L.length;s.bN(P,_t+0,nt,Ge,ut),s.bN(P,_t+1,nt,Ge,ut),s.bN(P,_t+2,nt,Ge,ut),s.bN(P,_t+3,nt,Ge,ut)}const[Bt,Ye,Oe]=ot.point;s.bO(L,Bt,Ye,Oe,ot.angle)};if(be>1){const ot=fh(fe,E,Te,we,n,F,j,u,R,y,H,G,!1,te,X,re,ce);if(!ot)return{notEnoughRoom:!0};if(c&&!n){let[Bt,Ye,Oe]=ot.first.point,[nt,Ge,ut]=ot.last.point;[Bt,Ye]=Za(Bt,Ye,Oe,w),[nt,Ge]=Za(nt,Ge,ut,w);const _t=Sp(We,ke,(nt-Bt)*$,Ge-Ye);if(u.flipState=_t&&_t.needsFlipping?hh.flipRequired:hh.flipNotRequired,_t)return _t}Ze(ot.first);for(let Bt=ve+1;Bt<ve+be-1;Bt++){const Ye=mf(fe*E.getoffsetX(Bt),Te,we,n,F,j,Ce,Ee,ct,R,y,H,G,!1,!1,te,X,re,ce);if(!Ye)return L.length-=4*(Bt-ve),{notEnoughRoom:!0};Ze(Ye)}Ze(ot.last)}else{if(c&&!n){const Bt=Za(j.x,j.y,0,m),Ye=Ee+Ce+1,Oe=new s.P(R.getx(Ye),R.gety(Ye)),nt=Za(Oe.x,Oe.y,0,m),Ge=nt[3]>0?nt:jm(j,Oe,Bt,1,m,void 0,te,X.canonical),ut=Sp(We,ke,(Ge[0]-Bt[0])*$,Ge[1]-Bt[1]);if(u.flipState=ut&&ut.needsFlipping?hh.flipRequired:hh.flipNotRequired,ut)return ut}const ot=mf(fe*E.getoffsetX(ve),Te,we,n,F,j,Ce,Ee,ct,R,y,H,G,!1,!1,te,X,re,ce);if(!ot)return{notEnoughRoom:!0};Ze(ot)}return{}}function Ep(u,t,n,c,m){const{x:y,y:w,z:E}=c.projectTilePoint(u.x,u.y,t);if(!m)return Za(y,w,E,n);const[R,L,P]=m(u);return Za(y+R,w+L,E+P,n)}function jm(u,t,n,c,m,y,w,E){const R=Ep(u.sub(t)._unit()._add(u),E,m,w,y);return s.av(R,n,R),s.aw(R,R),s.bH(R,n,R,c)}function mf(u,t,n,c,m,y,w,E,R,L,P,F,j,H,$,G,te,X,re){const ce=c?u-t:u+t;let fe=ce>0?1:-1,Te=0;c&&(fe*=-1,Te=Math.PI),fe<0&&(Te+=Math.PI);let we=E+w+(fe>0?0:1)|0,Ee=m,ve=m,be=0,Ce=0;const We=Math.abs(ce),ke=[],ct=[];let Ze=y,ot=Ze,Bt=s.bF([]);const Ye=()=>jm(ot,Ze,ve,We-be+1,P,j,G,te.canonical);for(;be+Ce<=We;){if(we+=fe,we<E||we>=R)return null;if(ve=Ee,ot=Ze,ke.push(ve),H&&ct.push(ot),Ze=new s.P(L.getx(we),L.gety(we)),Ee=F[we],!Ee){const li=Ep(Ze,te.canonical,P,G,j);Ee=li[3]>0?F[we]=li:Ye()}be+=Ce;const St=s.av([],Ee,ve),gi=s.bG(ve,Ee);if(n&&gi>0&&Ce>0&&s.bJ(Bt,St)/(Ce*gi)<re)return null;Ce=gi,Bt=St}$&&j&&(F[we]&&(Ee=Ye(),Ce=s.bG(ve,Ee),Bt=s.av([],Ee,ve)),F[we]=Ee);const Oe=(We-be)/Ce,nt=Ze.sub(ot)._mult(Oe)._add(ot),Ge=s.bH([],ve,Bt,Oe);let ut=[0,0,1],_t=Bt[0],$t=Bt[1];if(X&&(ut=G.upVector(te.canonical,nt.x,nt.y),ut[0]!==0||ut[1]!==0||ut[2]!==1)){const St=[ut[2],0,-ut[0]],gi=s.bI([],ut,St);s.aw(St,St),s.aw(gi,gi),_t=s.bJ(Bt,St),$t=s.bJ(Bt,gi)}if(n){const St=s.bI([],ut,Bt);s.aw(St,St),s.bH(Ge,Ge,St,n*fe)}const Rt=Te+Math.atan2($t,_t);return ke.push(Ge),H&&ct.push(nt),{point:Ge,angle:Rt,path:ke,tilePath:ct,up:ut}}function Li(u,t){const n=t.length,c=n+4*u;t.resize(c),t.float32.fill(-1/0,4*n,4*c)}function Ap(u,t,n){const c=t[0],m=t[1];return u[0]=n[0]*c+n[4]*m+n[12],u[1]=n[1]*c+n[5]*m+n[13],u[3]=n[3]*c+n[7]*m+n[15],u}const oo=100;class Fo{constructor(t,n,c=new hu(t.width+200,t.height+200,25),m=new hu(t.width+200,t.height+200,25)){this.transform=t,this.grid=c,this.ignoredGrid=m,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+oo,this.screenBottomBoundary=t.height+oo,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=n}placeCollisionBox(t,n,c,m,y,w,E,R,L,P,F){let j=c.projectedAnchorX,H=c.projectedAnchorY,$=c.projectedAnchorZ;const G=c.tileAnchorX,te=c.tileAnchorY,X=c.elevation,re=c.tileID,ce=t.getProjection();if(X&&re){const[ct,Ze,ot]=ce.upVector(re.canonical,c.tileAnchorX,c.tileAnchorY),Bt=ce.upVectorScale(re.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;j+=ct*X*Bt,H+=Ze*X*Bt,$+=ot*X*Bt}const fe=t.projection.name==="globe",Te=t.projection.name==="globe"?s.aj(this.transform.zoom):0;if(re&&fe&&Te<1&&!w){const ct=1<<re.canonical.z,Ze=s.bP(G,te);s.bQ(Ze,Ze,1/s.al),s.bR(Ze,Ze,s.bP(re.canonical.x,re.canonical.y)),s.bQ(Ze,Ze,1/ct),s.bS(Ze,Ze,s.bP(m[0],m[1])),Ze[0]=s.bT(Ze[0],-.5,.5),s.bQ(Ze,Ze,s.al);const ot=s.bU(Ze[0],Ze[1],s.al/(2*Math.PI),1);s.aC(ot,ot,y),j=s.ak(j,ot[0],Te),H=s.ak(H,ot[1],Te),$=s.ak($,ot[2],Te)}const we=this.projectAndGetPerspectiveRatio(P,j,H,$,c.tileID,ce.name==="globe"||!!X||this.transform.pitch>0,ce),Ee=L*we.perspectiveRatio,ve=(c.x1*n+E.x-c.padding)*Ee+we.point.x,be=(c.y1*n+E.y-c.padding)*Ee+we.point.y,Ce=(c.x2*n+E.x+c.padding)*Ee+we.point.x,We=(c.y2*n+E.y+c.padding)*Ee+we.point.y,ke=we.perspectiveRatio<=.55||we.occluded;return!this.isInsideGrid(ve,be,Ce,We)||!R&&this.grid.hitTest(ve,be,Ce,We,F)||ke?{box:[],offscreen:!1,occluded:we.occluded}:{box:[ve,be,Ce,We],offscreen:this.isOffscreen(ve,be,Ce,We),occluded:!1}}placeCollisionCircles(t,n,c,m,y,w,E,R,L,P,F,j,H,$,G){const te=[],X=this.transform.elevation,re=t.getProjection(),ce=X?X.getAtTileOffsetFunc(G,this.transform.center.lat,this.transform.worldSize,re):null,fe=new s.P(c.tileAnchorX,c.tileAnchorY);let{x:Te,y:we,z:Ee}=re.projectTilePoint(fe.x,fe.y,G.canonical);if(ce){const[ut,_t,$t]=ce(fe);Te+=ut,we+=_t,Ee+=$t}const ve=re.name==="globe",be=this.projectAndGetPerspectiveRatio(E,Te,we,Ee,G,ve||!!X||this.transform.pitch>0,re),{perspectiveRatio:Ce}=be,We=(F?w/Ce:w*Ce)/s.bX,ke=Za(Te,we,Ee,R),ct=c.lineOffsetX*We,Ze=c.lineOffsetY*We,ot=s.an(t.layers[0].layout.get("text-max-angle")),Bt=Math.cos(ot),Ye=be.signedDistanceFromCamera>0?fh(We,y,ct,Ze,!1,ke,fe,c,m,R,{},X&&!F?ce:null,F&&!!X,re,G,F,Bt):null;let Oe=!1,nt=!1,Ge=!0;if(Ye&&!be.occluded){const ut=.5*H*Ce+$,_t=new s.P(-100,-100),$t=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Rt=new cd,{first:St,last:gi}=Ye,li=St.path.length;let ti=[];for(let Ki=li-1;Ki>=1;Ki--)ti.push(St.path[Ki]);for(let Ki=1;Ki<gi.path.length;Ki++)ti.push(gi.path[Ki]);const ci=2.5*ut;L&&(ti=ti.map(([Ki,Hi,jr],qi)=>(ce&&!ve&&(jr=ce(qi<li-1?St.tilePath[li-1-qi]:gi.tilePath[qi-li+2])[2]),Za(Ki,Hi,jr,L))),ti.some(Ki=>Ki[3]<=0)&&(ti=[]));let Oi=[];if(ti.length>0){let Ki=1/0,Hi=-1/0,jr=1/0,qi=-1/0;for(const yr of ti)Ki=Math.min(Ki,yr[0]),jr=Math.min(jr,yr[1]),Hi=Math.max(Hi,yr[0]),qi=Math.max(qi,yr[1]);Hi>=_t.x&&Ki<=$t.x&&qi>=_t.y&&jr<=$t.y&&(Oi=[ti.map(yr=>new s.P(yr[0],yr[1]))],(Ki<_t.x||Hi>$t.x||jr<_t.y||qi>$t.y)&&(Oi=s.bV(Oi,_t.x,_t.y,$t.x,$t.y)))}for(const Ki of Oi){Rt.reset(Ki,.25*ut);let Hi=0;Hi=Rt.length<=.5*ut?1:Math.ceil(Rt.paddedLength/ci)+1;for(let jr=0;jr<Hi;jr++){const qi=jr/Math.max(Hi-1,1),yr=Rt.lerp(qi),Ur=yr.x+oo,fn=yr.y+oo;te.push(Ur,fn,ut,0);const Yi=Ur-ut,Or=fn-ut,Tr=Ur+ut,Nr=fn+ut;if(Ge=Ge&&this.isOffscreen(Yi,Or,Tr,Nr),nt=nt||this.isInsideGrid(Yi,Or,Tr,Nr),!n&&this.grid.hitTestCircle(Ur,fn,ut,j)&&(Oe=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Oe,occluded:!1}}}}return{circles:!P&&Oe||!nt?[]:te,offscreen:Ge,collisionDetected:Oe,occluded:be.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let c=1/0,m=1/0,y=-1/0,w=-1/0;for(const P of t){const F=new s.P(P.x+oo,P.y+oo);c=Math.min(c,F.x),m=Math.min(m,F.y),y=Math.max(y,F.x),w=Math.max(w,F.y),n.push(F)}const E=this.grid.query(c,m,y,w).concat(this.ignoredGrid.query(c,m,y,w)),R={},L={};for(const P of E){const F=P.key;if(R[F.bucketInstanceId]===void 0&&(R[F.bucketInstanceId]={}),R[F.bucketInstanceId][F.featureIndex])continue;const j=[new s.P(P.x1,P.y1),new s.P(P.x2,P.y1),new s.P(P.x2,P.y2),new s.P(P.x1,P.y2)];s.bW(n,j)&&(R[F.bucketInstanceId][F.featureIndex]=!0,L[F.bucketInstanceId]===void 0&&(L[F.bucketInstanceId]=[]),L[F.bucketInstanceId].push(F.featureIndex))}return L}insertCollisionBox(t,n,c,m,y){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:m,collisionGroupID:y},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,c,m,y){const w=n?this.ignoredGrid:this.grid,E={bucketInstanceId:c,featureIndex:m,collisionGroupID:y};for(let R=0;R<t.length;R+=4)w.insertCircle(E,t[R],t[R+1],t[R+2])}projectAndGetPerspectiveRatio(t,n,c,m,y,w,E){const R=[n,c,m,1];let L=!1;m||this.transform.pitch>0?(s.aC(R,R,t),this.fogState&&y&&E.name!=="globe"&&(L=function(j,H,$,G,te,X){const re=X.calculateFogTileMatrix(te),ce=[H,$,G];return s.af(ce,ce,re),Mi(j,s.ag(ce),X.pitch,X._fov)}(this.fogState,n,c,m,y.toUnwrapped(),this.transform)>.9)):Ap(R,R,t);const P=R[3];return{point:new s.P((R[0]/P+1)/2*this.transform.width+oo,(-R[1]/P+1)/2*this.transform.height+oo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/P*.5,1.5),signedDistanceFromCamera:P,occluded:w&&R[2]>P||L}}isOffscreen(t,n,c,m){return c<oo||t>=this.screenRightBoundary||m<oo||n>this.screenBottomBoundary}isInsideGrid(t,n,c,m){return c>=0&&t<this.gridRightBoundary&&m>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=s.bA([]);return s.br(t,t,[-100,-100,0]),t}}class gf{constructor(t,n,c,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):m&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class bo{constructor(t,n,c,m,y,w=!1){this.text=new gf(t?t.text:null,n,c,y),this.icon=new gf(t?t.icon:null,n,m,y),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class yi{constructor(t,n,c,m=!1){this.text=t,this.icon=n,this.skipFade=c,this.clipped=m}}class Zr{constructor(){this.invProjMatrix=s.bC(),this.viewportMatrix=s.bC(),this.circles=[]}}class Kr{constructor(t,n,c,m,y){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=c,this.bucketIndex=m,this.tileID=y}}class Na{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:c=>c.collisionGroupID===n}}return this.collisionGroups[t]}}function pu(u,t,n,c,m){const{horizontalAlign:y,verticalAlign:w}=s.c0(u),E=-(y-.5)*t,R=-(w-.5)*n,L=s.c1(u,c);return new s.P(E+L[0]*m,R+L[1]*m)}function qr(u,t,n,c,m){const y=new s.P(u,t);return n&&y._rotate(c?m:-m),y}class _f{constructor(t,n,c,m,y,w){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Fo(this.transform,y),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new Na(c),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,c,m,y=1){const w=c.getBucket(n),E=c.latestFeatureIndex;if(!w||!E||n.fqid!==w.layerIds[0])return;const R=w.layers[0].layout,L=w.layers[0].paint,P=c.collisionBoxArray,F=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),j=c.tileSize/s.al,H=c.tileID.toUnwrapped();this.transform.setProjection(w.projection);const $=(G=c.tileID,te=w.getProjection(),X=this.transform,te.name===this.projection?X.calculateProjMatrix(G.toUnwrapped()):ld(X,te,G));var G,te,X;const re=R.get("text-pitch-alignment")==="map",ce=R.get("text-rotation-alignment")==="map";n.compileFilter(n.options);const fe=n.dynamicFilter(),Te=n.dynamicFilterNeedsFeature(),we=this.transform.calculatePixelsToTileUnitsMatrix(c),Ee=Fl($,c.tileID.canonical,re,ce,this.transform,w.getProjection(),we);let ve=null;const be=w.getProjection().createInversionMatrix(this.transform,c.tileID.canonical);if(re){const Oe=du($,c.tileID.canonical,re,ce,this.transform,w.getProjection(),we);ve=s.aB([],this.transform.labelPlaneMatrix,Oe)}let Ce=null;fe&&c.latestFeatureIndex&&(Ce={unwrappedTileID:H,dynamicFilter:fe,dynamicFilterNeedsFeature:Te}),this.retainedQueryData[w.bucketInstanceId]=new Kr(w.bucketInstanceId,E,w.sourceLayerIndex,w.index,c.tileID);const[We,ke]=w.layers[0].layout.get("text-size-scale-range"),ct=s.aA(y,We,ke),[Ze,ot]=R.get("icon-size-scale-range"),Bt=s.aA(y,Ze,ot),Ye={bucket:w,layout:R,paint:L,posMatrix:$,invMatrix:be,mercatorCenter:[s.aF(this.transform.center.lng),s.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ee,labelToScreenMatrix:ve,clippingData:Ce,scale:F,textPixelRatio:j,holdingForFade:c.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:s.bK(w.textSizeData,this.transform.zoom,ct),partiallyEvaluatedIconSize:s.bK(w.iconSizeData,this.transform.zoom,Bt),collisionGroup:this.collisionGroups.get(w.sourceID),latestFeatureIndex:c.latestFeatureIndex};if(m)for(const Oe of w.sortKeyRanges){const{sortKey:nt,symbolInstanceStart:Ge,symbolInstanceEnd:ut}=Oe;t.push({sortKey:nt,symbolInstanceStart:Ge,symbolInstanceEnd:ut,parameters:Ye})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Ye})}attemptAnchorPlacement(t,n,c,m,y,w,E,R,L,P,F,j,H,$,G,te,X,re,ce,fe,Te){const{textOffset0:we,textOffset1:Ee,crossTileID:ve}=G,be=[we,Ee],Ce=pu(t,w,E,be,R),We=this.collisionIndex.placeCollisionBox(X,R,n,c,m,y,qr(Ce.x,Ce.y,L,P,this.transform.angle),$,F,j,H.predicate);if(ce){const ke=X.getSymbolInstanceIconSize(Te,this.transform.zoom,G.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(X,ke,ce,c,m,y,qr(Ce.x,Ce.y,L,P,this.transform.angle),$,F,j,H.predicate).box.length===0)return}if(We.box.length>0){let ke;return this.prevPlacement&&this.prevPlacement.variableOffsets[ve]&&this.prevPlacement.placements[ve]&&this.prevPlacement.placements[ve].text&&(ke=this.prevPlacement.variableOffsets[ve].anchor),this.variableOffsets[ve]={textOffset:be,width:w,height:E,anchor:t,textScale:R,prevAnchor:ke},this.markUsedJustification(X,t,G,re),X.allowVerticalPlacement&&(this.markUsedOrientation(X,re,G),this.placedOrientations[ve]=re),{shift:Ce,placedGlyphBoxes:We}}}placeLayerBucketPart(t,n,c,m,y=1){const{bucket:w,layout:E,paint:R,posMatrix:L,textLabelPlaneMatrix:P,labelToScreenMatrix:F,clippingData:j,textPixelRatio:H,mercatorCenter:$,invMatrix:G,holdingForFade:te,collisionBoxArray:X,partiallyEvaluatedTextSize:re,partiallyEvaluatedIconSize:ce,collisionGroup:fe,latestFeatureIndex:Te}=t.parameters,we=E.get("text-optional"),Ee=E.get("icon-optional"),ve=E.get("text-allow-overlap"),be=E.get("icon-allow-overlap"),Ce=E.get("text-rotation-alignment")==="map",We=E.get("icon-rotation-alignment")==="map",ke=E.get("text-pitch-alignment")==="map",ct=R.get("symbol-z-offset"),Ze=E.get("symbol-elevation-reference")==="sea",ot=E.get("symbol-placement"),[Bt,Ye]=E.get("text-size-scale-range"),[Oe,nt]=E.get("icon-size-scale-range"),Ge=s.aA(y,Bt,Ye),ut=s.aA(y,Oe,nt),_t=E.get("text-variable-anchor"),$t=Ce&&ot!=="point",Rt=We&&ot!=="point",St=_t&&w.hasTextData(),gi=w.hasIconTextFit()&&St&&w.hasIconData();this.transform.setProjection(w.projection);const li=St||$t,ti=Rt||gi;let ci=ve&&(be||!w.hasIconData()||Ee),Oi=be&&(ve||!w.hasTextData()||we);const Ki=!ct.isConstant();!w.collisionArrays&&X&&w.deserializeCollisionBoxes(X),c&&m&&w.updateCollisionDebugBuffers(this.transform.zoom,X,Ge,ut);const Hi=(qi,yr,Ur)=>{const{crossTileID:fn,numVerticalGlyphVertices:Yi}=qi;let Or=null;if(j&&j.dynamicFilterNeedsFeature||Ki){const Bn=this.retainedQueryData[w.bucketInstanceId];Or=Te.loadFeature({featureIndex:qi.featureIndex,bucketIndex:Bn.bucketIndex,sourceLayerIndex:Bn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(j&&!(0,j.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Or,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new s.P(qi.tileAnchorX,qi.tileAnchorY),this.transform.calculateDistanceTileData(j.unwrappedTileID)))return this.placements[fn]=new yi(!1,!1,!1,!0),void n.add(fn);const Tr=ct.evaluate(Or,{});if(n.has(fn))return;if(te)return void(this.placements[fn]=new yi(!1,!1,!1));let Nr=!1,nn=!1,zn=!0,us=!1,gn=!1,Ji=null,Di={box:null,offscreen:null,occluded:null},wr={box:null},jn=null,Vr=null,es=null,ws=0,Ja=0,mo=0;Ur.textFeatureIndex?ws=Ur.textFeatureIndex:qi.useRuntimeCollisionCircles&&(ws=qi.featureIndex),Ur.verticalTextFeatureIndex&&(Ja=Ur.verticalTextFeatureIndex);const Ts=Bn=>{Bn.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const Hn=this.transform.elevation;Bn.elevation=Ze?Tr:Tr+(Hn?Hn.getAtTileOffset(Bn.tileID,Bn.tileAnchorX,Bn.tileAnchorY):0),Bn.elevation+=qi.zOffset},ga=Ur.textBox;if(ga){Ts(ga);const Bn=vn=>{let ss=s.bL.horizontal;if(w.allowVerticalPlacement&&!vn&&this.prevPlacement){const Ss=this.prevPlacement.placedOrientations[fn];Ss&&(this.placedOrientations[fn]=Ss,ss=Ss,this.markUsedOrientation(w,ss,qi))}return ss},Hn=(vn,ss)=>{if(w.allowVerticalPlacement&&Yi>0&&Ur.verticalTextBox){for(const Ss of w.writingModes)if(Ss===s.bL.vertical?(Di=ss(),wr=Di):Di=vn(),Di&&Di.box&&Di.box.length)break}else Di=vn()};if(_t){let vn=_t;if(this.prevPlacement&&this.prevPlacement.variableOffsets[fn]){const ts=this.prevPlacement.variableOffsets[fn];vn.indexOf(ts.anchor)>0&&(vn=vn.filter(ia=>ia!==ts.anchor),vn.unshift(ts.anchor))}const ss=(ts,ia,tl)=>{const Cl=w.getSymbolInstanceTextSize(re,qi,this.transform.zoom,yr),Ca=(ts.x2-ts.x1)*Cl+2*ts.padding,il=(ts.y2-ts.y1)*Cl+2*ts.padding,pc=qi.hasIconTextFit&&!be?ia:null;pc&&Ts(pc);let rl={box:[],offscreen:!1,occluded:!1};const Zh=ve?2*vn.length:vn.length;for(let Rl=0;Rl<Zh;++Rl){const Ha=this.attemptAnchorPlacement(vn[Rl%vn.length],ts,$,G,li,Ca,il,Cl,Ce,ke,H,L,fe,Rl>=vn.length,qi,yr,w,tl,pc,re,ce);if(Ha&&(rl=Ha.placedGlyphBoxes,rl&&rl.box&&rl.box.length)){Nr=!0,Ji=Ha.shift;break}}return rl};Hn(()=>ss(ga,Ur.iconBox,s.bL.horizontal),()=>{const ts=Ur.verticalTextBox;return ts&&Ts(ts),w.allowVerticalPlacement&&!(Di&&Di.box&&Di.box.length)&&Yi>0&&ts?ss(ts,Ur.verticalIconBox,s.bL.vertical):{box:null,offscreen:null,occluded:null}}),Di&&(Nr=Di.box,zn=Di.offscreen,us=Di.occluded);const Ss=Bn(!(!Di||!Di.box));if(!Nr&&this.prevPlacement){const ts=this.prevPlacement.variableOffsets[fn];ts&&(this.variableOffsets[fn]=ts,this.markUsedJustification(w,ts.anchor,qi,Ss))}}else{const vn=(ss,Ss)=>{const ts=w.getSymbolInstanceTextSize(re,qi,this.transform.zoom,yr),ia=this.collisionIndex.placeCollisionBox(w,ts,ss,$,G,li,new s.P(0,0),ve,H,L,fe.predicate);return ia&&ia.box&&ia.box.length&&(this.markUsedOrientation(w,Ss,qi),this.placedOrientations[fn]=Ss),ia};Hn(()=>vn(ga,s.bL.horizontal),()=>{const ss=Ur.verticalTextBox;return w.allowVerticalPlacement&&Yi>0&&ss?(Ts(ss),vn(ss,s.bL.vertical)):{box:null,offscreen:null,occluded:null}}),Bn(!!(Di&&Di.box&&Di.box.length))}}if(jn=Di,Nr=jn&&jn.box&&jn.box.length>0,zn=jn&&jn.offscreen,us=jn&&jn.occluded,qi.useRuntimeCollisionCircles){const Bn=w.text.placedSymbolArray.get(qi.centerJustifiedTextSymbolIndex>=0?qi.centerJustifiedTextSymbolIndex:qi.verticalPlacedTextSymbolIndex),Hn=s.bM(w.textSizeData,re,Bn),vn=E.get("text-padding");Vr=this.collisionIndex.placeCollisionCircles(w,ve,Bn,w.lineVertexArray,w.glyphOffsetArray,Hn,L,P,F,c,ke,fe.predicate,qi.collisionCircleDiameter*Hn/s.bX,vn,this.retainedQueryData[w.bucketInstanceId].tileID),Nr=ve||Vr.circles.length>0&&!Vr.collisionDetected,zn=zn&&Vr.offscreen,us=Vr.occluded}if(Ur.iconFeatureIndex&&(mo=Ur.iconFeatureIndex),Ur.iconBox){const Bn=Hn=>{Ts(Hn);const vn=qi.hasIconTextFit&&Ji?qr(Ji.x,Ji.y,Ce,ke,this.transform.angle):new s.P(0,0),ss=w.getSymbolInstanceIconSize(ce,this.transform.zoom,qi.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,ss,Hn,$,G,ti,vn,be,H,L,fe.predicate)};wr&&wr.box&&wr.box.length&&Ur.verticalIconBox?(es=Bn(Ur.verticalIconBox),nn=es.box.length>0):(es=Bn(Ur.iconBox),nn=es.box.length>0),zn=zn&&es.offscreen,gn=es.occluded}const ta=we||qi.numHorizontalGlyphVertices===0&&Yi===0,_a=Ee||qi.numIconVertices===0;if(ta||_a?_a?ta||(nn=nn&&Nr):Nr=nn&&Nr:nn=Nr=nn&&Nr,Nr&&jn&&jn.box&&this.collisionIndex.insertCollisionBox(jn.box,E.get("text-ignore-placement"),w.bucketInstanceId,wr&&wr.box&&Ja?Ja:ws,fe.ID),nn&&es&&this.collisionIndex.insertCollisionBox(es.box,E.get("icon-ignore-placement"),w.bucketInstanceId,mo,fe.ID),Vr&&(Nr&&this.collisionIndex.insertCollisionCircles(Vr.circles,E.get("text-ignore-placement"),w.bucketInstanceId,ws,fe.ID),c)){const Bn=w.bucketInstanceId;let Hn=this.collisionCircleArrays[Bn];Hn===void 0&&(Hn=this.collisionCircleArrays[Bn]=new Zr);for(let vn=0;vn<Vr.circles.length;vn+=4)Hn.circles.push(Vr.circles[vn+0]),Hn.circles.push(Vr.circles[vn+1]),Hn.circles.push(Vr.circles[vn+2]),Hn.circles.push(Vr.collisionDetected?1:0)}const zo=w.projection.name!=="globe";ci=ci&&(zo||!us),Oi=Oi&&(zo||!gn),this.placements[fn]=new yi(Nr||ci,nn||Oi,zn||w.justReloaded),n.add(fn)},jr=this.retainedQueryData[w.bucketInstanceId].tileID;if(w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,jr),w.elevationType==="road"&&w.updateRoadElevation(jr.canonical),w.updateZOffset(),w.sortFeaturesByY){const qi=w.getSortedSymbolIndexes(this.transform.angle);for(let yr=qi.length-1;yr>=0;--yr){const Ur=qi[yr];Hi(w.symbolInstances.get(Ur),Ur,w.collisionArrays[Ur])}w.hasAnyZOffset&&s.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const qi=w.getSortedIndexesByZOffset();for(let yr=0;yr<qi.length;++yr){const Ur=qi[yr];Hi(w.symbolInstances.get(Ur),Ur,w.collisionArrays[Ur])}}else for(let qi=t.symbolInstanceStart;qi<t.symbolInstanceEnd;qi++)Hi(w.symbolInstances.get(qi),qi,w.collisionArrays[qi]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){const qi=this.collisionCircleArrays[w.bucketInstanceId];s.bl(qi.invProjMatrix,L),qi.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(t,n,c,m){const{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:R,crossTileID:L}=c,P=s.c2(n),F=m===s.bL.vertical?R:P==="left"?y:P==="center"?w:P==="right"?E:-1;y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=F>=0&&y!==F?0:L),w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=F>=0&&w!==F?0:L),E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=F>=0&&E!==F?0:L),R>=0&&(t.text.placedSymbolArray.get(R).crossTileID=F>=0&&R!==F?0:L)}markUsedOrientation(t,n,c){const m=n===s.bL.horizontal||n===s.bL.horizontalOnly?n:0,y=n===s.bL.vertical?n:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:L}=c,P=t.text.placedSymbolArray;w>=0&&(P.get(w).placedOrientation=m),E>=0&&(P.get(E).placedOrientation=m),R>=0&&(P.get(R).placedOrientation=m),L>=0&&(P.get(L).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let c=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const m=n?n.symbolFadeChange(t):1,y=n?n.opacities:{},w=n?n.variableOffsets:{},E=n?n.placedOrientations:{};for(const R in this.placements){const L=this.placements[R],P=y[R];P?(this.opacities[R]=new bo(P,m,L.text,L.icon,null,L.clipped),c=c||L.text!==P.text.placed||L.icon!==P.icon.placed):(this.opacities[R]=new bo(null,m,L.text,L.icon,L.skipFade,L.clipped),c=c||L.text||L.icon)}for(const R in y){const L=y[R];if(!this.opacities[R]){const P=new bo(L,m,!1,!1);P.isHidden()||(this.opacities[R]=P,c=c||L.text.placed||L.icon.placed)}}for(const R in w)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=w[R]);for(const R in E)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=E[R]);c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n,c,m){const y=new Set;for(const w of n){const E=w.getBucket(t);E&&w.latestFeatureIndex&&t.fqid===E.layerIds[0]&&(this.updateBucketOpacities(E,y,w,w.collisionBoxArray,c,m,w.tileID,t.scope),E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,w.tileID),E.elevationType==="road"&&E.updateRoadElevation(w.tileID.canonical),E.updateZOffset())}}updateBucketOpacities(t,n,c,m,y,w,E,R){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const L=t.layers[0].layout,P=t.layers[0].paint,F=!!t.layers[0].dynamicFilter(),j=new bo(null,0,!1,!1,!0),H=L.get("text-allow-overlap"),$=L.get("icon-allow-overlap"),G=L.get("text-variable-anchor"),te=L.get("text-rotation-alignment")==="map",X=L.get("text-pitch-alignment")==="map",re=P.get("symbol-z-offset"),ce=L.get("symbol-elevation-reference")==="sea",fe=!re.isConstant(),Te=new bo(null,0,H&&($||!t.hasIconData()||L.get("icon-optional")),$&&(H||!t.hasTextData()||L.get("text-optional")),!0);!t.collisionArrays&&m&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(m);const we=(ve,be,Ce)=>{for(let We=0;We<be/4;We++)ve.opacityVertexArray.emplaceBack(Ce)};let Ee=0;w&&t.updateReplacement(E,w);for(let ve=0;ve<t.symbolInstances.length;ve++){const be=t.symbolInstances.get(ve),{numHorizontalGlyphVertices:Ce,numVerticalGlyphVertices:We,crossTileID:ke,numIconVertices:ct,tileAnchorX:Ze,tileAnchorY:ot}=be;let Bt=null;const Ye=this.retainedQueryData[t.bucketInstanceId];fe&&be&&Ye&&(Bt=c.latestFeatureIndex.loadFeature({featureIndex:be.featureIndex,bucketIndex:Ye.bucketIndex,sourceLayerIndex:Ye.sourceLayerIndex,layoutVertexArrayOffset:0}));const Oe=re.evaluate(Bt,{}),nt=n.has(ke);let Ge=this.opacities[ke];nt?Ge=j:Ge||(Ge=Te,this.opacities[ke]=Ge),n.add(ke);const ut=Ce>0||We>0,_t=ct>0,$t=this.placedOrientations[ke],Rt=$t===s.bL.vertical,St=$t===s.bL.horizontal||$t===s.bL.horizontalOnly;!ut&&!_t||Ge.isHidden()||Ee++;let gi=!1;if((ut||_t)&&w)for(const li of t.activeReplacements){if(s.bY(li,y,s.bZ.Symbol,R)||li.min.x>Ze||Ze>li.max.x||li.min.y>ot||ot>li.max.y)continue;const ti=s.b_(Ze,ot,E.canonical,li.footprintTileId.canonical);if(gi=s.b$(ti,li.footprint),gi)break}if(ut){const li=gi?Vl:fd(Ge.text);we(t.text,Ce,Rt?Vl:li),we(t.text,We,St?Vl:li);const ti=Ge.text.isHidden(),{leftJustifiedTextSymbolIndex:ci,centerJustifiedTextSymbolIndex:Oi,rightJustifiedTextSymbolIndex:Ki,verticalPlacedTextSymbolIndex:Hi}=be,jr=t.text.placedSymbolArray,qi=ti||Rt?1:0;ci>=0&&(jr.get(ci).hidden=qi),Oi>=0&&(jr.get(Oi).hidden=qi),Ki>=0&&(jr.get(Ki).hidden=qi),Hi>=0&&(jr.get(Hi).hidden=ti||St?1:0);const yr=this.variableOffsets[ke];yr&&this.markUsedJustification(t,yr.anchor,be,$t);const Ur=this.placedOrientations[ke];Ur&&(this.markUsedJustification(t,"left",be,Ur),this.markUsedOrientation(t,Ur,be))}if(_t){const li=gi?Vl:fd(Ge.icon),{placedIconSymbolIndex:ti,verticalPlacedIconSymbolIndex:ci}=be,Oi=t.icon.placedSymbolArray,Ki=Ge.icon.isHidden()?1:0;ti>=0&&(we(t.icon,ct,Rt?Vl:li),Oi.get(ti).hidden=Ki),ci>=0&&(we(t.icon,be.numVerticalIconVertices,St?Vl:li),Oi.get(ci).hidden=Ki)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const li=t.collisionArrays[ve];if(li){let ti=new s.P(0,0),ci=!0;if(li.textBox||li.verticalTextBox){if(G){const Ki=this.variableOffsets[ke];Ki?(ti=pu(Ki.anchor,Ki.width,Ki.height,Ki.textOffset,Ki.textScale),te&&ti._rotate(X?this.transform.angle:-this.transform.angle)):ci=!1}F&&(ci=!Ge.clipped),li.textBox&&Ic(t.textCollisionBox.collisionVertexArray,Ge.text.placed,!ci||Rt,Oe,ce,ti.x,ti.y),li.verticalTextBox&&Ic(t.textCollisionBox.collisionVertexArray,Ge.text.placed,!ci||St,Oe,ce,ti.x,ti.y)}const Oi=ci&&!!(!St&&li.verticalIconBox);li.iconBox&&Ic(t.iconCollisionBox.collisionVertexArray,Ge.icon.placed,Oi,Oe,ce,be.hasIconTextFit?ti.x:0,be.hasIconTextFit?ti.y:0),li.verticalIconBox&&Ic(t.iconCollisionBox.collisionVertexArray,Ge.icon.placed,!Oi,Oe,ce,be.hasIconTextFit?ti.x:0,be.hasIconTextFit?ti.y:0)}}}if(t.fullyClipped=Ee===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ve=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ve.invProjMatrix,t.placementViewportMatrix=ve.viewportMatrix,t.collisionCircleArray=ve.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const c=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function Ic(u,t,n,c,m,y,w){u.emplaceBack(t?1:0,n?1:0,y||0,w||0,c,m?1:0),u.emplaceBack(t?1:0,n?1:0,y||0,w||0,c,m?1:0),u.emplaceBack(t?1:0,n?1:0,y||0,w||0,c,m?1:0),u.emplaceBack(t?1:0,n?1:0,y||0,w||0,c,m?1:0)}const ud=Math.pow(2,25),la=Math.pow(2,24),ls=Math.pow(2,17),Xg=Math.pow(2,16),hd=Math.pow(2,9),dd=Math.pow(2,8),Ul=Math.pow(2,1);function fd(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,n=Math.floor(127*u.opacity);return n*ud+t*la+n*ls+t*Xg+n*hd+t*dd+n*Ul+t}const Vl=0;class pd{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,n,c,m,y,w){const E=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(E,m,t[this._currentTileIndex],this._sortAcrossTiles,w),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((R,L)=>R.sortKey-L.sortKey));this._currentPartIndex<E.length;){const R=E[this._currentPartIndex];if(n.placeLayerBucketPart(R,this._seenCrossTileIDs,c,R.symbolInstanceStart===0,w),this._currentPartIndex++,y())return!0}return!1}}class ca{constructor(t,n,c,m,y,w,E,R,L){this.placement=new _f(t,y,w,E,R,L),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,n,c,m,y){const w=s.o.now(),E=()=>{const R=s.o.now()-w;return!this._forceFullPlacement&&R>2};for(;this._currentPlacementIndex>=0;){const R=n[t[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=L)&&(!R.maxzoom||R.maxzoom>L)){const P=R,F=P.layout.get("symbol-z-elevate"),j=P.layout.get("symbol-sort-key").constantOr(1)!==void 0,H=P.layout.get("symbol-z-order"),$=H==="viewport-y"||H==="auto"&&!(H!=="viewport-y"&&j),G=P.layout.get("text-allow-overlap")||P.layout.get("icon-allow-overlap")||P.layout.get("text-ignore-placement")||P.layout.get("icon-ignore-placement"),te=$&&G,X=this._inProgressLayer=this._inProgressLayer||new pd(P),re=s.B(R.source,R.scope);if(X.continuePlacement(F||te?m[re]:c[re],this.placement,this._showCollisionBoxes,R,E,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const wo=512/s.al/2;class Sa{constructor(t,n,c){this.tileID=t,this.bucketInstanceId=c,this.index=new s.c3(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const m=t.canonical.x*s.al,y=t.canonical.y*s.al;for(let w=0;w<n.length;w++){const{key:E,crossTileID:R,tileAnchorX:L,tileAnchorY:P}=n.get(w),F=Math.floor((m+L)*wo),j=Math.floor((y+P)*wo);this.index.add(F,j),this.keys.push(E),this.crossTileIDs.push(R)}this.index.finish()}findMatches(t,n,c){const m=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),y=wo/Math.pow(2,n.canonical.z-this.tileID.canonical.z),w=n.canonical.x*s.al,E=n.canonical.y*s.al;for(let R=0;R<t.length;R++){const L=t.get(R);if(L.crossTileID)continue;const{key:P,tileAnchorX:F,tileAnchorY:j}=L,H=Math.floor((w+F)*y),$=Math.floor((E+j)*y),G=this.index.range(H-m,$-m,H+m,$+m).sort((te,X)=>te-X);for(const te of G){const X=this.crossTileIDs[te];if(this.keys[te]===P&&!c.has(X)){c.add(X),L.crossTileID=X;break}}}}}class mu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ph{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const c in this.indexes){const m=this.indexes[c],y={};for(const w in m){const E=m[w];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+n),y[E.tileID.key]=E}this.indexes[c]=y}this.lng=t}addBucket(t,n,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<n.symbolInstances.length;y++)n.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const m=this.usedCrossTileIDs[t.overscaledZ];for(const y in this.indexes){const w=this.indexes[y];if(Number(y)>t.overscaledZ)for(const E in w){const R=w[E];R.tileID.isChildOf(t)&&R.findMatches(n.symbolInstances,t,m)}else{const E=w[t.scaledTo(Number(y)).key];E&&E.findMatches(n.symbolInstances,t,m)}}for(let y=0;y<n.symbolInstances.length;y++){const w=n.symbolInstances.get(y);w.crossTileID||(w.crossTileID=c.generate(),m.add(w.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Sa(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const c of n.crossTileIDs)this.usedCrossTileIDs[t].delete(c)}removeStaleBuckets(t){let n=!1;for(const c in this.indexes){const m=this.indexes[c];for(const y in m)t[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,m[y]),delete m[y],n=!0)}return n}}class vs{constructor(){this.layerIndexes={},this.crossTileIDs=new mu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,c,m){let y=this.layerIndexes[t.fqid];y===void 0&&(y=this.layerIndexes[t.fqid]=new ph);let w=!1;const E={};m.name!=="globe"&&y.handleWrapJump(c);for(const R of n){const L=R.getBucket(t);L&&t.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(R.tileID,L,this.crossTileIDs)&&(w=!0),E[L.bucketInstanceId]=!0)}return y.removeStaleBuckets(E)&&(w=!0),w}pruneUnusedLayers(t){const n={};t.forEach(c=>{n[c]=!0});for(const c in this.layerIndexes)n[c]||delete this.layerIndexes[c]}}const ka=771;class ir{constructor(t,n,c,m){this.blendFunction=t,this.blendColor=n.toNonPremultipliedRenderColor(null),this.mask=c,this.blendEquation=m}}ir.Replace=[1,0,1,0],ir.disabled=new ir(ir.Replace,s.ao.transparent,[!1,!1,!1,!1]),ir.unblended=new ir(ir.Replace,s.ao.transparent,[!0,!0,!0,!0]),ir.alphaBlended=new ir([1,ka,1,ka],s.ao.transparent,[!0,!0,!0,!0]),ir.alphaBlendedNonPremultiplied=new ir([770,ka,770,ka],s.ao.transparent,[!0,!0,!0,!0]),ir.multiply=new ir([774,0,774,0],s.ao.transparent,[!0,!0,!0,!0]);class ni{constructor(t,n,c){this.func=t,this.mask=n,this.range=c}}ni.ReadOnly=!1,ni.ReadWrite=!0,ni.disabled=new ni(519,ni.ReadOnly,[0,1]);const Hl=7680;class Ii{constructor(t,n,c,m,y,w){this.test=t,this.ref=n,this.mask=c,this.fail=m,this.depthFail=y,this.pass=w}}Ii.disabled=new Ii({func:519,mask:0},0,0,Hl,Hl,Hl);const gu=1029,ql=2305;class ki{constructor(t,n,c){this.enable=t,this.mode=n,this.frontFace=c}}function yf(u,t){const n=s.c9(u,3);s.cb(u,t),s.cf(u,3,n)}function _u(u,t){const n=s.c6([]);return s.c7(n,n,-t),s.c8(n,n,-u),n}function yu(u,t){const n=[u[0],u[1],0],c=[t[0],t[1],0];if(s.ag(n)>=1e-15){const w=s.aw([],n);s.c4(c,w,s.bJ(c,w)),t[0]=c[0],t[1]=c[1]}const m=s.bI([],t,u);if(s.c5(m)<1e-15)return null;const y=Math.atan2(-m[1],m[0]);return _u(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),y)}ki.disabled=new ki(!1,gu,ql),ki.backCCW=new ki(!0,gu,ql),ki.backCW=new ki(!0,gu,2304),ki.frontCW=new ki(!0,1028,2304),ki.frontCCW=new ki(!0,1028,ql);class xf{constructor(t,n){this.position=t,this.orientation=n}get position(){return this._position}set position(t){if(t){const n=t instanceof s.ae?t:new s.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=s.bT(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const c=this.position,m=this._elevation?this._elevation.getAtPointOrZero(s.ae.fromLngLat(t)):0,y=s.ae.fromLngLat(t,m),w=[y.x-c.x,y.y-c.y,y.z-c.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=yu(w,n)}setPitchBearing(t,n){this.orientation=_u(s.an(t),s.an(-n))}}class md{constructor(t,n){this._transform=s.bA([]),this.orientation=n,this.position=t}get mercatorPosition(){const t=this.position;return new s.ae(t[0],t[1],t[2])}get position(){const t=s.c9(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var n;t&&s.cf(this._transform,3,[(n=t)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||s.c6([]),t&&yf(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,n){this._orientation=_u(t,n),yf(this._transform,this._orientation)}forward(){const t=s.c9(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=s.c9(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=s.c9(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,n){const c=new Float64Array(16);return s.bl(c,this.getWorldToCamera(t,n)),c}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,n,c){const m=this.position;s.c4(m,m,-t);const y=new Float64Array(16);return s.bq(y,[c,c,c]),s.br(y,y,m),y[10]*=n,y}getWorldToCamera(t,n){const c=new Float64Array(16),m=new Float64Array(4),y=this.position;return s.ca(m,this._orientation),s.c4(y,y,-t),s.cb(c,m),s.br(c,c,y),c[1]*=-1,c[5]*=-1,c[9]*=-1,c[13]*=-1,c[8]*=n,c[9]*=n,c[10]*=n,c[11]*=n,c}getCameraToClipPerspective(t,n,c,m){const y=new Float64Array(16);return s.cc(y,t,n,c,m),y}getCameraToClipOrthographic(t,n,c,m,y,w){const E=new Float64Array(16);return s.cd(E,t,n,c,m,y,w),E}getDistanceToElevation(t,n=!1){const c=t===0?0:s.ce(t,n?s.a$(this.position[1]):this.position[1]),m=this.forward();return(c-this.position[2])/m[2]}clone(){return new md([...this.position],[...this.orientation])}}const Qn={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Cp{constructor(t=0,n=0,c=0,m=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(c)||c<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=c,this.right=m}interpolate(t,n,c){return n.top!=null&&t.top!=null&&(this.top=s.ak(t.top,n.top,c)),n.bottom!=null&&t.bottom!=null&&(this.bottom=s.ak(t.bottom,n.bottom,c)),n.left!=null&&t.left!=null&&(this.left=s.ak(t.left,n.left,c)),n.right!=null&&t.right!=null&&(this.right=s.ak(t.right,n.right,c)),this}getCenter(t,n){const c=s.aA((this.left+t-this.right)/2,0,t),m=s.aA((this.top+n-this.bottom)/2,0,n);return new s.P(c,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Cp(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Gl=15;class Ea{constructor(t,n,c,m,y,w,E){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=c??0,this._maxPitch=m??60,this.setProjection(w),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new s.aR(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Cp,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new md,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Ea(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Gl}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,n=!1){const c=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||c)&&this._updateCameraOnTerrain(),(t||c)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return s.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=s.cl(this.projectionOptions);const c=this.getProjection(),m=!s.by(n,c);return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.cl({name:"mercator"});const n=t!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bT(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const n=-t*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=s.cm(),s.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=s.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=s.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&c.exaggeration()&&this._centerAltitudeValidForExaggeration!==c.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*c.exaggeration(),this._centerAltitudeValidForExaggeration=c.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=c.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],c=this.horizonLineFromTop();let m=0,y=0;for(let w=0;w<n.length;w++){const E=new s.P(n[w][0]*this.width,c+n[w][1]*(this.height-c)),R=t.pointCoordinate(E);if(!R)continue;const L=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);m+=R[3]*L,y+=L}return y===0?NaN:m/y}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),c=this.pixelsPerMeter/this.worldSize*n,m=this._mercatorZfromZoom(t),y=this._mercatorZfromZoom(this._maxZoom),w=Math.max(m-c,y);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let c;c=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const m=s.ag(s.av([],this._camera.position,c));return s.aA(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!s.co(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const c=[t.position.x,t.position.y,t.position.z];s.cp(c,this._camera.position)||(this._setCameraPosition(c),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new xf;return n.position=new s.ae(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(t){if(!s.cq(t))return!1;s.cr(t,t);const n=s.cs([],[0,0,-1],t),c=s.cs([],[0,-1,0],t);if(c[2]<0)return!1;const m=yu(n,c);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,c=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;t[2]=s.aA(t[2],m/c,m/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,c){this._unmodified=!1,this._edgeInsets.interpolate(t,n,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new s.ct(0,t)];if(this.renderWorldCopies){const c=this.pointCoordinate(new s.P(0,0)),m=this.pointCoordinate(new s.P(this.width,0)),y=this.pointCoordinate(new s.P(this.width,this.height)),w=this.pointCoordinate(new s.P(0,this.height)),E=Math.floor(Math.min(c.x,m.x,y.x,w.x)),R=Math.floor(Math.max(c.x,m.x,y.x,w.x)),L=1;for(let P=E-L;P<=R+L;P++)P!==0&&n.push(new s.ct(P,t))}return n}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,n,c){let m=[];const y=c!=null,w=!y;if(w&&this.zoom<n||y&&c[0]===0&&c[1]===0)return m;const E=new Set,R=(P,F,j,H,$)=>{const G=s.cX(F,P,j,H,$);E.has(G)||(m.push(new s.aO(P,F,j,H,$)),E.add(G))};for(let P=0;P<t.length;P++){const F=t[P];if(w&&F.canonical.z!==n)continue;const j=F.canonical,H=F.overscaledZ,$=F.wrap,G=1<<j.z,te=j.x+1<G,X=j.x>0,re=j.y+1<G,ce=j.y>0,fe=F.wrap-(X?0:1),Te=F.wrap+(te?0:1),we=X?j.x-1:G-1,Ee=te?j.x+1:0;if(y)c[0]<0?(R(H,Te,j.z,Ee,j.y),c[1]<0&&re&&(R(H,$,j.z,j.x,j.y+1),R(H,Te,j.z,Ee,j.y+1)),c[1]>0&&ce&&(R(H,$,j.z,j.x,j.y-1),R(H,Te,j.z,Ee,j.y-1))):c[0]>0?(R(H,fe,j.z,we,j.y),c[1]<0&&re&&(R(H,$,j.z,j.x,j.y+1),R(H,fe,j.z,we,j.y+1)),c[1]>0&&ce&&(R(H,$,j.z,j.x,j.y-1),R(H,fe,j.z,we,j.y-1))):c[1]<0&&re?R(H,$,j.z,j.x,j.y+1):ce&&R(H,$,j.z,j.x,j.y-1);else{const ve=F.visibleQuadrants;1&ve&&(R(H,fe,j.z,we,j.y),ce&&(R(H,$,j.z,j.x,j.y-1),R(H,fe,j.z,we,j.y-1))),2&ve&&(R(H,Te,j.z,Ee,j.y),ce&&(R(H,$,j.z,j.x,j.y-1),R(H,Te,j.z,Ee,j.y-1))),4&ve&&(R(H,fe,j.z,we,j.y),re&&(R(H,$,j.z,j.x,j.y+1),R(H,fe,j.z,we,j.y+1))),8&ve&&(R(H,Te,j.z,Ee,j.y),re&&(R(H,$,j.z,j.x,j.y+1),R(H,Te,j.z,Ee,j.y+1)))}}const L=[];for(const P of m)m.some(F=>P.isChildOf(F))||L.push(P);if(m=L.filter(P=>!t.some(F=>!!(P.overscaledZ<n&&F.isChildOf(P))||P.equals(F)||P.isChildOf(F))),w){const P=1<<n,F=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),j=[P*F.x,P*F.y],H=4,$=H*H;m=m.filter(G=>{const te=G.canonical.x+.5-j[0],X=G.canonical.y+.5-j[1];return te*te+X*X<$})}return m}extendTileCoverToNearPlane(t,n,c){const m=[],y=new Set;for(const re of t)y.add(re.key);const w=(re,ce,fe,Te,we)=>{const Ee=s.cX(ce,re,fe,Te,we);y.has(Ee)||(m.push(new s.aO(re,ce,fe,Te,we)),y.add(Ee))},E=t.reduce((re,ce)=>Math.max(re,ce.overscaledZ),c),R=1<<c,L=[new s.P(0,0),new s.P(s.al,0),new s.P(s.al,s.al),new s.P(0,s.al)],P=new s.P(0,0),F=new s.P(0,0),j=(re,ce)=>{const fe=Math.floor(re[0]),Te=Math.floor(re[1]),we=(re[0]-fe)*s.al,Ee=(re[1]-Te)*s.al,ve=Math.floor(ce[0]),be=Math.floor(ce[1]),Ce=(ce[0]-ve)*s.al,We=(ce[1]-be)*s.al;for(let ke=-1;ke<=1;ke++){const ct=fe+ke;if(!(ct<0||ct>=R)){P.x=we-ke*s.al,F.x=Ce-(ct-ve)*s.al;for(let Ze=-1;Ze<=1;Ze++){const ot=Te+Ze;P.y=Ee-Ze*s.al,F.y=We-(ot-be)*s.al,s.cY(P,F,L)&&w(E,0,c,ct,ot)}}}},H=n.points,$=H[s.cu],G=H[s.cv],te=this._projectToGround($,H[s.cw]),X=this._projectToGround(G,H[s.cx]);return j($,te),j(G,X),m}_projectToGround(t,n){return s.cy(s.cz(),t,n,t[2]/(t[2]-n[2]))}coveringTiles(t){let n=this.coveringZoomLevel(t);const c=n,m=this.elevation&&this.elevation.exaggeration(),y=m&&!t.isTerrainDEM,w=this.projection.name==="mercator";if(t.minzoom!==void 0&&n<t.minzoom)return[];t.maxzoom!==void 0&&n>t.maxzoom&&(n=t.maxzoom);const E=this.locationCoordinate(this.center),R=this.center.lat,L=1<<n,P=[L*E.x,L*E.y,0],F=this.projection.name==="globe",j=!F,H=s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,j),$=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=L*s.ce(1,this.center.lat),te=this._camera.position[2]/s.ce(1,this.center.lat),X=[L*$.x,L*$.y,te*(j?1:G)],re=F||m,ce=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),fe=this.isLODDisabled(!0)?n:0;let Te;if(this._elevation&&t.isTerrainDEM)Te=1e4*this._elevation.exaggeration();else if(this._elevation){const Oe=this._elevation.getMinMaxForVisibleTiles();Te=Oe?Oe.max:this._centerAltitude}else Te=this._centerAltitude;const we=t.isTerrainDEM?-Te:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ee=this.projection.isReprojectedInTileSpace?s.cB(this):1,ve=Oe=>{const Ge=new s.ae(Oe.x+25e-6,Oe.y,Oe.z),ut=new s.ae(Oe.x,Oe.y+25e-6,Oe.z),_t=Oe.toLngLat(),$t=Ge.toLngLat(),Rt=ut.toLngLat(),St=this.locationCoordinate(_t),gi=this.locationCoordinate($t),li=this.locationCoordinate(Rt),ti=Math.hypot(gi.x-St.x,gi.y-St.y),ci=Math.hypot(li.x-St.x,li.y-St.y);return Math.sqrt(ti*ci)*Ee/25e-6},be=Oe=>{const nt=Te,Ge=we;return{aabb:s.cE(this,L,0,0,0,Oe,Ge,nt,this.projection),zoom:0,x:0,y:0,minZ:Ge,maxZ:nt,wrap:Oe,fullyVisible:!1}},Ce=[];let We=[];const ke=n,ct=t.reparseOverscaled?c:n,Ze=(te-this._centerAltitude)*G,ot=Oe=>{if(!this._elevation||!Oe.tileID||!w)return;const nt=this._elevation.getMinMaxForTile(Oe.tileID),Ge=Oe.aabb;nt?(Ge.min[2]=nt.min,Ge.max[2]=nt.max,Ge.center[2]=(Ge.min[2]+Ge.max[2])/2):(Oe.shouldSplit=Ye(Oe),Oe.shouldSplit||(Ge.min[2]=Ge.max[2]=Ge.center[2]=this._centerAltitude))},Bt=(Oe,nt)=>{if(.707*nt<Oe)return 1;const Ge=nt/Oe;return Ge/(1.4144271570014144+(Math.pow(1.1,Ge-1.4144271570014144+1)-1)/(1.1-1)-1)},Ye=Oe=>{if(Oe.zoom<fe)return!0;if(Oe.zoom===ke)return!1;if(Oe.shouldSplit!=null)return Oe.shouldSplit;const nt=Oe.aabb.distanceX(X),Ge=Oe.aabb.distanceY(X);let ut=Ze,_t=1;if(F){ut=Oe.aabb.distanceZ(X);const ci=Math.pow(2,Oe.zoom),Oi=s.a$((Oe.y+1)/ci),Ki=s.a$(Oe.y/ci),Hi=Math.min(Math.max(R,Oi),Ki),jr=s.d0(Hi)/s.d0(R);if(_t=Hi===R?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,jr/this._mercatorScaleRatio),this.zoom<=s.cZ&&Oe.zoom===ke-1&&jr>=.9)return!0}else if(y&&(ut=Oe.aabb.distanceZ(X)*G),this.projection.isReprojectedInTileSpace&&c<=5){const ci=Math.pow(2,Oe.zoom),Oi=ve(new s.ae((Oe.x+.5)/ci,(Oe.y+.5)/ci));_t=Oi>.85?1:Oi}if(!w){const ci=Math.sqrt(nt*nt+Ge*Ge+ut*ut);let Oi=(1<<ke-Oe.zoom)*ce*_t;return Oi*=Bt(Math.max(ut,Ze),ci),ci<Oi}let $t=Number.MAX_VALUE,Rt=0;const St=Oe.aabb.getCorners(),gi=[];for(const ci of St){s.av(gi,ci,X),F||(y?gi[2]*=G:gi[2]=Ze);const Oi=s.bJ(gi,this._camera.forward());Oi<$t&&($t=Oi,Rt=Math.abs(gi[2]))}let li=(1<<ke-Oe.zoom)*ce*_t;if(li*=Bt(Math.max(Rt,Ze),$t),$t<li)return!0;const ti=Oe.aabb.closestPoint(P);return ti[0]===P[0]&&ti[1]===P[1]};if(this.renderWorldCopies)for(let Oe=1;Oe<=3;Oe++)Ce.push(be(-Oe)),Ce.push(be(Oe));for(Ce.push(be(0));Ce.length>0;){const Oe=Ce.pop(),nt=Oe.x,Ge=Oe.y;let ut=Oe.fullyVisible;const _t=()=>this.projection.name==="globe"&&(Oe.y===0||Oe.y===(1<<Oe.zoom)-1);if(!ut){let $t=re?Oe.aabb.intersects(H):Oe.aabb.intersectsFlat(H);if($t===0&&_t()){const Rt=new s.cC(Oe.zoom,nt,Ge);$t=s.cD(this,L,Rt,!0).intersects(H)}if($t===0)continue;ut=$t===2}if(Oe.zoom!==ke&&Ye(Oe))for(let $t=0;$t<4;$t++){const Rt=(nt<<1)+$t%2,St=(Ge<<1)+($t>>1),gi={aabb:w?Oe.aabb.quadrant($t):s.cE(this,L,Oe.zoom+1,Rt,St,Oe.wrap,Oe.minZ,Oe.maxZ,this.projection),zoom:Oe.zoom+1,x:Rt,y:St,wrap:Oe.wrap,fullyVisible:ut,tileID:void 0,shouldSplit:void 0,minZ:Oe.minZ,maxZ:Oe.maxZ};y&&!F&&(gi.tileID=new s.aO(Oe.zoom+1===ke?ct:Oe.zoom+1,Oe.wrap,Oe.zoom+1,Rt,St),ot(gi)),Ce.push(gi)}else{const $t=Oe.zoom===ke?ct:Oe.zoom;if(t.minzoom&&t.minzoom>$t)continue;let Rt=0;if(!ut){let ti=re?Oe.aabb.intersectsPrecise(H):Oe.aabb.intersectsPreciseFlat(H);if(ti===0&&_t()){const ci=new s.cC(Oe.zoom,nt,Ge);ti=s.cD(this,L,ci,!0).intersectsPrecise(H)}if(ti===0)continue;if(t.calculateQuadrantVisibility)if(H.containsPoint(Oe.aabb.center))Rt=15;else for(let ci=0;ci<4;ci++)Oe.aabb.quadrant(ci).intersects(H)!==0&&(Rt|=1<<ci)}const St=P[0]-(.5+nt+(Oe.wrap<<Oe.zoom))*(1<<n-Oe.zoom),gi=P[1]-.5-Ge,li=Oe.tileID?Oe.tileID:new s.aO($t,Oe.wrap,Oe.zoom,nt,Ge);t.calculateQuadrantVisibility&&(li.visibleQuadrants=Rt),We.push({tileID:li,distanceSq:St*St+gi*gi})}}if(this.fogCullDistSq){const Oe=this.fogCullDistSq,nt=this.horizonLineFromTop();We=We.filter(Ge=>{const ut=[0,0,0,1],_t=[s.al,s.al,0,1],$t=this.calculateFogTileMatrix(Ge.tileID.toUnwrapped());s.aC(ut,ut,$t),s.aC(_t,_t,$t);const Rt=s.cF([],ut,_t),St=s.cG([],ut,_t),gi=s.c_(Rt,St);if(gi===0)return!0;let li=!1;const ti=this._elevation;if(ti&&gi>Oe&&nt!==0){const ci=this.calculateProjMatrix(Ge.tileID.toUnwrapped());let Oi;t.isTerrainDEM||(Oi=ti.getMinMaxForTile(Ge.tileID)),Oi||(Oi={min:we,max:Te});const Ki=s.cH(this.rotation),Hi=[Ki[0]*s.al,Ki[1]*s.al,Oi.max];s.af(Hi,Hi,ci),li=(1-Hi[1])*this.height*.5<nt}return gi<Oe||li})}return We.sort((Oe,nt)=>Oe.distanceSq-nt.distanceSq).map(Oe=>Oe.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const n=s.aA(t.lat,-s.cI,s.cI),c=this.projection.project(t.lng,n);return new s.P(c.x*this.worldSize,c.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,n){let c,m;const y=this.centerPoint;if(this.projection.name==="globe"){const E=this.worldSize;c=(n.x-y.x)/E,m=(n.y-y.y)/E}else{const E=this.pointCoordinate(n),R=this.pointCoordinate(y);c=E.x-R.x,m=E.y-R.y}const w=this.locationCoordinate(t);this.setLocation(new s.ae(w.x-c,w.y-m))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,n){return this.projection.locationPoint(this,t,n)}locationPoint3D(t,n){return this.projection.locationPoint(this,t,n,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,n){return this.coordinateLocation(this.pointCoordinate3D(t,n))}locationCoordinate(t,n){const c=n?s.ce(n,t.lat):void 0,m=this.projection.project(t.lng,t.lat);return new s.ae(m.x,m.y,c)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,n){const c=n??this._centerAltitude,m=[t.x,t.y,0,1],y=[t.x,t.y,1,1];s.aC(m,m,this.pixelMatrixInverse),s.aC(y,y,this.pixelMatrixInverse);const w=y[3];s.cJ(m,m,1/m[3]),s.cJ(y,y,1/w);const E=m[2],R=y[2];return{p0:m,p1:y,t:E===R?0:(c-E)/(R-E)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],c=[t.x,t.y,1,1];return s.aC(n,n,this.pixelMatrixInverse),s.aC(c,c,this.pixelMatrixInverse),s.cJ(n,n,1/n[3]),s.cJ(c,c,1/c[3]),n[2]=s.ce(n[2],this._center.lat)*this.worldSize,c[2]=s.ce(c[2],this._center.lat)*this.worldSize,s.cJ(n,n,1/this.worldSize),s.cJ(c,c,1/this.worldSize),new s.ax([n[0],n[1],n[2]],s.aw([],s.av([],c,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:c,t:m}=t,y=s.ce(n[2],this._center.lat),w=s.ce(c[2],this._center.lat);return new s.ae(s.ak(n[0],c[0],m)/this.worldSize,s.ak(n[1],c[1],m)/this.worldSize,s.ak(y,w,m))}pointCoordinate(t,n=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,n)}pointCoordinate3D(t,n){if(!this.elevation)return this.pointCoordinate(t,n);let c=this.projection.pointCoordinate3D(this,t.x,t.y);if(c)return new s.ae(c[0],c[1],c[2]);let m=0,y=this.horizonLineFromTop();if(t.y>y)return this.pointCoordinate(t,n);const w=.02*y,E=t.clone();for(let R=0;R<10&&y-m>w;R++){E.y=s.ak(m,y,.66);const L=this.projection.pointCoordinate3D(this,E.x,E.y);L?(y=E.y,c=L):m=E.y}return c?new s.ae(c[0],c[1],c[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=s.cK)return!this.isPointAboveHorizon(t);const n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}_coordinatePoint(t,n){const c=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,m=[t.x*this.worldSize,t.y*this.worldSize,c+t.toAltitude(),1];return s.aC(m,m,this.pixelMatrix),m[3]>0?new s.P(m[0]/m[3],m[1]/m[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:n}=this._edgeInsets,c=this.height-this._edgeInsets.bottom,m=this.width-this._edgeInsets.right,y=this.pointLocation3D(new s.P(n,t)),w=this.pointLocation3D(new s.P(m,t)),E=this.pointLocation3D(new s.P(m,c)),R=this.pointLocation3D(new s.P(n,c));let L=Math.min(y.lng,w.lng,E.lng,R.lng),P=Math.max(y.lng,w.lng,E.lng,R.lng),F=Math.min(y.lat,w.lat,E.lat,R.lat),j=Math.max(y.lat,w.lat,E.lat,R.lat);const H=Math.pow(2,-this.zoom)/16*270,$=this.projection.name==="globe"?1:4,G=(te,X,re,ce,fe)=>{const Te=(te+re)/2,we=(X+ce)/2,Ee=new s.P(Te,we),{lng:ve,lat:be}=this.pointLocation3D(Ee),Ce=Math.max(0,L-ve,F-be,ve-P,be-j);L=Math.min(L,ve),P=Math.max(P,ve),F=Math.min(F,be),j=Math.max(j,be),(fe<$||Ce>H)&&(G(te,X,Te,we,fe+1),G(Te,we,re,ce,fe+1))};if(G(n,t,m,t,1),G(m,t,m,c,1),G(m,c,n,c,1),G(n,c,n,t,1),this.projection.name==="globe"){const[te,X]=s.cL(this);te?(j=90,P=180,L=-180):X&&(F=-90,P=180,L=-180)}return new s.aI(new s.aR(L,F),new s.aR(P,j))}_getBoundsRectangular(t,n){const{top:c,left:m}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,E=new s.P(m,c),R=new s.P(w,c),L=new s.P(w,y),P=new s.P(m,y);let F=this.pointCoordinate(E,t),j=this.pointCoordinate(R,t);const H=this.pointCoordinate(L,n),$=this.pointCoordinate(P,n),G=(te,X)=>(X.y-te.y)/(X.x-te.x);return F.y>1&&j.y>=0?F=new s.ae((1-$.y)/G($,F)+$.x,1):F.y<0&&j.y<=1&&(F=new s.ae(-$.y/G($,F)+$.x,0)),j.y>1&&F.y>=0?j=new s.ae((1-H.y)/G(H,j)+H.x,1):j.y<0&&F.y<=1&&(j=new s.ae(-H.y/G(H,j)+H.x,0)),new s.aI().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(H))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const n=t.visibleDemTiles.reduce((c,m)=>{if(m.dem){const y=m.dem.tree;c.min=Math.min(c.min,y.minimums[0]),c.max=Math.max(c.max,y.maximums[0])}return c},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*t.exaggeration(),n.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,c=this.height/2-n*(1-this._horizonShift);return t?Math.max(0,c):c}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-s.cI,this.maxLat=s.cI,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aF(this.minLng)*this.tileSize,this.worldMaxX=s.aF(this.maxLng)*this.tileSize,this.worldMinY=s.aJ(this.maxLat)*this.tileSize,this.worldMaxY=s.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,n){return this.projection.createTileMatrix(this,n,t)}calculateDistanceTileData(t){const n=t.key,c=this._distanceTileDataCache;if(c[n])return c[n];const m=t.canonical,y=1/this.height,w=this.cameraWorldSize,E=w/this.zoomScale(m.z),R=(m.x+Math.pow(2,m.z)*t.wrap)*E,L=m.y*E,P=this.point;P.x*=w/this.worldSize,P.y*=w/this.worldSize;const F=this.angle,j=Math.sin(-F),H=-Math.cos(-F);return c[n]={bearing:[j,H],center:[(P.x-R)*y,(P.y-L)*y],scale:E/s.al*y},c[n]}calculateFogTileMatrix(t){const n=t.key,c=this._fogTileMatrixCache;if(c[n])return c[n];const m=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return s.aB(m,this.worldToFogMatrix,m),c[n]=new Float32Array(m),c[n]}calculateProjMatrix(t,n=!1,c=!1){const m=t.key;let y;if(y=c?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,y[m])return y[m];const w=this.calculatePosMatrix(t,this.worldSize);let E;return E=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,s.aB(w,E,w),y[m]=new Float32Array(w),y[m]}calculatePixelsToTileUnitsMatrix(t){const n=t.tileID.key,c=this._pixelsToTileUnitsCache;if(c[n])return c[n];const m=s.cM(t,this);return c[n]=m,c[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,n=s.bq([],[t,t,t]);return s.aB(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const n=s.ce(1,this._center.lat)*this.worldSize,c=this._computeCameraPosition(n),m=this._camera.forward(),y=s.ce(1,this._center.lat);c[2]/=y,m[2]/=y,s.aw(m,m);const w=t.raycast(c,m,t.exaggeration());if(w){const E=s.bH([],c,m,w),R=new s.ae(E[0],E[1],s.ce(E[2],s.a$(E[1]))),L=(R.z+s.ag([R.x-c[0],R.y-c[1],R.z-c[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const n=this._elevation,c=s.ce(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),y=n.getAtPointOrZero(new s.ae(...m)),w=this.pixelsPerMeter/this.worldSize*y,E=this._minimumHeightOverTerrain(),R=m[2]-w;if(R<=E)if(R<0||t){const L=this.locationCoordinate(this._center,this._centerAltitude),P=[m[0],m[1],L.z-m[2]],F=s.ag(P);P[2]-=(E-R)/this._pixelsPerMercatorPixel;const j=s.ag(P);if(j===0)return;s.c4(P,P,F/j*this._pixelsPerMercatorPixel),this._camera.position=[m[0],m[1],L.z*this._pixelsPerMercatorPixel-P[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const j=this.center;return j.lat=s.aA(j.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(j.lng=s.aA(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const n=this._unmodified,{x:c,y:m}=this.point;let y=0,w=c,E=m;const R=this.width/2,L=this.height/2,P=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(m-L<P&&(E=P+L),m+L>F&&(E=F-L),F-P<this.height&&(y=Math.max(y,this.height/(F-P)),E=(F+P)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const j=this.worldMinX*this.scale,H=this.worldMaxX*this.scale,$=this.worldSize/2-(j+H)/2;w=(c+$+this.worldSize)%this.worldSize-$,w-R<j&&(w=j+R),w+R>H&&(w=H-R),H-j<this.width&&(y=Math.max(y,this.width/(H-j)),w=(H+j)/2)}w===c&&E===m||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(w,E))),y&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.projection.name==="globe",c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.ce(1,this.center.lat)/s.ce(1,s.d1));const m=s.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?c:1,w=this._camera.getWorldToCamera(this.worldSize,y);let E;const R=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(R[8]=2*-t.x/this.width,R[9]=2*t.y/this.height,this.isOrthographic){let be=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ce=be*this.aspect,We=-Ce,ke=-be;Ce-=t.x,We-=t.x,be+=t.y,ke+=t.y,E=this._camera.getCameraToClipOrthographic(We,Ce,ke,be,this._nearZ,this._farZ),((ct,Ze,ot,Bt)=>{for(let Ye=0;Ye<16;Ye++)ct[Ye]=s.ak(Ze[Ye],ot[Ye],Bt)})(E,E,R,s.c$(this.pitch>=Gl?1:this.pitch/Gl))}else E=R;const L=s.cO([],R,w);let P=s.cO([],E,w);if(this.projection.isReprojectedInTileSpace){const be=this.locationCoordinate(this.center),Ce=s.bA([]);s.br(Ce,Ce,[be.x*this.worldSize,be.y*this.worldSize,0]),s.aB(Ce,Ce,s.cP(this)),s.br(Ce,Ce,[-be.x*this.worldSize,-be.y*this.worldSize,0]),s.aB(P,P,Ce),s.aB(L,L,Ce),this.inverseAdjustmentMatrix=s.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cR([],P,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=P,this.invProjMatrix=s.bl(new Float64Array(16),this.projMatrix),n){const be=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);be[8]=2*-t.x/this.width,be[9]=2*t.y/this.height,this.expandedFarZProjMatrix=s.cO([],be,w)}else this.expandedFarZProjMatrix=this.projMatrix;const F=s.bl([],E);this.frustumCorners=s.cS.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const j=new Float32Array(16);s.bA(j),s.cR(j,j,[1,-1,1]),s.cT(j,j,this._pitch),s.bB(j,j,this.angle);const H=s.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bz(H);const $=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;H[8]=2*-t.x/this.width,H[9]=2*(t.y+$)/this.height,this.skyboxMatrix=s.aB(j,H,j);const G=this.point,te=G.x,X=G.y,re=this.width%2/2,ce=this.height%2/2,fe=Math.cos(this.angle),Te=Math.sin(this.angle),we=te-Math.round(te)+fe*re+Te*ce,Ee=X-Math.round(X)+fe*ce+Te*re,ve=new Float64Array(P);if(s.br(ve,ve,[we>.5?we-1:we,Ee>.5?Ee-1:Ee,0]),this.alignedProjMatrix=ve,P=s.bC(),s.cR(P,P,[this.width/2,-this.height/2,1]),s.br(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=s.bC(),s.cR(P,P,[1,-1,1]),s.br(P,P,[-1,-1,0]),s.cR(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=s.aB(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},P=s.bl(new Float64Array(16),this.pixelMatrix),!P)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=P,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cU(this);const be=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.af(be,be,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=P;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,c=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,y=[t,t,n];s.c4(y,y,m),s.c4(c,c,-1),s.cV(c,c,y);const w=s.bC();s.br(w,w,c),s.cR(w,w,y),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,m)}_computeCameraPosition(t){const n=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,c=this._camera.forward(),m=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-t/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-c[0]*y,m.y/this.worldSize-c[1]*y,t/this.worldSize*this._centerAltitude-c[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),c=this._camera.position[2],m=t[2];let y=1;this.projection.wrap&&(this.center=this.center.wrap()),m>0&&(y=Math.min((n-c)/m,1)),this._camera.position=s.bH([],this._camera.position,t,y),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:c,bearing:m}=this._camera.getPitchBearing(),y=s.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.an(this._maxPitch)),E=Math.max((t[2]-y)/Math.cos(c),w),R=this._zoomFromMercatorZ(E);s.bH(t,t,n,E),this._pitch=s.aA(c,s.an(this.minPitch),s.an(this.maxPitch)),this.angle=s.bT(m,-Math.PI,Math.PI),this._setZoom(s.aA(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let n=0,c=s.cK,m=0,y=1/0;for(;c-n>1e-6&&c>n;){const w=n+.5*(c-n),E=this.tileSize*Math.pow(2,w),R=this.getCameraToCenterDistance(this.projection,w,E),L=this.scaleZoom(R/(Math.max(0,t)*this.tileSize)),P=Math.abs(w-L);P<y&&(y=P,m=w),w<L?n=w:c=w}return m}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,n){const c=Math.min(t.x,n.x),m=Math.max(t.x,n.x),y=Math.min(t.y,n.y),w=Math.max(t.y,n.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new s.P(c,y),new s.P(m,w),new s.P(c,w),new s.P(m,y)],R=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const P of E){const F=this.pointRayIntersection(P);if(F.t<0)return!0;const j=this.rayIntersectionCoordinate(F);if(j.x<R||j.y<0||j.x>L||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(t,n){const c=s.ag(s.av([],this._camera.position,t)),m=this._zoomFromMercatorZ(c)+n;return c-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([n,c,m],y){const w=[n,c,m,1];s.aC(w,w,y);const E=w[3]=Math.max(w[3],1e-6);return w[0]/=E,w[1]/=E,w[2]/=E,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}}getCameraToCenterDistance(t,n=this.zoom,c=this.worldSize){const m=s.cN(t,n,this.width,this.height,1024),y=t.pixelSpaceConversion(this.center.lat,c,m);let w=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(w=s.ak(1,w,s.c$(this.pitch>=Gl?1:this.pitch/Gl))),w}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.aB(t,t,this.globeMatrix),t}getFrustum(t){return s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const zc=(u,t)=>{if(t>0&&u.terrain&&s.w("Cutoff is currently disabled on terrain"),t<=0||u.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const n=u.transform,c=Math.max(Math.abs(n._zoom-(u.minCutoffZoom-1)),1),m=n.isLODDisabled(!1)?s.ah(60,45,n.pitch):s.ah(30,15,n.pitch),y=n._farZ-n._nearZ,w=t*n.height,E=((1-(R=m))*n.cameraToCenterDistance+R*(n._farZ+w))*c;var R;return{shouldRenderCutoff:m<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(E-n._nearZ)/y,(E-w-n._nearZ)/y]}}},qs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Wa{constructor(t,n){this.aabb=t,this.lastCascade=n}}class $l{add(t,n){const c=this.receivers[t.key];c!==void 0?(c.aabb.min[0]=Math.min(c.aabb.min[0],n.min[0]),c.aabb.min[1]=Math.min(c.aabb.min[1],n.min[1]),c.aabb.min[2]=Math.min(c.aabb.min[2],n.min[2]),c.aabb.max[0]=Math.max(c.aabb.max[0],n.max[0]),c.aabb.max[1]=Math.max(c.aabb.max[1],n.max[1]),c.aabb.max[2]=Math.max(c.aabb.max[2],n.max[2])):this.receivers[t.key]=new Wa(n,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,n,c){const m=s.d8.fromPoints(t.points);let y=0;for(const w in this.receivers){const E=this.receivers[w];if(!E||!m.intersectsAabb(E.aabb))continue;E.aabb.min=m.closestPoint(E.aabb.min),E.aabb.max=m.closestPoint(E.aabb.max);const R=E.aabb.getCorners();for(let L=0;L<c.length;L++){let P=!0;for(const F of R){const j=[F[0]*n,F[1]*n,F[2]];if(s.af(j,j,c[L].matrix),j[0]<-1||j[0]>1||j[1]<-1||j[1]>1){P=!1;break}}if(E.lastCascade=L,y=Math.max(y,L),P)break}}return y+1}}class Nm{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new $l,this._depthMode=new ni(t.context.gl.LEQUAL,ni.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(qs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(qs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(qs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,n){const c=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const m=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||m<=0||(this._shadowLayerCount=c.style.order.reduce(($,G)=>{const te=c.style._mergedLayers[G];return $+(te.hasShadowPass()&&!te.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const y=c.context,w=qs.shadowMapResolution,E=qs.shadowMapResolution;if(this._cascades.length===0||qs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let $=0;$<qs.cascadeCount;++$){const G=c._shadowMapDebug,te=y.gl,X=y.createFramebuffer(w,E,G,"texture"),re=new s.T(y,{width:w,height:E,data:null},te.DEPTH_COMPONENT16);if(X.depthAttachment.set(re.texture),G){const ce=new s.T(y,{width:w,height:E,data:null},te.RGBA8);X.colorAttachment.set(ce.texture)}this._cascades.push({framebuffer:X,texture:re,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cA,scale:0})}}this.shadowDirection=xu(n);let R=0;if(t.elevation){const $=t.elevation,G=[1e4,-1e4];$.visibleDemTiles.filter(te=>te.dem).forEach(te=>{const X=te.dem.tree;G[0]=Math.min(G[0],X.minimums[0]),G[1]=Math.max(G[1],X.maximums[0])}),G[0]!==1e4&&(R=(G[1]-G[0])*$.exaggeration())}const L=1.5*t.cameraToCenterDistance,P=3*L,F=new Float64Array(16);for(let $=0;$<this._cascades.length;++$){const G=this._cascades[$];let te=t.height/50,X=1;qs.cascadeCount===1?X=P:$===0?X=L:(te=L,X=P);const[re,ce]=Rp(t,this.shadowDirection,te,X,qs.shadowMapResolution,R);G.scale=t.scale,G.matrix=re,G.boundingSphereRadius=ce,s.bl(F,G.matrix),G.frustum=s.cA.fromInvProjectionMatrix(F,1,0,!0),G.far=X}const j=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[j].far,this._cascades[j].far],this._uniformValues.u_shadow_intensity=m,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/qs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=qs.shadowMapResolution,this._uniformValues.u_shadowmap_0=Qn.ShadowMap0,this._uniformValues.u_shadowmap_1=Qn.ShadowMap0+1,this._groundShadowTiles=c.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const H=c.transform.elevation;for(const $ of this._groundShadowTiles){let G={min:0,max:0};if(H){const te=H.getMinMaxForTile($);te&&(G=te)}this.addShadowReceiver($.toUnwrapped(),G.min,G.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,n){if(!this.enabled)return;const c=this.painter,m=c.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(c.transform.getFrustum(0),c.transform.worldSize,this._cascades),m.viewport.set([0,0,qs.shadowMapResolution,qs.shadowMapResolution]);for(let y=0;y<this._numCascadesToRender;++y){c.currentShadowCascade=y,m.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),m.clear({color:s.ao.white,depth:1});for(const w of t.order){const E=t._mergedLayers[w];if(!E.hasShadowPass()||E.isHidden(c.transform.zoom))continue;const R=t.getLayerSourceCache(E),L=R?n[R.id]:void 0;(E.type==="model"||L&&L.length)&&c.renderLayer(c,R,E,L)}}c.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,n=t.style,c=t.context,m=c.gl,y=n.directionalLight,w=n.ambientLight;if(!y||!w)return;const E=[],R=zc(t,t.longestCutoffRange);R.shouldRenderCutoff&&E.push("RENDER_CUTOFF"),E.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&E.push("NORMAL_OFFSET");const L=To(n,y,w),P=new ni(m.LEQUAL,ni.ReadOnly,t.depthRangeFor3D),F=new Ii({func:m.EQUAL,mask:255},0,255,m.KEEP,m.KEEP,m.KEEP);for(const j of this._groundShadowTiles){const H=j.toUnwrapped(),$=t.isTileAffectedByFog(j),G=t.getOrCreateProgram("groundShadow",{defines:E,overrideFog:$});this.setupShadows(H,G),t.uploadCommonUniforms(c,G,H,null,R);const te={u_matrix:t.transform.calculateProjMatrix(H),u_ground_shadow_factor:L};G.draw(t,m.TRIANGLES,P,F,ir.multiply,ki.disabled,te,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?ir.unblended:ir.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const n=this.painter.transform,c=n.calculatePosMatrix(t,n.worldSize);return s.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,c),Float32Array.from(c)}calculateShadowPassMatrixFromMatrix(t){return s.aB(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,n,c){if(!this.enabled)return;const m=this.painter.transform,y=this.painter.context,w=y.gl,E=this._uniformValues,R=new Float64Array(16),L=m.calculatePosMatrix(t,m.worldSize);for(let P=0;P<this._cascades.length;P++)s.aB(R,this._cascades[P].matrix,L),E[P===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),y.activeTexture.set(w.TEXTURE0+Qn.ShadowMap0+P),this._cascades[P].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=!!c,this.useNormalOffset){const P=s.d6(t.canonical),F=2/m.tileSize*s.al/qs.shadowMapResolution,j=F*this._cascades[0].boundingSphereRadius,H=F*this._cascades[this._cascades.length-1].boundingSphereRadius,$=(c==="vector-tile"?1:3)*function(G,te,X,re,ce){const fe=s.aA((G-22)/-22,0,1);return .125*(1-fe)+4*fe}(m.zoom);E.u_shadow_normal_offset=[P,j*$,H*$],E.u_shadow_bias=[1e-4,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(y,E)}setupShadowsFromMatrix(t,n,c=!1){if(!this.enabled)return;const m=this.painter.context,y=m.gl,w=this._uniformValues,E=new Float64Array(16);for(let R=0;R<qs.cascadeCount;R++)s.aB(E,this._cascades[R].matrix,t),w[R===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),m.activeTexture.set(y.TEXTURE0+Qn.ShadowMap0+R),this._cascades[R].texture.bindExtraParam(y.LINEAR,y.LINEAR,y.CLAMP_TO_EDGE,y.CLAMP_TO_EDGE,y.GREATER);if(this.useNormalOffset=c,c){const R=qs.normalOffset;w.u_shadow_normal_offset=[1,R,R],w.u_shadow_bias=[6e-5,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(m,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,n,c,m){if(m[2]>=0)return{};const y=function(R,L,P){const F=P/(1<<R.canonical.z);return new s.d8([R.canonical.x*F+R.wrap*P,R.canonical.y*F+R.wrap*P,0],[(R.canonical.x+1)*F+R.wrap*P,(R.canonical.y+1)*F+R.wrap*P,L])}(t,n,c).getCorners(),w=n/-m[2];m[0]<0?(s.d7(y[0],y[0],[m[0]*w,0,0]),s.d7(y[3],y[3],[m[0]*w,0,0])):m[0]>0&&(s.d7(y[1],y[1],[m[0]*w,0,0]),s.d7(y[2],y[2],[m[0]*w,0,0])),m[1]<0?(s.d7(y[0],y[0],[0,m[1]*w,0]),s.d7(y[1],y[1],[0,m[1]*w,0])):m[1]>0&&(s.d7(y[2],y[2],[0,m[1]*w,0]),s.d7(y[3],y[3],[0,m[1]*w,0]));const E={};return E.vertices=y,E.planes=[gd(y[1],y[0],y[4]),gd(y[2],y[1],y[5]),gd(y[3],y[2],y[6]),gd(y[0],y[3],y[7])],E}addShadowReceiver(t,n,c){this._receivers.add(t,s.d8.fromTileIdAndHeight(t,n,c))}getMaxCascadeForTile(t){const n=this._receivers.get(t);return n&&n.lastCascade?n.lastCascade:0}}function gd(u,t,n){const c=s.av([],n,t),m=s.av([],u,t),y=s.bI([],c,m),w=s.ag(y);return w===0?[0,0,1,0]:(s.c4(y,y,1/w),[y[0],y[1],y[2],-s.bJ(y,t)])}function xu(u){const t=u.properties.get("direction"),n=s.d3(t.x,t.y,t.z);n[2]=s.aA(n[2],0,75);const c=s.d5([n[0],n[1],n[2]]);return s.d4(c.x,c.y,c.z)}function To(u,t,n){const c=t.properties.get("color-use-theme")==="none",m=t.properties.get("color"),y=t.properties.get("intensity"),w=t.properties.get("direction"),E=[w.x,w.y,w.z],R=n.properties.get("color-use-theme")==="none",L=n.properties.get("color"),P=n.properties.get("intensity"),F=Math.max(s.bJ([0,0,1],E),0),j=[0,0,0];s.c4(j,L.toPremultipliedRenderColor(R?null:u.getLut(t.scope)).toArray01Linear().slice(0,3),P);const H=[0,0,0];return s.c4(H,m.toPremultipliedRenderColor(c?null:u.getLut(n.scope)).toArray01Linear().slice(0,3),F*y),s.da([j[0]>0?j[0]/(j[0]+H[0]):0,j[1]>0?j[1]/(j[1]+H[1]):0,j[2]>0?j[2]/(j[2]+H[2]):0])}function Rp(u,t,n,c,m,y){const w=u.zoom,E=u.scale,R=u.worldSize,L=1/R,P=u.aspect,F=Math.sqrt(1+P*P)*Math.tan(.5*u.fovX),j=F*F,H=c-n,$=c+n;let G,te;j>H/$?(G=c,te=c*F):(G=.5*$*(1+j),te=.5*Math.sqrt(H*H+2*(c*c+n*n)*j+$*$*j*j));const X=u.projection.pixelsPerMeter(u.center.lat,R),re=u._camera.getCameraToWorldMercator(),ce=[0,0,-G*L];s.af(ce,ce,re);let fe=te*L;const Te=u._edgeInsets;if(!(Te.left===0&&Te.top===0&&Te.right===0&&Te.bottom===0||Te.left===Te.right&&Te.top===Te.bottom)){const ut=u._camera.getWorldToCamera(u.worldSize,u.projection.zAxisUnit==="meters"?X:1),_t=u._camera.getCameraToClipPerspective(u._fov,u.width/u.height,n,c);_t[8]=2*-u.centerOffset.x/u.width,_t[9]=2*u.centerOffset.y/u.height;const $t=new Float64Array(16);s.cO($t,_t,ut);const Rt=new Float64Array(16);s.bl(Rt,$t);const St=s.cA.fromInvProjectionMatrix(Rt,R,w,!0);for(const gi of St.points){const li=((we=gi)[0]/=E,we[1]/=E,we[2]=s.ce(we[2],u._center.lat),we);fe=Math.max(fe,s.c5(s.d9([],ce,li)))}}var we;fe*=m/(m-1);const Ee=Math.acos(t[2]),ve=Math.atan2(-t[0],-t[1]),be=new md;be.position=ce,be.setPitchBearing(Ee,ve);const Ce=be.getWorldToCamera(R,X),We=fe*R,ke=Math.min(u._mercatorZfromZoom(17)*R*-2,-2*We),ct=be.getCameraToClipOrthographic(-We,We,-We,We,ke,(We+y*X)/t[2]),Ze=new Float64Array(16);s.aB(Ze,ct,Ce);const ot=s.d4(Math.floor(1e6*ce[0])/1e6*R,Math.floor(1e6*ce[1])/1e6*R,0),Bt=.5*m,Ye=[0,0,0];s.af(Ye,ot,Ze),s.c4(Ye,Ye,Bt);const Oe=[Math.floor(Ye[0]),Math.floor(Ye[1]),Math.floor(Ye[2])],nt=[0,0,0];s.av(nt,Ye,Oe),s.c4(nt,nt,-1/Bt);const Ge=new Float64Array(16);return s.bA(Ge),s.br(Ge,Ge,nt),s.aB(Ze,Ge,Ze),[Ze,We]}class mh extends s.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,n){return s.aV(this.requestManager.transformRequest(n,s.R.Model).url).then(c=>{if(!c)return;const m=s.aW(c),y=new s.aX(t,void 0,void 0,m);return y.computeBoundsAndApplyParent(),y}).catch(c=>{if(c&&c.status===404)return null;this.fire(new s.y(new Error(`Could not load model ${t} from ${n}: ${c.message}`)))})}load(t,n,c={forceReload:!1}){this.models[n]||(this.models[n]={});const m=Object.keys(t),y=[],w=[];for(const E of m){const R=t[E];this.hasURLBeenRequested(R)&&!c.forceReload||(this.modelByURL[R]={modelId:E,scope:n},y.push(this.loadModel(E,R)),w.push(E)),this.models[n][E]||(this.models[n][E]={model:null,numReferences:1})}this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+w.length,Promise.allSettled(y).then(E=>{for(let R=0;R<E.length;R++){const{status:L}=E[R];if(L==="rejected")continue;const{value:P}=E[R];this.models[n][w[R]]||(this.models[n][w[R]]={model:null,numReferences:1}),this.models[n][w[R]].model=P}this.numModelsLoading[n]-=w.length,this.fire(new s.z("data",{dataType:"style"}))}).catch(E=>{this.fire(new s.y(new Error(`Could not load models: ${E.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,n,c={exactIdMatch:!1}){return!!(c.exactIdMatch?this.getModel(t,n):this.getModelByURL(this.modelUris[n][t]))}getModel(t,n){return this.models[n]||(this.models[n]={}),this.models[n][t]?this.models[n][t].model:void 0}getModelByURL(t){if(!t)return null;const n=this.modelByURL[t];return n?this.models[n.scope][n.modelId].model:null}hasModelBeenAdded(t,n){return this.models[n]&&this.models[n][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,n,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const m=this.requestManager.normalizeModelURL(n);if((this.hasModel(t,c,{exactIdMatch:!0})||this.hasModelBeenAdded(t,c))&&this.modelUris[c][t]===m)this.models[c][t].numReferences++;else if(this.hasURLBeenRequested(m)){const{scope:y,modelId:w}=this.modelByURL[m];this.models[y][w].numReferences++}else this.modelUris[c][t]=m,this.load({[t]:this.modelUris[c][t]},c)}addModelURLs(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const c=this.modelUris[n];for(const m in t)c[m]=this.requestManager.normalizeModelURL(t[m])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const c={};for(const m of t)this.hasModel(m,n,{exactIdMatch:!0})||this.hasURLBeenRequested(m)?this.models[n][m].numReferences++:this.modelUris[n][m]&&!this.hasURLBeenRequested(m)?c[m]=this.modelUris[n][m]:!this.hasURLBeenRequested(m)&&s.db(m,!1)&&(this.modelUris[n][m]=this.requestManager.normalizeModelURL(m),c[m]=this.modelUris[n][m]);this.load(c,n)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,n,c=!1,m=!1){if(this.models[n]&&this.models[n][t]&&(this.models[n][t].numReferences--,this.models[n][t].numReferences===0||m)){const y=this.modelUris[n][t];c||delete this.modelUris[n][t],delete this.modelByURL[y];const w=this.models[n][t].model;if(!w)return;delete this.models[n][t],w.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const n of Object.keys(this.models[t])){const c=this.models[t][n].model;delete this.models[t][n],c&&c.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,n){this.models[n]||(this.models[n]={});for(const c in this.models[n])this.models[n][c].model&&this.models[n][c].model.upload(t.context)}}const km=new s.a9({data:new s.aa(s.a6.colorTheme.data)});function Zl(u){if(!u.metadata||!u.metadata.content_area)return;const t=s.o.devicePixelRatio,{left:n,top:c,width:m,height:y}=u.metadata.content_area,w=n*t,E=c*t;return[w,E,w+m*t,E+y*t]}function gh(u){if(u)return u.map(([t,n])=>[t*s.o.devicePixelRatio,n*s.o.devicePixelRatio])}class So{constructor(t,n,c){this.id=t,this.scope=n,this.sourceCache=c,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const n=this.sourceCache.getVisibleCoordinates();if(n.length===0)return t;const c=this.sourceCache.getSource();if(!(c instanceof Ol))return t;const m=n.map(w=>this.sourceCache.getTile(w)),y=c.getImages(m,Array.from(this.pendingRequests));for(const[w,E]of y)t.set(s.I.from({name:w,iconsetId:this.id}),E),this.pendingRequests.delete(w);for(const w of this.pendingRequests)this.missingRequests.add(w);return this.pendingRequests.clear(),t}}const Wl=(u,t)=>Ie(u,t&&t.filter(n=>n.identifier!=="source.canvas")),Bm=s.aH(Mr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),vu=s.aH(Mr,["setCenter","setZoom","setBearing","setPitch"]),Xl=new Set(["background","sky","slot","custom"]),vf={version:8,layers:[],sources:{}},_d={duration:300,delay:0};class Xs extends s.E{constructor(t,n={}){super(),this.map=t,this.scope=n.scope||"",this.globalId=null,this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=Object.assign({},_d),this._buildingIndex=new uh(this),this.crossTileSymbolIndex=new vs,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new Cr,this.dispatcher=n.dispatcher?n.dispatcher:new s.D(s.dd(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new Er(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new s.de(t._requestManager,n.localFontFamily?s.df.all:n.localIdeographFontFamily?s.df.ideographs:s.df.none,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new mh(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=n.configOptions?n.configOptions:new Map,this._configDependentLayers=n.configDependentLayers?n.configDependentLayers:new Set,this._config=n.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:n.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=n.initialConfig,this.dispatcher.broadcast("setReferrer",s.dg());const c=this;this._rtlTextPluginCallback=Xs.registerForPluginStateChange(m=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(y,w)=>{if(s.dh(y),w&&w.every(E=>E))for(const E in c._sourceCaches){const R=c._sourceCaches[E],L=R.getSource().type;L!=="vector"&&L!=="geojson"||R.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const y=this.getOwnSource(m.sourceId);if(y&&y.vectorLayerIds)for(const w in this._layers){const E=this._layers[w];E.source===y.id&&this._validateLayer(E)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(s.h(t))return t;const n=s.di(t);if(!n.startsWith("http"))try{return new URL(n,location.href).toString()}catch{return n}return n}return`json://${s.dj(JSON.stringify(t))}`}_diffStyle(t,n,c){this.globalId=this._getGlobalId(t);const m=(y,w)=>{try{w(null,this.setState(y,c))}catch(E){w(E,!1)}};if(typeof t=="string"){const y=this.map._requestManager.normalizeStyleURL(t),w=this.map._requestManager.transformRequest(y,s.R.Style);s.m(w,(E,R)=>{E?this.fire(new s.y(E)):R&&m(R,n)})}else typeof t=="object"&&m(t,n)}loadURL(t,n={}){this.fire(new s.z("dataloading",{dataType:"style"}));const c=typeof n.validate=="boolean"?n.validate:!s.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,n.accessToken),this.resolvedImports.add(t);const m=this.importsCache.get(t);if(m)return this._load(m,c);const y=this.map._requestManager.transformRequest(t,s.R.Style);this._request=s.m(y,(w,E)=>{if(this._request=null,w)this.fire(new s.y(w));else if(E)return this.importsCache.set(t,E),this._load(E,c)})}loadJSON(t,n={}){this.fire(new s.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=s.o.frame(()=>{this._request=null,this._load(t,n.validate!==!1)})}loadEmpty(){this.fire(new s.z("dataloading",{dataType:"style"})),this._load(vf,!1)}_loadImports(t,n,c){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const m=[];for(const y of t){const w=this._createFragmentStyle(y),E=new Promise(P=>{w.once("style.import.load",P),w.once("error",P)}).then(()=>this.mergeAll());if(m.push(E),this.resolvedImports.has(y.url)){w.loadEmpty();continue}const R=y.data||this.importsCache.get(y.url);R?(w.loadJSON(R,{validate:n}),this._isInternalStyle(R)&&(w.globalId=null)):y.url?w.loadURL(y.url,{validate:n}):w.loadEmpty();const L={style:w,id:y.id,config:y.config};if(c){const P=this.fragments.findIndex(({id:F})=>F===c);this.fragments=this.fragments.slice(0,P).concat(L).concat(this.fragments.slice(P))}else this.fragments.push(L)}return Promise.allSettled(m)}getImportGlobalIds(t=this,n=new Set){for(const c of t.fragments)c.style.globalId&&n.add(c.style.globalId),this.getImportGlobalIds(c.style,n);return[...n.values()]}_createFragmentStyle(t){const n=this.scope?s.B(t.id,this.scope):t.id;let c;const m=this._initialConfig&&this._initialConfig[n];(t.config||m)&&(c=Object.assign({},t.config,m));const y=new Xs(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:c,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,n){if(this._isInternalStyle(t)){const y=Object.assign({},vf,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(y,n)}if(this.updateConfig(this._config,t.schema),n&&Wl(this,br(t)))return;this._loaded=!0,this.stylesheet=s.dk(t);const c=()=>{for(const R in t.sources)this.addSource(R,t.sources[R],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const R in t.iconsets)this.addIconset(R,t.iconsets[R]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const y=Rc(this.stylesheet.layers);if(this._order=y.map(R=>R.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const R=this.stylesheet.lights[0];this.light=new Be(R.properties,R.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Be(this.stylesheet.light)),this._layers={};for(const R of y){const L=s.dq(R,this.scope,this._styleColorTheme.lut,this.options);L.configDependencies.size!==0&&this._configDependentLayers.add(L.fqid),L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L;const P=this.getOwnLayerSourceCache(L),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();P&&L.canCastShadows()&&F&&(P.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const w=this.stylesheet.terrain;w&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(w,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.z("data",{dataType:"style"}));const E=this.isRootStyle();t.imports?this._loadImports(t.imports,n).then(()=>{this._reloadImports(),this.fire(new s.z(E?"style.load":"style.import.load"))}).catch(R=>{this.fire(new s.y(new Error("Failed to load imports",R))),this.fire(new s.z(E?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.z(E?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const m=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(m){const y=this._evaluateColorThemeData(m);this._loadColorTheme(y).then(()=>{c()}).catch(w=>{s.w(`Couldn't load color theme from the stylesheet: ${w}`),c()})}else this._styleColorTheme.lut=null,c()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,n,c,m,y,w,E,R,L,P;const F={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(j=>{if(j.stylesheet){if(j.light!=null&&(t=j.light),j.stylesheet.lights)for(const H of j.stylesheet.lights)H.type==="ambient"&&j.ambientLight!=null&&(n=j.ambientLight),H.type==="directional"&&j.directionalLight!=null&&(c=j.directionalLight);m=this._prioritizeTerrain(m,j.terrain,j.stylesheet.terrain),j.stylesheet.fog&&j.fog!=null&&(y=j.fog),j.stylesheet.snow&&j.snow!=null&&(w=j.snow),j.stylesheet.rain&&j.rain!=null&&(E=j.rain),j.stylesheet.camera!=null&&(P=j.stylesheet.camera),j.stylesheet.projection!=null&&(R=j.stylesheet.projection),j.stylesheet.transition!=null&&(L=j.stylesheet.transition),F[j.scope]=j._styleColorTheme}}),this.light=t,this.ambientLight=n,this.directionalLight=c,this.fog=y,this.snow=w,this.rain=E,this._styleColorThemeForScope=F,m===null?delete this.terrain:this.terrain=m,this.camera=P||{"camera-projection":"perspective"},this.projection=R||{name:"mercator"},this.transition=Object.assign({},_d,L),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const n=c=>{for(const m of c.fragments)n(m.style);t(c)};n(this)}_prioritizeTerrain(t,n,c){const m=t&&t.drapeRenderMode===0;return c===null?n&&n.drapeRenderMode===0?n:m?t:null:n!=null&&(!t||m||n&&n.drapeRenderMode===1)?n:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(n=>{t=this._prioritizeTerrain(t,n.terrain,n.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(n=>{n.stylesheet.projection!=null&&(t=n.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},n={},c={};this.forEachFragmentStyle(m=>{for(const y in m._sourceCaches){const w=s.B(y,m.scope);t[w]=m._sourceCaches[y]}for(const y in m._otherSourceCaches){const w=s.B(y,m.scope);n[w]=m._otherSourceCaches[y]}for(const y in m._symbolSourceCaches){const w=s.B(y,m.scope);c[w]=m._symbolSourceCaches[y]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=c}mergeLayers(){const t={},n=[],c={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(const E of w._order){const R=w._layers[E];if(R.type==="slot"){const L=s.dl(E);if(t[L])continue;t[L]=[]}R.slot&&t[R.slot]?t[R.slot].push(R):n.push(R)}}),this._mergedOrder=[];let m=-1;const y=(w=[])=>{for(const E of w)if(E.type==="slot"){const R=s.dl(E.id);t[R]&&y(t[R]),this._mergedSlots.push(R)}else{const R=s.B(E.id,E.scope);this._mergedOrder.push(R),c[R]=E,E.is3D(!!this.terrain)&&(this._has3DLayers=!0,m=this._mergedOrder.length-1),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0),E.type==="clip"&&(this._clipLayerPresent=!0)}};if(y(n),this._has3DLayers){const w={};for(let E=0;E<this._mergedOrder.length;++E){const R=this._mergedOrder[E];w[R]=E===m?1:E<m?c[R].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((E,R)=>w[E]-w[R])}this._mergedLayers=c,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(n,c,m,y){const w=Object.assign({},c);for(const R of Object.keys(s.a6.colorTheme))w[R]===void 0&&(w[R]=s.a6.colorTheme[R].default);const E=new s.a8(km,n,new Map(m));return E.setTransitionOrValue(w,m),E.untransitioned().possiblyEvaluate(new s.ac(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const n=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((c,m)=>{const y="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void c();let w=t;w.startsWith(y)||(w=y+w);const E=s.I.from("mapbox-reserved-lut"),R=new Image;R.src=w,R.onerror=()=>{this._styleColorTheme.lutLoading=!1,m(new Error("Failed to load image data"))},R.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==n)return void c();this._styleColorTheme.lutLoading=!1;const{width:L,height:P,data:F}=s.o.getImageData(R);if(P>32)return void m(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==P*P)return void m(new Error("The width of the image must be equal to the height squared."));this.getImage(E)&&this.removeImage(E),this.addImage(E,{data:new s.q({width:L,height:P},F),pixelRatio:1,sdf:!1,usvg:!1,version:0});const j=this.imageManager.getImage(E,this.scope);j?(this._styleColorTheme.lut={image:j.data,data:t},c()):m(new Error("Missing LUT image."))}})}getLut(t){const n=this._styleColorThemeForScope[t];return n?n.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(n,c,m){let y,w,E;const R=s.o.devicePixelRatio>1?"@2x":"";let L=s.m(c.transformRequest(c.normalizeSpriteURL(n,R,".json"),s.R.SpriteJSON),(j,H)=>{L=null,E||(E=j,y=H,F())}),P=s.n(c.transformRequest(c.normalizeSpriteURL(n,R,".png"),s.R.SpriteImage),(j,H)=>{P=null,E||(E=j,w=H,F())});function F(){if(E)m(E);else if(y&&w){const j=s.o.getImageData(w),H={};for(const $ in y){const{width:G,height:te,x:X,y:re,sdf:ce,pixelRatio:fe,stretchX:Te,stretchY:we,content:Ee}=y[$],ve=new s.q({width:G,height:te});s.q.copy(j,ve,{x:X,y:re},{x:0,y:0},{width:G,height:te},null),H[$]={data:ve,pixelRatio:fe!==void 0?fe:1,sdf:ce!==void 0&&ce,stretchX:Te,stretchY:we,content:Ee,usvg:!1,version:0}}m(null,H)}}return{cancel(){L&&(L.cancel(),L=null),P&&(P.cancel(),P=null)}}}(t,this.map._requestManager,(n,c)=>{if(this._spriteRequest=null,n)this.fire(new s.y(n));else if(c){const m=new Map;for(const y in c)m.set(s.I.from(y),c[y]);this.addImages(m)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))})}addIconset(t,n){if(n.type==="sprite")return void this._loadSprite(n.url);const c=this.getOwnSourceCache(n.source);if(!c)return void this.fire(new s.y(new Error(`Source "${n.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const m=c.getSource();if(m.type!=="raster-array")return void this.fire(new s.y(new Error(`Source "${n.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));m.partial=!1;const y=new So(t,this.scope,c);this.imageManager.addImageProvider(y,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!s.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const n=this.map._spriteFormat==="auto";var c,m;this._spriteRequest=(m=(y,w)=>{if(this._spriteRequest=null,y)n?this._loadSprite(t):this.fire(new s.y(y));else if(w){const E=new Map;for(const R in w)E.set(s.I.from(R),w[R]);this.addImages(E)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))},s.bu((c=this.map._requestManager).transformRequest(c.normalizeIconsetURL(t),s.R.Iconset),(y,w)=>{if(y)return void m(y);const E={},R=s.dc(new s.bt(w));for(const L of R.icons){const P={version:1,pixelRatio:s.o.devicePixelRatio,content:Zl(L),stretchX:L.metadata?gh(L.metadata.stretch_x_areas):void 0,stretchY:L.metadata?gh(L.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:L};E[L.name]=P}m(null,E)}))}_validateLayer(t){const n=this.getOwnSource(t.source);if(!n)return;const c=t.sourceLayer;c&&(n.type==="geojson"||n.vectorLayerIds&&n.vectorLayerIds.indexOf(c)===-1)&&this.fire(new s.y(new Error(`Source layer "${c}" does not exist on source "${n.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,n)=>{const c=this.fragments[n];return c&&c.style&&(t.data=c.style.serialize()),t})}_serializeSources(){const t={};for(const n in this._sourceCaches){const c=this._sourceCaches[n].getSource();t[c.id]||(t[c.id]=c.serialize())}return t}_serializeLayers(t){const n=[];for(const c of t){const m=this._layers[c];m&&m.type!=="custom"&&n.push(m.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const n=this.getOwnLayer(t);if(n)return n;this.fire(new s.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const n=this.getOwnSource(t);if(n)return n;this.fire(new s.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,n){const c=this.map.painter;if(c)for(let m=t.minzoom||0;m<(t.maxzoom||25.5);m++){const y=t.getProgramIds();if(y)for(const w of y){const E=t.getDefaultProgramParams(w,n.zoom,this._styleColorTheme.lut);E&&(c.style=this,this.fog&&(c._fogVisible=!0,E.overrideFog=!0,c.getOrCreateProgram(w,E)),c._fogVisible=!1,E.overrideFog=!1,c.getOrCreateProgram(w,E),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(E.overrideRtt=!0,c.getOrCreateProgram(w,E)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const n=this.calculateLightsBrightness();t.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const c=this._changes.isDirty();let m=!1;if(this._changes.isDirty()){const E=this._changes.getLayerUpdatesByScope();for(const R in E){const{updatedIds:L,removedIds:P}=E[R];(L||P)&&(this._updateWorkerLayers(R,L,P),m=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const y={};for(const E in this._mergedSourceCaches){const R=this._mergedSourceCaches[E];y[E]=R.used,R.used=!1,R.tileCoverLift=0}for(const E of this._mergedOrder){const R=this._mergedLayers[E];if(R.recalculate(t,this._availableImages),!R.isHidden(t.zoom)){const L=this.getLayerSourceCache(R);L&&(L.used=!0,L.tileCoverLift=Math.max(L.tileCoverLift,R.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(R,t)}):this.precompilePrograms(R,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&m&&this.mergeLayers();const w=this.imageManager.getPendingImageProviders();for(const E of w)E.sourceCache.used=!0;for(const E in y){const R=this._mergedSourceCaches[E];y[E]!==R.used&&R.getSource().fire(new s.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:R.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),c&&this.fire(new s.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const n of t){const c=n.resolvePendingRequests(),m=this.getFragmentStyle(n.scope);m&&m.addImages(c)}}_updateTilesForChangedImages(){const t={};for(const n in this._mergedSourceCaches){const c=this._mergedSourceCaches[n].getSource().scope;t[c]=t[c]||this._changes.getUpdatedImages(c),t[c].length!==0&&this._mergedSourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t[c])}for(const n in t)this._changes.resetUpdatedImages(n)}_updateWorkerLayers(t,n,c){const m=this.getFragmentStyle(t);m&&this.dispatcher.broadcast("updateLayers",{layers:n?m._serializeLayers(n):[],scope:t,removedIds:c||[],options:m.options})}setState(t,n){if(this._checkLoaded(),Wl(this,br(t)))return!1;(t=s.dk(t)).layers=Rc(t.layers);const c=function(w,E){if(!w)return[{command:Mr.setStyle,args:[E]}];let R=[];try{if(!s.by(w.version,E.version))return[{command:Mr.setStyle,args:[E]}];if(s.by(w.center,E.center)||R.push({command:Mr.setCenter,args:[E.center]}),s.by(w.zoom,E.zoom)||R.push({command:Mr.setZoom,args:[E.zoom]}),s.by(w.bearing,E.bearing)||R.push({command:Mr.setBearing,args:[E.bearing]}),s.by(w.pitch,E.pitch)||R.push({command:Mr.setPitch,args:[E.pitch]}),s.by(w.sprite,E.sprite)||R.push({command:Mr.setSprite,args:[E.sprite]}),s.by(w.glyphs,E.glyphs)||R.push({command:Mr.setGlyphs,args:[E.glyphs]}),s.by(w.imports,E.imports)||function(H=[],$=[],G){$=$||[];const te=(H=H||[]).map(Bl),X=$.map(Bl),re=H.reduce(Mc,{}),ce=$.reduce(Mc,{}),fe=te.slice();let Te,we,Ee,ve;for(Te=0,we=0;Te<te.length;Te++)Ee=te[Te],ce.hasOwnProperty(Ee)?we++:(G.push({command:Mr.removeImport,args:[Ee]}),fe.splice(fe.indexOf(Ee,we),1));for(Te=0,we=0;Te<X.length;Te++)Ee=X[X.length-1-Te],fe[fe.length-1-Te]!==Ee&&(re.hasOwnProperty(Ee)?(G.push({command:Mr.removeImport,args:[Ee]}),fe.splice(fe.lastIndexOf(Ee,fe.length-we),1)):we++,ve=fe[fe.length-Te],G.push({command:Mr.addImport,args:[ce[Ee],ve]}),fe.splice(fe.length-Te,0,Ee));for(const be of $){const Ce=re[be.id];Ce&&(delete Ce.data,s.by(Ce,be)||G.push({command:Mr.updateImport,args:[be.id,be]}))}}(w.imports,E.imports,R),s.by(w.transition,E.transition)||R.push({command:Mr.setTransition,args:[E.transition]}),s.by(w.light,E.light)||R.push({command:Mr.setLight,args:[E.light]}),s.by(w.fog,E.fog)||R.push({command:Mr.setFog,args:[E.fog]}),s.by(w.snow,E.snow)||R.push({command:Mr.setSnow,args:[E.snow]}),s.by(w.rain,E.rain)||R.push({command:Mr.setRain,args:[E.rain]}),s.by(w.projection,E.projection)||R.push({command:Mr.setProjection,args:[E.projection]}),s.by(w.lights,E.lights)||R.push({command:Mr.setLights,args:[E.lights]}),s.by(w.camera,E.camera)||R.push({command:Mr.setCamera,args:[E.camera]}),s.by(w.iconsets,E.iconsets)||function(H,$,G){let te;for(te in $=$||{},H=H||{})H.hasOwnProperty(te)&&($.hasOwnProperty(te)||G.push({command:Mr.removeIconset,args:[te]}));for(te in $){if(!$.hasOwnProperty(te))continue;const X=$[te];H.hasOwnProperty(te)?s.by(H[te],X)||(G.push({command:Mr.removeIconset,args:[te]}),G.push({command:Mr.addIconset,args:[te,X]})):G.push({command:Mr.addIconset,args:[te,X]})}}(w.iconsets,E.iconsets,R),!s.by(w["color-theme"],E["color-theme"]))return[{command:Mr.setStyle,args:[E]}];const L={},P=[];(function(H,$,G,te){let X;for(X in $=$||{},H=H||{})H.hasOwnProperty(X)&&($.hasOwnProperty(X)||Nl(X,G,te));for(X in $){if(!$.hasOwnProperty(X))continue;const re=$[X];H.hasOwnProperty(X)?s.by(H[X],re)||(H[X].type==="geojson"&&re.type==="geojson"&&uu(H,$,X)?G.push({command:Mr.setGeoJSONSourceData,args:[X,re.data]}):pf(X,$,G,te)):ul(X,$,G)}})(w.sources,E.sources,P,L);const F=[];w.layers&&w.layers.forEach(H=>{H.source&&L[H.source]?R.push({command:Mr.removeLayer,args:[H.id]}):F.push(H)});let j=w.terrain;j&&L[j.source]&&(R.push({command:Mr.setTerrain,args:[void 0]}),j=void 0),R=R.concat(P),s.by(j,E.terrain)||R.push({command:Mr.setTerrain,args:[E.terrain]}),function(H,$,G){$=$||[];const te=(H=H||[]).map(Bl),X=$.map(Bl),re=H.reduce(Mc,{}),ce=$.reduce(Mc,{}),fe=te.slice(),Te=Object.create(null);let we,Ee,ve,be,Ce,We,ke;for(we=0,Ee=0;we<te.length;we++)ve=te[we],ce.hasOwnProperty(ve)?Ee++:(G.push({command:Mr.removeLayer,args:[ve]}),fe.splice(fe.indexOf(ve,Ee),1));for(we=0,Ee=0;we<X.length;we++)ve=X[X.length-1-we],fe[fe.length-1-we]!==ve&&(re.hasOwnProperty(ve)?(G.push({command:Mr.removeLayer,args:[ve]}),fe.splice(fe.lastIndexOf(ve,fe.length-Ee),1)):Ee++,We=fe[fe.length-we],G.push({command:Mr.addLayer,args:[ce[ve],We]}),fe.splice(fe.length-we,0,ve),Te[ve]=!0);for(we=0;we<X.length;we++)if(ve=X[we],be=re[ve],Ce=ce[ve],!Te[ve]&&!s.by(be,Ce))if(s.by(be.source,Ce.source)&&s.by(be["source-layer"],Ce["source-layer"])&&s.by(be.type,Ce.type)){for(ke in kl(be.layout,Ce.layout,G,ve,null,Mr.setLayoutProperty),kl(be.paint,Ce.paint,G,ve,null,Mr.setPaintProperty),s.by(be.slot,Ce.slot)||G.push({command:Mr.setSlot,args:[ve,Ce.slot]}),s.by(be.filter,Ce.filter)||G.push({command:Mr.setFilter,args:[ve,Ce.filter]}),s.by(be.minzoom,Ce.minzoom)&&s.by(be.maxzoom,Ce.maxzoom)||G.push({command:Mr.setLayerZoomRange,args:[ve,Ce.minzoom,Ce.maxzoom]}),be)be.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&ke!=="slot"&&(ke.indexOf("paint.")===0?kl(be[ke],Ce[ke],G,ve,ke.slice(6),Mr.setPaintProperty):s.by(be[ke],Ce[ke])||G.push({command:Mr.setLayerProperty,args:[ve,ke,Ce[ke]]}));for(ke in Ce)Ce.hasOwnProperty(ke)&&!be.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&ke!=="slot"&&(ke.indexOf("paint.")===0?kl(be[ke],Ce[ke],G,ve,ke.slice(6),Mr.setPaintProperty):s.by(be[ke],Ce[ke])||G.push({command:Mr.setLayerProperty,args:[ve,ke,Ce[ke]]}))}else G.push({command:Mr.removeLayer,args:[ve]}),We=fe[fe.lastIndexOf(ve)+1],G.push({command:Mr.addLayer,args:[Ce,We]})}(F,E.layers,R)}catch(L){console.warn("Unable to compute style diff:",L),R=[{command:Mr.setStyle,args:[E]}]}return R}(this.serialize(),t).filter(w=>!(w.command in vu));if(c.length===0)return!1;const m=c.filter(w=>!(w.command in Bm));if(m.length>0)throw new Error(`Unimplemented: ${m.map(w=>w.command).join(", ")}.`);const y=[];return c.forEach(w=>{y.push(this[w.command](...w.args))}),n&&Promise.all(y).then(n).catch(n),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[n,c]of t.entries()){if(this.getImage(n))return this.fire(new s.y(new Error(`An image with the name "${n.name}" already exists.`)));this.imageManager.addImage(n,this.scope,c),this._changes.updateImage(n,this.scope)}return this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this}addImage(t,n){return this.getImage(t)?this.fire(new s.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,n),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this)}updateImage(t,n,c=!1){this.imageManager.updateImage(t,this.scope,n),c&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new s.z("data",{dataType:"style"})),this}addModel(t,n,c={}){return this._checkLoaded(),this._validate(je,`models.${t}`,n,null,c)||(this.modelManager.addModel(t,n,this.scope),this.fire(new s.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,n,c={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(Rr,`sources.${t}`,n,null,c))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const m=wc(t,n,this.dispatcher,this);m.scope=this.scope,m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(m.id),source:m.serialize(),sourceId:m.id}));const y=w=>{const E=(w?"symbol:":"other:")+m.id,R=s.B(E,this.scope),L=this._sourceCaches[E]=new Oa(R,m,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[m.id]=L,L.onAdd(this.map)};y(!1),n.type!=="vector"&&n.type!=="geojson"||y(!0),m.onAdd&&m.onAdd(this.map),c.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const n=this.getOwnSource(t);if(!n)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===t)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const m=Object.entries(this.stylesheet.iconsets).find(([y,w])=>w.type==="source"&&w.source===t);if(m)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while iconset "${m[0]}" is using it.`)))}const c=this.getOwnSourceCaches(t);for(const m of c){const y=s.dl(m.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(m.id),m.fire(new s.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,n){this._checkLoaded(),this.getOwnSource(t).setData(n),this._changes.setDirty()}getOwnSource(t){const n=this.getOwnSourceCache(t);return n&&n.getSource()}getOwnSources(){const t=[];for(const n in this._otherSourceCaches){const c=this.getOwnSourceCache(n);c&&t.push(c.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const n in t){const c=t[n]._tiles;for(const m in c){const y=c[m];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const y of t){if(this._validate(xs,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(y),w.updateTransitions(n)}else this.ambientLight=new Ft(y,mn||(mn=new s.a9({color:new s.aa(s.a6.properties_light_ambient.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(y),w.updateTransitions(n)}else this.directionalLight=new Ft(y,Yr||(Yr=new s.a9({direction:new s.ap(s.a6.properties_light_directional.direction),color:new s.aa(s.a6.properties_light_directional.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_directional.intensity),"cast-shadows":new s.aa(s.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new s.aa(s.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.aa(s.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const c=Object.assign(n,{worldview:this.map.getWorldview()}),m=new s.ac(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(m),this.directionalLight&&this.directionalLight.recalculate(m),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,n=this.ambientLight;if(!t||!n)return;const c=j=>.2126*(j[0]<=.03928?j[0]/12.92:Math.pow((j[0]+.055)/1.055,2.4))+.7152*(j[1]<=.03928?j[1]/12.92:Math.pow((j[1]+.055)/1.055,2.4))+.0722*(j[2]<=.03928?j[2]/12.92:Math.pow((j[2]+.055)/1.055,2.4)),m=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),y=t.properties.get("intensity"),w=t.properties.get("direction"),E=1-s.d3(w.x,w.y,w.z)[2]/90,R=c(m)*y*E,L=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),P=n.properties.get("intensity"),F=c(L)*P;return Number(((R+F)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(s.dm(t)){const n=s.dn(t),c=this.fragments.find(({id:y})=>y===n);if(!c)return;const m=s.dl(t);return c.style.getFragmentStyle(m)}{const n=this.fragments.find(({id:c})=>c===t);return n?n.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const n={},c=(m,y="")=>`${m}::${y}`;this._featuresetSelectors={};for(const m in t){const y=this._featuresetSelectors[m]=[];for(const w of t[m].selectors){if(w.featureNamespace){const R=this.getOwnLayer(w.layer);if(!R){s.w(`Layer is undefined for selector: ${w.layer}`);continue}const L=c(R.source,R.sourceLayer);if(L in n&&n[L]!==w.featureNamespace){s.w(`"featureNamespace ${w.featureNamespace} of featureset ${m}'s selector is not associated to the same source, skip this selector`);continue}n[L]=w.featureNamespace}let E;if(w.properties)for(const R in w.properties){const L=s.U(w.properties[R]);L.result==="success"&&(E=E||{},E[R]=L.value)}y.push({layerId:w.layer,namespace:w.featureNamespace,properties:E,uniqueFeatureID:w._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const n=this.getFragmentStyle(t);if(!n||!n.stylesheet.featuresets)return[];const c=[];for(const m in n.stylesheet.featuresets)c.push({featuresetId:m,importId:n.scope?n.scope:void 0});return c}getFeaturesetLayers(t,n){const c=this.getFragmentStyle(n),m=c.stylesheet.featuresets;if(!m||!m[t])return this.fire(new s.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const y=[];for(const w of m[t].selectors){const E=c.getOwnLayer(w.layer);E&&y.push(E)}return y}getConfigProperty(t,n){const c=this.getFragmentStyle(t);if(!c)return null;const m=s.B(n,c.scope),y=c.options.get(m),w=y?y.value||y.default:null;return w?w.serialize():null}setConfigProperty(t,n,c){const m=this.getFragmentStyle(t);if(!m)return;const y=m.stylesheet.schema;if(!y||!y[n])return;const w=s.U(c);if(w.result!=="success")return void Wl(this,w.value);const E=w.value.expression,R=s.B(n,m.scope),L=m.options.get(R);if(!L)return;let P;const{minValue:F,maxValue:j,stepValue:H,type:$,values:G}=y[n],te=s.U(y[n].default);te.result==="success"&&(P=te.value.expression),P?(this.options.set(R,Object.assign({},L,{value:E,default:P,minValue:F,maxValue:j,stepValue:H,type:$,values:G})),this.updateConfigDependencies(n)):this.fire(new s.y(new Error(`No schema defined for the config option "${n}" in the "${t}" fragment.`)))}getConfig(t){const n=this.getFragmentStyle(t);if(!n)return null;const c=n.stylesheet.schema;if(!c)return null;const m={};for(const y in c){const w=s.B(y,n.scope),E=n.options.get(w),R=E?E.value||E.default:null;m[y]=R?R.serialize():null}return m}setConfig(t,n){const c=this.getFragmentStyle(t);c&&(c.updateConfig(n,c.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const n=this.getFragmentStyle(t);return n?n.stylesheet.schema:null}setSchema(t,n){const c=this.getFragmentStyle(t);c&&(c.stylesheet.schema=n,c.updateConfig(c._config,n),this.updateConfigDependencies())}updateConfig(t,n){if(this._config=t,t||n)if(n)for(const c in n){let m,y;const w=s.U(n[c].default);if(w.result==="success"&&(m=w.value.expression),t&&t[c]!==void 0){const j=s.U(t[c]);j.result==="success"&&(y=j.value.expression)}const{minValue:E,maxValue:R,stepValue:L,type:P,values:F}=n[c];if(m){const j=s.B(c,this.scope);this.options.set(j,{default:m,value:y,minValue:E,maxValue:R,stepValue:L,type:P,values:F})}else this.fire(new s.y(new Error(`No schema defined for config option "${c}".`)))}else this.fire(new s.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const n of this._configDependentLayers){const c=this.getLayer(n);if(c){if(t&&!c.configDependencies.has(t))continue;c.possiblyEvaluateVisibility(),this._updateLayer(c)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(n=>{const c=n._styleColorTheme.colorThemeOverride?n._styleColorTheme.colorThemeOverride:n._styleColorTheme.colorTheme;if(c){const m=n._evaluateColorThemeData(c);(!n._styleColorTheme.lut&&m!==""||n._styleColorTheme.lut&&m!==n._styleColorTheme.lut.data)&&n.setColorTheme(c)}}),this._changes.setDirty()}addLayer(t,n,c={}){this._checkLoaded();const m=t.id;if(this._layers[m])return void this.fire(new s.y(new Error(`Layer with id "${m}" already exists on this map`)));let y;if(t.type==="custom"){if(Wl(this,s.dp(t)))return;y=s.dq(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=s.dk(t),t=Object.assign(t,{source:m})),this._validate(He,`layers.${m}`,t,{arrayIndex:-1},c))return;y=s.dq(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}})}y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid);let w=this._order.length;if(n){const P=this._order.indexOf(n);if(P===-1)return void this.fire(new s.y(new Error(`Layer with id "${n}" does not exist on this map.`)));y.slot===this._layers[n].slot?w=P:s.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,m),this._layerOrderChanged=!0,this._layers[m]=y;const E=this.getOwnLayerSourceCache(y),R=!!this.directionalLight&&this.directionalLight.shadowsEnabled();E&&y.canCastShadows()&&R&&(E.castsShadows=!0);const L=this._changes.getRemovedLayer(y);if(L&&y.source&&E&&y.type!=="custom"){this._changes.discardLayerRemoval(y);const P=s.B(y.source,y.scope);L.type!==y.type?this._changes.updateSourceCache(P,"clear"):(this._changes.updateSourceCache(P,"reload"),E.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(t,n){this._checkLoaded();const c=this._checkLayer(t);if(!c||t===n)return;const m=this._order.indexOf(t);this._order.splice(m,1);let y=this._order.length;if(n){const w=this._order.indexOf(n);if(w===-1)return void this.fire(new s.y(new Error(`Layer with id "${n}" does not exist on this map.`)));c.slot===this._layers[n].slot?y=w:s.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const n=this._checkLayer(t);if(!n)return;n.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);const m=this.getOwnLayerSourceCache(n);if(m&&m.castsShadows){let y=!1;for(const w in this._layers)if(this._layers[w].source===n.source&&this._layers[w].canCastShadows()){y=!0;break}m.castsShadows=y}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const n in this._layers)if(this._layers[n].type===t)return!0;return!1}setLayerZoomRange(t,n,c){this._checkLoaded();const m=this._checkLayer(t);m&&(m.minzoom===n&&m.maxzoom===c||(n!=null&&(m.minzoom=n),c!=null&&(m.maxzoom=c),this._updateLayer(m)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,n){this._checkLoaded();const c=this._checkLayer(t);c&&c.slot!==n&&(c.slot=n,this._updateLayer(c))}setFilter(t,n,c={}){this._checkLoaded();const m=this._checkLayer(t);if(m&&!s.by(m.filter,n))return n==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(J,`layers.${m.id}.filter`,n,{layerType:m.type},c)||(m.filter=s.dk(n),this._updateLayer(m)))}getFilter(t){const n=this._checkLayer(t);if(n)return s.dk(n.filter)}setLayoutProperty(t,n,c,m={}){this._checkLoaded();const y=this._checkLayer(t);if(y&&!s.by(y.getLayoutProperty(n),c)){if(c!=null&&(!m||m.validate!==!1)&&Wl(y,me.call(br,{key:`layers.${t}.layout.${n}`,layerType:y.type,objectKey:n,value:c,styleSpec:s.a6,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(n,c),y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),this._updateLayer(y)}}getLayoutProperty(t,n){const c=this._checkLayer(t);if(c)return c.getLayoutProperty(n)}setPaintProperty(t,n,c,m={}){this._checkLoaded();const y=this._checkLayer(t);if(!y||s.by(y.getPaintProperty(n),c)||c!=null&&(!m||m.validate!==!1)&&Wl(y,ie.call(br,{key:`layers.${t}.paint.${n}`,layerType:y.type,objectKey:n,value:c,styleSpec:s.a6})))return;const w=y.setPaintProperty(n,c);y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),w&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(t,n){const c=this._checkLayer(t);if(c)return c.getPaintProperty(n)}setFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:R,importId:L}=t.target,P=this.getFragmentStyle(L),F=P.getFeaturesetLayers(R);for(const{source:j,sourceLayer:H}of F)P.setFeatureState({id:t.id,source:j,sourceLayer:H},n)}else if("layerId"in t.target){const{layerId:R}=t.target,L=this.getLayer(R);this.setFeatureState({id:t.id,source:L.source,sourceLayer:L.sourceLayer},n)}return}const c=t.source,m=t.sourceLayer,y=this._checkSource(c);if(!y)return;const w=y.type;if(w==="geojson"&&m)return void this.fire(new s.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!m)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided.")));const E=this.getOwnSourceCaches(c);for(const R of E)R.setFeatureState(m,t.id,n)}removeFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:R,importId:L}=t.target,P=this.getFragmentStyle(L),F=P.getFeaturesetLayers(R);for(const{source:j,sourceLayer:H}of F)P.removeFeatureState({id:t.id,source:j,sourceLayer:H},n)}else if("layerId"in t.target){const{layerId:R}=t.target,L=this.getLayer(R);this.removeFeatureState({id:t.id,source:L.source,sourceLayer:L.sourceLayer},n)}return}const c=t.source,m=this._checkSource(c);if(!m)return;const y=m.type,w=y==="vector"?t.sourceLayer:void 0;if(y==="vector"&&!w)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new s.y(new Error("A feature id is required to remove its specific state property.")));const E=this.getOwnSourceCaches(c);for(const R of E)R.removeFeatureState(w,t.id,n)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let y;if("featuresetId"in t.target){const{featuresetId:w,importId:E}=t.target,R=this.getFragmentStyle(E),L=R.getFeaturesetLayers(w);for(const{source:P,sourceLayer:F}of L){const j=R.getFeatureState({id:t.id,source:P,sourceLayer:F});if(j&&!y)y=j;else if(!s.by(y,j))return void this.fire(new s.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:w}=t.target,E=this.getLayer(w);y=this.getFeatureState({id:t.id,source:E.source,sourceLayer:E.sourceLayer})}return y}const n=t.source,c=t.sourceLayer,m=this._checkSource(n);if(m){if(m.type!=="vector"||c)return t.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(c,t.id);this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),n=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return s.dr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateFilteredLayers(t){for(const n of Object.values(this._mergedLayers))t(n)&&this._updateLayer(n)}_updateLayer(t){this._changes.updateLayer(t);const n=this.getLayerSourceCache(t),c=s.B(t.source,t.scope),m=this._changes.getUpdatedSourceCaches();t.source&&!m[c]&&n&&n.getSource().type!=="raster"&&(this._changes.updateSourceCache(c,"reload"),n.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const n=E=>this._mergedLayers[E].is3D(!!this.terrain),c=this.order,m={},y=[];for(let E=c.length-1;E>=0;E--){const R=c[E];if(n(R)){m[R]=E;for(const L of t){const P=L[R];if(P)for(const F of P)y.push(F)}}}y.sort((E,R)=>R.intersectionZ-E.intersectionZ);const w=[];for(let E=c.length-1;E>=0;E--){const R=c[E];if(n(R))for(let L=y.length-1;L>=0;L--){const P=y[L].feature;if(P.layer&&m[P.layer.id]<E)break;w.push(P),y.pop()}else for(const L of t){const P=L[R];if(P)for(const F of P)w.push(F.feature)}}return w}queryRasterValue(t,n,c){const m=this.getOwnSource(t);return m?m.type!=="raster-array"?(this.fire(new s.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):m.queryRasterArrayValue(n,c):(this.fire(new s.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,n,c){let m;n&&!Array.isArray(n)&&n.filter&&(this._validate(J,"queryRenderedFeatures.filter",n.filter,null,n),m=s.b6(n.filter));const y={},w=P=>{if(Xl.has(P.type))return;const F=this.getOwnLayerSourceCache(P),j=y[F.id]=y[F.id]||{sourceCache:F,layers:{},has3DLayers:!1};P.is3D(!!this.terrain)&&(j.has3DLayers=!0),j.layers[P.fqid]=j.layers[P.fqid]||{styleLayer:P,targets:[]},j.layers[P.fqid].targets.push({filter:m})};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new s.y(new Error("parameters.layers must be an Array."))),[];for(const P of n.layers){const F=this._layers[P];if(!F)return this.fire(new s.y(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];w(F)}}else for(const P in this._layers)w(this._layers[P]);const E=this._queryRenderedFeatures(t,y,c),R=this._flattenAndSortRenderedFeatures(E),L=[];for(const P of R)s.ds(P.layer.id)===this.scope&&L.push(P);return L}queryRenderedFeatureset(t,n,c){let m;n&&!Array.isArray(n)&&n.filter&&(this._validate(J,"queryRenderedFeatures.filter",n.filter,null,n),m=s.b6(n.filter));const y="mock",w=[];if(n&&n.target)w.push(Object.assign({},n,{targetId:y,filter:m}));else{const P=this.getFeaturesetDescriptors();for(const F of P)w.push({targetId:y,filter:m,target:F});for(const{style:F}of this.fragments){const j=F.getFeaturesetDescriptors();for(const H of j)w.push({targetId:y,filter:m,target:H})}}const E=this.queryRenderedTargets(t,w,c),R=[],L=new Set;for(const P of E)for(const F of P.variants[y])Bo(F,P,L)||R.push(new s.dt(P,F));return R}queryRenderedTargets(t,n,c){const m={},y=(E,R,L,P)=>{const F=m[R.id]=m[R.id]||{sourceCache:R,layers:{},has3DLayers:!1};if(F.layers[E.fqid]=F.layers[E.fqid]||{styleLayer:E,targets:[]},E.is3D(!!this.terrain)&&(F.has3DLayers=!0),!P)return L.uniqueFeatureID=!1,void F.layers[E.fqid].targets.push(L);F.layers[E.fqid].targets.push(Object.assign({},L,{namespace:P.namespace,properties:P.properties,uniqueFeatureID:P.uniqueFeatureID}))};for(const E of n)if("featuresetId"in E.target){const{featuresetId:R,importId:L}=E.target,P=this.getFragmentStyle(L);if(!P||!P._featuresetSelectors)continue;const F=P._featuresetSelectors[R];if(!F){this.fire(new s.y(new Error(`The featureset '${R}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const j of F){const H=P.getOwnLayer(j.layerId);H&&!Xl.has(H.type)&&y(H,P.getOwnLayerSourceCache(H),E,j)}}else if("layerId"in E.target){const{layerId:R}=E.target,L=this.getLayer(R);if(!L||Xl.has(L.type))continue;y(L,this.getLayerSourceCache(L),E)}const w=this._queryRenderedFeatures(t,m,c);return this._flattenAndSortRenderedFeatures(w)}_queryRenderedFeatures(t,n,c){const m=[],y=!!this.map._showQueryGeometry,w=Qt.createFromScreenPoints(t,c);for(const E in n){const R=ad(w,n[E],this._availableImages,c,y);Object.keys(R).length&&m.push(R)}if(this.placement)for(const E in n){if(!n[E].sourceCache._onlySymbols)continue;const R=$a(w.screenGeometry,n[E],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(R).length&&m.push(R)}return m}querySourceFeatures(t,n){const c=n&&n.filter;c&&this._validate(J,"querySourceFeatures.filter",c,null,n);let m=[];const y=this.getOwnSourceCaches(t);for(const w of y)m=m.concat(xo(w,n));return m}addSourceType(t,n,c){return Xs.getSourceType(t)?c(new Error(`A source type called "${t}" already exists.`)):(Xs.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},c):c(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,n,c={}){this._checkLoaded();const m=this.light.getLight();let y=!1;for(const E in t)if(!s.by(t[E],m[E])){y=!0;break}if(!y)return;const w=this._getTransitionParameters();this.light.setLight(t,n,c),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,n=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),n===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let c=t;const m=t.source==null;if(n===1){if(this.disableElevatedTerrain)return;if(typeof c.source=="object"){const E="terrain-dem-src";this.addSource(E,c.source),c=s.dk(c),c=Object.assign(c,{source:E})}const y=Object.assign({},c),w={};if(this.terrain&&m){y.source=this.terrain.get().source;const E=this.terrain?this.getFragmentStyle(this.terrain.scope):null;E&&(w.style=E.serialize())}if(this._validate(Ct,"terrain",y,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!m||this.terrain&&n!==this.terrain.drapeRenderMode){if(!c)return;this._createTerrain(c,n),this.fire(new s.z("data",{dataType:"style"}))}else{const y=this.terrain,w=y.get();for(const E of Object.keys(s.a6.terrain))!c.hasOwnProperty(E)&&s.a6.terrain[E].default&&(c[E]=s.a6.terrain[E].default);for(const E in t)if(!s.by(t[E],w[E])){y.set(t,this.options),this.stylesheet.terrain=t;const R=this._getTransitionParameters({duration:0});y.updateTransitions(R),this.fire(new s.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const n=this.fog=new cr(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}_createSnow(t){const n=this.snow=new Ve(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}_createRain(t){const n=this.rain=new wt(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!s.by(n.get(),t)){n.set(t,this.options),this.stylesheet.fog=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const n=this.snow;if(!s.by(n.get(),t)){n.set(t,this.options),this.stylesheet.snow=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const n=this.rain;if(!s.by(n.get(),t)){n.set(t,this.options),this.stylesheet.rain=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const m in this._layers)this._layers[m].lut=this._styleColorTheme.lut;for(const m in this._sourceCaches)this._sourceCaches[m].clearTiles()},n=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!n)return this._styleColorTheme.lut=null,void t();const c=this._evaluateColorThemeData(n);this._loadColorTheme(c).then(()=>{this.fire(new s.z("colorthemeset")),t()}).catch(m=>{s.w(`Couldn't set color theme: ${m}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,n){const c=this.getFragmentStyle(t);c&&(c._styleColorTheme.colorThemeOverride=n,c._reloadColorTheme())}_getTransitionParameters(t){return{now:s.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],n=[];for(const c of this._mergedOrder)this.isLayerDraped(this._mergedLayers[c])?t.push(c):n.push(c);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...n)}_createTerrain(t,n){const c=this.terrain=new Je(t,n,this.scope,this.options,this.map.getWorldview());n===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}_force3DLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="fill-extrusion"&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="symbol"&&this._updateLayer(n)}}_validate(t,n,c,m,y={}){if(y&&y.validate===!1)return!1;const w=Object.assign({},this.serialize());return Wl(this,t.call(br,Object.assign({key:n,style:w,value:c,styleSpec:s.a6},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.du.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const n=this.getSourceCaches(t);for(const c of n)c.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const n=this._mergedLayers[t];n._clear&&n._clear()}}reloadSource(t){const n=this.getSourceCaches(t);for(const c of n)c.resume(),c.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let n;this.directionalLight&&(n=xu(this.directionalLight));const c=new Set;for(const m in this._mergedLayers){const y=this._mergedLayers[m];y.hasElevation()&&!c.has(y.source)&&c.add(y.source)}for(const m in this._mergedSourceCaches){const y=this._mergedSourceCaches[m],w=c.has(y._source.id);y.update(t,void 0,void 0,n,w)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const n=this._sourceCaches[t];n.resume(),n.reload()}}_updatePlacement(t,n,c,m,y,w,E=!1){let R=!1,L=!1;const P={},F={};for(const j of this._mergedOrder){const H=this._mergedLayers[j];if(H.type!=="symbol")continue;const $=s.B(H.source,H.scope);let G=P[$];if(!G){const X=this.getLayerSourceCache(H);if(!X)continue;const re=X.getRenderableIds(!0).map(ce=>X.getTileByID(ce));F[$]=re.slice(),G=P[$]=re.sort((ce,fe)=>fe.tileID.overscaledZ-ce.tileID.overscaledZ||(ce.tileID.isLessThan(fe.tileID)?-1:1))}const te=this.crossTileSymbolIndex.addLayer(H,G,n.center.lng,n.projection);R=R||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),E=E||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new s.z("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.o.now(),n.zoom))&&(this.pauseablePlacement=new ca(n,this._mergedOrder,E,c,m,y,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,P,F,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.o.now()),L=!0),R&&this.pauseablePlacement.placement.setStale()),L||R){this._buildingIndex.onNewFrame(n.zoom);for(let j=0;j<this._mergedOrder.length;j++){const H=this._mergedLayers[this._mergedOrder[j]];if(H.type!=="symbol")continue;const $=this.isLayerClipped(H);this.placement.updateLayerOpacities(H,P[s.B(H.source,H.scope)],j,$?w:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,n){this._checkLoaded();const c=this.stylesheet.imports=this.stylesheet.imports||[];if(c.findIndex(({id:y})=>y===t.id)!==-1)return void this.fire(new s.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!n)return c.push(t),this._loadImports([t],!0);const m=c.findIndex(({id:y})=>y===n);return m===-1&&this.fire(new s.y(new Error(`Import with id "${n}" does not exist on this map.`))),this.stylesheet.imports=c.slice(0,m).concat(t).concat(c.slice(m)),this._loadImports([t],!0,n)}updateImport(t,n){this._checkLoaded();const c=this.stylesheet.imports||[],m=this.getImportIndex(t);return m===-1?this:typeof n=="string"?(this.setImportUrl(t,n),this):(n.url&&n.url!==c[m].url&&this.setImportUrl(t,n.url),s.by(n.config,c[m].config)||this.setImportConfig(t,n.config,n.data.schema),s.by(n.data,c[m].data)||this.setImportData(t,n.data),this)}moveImport(t,n){this._checkLoaded();let c=this.stylesheet.imports||[];const m=this.getImportIndex(t);if(m===-1)return this;const y=this.getImportIndex(n);if(y===-1)return this;const w=c[m],E=this.fragments[m];return c=c.filter(({id:R})=>R!==t),this.fragments=this.fragments.filter(({id:R})=>R!==t),this.stylesheet.imports=c.slice(0,y).concat(w).concat(c.slice(y)),this.fragments=this.fragments.slice(0,y).concat(E).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(t,n){this._checkLoaded();const c=this.stylesheet.imports||[],m=this.getImportIndex(t);if(m===-1)return this;c[m].url=n;const y=this.fragments[m];return y.style=this._createFragmentStyle(c[m]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(n),this}setImportData(t,n){this._checkLoaded();const c=this.getImportIndex(t),m=this.stylesheet.imports||[];return c===-1?this:n?(this.fragments[c].style.setState(n),this._reloadImports(),this):(delete m[c].data,this.setImportUrl(t,m[c].url))}setImportConfig(t,n,c){this._checkLoaded();const m=this.getImportIndex(t),y=this.stylesheet.imports||[];if(m===-1)return this;n?y[m].config=n:delete y[m].config;const w=this.fragments[m];c&&w.style.stylesheet&&(w.style.stylesheet.schema=c);const E=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=n,w.style.updateConfig(n,E),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const n=this.stylesheet.imports||[],c=this.getImportIndex(t);c!==-1&&(n.splice(c,1),this.fragments[c].style._remove(),this.fragments.splice(c,1),this._reloadImports())}getImportIndex(t){const n=(this.stylesheet.imports||[]).findIndex(c=>c.id===t);return n===-1&&this.fire(new s.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),n}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const n in this._mergedOtherSourceCaches){const c=this._mergedOtherSourceCaches[n];c&&t.push(c.getSource())}return t}getSource(t,n){const c=this.getSourceCache(t,n);return c&&c.getSource()}getLayerSource(t){const n=this.getLayerSourceCache(t);return n&&n.getSource()}getSourceCache(t,n){const c=s.B(t,n);return this._mergedOtherSourceCaches[c]}getLayerSourceCache(t){const n=s.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const n=[];return this._mergedOtherSourceCaches[t]&&n.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&n.push(this._mergedSymbolSourceCaches[t]),n}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const n in t){const c=t[n];c==="reload"?this.reloadSource(n):c==="clear"&&this.clearSource(n)}}updateLayers(t){const n=this._changes.getUpdatedPaintProperties();for(const c of n){const m=this.getLayer(c);m&&m.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,n,c){this.imageManager.getImages(n.images,n.scope,c),this._updateTilesForChangedImages();const m=w=>{if(w){const E=n.images.map(R=>s.I.toString(R));w.setDependencies(n.tileID.key,n.type,E)}},y=s.B(n.source,n.scope);m(this._mergedOtherSourceCaches[y]),m(this._mergedSymbolSourceCaches[y]),n.images.some(w=>w.iconsetId)&&this.fire(new s.z("data",{dataType:"style"}))}rasterizeImages(t,n,c){this.imageManager.rasterizeImages(n,c)}getGlyphs(t,n,c){this.glyphManager.getGlyphs(n.stacks,c)}getResource(t,n,c){return s.dv(n,c)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const n=[];return this._otherSourceCaches[t]&&n.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&n.push(this._symbolSourceCaches[t]),n}_isSourceCacheLoaded(t){const n=this.getOwnSourceCaches(t);return n.length===0?(this.fire(new s.y(new Error(`There is no source with ID '${t}'`))),!1):n.every(c=>c.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,n){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const c=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),m=t.type==="building";if(t.is3D(!!this.terrain)){if(c||m||n&&n.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Xs.getSourceType=function(u){return oh[u]},Xs.setSourceType=function(u,t){oh[u]=t},Xs.registerForPluginStateChange=s.dw;class Mp{execute(t){const n=this._makeBuildingsQueryArea(t),c=this._makeFloorsQueryArea(t),m=t.queryRenderedFeatures(n).reduce((L,P)=>{const F=P.properties.id;return P.properties.type!=="building"||L.some(j=>j.properties.id===F)||L.push(P),L},[]),y=t.queryRenderedFeatures(c).reduce((L,P)=>{const F=P.properties.id;return P.properties.type!=="floor"||L.some(j=>j.properties.id===F)||L.push(P),L},[]),w=[t.getCenter().lng,t.getCenter().lat],E=this._findBuildingAtCenter(w,m),R=m.length>0?m[0]:null;return{floors:y.map(L=>({id:L.properties.id,name:L.properties.name,isDefault:L.properties.is_default,zIndex:L.properties.z_index,connectedFloorIds:L.properties.connected_floor_ids,conflictedFloorIds:L.properties.conflicted_floor_ids,buildingIds:L.properties.building_ids})),building:E?{id:E.properties.id,name:E.properties.name}:{id:R.properties.id,name:R.properties.name}}}_makeBuildingsQueryArea(t){const n=t.transform.width,c=t.transform.height,m=Math.min(n,c)*(1/8),y=.5*(n-m),w=.5*(c-m);return[new s.P(y,w),new s.P(y+m,w+m)]}_makeFloorsQueryArea(t){const n=t.transform.width,c=t.transform.height;return[new s.P(0,0),new s.P(n,c)]}_findBuildingAtCenter(t,n){for(const c of n)if(c.geometry.type==="Polygon"&&this._pointInPolygon(t,c.geometry.coordinates[0]))return c;return null}_pointInPolygon(t,n){let c=!1;for(let m=0,y=n.length-1;m<n.length;y=m++){const w=n[m][0],E=n[m][1],R=n[y][1];E>t[1]!=R>t[1]&&t[0]<(n[y][0]-w)*(t[1]-E)/(R-E)+w&&(c=!c)}return c}}class Ip{constructor(){this._floors=new Map,this._buildings=new Map}append(t){const n=t.building;let c=!1;if(n){const m=n.id;m&&(this._buildings.set(m,n),c||this._buildings.has(m)||(c=!0))}return t.floors.forEach(m=>{const y=m.id;c||this._floors.has(y)||(c=!0),this._floors.set(y,m)}),c}clear(){this._floors.clear(),this._buildings.clear()}getFloors(t=null){const n=Array.from(this._floors.values());return t?n.filter(c=>{const m=c.buildingIds;return!!m&&m.split(";").includes(t)}):n}}class zp{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage=new Ip}setIndoorData(t){const n=this._featuresStorage.append(t);return this._selectedBuildingId=t.building?t.building.id:null,n}setFloorId(t){const n=this._selectedFloorId!==t;return n&&(this._selectedFloorId=t),n}getCurrentBuildingSelection(){if(!this._selectedBuildingId)return{selectedFloorId:null,floors:[]};const t=this._featuresStorage.getFloors(this._selectedBuildingId),n=this.getActiveFloors().find(c=>{const m=c.buildingIds;if(!m)return!1;const y=m.split(";");return!!this._selectedBuildingId&&y.includes(this._selectedBuildingId)});return{selectedFloorId:n?n.id:null,floors:t}}getActiveFloors(t=!1){const n=this._featuresStorage.getFloors(),c=n.find(R=>R.id===this._selectedFloorId),m=n.filter(R=>R.isDefault===!0);let y=[];if(c)return y=this._calculateCurrentActiveFloors(n,c,m,t),y;if(m.length===0){const R=this._featuresStorage.getFloors(this._selectedBuildingId);y=R.length>0?[R[0]]:[]}else y=m;const w=this._getNonConflictingLastActiveFloors(y),E=[...y,...w];return this._lastActiveFloors=E,E}hasBuildingChanged(t){return this._selectedBuildingId!==(t.building?t.building.id:null)}hasActiveBuilding(){return this._selectedBuildingId!==null}isEmpty(){return this._selectedFloorId===null&&this._selectedBuildingId===null&&this._lastActiveFloors.length===0}_calculateCurrentActiveFloors(t,n,c,m){if(!n)return this._getNonConflictingDefaultFloors(this._lastActiveFloors,c);const y=this._getConnectedFloors(n,t);return m?this._buildExplicitSelectionFloors(n,y,c):this._buildImplicitSelectionFloors(y,c)}_getConnectedFloors(t,n){const c=t.connectedFloorIds;if(!c)return[];const m=new Set(c.split(";"));return n.filter(y=>m.has(y.id))}_buildExplicitSelectionFloors(t,n,c){const m=[t,...n],y=this._getNonConflictingLastActiveFloors(m),w=[...m,...y],E=this._deduplicateFloors(w),R=this._getConflictingFloorIdsFrom(E),L=c.filter(F=>!R.has(F.id)),P=[...E,...L];return this._lastActiveFloors=P,P}_buildImplicitSelectionFloors(t,n){const c=this._getConflictingFloorIdsFrom(this._lastActiveFloors),m=n.filter(w=>!c.has(w.id)),y=this._deduplicateFloors([...this._lastActiveFloors,...m]);return this._lastActiveFloors=y,y}_getNonConflictingDefaultFloors(t,n){const c=this._getConflictingFloorIdsFrom(t),m=n.filter(w=>!c.has(w.id)),y=this._deduplicateFloors([...t,...m]);return this._lastActiveFloors=y,y}_deduplicateFloors(t){const n=new Set;return t.filter(c=>{const m=c.id;return!n.has(m)&&(n.add(m),!0)})}_getConflictingFloorIdsFrom(t){const n=new Set;return t.forEach(c=>{const m=c.conflictedFloorIds;m&&m.split(";").forEach(y=>n.add(y))}),n}_getNonConflictingLastActiveFloors(t){if(!this._lastActiveFloors||this._lastActiveFloors.length===0)return[];const n=new Set(t.map(m=>m.id)),c=this._getConflictingFloorIdsFrom(t);return this._lastActiveFloors.filter(m=>{const y=m.id;return!n.has(y)&&!c.has(y)})}_isFloorConflicted(t,n){const c=t.id;return n.some(m=>{const y=m.conflictedFloorIds;return!!y&&y.split(";").includes(c)})}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage.clear()}}class bu extends s.E{constructor(t){super(),s.aY(["_onLoad","_onMove"],this),this._map=t,this._floorSelectionState=new zp,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.off("load",this._onLoad),this._map.off("move",this._onMove),this._map=null,this._floorSelectionState=null}selectFloor(t){this._floorSelectionState.setFloorId(t)&&this._updateIndoorConfig(!0)}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new s.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=t.scope,this._indoorDataQuery=new Mp))}),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<15)return void this._clearIndoorData();const t=this._indoorDataQuery.execute(this._map);if(!t||t.floors.length===0||this._map.transform.zoom<16)this._clearIndoorData();else if(this._floorSelectionState.hasBuildingChanged(t)){if(!t.building&&this._floorSelectionState.getActiveFloors().length<=0)return void this._clearIndoorData();this._setIndoorData(t),t.building&&this._updateIndoorSelector()}else this._setIndoorData(t)}_setIndoorData(t){this._floorSelectionState.setIndoorData(t)&&this._updateIndoorConfig()}_clearIndoorData(){this._floorSelectionState.isEmpty()||(this._floorSelectionState.reset(),this._updateIndoorSelector(),this._map.setConfigProperty(this._scope,"activeFloors",["literal",[]]))}_updateIndoorSelector(){const t=this._floorSelectionState.getCurrentBuildingSelection(),n=t.floors.map(c=>({id:c.id,name:c.name,shortName:c.zIndex.toString(),levelOrder:c.zIndex}));this.fire(new s.z("indoorupdate",{selectedFloorId:t.selectedFloorId,floors:n}))}_updateIndoorConfig(t=!1){const n=this._floorSelectionState.getActiveFloors(t).map(c=>c.id)||[];this._map.setConfigProperty(this._scope,"activeFloors",["literal",n])}}var yd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Lp=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,bf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,wu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Tu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,lo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ba=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ys=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,_h=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Vt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,yh=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Lc=[];ms(yd,Lc),ms(bf,Lc),ms(Lp,Lc);const co={"_prelude_fog.vertex.glsl":lo,"_prelude_terrain.vertex.glsl":Tu,"_prelude_shadow.vertex.glsl":Vt,"_prelude_fog.fragment.glsl":Ba,"_prelude_shadow.fragment.glsl":yh,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Ys,"_prelude_raster_particle.glsl":_h},xh={};mr("",Tu),mr(Ba,lo),mr(yh,Vt),mr(Ys,""),mr(_h,"");const Dc=mr(Lp,bf),Fa=yd;var xd={background:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:mr(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:mr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:mr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:mr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:mr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:mr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:mr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:mr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:mr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:mr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:mr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:mr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:mr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:mr(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:mr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:mr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:mr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:mr(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:mr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:mr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,wu),skyboxGradient:mr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,wu),skyboxCapture:mr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:mr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:mr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:mr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:mr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:mr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:mr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:mr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:mr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function ms(u,t){const n=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let c of n)if(c=c.trim(),c[0]==="#"&&c.includes("if")&&!c.includes("endif")){c=c.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const m=c.split(" ");for(const y of m)t.includes(y)||t.push(y)}}function mr(u,t){const n=/#include\s+"([^"]+)"/g,c=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,m={},y=[],w=[];if(u=u.replace(n,(R,L)=>(w.push(L),"")),(t=t.replace(n,(R,L)=>(y.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let E=[...Lc];ms(u,E),ms(t,E);for(const R of[...y,...w])co[R]||console.error(`Undefined include: ${R}`),xh[R]||(xh[R]=[],ms(co[R],xh[R])),E=[...E,...xh[R]];return{fragmentSource:u=u.replace(c,(R,L,P,F,j)=>(m[j]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${P} ${F} ${j};
#else
uniform ${P} ${F} u_${j};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${j}
    ${P} ${F} ${j} = u_${j};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${P} ${F} ${j};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(c,(R,L,P,F,j)=>{const H=F==="float"?"vec2":F,$=j.match(/color/)?"color":H;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${j}
in ${P} ${F} a_${j};
#endif
`:m[j]?L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${P} ${H} a_${j};
out ${P} ${F} ${j};
#else
uniform ${P} ${F} u_${j};
#endif
`:L==="initialize"?$==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${P} ${F} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${$}(a_${j}, u_${j}_t);
#else
    ${P} ${F} ${j} = u_${j};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${P} ${F} a_${j};
    out ${P} ${F} ${j};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${j} = a_${j};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${P} ${H} a_${j};
#else
uniform ${P} ${F} u_${j};
#endif
`:L==="define-instanced"?$==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${j}0;
in vec4 a_${j}1;
in vec4 a_${j}2;
in vec4 a_${j}3;
#else
uniform ${P} ${F} u_${j};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${P} ${H} a_${j};
#else
uniform ${P} ${F} u_${j};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${P} ${F} ${j} = a_${j};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${P} ${F} ${j} = a_${j};
#else
    ${P} ${F} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${P} ${F} ${j} = unpack_mix_${$}(a_${j}, u_${j}_t);
#else
    ${P} ${F} ${j} = u_${j};
#endif
`}),usedDefines:E,vertexIncludes:y,fragmentIncludes:w}}class Uo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,n,c,m,y,w,E,R){this.context=t;let L=this.boundPaintVertexBuffers.length!==m.length;for(let F=0;!L&&F<m.length;F++)this.boundPaintVertexBuffers[F]!==m[F]&&(L=!0);let P=this.boundDynamicVertexBuffers.length!==E.length;for(let F=0;!P&&F<E.length;F++)this.boundDynamicVertexBuffers[F]!==E[F]&&(P=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==c||L||P||this.boundIndexBuffer!==y||this.boundVertexOffset!==w)this.freshBind(n,c,m,y,w,E,R);else{t.bindVertexArrayOES.set(this.vao);for(const F of E)F&&(F.bind(),R&&F.instanceCount&&F.setVertexAttribDivisor(t.gl,n,R));y&&y.dynamicDraw&&y.bind()}}freshBind(t,n,c,m,y,w,E){const R=this.context,L=R.gl;this.vao&&this.destroy(),this.vao=R.gl.createVertexArray(),R.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=w,n.enableAttributes(L,t),n.bind(),n.setVertexAttribPointers(L,t,y);for(const P of c)P.enableAttributes(L,t),P.bind(),P.setVertexAttribPointers(L,t,y);for(const P of w)P&&(P.enableAttributes(L,t),P.bind(),P.setVertexAttribPointers(L,t,y),E&&P.instanceCount&&P.setVertexAttribDivisor(L,t,E));m&&m.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function wf(u,t){const n=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new s.ae(0,c/n).toLngLat().lat,new s.ae(0,(c+1)/n).toLngLat().lat]}function Tf(u,t,n,c,m,y,w){const E=u.context,R=E.gl,L=n.hillshadeFBO;if(!L)return;u.prepareDrawTile();const P=u.isTileAffectedByFog(t),F=u.getOrCreateProgram("hillshade",{overrideFog:P});E.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,L.colorAttachment.get());const j=((te,X,re,ce)=>{const fe=re.paint.get("hillshade-shadow-color"),Te=re.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",we=re.paint.get("hillshade-highlight-color"),Ee=re.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ve=re.paint.get("hillshade-accent-color"),be=re.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ce=re.paint.get("hillshade-emissive-strength");let We=s.an(re.paint.get("hillshade-illumination-direction"));if(re.paint.get("hillshade-illumination-anchor")==="viewport")We-=te.transform.angle;else if(te.style&&te.style.enable3dLights()&&te.style.directionalLight){const ct=te.style.directionalLight.properties.get("direction"),Ze=s.d3(ct.x,ct.y,ct.z);We=s.an(Ze[1])}const ke=!te.options.moving;return{u_matrix:ce||te.transform.calculateProjMatrix(X.tileID.toUnwrapped(),ke),u_image:0,u_latrange:wf(0,X.tileID),u_light:[re.paint.get("hillshade-exaggeration"),We],u_shadow:fe.toPremultipliedRenderColor(Te?null:re.lut),u_highlight:we.toPremultipliedRenderColor(Ee?null:re.lut),u_emissive_strength:Ce,u_accent:ve.toPremultipliedRenderColor(be?null:re.lut)}})(u,n,c,u.terrain?t.projMatrix:null);u.uploadCommonUniforms(E,F,t.toUnwrapped());const{tileBoundsBuffer:H,tileBoundsIndexBuffer:$,tileBoundsSegments:G}=u.getTileBoundsBuffers(n);F.draw(u,R.TRIANGLES,m,y,w,ki.disabled,j,c.id,H,$,G)}function Ua(u,t,n){if(!t.needsDEMTextureUpload)return;const c=u.context,m=c.gl;c.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(n.stride);const y=n.getPixels();t.demTexture?t.demTexture.update(y,{premultiply:!1}):t.demTexture=new s.T(c,y,m.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Eo(u,t,n){const c=u.context,m=c.gl;if(!t.dem)return;const y=t.dem;if(c.activeTexture.set(m.TEXTURE1),Ua(u,t,y),!t.demTexture)return;t.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE);const w=y.dim;c.activeTexture.set(m.TEXTURE0);let E=t.hillshadeFBO;if(!E){const j=new s.T(c,{width:w,height:w,data:null},m.RGBA8);j.bind(m.LINEAR,m.CLAMP_TO_EDGE),E=t.hillshadeFBO=c.createFramebuffer(w,w,!0,"renderbuffer"),E.colorAttachment.set(j.texture)}c.bindFramebuffer.set(E.framebuffer),c.viewport.set([0,0,w,w]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:L,tileBoundsSegments:P}=u.getMercatorTileBoundsBuffers(),F=[];u.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),u.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(u,m.TRIANGLES,ni.disabled,Ii.disabled,ir.unblended,ki.disabled,((j,H)=>{const $=H.stride,G=s.bC();return s.cd(G,0,s.al,-s.al,0,0,1),s.br(G,G,[0,-s.al,0]),{u_matrix:G,u_image:1,u_dimension:[$,$],u_zoom:j.overscaledZ}})(t.tileID,y),n.id,R,L,P),t.needsHillshadePrepare=!1}class cn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class hl extends cn{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Vo extends cn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Su extends cn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Fm extends cn{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Dp extends cn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Pp extends cn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Aa extends cn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ua extends cn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class En extends cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Ho extends cn{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class qo extends cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class vd extends cn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class dl extends cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class Sf extends cn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Pc extends cn{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class fl extends cn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Oc extends cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class jc extends cn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class pl extends cn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Op=class extends cn{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class bd extends cn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class jp extends cn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Yl extends cn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class wd extends cn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Nc extends cn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ef extends cn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Kl extends cn{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Jl extends cn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Td extends cn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class vh extends cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Sd extends cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ql extends cn{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class Np extends Ql{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class kc extends Ql{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Um extends Ql{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class bh extends kc{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const wh=(u,t,n)=>({u_matrix:u,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),Ed=(u,t,n,c,m,y,w,E,R,L,P,F,j,H,$,G)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(c),u_merc_matrix:n,u_zoom_transition:m,u_merc_center:y,u_image0:0,u_frustum_tl:w,u_frustum_tr:E,u_frustum_br:R,u_frustum_bl:L,u_globe_pos:P,u_globe_radius:F,u_viewport:j,u_grid_matrix:G?Float32Array.from(G):new Float32Array(9),u_skirt_height:H,u_far_z_cutoff:$});function Th(u,t){return u!=null&&t!=null&&!(!u.hasData()||!t.hasData())&&u.demTexture!=null&&t.demTexture!=null&&u.tileID.key!==t.tileID.key}const ml=new class{constructor(){this.operations={}}newMorphing(u,t,n,c,m){if(u in this.operations){const y=this.operations[u];y.to.tileID.key!==n.tileID.key&&(y.queued=n)}else this.operations[u]={startTime:c,phase:0,duration:m,from:t,to:n,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const t=this.operations[u];return{from:t.from,to:t.to,phase:t.phase}}update(u){for(const t in this.operations){const n=this.operations[t];for(n.phase=(u-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,u)){delete this.operations[t];break}}}_nextOp(u,t){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=t,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},Xa={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ao(u,t,n){if(t===0)return 0;const c=t<1&&n===514?.25/t:1;return 6*Math.pow(1.5,22-u)*Math.max(t,1)*c}function Bc(u,t){const n=1<<u.z;return!t&&(u.x===0||u.x===n-1)||u.y===0||u.y===n-1}const Fc=u=>({u_matrix:u});function Ya(u,t,n,c,m){if(m>0){const y=s.o.now(),w=(y-u.timeAdded)/m,E=t?(y-t.timeAdded)/m:-1,R=n.getSource(),L=c.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),P=!t||Math.abs(t.tileID.overscaledZ-L)>Math.abs(u.tileID.overscaledZ-L),F=P&&u.refreshedUponExpiration?1:s.aA(P?w:1-E,0,1);return t?{opacity:1,mix:1-F,isFading:w<1}:{opacity:F,mix:0,isFading:w<1}}return{opacity:1,mix:0,isFading:!1}}class gl extends Oa{constructor(t){const n=wc("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",n,!1),n.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,n){t.state="loaded",n(null)}}class kn extends Oa{constructor(t){const n=wc("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,n,c){if(t.freezeTileCoverage)return;this.transform=t;const m=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,w)=>{if(y[w.key]="",!this._tiles[w.key]){const E=new Sc(w,this._source.tileSize*w.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);E.state="loaded",this._tiles[w.key]=E}return y},{});for(const y in this._tiles)y in m||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(t){const n=this.proxyCachedFBO[t];if(n!==void 0){const c=Object.values(n);this.renderCachePool.push(...c),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Eu extends s.aO{constructor(t,n,c){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=n,this.projMatrix=c}}class Ad extends s.dH{constructor(t,n){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[c,m,y]=function(R){const L=new s.bd,P=new s.b1,F=131;L.reserve(17161),P.reserve(33800);const j=s.al/128,H=s.al+j/2,$=H+j;for(let te=-j;te<$;te+=j)for(let X=-j;X<$;X+=j){const re=X<0||X>H||te<0||te>H?24575:0,ce=s.aA(Math.round(X),0,s.al),fe=s.aA(Math.round(te),0,s.al);L.emplaceBack(ce+re,fe)}const G=(te,X)=>{const re=X*F+te;P.emplaceBack(re+1,re,re+F),P.emplaceBack(re+F,re+F+1,re+1)};for(let te=1;te<129;te++)for(let X=1;X<129;X++)G(X,te);return[0,129].forEach(te=>{for(let X=0;X<130;X++)G(X,te),G(te,X)}),[L,P,32768]}(),w=t.context;this.gridBuffer=w.createVertexBuffer(c,s.bf.members),this.gridIndexBuffer=w.createIndexBuffer(m),this.gridSegments=s.bg.simpleSegment(0,0,c.length,m.length),this.gridNoSkirtSegments=s.bg.simpleSegment(0,0,c.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new kn(n.map),this.orthoMatrix=s.bC(),s.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.al,0,s.al,0,1);const E=w.gl;this._overlapStencilMode=new Ii({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new gl(n.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,n,c){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const m=t.terrain.properties,y=t.terrain.drapeRenderMode===0,w=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.o.now();const E=t.terrain&&t.terrain.scope,R=m.get("source"),L=y?this._mockSourceCache:t.getSourceCache(R,E);if(!L)return void s.w(`Couldn't find terrain source "${R}".`);if(this.sourceCache=L,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=w?this.calculateExaggeration(n):m.get("exaggeration"),!n.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;const P=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const F=this.getScaledDemTileSize();this.sourceCache.update(n,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,P(),this._initializing=!0),P(),n.updateElevation(!0,c),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const n=this._previousCameraAltitude,c=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=c;const m=n!=null?c-n:Number.MAX_VALUE;if(Math.abs(m)<2)return this._exaggeration;const y=t.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(y);let E=y-this._previousZoom;const R=this._previousUpdateTimestamp;let L=y;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(y-L)>.5&&(E=.5*(y-L+E)),E*m<0&&(L+=E)),this._evaluationZoom=L;const P=w.getExaggeration(L),F=P===w.getExaggeration(Math.max(0,L-.1));if(F&&Math.abs(P-this._exaggeration)<.01)return P;let j=Math.min(.1,.00375*(this._updateTimestamp-R));return(F||P<.1||Math.abs(E)<1e-4)&&(j=Math.min(.2,4*j)),s.ak(this._exaggeration,P,j)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,c=this.painter.transform;this._initializing&&(this._initializing=c._centerAltitude===0&&this.getAtPointOrZero(s.ae.fromLngLat(c.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=n.getIds().map(R=>{const L=n.getTileByID(R).tileID;return L.projMatrix=c.calculateProjMatrix(L.toUnwrapped()),L});(function(R,L){const P=L.transform.pointCoordinate(L.transform.getCameraPoint()),F=new s.P(P.x,P.y);R.sort((j,H)=>{if(H.overscaledZ-j.overscaledZ)return H.overscaledZ-j.overscaledZ;const $=new s.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),G=new s.P(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),te=F.mult(1<<j.canonical.z);return te.x-=.5,te.y-=.5,te.distSqr($)-te.distSqr(G)})})(m,this.painter);const y=this.proxyToSource||{};this.proxyToSource={},m.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const w=this._style._mergedSourceCaches;for(const R in w){const L=w[R];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,t[R],y),L.usedForTerrain))continue;const P=t[R];L.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[n.id]=m.map(R=>new Eu(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;const E={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const L=this.terrainTileForTile[R.key];if(!L)continue;const P=L.tileID.key;P in E||(this._visibleDemTiles.push(L),E[P]=P)}}_assignTerrainTiles(t){this._initializing||t.forEach(n=>{if(this.terrainTileForTile[n.key])return;const c=this._findTileCoveringTileID(n,this.sourceCache);c&&(this.terrainTileForTile[n.key]=c)})}_prepareDEMTextures(){const t=this.painter.context,n=t.gl;for(const c in this.terrainTileForTile){const m=this.terrainTileForTile[c],y=m.dem;!y||m.demTexture&&!m.needsDEMTextureUpload||(t.activeTexture.set(n.TEXTURE1),Ua(this.painter,m,y))}}_prepareDemTileUniforms(t,n,c,m){if(!n||n.demTexture==null)return!1;const y=t.tileID.canonical,w=Math.pow(2,n.tileID.canonical.z-y.z),E=m||"";return c[`u_dem_tl${E}`]=[y.x*w%1,y.y*w%1],c[`u_dem_scale${E}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const n=this._visibleDemTiles.reduce((c,m)=>{if(!m.dem)return c;const y=m.dem.tree.minimums[0];return y>0&&t++,c+y},0);return t?n/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const c=this._getLoadedAreaMinimum(),m=new s.dI({width:1,height:1},new Float32Array([c]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(m,{premultiply:!1}):y=this._emptyDEMTexture=new s.T(t,m,n.R32F,{premultiply:!1}),y}setupElevationDraw(t,n,c){const m=this.painter.context,y=m.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};w.u_exaggeration=this.exaggeration();let E=null,R=null,L=1;if(c&&c.morphing&&this._useVertexMorphing){const H=c.morphing.srcDemTile,$=c.morphing.dstDemTile;L=c.morphing.phase,H&&$&&(this._prepareDemTileUniforms(t,H,w,"_prev")&&(R=H),this._prepareDemTileUniforms(t,$,w)&&(E=$))}const P=H=>H&&H.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST;let F=null;var j;if(this.enabled?R&&E?(F=E.demTexture,m.activeTexture.set(y.TEXTURE4),R.demTexture.bind(P(R),y.CLAMP_TO_EDGE),w.u_dem_lerp=L):(E=this.terrainTileForTile[t.tileID.key],F=this._prepareDemTileUniforms(t,E,w)?E.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,m.activeTexture.set(y.TEXTURE2),F&&(w.u_dem_size=(j=F).size[0]===1?1:j.size[0]-2,F.bind(P(E),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(c&&c.useDepthForOcclusion,n,w),c&&c.useMeterToDem&&E){const H=(1<<E.tileID.canonical.z)*s.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=H}if(c&&c.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=c.labelPlaneMatrixInv),n.setTerrainUniformValues(m,w),this.painter.transform.projection.name==="globe"){const H=this.globeUniformValues(this.painter.transform,t.tileID.canonical,c&&c.useDenormalizedUpVectorScale);n.setGlobeUniformValues(m,H)}}globeUniformValues(t,n,c){const m=t.projection;return{u_tile_tl_up:m.upVector(n,0,0),u_tile_tr_up:m.upVector(n,s.al,0),u_tile_br_up:m.upVector(n,s.al,s.al),u_tile_bl_up:m.upVector(n,0,s.al),u_tile_up_scale:c?s.dJ(1):m.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const n=this.painter,c=this.painter.context;t.length!==0&&(c.bindFramebuffer.set(null),c.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,y,w,E,R){if(m.transform.projection.name==="globe")(function(L,P,F,j,H){const $=L.context,G=$.gl;let te,X;const re=L.transform,ce=s.dA(L,$,re),fe=(ct,Ze)=>{if(X===Ze)return;const ot=[Xa[Ze],"PROJECTION_GLOBE_VIEW"];ce&&ot.push("CUSTOM_ANTIALIASING");const Bt=L.isTileAffectedByFog(ct);te=L.getOrCreateProgram("globeRaster",{defines:ot,overrideFog:Bt}),X=Ze},Te=L.colorModeForRenderPass(),we=new ni(G.LEQUAL,ni.ReadWrite,L.depthRangeFor3D);ml.update(H);const Ee=s.dB(re),ve=[s.aF(re.center.lng),s.aJ(re.center.lat)],be=L.globeSharedBuffers,Ce=[re.width*s.o.devicePixelRatio,re.height*s.o.devicePixelRatio],We=Float32Array.from(re.globeMatrix),ke={useDenormalizedUpVectorScale:!0};{const ct=L.transform,Ze=Ao(ct.zoom,P.exaggeration(),P.sourceCache._source.tileSize);X=-1;const ot=G.TRIANGLES;for(const Bt of j){const Ye=F.getTile(Bt),Oe=Ii.disabled,nt=P.prevTerrainTileForTile[Bt.key],Ge=P.terrainTileForTile[Bt.key];Th(nt,Ge)&&ml.newMorphing(Bt.key,nt,Ge,H,250),$.activeTexture.set(G.TEXTURE0),Ye.texture&&Ye.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const ut=ml.getMorphValuesForProxy(Bt.key),_t=ut?1:0;ut&&Object.assign(ke,{morphing:{srcDemTile:ut.from,dstDemTile:ut.to,phase:s.dz(ut.phase)}});const $t=s.dC(Bt.canonical),Rt=s.dD($t.getCenter().lat),St=s.dE(Bt.canonical,$t,Rt,ct.worldSize/ct._pixelsPerMercatorPixel),gi=s.bk(s.dF(Bt.canonical)),li=Ed(ct.expandedFarZProjMatrix,We,Ee,gi,s.aj(ct.zoom),ve,ct.frustumCorners.TL,ct.frustumCorners.TR,ct.frustumCorners.BR,ct.frustumCorners.BL,ct.globeCenterInViewSpace,ct.globeRadius,Ce,Ze,ct._farZ,St);if(fe(Bt,_t),te&&(P.setupElevationDraw(Ye,te,ke),L.uploadCommonUniforms($,te,Bt.toUnwrapped()),be)){const[ti,ci,Oi]=be.getGridBuffers(Rt,Ze!==0);te.draw(L,ot,we,Oe,Te,ki.backCCW,li,"globe_raster",ti,ci,Oi)}}}if(be&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const ct=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ce&&ct.push("CUSTOM_ANTIALIASING"),te=L.getOrCreateProgram("globeRaster",{defines:ct});for(const Ze of j){const{x:ot,y:Bt,z:Ye}=Ze.canonical,Oe=Bt===0,nt=Bt===(1<<Ye)-1,[Ge,ut,_t,$t]=be.getPoleBuffers(Ye,!1);if($t&&(Oe||nt)){const Rt=F.getTile(Ze);$.activeTexture.set(G.TEXTURE0),Rt.texture&&Rt.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let St=s.dG(Ye,ot,re);const gi=s.bk(s.dF(Ze.canonical)),li=(ti,ci)=>ti.draw(L,G.TRIANGLES,we,Ii.disabled,Te,ki.disabled,Ed(re.expandedFarZProjMatrix,St,St,gi,0,ve,re.frustumCorners.TL,re.frustumCorners.TR,re.frustumCorners.BR,re.frustumCorners.BL,re.globeCenterInViewSpace,re.globeRadius,Ce,0,re._farZ),"globe_pole_raster",ci,_t,$t);P.setupElevationDraw(Rt,te,ke),L.uploadCommonUniforms($,te,Ze.toUnwrapped()),Oe&&L.renderDefaultNorthPole&&li(te,Ge),nt&&L.renderDefaultSouthPole&&(St=s.cR(s.bC(),St,[1,-1,1]),li(te,ut))}}}})(m,y,w,E,R);else{const L=m.context,P=L.gl;let F,j;const H=m.shadowRenderer,$=zc(m,m.longestCutoffRange),G=Te=>{if(j===Te)return;const we=[];we.push(Xa[Te]),$.shouldRenderCutoff&&we.push("RENDER_CUTOFF"),H&&(we.push("RENDER_SHADOWS","DEPTH_TEXTURE"),H.useNormalOffset&&we.push("NORMAL_OFFSET")),F=m.getOrCreateProgram("terrainRaster",{defines:we}),j=Te},te=m.colorModeForRenderPass(),X=new ni(P.LEQUAL,ni.ReadWrite,m.depthRangeFor3D);ml.update(R);const re=m.transform,ce=Ao(re.zoom,y.exaggeration(),y.sourceCache._source.tileSize);let fe=[0,0,0];if(H){const Te=m.style.directionalLight,we=m.style.ambientLight;Te&&we&&(fe=To(m.style,Te,we))}{j=-1;const Te=P.TRIANGLES,[we,Ee]=[y.gridIndexBuffer,y.gridSegments];for(const ve of E){const be=w.getTile(ve),Ce=Ii.disabled,We=y.prevTerrainTileForTile[ve.key],ke=y.terrainTileForTile[ve.key];Th(We,ke)&&ml.newMorphing(ve.key,We,ke,R,250),L.activeTexture.set(P.TEXTURE0),be.texture&&be.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE);const ct=ml.getMorphValuesForProxy(ve.key),Ze=ct?1:0;let ot;ct&&(ot={morphing:{srcDemTile:ct.from,dstDemTile:ct.to,phase:s.dz(ct.phase)}});const Bt=wh(ve.projMatrix,Bc(ve.canonical,re.renderWorldCopies)?ce/10:ce,fe);if(G(Ze),!F)continue;y.setupElevationDraw(be,F,ot);const Ye=ve.toUnwrapped();H&&H.setupShadows(Ye,F),m.uploadCommonUniforms(L,F,Ye,null,$),F.draw(m,Te,X,Ce,te,ki.backCCW,Bt,"terrain_raster",y.gridBuffer,we,Ee)}}}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const n=this.painter,c=this.painter.context,m=this.proxySourceCache,y=this.proxiedCoords[m.id],w=this._drapedRenderBatches.shift(),E=n.style.order,R=[];let L=0;for(const P of y){const F=m.getTileByID(P.proxyTileKey),j=m.proxyCachedFBO[P.key]?m.proxyCachedFBO[P.key][t]:void 0,H=j!==void 0?m.renderCache[j]:this.pool[L++],$=j!==void 0;if(F.texture=H.tex,$&&!H.dirty){R.push(F.tileID);continue}let G;c.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(c.clear({color:s.ao.transparent,stencil:0}),H.dirty=!1);for(let te=w.start;te<=w.end;++te){const X=n.style._mergedLayers[E[te]];if(X.isHidden(n.transform.zoom))continue;const re=n.style.getLayerSourceCache(X),ce=re?this.proxyToSource[P.key][re.id]:[P];if(!ce)continue;const fe=ce;c.viewport.set([0,0,H.fb.width,H.fb.height]),G!==(re?re.id:null)&&(this._setupStencil(H,ce,X,re),G=re?re.id:null),n.renderLayer(n,re,X,fe)}if(this._drapedRenderBatches.length===0)for(const te of this._pendingGroundEffectLayers){const X=n.style._mergedLayers[E[te]];if(X.isHidden(n.transform.zoom))continue;const re=n.style.getLayerSourceCache(X),ce=re?this.proxyToSource[P.key][re.id]:[P];if(!ce)continue;const fe=ce;c.viewport.set([0,0,H.fb.width,H.fb.height]),G!==(re?re.id:null)&&(this._setupStencil(H,ce,X,re),G=re?re.id:null),n.renderLayer(n,re,X,fe)}this.renderedToTile?(H.dirty=!0,R.push(F.tileID)):$||--L,L===5&&(L=0,this.renderToBackBuffer(R))}return this.renderToBackBuffer(R),this.renderingToTexture=!1,c.bindFramebuffer.set(null),c.viewport.set([0,0,n.width,n.height]),w.end+1}postRender(){}isLayerOrderingCorrect(t){const n=t.order.length;let c=-1,m=n;for(let y=0;y<n;++y)this._style.isLayerDraped(t._mergedLayers[t.order[y]])?c=Math.max(c,y):m=Math.min(m,y);return m>c}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{t=Math.min(t,n.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,n,c){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const w=y.tileID,E=1<<w.overscaledZ,{x:R,y:L}=w.canonical,P=R/E,F=(R+1)/E,j=L/E,H=(L+1)/E;return{minx:P,miny:j,maxx:F,maxy:H,t:y.dem.tree.raycastRoot(P,j,F,H,t,n,c),tile:y}});m.sort((y,w)=>(y.t!==null?y.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const y of m){if(y.t==null)return null;const w=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,t,n,c);if(w!=null)return w}return null}_createFBO(){const t=this.painter.context,n=t.gl,c=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const m=new s.T(t,{width:c[0],height:c[1],data:null},n.RGBA8);m.bind(n.LINEAR,n.CLAMP_TO_EDGE);const y=t.createFramebuffer(c[0],c[1],!0,null);return y.colorAttachment.set(m.texture),y.depthAttachment=new bh(t,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,c[0],c[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:y,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const n=this._style._mergedLayers[t],c=n.isHidden(this.painter.transform.zoom);return n.type==="hillshade"||n.type==="custom"?!c&&n.shouldRedrape():!c&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const c of this._style.getSources())if(c instanceof Yn){t=!0;break}if(!t)return;const n={};for(let c=0;c<this._style.order.length;++c){const m=this._style._mergedLayers[this._style.order[c]],y=this._style.getLayerSourceCache(m);if(y&&!n[y.id]&&!m.isHidden(this.painter.transform.zoom)&&m.type==="line"&&m.widthExpression()instanceof s.ad){n[y.id]=!0;for(const w of this.proxyCoords){const E=this.proxyToSource[w.key][y.id];if(E)for(const R of E)this._clearRenderCacheForTile(y.id,R)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c]._source instanceof Ga){t=!0;break}if(!t)return;const n={};for(let c=0;c<this._style.order.length;++c){const m=this._style._mergedLayers[this._style.order[c]],y=this._style.getLayerSourceCache(m);if(!y||n[y.id]||m.isHidden(this.painter.transform.zoom)||m.type!=="raster")continue;const w=m.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const R=this.proxyToSource[E.key][y.id];if(R)for(const L of R){const P=Ya(y.getTile(L),y.findLoadedParent(L,0),y,this.painter.transform,w);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(y.id,L)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,n=t.length;if(n===0)return;const c=[];this._pendingGroundEffectLayers=[];let m,y=0,w=this._style._mergedLayers[t[y]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++y<n;)w=this._style._mergedLayers[t[y]];for(;y<n;++y){const E=this._style._mergedLayers[t[y]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?m===void 0&&(m=y):(E.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),m!==void 0&&(c.push({start:m,end:y-1}),m=void 0)))}if(m!==void 0&&c.push({start:m,end:y-1}),c.length!==0){const E=c[c.length-1];this._pendingGroundEffectLayers.every(R=>R>E.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=c}_setupRenderCache(t){const n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){const w=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let E=0;E<w.length;++E){const R=Object.values(w[E]);n.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const c=this.proxyCoords,m=this._tilesDirty;for(let w=c.length-1;w>=0;w--){const E=c[w];if(n.getTileByID(E.key),n.proxyCachedFBO[E.key]!==void 0){const R=t[E.key],L=this.proxyToSource[E.key];let P=0;for(const F in L){const j=L[F],H=R[F];if(!H||H.length!==j.length||j.some(($,G)=>$!==H[G]||m[F]&&m[F].hasOwnProperty($.key))){P=-1;break}++P}for(const F in n.proxyCachedFBO[E.key])n.renderCache[n.proxyCachedFBO[E.key][F]].dirty=P<0||P!==Object.values(R).length}}const y=[...this._drapedRenderBatches];y.sort((w,E)=>E.end-E.start-(w.end-w.start));for(const w of y)for(const E of c){if(n.proxyCachedFBO[E.key])continue;let R=n.renderCachePool.pop();R===void 0&&n.renderCache.length<50&&(R=n.renderCache.length,n.renderCache.push(this._createFBO())),R!==void 0&&(n.proxyCachedFBO[E.key]={},n.proxyCachedFBO[E.key][w.start]=R,n.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(t,n,c,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,w=y.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let E;if(c.isTileClipped())E=n.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,c.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Ii.disabled}_renderTileClippingMasks(t,n){const c=this.painter,m=this.painter.context,y=m.gl;c._tileClippingMaskIDs={},m.setColorMode(ir.disabled),m.setDepthMode(ni.disabled);const w=c.getOrCreateProgram("clippingMask");for(const E of t){const R=c._tileClippingMaskIDs[E.key]=--n;w.draw(c,y.TRIANGLES,ni.disabled,new Ii({func:y.ALWAYS,mask:0},R,255,y.KEEP,y.KEEP,y.REPLACE),ir.disabled,ki.disabled,Fc(E.projMatrix),"$clipping",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const c=[t.x,t.y,1,1];s.aC(c,c,n.pixelMatrixInverse),s.cJ(c,c,1/c[3]),c[0]/=n.worldSize,c[1]/=n.worldSize;const m=n._camera.position,y=s.ce(1,n.center.lat),w=[m[0],m[1],m[2]/y,0],E=s.d9([],c.slice(0,3),w);s.aw(E,E);const R=this.raycast(w,E,this._exaggeration);return R!==null&&R?(s.bH(w,w,E,R),w[3]=w[2],w[2]*=y,w):null}_setupProxiedCoordsForOrtho(t,n,c){if(t.getSource()instanceof s.aS)return this._setupProxiedCoordsForImageSource(t,n,c);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const m=this.proxiedCoords[t.id]=[],y=this.proxyCoords;for(let R=0;R<y.length;R++){const L=y[R],P=this._findTileCoveringTileID(L,t);if(P){const F=this._createProxiedId(L,P,c[L.key]&&c[L.key][t.id]);m.push(F),this.proxyToSource[L.key][t.id]=[F]}}let w=!1;const E=new Set;for(let R=0;R<n.length;R++){const L=t.getTile(n[R]);if(!L||!L.hasData())continue;const P=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==L.tileID.canonical.z){const F=this.proxyToSource[P.tileID.key][t.id],j=this._createProxiedId(P.tileID,L,c[P.tileID.key]&&c[P.tileID.key][t.id]);F?F.splice(F.length-1,0,j):this.proxyToSource[P.tileID.key][t.id]=[j];const H=this.proxyToSource[P.tileID.key][t.id];E.has(H)||E.add(H),m.push(j),w=!0}}if(this._sourceTilesOverlap[t.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(const R of E)R.sort((L,P)=>P.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(t,n,c){if(!t.getSource().loaded())return;const m=this.proxiedCoords[t.id]=[],y=this.proxyCoords,w=t.getSource(),E=w.tileID;if(!E)return;const R=new s.P(E.x,E.y)._div(1<<E.z),L=w.coordinates.map(s.ae.fromLngLat).reduce((F,j)=>(F.min.x=Math.min(F.min.x,j.x-R.x),F.min.y=Math.min(F.min.y,j.y-R.y),F.max.x=Math.max(F.max.x,j.x-R.x),F.max.y=Math.max(F.max.y,j.y-R.y),F),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(F,j)=>{const H=F.wrap+F.canonical.x/(1<<F.canonical.z),$=F.canonical.y/(1<<F.canonical.z),G=s.al/(1<<F.canonical.z),te=j.wrap+j.canonical.x/(1<<j.canonical.z),X=j.canonical.y/(1<<j.canonical.z);return H+G<te+L.min.x||H>te+L.max.x||$+G<X+L.min.y||$>X+L.max.y};for(let F=0;F<y.length;F++){const j=y[F];for(let H=0;H<n.length;H++){const $=t.getTile(n[H]);if(!$||!$.hasData()||P(j,$.tileID))continue;const G=this._createProxiedId(j,$,c[j.key]&&c[j.key][t.id]),te=this.proxyToSource[j.key][t.id];te?te.push(G):this.proxyToSource[j.key][t.id]=[G],m.push(G)}}}_createProxiedId(t,n,c){let m=this.orthoMatrix;if(c){const y=c.find(w=>w.key===n.tileID.key);if(y)return y}if(n.tileID.key!==t.key){const y=t.canonical.z-n.tileID.canonical.z;let w,E,R;m=s.bC();const L=n.tileID.wrap-t.wrap<<t.overscaledZ;y>0?(w=s.al>>y,E=w*((n.tileID.canonical.x<<y)-t.canonical.x+L),R=w*((n.tileID.canonical.y<<y)-t.canonical.y)):(w=s.al<<-y,E=s.al*(n.tileID.canonical.x-(t.canonical.x+L<<-y)),R=s.al*(n.tileID.canonical.y-(t.canonical.y<<-y))),s.cd(m,0,w,0,w,0,1),s.br(m,m,[E,R,0])}return new Eu(n.tileID,t.key,m)}_findTileCoveringTileID(t,n){let c=n.getTile(t);if(c&&c.hasData())return c;const m=this._findCoveringTileCache[n.id],y=m[t.key];if(c=y?n.getTileByID(y):null,c&&c.hasData()||y===null)return c;let w=c?c.tileID:t,E=w.overscaledZ;const R=n.getSource().minzoom,L=[];if(!y){const F=n.getSource().maxzoom;if(t.canonical.z>=F){const j=t.canonical.z-F;n.getSource().reparseOverscaled?(E=Math.max(t.canonical.z+2,n.transform.tileZoom),w=new s.aO(E,t.wrap,F,t.canonical.x>>j,t.canonical.y>>j)):j!==0&&(E=F,w=new s.aO(E,t.wrap,F,t.canonical.x>>j,t.canonical.y>>j))}w.key!==t.key&&(L.push(w.key),c=n.getTile(w))}const P=F=>{L.forEach(j=>{m[j]=F}),L.length=0};for(E-=1;E>=R&&(!c||!c.hasData());E--){c&&P(c.tileID.key);const F=w.calculateScaledKey(E);if(c=n.getTileByID(F),c&&c.hasData())break;const j=m[F];if(j===null)break;j===void 0?L.push(F):c=n.getTileByID(j)}return P(c?c.tileID.key:null),c&&c.hasData()?c:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,n){let c=this._tilesDirty[t];c||(c=this._tilesDirty[t]={}),c[n.key]=!0}}function Af(u,t,n){const c=function(E,R,L){const P=s.bJ(R,E),F=s.bJ(L,[.2126,.7152,.0722]),j=($,G,te)=>(1-te)*$+te*G,H=j(1-.3*Math.min(F,1),1,Math.min(P+1,1));return j(.92,1,Math.asin(s.aA(R[2],-1,1))/Math.PI+.5)*H}(u,[0,0,1],t),m=[0,0,0];s.c4(m,n.slice(0,3),c);const y=[0,0,0];s.c4(y,t.slice(0,3),u[2]);const w=[0,0,0];return s.d7(w,m,y),s.da(w)}const kp=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Is=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Sh{static cacheKey(t,n,c,m){let y=`${n}${m?m.cacheKey:""}`;for(const w of c)t.usedDefines.includes(w)&&(y+=`/${w}`);return y}constructor(t,n,c,m,y,w){const E=t.gl;this.program=E.createProgram(),this.configuration=m,this.name=n,this.fixedDefines=[...w];let R=m?m.defines():[];R=R.concat(w.map($=>`#define ${$}`));const L=`#version 300 es
`;let P=L+R.concat("precision mediump float;",Fa,Dc.fragmentSource).join(`
`);for(const $ of c.fragmentIncludes)P+=`
${co[$]}`;P+=`
${c.fragmentSource}`;let F=L+R.concat("precision highp float;",Fa,Dc.vertexSource).join(`
`);for(const $ of c.vertexIncludes)F+=`
${co[$]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&c.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(F+=`
uniform int u_instanceID;
`),F+=`
${c.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(F=F.replaceAll("gl_InstanceID","u_instanceID"));const j=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(j,P),E.compileShader(j),E.attachShader(this.program,j);const H=E.createShader(E.VERTEX_SHADER);E.isContextLost()?this.failedToCreate=!0:(E.shaderSource(H,F),E.compileShader(H),E.attachShader(this.program,H),this.attributes={},E.linkProgram(this.program),E.deleteShader(H),E.deleteShader(j),this.fixedUniforms=y(t),this.binderUniforms=m?m.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=($=>({u_instanceID:new s.cg($)}))(t)),(w.includes("TERRAIN")||n.indexOf("symbol")!==-1||n.indexOf("circle")!==-1)&&(this.terrainUniforms=($=>({u_dem:new s.cg($),u_dem_prev:new s.cg($),u_dem_tl:new s.cj($),u_dem_scale:new s.ci($),u_dem_tl_prev:new s.cj($),u_dem_scale_prev:new s.ci($),u_dem_size:new s.ci($),u_dem_lerp:new s.ci($),u_exaggeration:new s.ci($),u_depth:new s.cg($),u_depth_size_inv:new s.cj($),u_depth_range_unpack:new s.cj($),u_occluder_half_size:new s.ci($),u_occlusion_depth_offset:new s.ci($),u_meter_to_dem:new s.ci($),u_label_plane_matrix_inv:new s.ck($)}))(t)),w.includes("GLOBE")&&(this.globeUniforms=($=>({u_tile_tl_up:new s.ch($),u_tile_tr_up:new s.ch($),u_tile_br_up:new s.ch($),u_tile_bl_up:new s.ch($),u_tile_up_scale:new s.ci($)}))(t)),w.includes("FOG")&&(this.fogUniforms=($=>({u_fog_matrix:new s.ck($),u_fog_range:new s.cj($),u_fog_color:new s.d2($),u_fog_horizon_blend:new s.ci($),u_fog_vertical_limit:new s.cj($),u_fog_temporal_offset:new s.ci($),u_frustum_tl:new s.ch($),u_frustum_tr:new s.ch($),u_frustum_br:new s.ch($),u_frustum_bl:new s.ch($),u_globe_pos:new s.ch($),u_globe_radius:new s.ci($),u_globe_transition:new s.ci($),u_is_globe:new s.cg($),u_viewport:new s.cj($)}))(t)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=($=>({u_cutoff_params:new s.d2($)}))(t)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=($=>({u_lighting_ambient_color:new s.ch($),u_lighting_directional_dir:new s.ch($),u_lighting_directional_color:new s.ch($),u_ground_radiance:new s.ch($)}))(t)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=($=>({u_light_matrix_0:new s.ck($),u_light_matrix_1:new s.ck($),u_fade_range:new s.cj($),u_shadow_normal_offset:new s.ch($),u_shadow_intensity:new s.ci($),u_shadow_texel_size:new s.ci($),u_shadow_map_resolution:new s.ci($),u_shadow_direction:new s.ch($),u_shadow_bias:new s.ch($),u_shadowmap_0:new s.cg($),u_shadowmap_1:new s.cg($)}))(t)))}getAttributeLocation(t,n){let c=this.attributes[n];return c===void 0&&(c=this.attributes[n]=t.getAttribLocation(this.program,n)),c}setTerrainUniformValues(t,n){if(!this.terrainUniforms)return;const c=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in n)c[m]&&c[m].set(this.program,m,n[m])}}setGlobeUniformValues(t,n){if(!this.globeUniforms)return;const c=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in n)c[m]&&c[m].set(this.program,m,n[m])}}setFogUniformValues(t,n){if(!this.fogUniforms)return;const c=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in n)c[m].set(this.program,m,n[m])}}setCutoffUniformValues(t,n){if(!this.cutoffUniforms)return;const c=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in n)c[m].set(this.program,m,n[m])}}setLightsUniformValues(t,n){if(!this.lightsUniforms)return;const c=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in n)c[m].set(this.program,m,n[m])}}setShadowUniformValues(t,n){if(this.failedToCreate||!this.shadowUniforms)return;const c=this.shadowUniforms;t.program.set(this.program);for(const m in n)c[m].set(this.program,m,n[m])}_drawDebugWireframe(t,n,c,m,y,w,E,R,L,P){const F=t.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;const j=t.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||t._terrain&&t._terrain.renderingToTexture||!kp.includes(this.name))||!(!F.layers3D||!Is.includes(this.name))))return;const H=j.gl,$=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,y,j);if(!$)return;const G=[...this.fixedDefines];G.push("DEBUG_WIREFRAME");const te=t.getOrCreateProgram(this.name,{config:this.configuration,defines:G});j.program.set(te.program);const X=(fe,Te,we)=>{if(Te[fe]&&we[fe])for(const Ee in Te[fe])we[fe][Ee]&&we[fe][Ee].set(we.program,Ee,Te[fe][Ee].current)};L&&L.setUniforms(te.program,j,te.binderUniforms,E,{zoom:R}),X("fixedUniforms",this,te),X("terrainUniforms",this,te),X("globeUniforms",this,te),X("fogUniforms",this,te),X("lightsUniforms",this,te),X("shadowUniforms",this,te),$.bind(),j.setColorMode(new ir([H.ONE,H.ONE_MINUS_SRC_ALPHA,H.ZERO,H.ONE],s.ao.transparent,[!0,!0,!0,!1])),j.setDepthMode(new ni(n.func===H.LESS?H.LEQUAL:n.func,ni.ReadOnly,n.range)),j.setStencilMode(Ii.disabled);const re=3*w.primitiveLength*2,ce=3*w.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const fe=P||1;for(let Te=0;Te<fe;++Te)te.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Te),H.drawElements(H.LINES,re,H.UNSIGNED_SHORT,ce)}else P&&P>1?H.drawElementsInstanced(H.LINES,re,H.UNSIGNED_SHORT,ce,P):H.drawElements(H.LINES,re,H.UNSIGNED_SHORT,ce);y.bind(),j.program.set(this.program),j.setDepthMode(n),j.setStencilMode(c),j.setColorMode(m)}checkUniforms(t,n,c){if(this.fixedDefines.includes(n)){for(const m of Object.keys(c))if(!c[m].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${m} not set but required by ${n} being defined`)}}draw(t,n,c,m,y,w,E,R,L,P,F,j,H,$,G,te){const X=t.context,re=X.gl;if(this.failedToCreate)return;X.program.set(this.program),X.setDepthMode(c),X.setStencilMode(m),X.setColorMode(y),X.setCullFace(w);for(const Te of Object.keys(this.fixedUniforms))this.fixedUniforms[Te].set(this.program,Te,E[Te]);$&&$.setUniforms(this.program,X,this.binderUniforms,j,{zoom:H});const ce={[re.POINTS]:1,[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[n];this.checkUniforms(R,"RENDER_SHADOWS",this.shadowUniforms);const fe=te&&te>0?1:void 0;for(const Te of F.get()){const we=Te.vaos||(Te.vaos={});if((we[R]||(we[R]=new Uo)).bind(X,this,L,$?$.getPaintVertexBuffers():[],P,Te.vertexOffset,G||[],fe),this.forceManualRenderingForInstanceIDShaders){const Ee=te||1;for(let ve=0;ve<Ee;++ve)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ve),P?re.drawElements(n,Te.primitiveLength*ce,re.UNSIGNED_SHORT,Te.primitiveOffset*ce*2):re.drawArrays(n,Te.vertexOffset,Te.vertexLength)}else te&&te>1?re.drawElementsInstanced(n,Te.primitiveLength*ce,re.UNSIGNED_SHORT,Te.primitiveOffset*ce*2,te):P?re.drawElements(n,Te.primitiveLength*ce,re.UNSIGNED_SHORT,Te.primitiveOffset*ce*2):re.drawArrays(n,Te.vertexOffset,Te.vertexLength);n===re.TRIANGLES&&P&&this._drawDebugWireframe(t,c,m,y,P,Te,j,H,$,te)}}}function ec(u,t,n=0){const c=Math.pow(2,t.tileID.overscaledZ),m=t.tileSize*Math.pow(2,u.transform.tileZoom)/c,y=m*(t.tileID.canonical.x+t.tileID.wrap*c),w=m*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(t,1,u.transform.tileZoom),u_pixel_coord_upper:[y>>16,w>>16],u_pixel_coord_lower:[65535&y,65535&w],u_pattern_transition:n}}const _l={terrain:0,flat:1},Cd=s.bC(),yl=(u,t,n,c,m,y,w,E,R,L,P,F,j,H,$,G,te,X)=>{const re=t.style.light,ce=re.properties.get("position"),fe=[ce.x,ce.y,ce.z],Te=s.dL();re.properties.get("anchor")==="viewport"&&(s.dM(Te,-t.transform.angle),s.dN(fe,fe,Te));const we=re.properties.get("color").toPremultipliedRenderColor(null),Ee=t.transform,ve={u_matrix:u,u_lightpos:fe,u_lightintensity:re.properties.get("intensity"),u_lightcolor:[we.r,we.g,we.b],u_vertical_gradient:+n,u_opacity:c,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Cd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:_l[L],u_base_type:_l[P],u_ao:m,u_edge_radius:y,u_width_scale:w,u_flood_light_color:$,u_vertical_scale:G,u_flood_light_intensity:te,u_ground_shadow_factor:X};return Ee.projection.name==="globe"&&(ve.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],ve.u_zoom_transition=F,ve.u_inv_rot_matrix=H,ve.u_merc_center=j,ve.u_up_dir=Ee.projection.upVector(new s.cC(0,0,0),j[0]*s.al,j[1]*s.al),ve.u_height_lift=R),ve},Uc=(u,t,n,c,m,y)=>({u_matrix:u,u_edge_radius:t,u_width_scale:n,u_vertical_scale:c,u_height_type:_l[m],u_base_type:_l[y]}),Vm=(u,t,n,c,m,y,w,E,R,L,P,F,j,H,$,G,te,X)=>{const re=yl(u,t,n,c,m,y,w,E,L,P,F,j,H,$,G,te,1,[0,0,0]),ce={u_height_factor:-Math.pow(2,E.overscaledZ)/R.tileSize/8};return Object.assign(re,ec(t,R,X),ce)},Cf=(u,t,n)=>({u_matrix:u,u_emissive_strength:t,u_ground_shadow_factor:n}),Au=(u,t,n,c,m,y=0)=>Object.assign(Cf(u,t,m),ec(n,c,y)),Hm=(u,t,n,c)=>({u_matrix:u,u_world:n,u_emissive_strength:t,u_ground_shadow_factor:c}),Cu=(u,t,n,c,m,y,w=0)=>Object.assign(Au(u,t,n,c,y,w),{u_world:m}),Bp=(u,t)=>({u_matrix:u,u_ground_shadow_factor:t}),Ru=(u,t,n,c,m)=>({u_matrix:u,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:n,u_height_scale:c,u_reset_depth:m}),qm=(u,t,n,c,m,y,w)=>({u_matrix:u,u_normal_matrix:t,u_opacity:n,u_faux_facade_ao_intensity:c,u_camera_pos:m,u_tile_to_meter:y,u_facade_emissive_chance:w}),Vc=u=>({u_matrix:u}),rn=u=>({u_matrix:u}),Vn=(u,t,n,c,m,y,w,E)=>{const R=s.al/y.tileSize;return{u_matrix:u,u_inv_rot_matrix:t,u_camera_to_center_distance:n.getCameraToCenterDistance(E),u_extrude_scale:[n.pixelsToGLUnits[0]/R,n.pixelsToGLUnits[1]/R],u_zoom_transition:c,u_tile_id:w,u_merc_center:m}},bs=(u,t,n=1)=>({u_matrix:u,u_color:t,u_overlay:0,u_overlay_scale:n}),tc=s.bC(),Mu=(u,t,n,c,m,y,w)=>{const E=u.transform,R=E.projection.name==="globe",L=R?s.dO(E.zoom,t.canonical)*E._pixelsPerMercatorPixel:s.ay(n,1,y),P={u_matrix:t.projMatrix,u_extrude_scale:L,u_intensity:w,u_inv_rot_matrix:tc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){P.u_inv_rot_matrix=c,P.u_merc_center=m,P.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],P.u_zoom_transition=s.aj(E.zoom);const F=m[0]*s.al,j=m[1]*s.al;P.u_up_dir=E.projection.upVector(new s.cC(0,0,0),F,j)}return P};function ic(u,[t,n,c,m],[y,w]){if(y===w)return[0,0,0,0];const E=255*(u-1)/(u*(w-y));return[t*E,n*E,c*E,m*E]}function Eh(u,t,[n,c]){return n===c?0:.5/u+(t-n)*(u-1)/(u*(c-n))}const Hc=(u,t,n,c,m,y,w,E,R,L,P,F,j,H,$,G,te,X,re,ce,fe)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:c,u_grid_matrix:m,u_tl_parent:y,u_scale_parent:L,u_fade_t:P.mix,u_opacity:P.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:s.dQ(F.paint.get("raster-saturation")),u_contrast_factor:s.dP(F.paint.get("raster-contrast")),u_spin_weights:Co(F.paint.get("raster-hue-rotate")),u_perspective_transform:j,u_raster_elevation:H,u_zoom_transition:w,u_merc_center:E,u_cutoff_params:R,u_colorization_mix:ic(s.dR,G,X),u_colorization_offset:Eh(s.dR,te,X),u_color_ramp:$,u_texture_offset:[ce/(re+2*ce),re/(re+2*ce)],u_texture_res:[re+2*ce,re+2*ce],u_emissive_strength:fe});function Co(u){u*=Math.PI/180;const t=Math.sin(u),n=Math.cos(u);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const Iu=.05,Kn=(u,t,n,c,m,y,w,E,R,L,P,F)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:c,u_grid_matrix:m,u_tl_parent:y,u_scale_parent:L,u_fade_t:P.mix,u_opacity:P.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:w,u_merc_center:E,u_cutoff_params:R}),Rd=(u,t,n,c,m,y,w,E,R,L)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_tile_offset:n,u_velocity:c,u_color_ramp:y,u_velocity_res:m,u_max_speed:w,u_uv_offset:E,u_data_scale:[255*R[0],255*R[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Iu,Iu]}),Ah=(u,t,n,c,m,y,w,E,R,L)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_velocity:n,u_velocity_res:c,u_max_speed:m,u_speed_factor:y,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:E,u_data_scale:[255*R[0],255*R[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Iu,Iu]}),Rf=s.bC(),Mf=(u,t,n,c,m,y,w,E,R,L,P,F,j,H,$,G,te,X,re,ce,fe,Te,we,Ee)=>{const ve=m.transform,be={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ve.getCameraToCenterDistance(re),u_rotate_symbol:+n,u_aspect_ratio:ve.width/ve.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:w,u_coord_matrix:E,u_is_text:+L,u_elevation_from_sea:R?1:0,u_pitch_with_map:+c,u_texsize:P,u_texsize_icon:F,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Rf,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Rf,u_up_vector:[0,-1,0],u_color_adj_mat:Te,u_icon_transition:we||0,u_gamma_scale:c?m.transform.getCameraToCenterDistance(re)*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:s.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ee||1,u_ground_shadow_factor:ce,u_inv_matrix:s.bl(s.bC(),w),u_normal_scale:fe,u_lutTexture:Qn.LUT};return re.name==="globe"&&(be.u_tile_id=[H.canonical.x,H.canonical.y,1<<H.canonical.z],be.u_zoom_transition=$,be.u_inv_rot_matrix=te,be.u_merc_center=G,be.u_camera_forward=ve._camera.forward(),be.u_ecef_origin=s.dS(ve.globeMatrix,H.toUnwrapped()),be.u_tile_matrix=Float32Array.from(ve.globeMatrix),be.u_up_vector=X),be},If=(u,t,n,c)=>({u_matrix:u,u_emissive_strength:t,u_opacity:n,u_color:c}),Ch=(u,t,n,c,m,y,w,E,R)=>Object.assign(function(L,P,F,j,H,$){const{width:G,height:te}=j.imageManager.getPixelSize(P),X=Math.pow(2,$.tileID.overscaledZ),re=$.tileSize*Math.pow(2,j.transform.tileZoom)/X,ce=re*($.tileID.canonical.x+$.tileID.wrap*X),fe=re*$.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[G,te],u_pattern_size:F.displaySize,u_pattern_units_to_pixels:H?[j.transform.width,-1*j.transform.height]:[1/s.ay($,1,j.transform.tileZoom),1/s.ay($,1,j.transform.tileZoom)],u_pixel_coord_upper:[ce>>16,fe>>16],u_pixel_coord_lower:[65535&ce,65535&fe]}}(0,y,w,c,E,R),{u_matrix:u,u_emissive_strength:t,u_opacity:n}),Md=new Float32Array(s.bA([])),Rh=(u,t,n,c,m,y,w,E,R,L,P,F,j,H=[0,0,0],$)=>{const G=m.style.light,te=G.properties.get("position"),X=[-te.x,-te.y,te.z],re=s.dL();G.properties.get("anchor")==="viewport"&&(s.dM(re,-m.transform.angle),s.dN(X,X,re));const ce=P.alphaMode==="MASK",fe=G.properties.get("color").toNonPremultipliedRenderColor(null),Te=j.paint.get("model-ambient-occlusion-intensity"),we=j.paint.get("model-color").constantOr(s.ao.white).toNonPremultipliedRenderColor(null);return we.a=j.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:u,u_lighting_matrix:t,u_normal_matrix:n,u_node_matrix:c||Md,u_lightpos:X,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_camera_pos:H,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+ce,u_alphaCutoff:P.alphaCutoff,u_baseColorFactor:w.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:R,u_roughnessFactor:L,u_baseColorTexture:Qn.BaseColor,u_metallicRoughnessTexture:Qn.MetallicRoughness,u_normalTexture:Qn.Normal,u_occlusionTexture:Qn.Occlusion,u_emissionTexture:Qn.Emission,u_lutTexture:Qn.LUT,u_color_mix:we.toArray01(),u_aoIntensity:Te,u_emissive_strength:F,u_occlusionTextureTransform:$||[0,0,0,0]}},Gs=(u,t=Md,n=Md)=>({u_matrix:u,u_instance:t,u_node_matrix:n}),Os={fillExtrusion:u=>({u_matrix:new s.ck(u),u_lightpos:new s.ch(u),u_lightintensity:new s.ci(u),u_lightcolor:new s.ch(u),u_vertical_gradient:new s.ci(u),u_opacity:new s.ci(u),u_edge_radius:new s.ci(u),u_width_scale:new s.ci(u),u_ao:new s.cj(u),u_height_type:new s.cg(u),u_base_type:new s.cg(u),u_tile_id:new s.ch(u),u_zoom_transition:new s.ci(u),u_inv_rot_matrix:new s.ck(u),u_merc_center:new s.cj(u),u_up_dir:new s.ch(u),u_height_lift:new s.ci(u),u_flood_light_color:new s.ch(u),u_vertical_scale:new s.ci(u),u_flood_light_intensity:new s.ci(u),u_ground_shadow_factor:new s.ch(u)}),fillExtrusionDepth:u=>({u_matrix:new s.ck(u),u_edge_radius:new s.ci(u),u_width_scale:new s.ci(u),u_vertical_scale:new s.ci(u),u_height_type:new s.cg(u),u_base_type:new s.cg(u)}),fillExtrusionPattern:u=>({u_matrix:new s.ck(u),u_lightpos:new s.ch(u),u_lightintensity:new s.ci(u),u_lightcolor:new s.ch(u),u_vertical_gradient:new s.ci(u),u_height_factor:new s.ci(u),u_edge_radius:new s.ci(u),u_width_scale:new s.ci(u),u_ao:new s.cj(u),u_height_type:new s.cg(u),u_base_type:new s.cg(u),u_tile_id:new s.ch(u),u_zoom_transition:new s.ci(u),u_inv_rot_matrix:new s.ck(u),u_merc_center:new s.cj(u),u_up_dir:new s.ch(u),u_height_lift:new s.ci(u),u_image:new s.cg(u),u_texsize:new s.cj(u),u_pixel_coord_upper:new s.cj(u),u_pixel_coord_lower:new s.cj(u),u_tile_units_to_pixels:new s.ci(u),u_opacity:new s.ci(u),u_pattern_transition:new s.ci(u)}),fillExtrusionGroundEffect:u=>({u_matrix:new s.ck(u),u_opacity:new s.ci(u),u_ao_pass:new s.ci(u),u_meter_to_tile:new s.ci(u),u_ao:new s.cj(u),u_flood_light_intensity:new s.ci(u),u_flood_light_color:new s.ch(u),u_attenuation:new s.ci(u),u_edge_radius:new s.ci(u),u_fb:new s.cg(u),u_fb_size:new s.ci(u),u_dynamic_offset:new s.ci(u)}),fill:u=>({u_matrix:new s.ck(u),u_emissive_strength:new s.ci(u),u_ground_shadow_factor:new s.ch(u)}),fillPattern:u=>({u_matrix:new s.ck(u),u_emissive_strength:new s.ci(u),u_image:new s.cg(u),u_texsize:new s.cj(u),u_pixel_coord_upper:new s.cj(u),u_pixel_coord_lower:new s.cj(u),u_tile_units_to_pixels:new s.ci(u),u_ground_shadow_factor:new s.ch(u),u_pattern_transition:new s.ci(u)}),fillOutline:u=>({u_matrix:new s.ck(u),u_emissive_strength:new s.ci(u),u_world:new s.cj(u),u_ground_shadow_factor:new s.ch(u)}),fillOutlinePattern:u=>({u_matrix:new s.ck(u),u_emissive_strength:new s.ci(u),u_world:new s.cj(u),u_image:new s.cg(u),u_texsize:new s.cj(u),u_pixel_coord_upper:new s.cj(u),u_pixel_coord_lower:new s.cj(u),u_tile_units_to_pixels:new s.ci(u),u_ground_shadow_factor:new s.ch(u),u_pattern_transition:new s.ci(u)}),building:u=>({u_matrix:new s.ck(u),u_normal_matrix:new s.ck(u),u_opacity:new s.ci(u),u_faux_facade_ao_intensity:new s.ci(u),u_camera_pos:new s.ch(u),u_tile_to_meter:new s.ci(u),u_facade_emissive_chance:new s.ci(u)}),buildingBloom:u=>({u_matrix:new s.ck(u)}),buildingDepth:u=>({u_matrix:new s.ck(u)}),elevatedStructuresDepth:u=>({u_matrix:new s.ck(u),u_depth_bias:new s.ci(u)}),elevatedStructures:u=>({u_matrix:new s.ck(u),u_ground_shadow_factor:new s.ch(u)}),elevatedStructuresDepthReconstruct:u=>({u_matrix:new s.ck(u),u_camera_pos:new s.ch(u),u_depth_bias:new s.ci(u),u_height_scale:new s.ci(u),u_reset_depth:new s.ci(u)}),circle:s.dV,collisionBox:u=>({u_matrix:new s.ck(u),u_inv_rot_matrix:new s.ck(u),u_camera_to_center_distance:new s.ci(u),u_extrude_scale:new s.cj(u),u_zoom_transition:new s.ci(u),u_merc_center:new s.cj(u),u_tile_id:new s.ch(u)}),collisionCircle:u=>({u_matrix:new s.ck(u),u_inv_matrix:new s.ck(u),u_camera_to_center_distance:new s.ci(u),u_viewport_size:new s.cj(u)}),debug:u=>({u_color:new s.dx(u),u_matrix:new s.ck(u),u_overlay:new s.cg(u),u_overlay_scale:new s.ci(u)}),clippingMask:u=>({u_matrix:new s.ck(u)}),heatmap:u=>({u_extrude_scale:new s.ci(u),u_intensity:new s.ci(u),u_matrix:new s.ck(u),u_inv_rot_matrix:new s.ck(u),u_merc_center:new s.cj(u),u_tile_id:new s.ch(u),u_zoom_transition:new s.ci(u),u_up_dir:new s.ch(u)}),heatmapTexture:u=>({u_image:new s.cg(u),u_color_ramp:new s.cg(u),u_opacity:new s.ci(u)}),hillshade:u=>({u_matrix:new s.ck(u),u_image:new s.cg(u),u_latrange:new s.cj(u),u_light:new s.cj(u),u_shadow:new s.dx(u),u_highlight:new s.dx(u),u_emissive_strength:new s.ci(u),u_accent:new s.dx(u)}),hillshadePrepare:u=>({u_matrix:new s.ck(u),u_image:new s.cg(u),u_dimension:new s.cj(u),u_zoom:new s.ci(u)}),line:s.dU,linePattern:s.dT,raster:u=>({u_matrix:new s.ck(u),u_normalize_matrix:new s.ck(u),u_globe_matrix:new s.ck(u),u_merc_matrix:new s.ck(u),u_grid_matrix:new s.dy(u),u_tl_parent:new s.cj(u),u_scale_parent:new s.ci(u),u_fade_t:new s.ci(u),u_opacity:new s.ci(u),u_image0:new s.cg(u),u_image1:new s.cg(u),u_brightness_low:new s.ci(u),u_brightness_high:new s.ci(u),u_saturation_factor:new s.ci(u),u_contrast_factor:new s.ci(u),u_spin_weights:new s.ch(u),u_perspective_transform:new s.cj(u),u_raster_elevation:new s.ci(u),u_zoom_transition:new s.ci(u),u_merc_center:new s.cj(u),u_cutoff_params:new s.d2(u),u_colorization_mix:new s.d2(u),u_colorization_offset:new s.ci(u),u_color_ramp:new s.cg(u),u_texture_offset:new s.cj(u),u_texture_res:new s.cj(u),u_emissive_strength:new s.ci(u)}),rasterParticle:u=>({u_matrix:new s.ck(u),u_normalize_matrix:new s.ck(u),u_globe_matrix:new s.ck(u),u_merc_matrix:new s.ck(u),u_grid_matrix:new s.dy(u),u_tl_parent:new s.cj(u),u_scale_parent:new s.ci(u),u_fade_t:new s.ci(u),u_opacity:new s.ci(u),u_image0:new s.cg(u),u_image1:new s.cg(u),u_raster_elevation:new s.ci(u),u_zoom_transition:new s.ci(u),u_merc_center:new s.cj(u),u_cutoff_params:new s.d2(u)}),rasterParticleTexture:u=>({u_texture:new s.cg(u),u_opacity:new s.ci(u)}),rasterParticleDraw:u=>({u_particle_texture:new s.cg(u),u_particle_texture_side_len:new s.ci(u),u_tile_offset:new s.cj(u),u_velocity:new s.cg(u),u_color_ramp:new s.cg(u),u_velocity_res:new s.cj(u),u_max_speed:new s.ci(u),u_uv_offset:new s.cj(u),u_data_scale:new s.cj(u),u_data_offset:new s.ci(u),u_particle_pos_scale:new s.ci(u),u_particle_pos_offset:new s.cj(u)}),rasterParticleUpdate:u=>({u_particle_texture:new s.cg(u),u_particle_texture_side_len:new s.ci(u),u_velocity:new s.cg(u),u_velocity_res:new s.cj(u),u_max_speed:new s.ci(u),u_speed_factor:new s.ci(u),u_reset_rate:new s.ci(u),u_rand_seed:new s.ci(u),u_uv_offset:new s.cj(u),u_data_scale:new s.cj(u),u_data_offset:new s.ci(u),u_particle_pos_scale:new s.ci(u),u_particle_pos_offset:new s.cj(u)}),symbol:u=>({u_is_size_zoom_constant:new s.cg(u),u_is_size_feature_constant:new s.cg(u),u_size_t:new s.ci(u),u_size:new s.ci(u),u_camera_to_center_distance:new s.ci(u),u_rotate_symbol:new s.cg(u),u_aspect_ratio:new s.ci(u),u_fade_change:new s.ci(u),u_matrix:new s.ck(u),u_label_plane_matrix:new s.ck(u),u_coord_matrix:new s.ck(u),u_is_text:new s.cg(u),u_elevation_from_sea:new s.cg(u),u_pitch_with_map:new s.cg(u),u_texsize:new s.cj(u),u_texsize_icon:new s.cj(u),u_texture:new s.cg(u),u_texture_icon:new s.cg(u),u_gamma_scale:new s.ci(u),u_device_pixel_ratio:new s.ci(u),u_tile_id:new s.ch(u),u_zoom_transition:new s.ci(u),u_inv_rot_matrix:new s.ck(u),u_merc_center:new s.cj(u),u_camera_forward:new s.ch(u),u_tile_matrix:new s.ck(u),u_up_vector:new s.ch(u),u_ecef_origin:new s.ch(u),u_is_halo:new s.cg(u),u_icon_transition:new s.ci(u),u_color_adj_mat:new s.ck(u),u_scale_factor:new s.ci(u),u_ground_shadow_factor:new s.ch(u),u_inv_matrix:new s.ck(u),u_normal_scale:new s.ci(u),u_lutTexture:new s.cg(u)}),background:u=>({u_matrix:new s.ck(u),u_emissive_strength:new s.ci(u),u_opacity:new s.ci(u),u_color:new s.dx(u)}),backgroundPattern:u=>({u_matrix:new s.ck(u),u_emissive_strength:new s.ci(u),u_opacity:new s.ci(u),u_image:new s.cg(u),u_pattern_tl:new s.cj(u),u_pattern_br:new s.cj(u),u_texsize:new s.cj(u),u_pattern_size:new s.cj(u),u_pixel_coord_upper:new s.cj(u),u_pixel_coord_lower:new s.cj(u),u_pattern_units_to_pixels:new s.cj(u)}),terrainRaster:u=>({u_matrix:new s.ck(u),u_image0:new s.cg(u),u_skirt_height:new s.ci(u),u_ground_shadow_factor:new s.ch(u)}),skybox:u=>({u_matrix:new s.ck(u),u_sun_direction:new s.ch(u),u_cubemap:new s.cg(u),u_opacity:new s.ci(u),u_temporal_offset:new s.ci(u)}),skyboxGradient:u=>({u_matrix:new s.ck(u),u_color_ramp:new s.cg(u),u_center_direction:new s.ch(u),u_radius:new s.ci(u),u_opacity:new s.ci(u),u_temporal_offset:new s.ci(u)}),skyboxCapture:u=>({u_matrix_3f:new s.dy(u),u_sun_direction:new s.ch(u),u_sun_intensity:new s.ci(u),u_color_tint_r:new s.d2(u),u_color_tint_m:new s.d2(u),u_luminance:new s.ci(u)}),globeRaster:u=>({u_proj_matrix:new s.ck(u),u_globe_matrix:new s.ck(u),u_normalize_matrix:new s.ck(u),u_merc_matrix:new s.ck(u),u_zoom_transition:new s.ci(u),u_merc_center:new s.cj(u),u_image0:new s.cg(u),u_grid_matrix:new s.dy(u),u_skirt_height:new s.ci(u),u_far_z_cutoff:new s.ci(u),u_frustum_tl:new s.ch(u),u_frustum_tr:new s.ch(u),u_frustum_br:new s.ch(u),u_frustum_bl:new s.ch(u),u_globe_pos:new s.ch(u),u_globe_radius:new s.ci(u),u_viewport:new s.cj(u)}),globeAtmosphere:u=>({u_frustum_tl:new s.ch(u),u_frustum_tr:new s.ch(u),u_frustum_br:new s.ch(u),u_frustum_bl:new s.ch(u),u_horizon:new s.ci(u),u_transition:new s.ci(u),u_fadeout_range:new s.ci(u),u_atmosphere_fog_color:new s.d2(u),u_high_color:new s.d2(u),u_space_color:new s.d2(u),u_temporal_offset:new s.ci(u),u_horizon_angle:new s.ci(u)}),model:u=>({u_matrix:new s.ck(u),u_lighting_matrix:new s.ck(u),u_normal_matrix:new s.ck(u),u_node_matrix:new s.ck(u),u_lightpos:new s.ch(u),u_lightintensity:new s.ci(u),u_lightcolor:new s.ch(u),u_camera_pos:new s.ch(u),u_opacity:new s.ci(u),u_baseColorFactor:new s.d2(u),u_emissiveFactor:new s.d2(u),u_metallicFactor:new s.ci(u),u_roughnessFactor:new s.ci(u),u_baseTextureIsAlpha:new s.cg(u),u_alphaMask:new s.cg(u),u_alphaCutoff:new s.ci(u),u_baseColorTexture:new s.cg(u),u_metallicRoughnessTexture:new s.cg(u),u_normalTexture:new s.cg(u),u_occlusionTexture:new s.cg(u),u_emissionTexture:new s.cg(u),u_lutTexture:new s.cg(u),u_color_mix:new s.d2(u),u_aoIntensity:new s.ci(u),u_emissive_strength:new s.ci(u),u_occlusionTextureTransform:new s.d2(u)}),modelDepth:u=>({u_matrix:new s.ck(u),u_instance:new s.ck(u),u_node_matrix:new s.ck(u)}),groundShadow:u=>({u_matrix:new s.ck(u),u_ground_shadow_factor:new s.ch(u)}),stars:u=>({u_matrix:new s.ck(u),u_up:new s.ch(u),u_right:new s.ch(u),u_intensity_multiplier:new s.ci(u)}),snowParticle:u=>({u_modelview:new s.ck(u),u_projection:new s.ck(u),u_time:new s.ci(u),u_cam_pos:new s.ch(u),u_velocityConeAperture:new s.ci(u),u_velocity:new s.ci(u),u_horizontalOscillationRadius:new s.ci(u),u_horizontalOscillationRate:new s.ci(u),u_boxSize:new s.ci(u),u_billboardSize:new s.ci(u),u_simpleShapeParameters:new s.cj(u),u_screenSize:new s.cj(u),u_thinningCenterPos:new s.cj(u),u_thinningShape:new s.ch(u),u_thinningAffectedRatio:new s.ci(u),u_thinningParticleOffset:new s.ci(u),u_particleColor:new s.d2(u),u_direction:new s.ch(u)}),rainParticle:u=>({u_modelview:new s.ck(u),u_projection:new s.ck(u),u_time:new s.ci(u),u_cam_pos:new s.ch(u),u_texScreen:new s.cg(u),u_velocityConeAperture:new s.ci(u),u_velocity:new s.ci(u),u_boxSize:new s.ci(u),u_rainDropletSize:new s.cj(u),u_distortionStrength:new s.ci(u),u_rainDirection:new s.ch(u),u_color:new s.d2(u),u_screenSize:new s.cj(u),u_thinningCenterPos:new s.cj(u),u_thinningShape:new s.ch(u),u_thinningAffectedRatio:new s.ci(u),u_thinningParticleOffset:new s.ci(u),u_shapeDirectionalPower:new s.ci(u),u_shapeNormalPower:new s.ci(u),u_mode:new s.ci(u)}),vignette:u=>({u_vignetteShape:new s.ch(u),u_vignetteColor:new s.d2(u)}),occlusion:u=>({u_matrix:new s.ck(u),u_anchorPos:new s.ch(u),u_screenSizePx:new s.cj(u),u_occluderSizePx:new s.cj(u),u_color:new s.d2(u)})};class Go{constructor(t,n,c,m){this.id=Go.uniqueIdxCounter,Go.uniqueIdxCounter++,this.context=t;const y=t.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||m||n.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Go.uniqueIdxCounter,Go.uniqueIdxCounter++;const n=this.context.gl;this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Go.uniqueIdxCounter=0;const Mh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zf{constructor(t,n,c,m,y,w){this.length=n.length,this.attributes=c,this.itemSize=n.bytesPerElement,this.dynamicDraw=m,this.instanceCount=w,this.context=t;const E=t.gl;this.buffer=E.createBuffer(),t.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||y||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let c=0;c<this.attributes.length;c++){const m=n.getAttributeLocation(t,this.attributes[c].name);m!==-1&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,n,c){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],w=n.getAttributeLocation(t,y.name);w!==-1&&t.vertexAttribPointer(w,y.components,t[Mh[y.type]],!1,this.itemSize,y.offset+this.itemSize*(c||0))}}setVertexAttribDivisor(t,n,c){for(let m=0;m<this.attributes.length;m++){const y=n.getAttributeLocation(t,this.attributes[m].name);y!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(y,c)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ih{constructor(t,n,c,m,y){this.context=t,this.width=n,this.height=c;const w=this.framebuffer=t.gl.createFramebuffer();m&&(this.colorAttachment=new Np(t,w)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new kc(t,w):new Um(t,w))}destroy(){const t=this.context.gl;if(this.colorAttachment){const n=this.colorAttachment.get();n&&t.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}else{const n=this.depthAttachment.get();n&&t.deleteTexture(n)}t.deleteFramebuffer(this.framebuffer)}}class $o{constructor(t,n){this.gl=t,this.clearColor=new hl(this),this.clearDepth=new Vo(this),this.clearStencil=new Su(this),this.colorMask=new Fm(this),this.depthMask=new Dp(this),this.stencilMask=new Pp(this),this.stencilFunc=new Aa(this),this.stencilOp=new ua(this),this.stencilTest=new En(this),this.depthRange=new Ho(this),this.depthTest=new qo(this),this.depthFunc=new vd(this),this.blend=new dl(this),this.blendFunc=new Sf(this),this.blendColor=new Pc(this),this.blendEquation=new fl(this),this.cullFace=new Oc(this),this.cullFaceSide=new jc(this),this.frontFace=new pl(this),this.program=new Op(this),this.activeTexture=new bd(this),this.viewport=new jp(this),this.bindFramebuffer=new Yl(this),this.bindRenderbuffer=new wd(this),this.bindTexture=new Nc(this),this.bindVertexBuffer=new Ef(this),this.bindElementBuffer=new Kl(this),this.bindVertexArrayOES=new Jl(this),this.pixelStoreUnpack=new Td(this),this.pixelStoreUnpackPremultiplyAlpha=new vh(this),this.pixelStoreUnpackFlipY=new Sd(this),this.options=n?Object.assign({},n):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=n&&!!n.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n,c){return new Go(this,t,n,c)}createVertexBuffer(t,n,c,m,y){return new zf(this,t,n,c,m,y)}createRenderbuffer(t,n,c){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,t,n,c),this.bindRenderbuffer.set(null),y}createFramebuffer(t,n,c,m){return new Ih(this,t,n,c,m)}clear({color:t,depth:n,stencil:c,colorMask:m}){const y=this.gl;let w=0;t&&(w|=y.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(m||[!0,!0,!0,!0])),n!==void 0&&(w|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),c!==void 0&&(w|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),y.clear(w)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.by(t.blendFunction,ir.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let uo;function zu(u,t,n,c,m,y,w){const E=u.context,R=E.gl,L=u.transform,P=[s.aF(L.center.lng),s.aJ(L.center.lat)],F=n.layout.get("symbol-placement"),j=n.layout.get("text-variable-anchor"),H=n.layout.get("icon-rotation-alignment")==="map",$=n.layout.get("text-rotation-alignment")==="map",G=F!=="point",te=[];let X=0,re=0;for(let be=0;be<c.length;be++){const Ce=c[be],We=t.getTile(Ce),ke=We.getBucket(n);if(!ke)continue;const ct=ke.getProjection().createInversionMatrix(L,Ce.canonical),Ze=[],ot=ja(Ce,ke,L),Bt=!w&&H&&G,Ye=w&&$&&G,Oe=j&&ke.hasTextData(),nt=ke.hasIconTextFit()&&Oe&&ke.hasIconData(),Ge=Bt||Ye||w&&Oe||nt,ut=ke.projection.name==="globe",_t=ut?s.aj(L.zoom):0;ut&&(Ze.push("PROJECTION_GLOBE_VIEW"),Ge&&Ze.push("PROJECTED_POS_ON_VIEWPORT"));const $t=u.getOrCreateProgram("collisionBox",{defines:Ze});let Rt=ot;m[0]===0&&m[1]===0||(Rt=u.translatePosMatrix(ot,We,m,y));const St=w?ke.textCollisionBox:ke.iconCollisionBox,gi=ke.collisionCircleArray;if(gi.length>0){const ti=s.bC(),ci=Rt;s.cO(ti,ke.placementInvProjMatrix,L.glCoordMatrix),s.cO(ti,ti,ke.placementViewportMatrix),te.push({circleArray:gi,circleOffset:re,transform:ci,invTransform:ti,projection:ke.getProjection()}),X+=gi.length/4,re=X}if(!St)continue;u.terrain&&u.terrain.setupElevationDraw(We,$t);const li=ut?[Ce.canonical.x,Ce.canonical.y,1<<Ce.canonical.z]:[0,0,0];$t.draw(u,R.LINES,ni.disabled,Ii.disabled,u.colorModeForRenderPass(),ki.disabled,Vn(Rt,ct,L,_t,P,We,li,ke.getProjection()),n.id,St.layoutVertexBuffer,St.indexBuffer,St.segments,null,L.zoom,null,[St.collisionVertexBuffer,St.collisionVertexBufferExt])}if(!w||!te.length)return;const ce=u.getOrCreateProgram("collisionCircle"),fe=new s.dW;fe.resize(4*X),fe._trim();let Te=0;for(const be of te)for(let Ce=0;Ce<be.circleArray.length/4;Ce++){const We=4*Ce,ke=be.circleArray[We+0],ct=be.circleArray[We+1],Ze=be.circleArray[We+2],ot=be.circleArray[We+3];fe.emplace(Te++,ke,ct,Ze,ot,0),fe.emplace(Te++,ke,ct,Ze,ot,1),fe.emplace(Te++,ke,ct,Ze,ot,2),fe.emplace(Te++,ke,ct,Ze,ot,3)}(!uo||uo.length<2*X)&&(uo=function(be){const Ce=2*be,We=new s.b1;We.resize(Ce),We._trim();for(let ke=0;ke<Ce;ke++){const ct=6*ke;We.uint16[ct+0]=4*ke+0,We.uint16[ct+1]=4*ke+1,We.uint16[ct+2]=4*ke+2,We.uint16[ct+3]=4*ke+2,We.uint16[ct+4]=4*ke+3,We.uint16[ct+5]=4*ke+0}return We}(X));const we=E.createIndexBuffer(uo,!0),Ee=E.createVertexBuffer(fe,s.dX.members,!0);for(const be of te){const Ce={u_matrix:be.transform,u_inv_matrix:be.invTransform,u_camera_to_center_distance:(ve=L).getCameraToCenterDistance(be.projection),u_viewport_size:[ve.width,ve.height]};ce.draw(u,R.TRIANGLES,ni.disabled,Ii.disabled,u.colorModeForRenderPass(),ki.disabled,Ce,n.id,Ee,we,s.bg.simpleSegment(0,2*be.circleOffset,be.circleArray.length,be.circleArray.length/2),null,L.zoom)}var ve;Ee.destroy(),we.destroy()}const xl=s.bC();function Lf(u){const t=u._camera.getWorldToCamera(u.worldSize,1),n=s.aB([],t,u.globeMatrix);s.bl(n,n);const c=[0,0,0],m=[0,1,0,0];return s.aC(m,m,n),c[0]=m[0],c[1]=m[1],c[2]=m[2],s.aw(c,c),c}function Id({width:u,height:t,anchor:n,textOffset:c,textScale:m},y){const{horizontalAlign:w,verticalAlign:E}=s.c0(n),R=-(w-.5)*u,L=-(E-.5)*t,P=s.c1(n,c);return new s.P((R/m+P[0])*y,(L/m+P[1])*y)}function zd(u,t,n,c,m,y,w,E,R,L){const P=u.text.placedSymbolArray,F=u.text.dynamicLayoutVertexArray,j=u.icon.dynamicLayoutVertexArray,H={},$=u.getProjection(),G=no(w,$,m),te=m.elevation,X=$.upVectorScale(w.canonical,m.center.lat,m.worldSize).metersToTile;F.clear();for(let re=0;re<P.length;re++){const ce=P.get(re),{tileAnchorX:fe,tileAnchorY:Te,numGlyphs:we}=ce,Ee=ce.hidden||!ce.crossTileID||u.allowVerticalPlacement&&!ce.placedOrientation?null:c[ce.crossTileID];if(Ee){let ve=0,be=0,Ce=0;if(te){const nt=te?te.getAtTileOffset(w,fe,Te):0,[Ge,ut,_t]=$.upVector(w.canonical,fe,Te);ve=nt*Ge*X,be=nt*ut*X,Ce=nt*_t*X}let[We,ke,ct,Ze]=Za(ce.projectedAnchorX+ve,ce.projectedAnchorY+be,ce.projectedAnchorZ+Ce,n?G:y);const ot=fu(m.getCameraToCenterDistance($),Ze);let Bt=s.bM(u.textSizeData,R,ce)*ot/s.bX;n&&(Bt*=u.tilePixelRatio/E);const Ye=Id(Ee,Bt);n?({x:We,y:ke,z:ct}=$.projectTilePoint(fe+Ye.x,Te+Ye.y,w.canonical),[We,ke,ct]=Za(We+ve,ke+be,ct+Ce,y)):(t&&Ye._rotate(-m.angle),We+=Ye.x,ke+=Ye.y,ct=0);const Oe=u.allowVerticalPlacement&&ce.placedOrientation===s.bL.vertical?Math.PI/2:0;for(let nt=0;nt<we;nt++)s.bO(F,We,ke,ct,Oe);L&&ce.associatedIconIndex>=0&&(H[ce.associatedIconIndex]={x:We,y:ke,z:ct,angle:Oe})}else Li(we,F)}if(L){j.clear();const re=u.icon.placedSymbolArray;for(let ce=0;ce<re.length;ce++){const fe=re.get(ce),{numGlyphs:Te}=fe,we=H[ce];if(fe.hidden||!we)Li(Te,j);else{const{x:Ee,y:ve,z:be,angle:Ce}=we;for(let We=0;We<Te;We++)s.bO(j,Ee,ve,be,Ce)}}u.icon.dynamicLayoutVertexBuffer.updateData(j)}u.text.dynamicLayoutVertexBuffer.updateData(F)}function zh(u,t,n,c,m,y,w={}){const E=n.paint.get("icon-translate"),R=n.paint.get("text-translate"),L=n.paint.get("icon-translate-anchor"),P=n.paint.get("text-translate-anchor"),F=n.layout.get("icon-rotation-alignment"),j=n.layout.get("text-rotation-alignment"),H=n.layout.get("icon-pitch-alignment"),$=n.layout.get("text-pitch-alignment"),G=n.layout.get("icon-keep-upright"),te=n.layout.get("text-keep-upright"),X=n.paint.get("icon-color-saturation"),re=n.paint.get("icon-color-contrast"),ce=n.paint.get("icon-color-brightness-min"),fe=n.paint.get("icon-color-brightness-max"),Te=n.layout.get("symbol-elevation-reference")==="sea",we=n.layout.get("icon-image-use-theme")==="none",Ee=u.context,ve=Ee.gl,be=u.transform,Ce=F==="map",We=j==="map",ke=H==="map",ct=$==="map",Ze=n.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ot=!1;const Bt=u.depthModeForSublayer(0,ni.ReadOnly),Ye=new ni(u.context.gl.LEQUAL,ni.ReadOnly,u.depthRangeFor3D),Oe=[s.aF(be.center.lng),s.aJ(be.center.lat)],nt=n.layout.get("text-variable-anchor"),Ge=be.projection.name==="globe",ut=[],_t=[0,-1,0];for(const $t of c){const Rt=t.getTile($t),St=Rt.getBucket(n);if(!St||St.projection.name==="mercator"&&Ge||St.fullyClipped)continue;const gi=St.projection.name==="globe",li=gi?s.aj(be.zoom):0,ti=no($t,St.getProjection(),be),ci=be.calculatePixelsToTileUnitsMatrix(Rt),Oi=nt&&St.hasTextData(),Ki=St.hasIconTextFit()&&Oi&&St.hasIconData(),Hi=St.getProjection().createInversionMatrix(be,$t.canonical),jr=(1<<Rt.tileID.canonical.z)*s.al/u.transform.worldSize,qi=gn=>{let Ji=[0,0,0];if(gn){const Di=u.style.directionalLight,wr=u.style.ambientLight;Di&&wr&&(Ji=To(u.style,Di,wr))}return Ji},yr=gn=>{be.depthOcclusionForSymbolsAndCircles&&(n.hasOcclusionOpacityProperties||u.terrain)&&(gn.push("DEPTH_D24"),gn.push("DEPTH_OCCLUSION"))},Ur=gn=>{n.lut&&!we&&(n.lut.texture||(n.lut.texture=new s.dY(u.context,n.lut.image,[n.lut.image.height,n.lut.image.height,n.lut.image.height],Ee.gl.RGBA8)),Ee.activeTexture.set(Ee.gl.TEXTURE0+Qn.LUT),n.lut.texture&&n.lut.texture.bind(Ee.gl.LINEAR,Ee.gl.CLAMP_TO_EDGE),gn.push("APPLY_LUT_ON_GPU"))},fn=()=>{const gn=Ce&&n.layout.get("symbol-placement")!=="point",Ji=[];yr(Ji),Ur(Ji);const Di=gn||Ki,wr=St.elevationType==="road",jn=u.shadowRenderer,Vr=wr&&ke&&!!jn&&jn.enabled,es=qi(Vr),ws=wr&&ke&&!u.terrain?Ye:Bt,Ja=n.paint.get("icon-image-cross-fade");u.terrainRenderModeElevated()&&ke&&Ji.push("PITCH_WITH_MAP_TERRAIN"),gi&&(Ji.push("PROJECTION_GLOBE_VIEW"),Di&&Ji.push("PROJECTED_POS_ON_VIEWPORT")),Ja>0&&St.hasAnySecondaryIcon&&Ji.push("ICON_TRANSITION"),!St.icon.zOffsetVertexBuffer||wr&&u.terrain||Ji.push("Z_OFFSET"),X===0&&re===0&&ce===0&&fe===1||Ji.push("COLOR_ADJUSTMENT"),St.sdfIcons&&Ji.push("RENDER_SDF"),Vr&&Ji.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),wr&&ke&&!u.terrain&&St.icon.orientationVertexBuffer&&Ji.push("ELEVATED_ROADS");const mo=St.icon.programConfigurations.get(n.id),Ts=u.getOrCreateProgram("symbol",{config:mo,defines:Ji}),ga=Rt.imageAtlasTexture?Rt.imageAtlasTexture.size:[0,0],ta=St.iconSizeData,_a=s.bK(ta,be.zoom),zo=ke||!be.isOrthographic,Bn=so(ti,Rt.tileID.canonical,ke,Ce,be,St.getProjection(),ci),Hn=du(ti,Rt.tileID.canonical,ke,Ce,be,St.getProjection(),ci),vn=u.translatePosMatrix(Hn,Rt,E,L,!0),ss=u.translatePosMatrix(ti,Rt,E,L),Ss=Di?xl:Bn,ts=Ce&&!ke&&!gn;let ia=_t;!Ge&&!be.mercatorFromTransition||Ce||(ia=Lf(be));const tl=gi?ia:_t,Cl=n.getColorAdjustmentMatrix(X,re,ce,fe),Ca=Mf(ta.kind,_a,ts,ke,u,ss,Ss,vn,Te,!1,ga,[0,0],0,$t,li,Oe,Hi,tl,St.getProjection(),es,jr,Cl,Ja,null),il=Rt.imageAtlasTexture?Rt.imageAtlasTexture:null,pc=n.layout.get("icon-size").constantOr(0)!==1||St.iconsNeedLinear,rl=St.sdfIcons||u.options.rotating||u.options.zooming||pc||zo?ve.LINEAR:ve.NEAREST,Zh=St.sdfIcons&&n.paint.get("icon-halo-width").constantOr(1)!==0,Rl=u.terrain&&ke&&gn?s.bl(s.bC(),Bn):xl;if(gn&&St.icon){const Ha=be.elevation,Ml=Ha?Ha.getAtTileOffsetFunc($t,be.center.lat,be.worldSize,St.getProjection()):null,qn=Fl(ti,Rt.tileID.canonical,ke,Ce,be,St.getProjection(),ci);Tp(St,ti,u,!1,qn,Hn,ke,G,Ml,$t)}return{program:Ts,buffers:St.icon,uniformValues:Ca,atlasTexture:il,atlasTextureIcon:null,atlasInterpolation:rl,atlasInterpolationIcon:null,isSDF:St.sdfIcons,hasHalo:Zh,depthMode:ws,tile:Rt,renderWithShadows:Vr,labelPlaneMatrixInv:Rl}},Yi=()=>{const gn=We&&n.layout.get("symbol-placement")!=="point",Ji=[],Di=gn||nt||Ki,wr=St.elevationType==="road",jn=u.shadowRenderer,Vr=wr&&ct&&!!jn&&jn.enabled,es=qi(Vr),ws=wr&&ct&&!u.terrain?Ye:Bt;u.terrainRenderModeElevated()&&ct&&Ji.push("PITCH_WITH_MAP_TERRAIN"),gi&&(Ji.push("PROJECTION_GLOBE_VIEW"),Di&&Ji.push("PROJECTED_POS_ON_VIEWPORT")),!St.text.zOffsetVertexBuffer||wr&&u.terrain||Ji.push("Z_OFFSET"),St.iconsInText&&Ji.push("RENDER_TEXT_AND_SYMBOL"),Ji.push("RENDER_SDF"),Vr&&Ji.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),wr&&ct&&!u.terrain&&St.text.orientationVertexBuffer&&Ji.push("ELEVATED_ROADS"),yr(Ji);const Ja=St.text.programConfigurations.get(n.id),mo=u.getOrCreateProgram("symbol",{config:Ja,defines:Ji});let Ts,ga=[0,0],ta=null;const _a=St.textSizeData;St.iconsInText&&(ga=Rt.imageAtlasTexture?Rt.imageAtlasTexture.size:[0,0],ta=Rt.imageAtlasTexture?Rt.imageAtlasTexture:null,Ts=ct||!be.isOrthographic||u.options.rotating||u.options.zooming||_a.kind==="composite"||_a.kind==="camera"?ve.LINEAR:ve.NEAREST);const zo=Rt.glyphAtlasTexture?Rt.glyphAtlasTexture.size:[0,0],Bn=n.layout.get("text-size-scale-range"),Hn=s.aA(u.scaleFactor,Bn[0],Bn[1]),vn=s.bK(_a,be.zoom,Hn),ss=so(ti,Rt.tileID.canonical,ct,We,be,St.getProjection(),ci),Ss=du(ti,Rt.tileID.canonical,ct,We,be,St.getProjection(),ci),ts=u.translatePosMatrix(Ss,Rt,R,P,!0),ia=u.translatePosMatrix(ti,Rt,R,P),tl=Di?xl:ss,Cl=We&&!ct&&!gn;let Ca=_t;!Ge&&!be.mercatorFromTransition||We||(Ca=Lf(be));const il=Mf(_a.kind,vn,Cl,ct,u,ia,tl,ts,Te,!0,zo,ga,0,$t,li,Oe,Hi,gi?Ca:_t,St.getProjection(),es,jr,null,null,Hn),pc=Rt.glyphAtlasTexture?Rt.glyphAtlasTexture:null,rl=ve.LINEAR,Zh=n.paint.get("text-halo-width").constantOr(1)!==0,Rl=u.terrain&&ct&&gn?s.bl(s.bC(),ss):xl;if(gn&&St.text){const Ha=be.elevation,Ml=Ha?Ha.getAtTileOffsetFunc($t,be.center.lat,be.worldSize,St.getProjection()):null,qn=Fl(ti,Rt.tileID.canonical,ct,We,be,St.getProjection(),ci);Tp(St,ti,u,!0,qn,Ss,ct,te,Ml,$t)}return{program:mo,buffers:St.text,uniformValues:il,atlasTexture:pc,atlasTextureIcon:ta,atlasInterpolation:rl,atlasInterpolationIcon:Ts,isSDF:!0,hasHalo:Zh,depthMode:ws,tile:Rt,renderWithShadows:Vr,labelPlaneMatrixInv:Rl}},Or=St.icon.segments.get().length,Tr=St.text.segments.get().length,Nr=Or&&!w.onlyText?fn():null,nn=Tr&&!w.onlyIcons?Yi():null,zn=n.paint.get("icon-opacity").constantOr(1),us=n.paint.get("text-opacity").constantOr(1);if(Ze&&St.canOverlap){ot=!0;const gn=zn&&!w.onlyText?St.icon.segments.get():[],Ji=us&&!w.onlyIcons?St.text.segments.get():[];for(const Di of gn)ut.push({segments:new s.bg([Di]),sortKey:Di.sortKey,state:Nr});for(const Di of Ji)ut.push({segments:new s.bg([Di]),sortKey:Di.sortKey,state:nn})}else w.onlyText||ut.push({segments:zn?St.icon.segments:new s.bg([]),sortKey:0,state:Nr}),w.onlyIcons||ut.push({segments:us?St.text.segments:new s.bg([]),sortKey:0,state:nn})}ot&&ut.sort(($t,Rt)=>$t.sortKey-Rt.sortKey);for(const $t of ut){const Rt=$t.state;if(Rt)if(u.terrain?u.terrain.setupElevationDraw(Rt.tile,Rt.program,{useDepthForOcclusion:be.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Rt.labelPlaneMatrixInv}):u.setupDepthForOcclusion(be.depthOcclusionForSymbolsAndCircles,Rt.program),Ee.activeTexture.set(ve.TEXTURE0),Rt.atlasTexture&&Rt.atlasTexture.bind(Rt.atlasInterpolation,ve.CLAMP_TO_EDGE,!0),Rt.atlasTextureIcon&&(Ee.activeTexture.set(ve.TEXTURE1),Rt.atlasTextureIcon&&Rt.atlasTextureIcon.bind(Rt.atlasInterpolationIcon,ve.CLAMP_TO_EDGE,!0)),Rt.renderWithShadows&&u.shadowRenderer.setupShadows(Rt.tile.tileID.toUnwrapped(),Rt.program,"vector-tile"),u.uploadCommonLightUniforms(u.context,Rt.program),Rt.hasHalo){const St=Rt.uniformValues;St.u_is_halo=1,Ld(Rt.buffers,$t.segments,n,u,Rt.program,Rt.depthMode,m,y,St,2),St.u_is_halo=0}else{if(Rt.isSDF){const St=Rt.uniformValues;Rt.hasHalo&&(St.u_is_halo=1,Ld(Rt.buffers,$t.segments,n,u,Rt.program,Rt.depthMode,m,y,St,1)),St.u_is_halo=0}Ld(Rt.buffers,$t.segments,n,u,Rt.program,Rt.depthMode,m,y,Rt.uniformValues,1)}}}function Ld(u,t,n,c,m,y,w,E,R,L){const P=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.iconTransitioningVertexBuffer,u.globeExtVertexBuffer,u.zOffsetVertexBuffer,u.orientationVertexBuffer];m.draw(c,c.context.gl.TRIANGLES,y,w,E,ki.disabled,R,n.id,u.layoutVertexBuffer,u.indexBuffer,t,n.paint,c.transform.zoom,u.programConfigurations.get(n.id),P,L)}function Fp(u,t){const n=1<<u.canonical.z,c=(t.x*n-u.canonical.x-u.wrap*n)*s.al,m=(t.y*n-u.canonical.y)*s.al,y=s.e5(t.z,t.y);return s.d4(c,m,y)}function rc(u,t,n,c,m){if(!n.layout||n.layout.get("fill-elevation-reference")==="none")return;const y=u.context.gl,w=new ni(u.context.gl.LEQUAL,ni.ReadWrite,u.depthRangeFor3D),E=new ni(u.context.gl.GREATER,ni.ReadWrite,u.depthRangeFor3D),R=function(H){let $=.01;return H.isOrthographic&&($=s.ak(1e-4,$,s.c$(H.pitch>=Gl?1:H.pitch/Gl))),2*$}(u.transform),L=u.transform.getFreeCameraOptions().position,P="elevatedStructuresDepthReconstruct",F=u.getOrCreateProgram(P,{defines:["DEPTH_RECONSTRUCTION"]}),j=u.getOrCreateProgram(P);for(const H of c){const $=t.getTile(H),G=$.getBucket(n);if(!G)continue;const te=G.elevatedStructures;if(!te)continue;const X=G.elevationBufferData.heightRange,re=Fp(H.toUnwrapped(),L),ce=u.translatePosMatrix(H.projMatrix,$,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));let fe,Te,we,Ee;if(m==="initialize"){if(!X||X.min>=1||te.depthSegments.segments[0].primitiveLength===0)continue;fe=Ru(ce,re,R,1,0),Te=w,we=te.depthSegments,Ee=F}else if(m==="reset"){if(!X||X.min>=0||te.maskSegments.segments[0].primitiveLength===0)continue;fe=Ru(ce,re,0,0,1),Te=E,we=te.maskSegments,Ee=F}else if(m==="geometry"){if(te.depthSegments.segments[0].primitiveLength===0)continue;fe=Ru(ce,re,R,1,0),Te=w,we=te.depthSegments,Ee=j}Ee.draw(u,y.TRIANGLES,Te,Ii.disabled,ir.disabled,ki.disabled,fe,n.id,te.vertexBuffer,te.indexBuffer,we,n.paint,u.transform.zoom)}}function Lu(u,t,n){const{painter:c,sourceCache:m,layer:y,coords:w,colorMode:E,elevationType:R,terrainEnabled:L,pass:P}=u,F=c.context.gl,j=y.paint.get("fill-pattern"),H=y.paint.get("fill-pattern-cross-fade"),$=j.constantOr(null);let G=R;R!=="road"||t&&!L||(G="none");const te=G==="road",X=u.painter.shadowRenderer,re=te&&!!X&&X.enabled,ce=new ni(c.context.gl.LEQUAL,ni.ReadOnly,c.depthRangeFor3D);let fe=[0,0,0];if(re){const Ee=c.style.directionalLight,ve=c.style.ambientLight;Ee&&ve&&(fe=To(c.style,Ee,ve))}const Te=j&&j.constantOr(1),we=(Ee,ve)=>{let be,Ce,We,ke,ct;ve?(be=Te&&!y.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",We=F.LINES):(be=Te?"fillPattern":"fill",We=F.TRIANGLES);for(const Ze of w){const ot=m.getTile(Ze);if(Te&&!ot.patternsLoaded())continue;const Bt=ot.getBucket(y);if(!Bt)continue;const Ye=t?Bt.elevationBufferData:Bt.bufferData;if(Ye.isEmpty())continue;c.prepareDrawTile();const Oe=Ye.programConfigurations.get(y.id),nt=c.isTileAffectedByFog(Ze),Ge=[],ut=[];te&&(Ge.push("ELEVATED_ROADS"),ut.push(Ye.elevatedLayoutVertexBuffer)),re&&Ge.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Te&&(c.context.activeTexture.set(F.TEXTURE0),ot.imageAtlasTexture&&ot.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Oe.updatePaintBuffers());let _t=!1;if($&&ot.imageAtlas){const li=ot.imageAtlas,ti=s.e0.from($),ci=ti.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),Oi=ti.getSecondary(),Ki=li.patternPositions.get(ci),Hi=Oi?li.patternPositions.get(Oi.scaleSelf(s.o.devicePixelRatio).toString()):null;_t=!!Ki&&!!Hi,Ki&&Oe.setConstantPatternPositions(Ki,Hi)}H>0&&(_t||Oe.getPatternTransitionVertexBuffer("fill-pattern"))&&Ge.push("FILL_PATTERN_TRANSITION");const $t=c.getOrCreateProgram(be,{config:Oe,overrideFog:nt,defines:Ge}),Rt=c.translatePosMatrix(Ze.projMatrix,ot,y.paint.get("fill-translate"),y.paint.get("fill-translate-anchor"));re&&X.setupShadows(ot.tileID.toUnwrapped(),$t,"vector-tile");const St=y.paint.get("fill-emissive-strength");if(ve){ke=Ye.lineIndexBuffer,ct=Ye.lineSegments;const li=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[F.drawingBufferWidth,F.drawingBufferHeight];Ce=be==="fillOutlinePattern"&&Te?Cu(Rt,St,c,ot,li,fe,H):Hm(Rt,St,li,fe)}else ke=Ye.indexBuffer,ct=Ye.triangleSegments,Ce=Te?Au(Rt,St,c,ot,fe,H):Cf(Rt,St,fe);c.uploadCommonUniforms(c.context,$t,Ze.toUnwrapped());let gi=Ee;(R==="road"&&!L||R==="offset")&&(gi=ce),$t.draw(c,We,gi,n||c.stencilModeForClipping(Ze),E,ki.disabled,Ce,y.id,Ye.layoutVertexBuffer,ke,ct,y.paint,c.transform.zoom,Oe,ut)}};c.renderPass===P&&we(c.depthModeForSublayer(1,c.renderPass==="opaque"?ni.ReadWrite:ni.ReadOnly),!1),G==="none"&&c.renderPass==="translucent"&&y.paint.get("fill-antialias")&&we(c.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,ni.ReadOnly),!0)}function si(u,t,n,c,m,y,w,E){n.resetLayerRenderingStats(u);const R=u.context,L=R.gl,P=u.transform,F=n.paint.get("fill-extrusion-pattern"),j=n.paint.get("fill-extrusion-pattern-cross-fade"),H=F.constantOr(null),$=F.constantOr(1),G=n.paint.get("fill-extrusion-opacity"),te=u.style.enable3dLights(),X=n.paint.get(te&&!$?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),re=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),X],ce=n.layout.get("fill-extrusion-edge-radius"),fe=ce>0&&!n.paint.get("fill-extrusion-rounded-roof"),Te=fe?0:ce,we=P.projection.name==="globe"?s.e8():0,Ee=P.projection.name==="globe",ve=Ee?s.aj(P.zoom):0,be=[s.aF(P.center.lng),s.aJ(P.center.lat)],Ce=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",We=n.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ce?null:n.lut).toArray01().slice(0,3),ke=n.paint.get("fill-extrusion-flood-light-intensity"),ct=n.paint.get("fill-extrusion-vertical-scale"),Ze=n.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ot=n.paint.get("fill-extrusion-height-alignment"),Bt=n.paint.get("fill-extrusion-base-alignment"),Ye=zc(u,n.paint.get("fill-extrusion-cutoff-fade-range")),Oe=[];let nt;Ee&&Oe.push("PROJECTION_GLOBE_VIEW"),re[0]>0&&Oe.push("FAUX_AO"),fe&&Oe.push("ZERO_ROOF_RADIUS"),E&&Oe.push("HAS_CENTROID"),ke>0&&Oe.push("FLOOD_LIGHT"),Ye.shouldRenderCutoff&&Oe.push("RENDER_CUTOFF"),Ze&&Oe.push("RENDER_WALL_MODE");const Ge=u.renderPass==="shadow",ut=u.shadowRenderer,_t=Ge&&!!ut,$t=Ge?ki.disabled:ki.backCCW;u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0);let Rt=[0,0,0];if(ut){const li=u.style.directionalLight,ti=u.style.ambientLight;li&&ti&&(Rt=To(u.style,li,ti)),Ge||(Oe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ut.useNormalOffset&&Oe.push("NORMAL_OFFSET")),nt=Oe.concat(["SHADOWS_SINGLE_CASCADE"])}const St=_t?"fillExtrusionDepth":$?"fillExtrusionPattern":"fillExtrusion",gi=n.getLayerRenderingStats();for(const li of c){const ti=t.getTile(li),ci=ti.getBucket(n);if(!ci||ci.projection.name!==P.projection.name)continue;let Oi=!1;ut&&(Oi=ut.getMaxCascadeForTile(li.toUnwrapped())===0);const Ki=u.isTileAffectedByFog(li),Hi=ci.programConfigurations.get(n.id);let jr=!1;if(H&&ti.imageAtlas){const Tr=ti.imageAtlas,Nr=s.e0.from(H),nn=Nr.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),zn=Nr.getSecondary(),us=Tr.patternPositions.get(nn),gn=zn?Tr.patternPositions.get(zn.scaleSelf(s.o.devicePixelRatio).toString()):null;jr=!!us&&!!gn,us&&Hi.setConstantPatternPositions(us,gn)}j>0&&(jr||Hi.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Oe.push("FILL_EXTRUSION_PATTERN_TRANSITION");const qi=u.getOrCreateProgram(St,{config:Hi,defines:Oi?nt:Oe,overrideFog:Ki});if(u.terrain&&u.terrain.setupElevationDraw(ti,qi,{useMeterToDem:!0}),!ci.centroidVertexBuffer){const Tr=qi.getAttributeLocation(L,"a_centroid_pos");Tr!==-1&&L.vertexAttrib2f(Tr,0,0)}!Ge&&ut&&ut.setupShadows(ti.tileID.toUnwrapped(),qi,"vector-tile"),$&&(u.context.activeTexture.set(L.TEXTURE0),ti.imageAtlasTexture&&ti.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Hi.updatePaintBuffers());const yr=n.paint.get("fill-extrusion-vertical-gradient"),Ur=1/ci.tileToMeter;let fn;if(Ge&&ut){if(Up(ti.tileID,ci.maxHeight,u))continue;const Tr=ut.calculateShadowPassMatrixFromTile(ti.tileID.toUnwrapped());fn=Uc(Tr,Te,Ur,ct,ot,Bt)}else{const Tr=u.translatePosMatrix(li.expandedProjMatrix,ti,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Nr=P.projection.createInversionMatrix(P,li.canonical);fn=$?Vm(Tr,u,yr,G,re,Te,Ur,li,ti,we,ot,Bt,ve,be,Nr,We,ct,j):yl(Tr,u,yr,G,re,Te,Ur,li,we,ot,Bt,ve,be,Nr,We,ct,ke,Rt)}u.uploadCommonUniforms(R,qi,li.toUnwrapped(),null,Ye);let Yi=ci.segments;if(P.projection.name==="mercator"&&!Ge&&(Yi=ci.getVisibleSegments(ti.tileID,u.terrain,u.transform.getFrustum(0)),!Yi.get().length))continue;if(gi)if(Ge)for(const Tr of Yi.get())gi.numRenderedVerticesInShadowPass+=Tr.primitiveLength;else for(const Tr of Yi.get())gi.numRenderedVerticesInTransparentPass+=Tr.primitiveLength;const Or=[];(u.terrain||E)&&Or.push(ci.centroidVertexBuffer),Ee&&Or.push(ci.layoutVertexExtBuffer),Ze&&Or.push(ci.wallVertexBuffer),qi.draw(u,R.gl.TRIANGLES,m,y,w,$t,fn,n.id,ci.layoutVertexBuffer,ci.indexBuffer,Yi,n.paint,u.transform.zoom,Hi,Or)}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1)}class Df{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function vl(u,t,n,c,m,y,w,E,R,L,P,F,j,H,$,G,te,X,re,ce){const fe=t.context,Te=fe.gl,we=t.transform,Ee=t.transform.zoom,ve=[],be=u.translate,Ce=u.translateAnchor,We=u.edgeRadius,ke=zc(t,u.cutoffFadeRange);P==="clear"?(ve.push("CLEAR_SUBPASS"),ce&&(ve.push("CLEAR_FROM_TEXTURE"),fe.activeTexture.set(Te.TEXTURE0),ce.bind(Te.LINEAR,Te.CLAMP_TO_EDGE))):P==="sdf"&&ve.push("SDF_SUBPASS"),X&&ve.push("HAS_CENTROID"),ke.shouldRenderCutoff&&ve.push("RENDER_CUTOFF");const ct=(Ze,ot,Bt,Ye,Oe)=>{const nt=ot.programConfigurations.get(c.id),Ge=t.isTileAffectedByFog(Ze),ut=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:nt,defines:ve,overrideFog:Ge}),_t=((Rt,St,gi,li,ti,ci,Oi,Ki,Hi,jr,qi)=>({u_matrix:St,u_opacity:gi,u_ao_pass:li?1:0,u_meter_to_tile:ti,u_ao:ci,u_flood_light_intensity:Oi,u_flood_light_color:Ki,u_attenuation:Hi,u_edge_radius:jr,u_fb:0,u_fb_size:qi,u_dynamic_offset:1}))(0,Ye,F,L,Oe,[j,H*Oe],$,G,te,Ee>=17?0:We*Oe,ce?ce.size[0]:0),$t=[];X&&$t.push(ot.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(fe,ut,Ze.toUnwrapped(),null,ke),ut.draw(t,fe.gl.TRIANGLES,y,w,E,R,_t,c.id,ot.vertexBuffer,ot.indexBuffer,Bt,c.paint,Ee,nt,$t)};for(const Ze of m){const ot=n.getTile(Ze),Bt=ot.getBucket(c);if(!Bt||Bt.projection.name!==we.projection.name||!Bt.groundEffect||Bt.groundEffect&&!Bt.groundEffect.hasData())continue;const Ye=Bt.groundEffect,Oe=1/Bt.tileToMeter;{const nt=t.translatePosMatrix(Ze.projMatrix,ot,be,Ce),Ge=Ye.getDefaultSegment();ct(Ze,Ye,Ge,nt,Oe)}if(re)for(let nt=0;nt<4;nt++){const Ge=s.e6[nt](Ze),ut=n.getTile(Ge);if(!ut)continue;const _t=ut.getBucket(c);if(!_t||_t.projection.name!==we.projection.name||!_t.groundEffect||_t.groundEffect&&!_t.groundEffect.hasData())continue;const $t=_t.groundEffect;let Rt,St;nt===0?(Rt=[-s.al,0,0],St=1):nt===1?(Rt=[s.al,0,0],St=0):nt===2?(Rt=[0,-s.al,0],St=3):(Rt=[0,s.al,0],St=2);const gi=$t.regionSegments[St];if(!gi)continue;const li=new Float32Array(16);s.br(li,Ze.projMatrix,Rt),ct(Ze,$t,gi,t.translatePosMatrix(li,ot,be,Ce),Oe)}}}function nc(u,t,n,c,m,y,w){c.centroidVertexArray.length===0&&c.createCentroidsBuffer();const E=y?y.findDEMTileFor(n):null;if(!(E&&E.dem||w))return;y&&E&&E.dem&&c.selfDEMTileTimestamp!==E.dem._timestamp&&(c.borderDoneWithNeighborZ=[-1,-1,-1,-1],c.selfDEMTileTimestamp=E.dem._timestamp);const R=X=>new s.P(Math.ceil((X+s.ea)*s.eb),0),L=X=>{const re=t.getSource().minzoom,ce=Te=>{const we=t.getTileByID(Te);if(we&&we.hasData())return we.getBucket(m)},fe=[0,-1,1];for(const Te of fe){if(X.overscaledZ+Te<re)continue;const we=ce(X.calculateScaledKey(X.overscaledZ+Te));if(we)return we}},P=[0,0,0],F=(X,re)=>(P[0]=Math.min(X.min.y,re.min.y),P[1]=Math.max(X.max.y,re.max.y),P[2]=s.al-re.min.x>X.max.x?re.min.x-s.al:X.max.x,P),j=(X,re)=>(P[0]=Math.min(X.min.x,re.min.x),P[1]=Math.max(X.max.x,re.max.x),P[2]=s.al-re.min.y>X.max.y?re.min.y-s.al:X.max.y,P),H=[(X,re)=>F(X,re),(X,re)=>F(re,X),(X,re)=>j(X,re),(X,re)=>j(re,X)],$=(X,re,ce,fe,Te,we,Ee)=>{if(!y)return 0;const ve=[[we?ce:X,we?X:ce,0],[we?ce:re,we?re:ce,0]],be=Ee<0?s.al+Ee:Ee,Ce=[we?be:(X+re)/2,we?(X+re)/2:be,0];return ce===0&&Ee<0||ce!==0&&Ee>0?y.getForTilePoints(Te,[Ce],!0,fe):ve.push(Ce),y.getForTilePoints(n,ve,!0,E),Math.max(ve[0][2],ve[1][2],Ce[2])/y.exaggeration()};for(let X=0;X<4;X++){const re=c.borderFeatureIndices[X];if(re.length===0)continue;const ce=s.e6[X](n),fe=L(ce);if(!(fe&&fe instanceof s.e7))continue;const Te=y?y.findDEMTileFor(ce):null;if(!(Te&&Te.dem||w)||(y&&Te&&Te.dem&&c.borderDEMTileTimestamp[X]!==Te.dem._timestamp&&(c.borderDoneWithNeighborZ[X]=-1,c.borderDEMTileTimestamp[X]=Te.dem._timestamp),c.borderDoneWithNeighborZ[X]===fe.canonical.z))continue;fe.centroidVertexArray.length===0&&fe.createCentroidsBuffer();const we=(X<2?1:5)-X,Ee=fe.borderDoneWithNeighborZ[we]!==c.canonical.z,ve=fe.borderFeatureIndices[we];let be=0;if(c.canonical.z!==fe.canonical.z){for(const Ce of re)c.showCentroid(c.featuresOnBorder[Ce]);if(Ee)for(const Ce of ve)fe.showCentroid(fe.featuresOnBorder[Ce]);c.borderDoneWithNeighborZ[X]=fe.canonical.z,fe.borderDoneWithNeighborZ[we]=c.canonical.z}for(const Ce of re){const We=c.featuresOnBorder[Ce],ke=c.centroidData[We.centroidDataIndex],ct=We.borders[X];let Ze;for(;be<ve.length;){Ze=fe.featuresOnBorder[ve[be]];const ot=Ze.borders[we];if(ot[1]>ct[0]+3||ot[0]>ct[0]-3)break;fe.showCentroid(Ze),be++}if(Ze&&be<ve.length){const ot=be;let Bt=0;for(;!(Ze.borders[we][0]>ct[1]-3)&&(Bt++,++be!==ve.length);)Ze=fe.featuresOnBorder[ve[be]];Ze=fe.featuresOnBorder[ve[ot]];let Ye=!1;if(Bt>=1){const Ge=Ze.borders[we];Math.abs(ct[0]-Ge[0])<3&&Math.abs(ct[1]-Ge[1])<3&&(Bt=1,Ye=!0,be=ot+1)}else if(Bt===0){c.showCentroid(We);continue}const Oe=fe.centroidData[Ze.centroidDataIndex];w&&Ye&&(((G=ke).flags|(te=Oe).flags)&s.e9?(G.flags|=s.e9,te.flags|=s.e9):(G.flags&=~s.e9,te.flags&=~s.e9));const nt=We.intersectsCount()>1||Ze.intersectsCount()>1;if(Bt>1)be=ot,ke.centroidXY=Oe.centroidXY=new s.P(0,0);else if(Te&&Te.dem&&!nt){const Ge=H[X](ke,Oe),ut=X%2?s.al-1:0,_t=$(Ge[0],Math.min(s.al-1,Ge[1]),ut,Te,ce,X<2,Ge[2]);ke.centroidXY=Oe.centroidXY=R(_t)}else nt?ke.centroidXY=Oe.centroidXY=new s.P(0,0):(ke.centroidXY=c.encodeBorderCentroid(We),Oe.centroidXY=fe.encodeBorderCentroid(Ze));c.writeCentroidToBuffer(ke),fe.writeCentroidToBuffer(Oe)}else c.showCentroid(We)}c.borderDoneWithNeighborZ[X]=fe.canonical.z,fe.borderDoneWithNeighborZ[we]=c.canonical.z}var G,te;(c.needsCentroidUpdate||!c.centroidVertexBuffer&&c.centroidVertexArray.length!==0)&&c.uploadCentroid(u)}const bl=[1,0,0],zi=[0,1,0],Pf=[0,0,1];function Up(u,t,n){const c=n.transform,m=n.shadowRenderer;if(!m)return!0;const y=u.toUnwrapped(),w=c.tileSize*m._cascades[n.currentShadowCascade].scale;let E=t;if(c.elevation){const G=c.elevation.getMinMaxForTile(u);G&&(E+=G.max)}const R=[...m.shadowDirection];R[2]=-R[2];const L=m.computeSimplifiedTileShadowVolume(y,E,w,R);if(!L)return!1;const P=[bl,zi,Pf,R,[R[0],0,R[2]],[0,R[1],R[2]]],F=c.projection.name==="globe",j=c.scaleZoom(w),H=s.cA.fromInvProjectionMatrix(c.invProjMatrix,c.worldSize,j,!F),$=m.getCurrentCascadeFrustum();return H.intersectsPrecise(L.vertices,L.planes,P)===0||$.intersectsPrecise(L.vertices,L.planes,P)===0}function Dd(u){const{painter:t,source:n,layer:c,coords:m}=u;let y=u.defines;const w=t.context,E=t.renderPass==="shadow",R=t.renderPass==="light-beam",L=t.shadowRenderer,P=s.ec(t.transform.center.lat,t.transform.zoom),F=zc(t,c.paint.get("building-cutoff-fade-range"));F.shouldRenderCutoff&&(y=y.concat("RENDER_CUTOFF"));for(const j of m){const H=n.getTile(j),$=H.getBucket(c);if(!$)continue;L&&L.getMaxCascadeForTile(j.toUnwrapped())===0&&(y=y.concat("SHADOWS_SINGLE_CASCADE"));const G=$.programConfigurations.get(c.id);let te,X,re,ce=t.translatePosMatrix(j.expandedProjMatrix,H,[0,0],"map");if(ce=s.cR(s.bC(),ce,[1,1,u.verticalScale]),E&&L){if(Up(H.tileID,$.maxHeight*P,t))continue;let Te=L.calculateShadowPassMatrixFromTile(H.tileID.toUnwrapped());Te=s.cR(s.bC(),Te,[1,1,u.verticalScale]),re=rn(Te),te=X=t.getOrCreateProgram("buildingDepth",{config:G,defines:y,overrideFog:!1})}else if(R)te=X=t.getOrCreateProgram("buildingBloom",{config:G,defines:y,overrideFog:!1}),re=Vc(ce);else{const Te=t.transform.calculatePosMatrix(j.toUnwrapped(),t.transform.worldSize);s.cR(Te,Te,[1,1,u.verticalScale]);const we=s.bC();s.cR(we,Te,[1,-1,1/P]),s.bl(we,we),s.ed(we,we);const Ee=t.transform.getFreeCameraOptions().position,ve=1<<j.canonical.z;re=qm(ce,we,u.opacity,u.facadeAOIntensity,[((Ee.x-j.wrap)*ve-j.canonical.x)*s.al,(Ee.y*ve-j.canonical.y)*s.al,Ee.z*ve*s.al],$.tileToMeter,u.facadeEmissiveChance),X=t.getOrCreateProgram("building",{config:G,defines:y,overrideFog:!1});const be=y.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);te=t.getOrCreateProgram("building",{config:G,defines:be,overrideFog:!1}),L&&(L.setupShadowsFromMatrix(Te,X,!0),L.setupShadowsFromMatrix(Te,te,!0))}const fe=(Te,we)=>{if(R){const Ee=Te.entranceBloom;we.draw(t,w.gl.TRIANGLES,u.depthMode,Ii.disabled,u.blendMode,ki.disabled,re,c.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segmentsBucket,c.paint,t.transform.zoom,G,[Ee.layoutAttenuationBuffer,Ee.layoutColorBuffer])}else{const Ee=Te.segmentsBucket;let ve=[Te.layoutNormalBuffer,Te.layoutCentroidBuffer,Te.layoutColorBuffer];Te.layoutFacadePaintBuffer&&(ve=ve.concat([Te.layoutFacadeDataBuffer,Te.layoutFacadeVerticalRangeBuffer,Te.layoutFacadePaintBuffer])),we.draw(t,w.gl.TRIANGLES,u.depthMode,Ii.disabled,u.blendMode,E?ki.disabled:ki.backCW,re,c.id,Te.layoutVertexBuffer,Te.indexBuffer,Ee,c.paint,t.transform.zoom,G,ve)}};t.uploadCommonUniforms(w,X,j.toUnwrapped(),null,F),$.buildingWithoutFacade&&fe($.buildingWithoutFacade,X),te!==X&&t.uploadCommonUniforms(w,te,j.toUnwrapped(),null,F),$.buildingWithFacade&&fe($.buildingWithFacade,te)}}function Pd(u){return[u[0]*s.ee,u[1]*s.ee,u[2]*s.ee,0]}function Of(u,t,n,c,m,y,w,E,R){const L=c.getSource(),P=n.globeSharedBuffers;if(!P)return;let F,j,H;if(t&&(F=c.getTile(t)),L instanceof s.aS?(j=L.texture,H=s.dG(0,0,n.transform)):F&&t&&(j=F.texture,H=s.dG(t.canonical.z,t.canonical.x,n.transform)),!j||!H)return;u||(H=s.cR(s.bC(),H,[1,-1,1]));const $=n.context,G=$.gl,te=m.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR,X=n.colorModeForDrapableLayerRenderPass(y),re=w.defines;re.push("GLOBE_POLES");const ce=new ni(G.LEQUAL,ni.ReadWrite,n.depthRangeFor3D),fe=Float32Array.from(n.transform.expandedFarZProjMatrix),Te=Float32Array.from(s.bk(s.dF(new s.cC(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),$.activeTexture.set(G.TEXTURE0),j.bind(te,G.CLAMP_TO_EDGE),$.activeTexture.set(G.TEXTURE1),j.bind(te,G.CLAMP_TO_EDGE),"useMipmap"in j&&$.extTextureFilterAnisotropic&&n.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax);const[we,Ee,ve,be]=t?P.getPoleBuffers(t.canonical.z,!1):P.getPoleBuffers(0,!0),Ce=m.paint.get("raster-elevation");let We;u?(We=we,n.renderDefaultNorthPole=Ce!==0):(We=Ee,n.renderDefaultSouthPole=Ce!==0);const ke=Pd(w.mix),ct=((ot,Bt,Ye,Oe,nt,Ge,ut,_t,$t,Rt,St,gi,li)=>Hc(ot,Bt,Ye,new Float32Array(16),new Float32Array(9),[0,0],Oe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ge,[0,0],_t,2,Rt,St,gi,1,0,li))(fe,Te,H,s.aj(n.transform.zoom),0,m,0,Ce,0,ke,w.offset,w.range,y),Ze=n.getOrCreateProgram("raster",{defines:re});n.uploadCommonUniforms($,Ze,null),Ze.draw(n,G.TRIANGLES,ce,R,X,E,ct,m.id,We,ve,be)}function Gm(u){const t=u._nearZ,n=u.projection.farthestPixelDistance(u),c=n-t,m=.2*u.height,y=t+m;return[t,n,(y-m-t)/c,(y-t)/c]}function Du(u,t,n,c){if(u)return t instanceof Ol&&u instanceof od?t.getTextureDescriptor(u,n,!0):{texture:u.texture,mix:Pd(c.mix),offset:c.offset,buffer:0,tileSize:1}}var $m=s.ef([{name:"a_index",type:"Int16",components:1}]);class jf{constructor(t,n,c,m){const y={width:c[0],height:c[1],data:null},w=t.gl;this.targetColorTexture=new s.T(t,y,w.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(t,y,w.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(n,m),this.lastInvalidatedAt=0}updateParticleTexture(t,n){if(this.particleTextureDimension===n.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const c=this.context.gl,m=n.width*n.height;this.particleTexture0=new s.T(this.context,n,c.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,n,c.RGBA8,{premultiply:!1,useMipmap:!1});const y=new s.eg;y.reserve(m);for(let w=0;w<m;w++)y.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(y,$m.members,!0),this.particleSegment=s.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=n.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=s.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function ha(u,t,n){if(!u)return null;const c=t.getTextureDescriptor(u,n,!0);if(!c)return null;let{texture:m,mix:y,offset:w,tileSize:E,buffer:R,format:L}=c;if(!m||!L)return null;let P=!1;return L==="uint32"&&(P=!0,y[3]=0,y=ic(s.eh,y,[0,n.paint.get("raster-particle-max-speed")]),w=Eh(s.eh,w,[0,n.paint.get("raster-particle-max-speed")])),{texture:m,textureOffset:[R/(E+2*R),E/(E+2*R)],tileSize:E,scalarData:P,scale:y,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function Nf(u){const t=u._nearZ,n=u.projection.farthestPixelDistance(u),c=n-t,m=.2*u.height,y=t+m;return[t,n,(y-m-t)/c,(y-t)/c]}const Ks=new s.ao(1,0,0,1),sc=new s.ao(0,1,0,1),Vp=new s.ao(0,0,1,1),kf=new s.ao(1,0,1,1),Bf=new s.ao(0,1,1,1);function Lh(u,t,n,c,m,y){for(let w=0;w<n.length;w++)if(m){const L=new s.ao(c.r*.8,c.g*.8,c.b*.8,1);qc(u,t,n[w],c,-1,-1,y),qc(u,t,n[w],c,-1,1,y),qc(u,t,n[w],c,1,1,y),qc(u,t,n[w],c,1,-1,y),qc(u,t,n[w],L,0,0,y)}else qc(u,t,n[w],c,0,0,y)}function qc(u,t,n,c,m,y,w){const E=u.context,R=u.transform,L=E.gl,P=R.projection.name==="globe",F=P?["PROJECTION_GLOBE_VIEW"]:[];let j=s.bz(n.projMatrix);if(P&&s.aj(R.zoom)>0){const ke=s.bj(n.canonical,R),ct=s.ei(ke);j=s.aB(new Float32Array(16),R.globeMatrix,ct),s.aB(j,R.projMatrix,j)}const H=s.bC();H[12]+=2*m/(s.o.devicePixelRatio*R.width),H[13]+=2*y/(s.o.devicePixelRatio*R.height),s.aB(j,H,j);const $=u.getOrCreateProgram("debug",{defines:F}),G=t.getTileByID(n.key);u.terrain&&u.terrain.setupElevationDraw(G,$);const te=ni.disabled,X=Ii.disabled,re=u.colorModeForRenderPass(),ce="$debug";E.activeTexture.set(L.TEXTURE0),u.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),P?G._makeGlobeTileDebugBuffers(u.context,R):G._makeDebugTileBoundsBuffers(u.context,R.projection);const fe=G._tileDebugBuffer||u.debugBuffer,Te=G._tileDebugIndexBuffer||u.debugIndexBuffer,we=G._tileDebugSegments||u.debugSegments;if($.draw(u,L.LINE_STRIP,te,X,re,ki.disabled,bs(j,c.toPremultipliedRenderColor(null)),ce,fe,Te,we,null,null,null,[G._globeTileDebugBorderBuffer]),w){const ke=G.latestRawTileData,ct=Math.floor((ke&&ke.byteLength||0)/1024);let Ze=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(Ze+=` => ${n.overscaledZ}`),Ze+=` ${G.state}`,Ze+=` ${ct}kb`,function(ot,Bt){ot.initDebugOverlayCanvas();const Ye=ot.debugOverlayCanvas,Oe=ot.context.gl,nt=ot.debugOverlayCanvas.getContext("2d");nt.clearRect(0,0,Ye.width,Ye.height),nt.shadowColor="white",nt.shadowBlur=2,nt.lineWidth=1.5,nt.strokeStyle="white",nt.textBaseline="top",nt.font="bold 36px Open Sans, sans-serif",nt.fillText(Bt,5,5),nt.strokeText(Bt,5,5),ot.debugOverlayTexture.update(Ye),ot.debugOverlayTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE)}(u,Ze)}const Ee=t.getTile(n).tileSize,ve=512/Math.min(Ee,512)*(n.overscaledZ/R.zoom)*.5,be=G._tileDebugTextBuffer||u.debugBuffer,Ce=G._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,We=G._tileDebugTextSegments||u.debugSegments;$.draw(u,L.TRIANGLES,te,X,ir.alphaBlended,ki.disabled,bs(j,s.ao.transparent.toPremultipliedRenderColor(null),ve),ce,be,Ce,We,null,null,null,[G._globeTileDebugTextBuffer])}function Zo(u,t,n,c){Gc(u,0,t+n/2,u.transform.width,n,c)}function on(u,t,n,c){Gc(u,t-n/2,0,n,u.transform.height,c)}function Gc(u,t,n,c,m,y){const w=u.context,E=w.gl;E.enable(E.SCISSOR_TEST),E.scissor(t*s.o.devicePixelRatio,n*s.o.devicePixelRatio,c*s.o.devicePixelRatio,m*s.o.devicePixelRatio),w.clear({color:y}),E.disable(E.SCISSOR_TEST)}const Ff=s.ef([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Zm}=Ff;function Wo(u,t,n,c){u.emplaceBack(t,n,c)}class Uf{constructor(t){this.vertexArray=new s.ej,this.indices=new s.b1,Wo(this.vertexArray,-1,-1,1),Wo(this.vertexArray,1,-1,1),Wo(this.vertexArray,-1,1,1),Wo(this.vertexArray,1,1,1),Wo(this.vertexArray,-1,-1,-1),Wo(this.vertexArray,1,-1,-1),Wo(this.vertexArray,-1,1,-1),Wo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Zm),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=s.bg.simpleSegment(0,0,36,12)}}function $c(u,t,n,c,m,y){const w=u.context.gl,E=t.paint.get("sky-atmosphere-color"),R=t.paint.get("sky-atmosphere-halo-color"),L=t.paint.get("sky-atmosphere-sun-intensity"),P=((F,j,H,$,G)=>({u_matrix_3f:F,u_sun_direction:j,u_sun_intensity:H,u_color_tint_r:[$.r,$.g,$.b,$.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(s.el(s.dL(),c),m,L,E.toPremultipliedRenderColor(null),R.toPremultipliedRenderColor(null));w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+y,t.skyboxTexture,0),n.draw(u,w.TRIANGLES,ni.disabled,Ii.disabled,ir.unblended,ki.frontCW,P,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const ac=s.ef([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Zc{constructor(t){const n=new s.em;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const c=new s.b1;c.emplaceBack(0,1,2),c.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(n,ac.members),this.indexBuffer=t.createIndexBuffer(c),this.segments=s.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Nt=s.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Yt{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Dh{constructor(t){this.colorModeAlphaBlendedWriteRGB=new ir([1,ka,1,ka],s.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new ir([1,0,1,0],s.ao.transparent,[!1,!1,!1,!0]),this.params=new Yt,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const n=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Zc(n);const c=this.params.sizeRange,m=this.params.intensityRange,y=function(P){const F=s.eo(30),j=[];for(let H=0;H<P;++H){const $=2*Math.PI*F(),G=Math.acos(1-2*F())-.5*Math.PI;j.push(s.d4(Math.cos(G)*Math.cos($),Math.cos(G)*Math.sin($),Math.sin(G)))}return j}(this.params.starsCount),w=s.eo(300),E=new s.en,R=new s.b1;let L=0;for(let P=0;P<y.length;++P){const F=s.c4([],y[P],200),j=Math.max(0,1+.01*c*(1*w()-.5)),H=Math.max(0,1+.01*m*(1*w()-.5));E.emplaceBack(F[0],F[1],F[2],-1,-1,j,H),E.emplaceBack(F[0],F[1],F[2],1,-1,j,H),E.emplaceBack(F[0],F[1],F[2],1,1,j,H),E.emplaceBack(F[0],F[1],F[2],-1,1,j,H),R.emplaceBack(L+0,L+1,L+2),R.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=n.createVertexBuffer(E,Nt.members),this.starsIdx=n.createIndexBuffer(R),this.starsSegments=s.bg.simpleSegment(0,0,E.length,R.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,n){const c=t.context,m=c.gl,y=t.transform,w=new ni(m.LEQUAL,ni.ReadOnly,[0,1]),E=s.aj(y.zoom),R=t.style.getLut(n.scope),L=n.properties.get("color-use-theme")==="none",P=n.properties.get("color").toNonPremultipliedRenderColor(L?null:R),F=n.properties.get("high-color-use-theme")==="none",j=n.properties.get("high-color").toNonPremultipliedRenderColor(F?null:R),H=n.properties.get("space-color-use-theme")==="none",$=n.properties.get("space-color").toNonPremultipliedRenderColor(H?null:R),G=5e-4,te=s.ep(n.properties.get("horizon-blend"),0,1,G,.25),X=s.dA(t,c,y)&&te===G?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,re=t.frameCounter/1e3%1,ce=s.ag(y.globeCenterInViewSpace),fe=Math.sqrt(Math.pow(ce,2)-Math.pow(X,2)),Te=Math.acos(fe/ce),we=Ee=>{const ve=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ee&&ve.push("ALPHA_PASS");const be=t.getOrCreateProgram("globeAtmosphere",{defines:ve}),Ce=((ke,ct,Ze,ot,Bt,Ye,Oe,nt,Ge,ut,_t,$t)=>({u_frustum_tl:ke,u_frustum_tr:ct,u_frustum_br:Ze,u_frustum_bl:ot,u_horizon:Bt,u_transition:Ye,u_fadeout_range:Oe,u_atmosphere_fog_color:nt.toArray01(),u_high_color:Ge.toArray01(),u_space_color:ut.toArray01(),u_temporal_offset:_t,u_horizon_angle:$t}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,E,te,P,j,$,re,Te);t.uploadCommonUniforms(c,be);const We=this.atmosphereBuffer;We&&be.draw(t,m.TRIANGLES,w,Ii.disabled,Ee?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ki.backCW,Ce,Ee?"atmosphere_glow_alpha":"atmosphere_glow",We.vertexBuffer,We.indexBuffer,We.segments)};we(!1),we(!0)}drawStars(t,n){const c=s.aA(n.properties.get("star-intensity"),0,1);if(c===0)return;const m=t.context,y=m.gl,w=t.transform,E=t.getOrCreateProgram("stars"),R=s.c6([]);s.c8(R,R,-w._pitch),s.c7(R,R,-w.angle),s.c8(R,R,s.an(w._center.lat)),s.eq(R,R,-s.an(w._center.lng));const L=s.cb(new Float32Array(16),R),P=s.aB([],w.starsProjMatrix,L),F=s.el([],L),j=s.er([],F),H=[0,1,0];s.dN(H,H,j),s.c4(H,H,this.params.sizeMultiplier);const $=[1,0,0];s.dN($,$,j),s.c4($,$,this.params.sizeMultiplier);const G=(te=H,X=$,re=c,{u_matrix:Float32Array.from(P),u_up:te,u_right:X,u_intensity_multiplier:re});var te,X,re;t.uploadCommonUniforms(m,E),this.starsVx&&this.starsIdx&&E.draw(t,y.TRIANGLES,ni.disabled,Ii.disabled,this.colorModeAlphaBlendedWriteRGB,ki.disabled,G,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class On{constructor(){this.visibleTiles=[]}updateBorders(t,n){const c=[],m=[],y=t._getRenderableCoordinates(!1,!0);for(const R of y){const L=t.getTile(R);if(!L.hasData())continue;const P=L.getBucket(n);P&&(P.isEmpty()||(c.push(R.key),m.push({bucket:P,tileID:R.canonical})))}let w=c.length!==this.visibleTiles.length;if(!w){c.sort();for(let R=0;R<c.length;R++)if(c[R]!==this.visibleTiles[R]){w=!0;break}}if(!w)return;const E=new Set;this.visibleTiles=c,m.sort((R,L)=>R.tileID.z-L.tileID.z||R.tileID.x-L.tileID.x||R.tileID.y-L.tileID.y);for(const R of m){const L=new Array,P=new Array,F=R.bucket;for(const j of F.featuresOnBorder)E.has(j.featureId)?P.push(j.footprintIndex):(E.add(j.featureId),L.push(j.footprintIndex));F.updateFootprintHiddenFlags(L,s.es,!1),F.updateFootprintHiddenFlags(P,s.es,!0)}}}function qe(u,t){const n=[...u],c=t.cameraWorldSizeForFog/t.worldSize,m=s.bA([]);return s.cR(m,m,[c,c,1]),s.aB(n,m,n),s.aB(n,t.worldToFogMatrix,n),n}function Ph(u,t,n,c,m){const y=n.material,w=c.context,{baseColorTexture:E,metallicRoughnessTexture:R}=y.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:P,emissionTexture:F}=y;function j($,G,te){if($&&(u.push(G),w.activeTexture.set(w.gl.TEXTURE0+te),$.gfxTexture)){const{minFilter:X,magFilter:re,wrapS:ce,wrapT:fe}=$.sampler;$.gfxTexture.bindExtraParam(X,re,ce,fe)}}j(E,"HAS_TEXTURE_u_baseColorTexture",Qn.BaseColor),j(R,"HAS_TEXTURE_u_metallicRoughnessTexture",Qn.MetallicRoughness),j(L,"HAS_TEXTURE_u_normalTexture",Qn.Normal),j(P,"HAS_TEXTURE_u_occlusionTexture",Qn.Occlusion),j(F,"HAS_TEXTURE_u_emissionTexture",Qn.Emission),m&&(m.texture||(m.texture=new s.dY(c.context,m.image,[m.image.height,m.image.height,m.image.height],w.gl.RGBA8)),w.activeTexture.set(w.gl.TEXTURE0+Qn.LUT),m.texture&&m.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),u.push("APPLY_LUT_ON_GPU")),n.texcoordBuffer&&(u.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(n.texcoordBuffer)),n.colorBuffer&&(u.push(n.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(n.colorBuffer)),n.normalBuffer&&(u.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(n.normalBuffer)),n.pbrBuffer&&(u.push("HAS_ATTRIBUTE_a_pbr"),u.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(n.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||u.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||u.push("DIFFUSE_SHADED");const H=c.shadowRenderer;H&&(u.push("RENDER_SHADOWS","DEPTH_TEXTURE"),H.useNormalOffset&&u.push("NORMAL_OFFSET"))}function wl(u,t,n,c,m,y){const w=n.paint.get("model-opacity").constantOr(1),E=t.context,R=new ni(t.context.gl.LEQUAL,ni.ReadWrite,t.depthRangeFor3D),L=t.transform,P=u.mesh,F=P.material,j=F.pbrMetallicRoughness,H=t.style.fog;let $;$=t.transform.projection.zAxisUnit==="pixels"?[...u.nodeModelMatrix]:s.aB([],c.zScaleMatrix,u.nodeModelMatrix),s.aB($,c.negCameraPosMatrix,$);const G=s.bl([],$);s.ed(G,G);const te=n.paint.get("model-color-use-theme").constantOr("default")==="none",X=n.paint.get("model-emissive-strength").constantOr(0),re=Rh(new Float32Array(u.worldViewProjection),new Float32Array($),new Float32Array(G),null,t,w,j.baseColorFactor,F.emissiveFactor,j.metallicFactor,j.roughnessFactor,F,X,n),ce={defines:[]},fe=[],Te=t.shadowRenderer;Te&&(Te.useNormalOffset=!1),Ph(ce.defines,fe,P,t,te?null:n.lut);let we=null;if(H){const be=qe(u.nodeModelMatrix,t.transform);if(we=new Float32Array(be),L.projection.name!=="globe"){const Ce=P.aabb.min,We=P.aabb.max,[ke,ct]=H.getOpacityForBounds(be,Ce[0],Ce[1],We[0],We[1]);ce.overrideFog=ke>=pi||ct>=pi}}const Ee=zc(t,n.paint.get("model-cutoff-fade-range"));Ee.shouldRenderCutoff&&ce.defines.push("RENDER_CUTOFF");const ve=t.getOrCreateProgram("model",ce);t.uploadCommonUniforms(E,ve,null,we,Ee),t.renderPass!=="shadow"&&Te&&Te.setupShadowsFromMatrix(u.nodeModelMatrix,ve),ve.draw(t,E.gl.TRIANGLES,R,m,y,P.material.doubleSided?ki.disabled:ki.backCCW,re,n.id,P.vertexBuffer,P.indexBuffer,P.segments,n.paint,t.transform.zoom,void 0,fe)}function Od(u,t,n,c,m,y,w){let E;E=u.projection.name==="globe"?s.eu(n,u):[...n],s.aB(E,E,t.matrix);const R=s.aB([],c,E);if(t.meshes)for(const L of t.meshes){if(L.material.alphaMode!=="BLEND"){w.push({mesh:L,depth:0,modelIndex:m,worldViewProjection:R,nodeModelMatrix:E});continue}const P=s.af([],L.centroid,R);!u.isOrthographic&&P[2]<=0||y.push({mesh:L,depth:P[2],modelIndex:m,worldViewProjection:R,nodeModelMatrix:E})}if(t.children)for(const L of t.children)Od(u,L,n,c,m,y,w)}function Oh(u,t,n,c){const m=n.shadowRenderer;if(!m)return;const y=m.getShadowPassDepthMode(),w=m.getShadowPassColorMode(),E=m.calculateShadowPassMatrixFromMatrix(t),R=Gs(E);n.getOrCreateProgram("modelDepth",{defines:n._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,y,Ii.disabled,w,ki.backCCW,R,c.id,u.vertexBuffer,u.indexBuffer,u.segments,c.paint,n.transform.zoom,void 0,void 0)}function Xo(u,t,n){const c=t.updateZoomBasedPaintProperties(),m=function(y,w,E){let R,L,P,F=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&F>0){const j=y.terrain,H=j.findDEMTileFor(E);H&&H.dem?R=s.ew.create(j,E,H):F=0}if(F===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),F===w.validForExaggeration&&(F===0||R&&R._demTile&&R._demTile.tileID===w.validForDEMTile.id&&R._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(const j in w.instancesPerModel){const H=w.instancesPerModel[j];for(let $=0;$<H.instancedDataArray.length;++$){const G=(R?F*R.getElevationAt(0|H.instancedDataArray.float32[16*$],0|H.instancedDataArray.float32[16*$+1],!0,!0):0)+H.instancesEvaluatedElevation[$];H.instancedDataArray.float32[16*$+6]=G,L=L?Math.min(w.terrainElevationMin,G):G,P=P?Math.max(w.terrainElevationMax,G):G}}return w.terrainElevationMin=L||0,w.terrainElevationMax=P||0,w.validForExaggeration=F,w.validForDEMTile=R&&R._demTile?{id:R._demTile.tileID,timestamp:R._dem._timestamp}:{id:void 0,timestamp:0},!0}(u,t,n);(c||m)&&(t.uploaded=!1,t.upload(u.context))}const da={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.d8([0,0,0],[s.al,s.al,0])};function ho(u,t){const n=1<<u.canonical.z,c=t.getFreeCameraOptions().position,m=t.elevation,y=u.canonical.x/n,w=(u.canonical.x+1)/n,E=u.canonical.y/n,R=(u.canonical.y+1)/n;let L=t._centerAltitude;if(m){const H=m.getMinMaxForTile(u);H&&H.max>L&&(L=H.max)}const P=s.aA(c.x,y,w)-c.x,F=s.aA(c.y,E,R)-c.y,j=s.ce(L,t.center.lat)-c.z;return t._zoomFromMercatorZ(Math.sqrt(P*P+F*F+j*j))}function Wc(u,t,n,c,m,y,w){const E=u.context,R=u.renderPass==="shadow",L=u.shadowRenderer,P=R&&L?L.getShadowPassDepthMode():new ni(E.gl.LEQUAL,ni.ReadWrite,u.depthRangeFor3D),F=u.isTileAffectedByFog(y);if(n.meshes)for(const j of n.meshes){const H=["MODEL_POSITION_ON_GPU"],$=[];let G,te,X;c.instancedDataArray.length>20&&H.push("INSTANCED_ARRAYS");const re=zc(u,t.paint.get("model-cutoff-fade-range"));if(re.shouldRenderCutoff&&H.push("RENDER_CUTOFF"),R&&L)G=u.getOrCreateProgram("modelDepth",{defines:H}),te=Gs(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(n.matrix)),X=L.getShadowPassColorMode();else{Ph(H,$,j,u,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),G=u.getOrCreateProgram("model",{defines:H,overrideFog:F});const fe=j.material,Te=fe.pbrMetallicRoughness,we=t.paint.get("model-opacity").constantOr(1),Ee=t.paint.get("model-emissive-strength").constantOr(0);te=Rh(y.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),null,u,we,Te.baseColorFactor,fe.emissiveFactor,Te.metallicFactor,Te.roughnessFactor,fe,Ee,t,m),L&&(w.shadowUniformsInitialized?G.setShadowUniformValues(E,L.getShadowUniformValues()):(L.setupShadows(y.toUnwrapped(),G,"model-tile"),w.shadowUniformsInitialized=!0)),X=re.shouldRenderCutoff||we<1||fe.alphaMode!=="OPAQUE"?ir.alphaBlended:ir.unblended}u.uploadCommonUniforms(E,G,y.toUnwrapped(),null,re);const ce=j.material.doubleSided?ki.disabled:ki.backCCW;if(c.instancedDataArray.length>20)$.push(c.instancedDataBuffer),G.draw(u,E.gl.TRIANGLES,P,Ii.disabled,X,ce,te,t.id,j.vertexBuffer,j.indexBuffer,j.segments,t.paint,u.transform.zoom,void 0,$,c.instancedDataArray.length);else{const fe=R?"u_instance":"u_normal_matrix";for(let Te=0;Te<c.instancedDataArray.length;++Te)te[fe]=new Float32Array(c.instancedDataArray.arrayBuffer,64*Te,16),G.draw(u,E.gl.TRIANGLES,P,Ii.disabled,X,ce,te,t.id,j.vertexBuffer,j.indexBuffer,j.segments,t.paint,u.transform.zoom,void 0,$)}}if(n.children)for(const j of n.children)Wc(u,t,j,c,m,y,w)}const Hp=[1,-1,1];function Vf(u,t,n,c){if(!n.modelManager)return!0;const m=n.modelManager;if(!n.shadowRenderer)return!0;const y=n.shadowRenderer,w=t.aabb;let E=!0,R=u.maxHeight;if(R===0){let P=0;for(const F in u.instancesPerModel){const j=m.getModel(F,c);j?P=Math.max(P,Math.max(Math.max(j.aabb.max[0],j.aabb.max[1]),j.aabb.max[2])):E=!1}R=u.maxScale*P*1.41+u.maxVerticalOffset,E&&(u.maxHeight=R)}w.max[2]=R,w.min[2]+=u.terrainElevationMin,w.max[2]+=u.terrainElevationMax,s.af(w.min,w.min,t.tileMatrix),s.af(w.max,w.max,t.tileMatrix);const L=w.intersects(y.getCurrentCascadeFrustum());return n.currentShadowCascade===0&&(u.isInsideFirstShadowMapFrustum=L===2),L===0}function jd(u,t){const n=u.uniformValues.u_cutoff_params[0],c=u.uniformValues.u_cutoff_params[1],m=u.uniformValues.u_cutoff_params[2],y=u.uniformValues.u_cutoff_params[3];return c===n||y===m?1:s.aA(((t-n)/(c-n)-m)/(y-m),0,1)}function Hf(u,t,n,c){if(t.pitch<20)return 1;const m=t.getWorldToCameraMatrix();s.aB(m,m,u);const y=s.bU(n.min[0],n.min[1],n.min[2],1);let w=s.aC(s.ex(),y,m),E=w,R=w;y[1]=n.max[1],w=s.aC(s.ex(),y,m),E=w[1]<E[1]?w:E,R=w[1]>R[1]?w:R,y[0]=n.max[0],w=s.aC(s.ex(),y,m),E=w[1]<E[1]?w:E,R=w[1]>R[1]?w:R,y[1]=n.min[1],w=s.aC(s.ex(),y,m),E=w[1]<E[1]?w:E,R=w[1]>R[1]?w:R;const L=s.aA(c[0],0,1),P=100*t.pixelsPerMeter*s.aA(c[1],0,1),F=s.aA(c[2],0,1),j=s.ey(s.ex(),E,R,L),H=Math.tan(.5*t.fovX),$=-j[2]*H;if(P===0)return j[1]<-Math.abs($)?F:1;const G=(-Math.abs($)-j[1])/P,te=(re,ce,fe)=>(1-fe)*re+fe*ce,X=s.aA(te(1,F,G),F,1);return te(1,X,s.aA((t.pitch-20)/20,0,1))}class Xc{}class Nd{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,n,c){{const F=this._storage.get(n.id);if(F)return F.lastUsedFrameIdx=t,F.buf}const m=c.gl,y=m.getBufferParameter(m.ELEMENT_ARRAY_BUFFER,m.BUFFER_SIZE),w=new ArrayBuffer(y),E=new Int16Array(w);m.getBufferSubData(m.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));const R=new s.eA;for(let F=0;F<y/2;F+=3){const j=E[F],H=E[F+1],$=E[F+2];R.emplaceBack(j,H),R.emplaceBack(H,$),R.emplaceBack($,j)}const L=c.bindVertexArrayOES.current,P=new Xc;return P.buf=new Go(c,R),P.lastUsedFrameIdx=t,this._storage.set(n.id,P),c.bindVertexArrayOES.set(L),P.buf}update(t){for(const[n,c]of this._storage)t-c.lastUsedFrameIdx>30&&(c.buf.destroy(),this._storage.delete(n))}destroy(){for(const[t,n]of this._storage)n.buf.destroy(),this._storage.delete(t)}}class kd{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const jh=s.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Pu{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Nh{constructor(t,n){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...n,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...n,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const qp=s.ef([{type:"Float32",name:"a_pos_2f",components:2}]);class Gp{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,n){const c=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const w=new s.eB,E=new s.b1;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(1,1),w.emplaceBack(-1,1),E.emplaceBack(0,1,2),E.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(w,qp.members),this.vignetteIdx=t.context.createIndexBuffer(E)}const m=s.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,c);const w={u_vignetteShape:(y={vignetteShape:[n.start,n.range,Math.pow(10,n.fadePower)],vignetteColor:[n.color.r,n.color.g,n.color.b,n.color.a*n.strength]}).vignetteShape,u_vignetteColor:y.vignetteColor};c.draw(t,t.context.gl.TRIANGLES,ni.disabled,Ii.disabled,ir.alphaBlended,ki.disabled,w,"vignette",this.vignetteVx,this.vignetteIdx,m)}var y}}class $p{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,n){const c=t.getFreeCameraOptions().position,m=c.toAltitude(),y=c.toLngLat(),w=s.an(y.lng),E=s.an(y.lat),R=t.pixelsPerMeter/n,L=w*s.eD,P=s.eD*Math.log(Math.tan(Math.PI/4+E/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const F=-this._offsetYPrev+P,j=-this._elevationPrev+m;this._accumulatedOffsetX+=(-this._offsetXPrev+L)*R,this._accumulatedOffsetY+=F*R,this._accumulatedElevation+=j*R,this._offsetXPrev=L,this._offsetYPrev=P,this._elevationPrev=m}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Zp(u,t){return[-(u[0]-Math.floor(u[0]/t)*t),-(u[1]-Math.floor(u[1]/t)*t),-(u[2]-Math.floor(u[2]/t)*t)]}function fa(u){const t=s.eo(1323123451230),n=[];for(let c=0;c<u;++c){const m=2*t()-1,y=2*t()-1,w=2*t()-1;n.push(s.d4(m,y,w))}return n}function oc(u,t,n,c,m){const y=s.aA((m-n)/(c-n),0,1);return(1-y)*u+y*t}class gs{constructor(t){this._movement=new $p,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Gp,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,n){const c=t.transform;this._movement.update(c,this._ppmScaleFactor);const m=c.starsProjMatrix,y=s.c6([]);s.c8(y,y,s.an(90)-c._pitch),s.c7(y,y,-c.angle);const w=s.cb(new Float32Array(16),y),E=s.eC(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),R=s.ed([],E),L=s.aB([],R,w),P=Date.now()/1e3;return this._accumulatedTimeFromStart+=(P-this._prevTime)*n,this._prevTime=P,{projectionMatrix:m,modelviewMatrix:L}}}class Lr extends gs{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Nh(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const c=fa(this.particlesCount),m=new s.eE,y=new s.b1;let w=0;const E=s.eo(1323123451230);for(let R=0;R<c.length;++R){const L=c[R],P=[2*E()-1,E(),E(),E()];m.emplaceBack(L[0],L[1],L[2],-1,-1,...P),m.emplaceBack(L[0],L[1],L[2],1,-1,...P),m.emplaceBack(L[0],L[1],L[2],1,1,...P),m.emplaceBack(L[0],L[1],L[2],-1,1,...P),y.emplaceBack(w+0,w+1,w+2),y.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=n.createVertexBuffer(m,jh.members),this.particlesIdx=n.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const n=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},c=t.transform.zoom;if(n.revealStart>c)return;const m=oc(0,1,n.revealStart,n.revealStart+n.revealRange,c);if(!this.particlesVx||!this.particlesIdx)return;const y=structuredClone(this._params);let w=[-y.direction.x,y.direction.y,-100];s.aw(w,w);const E=structuredClone(this._vignetteParams);E.strength*=m,y.overrideStyleParameters||(y.intensity=t.style.rain.state.density,y.timeFactor=t.style.rain.state.intensity,y.color=structuredClone(t.style.rain.state.color),w=structuredClone(t.style.rain.state.direction),y.screenThinning.intensity=t.style.rain.state.centerThinning,y.dropletSizeX=t.style.rain.state.dropletSize[0],y.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],y.distortionStrength=100*t.style.rain.state.distortionStrength,E.strength=1,E.color=structuredClone(t.style.rain.state.vignetteColor));const R=this.updateOnRender(t,y.timeFactor),L=t.context,P=L.gl,F=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new s.T(L,{width:t.width,height:t.height,data:null},P.RGBA8)),y.distortionStrength>0&&(L.activeTexture.set(P.TEXTURE0),this.screenTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),P.copyTexSubImage2D(P.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const j=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(L,j),L.activeTexture.set(P.TEXTURE0),this.screenTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE);const H=[y.color.r,y.color.g,y.color.b,y.color.a],$=(G,te)=>{const X=Zp(this._movement.getPosition(),G),re=y.dropletSizeX,ce=y.dropletSizeX*y.dropletSizeYScale,fe=t.width/2,Te=t.height/2,we=oc(0,y.screenThinning.start,0,1,y.screenThinning.intensity),Ee=oc(.001,y.screenThinning.range,0,1,y.screenThinning.intensity),ve=oc(0,y.screenThinning.particleOffset,0,1,y.screenThinning.intensity),be=(Ce={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:X,velocityConeAperture:y.velocityConeAperture,velocity:y.velocity,boxSize:G,rainDropletSize:[re,ce],distortionStrength:y.distortionStrength,rainDirection:w,color:H,screenSize:[F.width,F.height],thinningCenterPos:[fe,Te],thinningShape:[we,Ee,Math.pow(10,y.screenThinning.fadePower)],thinningAffectedRatio:y.screenThinning.affectedRatio,thinningParticleOffset:ve,shapeDirectionalPower:y.shapeDirPower,shapeNormalPower:y.shapeNormalPower,mode:te?0:1},{u_modelview:Float32Array.from(Ce.modelview),u_projection:Float32Array.from(Ce.projection),u_time:Ce.time,u_cam_pos:Ce.camPos,u_texScreen:0,u_velocityConeAperture:Ce.velocityConeAperture,u_velocity:Ce.velocity,u_boxSize:Ce.boxSize,u_rainDropletSize:Ce.rainDropletSize,u_distortionStrength:Ce.distortionStrength,u_rainDirection:Ce.rainDirection,u_color:Ce.color,u_screenSize:Ce.screenSize,u_thinningCenterPos:Ce.thinningCenterPos,u_thinningShape:Ce.thinningShape,u_thinningAffectedRatio:Ce.thinningAffectedRatio,u_thinningParticleOffset:Ce.thinningParticleOffset,u_shapeDirectionalPower:Ce.shapeDirectionalPower,u_shapeNormalPower:Ce.shapeNormalPower,u_mode:Ce.mode});var Ce;const We=Math.round(y.intensity*this.particlesCount),ke=s.bg.simpleSegment(0,0,4*We,2*We);j.draw(t,P.TRIANGLES,ni.disabled,Ii.disabled,ir.alphaBlended,ki.disabled,be,"rain_particles",this.particlesVx,this.particlesIdx,ke)};y.distortionStrength>0&&$(y.boxSize,!0),$(y.boxSize,!1),this._vignette.draw(t,E)}}const xr=s.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Wp extends gs{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Nh(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const c=fa(this.particlesCount),m=new s.eF,y=new s.b1;let w=0;const E=s.eo(1323123451230);for(let R=0;R<c.length;++R){const L=c[R],P=E(),F=E(),j=E(),H=[R/c.length,P,F,j],$=[E(),E()];m.emplaceBack(L[0],L[1],L[2],-1,-1,...H,...$),m.emplaceBack(L[0],L[1],L[2],1,-1,...H,...$),m.emplaceBack(L[0],L[1],L[2],1,1,...H,...$),m.emplaceBack(L[0],L[1],L[2],-1,1,...H,...$),y.emplaceBack(w+0,w+1,w+2),y.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=n.createVertexBuffer(m,xr.members),this.particlesIdx=n.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const n=structuredClone(this._params);let c=[-n.direction.x,n.direction.y,-100];s.aw(c,c);const m=structuredClone(this._vignetteParams),y=n.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},w=t.transform.zoom;if(y.revealStart>w)return;const E=oc(0,1,y.revealStart,y.revealStart+y.revealRange,w);m.strength*=E,n.overrideStyleParameters||(n.intensity=t.style.snow.state.density,n.timeFactor=t.style.snow.state.intensity,n.color=structuredClone(t.style.snow.state.color),c=structuredClone(t.style.snow.state.direction),n.screenThinning.intensity=t.style.snow.state.centerThinning,n.billboardSize=2.79*t.style.snow.state.flakeSize,m.strength=1,m.color=structuredClone(t.style.snow.state.vignetteColor));const R=this.updateOnRender(t,n.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const L=t.context,P=L.gl,F=t.transform,j=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(L,j),((H,$,G)=>{const te=Zp(this._movement.getPosition(),H),X=F.width/2,re=F.height/2,ce=oc(0,G.screenThinning.start,0,1,G.screenThinning.intensity),fe=oc(.001,G.screenThinning.range,0,1,G.screenThinning.intensity),Te=oc(0,G.screenThinning.particleOffset,0,1,G.screenThinning.intensity),we=(Ee={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:te,velocityConeAperture:G.velocityConeAperture,velocity:G.velocity,horizontalOscillationRadius:G.horizontalOscillationRadius,horizontalOscillationRate:G.horizontalOscillationRate,boxSize:H,billboardSize:1*G.billboardSize,simpleShapeParameters:[G.shapeFadeStart,G.shapeFadePower],screenSize:[F.width,F.height],thinningCenterPos:[X,re],thinningShape:[ce,fe,Math.pow(10,G.screenThinning.fadePower)],thinningAffectedRatio:G.screenThinning.affectedRatio,thinningParticleOffset:Te,color:[G.color.r,G.color.g,G.color.b,G.color.a],direction:c},{u_modelview:Float32Array.from(Ee.modelview),u_projection:Float32Array.from(Ee.projection),u_time:Ee.time,u_cam_pos:Ee.camPos,u_velocityConeAperture:Ee.velocityConeAperture,u_velocity:Ee.velocity,u_horizontalOscillationRadius:Ee.horizontalOscillationRadius,u_horizontalOscillationRate:Ee.horizontalOscillationRate,u_boxSize:Ee.boxSize,u_billboardSize:Ee.billboardSize,u_simpleShapeParameters:Ee.simpleShapeParameters,u_screenSize:Ee.screenSize,u_thinningCenterPos:Ee.thinningCenterPos,u_thinningShape:Ee.thinningShape,u_thinningAffectedRatio:Ee.thinningAffectedRatio,u_thinningParticleOffset:Ee.thinningParticleOffset,u_particleColor:Ee.color,u_direction:Ee.direction});var Ee;const ve=Math.round(G.intensity*this.particlesCount),be=s.bg.simpleSegment(0,0,4*ve,2*ve);this.particlesVx&&this.particlesIdx&&j.draw(t,P.TRIANGLES,ni.disabled,Ii.disabled,ir.alphaBlended,ki.disabled,we,"snow_particles",this.particlesVx,this.particlesIdx,be)})(n.boxSize,0,n),this._vignette.draw(t,m)}}const lc={symbol:function(u,t,n,c,m){if(u.renderPass!=="translucent")return;const y=Ii.disabled,w=u.colorModeForRenderPass(),E=n.layout.get("text-variable-anchor"),R=n.layout.get("text-size-scale-range"),L=s.aA(u.scaleFactor,R[0],R[1]);E&&function(j,H,$,G,te,X,re,ce){const fe=H.transform,Te=te==="map",we=X==="map";for(const Ee of j){const ve=G.getTile(Ee),be=ve.getBucket($);if(!be||!be.text||!be.text.segments.get().length)continue;const Ce=s.bK(be.textSizeData,fe.zoom,ce),We=no(Ee,be.getProjection(),fe),ke=fe.calculatePixelsToTileUnitsMatrix(ve),ct=so(We,ve.tileID.canonical,we,Te,fe,be.getProjection(),ke),Ze=be.hasIconTextFit()&&be.hasIconData();Ce&&zd(be,Te,we,re,fe,ct,Ee,Math.pow(2,fe.zoom-ve.tileID.overscaledZ),Ce,Ze)}}(c,u,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),m,L);const P=n.paint.get("icon-opacity").constantOr(1)!==0,F=n.paint.get("text-opacity").constantOr(1)!==0;n.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(P||F)?zh(u,t,n,c,y,w):(P&&zh(u,t,n,c,y,w,{onlyIcons:!0}),F&&zh(u,t,n,c,y,w,{onlyText:!0})),t.map.showCollisionBoxes&&(zu(u,t,n,c,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),zu(u,t,n,c,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(u,t,n,c){if(u.renderPass!=="translucent")return;const m=n.paint.get("circle-opacity"),y=n.paint.get("circle-stroke-width"),w=n.paint.get("circle-stroke-opacity"),E=n.layout.get("circle-sort-key").constantOr(1)!==void 0,R=n.paint.get("circle-emissive-strength");if(m.constantOr(1)===0&&(y.constantOr(1)===0||w.constantOr(1)===0))return;const L=u.context,P=L.gl,F=u.transform,j=!(!u.terrain||!u.terrain.enabled),H=n.layout.get("circle-elevation-reference"),$=u.depthModeForSublayer(0,ni.ReadOnly),G=new ni(u.context.gl.LEQUAL,ni.ReadOnly,u.depthRangeFor3D),te=H==="none"||j?$:G,X=Ii.disabled,re=u.colorModeForDrapableLayerRenderPass(R),ce=F.projection.name==="globe",fe=[s.aF(F.center.lng),s.aJ(F.center.lat)],Te=[];for(let Ee=0;Ee<c.length;Ee++){const ve=c[Ee],be=t.getTile(ve),Ce=be.getBucket(n);if(!Ce||Ce.projection.name!==F.projection.name)continue;const We=Ce.programConfigurations.get(n.id),ke=Ce.layoutVertexBuffer,ct=Ce.globeExtVertexBuffer,Ze=Ce.indexBuffer,ot=s.dZ(n),Bt=[ct],Ye=u.isTileAffectedByFog(ve);ce&&ot.push("PROJECTION_GLOBE_VIEW"),ot.push("DEPTH_D24"),u.terrain&&F.depthOcclusionForSymbolsAndCircles&&ot.push("DEPTH_OCCLUSION"),Ce.hasElevation&&!u.terrain&&(ot.push("ELEVATED_ROADS"),Bt.push(Ce.elevatedLayoutVertexBuffer));const Oe=u.getOrCreateProgram("circle",{config:We,defines:ot,overrideFog:Ye}),nt=F.projection.createInversionMatrix(F,ve.canonical),Ge={programConfiguration:We,program:Oe,layoutVertexBuffer:ke,dynamicBuffers:Bt,indexBuffer:Ze,uniformValues:s.d_(u,ve,be,nt,fe,n),tile:be};if(E){const ut=Ce.segments.get();for(const _t of ut)Te.push({segments:new s.bg([_t]),sortKey:_t.sortKey,state:Ge})}else Te.push({segments:Ce.segments,sortKey:0,state:Ge})}E&&Te.sort((Ee,ve)=>Ee.sortKey-ve.sortKey);const we={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(const Ee of Te){const{programConfiguration:ve,program:be,layoutVertexBuffer:Ce,dynamicBuffers:We,indexBuffer:ke,uniformValues:ct,tile:Ze}=Ee.state,ot=Ee.segments;u.terrain&&u.terrain.setupElevationDraw(Ze,be,we),u.uploadCommonUniforms(L,be,Ze.tileID.toUnwrapped()),be.draw(u,P.TRIANGLES,te,X,re,ki.disabled,ct,n.id,Ce,ke,ot,n.paint,F.zoom,ve,We)}},heatmap:function(u,t,n,c){if(n.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const m=u.context,y=m.gl,w=Ii.disabled,E=new ir([y.ONE,y.ONE,y.ONE,y.ONE],s.ao.transparent,[!0,!0,!0,!0]);(function(H,$,G,te){const X=H.gl,re=$.width*te,ce=$.height*te;H.activeTexture.set(X.TEXTURE1),H.viewport.set([0,0,re,ce]);let fe=G.heatmapFbo;if(!fe||fe&&(fe.width!==re||fe.height!==ce)){fe&&fe.destroy();const Te=X.createTexture();X.bindTexture(X.TEXTURE_2D,Te),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),fe=G.heatmapFbo=H.createFramebuffer(re,ce,!0,null),function(we,Ee,ve,be,Ce,We){const ke=we.gl;ke.texImage2D(ke.TEXTURE_2D,0,we.extRenderToTextureHalfFloat?ke.RGBA16F:ke.RGBA,Ce,We,0,ke.RGBA,we.extRenderToTextureHalfFloat?ke.HALF_FLOAT:ke.UNSIGNED_BYTE,null),be.colorAttachment.set(ve)}(H,0,Te,fe,re,ce)}else X.bindTexture(X.TEXTURE_2D,fe.colorAttachment.get()),H.bindFramebuffer.set(fe.framebuffer)})(m,u,n,u.transform.projection.name==="globe"?.5:.25),m.clear({color:s.ao.transparent});const R=u.transform,L=R.projection.name==="globe",P=L?["PROJECTION_GLOBE_VIEW"]:[],F=L?ki.frontCCW:ki.disabled,j=[s.aF(R.center.lng),s.aJ(R.center.lat)];for(let H=0;H<c.length;H++){const $=c[H];if(t.hasRenderableParent($))continue;const G=t.getTile($),te=G.getBucket(n);if(!te||te.projection.name!==R.projection.name)continue;const X=u.isTileAffectedByFog($),re=te.programConfigurations.get(n.id),ce=u.getOrCreateProgram("heatmap",{config:re,defines:P,overrideFog:X}),{zoom:fe}=u.transform;u.terrain&&u.terrain.setupElevationDraw(G,ce),u.uploadCommonUniforms(m,ce,$.toUnwrapped());const Te=R.projection.createInversionMatrix(R,$.canonical);ce.draw(u,y.TRIANGLES,ni.disabled,w,E,F,Mu(u,$,G,Te,j,fe,n.paint.get("heatmap-intensity")),n.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,n.paint,u.transform.zoom,re,L?[te.globeExtVertexBuffer]:null)}m.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(m,y){const w=m.context,E=w.gl,R=y.heatmapFbo;if(!R)return;w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,R.colorAttachment.get()),w.activeTexture.set(E.TEXTURE1);let L=y.colorRampTexture;L||(L=y.colorRampTexture=new s.T(w,y.colorRamp,E.RGBA8)),L.bind(E.LINEAR,E.CLAMP_TO_EDGE),m.getOrCreateProgram("heatmapTexture").draw(m,E.TRIANGLES,ni.disabled,Ii.disabled,m.colorModeForRenderPass(),ki.disabled,((P,F,j,H)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,y),y.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,y.paint,m.transform.zoom)}(u,n))},line:function(u,t,n,c){if(u.renderPass!=="translucent")return;const m=n.paint.get("line-opacity"),y=n.paint.get("line-width");if(m.constantOr(1)===0||y.constantOr(1)===0)return;const w=n.paint.get("line-emissive-strength"),E=n.paint.get("line-occlusion-opacity"),R=n.layout.get("line-elevation-reference"),L=n.layout.get("line-width-unit")==="meters",P=R==="sea",F=!(!u.terrain||!u.terrain.enabled),j=u.context,H=j.gl;if(n.hasElevatedBuckets&&u.transform.projection.name==="globe")return;const $=n.layout.get("line-cross-slope"),G=$!==void 0,te=$<1,X=u.colorModeForDrapableLayerRenderPass(w),re=u.terrain&&u.terrain.renderingToTexture,ce=re?1:s.o.devicePixelRatio,fe=n.paint.get("line-dasharray"),Te=fe.constantOr(1),we=n.layout.get("line-cap"),Ee=fe.constantOr(null),ve=we.constantOr(null),be=n.paint.get("line-pattern"),Ce=be.constantOr(1),We=n.paint.get("line-pattern-cross-fade"),ke=be.constantOr(null),ct=n.paint.get("line-opacity").constantOr(1);let Ze=!Ce&&ct!==1||u.depthOcclusion&&E>0&&E<1;const ot=n.paint.get("line-gradient"),Bt=Ce?"linePattern":"line",Ye=s.d$(n);let Oe;if(re&&u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(Ze=!1),E!==0&&u.depthOcclusion){const _t=n.paint._values["line-opacity"];_t&&_t.value&&_t.value.kind==="constant"?Oe=_t.value:s.w(`Occlusion opacity for layer ${n.id} is supported only when line-opacity isn't data-driven.`)}y.value.kind!=="constant"&&y.value.isLineProgressConstant===!1&&Ye.push("VARIABLE_LINE_WIDTH");const nt=(_t,$t,Rt,St,gi,li)=>{for(const ti of _t){const ci=t.getTile(ti);if(Ce&&!ci.patternsLoaded())continue;const Oi=ci.getBucket(n);if(!Oi||Oi.elevationType!=="none"&&!gi||Oi.elevationType==="none"&&gi)continue;u.prepareDrawTile();const Ki=[...$t],Hi=u.shadowRenderer,jr=Oi.elevationType==="road"&&!!Hi&&Hi.enabled;let qi=[0,0,0];if(jr){const Ji=u.style.directionalLight,Di=u.style.ambientLight;Ji&&Di&&(qi=To(u.style,Ji,Di)),Ki.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const yr=Oi.programConfigurations.get(n.id);let Ur=!1;if(ke&&ci.imageAtlas){const Ji=s.e0.from(ke),Di=Ji.getPrimary().scaleSelf(ce).toString(),wr=ci.imageAtlas.patternPositions.get(Di),jn=Ji.getSecondary(),Vr=jn?ci.imageAtlas.patternPositions.get(jn.scaleSelf(ce).toString()):null;Ur=!!wr&&!!Vr,wr&&yr.setConstantPatternPositions(wr,Vr)}We>0&&(Ur||yr.getPatternTransitionVertexBuffer("line-pattern"))&&Ki.push("LINE_PATTERN_TRANSITION");const fn=u.isTileAffectedByFog(ti),Yi=u.getOrCreateProgram(Bt,{config:yr,defines:Ki,overrideFog:fn});if(!Ce&&Ee&&ve&&ci.lineAtlas){const Ji=ci.lineAtlas.getDash(Ee,ve);Ji&&yr.setConstantPatternPositions(Ji)}jr&&Hi.setupShadows(ci.tileID.toUnwrapped(),Yi,"vector-tile");let[Or,Tr]=n.paint.get("line-trim-offset");(ve==="round"||ve==="square")&&Or!==Tr&&(Or===0&&(Or-=1),Tr===1&&(Tr+=1));const Nr=re?ti.projMatrix:null,nn=L?1/Oi.tileToMeter/s.ay(ci,1,u.transform.zoom):1,zn=L?1/Oi.tileToMeter/s.ay(ci,1,Math.floor(u.transform.zoom)):1,us=Ce?s.e1(u,ci,n,Nr,ce,nn,zn,[Or,Tr],qi,We):s.e2(u,ci,n,Nr,Oi.lineClipsArray.length,ce,nn,zn,[Or,Tr],qi);if(ot){const Ji=Oi.gradients[n.id];let Di=Ji.texture;if(n.gradientVersion!==Ji.version){let wr=256;if(n.stepInterpolant){const jn=t.getSource().maxzoom,Vr=ti.canonical.z===jn?Math.ceil(1<<u.transform.maxZoom-ti.canonical.z):1;wr=s.aA(s.e3(Oi.maxLineLength/s.al*1024*Vr),256,j.maxTextureSize)}Ji.gradient=s.e4({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:wr,image:Ji.gradient||void 0,clips:Oi.lineClipsArray}),Ji.texture?Ji.texture.update(Ji.gradient):Ji.texture=new s.T(j,Ji.gradient,H.RGBA8),Ji.version=n.gradientVersion,Di=Ji.texture}j.activeTexture.set(H.TEXTURE1),Di.bind(n.stepInterpolant?H.NEAREST:H.LINEAR,H.CLAMP_TO_EDGE)}Te&&(j.activeTexture.set(H.TEXTURE0),ci.lineAtlasTexture&&ci.lineAtlasTexture.bind(H.LINEAR,H.REPEAT),yr.updatePaintBuffers()),Ce&&(j.activeTexture.set(H.TEXTURE0),ci.imageAtlasTexture&&ci.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),yr.updatePaintBuffers()),gi&&!P&&u.terrain.setupElevationDraw(ci,Yi),u.uploadCommonUniforms(j,Yi,ti.toUnwrapped());const gn=Ji=>{Oe!=null&&(Oe.value=ct*E),Yi.draw(u,H.TRIANGLES,Rt,Ji,X,ki.disabled,us,n.id,Oi.layoutVertexBuffer,Oi.indexBuffer,Oi.segments,n.paint,u.transform.zoom,yr,[Oi.layoutVertexBuffer2,Oi.patternVertexBuffer,Oi.zOffsetVertexBuffer]),Oe!=null&&(Oe.value=ct)};if(Ze&&!gi){const Ji=u.stencilModeForClipping(ti).ref;Ji===0&&re&&j.clear({stencil:0});const Di={func:H.EQUAL,mask:255};us.u_alpha_discard_threshold=.8,gn(new Ii(Di,Ji,255,H.KEEP,H.KEEP,H.INVERT)),us.u_alpha_discard_threshold=0,gn(new Ii(Di,Ji,255,H.KEEP,H.KEEP,H.KEEP))}else us.u_alpha_discard_threshold=Ze&&gi&&li?.8:0,gn(gi?St:u.stencilModeForClipping(ti))}};let Ge=u.depthModeForSublayer(0,ni.ReadOnly);const ut=new ni(u.depthOcclusion?H.GREATER:H.LEQUAL,ni.ReadOnly,u.depthRangeFor3D);if(n.hasNonElevatedBuckets){const _t=!re&&u.terrain;E!==0&&_t?s.w(`Occlusion opacity for layer ${n.id} is supported on terrain only if the layer has line-z-offset enabled.`):_t?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${n.id}.`):nt(c,Ye,Ge,Ii.disabled,!1,!0)}if(n.hasElevatedBuckets){R==="hd-road-markup"?F||(Ge=ut,Ye.push("ELEVATED_ROADS")):(Ye.push("ELEVATED"),Ge=ut,G&&Ye.push(te?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),P&&Ye.push("ELEVATION_REFERENCE_SEA"));const _t=Ze?u.stencilModeFor3D():Ii.disabled;u.forceTerrainMode=!0,nt(c,Ye,Ge,_t,!0,!0),Ze&&nt(c,Ye,Ge,_t,!0,!1),u.forceTerrainMode=!1}Ze&&(u.resetStencilClippingMasks(),re&&j.clear({stencil:0})),E===0||u.depthOcclusion||re||u.layersWithOcclusionOpacity.push(u.currentLayer)},fill:function(u,t,n,c){const m=n.paint.get("fill-color"),y=n.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const w=n.paint.get("fill-emissive-strength"),E=u.colorModeForDrapableLayerRenderPass(w),R=n.paint.get("fill-pattern"),L=u.opaquePassEnabledForLayer()&&!R.constantOr(1)&&m.constantOr(s.ao.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";let P="none";n.layout.get("fill-elevation-reference")!=="none"?P="road":n.paint.get("fill-z-offset").constantOr(1)!==0&&(P="offset");const F=!(!u.terrain||!u.terrain.enabled),j={painter:u,sourceCache:t,layer:n,coords:c,colorMode:E,elevationType:P,terrainEnabled:F,pass:L};if(u.renderPass!=="shadow")if(P!=="offset"){if(Lu(j,!1),P==="road"){const H=!F&&u.renderPass==="translucent";H&&rc(u,t,n,c,"geometry"),Lu(j,!0,Ii.disabled),H&&function($){const{painter:G,sourceCache:te,layer:X,coords:re,colorMode:ce}=$,fe=G.context.gl,Te=$.painter.shadowRenderer,we=!!Te&&Te.enabled,Ee=new ni(G.context.gl.LEQUAL,ni.ReadOnly,G.depthRangeFor3D);let ve=[0,0,0];if(we){const Ce=G.style.directionalLight,We=G.style.ambientLight;Ce&&We&&(ve=To(G.style,Ce,We))}const be=Ce=>{for(const We of re){const ke=te.getTile(We),ct=ke.getBucket(X);if(!ct)continue;const Ze=ct.elevatedStructures;if(!Ze)continue;let ot,Bt;if(Ce?(ot=Ze.renderableBridgeSegments,Bt=Ze.bridgeProgramConfigurations.get(X.id)):(ot=Ze.renderableTunnelSegments,Bt=Ze.tunnelProgramConfigurations.get(X.id)),!ot||ot.segments[0].primitiveLength===0)continue;Bt.updatePaintBuffers(),G.prepareDrawTile();const Ye=G.isTileAffectedByFog(We),Oe=[];we&&Oe.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const nt=G.getOrCreateProgram("elevatedStructures",{config:Bt,overrideFog:Ye,defines:Oe}),Ge=G.translatePosMatrix(We.projMatrix,ke,X.paint.get("fill-translate"),X.paint.get("fill-translate-anchor"));we&&Te.setupShadows(ke.tileID.toUnwrapped(),nt,"vector-tile");const ut=Bp(Ge,ve);G.uploadCommonUniforms(G.context,nt,We.toUnwrapped()),nt.draw(G,fe.TRIANGLES,Ee,Ii.disabled,ce,ki.backCCW,ut,X.id,Ze.vertexBuffer,Ze.indexBuffer,ot,X.paint,G.transform.zoom,Bt,[Ze.vertexBufferNormal])}};be(!0),be(!1)}(j)}}else Lu(j,!1,u.stencilModeFor3D());else u.shadowRenderer&&P==="road"&&!F&&function(H){const{painter:$,sourceCache:G,layer:te,coords:X}=H,re=$.context.gl,ce=H.painter.shadowRenderer;for(const fe of X){const Te=G.getTile(fe),we=Te.getBucket(te);if(!we)continue;const Ee=we.elevatedStructures;if(!Ee||!Ee.shadowCasterSegments||Ee.shadowCasterSegments.segments[0].primitiveLength===0)continue;$.prepareDrawTile();const ve=we.bufferData.programConfigurations.get(te.id),be=$.isTileAffectedByFog(fe),Ce=$.getOrCreateProgram("elevatedStructuresDepth",{config:ve,overrideFog:be}),We=ce.calculateShadowPassMatrixFromTile(Te.tileID.toUnwrapped());$.uploadCommonUniforms($.context,Ce,fe.toUnwrapped());const ke={u_matrix:We,u_depth_bias:0};Ce.draw($,re.TRIANGLES,ce.getShadowPassDepthMode(),Ii.disabled,ce.getShadowPassColorMode(),ki.disabled,ke,te.id,Ee.vertexBuffer,Ee.indexBuffer,Ee.shadowCasterSegments,te.paint,$.transform.zoom,ve)}}(j)},"fill-extrusion":function(u,t,n,c){const m=n.paint.get("fill-extrusion-opacity"),y=u.context,w=y.gl,E=u.terrain,R=E&&E.renderingToTexture;if(m===0)return;const L=u.conflationActive&&u.style.isLayerClipped(n,t.getSource()),P=u.style.order.indexOf(n.fqid);if(L&&function(F,j,H,$,G){for(const te of $){const X=j.getTile(te).getBucket(H);X&&(X.updateReplacement(te,F.replacementSource,G),X.uploadCentroid(F.context))}}(u,t,n,c,P),E||L)for(const F of c){const j=t.getTile(F).getBucket(n);j&&nc(u.context,t,F,j,n,E,L)}if(u.renderPass==="shadow"&&u.shadowRenderer){const F=u.shadowRenderer;if(E&&m<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ad)return;const j=F.getShadowPassDepthMode(),H=F.getShadowPassColorMode();si(u,t,n,c,j,Ii.disabled,H,L)}else if(u.renderPass==="translucent"){const F=!n.paint.get("fill-extrusion-pattern").constantOr(1),j=n.paint.get("fill-extrusion-color").constantOr(s.ao.white);if(!R&&j.a!==0){const H=new ni(u.context.gl.LEQUAL,ni.ReadWrite,u.depthRangeFor3D);m===1&&F?si(u,t,n,c,H,Ii.disabled,ir.unblended,L):(si(u,t,n,c,H,Ii.disabled,ir.disabled,L),si(u,t,n,c,H,u.stencilModeFor3D(),u.colorModeForRenderPass(),L),u.resetStencilClippingMasks())}if(u.style.enable3dLights()&&F&&(!E&&u.transform.projection.name!=="globe"||R)){const H=n.paint.get("fill-extrusion-opacity"),$=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),G=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),te=n.paint.get("fill-extrusion-flood-light-intensity"),X=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",re=n.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(X?null:n.lut).toArray01().slice(0,3),ce=$>0&&G>0,fe=te>0,Te=(ve,be,Ce)=>(1-Ce)*ve+Ce*be,we=new Df;we.translate=n.paint.get("fill-extrusion-translate"),we.translateAnchor=n.paint.get("fill-extrusion-translate-anchor"),we.edgeRadius=n.layout.get("fill-extrusion-edge-radius"),we.cutoffFadeRange=n.paint.get("fill-extrusion-cutoff-fade-range");const Ee=ve=>{const be=u.depthModeForSublayer(1,ni.ReadOnly,w.LEQUAL,!0),Ce=n.paint.get(ve?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),We=Te(.1,3,Ce),ke=u._showOverdrawInspector;if(!ke){const ct=new Ii({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Ze=new ir([w.ONE,w.ONE,w.ONE,w.ONE],s.ao.transparent,[!1,!1,!1,!0],w.MIN);vl(we,u,t,n,c,be,ct,Ze,ki.disabled,ve,"sdf",H,$,G,te,re,We,L,!1)}{const ct=ke?Ii.disabled:new Ii({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Ze=ke?u.colorModeForRenderPass():new ir([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],s.ao.transparent,[!0,!0,!0,!0]);vl(we,u,t,n,c,be,ct,Ze,ki.disabled,ve,"color",H,$,G,te,re,We,L,!1)}};if(R){const ve=(be,Ce,We)=>{const ke=u.depthModeForSublayer(1,ni.ReadOnly,w.LEQUAL,!1),ct=n.paint.get(be?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ze=Te(.1,3,ct);{const ot=new ir([w.ONE,w.ONE,w.ONE,w.ONE],s.ao.transparent,[!1,!1,!1,!0]);vl(we,u,t,n,c,ke,Ii.disabled,ot,ki.disabled,be,"clear",H,$,G,te,re,Ze,L,Ce)}{const ot=new Ii({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Bt=new ir([w.ONE,w.ONE,w.ONE,w.ONE],s.ao.transparent,[!1,!1,!1,!0],w.MIN);vl(we,u,t,n,c,ke,ot,Bt,ki.disabled,be,"sdf",H,$,G,te,re,Ze,L,Ce)}{const ot=be?w.ZERO:w.ONE_MINUS_DST_ALPHA,Bt=new Ii({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Ye=new ir([ot,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],s.ao.transparent,[!0,!0,!0,!0]);vl(we,u,t,n,c,ke,Bt,Ye,ki.disabled,be,"color",H,$,G,te,re,Ze,L,Ce)}{const ot=new ir([w.ONE,w.ONE,w.ONE,be?w.ZERO:w.ONE],s.ao.transparent,[!1,!1,!1,!0],be?w.FUNC_ADD:w.MAX);vl(we,u,t,n,c,ke,Ii.disabled,ot,ki.disabled,be,"clear",H,$,G,te,re,Ze,L,Ce,We)}};if(ce||fe){let be;if(u.prepareDrawTile(),E){const Ce=E.drapeBufferSize[0],We=E.drapeBufferSize[1];be=E.framebufferCopyTexture,be&&(!be||be.size[0]===Ce&&be.size[1]===We)||(be&&be.destroy(),be=E.framebufferCopyTexture=new s.T(y,new s.q({width:Ce,height:We}),w.RGBA8)),be.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexSubImage2D(w.TEXTURE_2D,0,0,0,0,0,Ce,We)}ce&&ve(!0,!1,be),fe&&ve(!1,!0,be)}}else ce&&Ee(!0),fe&&Ee(!1),(ce||fe)&&u.resetStencilClippingMasks()}}},building:function(u,t,n,c){u.currentLayer<u.firstLightBeamLayer&&(u.firstLightBeamLayer=u.currentLayer);const m=n.paint.get("building-ambient-occlusion-ground-intensity"),y=n.paint.get("building-ambient-occlusion-ground-radius"),w=n.paint.get("building-ambient-occlusion-ground-attenuation"),E=n.paint.get("building-opacity");if(E<=0)return;let R=m>0&&y>0,L=!0;const P=n.paint.get("building-vertical-scale");(!u.shadowRenderer||P<1)&&(L=!1);const F=u.conflationActive&&u.style.isLayerClipped(n,t.getSource()),j=u.style.order.indexOf(n.fqid);if(function(H,$,G,te,X,re){for(const ce of re){const fe=$.getTile(ce).getBucket(G);fe&&(X&&fe.updateReplacement(ce,H.replacementSource,te),fe.uploadUpdatedIndexBuffer(H.context))}}(u,t,n,j,F,c),function(H,$,G,te){for(const X of te){const re=$.getTile(X).getBucket(G);re&&re.needsEvaluation()&&re.uploadUpdatedColorBuffer(H.context)}}(u,t,n,c),n.resetLayerRenderingStats(u),u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0),u.renderPass==="shadow"&&u.shadowRenderer){const H=u.shadowRenderer,$=[],G=H.getShadowPassDepthMode();Dd({painter:u,source:t,layer:n,coords:c,defines:$,blendMode:H.getShadowPassColorMode(),depthMode:G,opacity:E,verticalScale:P,facadeEmissiveChance:0,facadeAOIntensity:0})}else if(u.renderPass==="translucent"){let H=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];L&&(H=H.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),u.shadowRenderer&&u.shadowRenderer.useNormalOffset&&(H=H.concat("NORMAL_OFFSET"));const $=n.paint.get("building-facade-emissive-chance"),G=n.paint.get("building-ambient-occlusion-intensity"),te=new ni(u.context.gl.LEQUAL,ni.ReadWrite,u.depthRangeFor3D);E<1&&Dd({painter:u,source:t,layer:n,coords:c,defines:H,blendMode:ir.disabled,depthMode:te,opacity:E,verticalScale:P,facadeEmissiveChance:$,facadeAOIntensity:G});const X=u.colorModeForRenderPass();Dd({painter:u,source:t,layer:n,coords:c,defines:H,blendMode:X,depthMode:te,opacity:E,verticalScale:P,facadeEmissiveChance:$,facadeAOIntensity:G}),R&&function(re,ce,fe,Te,we,Ee,ve,be,Ce,We,ke,ct,Ze){const ot=re.context.gl,Bt=re.depthModeForSublayer(1,ni.ReadOnly,ot.LEQUAL,!0),Ye=.1*(1-(Oe=ke))+3*Oe;var Oe;const nt=re._showOverdrawInspector,Ge=ct,ut=new Df;nt||vl(ut,re,ce,fe,Te,Bt,new Ii({func:ot.ALWAYS,mask:255},255,255,ot.KEEP,ot.KEEP,ot.REPLACE),new ir([ot.ONE,ot.ONE,ot.ONE,ot.ONE],s.ao.transparent,[!1,!1,!1,!0],ot.MIN),ki.disabled,we,"sdf",Ee,ve,be,0,We,Ye,Ge,!1);{const _t=nt?Ii.disabled:new Ii({func:ot.EQUAL,mask:255},255,255,ot.KEEP,ot.DECR,ot.DECR),$t=nt?re.colorModeForRenderPass():new ir([ot.ONE_MINUS_DST_ALPHA,ot.DST_ALPHA,ot.ONE,ot.ONE],s.ao.transparent,[!0,!0,!0,!0]);vl(ut,re,ce,fe,Te,Bt,_t,$t,ki.disabled,we,"color",Ee,ve,be,0,We,Ye,Ge,!1)}}(u,t,n,c,!0,E,m,y,0,[0,0,0],w,F)}else if(u.renderPass==="light-beam"){const H=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],$=new ni(u.context.gl.LEQUAL,ni.ReadOnly,u.depthRangeFor3D);Dd({painter:u,source:t,layer:n,coords:c,defines:H,blendMode:ir.alphaBlended,depthMode:$,opacity:E,verticalScale:P,facadeEmissiveChance:0,facadeAOIntensity:0})}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1),u.resetStencilClippingMasks()},hillshade:function(u,t,n,c){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent"||u.style.disableElevatedTerrain)return;const m=u.context,y=u.terrain&&u.terrain.renderingToTexture,[w,E]=u.renderPass!=="translucent"||y?[{},c]:u.stencilConfigForOverlap(c);for(const R of E){const L=t.getTile(R);if(L.needsHillshadePrepare&&u.renderPass==="offscreen")Eo(u,L,n);else if(u.renderPass==="translucent"){const P=u.depthModeForSublayer(0,ni.ReadOnly),F=n.paint.get("hillshade-emissive-strength"),j=u.colorModeForDrapableLayerRenderPass(F),H=y&&u.terrain?u.terrain.stencilModeForRTTOverlap(R):w[R.overscaledZ];Tf(u,R,L,n,P,H,j)}}m.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,t,n,c,m,y){if(u.renderPass!=="translucent"||n.paint.get("raster-opacity")===0)return;const w=u.transform.projection.name==="globe",E=n.paint.get("raster-elevation")!==0,R=E&&w;if(u.renderElevatedRasterBackface&&!R)return;const L=u.context,P=L.gl,F=t.getSource(),j=function(we,Ee,ve,be){const Ce=Ee.paint.get("raster-color"),We=we.type==="raster-array",ke=[],ct=Ee.paint.get("raster-resampling"),Ze=Ee.paint.get("raster-color-mix");let ot=Ee.paint.get("raster-color-range");const Bt=[Ze[0],Ze[1],Ze[2],0],Ye=Ze[3];let Oe=ct==="nearest"?be.NEAREST:be.LINEAR;if(We&&(ke.push("RASTER_ARRAY"),Ce||ke.push("RASTER_COLOR"),ct==="linear"&&ke.push("RASTER_ARRAY_LINEAR"),Oe=be.NEAREST,!ot&&we.rasterLayers)){const nt=we.rasterLayers.find(({id:Ge})=>Ge===Ee.sourceLayer);nt&&nt.fields&&nt.fields.range&&(ot=nt.fields.range)}if(ot=ot||[0,1],Ce){ke.push("RASTER_COLOR"),ve.activeTexture.set(be.TEXTURE2),Ee.updateColorRamp(ot);let nt=Ee.colorRampTexture;nt||(nt=Ee.colorRampTexture=new s.T(ve,Ee.colorRamp,be.RGBA8)),nt.bind(be.LINEAR,be.CLAMP_TO_EDGE)}return{mix:Bt,range:ot,offset:Ye,defines:ke,resampling:Oe}}(F,n,L,P);if(F instanceof s.aS&&!c.length&&!w)return;const H=n.paint.get("raster-emissive-strength"),$=u.colorModeForDrapableLayerRenderPass(H),G=u.terrain&&u.terrain.renderingToTexture,te=!u.options.moving,X=n.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;if(F instanceof s.aS&&!c.length&&(F.onNorthPole||F.onSouthPole)){const we=E?u.stencilModeFor3D():Ii.disabled;return void Of(!!F.onNorthPole,null,u,t,n,H,j,ki.disabled,we)}if(!c.length)return;const[re,ce]=F instanceof s.aS||G?[{},c]:u.stencilConfigForOverlap(c),fe=ce[ce.length-1].overscaledZ;R&&j.defines.push("PROJECTION_GLOBE_VIEW"),E&&j.defines.push("RENDER_CUTOFF");const Te=(we,Ee,ve)=>{for(const be of we){const Ce=be.toUnwrapped(),We=t.getTile(be);if(G&&(!We||!We.hasData()))continue;L.activeTexture.set(P.TEXTURE0);const ke=Du(We,F,n,j);if(!ke||!ke.texture)continue;const{texture:ct,mix:Ze,offset:ot,tileSize:Bt,buffer:Ye}=ke;let Oe,nt;G?(Oe=ni.disabled,nt=be.projMatrix):E?(Oe=new ni(P.LEQUAL,ni.ReadWrite,u.depthRangeFor3D),nt=w?Float32Array.from(u.transform.expandedFarZProjMatrix):u.transform.calculateProjMatrix(Ce,te)):(Oe=u.depthModeForSublayer(be.overscaledZ-fe,n.paint.get("raster-opacity")===1?ni.ReadWrite:ni.ReadOnly,P.LESS),nt=u.transform.calculateProjMatrix(Ce,te));const Ge=u.terrain&&G?u.terrain.stencilModeForRTTOverlap(be):re[be.overscaledZ],ut=y?0:n.paint.get("raster-fade-duration");We.registerFadeDuration(ut);const _t=t.findLoadedParent(be,0),$t=Ya(We,_t,t,u.transform,ut);let Rt,St;!$t.isFading&&We.refreshedUponExpiration&&(We.refreshedUponExpiration=!1),u.terrain&&u.terrain.prepareDrawTile(),L.activeTexture.set(P.TEXTURE0),ct.bind(X,P.CLAMP_TO_EDGE),L.activeTexture.set(P.TEXTURE1),_t?(_t.texture&&_t.texture.bind(X,P.CLAMP_TO_EDGE),Rt=Math.pow(2,_t.tileID.overscaledZ-We.tileID.overscaledZ),St=[We.tileID.canonical.x*Rt%1,We.tileID.canonical.y*Rt%1]):ct.bind(X,P.CLAMP_TO_EDGE),"useMipmap"in ct&&L.extTextureFilterAnisotropic&&u.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const gi=u.transform;let li;const ti=E?Gm(gi):[0,0,0,0];let ci,Oi,Ki,Hi,jr,qi=0;if(R&&F instanceof s.aS&&F.coordinates.length>3)ci=Float32Array.from(s.bk(s.dF(new s.cC(0,0,0)))),Oi=Float32Array.from(gi.globeMatrix),Ki=Float32Array.from(s.dB(gi)),Hi=[s.aF(gi.center.lng),s.aJ(gi.center.lat)],li=F.elevatedGlobePerspectiveTransform,jr=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(R){const Yi=s.dC(be.canonical);qi=s.dD(Yi.getCenter().lat),ci=Float32Array.from(s.bk(s.dF(be.canonical))),Oi=Float32Array.from(gi.globeMatrix),Ki=Float32Array.from(s.dB(gi)),Hi=[s.aF(gi.center.lng),s.aJ(gi.center.lat)],li=[0,0],jr=Float32Array.from(s.dE(be.canonical,Yi,qi,gi.worldSize/gi._pixelsPerMercatorPixel))}else li=F instanceof s.aS?F.perspectiveTransform:[0,0],ci=new Float32Array(16),Oi=new Float32Array(9),Ki=new Float32Array(16),Hi=[0,0],jr=new Float32Array(9);const yr=Hc(nt,ci,Oi,Ki,jr,St||[0,0],s.aj(u.transform.zoom),Hi,ti,Rt||1,$t,n,li,E?n.paint.get("raster-elevation"):0,2,Ze,ot,j.range,Bt,Ye,H),Ur=u.isTileAffectedByFog(be),fn=u.getOrCreateProgram("raster",{defines:j.defines,overrideFog:Ur});if(u.uploadCommonUniforms(L,fn,Ce),F instanceof s.aS){const Yi=F.elevatedGlobeVertexBuffer,Or=F.elevatedGlobeIndexBuffer;if(G||!w)F.boundsBuffer&&F.boundsSegments&&fn.draw(u,P.TRIANGLES,Oe,Ii.disabled,$,ki.disabled,yr,n.id,F.boundsBuffer,u.quadTriangleIndexBuffer,F.boundsSegments);else if(Yi&&Or){const Tr=gi.zoom<=s.cZ?F.elevatedGlobeSegments:F.getSegmentsForLongitude(gi.center.lng);Tr&&fn.draw(u,P.TRIANGLES,Oe,Ii.disabled,$,Ee,yr,n.id,Yi,Or,Tr)}}else if(R){Oe=new ni(P.LEQUAL,ni.ReadOnly,u.depthRangeFor3D);const Yi=u.globeSharedBuffers;if(Yi){const[Or,Tr,Nr]=Yi.getGridBuffers(qi,!1);fn.draw(u,P.TRIANGLES,Oe,ve||Ge,u.colorModeForRenderPass(),Ee,yr,n.id,Or,Tr,Nr)}}else{const{tileBoundsBuffer:Yi,tileBoundsIndexBuffer:Or,tileBoundsSegments:Tr}=u.getTileBoundsBuffers(We);fn.draw(u,P.TRIANGLES,Oe,Ge,$,ki.disabled,yr,n.id,Yi,Or,Tr)}}if(!(F instanceof s.aS)&&R)for(const be of we){const Ce=be.canonical.y===(1<<be.canonical.z)-1;be.canonical.y===0&&Of(!0,be,u,t,n,H,j,Ee,ve||Ii.disabled),Ce&&Of(!1,be,u,t,n,H,j,Ee===ki.frontCW?ki.backCW:ki.frontCW,ve||Ii.disabled)}};R?Te(ce,u.renderElevatedRasterBackface?ki.backCW:ki.frontCW,u.stencilModeFor3D()):Te(ce,ki.disabled,void 0),u.resetStencilClippingMasks()},"raster-particle":function(u,t,n,c,m,y){u.renderPass==="offscreen"&&function(w,E,R,L){if(!L.length)return;const P=w.context,F=P.gl,j=E.getSource();if(!(j instanceof Ol))return;const H=Math.ceil(Math.sqrt(R.paint.get("raster-particle-count")));let $=R.particlePositionRGBAImage;if(!$||$.width!==H){const ce=function(fe){const Te=fe*fe,we=new Uint8Array(4*Te),Ee=function(be){return be|=0,be=Math.imul(2747636419^be,2654435769),be=Math.imul(be^be>>>16,2654435769),((be=Math.imul(be^be>>>16,2654435769))>>>0)/4294967296},ve=1/1.1;for(let be=0;be<Te;be++){const Ce=ve*(Ee(2*be+0)+Iu),We=ve*(Ee(2*be+1)+Iu),ke=255*Ce%1,ct=255*We%1,Ze=ke,ot=We-ct/255,Bt=ct;we[4*be+0]=255*(Ce-ke/255),we[4*be+1]=255*Ze,we[4*be+2]=255*ot,we[4*be+3]=255*Bt}return we}(H);$=R.particlePositionRGBAImage=new s.q({width:H,height:H},ce)}let G=R.particleFramebuffer;G?G.width!==H&&(G.destroy(),G=R.particleFramebuffer=P.createFramebuffer(H,H,!0,null)):G=R.particleFramebuffer=P.createFramebuffer(H,H,!0,null);const te=[];for(const ce of L){const fe=E.getTile(ce);if(!(fe instanceof od))continue;const Te=ha(fe,j,R);if(!Te)continue;const we=[fe.tileSize,fe.tileSize];let Ee=R.tileFramebuffer;Ee||(Ee=R.tileFramebuffer=P.createFramebuffer(we[0],we[1],!0,null));let ve=fe.rasterParticleState;ve||(ve=fe.rasterParticleState=new jf(P,ce,we,$));const be=ve.update(R.lastInvalidatedAt);ve.particleTextureDimension!==H&&ve.updateParticleTexture(ce,$);const Ce=ve.targetColorTexture;ve.targetColorTexture=ve.backgroundColorTexture,ve.backgroundColorTexture=Ce;const We=ve.particleTexture0;ve.particleTexture0=ve.particleTexture1,ve.particleTexture1=We,te.push([ce,Te,ve,be])}if(te.length===0)return;const X=s.o.now(),re=R.previousDrawTimestamp?.001*(X-R.previousDrawTimestamp):.0167;if(R.previousDrawTimestamp=X,R.hasColorMap()){P.activeTexture.set(F.TEXTURE0+2);let ce=R.colorRampTexture;ce||(ce=R.colorRampTexture=new s.T(P,R.colorRamp,F.RGBA8)),ce.bind(F.LINEAR,F.CLAMP_TO_EDGE)}P.bindFramebuffer.set(R.tileFramebuffer.framebuffer),function(ce,fe,Te){const we=ce.context,Ee=we.gl,ve=fe.tileFramebuffer;we.activeTexture.set(Ee.TEXTURE0);const be={u_texture:0,u_opacity:1.05*(We=fe.paint.get("raster-particle-fade-opacity-factor"))/(We+.05)},Ce=ce.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var We;for(const ke of Te){const[,,ct,Ze]=ke;ve.colorAttachment.set(ct.targetColorTexture.texture),we.viewport.set([0,0,ve.width,ve.height]),we.clear({color:s.ao.transparent}),Ze&&(ct.backgroundColorTexture.bind(Ee.NEAREST,Ee.CLAMP_TO_EDGE),Ce.draw(ce,Ee.TRIANGLES,ni.disabled,Ii.disabled,ir.alphaBlended,ki.disabled,be,fe.id,ce.viewportBuffer,ce.quadTriangleIndexBuffer,ce.viewportSegments))}}(w,R,te),function(ce,fe,Te,we){const Ee=ce.context,ve=Ee.gl,be=Te.tileFramebuffer,Ce=ce.transform.projection.name==="globe",We=Te.paint.get("raster-particle-max-speed");for(const ke of we){const[ct,Ze,ot]=ke;Ee.activeTexture.set(ve.TEXTURE0+0),Ze.texture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE),be.colorAttachment.set(ot.targetColorTexture.texture);const Bt=ce.getOrCreateProgram("rasterParticleDraw",{defines:Ze.defines,overrideFog:!1});Ee.activeTexture.set(ve.TEXTURE0+1);const Ye=Ze.scalarData?[]:[0,1,2,3].map(Ge=>s.e6[Ge](ct));Ye.push(ct);const Oe=ct.canonical.x,nt=ct.canonical.y;for(const Ge of Ye){const ut=fe.getTile(Ce?Ge.wrapped():Ge);if(!ut)continue;const _t=ut.rasterParticleState;if(!_t)continue;const $t=Ge.canonical.x+(1<<Ge.canonical.z)*(Ge.wrap-ct.wrap),Rt=Ge.canonical.y;_t.particleTexture0.bind(ve.NEAREST,ve.CLAMP_TO_EDGE);const St=Rd(1,_t.particleTexture0.size[0],[$t-Oe,Rt-nt],0,Ze.texture.size,2,We,Ze.textureOffset,Ze.scale,Ze.offset);Bt.draw(ce,ve.POINTS,ni.disabled,Ii.disabled,ir.alphaBlended,ki.disabled,St,Te.id,_t.particleIndexBuffer,void 0,_t.particleSegment)}}}(w,E,R,te),P.bindFramebuffer.set(R.particleFramebuffer.framebuffer),function(ce,fe,Te,we){const Ee=ce.context,ve=Ee.gl,be=fe.paint.get("raster-particle-max-speed"),Ce=we*fe.paint.get("raster-particle-speed-factor")*.15,We=function(ct){return Math.pow(ct,6)}(.01+1*fe.paint.get("raster-particle-reset-rate-factor")),ke=fe.particleFramebuffer;Ee.viewport.set([0,0,ke.width,ke.height]);for(const ct of Te){const[,Ze,ot]=ct;Ee.activeTexture.set(ve.TEXTURE0+0),Ze.texture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE),Ee.activeTexture.set(ve.TEXTURE0+1);const Bt=ot.particleTexture0;Bt.bind(ve.NEAREST,ve.CLAMP_TO_EDGE);const Ye=Ah(1,Bt.size[0],0,Ze.texture.size,be,Ce,We,Ze.textureOffset,Ze.scale,Ze.offset);ke.colorAttachment.set(ot.particleTexture1.texture),Ee.clear({color:s.ao.transparent}),ce.getOrCreateProgram("rasterParticleUpdate",{defines:Ze.defines}).draw(ce,ve.TRIANGLES,ni.disabled,Ii.disabled,ir.unblended,ki.disabled,Ye,fe.id,ce.viewportBuffer,ce.quadTriangleIndexBuffer,ce.viewportSegments)}}(w,R,te,re)}(u,t,n,c),u.renderPass==="translucent"&&(function(w,E,R,L,P){const F=w.context,j=F.gl,H=E.getSource().tileSize,$=5*(1-s.ah(s.cK,s.cK+1,w.transform.zoom))*H+R.paint.get("raster-particle-elevation"),G=!w.options.moving,te=w.transform.projection.name==="globe";if(!L.length)return;const[X,re]=w.stencilConfigForOverlap(L),ce=[];te&&ce.push("PROJECTION_GLOBE_VIEW");const fe=w.stencilModeFor3D();for(const Te of re){const we=Te.toUnwrapped(),Ee=E.getTile(Te);if(!Ee.rasterParticleState)continue;const ve=Ee.rasterParticleState,be=100;Ee.registerFadeDuration(be);const Ce=E.findLoadedParent(Te,0),We=Ya(Ee,Ce,E,w.transform,be);let ke,ct;w.terrain&&w.terrain.prepareDrawTile(),F.activeTexture.set(j.TEXTURE0),ve.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),F.activeTexture.set(j.TEXTURE1),Ce&&Ce.rasterParticleState?(Ce.rasterParticleState.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),ke=Math.pow(2,Ce.tileID.overscaledZ-Ee.tileID.overscaledZ),ct=[Ee.tileID.canonical.x*ke%1,Ee.tileID.canonical.y*ke%1]):ve.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const Ze=te?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(we,G),ot=w.transform,Bt=Nf(ot),Ye=s.dC(Te.canonical),Oe=s.dD(Ye.getCenter().lat);let nt,Ge,ut,_t,$t;te?(nt=Float32Array.from(s.bk(s.dF(Te.canonical))),Ge=Float32Array.from(ot.globeMatrix),ut=Float32Array.from(s.dB(ot)),_t=[s.aF(ot.center.lng),s.aJ(ot.center.lat)],$t=Float32Array.from(s.dE(Te.canonical,Ye,Oe,ot.worldSize/ot._pixelsPerMercatorPixel))):(nt=new Float32Array(16),Ge=new Float32Array(9),ut=new Float32Array(16),_t=[0,0],$t=new Float32Array(9));const Rt=Kn(Ze,nt,Ge,ut,$t,ct||[0,0],s.aj(w.transform.zoom),_t,Bt,ke||1,We,$),St=w.isTileAffectedByFog(Te),gi=w.getOrCreateProgram("rasterParticle",{defines:ce,overrideFog:St});if(w.uploadCommonUniforms(F,gi,we),te){const li=new ni(j.LEQUAL,ni.ReadOnly,w.depthRangeFor3D),ti=0,ci=w.globeSharedBuffers;if(ci){const[Oi,Ki,Hi]=ci.getGridBuffers(Oe,ti!==0);gi.draw(w,j.TRIANGLES,li,fe,ir.alphaBlended,w.renderElevatedRasterBackface?ki.frontCCW:ki.backCCW,Rt,R.id,Oi,Ki,Hi)}}else{const li=w.depthModeForSublayer(0,ni.ReadOnly),ti=X[Te.overscaledZ],{tileBoundsBuffer:ci,tileBoundsIndexBuffer:Oi,tileBoundsSegments:Ki}=w.getTileBoundsBuffers(Ee);gi.draw(w,j.TRIANGLES,li,ti,ir.alphaBlended,ki.disabled,Rt,R.id,ci,Oi,Ki)}}w.resetStencilClippingMasks()}(u,t,n,c),u.style.map.triggerRepaint())},background:function(u,t,n,c){const m=n.paint.get("background-color"),y=n.paint.get("background-color-use-theme").constantOr("default")==="none",w=n.paint.get("background-opacity"),E=n.paint.get("background-emissive-strength"),R=n.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const L=u.context,P=L.gl,F=u.transform,j=F.tileSize,H=n.paint.get("background-pattern");let $;if(H!==void 0&&(H===null||($=u.imageManager.getPattern(s.I.from(H.toString()),n.scope,u.style.getLut(n.scope)),!$)))return;const G=!H&&m.a===1&&w===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==G)return;const te=Ii.disabled,X=u.depthModeForSublayer(0,G==="opaque"?ni.ReadWrite:ni.ReadOnly),re=u.colorModeForDrapableLayerRenderPass(E),ce=H?"backgroundPattern":"background";let fe,Te=c;if(Te||(fe=u.getBackgroundTiles(),Te=Object.values(fe).map(we=>we.tileID)),H&&(L.activeTexture.set(P.TEXTURE0),u.imageManager.bind(u.context,n.scope)),R){const we=u.getOrCreateProgram(ce,{overrideFog:!1,overrideRtt:!0}),Ee=new Float32Array(s.bA([])),ve=new s.aO(0,0,0,0,0),be=H?Ch(Ee,E,w,u,0,n.scope,$,R,{tileID:ve,tileSize:j}):If(Ee,E,w,m.toPremultipliedRenderColor(y?null:n.lut));we.draw(u,P.TRIANGLES,X,te,re,ki.disabled,be,n.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments)}else for(const we of Te){const Ee=u.isTileAffectedByFog(we),ve=u.getOrCreateProgram(ce,{overrideFog:Ee}),be=we.toUnwrapped(),Ce=c?we.projMatrix:u.transform.calculateProjMatrix(be);u.prepareDrawTile();const We=t?t.getTile(we):fe?fe[we.key]:new Sc(we,j,F.zoom,u),ke=H?Ch(Ce,E,w,u,0,n.scope,$,R,{tileID:we,tileSize:j}):If(Ce,E,w,m.toPremultipliedRenderColor(y?null:n.lut));u.uploadCommonUniforms(L,ve,be);const{tileBoundsBuffer:ct,tileBoundsIndexBuffer:Ze,tileBoundsSegments:ot}=u.getTileBoundsBuffers(We);ve.draw(u,P.TRIANGLES,X,te,re,ki.disabled,ke,n.id,ct,Ze,ot)}},sky:function(u,t,n){const c=u._atmosphere?s.aj(u.transform.zoom):1,m=n.paint.get("sky-opacity")*c;if(m===0)return;const y=u.context,w=n.paint.get("sky-type"),E=new ni(y.gl.LEQUAL,ni.ReadOnly,[0,1]),R=u.frameCounter/1e3%1;w==="atmosphere"?u.renderPass==="offscreen"?n.needsSkyboxCapture(u)&&(function(L,P,F,j){const H=L.context,$=H.gl;let G=P.skyboxFbo;if(!G){G=P.skyboxFbo=H.createFramebuffer(32,32,!0,null),P.skyboxGeometry=new Uf(H),P.skyboxTexture=H.gl.createTexture(),$.bindTexture($.TEXTURE_CUBE_MAP,P.skyboxTexture),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MAG_FILTER,$.LINEAR);for(let ce=0;ce<6;++ce)$.texImage2D($.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,$.RGBA,32,32,0,$.RGBA,$.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(G.framebuffer),H.viewport.set([0,0,32,32]);const te=P.getCenter(L,!0),X=L.getOrCreateProgram("skyboxCapture"),re=new Float64Array(16);s.bA(re),s.ek(re,re,.5*-Math.PI),$c(L,P,X,re,te,0),s.bA(re),s.ek(re,re,.5*Math.PI),$c(L,P,X,re,te,1),s.bA(re),s.cT(re,re,.5*-Math.PI),$c(L,P,X,re,te,2),s.bA(re),s.cT(re,re,.5*Math.PI),$c(L,P,X,re,te,3),s.bA(re),$c(L,P,X,re,te,4),s.bA(re),s.ek(re,re,Math.PI),$c(L,P,X,re,te,5),H.viewport.set([0,0,L.width,L.height])}(u,n),n.markSkyboxValid(u)):u.renderPass==="sky"&&function(L,P,F,j,H){const $=L.context,G=$.gl,te=L.transform,X=L.getOrCreateProgram("skybox");$.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,P.skyboxTexture);const re=((ce,fe,Te,we,Ee)=>({u_matrix:ce,u_sun_direction:fe,u_cubemap:0,u_opacity:we,u_temporal_offset:Ee}))(te.skyboxMatrix,P.getCenter(L,!1),0,j,H);L.uploadCommonUniforms($,X),X.draw(L,G.TRIANGLES,F,Ii.disabled,L.colorModeForRenderPass(),ki.backCW,re,"skybox",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(u,n,E,m,R):w==="gradient"&&u.renderPass==="sky"&&function(L,P,F,j,H){const $=L.context,G=$.gl,te=L.transform,X=L.getOrCreateProgram("skyboxGradient");P.skyboxGeometry||(P.skyboxGeometry=new Uf($)),$.activeTexture.set(G.TEXTURE0);let re=P.colorRampTexture;re||(re=P.colorRampTexture=new s.T($,P.colorRamp,G.RGBA8)),re.bind(G.LINEAR,G.CLAMP_TO_EDGE);const ce=((fe,Te,we,Ee,ve)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:Te,u_radius:s.an(we),u_opacity:Ee,u_temporal_offset:ve}))(te.skyboxMatrix,P.getCenter(L,!1),P.paint.get("sky-gradient-radius"),j,H);L.uploadCommonUniforms($,X),X.draw(L,G.TRIANGLES,F,Ii.disabled,L.colorModeForRenderPass(),ki.backCW,ce,"skyboxGradient",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(u,n,E,m,R)},custom:function(u,t,n,c){const m=u.context,y=n.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&n.isDraped(t)){if(u.renderPass==="offscreen"){const w=y.prerender;if(w){if(u.setCustomLayerDefaults(),m.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){const E=u.transform.pointMerc;w.call(y,m.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),s.aj(u.transform.zoom),[E.x,E.y],u.transform.pixelsPerMeterRatio)}else w.call(y,m.gl,u.transform.customLayerMatrix());m.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){const E=y.renderToTile;if(E){const R=c[0].canonical,L={x:R.x+c[0].wrap*(y.wrapTileId?0:1<<R.z),y:R.y,z:R.z};m.setDepthMode(ni.disabled),m.setStencilMode(Ii.disabled),m.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),E.call(y,m.gl,L),m.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),m.setColorMode(u.colorModeForRenderPass()),m.setStencilMode(Ii.disabled);const w=y.renderingMode==="3d"?new ni(u.context.gl.LEQUAL,ni.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,ni.ReadOnly);if(m.setDepthMode(w),u.transform.projection.name==="globe"){const E=u.transform.pointMerc;y.render(m.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),s.aj(u.transform.zoom),[E.x,E.y],u.transform.pixelsPerMeterRatio)}else y.render(m.gl,u.transform.customLayerMatrix());m.setDirty(),u.setBaseState(),m.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(u,t,n,c){if(u.renderPass==="opaque")return;const m=n.paint.get("model-opacity").constantOr(1);if(m===0)return;const y=n.paint.get("model-cast-shadows");if(u.renderPass==="shadow"&&(!y||u.terrain&&m<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof s.ad))return;const w=u.shadowRenderer,E=n.paint.get("model-receive-shadows");w&&(w.useNormalOffset=!0,E||(w.enabled=!1));const R=()=>{w&&(w.useNormalOffset=!0,E||(w.enabled=!0))},L=t.getSource();if(u.renderPass==="light-beam"&&L.type!=="batched-model")return;if(L.type==="vector"||L.type==="geojson")return function(X,re,ce,fe,Te){const we=X.transform;if(we.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${we.projection.name} projection is not yet implemented`);const Ee=we.getFreeCameraOptions().position;if(!X.modelManager)return;const ve=X.modelManager;ce.modelManager=ve;const be=X.shadowRenderer;if(!ce._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ce=ce._unevaluatedLayout._values["model-id"],We=Object.assign({},ce.layout.get("model-id").parameters),ke=X.style.order.indexOf(ce.fqid);for(const ct of fe){const Ze=re.getTile(ct).getBucket(ce);if(!Ze||Ze.projection.name!==we.projection.name)continue;const ot=Ze.getModelUris();ot&&!Ze.modelsRequested&&(ve.addModelsFromBucket(ot,Te),Ze.modelsRequested=!0);const Bt=ho(ct,we);We.zoom=Bt;const Ye=Ce.possiblyEvaluate(We);if(Xo(X,Ze,ct),da.shadowUniformsInitialized=!1,da.useSingleShadowCascade=!!be&&be.getMaxCascadeForTile(ct.toUnwrapped())===0,X.renderPass==="shadow"&&be){if(X.currentShadowCascade===1&&Ze.isInsideFirstShadowMapFrustum)continue;const Ge=we.calculatePosMatrix(ct.toUnwrapped(),we.worldSize);if(da.tileMatrix.set(Ge),da.shadowTileMatrix=Float32Array.from(be.calculateShadowPassMatrixFromMatrix(Ge)),da.aabb.min=[0,0,0],da.aabb.max[0]=da.aabb.max[1]=s.al,da.aabb.max[2]=0,Vf(Ze,da,X,ce.scope))continue}const Oe=1<<ct.canonical.z,nt=[((Ee.x-ct.wrap)*Oe-ct.canonical.x)*s.al,(Ee.y*Oe-ct.canonical.y)*s.al,Ee.z*Oe*s.al];X.conflationActive&&Object.keys(Ze.instancesPerModel).length>0&&X.style.isLayerClipped(ce,re.getSource())&&Ze.updateReplacement(ct,X.replacementSource,ke,Te)&&(Ze.uploaded=!1,Ze.upload(X.context));for(let Ge in Ze.instancesPerModel){const ut=Ze.instancesPerModel[Ge];ut.features.length>0&&(Ge=Ye.evaluate(ut.features[0].feature,{}));const _t=ve.getModel(Ge,Te);if(_t||ve.hasURLBeenRequested(Ge)||Ze.modelUris.includes(Ge)||(Ze.modelUris.push(Ge),Ze.modelsRequested=!1),_t&&_t.uploaded)for(const $t of _t.nodes)Wc(X,ce,$t,ut,nt,ct,da)}}}(u,t,n,c,L.type==="vector"?n.scope:""),void R();if(!L.loaded())return;if(L.type==="batched-model")return function(X,re,ce,fe){ce.resetLayerRenderingStats(X);const Te=X.context,we=X.transform,Ee=X.style.fog,ve=X.shadowRenderer;if(we.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${we.projection.name} projection is not yet implemented`);const be=X.transform.getFreeCameraOptions().position,Ce=s.c4([],[be.x,be.y,be.z],X.transform.worldSize),We=s.et([],Ce),ke=s.bA([]),ct=s.ec(we.center.lat,we.zoom),Ze=s.bq([],[1,1,1/ct]);s.br(ke,ke,We);const ot=ce.paint.get("model-opacity").constantOr(1),Bt=new ni(Te.gl.LEQUAL,ni.ReadWrite,X.depthRangeFor3D),Ye=new ni(Te.gl.LEQUAL,ni.ReadOnly,X.depthRangeFor3D),Oe=new s.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),nt=X.renderPass==="shadow",Ge=nt&&ve?ve.getCurrentCascadeFrustum():we.getFrustum(we.scaleZoom(we.worldSize)),ut=ce.paint.get("model-front-cutoff"),_t=ut[2]<1,$t=zc(X,ce.paint.get("model-cutoff-fade-range")),Rt=ce.getLayerRenderingStats();(function(St,gi,li,ti){const ci=St.terrain?St.terrain.exaggeration():0,Oi=St.transform.zoom;for(const Ki of ti){const Hi=gi.getTile(Ki).getBucket(li);Hi&&(Hi.setFilter(li.filter),St.conflationActive&&Hi.updateReplacement(Ki,St.replacementSource),Hi.evaluateTransform(St,li),St.terrain&&ci>0&&Hi.elevationUpdate(St.terrain,ci,Ki,li.source),Hi.needsReEvaluation(St,Oi,li)&&Hi.evaluate(li))}})(X,re,ce,fe),function(){let St,gi,li;_t?(St=fe.length-1,gi=-1,li=-1):(St=0,gi=fe.length,li=1);const ti=new Float64Array(16),ci=s.cz(),Oi=new s.P(0,0);for(let Ki=St;Ki!==gi;Ki+=li){const Hi=fe[Ki],jr=re.getTile(Hi).getBucket(ce);if(!jr||!jr.uploaded)continue;let qi=!1;ve&&(qi=ve.getMaxCascadeForTile(Hi.toUnwrapped())===0);const yr=we.calculatePosMatrix(Hi.toUnwrapped(),we.worldSize),Ur=jr.modelTraits;!nt&&_t&&(s.bl(ti,yr),s.af(ci,Ce,ti),Oi.x=ci[0],Oi.y=ci[1]);const fn=[];jr.setFilter(ce.filter);for(const Yi of jr.getNodesInfo()){if(Yi.hiddenByReplacement||!Yi.node.meshes)continue;const Or=Yi.node;let Tr=0;X.terrain&&Or.elevation&&(Tr=Or.elevation*X.terrain.exaggeration());const Nr=(()=>{const ws=Yi.aabb;return Oe.min=[...ws.min],Oe.max=[...ws.max],Oe.min[2]+=Tr,Oe.max[2]+=Tr,s.af(Oe.min,Oe.min,yr),s.af(Oe.max,Oe.max,yr),Oe})(),nn=Yi.evaluatedScale;if(nn[0]<=1&&nn[1]<=1&&nn[2]<=1&&Nr.intersects(Ge)===0)continue;if(!nt&&_t){const ws=.16666666666666666;Yi.cameraCollisionOpacity=Ce[0]>Nr.min[0]&&Ce[0]<Nr.max[0]&&Ce[1]>Nr.min[1]&&Ce[1]<Nr.max[1]&&Ce[2]*ct<Nr.max[2]&&Or.footprint&&s.b$(Oi,Or.footprint)?Math.max(Yi.cameraCollisionOpacity-ws,0):Math.min(1,Yi.cameraCollisionOpacity+ws)}const zn=[...yr],us=1/s.d6(Hi.canonical),gn=Or.anchor?Or.anchor[0]:0,Ji=Or.anchor?Or.anchor[1]:0;s.br(zn,zn,[gn*(nn[0]-1)+Yi.evaluatedTranslation[0]*us,Ji*(nn[1]-1)+Yi.evaluatedTranslation[1]*us,Tr+Yi.evaluatedTranslation[2]]),s.cp(nn,s.ev)||s.cR(zn,zn,nn);const Di=s.aB([],zn,Or.matrix),wr=s.aB([],we.expandedFarZProjMatrix,Di),jn=s.aB([],we.expandedFarZProjMatrix,zn),Vr=s.aC([],[gn,Ji,Tr,1],wr)[2];Or.hidden=!1;let es=ot;nt||(_t&&(es*=Yi.cameraCollisionOpacity,es*=Hf(zn,we,Yi.aabb,ut)),es*=jd($t,Vr)),es!==0?fn.push({nodeInfo:Yi,depth:Vr,opacity:es,wvpForNode:wr,wvpForTile:jn,nodeModelMatrix:Di,tileModelMatrix:zn}):Or.hidden=!0}nt||fn.sort((Yi,Or)=>!_t||Yi.opacity===1&&Or.opacity===1?Yi.depth<Or.depth?-1:1:Yi.opacity===1?-1:Or.opacity===1?1:Yi.depth>Or.depth?-1:1);for(const Yi of fn){const Or=Yi.nodeInfo,Tr=Or.node;let Nr=s.aB([],Ze,Yi.tileModelMatrix);s.aB(Nr,ke,Nr);const nn=s.bl([],Nr);s.ed(nn,nn),s.cR(nn,nn,Hp),Nr=s.aB(Nr,Nr,Tr.matrix);const zn=X.renderPass==="light-beam",us=ce.paint.get("model-color-use-theme").constantOr("default")==="none",gn=Ur&s.ez.HasMapboxMeshFeatures,Ji=gn?0:Or.evaluatedRMEA[0][2];for(let Di=0;Di<Tr.meshes.length;++Di){const wr=Tr.meshes[Di],jn=Di===Tr.lightMeshIndex;let Vr=Yi.wvpForNode;if(jn){if(!zn&&!X.terrain&&X.shadowRenderer){X.currentLayer<X.firstLightBeamLayer&&(X.firstLightBeamLayer=X.currentLayer);continue}Vr=Yi.wvpForTile}else if(zn)continue;const es={defines:[]},ws=[];if(!nt&&ve&&(ve.useNormalOffset=!!wr.normalBuffer),Ph(es.defines,ws,wr,X,us?null:ce.lut),gn||es.defines.push("DIFFUSE_SHADED"),qi&&es.defines.push("SHADOWS_SINGLE_CASCADE"),Rt&&(nt?Rt.numRenderedVerticesInShadowPass+=wr.vertexArray.length:Rt.numRenderedVerticesInTransparentPass+=wr.vertexArray.length),nt){Oh(wr,Yi.nodeModelMatrix,X,ce);continue}let Ja=null;if(Ee){const zo=qe(Yi.nodeModelMatrix,X.transform);if(Ja=new Float32Array(zo),we.projection.name!=="globe"){const Bn=wr.aabb.min,Hn=wr.aabb.max,[vn,ss]=Ee.getOpacityForBounds(zo,Bn[0],Bn[1],Hn[0],Hn[1]);es.overrideFog=vn>=pi||ss>=pi}}const mo=wr.material;let Ts;mo.occlusionTexture&&mo.occlusionTexture.offsetScale&&(Ts=mo.occlusionTexture.offsetScale,es.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const ga=X.getOrCreateProgram("model",es);!nt&&ve&&ve.setupShadowsFromMatrix(Yi.tileModelMatrix,ga,ve.useNormalOffset),X.uploadCommonUniforms(Te,ga,null,Ja);const ta=mo.pbrMetallicRoughness;ta.metallicFactor=.9,ta.roughnessFactor=.5;const _a=Rh(new Float32Array(Vr),new Float32Array(Nr),new Float32Array(nn),new Float32Array(Tr.matrix),X,Yi.opacity,ta.baseColorFactor,mo.emissiveFactor,ta.metallicFactor,ta.roughnessFactor,mo,Ji,ce,[0,0,0],Ts);!jn&&(Or.hasTranslucentParts||Yi.opacity<1)&&ga.draw(X,Te.gl.TRIANGLES,Bt,Ii.disabled,ir.disabled,ki.backCCW,_a,ce.id,wr.vertexBuffer,wr.indexBuffer,wr.segments,ce.paint,X.transform.zoom,void 0,ws),ga.draw(X,Te.gl.TRIANGLES,jn?Ye:Bt,Ii.disabled,jn||Yi.opacity<1||Or.hasTranslucentParts?ir.alphaBlended:ir.unblended,ki.backCCW,_a,ce.id,wr.vertexBuffer,wr.indexBuffer,wr.segments,ce.paint,X.transform.zoom,void 0,ws)}}}}()}(u,t,n,c),void R();if(L.type!=="model")return;const P=L.getModels(),F=[],j=u.transform.getFreeCameraOptions().position,H=s.c4([],[j.x,j.y,j.z],u.transform.worldSize);s.et(H,H);const $=[],G=[];let te=0;for(const X of P){const re=n.paint.get("model-rotation").constantOr(null),ce=n.paint.get("model-scale").constantOr(null),fe=n.paint.get("model-translation").constantOr(null);X.computeModelMatrix(u,re,ce,fe,!0,!0,!1);const Te=s.bA([]),we=s.ec(X.position.lat,u.transform.zoom),Ee=s.bq([],[1,1,1/we]);s.br(Te,Te,H),F.push({zScaleMatrix:Ee,negCameraPosMatrix:Te});for(const ve of X.nodes)Od(u.transform,ve,X.matrix,u.transform.expandedFarZProjMatrix,te,$,G);te++}if($.sort((X,re)=>re.depth-X.depth),u.renderPass!=="shadow"){if(m===1)for(const X of G)wl(X,u,n,F[X.modelIndex],Ii.disabled,u.colorModeForRenderPass());else{for(const X of G)wl(X,u,n,F[X.modelIndex],Ii.disabled,ir.disabled);for(const X of G)wl(X,u,n,F[X.modelIndex],u.stencilModeFor3D(),u.colorModeForRenderPass());u.resetStencilClippingMasks()}for(const X of $)wl(X,u,n,F[X.modelIndex],Ii.disabled,u.colorModeForRenderPass());R()}else{for(const X of G)Oh(X.mesh,X.nodeModelMatrix,u,n);for(const X of $)Oh(X.mesh,X.nodeModelMatrix,u,n);R()}}},Yc={line:function(u,t,n){if(u.hasElevatedBuckets=!1,u.hasNonElevatedBuckets=!1,u._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||u._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const c=t.getVisibleCoordinates();for(const m of c){const y=t.getTile(m).getBucket(u);if(y&&(y.elevationType!=="none"?u.hasElevatedBuckets=!0:u.hasNonElevatedBuckets=!0,u.hasElevatedBuckets&&u.hasNonElevatedBuckets))break}}}else u.hasNonElevatedBuckets=!0},model:function(u,t,n){const c=t.getSource();if(!c.loaded())return;if(c.type==="vector"||c.type==="geojson")return void(n.modelManager&&n.modelManager.upload(n,c.type==="vector"?u.scope:""));if(c.type==="batched-model"||c.type!=="model")return;const m=c.getModels();for(const y of m)y.upload(n.context)},raster:function(u,t,n){const c=t.getSource();if(!(c instanceof Ol&&c.loaded()))return;const m=u.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!m)return;const y=u.paint.get("raster-array-band")||c.getInitialBand(m);if(y==null)return;const w=t.getIds().map(E=>t.getTileByID(E));for(const E of w)E.updateNeeded(u.id,y)&&c.prepareTile(E,m,u.id,y)},"raster-particle":function(u,t,n){const c=t.getSource();if(!(c instanceof Ol&&c.loaded()))return;const m=u.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!m)return;const y=u.paint.get("raster-particle-array-band")||c.getInitialBand(m);if(y==null)return;const w=t.getIds().map(E=>t.getTileByID(E));for(const E of w)E.updateNeeded(u.id,y)&&c.prepareTile(E,m,u.id,y)}},Kc={fill:rc},Ro={fill:function(u,t,n,c){if(!n.layout||n.layout.get("fill-elevation-reference")==="none")return;const m=u.context.gl,y=new ni(m.LEQUAL,ni.ReadOnly,u.depthRangeFor3D),w=new Ii({func:m.ALWAYS,mask:255},255,255,m.KEEP,m.KEEP,m.REPLACE),E=u.transform.getFreeCameraOptions().position,R=u.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const L of c){const P=t.getTile(L),F=P.getBucket(n);if(!F)continue;const j=F.elevatedStructures;if(!j||j.depthSegments.segments[0].primitiveLength===0)continue;const H=Fp(L.toUnwrapped(),E),$=u.translatePosMatrix(L.projMatrix,P,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),G=Ru($,H,0,1,0);R.draw(u,m.TRIANGLES,y,w,ir.disabled,ki.disabled,G,n.id,j.vertexBuffer,j.indexBuffer,j.depthSegments,n.paint,u.transform.zoom)}}};class Bd{constructor(t,n,c,m,y,w){this.context=new $o(t,n),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=y,this._timeStamp=s.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const E=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const L of E)this._debugParams.enabledLayers[L]=!0;y.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),y.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),y.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),y.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const L of E)y.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],L);this.occlusionParams=new kd(y),this.setup(),this.numSublayers=Oa.maxUnderzooming+Oa.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.eG,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Nm(this),this._wireframeDebugCache=new Nd,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const R=new s.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,R,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=m,this.worldview=w}updateTerrain(t,n){const c=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(c||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ad(this,t));const m=this._terrain;this.transform.elevation=c?m:null,m.update(t,this.transform,n),this.transform.elevation&&!m.enabled&&(this.transform.elevation=null)}_updateFog(t){const n=t.fog;if(!n||this.transform.projection.name==="globe"||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[c,m]=n.getFovAdjustedRange(this.transform._fov);if(c>m)return void(this.transform.fogCullDistSq=null);const y=c+.78*(m-c);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Ad(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,n){if(this.width=t*s.o.devicePixelRatio,this.height=n*s.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style.order)this.style._mergedLayers[c].resize()}setup(){const t=this.context,n=new s.bd;n.emplaceBack(0,0),n.emplaceBack(s.al,0),n.emplaceBack(0,s.al),n.emplaceBack(s.al,s.al),this.tileExtentBuffer=t.createVertexBuffer(n,s.bf.members),this.tileExtentSegments=s.bg.simpleSegment(0,0,4,2);const c=new s.bd;c.emplaceBack(0,0),c.emplaceBack(s.al,0),c.emplaceBack(0,s.al),c.emplaceBack(s.al,s.al),this.debugBuffer=t.createVertexBuffer(c,s.bf.members),this.debugSegments=s.bg.simpleSegment(0,0,4,5);const m=new s.bd;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,s.bf.members),this.viewportSegments=s.bg.simpleSegment(0,0,4,2);const y=new s.b0;y.emplaceBack(0,0,0,0),y.emplaceBack(s.al,0,s.al,0),y.emplaceBack(0,s.al,0,s.al),y.emplaceBack(s.al,s.al,s.al,s.al),this.mercatorBoundsBuffer=t.createVertexBuffer(y,s.bi.members),this.mercatorBoundsSegments=s.bg.simpleSegment(0,0,4,2);const w=new s.b1;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(w);const E=new s.be;for(const L of[0,1,3,2,0])E.emplaceBack(L);this.debugIndexBuffer=t.createIndexBuffer(E),this.emptyTexture=new s.T(t,new s.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=s.bC();const R=this.context.gl;this.stencilClearMode=new Ii({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,ni.disabled,this.stencilClearMode,ir.disabled,ki.disabled,Fc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,n,c){if(!n||this.currentStencilSource===n.id||!t.isTileClipped()||!c||c.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const R of c)if(this._tileClippingMaskIDs[R.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=n.id;const m=this.context,y=m.gl;this.nextStencilID+c.length>256&&this.clearStencil(),m.setColorMode(ir.disabled),m.setDepthMode(ni.disabled);const w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of c){const R=n.getTile(E),L=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:F,tileBoundsSegments:j}=this.getTileBoundsBuffers(R);w.draw(this,y.TRIANGLES,ni.disabled,new Ii({func:y.ALWAYS,mask:0},L,255,y.KEEP,y.KEEP,y.REPLACE),ir.disabled,ki.disabled,Fc(E.projMatrix),"$clipping",P,F,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Ii({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const n=this.context.gl;return new Ii({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,c=t.sort((w,E)=>E.overscaledZ-w.overscaledZ),m=c[c.length-1].overscaledZ,y=c[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const w={};for(let E=0;E<y;E++)w[E+m]=new Ii({func:n.GEQUAL,mask:255},E+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=y,[w,c]}return[{[m]:Ii.disabled},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new ir([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new s.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ir.unblended:ir.alphaBlended}colorModeForDrapableLayerRenderPass(t){const n=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new ir([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new s.ao(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,n,c,m=!1){if(this.depthOcclusion)return new ni(this.context.gl.GREATER,ni.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!m)return ni.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ni(c||this.context.gl.LEQUAL,n,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,n=Math.ceil(this.width),c=Math.ceil(this.height),m=this.context.bindFramebuffer.get(),y=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===n&&this.depthFBO.height===c||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),n!==0&&c!==0&&(this.depthFBO=new Ih(this.context,n,c,!1,"texture"),this.depthTexture=new s.T(this.context,{width:n,height:c,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(m),t.bindTexture(t.TEXTURE_2D,y),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,n,c,0,0,n,c,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,n)=>t+n/this._fpsHistory.length,0))}render(t,n){const c=s.o.now();this._dt=c-this._timeStamp,this._timeStamp=c,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=n;const m=this.style._mergedLayers,y=!(!this.terrain||!this.terrain.enabled),w=()=>this.style._getOrder(y).filter(Ye=>{const Oe=m[Ye];return!(Oe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Oe.type]});let E=w(),R=!1,L=!1,P=null;for(const Ye of E){const Oe=m[Ye];Oe.type==="circle"?R=!0:Oe.type==="building"?P=Oe:Oe.type==="symbol"&&(Oe.hasOcclusionOpacityProperties?L=!0:R=!0)}let F=E.map(Ye=>m[Ye]);const j=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.o.now()),this.imageManager.beginFrame();let H=0,$=!1;for(const Ye in j){const Oe=j[Ye];Oe.used&&(Oe.prepare(this.context),Oe.getSource().usedInConflation&&++H)}let G=!1;for(const Ye of F)Ye.isHidden(this.transform.zoom)||(Ye.type==="clip"&&(G=!0),this.prepareLayer(Ye));const te={},X={},re={},ce={},fe={};for(const Ye in j){const Oe=j[Ye];te[Ye]=Oe.getVisibleCoordinates(),X[Ye]=te[Ye].slice().reverse(),re[Ye]=Oe.getVisibleCoordinates(!0).reverse(),ce[Ye]=Oe.getShadowCasterCoordinates(),fe[Ye]=Oe.sortCoordinatesByDistance(te[Ye])}const Te=Ye=>{const Oe=this.style.getLayerSourceCache(Ye);return Oe&&Oe.used?Oe.getSource():null};if(H||G||this._clippingActiveLastFrame){const Ye=[],Oe=[];let nt=0;for(const Ge of F)this.isSourceForClippingOrConflation(Ge,Te(Ge))&&(Ye.push(Ge),Oe.push(nt)),nt++;if(Ye&&(G||Ye.length>1)||this._clippingActiveLastFrame){G=!1;const Ge=[];for(let ut=0;ut<Ye.length;ut++){const _t=Ye[ut],$t=Oe[ut],Rt=this.style.getLayerSourceCache(_t);if(!Rt||!Rt.used||!Rt.getSource().usedInConflation&&_t.type!=="clip"&&_t.type!=="building")continue;let St=s.eH,gi=s.bZ.None;const li=[];let ti=!0;if(_t.type==="building")St=s.eJ;else if(_t.type==="clip"){St=$t;for(const ci of _t.layout.get("clip-layer-types"))gi|=ci==="model"?s.bZ.Model:ci==="symbol"?s.bZ.Symbol:s.bZ.FillExtrusion;for(const ci of _t.layout.get("clip-layer-scope"))li.push(ci);_t.isHidden(this.transform.zoom)?ti=!1:G=!0}ti&&Ge.push({layer:_t.fqid,cache:Rt,order:St,clipMask:gi,clipScope:li})}this.replacementSource.setSources(Ge),$=!0}}this._clippingActiveLastFrame=G,$||this.replacementSource.clear(),this.conflationActive=$,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ye=0;Ye<F.length;Ye++){const Oe=F[Ye],nt=Oe.cutoffRange();if(this.longestCutoffRange=Math.max(nt,this.longestCutoffRange),nt>0){const Ge=Te(Oe);Ge&&(this.minCutoffZoom=Math.max(Ge.minzoom,this.minCutoffZoom)),Oe.minzoom&&(this.minCutoffZoom=Math.max(Oe.minzoom,this.minCutoffZoom))}Oe.is3D(y)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ye),this._lastOcclusionLayer=Ye)}const we=this.style&&this.style.fog;we?(this._fogVisible=we.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=we.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(re),this.opaquePassCutoff=0,E=w(),F=E.map(Ye=>m[Ye]));const Ee=this._shadowRenderer;if(Ee){Ee.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ye in j)for(const Oe of te[Ye]){let nt={min:0,max:0};this.terrain&&(nt=this.terrain.getMinMaxForTile(Oe)||nt),Ee.addShadowReceiver(Oe.toUnwrapped(),nt.min,nt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eI(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Dh(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ve=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),be=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ve&&!this._snow&&(this._snow=new Wp(this)),!ve&&this._snow&&(this._snow.destroy(),delete this._snow),be&&!this._rain&&(this._rain=new Lr(this)),!be&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),P){this.buildingTileBorderManager||(this.buildingTileBorderManager=new On);const Ye=this.style.getLayerSourceCache(P);this.buildingTileBorderManager.updateBorders(Ye,P)}if(!Si.has(this.context.gl))return;this.renderPass="offscreen";for(const Ye of F){const Oe=t.getLayerSourceCache(Ye);if(!Ye.hasOffscreenPass()||Ye.isHidden(this.transform.zoom))continue;const nt=Oe?X[Oe.id]:void 0;(Ye.type==="custom"||Ye.type==="raster"||Ye.type==="raster-particle"||Ye.isSky()||nt&&nt.length)&&this.renderLayer(this,Oe,Ye,nt)}this.depthRangeFor3D=[0,1-(F.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ce)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ce=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),We=(()=>{if(n.showOverdrawInspector)return s.ao.black;const Ye=this.style.fog;if(Ye&&this.transform.projection.supportsFog){const Oe=this.style.getLut(Ye.scope);if(!Ce){const nt=Ye.properties.get("color-use-theme")==="none",Ge=Ye.properties.get("color").toNonPremultipliedRenderColor(nt?null:Oe).toArray01();return new s.ao(...Ge)}if(Ce){const nt=Ye.properties.get("space-color-use-theme")==="none",Ge=Ye.properties.get("space-color").toNonPremultipliedRenderColor(nt?null:Oe).toArray01();return new s.ao(...Ge)}}return s.ao.transparent})();if(this.context.clear({color:We,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ce&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=E.length-1;this.currentLayer>=0;this.currentLayer--){const Ye=F[this.currentLayer],Oe=t.getLayerSourceCache(Ye);if(Ye.isSky())continue;const nt=Oe?(Ye.is3D(y)?fe:X)[Oe.id]:void 0;this._renderTileClippingMasks(Ye,Oe,nt),this.renderLayer(this,Oe,Ye,nt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ce&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<E.length;this.currentLayer++){const Ye=F[this.currentLayer],Oe=t.getLayerSourceCache(Ye);Ye.isSky()&&this.renderLayer(this,Oe,Ye,Oe?X[Oe.id]:void 0)}function ke(Ye,Oe){let nt;return Oe&&(nt=(Ye.type==="symbol"?re:Ye.is3D(y)?fe:X)[Oe.id]),nt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<E.length;){const Ye=F[this.currentLayer];if(Ye.type==="raster"||Ye.type==="raster-particle"){const Oe=t.getLayerSourceCache(Ye);this.renderLayer(this,Oe,Ye,ke(Ye,Oe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ct=0;Ee&&(ct=Ee.getShadowCastingLayerCount());let Ze=!1,ot=-1;for(let Ye=0;Ye<E.length;++Ye){const Oe=F[Ye];Oe.isHidden(this.transform.zoom)||Oe.is3D(y)&&(ot=Ye)}L&&ot===-1&&(R=!0);let Bt=!1;for(;this.currentLayer<E.length;){const Ye=F[this.currentLayer],Oe=t.getLayerSourceCache(Ye);if(Ye.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ye)){if(Ye.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Bt&&Ye.is3D(y)&&!y){const nt=this.currentLayer,Ge=ut=>{for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){const _t=F[this.currentLayer];if(Kc[_t.type]){const $t=this.style.getLayerSourceCache(_t);Kc[_t.type](this,$t,_t,ke(_t,$t),ut)}}};Ge("initialize"),Ge("reset"),this.currentLayer=nt,Bt=!0}if(R&&!Ze&&this.terrain&&!this.transform.isOrthographic&&(Ze=!0,this.blitDepth()),L&&ot!==-1&&this.currentLayer===ot+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ye,Oe,Oe?te[Oe.id]:void 0),this.renderLayer(this,Oe,Ye,ke(Ye,Oe)),!this.terrain&&Ee&&ct>0&&Ye.hasShadowPass()&&--ct==0){{this.clearStencil(),this.resetStencilClippingMasks();const nt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){const Ge=F[this.currentLayer];if(Ro[Ge.type]){const ut=this.style.getLayerSourceCache(Ge);Ro[Ge.type](this,ut,Ge,ke(Ge,ut))}}this.currentLayer=nt}if(Ee.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const nt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=nt;this.currentLayer++){const Ge=F[this.currentLayer];if(!Ge.hasLightBeamPass())continue;const ut=t.getLayerSourceCache(Ge);this.renderLayer(this,ut,Ge,ut?X[ut.id]:void 0)}this.currentLayer=nt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const nt=this.currentLayer;this.depthOcclusion=!0;for(const Ge of this.layersWithOcclusionOpacity){this.currentLayer=Ge;const ut=F[this.currentLayer],_t=t.getLayerSourceCache(ut),$t=_t?X[_t.id]:void 0;this.terrain||this._renderTileClippingMasks(ut,_t,_t?te[_t.id]:void 0),this.renderLayer(this,_t,ut,$t)}this.depthOcclusion=!1,this.currentLayer=nt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ye=null;F.forEach(Oe=>{const nt=t.getLayerSourceCache(Oe);nt&&!Oe.isHidden(this.transform.zoom)&&nt.getVisibleCoordinates().length&&(!Ye||Ye.getSource().maxzoom<nt.getSource().maxzoom)&&(Ye=nt)}),Ye&&this.options.showTileBoundaries&&Lh(this,Ye,Ye.getVisibleCoordinates(),s.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Lh(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ye){const Oe=Ye.transform.padding;Zo(Ye,Ye.transform.height-(Oe.top||0),3,Ks),Zo(Ye,Oe.bottom||0,3,sc),on(Ye,Oe.left||0,3,Vp),on(Ye,Ye.transform.width-(Oe.right||0),3,kf);const nt=Ye.transform.centerPoint;(function(Ge,ut,_t,$t){Gc(Ge,ut-1,_t-10,2,20,$t),Gc(Ge,ut-10,_t-1,20,2,$t)})(Ye,nt.x,Ye.transform.height-nt.y,Bf)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),$||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:n}=this.transform.projection,c=!n||!n.includes(t.type);if(Yc[t.type]&&(c||this.terrain&&t.type==="custom")){const m=this.style.getLayerSourceCache(t);Yc[t.type](t,m,this)}this.gpuTimingEnd()}renderLayer(t,n,c,m){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="sky"||c.type==="custom"||c.type==="model"||c.type==="raster"||c.type==="raster-particle"||m&&m.length)&&(this.id=c.id,this.gpuTimingStart(c),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(c.type)&&(!t.terrain||c.type!=="custom")||c.type==="clip"||lc[c.type](t,n,c,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery,c=this.context.gl;let m=this.gpuTimers[t.id];m||(m=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:c.createQuery()}),m.calls++,c.beginQuery(n.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,n=this.context.gl,c=n.createQuery();this.deferredRenderGpuTimeQueries.push(c),n.beginQuery(t.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const n={};for(const c in t){const m=t[c],y=this.context.extTimerQuery,w=y.getQueryParameter(m.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(m.query),n[c]=w}return n}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const n=this.context.gl;let c=0;for(const m of t)c+=n.getQueryParameter(m,n.QUERY_RESULT)/1e6,n.deleteQuery(m);return c}translatePosMatrix(t,n,c,m,y){if(!c[0]&&!c[1])return t;const w=y?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(w){const L=Math.sin(w),P=Math.cos(w);c=[c[0]*P-c[1]*L,c[0]*L+c[1]*P]}const E=[y?c[0]:s.ay(n,c[0],this.transform.zoom),y?c[1]:s.ay(n,c[1],this.transform.zoom),0],R=new Float32Array(16);return s.br(R,t,E),R}saveTileTexture(t){if(t.context!==this.context)return;const n=t.size[0],c=this._tileTextures[n];c?c.push(t):this._tileTextures[n]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,n,c){const m=c===void 0?this.terrain&&this.terrain.renderingToTexture:c,y=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):m||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||m||n!==void 0&&!n||y.push("FOG","FOG_DITHERING"),m&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(t,n){this.cache=this.cache||{};const c=n&&n.defines||[],m=n&&n.config,y=this.currentGlobalDefines(t,n&&n.overrideFog,n&&n.overrideRtt).concat(c),w=Sh.cacheKey(xd[t],t,y,m);return this.cache[w]||(this.cache[w]=new Sh(this.context,t,xd[t],m,Os[t],y)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,n){if(this.style.enable3dLights()){const c=this.style.directionalLight,m=this.style.ambientLight;if(c&&m){const y=((w,E,R)=>{const L=w.properties.get("direction"),P=w.properties.get("color-use-theme")==="none",F=w.properties.get("color").toNonPremultipliedRenderColor(P?null:R.getLut(w.scope)).toArray01(),j=w.properties.get("intensity"),H=E.properties.get("color-use-theme")==="none",$=E.properties.get("color").toNonPremultipliedRenderColor(H?null:R.getLut(E.scope)).toArray01(),G=E.properties.get("intensity"),te=[L.x,L.y,L.z],X=s.dK($,G),re=s.dK(F,j);return{u_lighting_ambient_color:X,u_lighting_directional_dir:te,u_lighting_directional_color:re,u_ground_radiance:Af(te,re,X)}})(c,m,this.style);n.setLightsUniformValues(t,y)}}}uploadCommonUniforms(t,n,c,m,y){if(this.uploadCommonLightUniforms(t,n),this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const E=w.getOpacity(this.transform.pitch),R=((L,P,F,j,H,$,G,te,X,re,ce,fe)=>{const Te=L.transform,we=P.properties.get("color-use-theme")==="none",Ee=P.properties.get("color").toNonPremultipliedRenderColor(we?null:L.style.getLut(P.scope)).toArray01();Ee[3]=j;const ve=L.frameCounter/1e3%1,[be,Ce]=P.properties.get("vertical-range");return{u_fog_matrix:F?Te.calculateFogTileMatrix(F):fe||L.identityMat,u_fog_range:P.getFovAdjustedRange(Te._fov),u_fog_color:Ee,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(be,Ce),Ce],u_fog_temporal_offset:ve,u_frustum_tl:H,u_frustum_tr:$,u_frustum_br:G,u_frustum_bl:te,u_globe_pos:X,u_globe_radius:re,u_viewport:ce,u_globe_transition:s.aj(Te.zoom),u_is_globe:+(Te.projection.name==="globe")}})(this,w,c,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.o.devicePixelRatio,this.transform.height*s.o.devicePixelRatio],m);n.setFogUniformValues(t,R)}y&&n.setCutoffUniformValues(t,y.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,n=this._backgroundTiles={},c=this.transform.coveringTiles({tileSize:512});for(const m of c)n[m.key]=t[m.key]||new Sc(m,512,this.transform.tileZoom,this,void 0,this.worldview);return n}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,n){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!n||n.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let n=this._cachedTileFogOpacities[t.key];return n||(this._cachedTileFogOpacities[t.key]=n=this.style.fog.getOpacityForTile(t)),n[0]>=pi||n[1]>=pi}setupDepthForOcclusion(t,n,c){const m=this.context,y=m.gl,w=!!c;var E;c||(c={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),m.activeTexture.set(y.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),c.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],c.u_depth_range_unpack=[2/((E=this.depthRangeFor3D)[1]-E[0]),-1-2*E[0]/(E[1]-E[0])],c.u_occluder_half_size=.5*this.occlusionParams.occluderSize,c.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),m.activeTexture.set(y.TEXTURE0),w||n.setTerrainUniformValues(m,c)}}function Fd(u,t){let n=!1,c=null;const m=()=>{c=null,n&&(u(),c=setTimeout(m,t),n=!1)};return()=>(n=!0,c||m(),c)}class qf{constructor(t){this._hashName=t&&encodeURIComponent(t),s.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Fd(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const n=Ud(t);if(this._hashName){const c=this._hashName;let m=!1;const y=location.hash.slice(1).split("&").map(w=>{const E=w.split("=")[0];return E===c?(m=!0,`${E}=${n}`):w}).filter(w=>w);return m||y.push(`${c}=${n}`),`#${y.join("&")}`}return`#${n}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(n=c)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const n=this._getCurrentHash();if(n.length>=3&&!n.some(c=>isNaN(Number(c)))){const c=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(n[3]||0):t.getBearing();return t.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:c,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ud(u,t){const n=u.getCenter(),c=Math.round(100*u.getZoom())/100,m=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),w=Math.round(n.lng*y)/y,E=Math.round(n.lat*y)/y,R=u.getBearing(),L=u.getPitch();let P=t?`/${w}/${E}/${c}`:`${c}/${E}/${w}`;return(R||L)&&(P+="/"+Math.round(10*R)/10),L&&(P+=`/${Math.round(L)}`),P}const pa={linearity:.3,easing:s.eK(0,0,.3,1)},Tl=Object.assign({deceleration:2500,maxSpeed:1400},pa),Jc=Object.assign({deceleration:20,maxSpeed:1400},pa),Vd=Object.assign({deceleration:1e3,maxSpeed:360},pa),Hd=Object.assign({deceleration:1e3,maxSpeed:90},pa);class qd{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=s.o.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const n={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)n.zoom+=y.zoomDelta||0,n.bearing+=y.bearingDelta||0,n.pitch+=y.pitchDelta||0,y.panDelta&&n.pan._add(y.panDelta),y.around&&(n.around=y.around),y.pinchAround&&(n.pinchAround=y.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(n.pan.mag()){const y=Ou(n.pan.mag(),c,Object.assign({},Tl,t||{}));m.offset=n.pan.mult(y.amount/n.pan.mag()),m.center=this._map.transform.center,fo(m,y)}if(n.zoom){const y=Ou(n.zoom,c,Jc);m.zoom=this._map.transform.zoom+y.amount,fo(m,y)}if(n.bearing){const y=Ou(n.bearing,c,Vd);m.bearing=this._map.transform.bearing+s.aA(y.amount,-179,179),fo(m,y)}if(n.pitch){const y=Ou(n.pitch,c,Hd);m.pitch=this._map.transform.pitch+y.amount,fo(m,y)}if(m.zoom||m.bearing){const y=n.pinchAround===void 0?n.around:n.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function fo(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function Ou(u,t,n){const{maxSpeed:c,linearity:m,deceleration:y}=n,w=s.aA(u*m/(t/1e3),-c,c),E=Math.abs(w)/(y*m);return{easing:n.easing,duration:1e3*E,amount:w*(E/2)}}class rs extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,c,m={}){const y=rt(n.getCanvasContainer(),c),w=n.unproject(y);super(t,Object.assign({point:y,lngLat:w,originalEvent:c},m)),this._defaultPrevented=!1,this.target=n}}class ju extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,c){const m=t==="touchend"?c.changedTouches:c.touches,y=lt(n.getCanvasContainer(),m),w=y.map(R=>n.unproject(R)),E=y.reduce((R,L,P,F)=>R.add(L.div(F.length)),new s.P(0,0));super(t,{points:y,point:E,lngLats:w,lngLat:n.unproject(E),originalEvent:c}),this._defaultPrevented=!1}}class Mo extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n){super("wheel",{originalEvent:n}),this._defaultPrevented=!1}}class Gd{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Mo(this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new rs(t.type,this._map,t))}mouseup(t){this._map.fire(new rs(t.type,this._map,t))}preclick(t){const n=new MouseEvent("preclick",t);this._map.fire(new rs(n.type,this._map,n))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(t),this._map.fire(new rs(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new rs(t.type,this._map,t))}mouseover(t){this._map.fire(new rs(t.type,this._map,t))}mouseout(t){this._map.fire(new rs(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ju(t.type,this._map,t))}touchmove(t){this._map.fire(new ju(t.type,this._map,t))}touchend(t){this._map.fire(new ju(t.type,this._map,t))}touchcancel(t){this._map.fire(new ju(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xp{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new rs(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new rs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new rs(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cs{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(Le(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const c=n,m=this._startPos,y=this._lastPos;if(!m||!y||y.equals(c)||!this._box&&c.dist(m)<this._clickTolerance)return;this._lastPos=c,this._box||(this._box=Se("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const w=Math.min(m.x,c.x),E=Math.max(m.x,c.x),R=Math.min(m.y,c.y),L=Math.max(m.y,c.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${R}px)`,this._box.style.width=E-w+"px",this._box.style.height=L-R+"px")})}mouseupWindow(t,n){if(!this._active)return;const c=this._startPos,m=n;if(c&&t.button===0){if(this.reset(),it(),c.x!==m.x||c.y!==m.y)return this._map.fire(new s.z("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(c,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ae(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new s.z(t,{originalEvent:n}))}}function Nu(u,t){const n={};for(let c=0;c<u.length;c++)n[u[c].identifier]=t[c];return n}class cc{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,n,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=function(m){const y=new s.P(0,0);for(const w of m)y._add(w);return y.div(m.length)}(n),this.touches=Nu(c,n)))}touchmove(t,n,c){if(this.aborted||!this.centroid)return;const m=Nu(c,n);for(const y in this.touches){const w=m[y];(!w||w.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(t,n,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class po{constructor(t){this.singleTap=new cc(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,n,c){this.singleTap.touchstart(t,n,c)}touchmove(t,n,c){this.singleTap.touchmove(t,n,c)}touchend(t,n,c){const m=this.singleTap.touchend(t,n,c);if(m){const y=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(m)<30;if(y&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Ka{constructor(){this._zoomIn=new po({numTouches:1,numTaps:2}),this._zoomOut=new po({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,c){this._zoomIn.touchstart(t,n,c),this._zoomOut.touchstart(t,n,c)}touchmove(t,n,c){this._zoomIn.touchmove(t,n,c),this._zoomOut.touchmove(t,n,c)}touchend(t,n,c){const m=this._zoomIn.touchend(t,n,c),y=this._zoomOut.touchend(t,n,c);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(m)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Yo={0:1,2:2},kh={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class ku{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const c=zt(t);this._correctButton(t,c)&&(this._lastPoint=n,this._eventButton=c)}mousemoveWindow(t,n){const c=this._lastPoint;if(c){if(t.preventDefault(),this._eventButton!=null&&function(m,y){const w=Yo[y];return m.buttons===void 0||(m.buttons&w)!==w}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(c,n)}}mouseupWindow(t){this._lastPoint&&zt(t)===this._eventButton&&(this._moved&&it(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sl extends ku{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return n===0&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class Bu extends ku{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?kh[t.pitchRotateKey]:void 0}_correctButton(t,n){return this._pitchRotateKey?n===0&&t[this._pitchRotateKey]:n===0&&t.ctrlKey||n===2}_move(t,n){const c=.8*(n.x-t.x);if(c)return this._active=!0,{bearingDelta:c}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class El extends ku{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?kh[t.pitchRotateKey]:void 0}_correctButton(t,n){return this._pitchRotateKey?n===0&&t[this._pitchRotateKey]:n===0&&t.ctrlKey||n===2}_move(t,n){const c=-.5*(n.y-t.y);if(c)return this._active=!0,{pitchDelta:c}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Js{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),s.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(t,n,c){return this._calculateTransform(t,n,c)}touchmove(t,n,c){if(this._active&&!(c.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(c.length===1&&!s.eL())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,c)}}touchend(t,n,c){this._calculateTransform(t,n,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,c){c.length>0&&(this._active=!0);const m=Nu(c,n),y=new s.P(0,0),w=new s.P(0,0);let E=0;for(const L in m){const P=m[L],F=this._touches[L];F&&(y._add(P),w._add(P.sub(F)),E++,m[L]=P)}if(this._touches=m,E<this._minTouches||!w.mag())return;const R=w.div(E);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(E),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Se("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class uc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,n,c){return{}}touchstart(t,n,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,c){const m=this._firstTwoTouches;if(!m)return;t.preventDefault();const[y,w]=m,E=Fu(c,n,y),R=Fu(c,n,w);if(!E||!R)return;const L=this._aroundCenter?null:E.add(R).div(2);return this._move([E,R],L,t)}touchend(t,n,c){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,w=Fu(c,n,m),E=Fu(c,n,y);w&&E||(this._active&&it(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Fu(u,t,n){for(let c=0;c<u.length;c++)if(u[c].identifier===n)return t[c]}function Ko(u,t){return Math.log2(u/t)}class Gf extends uc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Ko(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ko(this._distance,c),pinchAround:n}}}function $d(u,t){return 180*u.angleWith(t)/Math.PI}class hc extends uc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const c=this._vector;if(this._vector=t[0].sub(t[1]),c&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:$d(this._vector,c),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,c=this._startVector;if(!c)return!1;const m=$d(t,c);return Math.abs(m)<n}}function Jo(u){return Math.abs(u.y)>Math.abs(u.x)}class Bh extends uc{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Jo(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,c){const m=this._lastPoints;if(!m)return;const y=t[0].sub(m[0]),w=t[1].sub(m[1]);return this._map._cooperativeGestures&&!s.eL()&&c.touches.length<3||(this._valid=this.gestureBeginsVertically(y,w,c.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+w.y)/2*-.5})}gestureBeginsVertically(t,n,c){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,y=n.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove==null&&(this._firstMove=c),c-this._firstMove<100&&void 0;const w=t.y>0==n.y>0;return Jo(t)&&Jo(n)&&w}}const $f={panStep:100,bearingStep:15,pitchStep:10};class Zf{constructor(){const t=$f;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,c=0,m=0,y=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(c=0,m=0),{cameraAnimation:E=>{const R=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:Fh,zoom:n?Math.round(R)+n*(t.shiftKey?2:1):R,bearing:E.getBearing()+c*this._bearingStep,pitch:E.getPitch()+m*this._pitchStep,offset:[-y*this._panStep,-w*this._panStep],center:E.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Fh(u){return u*(2-u)}const Uu=4.000244140625,Yp=1/450;class Kp{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Yp,s.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||s.eL()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=s.o.now(),m=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,n!==0&&n%Uu==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=n,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=rt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>Uu?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&P!==0&&(P=1/P);const F=n(),j=Math.pow(2,F),H=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(H*P))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const c=typeof this._targetZoom=="number"?this._targetZoom:n(),m=this._startZoom,y=this._easing;let w,E=!1;if(this._type==="wheel"&&m&&y){const L=Math.min((s.o.now()-this._lastWheelEventTime)/200,1),P=y(L);w=s.ak(m,c,P),L<1?this._frameId||(this._frameId=!0):E=!0}else w=c,E=!0;this._active=!0,E&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let R=w-n();return R*this._lastDelta<0&&(R=0),{noInertia:!0,needsRenderFrame:!E,zoomDelta:R,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=s.eM;if(this._prevEase){const c=this._prevEase,m=(s.o.now()-c.start)/c.duration,y=c.easing(m+.01)-c.easing(m),w=.27/Math.sqrt(y*y+1e-4)*.01,E=Math.sqrt(.0729-w*w);n=s.eK(w,E,.25,1)}return this._prevEase={start:s.o.now(),duration:t,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Se("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Uh{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class dc{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,n){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:c.getZoom()+(t.shiftKey?-1:1),around:c.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wm{constructor(){this._tap=new po({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,n,c){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=n[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(t,n,c))}touchmove(t,n,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const m=n[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,n,c)}touchend(t,n,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(t,n,c)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xm{constructor(t,n,c){this._el=t,this._mousePan=n,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vu{constructor(t,n,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Wr{constructor(t,n,c,m){this._el=t,this._touchZoom=n,this._touchRotate=c,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Vh=u=>u.zoom||u.drag||u.pitch||u.rotate;class Ym extends s.z{}class Km{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const c=s.av([],n,t);this.radius=s.ag(c[2]<0?s.eO([],c,this.constants):[c[0],c[1],0])}projectRay(t){s.eO(t,t,this.constants),s.aw(t,t),s.eP(t,t,this.constants);const n=s.c4([],t,this.radius);if(n[2]>0){const c=s.c4([],[0,0,1],s.bJ(n,[0,0,1])),m=s.c4([],s.aw([],[n[0],n[1],0]),this.radius),y=s.d7([],n,s.c4([],s.av([],s.d7([],m,c),n),2));n[0]=y[0],n[1]=y[1]}return n}}function Hh(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class Hu{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qd(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Km,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),s.aY(["handleEvent","handleWindowEvent"],this);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,y,w]of this._listeners){const E=m===document?this.handleWindowEvent:this.handleEvent;m.addEventListener(y,E,w)}}destroy(){for(const[t,n,c]of this._listeners){const m=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(n,m,c)}}_addDefaultHandlers(t){const n=this._map,c=n.getCanvasContainer();this._add("mapEvent",new Gd(n,t));const m=n.boxZoom=new cs(n,t);this._add("boxZoom",m);const y=new Ka,w=new dc;n.doubleClickZoom=new Uh(w,y),this._add("tapZoom",y),this._add("clickZoom",w);const E=new Wm;this._add("tapDragZoom",E);const R=n.touchPitch=new Bh(n);this._add("touchPitch",R);const L=new Bu(t),P=new El(t);n.dragRotate=new Vu(t,L,P),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);const F=new Sl(t),j=new Js(n,t);n.dragPan=new Xm(c,F,j),this._add("mousePan",F),this._add("touchPan",j,["touchZoom","touchRotate"]);const H=new hc,$=new Gf;n.touchZoomRotate=new Wr(c,$,H,E),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Xp(n));const G=n.scrollZoom=new Kp(n,this);this._add("scrollZoom",G,["mousePan"]);const te=n.keyboard=new Zf;this._add("keyboard",te);for(const X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[X]&&n[X].enable(t[X])}_add(t,n,c){this._handlers.push({handlerName:t,handler:n,allowed:c}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Vh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,n,c){for(const m in t)if(m!==c&&(!n||n.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const c of t)this._el.contains(c.target)&&n.push(c);return n}handleEvent(t,n){this._updatingCamera=!0;const c=t.type==="renderFrame",m=c?void 0:t,y={needsRenderFrame:!1},w={},E={},R=t.touches?this._getMapTouches(t.touches):void 0,L=R?lt(this._el,R):c?void 0:rt(this._el,t);for(const{handlerName:j,handler:H,allowed:$}of this._handlers){if(!H.isEnabled())continue;let G;this._blockedByActive(E,$,j)?H.reset():H[n||t.type]&&(G=H[n||t.type](t,L,R),this.mergeHandlerResult(y,w,G,j,m),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||H.isActive())&&(E[j]=H)}const P={};for(const j in this._previousActiveHandlers)E[j]||(P[j]=m);this._previousActiveHandlers=E,(Object.keys(P).length||Hh(y))&&(this._changes.push([y,w,P]),this._triggerRenderFrame()),(Object.keys(E).length||Hh(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=y;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(t,n,c,m,y){if(!c)return;Object.assign(t,c);const w={handlerName:m,originalEvent:c.originalEvent||y};c.zoomDelta!==void 0&&(n.zoom=w),c.panDelta!==void 0&&(n.drag=w),c.pitchDelta!==void 0&&(n.pitch=w),c.bearingDelta!==void 0&&(n.rotate=w)}_applyChanges(){const t={},n={},c={};for(const[m,y,w]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.aroundCoord!==void 0&&(t.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),Object.assign(n,y),Object.assign(c,w);this._updateMapTransform(t,n,c),this._changes=[]}_updateMapTransform(t,n,c){const m=this._map,y=m.transform,w=re=>[re.x,re.y,re.z];if((re=>{const ce=this._eventsInProgress.drag;return ce&&!this._handlersById[ce.handlerName].isActive()})()&&!Hh(t)){const re=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),re!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&m._stop(!0),!Hh(t))return void this._fireEvents(n,c,!0);let{panDelta:E,zoomDelta:R,bearingDelta:L,pitchDelta:P,around:F,aroundCoord:j,pinchAround:H}=t;y._isCameraConstrained&&(R>0&&(R=0),y._isCameraConstrained=!1),H!==void 0&&(F=H),(R||(re=>n[re]&&!this._eventsInProgress[re])("drag"))&&F&&(this._dragOrigin=w(y.pointCoordinate3D(F)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",m._stop(!0),F=F||m.transform.centerPoint,L&&(y.bearing+=L),P&&(y.pitch+=P),y._updateCameraState();const $=[0,0,0];if(E)if(y.projection.name==="mercator"){const re=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(F).dir),ce=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(F.sub(E)).dir);$[0]=ce[0]-re[0],$[1]=ce[1]-re[1]}else{const re=y.pointCoordinate(F);if(y.projection.name==="globe"){E=E.rotate(-y.angle);const ce=y._pixelsPerMercatorPixel/y.worldSize;$[0]=-E.x*s.eN(s.a$(re.y))*ce,$[1]=-E.y*s.eN(y.center.lat)*ce}else{const ce=y.pointCoordinate(F.sub(E));re&&ce&&($[0]=ce.x-re.x,$[1]=ce.y-re.y)}}const G=y.zoom,te=[0,0,0];if(R){const re=w(j||y.pointCoordinate3D(F)),ce={dir:s.aw([],s.av([],re,y._camera.position))};if(ce.dir[2]<0){const fe=y.zoomDeltaToMovement(re,R);s.c4(te,ce.dir,fe)}}const X=s.d7($,$,te);y._translateCameraConstrained(X),R&&Math.abs(y.zoom-G)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,c,!0)}_fireEvents(t,n,c){const m=Vh(this._eventsInProgress),y=Vh(t),w={};for(const P in t){const{originalEvent:F}=t[P];this._eventsInProgress[P]||(w[`${P}start`]=F),this._eventsInProgress[P]=t[P]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const P in w)this._fireEvent(P,w[P]);y&&this._fireEvent("move",y.originalEvent);for(const P in t){const{originalEvent:F}=t[P];this._fireEvent(P,F)}const E={};let R;for(const P in this._eventsInProgress){const{handlerName:F,originalEvent:j}=this._eventsInProgress[P];this._handlersById[F].isActive()||(delete this._eventsInProgress[P],R=n[F]||j,E[`${P}end`]=R)}for(const P in E)this._fireEvent(P,E[P]);const L=Vh(this._eventsInProgress);if(c&&(m||y)&&!L){this._updatingCamera=!0;const P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;P?(F(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:R})):(this._map.fire(new s.z("moveend",{originalEvent:R})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new s.z(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Ym("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const qh="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Qo extends s.E{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=n.respectPrefersReducedMotion!==!1,s.aY(["_renderFrameCallback"],this)}getCenter(){return new s.aR(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,c){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},n),c)}panTo(t,n,c){return this.easeTo(Object.assign({center:t},n),c)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,c){return this.easeTo(Object.assign({zoom:t},n),c)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,c){return this.easeTo(Object.assign({bearing:t},n),c)}resetNorth(t,n){return this.rotateTo(0,Object.assign({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=s.aI.convert(t);const c=n&&n.bearing||0,m=n&&n.pitch||0,y=t.getNorthWest(),w=t.getSouthEast();return this._cameraForBounds(this.transform,y,w,c,m,n)}_extendPadding(t){const n={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},n,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},n,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,n){const c=n.max[0]-n.min[0],m=n.max[1]-n.min[1];return c/m>t.aspect?c/(2*Math.tan(.5*t.fovX)*t.aspect):m/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,n,c,m,y,w){const E=t.clone(),R=this._extendCameraOptions(w);E.bearing=m,E.pitch=y;const L=s.aR.convert(n),P=s.aR.convert(c),F=.5*(L.lat+P.lat),j=.5*(L.lng+P.lng),H=s.eQ(F,j),$=s.aw([],H),G=s.aw([],s.bI([],$,[0,1,0])),te=s.bI([],G,$),X=[G[0],G[1],G[2],0,te[0],te[1],te[2],0,$[0],$[1],$[2],0,0,0,0,1],re=[H,s.eQ(L.lat,L.lng),s.eQ(P.lat,L.lng),s.eQ(P.lat,P.lng),s.eQ(L.lat,P.lng),s.eQ(F,L.lng),s.eQ(F,P.lng),s.eQ(L.lat,j),s.eQ(P.lat,j)];let ce=s.d8.fromPoints(re.map(Ge=>[s.bJ(G,Ge),s.bJ(te,Ge),s.bJ($,Ge)]));const fe=s.af([],ce.center,X);s.eR(fe)===0&&s.eS(fe,0,0,1),s.aw(fe,fe),s.c4(fe,fe,s.aD),E.center=s.eT(fe);const Te=E.getWorldToCameraMatrix(),we=s.bl(new Float64Array(16),Te);ce=s.d8.applyTransform(ce,s.aB([],Te,X));const Ee=this._extendAABB(ce,E,R,m);if(!Ee)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=Ee,s.af(fe,fe,Te);const ve=.5*(ce.max[2]-ce.min[2]),be=this._minimumAABBFrustumDistance(E,ce),Ce=s.c4([],[0,0,1],ve),We=s.d7(Ce,fe,Ce),ke=be+(E.pitch===0?0:s.bG(fe,We)),ct=E.globeCenterInViewSpace,Ze=s.av([],fe,[ct[0],ct[1],ct[2]]);s.aw(Ze,Ze),s.c4(Ze,Ze,ke);const ot=s.d7([],fe,Ze);s.af(ot,ot,we);const Bt=s.eD/s.aD,Ye=s.ag(ot),Oe=s.ce(Math.max(Ye*Bt-s.eD,Number.EPSILON),0),nt=Math.min(E.zoomFromMercatorZAdjusted(Oe),R.maxZoom);return nt>.5*(s.cZ+s.cK)?(E.setProjection({name:"mercator"}),E.zoom=nt,this._cameraForBounds(E,n,c,m,y,w)):{center:E.center,zoom:nt,bearing:m,pitch:y}}_extendAABB(t,n,c,m){const y=.5*((c.padding.left||0)+(c.padding.right||0)),w=.5*((c.padding.top||0)+(c.padding.bottom||0)),E=w,R=y,L=y,P=w,F=n.width-(R+L),j=n.height-(E+P),H=s.av([],t.max,t.min),$=Math.min(F/H[0],j/H[1]),G=Math.min(n.scaleZoom(n.scale*$),c.maxZoom);if(isNaN(G))return null;const te=n.scale/n.zoomScale(G),X=new s.d8([t.min[0]-R*te,t.min[1]-P*te,t.min[2]],[t.max[0]+L*te,t.max[1]+E*te,t.max[2]]),re=(typeof c.offset.x=="number"&&typeof c.offset.y=="number"?new s.P(c.offset.x,c.offset.y):s.P.convert(c.offset)).rotate(-s.an(m));return X.center[0]-=re.x*te,X.center[1]+=re.y*te,X}queryTerrainElevation(t,n){const c=this.transform.elevation;return c?(n=Object.assign({},{exaggerated:!0},n),c.getAtPoint(s.ae.fromLngLat(t),null,n.exaggerated)):null}_cameraForBounds(t,n,c,m,y,w){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,n,c,m,y,w);const E=t.clone(),R=this._extendCameraOptions(w);E.bearing=m,E.pitch=y;const L=s.aR.convert(n),P=s.aR.convert(c),F=new s.aR(L.lng,P.lat),j=new s.aR(P.lng,L.lat),H=E.project(L),$=E.project(P),G=this.queryTerrainElevation(L),te=this.queryTerrainElevation(P),X=this.queryTerrainElevation(F),re=this.queryTerrainElevation(j),ce=[[H.x,H.y,Math.min(G||0,te||0,X||0,re||0)],[$.x,$.y,Math.max(G||0,te||0,X||0,re||0)]];let fe=s.d8.fromPoints(ce);const Te=E.getWorldToCameraMatrix(),we=s.bl(new Float64Array(16),Te);fe=s.d8.applyTransform(fe,Te);const Ee=this._extendAABB(fe,E,R,m);if(!Ee)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=Ee;const ve=.5*s.av([],fe.max,fe.min)[2],be=this._minimumAABBFrustumDistance(E,fe),Ce=[0,0,1,0];s.aC(Ce,Ce,Te),s.eU(Ce,Ce);const We=s.c4([],Ce,be+ve),ke=s.d7([],fe.center,We);s.af(fe.center,fe.center,we),s.af(ke,ke,we);const ct=E.unproject(new s.P(fe.center[0],fe.center[1])),Ze=s.eV(E.projection,ct),ot=Math.pow(2,Ze),Bt=Math.min(E._zoomFromMercatorZ(ke[2]*E.pixelsPerMeter*ot/E.worldSize),R.maxZoom);return E.mercatorFromTransition&&Bt<.5*(s.cZ+s.cK)?(E.setProjection({name:"globe"}),E.zoom=Bt,this._cameraForBounds(E,n,c,m,y,w)):{center:ct,zoom:Bt,bearing:m,pitch:y}}fitBounds(t,n,c){const m=this.cameraForBounds(t,n);return this._fitInternal(m,n,c)}fitScreenCoordinates(t,n,c,m,y){const w=s.P.convert(t),E=s.P.convert(n),R=new s.P(Math.min(w.x,E.x),Math.min(w.y,E.y)),L=new s.P(Math.max(w.x,E.x),Math.max(w.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,E))return this;const P=this.transform.pointLocation3D(R),F=this.transform.pointLocation3D(L),j=this.transform.pointLocation3D(new s.P(R.x,L.y)),H=this.transform.pointLocation3D(new s.P(L.x,R.y)),$=[Math.min(P.lng,F.lng,j.lng,H.lng),Math.min(P.lat,F.lat,j.lat,H.lat)],G=[Math.max(P.lng,F.lng,j.lng,H.lng),Math.max(P.lat,F.lat,j.lat,H.lat)],te=m&&m.pitch?m.pitch:this.getPitch(),X=this._cameraForBounds(this.transform,$,G,c,te,m);return this._fitInternal(X,m,y)}_fitInternal(t,n,c){return t?(n=Object.assign(t,n)).linear?this.easeTo(n,c):this.flyTo(n,c):this}jumpTo(t,n){this.stop();const c=t.preloadOnly?this.transform.clone():this.transform;let m=!1,y=!1,w=!1;"zoom"in t&&c.zoom!==+t.zoom&&(m=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=s.aR.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(y=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(w=!0,c.pitch=+t.pitch);const E=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!c.isPaddingEqual(E))if(t.retainPadding===!1){const R=c.clone();R.padding=E,c.setLocationAtPoint(c.center,R.centerPoint)}else c.padding=E;return t.preloadOnly?(this._preloadTiles(c),this):(this.fire(new s.z("movestart",n)).fire(new s.z("move",n)),m&&this.fire(new s.z("zoomstart",n)).fire(new s.z("zoom",n)).fire(new s.z("zoomend",n)),y&&this.fire(new s.z("rotatestart",n)).fire(new s.z("rotate",n)).fire(new s.z("rotateend",n)),w&&this.fire(new s.z("pitchstart",n)).fire(new s.z("pitch",n)).fire(new s.z("pitchend",n)),this.fire(new s.z("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(qh),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){const c=this.transform;if(!c.projection.supportsFreeCamera)return s.w(qh),this;this.stop();const m=c.zoom,y=c.pitch,w=c.bearing;c.setFreeCameraOptions(t);const E=m!==c.zoom,R=y!==c.pitch,L=w!==c.bearing;return this.fire(new s.z("movestart",n)).fire(new s.z("move",n)),E&&this.fire(new s.z("zoomstart",n)).fire(new s.z("zoom",n)).fire(new s.z("zoomend",n)),L&&this.fire(new s.z("rotatestart",n)).fire(new s.z("rotate",n)).fire(new s.z("rotateend",n)),R&&this.fire(new s.z("pitchstart",n)).fire(new s.z("pitch",n)).fire(new s.z("pitchend",n)),this.fire(new s.z("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:s.eM},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const c=this.transform,m=this.getZoom(),y=this.getBearing(),w=this.getPitch(),E=this.getPadding(),R="zoom"in t?+t.zoom:m,L="bearing"in t?this._normalizeBearing(t.bearing,y):y,P="pitch"in t?+t.pitch:w,F=this._extendPadding(t.padding),j=s.P.convert(t.offset);let H,$,G;if(c.projection.name==="globe"){const Ce=s.ae.fromLngLat(c.center),We=j.rotate(-c.angle);Ce.x+=We.x/c.worldSize,Ce.y+=We.y/c.worldSize;const ke=Ce.toLngLat(),ct=s.aR.convert(t.center||ke);this._normalizeCenter(ct),H=c.centerPoint.add(We),$=new s.P(Ce.x,Ce.y).mult(c.worldSize),G=new s.P(s.aF(ct.lng),s.aJ(ct.lat)).mult(c.worldSize).sub($)}else{H=c.centerPoint.add(j);const Ce=c.pointLocation(H),We=s.aR.convert(t.center||Ce);this._normalizeCenter(We),$=c.project(Ce),G=c.project(We).sub($)}const te=c.zoomScale(R-m);let X,re;t.around&&(X=s.aR.convert(t.around),re=c.locationPoint(X));const ce=this._zooming||R!==m,fe=this._rotating||y!==L,Te=this._pitching||P!==w,we=!c.isPaddingEqual(F),Ee=t.retainPadding===!1?c.clone():c,ve=Ce=>We=>{if(ce&&(Ce.zoom=s.ak(m,R,We)),fe&&(Ce.bearing=s.ak(y,L,We)),Te&&(Ce.pitch=s.ak(w,P,We)),we&&(Ee.interpolatePadding(E,F,We),H=Ee.centerPoint.add(j)),X)Ce.setLocationAtPoint(X,re);else{const ke=Ce.zoomScale(Ce.zoom-m),ct=R>m?Math.min(2,te):Math.max(.5,te),Ze=Math.pow(ct,1-We),ot=Ce.unproject($.add(G.mult(We*Ze)).mult(ke));Ce.setLocationAtPoint(Ce.renderWorldCopies?ot.wrap():ot,H)}return t.preloadOnly||this._fireMoveEvents(n),Ce};if(t.preloadOnly){const Ce=this._emulate(ve,t.duration,c);return this._preloadTiles(Ce),this}const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ce,this._rotating=fe,this._pitching=Te,this._padding=we,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,be),this._ease(ve(c),Ce=>{c.cameraElevationReference==="sea"&&c.recenterOnTerrain(),this._afterEase(n,Ce)},t),this}_prepareEase(t,n,c={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),n||c.moving||this.fire(new s.z("movestart",t)),this._zooming&&!c.zooming&&this.fire(new s.z("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new s.z("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new s.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.z("move",t)),this._zooming&&this.fire(new s.z("zoom",t)),this._rotating&&this.fire(new s.z("rotate",t)),this._pitching&&this.fire(new s.z("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const c=this._zooming,m=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new s.z("zoomend",t)),m&&this.fire(new s.z("rotateend",t)),y&&this.fire(new s.z("pitchend",t)),this.fire(new s.z("moveend",t))}flyTo(t,n){if(this._prefersReducedMotion(t)){const Ge=s.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ge,n)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:s.eM},t);const c=this.transform,m=this.getZoom(),y=this.getBearing(),w=this.getPitch(),E=this.getPadding(),R="zoom"in t?s.aA(+t.zoom,c.minZoom,c.maxZoom):m,L="bearing"in t?this._normalizeBearing(t.bearing,y):y,P="pitch"in t?+t.pitch:w,F=this._extendPadding(t.padding),j=c.zoomScale(R-m),H=s.P.convert(t.offset);let $=c.centerPoint.add(H);const G=c.pointLocation($),te=s.aR.convert(t.center||G);this._normalizeCenter(te);const X=c.project(G),re=c.project(te).sub(X);let ce=t.curve;const fe=Math.max(c.width,c.height),Te=fe/j,we=re.mag();if("minZoom"in t){const Ge=s.aA(Math.min(t.minZoom,m,R),c.minZoom,c.maxZoom),ut=fe/c.zoomScale(Ge-m);ce=Math.sqrt(ut/we*2)}const Ee=ce*ce;function ve(Ge){const ut=(Te*Te-fe*fe+(Ge?-1:1)*Ee*Ee*we*we)/(2*(Ge?Te:fe)*Ee*we);return Math.log(Math.sqrt(ut*ut+1)-ut)}function be(Ge){return(Math.exp(Ge)-Math.exp(-Ge))/2}function Ce(Ge){return(Math.exp(Ge)+Math.exp(-Ge))/2}const We=ve(0);let ke=function(Ge){return Ce(We)/Ce(We+ce*Ge)},ct=function(Ge){return fe*((Ce(We)*(be(ut=We+ce*Ge)/Ce(ut))-be(We))/Ee)/we;var ut},Ze=(ve(1)-We)/ce;if(Math.abs(we)<1e-6||!isFinite(Ze)){if(Math.abs(fe-Te)<1e-6)return this.easeTo(t,n);const Ge=Te<fe?-1:1;Ze=Math.abs(Math.log(Te/fe))/ce,ct=function(){return 0},ke=function(ut){return Math.exp(Ge*ce*ut)}}t.duration="duration"in t?+t.duration:1e3*Ze/("screenSpeed"in t?+t.screenSpeed/ce:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const ot=y!==L,Bt=P!==w,Ye=!c.isPaddingEqual(F),Oe=t.retainPadding===!1?c.clone():c,nt=Ge=>ut=>{const _t=ut*Ze,$t=1/ke(_t);Ge.zoom=ut===1?R:m+Ge.scaleZoom($t),ot&&(Ge.bearing=s.ak(y,L,ut)),Bt&&(Ge.pitch=s.ak(w,P,ut)),Ye&&(Oe.interpolatePadding(E,F,ut),$=Oe.centerPoint.add(H));const Rt=ut===1?te:Ge.unproject(X.add(re.mult(ct(_t))).mult($t));return Ge.setLocationAtPoint(Ge.renderWorldCopies?Rt.wrap():Rt,$),Ge._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(n),Ge};if(t.preloadOnly){const Ge=this._emulate(nt,t.duration,c);return this._preloadTiles(Ge),this}return this._zooming=!0,this._rotating=ot,this._pitching=Bt,this._padding=Ye,this._prepareEase(n,!1),this._ease(nt(c),()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const c=this._onEaseEnd;this._onEaseEnd=void 0,c.call(this,n)}if(!t){const c=this.handlers;c&&c.stop(!1)}return this}_ease(t,n,c){c.animate===!1||c.duration===0?(t(1),n()):(this._easeStart=s.o.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.o.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=s.bT(t,-180,180);const c=Math.abs(t-n);return Math.abs(t-360-n)<c&&(t-=360),Math.abs(t+360-n)<c&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(n.maxBounds||n.projection.name!=="globe"&&!n.renderWorldCopies)return;const c=t.lng-n.center.lng;t.lng+=c>180?-360:c<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&s.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,n,c){const m=Math.ceil(15*n/1e3),y=[],w=t(c.clone());for(let E=0;E<=m;E++){const R=w(E/m);y.push(R.clone())}return y}_preloadTiles(t,n){}}class ns{constructor(t={}){this.options=t,s.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const n=this.options&&this.options.compact,c=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Se("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",c);const m=Se("span","mapboxgl-ctrl-icon",this._compactButton);return m.setAttribute("aria-hidden","true"),m.setAttribute("title",c),this._innerContainer=Se("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),n===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(t){const c=n.reduce((m,y,w)=>(y.value&&(m+=`${y.key}=${y.value}${w<n.length-1?"&":""}`),m),"?");t.href=`${s.e.FEEDBACK_URL}/${c}#${Ud(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const n=this._map.style._mergedSourceCaches;for(const m in n){const y=n[m];if(y.used){const w=y.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t.sort((m,y)=>m.length-y.length),t=t.filter((m,y)=>{for(let w=y+1;w<t.length;w++)if(t[w].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Io{constructor(){s.aY(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Se("div","mapboxgl-ctrl");const n=Se("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const n in t){const c=t[n].getSource();if(c.hasOwnProperty("mapbox_logo")&&!c.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class Gh{constructor(){s.aY(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",n=>this._onIndoorUpdate({selectedFloorId:n.selectedFloorId,floors:n.floors})),this._container}_createButton(t,n){const c=Se("button",t,this._container);return c.type="button",c.addEventListener("click",n),c}_createSeparator(){return Se("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,n){this._map&&(t.setAttribute("aria-label",n),t.textContent=n)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return void(this._container.style.display="none");const n=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px";const c=t.floors.sort((m,y)=>y.levelOrder-m.levelOrder);n?(Array.from(this._container.children).forEach(m=>m.remove()),this.addCurrentFloors(c)):this.addCurrentFloors(c)}addCurrentFloors(t){for(let n=0;n<t.length;n++){const c=t[n],m=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(c.id),this._model&&(this._model.selectedFloorId=c.id),Array.from(this._container.children).forEach(y=>{y.classList.contains("mapboxgl-ctrl-level-button")&&y.classList.remove("mapboxgl-ctrl-level-button-selected")}),m.classList.add("mapboxgl-ctrl-level-button-selected")});this._setButtonTitle(m,c.shortName),this._model&&c.id===this._model.selectedFloorId&&m.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(m),n<t.length-1&&this._createSeparator()}}}class Jr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,c=n?this._queue.concat(n):this._queue;for(const m of c)if(m.id===t)return void(m.cancelled=!0)}run(t=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const c of n)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class el{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=s.dz((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,n,c){this._start=this.getValue(n),this._end=t,this._startTime=n,this._endTime=n+c}}const Zd={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class $h extends s.z{constructor(t,n,c,m){const{point:y,lngLat:w,originalEvent:E,target:R}=t;super(t.type,{point:y,lngLat:w,originalEvent:E,target:R}),this.preventDefault=()=>{t.preventDefault()},this.id=n,this.interaction=c,this.feature=m}}class Jp{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,n){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const c=n.filter;let m=n.type;c&&this.filters.set(t,s.b6(c)),m==="mouseover"&&(m="mouseenter"),m==="mouseout"&&(m="mouseleave");const y=this.interactionsByType.get(m)||new Map;m==="mouseenter"||m==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,n)):y.size===0&&this.map.on(m,this.handleType),y.size===0&&this.interactionsByType.set(m,y),y.set(t,n),this.typeById.set(t,m)}get(t){const n=this.typeById.get(t);if(!n)return;const c=this.interactionsByType.get(n);return c?c.get(t):void 0}remove(t){const n=this.typeById.get(t);if(!n)return;this.typeById.delete(t),this.filters.delete(t);const c=this.interactionsByType.get(n);c&&(c.delete(t),n==="mouseenter"||n==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):c.size===0&&this.map.off(n,this.handleType))}queryTargets(t,n){const c=[];for(const[m,y]of n)y.target&&c.push({targetId:m,target:y.target,filter:this.filters.get(m)});return this.map.style.queryRenderedTargets(t,c,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const n=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());n.length&&(t.type="mouseenter",this.handleType(t,n));const c=new Map;for(const[m,{feature:y}]of this.prevHoveredFeatures)this.hoveredFeatures.has(m)||c.set(y.id,y);c.size&&(t.type="mouseleave",this.handleType(t,Array.from(c.values())))}handleOut(t){const n=Array.from(this.hoveredFeatures.values()).map(({feature:c})=>c);n.length&&(t.type="mouseleave",this.handleType(t,n)),this.hoveredFeatures.clear()}handleType(t,n){const c=t.type==="mouseenter";if(c&&!this.interactionsByType.has(t.type))return void s.w("mouseenter interaction required for mouseleave to work.");const m=Array.from(this.interactionsByType.get(t.type)).reverse(),y=!!n;n=n||this.queryTargets(t.point,m);let w=!1;const E=new Set;for(const R of n){for(const[L,P]of m){if(!P.target)continue;const F=R.variants?R.variants[L]:null;if(F){for(const j of F){if(Bo(j,R,E,L))continue;const H=new s.dt(R,j),$=lh(j,R,L);y&&(H.state=this.map.getFeatureState(H));const G=c?this.prevHoveredFeatures.get($):null,te=new $h(t,L,P,H),X=G?G.stop:P.handler(te);if(c&&this.hoveredFeatures.set($,{feature:R,stop:X}),X!==!1){w=!0;break}}if(w)break}}if(w)break}if(!w)for(const[R,L]of m){const{handler:P,target:F}=L;if(!F&&P(new $h(t,R,L,null))!==!1)break}}}function js(u,t){if(Array.isArray(u)&&Array.isArray(t)){const n=new Set(u),c=new Set(t);return n.size===c.size&&u.every(m=>c.has(m))}return s.by(u,t)}const ma={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},fc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Jm{constructor(t,n,c=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new Bu({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,c&&(this.mousePitch=new El({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),Le()}move(t,n){const c=this.map,m=this.mouseRotate.mousemoveWindow(t,n),y=m&&m.bearingDelta;if(y&&c.setBearing(c.getBearing()+y),this.mousePitch){const w=this.mousePitch.mousemoveWindow(t,n),E=w&&w.pitchDelta;E&&c.setPitch(c.getPitch()+E)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ae(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),rt(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,rt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=lt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=lt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Wd(u,t,n){if(u=new s.aR(u.lng,u.lat),t){const c=new s.aR(u.lng-360,u.lat),m=new s.aR(u.lng+360,u.lat),y=360*Math.ceil(Math.abs(u.lng-n.center.lng)/360),w=n.locationPoint3D(u).distSqr(t),E=t.x<0||t.y<0||t.x>n.width||t.y>n.height;n.locationPoint3D(c).distSqr(t)<w&&(E||Math.abs(c.lng-n.center.lng)<y)?u=c:n.locationPoint3D(m).distSqr(t)<w&&(E||Math.abs(m.lng-n.center.lng)<y)&&(u=m)}for(;Math.abs(u.lng-n.center.lng)>180;){const c=n.locationPoint3D(u);if(c.x>=0&&c.y>=0&&c.x<=n.width&&c.y<=n.height)break;u.lng>n.center.lng?u.lng-=360:u.lng+=360}return u}const Xd={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Va={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Qs extends s.E{constructor(t,n){super(),(t instanceof HTMLElement||n)&&(t=Object.assign({element:t},n)),s.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:c="center",color:m="#3FB1CE",scale:y=1,draggable:w=!1,clickTolerance:E=0,rotation:R=Va.rotation,rotationAlignment:L=Va.rotationAlignment,pitchAlignment:P=Va.pitchAlignment,occludedOpacity:F=Va.occludedOpacity,altitude:j=Va.altitude}=t||{};this._anchor=c,this._color=m,this._scale=y,this._draggable=w,this._clickTolerance=E,this._rotation=R,this._rotationAlignment=L,this._pitchAlignment=P,this._occludedOpacity=F,this._altitude=j,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",G=>{G.preventDefault()}),this._element.addEventListener("mousedown",G=>{G.preventDefault()});const H=this._element.classList;for(const G in Xd)H.remove(`mapboxgl-marker-anchor-${G}`);H.add(`mapboxgl-marker-anchor-${this._anchor}`);const $=t&&t.className?t.className.trim().split(/\s+/):[];H.add(...$),this._popup=null}_createDefaultMarker(){const t=Se("div"),n=ee("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const c=ee("radialGradient",{id:"shadowGradient"},ee("defs",{},n));ee("stop",{offset:"10%","stop-opacity":.4},c),ee("stop",{offset:"100%","stop-opacity":.05},c),ee("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},n)}return ee("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},n),ee("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},n),ee("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},n),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.aR.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Va.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const n=t.code,c=t.charCode||t.keyCode;n!=="Space"&&n!=="Enter"&&c!==32&&c!==13||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,c=this._element;this._popup&&(n===c||c.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,n=this._pos;if(!t||!n)return!1;const c=t.unproject(n,this._altitude),m=t.getFreeCameraOptions();if(!m.position)return!1;const y=m.position.toLngLat();return y.distanceTo(c)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)return void this._clearFadeTimer();const c=t.unproject(n,this._altitude);let m;t._showingGlobe()&&s.eY(t.transform,this._lngLat)?m=0:(m=1-t._queryFogOpacity(c),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(m*=this._occludedOpacity)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const n=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Xd[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${n.x}px,${n.y}px)
        `}_calculateXYTransform(){const t=this._pos,n=this._map,c=this.getPitchAlignment();if(!n||!t||c!=="map")return"";if(!n._showingGlobe()){const R=n.getPitch();return R?`rotateX(${R}deg)`:""}const m=s.cW(s.eZ(n.transform,this._lngLat)),y=t.sub(s.e_(n.transform)),w=Math.abs(y.x)+Math.abs(y.y);if(w===0)return"";const E=m/w;return`rotateX(${-y.y*E}deg) rotateY(${y.x*E}deg)`}_calculateZTransform(){const t=this._pos,n=this._map;if(!n||!t)return"";let c=0;const m=this.getRotationAlignment();if(m==="map")if(n._showingGlobe()){const y=n.project(new s.aR(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),w=n.project(new s.aR(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(y);c=s.cW(Math.atan2(w.y,w.x))-90}else c=-n.getBearing();else if(m==="horizon"){const y=s.ah(4,6,n.getZoom()),w=s.e_(n.transform);w.y+=y*n.transform.height;const E=t.sub(w),R=s.cW(Math.atan2(E.y,E.x));c=(R>90?R-270:R+90)*(1-y)}return c+=this._rotation,c?`rotateZ(${c}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=Wd(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const n=this._map;if(!n)return;const c=this._pointerdownPos,m=this._positionDelta;if(c&&m){if(!this._isDragging){const y=this._clickTolerance||n._clickTolerance;if(t.point.dist(c)<y)return;this._isDragging=!0}this._pos=t.point.sub(m),this._lngLat=n.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.z("dragstart"))),this.fire(new s.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.z("dragend")),this._state="inactive"}_addDragHandler(t){const n=this._map,c=this._pos;n&&c&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(c),this._pointerdownPos=t.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const n=this._map;return n&&(t?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Va.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Va.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Va.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Va.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ea={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Al={maxWidth:100,unit:"metric"},Ns={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Qc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},$s=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function qu(u=new s.P(0,0),t="bottom"){if(typeof u=="number"){const n=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(t){case"top":return new s.P(0,u);case"top-left":return new s.P(n,n);case"top-right":return new s.P(-n,n);case"bottom":return new s.P(0,-u);case"bottom-left":return new s.P(n,-n);case"bottom-right":return new s.P(-n,-n);case"left":return new s.P(u,0);case"right":return new s.P(-u,0)}return new s.P(0,0)}return u instanceof s.P||Array.isArray(u)?s.P.convert(u):s.P.convert(u[t]||[0,0])}return{version:q,supported:le.supported,setRTLTextPlugin:s.f2,getRTLTextPluginStatus:s.f1,Map:class extends Qo{constructor(u){Q.mark(Z.create);const t=u;if((u=Object.assign({},ma,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&s.eW(window)&&(u.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ea(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies,null,null),u),this._repaint=!!u.repaint,this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new Jr,this._domRenderTaskQueue=new Jr,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.b2(),this._locale=Object.assign({},Zd,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._tessellationStep=u.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=u.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new el(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=u.scaleFactor,this._requestManager=new or(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,this._contextCreateOptions=u.contextCreateOptions?Object.assign({},u.contextCreateOptions):{},typeof u.container=="string"){const n=document.getElementById(u.container);if(!n)throw new Error(`Container '${u.container.toString()}' not found.`);this._container=n}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),this._spriteFormat=u.spriteFormat,s.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Pu),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Hu(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,(u.style||!u.testMode)&&this.setStyle(u.style||s.e.DEFAULT_STYLE,{config:u.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this.indoor=new bu(this),u.hash&&(this._hash=new qf(typeof u.hash=="string"&&u.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch});const n=u.bounds;n&&(this.resize(),this.fitBounds(n,Object.assign({},u.fitBoundsOptions,{duration:0})))}this.resize(),u.attributionControl&&this.addControl(new ns({customAttribution:u.customAttribution})),this._logoControl=new Io,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new s.z(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new s.z(`${n.dataType}dataloading`,n))}),this._interactions=new Jp(this)}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new s.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=u.onAdd(this);this._controls.push(u);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(n,c.firstChild):c.appendChild(n),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new s.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new s.z("movestart",u)).fire(new s.z("move",u)),this.fire(new s.z("resize",u)),t&&this.fire(new s.z("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(s.aI.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(u){return this._scaleFactor=u,this.painter.scaleFactor=u,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(t=>t==="auto"?navigator.language:t):u}setLanguage(u){const t=this._parseLanguage(u);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,t=u.projection.name;let n;t==="globe"&&u.zoom>=s.cK?(u.setMercatorFromTransition(),n=!0):t==="mercator"&&u.zoom<s.cK&&(u.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(u,t){return this._updateProjection(u||t||{name:"mercator"})}_updateProjection(u){let t;return t=u.name==="globe"&&this.transform.zoom>=s.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(u,t){return this.transform.locationPoint3D(s.aR.convert(u),t)}unproject(u,t){return this.transform.pointLocation3D(s.P.convert(u),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,t,n){const c=m=>{let y=[];if(Array.isArray(t)){const w=t.filter(E=>this.getLayer(E));y=w.length?this.queryRenderedFeatures(m,{layers:w}):[]}else y=this.queryRenderedFeatures(m,{target:t});return y};if(u==="mouseenter"||u==="mouseover"){let m=!1;return{listener:n,targets:t,delegates:{mousemove:w=>{const E=c(w.point);E.length?m||(m=!0,n.call(this,new rs(u,this,w.originalEvent,{features:E}))):m=!1},mouseout:()=>{m=!1}}}}if(u==="mouseleave"||u==="mouseout"){let m=!1;return{listener:n,targets:t,delegates:{mousemove:E=>{c(E.point).length?m=!0:m&&(m=!1,n.call(this,new rs(u,this,E.originalEvent)))},mouseout:E=>{m&&(m=!1,n.call(this,new rs(u,this,E.originalEvent)))}}}}{const m=y=>{const w=c(y.point);w.length&&(y.features=w,n.call(this,y),delete y.features)};return{listener:n,targets:t,delegates:{[u]:m}}}}on(u,t,n){if(typeof t=="function"||n===void 0)return super.on(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._createDelegatedListener(u,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(c);for(const m in c.delegates)this.on(m,c.delegates[m]);return this}once(u,t,n){if(typeof t=="function"||n===void 0)return super.once(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._createDelegatedListener(u,t,n);for(const m in c.delegates)this.once(m,c.delegates[m]);return this}off(u,t,n){if(typeof t=="function"||n===void 0)return super.off(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._delegatedListeners?this._delegatedListeners[u]:void 0;return c&&(m=>{for(let y=0;y<m.length;y++){const w=m[y];if(w.listener===n&&js(w.targets,t)){for(const E in w.delegates)this.off(E,w.delegates[E]);return m.splice(y,1),this}}})(c),this}queryRenderedFeatures(u,t){if(!this.style)return[];if(u===void 0||u instanceof s.P||Array.isArray(u)||t!==void 0||(t=u,u=void 0),u=u||[[0,0],[this.transform.width,this.transform.height]],!t){const y=this.style.queryRenderedFeatures(u,void 0,this.transform),w=this.style.queryRenderedFeatureset(u,void 0,this.transform);return y.concat(w)}let n=!0;if(t.target&&(n=this._isTargetValid(t.target),n&&!t.layers))return this.style.queryRenderedFeatureset(u,t,this.transform);let c=!0;if(t.layers&&Array.isArray(t.layers)){for(const y of t.layers)if(!this._isValidId(y)){c=!1;break}if(c&&!t.target)return this.style.queryRenderedFeatures(u,t,this.transform)}let m=[];return c&&(m=m.concat(this.style.queryRenderedFeatures(u,t,this.transform))),n&&(m=m.concat(this.style.queryRenderedFeatureset(u,t,this.transform))),m}querySourceFeatures(u,t){return!u||typeof u=="string"&&!this._isValidId(u)?[]:this.style.querySourceFeatures(u,t)}queryRasterValue(u,t,n){return this._isValidId(u)?this.style.queryRasterValue(u,t,n):Promise.resolve(null)}isPointOnSurface(u){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&s.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(u))}addInteraction(u,t){return this._interactions.add(u,t),this}removeInteraction(u){return this._interactions.remove(u),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(u){return this._cooperativeGestures=u,this}setStyle(u,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&u&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(u,(n,c)=>{if(n){const m=typeof n=="string"?n:n instanceof Error?n.message:n.error;s.w(`Unable to perform style diff: ${m}. Rebuilding the style from scratch.`),this._updateStyle(u,t)}else c&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(u,t))}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u){const n=Object.assign({},t);t&&t.config&&(n.initialConfig=t.config,delete n.config),this.style=new Xs(this,n).load(u),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Xs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(u){return u==null?(this.fire(new s.y(new Error("IDs can't be empty."))),!1):!s.dm(u)||(this.fire(new s.y(new Error(`IDs can't contain special symbols: "${u}".`))),!1)}_isTargetValid(u){return"featuresetId"in u?this._isValidId("importId"in u?u.importId:u.featuresetId):"layerId"in u&&this._isValidId(u.layerId)}_areTargetsValid(u){if(Array.isArray(u)){for(const t of u)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(u)}addSource(u,t){return this._isValidId(u)?(this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)):this}isSourceLoaded(u){return!!this._isValidId(u)&&!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(u,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,n)}removeSource(u){return this._isValidId(u)?(this.style.removeSource(u),this._updateTerrain(),this._update(!0)):this}getSource(u){return this._isValidId(u)?this.style.getOwnSource(u):null}addImage(u,t,{pixelRatio:n=1,sdf:c=!1,stretchX:m,stretchY:y,content:w}={}){this._lazyInitEmptyStyle();const E=s.I.from(u);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:R,height:L,data:P}=s.o.getImageData(t);this.style.addImage(E,{data:new s.q({width:R,height:L},P),pixelRatio:n,stretchX:m,stretchY:y,content:w,sdf:c,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new s.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:R,height:L}=t,P=t;this.style.addImage(E,{data:new s.q({width:R,height:L},new Uint8Array(P.data)),pixelRatio:n,stretchX:m,stretchY:y,content:w,sdf:c,usvg:!1,version:0,userImage:P}),P.onAdd&&P.onAdd(this,u)}}updateImage(u,t){this._lazyInitEmptyStyle();const n=s.I.from(u),c=this.style.getImage(n);if(!c)return void this.fire(new s.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?s.o.getImageData(t):t,{width:y,height:w,data:E}=m;if(y===void 0||w===void 0)return void this.fire(new s.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(c.usvg?c.icon.usvg_tree.width:c.data.width)||w!==(c.usvg?c.icon.usvg_tree.height:c.data.height))return void this.fire(new s.y(new Error(`The width and height of the updated image (${y}, ${w})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`)));const R=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let L=!1;c.usvg?(c.data=new s.q({width:y,height:w},new Uint8Array(E)),c.usvg=!1,c.icon=void 0,L=!0):c.data.replace(E,R),this.style.updateImage(n,c,L)}hasImage(u){return u?!!this.style&&!!this.style.getImage(s.I.from(u)):(this.fire(new s.y(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(s.I.from(u))}loadImage(u,t){s.n(this._requestManager.transformRequest(u,s.R.Image),(n,c)=>{t(n,c instanceof HTMLImageElement?s.o.getImageData(c):c)})}listImages(){return this.style.listImages().map(u=>u.name)}addModel(u,t){this._lazyInitEmptyStyle(),this.style.addModel(u,t)}hasModel(u){return u?this.style.hasModel(u):(this.fire(new s.y(new Error("Missing required model id"))),!1)}removeModel(u){this.style.removeModel(u)}listModels(){return this.style.listModels()}addLayer(u,t){return this._isValidId(u.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)):this}getSlot(u){const t=this.getLayer(u);return t&&t.slot||null}setSlot(u,t){return this.style.setSlot(u,t),this.style.mergeLayers(),this._update(!0)}addImport(u,t){return this.style.addImport(u,t).catch(n=>this.fire(new s.y(new Error("Failed to add import",n)))),this}updateImport(u,t){return typeof t!="string"&&t.id!==u?(this.removeImport(u),this.addImport(t)):(this.style.updateImport(u,t),this._update(!0))}removeImport(u){return this.style.removeImport(u),this}moveImport(u,t){return this.style.moveImport(u,t),this._update(!0)}moveLayer(u,t){return this._isValidId(u)?(this.style.moveLayer(u,t),this._update(!0)):this}removeLayer(u){return this._isValidId(u)?(this.style.removeLayer(u),this._update(!0)):this}getLayer(u){if(!this._isValidId(u))return null;const t=this.style.getOwnLayer(u);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(u,t,n){return this._isValidId(u)?(this.style.setLayerZoomRange(u,t,n),this._update(!0)):this}setFilter(u,t,n={}){return this._isValidId(u)?(this.style.setFilter(u,t,n),this._update(!0)):this}getFilter(u){return this._isValidId(u)?this.style.getFilter(u):null}setPaintProperty(u,t,n,c={}){return this._isValidId(u)?(this.style.setPaintProperty(u,t,n,c),this._update(!0)):this}getPaintProperty(u,t){return this._isValidId(u)?this.style.getPaintProperty(u,t):null}setLayoutProperty(u,t,n,c={}){return this._isValidId(u)?(this.style.setLayoutProperty(u,t,n,c),this._update(!0)):this}getLayoutProperty(u,t){return this._isValidId(u)?this.style.getLayoutProperty(u,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(u){return this.style.setGlyphsUrl(u),this._update(!0)}getSchema(u){return this.style.getSchema(u)}setSchema(u,t){return this.style.setSchema(u,t),this._update(!0)}getConfig(u){return this.style.getConfig(u)}setConfig(u,t){return this.style.setConfig(u,t),this._update(!0)}getConfigProperty(u,t){return this.style.getConfigProperty(u,t)}setConfigProperty(u,t,n){return this.style.setConfigProperty(u,t,n),this._update(!0)}getFeaturesetDescriptors(u){return this.style.getFeaturesetDescriptors(u)}setLights(u){if(this._lazyInitEmptyStyle(),u&&u.length===1&&u[0].type==="flat"){const t=u[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(u),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const u=this.style.getLights()||[];return u.length===0&&u.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),u}setLight(u,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:u}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(u){return this._lazyInitEmptyStyle(),this.style.setSnow(u),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(u){return this._lazyInitEmptyStyle(),this.style.setRain(u),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(u){return this._lazyInitEmptyStyle(),this.style.setColorTheme(u),this._update(!0)}setImportColorTheme(u,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(u,t),this._update(!0)}setCamera(u){return this.style.setCamera(u),this._triggerCameraUpdate(u)}_triggerCameraUpdate(u){return this._update(this.transform.setOrthographicProjectionAtLowPitch(u["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.aR.convert(u),this.transform):0}setFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.setFeatureState(u,t),this._update())}removeFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.removeFeatureState(u,t),this._update())}getFeatureState(u){return u.source&&!this._isValidId(u.source)?null:this.style.getFeatureState(u)}_selectIndoorFloor(u){this.indoor.selectFloor(u)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Gh),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let n,c,m,y=this._container;for(;y&&(!c||!m);){const w=window.getComputedStyle(y).transform;w&&w!=="none"&&(n=w.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&n[0]!=="0"&&n[0]!=="1"&&(c=n[0]),n[3]&&n[3]!=="0"&&n[3]!=="1"&&(m=n[3])),y=y.parentElement}this._containerWidth=c?Math.abs(u/c):u,this._containerHeight=m?Math.abs(t/m):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=Se("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Se("div","mapboxgl-canvas-container",u);this._canvas=Se("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=Se("div","mapboxgl-control-container",u),c=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(m=>{c[m]=Se("div",`mapboxgl-ctrl-${m}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,t){const n=s.o.devicePixelRatio||1;this._canvas.width=n*Math.ceil(u),this._canvas.height=n*Math.ceil(t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const t=this._markers.indexOf(u);t!==-1&&this._markers.splice(t,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const t=this._popups.indexOf(u);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const u=Object.assign({},le.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",u);t?(Sr(t,!0),this.painter=new Bd(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",n=>{n.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.k.testSupport(t)):this.fire(new s.y(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.z("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.z("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let t;this.fire(new s.z("renderstart")),++this._frameId;const n=this.painter.context.extTimerQuery,c=s.o.now(),m=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=m.createQuery(),m.beginQuery(n.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,P=this.transform.pitch,F=s.o.now(),j=new s.ac(L,{now:F,fadeDuration:y,pitch:P,transition:this.style.transition,worldview:this._worldview});this.style.update(j)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(c),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(c);const E=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),E&&(this._placementDirty=E.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Q.mark(Z.load),this.fire(new s.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const L=s.o.now()-c;m.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{const P=m.getQueryParameter(t,m.QUERY_RESULT)/1e6;m.deleteQuery(t),this.fire(new s.z("gpu-timing-frame",{cpuTime:L,gpuTime:P}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(L);this.fire(new s.z("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(L);this.fire(new s.z("gpu-timing-deferred-render",{gpuTime:P}))},50)}const R=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(R||this._repaint)this.triggerRepaint();else{const L=this.idle();if(L&&(w=this._updateAverageElevation(c,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new s.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new s.z("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,Q.mark(Z.fullLoad),this._performanceMetricsCollection&&Ai(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const t of this._markers)u&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!u||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(u,t=!1){const n=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&n(0);const c=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(c||(t||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const m=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=u;const w=Math.abs(m-y);if(w>1){if(this._isInitialLoad||c)return this._averageElevation.jumpTo(y),n(y);this._averageElevation.easeTo(y,u,300)}else if(w>1e-4)return this._averageElevation.jumpTo(y),n(y)}return!!this._averageElevation.isEasing(u)&&n(this._averageElevation.getValue(u))}_authenticate(){Tt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===Zi||u.status===401)){const t=this.painter.context.gl;Sr(t,!1),this._logoControl instanceof Io&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ii(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&_i(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,c=n.createFramebuffer();function m(y){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,y,0);const w=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,w),w}return n.bindFramebuffer(n.FRAMEBUFFER,c),this._canvasPixelComparison(m(u),t.canvasCopies.map(m),t.timeStamps)}_canvasPixelComparison(u,t,n){let c=n[1]-n[0];const m=u.length/4;for(let y=0;y<t.length;y++){const w=t[y];let E=0;for(let R=0;R<w.length;R+=4)w[R]===u[R]&&w[R+1]===u[R+1]&&w[R+2]===u[R+2]&&w[R+3]===u[R+3]&&(E+=1);c+=(n[y+2]-n[y+1])*(1-E/m)}return c}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Si.delete(this.painter.context.gl),gt.remove(),Ui.remove(),this._removed=!0,this.fire(new s.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=s.o.frame(t=>{const n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(t)}))}_preloadTiles(u){const t=this.style?this.style.getSourceCaches():[];return s.bw(t,(n,c)=>n._preloadTiles(u,c),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(u){this._showParseStatus!==u&&(this._showParseStatus=u,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(u){this._showLayers2DWireframe!==u&&(this._showLayers2DWireframe=u,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(u){this._showLayers3DWireframe!==u&&(this._showLayers3DWireframe=u,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,this._tp.refreshUI(),u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,this._tp.refreshUI(),u&&this._update())}_setCacheLimits(u,t){s.eX(u,t)}get version(){return q}},NavigationControl:class{constructor(u={}){this.options=Object.assign({},fc,u),this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(s.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Se("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Se("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:t}):n.resetNorth({},{originalEvent:t}))}),this._compassIcon=Se("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const t=u.getZoom(),n=t===u.getMaxZoom(),c=t===u.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Jm(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,t){const n=Se("button",u,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(u,t){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${t}`);u.setAttribute("aria-label",n),u.firstElementChild&&u.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends s.E{constructor(u={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},ea,u),s.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Fd(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const t=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,u(n)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(n=>t(n.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),n=u.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new s.z("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("geolocate",u)),this._finish()}}_updateCamera(u){const t=new s.aR(u.coords.longitude,u.coords.latitude),n=u.coords.accuracy,c=this._map.getBearing(),m=Object.assign({bearing:c},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),m,{geolocateSource:!0})}_updateMarker(u){if(u){const t=new s.aR(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,t=s.ce(1,u._center.lat)*u.worldSize,n=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Se("button","mapboxgl-ctrl-geolocate",this._container),Se("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Se("div","mapboxgl-user-location"),this._dotElement.appendChild(Se("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Se("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Qs({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Se("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Qs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.z("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ns,ScaleControl:class{constructor(u={}){this.options=Object.assign({},Al,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,c=t._containerWidth/2-u/2,m=t.unproject([c,n]),y=t.unproject([c+u,n]),w=m.distanceTo(y);if(this.options.unit==="imperial"){const E=3.2808*w;E>5280?this._setScale(u,E/5280,"mile"):this._setScale(u,E,"foot")}else this.options.unit==="nautical"?this._setScale(u,w/1852,"nautical-mile"):w>=1e3?this._setScale(u,w/1e3,"kilometer"):this._setScale(u,w,"meter")}_setScale(u,t,n){this._map._requestDomTask(()=>{const c=function(y){const w=Math.pow(10,`${Math.floor(y)}`.length-1);let E=y/w;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(R){const L=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*L)/L}(E),w*E}(t),m=c/t;this._container.innerHTML=this._isNumberFormatSupported&&n!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(c):`${c}&nbsp;${Ns[n]}`,this._container.style.width=u*m+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u={}){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:s.w("Full screen control 'container' must be a DOM element.")),s.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=Se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=Se("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Se("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Gh,Popup:class extends s.E{constructor(u){super(),this.options=Object.assign(Object.create(Qc),u),this._altitude=this.options.altitude,s.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new s.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new s.z("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=s.aR.convert(u),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(u){return this._altitude=u,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const t=document.createDocumentFragment(),n=document.createElement("body");let c;for(n.innerHTML=u;c=n.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Se("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(u),this.options.closeButton){const n=this._closeButton=Se("button","mapboxgl-popup-close-button",t);n.type="button",n.setAttribute("aria-label","Close popup"),n.innerHTML='<span aria-hidden="true">&#215;</span>',n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let t;return this._classList.delete(u)?t=!1:(this._classList.add(u),t=!0),this._updateClassList(),t}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,c=this._pos;if(!t||!n||!c)return"bottom";const m=n.offsetWidth,y=n.offsetHeight,w=c.x<m/2,E=c.x>t.transform.width-m/2;if(c.y+u<y)return w?"top-left":E?"top-right":"top";if(c.y>t.transform.height-y){if(w)return"bottom-left";if(E)return"bottom-right"}return w?"left":E?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),u.className=t.join(" ")}_update(u){const t=this._map,n=this._content;if(!t||!this._lngLat&&!this._trackPointer||!n)return;let c=this._container;if(c||(c=this._container=Se("div","mapboxgl-popup",t.getContainer()),this._tip=Se("div","mapboxgl-popup-tip",c),c.appendChild(n)),this.options.maxWidth&&c.style.maxWidth!==this.options.maxWidth&&(c.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Wd(this._lngLat,this._pos,t.transform)),!this._trackPointer||u){const m=this._pos=this._trackPointer&&u instanceof s.P?u:t.project(this._lngLat,this._altitude),y=qu(this.options.offset),w=this._anchor=this._getAnchor(y.y),E=qu(this.options.offset,w),R=m.add(E).round();t._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${Xd[w]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&t._showingGlobe()){const m=s.eY(t.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector($s);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:Qs,Style:Xs,LngLat:s.aR,LngLatBounds:s.aI,Point:s.P,MercatorCoordinate:s.ae,FreeCameraOptions:xf,Evented:s.E,config:s.e,prewarm:s.f0,clearPrewarmedResources:s.e$,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(u){s.e.ACCESS_TOKEN=u},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(u){s.e.API_URL=u},get workerCount(){return s.f9.workerCount},set workerCount(u){s.f9.workerCount=u},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){s.e.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){s.f8(u)},get workerUrl(){return s.f7.workerUrl},set workerUrl(u){s.f7.workerUrl=u},get workerClass(){return s.f7.workerClass},set workerClass(u){s.f7.workerClass=u},get workerParams(){return s.f7.workerParams},set workerParams(u){s.f7.workerParams=u},get dracoUrl(){return s.f6()},set dracoUrl(u){s.f5(u)},get meshoptUrl(){return s.f4()},set meshoptUrl(u){s.f3(u)},setNow:s.o.setNow,restoreNow:s.o.restoreNow}});var V=I;return V})}(Yy)),Yy.exports}var RP=CP();const pp=O2(RP);var bv,y6;function Wg(){if(y6)return bv;y6=1,bv=g;var h=Object.prototype.hasOwnProperty;function g(){for(var b={},S=0;S<arguments.length;S++){var I=arguments[S];for(var N in I)h.call(I,N)&&(b[N]=I[N])}return b}return bv}var wv={exports:{}},x6;function MP(){return x6||(x6=1,function(h,g){(function(){var b={};h.exports=b,b.simpleFilter=function(S,I){return I.filter(function(N){return b.test(S,N)})},b.test=function(S,I){return b.match(S,I)!==null},b.match=function(S,I,N){N=N||{};var V=0,s=[],q=I.length,Z=0,Q=0,oe=N.pre||"",de=N.post||"",ze=N.caseSensitive&&I||I.toLowerCase(),le;S=N.caseSensitive&&S||S.toLowerCase();for(var Se=0;Se<q;Se++)le=I[Se],ze[Se]===S[V]?(le=oe+le+de,V+=1,Q+=1+Q):Q=0,Z+=Q,s[s.length]=le;return V===S.length?(Z=ze===S?1/0:Z,{rendered:s.join(""),score:Z}):null},b.filter=function(S,I,N){return!I||I.length===0?[]:typeof S!="string"?I:(N=N||{},I.reduce(function(V,s,q,Z){var Q=s;N.extract&&(Q=N.extract(s));var oe=b.match(S,Q,N);return oe!=null&&(V[V.length]={string:oe.rendered,score:oe.score,index:q,original:s}),V},[]).sort(function(V,s){var q=s.score-V.score;return q||V.index-s.index}))}})()}(wv)),wv.exports}var Tv,v6;function IP(){if(v6)return Tv;v6=1;var h=function(g){return this.component=g,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,g.el.parentNode.insertBefore(this.wrapper,g.el.nextSibling),this};return h.prototype.show=function(){this.element.style.display="block"},h.prototype.hide=function(){this.element.style.display="none"},h.prototype.add=function(g){this.items.push(g)},h.prototype.clear=function(){this.items=[],this.active=0},h.prototype.isEmpty=function(){return!this.items.length},h.prototype.isVisible=function(){return this.element.style.display==="block"},h.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var g=0;g<this.items.length;g++)this.drawItem(this.items[g],this.active===g);this.show()},h.prototype.drawItem=function(g,b){var S=document.createElement("li"),I=document.createElement("a");b&&(S.className+=" active"),I.innerHTML=g.string,S.appendChild(I),this.element.appendChild(S),S.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),S.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,g)}).bind(this))},h.prototype.handleMouseUp=function(g){this.selectingListItem=!1,this.component.value(g.original),this.clear(),this.draw()},h.prototype.move=function(g){this.active=g,this.draw()},h.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)},h.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},h.prototype.drawError=function(g){var b=document.createElement("li");b.innerHTML=g,this.element.appendChild(b),this.show()},Tv=h,Tv}var Sv,b6;function zP(){if(b6)return Sv;b6=1;var h=Wg(),g=MP(),b=IP(),S=function(I,N,V){return V=V||{},this.options=h({minLength:2,limit:5,filter:!0,hideOnBlur:!0},V),this.el=I,this.data=N||[],this.list=new b(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(s){this.handleKeyUp(s.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(s){this.handleKeyDown(s)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(s){this.handlePaste(s)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};return S.prototype.handleKeyUp=function(I){I===40||I===38||I===27||I===13||I===9||this.handleInputChange(this.el.value)},S.prototype.handleKeyDown=function(I){switch(I.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&I.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},S.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},S.prototype.handlePaste=function(I){if(I.clipboardData)this.handleInputChange(I.clipboardData.getData("Text"));else{var N=this;setTimeout(function(){N.handleInputChange(I.target.value)},100)}},S.prototype.handleInputChange=function(I){if(this.query=this.normalize(I),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(N){for(var V=0;V<N.length&&(this.list.add(N[V]),V!==this.options.limit-1);V++);this.list.draw()}).bind(this))},S.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},S.prototype.update=function(I){this.data=I,this.handleKeyUp()},S.prototype.clear=function(){this.data=[],this.list.clear()},S.prototype.normalize=function(I){return I=I.toLowerCase(),I},S.prototype.match=function(I,N){return I.indexOf(N)>-1},S.prototype.value=function(I){if(this.selected=I,this.el.value=this.getItemValue(I),document.createEvent){var N=document.createEvent("HTMLEvents");N.initEvent("change",!0,!1),this.el.dispatchEvent(N)}else this.el.fireEvent("onchange")},S.prototype.getCandidates=function(I){var N={pre:"<strong>",post:"</strong>",extract:(function(s){return this.getItemValue(s)}).bind(this)},V;this.options.filter?(V=g.filter(this.query,this.data,N),V=V.map((function(s){return{original:s.original,string:this.render(s.original,s.string)}}).bind(this))):V=this.data.map((function(s){var q=this.render(s);return{original:s,string:q}}).bind(this)),I(V)},S.prototype.getItemValue=function(I){return I},S.prototype.render=function(I,N){if(N)return N;for(var V=I.original?this.getItemValue(I.original):this.getItemValue(I),s=this.normalize(V),q=s.lastIndexOf(this.query);q>-1;){var Z=q+this.query.length;V=V.slice(0,q)+"<strong>"+V.slice(q,Z)+"</strong>"+V.slice(Z),q=s.slice(0,q).lastIndexOf(this.query)}return V},S.prototype.renderError=function(I){this.list.drawError(I)},Sv=S,Sv}var Ev,w6;function LP(){if(w6)return Ev;w6=1;var h=zP();return Ev=h,typeof window<"u"&&(window.Suggestions=h),Ev}var Av,T6;function DP(){if(T6)return Av;T6=1;var h="Expected a function",g=NaN,b="[object Symbol]",S=/^\s+|\s+$/g,I=/^[-+]0x[0-9a-f]+$/i,N=/^0b[01]+$/i,V=/^0o[0-7]+$/i,s=parseInt,q=typeof gp=="object"&&gp&&gp.Object===Object&&gp,Z=typeof self=="object"&&self&&self.Object===Object&&self,Q=q||Z||Function("return this")(),oe=Object.prototype,de=oe.toString,ze=Math.max,le=Math.min,Se=function(){return Q.Date.now()};function ee(Ae,Ke,it){var rt,lt,zt,xt,Ci,Zi,or=0,er=!1,Jt=!1,ji=!0;if(typeof Ae!="function")throw new TypeError(h);Ke=Le(Ke)||0,_e(it)&&(er=!!it.leading,Jt="maxWait"in it,zt=Jt?ze(Le(it.maxWait)||0,Ke):zt,ji="trailing"in it?!!it.trailing:ji);function Fi(Ri){var Ai=rt,gt=lt;return rt=lt=void 0,or=Ri,xt=Ae.apply(gt,Ai),xt}function Pr(Ri){return or=Ri,Ci=setTimeout(Pi,Ke),er?Fi(Ri):xt}function tt(Ri){var Ai=Ri-Zi,gt=Ri-or,Tt=Ke-Ai;return Jt?le(Tt,zt-gt):Tt}function Ht(Ri){var Ai=Ri-Zi,gt=Ri-or;return Zi===void 0||Ai>=Ke||Ai<0||Jt&&gt>=zt}function Pi(){var Ri=Se();if(Ht(Ri))return Ui(Ri);Ci=setTimeout(Pi,tt(Ri))}function Ui(Ri){return Ci=void 0,ji&&rt?Fi(Ri):(rt=lt=void 0,xt)}function ii(){Ci!==void 0&&clearTimeout(Ci),or=0,rt=Zi=lt=Ci=void 0}function Wi(){return Ci===void 0?xt:Ui(Se())}function _i(){var Ri=Se(),Ai=Ht(Ri);if(rt=arguments,lt=this,Zi=Ri,Ai){if(Ci===void 0)return Pr(Zi);if(Jt)return Ci=setTimeout(Pi,Ke),Fi(Zi)}return Ci===void 0&&(Ci=setTimeout(Pi,Ke)),xt}return _i.cancel=ii,_i.flush=Wi,_i}function _e(Ae){var Ke=typeof Ae;return!!Ae&&(Ke=="object"||Ke=="function")}function ye(Ae){return!!Ae&&typeof Ae=="object"}function xe(Ae){return typeof Ae=="symbol"||ye(Ae)&&de.call(Ae)==b}function Le(Ae){if(typeof Ae=="number")return Ae;if(xe(Ae))return g;if(_e(Ae)){var Ke=typeof Ae.valueOf=="function"?Ae.valueOf():Ae;Ae=_e(Ke)?Ke+"":Ke}if(typeof Ae!="string")return Ae===0?Ae:+Ae;Ae=Ae.replace(S,"");var it=N.test(Ae);return it||V.test(Ae)?s(Ae.slice(2),it?2:8):I.test(Ae)?g:+Ae}return Av=ee,Av}var Ny={exports:{}},S6;function PP(){if(S6)return Ny.exports;S6=1;var h=typeof Reflect=="object"?Reflect:null,g=h&&typeof h.apply=="function"?h.apply:function(Ae,Ke,it){return Function.prototype.apply.call(Ae,Ke,it)},b;h&&typeof h.ownKeys=="function"?b=h.ownKeys:Object.getOwnPropertySymbols?b=function(Ae){return Object.getOwnPropertyNames(Ae).concat(Object.getOwnPropertySymbols(Ae))}:b=function(Ae){return Object.getOwnPropertyNames(Ae)};function S(Le){console&&console.warn&&console.warn(Le)}var I=Number.isNaN||function(Ae){return Ae!==Ae};function N(){N.init.call(this)}Ny.exports=N,Ny.exports.once=_e,N.EventEmitter=N,N.prototype._events=void 0,N.prototype._eventsCount=0,N.prototype._maxListeners=void 0;var V=10;function s(Le){if(typeof Le!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Le)}Object.defineProperty(N,"defaultMaxListeners",{enumerable:!0,get:function(){return V},set:function(Le){if(typeof Le!="number"||Le<0||I(Le))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Le+".");V=Le}}),N.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},N.prototype.setMaxListeners=function(Ae){if(typeof Ae!="number"||Ae<0||I(Ae))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Ae+".");return this._maxListeners=Ae,this};function q(Le){return Le._maxListeners===void 0?N.defaultMaxListeners:Le._maxListeners}N.prototype.getMaxListeners=function(){return q(this)},N.prototype.emit=function(Ae){for(var Ke=[],it=1;it<arguments.length;it++)Ke.push(arguments[it]);var rt=Ae==="error",lt=this._events;if(lt!==void 0)rt=rt&&lt.error===void 0;else if(!rt)return!1;if(rt){var zt;if(Ke.length>0&&(zt=Ke[0]),zt instanceof Error)throw zt;var xt=new Error("Unhandled error."+(zt?" ("+zt.message+")":""));throw xt.context=zt,xt}var Ci=lt[Ae];if(Ci===void 0)return!1;if(typeof Ci=="function")g(Ci,this,Ke);else for(var Zi=Ci.length,or=le(Ci,Zi),it=0;it<Zi;++it)g(or[it],this,Ke);return!0};function Z(Le,Ae,Ke,it){var rt,lt,zt;if(s(Ke),lt=Le._events,lt===void 0?(lt=Le._events=Object.create(null),Le._eventsCount=0):(lt.newListener!==void 0&&(Le.emit("newListener",Ae,Ke.listener?Ke.listener:Ke),lt=Le._events),zt=lt[Ae]),zt===void 0)zt=lt[Ae]=Ke,++Le._eventsCount;else if(typeof zt=="function"?zt=lt[Ae]=it?[Ke,zt]:[zt,Ke]:it?zt.unshift(Ke):zt.push(Ke),rt=q(Le),rt>0&&zt.length>rt&&!zt.warned){zt.warned=!0;var xt=new Error("Possible EventEmitter memory leak detected. "+zt.length+" "+String(Ae)+" listeners added. Use emitter.setMaxListeners() to increase limit");xt.name="MaxListenersExceededWarning",xt.emitter=Le,xt.type=Ae,xt.count=zt.length,S(xt)}return Le}N.prototype.addListener=function(Ae,Ke){return Z(this,Ae,Ke,!1)},N.prototype.on=N.prototype.addListener,N.prototype.prependListener=function(Ae,Ke){return Z(this,Ae,Ke,!0)};function Q(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function oe(Le,Ae,Ke){var it={fired:!1,wrapFn:void 0,target:Le,type:Ae,listener:Ke},rt=Q.bind(it);return rt.listener=Ke,it.wrapFn=rt,rt}N.prototype.once=function(Ae,Ke){return s(Ke),this.on(Ae,oe(this,Ae,Ke)),this},N.prototype.prependOnceListener=function(Ae,Ke){return s(Ke),this.prependListener(Ae,oe(this,Ae,Ke)),this},N.prototype.removeListener=function(Ae,Ke){var it,rt,lt,zt,xt;if(s(Ke),rt=this._events,rt===void 0)return this;if(it=rt[Ae],it===void 0)return this;if(it===Ke||it.listener===Ke)--this._eventsCount===0?this._events=Object.create(null):(delete rt[Ae],rt.removeListener&&this.emit("removeListener",Ae,it.listener||Ke));else if(typeof it!="function"){for(lt=-1,zt=it.length-1;zt>=0;zt--)if(it[zt]===Ke||it[zt].listener===Ke){xt=it[zt].listener,lt=zt;break}if(lt<0)return this;lt===0?it.shift():Se(it,lt),it.length===1&&(rt[Ae]=it[0]),rt.removeListener!==void 0&&this.emit("removeListener",Ae,xt||Ke)}return this},N.prototype.off=N.prototype.removeListener,N.prototype.removeAllListeners=function(Ae){var Ke,it,rt;if(it=this._events,it===void 0)return this;if(it.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):it[Ae]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete it[Ae]),this;if(arguments.length===0){var lt=Object.keys(it),zt;for(rt=0;rt<lt.length;++rt)zt=lt[rt],zt!=="removeListener"&&this.removeAllListeners(zt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Ke=it[Ae],typeof Ke=="function")this.removeListener(Ae,Ke);else if(Ke!==void 0)for(rt=Ke.length-1;rt>=0;rt--)this.removeListener(Ae,Ke[rt]);return this};function de(Le,Ae,Ke){var it=Le._events;if(it===void 0)return[];var rt=it[Ae];return rt===void 0?[]:typeof rt=="function"?Ke?[rt.listener||rt]:[rt]:Ke?ee(rt):le(rt,rt.length)}N.prototype.listeners=function(Ae){return de(this,Ae,!0)},N.prototype.rawListeners=function(Ae){return de(this,Ae,!1)},N.listenerCount=function(Le,Ae){return typeof Le.listenerCount=="function"?Le.listenerCount(Ae):ze.call(Le,Ae)},N.prototype.listenerCount=ze;function ze(Le){var Ae=this._events;if(Ae!==void 0){var Ke=Ae[Le];if(typeof Ke=="function")return 1;if(Ke!==void 0)return Ke.length}return 0}N.prototype.eventNames=function(){return this._eventsCount>0?b(this._events):[]};function le(Le,Ae){for(var Ke=new Array(Ae),it=0;it<Ae;++it)Ke[it]=Le[it];return Ke}function Se(Le,Ae){for(;Ae+1<Le.length;Ae++)Le[Ae]=Le[Ae+1];Le.pop()}function ee(Le){for(var Ae=new Array(Le.length),Ke=0;Ke<Ae.length;++Ke)Ae[Ke]=Le[Ke].listener||Le[Ke];return Ae}function _e(Le,Ae){return new Promise(function(Ke,it){function rt(zt){Le.removeListener(Ae,lt),it(zt)}function lt(){typeof Le.removeListener=="function"&&Le.removeListener("error",rt),Ke([].slice.call(arguments))}xe(Le,Ae,lt,{once:!0}),Ae!=="error"&&ye(Le,rt,{once:!0})})}function ye(Le,Ae,Ke){typeof Le.on=="function"&&xe(Le,"error",Ae,Ke)}function xe(Le,Ae,Ke,it){if(typeof Le.on=="function")it.once?Le.once(Ae,Ke):Le.on(Ae,Ke);else if(typeof Le.addEventListener=="function")Le.addEventListener(Ae,function rt(lt){it.once&&Le.removeEventListener(Ae,rt),Ke(lt)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Le)}return Ny.exports}var Cv,E6;function OP(){return E6||(E6=1,Cv={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}),Cv}var Rv,A6;function jP(){if(A6)return Rv;A6=1;function h(S){var I=S.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return I?{key:I[1],value:I[2]}:null}function g(S){var I=S.match(/<?([^>]*)>(.*)/);if(!I)return null;var N=I[1],V=I[2].split(";"),s=null,q=V.reduce(function(Z,Q){var oe=h(Q);return oe?oe.key==="rel"?(s||(s=oe.value),Z):(Z[oe.key]=oe.value,Z):Z},{});return s?{url:N,rel:s,params:q}:null}function b(S){return S?S.split(/,\s*</).reduce(function(I,N){var V=g(N);if(!V)return I;var s=V.rel.split(/\s+/);return s.forEach(function(q){I[q]||(I[q]={url:V.url,params:V.params})}),I},{}):{}}return Rv=b,Rv}var Mv,C6;function NP(){if(C6)return Mv;C6=1;var h=jP();function g(b,S){this.request=b,this.headers=S.headers,this.rawBody=S.body,this.statusCode=S.statusCode;try{this.body=JSON.parse(S.body||"{}")}catch{this.body=S.body}this.links=h(this.headers.link)}return g.prototype.hasNextPage=function(){return!!this.links.next},g.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},Mv=g,Mv}var Iv,R6;function U1(){return R6||(R6=1,Iv={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}),Iv}var zv,M6;function kP(){if(M6)return zv;M6=1;var h=U1();function g(b){var S=b.type||h.ERROR_HTTP,I;if(b.body)try{I=JSON.parse(b.body)}catch{I=b.body}else I=null;var N=b.message||null;N||(typeof I=="string"?N=I:I&&typeof I.message=="string"?N=I.message:S===h.ERROR_REQUEST_ABORTED&&(N="Request aborted")),this.message=N,this.type=S,this.statusCode=b.statusCode||null,this.request=b.request,this.body=I}return zv=g,zv}var Lv,I6;function BP(){if(I6)return Lv;I6=1;function h(b){var S=b.indexOf(":"),I=b.substring(0,S).trim().toLowerCase(),N=b.substring(S+1).trim();return{name:I,value:N}}function g(b){var S={};return b&&b.trim().split(/[\r|\n]+/).forEach(function(I){var N=h(I);S[N.name]=N.value}),S}return Lv=g,Lv}var Dv,z6;function FP(){if(z6)return Dv;z6=1;var h=NP(),g=kP(),b=U1(),S=BP(),I={};function N(oe){var de=I[oe.id];de&&(de.abort(),delete I[oe.id])}function V(oe,de){return new h(oe,{body:de.response,headers:S(de.getAllResponseHeaders()),statusCode:de.status})}function s(oe){var de=oe.total,ze=oe.loaded,le=100*ze/de;return{total:de,transferred:ze,percent:le}}function q(oe,de){return new Promise(function(ze,le){de.onprogress=function(_e){oe.emitter.emit(b.EVENT_PROGRESS_DOWNLOAD,s(_e))};var Se=oe.file;Se&&(de.upload.onprogress=function(_e){oe.emitter.emit(b.EVENT_PROGRESS_UPLOAD,s(_e))}),de.onerror=function(_e){le(_e)},de.onabort=function(){var _e=new g({request:oe,type:b.ERROR_REQUEST_ABORTED});le(_e)},de.onload=function(){if(delete I[oe.id],de.status<200||de.status>=400){var _e=new g({request:oe,body:de.response,statusCode:de.status});le(_e);return}ze(de)};var ee=oe.body;typeof ee=="string"?de.send(ee):ee?de.send(JSON.stringify(ee)):Se?de.send(Se):de.send(),I[oe.id]=de}).then(function(ze){return V(oe,ze)})}function Z(oe,de){var ze=oe.url(de),le=new window.XMLHttpRequest;return le.open(oe.method,ze),Object.keys(oe.headers).forEach(function(Se){le.setRequestHeader(Se,oe.headers[Se])}),le}function Q(oe){return Promise.resolve().then(function(){var de=Z(oe,oe.client.accessToken);return q(oe,de)})}return Dv={browserAbort:N,sendRequestXhr:q,browserSend:Q,createRequestXhr:Z},Dv}var n0={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */var UP=n0.exports,L6;function VP(){return L6||(L6=1,function(h,g){(function(b){var S=g,I=h&&h.exports==S&&h,N=typeof gp=="object"&&gp;(N.global===N||N.window===N)&&(b=N);var V=function(le){this.message=le};V.prototype=new Error,V.prototype.name="InvalidCharacterError";var s=function(le){throw new V(le)},q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Z=/[\t\n\f\r ]/g,Q=function(le){le=String(le).replace(Z,"");var Se=le.length;Se%4==0&&(le=le.replace(/==?$/,""),Se=le.length),(Se%4==1||/[^+a-zA-Z0-9/]/.test(le))&&s("Invalid character: the string to be decoded is not correctly encoded.");for(var ee=0,_e,ye,xe="",Le=-1;++Le<Se;)ye=q.indexOf(le.charAt(Le)),_e=ee%4?_e*64+ye:ye,ee++%4&&(xe+=String.fromCharCode(255&_e>>(-2*ee&6)));return xe},oe=function(le){le=String(le),/[^\0-\xFF]/.test(le)&&s("The string to be encoded contains characters outside of the Latin1 range.");for(var Se=le.length%3,ee="",_e=-1,ye,xe,Le,Ae,Ke=le.length-Se;++_e<Ke;)ye=le.charCodeAt(_e)<<16,xe=le.charCodeAt(++_e)<<8,Le=le.charCodeAt(++_e),Ae=ye+xe+Le,ee+=q.charAt(Ae>>18&63)+q.charAt(Ae>>12&63)+q.charAt(Ae>>6&63)+q.charAt(Ae&63);return Se==2?(ye=le.charCodeAt(_e)<<8,xe=le.charCodeAt(++_e),Ae=ye+xe,ee+=q.charAt(Ae>>10)+q.charAt(Ae>>4&63)+q.charAt(Ae<<2&63)+"="):Se==1&&(Ae=le.charCodeAt(_e),ee+=q.charAt(Ae>>2)+q.charAt(Ae<<4&63)+"=="),ee},de={encode:oe,decode:Q,version:"0.1.0"};if(S&&!S.nodeType)if(I)I.exports=de;else for(var ze in de)de.hasOwnProperty(ze)&&(S[ze]=de[ze]);else b.base64=de})(UP)}(n0,n0.exports)),n0.exports}var Pv,D6;function p5(){if(D6)return Pv;D6=1;var h=VP(),g={};function b(N){if(g[N])return g[N];var V=N.split("."),s=V[0],q=V[1];if(!q)throw new Error("Invalid token");var Z=S(q),Q={usage:s,user:Z.u};return I(Z,"a")&&(Q.authorization=Z.a),I(Z,"exp")&&(Q.expires=Z.exp*1e3),I(Z,"iat")&&(Q.created=Z.iat*1e3),I(Z,"scopes")&&(Q.scopes=Z.scopes),I(Z,"client")&&(Q.client=Z.client),I(Z,"ll")&&(Q.lastLogin=Z.ll),I(Z,"iu")&&(Q.impersonator=Z.iu),g[N]=Q,Q}function S(N){try{return JSON.parse(h.decode(N))}catch{throw new Error("Invalid token")}}function I(N,V){return Object.prototype.hasOwnProperty.call(N,V)}return Pv=b,Pv}var Ov={exports:{}},P6;function HP(){return P6||(P6=1,function(h){var g=Object.prototype.hasOwnProperty,b="~";function S(){}Object.create&&(S.prototype=Object.create(null),new S().__proto__||(b=!1));function I(q,Z,Q){this.fn=q,this.context=Z,this.once=Q||!1}function N(q,Z,Q,oe,de){if(typeof Q!="function")throw new TypeError("The listener must be a function");var ze=new I(Q,oe||q,de),le=b?b+Z:Z;return q._events[le]?q._events[le].fn?q._events[le]=[q._events[le],ze]:q._events[le].push(ze):(q._events[le]=ze,q._eventsCount++),q}function V(q,Z){--q._eventsCount===0?q._events=new S:delete q._events[Z]}function s(){this._events=new S,this._eventsCount=0}s.prototype.eventNames=function(){var Z=[],Q,oe;if(this._eventsCount===0)return Z;for(oe in Q=this._events)g.call(Q,oe)&&Z.push(b?oe.slice(1):oe);return Object.getOwnPropertySymbols?Z.concat(Object.getOwnPropertySymbols(Q)):Z},s.prototype.listeners=function(Z){var Q=b?b+Z:Z,oe=this._events[Q];if(!oe)return[];if(oe.fn)return[oe.fn];for(var de=0,ze=oe.length,le=new Array(ze);de<ze;de++)le[de]=oe[de].fn;return le},s.prototype.listenerCount=function(Z){var Q=b?b+Z:Z,oe=this._events[Q];return oe?oe.fn?1:oe.length:0},s.prototype.emit=function(Z,Q,oe,de,ze,le){var Se=b?b+Z:Z;if(!this._events[Se])return!1;var ee=this._events[Se],_e=arguments.length,ye,xe;if(ee.fn){switch(ee.once&&this.removeListener(Z,ee.fn,void 0,!0),_e){case 1:return ee.fn.call(ee.context),!0;case 2:return ee.fn.call(ee.context,Q),!0;case 3:return ee.fn.call(ee.context,Q,oe),!0;case 4:return ee.fn.call(ee.context,Q,oe,de),!0;case 5:return ee.fn.call(ee.context,Q,oe,de,ze),!0;case 6:return ee.fn.call(ee.context,Q,oe,de,ze,le),!0}for(xe=1,ye=new Array(_e-1);xe<_e;xe++)ye[xe-1]=arguments[xe];ee.fn.apply(ee.context,ye)}else{var Le=ee.length,Ae;for(xe=0;xe<Le;xe++)switch(ee[xe].once&&this.removeListener(Z,ee[xe].fn,void 0,!0),_e){case 1:ee[xe].fn.call(ee[xe].context);break;case 2:ee[xe].fn.call(ee[xe].context,Q);break;case 3:ee[xe].fn.call(ee[xe].context,Q,oe);break;case 4:ee[xe].fn.call(ee[xe].context,Q,oe,de);break;default:if(!ye)for(Ae=1,ye=new Array(_e-1);Ae<_e;Ae++)ye[Ae-1]=arguments[Ae];ee[xe].fn.apply(ee[xe].context,ye)}}return!0},s.prototype.on=function(Z,Q,oe){return N(this,Z,Q,oe,!1)},s.prototype.once=function(Z,Q,oe){return N(this,Z,Q,oe,!0)},s.prototype.removeListener=function(Z,Q,oe,de){var ze=b?b+Z:Z;if(!this._events[ze])return this;if(!Q)return V(this,ze),this;var le=this._events[ze];if(le.fn)le.fn===Q&&(!de||le.once)&&(!oe||le.context===oe)&&V(this,ze);else{for(var Se=0,ee=[],_e=le.length;Se<_e;Se++)(le[Se].fn!==Q||de&&!le[Se].once||oe&&le[Se].context!==oe)&&ee.push(le[Se]);ee.length?this._events[ze]=ee.length===1?ee[0]:ee:V(this,ze)}return this},s.prototype.removeAllListeners=function(Z){var Q;return Z?(Q=b?b+Z:Z,this._events[Q]&&V(this,Q)):(this._events=new S,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=b,s.EventEmitter=s,h.exports=s}(Ov)),Ov.exports}var jv,O6;function qP(){if(O6)return jv;O6=1;function h(V){return V.map(encodeURIComponent).join(",")}function g(V){return Array.isArray(V)?h(V):encodeURIComponent(String(V))}function b(V,s,q){if(q===!1||q===null)return V;var Z=/\?/.test(V)?"&":"?",Q=encodeURIComponent(s);return q!==void 0&&q!==""&&q!==!0&&(Q+="="+g(q)),""+V+Z+Q}function S(V,s){if(!s)return V;var q=V;return Object.keys(s).forEach(function(Z){var Q=s[Z];Q!==void 0&&(Array.isArray(Q)&&(Q=Q.filter(function(oe){return oe!=null}).join(",")),q=b(q,Z,Q))}),q}function I(V,s){if(!s||V.slice(0,4)==="http")return V;var q=V[0]==="/"?"":"/";return""+s.replace(/\/$/,"")+q+V}function N(V,s){return s?V.replace(/\/:([a-zA-Z0-9]+)/g,function(q,Z){var Q=s[Z];if(Q===void 0)throw new Error("Unspecified route parameter "+Z);var oe=g(Q);return"/"+oe}):V}return jv={appendQueryObject:S,appendQueryParam:b,prependOrigin:I,interpolateRouteParams:N},jv}var Nv,j6;function GP(){if(j6)return Nv;j6=1;var h=p5(),g=Wg(),b=HP(),S=qP(),I=U1(),N=1;function V(s,q){if(!s)throw new Error("MapiRequest requires a client");if(!q||!q.path||!q.method)throw new Error("MapiRequest requires an options object with path and method properties");var Z={};q.body&&(Z["content-type"]="application/json");var Q=g(Z,q.headers),oe=Object.keys(Q).reduce(function(de,ze){return de[ze.toLowerCase()]=Q[ze],de},{});this.id=N++,this._options=q,this.emitter=new b,this.client=s,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=q.path,this.method=q.method,this.origin=q.origin||s.origin,this.query=q.query||{},this.params=q.params||{},this.body=q.body||null,this.file=q.file||null,this.encoding=q.encoding||"utf8",this.sendFileAs=q.sendFileAs||null,this.headers=oe}return V.prototype.url=function(q){var Z=S.prependOrigin(this.path,this.origin);Z=S.appendQueryObject(Z,this.query);var Q=this.params,oe=q??this.client.accessToken;if(oe){Z=S.appendQueryParam(Z,"access_token",oe);var de=h(oe).user;Q=g({ownerId:de},Q)}return Z=S.interpolateRouteParams(Z,Q),Z},V.prototype.send=function(){var q=this;if(q.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return q.sent=!0,q.client.sendRequest(q).then(function(Z){return q.response=Z,q.emitter.emit(I.EVENT_RESPONSE,Z),Z},function(Z){throw q.error=Z,q.emitter.emit(I.EVENT_ERROR,Z),Z})},V.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},V.prototype.eachPage=function(q){var Z=this;function Q(ze){function le(){delete Z._nextPageRequest;var Se=ze.nextPage();Se&&(Z._nextPageRequest=Se,de(Se))}q(null,ze,le)}function oe(ze){q(ze,null,function(){})}function de(ze){ze.send().then(Q,oe)}de(this)},V.prototype.clone=function(){return this._extend()},V.prototype._extend=function(q){var Z=g(this._options,q);return new V(this.client,Z)},Nv=V,Nv}var kv,N6;function m5(){if(N6)return kv;N6=1;var h=p5(),g=GP(),b=U1();function S(I){if(!I||!I.accessToken)throw new Error("Cannot create a client without an access token");h(I.accessToken),this.accessToken=I.accessToken,this.origin=I.origin||b.API_ORIGIN}return S.prototype.createRequest=function(N){return new g(this,N)},kv=S,kv}var Bv,k6;function g5(){if(k6)return Bv;k6=1;var h=FP(),g=m5();function b(I){g.call(this,I)}b.prototype=Object.create(g.prototype),b.prototype.constructor=b,b.prototype.sendRequest=h.browserSend,b.prototype.abortRequest=h.browserAbort;function S(I){return new b(I)}return Bv=S,Bv}var Fv,B6;function $P(){if(B6)return Fv;B6=1;var h=g5();return Fv=h,Fv}var Uv,F6;function ZP(){if(F6)return Uv;F6=1;var h=Object.prototype.toString;return Uv=function(g){var b;return h.call(g)==="[object Object]"&&(b=Object.getPrototypeOf(g),b===null||b===Object.getPrototypeOf({}))},Uv}var Vv,U6;function WP(){if(U6)return Vv;U6=1;var h=ZP(),g=Wg(),b="value",S=`
  `,I={};I.assert=function(le,Se){return Se=Se||{},function(ee){var _e=V(le,ee);if(_e){var ye=s(_e,Se);throw Se.apiName&&(ye=Se.apiName+": "+ye),new Error(ye)}}},I.shape=function(Se){var ee=ze(Se);return function(ye){var xe=V(I.plainObject,ye);if(xe)return xe;for(var Le,Ae,Ke=[],it=0;it<ee.length;it++)Le=ee[it].key,Ae=ee[it].value,xe=V(Ae,ye[Le]),xe&&Ke.push([Le].concat(xe));return Ke.length<2?Ke[0]:function(rt){Ke=Ke.map(function(xt){var Ci=xt[0],Zi=s(xt,rt).split(`
`).join(S);return"- "+Ci+": "+Zi});var lt=rt.path.join("."),zt=lt===b?"":" of "+lt;return"The following properties"+zt+" have invalid values:"+S+Ke.join(S)}}},I.strictShape=function(Se){var ee=I.shape(Se);return function(ye){var xe=ee(ye);if(xe)return xe;var Le=Object.keys(ye).reduce(function(Ae,Ke){return Se[Ke]===void 0&&Ae.push(Ke),Ae},[]);if(Le.length!==0)return function(){return"The following keys are invalid: "+Le.join(", ")}}},I.arrayOf=function(Se){return N(Se)},I.tuple=function(){var Se=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return N(Se)};function N(le){var Se=Array.isArray(le),ee=function(_e){return Se?le[_e]:le};return function(ye){var xe=V(I.plainArray,ye);if(xe)return xe;if(Se&&ye.length!==le.length)return"an array with "+le.length+" items";for(var Le=0;Le<ye.length;Le++)if(xe=V(ee(Le),ye[Le]),xe)return[Le].concat(xe)}}I.required=function(Se){function ee(_e){return _e==null?function(ye){return oe(ye,de(ye.path)?"cannot be undefined/null.":"is required.")}:Se.apply(this,arguments)}return ee.__required=!0,ee},I.oneOfType=function(){var Se=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(_e){var ye=Se.map(function(xe){return V(xe,_e)}).filter(Boolean);if(ye.length===Se.length)return ye.every(function(xe){return xe.length===1&&typeof xe[0]=="string"})?q(ye.map(function(xe){return xe[0]})):ye.reduce(function(xe,Le){return Le.length>xe.length?Le:xe})}},I.equal=function(Se){return function(_e){if(_e!==Se)return JSON.stringify(Se)}},I.oneOf=function(){var Se=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),ee=Se.map(function(_e){return I.equal(_e)});return I.oneOfType.apply(this,ee)},I.range=function(Se){var ee=Se[0],_e=Se[1];return function(xe){var Le=V(I.number,xe);if(Le||xe<ee||xe>_e)return"number between "+ee+" & "+_e+" (inclusive)"}},I.any=function(){},I.boolean=function(Se){if(typeof Se!="boolean")return"boolean"},I.number=function(Se){if(typeof Se!="number")return"number"},I.plainArray=function(Se){if(!Array.isArray(Se))return"array"},I.plainObject=function(Se){if(!h(Se))return"object"},I.string=function(Se){if(typeof Se!="string")return"string"},I.func=function(Se){if(typeof Se!="function")return"function"};function V(le,Se){if(!(Se==null&&!le.hasOwnProperty("__required"))){var ee=le(Se);if(ee)return Array.isArray(ee)?ee:[ee]}}function s(le,Se){var ee=le.length,_e=le[ee-1],ye=le.slice(0,ee-1);return ye.length===0&&(ye=[b]),Se=g(Se,{path:ye}),typeof _e=="function"?_e(Se):oe(Se,Z(_e))}function q(le){return le.length<2?le[0]:le.length===2?le.join(" or "):le.slice(0,-1).join(", ")+", or "+le.slice(-1)}function Z(le){return"must be "+Q(le)+"."}function Q(le){return/^an? /.test(le)?le:/^[aeiou]/i.test(le)?"an "+le:/^[a-z]/i.test(le)?"a "+le:le}function oe(le,Se){var ee=de(le.path),_e=le.path.join(".")+" "+Se,ye=ee?"Item at position ":"";return ye+_e}function de(le){return typeof le[le.length-1]=="number"||typeof le[0]=="number"}function ze(le){return Object.keys(le||{}).map(function(Se){return{key:Se,value:le[Se]}})}return I.validate=V,I.processMessage=s,Vv=I,Vv}var Hv,V6;function XP(){if(V6)return Hv;V6=1;var h=Wg(),g=WP();function b(V){if(typeof window<"u")return V instanceof gp.Blob||V instanceof gp.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof V=="string"||V.pipe!==void 0))return"Filename or Readable stream"}function S(V,s){return g.assert(g.strictShape(V),s)}function I(V){var s="date";if(typeof V=="boolean")return s;try{var q=new Date(V);if(q.getTime&&isNaN(q.getTime()))return s}catch{return s}}function N(V){return g.tuple(g.number,g.number)(V)}return Hv=h(g,{file:b,date:I,coordinates:N,assertShape:S}),Hv}var qv,H6;function YP(){if(H6)return qv;H6=1;function h(g,b){var S=function(I,N){return b.indexOf(I)!==-1&&N!==void 0};return typeof b=="function"&&(S=b),Object.keys(g).filter(function(I){return S(I,g[I])}).reduce(function(I,N){return I[N]=g[N],I},{})}return qv=h,qv}var Gv,q6;function KP(){if(q6)return Gv;q6=1;function h(g,b){return Object.keys(g).reduce(function(S,I){return S[I]=b(I,g[I]),S},{})}return Gv=h,Gv}var $v,G6;function JP(){if(G6)return $v;G6=1;var h=KP();function g(b){return h(b,function(S,I){return typeof I=="boolean"?JSON.stringify(I):I})}return $v=g,$v}var Zv,$6;function QP(){if($6)return Zv;$6=1;var h=m5(),g=g5();function b(S){return function(I){var N;h.prototype.isPrototypeOf(I)?N=I:N=g(I);var V=Object.create(S);return V.client=N,V}}return Zv=b,Zv}var Wv,Z6;function eO(){if(Z6)return Wv;Z6=1;var h=Wg(),g=XP(),b=YP(),S=JP(),I=QP(),N={},V=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];return N.forwardGeocode=function(s){g.assertShape({query:g.required(g.string),mode:g.oneOf("mapbox.places","mapbox.places-permanent"),countries:g.arrayOf(g.string),proximity:g.oneOf(g.coordinates,"ip"),types:g.arrayOf(g.oneOf(V)),autocomplete:g.boolean,bbox:g.arrayOf(g.number),limit:g.number,language:g.arrayOf(g.string),routing:g.boolean,fuzzyMatch:g.boolean,worldview:g.string,session_token:g.string})(s),s.mode=s.mode||"mapbox.places";var q=S(h({country:s.countries},b(s,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:b(s,["mode","query"]),query:q})},N.reverseGeocode=function(s){g.assertShape({query:g.required(g.coordinates),mode:g.oneOf("mapbox.places","mapbox.places-permanent"),countries:g.arrayOf(g.string),types:g.arrayOf(g.oneOf(V)),bbox:g.arrayOf(g.number),limit:g.number,language:g.arrayOf(g.string),reverseMode:g.oneOf("distance","score"),routing:g.boolean,worldview:g.string,session_token:g.string})(s),s.mode=s.mode||"mapbox.places";var q=S(h({country:s.countries},b(s,["country","types","bbox","limit","language","reverseMode","routing","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:b(s,["mode","query"]),query:q})},Wv=I(N),Wv}let tO="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",_5=h=>crypto.getRandomValues(new Uint8Array(h)),y5=(h,g,b)=>{let S=(2<<Math.log(h.length-1)/Math.LN2)-1,I=-~(1.6*S*g/h.length);return(N=g)=>{let V="";for(;;){let s=b(I),q=I|0;for(;q--;)if(V+=h[s[q]&S]||"",V.length===N)return V}}},iO=(h,g=21)=>y5(h,g,_5),rO=(h=21)=>crypto.getRandomValues(new Uint8Array(h)).reduce((g,b)=>(b&=63,b<36?g+=b.toString(36):b<62?g+=(b-26).toString(36).toUpperCase():b>62?g+="-":g+="_",g),"");const nO=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:iO,customRandom:y5,nanoid:rO,random:_5,urlAlphabet:tO},Symbol.toStringTag,{value:"Module"})),sO=uC(nO);var Xv,W6;function aO(){if(W6)return Xv;W6=1;var h=sO.nanoid;function g(b){this.origin=b.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=b.accessToken,this.version="0.3.0",this.pluginSessionID=this.generateSessionID(),this.sessionIncrementer=0,this.userAgent=this.getUserAgent(),this.options=b,this.send=this.send.bind(this),this.countries=b.countries?b.countries.split(","):null,this.types=b.types?b.types.split(","):null,this.bbox=b.bbox?b.bbox:null,this.language=b.language?b.language.split(","):null,this.limit=b.limit?+b.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(b),this.eventQueue=new Array,this.flushInterval=b.flushInterval||1e3,this.maxQueueSize=b.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}return g.prototype={select:function(b,S){var I=this.getEventPayload("search.select",S,{selectedFeature:b});if(I&&!(I.resultIndex===this.lastSentIndex&&I.queryString===this.lastSentInput||I.resultIndex==-1))return this.lastSentIndex=I.resultIndex,this.lastSentInput=I.queryString,this.push(I)},start:function(b){var S=this.getEventPayload("search.start",b);if(S)return this.push(S)},keyevent:function(b,S){if(b.key&&!(b.metaKey||[9,27,37,39,13,38,40].indexOf(b.keyCode)!==-1)){var I=this.getEventPayload("search.keystroke",S,{key:b.key});if(I)return this.push(I)}},send:function(b,S){if(!this.enableEventLogging)return S?S():void 0;var I=this.getRequestOptions(b);this.request(I,(function(N){if(N)return this.handleError(N,S);if(S)return S()}).bind(this))},getRequestOptions:function(b){Array.isArray(b)||(b=[b]);var S={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(b)};return S},getEventPayload:function(b,S,I={}){if(b==="search.select"&&!I.selectedFeature||b==="search.keystroke"&&!I.key)return null;var N;if(!S.options.proximity)N=null;else if(typeof S.options.proximity=="object")N=[S.options.proximity.longitude,S.options.proximity.latitude];else if(S.options.proximity==="ip"){var V=S._headers?S._headers["ip-proximity"]:null;V&&typeof V=="string"?N=V.split(",").map(parseFloat):N=[999,999]}else N=S.options.proximity;var s=S._map?S._map.getZoom():void 0,q={event:b,version:this.getEventSchemaVersion(b),created:+new Date,sessionIdentifier:this.getSessionId(),country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:S.options.autocomplete,fuzzyMatch:S.options.fuzzyMatch,proximity:N,limit:S.options.limit,routing:S.options.routing,worldview:S.options.worldview,mapZoom:s,keyboardLocale:this.locale};if(b==="search.select"?q.queryString=S.inputString:b!="search.select"&&S._inputEl?q.queryString=S._inputEl.value:q.queryString=S.inputString,["search.keystroke","search.select"].includes(b)&&(q.path="geocoding/v5/mapbox.places"),b==="search.keystroke"&&I.key)q.lastAction=I.key;else if(b==="search.select"&&I.selectedFeature){var Z=I.selectedFeature,Q=this.getSelectedIndex(Z,S);if(q.resultIndex=Q,q.resultPlaceName=Z.place_name,q.resultId=Z.id,Z.properties&&(q.resultMapboxId=Z.properties.mapbox_id),S._typeahead){var oe=S._typeahead.data;oe&&oe.length>0&&(q.suggestionIds=this.getSuggestionIds(oe),q.suggestionNames=this.getSuggestionNames(oe),q.suggestionTypes=this.getSuggestionTypes(oe),q.suggestionSources=this.getSuggestionSources(oe))}}return this.validatePayload(q)?q:null},request:function(b,S){var I=new XMLHttpRequest;I.onreadystatechange=function(){if(this.readyState==4)return this.status==204?S(null):S(this.statusText)},I.open(b.method,b.host+"/"+b.path,!0);for(var N in b.headers){var V=b.headers[N];I.setRequestHeader(N,V)}I.send(b.body)},handleError:function(b,S){if(S)return S(b)},generateSessionID:function(){return h()},getSessionId:function(){return this.pluginSessionID+"."+this.sessionIncrementer},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(b,S){if(S._typeahead){var I=S._typeahead.data,N=b.id,V=I.map(function(q){return q.id}),s=V.indexOf(N);return s}},getSuggestionIds:function(b){return b.map(function(S){return S.properties?S.properties.mapbox_id||"":S.id||""})},getSuggestionNames:function(b){return b.map(function(S){return S.place_name||""})},getSuggestionTypes:function(b){return b.map(function(S){return S.place_type&&Array.isArray(S.place_type)&&S.place_type[0]||""})},getSuggestionSources:function(b){return b.map(function(S){return S._source||""})},getEventSchemaVersion:function(b){return["search.keystroke","search.select"].includes(b)?"2.2":"2.0"},validatePayload:function(b){if(!b||!b.event)return!1;var S=["event","created","sessionIdentifier","queryString"],I=["event","created","sessionIdentifier","queryString","lastAction"],N=["event","created","sessionIdentifier","queryString","resultIndex","path","suggestionIds"],V=b.event;return V==="search.start"?this.objectHasRequiredProps(b,S):V==="search.keystroke"?this.objectHasRequiredProps(b,I):V==="search.select"?this.objectHasRequiredProps(b,N):!0},objectHasRequiredProps:function(b,S){return S.every(function(I){return I==="queryString"?typeof b[I]=="string"&&b[I].length>0:b[I]!==void 0})},shouldEnableLogging:function(b){return!(b.enableEventLogging===!1||b.origin&&b.origin!=="https://api.mapbox.com")},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(b,S){this.eventQueue.push(b),(this.eventQueue.length>=this.maxQueueSize||S)&&this.flush()},remove:function(){this.flush()}},Xv=g,Xv}var Yv,X6;function oO(){if(X6)return Yv;X6=1;var h={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""};return Yv={placeholder:h},Yv}var Ky={exports:{}},lO=Ky.exports,Y6;function cO(){return Y6||(Y6=1,function(h){(function(g,b,S){h.exports?h.exports=S():g[b]=S()})(lO,"subtag",function(){var g="",b=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function S(q){return q.match(b)||[]}function I(q){return S(q).filter(function(Z,Q){return Z&&Q})}function N(q){return q=S(q),{language:q[1]||g,extlang:q[2]||g,script:q[3]||g,region:q[4]||g}}function V(q,Z,Q){Object.defineProperty(q,Z,{value:Q,enumerable:!0})}function s(q,Z,Q){function oe(de){return S(de)[q]||g}V(oe,"pattern",Z),V(N,Q,oe)}return s(1,/^[a-zA-Z]{2,3}$/,"language"),s(2,/^[a-zA-Z]{3}$/,"extlang"),s(3,/^[a-zA-Z]{4}$/,"script"),s(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),V(N,"split",I),N})}(Ky)),Ky.exports}var Kv,K6;function uO(){if(K6)return Kv;K6=1;function h(){}return h.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const g={enableHighAccuracy:!0};return new Promise(function(b,S){window.navigator.geolocation.getCurrentPosition(b,S,g)})}},Kv=h,Kv}var Jv,J6;function hO(){if(J6)return Jv;J6=1;function h(S,I){const N=g(S),V=["address","street","place","country"];var s;if(typeof I=="function")return I(N);const q=V.indexOf(I);return q===-1?s=V:s=V.slice(q),s.reduce(function(Z,Q){return N[Q]?(Z!==""&&(Z=Z+", "),Z+N[Q]):Z},"")}function g(S){const I=S.address||"",N=S.text||"",V=S.place_name||"",q={address:V.split(",")[0],houseNumber:I,street:N,placeName:V};return S.context.forEach(function(Z){const Q=Z.id.split(".")[0];q[Q]=Z.text}),q}return Jv={transformFeatureToGeolocationText:h,getAddressInfo:g,REVERSE_GEOCODE_COORD_RGX:/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/},Jv}var Qv,Q6;function dO(){if(Q6)return Qv;Q6=1;var h=LP(),g=DP(),b=Wg(),S=PP().EventEmitter,I=OP(),N=$P(),V=eO(),s=aO(),q=oO(),Z=cO(),Q=uO(),oe=hO();const de={FORWARD:0,LOCAL:1,REVERSE:2};function ze(){var ee=document.createElement("div");return ee.className="mapboxgl-ctrl-geocoder--powered-by",ee.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',ee}function le(ee){this._eventEmitter=new S,this.options=b({},this.options,ee),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Q}function Se(ee){return ee?String(ee).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}return le.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",useBrowserFocus:!1,getItemValue:function(ee){return ee.place_name},render:function(ee){var _e=Se(ee.place_name).split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+_e[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+_e.splice(1,_e.length).join(",")+"</div></div>"}},_headers:{},addTo:function(ee){function _e(ye,xe){if(!document.body.contains(xe))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const Le=ye.onAdd();xe.appendChild(Le)}if(ee._controlContainer)ee.addControl(this);else if(ee instanceof HTMLElement)_e(this,ee);else if(typeof ee=="string"){const ye=document.querySelectorAll(ee);if(ye.length===0)throw new Error("Element ",ee,"not found.");if(ye.length>1)throw new Error("Geocoder can only be added to a single html element");_e(this,ye[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(ee){if(ee&&typeof ee!="string"&&(this._map=ee),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=V(N({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new s(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this),this._onSuggestionItemFocus=this._onSuggestionItemFocus.bind(this),this._onSuggestionItemKeyDown=this._onSuggestionItemKeydown.bind(this);var _e=this.container=document.createElement("div");_e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var ye=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",g(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(Ci){this.eventManager.keyevent(Ci,this)}).bind(this));var xe=document.createElement("div");xe.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var Le=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(Le),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),xe.appendChild(this._clearEl),xe.appendChild(this._loadingEl),_e.appendChild(ye),_e.appendChild(this._inputEl),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var Ae=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(Ae),xe.appendChild(this._geolocateEl),this._showGeolocateButton()}var Ke=this._typeahead=new h(this._inputEl,[],{hideOnBlur:!this.options.useBrowserFocus,filter:!1,minLength:this.options.minLength,limit:this.options.limit});_e.insertBefore(xe,Ke.list.wrapper),this.setRenderFunction(this.options.render),Ke.getItemValue=this.options.getItemValue;const it=this._typeahead.handleKeyDown.bind(this._typeahead),rt=this._typeahead.handleKeyUp.bind(this._typeahead);this._typeahead.handleKeyUp,this.options.useBrowserFocus&&(this._typeahead.handleKeyDown=(function(Ci){if(!(Ci.keyCode===9&&!Ke.list.isEmpty())){if(Ci.keyCode===40){this._typeahead.list.active=0,this._typeahead.list.element.querySelectorAll("li").forEach(function(Zi){Zi.classList.remove("active")}),this._typeahead.list.element.querySelectorAll("li")[0].classList.add("active"),this._typeahead.list.element.querySelectorAll("li")[0].focus();return}else if(Ci.keyCode===38){this._typeahead.list.active=Ke.list.items.length-1,this._typeahead.list.element.querySelectorAll("li").forEach(function(Zi){Zi.classList.remove("active")}),this._typeahead.list.element.querySelectorAll("li")[this._typeahead.list.active].classList.add("active"),this._typeahead.list.element.querySelectorAll("li")[this._typeahead.list.active].focus();return}it(Ci)}}).bind(this),this._typeahead.handleKeyUp=function(Ci){if(Ci&&Ci.keyCode===16){Ci.preventDefault();return}rt(Ci)});var lt=Ke.list.draw,zt=this._footerNode=ze(),xt=this;return Ke.list.draw=function(){xt.options.useBrowserFocus&&Ke.list.element.querySelectorAll("li").forEach(function(Ci){Ci.removeEventListener("focus",xt._onSuggestionItemFocus),Ci.removeEventListener("keydown",xt._onSuggestionItemKeyDown)}),lt.call(this),xt.options.useBrowserFocus&&Ke.list.element.querySelectorAll("li").forEach((function(Ci,Zi){Zi===0&&Ci.focus(),Ci.setAttribute("data-index",Zi),Ci.tabIndex=0,Ci.addEventListener("focus",this._onSuggestionItemFocus),Ci.addEventListener("keydown",this._onSuggestionItemKeyDown)}).bind(xt)),zt.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),zt.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(zt)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),_e},_onSuggestionItemKeydown(ee){const _e=ee.keyCode;if(_e!==9){if(_e===13){ee.preventDefault();const ye=this._typeahead.list.element.querySelector(".active");if(ye){const xe=ye.getAttribute("data-index"),Le=this._typeahead.list.items[xe];Le&&(this._typeahead.value(Le.original),this._typeahead.list.hide())}}else if(_e===38||_e===40){const ye=this._typeahead.list.element.querySelectorAll("li");if(ye.length>0){if(_e===38)if(this._typeahead.list.active>0)ee.preventDefault(),this._typeahead.list.active--;else{this._typeahead.el.focus();return}else if(_e===40)if(ee.preventDefault(),this._typeahead.list.active<ye.length-1)this._typeahead.list.active++;else return;ye.forEach(function(Le){Le.classList.remove("active")});const xe=ye[this._typeahead.list.active];xe&&(xe.classList.add("active"),xe.focus())}}}},_onSuggestionItemFocus(ee){this._typeahead.list.active=ee.target.getAttribute("data-index"),this._typeahead.list.element.querySelectorAll("li").forEach(function(_e){_e.classList.remove("active")}),ee.target.classList.add("active")},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(ee){this._hideLoadingIcon();const _e={geometry:{type:"Point",coordinates:[ee.coords.longitude,ee.coords.latitude]}};this._handleMarker(_e),this._fly(_e),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(_e),this._showClearButton(),this.fresh=!1;const ye={limit:1,language:[this.options.language],query:_e.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const xe=_e.geometry.coordinates[0]+","+_e.geometry.coordinates[1];this._setInputValue(xe),this._eventEmitter.emit("result",{result:_e})}else this.geocoderService.reverseGeocode(ye).send().then((function(xe){const Le=xe.body.features[0];if(Le){const Ae=oe.transformFeatureToGeolocationText(Le,this.options.addressAccuracy);this._setInputValue(Ae),Le.user_coordinates=_e.geometry.coordinates,this._eventEmitter.emit("result",{result:Le})}else this._eventEmitter.emit("result",{result:{user_coordinates:_e.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(ee){ee.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(ee,_e){var ye=document.createElementNS("http://www.w3.org/2000/svg","svg");return ye.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+ee),ye.setAttribute("viewBox","0 0 18 18"),ye.setAttribute("xml:space","preserve"),ye.setAttribute("width",18),ye.setAttribute("height",18),ye.innerHTML=_e,ye},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(ee){this._inputEl.value=ee,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(ee){var _e=(ee.clipboardData||window.clipboardData).getData("text");_e.length>=this.options.minLength&&this._geocode(_e)},_onKeyDown:function(ee){var _e=27,ye=9;if(ee.keyCode===_e&&this.options.clearAndBlurOnEsc)return this._clear(ee),this._inputEl.blur();var xe=ee.target&&ee.target.shadowRoot?ee.target.shadowRoot.activeElement:ee.target,Le=xe?xe.value:"";if(!Le)return this.fresh=!0,ee.keyCode!==ye&&this.clear(ee),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(ee.metaKey||[ye,_e,37,39,13,38,40].indexOf(ee.keyCode)!==-1)&&xe.value.length>=this.options.minLength&&this._geocode(xe.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(ee){this.options.clearOnBlur&&this._clearOnBlur(ee),this.options.collapsed&&this._collapse()},_onChange:function(){var ee=this._typeahead.selected;ee&&JSON.stringify(ee)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(ee),this.options.marker&&this._mapboxgl&&this._handleMarker(ee),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(ee),this._eventEmitter.emit("result",{result:ee}),this.eventManager.select(ee,this))},_fly:function(ee){var _e;if(ee.properties&&I[ee.properties.short_code])_e=b({},this.options.flyTo),this._map&&this._map.fitBounds(I[ee.properties.short_code].bbox,_e);else if(ee.bbox){var ye=ee.bbox;_e=b({},this.options.flyTo),this._map&&this._map.fitBounds([[ye[0],ye[1]],[ye[2],ye[3]]],_e)}else{var xe={zoom:this.options.zoom};_e=b({},xe,this.options.flyTo),ee.center?_e.center=ee.center:ee.geometry&&ee.geometry.type&&ee.geometry.type==="Point"&&ee.geometry.coordinates&&(_e.center=ee.geometry.coordinates),this._map&&this._map.flyTo(_e)}},_requestType:function(ee,_e){var ye;return ee.localGeocoderOnly?ye=de.LOCAL:ee.reverseGeocode&&oe.REVERSE_GEOCODE_COORD_RGX.test(_e)?ye=de.REVERSE:ye=de.FORWARD,ye},_setupConfig:function(ee,_e){const ye=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],xe=/[\s,]+/;var Le=this,Ae=ye.reduce(function(it,rt){if(Le.options[rt]===void 0||Le.options[rt]===null)return it;["countries","types","language"].indexOf(rt)>-1?it[rt]=Le.options[rt].split(xe):it[rt]=Le.options[rt];const lt=typeof Le.options[rt].longitude=="number"&&typeof Le.options[rt].latitude=="number";if(rt==="proximity"&&lt){const zt=Le.options[rt].longitude,xt=Le.options[rt].latitude;it[rt]=[zt,xt]}return it},{});switch(ee){case de.REVERSE:{var Ke=_e.split(xe).map(function(it){return parseFloat(it,10)});Le.options.flipCoordinates||Ke.reverse(),Ae.types&&Ae.types[0],Ae=b(Ae,{query:Ke,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(it){it in Ae&&delete Ae[it]})}break;case de.FORWARD:{const it=_e.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(it)&&(_e=_e.replace(/,/g," ")),Ae=b(Ae,{query:_e})}break}return Ae.session_token=this.eventManager.getSessionId(),Ae},_geocode:function(ee){this.inputString=ee,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:ee});const _e=this._requestType(this.options,ee),ye=this._setupConfig(_e,ee);var xe;switch(_e){case de.LOCAL:xe=Promise.resolve();break;case de.FORWARD:xe=this.geocoderService.forwardGeocode(ye).send();break;case de.REVERSE:xe=this.geocoderService.reverseGeocode(ye).send();break}var Le=this.options.localGeocoder?this.options.localGeocoder(ee)||[]:[],Ae=[],Ke=null;return xe.catch((function(it){Ke=it}).bind(this)).then((function(it){this._hideLoadingIcon();var rt={};return it?it.statusCode=="200"&&(rt=it.body,rt.request=it.request,rt.headers=it.headers,this._headers=it.headers):rt={type:"FeatureCollection",features:[]},rt.config=ye,this.fresh&&(this.eventManager.start(this),this.fresh=!1),rt.features&&rt.features.length&&rt.features.map(function(lt){lt._source="mapbox"}),rt.features=rt.features?Le.concat(rt.features):Le,this.options.externalGeocoder?(Ae=this.options.externalGeocoder(ee,rt.features)||Promise.resolve([]),Ae.then(function(lt){return rt.features=rt.features?lt.concat(rt.features):lt,rt},function(){return rt})):rt}).bind(this)).then((function(it){if(Ke)throw Ke;this.options.filter&&it.features.length&&(it.features=it.features.filter(this.options.filter)),it.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",it),this._typeahead.update(it.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",it))}).bind(this)).catch((function(it){this._hideLoadingIcon(),this._hideAttribution(),Le.length&&this.options.localGeocoder||Ae.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(Le)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:Le}),this._eventEmitter.emit("error",{error:it})}).bind(this)),xe},_clear:function(ee){ee&&ee.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this.eventManager.sessionIncrementer++,this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(ee){this._clear(ee),this._inputEl.focus(),this.options.useBrowserFocus&&this._typeahead.list.hide()},_clearOnBlur:function(ee){var _e=this;ee.relatedTarget&&_e._clear(ee)},_onQueryResult:function(ee){var _e=ee.body;if(_e.features.length){var ye=_e.features[0];this._typeahead.selected=ye,this._inputEl.value=ye.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var ee=this._map.getCenter().wrap();this.setProximity({longitude:ee.lng,latitude:ee.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(ee){return this._geocode(ee).then(this._onQueryResult),this},_renderError:function(){var ee="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(ee)},_renderLocationError:function(){var ee="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(ee)},_renderNoResults:function(){var ee="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(ee)},_renderUserDeniedGeolocationError:function(){var ee="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(ee)},_renderMessage:function(ee){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(ee)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var ee=this.options.language.split(",")[0],_e=Z.language(ee),ye=q.placeholder[_e];if(ye)return ye}return"Search"},setInput:function(ee,_e){return _e===void 0&&(_e=!1),this._inputEl.value=ee,this._typeahead.selected=null,this._typeahead.clear(),ee.length>=this.options.minLength&&(_e?this._geocode(ee):this._onChange()),this},setProximity:function(ee,_e=!0){return this.options.proximity=ee,_e&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(ee){return ee&&typeof ee=="function"&&(this._typeahead.render=ee),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(ee){var _e=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=ee||this.options.language||_e,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(ee){return this.options.zoom=ee,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(ee){return this.options.flyTo=ee,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(ee){return this.options.placeholder=ee||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(ee){return this.options.bbox=ee,this},getCountries:function(){return this.options.countries},setCountries:function(ee){return this.options.countries=ee,this},getTypes:function(){return this.options.types},setTypes:function(ee){return this.options.types=ee,this},getMinLength:function(){return this.options.minLength},setMinLength:function(ee){return this.options.minLength=ee,this._typeahead&&(this._typeahead.options.minLength=ee),this},getLimit:function(){return this.options.limit},setLimit:function(ee){return this.options.limit=ee,this._typeahead&&(this._typeahead.options.limit=ee),this},getFilter:function(){return this.options.filter},setFilter:function(ee){return this.options.filter=ee,this},setOrigin:function(ee){return this.options.origin=ee,this.geocoderService=V(N({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(ee){return this.options.accessToken=ee,this.geocoderService=V(N({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(ee){return this.options.autocomplete=ee,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(ee){return this.options.fuzzyMatch=ee,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(ee){return this.options.routing=ee,this},getRouting:function(){return this.options.routing},setWorldview:function(ee){return this.options.worldview=ee,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(ee){if(this._map){this._removeMarker();var _e={color:"#4668F2"},ye=b({},_e,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(ye),ee.center?this.mapMarker.setLngLat(ee.center).addTo(this._map):ee.geometry&&ee.geometry.type&&ee.geometry.type==="Point"&&ee.geometry.coordinates&&this.mapMarker.setLngLat(ee.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(ee,_e){return this._eventEmitter.on(ee,_e),this},off:function(ee,_e){return this._eventEmitter.removeListener(ee,_e),this.eventManager.remove(),this}},Qv=le,Qv}dO();const eT=void 0;function x5(){bc("Advanced Route Planner - Navigation Tool");const[h,g]=ue.useState([{address:"",coordinates:null}]),[b,S]=ue.useState(!1),[I,N]=ue.useState([]),[V,s]=ue.useState(null),[q,Z]=ue.useState([]),[Q,oe]=ue.useState(!1),[de,ze]=ue.useState(null),[le,Se]=ue.useState(null),[ee,_e]=ue.useState("driving"),[ye,xe]=ue.useState("streets"),[Le,Ae]=ue.useState(!1),[Ke,it]=ue.useState(!1),[rt,lt]=ue.useState(!0),[zt,xt]=ue.useState(!1),[Ci,Zi]=ue.useState(!1),[or,er]=ue.useState(!1),[Jt,ji]=ue.useState([]),[Fi,Pr]=ue.useState([]),[tt,Ht]=ue.useState(!1),[Pi,Ui]=ue.useState(!1),[ii,Wi]=ue.useState(null),[_i,Ri]=ue.useState(null),[Ai,gt]=ue.useState([]),[Tt,Si]=ue.useState(0),Sr=ue.useRef(null);ue.useRef([]);const Cr=ue.useRef([]),zr=ue.useRef([]),Er={streets:"mapbox://styles/mapbox/streets-v12",outdoors:"mapbox://styles/mapbox/outdoors-v12",light:"mapbox://styles/mapbox/light-v11",dark:"mapbox://styles/mapbox/dark-v11",satellite:"mapbox://styles/mapbox/satellite-v9",satelliteStreets:"mapbox://styles/mapbox/satellite-streets-v12"},Gn=[{id:"driving",name:"Driving",icon:P4,color:"#3B82F6"},{id:"walking",name:"Walking",icon:CI,color:"#10B981"},{id:"cycling",name:"Cycling",icon:mI,color:"#8B5CF6"},{id:"driving-traffic",name:"Driving (Traffic)",icon:P4,color:"#F59E0B"}],ds=()=>g(Dt=>[...Dt,{address:"",coordinates:null}]),Zs=Dt=>g(Ti=>Ti.filter((Ar,br)=>br!==Dt)),Br=(Dt,Ti,Ar=null)=>{g(br=>br.map((Rr,xn)=>xn===Dt?{address:Ti,coordinates:Ar}:Rr))};ue.useEffect(()=>{{console.warn("Mapbox access token not found. Please set VITE_MAPBOX_ACCESS_TOKEN in your environment variables."),Se("Mapbox access token not configured");return}},[]),ue.useEffect(()=>{if(!(!Q||!Sr.current||de)){try{const Dt=new pp.Map({container:Sr.current,style:Er[ye],center:[77.209,28.6139],zoom:11,attributionControl:!1,maxZoom:20,minZoom:1});Dt.on("load",()=>{console.log("Map loaded successfully"),ze(Dt),Se(null),Dt.addControl(new pp.NavigationControl({showCompass:!0,showZoom:!0,visualizePitch:!0}),"top-right");const Ti=new pp.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0,showAccuracyCircle:!0});Ti.on("geolocate",Ar=>{Wi([Ar.coords.longitude,Ar.coords.latitude])}),Dt.addControl(Ti,"top-right"),Dt.addControl(new pp.ScaleControl({maxWidth:100,unit:"metric"}),"bottom-left"),Dt.addControl(new pp.FullscreenControl,"top-right")}),Dt.on("error",Ti=>{console.error("Map error:",Ti),Se("Map failed to load. Please check your internet connection.")}),Dt.on("style.load",()=>{console.log("Map style loaded successfully")}),Dt.on("style.error",Ti=>{console.error("Map style error:",Ti),Se("Map style failed to load")})}catch(Dt){console.error("Error creating map:",Dt),Se("Failed to create map instance")}return()=>{de&&(de.remove(),ze(null))}}},[Q,ye]);const Jn=ue.useCallback(()=>{if(de){try{de.getLayer("route-main")&&de.removeLayer("route-main"),de.getSource("route-main")&&de.removeSource("route-main")}catch(Dt){console.warn("Error removing main route:",Dt)}zr.current.forEach(Dt=>{try{de.getLayer(Dt)&&de.removeLayer(Dt),de.getSource(Dt)&&de.removeSource(Dt)}catch(Ti){console.warn(`Error removing route ${Dt}:`,Ti)}}),zr.current=[]}},[de]),Rs=ue.useCallback(()=>{Cr.current.forEach(Dt=>{Dt&&Dt.remove()}),Cr.current=[]},[]),za=ue.useCallback(()=>{!de||!de.isStyleLoaded()||(Rs(),h.forEach((Dt,Ti)=>{if(Dt.coordinates){const Ar=Ti===0,br=Ti===h.length-1,Rr=document.createElement("div");Rr.className="custom-marker",Rr.style.cssText=`
          width: 30px;
          height: 30px;
          border-radius: 50%;
          background: ${Ar?"#10b981":br?"#ef4444":"#3b82f6"};
          border: 3px solid white;
          box-shadow: 0 2px 4px rgba(0,0,0,0.3);
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-weight: bold;
          font-size: 12px;
        `,Rr.textContent=Ti+1;const xn=new pp.Marker(Rr).setLngLat(Dt.coordinates).addTo(de),xs=new pp.Popup({offset:25}).setHTML(`
            <div class="p-2">
              <h3 class="font-semibold text-sm">Stop ${Ti+1}</h3>
              <p class="text-xs text-gray-600">${Dt.address}</p>
              <button onclick="navigator.clipboard.writeText('${Dt.coordinates[1]}, ${Dt.coordinates[0]}')" 
                      class="text-xs text-blue-600 hover:text-blue-800 mt-1">
                Copy Coordinates
              </button>
            </div>
          `);xn.setPopup(xs),Cr.current.push(xn)}}))},[de,h,Rs]);ue.useEffect(()=>{de&&de.isStyleLoaded()&&za()},[de,h,za]);const La=Dt=>{de&&(xe(Dt),de.setStyle(Er[Dt]))},fs=()=>{de&&(Ae(!Le),Le?(de.getLayer("traffic")&&de.removeLayer("traffic"),de.getSource("traffic")&&de.removeSource("traffic")):(de.addSource("traffic",{type:"vector",url:"mapbox://mapbox.mapbox-traffic-v1"}),de.addLayer({id:"traffic",type:"line",source:"traffic","source-layer":"traffic",paint:{"line-width":2,"line-color":["case",["==",["get","congestion"],"low"],"#10b981",["==",["get","congestion"],"moderate"],"#f59e0b",["==",["get","congestion"],"heavy"],"#ef4444",["==",["get","congestion"],"severe"],"#dc2626","#6b7280"]}})))},ps=()=>{const Dt=h.map(Ar=>Ar.address.trim()).filter(Boolean),Ti=new Date;return Dt.map((Ar,br)=>({addr:Ar,eta:new Date(Ti.getTime()+br*20*6e4)}))},$n=async()=>{const Dt=h.filter(Ti=>Ti.address.trim()&&Ti.coordinates);if(Dt.length<2){ei.error("Please add at least 2 valid addresses with coordinates");return}if(!de||!de.isStyleLoaded()){ei.error("Map is not ready. Please wait for the map to load.");return}S(!0);try{const Ti=Dt.map(xn=>xn.coordinates).join(";"),Ar=new URLSearchParams({geometries:"geojson",overview:"full",steps:"true",alternatives:or?"true":"false",access_token:eT});zt&&Ar.append("exclude","toll"),Ci&&Ar.append("exclude","motorway");const br=await fetch(`https://api.mapbox.com/directions/v5/mapbox/${ee}/${Ti}?${Ar}`);if(!br.ok)throw new Error(`HTTP error! status: ${br.status}`);const Rr=await br.json();if(Rr.routes&&Rr.routes.length>0){Jn();const xn=Rr.routes[0];s(xn),Rr.routes.length>1?gt(Rr.routes.slice(1)):gt([]);const xs="route-main";zr.current.push(xs),de.addSource(xs,{type:"geojson",data:{type:"Feature",properties:{},geometry:xn.geometry}}),de.addLayer({id:"route-main",type:"line",source:xs,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3b82f6","line-width":5,"line-opacity":.8}}),Ai.forEach((J,ie)=>{const me=`route-alt-${ie}`;zr.current.push(me),de.addSource(me,{type:"geojson",data:{type:"Feature",properties:{},geometry:J.geometry}}),de.addLayer({id:`route-alt-${ie}`,type:"line",source:me,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#6b7280","line-width":3,"line-opacity":.6,"line-dasharray":[2,2]}})});const Ct=Rr.waypoints||[],Hs=Date.now();let Pa=0;const ba=Dt.map((J,ie)=>{var me;if(ie>0){const je=((me=xn.legs[ie-1])==null?void 0:me.duration)*1e3||0;Pa+=je}return{addr:J.address,eta:new Date(Hs+Pa),coordinates:J.coordinates}});if(N(ba),Ri({distance:(xn.distance/1e3).toFixed(2),duration:Math.round(xn.duration/60),fuelCost:Xn(xn.distance,ee),co2Emission:Ds(xn.distance,ee)}),xn.geometry.coordinates.length>0){const J=xn.geometry.coordinates.reduce((ie,me)=>ie.extend(me),new pp.LngLatBounds(xn.geometry.coordinates[0],xn.geometry.coordinates[0]));de.fitBounds(J,{padding:50})}const He={id:Date.now(),stops:Dt,route:xn,alternatives:Ai,timestamp:new Date,travelMode:ee};Pr(J=>[He,...J.slice(0,9)]),ei.success("Route planned successfully!")}else throw new Error("No routes found")}catch(Ti){console.error("Route planning failed:",Ti),ei.error("Route planning failed. Showing approximate itinerary."),N(ps())}finally{S(!1)}},Xn=(Dt,Ti)=>Ti==="driving"||Ti==="driving-traffic"?(Dt/1e3/12*100).toFixed(2):0,Ds=(Dt,Ti)=>Ti==="driving"||Ti==="driving-traffic"?(Dt/1e3*120).toFixed(0):0,Ps=async()=>{if(!V){ei.error("No route to save");return}const Dt={name:`Route ${h.filter(Ti=>Ti.address).map(Ti=>Ti.address.split(",")[0]).join("  ")}`,stops:h.filter(Ti=>Ti.address&&Ti.coordinates),route:V,travelMode:ee,timestamp:new Date};try{const Ti=await fetch("https://urbansetu.onrender.com/api/route-planner/save",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(Dt)});if(Ti.ok){const Ar=await Ti.json();ji(br=>[Ar.route,...br]),ei.success("Route saved successfully!")}else throw new Error("Failed to save route")}catch(Ti){console.error("Error saving route:",Ti),ei.error("Failed to save route. Please try again.")}},Vs=Dt=>{g(Dt.stops),_e(Dt.travelMode),s(Dt.route),ei.success("Route loaded successfully!")},Pn=async()=>{try{const Dt=await fetch("https://urbansetu.onrender.com/api/route-planner/saved",{credentials:"include"});if(Dt.ok){const Ti=await Dt.json();ji(Ti.routes||[])}}catch(Dt){console.error("Error fetching saved routes:",Dt)}},oa=()=>{if(!V){ei.error("No route to export");return}const Dt=Da(V,h),Ti=new Blob([Dt],{type:"application/gpx+xml"}),Ar=URL.createObjectURL(Ti),br=document.createElement("a");br.href=Ar,br.download=`route-${Date.now()}.gpx`,br.click(),URL.revokeObjectURL(Ar),ei.success("Route exported as GPX file!")},Da=(Dt,Ti)=>{const Ar=Dt.geometry.coordinates;let br=`<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="UrbanSetu Route Planner">
  <trk>
    <name>Route</name>
    <trkseg>`;return Ar.forEach(Rr=>{br+=`
      <trkpt lat="${Rr[1]}" lon="${Rr[0]}"></trkpt>`}),br+=`
    </trkseg>
  </trk>`,Ti.forEach((Rr,xn)=>{Rr.coordinates&&(br+=`
  <wpt lat="${Rr.coordinates[1]}" lon="${Rr.coordinates[0]}">
    <name>Stop ${xn+1}</name>
    <desc>${Rr.address}</desc>
  </wpt>`)}),br+=`
</gpx>`,br},as=async()=>{if(!V){ei.error("No route to share");return}const Dt={title:"Route from UrbanSetu",text:`Check out this route: ${h.filter(Ti=>Ti.address).map(Ti=>Ti.address).join("  ")}`,url:window.location.href};if(navigator.share)try{await navigator.share(Dt),ei.success("Route shared successfully!")}catch(Ti){console.error("Error sharing:",Ti),va(Dt)}else va(Dt)},va=Dt=>{navigator.clipboard.writeText(Dt.url).then(()=>{ei.success("Route URL copied to clipboard!")}).catch(()=>{ei.error("Unable to share route")})},Ms=ue.useCallback(async(Dt,Ti)=>{if(Br(Dt,Ti),!Ti||Ti.length<3){Z(Ar=>{const br=[...Ar];return br[Dt]=[],br});return}try{const Ar=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(Ti)}.json?country=in&types=address,poi&limit=5&access_token=${eT}`);if(Ar.ok){const br=await Ar.json();Z(Rr=>{const xn=[...Rr];return xn[Dt]=br.features||[],xn})}}catch(Ar){console.error("Geocoding error:",Ar)}},[]),os=(Dt,Ti)=>{Br(Dt,Ti.place_name,Ti.center),Z(Ar=>{const br=[...Ar];return br[Dt]=[],br})},hn=Dt=>{ii?(Br(Dt,"Current Location",ii),ei.success("Current location added!")):ei.error("Current location not available")};return ue.useEffect(()=>{Pn()},[]),_.jsxs("div",{className:`max-w-7xl mx-auto px-2 sm:px-4 py-6 sm:py-10 ${tt?"fixed inset-0 z-50 bg-white":""}`,children:[_.jsxs("div",{className:"flex items-center justify-between mb-6",children:[_.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[_.jsx(r0,{className:"text-blue-600"})," Advanced Route Planner"]}),_.jsxs("div",{className:"flex items-center gap-2",children:[_.jsx("button",{onClick:()=>Ht(!tt),className:"p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors",title:"Toggle Fullscreen",children:_.jsx(k4,{className:"text-gray-600"})}),_.jsx("button",{onClick:()=>Ui(!Pi),className:"p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors",title:"Settings",children:_.jsx(Ly,{className:"text-gray-600"})})]})]}),_.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[_.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[_.jsxs("div",{className:"bg-white rounded-xl shadow p-4",children:[_.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[_.jsx(yI,{className:"text-blue-600"})," Travel Mode"]}),_.jsx("div",{className:"grid grid-cols-2 gap-2",children:Gn.map(Dt=>{const Ti=Dt.icon;return _.jsxs("button",{onClick:()=>_e(Dt.id),className:`p-3 rounded-lg border-2 transition-all flex items-center gap-2 ${ee===Dt.id?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"}`,children:[_.jsx(Ti,{style:{color:Dt.color}}),_.jsx("span",{className:"text-sm font-medium",children:Dt.name})]},Dt.id)})})]}),_.jsxs("div",{className:"bg-white rounded-xl shadow p-4",children:[_.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[_.jsx(bI,{className:"text-green-600"})," Route Options"]}),_.jsxs("div",{className:"space-y-3",children:[_.jsxs("label",{className:"flex items-center gap-2",children:[_.jsx("input",{type:"checkbox",checked:rt,onChange:Dt=>lt(Dt.target.checked),className:"rounded"}),_.jsx("span",{className:"text-sm",children:"Optimize waypoints"})]}),_.jsxs("label",{className:"flex items-center gap-2",children:[_.jsx("input",{type:"checkbox",checked:zt,onChange:Dt=>xt(Dt.target.checked),className:"rounded"}),_.jsx("span",{className:"text-sm",children:"Avoid tolls"})]}),_.jsxs("label",{className:"flex items-center gap-2",children:[_.jsx("input",{type:"checkbox",checked:Ci,onChange:Dt=>Zi(Dt.target.checked),className:"rounded"}),_.jsx("span",{className:"text-sm",children:"Avoid highways"})]}),_.jsxs("label",{className:"flex items-center gap-2",children:[_.jsx("input",{type:"checkbox",checked:or,onChange:Dt=>er(Dt.target.checked),className:"rounded"}),_.jsx("span",{className:"text-sm",children:"Show alternatives"})]})]})]}),_.jsxs("div",{className:"bg-white rounded-xl shadow p-4",children:[_.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[_.jsx(N4,{className:"text-red-600"})," Stops"]}),h.map((Dt,Ti)=>_.jsxs("div",{className:"flex flex-col gap-1 relative mb-3",children:[_.jsxs("div",{className:"flex gap-2",children:[_.jsxs("div",{className:"flex-1 relative",children:[_.jsx("input",{className:"w-full border rounded p-2 text-sm pr-8",value:Dt.address,onChange:Ar=>Ms(Ti,Ar.target.value),placeholder:`Stop ${Ti+1} address`}),Dt.coordinates&&_.jsx(N4,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-green-500"})]}),_.jsx("button",{onClick:()=>hn(Ti),className:"px-2 py-2 rounded bg-blue-100 text-blue-600 hover:bg-blue-200 transition-colors",title:"Use current location",children:_.jsx(TI,{})}),h.length>1&&_.jsx("button",{onClick:()=>Zs(Ti),className:"px-2 py-2 rounded bg-red-100 text-red-600 hover:bg-red-200 transition-colors",children:_.jsx(su,{})})]}),q[Ti]&&q[Ti].length>0&&_.jsx("ul",{className:"absolute z-10 top-full left-0 right-0 bg-white border border-gray-200 rounded shadow max-h-56 overflow-auto",children:q[Ti].map((Ar,br)=>_.jsxs("li",{className:"px-3 py-2 text-sm hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",onMouseDown:()=>os(Ti,Ar),children:[_.jsx("div",{className:"font-medium",children:Ar.place_name}),Ar.context&&_.jsx("div",{className:"text-xs text-gray-500",children:Ar.context.map(Rr=>Rr.text).join(", ")})]},br))})]},Ti)),_.jsxs("div",{className:"flex flex-col gap-2",children:[_.jsxs("button",{onClick:ds,className:"px-3 py-2 rounded bg-gray-100 hover:bg-gray-200 flex items-center gap-2 justify-center transition-colors",children:[_.jsx(rb,{})," Add Stop"]}),_.jsx("button",{onClick:$n,disabled:b||!de||!de.isStyleLoaded(),className:"px-4 py-2 rounded bg-gradient-to-r from-blue-600 to-purple-600 text-white disabled:opacity-60 hover:from-blue-700 hover:to-purple-700 transition-all",children:b?"Planning...":"Plan Route"})]})]}),V&&_.jsxs("div",{className:"bg-white rounded-xl shadow p-4",children:[_.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[_.jsx(d1,{className:"text-purple-600"})," Route Actions"]}),_.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[_.jsxs("button",{onClick:Ps,className:"p-2 rounded bg-green-100 text-green-600 hover:bg-green-200 transition-colors flex items-center gap-2 justify-center",children:[_.jsx(D4,{}),_.jsx("span",{className:"text-sm",children:"Save"})]}),_.jsxs("button",{onClick:oa,className:"p-2 rounded bg-blue-100 text-blue-600 hover:bg-blue-200 transition-colors flex items-center gap-2 justify-center",children:[_.jsx(xI,{}),_.jsx("span",{className:"text-sm",children:"Export"})]}),_.jsxs("button",{onClick:as,className:"p-2 rounded bg-purple-100 text-purple-600 hover:bg-purple-200 transition-colors flex items-center gap-2 justify-center",children:[_.jsx(EI,{}),_.jsx("span",{className:"text-sm",children:"Share"})]}),_.jsxs("button",{onClick:()=>Ui(!Pi),className:"p-2 rounded bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors flex items-center gap-2 justify-center",children:[_.jsx(Ly,{}),_.jsx("span",{className:"text-sm",children:"Settings"})]})]})]}),_i&&_.jsxs("div",{className:"bg-white rounded-xl shadow p-4",children:[_.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[_.jsx(d1,{className:"text-orange-600"})," Route Statistics"]}),_.jsxs("div",{className:"space-y-2 text-sm",children:[_.jsxs("div",{className:"flex justify-between",children:[_.jsx("span",{children:"Distance:"}),_.jsxs("span",{className:"font-medium",children:[_i.distance," km"]})]}),_.jsxs("div",{className:"flex justify-between",children:[_.jsx("span",{children:"Duration:"}),_.jsxs("span",{className:"font-medium",children:[_i.duration," min"]})]}),_i.fuelCost>0&&_.jsxs("div",{className:"flex justify-between",children:[_.jsx("span",{children:"Fuel Cost:"}),_.jsxs("span",{className:"font-medium",children:["",_i.fuelCost]})]}),_i.co2Emission>0&&_.jsxs("div",{className:"flex justify-between",children:[_.jsx("span",{children:"CO Emission:"}),_.jsxs("span",{className:"font-medium",children:[_i.co2Emission,"g"]})]})]})]})]}),_.jsxs("div",{className:"lg:col-span-2",children:[_.jsx("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:_.jsx("div",{className:"h-64 sm:h-80 lg:h-96 flex items-center justify-center text-gray-500",children:_.jsxs("div",{className:"text-center",children:[_.jsx(r0,{className:"text-4xl mb-2 mx-auto"}),_.jsx("p",{children:"Tip: Set VITE_MAPBOX_ACCESS_TOKEN to enable interactive map and directions."})]})})}),_.jsxs("div",{className:"mt-4 bg-white rounded-xl shadow p-4",children:[_.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[_.jsx(Ly,{className:"text-gray-600"})," Map Controls"]}),_.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:[Object.entries(Er).map(([Dt,Ti])=>_.jsx("button",{onClick:()=>La(Dt),className:`p-2 rounded text-sm capitalize ${ye===Dt?"bg-blue-100 text-blue-700 border-2 border-blue-300":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:Dt.replace(/([A-Z])/g," $1").trim()},Dt)),_.jsx("button",{onClick:fs,className:`p-2 rounded text-sm ${Le?"bg-red-100 text-red-700 border-2 border-red-300":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Traffic"})]})]})]})]}),I.length>0&&_.jsxs("div",{className:"mt-6 bg-white rounded-xl shadow p-5",children:[_.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[_.jsx(I1,{className:"text-blue-600"})," Visit Itinerary"]}),_.jsx("ol",{className:"space-y-3",children:I.map((Dt,Ti)=>_.jsxs("li",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[_.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm ${Ti===0?"bg-green-500":Ti===I.length-1?"bg-red-500":"bg-blue-500"}`,children:Ti+1}),_.jsxs("div",{className:"flex-1",children:[_.jsx("div",{className:"font-medium text-gray-900",children:Dt.addr}),_.jsxs("div",{className:"text-sm text-gray-500",children:["ETA: ",Dt.eta.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]},Ti))}),_.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:_.jsxs("p",{className:"text-sm text-blue-800",children:[_.jsx("strong",{children:"Route optimized using Mapbox Directions API"})," - Real-time routing with traffic considerations."]})})]}),Ai.length>0&&_.jsxs("div",{className:"mt-6 bg-white rounded-xl shadow p-5",children:[_.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[_.jsx(r0,{className:"text-gray-600"})," Alternative Routes"]}),_.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:Ai.map((Dt,Ti)=>_.jsxs("div",{className:"p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",children:[_.jsxs("div",{className:"flex justify-between items-center mb-2",children:[_.jsxs("span",{className:"font-medium",children:["Route ",Ti+2]}),_.jsxs("span",{className:"text-sm text-gray-500",children:[Math.round(Dt.duration/60)," min"]})]}),_.jsxs("div",{className:"text-sm text-gray-600",children:[(Dt.distance/1e3).toFixed(2)," km"]})]},Ti))})]}),Fi.length>0&&_.jsxs("div",{className:"mt-6 bg-white rounded-xl shadow p-5",children:[_.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[_.jsx(j4,{className:"text-green-600"})," Recent Routes"]}),_.jsx("div",{className:"space-y-2",children:Fi.slice(0,5).map(Dt=>_.jsx("div",{className:"p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",children:_.jsxs("div",{className:"flex justify-between items-center",children:[_.jsxs("div",{children:[_.jsx("div",{className:"font-medium text-sm",children:Dt.stops.map(Ti=>Ti.address.split(",")[0]).join("  ")}),_.jsx("div",{className:"text-xs text-gray-500",children:Dt.timestamp.toLocaleString()})]}),_.jsx("button",{onClick:()=>Vs(Dt),className:"px-3 py-1 bg-blue-100 text-blue-600 rounded text-sm hover:bg-blue-200",children:"Load"})]})},Dt.id))})]}),Pi&&_.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:_.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:_.jsxs("div",{className:"p-6",children:[_.jsxs("div",{className:"flex items-center justify-between mb-6",children:[_.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[_.jsx(Ly,{className:"text-blue-600"}),"Route Planner Settings"]}),_.jsx("button",{onClick:()=>Ui(!1),className:"p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors",children:""})]}),_.jsxs("div",{className:"space-y-6",children:[_.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[_.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[_.jsx(k4,{className:"text-green-600"}),"Map Settings"]}),_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Map Style"}),_.jsx("select",{value:ye,onChange:Dt=>La(Dt.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:Object.keys(Er).map(Dt=>_.jsx("option",{value:Dt,children:Dt.charAt(0).toUpperCase()+Dt.slice(1).replace(/([A-Z])/g," $1")},Dt))})]}),_.jsxs("div",{className:"flex items-center gap-2",children:[_.jsx("input",{type:"checkbox",id:"traffic",checked:Le,onChange:fs,className:"rounded"}),_.jsx("label",{htmlFor:"traffic",className:"text-sm font-medium text-gray-700",children:"Show Traffic"})]})]})]}),_.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[_.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[_.jsx(r0,{className:"text-blue-600"}),"Route Settings"]}),_.jsxs("div",{className:"space-y-3",children:[_.jsxs("div",{className:"flex items-center gap-2",children:[_.jsx("input",{type:"checkbox",id:"optimization",checked:rt,onChange:Dt=>lt(Dt.target.checked),className:"rounded"}),_.jsx("label",{htmlFor:"optimization",className:"text-sm font-medium text-gray-700",children:"Optimize waypoints"})]}),_.jsxs("div",{className:"flex items-center gap-2",children:[_.jsx("input",{type:"checkbox",id:"avoidTolls",checked:zt,onChange:Dt=>xt(Dt.target.checked),className:"rounded"}),_.jsx("label",{htmlFor:"avoidTolls",className:"text-sm font-medium text-gray-700",children:"Avoid tolls"})]}),_.jsxs("div",{className:"flex items-center gap-2",children:[_.jsx("input",{type:"checkbox",id:"avoidHighways",checked:Ci,onChange:Dt=>Zi(Dt.target.checked),className:"rounded"}),_.jsx("label",{htmlFor:"avoidHighways",className:"text-sm font-medium text-gray-700",children:"Avoid highways"})]}),_.jsxs("div",{className:"flex items-center gap-2",children:[_.jsx("input",{type:"checkbox",id:"alternatives",checked:or,onChange:Dt=>er(Dt.target.checked),className:"rounded"}),_.jsx("label",{htmlFor:"alternatives",className:"text-sm font-medium text-gray-700",children:"Show alternative routes"})]})]})]}),_.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[_.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[_.jsx(D4,{className:"text-purple-600"}),"Saved Routes"]}),Jt.length>0?_.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:Jt.map(Dt=>_.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[_.jsxs("div",{className:"flex-1",children:[_.jsx("div",{className:"font-medium text-sm",children:Dt.name}),_.jsx("div",{className:"text-xs text-gray-500",children:new Date(Dt.timestamp).toLocaleDateString()})]}),_.jsx("button",{onClick:()=>{Vs(Dt),Ui(!1)},className:"px-3 py-1 bg-blue-100 text-blue-600 rounded text-sm hover:bg-blue-200",children:"Load"})]},Dt.id))}):_.jsx("p",{className:"text-gray-500 text-sm",children:"No saved routes yet"})]}),_.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[_.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[_.jsx(j4,{className:"text-orange-600"}),"Recent Routes"]}),Fi.length>0?_.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:Fi.slice(0,5).map(Dt=>_.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[_.jsxs("div",{className:"flex-1",children:[_.jsx("div",{className:"font-medium text-sm",children:Dt.stops.map(Ti=>Ti.address.split(",")[0]).join("  ")}),_.jsx("div",{className:"text-xs text-gray-500",children:Dt.timestamp.toLocaleString()})]}),_.jsx("button",{onClick:()=>{Vs(Dt),Ui(!1)},className:"px-3 py-1 bg-green-100 text-green-600 rounded text-sm hover:bg-green-200",children:"Load"})]},Dt.id))}):_.jsx("p",{className:"text-gray-500 text-sm",children:"No recent routes"})]})]}),_.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t",children:[_.jsx("button",{onClick:()=>Ui(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Close"}),_.jsx("button",{onClick:()=>{xe("streets"),Ae(!1),lt(!0),xt(!1),Zi(!1),er(!1),ei.success("Settings reset to defaults")},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Reset to Defaults"})]})]})})})]})}const fO=Object.freeze(Object.defineProperty({__proto__:null,default:x5},Symbol.toStringTag,{value:"Module"}));function pO(){return bc("Route Planner Admin - Navigation Management"),_.jsx(x5,{})}const tT=ue.lazy(()=>Xr(()=>import("./PublicHome-BSVll3I_.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),iT=ue.lazy(()=>Xr(()=>import("./Home-Dlds2LZ0.js"),__vite__mapDeps([8,1,2,3,4,5,6,7]))),mO=ue.lazy(()=>Xr(()=>import("./PublicAbout-CwFuHxhw.js"),[])),gO=ue.lazy(()=>Xr(()=>import("./About-BWRRpYT5.js"),[])),_O=ue.lazy(()=>Xr(()=>import("./PublicSearch-DeoLB7vi.js"),__vite__mapDeps([9,4,5,10]))),yO=ue.lazy(()=>Xr(()=>import("./Search-CGpDTPjj.js"),__vite__mapDeps([11,4,5,6,7,12,10]))),xO=ue.lazy(()=>Xr(()=>import("./Profile-Cx9yZKDR.js"),__vite__mapDeps([13,14]))),vO=ue.lazy(()=>Xr(()=>import("./SignIn-DfNK_Shr.js"),__vite__mapDeps([15,16,14]))),bO=ue.lazy(()=>Xr(()=>import("./SignUp-C3aFWjQL.js"),__vite__mapDeps([17,16,14]))),wO=ue.lazy(()=>Xr(()=>import("./ForgotPassword-CNAVT50Y.js"),__vite__mapDeps([18,14]))),TO=ue.lazy(()=>Xr(()=>import("./CreateListing-C6ekv3EE.js"),__vite__mapDeps([19,12,10]))),SO=ue.lazy(()=>Xr(()=>import("./EditListing-DIII9DnG.js"),__vite__mapDeps([20,12,10]))),e2=ue.lazy(()=>Xr(()=>import("./Listing-CZlp6twd.js"),__vite__mapDeps([21,1,22,23,5,24]))),EO=ue.lazy(()=>Xr(()=>import("./WishList-B9U2CWV4.js"),__vite__mapDeps([25,4,5]))),AO=ue.lazy(()=>Xr(()=>import("./Watchlist-DXpgbvly.js"),__vite__mapDeps([26,4,5]))),CO=ue.lazy(()=>Xr(()=>import("./Appointment-CD8-uE6i.js"),__vite__mapDeps([27,28]))),RO=ue.lazy(()=>Xr(()=>import("./AdminAppointments-ClhA58DQ.js"),__vite__mapDeps([29,7,23,30]))),MO=ue.lazy(()=>Xr(()=>import("./AdminDashboard-Cn8r-foN.js"),__vite__mapDeps([31,4,5,6,7]))),IO=ue.lazy(()=>Xr(()=>import("./MyAppointments-B3-6j_KC.js"),__vite__mapDeps([32,7,23,30,28]))),zO=ue.lazy(()=>Xr(()=>import("./MyListings-BVGbK4IV.js"),__vite__mapDeps([33,5]))),LO=ue.lazy(()=>Xr(()=>import("./AdminAbout-CPUGsRMG.js"),[])),DO=ue.lazy(()=>Xr(()=>import("./AdminExplore-DJzP5osE.js"),__vite__mapDeps([34,4,5,6,7,12,10]))),PO=ue.lazy(()=>Xr(()=>import("./AdminCreateListing-C4PY3bR4.js"),__vite__mapDeps([35,12,10]))),OO=ue.lazy(()=>Xr(()=>import("./AdminProfile-BFPK-9Tu.js"),__vite__mapDeps([36,13,14]))),jO=ue.lazy(()=>Xr(()=>import("./AdminDeploymentManagement-DQxzl9Vl.js"),[])),NO=ue.lazy(()=>Xr(()=>import("./AdminRequests-DKO2lkZ7.js"),[])),kO=ue.lazy(()=>Xr(()=>import("./AdminListings-8x9w4pP0.js"),__vite__mapDeps([37,5]))),BO=ue.lazy(()=>Xr(()=>import("./AdminMyListings-SPM7Ju_1.js"),__vite__mapDeps([38,5]))),FO=ue.lazy(()=>Xr(()=>import("./AdminEditListing-B8FTB3dQ.js"),__vite__mapDeps([39,12,10]))),UO=ue.lazy(()=>Xr(()=>import("./Oauth-B1YZJ89D.js"),[])),VO=ue.lazy(()=>Xr(()=>import("./AdminAppointmentListing-8cXshxQ9.js"),[])),HO=ue.lazy(()=>Xr(()=>import("./AdminReviews-BzFb-lhd.js"),[])),qO=ue.lazy(()=>Xr(()=>import("./AdminServices-j9ryRUgg.js"),[])),GO=ue.lazy(()=>Xr(()=>import("./OnDemandServices-DbmvsSp-.js"),[])),$O=ue.lazy(()=>Xr(()=>Promise.resolve().then(()=>fO),void 0)),ZO=ue.lazy(()=>Xr(()=>import("./UserReviews-NfKzOUja.js"),__vite__mapDeps([40,22]))),WO=ue.lazy(()=>Xr(()=>import("./AdminFraudManagement-CLtOPAep.js"),[])),XO=ue.lazy(()=>Xr(()=>import("./PaymentDashboard-Drfhd7VP.js"),[])),YO=ue.lazy(()=>Xr(()=>import("./AdminSecurityModeration-D2ssKqtS.js"),[])),KO=ue.lazy(()=>Xr(()=>import("./MyPayments-BWpxUeWd.js"),[])),rT=ue.lazy(()=>Xr(()=>import("./DeviceManagement-4XH4CYEb.js"),[])),JO=ue.lazy(()=>Xr(()=>import("./SessionManagement-BncVJYeB.js"),[])),QO=ue.lazy(()=>Xr(()=>import("./SessionAuditLogs-SfxwoEhl.js"),[])),ej=ue.lazy(()=>Xr(()=>import("./Contact-BkxpstF9.js"),__vite__mapDeps([41,0,1,2,3,4,5,6,7]))),tj=ue.lazy(()=>Xr(()=>import("./UserContact-CnIt2Brx.js"),__vite__mapDeps([42,8,1,2,3,4,5,6,7]))),ij=ue.lazy(()=>Xr(()=>import("./AdminSupport-BFgaQ4bp.js"),__vite__mapDeps([43,31,4,5,6,7]))),rj=ue.lazy(()=>Xr(()=>import("./PublicAI-DF_mXxWX.js"),__vite__mapDeps([44,6,7,0,1,2,3,4,5]))),nj=ue.lazy(()=>Xr(()=>import("./UserAI-gR0iv3YO.js"),__vite__mapDeps([45,6,7,8,1,2,3,4,5]))),sj=ue.lazy(()=>Xr(()=>import("./AdminAI-CccWcDQ-.js"),__vite__mapDeps([46,6,7,31,4,5]))),nT=()=>_.jsxs("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-100 via-purple-100 to-pink-100 animate-fade-in",children:[_.jsxs("div",{className:"relative flex flex-col items-center",children:[_.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-tr from-blue-500 via-purple-500 to-pink-500 animate-spin-slow shadow-2xl border-8 border-white/40 flex items-center justify-center",children:_.jsx(Fg,{className:"text-5xl text-yellow-400 drop-shadow-lg animate-bounce-slow",style:{filter:"drop-shadow(0 2px 8px #facc15)"}})}),_.jsxs("span",{className:"mt-8 text-3xl font-extrabold bg-gradient-to-r from-yellow-400 via-pink-500 to-purple-600 bg-clip-text text-transparent animate-gradient-x drop-shadow",children:["Urban ",_.jsx("span",{className:"bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 bg-clip-text text-transparent",children:"Setu"})]}),_.jsx("span",{className:"mt-2 text-xl font-bold text-purple-700 drop-shadow animate-fade-in-up",children:"Loading..."})]}),_.jsx("style",{children:`
      @keyframes spin-slow { 100% { transform: rotate(360deg); } }
      .animate-spin-slow { animation: spin-slow 2s linear infinite; }
      @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
      .animate-fade-in { animation: fade-in 0.7s ease; }
      @keyframes fade-in-up { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
      .animate-fade-in-up { animation: fade-in-up 0.8s ease; }
      @keyframes gradient-x { 0%,100%{background-position:0 50%}50%{background-position:100% 50%} }
      .animate-gradient-x { background-size: 200% 200%; animation: gradient-x 3s ease-in-out infinite; }
      @keyframes bounce-slow { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }
      .animate-bounce-slow { animation: bounce-slow 2s infinite; }
    `})]}),Jy="https://urbansetu.onrender.com";function aj(h,g){h.length>1&&h.endsWith("/")&&(h=h.slice(0,-1));const b=["about","search","terms","privacy","listing","home","reviews","wishlist","profile","appointment","explore","contact","ai"];function S(s){const q=s.match(/^\/(user|admin)?\/?([^\/]+)?(\/.*)?$/);return{prefix:q&&q[1]?q[1]:null,base:q&&q[2]?q[2]:null,rest:q&&q[3]?q[3]:""}}const{prefix:I,base:N,rest:V}=S(h);return g==="public"?(I==="user"||I==="admin")&&b.includes(N)?`/${N}${V}`:I==="user"&&!b.includes(N)||I==="admin"&&!b.includes(N)?null:h:g==="user"?!h.startsWith("/user")&&b.includes(N)?`/user/${N}${V}`:I==="admin"?b.includes(N)?`/user/${N}${V}`:null:h:g==="admin"?!h.startsWith("/admin")&&b.includes(N)?`/admin/${N}${V}`:I==="user"?b.includes(N)?`/admin/${N}${V}`:null:h:h}function oj({children:h}){const g=ko(),{currentUser:b}=yo(N=>N.user),S=b?b.role==="admin"||b.role==="rootadmin"?"admin":"user":"public",I=ue.useMemo(()=>aj(g.pathname,S),[g.pathname,S]);return I===null?_.jsx(sf,{}):I!==g.pathname?_.jsx(Il,{to:I,replace:!0}):h}function lj({bootstrapped:h}){const g=ko(),b=bp(),{currentUser:S,loading:I}=yo(de=>de.user),[N,V]=ue.useState(!1),s=Pl(),{playNotification:q}=EP();ue.useEffect(()=>{let le=null,Se=null,ee=null;const _e=()=>{ee&&clearTimeout(ee),ee=setTimeout(()=>{window.location.reload()},6e5)},ye=()=>{if(document.hidden)le=Date.now(),_e();else{if(le&&(Date.now()-le)/6e4>=10){const Ke=sessionStorage.getItem("has_visited")==="1";sessionStorage.setItem("has_visited","1"),Ke&&window.location.reload()}ee&&clearTimeout(ee)}},xe=()=>{if(Se&&(Date.now()-Se)/6e4>=10){const Ke=sessionStorage.getItem("has_visited")==="1";sessionStorage.setItem("has_visited","1"),Ke&&window.location.reload()}ee&&clearTimeout(ee)},Le=()=>{Se=Date.now(),_e()};return document.addEventListener("visibilitychange",ye),window.addEventListener("focus",xe),window.addEventListener("blur",Le),sessionStorage.getItem("has_visited")||sessionStorage.setItem("has_visited","1"),_e(),()=>{document.removeEventListener("visibilitychange",ye),window.removeEventListener("focus",xe),window.removeEventListener("blur",Le),ee&&clearTimeout(ee)}},[]),ue.useEffect(()=>{h&&(async()=>{b(aM());try{const ze=await fetch(`${Jy}/api/auth/verify`,{method:"GET",credentials:"include"}),le=await ze.json();ze.ok?b(oM(le)):(b(S4(le.message||"Session invalid")),b(io()))}catch{b(S4("Network error")),b(io())}finally{V(!0)}})()},[h,b]),ue.useEffect(()=>{if(!S)return;const de=ee=>{ee.userId===S._id&&(b(io()),ei.error("Your account has been suspended. You have been signed out."),setTimeout(()=>{s("/sign-in")},1800))};pr.on("account_suspended",de);const ze=ee=>{ee.userId===S._id&&(b(io()),ei.error(ee.message||"You have been signed out."),setTimeout(()=>{s("/sign-in")},1800))};pr.on("force_signout",ze);const le=ee=>{var _e;(ee.userId===S._id||((_e=ee.user)==null?void 0:_e._id)===S._id)&&(ee.type==="update"?b(updateUserSuccess(ee.user)):ee.type==="delete"?(b(io()),ei.error("Your account has been deleted. You have been signed out."),setTimeout(()=>{s("/sign-in")},1800)):ee.type==="add"&&b(updateUserSuccess(ee.user)))},Se=ee=>{var _e;(ee.adminId===S._id||((_e=ee.admin)==null?void 0:_e._id)===S._id)&&(ee.type==="update"?b(updateUserSuccess(ee.admin)):ee.type==="delete"?(b(io()),ei.error("Your admin account has been deleted. You have been signed out."),setTimeout(()=>{s("/sign-in")},1800)):ee.type==="add"&&b(updateUserSuccess(ee.admin)))};return pr.on("user_update",le),pr.on("admin_update",Se),()=>{pr.off("account_suspended",de),pr.off("force_signout",ze),pr.off("user_update",le),pr.off("admin_update",Se)}},[b,s,S]);const[Z,Q]=ue.useState(null);if(ue.useEffect(()=>{const de=le=>{Q(le.detail.appointmentId)},ze=()=>{Q(null)};return window.addEventListener("chatOpened",de),window.addEventListener("chatClosed",ze),()=>{window.removeEventListener("chatOpened",de),window.removeEventListener("chatClosed",ze)}},[]),ue.useEffect(()=>{if(!S||S.role==="admin"||S.role==="rootadmin")return;const de=async ze=>{if(ze.comment&&ze.comment.senderEmail!==S.email){const le=window.location.pathname,Se=le.includes("/my-appointments")||le.includes("/user/my-appointments");if(Z===ze.appointmentId)return;const _e=Array.isArray(ze.comment.reactions)&&ze.comment.reactions.length>0,ye=!!ze.messageId;if(_e||ye)return;let xe=ze.comment.senderEmail||"User";if(ze.comment.senderEmail!==ze.buyerEmail&&ze.comment.senderEmail!==ze.sellerEmail)xe="UrbanSetu";else try{const Ae=await fetch(`${Jy}/api/user/check-email/${encodeURIComponent(ze.comment.senderEmail)}`,{credentials:"include"});Ae.ok&&(xe=(await Ae.json()).username||ze.comment.senderEmail)}catch{xe=ze.comment.senderEmail}try{q()}catch{}Se?ei.info(`New message from ${xe}`,{onClick:()=>{window.dispatchEvent(new CustomEvent("openChatFromNotification",{detail:{appointmentId:ze.appointmentId,fromNotification:!0,preferUnread:!0}}))},autoClose:5e3,closeOnClick:!0,pauseOnHover:!1}):ei.info(`New message from ${xe}`,{onClick:()=>{s("/user/my-appointments",{state:{openChatForAppointment:ze.appointmentId,fromNotification:!0}})},autoClose:5e3,closeOnClick:!0,pauseOnHover:!1})}};return pr.on("commentUpdate",de),()=>{pr.off("commentUpdate",de)}},[b,s,S,q,Z]),ue.useEffect(()=>{if(!S)return;const de=setInterval(async()=>{try{const ze=await fetch(`${Jy}/api/auth/verify`,{credentials:"include"});if(ze.status===401)b(io()),s("/sign-in");else if(ze.status===403)try{const le=await ze.clone().json();le.message&&le.message.toLowerCase().includes("suspended")&&(b(io()),ei.error(le.message||"Your account has been suspended. You have been signed out."),s("/sign-in"))}catch{}}catch{}},3e4);return()=>clearInterval(de)},[b,s,S]),!h||!N)return _.jsx(nT,{});const oe=["/appointments"];return _.jsxs(_.Fragment,{children:[_.jsx(dP,{}),!oe.includes(g.pathname)&&(S&&(S.role==="admin"||S.role==="rootadmin")?_.jsx(Zz,{}):_.jsx($z,{})),_.jsx(ue.Suspense,{fallback:_.jsx(nT,{}),children:_.jsx(oj,{children:_.jsxs(p8,{children:[_.jsx(Xi,{path:"/",element:S?_.jsx(sf,{}):_.jsx(tT,{bootstrapped:h,sessionChecked:N})}),_.jsx(Xi,{path:"/home",element:S?_.jsx(sf,{}):_.jsx(tT,{bootstrapped:h,sessionChecked:N})}),_.jsx(Xi,{path:"/about",element:S?_.jsx(Il,{to:"/user/about"}):_.jsx(mO,{bootstrapped:h,sessionChecked:N})}),_.jsx(Xi,{path:"/search",element:S?_.jsx(Il,{to:"/user/search"}):_.jsx(_O,{bootstrapped:h,sessionChecked:N})}),_.jsx(Xi,{path:"/listing/:listingId",element:S?_.jsx(sf,{}):_.jsx(e2,{})}),_.jsx(Xi,{path:"/sign-in",element:_.jsx(vO,{bootstrapped:h,sessionChecked:N})}),_.jsx(Xi,{path:"/sign-up",element:_.jsx(bO,{bootstrapped:h,sessionChecked:N})}),_.jsx(Xi,{path:"/forgot-password",element:_.jsx(wO,{bootstrapped:h,sessionChecked:N})}),_.jsx(Xi,{path:"/oauth",element:_.jsx(UO,{bootstrapped:h,sessionChecked:N})}),_.jsx(Xi,{path:"/terms",element:S?_.jsx(sf,{}):_.jsx(_P,{bootstrapped:h,sessionChecked:N})}),_.jsx(Xi,{path:"/privacy",element:S?_.jsx(sf,{}):_.jsx(yP,{bootstrapped:h,sessionChecked:N})}),_.jsx(Xi,{path:"/contact",element:S?_.jsx(Il,{to:"/user/contact"}):_.jsx(ej,{})}),_.jsx(Xi,{path:"/ai",element:S?_.jsx(Il,{to:"/user/ai"}):_.jsx(rj,{})}),_.jsx(Xi,{path:"/restore-account/:token",element:_.jsx(gP,{})}),_.jsxs(Xi,{element:_.jsx(Xz,{bootstrapped:h}),children:[_.jsx(Xi,{path:"/user",element:_.jsx(iT,{})}),_.jsx(Xi,{path:"/user/home",element:_.jsx(iT,{})}),_.jsx(Xi,{path:"/user/about",element:_.jsx(gO,{})}),_.jsx(Xi,{path:"/user/search",element:_.jsx(yO,{})}),_.jsx(Xi,{path:"/user/profile",element:_.jsx(xO,{})}),_.jsx(Xi,{path:"/user/create-listing",element:_.jsx(TO,{})}),_.jsx(Xi,{path:"/user/update-listing/:listingId",element:_.jsx(SO,{})}),_.jsx(Xi,{path:"/user/listing/:listingId",element:_.jsx(e2,{},g.pathname)}),_.jsx(Xi,{path:"/user/wishlist",element:_.jsx(EO,{})}),_.jsx(Xi,{path:"/user/watchlist",element:_.jsx(AO,{})}),_.jsx(Xi,{path:"/user/appointment",element:_.jsx(CO,{})}),_.jsx(Xi,{path:"/user/my-appointments",element:_.jsx(IO,{})}),_.jsx(Xi,{path:"/user/my-payments",element:_.jsx(KO,{})}),_.jsx(Xi,{path:"/user/my-listings",element:_.jsx(zO,{})}),_.jsx(Xi,{path:"/user/services",element:_.jsx(GO,{})}),_.jsx(Xi,{path:"/user/route-planner",element:_.jsx($O,{})}),_.jsx(Xi,{path:"/user/change-password",element:_.jsx(pP,{})}),_.jsx(Xi,{path:"/user/terms",element:_.jsx(xP,{})}),_.jsx(Xi,{path:"/user/privacy",element:_.jsx(bP,{})}),_.jsx(Xi,{path:"/user/reviews",element:_.jsx(ZO,{})}),_.jsx(Xi,{path:"/user/device-management",element:_.jsx(rT,{})}),_.jsx(Xi,{path:"/user/contact",element:_.jsx(tj,{})}),_.jsx(Xi,{path:"/user/ai",element:_.jsx(nj,{})}),_.jsx(Xi,{path:"/contact",element:_.jsx(Il,{to:"/user/contact"})}),_.jsx(Xi,{path:"/admin/contact",element:_.jsx(Il,{to:"/user/contact"})}),_.jsx(Xi,{path:"/ai",element:_.jsx(Il,{to:"/user/ai"})})]}),_.jsxs(Xi,{element:_.jsx(Yz,{bootstrapped:h}),children:[_.jsx(Xi,{path:"/admin",element:_.jsx(MO,{})}),_.jsx(Xi,{path:"/admin/appointments",element:_.jsx(RO,{})}),_.jsx(Xi,{path:"/admin/about",element:_.jsx(LO,{})}),_.jsx(Xi,{path:"/admin/explore",element:_.jsx(DO,{})}),_.jsx(Xi,{path:"/admin/create-listing",element:_.jsx(PO,{})}),_.jsx(Xi,{path:"/admin/listings",element:_.jsx(kO,{})}),_.jsx(Xi,{path:"/admin/my-listings",element:_.jsx(BO,{})}),_.jsx(Xi,{path:"/admin/update-listing/:listingId",element:_.jsx(FO,{})}),_.jsx(Xi,{path:"/admin/profile",element:_.jsx(OO,{})}),_.jsx(Xi,{path:"/admin/deployment-management",element:_.jsx(jO,{})}),_.jsx(Xi,{path:"/admin/change-password",element:_.jsx(mP,{})}),_.jsx(Xi,{path:"/admin/requests",element:_.jsx(NO,{})}),_.jsx(Xi,{path:"/admin/listing/:listingId",element:_.jsx(e2,{},g.pathname)}),_.jsx(Xi,{path:"/admin/appointmentlisting",element:_.jsx(VO,{})}),_.jsx(Xi,{path:"/admin/terms",element:_.jsx(vP,{})}),_.jsx(Xi,{path:"/admin/privacy",element:_.jsx(wP,{})}),_.jsx(Xi,{path:"/admin/management",element:_.jsx(TP,{})}),_.jsx(Xi,{path:"/admin/reviews",element:_.jsx(HO,{})}),_.jsx(Xi,{path:"/admin/services",element:_.jsx(qO,{})}),_.jsx(Xi,{path:"/admin/route-planner",element:_.jsx(pO,{})}),_.jsx(Xi,{path:"/admin/fraudmanagement",element:_.jsx(WO,{})}),_.jsx(Xi,{path:"/admin/payments",element:_.jsx(XO,{})}),_.jsx(Xi,{path:"/admin/security-moderation",element:_.jsx(YO,{})}),_.jsx(Xi,{path:"/admin/device-management",element:_.jsx(rT,{})}),_.jsx(Xi,{path:"/admin/session-management",element:_.jsx(JO,{})}),_.jsx(Xi,{path:"/admin/session-audit-logs",element:_.jsx(QO,{})}),_.jsx(Xi,{path:"/admin/support",element:_.jsx(ij,{})}),_.jsx(Xi,{path:"/admin/ai",element:_.jsx(sj,{})}),_.jsx(Xi,{path:"/contact",element:_.jsx(Il,{to:"/admin/support"})}),_.jsx(Xi,{path:"/support",element:_.jsx(Il,{to:"/admin/support"})}),_.jsx(Xi,{path:"/user/contact",element:_.jsx(Il,{to:"/admin/support"})}),_.jsx(Xi,{path:"/user/support",element:_.jsx(Il,{to:"/admin/support"})}),_.jsx(Xi,{path:"/ai",element:_.jsx(Il,{to:"/admin/ai"})}),_.jsx(Xi,{path:"/user/ai",element:_.jsx(Il,{to:"/admin/ai"})})]}),_.jsx(Xi,{path:"*",element:_.jsx(sf,{})})]})})}),_.jsx(lz,{position:"top-center",autoClose:2e3,hideProgressBar:!1,newestOnTop:!0,closeOnClick:!0,pauseOnFocusLoss:!1,draggable:!1,pauseOnHover:!1,rtl:!1,theme:"light",limit:3})]})}function cj(){const h=bp(),[g,b]=ue.useState(!1);return ue.useEffect(()=>{(async()=>{try{(await(await fetch(`${Jy}/api/auth/verify`)).json()).success===!1&&h(io())}catch(I){console.error("Auth check failed:",I),h(io())}finally{b(!0)}})()},[h]),_.jsx(Kz,{children:_.jsx(lP,{children:_.jsx(N8,{children:_.jsx(lj,{bootstrapped:g})})})})}function Qy(h){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Qy=function(b){return typeof b}:Qy=function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},Qy(h)}function uj(h,g){if(!(h instanceof g))throw new TypeError("Cannot call a class as a function")}function hj(h,g){for(var b=0;b<g.length;b++){var S=g[b];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(h,S.key,S)}}function dj(h,g,b){return g&&hj(h.prototype,g),h}function fj(h,g){return g&&(Qy(g)==="object"||typeof g=="function")?g:e1(h)}function D2(h){return D2=Object.setPrototypeOf?Object.getPrototypeOf:function(b){return b.__proto__||Object.getPrototypeOf(b)},D2(h)}function e1(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function pj(h,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(g&&g.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),g&&P2(h,g)}function P2(h,g){return P2=Object.setPrototypeOf||function(S,I){return S.__proto__=I,S},P2(h,g)}function t1(h,g,b){return g in h?Object.defineProperty(h,g,{value:b,enumerable:!0,configurable:!0,writable:!0}):h[g]=b,h}var v5=function(h){pj(g,h);function g(){var b,S;uj(this,g);for(var I=arguments.length,N=new Array(I),V=0;V<I;V++)N[V]=arguments[V];return S=fj(this,(b=D2(g)).call.apply(b,[this].concat(N))),t1(e1(S),"state",{bootstrapped:!1}),t1(e1(S),"_unsubscribe",void 0),t1(e1(S),"handlePersistorState",function(){var s=S.props.persistor,q=s.getState(),Z=q.bootstrapped;Z&&(S.props.onBeforeLift?Promise.resolve(S.props.onBeforeLift()).finally(function(){return S.setState({bootstrapped:!0})}):S.setState({bootstrapped:!0}),S._unsubscribe&&S._unsubscribe())}),S}return dj(g,[{key:"componentDidMount",value:function(){this._unsubscribe=this.props.persistor.subscribe(this.handlePersistorState),this.handlePersistorState()}},{key:"componentWillUnmount",value:function(){this._unsubscribe&&this._unsubscribe()}},{key:"render",value:function(){return typeof this.props.children=="function"?this.props.children(this.state.bootstrapped):this.state.bootstrapped?this.props.children:this.props.loading}}]),g}(ue.PureComponent);t1(v5,"defaultProps",{children:null,loading:null});xC.createRoot(document.getElementById("root")).render(_.jsx(oR,{store:MS,children:_.jsx(v5,{loading:null,persistor:Ug,children:h=>_.jsx(cj,{bootstrapped:h})})}));export{WN as $,vj as A,sI as B,l5 as C,bj as D,Dm as E,vN as F,qy as G,O4 as H,d5 as I,u5 as J,h5 as K,Fs as L,_1 as M,ub as N,sf as O,QC as P,pr as Q,Sm as R,su as S,nk as T,p1 as U,F4 as V,DN as W,fS as X,L4 as Y,_o as Z,YN as _,Yj as a,gI as a$,XN as a0,Wn as a1,MN as a2,eN as a3,PN as a4,_p as a5,Kj as a6,O2 as a7,Mm as a8,y1 as a9,Jj as aA,UN as aB,FN as aC,lN as aD,SI as aE,tk as aF,Rm as aG,hk as aH,wN as aI,HN as aJ,ZN as aK,jN as aL,P4 as aM,ak as aN,QN as aO,dk as aP,D4 as aQ,hS as aR,rb as aS,bI as aT,pI as aU,Ls as aV,lz as aW,AI as aX,Fj as aY,K_ as aZ,zl as a_,HR as aa,ER as ab,yj as ac,l4 as ad,_j as ae,xj as af,Bg as ag,PR as ah,wT as ai,oR as aj,KN as ak,N4 as al,Vj as am,ON as an,Xj as ao,Fg as ap,aN as aq,_k as ar,Uj as as,mN as at,yN as au,EI as av,wI as aw,Gj as ax,qj as ay,zN as az,JN as b,ik as b$,oN as b0,uN as b1,gk as b2,pN as b3,d1 as b4,ek as b5,rN as b6,CN as b7,iN as b8,f1 as b9,zj as bA,_I as bB,pS as bC,r0 as bD,EN as bE,sN as bF,c0 as bG,Tj as bH,Ij as bI,Ej as bJ,C1 as bK,vp as bL,io as bM,Ug as bN,Sj as bO,Cj as bP,ck as bQ,j4 as bR,B4 as bS,Dj as bT,Bj as bU,iI as bV,Hj as bW,xN as bX,kN as bY,bN as bZ,dN as b_,Nk as ba,nN as bb,EP as bc,sk as bd,kk as be,hN as bf,gN as bg,Gt as bh,AN as bi,Xr as bj,TN as bk,_N as bl,Pj as bm,Nj as bn,Oj as bo,kj as bp,jj as bq,jk as br,GN as bs,qN as bt,cN as bu,LN as bv,NN as bw,mk as bx,SN as by,Ly as bz,Py as c,BN as c0,pk as c1,rk as c2,VN as c3,Qj as c4,tN as c5,ok as c6,Zj as c7,$j as c8,fk as c9,Wj as ca,fN as cb,Dy as cc,IN as cd,I1 as ce,lk as cf,cP as cg,uP as ch,gp as ci,$N as d,uk as e,nd as f,fv as g,RN as h,yo as i,_ as j,Lj as k,xI as l,Gz as m,K4 as n,ko as o,Pl as p,Wz as q,ue as r,bp as s,c5 as t,bc as u,jg as v,au as w,wj as x,ei as y,tb as z};
