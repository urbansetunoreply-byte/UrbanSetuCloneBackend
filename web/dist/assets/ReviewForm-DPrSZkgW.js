import{i as A,r as n,p as T,j as e,Z as S,H as L,y as E,b as Y}from"./index-DFkuEFH9.js";const f="https://urbansetu.onrender.com";function O({listingId:h,existingReview:r,onReviewSubmitted:g}){const{currentUser:m}=A(s=>s.user),[o,b]=n.useState((r==null?void 0:r.rating)||0),[c,p]=n.useState((r==null?void 0:r.comment)||""),[j,N]=n.useState(!1),[w,l]=n.useState(""),[t,v]=n.useState(!!r),[k,i]=n.useState(!0),[C,u]=n.useState("");T(),n.useEffect(()=>{U()},[m,h]);const U=async()=>{if(!m){i(!1),u("Please sign in to leave a review");return}try{if(m.role==="admin"||m.role==="rootadmin"){i(!1),u("Admins cannot post reviews. You can only manage reviews.");return}const s=await fetch(`${f}/api/listing/get/${h}`),a=await s.json();if(s.ok&&a.userRef===m._id){i(!1),u("Property owners cannot review their own properties.");return}const x=await fetch(`${f}/api/review/user`,{credentials:"include"});if(x.ok&&(await x.json()).find(_=>_.listingId===h)&&!r){i(!1),u("You have already reviewed this property.");return}i(!0),u("")}catch(s){console.error("Error checking review permissions:",s),i(!0)}},$=async s=>{if(s.preventDefault(),!o||!c.trim()){l("Please provide both rating and comment");return}if(c.trim().length<10){l("Comment must be at least 10 characters long");return}N(!0),l("");try{const a=t?`${f}/api/review/update/${r._id}`:`${f}/api/review/create`,y=await fetch(a,{method:t?"PUT":"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({listingId:h,rating:o,comment:c.trim()})}),d=await y.json();y.ok?(g&&g(),t||(b(0),p("")),v(!1),E.success(d.message||"Review submitted successfully!")):(d.message&&d.message.includes("already reviewed")&&E.error(d.message),l(d.message||"Failed to submit review"))}catch{l("Network error. Please try again.")}finally{N(!1)}},P=()=>{v(!1),b((r==null?void 0:r.rating)||0),p((r==null?void 0:r.comment)||""),l("")},F=()=>[...Array(5)].map((s,a)=>e.jsx(Y,{className:`text-2xl cursor-pointer transition-colors ${a<o?"text-yellow-400":"text-gray-300"} hover:text-yellow-400`,onClick:()=>b(a+1)},a));return k?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t?"Edit Your Review":"Write a Review"}),t&&e.jsx("button",{onClick:P,className:"text-gray-500 hover:text-gray-700",children:e.jsx(S,{})})]}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rating *"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[F(),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:o>0?`${o} star${o>1?"s":""}`:"Select rating"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Comment *"}),e.jsx("textarea",{value:c,onChange:s=>p(s.target.value),rows:"4",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Share your experience with this property...",maxLength:"500"}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Minimum 10 characters required"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[c.length,"/500"]})]})]}),w&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:e.jsx("p",{className:"text-red-800 text-sm",children:w})}),e.jsx("button",{type:"submit",disabled:j||!o||!c.trim(),className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),t?"Updating...":"Submitting..."]}):e.jsxs(e.Fragment,{children:[t?e.jsx(L,{className:"mr-2"}):null,t?"Update Review":"Submit Review"]})})]})]}):e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-center text-gray-600",children:[e.jsx(S,{className:"mr-2 text-red-500"}),e.jsx("span",{className:"font-medium",children:C})]})})}export{O as R};
