import{u as v,r as i,j as t,cd as u,l as p,ak as w,bf as N}from"./index-D5SGkqik.js";const S=()=>{v("My Payments - Payment History");const[o,g]=i.useState([]),[y,x]=i.useState(!0),[a,l]=i.useState({status:"",gateway:"",currency:"",q:"",fromDate:"",toDate:""});i.useEffect(()=>{h()},[a]);const h=async()=>{try{x(!0);const e=new URLSearchParams;a.status&&e.set("status",a.status),a.gateway&&e.set("gateway",a.gateway),a.currency&&e.set("currency",a.currency),a.q&&e.set("q",a.q),a.fromDate&&e.set("fromDate",a.fromDate),a.toDate&&e.set("toDate",a.toDate),e.set("limit","1000");const s=await fetch(`https://urbansetu.onrender.com/api/payments/history?${e.toString()}`,{credentials:"include"}),r=await s.json();s.ok&&g(r.payments||[])}catch{}finally{x(!1)}},f=e=>{!e||e.status==="completed"||(window.location.href="/user/my-appointments")},b=async e=>{if(e)try{const s=await fetch(e,{credentials:"include"});if(!s.ok)return;const r=await s.blob(),d=window.URL.createObjectURL(r),n=document.createElement("a");n.href=d,n.download="receipt.pdf",document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(d)}catch{}},j=e=>{const s=e==="completed"?"bg-green-100 text-green-700":e==="failed"?"bg-red-100 text-red-700":e==="refunded"?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700";return t.jsx("span",{className:`px-2 py-1 text-[10px] rounded-full font-semibold ${s}`,children:e})};return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100 py-6 sm:py-10 px-2 md:px-8",children:t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsx("div",{className:"bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-6 sm:mb-8",children:t.jsx("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:t.jsxs("div",{children:[t.jsxs("h1",{className:"text-3xl font-bold text-gray-800 flex items-center gap-3",children:[t.jsx(u,{className:"text-green-600"}),"My Payments"]}),t.jsx("p",{className:"text-gray-600 mt-2",children:"View and manage your payments and receipts"})]})})}),t.jsxs("div",{className:"bg-gradient-to-br from-white to-blue-50 rounded-xl shadow-lg p-4 sm:p-6 border border-blue-100",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4 flex-wrap",children:[t.jsx("input",{value:a.q,onChange:e=>l(s=>({...s,q:e.target.value})),placeholder:"Search payment ID or receipt",className:"px-3 py-2 border rounded-lg text-sm"}),t.jsx("label",{className:"text-sm text-gray-600",children:"From:"}),t.jsx("input",{type:"date",value:a.fromDate,max:new Date().toISOString().split("T")[0],onChange:e=>l(s=>({...s,fromDate:e.target.value})),className:"px-3 py-2 border rounded-lg text-sm"}),t.jsx("label",{className:"text-sm text-gray-600",children:"To:"}),t.jsx("input",{type:"date",value:a.toDate,max:new Date().toISOString().split("T")[0],onChange:e=>l(s=>({...s,toDate:e.target.value})),className:"px-3 py-2 border rounded-lg text-sm"}),t.jsxs("select",{value:a.status,onChange:e=>l(s=>({...s,status:e.target.value})),className:"px-3 py-2 border rounded-lg text-sm",children:[t.jsx("option",{value:"",children:"All Status"}),t.jsx("option",{value:"completed",children:"Completed"}),t.jsx("option",{value:"pending",children:"Pending"}),t.jsx("option",{value:"failed",children:"Failed"}),t.jsx("option",{value:"refunded",children:"Refunded"}),t.jsx("option",{value:"partially_refunded",children:"Partially Refunded"})]}),t.jsxs("select",{value:a.gateway,onChange:e=>l(s=>({...s,gateway:e.target.value})),className:"px-3 py-2 border rounded-lg text-sm",children:[t.jsx("option",{value:"",children:"All Gateways"}),t.jsx("option",{value:"paypal",children:"PayPal"}),t.jsx("option",{value:"razorpay",children:"Razorpay"})]}),t.jsxs("select",{value:a.currency,onChange:e=>l(s=>({...s,currency:e.target.value})),className:"px-3 py-2 border rounded-lg text-sm",children:[t.jsx("option",{value:"",children:"All Currencies"}),t.jsx("option",{value:"USD",children:"USD ($)"}),t.jsx("option",{value:"INR",children:"INR (₹)"})]}),t.jsxs("button",{onClick:async()=>{try{const e=new URLSearchParams;a.status&&e.set("status",a.status),a.gateway&&e.set("gateway",a.gateway),a.q&&e.set("q",a.q),a.fromDate&&e.set("fromDate",a.fromDate),a.toDate&&e.set("toDate",a.toDate);const s=e.toString(),r=`https://urbansetu.onrender.com/api/payments/export-csv${s?`?${s}`:""}`,d=await fetch(r,{credentials:"include"});if(!d.ok){console.error("Export failed",await d.text());return}const n=await d.blob(),m=window.URL.createObjectURL(n),c=document.createElement("a");c.href=m,c.download="my_payments.csv",document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(m)}catch(e){console.error("Export error",e)}},className:"px-3 py-2 bg-green-100 text-green-700 rounded-lg text-sm flex items-center gap-2",children:[t.jsx(p,{})," Export CSV"]})]}),y?t.jsxs("div",{className:"flex items-center justify-center py-8",children:[t.jsx(w,{className:"animate-spin text-2xl text-blue-600"}),t.jsx("span",{className:"ml-2 text-gray-600",children:"Loading payments..."})]}):((o==null?void 0:o.length)||0)===0?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(u,{className:"text-6xl text-gray-300 mx-auto mb-4"}),t.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No Payments Found"}),t.jsx("p",{className:"text-gray-500",children:"You don't have any payments yet."})]}):t.jsx("div",{className:"space-y-3",children:Array.isArray(o)&&o.map(e=>{var s,r;return t.jsxs("div",{className:`rounded-lg p-4 border ${e.status==="completed"?"border-green-200 bg-gradient-to-r from-green-50 to-emerald-50":e.status==="failed"?"border-red-200 bg-gradient-to-r from-red-50 to-rose-50":e.status==="refunded"||e.status==="partially_refunded"?"border-blue-200 bg-gradient-to-r from-blue-50 to-cyan-50":"border-yellow-200 bg-gradient-to-r from-yellow-50 to-amber-50"} hover:shadow transition`,children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-semibold text-gray-800",children:((s=e.appointmentId)==null?void 0:s.propertyName)||"Property Payment"}),t.jsxs("div",{className:"text-xs text-gray-500 flex flex-wrap items-center gap-2 mt-1",children:[t.jsx("span",{className:"px-2 py-0.5 rounded-full bg-blue-100 text-blue-700",children:(r=e.gateway)==null?void 0:r.toUpperCase()}),t.jsx("span",{className:"px-2 py-0.5 rounded-full bg-purple-100 text-purple-700",children:e.currency||"USD"}),t.jsxs("span",{children:[e.currency==="INR"?"₹":"$",Number(e.amount).toFixed(2)]}),e.refundAmount>0&&t.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-red-100 text-red-700",children:["Refunded: ",e.currency==="INR"?"₹":"$",Number(e.refundAmount).toFixed(2)]})]})]}),t.jsxs("div",{className:"flex flex-col sm:items-end gap-2",children:[t.jsx("div",{className:"text-xs text-gray-500 space-y-1",children:e.completedAt?t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"font-medium",children:["Paid: ",new Date(e.completedAt).toLocaleDateString("en-GB")]}),t.jsx("div",{className:"text-gray-400",children:new Date(e.completedAt).toLocaleTimeString("en-GB")}),t.jsxs("div",{className:"text-gray-300 mt-1",children:["Created: ",new Date(e.createdAt).toLocaleDateString("en-GB")]}),t.jsx("div",{className:"text-gray-300",children:new Date(e.createdAt).toLocaleTimeString("en-GB")}),e.refundedAt&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"text-red-400 mt-1",children:["Refunded: ",new Date(e.refundedAt).toLocaleDateString("en-GB")]}),t.jsx("div",{className:"text-red-300",children:new Date(e.refundedAt).toLocaleTimeString("en-GB")})]})]}):t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"font-medium",children:["Created: ",new Date(e.createdAt).toLocaleDateString("en-GB")]}),t.jsx("div",{className:"text-gray-400",children:new Date(e.createdAt).toLocaleTimeString("en-GB")})]})}),t.jsx("div",{children:j(e.status)})]})]}),t.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Payment ID: ",t.jsx("span",{className:"font-mono",children:e.paymentId})]}),t.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.receiptUrl&&t.jsxs("button",{onClick:()=>b(e.receiptUrl),className:"px-3 py-1 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 text-xs flex items-center gap-1",children:[t.jsx(p,{className:"text-xs"})," Receipt"]}),e.status!=="completed"&&e.status!=="refunded"&&e.status!=="partially_refunded"&&t.jsxs("button",{onClick:()=>f(e),className:"px-3 py-1 bg-green-600 text-white rounded-lg hover:bg-green-700 text-xs flex items-center gap-1",children:[t.jsx(N,{className:"text-xs"})," Pay Now"]})]})]},e._id)})})]})]})})};export{S as default};
