import{u as L,r as i,j as e,by as A,f as q,b_ as E}from"./index-WPqAAPOK.js";function T(){const{currentUser:m}=L(s=>s.user),[o,h]=i.useState([]),[c,g]=i.useState({q:"",status:"all"}),[N,p]=i.useState([]),[d,j]=i.useState({q:"",status:"all"}),[C,v]=i.useState(!0),[_,f]=i.useState(!0),[D,R]=i.useState(!1),x="https://urbansetu.onrender.com",b=async()=>{if(m){v(!0);try{const t=await(await fetch(`${x}/api/requests/services`,{credentials:"include"})).json();h(Array.isArray(t)?t:[])}catch{}v(!1)}},w=async()=>{if(m){f(!0);try{const t=await(await fetch(`${x}/api/requests/movers`,{credentials:"include"})).json();p(Array.isArray(t)?t:[])}catch{}f(!1)}};i.useEffect(()=>{b(),w()},[m==null?void 0:m._id]);const S=i.useMemo(()=>o.filter(s=>{const t=c.q.trim()?(s.requesterName||"").toLowerCase().includes(c.q.toLowerCase())||(s.requesterEmail||"").toLowerCase().includes(c.q.toLowerCase())||(Array.isArray(s.services)?s.services.join(", "):"").toLowerCase().includes(c.q.toLowerCase()):!0,r=c.status==="all"?!0:s.status===c.status;return t&&r}),[o,c]);return e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(A,{className:"text-purple-700"})," Service Requests"]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("button",{onClick:b,className:"px-3 py-1.5 bg-gray-100 rounded hover:bg-gray-200 text-sm",children:"Refresh"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-white rounded shadow p-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Total"}),e.jsx("p",{className:"text-xl font-bold",children:o.length})]}),e.jsxs("div",{className:"bg-white rounded shadow p-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Unread"}),e.jsx("p",{className:"text-xl font-bold text-red-600",children:o.filter(s=>!s.isRead).length})]}),e.jsxs("div",{className:"bg-white rounded shadow p-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Read"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:o.filter(s=>s.isRead).length})]}),e.jsxs("div",{className:"bg-white rounded shadow p-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Today"}),e.jsx("p",{className:"text-xl font-bold",children:o.filter(s=>new Date(s.createdAt).toDateString()===new Date().toDateString()).length})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mb-3",children:[e.jsx("input",{className:"border rounded p-2 text-sm",placeholder:"Search",value:c.q,onChange:s=>g(t=>({...t,q:s.target.value}))}),e.jsx("select",{className:"border rounded p-2 text-sm",value:c.status,onChange:s=>g(t=>({...t,status:s.target.value})),children:["all","pending","in_progress","completed","cancelled"].map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded text-sm",onClick:()=>g({q:"",status:"all"}),children:"Clear"})]}),C?e.jsx("div",{className:"text-gray-600",children:"Loading..."}):e.jsx("div",{className:"bg-white rounded-xl shadow overflow-auto",children:e.jsxs("table",{className:"min-w-[700px] w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3",children:"Requested"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Requester"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Details"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:S.map(s=>{var r;const t=s.requesterEmail;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:new Date(s.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3",children:[s.requesterName," (",s.requesterEmail,")"]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsxs("div",{className:"text-xs text-gray-700",children:["Services: ",(r=s.services)==null?void 0:r.join(", ")]}),e.jsxs("div",{className:"text-xs text-gray-700",children:["Preferred Date: ",s.preferredDate]}),e.jsxs("div",{className:"text-xs text-gray-700",children:["Address: ",s.address]}),s.notes&&e.jsxs("div",{className:"text-xs text-gray-700",children:["Notes: ",s.notes]})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsxs("a",{href:`mailto:${t}`,className:"px-2 py-1 rounded bg-blue-600 text-white text-xs inline-flex items-center gap-1",children:[e.jsx(q,{})," Email"]}),e.jsx("select",{value:s.status,onChange:async a=>{const l=a.target.value;try{h(n=>n.map(u=>u._id===s._id?{...u,status:l}:u)),await fetch(`${x}/api/requests/services/${s._id}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:l})})}catch{h(u=>u.map(y=>y._id===s._id?{...y,status:s.status}:y))}},className:"text-xs border rounded px-2 py-1",children:["pending","in_progress","completed","cancelled"].map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx("button",{onClick:async()=>{if(confirm("Delete this service request?"))try{(await fetch(`${x}/api/requests/services/${s._id}`,{method:"DELETE",credentials:"include"})).ok&&h(l=>l.filter(n=>n._id!==s._id))}catch{}},className:"text-xs px-2 py-1 rounded bg-red-100 text-red-700",children:"Delete"})]})})]},s._id)})})]})}),e.jsxs("div",{className:"mt-10 border-t border-gray-200 pt-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(E,{className:"text-blue-600"})," Movers Requests"]}),e.jsx("button",{onClick:w,className:"px-3 py-1.5 bg-gray-100 rounded hover:bg-gray-200 text-sm",children:"Refresh"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mb-3",children:[e.jsx("input",{className:"border rounded p-2 text-sm",placeholder:"Search",value:d.q,onChange:s=>j(t=>({...t,q:s.target.value}))}),e.jsx("select",{className:"border rounded p-2 text-sm",value:d.status,onChange:s=>j(t=>({...t,status:s.target.value})),children:["all","pending","in_progress","completed","cancelled"].map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded text-sm",onClick:()=>j({q:"",status:"all"}),children:"Clear"})]}),_?e.jsx("div",{className:"text-gray-600",children:"Loading..."}):N.length===0?e.jsx("div",{className:"text-gray-600",children:"No movers requests found."}):e.jsx("div",{className:"bg-white rounded-xl shadow overflow-auto",children:e.jsxs("table",{className:"min-w-[700px] w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3",children:"Requested"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Requester"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Details"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:N.filter(s=>{const t=d.q.trim()?(s.requesterName||"").toLowerCase().includes(d.q.toLowerCase())||(s.requesterEmail||"").toLowerCase().includes(d.q.toLowerCase())||(s.fromAddress||"").toLowerCase().includes(d.q.toLowerCase())||(s.toAddress||"").toLowerCase().includes(d.q.toLowerCase()):!0,r=d.status==="all"?!0:s.status===d.status;return t&&r}).map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:new Date(s.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3",children:[s.requesterName," (",s.requesterEmail,")"]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsxs("div",{className:"text-xs text-gray-700",children:["From: ",s.fromAddress]}),e.jsxs("div",{className:"text-xs text-gray-700",children:["To: ",s.toAddress]}),e.jsxs("div",{className:"text-xs text-gray-700",children:["Date: ",s.moveDate]}),e.jsxs("div",{className:"text-xs text-gray-700",children:["Size: ",s.size]}),s.notes&&e.jsxs("div",{className:"text-xs text-gray-700",children:["Notes: ",s.notes]})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.requesterEmail&&e.jsxs("a",{href:`mailto:${s.requesterEmail}`,className:"px-2 py-1 rounded bg-blue-600 text-white text-xs inline-flex items-center gap-1",children:[e.jsx(q,{})," Email"]}),e.jsx("select",{value:s.status,onChange:async t=>{const r=t.target.value;try{p(a=>a.map(l=>l._id===s._id?{...l,status:r}:l)),await fetch(`${x}/api/requests/movers/${s._id}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:r})})}catch{p(l=>l.map(n=>n._id===s._id?{...n,status:s.status}:n))}},className:"text-xs border rounded px-2 py-1",children:["pending","in_progress","completed","cancelled"].map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("button",{onClick:async()=>{if(confirm("Delete this movers request?"))try{(await fetch(`${x}/api/requests/movers/${s._id}`,{method:"DELETE",credentials:"include"})).ok&&p(r=>r.filter(a=>a._id!==s._id))}catch{}},className:"text-xs px-2 py-1 rounded bg-red-100 text-red-700",children:"Delete"})]})})]},s._id))})]})})]})]})}export{T as default};
