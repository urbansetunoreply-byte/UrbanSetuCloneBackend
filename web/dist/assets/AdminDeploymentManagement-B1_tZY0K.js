import{u as z,r as i,y as r,j as e,ak as F,bF as G,bQ as A,Z as S,G as j,l as U,bR as O,S as R,bS as V,bT as k,bU as W,k as X}from"./index-D5SGkqik.js";const g="https://urbansetu.onrender.com";function K(){z("Deployment Management - App Updates");const[b,D]=i.useState([]),[N,E]=i.useState([]),[P,C]=i.useState(!0),[h,d]=i.useState(!1),[x,c]=i.useState(0),[m,p]=i.useState(null),[n,u]=i.useState({platform:"android",version:"",description:"",isActive:!1});i.useEffect(()=>{f(),y()},[]),i.useEffect(()=>()=>{m&&m.abort()},[m]);const f=async()=>{try{const t=await(await fetch(`${g}/api/deployment`,{credentials:"include"})).json();t.success&&D(t.data)}catch(s){console.error("Error fetching files:",s),r.error("Failed to fetch deployment files")}finally{C(!1)}},y=async()=>{try{const t=await(await fetch(`${g}/api/deployment/active`)).json();t.success&&E(t.data)}catch(s){console.error("Error fetching active files:",s)}},M=async s=>{if(s.preventDefault(),!n.version){r.error("Please enter a version number");return}const t=document.getElementById("fileInput");if(!t.files[0]){r.error("Please select a file");return}d(!0),c(0);try{const a=new FormData;a.append("file",t.files[0]),a.append("platform",n.platform),a.append("version",n.version),a.append("description",n.description),a.append("isActive",n.isActive);const l=new XMLHttpRequest;p(l),l.upload.addEventListener("progress",o=>{if(o.lengthComputable){const B=Math.round(o.loaded/o.total*100);c(B)}}),l.addEventListener("load",()=>{if(l.status===200)try{const o=JSON.parse(l.responseText);o.success?(r.success("File uploaded successfully to AWS S3!"),u({platform:"android",version:"",description:"",isActive:!1}),document.getElementById("fileInput").value="",f(),y()):r.error(o.message||"Upload failed")}catch(o){console.error("Error parsing response:",o),r.error("Upload failed - invalid response")}else r.error(`Upload failed with status: ${l.status}`);d(!1),c(0),p(null)}),l.addEventListener("error",()=>{console.error("Upload error:",l.statusText),r.error("Upload failed - network error"),d(!1),c(0),p(null)}),l.addEventListener("abort",()=>{console.log("Upload aborted"),r.error("Upload cancelled"),d(!1),c(0),p(null)}),l.open("POST",`${g}/api/deployment/upload`),l.withCredentials=!0,l.send(a)}catch(a){console.error("Upload error:",a),r.error("Upload failed"),d(!1),c(0),p(null)}},I=()=>{m&&m.abort()},L=async s=>{try{const a=await(await fetch(`${g}/api/deployment/set-active/${s}`,{method:"PUT",credentials:"include"})).json();a.success?(r.success("Active deployment updated!"),f(),y()):r.error(a.message||"Failed to set active deployment")}catch(t){console.error("Error setting active:",t),r.error("Failed to set active deployment")}},T=async s=>{if(window.confirm("Are you sure you want to delete this file?"))try{const a=await(await fetch(`${g}/api/deployment/${s}`,{method:"DELETE",credentials:"include"})).json();a.success?(r.success("File deleted successfully!"),f(),y()):r.error(a.message||"Failed to delete file")}catch(t){console.error("Error deleting file:",t),r.error("Failed to delete file")}},v=s=>{switch(s){case"android":return e.jsx(X,{className:"text-green-500"});case"ios":return e.jsx(k,{className:"text-gray-600"});case"windows":return e.jsx(W,{className:"text-blue-500"});case"macos":return e.jsx(k,{className:"text-gray-800"});default:return e.jsx(V,{className:"text-gray-500"})}},w=s=>{if(s===0)return"0 Bytes";const t=1024,a=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,l)).toFixed(2))+" "+a[l]},$=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return P?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:"animate-spin text-4xl text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading deployment management..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(G,{className:"text-blue-600"}),"Deployment Management (AWS S3)"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage mobile app deployments and updates - Supports files up to 200MB"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(A,{className:"text-green-600"}),"Upload New Deployment"]}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Platform"}),e.jsxs("select",{value:n.platform,onChange:s=>u({...n,platform:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"android",children:"Android (APK)"}),e.jsx("option",{value:"ios",children:"iOS (IPA)"}),e.jsx("option",{value:"windows",children:"Windows (EXE/MSI)"}),e.jsx("option",{value:"macos",children:"macOS (DMG/PKG)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Version"}),e.jsx("input",{type:"text",value:n.version,onChange:s=>u({...n,version:s.target.value}),placeholder:"e.g., 1.0.0",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:n.description,onChange:s=>u({...n,description:s.target.value}),placeholder:"Describe this deployment...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:n.isActive,onChange:s=>u({...n,isActive:s.target.checked}),className:"mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Set as active deployment"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"File"}),e.jsx("input",{id:"fileInput",type:"file",accept:".apk,.ipa,.exe,.msi,.dmg,.pkg",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),h&&e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Upload Progress"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[x,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:`${x}%`}})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:x<100?"Uploading file...":"Processing upload..."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",disabled:h,className:"flex-1 px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"animate-spin"}),x<100?`Uploading... ${x}%`:"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{}),"Upload File"]})}),h&&e.jsxs("button",{type:"button",onClick:I,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 flex items-center gap-2",children:[e.jsx(S,{}),"Cancel"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(j,{className:"text-green-600"}),"Active Deployments"]}),N.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No active deployments"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:N.map(s=>e.jsxs("div",{className:"border border-green-200 rounded-lg p-4 bg-green-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[v(s.platform),e.jsx("span",{className:"font-medium text-gray-900",children:s.platform.toUpperCase()})]}),e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"ACTIVE"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Version: ",s.version]}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:w(s.size)}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("a",{href:s.url,download:!0,className:"flex-1 px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700 flex items-center justify-center gap-1",children:[e.jsx(U,{}),"Download"]})})]},s.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(O,{className:"text-gray-600"}),"All Deployments"]}),b.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No deployments found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Platform"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Version"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Size"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Uploaded"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2",children:[v(s.platform),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.platform.toUpperCase()})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.version}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:w(s.size)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.isActive?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(j,{className:"mr-1"}),"Active"]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[e.jsx(S,{className:"mr-1"}),"Inactive"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:$(s.createdAt)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("a",{href:s.url,download:!0,className:"text-blue-600 hover:text-blue-900 p-1",title:"Download",children:e.jsx(U,{})}),!s.isActive&&e.jsx("button",{onClick:()=>L(s.id),className:"text-green-600 hover:text-green-900 p-1",title:"Set as Active",children:e.jsx(j,{})}),e.jsx("button",{onClick:()=>T(s.id),className:"text-red-600 hover:text-red-900 p-1",title:"Delete",children:e.jsx(R,{})})]})})]},s.id))})]})})]})]})})}export{K as default};
