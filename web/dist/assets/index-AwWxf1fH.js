const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PublicHome-DM5XTeVe.js","assets/create-element-if-not-defined-CeVZSkFe.js","assets/pagination-Di15F9Og.js","assets/pagination-B-59Jalc.css","assets/ListingItem-Cp5-rgXZ.js","assets/addressMasking-3vIUwCOC.js","assets/GeminiAIWrapper-B0HqR0LI.js","assets/linkFormatter-D7tFnnq6.js","assets/Home-DDOVir-n.js","assets/PublicSearch-69IhuwzT.js","assets/countries_states_cities-CCOM4uJJ.js","assets/Search-Cc1NfajN.js","assets/LocationSelector-C3s9mesM.js","assets/Profile-B42om_9p.js","assets/RecaptchaWidget-BqjJeuRj.js","assets/SignIn-CYsxHyDj.js","assets/Oauth-BSWlNrx8.js","assets/SignUp-BM_rII5G.js","assets/ForgotPassword-Czo9hX3S.js","assets/CreateListing-JrCDPfvV.js","assets/EditListing-DhoeRaI5.js","assets/Listing-EsAmA3kM.js","assets/ReviewForm-TYaHGKVk.js","assets/ImagePreview-CH2URm-z.js","assets/Listing-vHIubPVI.css","assets/WishList-D3vOeKZ-.js","assets/Watchlist-CnDGHM2r.js","assets/Appointment-BS9KmywZ.js","assets/PaymentModal-D0_JBPvQ.js","assets/AdminAppointments-C_aivUzU.js","assets/ExportChatModal-DHRjGm0T.js","assets/AdminDashboard-B9Qev4ff.js","assets/MyAppointments-DQ5sdelk.js","assets/MyListings-B_ZwwoYm.js","assets/AdminExplore-D6m__y_m.js","assets/AdminCreateListing-B7hVQC-e.js","assets/AdminProfile-CyMqJOgB.js","assets/AdminListings-DfqakGLo.js","assets/AdminMyListings-QMdkIv9f.js","assets/AdminEditListing-BlOulmo8.js","assets/UserReviews-CEsZ0Cf5.js","assets/Contact-DBKT3sjF.js","assets/UserContact-EZYElgyQ.js","assets/AdminSupport-B6q9DdFg.js","assets/PublicAI-CumC4PG8.js","assets/UserAI-WWOENtIT.js","assets/AdminAI-CJsmysRg.js"])))=>i.map(i=>d[i]);
var tC=Object.defineProperty;var iC=(h,g,b)=>g in h?tC(h,g,{enumerable:!0,configurable:!0,writable:!0,value:b}):h[g]=b;var Gx=(h,g,b)=>iC(h,typeof g!="symbol"?g+"":g,b);function nC(h,g){for(var b=0;b<g.length;b++){const S=g[b];if(typeof S!="string"&&!Array.isArray(S)){for(const I in S)if(I!=="default"&&!(I in h)){const N=Object.getOwnPropertyDescriptor(S,I);N&&Object.defineProperty(h,I,N.get?N:{enumerable:!0,get:()=>S[I]})}}}return Object.freeze(Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}))}(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const I of document.querySelectorAll('link[rel="modulepreload"]'))S(I);new MutationObserver(I=>{for(const N of I)if(N.type==="childList")for(const V of N.addedNodes)V.tagName==="LINK"&&V.rel==="modulepreload"&&S(V)}).observe(document,{childList:!0,subtree:!0});function b(I){const N={};return I.integrity&&(N.integrity=I.integrity),I.referrerPolicy&&(N.referrerPolicy=I.referrerPolicy),I.crossOrigin==="use-credentials"?N.credentials="include":I.crossOrigin==="anonymous"?N.credentials="omit":N.credentials="same-origin",N}function S(I){if(I.ep)return;I.ep=!0;const N=b(I);fetch(I.href,N)}})();var mp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function P2(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}function rC(h){if(Object.prototype.hasOwnProperty.call(h,"__esModule"))return h;var g=h.default;if(typeof g=="function"){var b=function S(){return this instanceof S?Reflect.construct(g,arguments,this.constructor):g.apply(this,arguments)};b.prototype=g.prototype}else b={};return Object.defineProperty(b,"__esModule",{value:!0}),Object.keys(h).forEach(function(S){var I=Object.getOwnPropertyDescriptor(h,S);Object.defineProperty(b,S,I.get?I:{enumerable:!0,get:function(){return h[S]}})}),b}var $x={exports:{}},G_={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H3;function sC(){if(H3)return G_;H3=1;var h=Symbol.for("react.transitional.element"),g=Symbol.for("react.fragment");function b(S,I,N){var V=null;if(N!==void 0&&(V=""+N),I.key!==void 0&&(V=""+I.key),"key"in I){N={};for(var s in I)s!=="key"&&(N[s]=I[s])}else N=I;return I=N.ref,{$$typeof:h,type:S,key:V,ref:I!==void 0?I:null,props:N}}return G_.Fragment=g,G_.jsx=b,G_.jsxs=b,G_}var q3;function aC(){return q3||(q3=1,$x.exports=sC()),$x.exports}var x=aC(),Zx={exports:{}},dr={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G3;function oC(){if(G3)return dr;G3=1;var h=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),N=Symbol.for("react.consumer"),V=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),q=Symbol.for("react.suspense"),Z=Symbol.for("react.memo"),Q=Symbol.for("react.lazy"),oe=Symbol.iterator;function pe(Qe){return Qe===null||typeof Qe!="object"?null:(Qe=oe&&Qe[oe]||Qe["@@iterator"],typeof Qe=="function"?Qe:null)}var ze={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},le=Object.assign,Se={};function te(Qe,Ft,Di){this.props=Qe,this.context=Ft,this.refs=Se,this.updater=Di||ze}te.prototype.isReactComponent={},te.prototype.setState=function(Qe,Ft){if(typeof Qe!="object"&&typeof Qe!="function"&&Qe!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Qe,Ft,"setState")},te.prototype.forceUpdate=function(Qe){this.updater.enqueueForceUpdate(this,Qe,"forceUpdate")};function ge(){}ge.prototype=te.prototype;function xe(Qe,Ft,Di){this.props=Qe,this.context=Ft,this.refs=Se,this.updater=Di||ze}var ye=xe.prototype=new ge;ye.constructor=xe,le(ye,te.prototype),ye.isPureReactComponent=!0;var Pe=Array.isArray,Ae={H:null,A:null,T:null,S:null},Ke=Object.prototype.hasOwnProperty;function it(Qe,Ft,Di,Zi,ii,Yi){return Di=Yi.ref,{$$typeof:h,type:Qe,key:Ft,ref:Di!==void 0?Di:null,props:Yi}}function rt(Qe,Ft){return it(Qe.type,Ft,void 0,void 0,void 0,Qe.props)}function ut(Qe){return typeof Qe=="object"&&Qe!==null&&Qe.$$typeof===h}function Lt(Qe){var Ft={"=":"=0",":":"=2"};return"$"+Qe.replace(/[=:]/g,function(Di){return Ft[Di]})}var lt=/\/+/g;function Jt(Qe,Ft){return typeof Qe=="object"&&Qe!==null&&Qe.key!=null?Lt(""+Qe.key):Ft.toString(36)}function wi(){}function Fi(Qe){switch(Qe.status){case"fulfilled":return Qe.value;case"rejected":throw Qe.reason;default:switch(typeof Qe.status=="string"?Qe.then(wi,wi):(Qe.status="pending",Qe.then(function(Ft){Qe.status==="pending"&&(Qe.status="fulfilled",Qe.value=Ft)},function(Ft){Qe.status==="pending"&&(Qe.status="rejected",Qe.reason=Ft)})),Qe.status){case"fulfilled":return Qe.value;case"rejected":throw Qe.reason}}throw Qe}function Bi(Qe,Ft,Di,Zi,ii){var Yi=typeof Qe;(Yi==="undefined"||Yi==="boolean")&&(Qe=null);var Ti=!1;if(Qe===null)Ti=!0;else switch(Yi){case"bigint":case"string":case"number":Ti=!0;break;case"object":switch(Qe.$$typeof){case h:case g:Ti=!0;break;case Q:return Ti=Qe._init,Bi(Ti(Qe._payload),Ft,Di,Zi,ii)}}if(Ti)return ii=ii(Qe),Ti=Zi===""?"."+Jt(Qe,0):Zi,Pe(ii)?(Di="",Ti!=null&&(Di=Ti.replace(lt,"$&/")+"/"),Bi(ii,Ft,Di,"",function(xt){return xt})):ii!=null&&(ut(ii)&&(ii=rt(ii,Di+(ii.key==null||Qe&&Qe.key===ii.key?"":(""+ii.key).replace(lt,"$&/")+"/")+Ti)),Ft.push(ii)),1;Ti=0;var Mi=Zi===""?".":Zi+":";if(Pe(Qe))for(var Ii=0;Ii<Qe.length;Ii++)Zi=Qe[Ii],Yi=Mi+Jt(Zi,Ii),Ti+=Bi(Zi,Ft,Di,Yi,ii);else if(Ii=pe(Qe),typeof Ii=="function")for(Qe=Ii.call(Qe),Ii=0;!(Zi=Qe.next()).done;)Zi=Zi.value,Yi=Mi+Jt(Zi,Ii++),Ti+=Bi(Zi,Ft,Di,Yi,ii);else if(Yi==="object"){if(typeof Qe.then=="function")return Bi(Fi(Qe),Ft,Di,Zi,ii);throw Ft=String(Qe),Error("Objects are not valid as a React child (found: "+(Ft==="[object Object]"?"object with keys {"+Object.keys(Qe).join(", ")+"}":Ft)+"). If you meant to render a collection of children, use an array instead.")}return Ti}function Wt(Qe,Ft,Di){if(Qe==null)return Qe;var Zi=[],ii=0;return Bi(Qe,Zi,"","",function(Yi){return Ft.call(Di,Yi,ii++)}),Zi}function ki(Qe){if(Qe._status===-1){var Ft=Qe._result;Ft=Ft(),Ft.then(function(Di){(Qe._status===0||Qe._status===-1)&&(Qe._status=1,Qe._result=Di)},function(Di){(Qe._status===0||Qe._status===-1)&&(Qe._status=2,Qe._result=Di)}),Qe._status===-1&&(Qe._status=0,Qe._result=Ft)}if(Qe._status===1)return Qe._result.default;throw Qe._result}var Ui=typeof reportError=="function"?reportError:function(Qe){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ft=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Qe=="object"&&Qe!==null&&typeof Qe.message=="string"?String(Qe.message):String(Qe),error:Qe});if(!window.dispatchEvent(Ft))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Qe);return}console.error(Qe)};function Cn(){}return dr.Children={map:Wt,forEach:function(Qe,Ft,Di){Wt(Qe,function(){Ft.apply(this,arguments)},Di)},count:function(Qe){var Ft=0;return Wt(Qe,function(){Ft++}),Ft},toArray:function(Qe){return Wt(Qe,function(Ft){return Ft})||[]},only:function(Qe){if(!ut(Qe))throw Error("React.Children.only expected to receive a single React element child.");return Qe}},dr.Component=te,dr.Fragment=b,dr.Profiler=I,dr.PureComponent=xe,dr.StrictMode=S,dr.Suspense=q,dr.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ae,dr.act=function(){throw Error("act(...) is not supported in production builds of React.")},dr.cache=function(Qe){return function(){return Qe.apply(null,arguments)}},dr.cloneElement=function(Qe,Ft,Di){if(Qe==null)throw Error("The argument must be a React element, but you passed "+Qe+".");var Zi=le({},Qe.props),ii=Qe.key,Yi=void 0;if(Ft!=null)for(Ti in Ft.ref!==void 0&&(Yi=void 0),Ft.key!==void 0&&(ii=""+Ft.key),Ft)!Ke.call(Ft,Ti)||Ti==="key"||Ti==="__self"||Ti==="__source"||Ti==="ref"&&Ft.ref===void 0||(Zi[Ti]=Ft[Ti]);var Ti=arguments.length-2;if(Ti===1)Zi.children=Di;else if(1<Ti){for(var Mi=Array(Ti),Ii=0;Ii<Ti;Ii++)Mi[Ii]=arguments[Ii+2];Zi.children=Mi}return it(Qe.type,ii,void 0,void 0,Yi,Zi)},dr.createContext=function(Qe){return Qe={$$typeof:V,_currentValue:Qe,_currentValue2:Qe,_threadCount:0,Provider:null,Consumer:null},Qe.Provider=Qe,Qe.Consumer={$$typeof:N,_context:Qe},Qe},dr.createElement=function(Qe,Ft,Di){var Zi,ii={},Yi=null;if(Ft!=null)for(Zi in Ft.key!==void 0&&(Yi=""+Ft.key),Ft)Ke.call(Ft,Zi)&&Zi!=="key"&&Zi!=="__self"&&Zi!=="__source"&&(ii[Zi]=Ft[Zi]);var Ti=arguments.length-2;if(Ti===1)ii.children=Di;else if(1<Ti){for(var Mi=Array(Ti),Ii=0;Ii<Ti;Ii++)Mi[Ii]=arguments[Ii+2];ii.children=Mi}if(Qe&&Qe.defaultProps)for(Zi in Ti=Qe.defaultProps,Ti)ii[Zi]===void 0&&(ii[Zi]=Ti[Zi]);return it(Qe,Yi,void 0,void 0,null,ii)},dr.createRef=function(){return{current:null}},dr.forwardRef=function(Qe){return{$$typeof:s,render:Qe}},dr.isValidElement=ut,dr.lazy=function(Qe){return{$$typeof:Q,_payload:{_status:-1,_result:Qe},_init:ki}},dr.memo=function(Qe,Ft){return{$$typeof:Z,type:Qe,compare:Ft===void 0?null:Ft}},dr.startTransition=function(Qe){var Ft=Ae.T,Di={};Ae.T=Di;try{var Zi=Qe(),ii=Ae.S;ii!==null&&ii(Di,Zi),typeof Zi=="object"&&Zi!==null&&typeof Zi.then=="function"&&Zi.then(Cn,Ui)}catch(Yi){Ui(Yi)}finally{Ae.T=Ft}},dr.unstable_useCacheRefresh=function(){return Ae.H.useCacheRefresh()},dr.use=function(Qe){return Ae.H.use(Qe)},dr.useActionState=function(Qe,Ft,Di){return Ae.H.useActionState(Qe,Ft,Di)},dr.useCallback=function(Qe,Ft){return Ae.H.useCallback(Qe,Ft)},dr.useContext=function(Qe){return Ae.H.useContext(Qe)},dr.useDebugValue=function(){},dr.useDeferredValue=function(Qe,Ft){return Ae.H.useDeferredValue(Qe,Ft)},dr.useEffect=function(Qe,Ft){return Ae.H.useEffect(Qe,Ft)},dr.useId=function(){return Ae.H.useId()},dr.useImperativeHandle=function(Qe,Ft,Di){return Ae.H.useImperativeHandle(Qe,Ft,Di)},dr.useInsertionEffect=function(Qe,Ft){return Ae.H.useInsertionEffect(Qe,Ft)},dr.useLayoutEffect=function(Qe,Ft){return Ae.H.useLayoutEffect(Qe,Ft)},dr.useMemo=function(Qe,Ft){return Ae.H.useMemo(Qe,Ft)},dr.useOptimistic=function(Qe,Ft){return Ae.H.useOptimistic(Qe,Ft)},dr.useReducer=function(Qe,Ft,Di){return Ae.H.useReducer(Qe,Ft,Di)},dr.useRef=function(Qe){return Ae.H.useRef(Qe)},dr.useState=function(Qe){return Ae.H.useState(Qe)},dr.useSyncExternalStore=function(Qe,Ft,Di){return Ae.H.useSyncExternalStore(Qe,Ft,Di)},dr.useTransition=function(){return Ae.H.useTransition()},dr.version="19.0.0",dr}var $3;function m1(){return $3||($3=1,Zx.exports=oC()),Zx.exports}var he=m1();const Fr=P2(he),sk=nC({__proto__:null,default:Fr},[he]);var Wx={exports:{}},$_={},Xx={exports:{}},Yx={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Z3;function lC(){return Z3||(Z3=1,function(h){function g(Wt,ki){var Ui=Wt.length;Wt.push(ki);e:for(;0<Ui;){var Cn=Ui-1>>>1,Qe=Wt[Cn];if(0<I(Qe,ki))Wt[Cn]=ki,Wt[Ui]=Qe,Ui=Cn;else break e}}function b(Wt){return Wt.length===0?null:Wt[0]}function S(Wt){if(Wt.length===0)return null;var ki=Wt[0],Ui=Wt.pop();if(Ui!==ki){Wt[0]=Ui;e:for(var Cn=0,Qe=Wt.length,Ft=Qe>>>1;Cn<Ft;){var Di=2*(Cn+1)-1,Zi=Wt[Di],ii=Di+1,Yi=Wt[ii];if(0>I(Zi,Ui))ii<Qe&&0>I(Yi,Zi)?(Wt[Cn]=Yi,Wt[ii]=Ui,Cn=ii):(Wt[Cn]=Zi,Wt[Di]=Ui,Cn=Di);else if(ii<Qe&&0>I(Yi,Ui))Wt[Cn]=Yi,Wt[ii]=Ui,Cn=ii;else break e}}return ki}function I(Wt,ki){var Ui=Wt.sortIndex-ki.sortIndex;return Ui!==0?Ui:Wt.id-ki.id}if(h.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var N=performance;h.unstable_now=function(){return N.now()}}else{var V=Date,s=V.now();h.unstable_now=function(){return V.now()-s}}var q=[],Z=[],Q=1,oe=null,pe=3,ze=!1,le=!1,Se=!1,te=typeof setTimeout=="function"?setTimeout:null,ge=typeof clearTimeout=="function"?clearTimeout:null,xe=typeof setImmediate<"u"?setImmediate:null;function ye(Wt){for(var ki=b(Z);ki!==null;){if(ki.callback===null)S(Z);else if(ki.startTime<=Wt)S(Z),ki.sortIndex=ki.expirationTime,g(q,ki);else break;ki=b(Z)}}function Pe(Wt){if(Se=!1,ye(Wt),!le)if(b(q)!==null)le=!0,Fi();else{var ki=b(Z);ki!==null&&Bi(Pe,ki.startTime-Wt)}}var Ae=!1,Ke=-1,it=5,rt=-1;function ut(){return!(h.unstable_now()-rt<it)}function Lt(){if(Ae){var Wt=h.unstable_now();rt=Wt;var ki=!0;try{e:{le=!1,Se&&(Se=!1,ge(Ke),Ke=-1),ze=!0;var Ui=pe;try{t:{for(ye(Wt),oe=b(q);oe!==null&&!(oe.expirationTime>Wt&&ut());){var Cn=oe.callback;if(typeof Cn=="function"){oe.callback=null,pe=oe.priorityLevel;var Qe=Cn(oe.expirationTime<=Wt);if(Wt=h.unstable_now(),typeof Qe=="function"){oe.callback=Qe,ye(Wt),ki=!0;break t}oe===b(q)&&S(q),ye(Wt)}else S(q);oe=b(q)}if(oe!==null)ki=!0;else{var Ft=b(Z);Ft!==null&&Bi(Pe,Ft.startTime-Wt),ki=!1}}break e}finally{oe=null,pe=Ui,ze=!1}ki=void 0}}finally{ki?lt():Ae=!1}}}var lt;if(typeof xe=="function")lt=function(){xe(Lt)};else if(typeof MessageChannel<"u"){var Jt=new MessageChannel,wi=Jt.port2;Jt.port1.onmessage=Lt,lt=function(){wi.postMessage(null)}}else lt=function(){te(Lt,0)};function Fi(){Ae||(Ae=!0,lt())}function Bi(Wt,ki){Ke=te(function(){Wt(h.unstable_now())},ki)}h.unstable_IdlePriority=5,h.unstable_ImmediatePriority=1,h.unstable_LowPriority=4,h.unstable_NormalPriority=3,h.unstable_Profiling=null,h.unstable_UserBlockingPriority=2,h.unstable_cancelCallback=function(Wt){Wt.callback=null},h.unstable_continueExecution=function(){le||ze||(le=!0,Fi())},h.unstable_forceFrameRate=function(Wt){0>Wt||125<Wt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):it=0<Wt?Math.floor(1e3/Wt):5},h.unstable_getCurrentPriorityLevel=function(){return pe},h.unstable_getFirstCallbackNode=function(){return b(q)},h.unstable_next=function(Wt){switch(pe){case 1:case 2:case 3:var ki=3;break;default:ki=pe}var Ui=pe;pe=ki;try{return Wt()}finally{pe=Ui}},h.unstable_pauseExecution=function(){},h.unstable_requestPaint=function(){},h.unstable_runWithPriority=function(Wt,ki){switch(Wt){case 1:case 2:case 3:case 4:case 5:break;default:Wt=3}var Ui=pe;pe=Wt;try{return ki()}finally{pe=Ui}},h.unstable_scheduleCallback=function(Wt,ki,Ui){var Cn=h.unstable_now();switch(typeof Ui=="object"&&Ui!==null?(Ui=Ui.delay,Ui=typeof Ui=="number"&&0<Ui?Cn+Ui:Cn):Ui=Cn,Wt){case 1:var Qe=-1;break;case 2:Qe=250;break;case 5:Qe=1073741823;break;case 4:Qe=1e4;break;default:Qe=5e3}return Qe=Ui+Qe,Wt={id:Q++,callback:ki,priorityLevel:Wt,startTime:Ui,expirationTime:Qe,sortIndex:-1},Ui>Cn?(Wt.sortIndex=Ui,g(Z,Wt),b(q)===null&&Wt===b(Z)&&(Se?(ge(Ke),Ke=-1):Se=!0,Bi(Pe,Ui-Cn))):(Wt.sortIndex=Qe,g(q,Wt),le||ze||(le=!0,Fi())),Wt},h.unstable_shouldYield=ut,h.unstable_wrapCallback=function(Wt){var ki=pe;return function(){var Ui=pe;pe=ki;try{return Wt.apply(this,arguments)}finally{pe=Ui}}}}(Yx)),Yx}var W3;function cC(){return W3||(W3=1,Xx.exports=lC()),Xx.exports}var Kx={exports:{}},Lo={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X3;function uC(){if(X3)return Lo;X3=1;var h=m1();function g(q){var Z="https://react.dev/errors/"+q;if(1<arguments.length){Z+="?args[]="+encodeURIComponent(arguments[1]);for(var Q=2;Q<arguments.length;Q++)Z+="&args[]="+encodeURIComponent(arguments[Q])}return"Minified React error #"+q+"; visit "+Z+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function b(){}var S={d:{f:b,r:function(){throw Error(g(522))},D:b,C:b,L:b,m:b,X:b,S:b,M:b},p:0,findDOMNode:null},I=Symbol.for("react.portal");function N(q,Z,Q){var oe=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:I,key:oe==null?null:""+oe,children:q,containerInfo:Z,implementation:Q}}var V=h.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(q,Z){if(q==="font")return"";if(typeof Z=="string")return Z==="use-credentials"?Z:""}return Lo.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,Lo.createPortal=function(q,Z){var Q=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Z||Z.nodeType!==1&&Z.nodeType!==9&&Z.nodeType!==11)throw Error(g(299));return N(q,Z,null,Q)},Lo.flushSync=function(q){var Z=V.T,Q=S.p;try{if(V.T=null,S.p=2,q)return q()}finally{V.T=Z,S.p=Q,S.d.f()}},Lo.preconnect=function(q,Z){typeof q=="string"&&(Z?(Z=Z.crossOrigin,Z=typeof Z=="string"?Z==="use-credentials"?Z:"":void 0):Z=null,S.d.C(q,Z))},Lo.prefetchDNS=function(q){typeof q=="string"&&S.d.D(q)},Lo.preinit=function(q,Z){if(typeof q=="string"&&Z&&typeof Z.as=="string"){var Q=Z.as,oe=s(Q,Z.crossOrigin),pe=typeof Z.integrity=="string"?Z.integrity:void 0,ze=typeof Z.fetchPriority=="string"?Z.fetchPriority:void 0;Q==="style"?S.d.S(q,typeof Z.precedence=="string"?Z.precedence:void 0,{crossOrigin:oe,integrity:pe,fetchPriority:ze}):Q==="script"&&S.d.X(q,{crossOrigin:oe,integrity:pe,fetchPriority:ze,nonce:typeof Z.nonce=="string"?Z.nonce:void 0})}},Lo.preinitModule=function(q,Z){if(typeof q=="string")if(typeof Z=="object"&&Z!==null){if(Z.as==null||Z.as==="script"){var Q=s(Z.as,Z.crossOrigin);S.d.M(q,{crossOrigin:Q,integrity:typeof Z.integrity=="string"?Z.integrity:void 0,nonce:typeof Z.nonce=="string"?Z.nonce:void 0})}}else Z==null&&S.d.M(q)},Lo.preload=function(q,Z){if(typeof q=="string"&&typeof Z=="object"&&Z!==null&&typeof Z.as=="string"){var Q=Z.as,oe=s(Q,Z.crossOrigin);S.d.L(q,Q,{crossOrigin:oe,integrity:typeof Z.integrity=="string"?Z.integrity:void 0,nonce:typeof Z.nonce=="string"?Z.nonce:void 0,type:typeof Z.type=="string"?Z.type:void 0,fetchPriority:typeof Z.fetchPriority=="string"?Z.fetchPriority:void 0,referrerPolicy:typeof Z.referrerPolicy=="string"?Z.referrerPolicy:void 0,imageSrcSet:typeof Z.imageSrcSet=="string"?Z.imageSrcSet:void 0,imageSizes:typeof Z.imageSizes=="string"?Z.imageSizes:void 0,media:typeof Z.media=="string"?Z.media:void 0})}},Lo.preloadModule=function(q,Z){if(typeof q=="string")if(Z){var Q=s(Z.as,Z.crossOrigin);S.d.m(q,{as:typeof Z.as=="string"&&Z.as!=="script"?Z.as:void 0,crossOrigin:Q,integrity:typeof Z.integrity=="string"?Z.integrity:void 0})}else S.d.m(q)},Lo.requestFormReset=function(q){S.d.r(q)},Lo.unstable_batchedUpdates=function(q,Z){return q(Z)},Lo.useFormState=function(q,Z,Q){return V.H.useFormState(q,Z,Q)},Lo.useFormStatus=function(){return V.H.useHostTransitionStatus()},Lo.version="19.0.0",Lo}var Y3;function JT(){if(Y3)return Kx.exports;Y3=1;function h(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h)}catch(g){console.error(g)}}return h(),Kx.exports=uC(),Kx.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K3;function hC(){if(K3)return $_;K3=1;var h=cC(),g=m1(),b=JT();function S(l){var f="https://react.dev/errors/"+l;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var v=2;v<arguments.length;v++)f+="&args[]="+encodeURIComponent(arguments[v])}return"Minified React error #"+l+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function I(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}var N=Symbol.for("react.element"),V=Symbol.for("react.transitional.element"),s=Symbol.for("react.portal"),q=Symbol.for("react.fragment"),Z=Symbol.for("react.strict_mode"),Q=Symbol.for("react.profiler"),oe=Symbol.for("react.provider"),pe=Symbol.for("react.consumer"),ze=Symbol.for("react.context"),le=Symbol.for("react.forward_ref"),Se=Symbol.for("react.suspense"),te=Symbol.for("react.suspense_list"),ge=Symbol.for("react.memo"),xe=Symbol.for("react.lazy"),ye=Symbol.for("react.offscreen"),Pe=Symbol.for("react.memo_cache_sentinel"),Ae=Symbol.iterator;function Ke(l){return l===null||typeof l!="object"?null:(l=Ae&&l[Ae]||l["@@iterator"],typeof l=="function"?l:null)}var it=Symbol.for("react.client.reference");function rt(l){if(l==null)return null;if(typeof l=="function")return l.$$typeof===it?null:l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case q:return"Fragment";case s:return"Portal";case Q:return"Profiler";case Z:return"StrictMode";case Se:return"Suspense";case te:return"SuspenseList"}if(typeof l=="object")switch(l.$$typeof){case ze:return(l.displayName||"Context")+".Provider";case pe:return(l._context.displayName||"Context")+".Consumer";case le:var f=l.render;return l=l.displayName,l||(l=f.displayName||f.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case ge:return f=l.displayName||null,f!==null?f:rt(l.type)||"Memo";case xe:f=l._payload,l=l._init;try{return rt(l(f))}catch{}}return null}var ut=g.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Lt=Object.assign,lt,Jt;function wi(l){if(lt===void 0)try{throw Error()}catch(v){var f=v.stack.trim().match(/\n( *(at )?)/);lt=f&&f[1]||"",Jt=-1<v.stack.indexOf(`
    at`)?" (<anonymous>)":-1<v.stack.indexOf("@")?"@unknown:0:0":""}return`
`+lt+l+Jt}var Fi=!1;function Bi(l,f){if(!l||Fi)return"";Fi=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var C={DetermineComponentFrameRoot:function(){try{if(f){var yi=function(){throw Error()};if(Object.defineProperty(yi.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(yi,[])}catch(ti){var Ut=ti}Reflect.construct(l,[],yi)}else{try{yi.call()}catch(ti){Ut=ti}l.call(yi.prototype)}}else{try{throw Error()}catch(ti){Ut=ti}(yi=l())&&typeof yi.catch=="function"&&yi.catch(function(){})}}catch(ti){if(ti&&Ut&&typeof ti.stack=="string")return[ti.stack,Ut.stack]}return[null,null]}};C.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var O=Object.getOwnPropertyDescriptor(C.DetermineComponentFrameRoot,"name");O&&O.configurable&&Object.defineProperty(C.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var U=C.DetermineComponentFrameRoot(),ae=U[0],De=U[1];if(ae&&De){var Xe=ae.split(`
`),gt=De.split(`
`);for(O=C=0;C<Xe.length&&!Xe[C].includes("DetermineComponentFrameRoot");)C++;for(;O<gt.length&&!gt[O].includes("DetermineComponentFrameRoot");)O++;if(C===Xe.length||O===gt.length)for(C=Xe.length-1,O=gt.length-1;1<=C&&0<=O&&Xe[C]!==gt[O];)O--;for(;1<=C&&0<=O;C--,O--)if(Xe[C]!==gt[O]){if(C!==1||O!==1)do if(C--,O--,0>O||Xe[C]!==gt[O]){var si=`
`+Xe[C].replace(" at new "," at ");return l.displayName&&si.includes("<anonymous>")&&(si=si.replace("<anonymous>",l.displayName)),si}while(1<=C&&0<=O);break}}}finally{Fi=!1,Error.prepareStackTrace=v}return(v=l?l.displayName||l.name:"")?wi(v):""}function Wt(l){switch(l.tag){case 26:case 27:case 5:return wi(l.type);case 16:return wi("Lazy");case 13:return wi("Suspense");case 19:return wi("SuspenseList");case 0:case 15:return l=Bi(l.type,!1),l;case 11:return l=Bi(l.type.render,!1),l;case 1:return l=Bi(l.type,!0),l;default:return""}}function ki(l){try{var f="";do f+=Wt(l),l=l.return;while(l);return f}catch(v){return`
Error generating stack: `+v.message+`
`+v.stack}}function Ui(l){var f=l,v=l;if(l.alternate)for(;f.return;)f=f.return;else{l=f;do f=l,(f.flags&4098)!==0&&(v=f.return),l=f.return;while(l)}return f.tag===3?v:null}function Cn(l){if(l.tag===13){var f=l.memoizedState;if(f===null&&(l=l.alternate,l!==null&&(f=l.memoizedState)),f!==null)return f.dehydrated}return null}function Qe(l){if(Ui(l)!==l)throw Error(S(188))}function Ft(l){var f=l.alternate;if(!f){if(f=Ui(l),f===null)throw Error(S(188));return f!==l?null:l}for(var v=l,C=f;;){var O=v.return;if(O===null)break;var U=O.alternate;if(U===null){if(C=O.return,C!==null){v=C;continue}break}if(O.child===U.child){for(U=O.child;U;){if(U===v)return Qe(O),l;if(U===C)return Qe(O),f;U=U.sibling}throw Error(S(188))}if(v.return!==C.return)v=O,C=U;else{for(var ae=!1,De=O.child;De;){if(De===v){ae=!0,v=O,C=U;break}if(De===C){ae=!0,C=O,v=U;break}De=De.sibling}if(!ae){for(De=U.child;De;){if(De===v){ae=!0,v=U,C=O;break}if(De===C){ae=!0,C=U,v=O;break}De=De.sibling}if(!ae)throw Error(S(189))}}if(v.alternate!==C)throw Error(S(190))}if(v.tag!==3)throw Error(S(188));return v.stateNode.current===v?l:f}function Di(l){var f=l.tag;if(f===5||f===26||f===27||f===6)return l;for(l=l.child;l!==null;){if(f=Di(l),f!==null)return f;l=l.sibling}return null}var Zi=Array.isArray,ii=b.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Yi={pending:!1,data:null,method:null,action:null},Ti=[],Mi=-1;function Ii(l){return{current:l}}function xt(l){0>Mi||(l.current=Ti[Mi],Ti[Mi]=null,Mi--)}function St(l,f){Mi++,Ti[Mi]=l.current,l.current=f}var Ei=Ii(null),Sn=Ii(null),Mn=Ii(null),Nn=Ii(null);function In(l,f){switch(St(Mn,f),St(Sn,l),St(Ei,null),l=f.nodeType,l){case 9:case 11:f=(f=f.documentElement)&&(f=f.namespaceURI)?E0(f):0;break;default:if(l=l===8?f.parentNode:f,f=l.tagName,l=l.namespaceURI)l=E0(l),f=A0(l,f);else switch(f){case"svg":f=1;break;case"math":f=2;break;default:f=0}}xt(Ei),St(Ei,f)}function qr(){xt(Ei),xt(Sn),xt(Mn)}function bs(l){l.memoizedState!==null&&St(Nn,l);var f=Ei.current,v=A0(f,l.type);f!==v&&(St(Sn,l),St(Ei,v))}function fa(l){Sn.current===l&&(xt(Ei),xt(Sn)),Nn.current===l&&(xt(Nn),um._currentValue=Yi)}var Un=Object.prototype.hasOwnProperty,es=h.unstable_scheduleCallback,js=h.unstable_cancelCallback,po=h.unstable_shouldYield,mo=h.unstable_requestPaint,As=h.unstable_now,ws=h.unstable_getCurrentPriorityLevel,Gr=h.unstable_ImmediatePriority,Yr=h.unstable_UserBlockingPriority,Bs=h.unstable_NormalPriority,Fs=h.unstable_LowPriority,Sa=h.unstable_IdlePriority,Or=h.log,Ea=h.unstable_setDisableYieldValue,Ya=null,ss=null;function Ka(l){if(ss&&typeof ss.onCommitFiberRoot=="function")try{ss.onCommitFiberRoot(Ya,l,void 0,(l.current.flags&128)===128)}catch{}}function Ls(l){if(typeof Or=="function"&&Ea(l),ss&&typeof ss.setStrictMode=="function")try{ss.setStrictMode(Ya,l)}catch{}}var hs=Math.clz32?Math.clz32:bc,fr=Math.log,as=Math.LN2;function bc(l){return l>>>=0,l===0?32:31-(fr(l)/as|0)|0}var ka=128,ds=4194304;function Ur(l){var f=l&42;if(f!==0)return f;switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return l&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return l}}function No(l,f){var v=l.pendingLanes;if(v===0)return 0;var C=0,O=l.suspendedLanes,U=l.pingedLanes,ae=l.warmLanes;l=l.finishedLanes!==0;var De=v&134217727;return De!==0?(v=De&~O,v!==0?C=Ur(v):(U&=De,U!==0?C=Ur(U):l||(ae=De&~ae,ae!==0&&(C=Ur(ae))))):(De=v&~O,De!==0?C=Ur(De):U!==0?C=Ur(U):l||(ae=v&~ae,ae!==0&&(C=Ur(ae)))),C===0?0:f!==0&&f!==C&&(f&O)===0&&(O=C&-C,ae=f&-f,O>=ae||O===32&&(ae&4194176)!==0)?f:C}function pa(l,f){return(l.pendingLanes&~(l.suspendedLanes&~l.pingedLanes)&f)===0}function Mt(l,f){switch(l){case 1:case 2:case 4:case 8:return f+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ea(){var l=ka;return ka<<=1,(ka&4194176)===0&&(ka=128),l}function go(){var l=ds;return ds<<=1,(ds&62914560)===0&&(ds=4194304),l}function Na(l){for(var f=[],v=0;31>v;v++)f.push(l);return f}function He(l,f){l.pendingLanes|=f,f!==268435456&&(l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0)}function J(l,f,v,C,O,U){var ae=l.pendingLanes;l.pendingLanes=v,l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0,l.expiredLanes&=v,l.entangledLanes&=v,l.errorRecoveryDisabledLanes&=v,l.shellSuspendCounter=0;var De=l.entanglements,Xe=l.expirationTimes,gt=l.hiddenUpdates;for(v=ae&~v;0<v;){var si=31-hs(v),yi=1<<si;De[si]=0,Xe[si]=-1;var Ut=gt[si];if(Ut!==null)for(gt[si]=null,si=0;si<Ut.length;si++){var ti=Ut[si];ti!==null&&(ti.lane&=-536870913)}v&=~yi}C!==0&&ne(l,C,0),U!==0&&O===0&&l.tag!==0&&(l.suspendedLanes|=U&~(ae&~f))}function ne(l,f,v){l.pendingLanes|=f,l.suspendedLanes&=~f;var C=31-hs(f);l.entangledLanes|=f,l.entanglements[C]=l.entanglements[C]|1073741824|v&4194218}function _e(l,f){var v=l.entangledLanes|=f;for(l=l.entanglements;v;){var C=31-hs(v),O=1<<C;O&f|l[C]&f&&(l[C]|=f),v&=~O}}function ke(l){return l&=-l,2<l?8<l?(l&134217727)!==0?32:268435456:8:2}function Le(){var l=ii.p;return l!==0?l:(l=window.event,l===void 0?32:fg(l.type))}function Ie(l,f){var v=ii.p;try{return ii.p=l,f()}finally{ii.p=v}}var et=Math.random().toString(36).slice(2),Be="__reactFiber$"+et,Je="__reactProps$"+et,zt="__reactContainer$"+et,vt="__reactEvents$"+et,pi="__reactListeners$"+et,Ai="__reactHandles$"+et,Vi="__reactResources$"+et,on="__reactMarker$"+et;function rn(l){delete l[Be],delete l[Je],delete l[vt],delete l[pi],delete l[Ai]}function ln(l){var f=l[Be];if(f)return f;for(var v=l.parentNode;v;){if(f=v[zt]||v[Be]){if(v=f.alternate,f.child!==null||v!==null&&v.child!==null)for(l=M0(l);l!==null;){if(v=l[Be])return v;l=M0(l)}return f}l=v,v=l.parentNode}return null}function jn(l){if(l=l[Be]||l[zt]){var f=l.tag;if(f===5||f===6||f===13||f===26||f===27||f===3)return l}return null}function cn(l){var f=l.tag;if(f===5||f===26||f===27||f===6)return l.stateNode;throw Error(S(33))}function cr(l){var f=l[Vi];return f||(f=l[Vi]={hoistableStyles:new Map,hoistableScripts:new Map}),f}function $n(l){l[on]=!0}var Ve=new Set,wt={};function Bt(l,f){Qt(l,f),Qt(l+"Capture",f)}function Qt(l,f){for(wt[l]=f,l=0;l<f.length;l++)Ve.add(f[l])}var bi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),$i=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),yr={},Kn={};function ar(l){return Un.call(Kn,l)?!0:Un.call(yr,l)?!1:$i.test(l)?Kn[l]=!0:(yr[l]=!0,!1)}function Sr(l,f,v){if(ar(f))if(v===null)l.removeAttribute(f);else{switch(typeof v){case"undefined":case"function":case"symbol":l.removeAttribute(f);return;case"boolean":var C=f.toLowerCase().slice(0,5);if(C!=="data-"&&C!=="aria-"){l.removeAttribute(f);return}}l.setAttribute(f,""+v)}}function Vr(l,f,v){if(v===null)l.removeAttribute(f);else{switch(typeof v){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(f);return}l.setAttribute(f,""+v)}}function ja(l,f,v,C){if(C===null)l.removeAttribute(v);else{switch(typeof C){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(v);return}l.setAttributeNS(f,v,""+C)}}function Ja(l){switch(typeof l){case"bigint":case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function Ll(l){var f=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function oh(l){var f=Ll(l)?"checked":"value",v=Object.getOwnPropertyDescriptor(l.constructor.prototype,f),C=""+l[f];if(!l.hasOwnProperty(f)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var O=v.get,U=v.set;return Object.defineProperty(l,f,{configurable:!0,get:function(){return O.call(this)},set:function(ae){C=""+ae,U.call(this,ae)}}),Object.defineProperty(l,f,{enumerable:v.enumerable}),{getValue:function(){return C},setValue:function(ae){C=""+ae},stopTracking:function(){l._valueTracker=null,delete l[f]}}}}function wc(l){l._valueTracker||(l._valueTracker=oh(l))}function lh(l){if(!l)return!1;var f=l._valueTracker;if(!f)return!0;var v=f.getValue(),C="";return l&&(C=Ll(l)?l.checked?"true":"false":l.value),l=C,l!==v?(f.setValue(l),!0):!1}function jo(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var ad=/[\n"\\]/g;function Ba(l){return l.replace(ad,function(f){return"\\"+f.charCodeAt(0).toString(16)+" "})}function _o(l,f,v,C,O,U,ae,De){l.name="",ae!=null&&typeof ae!="function"&&typeof ae!="symbol"&&typeof ae!="boolean"?l.type=ae:l.removeAttribute("type"),f!=null?ae==="number"?(f===0&&l.value===""||l.value!=f)&&(l.value=""+Ja(f)):l.value!==""+Ja(f)&&(l.value=""+Ja(f)):ae!=="submit"&&ae!=="reset"||l.removeAttribute("value"),f!=null?ch(l,ae,Ja(f)):v!=null?ch(l,ae,Ja(v)):C!=null&&l.removeAttribute("value"),O==null&&U!=null&&(l.defaultChecked=!!U),O!=null&&(l.checked=O&&typeof O!="function"&&typeof O!="symbol"),De!=null&&typeof De!="function"&&typeof De!="symbol"&&typeof De!="boolean"?l.name=""+Ja(De):l.removeAttribute("name")}function hf(l,f,v,C,O,U,ae,De){if(U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"&&(l.type=U),f!=null||v!=null){if(!(U!=="submit"&&U!=="reset"||f!=null))return;v=v!=null?""+Ja(v):"",f=f!=null?""+Ja(f):v,De||f===l.value||(l.value=f),l.defaultValue=f}C=C??O,C=typeof C!="function"&&typeof C!="symbol"&&!!C,l.checked=De?l.checked:!!C,l.defaultChecked=!!C,ae!=null&&typeof ae!="function"&&typeof ae!="symbol"&&typeof ae!="boolean"&&(l.name=ae)}function ch(l,f,v){f==="number"&&jo(l.ownerDocument)===l||l.defaultValue===""+v||(l.defaultValue=""+v)}function Us(l,f,v,C){if(l=l.options,f){f={};for(var O=0;O<v.length;O++)f["$"+v[O]]=!0;for(v=0;v<l.length;v++)O=f.hasOwnProperty("$"+l[v].value),l[v].selected!==O&&(l[v].selected=O),O&&C&&(l[v].defaultSelected=!0)}else{for(v=""+Ja(v),f=null,O=0;O<l.length;O++){if(l[O].value===v){l[O].selected=!0,C&&(l[O].defaultSelected=!0);return}f!==null||l[O].disabled||(f=l[O])}f!==null&&(f.selected=!0)}}function yo(l,f,v){if(f!=null&&(f=""+Ja(f),f!==l.value&&(l.value=f),v==null)){l.defaultValue!==f&&(l.defaultValue=f);return}l.defaultValue=v!=null?""+Ja(v):""}function ll(l,f,v,C){if(f==null){if(C!=null){if(v!=null)throw Error(S(92));if(Zi(C)){if(1<C.length)throw Error(S(93));C=C[0]}v=C}v==null&&(v=""),f=v}v=Ja(f),l.defaultValue=v,C=l.textContent,C===v&&C!==""&&C!==null&&(l.value=C)}function ma(l,f){if(f){var v=l.firstChild;if(v&&v===l.lastChild&&v.nodeType===3){v.nodeValue=f;return}}l.textContent=f}var ga=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Tc(l,f,v){var C=f.indexOf("--")===0;v==null||typeof v=="boolean"||v===""?C?l.setProperty(f,""):f==="float"?l.cssFloat="":l[f]="":C?l.setProperty(f,v):typeof v!="number"||v===0||ga.has(f)?f==="float"?l.cssFloat=v:l[f]=(""+v).trim():l[f]=v+"px"}function df(l,f,v){if(f!=null&&typeof f!="object")throw Error(S(62));if(l=l.style,v!=null){for(var C in v)!v.hasOwnProperty(C)||f!=null&&f.hasOwnProperty(C)||(C.indexOf("--")===0?l.setProperty(C,""):C==="float"?l.cssFloat="":l[C]="");for(var O in f)C=f[O],f.hasOwnProperty(O)&&v[O]!==C&&Tc(l,O,C)}else for(var U in f)f.hasOwnProperty(U)&&Tc(l,U,f[U])}function lu(l){if(l.indexOf("-")===-1)return!1;switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Sc=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),od=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ec(l){return od.test(""+l)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":l}var Ac=null;function Aa(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var Cc=null,Ol=null;function cu(l){var f=jn(l);if(f&&(l=f.stateNode)){var v=l[Je]||null;e:switch(l=f.stateNode,f.type){case"input":if(_o(l,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name),f=v.name,v.type==="radio"&&f!=null){for(v=l;v.parentNode;)v=v.parentNode;for(v=v.querySelectorAll('input[name="'+Ba(""+f)+'"][type="radio"]'),f=0;f<v.length;f++){var C=v[f];if(C!==l&&C.form===l.form){var O=C[Je]||null;if(!O)throw Error(S(90));_o(C,O.value,O.defaultValue,O.defaultValue,O.checked,O.defaultChecked,O.type,O.name)}}for(f=0;f<v.length;f++)C=v[f],C.form===l.form&&lh(C)}break e;case"textarea":yo(l,v.value,v.defaultValue);break e;case"select":f=v.value,f!=null&&Us(l,!!v.multiple,f,!1)}}}var uh=!1;function ff(l,f,v){if(uh)return l(f,v);uh=!0;try{var C=l(f);return C}finally{if(uh=!1,(Cc!==null||Ol!==null)&&(ca(),Cc&&(f=Cc,l=Ol,Ol=Cc=null,cu(f),l)))for(f=0;f<l.length;f++)cu(l[f])}}function Rc(l,f){var v=l.stateNode;if(v===null)return null;var C=v[Je]||null;if(C===null)return null;v=C[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(C=!C.disabled)||(l=l.type,C=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!C;break e;default:l=!1}if(l)return null;if(v&&typeof v!="function")throw Error(S(231,f,typeof v));return v}var wn=!1;if(bi)try{var cl={};Object.defineProperty(cl,"passive",{get:function(){wn=!0}}),window.addEventListener("test",cl,cl),window.removeEventListener("test",cl,cl)}catch{wn=!1}var kl=null,pf=null,uu=null;function Nl(){if(uu)return uu;var l,f=pf,v=f.length,C,O="value"in kl?kl.value:kl.textContent,U=O.length;for(l=0;l<v&&f[l]===O[l];l++);var ae=v-l;for(C=1;C<=ae&&f[v-C]===O[U-C];C++);return uu=O.slice(l,1<C?1-C:void 0)}function jl(l){var f=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&f===13&&(l=13)):l=f,l===10&&(l=13),32<=l||l===13?l:0}function Mc(){return!0}function ld(){return!1}function Ca(l){function f(v,C,O,U,ae){this._reactName=v,this._targetInst=O,this.type=C,this.nativeEvent=U,this.target=ae,this.currentTarget=null;for(var De in l)l.hasOwnProperty(De)&&(v=l[De],this[De]=v?v(U):U[De]);return this.isDefaultPrevented=(U.defaultPrevented!=null?U.defaultPrevented:U.returnValue===!1)?Mc:ld,this.isPropagationStopped=ld,this}return Lt(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var v=this.nativeEvent;v&&(v.preventDefault?v.preventDefault():typeof v.returnValue!="unknown"&&(v.returnValue=!1),this.isDefaultPrevented=Mc)},stopPropagation:function(){var v=this.nativeEvent;v&&(v.stopPropagation?v.stopPropagation():typeof v.cancelBubble!="unknown"&&(v.cancelBubble=!0),this.isPropagationStopped=Mc)},persist:function(){},isPersistent:Mc}),f}var Qa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cd=Ca(Qa),hu=Lt({},Qa,{view:0,detail:0}),hh=Ca(hu),dh,eo,Bl,du=Lt({},hu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xo,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==Bl&&(Bl&&l.type==="mousemove"?(dh=l.screenX-Bl.screenX,eo=l.screenY-Bl.screenY):eo=dh=0,Bl=l),dh)},movementY:function(l){return"movementY"in l?l.movementY:eo}}),Fa=Ca(du),fu=Lt({},du,{dataTransfer:0}),to=Ca(fu),wp=Lt({},hu,{relatedTarget:0}),fh=Ca(wp),Tp=Lt({},Qa,{animationName:0,elapsedTime:0,pseudoElement:0}),Vn=Ca(Tp),Sp=Lt({},Qa,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),Om=Ca(Sp),mf=Lt({},Qa,{data:0}),zi=Ca(mf),Ep={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},io={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Bo={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gf(l){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(l):(l=Bo[l])?!!f[l]:!1}function xo(){return gf}var _i=Lt({},hu,{key:function(l){if(l.key){var f=Ep[l.key]||l.key;if(f!=="Unidentified")return f}return l.type==="keypress"?(l=jl(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?io[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xo,charCode:function(l){return l.type==="keypress"?jl(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?jl(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),Hn=Ca(_i),Zn=Lt({},du,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ra=Ca(Zn),pu=Lt({},hu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xo}),Bn=Ca(pu),_f=Lt({},Qa,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ic=Ca(_f),ud=Lt({},du,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),ta=Ca(ud),ts=Lt({},Qa,{newState:0,oldState:0}),Wg=Ca(ts),hd=[9,13,27,32],dd=bi&&"CompositionEvent"in window,Fl=null;bi&&"documentMode"in document&&(Fl=document.documentMode);var fd=bi&&"TextEvent"in window&&!Fl,Ul=bi&&(!dd||Fl&&8<Fl&&11>=Fl),pd=" ",ia=!1;function vo(l,f){switch(l){case"keyup":return hd.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _a(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var mu=!1;function ph(l,f){switch(l){case"compositionend":return _a(f);case"keypress":return f.which!==32?null:(ia=!0,pd);case"textInput":return l=f.data,l===pd&&ia?null:l;default:return null}}function fs(l,f){if(mu)return l==="compositionend"||!dd&&vo(l,f)?(l=Nl(),uu=pf=kl=null,mu=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return Ul&&f.locale!=="ko"?null:f.data;default:return null}}var Ma={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tn(l){var f=l&&l.nodeName&&l.nodeName.toLowerCase();return f==="input"?!!Ma[l.type]:f==="textarea"}function ni(l,f,v,C){Cc?Ol?Ol.push(C):Ol=[C]:Cc=C,f=ng(f,"onChange"),0<f.length&&(v=new cd("onChange","change",null,v,C),l.push({event:v,listeners:f}))}var Vl=null,Ci=null;function gu(l){t_(l,0)}function Hl(l){var f=cn(l);if(lh(f))return l}function Ni(l,f){if(l==="change")return f}var yf=!1;if(bi){var _u;if(bi){var yu="oninput"in document;if(!yu){var xf=document.createElement("div");xf.setAttribute("oninput","return;"),yu=typeof xf.oninput=="function"}_u=yu}else _u=!1;yf=_u&&(!document.documentMode||9<document.documentMode)}function md(){Vl&&(Vl.detachEvent("onpropertychange",$r),Ci=Vl=null)}function $r(l){if(l.propertyName==="value"&&Hl(Ci)){var f=[];ni(f,Ci,l,Aa(l)),ff(gu,f)}}function Ap(l,f,v){l==="focusin"?(md(),Vl=f,Ci=v,Vl.attachEvent("onpropertychange",$r)):l==="focusout"&&md()}function ql(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return Hl(Ci)}function ya(l,f){if(l==="click")return Hl(f)}function zc(l,f){if(l==="input"||l==="change")return Hl(f)}function Os(l,f){return l===f&&(l!==0||1/l===1/f)||l!==l&&f!==f}var Ua=typeof Object.is=="function"?Object.is:Os;function Gl(l,f){if(Ua(l,f))return!0;if(typeof l!="object"||l===null||typeof f!="object"||f===null)return!1;var v=Object.keys(l),C=Object.keys(f);if(v.length!==C.length)return!1;for(C=0;C<v.length;C++){var O=v[C];if(!Un.call(f,O)||!Ua(l[O],f[O]))return!1}return!0}function km(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function gd(l,f){var v=km(l);l=0;for(var C;v;){if(v.nodeType===3){if(C=l+v.textContent.length,l<=f&&C>=f)return{node:v,offset:f-l};l=C}e:{for(;v;){if(v.nextSibling){v=v.nextSibling;break e}v=v.parentNode}v=void 0}v=km(v)}}function xu(l,f){return l&&f?l===f?!0:l&&l.nodeType===3?!1:f&&f.nodeType===3?xu(l,f.parentNode):"contains"in l?l.contains(f):l.compareDocumentPosition?!!(l.compareDocumentPosition(f)&16):!1:!1}function bo(l){l=l!=null&&l.ownerDocument!=null&&l.ownerDocument.defaultView!=null?l.ownerDocument.defaultView:window;for(var f=jo(l.document);f instanceof l.HTMLIFrameElement;){try{var v=typeof f.contentWindow.location.href=="string"}catch{v=!1}if(v)l=f.contentWindow;else break;f=jo(l.document)}return f}function Cp(l){var f=l&&l.nodeName&&l.nodeName.toLowerCase();return f&&(f==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||f==="textarea"||l.contentEditable==="true")}function mh(l,f){var v=bo(f);f=l.focusedElem;var C=l.selectionRange;if(v!==f&&f&&f.ownerDocument&&xu(f.ownerDocument.documentElement,f)){if(C!==null&&Cp(f)){if(l=C.start,v=C.end,v===void 0&&(v=l),"selectionStart"in f)f.selectionStart=l,f.selectionEnd=Math.min(v,f.value.length);else if(v=(l=f.ownerDocument||document)&&l.defaultView||window,v.getSelection){v=v.getSelection();var O=f.textContent.length,U=Math.min(C.start,O);C=C.end===void 0?U:Math.min(C.end,O),!v.extend&&U>C&&(O=C,C=U,U=O),O=gd(f,U);var ae=gd(f,C);O&&ae&&(v.rangeCount!==1||v.anchorNode!==O.node||v.anchorOffset!==O.offset||v.focusNode!==ae.node||v.focusOffset!==ae.offset)&&(l=l.createRange(),l.setStart(O.node,O.offset),v.removeAllRanges(),U>C?(v.addRange(l),v.extend(ae.node,ae.offset)):(l.setEnd(ae.node,ae.offset),v.addRange(l)))}}for(l=[],v=f;v=v.parentNode;)v.nodeType===1&&l.push({element:v,left:v.scrollLeft,top:v.scrollTop});for(typeof f.focus=="function"&&f.focus(),f=0;f<l.length;f++)v=l[f],v.element.scrollLeft=v.left,v.element.scrollTop=v.top}}var Nm=bi&&"documentMode"in document&&11>=document.documentMode,$l=null,gh=null,wo=null,Zl=!1;function jm(l,f,v){var C=v.window===v?v.document:v.nodeType===9?v:v.ownerDocument;Zl||$l==null||$l!==jo(C)||(C=$l,"selectionStart"in C&&Cp(C)?C={start:C.selectionStart,end:C.selectionEnd}:(C=(C.ownerDocument&&C.ownerDocument.defaultView||window).getSelection(),C={anchorNode:C.anchorNode,anchorOffset:C.anchorOffset,focusNode:C.focusNode,focusOffset:C.focusOffset}),wo&&Gl(wo,C)||(wo=C,C=ng(gh,"onSelect"),0<C.length&&(f=new cd("onSelect","select",null,f,v),l.push({event:f,listeners:C}),f.target=$l)))}function vu(l,f){var v={};return v[l.toLowerCase()]=f.toLowerCase(),v["Webkit"+l]="webkit"+f,v["Moz"+l]="moz"+f,v}var Wl={animationend:vu("Animation","AnimationEnd"),animationiteration:vu("Animation","AnimationIteration"),animationstart:vu("Animation","AnimationStart"),transitionrun:vu("Transition","TransitionRun"),transitionstart:vu("Transition","TransitionStart"),transitioncancel:vu("Transition","TransitionCancel"),transitionend:vu("Transition","TransitionEnd")},vf={},_d={};bi&&(_d=document.createElement("div").style,"AnimationEvent"in window||(delete Wl.animationend.animation,delete Wl.animationiteration.animation,delete Wl.animationstart.animation),"TransitionEvent"in window||delete Wl.transitionend.transition);function Vs(l){if(vf[l])return vf[l];if(!Wl[l])return l;var f=Wl[l],v;for(v in f)if(f.hasOwnProperty(v)&&v in _d)return vf[l]=f[v];return l}var Rp=Vs("animationend"),Mp=Vs("animationiteration"),Ip=Vs("animationstart"),bu=Vs("transitionrun"),yd=Vs("transitionstart"),zp=Vs("transitioncancel"),bf=Vs("transitionend"),wu=new Map,Tu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function no(l,f){wu.set(l,f),Bt(f,[l])}var Ia=[],Hs=0,_h=0;function Vt(){for(var l=Hs,f=_h=Hs=0;f<l;){var v=Ia[f];Ia[f++]=null;var C=Ia[f];Ia[f++]=null;var O=Ia[f];Ia[f++]=null;var U=Ia[f];if(Ia[f++]=null,C!==null&&O!==null){var ae=C.pending;ae===null?O.next=O:(O.next=ae.next,ae.next=O),C.pending=O}U!==0&&xh(v,O,U)}}function yh(l,f,v,C){Ia[Hs++]=l,Ia[Hs++]=f,Ia[Hs++]=v,Ia[Hs++]=C,_h|=C,l.lanes|=C,l=l.alternate,l!==null&&(l.lanes|=C)}function Dc(l,f,v,C){return yh(l,f,v,C),Pc(l)}function ro(l,f){return yh(l,null,null,f),Pc(l)}function xh(l,f,v){l.lanes|=v;var C=l.alternate;C!==null&&(C.lanes|=v);for(var O=!1,U=l.return;U!==null;)U.childLanes|=v,C=U.alternate,C!==null&&(C.childLanes|=v),U.tag===22&&(l=U.stateNode,l===null||l._visibility&1||(O=!0)),l=U,U=U.return;O&&f!==null&&l.tag===3&&(U=l.stateNode,O=31-hs(v),U=U.hiddenUpdates,l=U[O],l===null?U[O]=[f]:l.push(f),f.lane=v|536870912)}function Pc(l){if(50<Ji)throw Ji=0,Pi=null,Error(S(185));for(var f=l.return;f!==null;)l=f,f=l.return;return l.tag===3?l.stateNode:null}var za={},xd=new WeakMap;function os(l,f){if(typeof l=="object"&&l!==null){var v=xd.get(l);return v!==void 0?v:(f={value:l,source:f,stack:ki(f)},xd.set(l,f),f)}return{value:l,source:f,stack:ki(f)}}var pn=[],Fo=0,wf=null,Tf=0,Da=[],To=0,rr=null,ul=1,Uo="";function Su(l,f){pn[Fo++]=Tf,pn[Fo++]=wf,wf=l,Tf=f}function Bm(l,f,v){Da[To++]=ul,Da[To++]=Uo,Da[To++]=rr,rr=l;var C=ul;l=Uo;var O=32-hs(C)-1;C&=~(1<<O),v+=1;var U=32-hs(f)+O;if(30<U){var ae=O-O%5;U=(C&(1<<ae)-1).toString(32),C>>=ae,O-=ae,ul=1<<32-hs(f)+O|v<<O|C,Uo=U+l}else ul=1<<U|v<<O|C,Uo=l}function Dp(l){l.return!==null&&(Su(l,1),Bm(l,1,0))}function Pp(l){for(;l===wf;)wf=pn[--Fo],pn[Fo]=null,Tf=pn[--Fo],pn[Fo]=null;for(;l===rr;)rr=Da[--To],Da[To]=null,Uo=Da[--To],Da[To]=null,ul=Da[--To],Da[To]=null}var xa=null,na=null,xr=!1,Vo=null,Ho=!1,vd=Error(S(519));function hl(l){var f=Error(S(418,""));throw kc(os(f,l)),vd}function Sf(l){var f=l.stateNode,v=l.type,C=l.memoizedProps;switch(f[Be]=l,f[Je]=C,v){case"dialog":Ar("cancel",f),Ar("close",f);break;case"iframe":case"object":case"embed":Ar("load",f);break;case"video":case"audio":for(v=0;v<Yf.length;v++)Ar(Yf[v],f);break;case"source":Ar("error",f);break;case"img":case"image":case"link":Ar("error",f),Ar("load",f);break;case"details":Ar("toggle",f);break;case"input":Ar("invalid",f),hf(f,C.value,C.defaultValue,C.checked,C.defaultChecked,C.type,C.name,!0),wc(f);break;case"select":Ar("invalid",f);break;case"textarea":Ar("invalid",f),ll(f,C.value,C.defaultValue,C.children),wc(f)}v=C.children,typeof v!="string"&&typeof v!="number"&&typeof v!="bigint"||f.textContent===""+v||C.suppressHydrationWarning===!0||o_(f.textContent,v)?(C.popover!=null&&(Ar("beforetoggle",f),Ar("toggle",f)),C.onScroll!=null&&Ar("scroll",f),C.onScrollEnd!=null&&Ar("scrollend",f),C.onClick!=null&&(f.onclick=rm),f=!0):f=!1,f||hl(l)}function Lc(l){for(xa=l.return;xa;)switch(xa.tag){case 3:case 27:Ho=!0;return;case 5:case 13:Ho=!1;return;default:xa=xa.return}}function dl(l){if(l!==xa)return!1;if(!xr)return Lc(l),xr=!0,!1;var f=!1,v;if((v=l.tag!==3&&l.tag!==27)&&((v=l.tag===5)&&(v=l.type,v=!(v!=="form"&&v!=="button")||l_(l.type,l.memoizedProps)),v=!v),v&&(f=!0),f&&na&&hl(l),Lc(l),l.tag===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(S(317));e:{for(l=l.nextSibling,f=0;l;){if(l.nodeType===8)if(v=l.data,v==="/$"){if(f===0){na=rl(l.nextSibling);break e}f--}else v!=="$"&&v!=="$!"&&v!=="$?"||f++;l=l.nextSibling}na=null}}else na=xa?rl(l.stateNode.nextSibling):null;return!0}function Oc(){na=xa=null,xr=!1}function kc(l){Vo===null?Vo=[l]:Vo.push(l)}var fl=Error(S(460)),Lp=Error(S(474)),bd={then:function(){}};function Op(l){return l=l.status,l==="fulfilled"||l==="rejected"}function Xl(){}function wd(l,f,v){switch(v=l[v],v===void 0?l.push(f):v!==f&&(f.then(Xl,Xl),f=v),f.status){case"fulfilled":return f.value;case"rejected":throw l=f.reason,l===fl?Error(S(483)):l;default:if(typeof f.status=="string")f.then(Xl,Xl);else{if(l=nt,l!==null&&100<l.shellSuspendCounter)throw Error(S(482));l=f,l.status="pending",l.then(function(C){if(f.status==="pending"){var O=f;O.status="fulfilled",O.value=C}},function(C){if(f.status==="pending"){var O=f;O.status="rejected",O.reason=C}})}switch(f.status){case"fulfilled":return f.value;case"rejected":throw l=f.reason,l===fl?Error(S(483)):l}throw Nc=f,fl}}var Nc=null;function Ef(){if(Nc===null)throw Error(S(459));var l=Nc;return Nc=null,l}var Yl=null,Kl=0;function Td(l){var f=Kl;return Kl+=1,Yl===null&&(Yl=[]),wd(Yl,l,f)}function vh(l,f){f=f.props.ref,l.ref=f!==void 0?f:null}function Sd(l,f){throw f.$$typeof===N?Error(S(525)):(l=Object.prototype.toString.call(f),Error(S(31,l==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":l)))}function Jl(l){var f=l._init;return f(l._payload)}function kp(l){function f(Rt,mt){if(l){var Dt=Rt.deletions;Dt===null?(Rt.deletions=[mt],Rt.flags|=16):Dt.push(mt)}}function v(Rt,mt){if(!l)return null;for(;mt!==null;)f(Rt,mt),mt=mt.sibling;return null}function C(Rt){for(var mt=new Map;Rt!==null;)Rt.key!==null?mt.set(Rt.key,Rt):mt.set(Rt.index,Rt),Rt=Rt.sibling;return mt}function O(Rt,mt){return Rt=X(Rt,mt),Rt.index=0,Rt.sibling=null,Rt}function U(Rt,mt,Dt){return Rt.index=Dt,l?(Dt=Rt.alternate,Dt!==null?(Dt=Dt.index,Dt<mt?(Rt.flags|=33554434,mt):Dt):(Rt.flags|=33554434,mt)):(Rt.flags|=1048576,mt)}function ae(Rt){return l&&Rt.alternate===null&&(Rt.flags|=33554434),Rt}function De(Rt,mt,Dt,di){return mt===null||mt.tag!==6?(mt=we(Dt,Rt.mode,di),mt.return=Rt,mt):(mt=O(mt,Dt),mt.return=Rt,mt)}function Xe(Rt,mt,Dt,di){var un=Dt.type;return un===q?si(Rt,mt,Dt.props.children,di,Dt.key):mt!==null&&(mt.elementType===un||typeof un=="object"&&un!==null&&un.$$typeof===xe&&Jl(un)===mt.type)?(mt=O(mt,Dt.props),vh(mt,Dt),mt.return=Rt,mt):(mt=ce(Dt.type,Dt.key,Dt.props,null,Rt.mode,di),vh(mt,Dt),mt.return=Rt,mt)}function gt(Rt,mt,Dt,di){return mt===null||mt.tag!==4||mt.stateNode.containerInfo!==Dt.containerInfo||mt.stateNode.implementation!==Dt.implementation?(mt=Ee(Dt,Rt.mode,di),mt.return=Rt,mt):(mt=O(mt,Dt.children||[]),mt.return=Rt,mt)}function si(Rt,mt,Dt,di,un){return mt===null||mt.tag!==7?(mt=de(Dt,Rt.mode,di,un),mt.return=Rt,mt):(mt=O(mt,Dt),mt.return=Rt,mt)}function yi(Rt,mt,Dt){if(typeof mt=="string"&&mt!==""||typeof mt=="number"||typeof mt=="bigint")return mt=we(""+mt,Rt.mode,Dt),mt.return=Rt,mt;if(typeof mt=="object"&&mt!==null){switch(mt.$$typeof){case V:return Dt=ce(mt.type,mt.key,mt.props,null,Rt.mode,Dt),vh(Dt,mt),Dt.return=Rt,Dt;case s:return mt=Ee(mt,Rt.mode,Dt),mt.return=Rt,mt;case xe:var di=mt._init;return mt=di(mt._payload),yi(Rt,mt,Dt)}if(Zi(mt)||Ke(mt))return mt=de(mt,Rt.mode,Dt,null),mt.return=Rt,mt;if(typeof mt.then=="function")return yi(Rt,Td(mt),Dt);if(mt.$$typeof===ze)return yi(Rt,cc(Rt,mt),Dt);Sd(Rt,mt)}return null}function Ut(Rt,mt,Dt,di){var un=mt!==null?mt.key:null;if(typeof Dt=="string"&&Dt!==""||typeof Dt=="number"||typeof Dt=="bigint")return un!==null?null:De(Rt,mt,""+Dt,di);if(typeof Dt=="object"&&Dt!==null){switch(Dt.$$typeof){case V:return Dt.key===un?Xe(Rt,mt,Dt,di):null;case s:return Dt.key===un?gt(Rt,mt,Dt,di):null;case xe:return un=Dt._init,Dt=un(Dt._payload),Ut(Rt,mt,Dt,di)}if(Zi(Dt)||Ke(Dt))return un!==null?null:si(Rt,mt,Dt,di,null);if(typeof Dt.then=="function")return Ut(Rt,mt,Td(Dt),di);if(Dt.$$typeof===ze)return Ut(Rt,mt,cc(Rt,Dt),di);Sd(Rt,Dt)}return null}function ti(Rt,mt,Dt,di,un){if(typeof di=="string"&&di!==""||typeof di=="number"||typeof di=="bigint")return Rt=Rt.get(Dt)||null,De(mt,Rt,""+di,un);if(typeof di=="object"&&di!==null){switch(di.$$typeof){case V:return Rt=Rt.get(di.key===null?Dt:di.key)||null,Xe(mt,Rt,di,un);case s:return Rt=Rt.get(di.key===null?Dt:di.key)||null,gt(mt,Rt,di,un);case xe:var mr=di._init;return di=mr(di._payload),ti(Rt,mt,Dt,di,un)}if(Zi(di)||Ke(di))return Rt=Rt.get(Dt)||null,si(mt,Rt,di,un,null);if(typeof di.then=="function")return ti(Rt,mt,Dt,Td(di),un);if(di.$$typeof===ze)return ti(Rt,mt,Dt,cc(mt,di),un);Sd(mt,di)}return null}function xn(Rt,mt,Dt,di){for(var un=null,mr=null,Tn=mt,Ln=mt=0,Is=null;Tn!==null&&Ln<Dt.length;Ln++){Tn.index>Ln?(Is=Tn,Tn=null):Is=Tn.sibling;var Ir=Ut(Rt,Tn,Dt[Ln],di);if(Ir===null){Tn===null&&(Tn=Is);break}l&&Tn&&Ir.alternate===null&&f(Rt,Tn),mt=U(Ir,mt,Ln),mr===null?un=Ir:mr.sibling=Ir,mr=Ir,Tn=Is}if(Ln===Dt.length)return v(Rt,Tn),xr&&Su(Rt,Ln),un;if(Tn===null){for(;Ln<Dt.length;Ln++)Tn=yi(Rt,Dt[Ln],di),Tn!==null&&(mt=U(Tn,mt,Ln),mr===null?un=Tn:mr.sibling=Tn,mr=Tn);return xr&&Su(Rt,Ln),un}for(Tn=C(Tn);Ln<Dt.length;Ln++)Is=ti(Tn,Rt,Ln,Dt[Ln],di),Is!==null&&(l&&Is.alternate!==null&&Tn.delete(Is.key===null?Ln:Is.key),mt=U(Is,mt,Ln),mr===null?un=Is:mr.sibling=Is,mr=Is);return l&&Tn.forEach(function(zo){return f(Rt,zo)}),xr&&Su(Rt,Ln),un}function Xn(Rt,mt,Dt,di){if(Dt==null)throw Error(S(151));for(var un=null,mr=null,Tn=mt,Ln=mt=0,Is=null,Ir=Dt.next();Tn!==null&&!Ir.done;Ln++,Ir=Dt.next()){Tn.index>Ln?(Is=Tn,Tn=null):Is=Tn.sibling;var zo=Ut(Rt,Tn,Ir.value,di);if(zo===null){Tn===null&&(Tn=Is);break}l&&Tn&&zo.alternate===null&&f(Rt,Tn),mt=U(zo,mt,Ln),mr===null?un=zo:mr.sibling=zo,mr=zo,Tn=Is}if(Ir.done)return v(Rt,Tn),xr&&Su(Rt,Ln),un;if(Tn===null){for(;!Ir.done;Ln++,Ir=Dt.next())Ir=yi(Rt,Ir.value,di),Ir!==null&&(mt=U(Ir,mt,Ln),mr===null?un=Ir:mr.sibling=Ir,mr=Ir);return xr&&Su(Rt,Ln),un}for(Tn=C(Tn);!Ir.done;Ln++,Ir=Dt.next())Ir=ti(Tn,Rt,Ln,Ir.value,di),Ir!==null&&(l&&Ir.alternate!==null&&Tn.delete(Ir.key===null?Ln:Ir.key),mt=U(Ir,mt,Ln),mr===null?un=Ir:mr.sibling=Ir,mr=Ir);return l&&Tn.forEach(function(lp){return f(Rt,lp)}),xr&&Su(Rt,Ln),un}function cs(Rt,mt,Dt,di){if(typeof Dt=="object"&&Dt!==null&&Dt.type===q&&Dt.key===null&&(Dt=Dt.props.children),typeof Dt=="object"&&Dt!==null){switch(Dt.$$typeof){case V:e:{for(var un=Dt.key;mt!==null;){if(mt.key===un){if(un=Dt.type,un===q){if(mt.tag===7){v(Rt,mt.sibling),di=O(mt,Dt.props.children),di.return=Rt,Rt=di;break e}}else if(mt.elementType===un||typeof un=="object"&&un!==null&&un.$$typeof===xe&&Jl(un)===mt.type){v(Rt,mt.sibling),di=O(mt,Dt.props),vh(di,Dt),di.return=Rt,Rt=di;break e}v(Rt,mt);break}else f(Rt,mt);mt=mt.sibling}Dt.type===q?(di=de(Dt.props.children,Rt.mode,di,Dt.key),di.return=Rt,Rt=di):(di=ce(Dt.type,Dt.key,Dt.props,null,Rt.mode,di),vh(di,Dt),di.return=Rt,Rt=di)}return ae(Rt);case s:e:{for(un=Dt.key;mt!==null;){if(mt.key===un)if(mt.tag===4&&mt.stateNode.containerInfo===Dt.containerInfo&&mt.stateNode.implementation===Dt.implementation){v(Rt,mt.sibling),di=O(mt,Dt.children||[]),di.return=Rt,Rt=di;break e}else{v(Rt,mt);break}else f(Rt,mt);mt=mt.sibling}di=Ee(Dt,Rt.mode,di),di.return=Rt,Rt=di}return ae(Rt);case xe:return un=Dt._init,Dt=un(Dt._payload),cs(Rt,mt,Dt,di)}if(Zi(Dt))return xn(Rt,mt,Dt,di);if(Ke(Dt)){if(un=Ke(Dt),typeof un!="function")throw Error(S(150));return Dt=un.call(Dt),Xn(Rt,mt,Dt,di)}if(typeof Dt.then=="function")return cs(Rt,mt,Td(Dt),di);if(Dt.$$typeof===ze)return cs(Rt,mt,cc(Rt,Dt),di);Sd(Rt,Dt)}return typeof Dt=="string"&&Dt!==""||typeof Dt=="number"||typeof Dt=="bigint"?(Dt=""+Dt,mt!==null&&mt.tag===6?(v(Rt,mt.sibling),di=O(mt,Dt),di.return=Rt,Rt=di):(v(Rt,mt),di=we(Dt,Rt.mode,di),di.return=Rt,Rt=di),ae(Rt)):v(Rt,mt)}return function(Rt,mt,Dt,di){try{Kl=0;var un=cs(Rt,mt,Dt,di);return Yl=null,un}catch(Tn){if(Tn===fl)throw Tn;var mr=G(29,Tn,null,Rt.mode);return mr.lanes=di,mr.return=Rt,mr}finally{}}}var jc=kp(!0),Fm=kp(!1),bh=Ii(null),wh=Ii(0);function Ed(l,f){l=oi,St(wh,l),St(bh,f),oi=l|f.baseLanes}function Th(){St(wh,oi),St(bh,bh.current)}function pl(){oi=wh.current,xt(bh),xt(wh)}var Va=Ii(null),So=null;function Bc(l){var f=l.alternate;St(zr,zr.current&1),St(Va,l),So===null&&(f===null||bh.current!==null||f.memoizedState!==null)&&(So=l)}function Fc(l){if(l.tag===22){if(St(zr,zr.current),St(Va,l),So===null){var f=l.alternate;f!==null&&f.memoizedState!==null&&(So=l)}}else Ha()}function Ha(){St(zr,zr.current),St(Va,Va.current)}function ml(l){xt(Va),So===l&&(So=null),xt(zr)}var zr=Ii(0);function Eu(l){for(var f=l;f!==null;){if(f.tag===13){var v=f.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||v.data==="$?"||v.data==="$!"))return f}else if(f.tag===19&&f.memoizedProps.revealOrder!==void 0){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}var Ad=typeof AbortController<"u"?AbortController:function(){var l=[],f=this.signal={aborted:!1,addEventListener:function(v,C){l.push(C)}};this.abort=function(){f.aborted=!0,l.forEach(function(v){return v()})}},Af=h.unstable_scheduleCallback,Np=h.unstable_NormalPriority,Ts={$$typeof:ze,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Sh(){return{controller:new Ad,data:new Map,refCount:0}}function Ql(l){l.refCount--,l.refCount===0&&Af(Np,function(){l.controller.abort()})}var gl=null,Cd=0,_l=0,Uc=null;function Um(l,f){if(gl===null){var v=gl=[];Cd=0,_l=Xf(),Uc={status:"pending",value:void 0,then:function(C){v.push(C)}}}return Cd++,f.then(Cf,Cf),f}function Cf(){if(--Cd===0&&gl!==null){Uc!==null&&(Uc.status="fulfilled");var l=gl;gl=null,_l=0,Uc=null;for(var f=0;f<l.length;f++)(0,l[f])()}}function Au(l,f){var v=[],C={status:"pending",value:null,reason:null,then:function(O){v.push(O)}};return l.then(function(){C.status="fulfilled",C.value=f;for(var O=0;O<v.length;O++)(0,v[O])(f)},function(O){for(C.status="rejected",C.reason=O,O=0;O<v.length;O++)(0,v[O])(void 0)}),C}var Vm=ut.S;ut.S=function(l,f){typeof f=="object"&&f!==null&&typeof f.then=="function"&&Um(l,f),Vm!==null&&Vm(l,f)};var Cu=Ii(null);function jp(){var l=Cu.current;return l!==null?l:nt.pooledCache}function Ru(l,f){f===null?St(Cu,Cu.current):St(Cu,f.pool)}function Hm(){var l=jp();return l===null?null:{parent:Ts._currentValue,pool:l}}var Vc=0,Jn=null,kr=null,ps=null,ec=!1,Mu=!1,tc=!1,Eh=0,Hc=0,Eo=null,Iu=0;function Hr(){throw Error(S(321))}function Rd(l,f){if(f===null)return!1;for(var v=0;v<f.length&&v<l.length;v++)if(!Ua(l[v],f[v]))return!1;return!0}function Ah(l,f,v,C,O,U){return Vc=U,Jn=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,ut.H=l===null||l.memoizedState===null?sa:ao,tc=!1,U=v(C,O),tc=!1,Mu&&(U=Mf(f,v,C,O)),Rf(l),U}function Rf(l){ut.H=Wo;var f=kr!==null&&kr.next!==null;if(Vc=0,ps=kr=Jn=null,ec=!1,Hc=0,Eo=null,f)throw Error(S(300));l===null||ls||(l=l.dependencies,l!==null&&Bu(l)&&(ls=!0))}function Mf(l,f,v,C){Jn=l;var O=0;do{if(Mu&&(Eo=null),Hc=0,Mu=!1,25<=O)throw Error(S(301));if(O+=1,ps=kr=null,l.updateQueue!=null){var U=l.updateQueue;U.lastEffect=null,U.events=null,U.stores=null,U.memoCache!=null&&(U.memoCache.index=0)}ut.H=Wc,U=f(v,C)}while(Mu);return U}function If(){var l=ut.H,f=l.useState()[0];return f=typeof f.then=="function"?Mh(f):f,l=l.useState()[0],(kr!==null?kr.memoizedState:null)!==l&&(Jn.flags|=1024),f}function Ch(){var l=Eh!==0;return Eh=0,l}function Md(l,f,v){f.updateQueue=l.updateQueue,f.flags&=-2053,l.lanes&=~v}function Rh(l){if(ec){for(l=l.memoizedState;l!==null;){var f=l.queue;f!==null&&(f.pending=null),l=l.next}ec=!1}Vc=0,ps=kr=Jn=null,Mu=!1,Hc=Eh=0,Eo=null}function ks(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ps===null?Jn.memoizedState=ps=l:ps=ps.next=l,ps}function Cs(){if(kr===null){var l=Jn.alternate;l=l!==null?l.memoizedState:null}else l=kr.next;var f=ps===null?Jn.memoizedState:ps.next;if(f!==null)ps=f,kr=l;else{if(l===null)throw Jn.alternate===null?Error(S(467)):Error(S(310));kr=l,l={memoizedState:kr.memoizedState,baseState:kr.baseState,baseQueue:kr.baseQueue,queue:kr.queue,next:null},ps===null?Jn.memoizedState=ps=l:ps=ps.next=l}return ps}var qo;qo=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function Mh(l){var f=Hc;return Hc+=1,Eo===null&&(Eo=[]),l=wd(Eo,l,f),f=Jn,(ps===null?f.memoizedState:ps.next)===null&&(f=f.alternate,ut.H=f===null||f.memoizedState===null?sa:ao),l}function zf(l){if(l!==null&&typeof l=="object"){if(typeof l.then=="function")return Mh(l);if(l.$$typeof===ze)return Gs(l)}throw Error(S(438,String(l)))}function Ih(l){var f=null,v=Jn.updateQueue;if(v!==null&&(f=v.memoCache),f==null){var C=Jn.alternate;C!==null&&(C=C.updateQueue,C!==null&&(C=C.memoCache,C!=null&&(f={data:C.data.map(function(O){return O.slice()}),index:0})))}if(f==null&&(f={data:[],index:0}),v===null&&(v=qo(),Jn.updateQueue=v),v.memoCache=f,v=f.data[f.index],v===void 0)for(v=f.data[f.index]=Array(l),C=0;C<l;C++)v[C]=Pe;return f.index++,v}function Go(l,f){return typeof f=="function"?f(l):f}function so(l){var f=Cs();return zu(f,kr,l)}function zu(l,f,v){var C=l.queue;if(C===null)throw Error(S(311));C.lastRenderedReducer=v;var O=l.baseQueue,U=C.pending;if(U!==null){if(O!==null){var ae=O.next;O.next=U.next,U.next=ae}f.baseQueue=O=U,C.pending=null}if(U=l.baseState,O===null)l.memoizedState=U;else{f=O.next;var De=ae=null,Xe=null,gt=f,si=!1;do{var yi=gt.lane&-536870913;if(yi!==gt.lane?(ht&yi)===yi:(Vc&yi)===yi){var Ut=gt.revertLane;if(Ut===0)Xe!==null&&(Xe=Xe.next={lane:0,revertLane:0,action:gt.action,hasEagerState:gt.hasEagerState,eagerState:gt.eagerState,next:null}),yi===_l&&(si=!0);else if((Vc&Ut)===Ut){gt=gt.next,Ut===_l&&(si=!0);continue}else yi={lane:0,revertLane:gt.revertLane,action:gt.action,hasEagerState:gt.hasEagerState,eagerState:gt.eagerState,next:null},Xe===null?(De=Xe=yi,ae=U):Xe=Xe.next=yi,Jn.lanes|=Ut,li|=Ut;yi=gt.action,tc&&v(U,yi),U=gt.hasEagerState?gt.eagerState:v(U,yi)}else Ut={lane:yi,revertLane:gt.revertLane,action:gt.action,hasEagerState:gt.hasEagerState,eagerState:gt.eagerState,next:null},Xe===null?(De=Xe=Ut,ae=U):Xe=Xe.next=Ut,Jn.lanes|=yi,li|=yi;gt=gt.next}while(gt!==null&&gt!==f);if(Xe===null?ae=U:Xe.next=De,!Ua(U,l.memoizedState)&&(ls=!0,si&&(v=Uc,v!==null)))throw v;l.memoizedState=U,l.baseState=ae,l.baseQueue=Xe,C.lastRenderedState=U}return O===null&&(C.lanes=0),[l.memoizedState,C.dispatch]}function yl(l){var f=Cs(),v=f.queue;if(v===null)throw Error(S(311));v.lastRenderedReducer=l;var C=v.dispatch,O=v.pending,U=f.memoizedState;if(O!==null){v.pending=null;var ae=O=O.next;do U=l(U,ae.action),ae=ae.next;while(ae!==O);Ua(U,f.memoizedState)||(ls=!0),f.memoizedState=U,f.baseQueue===null&&(f.baseState=U),v.lastRenderedState=U}return[U,C]}function Df(l,f,v){var C=Jn,O=Cs(),U=xr;if(U){if(v===void 0)throw Error(S(407));v=v()}else v=f();var ae=!Ua((kr||O).memoizedState,v);if(ae&&(O.memoizedState=v,ls=!0),O=O.queue,qs(zh.bind(null,C,O,l),[l]),O.getSnapshot!==f||ae||ps!==null&&ps.memoizedState.tag&1){if(C.flags|=2048,Pu(9,zd.bind(null,C,O,v,f),{destroy:void 0},null),nt===null)throw Error(S(349));U||(Vc&60)!==0||Id(C,f,v)}return v}function Id(l,f,v){l.flags|=16384,l={getSnapshot:f,value:v},f=Jn.updateQueue,f===null?(f=qo(),Jn.updateQueue=f,f.stores=[l]):(v=f.stores,v===null?f.stores=[l]:v.push(l))}function zd(l,f,v,C){f.value=v,f.getSnapshot=C,Dd(f)&&Bp(l)}function zh(l,f,v){return v(function(){Dd(f)&&Bp(l)})}function Dd(l){var f=l.getSnapshot;l=l.value;try{var v=f();return!Ua(l,v)}catch{return!0}}function Bp(l){var f=ro(l,2);f!==null&&kn(f,l,2)}function ic(l){var f=ks();if(typeof l=="function"){var v=l;if(l=v(),tc){Ls(!0);try{v()}finally{Ls(!1)}}}return f.memoizedState=f.baseState=l,f.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Go,lastRenderedState:l},f}function Du(l,f,v,C){return l.baseState=v,zu(l,kr,typeof C=="function"?C:Go)}function ri(l,f,v,C,O){if(bl(l))throw Error(S(485));if(l=f.action,l!==null){var U={payload:O,action:l,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ae){U.listeners.push(ae)}};ut.T!==null?v(!0):U.isTransition=!1,C(U),v=f.pending,v===null?(U.next=f.pending=U,Pf(f,U)):(U.next=v.next,f.pending=v.next=U)}}function Pf(l,f){var v=f.action,C=f.payload,O=l.state;if(f.isTransition){var U=ut.T,ae={};ut.T=ae;try{var De=v(O,C),Xe=ut.S;Xe!==null&&Xe(ae,De),xl(l,f,De)}catch(gt){vl(l,f,gt)}finally{ut.T=U}}else try{U=v(O,C),xl(l,f,U)}catch(gt){vl(l,f,gt)}}function xl(l,f,v){v!==null&&typeof v=="object"&&typeof v.then=="function"?v.then(function(C){nc(l,f,C)},function(C){return vl(l,f,C)}):nc(l,f,v)}function nc(l,f,v){f.status="fulfilled",f.value=v,Ri(f),l.state=v,f=l.pending,f!==null&&(v=f.next,v===f?l.pending=null:(v=v.next,f.next=v,Pf(l,v)))}function vl(l,f,v){var C=l.pending;if(l.pending=null,C!==null){C=C.next;do f.status="rejected",f.reason=v,Ri(f),f=f.next;while(f!==C)}l.action=null}function Ri(l){l=l.listeners;for(var f=0;f<l.length;f++)(0,l[f])()}function Lf(l,f){return f}function Fp(l,f){if(xr){var v=nt.formState;if(v!==null){e:{var C=Jn;if(xr){if(na){t:{for(var O=na,U=Ho;O.nodeType!==8;){if(!U){O=null;break t}if(O=rl(O.nextSibling),O===null){O=null;break t}}U=O.data,O=U==="F!"||U==="F"?O:null}if(O){na=rl(O.nextSibling),C=O.data==="F!";break e}}hl(C)}C=!1}C&&(f=v[0])}}return v=ks(),v.memoizedState=v.baseState=f,C={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Lf,lastRenderedState:f},v.queue=C,v=Rr.bind(null,Jn,C),C.dispatch=v,C=ic(!1),U=Lh.bind(null,Jn,!1,C.queue),C=ks(),O={state:f,dispatch:null,action:l,pending:null},C.queue=O,v=ri.bind(null,Jn,O,U,v),O.dispatch=v,C.memoizedState=l,[f,v,!1]}function Pd(l){var f=Cs();return Ld(f,kr,l)}function Ld(l,f,v){f=zu(l,f,Lf)[0],l=so(Go)[0],f=typeof f=="object"&&f!==null&&typeof f.then=="function"?Mh(f):f;var C=Cs(),O=C.queue,U=O.dispatch;return v!==C.memoizedState&&(Jn.flags|=2048,Pu(9,Of.bind(null,O,v),{destroy:void 0},null)),[f,U,l]}function Of(l,f){l.action=f}function qm(l){var f=Cs(),v=kr;if(v!==null)return Ld(f,v,l);Cs(),f=f.memoizedState,v=Cs();var C=v.queue.dispatch;return v.memoizedState=l,[f,C,!1]}function Pu(l,f,v,C){return l={tag:l,create:f,inst:v,deps:C,next:null},f=Jn.updateQueue,f===null&&(f=qo(),Jn.updateQueue=f),v=f.lastEffect,v===null?f.lastEffect=l.next=l:(C=v.next,v.next=l,l.next=C,f.lastEffect=l),l}function Gm(){return Cs().memoizedState}function kf(l,f,v,C){var O=ks();Jn.flags|=l,O.memoizedState=Pu(1|f,v,{destroy:void 0},C===void 0?null:C)}function ra(l,f,v,C){var O=Cs();C=C===void 0?null:C;var U=O.memoizedState.inst;kr!==null&&C!==null&&Rd(C,kr.memoizedState.deps)?O.memoizedState=Pu(f,v,U,C):(Jn.flags|=l,O.memoizedState=Pu(1|f,v,U,C))}function Nf(l,f){kf(8390656,8,l,f)}function qs(l,f){ra(2048,8,l,f)}function rc(l,f){return ra(4,2,l,f)}function Up(l,f){return ra(4,4,l,f)}function jf(l,f){if(typeof f=="function"){l=l();var v=f(l);return function(){typeof v=="function"?v():f(null)}}if(f!=null)return l=l(),f.current=l,function(){f.current=null}}function Bf(l,f,v){v=v!=null?v.concat([l]):null,ra(4,4,jf.bind(null,f,l),v)}function Dh(){}function qc(l,f){var v=Cs();f=f===void 0?null:f;var C=v.memoizedState;return f!==null&&Rd(f,C[1])?C[0]:(v.memoizedState=[l,f],l)}function $o(l,f){var v=Cs();f=f===void 0?null:f;var C=v.memoizedState;if(f!==null&&Rd(f,C[1]))return C[0];if(C=l(),tc){Ls(!0);try{l()}finally{Ls(!1)}}return v.memoizedState=[C,f],C}function ir(l,f,v){return v===void 0||(Vc&1073741824)!==0?l.memoizedState=f:(l.memoizedState=v,l=Mr(),Jn.lanes|=l,li|=l,v)}function Gc(l,f,v,C){return Ua(v,f)?v:bh.current!==null?(l=ir(l,v,C),Ua(l,f)||(ls=!0),l):(Vc&42)===0?(ls=!0,l.memoizedState=v):(l=Mr(),Jn.lanes|=l,li|=l,f)}function Ff(l,f,v,C,O){var U=ii.p;ii.p=U!==0&&8>U?U:8;var ae=ut.T,De={};ut.T=De,Lh(l,!1,f,v);try{var Xe=O(),gt=ut.S;if(gt!==null&&gt(De,Xe),Xe!==null&&typeof Xe=="object"&&typeof Xe.then=="function"){var si=Au(Xe,C);qe(l,f,si,vn(l))}else qe(l,f,C,vn(l))}catch(yi){qe(l,f,{then:function(){},status:"rejected",reason:yi},vn())}finally{ii.p=U,ut.T=ae}}function $m(){}function Zo(l,f,v,C){if(l.tag!==5)throw Error(S(476));var O=Uf(l).queue;Ff(l,O,f,Yi,v===null?$m:function(){return $c(l),v(C)})}function Uf(l){var f=l.memoizedState;if(f!==null)return f;f={memoizedState:Yi,baseState:Yi,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Go,lastRenderedState:Yi},next:null};var v={};return f.next={memoizedState:v,baseState:v,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Go,lastRenderedState:v},next:null},l.memoizedState=f,l=l.alternate,l!==null&&(l.memoizedState=f),f}function $c(l){var f=Uf(l).next.queue;qe(l,f,{},vn())}function sc(){return Gs(um)}function Zc(){return Cs().memoizedState}function kt(){return Cs().memoizedState}function Yt(l){for(var f=l.return;f!==null;){switch(f.tag){case 24:case 3:var v=vn();l=uc(v);var C=Ko(f,l,v);C!==null&&(kn(C,f,v),Bh(C,f,v)),f={cache:Sh()},l.payload=f;return}f=f.return}}function Ph(l,f,v){var C=vn();v={lane:C,revertLane:0,action:v,hasEagerState:!1,eagerState:null,next:null},bl(l)?Od(f,v):(v=Dc(l,f,v,C),v!==null&&(kn(v,l,C),Oh(v,f,C)))}function Rr(l,f,v){var C=vn();qe(l,f,v,C)}function qe(l,f,v,C){var O={lane:C,revertLane:0,action:v,hasEagerState:!1,eagerState:null,next:null};if(bl(l))Od(f,O);else{var U=l.alternate;if(l.lanes===0&&(U===null||U.lanes===0)&&(U=f.lastRenderedReducer,U!==null))try{var ae=f.lastRenderedState,De=U(ae,v);if(O.hasEagerState=!0,O.eagerState=De,Ua(De,ae))return yh(l,f,O,0),nt===null&&Vt(),!1}catch{}finally{}if(v=Dc(l,f,O,C),v!==null)return kn(v,l,C),Oh(v,f,C),!0}return!1}function Lh(l,f,v,C){if(C={lane:2,revertLane:Xf(),action:C,hasEagerState:!1,eagerState:null,next:null},bl(l)){if(f)throw Error(S(479))}else f=Dc(l,v,C,2),f!==null&&kn(f,l,2)}function bl(l){var f=l.alternate;return l===Jn||f!==null&&f===Jn}function Od(l,f){Mu=ec=!0;var v=l.pending;v===null?f.next=f:(f.next=v.next,v.next=f),l.pending=f}function Oh(l,f,v){if((v&4194176)!==0){var C=f.lanes;C&=l.pendingLanes,v|=C,f.lanes=v,_e(l,v)}}var Wo={readContext:Gs,use:zf,useCallback:Hr,useContext:Hr,useEffect:Hr,useImperativeHandle:Hr,useLayoutEffect:Hr,useInsertionEffect:Hr,useMemo:Hr,useReducer:Hr,useRef:Hr,useState:Hr,useDebugValue:Hr,useDeferredValue:Hr,useTransition:Hr,useSyncExternalStore:Hr,useId:Hr};Wo.useCacheRefresh=Hr,Wo.useMemoCache=Hr,Wo.useHostTransitionStatus=Hr,Wo.useFormState=Hr,Wo.useActionState=Hr,Wo.useOptimistic=Hr;var sa={readContext:Gs,use:zf,useCallback:function(l,f){return ks().memoizedState=[l,f===void 0?null:f],l},useContext:Gs,useEffect:Nf,useImperativeHandle:function(l,f,v){v=v!=null?v.concat([l]):null,kf(4194308,4,jf.bind(null,f,l),v)},useLayoutEffect:function(l,f){return kf(4194308,4,l,f)},useInsertionEffect:function(l,f){kf(4,2,l,f)},useMemo:function(l,f){var v=ks();f=f===void 0?null:f;var C=l();if(tc){Ls(!0);try{l()}finally{Ls(!1)}}return v.memoizedState=[C,f],C},useReducer:function(l,f,v){var C=ks();if(v!==void 0){var O=v(f);if(tc){Ls(!0);try{v(f)}finally{Ls(!1)}}}else O=f;return C.memoizedState=C.baseState=O,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:O},C.queue=l,l=l.dispatch=Ph.bind(null,Jn,l),[C.memoizedState,l]},useRef:function(l){var f=ks();return l={current:l},f.memoizedState=l},useState:function(l){l=ic(l);var f=l.queue,v=Rr.bind(null,Jn,f);return f.dispatch=v,[l.memoizedState,v]},useDebugValue:Dh,useDeferredValue:function(l,f){var v=ks();return ir(v,l,f)},useTransition:function(){var l=ic(!1);return l=Ff.bind(null,Jn,l.queue,!0,!1),ks().memoizedState=l,[!1,l]},useSyncExternalStore:function(l,f,v){var C=Jn,O=ks();if(xr){if(v===void 0)throw Error(S(407));v=v()}else{if(v=f(),nt===null)throw Error(S(349));(ht&60)!==0||Id(C,f,v)}O.memoizedState=v;var U={value:v,getSnapshot:f};return O.queue=U,Nf(zh.bind(null,C,U,l),[l]),C.flags|=2048,Pu(9,zd.bind(null,C,U,v,f),{destroy:void 0},null),v},useId:function(){var l=ks(),f=nt.identifierPrefix;if(xr){var v=Uo,C=ul;v=(C&~(1<<32-hs(C)-1)).toString(32)+v,f=":"+f+"R"+v,v=Eh++,0<v&&(f+="H"+v.toString(32)),f+=":"}else v=Iu++,f=":"+f+"r"+v.toString(32)+":";return l.memoizedState=f},useCacheRefresh:function(){return ks().memoizedState=Yt.bind(null,Jn)}};sa.useMemoCache=Ih,sa.useHostTransitionStatus=sc,sa.useFormState=Fp,sa.useActionState=Fp,sa.useOptimistic=function(l){var f=ks();f.memoizedState=f.baseState=l;var v={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return f.queue=v,f=Lh.bind(null,Jn,!0,v),v.dispatch=f,[l,f]};var ao={readContext:Gs,use:zf,useCallback:qc,useContext:Gs,useEffect:qs,useImperativeHandle:Bf,useInsertionEffect:rc,useLayoutEffect:Up,useMemo:$o,useReducer:so,useRef:Gm,useState:function(){return so(Go)},useDebugValue:Dh,useDeferredValue:function(l,f){var v=Cs();return Gc(v,kr.memoizedState,l,f)},useTransition:function(){var l=so(Go)[0],f=Cs().memoizedState;return[typeof l=="boolean"?l:Mh(l),f]},useSyncExternalStore:Df,useId:Zc};ao.useCacheRefresh=kt,ao.useMemoCache=Ih,ao.useHostTransitionStatus=sc,ao.useFormState=Pd,ao.useActionState=Pd,ao.useOptimistic=function(l,f){var v=Cs();return Du(v,kr,l,f)};var Wc={readContext:Gs,use:zf,useCallback:qc,useContext:Gs,useEffect:qs,useImperativeHandle:Bf,useInsertionEffect:rc,useLayoutEffect:Up,useMemo:$o,useReducer:yl,useRef:Gm,useState:function(){return yl(Go)},useDebugValue:Dh,useDeferredValue:function(l,f){var v=Cs();return kr===null?ir(v,l,f):Gc(v,kr.memoizedState,l,f)},useTransition:function(){var l=yl(Go)[0],f=Cs().memoizedState;return[typeof l=="boolean"?l:Mh(l),f]},useSyncExternalStore:Df,useId:Zc};Wc.useCacheRefresh=kt,Wc.useMemoCache=Ih,Wc.useHostTransitionStatus=sc,Wc.useFormState=qm,Wc.useActionState=qm,Wc.useOptimistic=function(l,f){var v=Cs();return kr!==null?Du(v,kr,l,f):(v.baseState=l,[l,v.queue.dispatch])};function Vp(l,f,v,C){f=l.memoizedState,v=v(C,f),v=v==null?f:Lt({},f,v),l.memoizedState=v,l.lanes===0&&(l.updateQueue.baseState=v)}var Vf={isMounted:function(l){return(l=l._reactInternals)?Ui(l)===l:!1},enqueueSetState:function(l,f,v){l=l._reactInternals;var C=vn(),O=uc(C);O.payload=f,v!=null&&(O.callback=v),f=Ko(l,O,C),f!==null&&(kn(f,l,C),Bh(f,l,C))},enqueueReplaceState:function(l,f,v){l=l._reactInternals;var C=vn(),O=uc(C);O.tag=1,O.payload=f,v!=null&&(O.callback=v),f=Ko(l,O,C),f!==null&&(kn(f,l,C),Bh(f,l,C))},enqueueForceUpdate:function(l,f){l=l._reactInternals;var v=vn(),C=uc(v);C.tag=2,f!=null&&(C.callback=f),f=Ko(l,C,v),f!==null&&(kn(f,l,v),Bh(f,l,v))}};function kd(l,f,v,C,O,U,ae){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(C,U,ae):f.prototype&&f.prototype.isPureReactComponent?!Gl(v,C)||!Gl(O,U):!0}function Hf(l,f,v,C){l=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(v,C),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(v,C),f.state!==l&&Vf.enqueueReplaceState(f,f.state,null)}function Xc(l,f){var v=f;if("ref"in f){v={};for(var C in f)C!=="ref"&&(v[C]=f[C])}if(l=l.defaultProps){v===f&&(v=Lt({},v));for(var O in l)v[O]===void 0&&(v[O]=l[O])}return v}var Nd=typeof reportError=="function"?reportError:function(l){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof l=="object"&&l!==null&&typeof l.message=="string"?String(l.message):String(l),error:l});if(!window.dispatchEvent(f))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",l);return}console.error(l)};function jd(l){Nd(l)}function kh(l){console.error(l)}function Lu(l){Nd(l)}function Nh(l,f){try{var v=l.onUncaughtError;v(f.value,{componentStack:f.stack})}catch(C){setTimeout(function(){throw C})}}function Hp(l,f,v){try{var C=l.onCaughtError;C(v.value,{componentStack:v.stack,errorBoundary:f.tag===1?f.stateNode:null})}catch(O){setTimeout(function(){throw O})}}function qp(l,f,v){return v=uc(v),v.tag=3,v.payload={element:null},v.callback=function(){Nh(l,f)},v}function Gp(l){return l=uc(l),l.tag=3,l}function $p(l,f,v,C){var O=v.type.getDerivedStateFromError;if(typeof O=="function"){var U=C.value;l.payload=function(){return O(U)},l.callback=function(){Hp(f,v,C)}}var ae=v.stateNode;ae!==null&&typeof ae.componentDidCatch=="function"&&(l.callback=function(){Hp(f,v,C),typeof O!="function"&&(bn===null?bn=new Set([this]):bn.add(this));var De=C.stack;this.componentDidCatch(C.value,{componentStack:De!==null?De:""})})}function aa(l,f,v,C,O){if(v.flags|=32768,C!==null&&typeof C=="object"&&typeof C.then=="function"){if(f=v.alternate,f!==null&&Tl(f,v,O,!0),v=Va.current,v!==null){switch(v.tag){case 13:return So===null?pr():v.alternate===null&&ei===0&&(ei=3),v.flags&=-257,v.flags|=65536,v.lanes=O,C===bd?v.flags|=16384:(f=v.updateQueue,f===null?v.updateQueue=new Set([C]):f.add(C),Ys(l,C,O)),!1;case 22:return v.flags|=65536,C===bd?v.flags|=16384:(f=v.updateQueue,f===null?(f={transitions:null,markerInstances:null,retryQueue:new Set([C])},v.updateQueue=f):(v=f.retryQueue,v===null?f.retryQueue=new Set([C]):v.add(C)),Ys(l,C,O)),!1}throw Error(S(435,v.tag))}return Ys(l,C,O),pr(),!1}if(xr)return f=Va.current,f!==null?((f.flags&65536)===0&&(f.flags|=256),f.flags|=65536,f.lanes=O,C!==vd&&(l=Error(S(422),{cause:C}),kc(os(l,v)))):(C!==vd&&(f=Error(S(423),{cause:C}),kc(os(f,v))),l=l.current.alternate,l.flags|=65536,O&=-O,l.lanes|=O,C=os(C,v),O=qp(l.stateNode,C,O),$f(l,O),ei!==4&&(ei=2)),!1;var U=Error(S(520),{cause:C});if(U=os(U,v),qi===null?qi=[U]:qi.push(U),ei!==4&&(ei=2),f===null)return!0;C=os(C,v),v=f;do{switch(v.tag){case 3:return v.flags|=65536,l=O&-O,v.lanes|=l,l=qp(v.stateNode,C,l),$f(v,l),!1;case 1:if(f=v.type,U=v.stateNode,(v.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||U!==null&&typeof U.componentDidCatch=="function"&&(bn===null||!bn.has(U))))return v.flags|=65536,O&=-O,v.lanes|=O,O=Gp(O),$p(O,l,v,C),$f(v,O),!1}v=v.return}while(v!==null);return!1}var ac=Error(S(461)),ls=!1;function En(l,f,v,C){f.child=l===null?Fm(f,null,v,C):jc(f,l.child,v,C)}function yn(l,f,v,C,O){v=v.render;var U=f.ref;if("ref"in C){var ae={};for(var De in C)De!=="ref"&&(ae[De]=C[De])}else ae=C;return Sl(f),C=Ah(l,f,v,ae,U,O),De=Ch(),l!==null&&!ls?(Md(l,f,O),Co(l,f,O)):(xr&&De&&Dp(f),f.flags|=1,En(l,f,C,O),f.child)}function Zp(l,f,v,C,O){if(l===null){var U=v.type;return typeof U=="function"&&!ee(U)&&U.defaultProps===void 0&&v.compare===null?(f.tag=15,f.type=U,oc(l,f,U,C,O)):(l=ce(v.type,null,C,f,f.mode,O),l.ref=f.ref,l.return=f,f.child=l)}if(U=l.child,!Gd(l,O)){var ae=U.memoizedProps;if(v=v.compare,v=v!==null?v:Gl,v(ae,C)&&l.ref===f.ref)return Co(l,f,O)}return f.flags|=1,l=X(U,C),l.ref=f.ref,l.return=f,f.child=l}function oc(l,f,v,C,O){if(l!==null){var U=l.memoizedProps;if(Gl(U,C)&&l.ref===f.ref)if(ls=!1,f.pendingProps=C=U,Gd(l,O))(l.flags&131072)!==0&&(ls=!0);else return f.lanes=l.lanes,Co(l,f,O)}return Bd(l,f,v,C,O)}function Yc(l,f,v){var C=f.pendingProps,O=C.children,U=(f.stateNode._pendingVisibility&2)!==0,ae=l!==null?l.memoizedState:null;if(Ao(l,f),C.mode==="hidden"||U){if((f.flags&128)!==0){if(C=ae!==null?ae.baseLanes|v:v,l!==null){for(O=f.child=l.child,U=0;O!==null;)U=U|O.lanes|O.childLanes,O=O.sibling;f.childLanes=U&~C}else f.childLanes=0,f.child=null;return Kc(l,f,C,v)}if((v&536870912)!==0)f.memoizedState={baseLanes:0,cachePool:null},l!==null&&Ru(f,ae!==null?ae.cachePool:null),ae!==null?Ed(f,ae):Th(),Fc(f);else return f.lanes=f.childLanes=536870912,Kc(l,f,ae!==null?ae.baseLanes|v:v,v)}else ae!==null?(Ru(f,ae.cachePool),Ed(f,ae),Ha(),f.memoizedState=null):(l!==null&&Ru(f,null),Th(),Ha());return En(l,f,O,v),f.child}function Kc(l,f,v,C){var O=jp();return O=O===null?null:{parent:Ts._currentValue,pool:O},f.memoizedState={baseLanes:v,cachePool:O},l!==null&&Ru(f,null),Th(),Fc(f),l!==null&&Tl(l,f,C,!0),null}function Ao(l,f){var v=f.ref;if(v===null)l!==null&&l.ref!==null&&(f.flags|=2097664);else{if(typeof v!="function"&&typeof v!="object")throw Error(S(284));(l===null||l.ref!==v)&&(f.flags|=2097664)}}function Bd(l,f,v,C,O){return Sl(f),v=Ah(l,f,v,C,void 0,O),C=Ch(),l!==null&&!ls?(Md(l,f,O),Co(l,f,O)):(xr&&C&&Dp(f),f.flags|=1,En(l,f,v,O),f.child)}function Fd(l,f,v,C,O,U){return Sl(f),f.updateQueue=null,v=Mf(f,C,v,O),Rf(l),C=Ch(),l!==null&&!ls?(Md(l,f,U),Co(l,f,U)):(xr&&C&&Dp(f),f.flags|=1,En(l,f,v,U),f.child)}function qf(l,f,v,C,O){if(Sl(f),f.stateNode===null){var U=za,ae=v.contextType;typeof ae=="object"&&ae!==null&&(U=Gs(ae)),U=new v(C,U),f.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,U.updater=Vf,f.stateNode=U,U._reactInternals=f,U=f.stateNode,U.props=C,U.state=f.memoizedState,U.refs={},Gf(f),ae=v.contextType,U.context=typeof ae=="object"&&ae!==null?Gs(ae):za,U.state=f.memoizedState,ae=v.getDerivedStateFromProps,typeof ae=="function"&&(Vp(f,v,ae,C),U.state=f.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(ae=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),ae!==U.state&&Vf.enqueueReplaceState(U,U.state,null),Uu(f,C,U,O),Fh(),U.state=f.memoizedState),typeof U.componentDidMount=="function"&&(f.flags|=4194308),C=!0}else if(l===null){U=f.stateNode;var De=f.memoizedProps,Xe=Xc(v,De);U.props=Xe;var gt=U.context,si=v.contextType;ae=za,typeof si=="object"&&si!==null&&(ae=Gs(si));var yi=v.getDerivedStateFromProps;si=typeof yi=="function"||typeof U.getSnapshotBeforeUpdate=="function",De=f.pendingProps!==De,si||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(De||gt!==ae)&&Hf(f,U,C,ae),Yo=!1;var Ut=f.memoizedState;U.state=Ut,Uu(f,C,U,O),Fh(),gt=f.memoizedState,De||Ut!==gt||Yo?(typeof yi=="function"&&(Vp(f,v,yi,C),gt=f.memoizedState),(Xe=Yo||kd(f,v,Xe,C,Ut,gt,ae))?(si||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount()),typeof U.componentDidMount=="function"&&(f.flags|=4194308)):(typeof U.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=C,f.memoizedState=gt),U.props=C,U.state=gt,U.context=ae,C=Xe):(typeof U.componentDidMount=="function"&&(f.flags|=4194308),C=!1)}else{U=f.stateNode,$d(l,f),ae=f.memoizedProps,si=Xc(v,ae),U.props=si,yi=f.pendingProps,Ut=U.context,gt=v.contextType,Xe=za,typeof gt=="object"&&gt!==null&&(Xe=Gs(gt)),De=v.getDerivedStateFromProps,(gt=typeof De=="function"||typeof U.getSnapshotBeforeUpdate=="function")||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(ae!==yi||Ut!==Xe)&&Hf(f,U,C,Xe),Yo=!1,Ut=f.memoizedState,U.state=Ut,Uu(f,C,U,O),Fh();var ti=f.memoizedState;ae!==yi||Ut!==ti||Yo||l!==null&&l.dependencies!==null&&Bu(l.dependencies)?(typeof De=="function"&&(Vp(f,v,De,C),ti=f.memoizedState),(si=Yo||kd(f,v,si,C,Ut,ti,Xe)||l!==null&&l.dependencies!==null&&Bu(l.dependencies))?(gt||typeof U.UNSAFE_componentWillUpdate!="function"&&typeof U.componentWillUpdate!="function"||(typeof U.componentWillUpdate=="function"&&U.componentWillUpdate(C,ti,Xe),typeof U.UNSAFE_componentWillUpdate=="function"&&U.UNSAFE_componentWillUpdate(C,ti,Xe)),typeof U.componentDidUpdate=="function"&&(f.flags|=4),typeof U.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof U.componentDidUpdate!="function"||ae===l.memoizedProps&&Ut===l.memoizedState||(f.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||ae===l.memoizedProps&&Ut===l.memoizedState||(f.flags|=1024),f.memoizedProps=C,f.memoizedState=ti),U.props=C,U.state=ti,U.context=Xe,C=si):(typeof U.componentDidUpdate!="function"||ae===l.memoizedProps&&Ut===l.memoizedState||(f.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||ae===l.memoizedProps&&Ut===l.memoizedState||(f.flags|=1024),C=!1)}return U=C,Ao(l,f),C=(f.flags&128)!==0,U||C?(U=f.stateNode,v=C&&typeof v.getDerivedStateFromError!="function"?null:U.render(),f.flags|=1,l!==null&&C?(f.child=jc(f,l.child,null,O),f.child=jc(f,null,v,O)):En(l,f,v,O),f.memoizedState=U.state,l=f.child):l=Co(l,f,O),l}function Ud(l,f,v,C){return Oc(),f.flags|=256,En(l,f,v,C),f.child}var oa={dehydrated:null,treeContext:null,retryLane:0};function wl(l){return{baseLanes:l,cachePool:Hm()}}function Jc(l,f,v){return l=l!==null?l.childLanes&~v:0,f&&(l|=Hi),l}function Vd(l,f,v){var C=f.pendingProps,O=!1,U=(f.flags&128)!==0,ae;if((ae=U)||(ae=l!==null&&l.memoizedState===null?!1:(zr.current&2)!==0),ae&&(O=!0,f.flags&=-129),ae=(f.flags&32)!==0,f.flags&=-33,l===null){if(xr){if(O?Bc(f):Ha(),xr){var De=na,Xe;if(Xe=De){e:{for(Xe=De,De=Ho;Xe.nodeType!==8;){if(!De){De=null;break e}if(Xe=rl(Xe.nextSibling),Xe===null){De=null;break e}}De=Xe}De!==null?(f.memoizedState={dehydrated:De,treeContext:rr!==null?{id:ul,overflow:Uo}:null,retryLane:536870912},Xe=G(18,null,null,0),Xe.stateNode=De,Xe.return=f,f.child=Xe,xa=f,na=null,Xe=!0):Xe=!1}Xe||hl(f)}if(De=f.memoizedState,De!==null&&(De=De.dehydrated,De!==null))return De.data==="$!"?f.lanes=16:f.lanes=536870912,null;ml(f)}return De=C.children,C=C.fallback,O?(Ha(),O=f.mode,De=qd({mode:"hidden",children:De},O),C=de(C,O,v,null),De.return=f,C.return=f,De.sibling=C,f.child=De,O=f.child,O.memoizedState=wl(v),O.childLanes=Jc(l,ae,v),f.memoizedState=oa,C):(Bc(f),Hd(f,De))}if(Xe=l.memoizedState,Xe!==null&&(De=Xe.dehydrated,De!==null)){if(U)f.flags&256?(Bc(f),f.flags&=-257,f=oo(l,f,v)):f.memoizedState!==null?(Ha(),f.child=l.child,f.flags|=128,f=null):(Ha(),O=C.fallback,De=f.mode,C=qd({mode:"visible",children:C.children},De),O=de(O,De,v,null),O.flags|=2,C.return=f,O.return=f,C.sibling=O,f.child=C,jc(f,l.child,null,v),C=f.child,C.memoizedState=wl(v),C.childLanes=Jc(l,ae,v),f.memoizedState=oa,f=O);else if(Bc(f),De.data==="$!"){if(ae=De.nextSibling&&De.nextSibling.dataset,ae)var gt=ae.dgst;ae=gt,C=Error(S(419)),C.stack="",C.digest=ae,kc({value:C,source:null,stack:null}),f=oo(l,f,v)}else if(ls||Tl(l,f,v,!1),ae=(v&l.childLanes)!==0,ls||ae){if(ae=nt,ae!==null){if(C=v&-v,(C&42)!==0)C=1;else switch(C){case 2:C=1;break;case 8:C=4;break;case 32:C=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:C=64;break;case 268435456:C=134217728;break;default:C=0}if(C=(C&(ae.suspendedLanes|v))!==0?0:C,C!==0&&C!==Xe.retryLane)throw Xe.retryLane=C,ro(l,C),kn(ae,l,C),ac}De.data==="$?"||pr(),f=oo(l,f,v)}else De.data==="$?"?(f.flags|=128,f.child=l.child,f=B1.bind(null,l),De._reactRetry=f,f=null):(l=Xe.treeContext,na=rl(De.nextSibling),xa=f,xr=!0,Vo=null,Ho=!1,l!==null&&(Da[To++]=ul,Da[To++]=Uo,Da[To++]=rr,ul=l.id,Uo=l.overflow,rr=f),f=Hd(f,C.children),f.flags|=4096);return f}return O?(Ha(),O=C.fallback,De=f.mode,Xe=l.child,gt=Xe.sibling,C=X(Xe,{mode:"hidden",children:C.children}),C.subtreeFlags=Xe.subtreeFlags&31457280,gt!==null?O=X(gt,O):(O=de(O,De,v,null),O.flags|=2),O.return=f,C.return=f,C.sibling=O,f.child=C,C=O,O=f.child,De=l.child.memoizedState,De===null?De=wl(v):(Xe=De.cachePool,Xe!==null?(gt=Ts._currentValue,Xe=Xe.parent!==gt?{parent:gt,pool:gt}:Xe):Xe=Hm(),De={baseLanes:De.baseLanes|v,cachePool:Xe}),O.memoizedState=De,O.childLanes=Jc(l,ae,v),f.memoizedState=oa,C):(Bc(f),v=l.child,l=v.sibling,v=X(v,{mode:"visible",children:C.children}),v.return=f,v.sibling=null,l!==null&&(ae=f.deletions,ae===null?(f.deletions=[l],f.flags|=16):ae.push(l)),f.child=v,f.memoizedState=null,v)}function Hd(l,f){return f=qd({mode:"visible",children:f},l.mode),f.return=l,l.child=f}function qd(l,f){return Te(l,f,0,null)}function oo(l,f,v){return jc(f,l.child,null,v),l=Hd(f,f.pendingProps.children),l.flags|=2,f.memoizedState=null,l}function Ou(l,f,v){l.lanes|=f;var C=l.alternate;C!==null&&(C.lanes|=f),jh(l.return,f,v)}function Kr(l,f,v,C,O){var U=l.memoizedState;U===null?l.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:C,tail:v,tailMode:O}:(U.isBackwards=f,U.rendering=null,U.renderingStartTime=0,U.last=C,U.tail=v,U.tailMode=O)}function ku(l,f,v){var C=f.pendingProps,O=C.revealOrder,U=C.tail;if(En(l,f,C.children,v),C=zr.current,(C&2)!==0)C=C&1|2,f.flags|=128;else{if(l!==null&&(l.flags&128)!==0)e:for(l=f.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&Ou(l,v,f);else if(l.tag===19)Ou(l,v,f);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===f)break e;for(;l.sibling===null;){if(l.return===null||l.return===f)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}C&=1}switch(St(zr,C),O){case"forwards":for(v=f.child,O=null;v!==null;)l=v.alternate,l!==null&&Eu(l)===null&&(O=v),v=v.sibling;v=O,v===null?(O=f.child,f.child=null):(O=v.sibling,v.sibling=null),Kr(f,!1,O,v,U);break;case"backwards":for(v=null,O=f.child,f.child=null;O!==null;){if(l=O.alternate,l!==null&&Eu(l)===null){f.child=O;break}l=O.sibling,O.sibling=v,v=O,O=l}Kr(f,!0,v,null,U);break;case"together":Kr(f,!1,null,null,void 0);break;default:f.memoizedState=null}return f.child}function Co(l,f,v){if(l!==null&&(f.dependencies=l.dependencies),li|=f.lanes,(v&f.childLanes)===0)if(l!==null){if(Tl(l,f,v,!1),(v&f.childLanes)===0)return null}else return null;if(l!==null&&f.child!==l.child)throw Error(S(153));if(f.child!==null){for(l=f.child,v=X(l,l.pendingProps),f.child=v,v.return=f;l.sibling!==null;)l=l.sibling,v=v.sibling=X(l,l.pendingProps),v.return=f;v.sibling=null}return f.child}function Gd(l,f){return(l.lanes&f)!==0?!0:(l=l.dependencies,!!(l!==null&&Bu(l)))}function Wp(l,f,v){switch(f.tag){case 3:In(f,f.stateNode.containerInfo),qa(f,Ts,l.memoizedState.cache),Oc();break;case 27:case 5:bs(f);break;case 4:In(f,f.stateNode.containerInfo);break;case 10:qa(f,f.type,f.memoizedProps.value);break;case 13:var C=f.memoizedState;if(C!==null)return C.dehydrated!==null?(Bc(f),f.flags|=128,null):(v&f.child.childLanes)!==0?Vd(l,f,v):(Bc(f),l=Co(l,f,v),l!==null?l.sibling:null);Bc(f);break;case 19:var O=(l.flags&128)!==0;if(C=(v&f.childLanes)!==0,C||(Tl(l,f,v,!1),C=(v&f.childLanes)!==0),O){if(C)return ku(l,f,v);f.flags|=128}if(O=f.memoizedState,O!==null&&(O.rendering=null,O.tail=null,O.lastEffect=null),St(zr,zr.current),C)break;return null;case 22:case 23:return f.lanes=0,Yc(l,f,v);case 24:qa(f,Ts,l.memoizedState.cache)}return Co(l,f,v)}function is(l,f,v){if(l!==null)if(l.memoizedProps!==f.pendingProps)ls=!0;else{if(!Gd(l,v)&&(f.flags&128)===0)return ls=!1,Wp(l,f,v);ls=(l.flags&131072)!==0}else ls=!1,xr&&(f.flags&1048576)!==0&&Bm(f,Tf,f.index);switch(f.lanes=0,f.tag){case 16:e:{l=f.pendingProps;var C=f.elementType,O=C._init;if(C=O(C._payload),f.type=C,typeof C=="function")ee(C)?(l=Xc(C,l),f.tag=1,f=qf(null,f,C,l,v)):(f.tag=0,f=Bd(null,f,C,l,v));else{if(C!=null){if(O=C.$$typeof,O===le){f.tag=11,f=yn(null,f,C,l,v);break e}else if(O===ge){f.tag=14,f=Zp(null,f,C,l,v);break e}}throw f=rt(C)||C,Error(S(306,f,""))}}return f;case 0:return Bd(l,f,f.type,f.pendingProps,v);case 1:return C=f.type,O=Xc(C,f.pendingProps),qf(l,f,C,O,v);case 3:e:{if(In(f,f.stateNode.containerInfo),l===null)throw Error(S(387));var U=f.pendingProps;O=f.memoizedState,C=O.element,$d(l,f),Uu(f,U,null,v);var ae=f.memoizedState;if(U=ae.cache,qa(f,Ts,U),U!==O.cache&&ju(f,[Ts],v,!0),Fh(),U=ae.element,O.isDehydrated)if(O={element:U,isDehydrated:!1,cache:ae.cache},f.updateQueue.baseState=O,f.memoizedState=O,f.flags&256){f=Ud(l,f,U,v);break e}else if(U!==C){C=os(Error(S(424)),f),kc(C),f=Ud(l,f,U,v);break e}else for(na=rl(f.stateNode.containerInfo.firstChild),xa=f,xr=!0,Vo=null,Ho=!0,v=Fm(f,null,U,v),f.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling;else{if(Oc(),U===C){f=Co(l,f,v);break e}En(l,f,U,v)}f=f.child}return f;case 26:return Ao(l,f),l===null?(v=og(f.type,null,f.pendingProps,null))?f.memoizedState=v:xr||(v=f.type,l=f.pendingProps,C=sg(Mn.current).createElement(v),C[Be]=f,C[Je]=l,ys(C,v,l),$n(C),f.stateNode=C):f.memoizedState=og(f.type,l.memoizedProps,f.pendingProps,l.memoizedState),null;case 27:return bs(f),l===null&&xr&&(C=f.stateNode=h_(f.type,f.pendingProps,Mn.current),xa=f,Ho=!0,na=rl(C.firstChild)),C=f.pendingProps.children,l!==null||xr?En(l,f,C,v):f.child=jc(f,null,C,v),Ao(l,f),f.child;case 5:return l===null&&xr&&((O=C=na)&&(C=H1(C,f.type,f.pendingProps,Ho),C!==null?(f.stateNode=C,xa=f,na=rl(C.firstChild),Ho=!1,O=!0):O=!1),O||hl(f)),bs(f),O=f.type,U=f.pendingProps,ae=l!==null?l.memoizedProps:null,C=U.children,l_(O,U)?C=null:ae!==null&&l_(O,ae)&&(f.flags|=32),f.memoizedState!==null&&(O=Ah(l,f,If,null,null,v),um._currentValue=O),Ao(l,f),En(l,f,C,v),f.child;case 6:return l===null&&xr&&((l=v=na)&&(v=q1(v,f.pendingProps,Ho),v!==null?(f.stateNode=v,xa=f,na=null,l=!0):l=!1),l||hl(f)),null;case 13:return Vd(l,f,v);case 4:return In(f,f.stateNode.containerInfo),C=f.pendingProps,l===null?f.child=jc(f,null,C,v):En(l,f,C,v),f.child;case 11:return yn(l,f,f.type,f.pendingProps,v);case 7:return En(l,f,f.pendingProps,v),f.child;case 8:return En(l,f,f.pendingProps.children,v),f.child;case 12:return En(l,f,f.pendingProps.children,v),f.child;case 10:return C=f.pendingProps,qa(f,f.type,C.value),En(l,f,C.children,v),f.child;case 9:return O=f.type._context,C=f.pendingProps.children,Sl(f),O=Gs(O),C=C(O),f.flags|=1,En(l,f,C,v),f.child;case 14:return Zp(l,f,f.type,f.pendingProps,v);case 15:return oc(l,f,f.type,f.pendingProps,v);case 19:return ku(l,f,v);case 22:return Yc(l,f,v);case 24:return Sl(f),C=Gs(Ts),l===null?(O=jp(),O===null&&(O=nt,U=Sh(),O.pooledCache=U,U.refCount++,U!==null&&(O.pooledCacheLanes|=v),O=U),f.memoizedState={parent:C,cache:O},Gf(f),qa(f,Ts,O)):((l.lanes&v)!==0&&($d(l,f),Uu(f,null,null,v),Fh()),O=l.memoizedState,U=f.memoizedState,O.parent!==C?(O={parent:C,cache:C},f.memoizedState=O,f.lanes===0&&(f.memoizedState=f.updateQueue.baseState=O),qa(f,Ts,C)):(C=U.cache,qa(f,Ts,C),C!==O.cache&&ju(f,[Ts],v,!0))),En(l,f,f.pendingProps.children,v),f.child;case 29:throw f.pendingProps}throw Error(S(156,f.tag))}var Nu=Ii(null),lc=null,lo=null;function qa(l,f,v){St(Nu,f._currentValue),f._currentValue=v}function Xo(l){l._currentValue=Nu.current,xt(Nu)}function jh(l,f,v){for(;l!==null;){var C=l.alternate;if((l.childLanes&f)!==f?(l.childLanes|=f,C!==null&&(C.childLanes|=f)):C!==null&&(C.childLanes&f)!==f&&(C.childLanes|=f),l===v)break;l=l.return}}function ju(l,f,v,C){var O=l.child;for(O!==null&&(O.return=l);O!==null;){var U=O.dependencies;if(U!==null){var ae=O.child;U=U.firstContext;e:for(;U!==null;){var De=U;U=O;for(var Xe=0;Xe<f.length;Xe++)if(De.context===f[Xe]){U.lanes|=v,De=U.alternate,De!==null&&(De.lanes|=v),jh(U.return,v,l),C||(ae=null);break e}U=De.next}}else if(O.tag===18){if(ae=O.return,ae===null)throw Error(S(341));ae.lanes|=v,U=ae.alternate,U!==null&&(U.lanes|=v),jh(ae,v,l),ae=null}else ae=O.child;if(ae!==null)ae.return=O;else for(ae=O;ae!==null;){if(ae===l){ae=null;break}if(O=ae.sibling,O!==null){O.return=ae.return,ae=O;break}ae=ae.return}O=ae}}function Tl(l,f,v,C){l=null;for(var O=f,U=!1;O!==null;){if(!U){if((O.flags&524288)!==0)U=!0;else if((O.flags&262144)!==0)break}if(O.tag===10){var ae=O.alternate;if(ae===null)throw Error(S(387));if(ae=ae.memoizedProps,ae!==null){var De=O.type;Ua(O.pendingProps.value,ae.value)||(l!==null?l.push(De):l=[De])}}else if(O===Nn.current){if(ae=O.alternate,ae===null)throw Error(S(387));ae.memoizedState.memoizedState!==O.memoizedState.memoizedState&&(l!==null?l.push(um):l=[um])}O=O.return}l!==null&&ju(f,l,v,C),f.flags|=262144}function Bu(l){for(l=l.firstContext;l!==null;){if(!Ua(l.context._currentValue,l.memoizedValue))return!0;l=l.next}return!1}function Sl(l){lc=l,lo=null,l=l.dependencies,l!==null&&(l.firstContext=null)}function Gs(l){return Fu(lc,l)}function cc(l,f){return lc===null&&Sl(l),Fu(l,f)}function Fu(l,f){var v=f._currentValue;if(f={context:f,memoizedValue:v,next:null},lo===null){if(l===null)throw Error(S(308));lo=f,l.dependencies={lanes:0,firstContext:f},l.flags|=524288}else lo=lo.next=f;return v}var Yo=!1;function Gf(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function $d(l,f){l=l.updateQueue,f.updateQueue===l&&(f.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,callbacks:null})}function uc(l){return{lane:l,tag:0,payload:null,callback:null,next:null}}function Ko(l,f,v){var C=l.updateQueue;if(C===null)return null;if(C=C.shared,(Oe&2)!==0){var O=C.pending;return O===null?f.next=f:(f.next=O.next,O.next=f),C.pending=f,f=Pc(l),xh(l,null,v),f}return yh(l,C,f,v),Pc(l)}function Bh(l,f,v){if(f=f.updateQueue,f!==null&&(f=f.shared,(v&4194176)!==0)){var C=f.lanes;C&=l.pendingLanes,v|=C,f.lanes=v,_e(l,v)}}function $f(l,f){var v=l.updateQueue,C=l.alternate;if(C!==null&&(C=C.updateQueue,v===C)){var O=null,U=null;if(v=v.firstBaseUpdate,v!==null){do{var ae={lane:v.lane,tag:v.tag,payload:v.payload,callback:null,next:null};U===null?O=U=ae:U=U.next=ae,v=v.next}while(v!==null);U===null?O=U=f:U=U.next=f}else O=U=f;v={baseState:C.baseState,firstBaseUpdate:O,lastBaseUpdate:U,shared:C.shared,callbacks:C.callbacks},l.updateQueue=v;return}l=v.lastBaseUpdate,l===null?v.firstBaseUpdate=f:l.next=f,v.lastBaseUpdate=f}var Zf=!1;function Fh(){if(Zf){var l=Uc;if(l!==null)throw l}}function Uu(l,f,v,C){Zf=!1;var O=l.updateQueue;Yo=!1;var U=O.firstBaseUpdate,ae=O.lastBaseUpdate,De=O.shared.pending;if(De!==null){O.shared.pending=null;var Xe=De,gt=Xe.next;Xe.next=null,ae===null?U=gt:ae.next=gt,ae=Xe;var si=l.alternate;si!==null&&(si=si.updateQueue,De=si.lastBaseUpdate,De!==ae&&(De===null?si.firstBaseUpdate=gt:De.next=gt,si.lastBaseUpdate=Xe))}if(U!==null){var yi=O.baseState;ae=0,si=gt=Xe=null,De=U;do{var Ut=De.lane&-536870913,ti=Ut!==De.lane;if(ti?(ht&Ut)===Ut:(C&Ut)===Ut){Ut!==0&&Ut===_l&&(Zf=!0),si!==null&&(si=si.next={lane:0,tag:De.tag,payload:De.payload,callback:null,next:null});e:{var xn=l,Xn=De;Ut=f;var cs=v;switch(Xn.tag){case 1:if(xn=Xn.payload,typeof xn=="function"){yi=xn.call(cs,yi,Ut);break e}yi=xn;break e;case 3:xn.flags=xn.flags&-65537|128;case 0:if(xn=Xn.payload,Ut=typeof xn=="function"?xn.call(cs,yi,Ut):xn,Ut==null)break e;yi=Lt({},yi,Ut);break e;case 2:Yo=!0}}Ut=De.callback,Ut!==null&&(l.flags|=64,ti&&(l.flags|=8192),ti=O.callbacks,ti===null?O.callbacks=[Ut]:ti.push(Ut))}else ti={lane:Ut,tag:De.tag,payload:De.payload,callback:De.callback,next:null},si===null?(gt=si=ti,Xe=yi):si=si.next=ti,ae|=Ut;if(De=De.next,De===null){if(De=O.shared.pending,De===null)break;ti=De,De=ti.next,ti.next=null,O.lastBaseUpdate=ti,O.shared.pending=null}}while(!0);si===null&&(Xe=yi),O.baseState=Xe,O.firstBaseUpdate=gt,O.lastBaseUpdate=si,U===null&&(O.shared.lanes=0),li|=ae,l.lanes=ae,l.memoizedState=yi}}function Xp(l,f){if(typeof l!="function")throw Error(S(191,l));l.call(f)}function Yp(l,f){var v=l.callbacks;if(v!==null)for(l.callbacks=null,l=0;l<v.length;l++)Xp(v[l],f)}function Uh(l,f){try{var v=f.updateQueue,C=v!==null?v.lastEffect:null;if(C!==null){var O=C.next;v=O;do{if((v.tag&l)===l){C=void 0;var U=v.create,ae=v.inst;C=U(),ae.destroy=C}v=v.next}while(v!==O)}}catch(De){jr(f,f.return,De)}}function hc(l,f,v){try{var C=f.updateQueue,O=C!==null?C.lastEffect:null;if(O!==null){var U=O.next;C=U;do{if((C.tag&l)===l){var ae=C.inst,De=ae.destroy;if(De!==void 0){ae.destroy=void 0,O=f;var Xe=v;try{De()}catch(gt){jr(O,Xe,gt)}}}C=C.next}while(C!==U)}}catch(gt){jr(f,f.return,gt)}}function Zm(l){var f=l.updateQueue;if(f!==null){var v=l.stateNode;try{Yp(f,v)}catch(C){jr(l,l.return,C)}}}function Wm(l,f,v){v.props=Xc(l.type,l.memoizedProps),v.state=l.memoizedState;try{v.componentWillUnmount()}catch(C){jr(l,f,C)}}function Vu(l,f){try{var v=l.ref;if(v!==null){var C=l.stateNode;switch(l.tag){case 26:case 27:case 5:var O=C;break;default:O=C}typeof v=="function"?l.refCleanup=v(O):v.current=O}}catch(U){jr(l,f,U)}}function qn(l,f){var v=l.ref,C=l.refCleanup;if(v!==null)if(typeof C=="function")try{C()}catch(O){jr(l,f,O)}finally{l.refCleanup=null,l=l.alternate,l!=null&&(l.refCleanup=null)}else if(typeof v=="function")try{v(null)}catch(O){jr(l,f,O)}else v.current=null}function Vh(l){var f=l.type,v=l.memoizedProps,C=l.stateNode;try{e:switch(f){case"button":case"input":case"select":case"textarea":v.autoFocus&&C.focus();break e;case"img":v.src?C.src=v.src:v.srcSet&&(C.srcset=v.srcSet)}}catch(O){jr(l,l.return,O)}}function Xm(l,f,v){try{var C=l.stateNode;Ks(C,l.type,v,f),C[Je]=f}catch(O){jr(l,l.return,O)}}function Ym(l){return l.tag===5||l.tag===3||l.tag===26||l.tag===27||l.tag===4}function Hh(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||Ym(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==27&&l.tag!==18;){if(l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function Hu(l,f,v){var C=l.tag;if(C===5||C===6)l=l.stateNode,f?v.nodeType===8?v.parentNode.insertBefore(l,f):v.insertBefore(l,f):(v.nodeType===8?(f=v.parentNode,f.insertBefore(l,v)):(f=v,f.appendChild(l)),v=v._reactRootContainer,v!=null||f.onclick!==null||(f.onclick=rm));else if(C!==4&&C!==27&&(l=l.child,l!==null))for(Hu(l,f,v),l=l.sibling;l!==null;)Hu(l,f,v),l=l.sibling}function qh(l,f,v){var C=l.tag;if(C===5||C===6)l=l.stateNode,f?v.insertBefore(l,f):v.appendChild(l);else if(C!==4&&C!==27&&(l=l.child,l!==null))for(qh(l,f,v),l=l.sibling;l!==null;)qh(l,f,v),l=l.sibling}var Jo=!1,Jr=!1,Ro=!1,Gh=typeof WeakSet=="function"?WeakSet:Set,Wn=null,Qo=!1;function Zd(l,f){if(l=l.containerInfo,rg=hm,l=bo(l),Cp(l)){if("selectionStart"in l)var v={start:l.selectionStart,end:l.selectionEnd};else e:{v=(v=l.ownerDocument)&&v.defaultView||window;var C=v.getSelection&&v.getSelection();if(C&&C.rangeCount!==0){v=C.anchorNode;var O=C.anchorOffset,U=C.focusNode;C=C.focusOffset;try{v.nodeType,U.nodeType}catch{v=null;break e}var ae=0,De=-1,Xe=-1,gt=0,si=0,yi=l,Ut=null;t:for(;;){for(var ti;yi!==v||O!==0&&yi.nodeType!==3||(De=ae+O),yi!==U||C!==0&&yi.nodeType!==3||(Xe=ae+C),yi.nodeType===3&&(ae+=yi.nodeValue.length),(ti=yi.firstChild)!==null;)Ut=yi,yi=ti;for(;;){if(yi===l)break t;if(Ut===v&&++gt===O&&(De=ae),Ut===U&&++si===C&&(Xe=ae),(ti=yi.nextSibling)!==null)break;yi=Ut,Ut=yi.parentNode}yi=ti}v=De===-1||Xe===-1?null:{start:De,end:Xe}}else v=null}v=v||{start:0,end:0}}else v=null;for(Yd={focusedElem:l,selectionRange:v},hm=!1,Wn=f;Wn!==null;)if(f=Wn,l=f.child,(f.subtreeFlags&1028)!==0&&l!==null)l.return=f,Wn=l;else for(;Wn!==null;){switch(f=Wn,U=f.alternate,l=f.flags,f.tag){case 0:break;case 11:case 15:break;case 1:if((l&1024)!==0&&U!==null){l=void 0,v=f,O=U.memoizedProps,U=U.memoizedState,C=v.stateNode;try{var xn=Xc(v.type,O,v.elementType===v.type);l=C.getSnapshotBeforeUpdate(xn,U),C.__reactInternalSnapshotBeforeUpdate=l}catch(Xn){jr(v,v.return,Xn)}}break;case 3:if((l&1024)!==0){if(l=f.stateNode.containerInfo,v=l.nodeType,v===9)u_(l);else if(v===1)switch(l.nodeName){case"HEAD":case"HTML":case"BODY":u_(l);break;default:l.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((l&1024)!==0)throw Error(S(163))}if(l=f.sibling,l!==null){l.return=f.return,Wn=l;break}Wn=f.return}return xn=Qo,Qo=!1,xn}function $h(l,f,v){var C=v.flags;switch(v.tag){case 0:case 11:case 15:Ns(l,v),C&4&&Uh(5,v);break;case 1:if(Ns(l,v),C&4)if(l=v.stateNode,f===null)try{l.componentDidMount()}catch(De){jr(v,v.return,De)}else{var O=Xc(v.type,f.memoizedProps);f=f.memoizedState;try{l.componentDidUpdate(O,f,l.__reactInternalSnapshotBeforeUpdate)}catch(De){jr(v,v.return,De)}}C&64&&Zm(v),C&512&&Vu(v,v.return);break;case 3:if(Ns(l,v),C&64&&(C=v.updateQueue,C!==null)){if(l=null,v.child!==null)switch(v.child.tag){case 27:case 5:l=v.child.stateNode;break;case 1:l=v.child.stateNode}try{Yp(C,l)}catch(De){jr(v,v.return,De)}}break;case 26:Ns(l,v),C&512&&Vu(v,v.return);break;case 27:case 5:Ns(l,v),f===null&&C&4&&Vh(v),C&512&&Vu(v,v.return);break;case 12:Ns(l,v);break;case 13:Ns(l,v),C&4&&Wd(l,v);break;case 22:if(O=v.memoizedState!==null||Jo,!O){f=f!==null&&f.memoizedState!==null||Jr;var U=Jo,ae=Jr;Jo=O,(Jr=f)&&!ae?Gu(l,v,(v.subtreeFlags&8772)!==0):Ns(l,v),Jo=U,Jr=ae}C&512&&(v.memoizedProps.mode==="manual"?Vu(v,v.return):qn(v,v.return));break;default:Ns(l,v)}}function Kp(l){var f=l.alternate;f!==null&&(l.alternate=null,Kp(f)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(f=l.stateNode,f!==null&&rn(f)),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}var Rs=null,la=!1;function dc(l,f,v){for(v=v.child;v!==null;)Km(l,f,v),v=v.sibling}function Km(l,f,v){if(ss&&typeof ss.onCommitFiberUnmount=="function")try{ss.onCommitFiberUnmount(Ya,v)}catch{}switch(v.tag){case 26:Jr||qn(v,f),dc(l,f,v),v.memoizedState?v.memoizedState.count--:v.stateNode&&(v=v.stateNode,v.parentNode.removeChild(v));break;case 27:Jr||qn(v,f);var C=Rs,O=la;for(Rs=v.stateNode,dc(l,f,v),v=v.stateNode,f=v.attributes;f.length;)v.removeAttributeNode(f[0]);rn(v),Rs=C,la=O;break;case 5:Jr||qn(v,f);case 6:O=Rs;var U=la;if(Rs=null,dc(l,f,v),Rs=O,la=U,Rs!==null)if(la)try{l=Rs,C=v.stateNode,l.nodeType===8?l.parentNode.removeChild(C):l.removeChild(C)}catch(ae){jr(v,f,ae)}else try{Rs.removeChild(v.stateNode)}catch(ae){jr(v,f,ae)}break;case 18:Rs!==null&&(la?(f=Rs,v=v.stateNode,f.nodeType===8?c_(f.parentNode,v):f.nodeType===1&&c_(f,v),op(f)):c_(Rs,v.stateNode));break;case 4:C=Rs,O=la,Rs=v.stateNode.containerInfo,la=!0,dc(l,f,v),Rs=C,la=O;break;case 0:case 11:case 14:case 15:Jr||hc(2,v,f),Jr||hc(4,v,f),dc(l,f,v);break;case 1:Jr||(qn(v,f),C=v.stateNode,typeof C.componentWillUnmount=="function"&&Wm(v,f,C)),dc(l,f,v);break;case 21:dc(l,f,v);break;case 22:Jr||qn(v,f),Jr=(C=Jr)||v.memoizedState!==null,dc(l,f,v),Jr=C;break;default:dc(l,f,v)}}function Wd(l,f){if(f.memoizedState===null&&(l=f.alternate,l!==null&&(l=l.memoizedState,l!==null&&(l=l.dehydrated,l!==null))))try{op(l)}catch(v){jr(f,f.return,v)}}function Xd(l){switch(l.tag){case 13:case 19:var f=l.stateNode;return f===null&&(f=l.stateNode=new Gh),f;case 22:return l=l.stateNode,f=l._retryCache,f===null&&(f=l._retryCache=new Gh),f;default:throw Error(S(435,l.tag))}}function Pa(l,f){var v=Xd(l);f.forEach(function(C){var O=Jm.bind(null,l,C);v.has(C)||(v.add(C),C.then(O,O))})}function $s(l,f){var v=f.deletions;if(v!==null)for(var C=0;C<v.length;C++){var O=v[C],U=l,ae=f,De=ae;e:for(;De!==null;){switch(De.tag){case 27:case 5:Rs=De.stateNode,la=!1;break e;case 3:Rs=De.stateNode.containerInfo,la=!0;break e;case 4:Rs=De.stateNode.containerInfo,la=!0;break e}De=De.return}if(Rs===null)throw Error(S(160));Km(U,ae,O),Rs=null,la=!1,U=O.alternate,U!==null&&(U.return=null),O.return=null}if(f.subtreeFlags&13878)for(f=f.child;f!==null;)El(f,l),f=f.sibling}var Zs=null;function El(l,f){var v=l.alternate,C=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:$s(f,l),Ms(l),C&4&&(hc(3,l,l.return),Uh(3,l),hc(5,l,l.return));break;case 1:$s(f,l),Ms(l),C&512&&(Jr||v===null||qn(v,v.return)),C&64&&Jo&&(l=l.updateQueue,l!==null&&(C=l.callbacks,C!==null&&(v=l.shared.hiddenCallbacks,l.shared.hiddenCallbacks=v===null?C:v.concat(C))));break;case 26:var O=Zs;if($s(f,l),Ms(l),C&512&&(Jr||v===null||qn(v,v.return)),C&4){var U=v!==null?v.memoizedState:null;if(C=l.memoizedState,v===null)if(C===null)if(l.stateNode===null){e:{C=l.type,v=l.memoizedProps,O=O.ownerDocument||O;t:switch(C){case"title":U=O.getElementsByTagName("title")[0],(!U||U[on]||U[Be]||U.namespaceURI==="http://www.w3.org/2000/svg"||U.hasAttribute("itemprop"))&&(U=O.createElement(C),O.head.insertBefore(U,O.querySelector("head > title"))),ys(U,C,v),U[Be]=l,$n(U),C=U;break e;case"link":var ae=cg("link","href",O).get(C+(v.href||""));if(ae){for(var De=0;De<ae.length;De++)if(U=ae[De],U.getAttribute("href")===(v.href==null?null:v.href)&&U.getAttribute("rel")===(v.rel==null?null:v.rel)&&U.getAttribute("title")===(v.title==null?null:v.title)&&U.getAttribute("crossorigin")===(v.crossOrigin==null?null:v.crossOrigin)){ae.splice(De,1);break t}}U=O.createElement(C),ys(U,C,v),O.head.appendChild(U);break;case"meta":if(ae=cg("meta","content",O).get(C+(v.content||""))){for(De=0;De<ae.length;De++)if(U=ae[De],U.getAttribute("content")===(v.content==null?null:""+v.content)&&U.getAttribute("name")===(v.name==null?null:v.name)&&U.getAttribute("property")===(v.property==null?null:v.property)&&U.getAttribute("http-equiv")===(v.httpEquiv==null?null:v.httpEquiv)&&U.getAttribute("charset")===(v.charSet==null?null:v.charSet)){ae.splice(De,1);break t}}U=O.createElement(C),ys(U,C,v),O.head.appendChild(U);break;default:throw Error(S(468,C))}U[Be]=l,$n(U),C=U}l.stateNode=C}else m_(O,l.type,l.stateNode);else l.stateNode=f_(O,C,l.memoizedProps);else U!==C?(U===null?v.stateNode!==null&&(v=v.stateNode,v.parentNode.removeChild(v)):U.count--,C===null?m_(O,l.type,l.stateNode):f_(O,C,l.memoizedProps)):C===null&&l.stateNode!==null&&Xm(l,l.memoizedProps,v.memoizedProps)}break;case 27:if(C&4&&l.alternate===null){O=l.stateNode,U=l.memoizedProps;try{for(var Xe=O.firstChild;Xe;){var gt=Xe.nextSibling,si=Xe.nodeName;Xe[on]||si==="HEAD"||si==="BODY"||si==="SCRIPT"||si==="STYLE"||si==="LINK"&&Xe.rel.toLowerCase()==="stylesheet"||O.removeChild(Xe),Xe=gt}for(var yi=l.type,Ut=O.attributes;Ut.length;)O.removeAttributeNode(Ut[0]);ys(O,yi,U),O[Be]=l,O[Je]=U}catch(xn){jr(l,l.return,xn)}}case 5:if($s(f,l),Ms(l),C&512&&(Jr||v===null||qn(v,v.return)),l.flags&32){O=l.stateNode;try{ma(O,"")}catch(xn){jr(l,l.return,xn)}}C&4&&l.stateNode!=null&&(O=l.memoizedProps,Xm(l,O,v!==null?v.memoizedProps:O)),C&1024&&(Ro=!0);break;case 6:if($s(f,l),Ms(l),C&4){if(l.stateNode===null)throw Error(S(162));C=l.memoizedProps,v=l.stateNode;try{v.nodeValue=C}catch(xn){jr(l,l.return,xn)}}break;case 3:if(lg=null,O=Zs,Zs=rs(f.containerInfo),$s(f,l),Zs=O,Ms(l),C&4&&v!==null&&v.memoizedState.isDehydrated)try{op(f.containerInfo)}catch(xn){jr(l,l.return,xn)}Ro&&(Ro=!1,Qc(l));break;case 4:C=Zs,Zs=rs(l.stateNode.containerInfo),$s(f,l),Ms(l),Zs=C;break;case 12:$s(f,l),Ms(l);break;case 13:$s(f,l),Ms(l),l.child.flags&8192&&l.memoizedState!==null!=(v!==null&&v.memoizedState!==null)&&(or=As()),C&4&&(C=l.updateQueue,C!==null&&(l.updateQueue=null,Pa(l,C)));break;case 22:if(C&512&&(Jr||v===null||qn(v,v.return)),Xe=l.memoizedState!==null,gt=v!==null&&v.memoizedState!==null,si=Jo,yi=Jr,Jo=si||Xe,Jr=yi||gt,$s(f,l),Jr=yi,Jo=si,Ms(l),f=l.stateNode,f._current=l,f._visibility&=-3,f._visibility|=f._pendingVisibility&2,C&8192&&(f._visibility=Xe?f._visibility&-2:f._visibility|1,Xe&&(f=Jo||Jr,v===null||gt||f||qu(l)),l.memoizedProps===null||l.memoizedProps.mode!=="manual"))e:for(v=null,f=l;;){if(f.tag===5||f.tag===26||f.tag===27){if(v===null){gt=v=f;try{if(O=gt.stateNode,Xe)U=O.style,typeof U.setProperty=="function"?U.setProperty("display","none","important"):U.display="none";else{ae=gt.stateNode,De=gt.memoizedProps.style;var ti=De!=null&&De.hasOwnProperty("display")?De.display:null;ae.style.display=ti==null||typeof ti=="boolean"?"":(""+ti).trim()}}catch(xn){jr(gt,gt.return,xn)}}}else if(f.tag===6){if(v===null){gt=f;try{gt.stateNode.nodeValue=Xe?"":gt.memoizedProps}catch(xn){jr(gt,gt.return,xn)}}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===l)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break e;for(;f.sibling===null;){if(f.return===null||f.return===l)break e;v===f&&(v=null),f=f.return}v===f&&(v=null),f.sibling.return=f.return,f=f.sibling}C&4&&(C=l.updateQueue,C!==null&&(v=C.retryQueue,v!==null&&(C.retryQueue=null,Pa(l,v))));break;case 19:$s(f,l),Ms(l),C&4&&(C=l.updateQueue,C!==null&&(l.updateQueue=null,Pa(l,C)));break;case 21:break;default:$s(f,l),Ms(l)}}function Ms(l){var f=l.flags;if(f&2){try{if(l.tag!==27){e:{for(var v=l.return;v!==null;){if(Ym(v)){var C=v;break e}v=v.return}throw Error(S(160))}switch(C.tag){case 27:var O=C.stateNode,U=Hh(l);qh(l,U,O);break;case 5:var ae=C.stateNode;C.flags&32&&(ma(ae,""),C.flags&=-33);var De=Hh(l);qh(l,De,ae);break;case 3:case 4:var Xe=C.stateNode.containerInfo,gt=Hh(l);Hu(l,gt,Xe);break;default:throw Error(S(161))}}}catch(si){jr(l,l.return,si)}l.flags&=-3}f&4096&&(l.flags&=-4097)}function Qc(l){if(l.subtreeFlags&1024)for(l=l.child;l!==null;){var f=l;Qc(f),f.tag===5&&f.flags&1024&&f.stateNode.reset(),l=l.sibling}}function Ns(l,f){if(f.subtreeFlags&8772)for(f=f.child;f!==null;)$h(l,f.alternate,f),f=f.sibling}function qu(l){for(l=l.child;l!==null;){var f=l;switch(f.tag){case 0:case 11:case 14:case 15:hc(4,f,f.return),qu(f);break;case 1:qn(f,f.return);var v=f.stateNode;typeof v.componentWillUnmount=="function"&&Wm(f,f.return,v),qu(f);break;case 26:case 27:case 5:qn(f,f.return),qu(f);break;case 22:qn(f,f.return),f.memoizedState===null&&qu(f);break;default:qu(f)}l=l.sibling}}function Gu(l,f,v){for(v=v&&(f.subtreeFlags&8772)!==0,f=f.child;f!==null;){var C=f.alternate,O=l,U=f,ae=U.flags;switch(U.tag){case 0:case 11:case 15:Gu(O,U,v),Uh(4,U);break;case 1:if(Gu(O,U,v),C=U,O=C.stateNode,typeof O.componentDidMount=="function")try{O.componentDidMount()}catch(gt){jr(C,C.return,gt)}if(C=U,O=C.updateQueue,O!==null){var De=C.stateNode;try{var Xe=O.shared.hiddenCallbacks;if(Xe!==null)for(O.shared.hiddenCallbacks=null,O=0;O<Xe.length;O++)Xp(Xe[O],De)}catch(gt){jr(C,C.return,gt)}}v&&ae&64&&Zm(U),Vu(U,U.return);break;case 26:case 27:case 5:Gu(O,U,v),v&&C===null&&ae&4&&Vh(U),Vu(U,U.return);break;case 12:Gu(O,U,v);break;case 13:Gu(O,U,v),v&&ae&4&&Wd(O,U);break;case 22:U.memoizedState===null&&Gu(O,U,v),Vu(U,U.return);break;default:Gu(O,U,v)}f=f.sibling}}function u(l,f){var v=null;l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(v=l.memoizedState.cachePool.pool),l=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(l=f.memoizedState.cachePool.pool),l!==v&&(l!=null&&l.refCount++,v!=null&&Ql(v))}function t(l,f){l=null,f.alternate!==null&&(l=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==l&&(f.refCount++,l!=null&&Ql(l))}function r(l,f,v,C){if(f.subtreeFlags&10256)for(f=f.child;f!==null;)c(l,f,v,C),f=f.sibling}function c(l,f,v,C){var O=f.flags;switch(f.tag){case 0:case 11:case 15:r(l,f,v,C),O&2048&&Uh(9,f);break;case 3:r(l,f,v,C),O&2048&&(l=null,f.alternate!==null&&(l=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==l&&(f.refCount++,l!=null&&Ql(l)));break;case 12:if(O&2048){r(l,f,v,C),l=f.stateNode;try{var U=f.memoizedProps,ae=U.id,De=U.onPostCommit;typeof De=="function"&&De(ae,f.alternate===null?"mount":"update",l.passiveEffectDuration,-0)}catch(Xe){jr(f,f.return,Xe)}}else r(l,f,v,C);break;case 23:break;case 22:U=f.stateNode,f.memoizedState!==null?U._visibility&4?r(l,f,v,C):_(l,f):U._visibility&4?r(l,f,v,C):(U._visibility|=4,m(l,f,v,C,(f.subtreeFlags&10256)!==0)),O&2048&&u(f.alternate,f);break;case 24:r(l,f,v,C),O&2048&&t(f.alternate,f);break;default:r(l,f,v,C)}}function m(l,f,v,C,O){for(O=O&&(f.subtreeFlags&10256)!==0,f=f.child;f!==null;){var U=l,ae=f,De=v,Xe=C,gt=ae.flags;switch(ae.tag){case 0:case 11:case 15:m(U,ae,De,Xe,O),Uh(8,ae);break;case 23:break;case 22:var si=ae.stateNode;ae.memoizedState!==null?si._visibility&4?m(U,ae,De,Xe,O):_(U,ae):(si._visibility|=4,m(U,ae,De,Xe,O)),O&&gt&2048&&u(ae.alternate,ae);break;case 24:m(U,ae,De,Xe,O),O&&gt&2048&&t(ae.alternate,ae);break;default:m(U,ae,De,Xe,O)}f=f.sibling}}function _(l,f){if(f.subtreeFlags&10256)for(f=f.child;f!==null;){var v=l,C=f,O=C.flags;switch(C.tag){case 22:_(v,C),O&2048&&u(C.alternate,C);break;case 24:_(v,C),O&2048&&t(C.alternate,C);break;default:_(v,C)}f=f.sibling}}var w=8192;function E(l){if(l.subtreeFlags&w)for(l=l.child;l!==null;)R(l),l=l.sibling}function R(l){switch(l.tag){case 26:E(l),l.flags&w&&l.memoizedState!==null&&k0(Zs,l.memoizedState,l.memoizedProps);break;case 5:E(l);break;case 3:case 4:var f=Zs;Zs=rs(l.stateNode.containerInfo),E(l),Zs=f;break;case 22:l.memoizedState===null&&(f=l.alternate,f!==null&&f.memoizedState!==null?(f=w,w=16777216,E(l),w=f):E(l));break;default:E(l)}}function D(l){var f=l.alternate;if(f!==null&&(l=f.child,l!==null)){f.child=null;do f=l.sibling,l.sibling=null,l=f;while(l!==null)}}function L(l){var f=l.deletions;if((l.flags&16)!==0){if(f!==null)for(var v=0;v<f.length;v++){var C=f[v];Wn=C,H(C,l)}D(l)}if(l.subtreeFlags&10256)for(l=l.child;l!==null;)F(l),l=l.sibling}function F(l){switch(l.tag){case 0:case 11:case 15:L(l),l.flags&2048&&hc(9,l,l.return);break;case 3:L(l);break;case 12:L(l);break;case 22:var f=l.stateNode;l.memoizedState!==null&&f._visibility&4&&(l.return===null||l.return.tag!==13)?(f._visibility&=-5,k(l)):L(l);break;default:L(l)}}function k(l){var f=l.deletions;if((l.flags&16)!==0){if(f!==null)for(var v=0;v<f.length;v++){var C=f[v];Wn=C,H(C,l)}D(l)}for(l=l.child;l!==null;){switch(f=l,f.tag){case 0:case 11:case 15:hc(8,f,f.return),k(f);break;case 22:v=f.stateNode,v._visibility&4&&(v._visibility&=-5,k(f));break;default:k(f)}l=l.sibling}}function H(l,f){for(;Wn!==null;){var v=Wn;switch(v.tag){case 0:case 11:case 15:hc(8,v,f);break;case 23:case 22:if(v.memoizedState!==null&&v.memoizedState.cachePool!==null){var C=v.memoizedState.cachePool.pool;C!=null&&C.refCount++}break;case 24:Ql(v.memoizedState.cache)}if(C=v.child,C!==null)C.return=v,Wn=C;else e:for(v=l;Wn!==null;){C=Wn;var O=C.sibling,U=C.return;if(Kp(C),C===v){Wn=null;break e}if(O!==null){O.return=U,Wn=O;break e}Wn=U}}}function $(l,f,v,C){this.tag=l,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=C,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function G(l,f,v,C){return new $(l,f,v,C)}function ee(l){return l=l.prototype,!(!l||!l.isReactComponent)}function X(l,f){var v=l.alternate;return v===null?(v=G(l.tag,f,l.key,l.mode),v.elementType=l.elementType,v.type=l.type,v.stateNode=l.stateNode,v.alternate=l,l.alternate=v):(v.pendingProps=f,v.type=l.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=l.flags&31457280,v.childLanes=l.childLanes,v.lanes=l.lanes,v.child=l.child,v.memoizedProps=l.memoizedProps,v.memoizedState=l.memoizedState,v.updateQueue=l.updateQueue,f=l.dependencies,v.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},v.sibling=l.sibling,v.index=l.index,v.ref=l.ref,v.refCleanup=l.refCleanup,v}function ie(l,f){l.flags&=31457282;var v=l.alternate;return v===null?(l.childLanes=0,l.lanes=f,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=v.childLanes,l.lanes=v.lanes,l.child=v.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=v.memoizedProps,l.memoizedState=v.memoizedState,l.updateQueue=v.updateQueue,l.type=v.type,f=v.dependencies,l.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),l}function ce(l,f,v,C,O,U){var ae=0;if(C=l,typeof l=="function")ee(l)&&(ae=1);else if(typeof l=="string")ae=g_(l,v,Ei.current)?26:l==="html"||l==="head"||l==="body"?27:5;else e:switch(l){case q:return de(v.children,O,U,f);case Z:ae=8,O|=24;break;case Q:return l=G(12,v,f,O|2),l.elementType=Q,l.lanes=U,l;case Se:return l=G(13,v,f,O),l.elementType=Se,l.lanes=U,l;case te:return l=G(19,v,f,O),l.elementType=te,l.lanes=U,l;case ye:return Te(v,O,U,f);default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case oe:case ze:ae=10;break e;case pe:ae=9;break e;case le:ae=11;break e;case ge:ae=14;break e;case xe:ae=16,C=null;break e}ae=29,v=Error(S(130,l===null?"null":typeof l,"")),C=null}return f=G(ae,v,f,O),f.elementType=l,f.type=C,f.lanes=U,f}function de(l,f,v,C){return l=G(7,l,C,f),l.lanes=v,l}function Te(l,f,v,C){l=G(22,l,C,f),l.elementType=ye,l.lanes=v;var O={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var U=O._current;if(U===null)throw Error(S(456));if((O._pendingVisibility&2)===0){var ae=ro(U,2);ae!==null&&(O._pendingVisibility|=2,kn(ae,U,2))}},attach:function(){var U=O._current;if(U===null)throw Error(S(456));if((O._pendingVisibility&2)!==0){var ae=ro(U,2);ae!==null&&(O._pendingVisibility&=-3,kn(ae,U,2))}}};return l.stateNode=O,l}function we(l,f,v){return l=G(6,l,null,f),l.lanes=v,l}function Ee(l,f,v){return f=G(4,l.children!==null?l.children:[],l.key,f),f.lanes=v,f.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},f}function ve(l){l.flags|=4}function be(l,f){if(f.type!=="stylesheet"||(f.state.loading&4)!==0)l.flags&=-16777217;else if(l.flags|=16777216,!ug(f)){if(f=Va.current,f!==null&&((ht&4194176)===ht?So!==null:(ht&62914560)!==ht&&(ht&536870912)===0||f!==So))throw Nc=bd,Lp;l.flags|=8192}}function Ce(l,f){f!==null&&(l.flags|=4),l.flags&16384&&(f=l.tag!==22?go():536870912,l.lanes|=f,zn|=f)}function We(l,f){if(!xr)switch(l.tailMode){case"hidden":f=l.tail;for(var v=null;f!==null;)f.alternate!==null&&(v=f),f=f.sibling;v===null?l.tail=null:v.sibling=null;break;case"collapsed":v=l.tail;for(var C=null;v!==null;)v.alternate!==null&&(C=v),v=v.sibling;C===null?f||l.tail===null?l.tail=null:l.tail.sibling=null:C.sibling=null}}function je(l){var f=l.alternate!==null&&l.alternate.child===l.child,v=0,C=0;if(f)for(var O=l.child;O!==null;)v|=O.lanes|O.childLanes,C|=O.subtreeFlags&31457280,C|=O.flags&31457280,O.return=l,O=O.sibling;else for(O=l.child;O!==null;)v|=O.lanes|O.childLanes,C|=O.subtreeFlags,C|=O.flags,O.return=l,O=O.sibling;return l.subtreeFlags|=C,l.childLanes=v,f}function ct(l,f,v){var C=f.pendingProps;switch(Pp(f),f.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return je(f),null;case 1:return je(f),null;case 3:return v=f.stateNode,C=null,l!==null&&(C=l.memoizedState.cache),f.memoizedState.cache!==C&&(f.flags|=2048),Xo(Ts),qr(),v.pendingContext&&(v.context=v.pendingContext,v.pendingContext=null),(l===null||l.child===null)&&(dl(f)?ve(f):l===null||l.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,Vo!==null&&(ms(Vo),Vo=null))),je(f),null;case 26:return v=f.memoizedState,l===null?(ve(f),v!==null?(je(f),be(f,v)):(je(f),f.flags&=-16777217)):v?v!==l.memoizedState?(ve(f),je(f),be(f,v)):(je(f),f.flags&=-16777217):(l.memoizedProps!==C&&ve(f),je(f),f.flags&=-16777217),null;case 27:fa(f),v=Mn.current;var O=f.type;if(l!==null&&f.stateNode!=null)l.memoizedProps!==C&&ve(f);else{if(!C){if(f.stateNode===null)throw Error(S(166));return je(f),null}l=Ei.current,dl(f)?Sf(f):(l=h_(O,C,v),f.stateNode=l,ve(f))}return je(f),null;case 5:if(fa(f),v=f.type,l!==null&&f.stateNode!=null)l.memoizedProps!==C&&ve(f);else{if(!C){if(f.stateNode===null)throw Error(S(166));return je(f),null}if(l=Ei.current,dl(f))Sf(f);else{switch(O=sg(Mn.current),l){case 1:l=O.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:l=O.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":l=O.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":l=O.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":l=O.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild);break;case"select":l=typeof C.is=="string"?O.createElement("select",{is:C.is}):O.createElement("select"),C.multiple?l.multiple=!0:C.size&&(l.size=C.size);break;default:l=typeof C.is=="string"?O.createElement(v,{is:C.is}):O.createElement(v)}}l[Be]=f,l[Je]=C;e:for(O=f.child;O!==null;){if(O.tag===5||O.tag===6)l.appendChild(O.stateNode);else if(O.tag!==4&&O.tag!==27&&O.child!==null){O.child.return=O,O=O.child;continue}if(O===f)break e;for(;O.sibling===null;){if(O.return===null||O.return===f)break e;O=O.return}O.sibling.return=O.return,O=O.sibling}f.stateNode=l;e:switch(ys(l,v,C),v){case"button":case"input":case"select":case"textarea":l=!!C.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&ve(f)}}return je(f),f.flags&=-16777217,null;case 6:if(l&&f.stateNode!=null)l.memoizedProps!==C&&ve(f);else{if(typeof C!="string"&&f.stateNode===null)throw Error(S(166));if(l=Mn.current,dl(f)){if(l=f.stateNode,v=f.memoizedProps,C=null,O=xa,O!==null)switch(O.tag){case 27:case 5:C=O.memoizedProps}l[Be]=f,l=!!(l.nodeValue===v||C!==null&&C.suppressHydrationWarning===!0||o_(l.nodeValue,v)),l||hl(f)}else l=sg(l).createTextNode(C),l[Be]=f,f.stateNode=l}return je(f),null;case 13:if(C=f.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(O=dl(f),C!==null&&C.dehydrated!==null){if(l===null){if(!O)throw Error(S(318));if(O=f.memoizedState,O=O!==null?O.dehydrated:null,!O)throw Error(S(317));O[Be]=f}else Oc(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;je(f),O=!1}else Vo!==null&&(ms(Vo),Vo=null),O=!0;if(!O)return f.flags&256?(ml(f),f):(ml(f),null)}if(ml(f),(f.flags&128)!==0)return f.lanes=v,f;if(v=C!==null,l=l!==null&&l.memoizedState!==null,v){C=f.child,O=null,C.alternate!==null&&C.alternate.memoizedState!==null&&C.alternate.memoizedState.cachePool!==null&&(O=C.alternate.memoizedState.cachePool.pool);var U=null;C.memoizedState!==null&&C.memoizedState.cachePool!==null&&(U=C.memoizedState.cachePool.pool),U!==O&&(C.flags|=2048)}return v!==l&&v&&(f.child.flags|=8192),Ce(f,f.updateQueue),je(f),null;case 4:return qr(),l===null&&ig(f.stateNode.containerInfo),je(f),null;case 10:return Xo(f.type),je(f),null;case 19:if(xt(zr),O=f.memoizedState,O===null)return je(f),null;if(C=(f.flags&128)!==0,U=O.rendering,U===null)if(C)We(O,!1);else{if(ei!==0||l!==null&&(l.flags&128)!==0)for(l=f.child;l!==null;){if(U=Eu(l),U!==null){for(f.flags|=128,We(O,!1),l=U.updateQueue,f.updateQueue=l,Ce(f,l),f.subtreeFlags=0,l=v,v=f.child;v!==null;)ie(v,l),v=v.sibling;return St(zr,zr.current&1|2),f.child}l=l.sibling}O.tail!==null&&As()>Xi&&(f.flags|=128,C=!0,We(O,!1),f.lanes=4194304)}else{if(!C)if(l=Eu(U),l!==null){if(f.flags|=128,C=!0,l=l.updateQueue,f.updateQueue=l,Ce(f,l),We(O,!0),O.tail===null&&O.tailMode==="hidden"&&!U.alternate&&!xr)return je(f),null}else 2*As()-O.renderingStartTime>Xi&&v!==536870912&&(f.flags|=128,C=!0,We(O,!1),f.lanes=4194304);O.isBackwards?(U.sibling=f.child,f.child=U):(l=O.last,l!==null?l.sibling=U:f.child=U,O.last=U)}return O.tail!==null?(f=O.tail,O.rendering=f,O.tail=f.sibling,O.renderingStartTime=As(),f.sibling=null,l=zr.current,St(zr,C?l&1|2:l&1),f):(je(f),null);case 22:case 23:return ml(f),pl(),C=f.memoizedState!==null,l!==null?l.memoizedState!==null!==C&&(f.flags|=8192):C&&(f.flags|=8192),C?(v&536870912)!==0&&(f.flags&128)===0&&(je(f),f.subtreeFlags&6&&(f.flags|=8192)):je(f),v=f.updateQueue,v!==null&&Ce(f,v.retryQueue),v=null,l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(v=l.memoizedState.cachePool.pool),C=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(C=f.memoizedState.cachePool.pool),C!==v&&(f.flags|=2048),l!==null&&xt(Cu),null;case 24:return v=null,l!==null&&(v=l.memoizedState.cache),f.memoizedState.cache!==v&&(f.flags|=2048),Xo(Ts),je(f),null;case 25:return null}throw Error(S(156,f.tag))}function Ze(l,f){switch(Pp(f),f.tag){case 1:return l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 3:return Xo(Ts),qr(),l=f.flags,(l&65536)!==0&&(l&128)===0?(f.flags=l&-65537|128,f):null;case 26:case 27:case 5:return fa(f),null;case 13:if(ml(f),l=f.memoizedState,l!==null&&l.dehydrated!==null){if(f.alternate===null)throw Error(S(340));Oc()}return l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 19:return xt(zr),null;case 4:return qr(),null;case 10:return Xo(f.type),null;case 22:case 23:return ml(f),pl(),l!==null&&xt(Cu),l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 24:return Xo(Ts),null;case 25:return null;default:return null}}function ot(l,f){switch(Pp(f),f.tag){case 3:Xo(Ts),qr();break;case 26:case 27:case 5:fa(f);break;case 4:qr();break;case 13:ml(f);break;case 19:xt(zr);break;case 10:Xo(f.type);break;case 22:case 23:ml(f),pl(),l!==null&&xt(Cu);break;case 24:Xo(Ts)}}var jt={getCacheForType:function(l){var f=Gs(Ts),v=f.data.get(l);return v===void 0&&(v=l(),f.data.set(l,v)),v}},Ye=typeof WeakMap=="function"?WeakMap:Map,Oe=0,nt=null,Ge=null,ht=0,_t=0,qt=null,Ct=!1,Tt=!1,gi=!1,oi=0,ei=0,li=0,Li=0,Ki=0,Hi=0,zn=0,qi=null,_n=null,On=!1,or=0,Xi=1/0,Rn=null,bn=null,Dn=!1,Qn=null,Er=0,ns=0,ur=null,Ji=0,Pi=null;function vn(){if((Oe&2)!==0&&ht!==0)return ht&-ht;if(ut.T!==null){var l=_l;return l!==0?l:Xf()}return Le()}function Mr(){Hi===0&&(Hi=(ht&536870912)===0||xr?ea():536870912);var l=Va.current;return l!==null&&(l.flags|=32),Hi}function kn(l,f,v){(l===nt&&_t===2||l.cancelPendingCommit!==null)&&(ua(l,0),gs(l,ht,Hi,!1)),He(l,v),((Oe&2)===0||l!==nt)&&(l===nt&&((Oe&2)===0&&(Li|=v),ei===4&&gs(l,ht,Hi,!1)),ha(l))}function Zr(l,f,v){if((Oe&6)!==0)throw Error(S(327));var C=!v&&(f&60)===0&&(f&l.expiredLanes)===0||pa(l,f),O=C?Wr(l,f):Qr(l,f,!0),U=C;do{if(O===0){Tt&&!C&&gs(l,f,0,!1);break}else if(O===6)gs(l,f,0,!Ct);else{if(v=l.current.alternate,U&&!co(v)){O=Qr(l,f,!1),U=!1;continue}if(O===2){if(U=f,l.errorRecoveryDisabledLanes&U)var ae=0;else ae=l.pendingLanes&-536870913,ae=ae!==0?ae:ae&536870912?536870912:0;if(ae!==0){f=ae;e:{var De=l;O=qi;var Xe=De.current.memoizedState.isDehydrated;if(Xe&&(ua(De,ae).flags|=256),ae=Qr(De,ae,!1),ae!==2){if(gi&&!Xe){De.errorRecoveryDisabledLanes|=U,Li|=U,O=4;break e}U=_n,_n=O,U!==null&&ms(U)}O=ae}if(U=!1,O!==2)continue}}if(O===1){ua(l,0),gs(l,f,0,!0);break}e:{switch(C=l,O){case 0:case 1:throw Error(S(345));case 4:if((f&4194176)===f){gs(C,f,Hi,!Ct);break e}break;case 2:_n=null;break;case 3:case 5:break;default:throw Error(S(329))}if(C.finishedWork=v,C.finishedLanes=f,(f&62914560)===f&&(U=or+300-As(),10<U)){if(gs(C,f,Hi,!Ct),No(C,0)!==0)break e;C.timeoutHandle=Yh(Ga.bind(null,C,v,_n,Rn,On,f,Hi,Li,zn,Ct,2,-0,0),U);break e}Ga(C,v,_n,Rn,On,f,Hi,Li,zn,Ct,0,-0,0)}}break}while(!0);ha(l)}function ms(l){_n===null?_n=l:_n.push.apply(_n,l)}function Ga(l,f,v,C,O,U,ae,De,Xe,gt,si,yi,Ut){var ti=f.subtreeFlags;if((ti&8192||(ti&16785408)===16785408)&&(np={stylesheets:null,count:0,unsuspend:O0},R(f),f=N0(),f!==null)){l.cancelPendingCommit=f(il.bind(null,l,v,C,O,ae,De,Xe,1,yi,Ut)),gs(l,U,ae,!gt);return}il(l,v,C,O,ae,De,Xe,si,yi,Ut)}function co(l){for(var f=l;;){var v=f.tag;if((v===0||v===11||v===15)&&f.flags&16384&&(v=f.updateQueue,v!==null&&(v=v.stores,v!==null)))for(var C=0;C<v.length;C++){var O=v[C],U=O.getSnapshot;O=O.value;try{if(!Ua(U(),O))return!1}catch{return!1}}if(v=f.child,f.subtreeFlags&16384&&v!==null)v.return=f,f=v;else{if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function gs(l,f,v,C){f&=~Ki,f&=~Li,l.suspendedLanes|=f,l.pingedLanes&=~f,C&&(l.warmLanes|=f),C=l.expirationTimes;for(var O=f;0<O;){var U=31-hs(O),ae=1<<U;C[U]=-1,O&=~ae}v!==0&&ne(l,v,f)}function ca(){return(Oe&6)===0?(nl(0),!1):!0}function Ws(){if(Ge!==null){if(_t===0)var l=Ge.return;else l=Ge,lo=lc=null,Rh(l),Yl=null,Kl=0,l=Ge;for(;l!==null;)ot(l.alternate,l),l=l.return;Ge=null}}function ua(l,f){l.finishedWork=null,l.finishedLanes=0;var v=l.timeoutHandle;v!==-1&&(l.timeoutHandle=-1,am(v)),v=l.cancelPendingCommit,v!==null&&(l.cancelPendingCommit=null,v()),Ws(),nt=l,Ge=v=X(l.current,null),ht=f,_t=0,qt=null,Ct=!1,Tt=pa(l,f),gi=!1,zn=Hi=Ki=Li=li=ei=0,_n=qi=null,On=!1,(f&8)!==0&&(f|=f&32);var C=l.entangledLanes;if(C!==0)for(l=l.entanglements,C&=f;0<C;){var O=31-hs(C),U=1<<O;f|=l[O],C&=~U}return oi=f,Vt(),v}function Mo(l,f){Jn=null,ut.H=Wo,f===fl?(f=Ef(),_t=3):f===Lp?(f=Ef(),_t=4):_t=f===ac?8:f!==null&&typeof f=="object"&&typeof f.then=="function"?6:1,qt=f,Ge===null&&(ei=1,Nh(l,os(f,l.current)))}function Dr(){var l=ut.H;return ut.H=Wo,l===null?Wo:l}function Nr(){var l=ut.A;return ut.A=jt,l}function pr(){ei=4,Ct||(ht&4194176)!==ht&&Va.current!==null||(Tt=!0),(li&134217727)===0&&(Li&134217727)===0||nt===null||gs(nt,ht,Hi,!1)}function Qr(l,f,v){var C=Oe;Oe|=2;var O=Dr(),U=Nr();(nt!==l||ht!==f)&&(Rn=null,ua(l,f)),f=!1;var ae=ei;e:do try{if(_t!==0&&Ge!==null){var De=Ge,Xe=qt;switch(_t){case 8:Ws(),ae=6;break e;case 3:case 2:case 6:Va.current===null&&(f=!0);var gt=_t;if(_t=0,qt=null,va(l,De,Xe,gt),v&&Tt){ae=0;break e}break;default:gt=_t,_t=0,qt=null,va(l,De,Xe,gt)}}_s(),ae=ei;break}catch(si){Mo(l,si)}while(!0);return f&&l.shellSuspendCounter++,lo=lc=null,Oe=C,ut.H=O,ut.A=U,Ge===null&&(nt=null,ht=0,Vt()),ae}function _s(){for(;Ge!==null;)el(Ge)}function Wr(l,f){var v=Oe;Oe|=2;var C=Dr(),O=Nr();nt!==l||ht!==f?(Rn=null,Xi=As()+500,ua(l,f)):Tt=pa(l,f);e:do try{if(_t!==0&&Ge!==null){f=Ge;var U=qt;t:switch(_t){case 1:_t=0,qt=null,va(l,f,U,1);break;case 2:if(Op(U)){_t=0,qt=null,Al(f);break}f=function(){_t===2&&nt===l&&(_t=7),ha(l)},U.then(f,f);break e;case 3:_t=7;break e;case 4:_t=5;break e;case 7:Op(U)?(_t=0,qt=null,Al(f)):(_t=0,qt=null,va(l,f,U,7));break;case 5:var ae=null;switch(Ge.tag){case 26:ae=Ge.memoizedState;case 5:case 27:var De=Ge;if(!ae||ug(ae)){_t=0,qt=null;var Xe=De.sibling;if(Xe!==null)Ge=Xe;else{var gt=De.return;gt!==null?(Ge=gt,tl(gt)):Ge=null}break t}}_t=0,qt=null,va(l,f,U,5);break;case 6:_t=0,qt=null,va(l,f,U,6);break;case 8:Ws(),ei=6;break e;default:throw Error(S(462))}}Xs();break}catch(si){Mo(l,si)}while(!0);return lo=lc=null,ut.H=C,ut.A=O,Oe=v,Ge!==null?0:(nt=null,ht=0,Vt(),ei)}function Xs(){for(;Ge!==null&&!po();)el(Ge)}function el(l){var f=is(l.alternate,l,oi);l.memoizedProps=l.pendingProps,f===null?tl(l):Ge=f}function Al(l){var f=l,v=f.alternate;switch(f.tag){case 15:case 0:f=Fd(v,f,f.pendingProps,f.type,void 0,ht);break;case 11:f=Fd(v,f,f.pendingProps,f.type.render,f.ref,ht);break;case 5:Rh(f);default:ot(v,f),f=Ge=ie(f,oi),f=is(v,f,oi)}l.memoizedProps=l.pendingProps,f===null?tl(l):Ge=f}function va(l,f,v,C){lo=lc=null,Rh(f),Yl=null,Kl=0;var O=f.return;try{if(aa(l,O,f,v,ht)){ei=1,Nh(l,os(v,l.current)),Ge=null;return}}catch(U){if(O!==null)throw Ge=O,U;ei=1,Nh(l,os(v,l.current)),Ge=null;return}f.flags&32768?(xr||C===1?l=!0:Tt||(ht&536870912)!==0?l=!1:(Ct=l=!0,(C===2||C===3||C===6)&&(C=Va.current,C!==null&&C.tag===13&&(C.flags|=16384))),fc(f,l)):tl(f)}function tl(l){var f=l;do{if((f.flags&32768)!==0){fc(f,Ct);return}l=f.return;var v=ct(f.alternate,f,oi);if(v!==null){Ge=v;return}if(f=f.sibling,f!==null){Ge=f;return}Ge=f=l}while(f!==null);ei===0&&(ei=5)}function fc(l,f){do{var v=Ze(l.alternate,l);if(v!==null){v.flags&=32767,Ge=v;return}if(v=l.return,v!==null&&(v.flags|=32768,v.subtreeFlags=0,v.deletions=null),!f&&(l=l.sibling,l!==null)){Ge=l;return}Ge=l=v}while(l!==null);ei=6,Ge=null}function il(l,f,v,C,O,U,ae,De,Xe,gt){var si=ut.T,yi=ii.p;try{ii.p=2,ut.T=null,Zh(l,f,v,C,yi,O,U,ae,De,Xe,gt)}finally{ut.T=si,ii.p=yi}}function Zh(l,f,v,C,O,U,ae,De){do La();while(Qn!==null);if((Oe&6)!==0)throw Error(S(327));var Xe=l.finishedWork;if(C=l.finishedLanes,Xe===null)return null;if(l.finishedWork=null,l.finishedLanes=0,Xe===l.current)throw Error(S(177));l.callbackNode=null,l.callbackPriority=0,l.cancelPendingCommit=null;var gt=Xe.lanes|Xe.childLanes;if(gt|=_h,J(l,C,gt,U,ae,De),l===nt&&(Ge=nt=null,ht=0),(Xe.subtreeFlags&10256)===0&&(Xe.flags&10256)===0||Dn||(Dn=!0,ns=gt,ur=v,F1(Bs,function(){return La(),null})),v=(Xe.flags&15990)!==0,(Xe.subtreeFlags&15990)!==0||v?(v=ut.T,ut.T=null,U=ii.p,ii.p=2,ae=Oe,Oe|=4,Zd(l,Xe),El(Xe,l),mh(Yd,l.containerInfo),hm=!!rg,Yd=rg=null,l.current=Xe,$h(l,Xe.alternate,Xe),mo(),Oe=ae,ii.p=U,ut.T=v):l.current=Xe,Dn?(Dn=!1,Qn=l,Er=C):Cl(l,gt),gt=l.pendingLanes,gt===0&&(bn=null),Ka(Xe.stateNode),ha(l),f!==null)for(O=l.onRecoverableError,Xe=0;Xe<f.length;Xe++)gt=f[Xe],O(gt.value,{componentStack:gt.stack});return(Er&3)!==0&&La(),gt=l.pendingLanes,(C&4194218)!==0&&(gt&42)!==0?l===Pi?Ji++:(Ji=0,Pi=l):Ji=0,nl(0),null}function Cl(l,f){(l.pooledCacheLanes&=f)===0&&(f=l.pooledCache,f!=null&&(l.pooledCache=null,Ql(f)))}function La(){if(Qn!==null){var l=Qn,f=ns;ns=0;var v=ke(Er),C=ut.T,O=ii.p;try{if(ii.p=32>v?32:v,ut.T=null,Qn===null)var U=!1;else{v=ur,ur=null;var ae=Qn,De=Er;if(Qn=null,Er=0,(Oe&6)!==0)throw Error(S(331));var Xe=Oe;if(Oe|=4,F(ae.current),c(ae,ae.current,De,v),Oe=Xe,nl(0,!1),ss&&typeof ss.onPostCommitFiberRoot=="function")try{ss.onPostCommitFiberRoot(Ya,ae)}catch{}U=!0}return U}finally{ii.p=O,ut.T=C,Cl(l,f)}}return!1}function Rl(l,f,v){f=os(v,f),f=qp(l.stateNode,f,2),l=Ko(l,f,2),l!==null&&(He(l,2),ha(l))}function jr(l,f,v){if(l.tag===3)Rl(l,l,v);else for(;f!==null;){if(f.tag===3){Rl(f,l,v);break}else if(f.tag===1){var C=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof C.componentDidCatch=="function"&&(bn===null||!bn.has(C))){l=os(v,l),v=Gp(2),C=Ko(f,v,2),C!==null&&($p(v,C,f,l),He(C,2),ha(C));break}}f=f.return}}function Ys(l,f,v){var C=l.pingCache;if(C===null){C=l.pingCache=new Ye;var O=new Set;C.set(f,O)}else O=C.get(f),O===void 0&&(O=new Set,C.set(f,O));O.has(v)||(gi=!0,O.add(v),l=Wf.bind(null,l,f,v),f.then(l,l))}function Wf(l,f,v){var C=l.pingCache;C!==null&&C.delete(f),l.pingedLanes|=l.suspendedLanes&v,l.warmLanes&=~v,nt===l&&(ht&v)===v&&(ei===4||ei===3&&(ht&62914560)===ht&&300>As()-or?(Oe&2)===0&&ua(l,0):Ki|=v,zn===ht&&(zn=0)),ha(l)}function v0(l,f){f===0&&(f=go()),l=ro(l,f),l!==null&&(He(l,f),ha(l))}function B1(l){var f=l.memoizedState,v=0;f!==null&&(v=f.retryLane),v0(l,v)}function Jm(l,f){var v=0;switch(l.tag){case 13:var C=l.stateNode,O=l.memoizedState;O!==null&&(v=O.retryLane);break;case 19:C=l.stateNode;break;case 22:C=l.stateNode._retryCache;break;default:throw Error(S(314))}C!==null&&C.delete(f),v0(l,v)}function F1(l,f){return es(l,f)}var Jp=null,$u=null,Xg=!1,Qp=!1,Yg=!1,Zu=0;function ha(l){l!==$u&&l.next===null&&($u===null?Jp=$u=l:$u=$u.next=l),Qp=!0,Xg||(Xg=!0,tm(b0))}function nl(l,f){if(!Yg&&Qp){Yg=!0;do for(var v=!1,C=Jp;C!==null;){if(l!==0){var O=C.pendingLanes;if(O===0)var U=0;else{var ae=C.suspendedLanes,De=C.pingedLanes;U=(1<<31-hs(42|l)+1)-1,U&=O&~(ae&~De),U=U&201326677?U&201326677|1:U?U|2:0}U!==0&&(v=!0,Qm(C,U))}else U=ht,U=No(C,C===nt?U:0),(U&3)===0||pa(C,U)||(v=!0,Qm(C,U));C=C.next}while(v);Yg=!1}}function b0(){Qp=Xg=!1;var l=0;Zu!==0&&(C0()&&(l=Zu),Zu=0);for(var f=As(),v=null,C=Jp;C!==null;){var O=C.next,U=Kg(C,f);U===0?(C.next=null,v===null?Jp=O:v.next=O,O===null&&($u=v)):(v=C,(l!==0||(U&3)!==0)&&(Qp=!0)),C=O}nl(l)}function Kg(l,f){for(var v=l.suspendedLanes,C=l.pingedLanes,O=l.expirationTimes,U=l.pendingLanes&-62914561;0<U;){var ae=31-hs(U),De=1<<ae,Xe=O[ae];Xe===-1?((De&v)===0||(De&C)!==0)&&(O[ae]=Mt(De,f)):Xe<=f&&(l.expiredLanes|=De),U&=~De}if(f=nt,v=ht,v=No(l,l===f?v:0),C=l.callbackNode,v===0||l===f&&_t===2||l.cancelPendingCommit!==null)return C!==null&&C!==null&&js(C),l.callbackNode=null,l.callbackPriority=0;if((v&3)===0||pa(l,v)){if(f=v&-v,f===l.callbackPriority)return f;switch(C!==null&&js(C),ke(v)){case 2:case 8:v=Yr;break;case 32:v=Bs;break;case 268435456:v=Sa;break;default:v=Bs}return C=em.bind(null,l),v=es(v,C),l.callbackPriority=f,l.callbackNode=v,f}return C!==null&&C!==null&&js(C),l.callbackPriority=2,l.callbackNode=null,2}function em(l,f){var v=l.callbackNode;if(La()&&l.callbackNode!==v)return null;var C=ht;return C=No(l,l===nt?C:0),C===0?null:(Zr(l,C,f),Kg(l,As()),l.callbackNode!=null&&l.callbackNode===v?em.bind(null,l):null)}function Qm(l,f){if(La())return null;Zr(l,f,!0)}function tm(l){U1(function(){(Oe&6)!==0?es(Gr,l):l()})}function Xf(){return Zu===0&&(Zu=ea()),Zu}function Jg(l){return l==null||typeof l=="symbol"||typeof l=="boolean"?null:typeof l=="function"?l:Ec(""+l)}function im(l,f){var v=f.ownerDocument.createElement("input");return v.name=f.name,v.value=f.value,l.id&&v.setAttribute("form",l.id),f.parentNode.insertBefore(v,f),l=new FormData(l),v.parentNode.removeChild(v),l}function Qg(l,f,v,C,O){if(f==="submit"&&v&&v.stateNode===O){var U=Jg((O[Je]||null).action),ae=C.submitter;ae&&(f=(f=ae[Je]||null)?Jg(f.formAction):ae.getAttribute("formAction"),f!==null&&(U=f,ae=null));var De=new cd("action","action",null,C,O);l.push({event:De,listeners:[{instance:null,listener:function(){if(C.defaultPrevented){if(Zu!==0){var Xe=ae?im(O,ae):new FormData(O);Zo(v,{pending:!0,data:Xe,method:O.method,action:U},null,Xe)}}else typeof U=="function"&&(De.preventDefault(),Xe=ae?im(O,ae):new FormData(O),Zo(v,{pending:!0,data:Xe,method:O.method,action:U},U,Xe))},currentTarget:O}]})}}for(var nm=0;nm<Tu.length;nm++){var eg=Tu[nm],w0=eg.toLowerCase(),Wh=eg[0].toUpperCase()+eg.slice(1);no(w0,"on"+Wh)}no(Rp,"onAnimationEnd"),no(Mp,"onAnimationIteration"),no(Ip,"onAnimationStart"),no("dblclick","onDoubleClick"),no("focusin","onFocus"),no("focusout","onBlur"),no(bu,"onTransitionRun"),no(yd,"onTransitionStart"),no(zp,"onTransitionCancel"),no(bf,"onTransitionEnd"),Qt("onMouseEnter",["mouseout","mouseover"]),Qt("onMouseLeave",["mouseout","mouseover"]),Qt("onPointerEnter",["pointerout","pointerover"]),Qt("onPointerLeave",["pointerout","pointerover"]),Bt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Bt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Bt("onBeforeInput",["compositionend","keypress","textInput","paste"]),Bt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Bt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Bt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),e_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Yf));function t_(l,f){f=(f&4)!==0;for(var v=0;v<l.length;v++){var C=l[v],O=C.event;C=C.listeners;e:{var U=void 0;if(f)for(var ae=C.length-1;0<=ae;ae--){var De=C[ae],Xe=De.instance,gt=De.currentTarget;if(De=De.listener,Xe!==U&&O.isPropagationStopped())break e;U=De,O.currentTarget=gt;try{U(O)}catch(si){Nd(si)}O.currentTarget=null,U=Xe}else for(ae=0;ae<C.length;ae++){if(De=C[ae],Xe=De.instance,gt=De.currentTarget,De=De.listener,Xe!==U&&O.isPropagationStopped())break e;U=De,O.currentTarget=gt;try{U(O)}catch(si){Nd(si)}O.currentTarget=null,U=Xe}}}}function Ar(l,f){var v=f[vt];v===void 0&&(v=f[vt]=new Set);var C=l+"__bubble";v.has(C)||(n_(f,l,2,!1),v.add(C))}function i_(l,f,v){var C=0;f&&(C|=4),n_(v,l,C,f)}var tg="_reactListening"+Math.random().toString(36).slice(2);function ig(l){if(!l[tg]){l[tg]=!0,Ve.forEach(function(v){v!=="selectionchange"&&(e_.has(v)||i_(v,!1,l),i_(v,!0,l))});var f=l.nodeType===9?l:l.ownerDocument;f===null||f[tg]||(f[tg]=!0,i_("selectionchange",!1,f))}}function n_(l,f,v,C){switch(fg(f)){case 2:var O=dg;break;case 8:O=V0;break;default:O=dm}v=O.bind(null,f,v,l),O=void 0,!wn||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(O=!0),C?O!==void 0?l.addEventListener(f,v,{capture:!0,passive:O}):l.addEventListener(f,v,!0):O!==void 0?l.addEventListener(f,v,{passive:O}):l.addEventListener(f,v,!1)}function r_(l,f,v,C,O){var U=C;if((f&1)===0&&(f&2)===0&&C!==null)e:for(;;){if(C===null)return;var ae=C.tag;if(ae===3||ae===4){var De=C.stateNode.containerInfo;if(De===O||De.nodeType===8&&De.parentNode===O)break;if(ae===4)for(ae=C.return;ae!==null;){var Xe=ae.tag;if((Xe===3||Xe===4)&&(Xe=ae.stateNode.containerInfo,Xe===O||Xe.nodeType===8&&Xe.parentNode===O))return;ae=ae.return}for(;De!==null;){if(ae=ln(De),ae===null)return;if(Xe=ae.tag,Xe===5||Xe===6||Xe===26||Xe===27){C=U=ae;continue e}De=De.parentNode}}C=C.return}ff(function(){var gt=U,si=Aa(v),yi=[];e:{var Ut=wu.get(l);if(Ut!==void 0){var ti=cd,xn=l;switch(l){case"keypress":if(jl(v)===0)break e;case"keydown":case"keyup":ti=Hn;break;case"focusin":xn="focus",ti=fh;break;case"focusout":xn="blur",ti=fh;break;case"beforeblur":case"afterblur":ti=fh;break;case"click":if(v.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ti=Fa;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ti=to;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ti=Bn;break;case Rp:case Mp:case Ip:ti=Vn;break;case bf:ti=Ic;break;case"scroll":case"scrollend":ti=hh;break;case"wheel":ti=ta;break;case"copy":case"cut":case"paste":ti=Om;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ti=Ra;break;case"toggle":case"beforetoggle":ti=Wg}var Xn=(f&4)!==0,cs=!Xn&&(l==="scroll"||l==="scrollend"),Rt=Xn?Ut!==null?Ut+"Capture":null:Ut;Xn=[];for(var mt=gt,Dt;mt!==null;){var di=mt;if(Dt=di.stateNode,di=di.tag,di!==5&&di!==26&&di!==27||Dt===null||Rt===null||(di=Rc(mt,Rt),di!=null&&Xn.push(Kf(mt,di,Dt))),cs)break;mt=mt.return}0<Xn.length&&(Ut=new ti(Ut,xn,null,v,si),yi.push({event:Ut,listeners:Xn}))}}if((f&7)===0){e:{if(Ut=l==="mouseover"||l==="pointerover",ti=l==="mouseout"||l==="pointerout",Ut&&v!==Ac&&(xn=v.relatedTarget||v.fromElement)&&(ln(xn)||xn[zt]))break e;if((ti||Ut)&&(Ut=si.window===si?si:(Ut=si.ownerDocument)?Ut.defaultView||Ut.parentWindow:window,ti?(xn=v.relatedTarget||v.toElement,ti=gt,xn=xn?ln(xn):null,xn!==null&&(cs=Ui(xn),Xn=xn.tag,xn!==cs||Xn!==5&&Xn!==27&&Xn!==6)&&(xn=null)):(ti=null,xn=gt),ti!==xn)){if(Xn=Fa,di="onMouseLeave",Rt="onMouseEnter",mt="mouse",(l==="pointerout"||l==="pointerover")&&(Xn=Ra,di="onPointerLeave",Rt="onPointerEnter",mt="pointer"),cs=ti==null?Ut:cn(ti),Dt=xn==null?Ut:cn(xn),Ut=new Xn(di,mt+"leave",ti,v,si),Ut.target=cs,Ut.relatedTarget=Dt,di=null,ln(si)===gt&&(Xn=new Xn(Rt,mt+"enter",xn,v,si),Xn.target=Dt,Xn.relatedTarget=cs,di=Xn),cs=di,ti&&xn)t:{for(Xn=ti,Rt=xn,mt=0,Dt=Xn;Dt;Dt=Jf(Dt))mt++;for(Dt=0,di=Rt;di;di=Jf(di))Dt++;for(;0<mt-Dt;)Xn=Jf(Xn),mt--;for(;0<Dt-mt;)Rt=Jf(Rt),Dt--;for(;mt--;){if(Xn===Rt||Rt!==null&&Xn===Rt.alternate)break t;Xn=Jf(Xn),Rt=Jf(Rt)}Xn=null}else Xn=null;ti!==null&&s_(yi,Ut,ti,Xn,!1),xn!==null&&cs!==null&&s_(yi,cs,xn,Xn,!0)}}e:{if(Ut=gt?cn(gt):window,ti=Ut.nodeName&&Ut.nodeName.toLowerCase(),ti==="select"||ti==="input"&&Ut.type==="file")var un=Ni;else if(tn(Ut))if(yf)un=zc;else{un=ql;var mr=Ap}else ti=Ut.nodeName,!ti||ti.toLowerCase()!=="input"||Ut.type!=="checkbox"&&Ut.type!=="radio"?gt&&lu(gt.elementType)&&(un=Ni):un=ya;if(un&&(un=un(l,gt))){ni(yi,un,v,si);break e}mr&&mr(l,Ut,gt),l==="focusout"&&gt&&Ut.type==="number"&&gt.memoizedProps.value!=null&&ch(Ut,"number",Ut.value)}switch(mr=gt?cn(gt):window,l){case"focusin":(tn(mr)||mr.contentEditable==="true")&&($l=mr,gh=gt,wo=null);break;case"focusout":wo=gh=$l=null;break;case"mousedown":Zl=!0;break;case"contextmenu":case"mouseup":case"dragend":Zl=!1,jm(yi,v,si);break;case"selectionchange":if(Nm)break;case"keydown":case"keyup":jm(yi,v,si)}var Tn;if(dd)e:{switch(l){case"compositionstart":var Ln="onCompositionStart";break e;case"compositionend":Ln="onCompositionEnd";break e;case"compositionupdate":Ln="onCompositionUpdate";break e}Ln=void 0}else mu?vo(l,v)&&(Ln="onCompositionEnd"):l==="keydown"&&v.keyCode===229&&(Ln="onCompositionStart");Ln&&(Ul&&v.locale!=="ko"&&(mu||Ln!=="onCompositionStart"?Ln==="onCompositionEnd"&&mu&&(Tn=Nl()):(kl=si,pf="value"in kl?kl.value:kl.textContent,mu=!0)),mr=ng(gt,Ln),0<mr.length&&(Ln=new zi(Ln,l,null,v,si),yi.push({event:Ln,listeners:mr}),Tn?Ln.data=Tn:(Tn=_a(v),Tn!==null&&(Ln.data=Tn)))),(Tn=fd?ph(l,v):fs(l,v))&&(Ln=ng(gt,"onBeforeInput"),0<Ln.length&&(mr=new zi("onBeforeInput","beforeinput",null,v,si),yi.push({event:mr,listeners:Ln}),mr.data=Tn)),Qg(yi,l,gt,v,si)}t_(yi,f)})}function Kf(l,f,v){return{instance:l,listener:f,currentTarget:v}}function ng(l,f){for(var v=f+"Capture",C=[];l!==null;){var O=l,U=O.stateNode;O=O.tag,O!==5&&O!==26&&O!==27||U===null||(O=Rc(l,v),O!=null&&C.unshift(Kf(l,O,U)),O=Rc(l,f),O!=null&&C.push(Kf(l,O,U))),l=l.return}return C}function Jf(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5&&l.tag!==27);return l||null}function s_(l,f,v,C,O){for(var U=f._reactName,ae=[];v!==null&&v!==C;){var De=v,Xe=De.alternate,gt=De.stateNode;if(De=De.tag,Xe!==null&&Xe===C)break;De!==5&&De!==26&&De!==27||gt===null||(Xe=gt,O?(gt=Rc(v,U),gt!=null&&ae.unshift(Kf(v,gt,Xe))):O||(gt=Rc(v,U),gt!=null&&ae.push(Kf(v,gt,Xe)))),v=v.return}ae.length!==0&&l.push({event:f,listeners:ae})}var T0=/\r\n?/g,S0=/\u0000|\uFFFD/g;function a_(l){return(typeof l=="string"?l:""+l).replace(T0,`
`).replace(S0,"")}function o_(l,f){return f=a_(f),a_(l)===f}function rm(){}function Xr(l,f,v,C,O,U){switch(v){case"children":typeof C=="string"?f==="body"||f==="textarea"&&C===""||ma(l,C):(typeof C=="number"||typeof C=="bigint")&&f!=="body"&&ma(l,""+C);break;case"className":Vr(l,"class",C);break;case"tabIndex":Vr(l,"tabindex",C);break;case"dir":case"role":case"viewBox":case"width":case"height":Vr(l,v,C);break;case"style":df(l,C,U);break;case"data":if(f!=="object"){Vr(l,"data",C);break}case"src":case"href":if(C===""&&(f!=="a"||v!=="href")){l.removeAttribute(v);break}if(C==null||typeof C=="function"||typeof C=="symbol"||typeof C=="boolean"){l.removeAttribute(v);break}C=Ec(""+C),l.setAttribute(v,C);break;case"action":case"formAction":if(typeof C=="function"){l.setAttribute(v,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof U=="function"&&(v==="formAction"?(f!=="input"&&Xr(l,f,"name",O.name,O,null),Xr(l,f,"formEncType",O.formEncType,O,null),Xr(l,f,"formMethod",O.formMethod,O,null),Xr(l,f,"formTarget",O.formTarget,O,null)):(Xr(l,f,"encType",O.encType,O,null),Xr(l,f,"method",O.method,O,null),Xr(l,f,"target",O.target,O,null)));if(C==null||typeof C=="symbol"||typeof C=="boolean"){l.removeAttribute(v);break}C=Ec(""+C),l.setAttribute(v,C);break;case"onClick":C!=null&&(l.onclick=rm);break;case"onScroll":C!=null&&Ar("scroll",l);break;case"onScrollEnd":C!=null&&Ar("scrollend",l);break;case"dangerouslySetInnerHTML":if(C!=null){if(typeof C!="object"||!("__html"in C))throw Error(S(61));if(v=C.__html,v!=null){if(O.children!=null)throw Error(S(60));l.innerHTML=v}}break;case"multiple":l.multiple=C&&typeof C!="function"&&typeof C!="symbol";break;case"muted":l.muted=C&&typeof C!="function"&&typeof C!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(C==null||typeof C=="function"||typeof C=="boolean"||typeof C=="symbol"){l.removeAttribute("xlink:href");break}v=Ec(""+C),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",v);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":C!=null&&typeof C!="function"&&typeof C!="symbol"?l.setAttribute(v,""+C):l.removeAttribute(v);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":C&&typeof C!="function"&&typeof C!="symbol"?l.setAttribute(v,""):l.removeAttribute(v);break;case"capture":case"download":C===!0?l.setAttribute(v,""):C!==!1&&C!=null&&typeof C!="function"&&typeof C!="symbol"?l.setAttribute(v,C):l.removeAttribute(v);break;case"cols":case"rows":case"size":case"span":C!=null&&typeof C!="function"&&typeof C!="symbol"&&!isNaN(C)&&1<=C?l.setAttribute(v,C):l.removeAttribute(v);break;case"rowSpan":case"start":C==null||typeof C=="function"||typeof C=="symbol"||isNaN(C)?l.removeAttribute(v):l.setAttribute(v,C);break;case"popover":Ar("beforetoggle",l),Ar("toggle",l),Sr(l,"popover",C);break;case"xlinkActuate":ja(l,"http://www.w3.org/1999/xlink","xlink:actuate",C);break;case"xlinkArcrole":ja(l,"http://www.w3.org/1999/xlink","xlink:arcrole",C);break;case"xlinkRole":ja(l,"http://www.w3.org/1999/xlink","xlink:role",C);break;case"xlinkShow":ja(l,"http://www.w3.org/1999/xlink","xlink:show",C);break;case"xlinkTitle":ja(l,"http://www.w3.org/1999/xlink","xlink:title",C);break;case"xlinkType":ja(l,"http://www.w3.org/1999/xlink","xlink:type",C);break;case"xmlBase":ja(l,"http://www.w3.org/XML/1998/namespace","xml:base",C);break;case"xmlLang":ja(l,"http://www.w3.org/XML/1998/namespace","xml:lang",C);break;case"xmlSpace":ja(l,"http://www.w3.org/XML/1998/namespace","xml:space",C);break;case"is":Sr(l,"is",C);break;case"innerText":case"textContent":break;default:(!(2<v.length)||v[0]!=="o"&&v[0]!=="O"||v[1]!=="n"&&v[1]!=="N")&&(v=Sc.get(v)||v,Sr(l,v,C))}}function sm(l,f,v,C,O,U){switch(v){case"style":df(l,C,U);break;case"dangerouslySetInnerHTML":if(C!=null){if(typeof C!="object"||!("__html"in C))throw Error(S(61));if(v=C.__html,v!=null){if(O.children!=null)throw Error(S(60));l.innerHTML=v}}break;case"children":typeof C=="string"?ma(l,C):(typeof C=="number"||typeof C=="bigint")&&ma(l,""+C);break;case"onScroll":C!=null&&Ar("scroll",l);break;case"onScrollEnd":C!=null&&Ar("scrollend",l);break;case"onClick":C!=null&&(l.onclick=rm);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!wt.hasOwnProperty(v))e:{if(v[0]==="o"&&v[1]==="n"&&(O=v.endsWith("Capture"),f=v.slice(2,O?v.length-7:void 0),U=l[Je]||null,U=U!=null?U[v]:null,typeof U=="function"&&l.removeEventListener(f,U,O),typeof C=="function")){typeof U!="function"&&U!==null&&(v in l?l[v]=null:l.hasAttribute(v)&&l.removeAttribute(v)),l.addEventListener(f,C,O);break e}v in l?l[v]=C:C===!0?l.setAttribute(v,""):Sr(l,v,C)}}}function ys(l,f,v){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ar("error",l),Ar("load",l);var C=!1,O=!1,U;for(U in v)if(v.hasOwnProperty(U)){var ae=v[U];if(ae!=null)switch(U){case"src":C=!0;break;case"srcSet":O=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(S(137,f));default:Xr(l,f,U,ae,v,null)}}O&&Xr(l,f,"srcSet",v.srcSet,v,null),C&&Xr(l,f,"src",v.src,v,null);return;case"input":Ar("invalid",l);var De=U=ae=O=null,Xe=null,gt=null;for(C in v)if(v.hasOwnProperty(C)){var si=v[C];if(si!=null)switch(C){case"name":O=si;break;case"type":ae=si;break;case"checked":Xe=si;break;case"defaultChecked":gt=si;break;case"value":U=si;break;case"defaultValue":De=si;break;case"children":case"dangerouslySetInnerHTML":if(si!=null)throw Error(S(137,f));break;default:Xr(l,f,C,si,v,null)}}hf(l,U,De,Xe,gt,ae,O,!1),wc(l);return;case"select":Ar("invalid",l),C=ae=U=null;for(O in v)if(v.hasOwnProperty(O)&&(De=v[O],De!=null))switch(O){case"value":U=De;break;case"defaultValue":ae=De;break;case"multiple":C=De;default:Xr(l,f,O,De,v,null)}f=U,v=ae,l.multiple=!!C,f!=null?Us(l,!!C,f,!1):v!=null&&Us(l,!!C,v,!0);return;case"textarea":Ar("invalid",l),U=O=C=null;for(ae in v)if(v.hasOwnProperty(ae)&&(De=v[ae],De!=null))switch(ae){case"value":C=De;break;case"defaultValue":O=De;break;case"children":U=De;break;case"dangerouslySetInnerHTML":if(De!=null)throw Error(S(91));break;default:Xr(l,f,ae,De,v,null)}ll(l,C,O,U),wc(l);return;case"option":for(Xe in v)if(v.hasOwnProperty(Xe)&&(C=v[Xe],C!=null))switch(Xe){case"selected":l.selected=C&&typeof C!="function"&&typeof C!="symbol";break;default:Xr(l,f,Xe,C,v,null)}return;case"dialog":Ar("cancel",l),Ar("close",l);break;case"iframe":case"object":Ar("load",l);break;case"video":case"audio":for(C=0;C<Yf.length;C++)Ar(Yf[C],l);break;case"image":Ar("error",l),Ar("load",l);break;case"details":Ar("toggle",l);break;case"embed":case"source":case"link":Ar("error",l),Ar("load",l);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(gt in v)if(v.hasOwnProperty(gt)&&(C=v[gt],C!=null))switch(gt){case"children":case"dangerouslySetInnerHTML":throw Error(S(137,f));default:Xr(l,f,gt,C,v,null)}return;default:if(lu(f)){for(si in v)v.hasOwnProperty(si)&&(C=v[si],C!==void 0&&sm(l,f,si,C,v,void 0));return}}for(De in v)v.hasOwnProperty(De)&&(C=v[De],C!=null&&Xr(l,f,De,C,v,null))}function Ks(l,f,v,C){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var O=null,U=null,ae=null,De=null,Xe=null,gt=null,si=null;for(ti in v){var yi=v[ti];if(v.hasOwnProperty(ti)&&yi!=null)switch(ti){case"checked":break;case"value":break;case"defaultValue":Xe=yi;default:C.hasOwnProperty(ti)||Xr(l,f,ti,null,C,yi)}}for(var Ut in C){var ti=C[Ut];if(yi=v[Ut],C.hasOwnProperty(Ut)&&(ti!=null||yi!=null))switch(Ut){case"type":U=ti;break;case"name":O=ti;break;case"checked":gt=ti;break;case"defaultChecked":si=ti;break;case"value":ae=ti;break;case"defaultValue":De=ti;break;case"children":case"dangerouslySetInnerHTML":if(ti!=null)throw Error(S(137,f));break;default:ti!==yi&&Xr(l,f,Ut,ti,C,yi)}}_o(l,ae,De,Xe,gt,si,U,O);return;case"select":ti=ae=De=Ut=null;for(U in v)if(Xe=v[U],v.hasOwnProperty(U)&&Xe!=null)switch(U){case"value":break;case"multiple":ti=Xe;default:C.hasOwnProperty(U)||Xr(l,f,U,null,C,Xe)}for(O in C)if(U=C[O],Xe=v[O],C.hasOwnProperty(O)&&(U!=null||Xe!=null))switch(O){case"value":Ut=U;break;case"defaultValue":De=U;break;case"multiple":ae=U;default:U!==Xe&&Xr(l,f,O,U,C,Xe)}f=De,v=ae,C=ti,Ut!=null?Us(l,!!v,Ut,!1):!!C!=!!v&&(f!=null?Us(l,!!v,f,!0):Us(l,!!v,v?[]:"",!1));return;case"textarea":ti=Ut=null;for(De in v)if(O=v[De],v.hasOwnProperty(De)&&O!=null&&!C.hasOwnProperty(De))switch(De){case"value":break;case"children":break;default:Xr(l,f,De,null,C,O)}for(ae in C)if(O=C[ae],U=v[ae],C.hasOwnProperty(ae)&&(O!=null||U!=null))switch(ae){case"value":Ut=O;break;case"defaultValue":ti=O;break;case"children":break;case"dangerouslySetInnerHTML":if(O!=null)throw Error(S(91));break;default:O!==U&&Xr(l,f,ae,O,C,U)}yo(l,Ut,ti);return;case"option":for(var xn in v)if(Ut=v[xn],v.hasOwnProperty(xn)&&Ut!=null&&!C.hasOwnProperty(xn))switch(xn){case"selected":l.selected=!1;break;default:Xr(l,f,xn,null,C,Ut)}for(Xe in C)if(Ut=C[Xe],ti=v[Xe],C.hasOwnProperty(Xe)&&Ut!==ti&&(Ut!=null||ti!=null))switch(Xe){case"selected":l.selected=Ut&&typeof Ut!="function"&&typeof Ut!="symbol";break;default:Xr(l,f,Xe,Ut,C,ti)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Xn in v)Ut=v[Xn],v.hasOwnProperty(Xn)&&Ut!=null&&!C.hasOwnProperty(Xn)&&Xr(l,f,Xn,null,C,Ut);for(gt in C)if(Ut=C[gt],ti=v[gt],C.hasOwnProperty(gt)&&Ut!==ti&&(Ut!=null||ti!=null))switch(gt){case"children":case"dangerouslySetInnerHTML":if(Ut!=null)throw Error(S(137,f));break;default:Xr(l,f,gt,Ut,C,ti)}return;default:if(lu(f)){for(var cs in v)Ut=v[cs],v.hasOwnProperty(cs)&&Ut!==void 0&&!C.hasOwnProperty(cs)&&sm(l,f,cs,void 0,C,Ut);for(si in C)Ut=C[si],ti=v[si],!C.hasOwnProperty(si)||Ut===ti||Ut===void 0&&ti===void 0||sm(l,f,si,Ut,C,ti);return}}for(var Rt in v)Ut=v[Rt],v.hasOwnProperty(Rt)&&Ut!=null&&!C.hasOwnProperty(Rt)&&Xr(l,f,Rt,null,C,Ut);for(yi in C)Ut=C[yi],ti=v[yi],!C.hasOwnProperty(yi)||Ut===ti||Ut==null&&ti==null||Xr(l,f,yi,Ut,C,ti)}var rg=null,Yd=null;function sg(l){return l.nodeType===9?l:l.ownerDocument}function E0(l){switch(l){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function A0(l,f){if(l===0)switch(f){case"svg":return 1;case"math":return 2;default:return 0}return l===1&&f==="foreignObject"?0:l}function l_(l,f){return l==="textarea"||l==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.children=="bigint"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var Xh=null;function C0(){var l=window.event;return l&&l.type==="popstate"?l===Xh?!1:(Xh=l,!0):(Xh=null,!1)}var Yh=typeof setTimeout=="function"?setTimeout:void 0,am=typeof clearTimeout=="function"?clearTimeout:void 0,R0=typeof Promise=="function"?Promise:void 0,U1=typeof queueMicrotask=="function"?queueMicrotask:typeof R0<"u"?function(l){return R0.resolve(null).then(l).catch(V1)}:Yh;function V1(l){setTimeout(function(){throw l})}function c_(l,f){var v=f,C=0;do{var O=v.nextSibling;if(l.removeChild(v),O&&O.nodeType===8)if(v=O.data,v==="/$"){if(C===0){l.removeChild(O),op(f);return}C--}else v!=="$"&&v!=="$?"&&v!=="$!"||C++;v=O}while(v);op(f)}function u_(l){var f=l.firstChild;for(f&&f.nodeType===10&&(f=f.nextSibling);f;){var v=f;switch(f=f.nextSibling,v.nodeName){case"HTML":case"HEAD":case"BODY":u_(v),rn(v);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(v.rel.toLowerCase()==="stylesheet")continue}l.removeChild(v)}}function H1(l,f,v,C){for(;l.nodeType===1;){var O=v;if(l.nodeName.toLowerCase()!==f.toLowerCase()){if(!C&&(l.nodeName!=="INPUT"||l.type!=="hidden"))break}else if(C){if(!l[on])switch(f){case"meta":if(!l.hasAttribute("itemprop"))break;return l;case"link":if(U=l.getAttribute("rel"),U==="stylesheet"&&l.hasAttribute("data-precedence"))break;if(U!==O.rel||l.getAttribute("href")!==(O.href==null?null:O.href)||l.getAttribute("crossorigin")!==(O.crossOrigin==null?null:O.crossOrigin)||l.getAttribute("title")!==(O.title==null?null:O.title))break;return l;case"style":if(l.hasAttribute("data-precedence"))break;return l;case"script":if(U=l.getAttribute("src"),(U!==(O.src==null?null:O.src)||l.getAttribute("type")!==(O.type==null?null:O.type)||l.getAttribute("crossorigin")!==(O.crossOrigin==null?null:O.crossOrigin))&&U&&l.hasAttribute("async")&&!l.hasAttribute("itemprop"))break;return l;default:return l}}else if(f==="input"&&l.type==="hidden"){var U=O.name==null?null:""+O.name;if(O.type==="hidden"&&l.getAttribute("name")===U)return l}else return l;if(l=rl(l.nextSibling),l===null)break}return null}function q1(l,f,v){if(f==="")return null;for(;l.nodeType!==3;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!v||(l=rl(l.nextSibling),l===null))return null;return l}function rl(l){for(;l!=null;l=l.nextSibling){var f=l.nodeType;if(f===1||f===3)break;if(f===8){if(f=l.data,f==="$"||f==="$!"||f==="$?"||f==="F!"||f==="F")break;if(f==="/$")return null}}return l}function M0(l){l=l.previousSibling;for(var f=0;l;){if(l.nodeType===8){var v=l.data;if(v==="$"||v==="$!"||v==="$?"){if(f===0)return l;f--}else v==="/$"&&f++}l=l.previousSibling}return null}function h_(l,f,v){switch(f=sg(v),l){case"html":if(l=f.documentElement,!l)throw Error(S(452));return l;case"head":if(l=f.head,!l)throw Error(S(453));return l;case"body":if(l=f.body,!l)throw Error(S(454));return l;default:throw Error(S(451))}}var $a=new Map,I0=new Set;function rs(l){return typeof l.getRootNode=="function"?l.getRootNode():l.ownerDocument}var Io=ii.d;ii.d={f:z0,r:ag,D:D0,C:P0,L:om,m:d_,X:G1,S:lm,M:L0};function z0(){var l=Io.f(),f=ca();return l||f}function ag(l){var f=jn(l);f!==null&&f.tag===5&&f.type==="form"?$c(f):Io.r(l)}var Wu=typeof document>"u"?null:document;function Qf(l,f,v){var C=Wu;if(C&&typeof f=="string"&&f){var O=Ba(f);O='link[rel="'+l+'"][href="'+O+'"]',typeof v=="string"&&(O+='[crossorigin="'+v+'"]'),I0.has(O)||(I0.add(O),l={rel:l,crossOrigin:v,href:f},C.querySelector(O)===null&&(f=C.createElement("link"),ys(f,"link",l),$n(f),C.head.appendChild(f)))}}function D0(l){Io.D(l),Qf("dns-prefetch",l,null)}function P0(l,f){Io.C(l,f),Qf("preconnect",l,f)}function om(l,f,v){Io.L(l,f,v);var C=Wu;if(C&&l&&f){var O='link[rel="preload"][as="'+Ba(f)+'"]';f==="image"&&v&&v.imageSrcSet?(O+='[imagesrcset="'+Ba(v.imageSrcSet)+'"]',typeof v.imageSizes=="string"&&(O+='[imagesizes="'+Ba(v.imageSizes)+'"]')):O+='[href="'+Ba(l)+'"]';var U=O;switch(f){case"style":U=Kh(l);break;case"script":U=Js(l)}$a.has(U)||(l=Lt({rel:"preload",href:f==="image"&&v&&v.imageSrcSet?void 0:l,as:f},v),$a.set(U,l),C.querySelector(O)!==null||f==="style"&&C.querySelector(ep(U))||f==="script"&&C.querySelector(tp(U))||(f=C.createElement("link"),ys(f,"link",l),$n(f),C.head.appendChild(f)))}}function d_(l,f){Io.m(l,f);var v=Wu;if(v&&l){var C=f&&typeof f.as=="string"?f.as:"script",O='link[rel="modulepreload"][as="'+Ba(C)+'"][href="'+Ba(l)+'"]',U=O;switch(C){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":U=Js(l)}if(!$a.has(U)&&(l=Lt({rel:"modulepreload",href:l},f),$a.set(U,l),v.querySelector(O)===null)){switch(C){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(v.querySelector(tp(U)))return}C=v.createElement("link"),ys(C,"link",l),$n(C),v.head.appendChild(C)}}}function lm(l,f,v){Io.S(l,f,v);var C=Wu;if(C&&l){var O=cr(C).hoistableStyles,U=Kh(l);f=f||"default";var ae=O.get(U);if(!ae){var De={loading:0,preload:null};if(ae=C.querySelector(ep(U)))De.loading=5;else{l=Lt({rel:"stylesheet",href:l,"data-precedence":f},v),(v=$a.get(U))&&ip(l,v);var Xe=ae=C.createElement("link");$n(Xe),ys(Xe,"link",l),Xe._p=new Promise(function(gt,si){Xe.onload=gt,Xe.onerror=si}),Xe.addEventListener("load",function(){De.loading|=1}),Xe.addEventListener("error",function(){De.loading|=2}),De.loading|=4,cm(ae,f,C)}ae={type:"stylesheet",instance:ae,count:1,state:De},O.set(U,ae)}}}function G1(l,f){Io.X(l,f);var v=Wu;if(v&&l){var C=cr(v).hoistableScripts,O=Js(l),U=C.get(O);U||(U=v.querySelector(tp(O)),U||(l=Lt({src:l,async:!0},f),(f=$a.get(O))&&p_(l,f),U=v.createElement("script"),$n(U),ys(U,"link",l),v.head.appendChild(U)),U={type:"script",instance:U,count:1,state:null},C.set(O,U))}}function L0(l,f){Io.M(l,f);var v=Wu;if(v&&l){var C=cr(v).hoistableScripts,O=Js(l),U=C.get(O);U||(U=v.querySelector(tp(O)),U||(l=Lt({src:l,async:!0,type:"module"},f),(f=$a.get(O))&&p_(l,f),U=v.createElement("script"),$n(U),ys(U,"link",l),v.head.appendChild(U)),U={type:"script",instance:U,count:1,state:null},C.set(O,U))}}function og(l,f,v,C){var O=(O=Mn.current)?rs(O):null;if(!O)throw Error(S(446));switch(l){case"meta":case"title":return null;case"style":return typeof v.precedence=="string"&&typeof v.href=="string"?(f=Kh(v.href),v=cr(O).hoistableStyles,C=v.get(f),C||(C={type:"style",instance:null,count:0,state:null},v.set(f,C)),C):{type:"void",instance:null,count:0,state:null};case"link":if(v.rel==="stylesheet"&&typeof v.href=="string"&&typeof v.precedence=="string"){l=Kh(v.href);var U=cr(O).hoistableStyles,ae=U.get(l);if(ae||(O=O.ownerDocument||O,ae={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},U.set(l,ae),(U=O.querySelector(ep(l)))&&!U._p&&(ae.instance=U,ae.state.loading=5),$a.has(l)||(v={rel:"preload",as:"style",href:v.href,crossOrigin:v.crossOrigin,integrity:v.integrity,media:v.media,hrefLang:v.hrefLang,referrerPolicy:v.referrerPolicy},$a.set(l,v),U||$1(O,l,v,ae.state))),f&&C===null)throw Error(S(528,""));return ae}if(f&&C!==null)throw Error(S(529,""));return null;case"script":return f=v.async,v=v.src,typeof v=="string"&&f&&typeof f!="function"&&typeof f!="symbol"?(f=Js(v),v=cr(O).hoistableScripts,C=v.get(f),C||(C={type:"script",instance:null,count:0,state:null},v.set(f,C)),C):{type:"void",instance:null,count:0,state:null};default:throw Error(S(444,l))}}function Kh(l){return'href="'+Ba(l)+'"'}function ep(l){return'link[rel="stylesheet"]['+l+"]"}function eu(l){return Lt({},l,{"data-precedence":l.precedence,precedence:null})}function $1(l,f,v,C){l.querySelector('link[rel="preload"][as="style"]['+f+"]")?C.loading=1:(f=l.createElement("link"),C.preload=f,f.addEventListener("load",function(){return C.loading|=1}),f.addEventListener("error",function(){return C.loading|=2}),ys(f,"link",v),$n(f),l.head.appendChild(f))}function Js(l){return'[src="'+Ba(l)+'"]'}function tp(l){return"script[async]"+l}function f_(l,f,v){if(f.count++,f.instance===null)switch(f.type){case"style":var C=l.querySelector('style[data-href~="'+Ba(v.href)+'"]');if(C)return f.instance=C,$n(C),C;var O=Lt({},v,{"data-href":v.href,"data-precedence":v.precedence,href:null,precedence:null});return C=(l.ownerDocument||l).createElement("style"),$n(C),ys(C,"style",O),cm(C,v.precedence,l),f.instance=C;case"stylesheet":O=Kh(v.href);var U=l.querySelector(ep(O));if(U)return f.state.loading|=4,f.instance=U,$n(U),U;C=eu(v),(O=$a.get(O))&&ip(C,O),U=(l.ownerDocument||l).createElement("link"),$n(U);var ae=U;return ae._p=new Promise(function(De,Xe){ae.onload=De,ae.onerror=Xe}),ys(U,"link",C),f.state.loading|=4,cm(U,v.precedence,l),f.instance=U;case"script":return U=Js(v.src),(O=l.querySelector(tp(U)))?(f.instance=O,$n(O),O):(C=v,(O=$a.get(U))&&(C=Lt({},v),p_(C,O)),l=l.ownerDocument||l,O=l.createElement("script"),$n(O),ys(O,"link",C),l.head.appendChild(O),f.instance=O);case"void":return null;default:throw Error(S(443,f.type))}else f.type==="stylesheet"&&(f.state.loading&4)===0&&(C=f.instance,f.state.loading|=4,cm(C,v.precedence,l));return f.instance}function cm(l,f,v){for(var C=v.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),O=C.length?C[C.length-1]:null,U=O,ae=0;ae<C.length;ae++){var De=C[ae];if(De.dataset.precedence===f)U=De;else if(U!==O)break}U?U.parentNode.insertBefore(l,U.nextSibling):(f=v.nodeType===9?v.head:v,f.insertBefore(l,f.firstChild))}function ip(l,f){l.crossOrigin==null&&(l.crossOrigin=f.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=f.referrerPolicy),l.title==null&&(l.title=f.title)}function p_(l,f){l.crossOrigin==null&&(l.crossOrigin=f.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=f.referrerPolicy),l.integrity==null&&(l.integrity=f.integrity)}var lg=null;function cg(l,f,v){if(lg===null){var C=new Map,O=lg=new Map;O.set(v,C)}else O=lg,C=O.get(v),C||(C=new Map,O.set(v,C));if(C.has(l))return C;for(C.set(l,null),v=v.getElementsByTagName(l),O=0;O<v.length;O++){var U=v[O];if(!(U[on]||U[Be]||l==="link"&&U.getAttribute("rel")==="stylesheet")&&U.namespaceURI!=="http://www.w3.org/2000/svg"){var ae=U.getAttribute(f)||"";ae=l+ae;var De=C.get(ae);De?De.push(U):C.set(ae,[U])}}return C}function m_(l,f,v){l=l.ownerDocument||l,l.head.insertBefore(v,f==="title"?l.querySelector("head > title"):null)}function g_(l,f,v){if(v===1||f.itemProp!=null)return!1;switch(l){case"meta":case"title":return!0;case"style":if(typeof f.precedence!="string"||typeof f.href!="string"||f.href==="")break;return!0;case"link":if(typeof f.rel!="string"||typeof f.href!="string"||f.href===""||f.onLoad||f.onError)break;switch(f.rel){case"stylesheet":return l=f.disabled,typeof f.precedence=="string"&&l==null;default:return!0}case"script":if(f.async&&typeof f.async!="function"&&typeof f.async!="symbol"&&!f.onLoad&&!f.onError&&f.src&&typeof f.src=="string")return!0}return!1}function ug(l){return!(l.type==="stylesheet"&&(l.state.loading&3)===0)}var np=null;function O0(){}function k0(l,f,v){if(np===null)throw Error(S(475));var C=np;if(f.type==="stylesheet"&&(typeof v.media!="string"||matchMedia(v.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var O=Kh(v.href),U=l.querySelector(ep(O));if(U){l=U._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(C.count++,C=Kd.bind(C),l.then(C,C)),f.state.loading|=4,f.instance=U,$n(U);return}U=l.ownerDocument||l,v=eu(v),(O=$a.get(O))&&ip(v,O),U=U.createElement("link"),$n(U);var ae=U;ae._p=new Promise(function(De,Xe){ae.onload=De,ae.onerror=Xe}),ys(U,"link",v),f.instance=U}C.stylesheets===null&&(C.stylesheets=new Map),C.stylesheets.set(f,l),(l=f.state.preload)&&(f.state.loading&3)===0&&(C.count++,f=Kd.bind(C),l.addEventListener("load",f),l.addEventListener("error",f))}}function N0(){if(np===null)throw Error(S(475));var l=np;return l.stylesheets&&l.count===0&&hg(l,l.stylesheets),0<l.count?function(f){var v=setTimeout(function(){if(l.stylesheets&&hg(l,l.stylesheets),l.unsuspend){var C=l.unsuspend;l.unsuspend=null,C()}},6e4);return l.unsuspend=f,function(){l.unsuspend=null,clearTimeout(v)}}:null}function Kd(){if(this.count--,this.count===0){if(this.stylesheets)hg(this,this.stylesheets);else if(this.unsuspend){var l=this.unsuspend;this.unsuspend=null,l()}}}var sl=null;function hg(l,f){l.stylesheets=null,l.unsuspend!==null&&(l.count++,sl=new Map,f.forEach(Z1,l),sl=null,Kd.call(l))}function Z1(l,f){if(!(f.state.loading&4)){var v=sl.get(l);if(v)var C=v.get(null);else{v=new Map,sl.set(l,v);for(var O=l.querySelectorAll("link[data-precedence],style[data-precedence]"),U=0;U<O.length;U++){var ae=O[U];(ae.nodeName==="LINK"||ae.getAttribute("media")!=="not all")&&(v.set(ae.dataset.precedence,ae),C=ae)}C&&v.set(null,C)}O=f.instance,ae=O.getAttribute("data-precedence"),U=v.get(ae)||C,U===C&&v.set(null,O),v.set(ae,O),this.count++,C=Kd.bind(this),O.addEventListener("load",C),O.addEventListener("error",C),U?U.parentNode.insertBefore(O,U.nextSibling):(l=l.nodeType===9?l.head:l,l.insertBefore(O,l.firstChild)),f.state.loading|=4}}var um={$$typeof:ze,Provider:null,Consumer:null,_currentValue:Yi,_currentValue2:Yi,_threadCount:0};function W1(l,f,v,C,O,U,ae,De){this.tag=1,this.containerInfo=l,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Na(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Na(0),this.hiddenUpdates=Na(null),this.identifierPrefix=C,this.onUncaughtError=O,this.onCaughtError=U,this.onRecoverableError=ae,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=De,this.incompleteTransitions=new Map}function j0(l,f,v,C,O,U,ae,De,Xe,gt,si,yi){return l=new W1(l,f,v,ae,De,Xe,gt,yi),f=1,U===!0&&(f|=24),U=G(3,null,null,f),l.current=U,U.stateNode=l,f=Sh(),f.refCount++,l.pooledCache=f,f.refCount++,U.memoizedState={element:C,isDehydrated:v,cache:f},Gf(U),l}function B0(l){return l?(l=za,l):za}function F0(l,f,v,C,O,U){O=B0(O),C.context===null?C.context=O:C.pendingContext=O,C=uc(f),C.payload={element:v},U=U===void 0?null:U,U!==null&&(C.callback=U),v=Ko(l,C,f),v!==null&&(kn(v,l,f),Bh(v,l,f))}function U0(l,f){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var v=l.retryLane;l.retryLane=v!==0&&v<f?v:f}}function Jd(l,f){U0(l,f),(l=l.alternate)&&U0(l,f)}function __(l){if(l.tag===13){var f=ro(l,67108864);f!==null&&kn(f,l,67108864),Jd(l,67108864)}}var hm=!0;function dg(l,f,v,C){var O=ut.T;ut.T=null;var U=ii.p;try{ii.p=2,dm(l,f,v,C)}finally{ii.p=U,ut.T=O}}function V0(l,f,v,C){var O=ut.T;ut.T=null;var U=ii.p;try{ii.p=8,dm(l,f,v,C)}finally{ii.p=U,ut.T=O}}function dm(l,f,v,C){if(hm){var O=rp(C);if(O===null)r_(l,f,C,fm,v),H0(l,C);else if(q0(O,l,f,v,C))C.stopPropagation();else if(H0(l,C),f&4&&-1<X1.indexOf(l)){for(;O!==null;){var U=jn(O);if(U!==null)switch(U.tag){case 3:if(U=U.stateNode,U.current.memoizedState.isDehydrated){var ae=Ur(U.pendingLanes);if(ae!==0){var De=U;for(De.pendingLanes|=2,De.entangledLanes|=2;ae;){var Xe=1<<31-hs(ae);De.entanglements[1]|=Xe,ae&=~Xe}ha(U),(Oe&6)===0&&(Xi=As()+500,nl(0))}}break;case 13:De=ro(U,2),De!==null&&kn(De,U,2),ca(),Jd(U,2)}if(U=rp(C),U===null&&r_(l,f,C,fm,v),U===O)break;O=U}O!==null&&C.stopPropagation()}else r_(l,f,C,null,v)}}function rp(l){return l=Aa(l),y_(l)}var fm=null;function y_(l){if(fm=null,l=ln(l),l!==null){var f=Ui(l);if(f===null)l=null;else{var v=f.tag;if(v===13){if(l=Cn(f),l!==null)return l;l=null}else if(v===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;l=null}else f!==l&&(l=null)}}return fm=l,null}function fg(l){switch(l){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ws()){case Gr:return 2;case Yr:return 8;case Bs:case Fs:return 32;case Sa:return 268435456;default:return 32}default:return 32}}var pg=!1,Xu=null,tu=null,iu=null,sp=new Map,Qd=new Map,Jh=[],X1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function H0(l,f){switch(l){case"focusin":case"focusout":Xu=null;break;case"dragenter":case"dragleave":tu=null;break;case"mouseover":case"mouseout":iu=null;break;case"pointerover":case"pointerout":sp.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":Qd.delete(f.pointerId)}}function pm(l,f,v,C,O,U){return l===null||l.nativeEvent!==U?(l={blockedOn:f,domEventName:v,eventSystemFlags:C,nativeEvent:U,targetContainers:[O]},f!==null&&(f=jn(f),f!==null&&__(f)),l):(l.eventSystemFlags|=C,f=l.targetContainers,O!==null&&f.indexOf(O)===-1&&f.push(O),l)}function q0(l,f,v,C,O){switch(f){case"focusin":return Xu=pm(Xu,l,f,v,C,O),!0;case"dragenter":return tu=pm(tu,l,f,v,C,O),!0;case"mouseover":return iu=pm(iu,l,f,v,C,O),!0;case"pointerover":var U=O.pointerId;return sp.set(U,pm(sp.get(U)||null,l,f,v,C,O)),!0;case"gotpointercapture":return U=O.pointerId,Qd.set(U,pm(Qd.get(U)||null,l,f,v,C,O)),!0}return!1}function Yu(l){var f=ln(l.target);if(f!==null){var v=Ui(f);if(v!==null){if(f=v.tag,f===13){if(f=Cn(v),f!==null){l.blockedOn=f,Ie(l.priority,function(){if(v.tag===13){var C=vn(),O=ro(v,C);O!==null&&kn(O,v,C),Jd(v,C)}});return}}else if(f===3&&v.stateNode.current.memoizedState.isDehydrated){l.blockedOn=v.tag===3?v.stateNode.containerInfo:null;return}}}l.blockedOn=null}function Qh(l){if(l.blockedOn!==null)return!1;for(var f=l.targetContainers;0<f.length;){var v=rp(l.nativeEvent);if(v===null){v=l.nativeEvent;var C=new v.constructor(v.type,v);Ac=C,v.target.dispatchEvent(C),Ac=null}else return f=jn(v),f!==null&&__(f),l.blockedOn=v,!1;f.shift()}return!0}function ap(l,f,v){Qh(l)&&v.delete(f)}function mg(){pg=!1,Xu!==null&&Qh(Xu)&&(Xu=null),tu!==null&&Qh(tu)&&(tu=null),iu!==null&&Qh(iu)&&(iu=null),sp.forEach(ap),Qd.forEach(ap)}function ed(l,f){l.blockedOn===f&&(l.blockedOn=null,pg||(pg=!0,h.unstable_scheduleCallback(h.unstable_NormalPriority,mg)))}var mm=null;function x_(l){mm!==l&&(mm=l,h.unstable_scheduleCallback(h.unstable_NormalPriority,function(){mm===l&&(mm=null);for(var f=0;f<l.length;f+=3){var v=l[f],C=l[f+1],O=l[f+2];if(typeof C!="function"){if(y_(C||v)===null)continue;break}var U=jn(v);U!==null&&(l.splice(f,3),f-=3,Zo(U,{pending:!0,data:O,method:v.method,action:C},C,O))}}))}function op(l){function f(Xe){return ed(Xe,l)}Xu!==null&&ed(Xu,l),tu!==null&&ed(tu,l),iu!==null&&ed(iu,l),sp.forEach(f),Qd.forEach(f);for(var v=0;v<Jh.length;v++){var C=Jh[v];C.blockedOn===l&&(C.blockedOn=null)}for(;0<Jh.length&&(v=Jh[0],v.blockedOn===null);)Yu(v),v.blockedOn===null&&Jh.shift();if(v=(l.ownerDocument||l).$$reactFormReplay,v!=null)for(C=0;C<v.length;C+=3){var O=v[C],U=v[C+1],ae=O[Je]||null;if(typeof U=="function")ae||x_(v);else if(ae){var De=null;if(U&&U.hasAttribute("formAction")){if(O=U,ae=U[Je]||null)De=ae.formAction;else if(y_(O)!==null)continue}else De=ae.action;typeof De=="function"?v[C+1]=De:(v.splice(C,3),C-=3),x_(v)}}}function gg(l){this._internalRoot=l}_g.prototype.render=gg.prototype.render=function(l){var f=this._internalRoot;if(f===null)throw Error(S(409));var v=f.current,C=vn();F0(v,C,l,f,null,null)},_g.prototype.unmount=gg.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var f=l.containerInfo;l.tag===0&&La(),F0(l.current,2,null,l,null,null),ca(),f[zt]=null}};function _g(l){this._internalRoot=l}_g.prototype.unstable_scheduleHydration=function(l){if(l){var f=Le();l={blockedOn:null,target:l,priority:f};for(var v=0;v<Jh.length&&f!==0&&f<Jh[v].priority;v++);Jh.splice(v,0,l),v===0&&Yu(l)}};var G0=g.version;if(G0!=="19.0.0")throw Error(S(527,G0,"19.0.0"));ii.findDOMNode=function(l){var f=l._reactInternals;if(f===void 0)throw typeof l.render=="function"?Error(S(188)):(l=Object.keys(l).join(","),Error(S(268,l)));return l=Ft(f),l=l!==null?Di(l):null,l=l===null?null:l.stateNode,l};var v_={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:ut,findFiberByHostInstance:ln,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ef=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ef.isDisabled&&ef.supportsFiber)try{Ya=ef.inject(v_),ss=ef}catch{}}return $_.createRoot=function(l,f){if(!I(l))throw Error(S(299));var v=!1,C="",O=jd,U=kh,ae=Lu,De=null;return f!=null&&(f.unstable_strictMode===!0&&(v=!0),f.identifierPrefix!==void 0&&(C=f.identifierPrefix),f.onUncaughtError!==void 0&&(O=f.onUncaughtError),f.onCaughtError!==void 0&&(U=f.onCaughtError),f.onRecoverableError!==void 0&&(ae=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(De=f.unstable_transitionCallbacks)),f=j0(l,1,!1,null,null,v,C,O,U,ae,De,null),l[zt]=f.current,ig(l.nodeType===8?l.parentNode:l),new gg(f)},$_.hydrateRoot=function(l,f,v){if(!I(l))throw Error(S(299));var C=!1,O="",U=jd,ae=kh,De=Lu,Xe=null,gt=null;return v!=null&&(v.unstable_strictMode===!0&&(C=!0),v.identifierPrefix!==void 0&&(O=v.identifierPrefix),v.onUncaughtError!==void 0&&(U=v.onUncaughtError),v.onCaughtError!==void 0&&(ae=v.onCaughtError),v.onRecoverableError!==void 0&&(De=v.onRecoverableError),v.unstable_transitionCallbacks!==void 0&&(Xe=v.unstable_transitionCallbacks),v.formState!==void 0&&(gt=v.formState)),f=j0(l,1,!0,f,v??null,C,O,U,ae,De,Xe,gt),f.context=B0(null),v=f.current,C=vn(),O=uc(C),O.callback=null,Ko(v,O,C),f.current.lanes=C,He(f,C),ha(f),l[zt]=f.current,ig(l),new _g(f)},$_.version="19.0.0",$_}var J3;function dC(){if(J3)return Wx.exports;J3=1;function h(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h)}catch(g){console.error(g)}}return h(),Wx.exports=hC(),Wx.exports}var fC=dC();const pC="modulepreload",mC=function(h){return"/"+h},Q3={},Gn=function(g,b,S){let I=Promise.resolve();if(b&&b.length>0){let V=function(Z){return Promise.all(Z.map(Q=>Promise.resolve(Q).then(oe=>({status:"fulfilled",value:oe}),oe=>({status:"rejected",reason:oe}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),q=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));I=V(b.map(Z=>{if(Z=mC(Z),Z in Q3)return;Q3[Z]=!0;const Q=Z.endsWith(".css"),oe=Q?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${Z}"]${oe}`))return;const pe=document.createElement("link");if(pe.rel=Q?"stylesheet":pC,Q||(pe.as="script"),pe.crossOrigin="",pe.href=Z,q&&pe.setAttribute("nonce",q),document.head.appendChild(pe),Q)return new Promise((ze,le)=>{pe.addEventListener("load",ze),pe.addEventListener("error",()=>le(new Error(`Unable to preload CSS for ${Z}`)))})}))}function N(V){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=V,window.dispatchEvent(s),!s.defaultPrevented)throw V}return I.then(V=>{for(const s of V||[])s.status==="rejected"&&N(s.reason);return g().catch(N)})};var Z_={},e4;function gC(){if(e4)return Z_;e4=1,Object.defineProperty(Z_,"__esModule",{value:!0}),Z_.parse=V,Z_.serialize=Z;const h=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,g=/^[\u0021-\u003A\u003C-\u007E]*$/,b=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,S=/^[\u0020-\u003A\u003D-\u007E]*$/,I=Object.prototype.toString,N=(()=>{const pe=function(){};return pe.prototype=Object.create(null),pe})();function V(pe,ze){const le=new N,Se=pe.length;if(Se<2)return le;const te=(ze==null?void 0:ze.decode)||Q;let ge=0;do{const xe=pe.indexOf("=",ge);if(xe===-1)break;const ye=pe.indexOf(";",ge),Pe=ye===-1?Se:ye;if(xe>Pe){ge=pe.lastIndexOf(";",xe-1)+1;continue}const Ae=s(pe,ge,xe),Ke=q(pe,xe,Ae),it=pe.slice(Ae,Ke);if(le[it]===void 0){let rt=s(pe,xe+1,Pe),ut=q(pe,Pe,rt);const Lt=te(pe.slice(rt,ut));le[it]=Lt}ge=Pe+1}while(ge<Se);return le}function s(pe,ze,le){do{const Se=pe.charCodeAt(ze);if(Se!==32&&Se!==9)return ze}while(++ze<le);return le}function q(pe,ze,le){for(;ze>le;){const Se=pe.charCodeAt(--ze);if(Se!==32&&Se!==9)return ze+1}return le}function Z(pe,ze,le){const Se=(le==null?void 0:le.encode)||encodeURIComponent;if(!h.test(pe))throw new TypeError(`argument name is invalid: ${pe}`);const te=Se(ze);if(!g.test(te))throw new TypeError(`argument val is invalid: ${ze}`);let ge=pe+"="+te;if(!le)return ge;if(le.maxAge!==void 0){if(!Number.isInteger(le.maxAge))throw new TypeError(`option maxAge is invalid: ${le.maxAge}`);ge+="; Max-Age="+le.maxAge}if(le.domain){if(!b.test(le.domain))throw new TypeError(`option domain is invalid: ${le.domain}`);ge+="; Domain="+le.domain}if(le.path){if(!S.test(le.path))throw new TypeError(`option path is invalid: ${le.path}`);ge+="; Path="+le.path}if(le.expires){if(!oe(le.expires)||!Number.isFinite(le.expires.valueOf()))throw new TypeError(`option expires is invalid: ${le.expires}`);ge+="; Expires="+le.expires.toUTCString()}if(le.httpOnly&&(ge+="; HttpOnly"),le.secure&&(ge+="; Secure"),le.partitioned&&(ge+="; Partitioned"),le.priority)switch(typeof le.priority=="string"?le.priority.toLowerCase():void 0){case"low":ge+="; Priority=Low";break;case"medium":ge+="; Priority=Medium";break;case"high":ge+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${le.priority}`)}if(le.sameSite)switch(typeof le.sameSite=="string"?le.sameSite.toLowerCase():le.sameSite){case!0:case"strict":ge+="; SameSite=Strict";break;case"lax":ge+="; SameSite=Lax";break;case"none":ge+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${le.sameSite}`)}return ge}function Q(pe){if(pe.indexOf("%")===-1)return pe;try{return decodeURIComponent(pe)}catch{return pe}}function oe(pe){return I.call(pe)==="[object Date]"}return Z_}gC();/**
 * react-router v7.3.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var t4="popstate";function _C(h={}){function g(S,I){let{pathname:N,search:V,hash:s}=S.location;return Jv("",{pathname:N,search:V,hash:s},I.state&&I.state.usr||null,I.state&&I.state.key||"default")}function b(S,I){return typeof I=="string"?I:s0(I)}return xC(g,b,null,h)}function Ps(h,g){if(h===!1||h===null||typeof h>"u")throw new Error(g)}function rh(h,g){if(!h){typeof console<"u"&&console.warn(g);try{throw new Error(g)}catch{}}}function yC(){return Math.random().toString(36).substring(2,10)}function i4(h,g){return{usr:h.state,key:h.key,idx:g}}function Jv(h,g,b=null,S){return{pathname:typeof h=="string"?h:h.pathname,search:"",hash:"",...typeof g=="string"?Ug(g):g,state:b,key:g&&g.key||S||yC()}}function s0({pathname:h="/",search:g="",hash:b=""}){return g&&g!=="?"&&(h+=g.charAt(0)==="?"?g:"?"+g),b&&b!=="#"&&(h+=b.charAt(0)==="#"?b:"#"+b),h}function Ug(h){let g={};if(h){let b=h.indexOf("#");b>=0&&(g.hash=h.substring(b),h=h.substring(0,b));let S=h.indexOf("?");S>=0&&(g.search=h.substring(S),h=h.substring(0,S)),h&&(g.pathname=h)}return g}function xC(h,g,b,S={}){let{window:I=document.defaultView,v5Compat:N=!1}=S,V=I.history,s="POP",q=null,Z=Q();Z==null&&(Z=0,V.replaceState({...V.state,idx:Z},""));function Q(){return(V.state||{idx:null}).idx}function oe(){s="POP";let te=Q(),ge=te==null?null:te-Z;Z=te,q&&q({action:s,location:Se.location,delta:ge})}function pe(te,ge){s="PUSH";let xe=Jv(Se.location,te,ge);Z=Q()+1;let ye=i4(xe,Z),Pe=Se.createHref(xe);try{V.pushState(ye,"",Pe)}catch(Ae){if(Ae instanceof DOMException&&Ae.name==="DataCloneError")throw Ae;I.location.assign(Pe)}N&&q&&q({action:s,location:Se.location,delta:1})}function ze(te,ge){s="REPLACE";let xe=Jv(Se.location,te,ge);Z=Q();let ye=i4(xe,Z),Pe=Se.createHref(xe);V.replaceState(ye,"",Pe),N&&q&&q({action:s,location:Se.location,delta:0})}function le(te){let ge=I.location.origin!=="null"?I.location.origin:I.location.href,xe=typeof te=="string"?te:s0(te);return xe=xe.replace(/ $/,"%20"),Ps(ge,`No window.location.(origin|href) available to create URL for href: ${xe}`),new URL(xe,ge)}let Se={get action(){return s},get location(){return h(I,V)},listen(te){if(q)throw new Error("A history only accepts one active listener");return I.addEventListener(t4,oe),q=te,()=>{I.removeEventListener(t4,oe),q=null}},createHref(te){return g(I,te)},createURL:le,encodeLocation(te){let ge=le(te);return{pathname:ge.pathname,search:ge.search,hash:ge.hash}},push:pe,replace:ze,go(te){return V.go(te)}};return Se}function QT(h,g,b="/"){return vC(h,g,b,!1)}function vC(h,g,b,S){let I=typeof g=="string"?Ug(g):g,N=of(I.pathname||"/",b);if(N==null)return null;let V=eS(h);bC(V);let s=null;for(let q=0;s==null&&q<V.length;++q){let Z=DC(N);s=IC(V[q],Z,S)}return s}function eS(h,g=[],b=[],S=""){let I=(N,V,s)=>{let q={relativePath:s===void 0?N.path||"":s,caseSensitive:N.caseSensitive===!0,childrenIndex:V,route:N};q.relativePath.startsWith("/")&&(Ps(q.relativePath.startsWith(S),`Absolute route path "${q.relativePath}" nested under path "${S}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),q.relativePath=q.relativePath.slice(S.length));let Z=af([S,q.relativePath]),Q=b.concat(q);N.children&&N.children.length>0&&(Ps(N.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${Z}".`),eS(N.children,g,Q,Z)),!(N.path==null&&!N.index)&&g.push({path:Z,score:RC(Z,N.index),routesMeta:Q})};return h.forEach((N,V)=>{var s;if(N.path===""||!((s=N.path)!=null&&s.includes("?")))I(N,V);else for(let q of tS(N.path))I(N,V,q)}),g}function tS(h){let g=h.split("/");if(g.length===0)return[];let[b,...S]=g,I=b.endsWith("?"),N=b.replace(/\?$/,"");if(S.length===0)return I?[N,""]:[N];let V=tS(S.join("/")),s=[];return s.push(...V.map(q=>q===""?N:[N,q].join("/"))),I&&s.push(...V),s.map(q=>h.startsWith("/")&&q===""?"/":q)}function bC(h){h.sort((g,b)=>g.score!==b.score?b.score-g.score:MC(g.routesMeta.map(S=>S.childrenIndex),b.routesMeta.map(S=>S.childrenIndex)))}var wC=/^:[\w-]+$/,TC=3,SC=2,EC=1,AC=10,CC=-2,n4=h=>h==="*";function RC(h,g){let b=h.split("/"),S=b.length;return b.some(n4)&&(S+=CC),g&&(S+=SC),b.filter(I=>!n4(I)).reduce((I,N)=>I+(wC.test(N)?TC:N===""?EC:AC),S)}function MC(h,g){return h.length===g.length&&h.slice(0,-1).every((S,I)=>S===g[I])?h[h.length-1]-g[g.length-1]:0}function IC(h,g,b=!1){let{routesMeta:S}=h,I={},N="/",V=[];for(let s=0;s<S.length;++s){let q=S[s],Z=s===S.length-1,Q=N==="/"?g:g.slice(N.length)||"/",oe=e1({path:q.relativePath,caseSensitive:q.caseSensitive,end:Z},Q),pe=q.route;if(!oe&&Z&&b&&!S[S.length-1].route.index&&(oe=e1({path:q.relativePath,caseSensitive:q.caseSensitive,end:!1},Q)),!oe)return null;Object.assign(I,oe.params),V.push({params:I,pathname:af([N,oe.pathname]),pathnameBase:kC(af([N,oe.pathnameBase])),route:pe}),oe.pathnameBase!=="/"&&(N=af([N,oe.pathnameBase]))}return V}function e1(h,g){typeof h=="string"&&(h={path:h,caseSensitive:!1,end:!0});let[b,S]=zC(h.path,h.caseSensitive,h.end),I=g.match(b);if(!I)return null;let N=I[0],V=N.replace(/(.)\/+$/,"$1"),s=I.slice(1);return{params:S.reduce((Z,{paramName:Q,isOptional:oe},pe)=>{if(Q==="*"){let le=s[pe]||"";V=N.slice(0,N.length-le.length).replace(/(.)\/+$/,"$1")}const ze=s[pe];return oe&&!ze?Z[Q]=void 0:Z[Q]=(ze||"").replace(/%2F/g,"/"),Z},{}),pathname:N,pathnameBase:V,pattern:h}}function zC(h,g=!1,b=!0){rh(h==="*"||!h.endsWith("*")||h.endsWith("/*"),`Route path "${h}" will be treated as if it were "${h.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${h.replace(/\*$/,"/*")}".`);let S=[],I="^"+h.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(V,s,q)=>(S.push({paramName:s,isOptional:q!=null}),q?"/?([^\\/]+)?":"/([^\\/]+)"));return h.endsWith("*")?(S.push({paramName:"*"}),I+=h==="*"||h==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):b?I+="\\/*$":h!==""&&h!=="/"&&(I+="(?:(?=\\/|$))"),[new RegExp(I,g?void 0:"i"),S]}function DC(h){try{return h.split("/").map(g=>decodeURIComponent(g).replace(/\//g,"%2F")).join("/")}catch(g){return rh(!1,`The URL path "${h}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${g}).`),h}}function of(h,g){if(g==="/")return h;if(!h.toLowerCase().startsWith(g.toLowerCase()))return null;let b=g.endsWith("/")?g.length-1:g.length,S=h.charAt(b);return S&&S!=="/"?null:h.slice(b)||"/"}function PC(h,g="/"){let{pathname:b,search:S="",hash:I=""}=typeof h=="string"?Ug(h):h;return{pathname:b?b.startsWith("/")?b:LC(b,g):g,search:NC(S),hash:jC(I)}}function LC(h,g){let b=g.replace(/\/+$/,"").split("/");return h.split("/").forEach(I=>{I===".."?b.length>1&&b.pop():I!=="."&&b.push(I)}),b.length>1?b.join("/"):"/"}function Jx(h,g,b,S){return`Cannot include a '${h}' character in a manually specified \`to.${g}\` field [${JSON.stringify(S)}].  Please separate it out to the \`to.${b}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function OC(h){return h.filter((g,b)=>b===0||g.route.path&&g.route.path.length>0)}function L2(h){let g=OC(h);return g.map((b,S)=>S===g.length-1?b.pathname:b.pathnameBase)}function O2(h,g,b,S=!1){let I;typeof h=="string"?I=Ug(h):(I={...h},Ps(!I.pathname||!I.pathname.includes("?"),Jx("?","pathname","search",I)),Ps(!I.pathname||!I.pathname.includes("#"),Jx("#","pathname","hash",I)),Ps(!I.search||!I.search.includes("#"),Jx("#","search","hash",I)));let N=h===""||I.pathname==="",V=N?"/":I.pathname,s;if(V==null)s=b;else{let oe=g.length-1;if(!S&&V.startsWith("..")){let pe=V.split("/");for(;pe[0]==="..";)pe.shift(),oe-=1;I.pathname=pe.join("/")}s=oe>=0?g[oe]:"/"}let q=PC(I,s),Z=V&&V!=="/"&&V.endsWith("/"),Q=(N||V===".")&&b.endsWith("/");return!q.pathname.endsWith("/")&&(Z||Q)&&(q.pathname+="/"),q}var af=h=>h.join("/").replace(/\/\/+/g,"/"),kC=h=>h.replace(/\/+$/,"").replace(/^\/*/,"/"),NC=h=>!h||h==="?"?"":h.startsWith("?")?h:"?"+h,jC=h=>!h||h==="#"?"":h.startsWith("#")?h:"#"+h;function BC(h){return h!=null&&typeof h.status=="number"&&typeof h.statusText=="string"&&typeof h.internal=="boolean"&&"data"in h}var iS=["POST","PUT","PATCH","DELETE"];new Set(iS);var FC=["GET",...iS];new Set(FC);var Vg=he.createContext(null);Vg.displayName="DataRouter";var g1=he.createContext(null);g1.displayName="DataRouterState";var nS=he.createContext({isTransitioning:!1});nS.displayName="ViewTransition";var UC=he.createContext(new Map);UC.displayName="Fetchers";var VC=he.createContext(null);VC.displayName="Await";var sh=he.createContext(null);sh.displayName="Navigation";var h0=he.createContext(null);h0.displayName="Location";var ou=he.createContext({outlet:null,matches:[],isDataRoute:!1});ou.displayName="Route";var k2=he.createContext(null);k2.displayName="RouteError";function HC(h,{relative:g}={}){Ps(Hg(),"useHref() may be used only in the context of a <Router> component.");let{basename:b,navigator:S}=he.useContext(sh),{hash:I,pathname:N,search:V}=d0(h,{relative:g}),s=N;return b!=="/"&&(s=N==="/"?b:af([b,N])),S.createHref({pathname:s,search:V,hash:I})}function Hg(){return he.useContext(h0)!=null}function ko(){return Ps(Hg(),"useLocation() may be used only in the context of a <Router> component."),he.useContext(h0).location}var rS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function sS(h){he.useContext(sh).static||he.useLayoutEffect(h)}function Pl(){let{isDataRoute:h}=he.useContext(ou);return h?sR():qC()}function qC(){Ps(Hg(),"useNavigate() may be used only in the context of a <Router> component.");let h=he.useContext(Vg),{basename:g,navigator:b}=he.useContext(sh),{matches:S}=he.useContext(ou),{pathname:I}=ko(),N=JSON.stringify(L2(S)),V=he.useRef(!1);return sS(()=>{V.current=!0}),he.useCallback((q,Z={})=>{if(rh(V.current,rS),!V.current)return;if(typeof q=="number"){b.go(q);return}let Q=O2(q,JSON.parse(N),I,Z.relative==="path");h==null&&g!=="/"&&(Q.pathname=Q.pathname==="/"?g:af([g,Q.pathname])),(Z.replace?b.replace:b.push)(Q,Z.state,Z)},[g,b,N,I,h])}var GC=he.createContext(null);function $C(h){let g=he.useContext(ou).outlet;return g&&he.createElement(GC.Provider,{value:h},g)}function ZC(){let{matches:h}=he.useContext(ou),g=h[h.length-1];return g?g.params:{}}function d0(h,{relative:g}={}){let{matches:b}=he.useContext(ou),{pathname:S}=ko(),I=JSON.stringify(L2(b));return he.useMemo(()=>O2(h,JSON.parse(I),S,g==="path"),[h,I,S,g])}function WC(h,g){return aS(h,g)}function aS(h,g,b,S){var xe;Ps(Hg(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:I,static:N}=he.useContext(sh),{matches:V}=he.useContext(ou),s=V[V.length-1],q=s?s.params:{},Z=s?s.pathname:"/",Q=s?s.pathnameBase:"/",oe=s&&s.route;{let ye=oe&&oe.path||"";oS(Z,!oe||ye.endsWith("*")||ye.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${Z}" (under <Route path="${ye}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${ye}"> to <Route path="${ye==="/"?"*":`${ye}/*`}">.`)}let pe=ko(),ze;if(g){let ye=typeof g=="string"?Ug(g):g;Ps(Q==="/"||((xe=ye.pathname)==null?void 0:xe.startsWith(Q)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${Q}" but pathname "${ye.pathname}" was given in the \`location\` prop.`),ze=ye}else ze=pe;let le=ze.pathname||"/",Se=le;if(Q!=="/"){let ye=Q.replace(/^\//,"").split("/");Se="/"+le.replace(/^\//,"").split("/").slice(ye.length).join("/")}let te=!N&&b&&b.matches&&b.matches.length>0?b.matches:QT(h,{pathname:Se});rh(oe||te!=null,`No routes matched location "${ze.pathname}${ze.search}${ze.hash}" `),rh(te==null||te[te.length-1].route.element!==void 0||te[te.length-1].route.Component!==void 0||te[te.length-1].route.lazy!==void 0,`Matched leaf route at location "${ze.pathname}${ze.search}${ze.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let ge=QC(te&&te.map(ye=>Object.assign({},ye,{params:Object.assign({},q,ye.params),pathname:af([Q,I.encodeLocation?I.encodeLocation(ye.pathname).pathname:ye.pathname]),pathnameBase:ye.pathnameBase==="/"?Q:af([Q,I.encodeLocation?I.encodeLocation(ye.pathnameBase).pathname:ye.pathnameBase])})),V,b,S);return g&&ge?he.createElement(h0.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...ze},navigationType:"POP"}},ge):ge}function XC(){let h=rR(),g=BC(h)?`${h.status} ${h.statusText}`:h instanceof Error?h.message:JSON.stringify(h),b=h instanceof Error?h.stack:null,S="rgba(200,200,200, 0.5)",I={padding:"0.5rem",backgroundColor:S},N={padding:"2px 4px",backgroundColor:S},V=null;return console.error("Error handled by React Router default ErrorBoundary:",h),V=he.createElement(he.Fragment,null,he.createElement("p",null," Hey developer "),he.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",he.createElement("code",{style:N},"ErrorBoundary")," or"," ",he.createElement("code",{style:N},"errorElement")," prop on your route.")),he.createElement(he.Fragment,null,he.createElement("h2",null,"Unexpected Application Error!"),he.createElement("h3",{style:{fontStyle:"italic"}},g),b?he.createElement("pre",{style:I},b):null,V)}var YC=he.createElement(XC,null),KC=class extends he.Component{constructor(h){super(h),this.state={location:h.location,revalidation:h.revalidation,error:h.error}}static getDerivedStateFromError(h){return{error:h}}static getDerivedStateFromProps(h,g){return g.location!==h.location||g.revalidation!=="idle"&&h.revalidation==="idle"?{error:h.error,location:h.location,revalidation:h.revalidation}:{error:h.error!==void 0?h.error:g.error,location:g.location,revalidation:h.revalidation||g.revalidation}}componentDidCatch(h,g){console.error("React Router caught the following error during render",h,g)}render(){return this.state.error!==void 0?he.createElement(ou.Provider,{value:this.props.routeContext},he.createElement(k2.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function JC({routeContext:h,match:g,children:b}){let S=he.useContext(Vg);return S&&S.static&&S.staticContext&&(g.route.errorElement||g.route.ErrorBoundary)&&(S.staticContext._deepestRenderedBoundaryId=g.route.id),he.createElement(ou.Provider,{value:h},b)}function QC(h,g=[],b=null,S=null){if(h==null){if(!b)return null;if(b.errors)h=b.matches;else if(g.length===0&&!b.initialized&&b.matches.length>0)h=b.matches;else return null}let I=h,N=b==null?void 0:b.errors;if(N!=null){let q=I.findIndex(Z=>Z.route.id&&(N==null?void 0:N[Z.route.id])!==void 0);Ps(q>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(N).join(",")}`),I=I.slice(0,Math.min(I.length,q+1))}let V=!1,s=-1;if(b)for(let q=0;q<I.length;q++){let Z=I[q];if((Z.route.HydrateFallback||Z.route.hydrateFallbackElement)&&(s=q),Z.route.id){let{loaderData:Q,errors:oe}=b,pe=Z.route.loader&&!Q.hasOwnProperty(Z.route.id)&&(!oe||oe[Z.route.id]===void 0);if(Z.route.lazy||pe){V=!0,s>=0?I=I.slice(0,s+1):I=[I[0]];break}}}return I.reduceRight((q,Z,Q)=>{let oe,pe=!1,ze=null,le=null;b&&(oe=N&&Z.route.id?N[Z.route.id]:void 0,ze=Z.route.errorElement||YC,V&&(s<0&&Q===0?(oS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),pe=!0,le=null):s===Q&&(pe=!0,le=Z.route.hydrateFallbackElement||null)));let Se=g.concat(I.slice(0,Q+1)),te=()=>{let ge;return oe?ge=ze:pe?ge=le:Z.route.Component?ge=he.createElement(Z.route.Component,null):Z.route.element?ge=Z.route.element:ge=q,he.createElement(JC,{match:Z,routeContext:{outlet:q,matches:Se,isDataRoute:b!=null},children:ge})};return b&&(Z.route.ErrorBoundary||Z.route.errorElement||Q===0)?he.createElement(KC,{location:b.location,revalidation:b.revalidation,component:ze,error:oe,children:te(),routeContext:{outlet:null,matches:Se,isDataRoute:!0}}):te()},null)}function N2(h){return`${h} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function eR(h){let g=he.useContext(Vg);return Ps(g,N2(h)),g}function tR(h){let g=he.useContext(g1);return Ps(g,N2(h)),g}function iR(h){let g=he.useContext(ou);return Ps(g,N2(h)),g}function j2(h){let g=iR(h),b=g.matches[g.matches.length-1];return Ps(b.route.id,`${h} can only be used on routes that contain a unique "id"`),b.route.id}function nR(){return j2("useRouteId")}function rR(){var S;let h=he.useContext(k2),g=tR("useRouteError"),b=j2("useRouteError");return h!==void 0?h:(S=g.errors)==null?void 0:S[b]}function sR(){let{router:h}=eR("useNavigate"),g=j2("useNavigate"),b=he.useRef(!1);return sS(()=>{b.current=!0}),he.useCallback(async(I,N={})=>{rh(b.current,rS),b.current&&(typeof I=="number"?h.navigate(I):await h.navigate(I,{fromRouteId:g,...N}))},[h,g])}var r4={};function oS(h,g,b){!g&&!r4[h]&&(r4[h]=!0,rh(!1,b))}he.memo(aR);function aR({routes:h,future:g,state:b}){return aS(h,void 0,b,g)}function Ml({to:h,replace:g,state:b,relative:S}){Ps(Hg(),"<Navigate> may be used only in the context of a <Router> component.");let{static:I}=he.useContext(sh);rh(!I,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:N}=he.useContext(ou),{pathname:V}=ko(),s=Pl(),q=O2(h,L2(N),V,S==="path"),Z=JSON.stringify(q);return he.useEffect(()=>{s(JSON.parse(Z),{replace:g,state:b,relative:S})},[s,Z,S,g,b]),null}function Qv(h){return $C(h.context)}function Wi(h){Ps(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function oR({basename:h="/",children:g=null,location:b,navigationType:S="POP",navigator:I,static:N=!1}){Ps(!Hg(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let V=h.replace(/^\/*/,"/"),s=he.useMemo(()=>({basename:V,navigator:I,static:N,future:{}}),[V,I,N]);typeof b=="string"&&(b=Ug(b));let{pathname:q="/",search:Z="",hash:Q="",state:oe=null,key:pe="default"}=b,ze=he.useMemo(()=>{let le=of(q,V);return le==null?null:{location:{pathname:le,search:Z,hash:Q,state:oe,key:pe},navigationType:S}},[V,q,Z,Q,oe,pe,S]);return rh(ze!=null,`<Router basename="${V}"> is not able to match the URL "${q}${Z}${Q}" because it does not start with the basename, so the <Router> won't render anything.`),ze==null?null:he.createElement(sh.Provider,{value:s},he.createElement(h0.Provider,{children:g,value:ze}))}function lR({children:h,location:g}){return WC(e2(h),g)}function e2(h,g=[]){let b=[];return he.Children.forEach(h,(S,I)=>{if(!he.isValidElement(S))return;let N=[...g,I];if(S.type===he.Fragment){b.push.apply(b,e2(S.props.children,N));return}Ps(S.type===Wi,`[${typeof S.type=="string"?S.type:S.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ps(!S.props.index||!S.props.children,"An index route cannot have child routes.");let V={id:S.props.id||N.join("-"),caseSensitive:S.props.caseSensitive,element:S.props.element,Component:S.props.Component,index:S.props.index,path:S.props.path,loader:S.props.loader,action:S.props.action,hydrateFallbackElement:S.props.hydrateFallbackElement,HydrateFallback:S.props.HydrateFallback,errorElement:S.props.errorElement,ErrorBoundary:S.props.ErrorBoundary,hasErrorBoundary:S.props.hasErrorBoundary===!0||S.props.ErrorBoundary!=null||S.props.errorElement!=null,shouldRevalidate:S.props.shouldRevalidate,handle:S.props.handle,lazy:S.props.lazy};S.props.children&&(V.children=e2(S.props.children,N)),b.push(V)}),b}var ky="get",Ny="application/x-www-form-urlencoded";function _1(h){return h!=null&&typeof h.tagName=="string"}function cR(h){return _1(h)&&h.tagName.toLowerCase()==="button"}function uR(h){return _1(h)&&h.tagName.toLowerCase()==="form"}function hR(h){return _1(h)&&h.tagName.toLowerCase()==="input"}function dR(h){return!!(h.metaKey||h.altKey||h.ctrlKey||h.shiftKey)}function fR(h,g){return h.button===0&&(!g||g==="_self")&&!dR(h)}var Cy=null;function pR(){if(Cy===null)try{new FormData(document.createElement("form"),0),Cy=!1}catch{Cy=!0}return Cy}var mR=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Qx(h){return h!=null&&!mR.has(h)?(rh(!1,`"${h}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Ny}"`),null):h}function gR(h,g){let b,S,I,N,V;if(uR(h)){let s=h.getAttribute("action");S=s?of(s,g):null,b=h.getAttribute("method")||ky,I=Qx(h.getAttribute("enctype"))||Ny,N=new FormData(h)}else if(cR(h)||hR(h)&&(h.type==="submit"||h.type==="image")){let s=h.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let q=h.getAttribute("formaction")||s.getAttribute("action");if(S=q?of(q,g):null,b=h.getAttribute("formmethod")||s.getAttribute("method")||ky,I=Qx(h.getAttribute("formenctype"))||Qx(s.getAttribute("enctype"))||Ny,N=new FormData(s,h),!pR()){let{name:Z,type:Q,value:oe}=h;if(Q==="image"){let pe=Z?`${Z}.`:"";N.append(`${pe}x`,"0"),N.append(`${pe}y`,"0")}else Z&&N.append(Z,oe)}}else{if(_1(h))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');b=ky,S=null,I=Ny,V=h}return N&&I==="text/plain"&&(V=N,N=void 0),{action:S,method:b.toLowerCase(),encType:I,formData:N,body:V}}function B2(h,g){if(h===!1||h===null||typeof h>"u")throw new Error(g)}async function _R(h,g){if(h.id in g)return g[h.id];try{let b=await import(h.module);return g[h.id]=b,b}catch(b){return console.error(`Error loading route module \`${h.module}\`, reloading page...`),console.error(b),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function yR(h){return h==null?!1:h.href==null?h.rel==="preload"&&typeof h.imageSrcSet=="string"&&typeof h.imageSizes=="string":typeof h.rel=="string"&&typeof h.href=="string"}async function xR(h,g,b){let S=await Promise.all(h.map(async I=>{let N=g.routes[I.route.id];if(N){let V=await _R(N,b);return V.links?V.links():[]}return[]}));return TR(S.flat(1).filter(yR).filter(I=>I.rel==="stylesheet"||I.rel==="preload").map(I=>I.rel==="stylesheet"?{...I,rel:"prefetch",as:"style"}:{...I,rel:"prefetch"}))}function s4(h,g,b,S,I,N){let V=(q,Z)=>b[Z]?q.route.id!==b[Z].route.id:!0,s=(q,Z)=>{var Q;return b[Z].pathname!==q.pathname||((Q=b[Z].route.path)==null?void 0:Q.endsWith("*"))&&b[Z].params["*"]!==q.params["*"]};return N==="assets"?g.filter((q,Z)=>V(q,Z)||s(q,Z)):N==="data"?g.filter((q,Z)=>{var oe;let Q=S.routes[q.route.id];if(!Q||!Q.hasLoader)return!1;if(V(q,Z)||s(q,Z))return!0;if(q.route.shouldRevalidate){let pe=q.route.shouldRevalidate({currentUrl:new URL(I.pathname+I.search+I.hash,window.origin),currentParams:((oe=b[0])==null?void 0:oe.params)||{},nextUrl:new URL(h,window.origin),nextParams:q.params,defaultShouldRevalidate:!0});if(typeof pe=="boolean")return pe}return!0}):[]}function vR(h,g,{includeHydrateFallback:b}={}){return bR(h.map(S=>{let I=g.routes[S.route.id];if(!I)return[];let N=[I.module];return I.clientActionModule&&(N=N.concat(I.clientActionModule)),I.clientLoaderModule&&(N=N.concat(I.clientLoaderModule)),b&&I.hydrateFallbackModule&&(N=N.concat(I.hydrateFallbackModule)),I.imports&&(N=N.concat(I.imports)),N}).flat(1))}function bR(h){return[...new Set(h)]}function wR(h){let g={},b=Object.keys(h).sort();for(let S of b)g[S]=h[S];return g}function TR(h,g){let b=new Set;return new Set(g),h.reduce((S,I)=>{let N=JSON.stringify(wR(I));return b.has(N)||(b.add(N),S.push({key:N,link:I})),S},[])}function SR(h,g){let b=typeof h=="string"?new URL(h,typeof window>"u"?"server://singlefetch/":window.location.origin):h;return b.pathname==="/"?b.pathname="_root.data":g&&of(b.pathname,g)==="/"?b.pathname=`${g.replace(/\/$/,"")}/_root.data`:b.pathname=`${b.pathname.replace(/\/$/,"")}.data`,b}function lS(){let h=he.useContext(Vg);return B2(h,"You must render this element inside a <DataRouterContext.Provider> element"),h}function ER(){let h=he.useContext(g1);return B2(h,"You must render this element inside a <DataRouterStateContext.Provider> element"),h}var F2=he.createContext(void 0);F2.displayName="FrameworkContext";function cS(){let h=he.useContext(F2);return B2(h,"You must render this element inside a <HydratedRouter> element"),h}function AR(h,g){let b=he.useContext(F2),[S,I]=he.useState(!1),[N,V]=he.useState(!1),{onFocus:s,onBlur:q,onMouseEnter:Z,onMouseLeave:Q,onTouchStart:oe}=g,pe=he.useRef(null);he.useEffect(()=>{if(h==="render"&&V(!0),h==="viewport"){let Se=ge=>{ge.forEach(xe=>{V(xe.isIntersecting)})},te=new IntersectionObserver(Se,{threshold:.5});return pe.current&&te.observe(pe.current),()=>{te.disconnect()}}},[h]),he.useEffect(()=>{if(S){let Se=setTimeout(()=>{V(!0)},100);return()=>{clearTimeout(Se)}}},[S]);let ze=()=>{I(!0)},le=()=>{I(!1),V(!1)};return b?h!=="intent"?[N,pe,{}]:[N,pe,{onFocus:W_(s,ze),onBlur:W_(q,le),onMouseEnter:W_(Z,ze),onMouseLeave:W_(Q,le),onTouchStart:W_(oe,ze)}]:[!1,pe,{}]}function W_(h,g){return b=>{h&&h(b),b.defaultPrevented||g(b)}}function CR({page:h,...g}){let{router:b}=lS(),S=he.useMemo(()=>QT(b.routes,h,b.basename),[b.routes,h,b.basename]);return S?he.createElement(MR,{page:h,matches:S,...g}):null}function RR(h){let{manifest:g,routeModules:b}=cS(),[S,I]=he.useState([]);return he.useEffect(()=>{let N=!1;return xR(h,g,b).then(V=>{N||I(V)}),()=>{N=!0}},[h,g,b]),S}function MR({page:h,matches:g,...b}){let S=ko(),{manifest:I,routeModules:N}=cS(),{basename:V}=lS(),{loaderData:s,matches:q}=ER(),Z=he.useMemo(()=>s4(h,g,q,I,S,"data"),[h,g,q,I,S]),Q=he.useMemo(()=>s4(h,g,q,I,S,"assets"),[h,g,q,I,S]),oe=he.useMemo(()=>{if(h===S.pathname+S.search+S.hash)return[];let le=new Set,Se=!1;if(g.forEach(ge=>{var ye;let xe=I.routes[ge.route.id];!xe||!xe.hasLoader||(!Z.some(Pe=>Pe.route.id===ge.route.id)&&ge.route.id in s&&((ye=N[ge.route.id])!=null&&ye.shouldRevalidate)||xe.hasClientLoader?Se=!0:le.add(ge.route.id))}),le.size===0)return[];let te=SR(h,V);return Se&&le.size>0&&te.searchParams.set("_routes",g.filter(ge=>le.has(ge.route.id)).map(ge=>ge.route.id).join(",")),[te.pathname+te.search]},[V,s,S,I,Z,g,h,N]),pe=he.useMemo(()=>vR(Q,I),[Q,I]),ze=RR(Q);return he.createElement(he.Fragment,null,oe.map(le=>he.createElement("link",{key:le,rel:"prefetch",as:"fetch",href:le,...b})),pe.map(le=>he.createElement("link",{key:le,rel:"modulepreload",href:le,...b})),ze.map(({key:le,link:Se})=>he.createElement("link",{key:le,...Se})))}function IR(...h){return g=>{h.forEach(b=>{typeof b=="function"?b(g):b!=null&&(b.current=g)})}}var uS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{uS&&(window.__reactRouterVersion="7.3.0")}catch{}function zR({basename:h,children:g,window:b}){let S=he.useRef();S.current==null&&(S.current=_C({window:b,v5Compat:!0}));let I=S.current,[N,V]=he.useState({action:I.action,location:I.location}),s=he.useCallback(q=>{he.startTransition(()=>V(q))},[V]);return he.useLayoutEffect(()=>I.listen(s),[I,s]),he.createElement(oR,{basename:h,children:g,location:N.location,navigationType:N.action,navigator:I})}var hS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ds=he.forwardRef(function({onClick:g,discover:b="render",prefetch:S="none",relative:I,reloadDocument:N,replace:V,state:s,target:q,to:Z,preventScrollReset:Q,viewTransition:oe,...pe},ze){let{basename:le}=he.useContext(sh),Se=typeof Z=="string"&&hS.test(Z),te,ge=!1;if(typeof Z=="string"&&Se&&(te=Z,uS))try{let ut=new URL(window.location.href),Lt=Z.startsWith("//")?new URL(ut.protocol+Z):new URL(Z),lt=of(Lt.pathname,le);Lt.origin===ut.origin&&lt!=null?Z=lt+Lt.search+Lt.hash:ge=!0}catch{rh(!1,`<Link to="${Z}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let xe=HC(Z,{relative:I}),[ye,Pe,Ae]=AR(S,pe),Ke=OR(Z,{replace:V,state:s,target:q,preventScrollReset:Q,relative:I,viewTransition:oe});function it(ut){g&&g(ut),ut.defaultPrevented||Ke(ut)}let rt=he.createElement("a",{...pe,...Ae,href:te||xe,onClick:ge||N?g:it,ref:IR(ze,Pe),target:q,"data-discover":!Se&&b==="render"?"true":void 0});return ye&&!Se?he.createElement(he.Fragment,null,rt,he.createElement(CR,{page:xe})):rt});Ds.displayName="Link";var DR=he.forwardRef(function({"aria-current":g="page",caseSensitive:b=!1,className:S="",end:I=!1,style:N,to:V,viewTransition:s,children:q,...Z},Q){let oe=d0(V,{relative:Z.relative}),pe=ko(),ze=he.useContext(g1),{navigator:le,basename:Se}=he.useContext(sh),te=ze!=null&&FR(oe)&&s===!0,ge=le.encodeLocation?le.encodeLocation(oe).pathname:oe.pathname,xe=pe.pathname,ye=ze&&ze.navigation&&ze.navigation.location?ze.navigation.location.pathname:null;b||(xe=xe.toLowerCase(),ye=ye?ye.toLowerCase():null,ge=ge.toLowerCase()),ye&&Se&&(ye=of(ye,Se)||ye);const Pe=ge!=="/"&&ge.endsWith("/")?ge.length-1:ge.length;let Ae=xe===ge||!I&&xe.startsWith(ge)&&xe.charAt(Pe)==="/",Ke=ye!=null&&(ye===ge||!I&&ye.startsWith(ge)&&ye.charAt(ge.length)==="/"),it={isActive:Ae,isPending:Ke,isTransitioning:te},rt=Ae?g:void 0,ut;typeof S=="function"?ut=S(it):ut=[S,Ae?"active":null,Ke?"pending":null,te?"transitioning":null].filter(Boolean).join(" ");let Lt=typeof N=="function"?N(it):N;return he.createElement(Ds,{...Z,"aria-current":rt,className:ut,ref:Q,style:Lt,to:V,viewTransition:s},typeof q=="function"?q(it):q)});DR.displayName="NavLink";var PR=he.forwardRef(({discover:h="render",fetcherKey:g,navigate:b,reloadDocument:S,replace:I,state:N,method:V=ky,action:s,onSubmit:q,relative:Z,preventScrollReset:Q,viewTransition:oe,...pe},ze)=>{let le=jR(),Se=BR(s,{relative:Z}),te=V.toLowerCase()==="get"?"get":"post",ge=typeof s=="string"&&hS.test(s),xe=ye=>{if(q&&q(ye),ye.defaultPrevented)return;ye.preventDefault();let Pe=ye.nativeEvent.submitter,Ae=(Pe==null?void 0:Pe.getAttribute("formmethod"))||V;le(Pe||ye.currentTarget,{fetcherKey:g,method:Ae,navigate:b,replace:I,state:N,relative:Z,preventScrollReset:Q,viewTransition:oe})};return he.createElement("form",{ref:ze,method:te,action:Se,onSubmit:S?q:xe,...pe,"data-discover":!ge&&h==="render"?"true":void 0})});PR.displayName="Form";function LR(h){return`${h} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function dS(h){let g=he.useContext(Vg);return Ps(g,LR(h)),g}function OR(h,{target:g,replace:b,state:S,preventScrollReset:I,relative:N,viewTransition:V}={}){let s=Pl(),q=ko(),Z=d0(h,{relative:N});return he.useCallback(Q=>{if(fR(Q,g)){Q.preventDefault();let oe=b!==void 0?b:s0(q)===s0(Z);s(h,{replace:oe,state:S,preventScrollReset:I,relative:N,viewTransition:V})}},[q,s,Z,b,S,g,h,I,N,V])}var kR=0,NR=()=>`__${String(++kR)}__`;function jR(){let{router:h}=dS("useSubmit"),{basename:g}=he.useContext(sh),b=nR();return he.useCallback(async(S,I={})=>{let{action:N,method:V,encType:s,formData:q,body:Z}=gR(S,g);if(I.navigate===!1){let Q=I.fetcherKey||NR();await h.fetch(Q,b,I.action||N,{preventScrollReset:I.preventScrollReset,formData:q,body:Z,formMethod:I.method||V,formEncType:I.encType||s,flushSync:I.flushSync})}else await h.navigate(I.action||N,{preventScrollReset:I.preventScrollReset,formData:q,body:Z,formMethod:I.method||V,formEncType:I.encType||s,replace:I.replace,state:I.state,fromRouteId:b,flushSync:I.flushSync,viewTransition:I.viewTransition})},[h,g,b])}function BR(h,{relative:g}={}){let{basename:b}=he.useContext(sh),S=he.useContext(ou);Ps(S,"useFormAction must be used inside a RouteContext");let[I]=S.matches.slice(-1),N={...d0(h||".",{relative:g})},V=ko();if(h==null){N.search=V.search;let s=new URLSearchParams(N.search),q=s.getAll("index");if(q.some(Q=>Q==="")){s.delete("index"),q.filter(oe=>oe).forEach(oe=>s.append("index",oe));let Q=s.toString();N.search=Q?`?${Q}`:""}}return(!h||h===".")&&I.route.index&&(N.search=N.search?N.search.replace(/^\?/,"?index&"):"?index"),b!=="/"&&(N.pathname=N.pathname==="/"?b:af([b,N.pathname])),s0(N)}function FR(h,g={}){let b=he.useContext(nS);Ps(b!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:S}=dS("useViewTransitionState"),I=d0(h,{relative:g.relative});if(!b.isTransitioning)return!1;let N=of(b.currentLocation.pathname,S)||b.currentLocation.pathname,V=of(b.nextLocation.pathname,S)||b.nextLocation.pathname;return e1(I.pathname,V)!=null||e1(I.pathname,N)!=null}new TextEncoder;var a4=JT(),ev={exports:{}},tv={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var o4;function UR(){if(o4)return tv;o4=1;var h=m1();function g(q,Z){return q===Z&&(q!==0||1/q===1/Z)||q!==q&&Z!==Z}var b=typeof Object.is=="function"?Object.is:g,S=h.useSyncExternalStore,I=h.useRef,N=h.useEffect,V=h.useMemo,s=h.useDebugValue;return tv.useSyncExternalStoreWithSelector=function(q,Z,Q,oe,pe){var ze=I(null);if(ze.current===null){var le={hasValue:!1,value:null};ze.current=le}else le=ze.current;ze=V(function(){function te(Ae){if(!ge){if(ge=!0,xe=Ae,Ae=oe(Ae),pe!==void 0&&le.hasValue){var Ke=le.value;if(pe(Ke,Ae))return ye=Ke}return ye=Ae}if(Ke=ye,b(xe,Ae))return Ke;var it=oe(Ae);return pe!==void 0&&pe(Ke,it)?(xe=Ae,Ke):(xe=Ae,ye=it)}var ge=!1,xe,ye,Pe=Q===void 0?null:Q;return[function(){return te(Z())},Pe===null?void 0:function(){return te(Pe())}]},[Z,Q,oe,pe]);var Se=S(q,ze[0],ze[1]);return N(function(){le.hasValue=!0,le.value=Se},[Se]),s(Se),Se},tv}var l4;function VR(){return l4||(l4=1,ev.exports=UR()),ev.exports}var HR=VR();function qR(h){h()}function GR(){let h=null,g=null;return{clear(){h=null,g=null},notify(){qR(()=>{let b=h;for(;b;)b.callback(),b=b.next})},get(){const b=[];let S=h;for(;S;)b.push(S),S=S.next;return b},subscribe(b){let S=!0;const I=g={callback:b,next:null,prev:g};return I.prev?I.prev.next=I:h=I,function(){!S||h===null||(S=!1,I.next?I.next.prev=I.prev:g=I.prev,I.prev?I.prev.next=I.next:h=I.next)}}}}var c4={notify(){},get:()=>[]};function $R(h,g){let b,S=c4,I=0,N=!1;function V(Se){Q();const te=S.subscribe(Se);let ge=!1;return()=>{ge||(ge=!0,te(),oe())}}function s(){S.notify()}function q(){le.onStateChange&&le.onStateChange()}function Z(){return N}function Q(){I++,b||(b=h.subscribe(q),S=GR())}function oe(){I--,b&&I===0&&(b(),b=void 0,S.clear(),S=c4)}function pe(){N||(N=!0,Q())}function ze(){N&&(N=!1,oe())}const le={addNestedSub:V,notifyNestedSubs:s,handleChangeWrapper:q,isSubscribed:Z,trySubscribe:pe,tryUnsubscribe:ze,getListeners:()=>S};return le}var ZR=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",WR=ZR(),XR=()=>typeof navigator<"u"&&navigator.product==="ReactNative",YR=XR(),KR=()=>WR||YR?he.useLayoutEffect:he.useEffect,JR=KR(),iv=Symbol.for("react-redux-context"),nv=typeof globalThis<"u"?globalThis:{};function QR(){if(!he.createContext)return{};const h=nv[iv]??(nv[iv]=new Map);let g=h.get(he.createContext);return g||(g=he.createContext(null),h.set(he.createContext,g)),g}var yp=QR();function e8(h){const{children:g,context:b,serverState:S,store:I}=h,N=he.useMemo(()=>{const q=$R(I);return{store:I,subscription:q,getServerState:S?()=>S:void 0}},[I,S]),V=he.useMemo(()=>I.getState(),[I]);JR(()=>{const{subscription:q}=N;return q.onStateChange=q.notifyNestedSubs,q.trySubscribe(),V!==I.getState()&&q.notifyNestedSubs(),()=>{q.tryUnsubscribe(),q.onStateChange=void 0}},[N,V]);const s=b||yp;return he.createElement(s.Provider,{value:N},g)}var t8=e8;function U2(h=yp){return function(){return he.useContext(h)}}var fS=U2();function pS(h=yp){const g=h===yp?fS:U2(h),b=()=>{const{store:S}=g();return S};return Object.assign(b,{withTypes:()=>b}),b}var i8=pS();function n8(h=yp){const g=h===yp?i8:pS(h),b=()=>g().dispatch;return Object.assign(b,{withTypes:()=>b}),b}var vp=n8(),r8=(h,g)=>h===g;function s8(h=yp){const g=h===yp?fS:U2(h),b=(S,I={})=>{const{equalityFn:N=r8}=typeof I=="function"?{equalityFn:I}:I,V=g(),{store:s,subscription:q,getServerState:Z}=V;he.useRef(!0);const Q=he.useCallback({[S.name](pe){return S(pe)}}[S.name],[S]),oe=HR.useSyncExternalStoreWithSelector(q.addNestedSub,s.getState,Z||s.getState,Q,N);return he.useDebugValue(oe),oe};return Object.assign(b,{withTypes:()=>b}),b}var fo=s8();function uo(h){return`Minified Redux error #${h}; visit https://redux.js.org/Errors?code=${h} for the full message or use the non-minified dev environment for full errors. `}var a8=typeof Symbol=="function"&&Symbol.observable||"@@observable",u4=a8,rv=()=>Math.random().toString(36).substring(7).split("").join("."),o8={INIT:`@@redux/INIT${rv()}`,REPLACE:`@@redux/REPLACE${rv()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${rv()}`},t1=o8;function V2(h){if(typeof h!="object"||h===null)return!1;let g=h;for(;Object.getPrototypeOf(g)!==null;)g=Object.getPrototypeOf(g);return Object.getPrototypeOf(h)===g||Object.getPrototypeOf(h)===null}function H2(h,g,b){if(typeof h!="function")throw new Error(uo(2));if(typeof g=="function"&&typeof b=="function"||typeof b=="function"&&typeof arguments[3]=="function")throw new Error(uo(0));if(typeof g=="function"&&typeof b>"u"&&(b=g,g=void 0),typeof b<"u"){if(typeof b!="function")throw new Error(uo(1));return b(H2)(h,g)}let S=h,I=g,N=new Map,V=N,s=0,q=!1;function Z(){V===N&&(V=new Map,N.forEach((te,ge)=>{V.set(ge,te)}))}function Q(){if(q)throw new Error(uo(3));return I}function oe(te){if(typeof te!="function")throw new Error(uo(4));if(q)throw new Error(uo(5));let ge=!0;Z();const xe=s++;return V.set(xe,te),function(){if(ge){if(q)throw new Error(uo(6));ge=!1,Z(),V.delete(xe),N=null}}}function pe(te){if(!V2(te))throw new Error(uo(7));if(typeof te.type>"u")throw new Error(uo(8));if(typeof te.type!="string")throw new Error(uo(17));if(q)throw new Error(uo(9));try{q=!0,I=S(I,te)}finally{q=!1}return(N=V).forEach(xe=>{xe()}),te}function ze(te){if(typeof te!="function")throw new Error(uo(10));S=te,pe({type:t1.REPLACE})}function le(){const te=oe;return{subscribe(ge){if(typeof ge!="object"||ge===null)throw new Error(uo(11));function xe(){const Pe=ge;Pe.next&&Pe.next(Q())}return xe(),{unsubscribe:te(xe)}},[u4](){return this}}}return pe({type:t1.INIT}),{dispatch:pe,subscribe:oe,getState:Q,replaceReducer:ze,[u4]:le}}function l8(h){Object.keys(h).forEach(g=>{const b=h[g];if(typeof b(void 0,{type:t1.INIT})>"u")throw new Error(uo(12));if(typeof b(void 0,{type:t1.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(uo(13))})}function mS(h){const g=Object.keys(h),b={};for(let N=0;N<g.length;N++){const V=g[N];typeof h[V]=="function"&&(b[V]=h[V])}const S=Object.keys(b);let I;try{l8(b)}catch(N){I=N}return function(V={},s){if(I)throw I;let q=!1;const Z={};for(let Q=0;Q<S.length;Q++){const oe=S[Q],pe=b[oe],ze=V[oe],le=pe(ze,s);if(typeof le>"u")throw s&&s.type,new Error(uo(14));Z[oe]=le,q=q||le!==ze}return q=q||S.length!==Object.keys(V).length,q?Z:V}}function i1(...h){return h.length===0?g=>g:h.length===1?h[0]:h.reduce((g,b)=>(...S)=>g(b(...S)))}function c8(...h){return g=>(b,S)=>{const I=g(b,S);let N=()=>{throw new Error(uo(15))};const V={getState:I.getState,dispatch:(q,...Z)=>N(q,...Z)},s=h.map(q=>q(V));return N=i1(...s)(I.dispatch),{...I,dispatch:N}}}function gS(h){return V2(h)&&"type"in h&&typeof h.type=="string"}var _S=Symbol.for("immer-nothing"),h4=Symbol.for("immer-draftable"),yc=Symbol.for("immer-state");function nh(h,...g){throw new Error(`[Immer] minified error nr: ${h}. Full error at: https://bit.ly/3cXEKWf`)}var Ng=Object.getPrototypeOf;function Im(h){return!!h&&!!h[yc]}function lf(h){var g;return h?yS(h)||Array.isArray(h)||!!h[h4]||!!((g=h.constructor)!=null&&g[h4])||x1(h)||v1(h):!1}var u8=Object.prototype.constructor.toString();function yS(h){if(!h||typeof h!="object")return!1;const g=Ng(h);if(g===null)return!0;const b=Object.hasOwnProperty.call(g,"constructor")&&g.constructor;return b===Object?!0:typeof b=="function"&&Function.toString.call(b)===u8}function n1(h,g){y1(h)===0?Reflect.ownKeys(h).forEach(b=>{g(b,h[b],h)}):h.forEach((b,S)=>g(S,b,h))}function y1(h){const g=h[yc];return g?g.type_:Array.isArray(h)?1:x1(h)?2:v1(h)?3:0}function t2(h,g){return y1(h)===2?h.has(g):Object.prototype.hasOwnProperty.call(h,g)}function xS(h,g,b){const S=y1(h);S===2?h.set(g,b):S===3?h.add(b):h[g]=b}function h8(h,g){return h===g?h!==0||1/h===1/g:h!==h&&g!==g}function x1(h){return h instanceof Map}function v1(h){return h instanceof Set}function wm(h){return h.copy_||h.base_}function i2(h,g){if(x1(h))return new Map(h);if(v1(h))return new Set(h);if(Array.isArray(h))return Array.prototype.slice.call(h);const b=yS(h);if(g===!0||g==="class_only"&&!b){const S=Object.getOwnPropertyDescriptors(h);delete S[yc];let I=Reflect.ownKeys(S);for(let N=0;N<I.length;N++){const V=I[N],s=S[V];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(S[V]={configurable:!0,writable:!0,enumerable:s.enumerable,value:h[V]})}return Object.create(Ng(h),S)}else{const S=Ng(h);if(S!==null&&b)return{...h};const I=Object.create(S);return Object.assign(I,h)}}function q2(h,g=!1){return b1(h)||Im(h)||!lf(h)||(y1(h)>1&&(h.set=h.add=h.clear=h.delete=d8),Object.freeze(h),g&&Object.entries(h).forEach(([b,S])=>q2(S,!0))),h}function d8(){nh(2)}function b1(h){return Object.isFrozen(h)}var f8={};function zm(h){const g=f8[h];return g||nh(0,h),g}var a0;function vS(){return a0}function p8(h,g){return{drafts_:[],parent_:h,immer_:g,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function d4(h,g){g&&(zm("Patches"),h.patches_=[],h.inversePatches_=[],h.patchListener_=g)}function n2(h){r2(h),h.drafts_.forEach(m8),h.drafts_=null}function r2(h){h===a0&&(a0=h.parent_)}function f4(h){return a0=p8(a0,h)}function m8(h){const g=h[yc];g.type_===0||g.type_===1?g.revoke_():g.revoked_=!0}function p4(h,g){g.unfinalizedDrafts_=g.drafts_.length;const b=g.drafts_[0];return h!==void 0&&h!==b?(b[yc].modified_&&(n2(g),nh(4)),lf(h)&&(h=r1(g,h),g.parent_||s1(g,h)),g.patches_&&zm("Patches").generateReplacementPatches_(b[yc].base_,h,g.patches_,g.inversePatches_)):h=r1(g,b,[]),n2(g),g.patches_&&g.patchListener_(g.patches_,g.inversePatches_),h!==_S?h:void 0}function r1(h,g,b){if(b1(g))return g;const S=g[yc];if(!S)return n1(g,(I,N)=>m4(h,S,g,I,N,b)),g;if(S.scope_!==h)return g;if(!S.modified_)return s1(h,S.base_,!0),S.base_;if(!S.finalized_){S.finalized_=!0,S.scope_.unfinalizedDrafts_--;const I=S.copy_;let N=I,V=!1;S.type_===3&&(N=new Set(I),I.clear(),V=!0),n1(N,(s,q)=>m4(h,S,I,s,q,b,V)),s1(h,I,!1),b&&h.patches_&&zm("Patches").generatePatches_(S,b,h.patches_,h.inversePatches_)}return S.copy_}function m4(h,g,b,S,I,N,V){if(Im(I)){const s=N&&g&&g.type_!==3&&!t2(g.assigned_,S)?N.concat(S):void 0,q=r1(h,I,s);if(xS(b,S,q),Im(q))h.canAutoFreeze_=!1;else return}else V&&b.add(I);if(lf(I)&&!b1(I)){if(!h.immer_.autoFreeze_&&h.unfinalizedDrafts_<1)return;r1(h,I),(!g||!g.scope_.parent_)&&typeof S!="symbol"&&Object.prototype.propertyIsEnumerable.call(b,S)&&s1(h,I)}}function s1(h,g,b=!1){!h.parent_&&h.immer_.autoFreeze_&&h.canAutoFreeze_&&q2(g,b)}function g8(h,g){const b=Array.isArray(h),S={type_:b?1:0,scope_:g?g.scope_:vS(),modified_:!1,finalized_:!1,assigned_:{},parent_:g,base_:h,draft_:null,copy_:null,revoke_:null,isManual_:!1};let I=S,N=G2;b&&(I=[S],N=o0);const{revoke:V,proxy:s}=Proxy.revocable(I,N);return S.draft_=s,S.revoke_=V,s}var G2={get(h,g){if(g===yc)return h;const b=wm(h);if(!t2(b,g))return _8(h,b,g);const S=b[g];return h.finalized_||!lf(S)?S:S===sv(h.base_,g)?(av(h),h.copy_[g]=a2(S,h)):S},has(h,g){return g in wm(h)},ownKeys(h){return Reflect.ownKeys(wm(h))},set(h,g,b){const S=bS(wm(h),g);if(S!=null&&S.set)return S.set.call(h.draft_,b),!0;if(!h.modified_){const I=sv(wm(h),g),N=I==null?void 0:I[yc];if(N&&N.base_===b)return h.copy_[g]=b,h.assigned_[g]=!1,!0;if(h8(b,I)&&(b!==void 0||t2(h.base_,g)))return!0;av(h),s2(h)}return h.copy_[g]===b&&(b!==void 0||g in h.copy_)||Number.isNaN(b)&&Number.isNaN(h.copy_[g])||(h.copy_[g]=b,h.assigned_[g]=!0),!0},deleteProperty(h,g){return sv(h.base_,g)!==void 0||g in h.base_?(h.assigned_[g]=!1,av(h),s2(h)):delete h.assigned_[g],h.copy_&&delete h.copy_[g],!0},getOwnPropertyDescriptor(h,g){const b=wm(h),S=Reflect.getOwnPropertyDescriptor(b,g);return S&&{writable:!0,configurable:h.type_!==1||g!=="length",enumerable:S.enumerable,value:b[g]}},defineProperty(){nh(11)},getPrototypeOf(h){return Ng(h.base_)},setPrototypeOf(){nh(12)}},o0={};n1(G2,(h,g)=>{o0[h]=function(){return arguments[0]=arguments[0][0],g.apply(this,arguments)}});o0.deleteProperty=function(h,g){return o0.set.call(this,h,g,void 0)};o0.set=function(h,g,b){return G2.set.call(this,h[0],g,b,h[0])};function sv(h,g){const b=h[yc];return(b?wm(b):h)[g]}function _8(h,g,b){var I;const S=bS(g,b);return S?"value"in S?S.value:(I=S.get)==null?void 0:I.call(h.draft_):void 0}function bS(h,g){if(!(g in h))return;let b=Ng(h);for(;b;){const S=Object.getOwnPropertyDescriptor(b,g);if(S)return S;b=Ng(b)}}function s2(h){h.modified_||(h.modified_=!0,h.parent_&&s2(h.parent_))}function av(h){h.copy_||(h.copy_=i2(h.base_,h.scope_.immer_.useStrictShallowCopy_))}var y8=class{constructor(h){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(g,b,S)=>{if(typeof g=="function"&&typeof b!="function"){const N=b;b=g;const V=this;return function(q=N,...Z){return V.produce(q,Q=>b.call(this,Q,...Z))}}typeof b!="function"&&nh(6),S!==void 0&&typeof S!="function"&&nh(7);let I;if(lf(g)){const N=f4(this),V=a2(g,void 0);let s=!0;try{I=b(V),s=!1}finally{s?n2(N):r2(N)}return d4(N,S),p4(I,N)}else if(!g||typeof g!="object"){if(I=b(g),I===void 0&&(I=g),I===_S&&(I=void 0),this.autoFreeze_&&q2(I,!0),S){const N=[],V=[];zm("Patches").generateReplacementPatches_(g,I,N,V),S(N,V)}return I}else nh(1,g)},this.produceWithPatches=(g,b)=>{if(typeof g=="function")return(V,...s)=>this.produceWithPatches(V,q=>g(q,...s));let S,I;return[this.produce(g,b,(V,s)=>{S=V,I=s}),S,I]},typeof(h==null?void 0:h.autoFreeze)=="boolean"&&this.setAutoFreeze(h.autoFreeze),typeof(h==null?void 0:h.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(h.useStrictShallowCopy)}createDraft(h){lf(h)||nh(8),Im(h)&&(h=x8(h));const g=f4(this),b=a2(h,void 0);return b[yc].isManual_=!0,r2(g),b}finishDraft(h,g){const b=h&&h[yc];(!b||!b.isManual_)&&nh(9);const{scope_:S}=b;return d4(S,g),p4(void 0,S)}setAutoFreeze(h){this.autoFreeze_=h}setUseStrictShallowCopy(h){this.useStrictShallowCopy_=h}applyPatches(h,g){let b;for(b=g.length-1;b>=0;b--){const I=g[b];if(I.path.length===0&&I.op==="replace"){h=I.value;break}}b>-1&&(g=g.slice(b+1));const S=zm("Patches").applyPatches_;return Im(h)?S(h,g):this.produce(h,I=>S(I,g))}};function a2(h,g){const b=x1(h)?zm("MapSet").proxyMap_(h,g):v1(h)?zm("MapSet").proxySet_(h,g):g8(h,g);return(g?g.scope_:vS()).drafts_.push(b),b}function x8(h){return Im(h)||nh(10,h),wS(h)}function wS(h){if(!lf(h)||b1(h))return h;const g=h[yc];let b;if(g){if(!g.modified_)return g.base_;g.finalized_=!0,b=i2(h,g.scope_.immer_.useStrictShallowCopy_)}else b=i2(h,!0);return n1(b,(S,I)=>{xS(b,S,wS(I))}),g&&(g.finalized_=!1),b}var xc=new y8,TS=xc.produce;xc.produceWithPatches.bind(xc);xc.setAutoFreeze.bind(xc);xc.setUseStrictShallowCopy.bind(xc);xc.applyPatches.bind(xc);xc.createDraft.bind(xc);xc.finishDraft.bind(xc);function ak(h){return h}function SS(h){return({dispatch:b,getState:S})=>I=>N=>typeof N=="function"?N(b,S,h):I(N)}var v8=SS(),b8=SS,w8=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?i1:i1.apply(null,arguments)};function jg(h,g){function b(...S){if(g){let I=g(...S);if(!I)throw new Error(_c(0));return{type:h,payload:I.payload,..."meta"in I&&{meta:I.meta},..."error"in I&&{error:I.error}}}return{type:h,payload:S[0]}}return b.toString=()=>`${h}`,b.type=h,b.match=S=>gS(S)&&S.type===h,b}var ES=class t0 extends Array{constructor(...g){super(...g),Object.setPrototypeOf(this,t0.prototype)}static get[Symbol.species](){return t0}concat(...g){return super.concat.apply(this,g)}prepend(...g){return g.length===1&&Array.isArray(g[0])?new t0(...g[0].concat(this)):new t0(...g.concat(this))}};function g4(h){return lf(h)?TS(h,()=>{}):h}function _4(h,g,b){return h.has(g)?h.get(g):h.set(g,b(g)).get(g)}function T8(h){return typeof h=="boolean"}var S8=()=>function(g){const{thunk:b=!0,immutableCheck:S=!0,serializableCheck:I=!0,actionCreatorCheck:N=!0}=g??{};let V=new ES;return b&&(T8(b)?V.push(v8):V.push(b8(b.extraArgument))),V},E8="RTK_autoBatch",y4=h=>g=>{setTimeout(g,h)},A8=(h={type:"raf"})=>g=>(...b)=>{const S=g(...b);let I=!0,N=!1,V=!1;const s=new Set,q=h.type==="tick"?queueMicrotask:h.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:y4(10):h.type==="callback"?h.queueNotification:y4(h.timeout),Z=()=>{V=!1,N&&(N=!1,s.forEach(Q=>Q()))};return Object.assign({},S,{subscribe(Q){const oe=()=>I&&Q(),pe=S.subscribe(oe);return s.add(Q),()=>{pe(),s.delete(Q)}},dispatch(Q){var oe;try{return I=!((oe=Q==null?void 0:Q.meta)!=null&&oe[E8]),N=!I,N&&(V||(V=!0,q(Z))),S.dispatch(Q)}finally{I=!0}}})},C8=h=>function(b){const{autoBatch:S=!0}=b??{};let I=new ES(h);return S&&I.push(A8(typeof S=="object"?S:void 0)),I};function R8(h){const g=S8(),{reducer:b=void 0,middleware:S,devTools:I=!0,preloadedState:N=void 0,enhancers:V=void 0}=h||{};let s;if(typeof b=="function")s=b;else if(V2(b))s=mS(b);else throw new Error(_c(1));let q;typeof S=="function"?q=S(g):q=g();let Z=i1;I&&(Z=w8({trace:!1,...typeof I=="object"&&I}));const Q=c8(...q),oe=C8(Q);let pe=typeof V=="function"?V(oe):oe();const ze=Z(...pe);return H2(s,N,ze)}function AS(h){const g={},b=[];let S;const I={addCase(N,V){const s=typeof N=="string"?N:N.type;if(!s)throw new Error(_c(28));if(s in g)throw new Error(_c(29));return g[s]=V,I},addMatcher(N,V){return b.push({matcher:N,reducer:V}),I},addDefaultCase(N){return S=N,I}};return h(I),[g,b,S]}function M8(h){return typeof h=="function"}function I8(h,g){let[b,S,I]=AS(g),N;if(M8(h))N=()=>g4(h());else{const s=g4(h);N=()=>s}function V(s=N(),q){let Z=[b[q.type],...S.filter(({matcher:Q})=>Q(q)).map(({reducer:Q})=>Q)];return Z.filter(Q=>!!Q).length===0&&(Z=[I]),Z.reduce((Q,oe)=>{if(oe)if(Im(Q)){const ze=oe(Q,q);return ze===void 0?Q:ze}else{if(lf(Q))return TS(Q,pe=>oe(pe,q));{const pe=oe(Q,q);if(pe===void 0){if(Q===null)return Q;throw Error("A case reducer on a non-draftable value must not return undefined")}return pe}}return Q},s)}return V.getInitialState=N,V}var z8="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",D8=(h=21)=>{let g="",b=h;for(;b--;)g+=z8[Math.random()*64|0];return g},P8=Symbol.for("rtk-slice-createasyncthunk");function L8(h,g){return`${h}/${g}`}function O8({creators:h}={}){var b;const g=(b=h==null?void 0:h.asyncThunk)==null?void 0:b[P8];return function(I){const{name:N,reducerPath:V=N}=I;if(!N)throw new Error(_c(11));const s=(typeof I.reducers=="function"?I.reducers(j8()):I.reducers)||{},q=Object.keys(s),Z={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},Q={addCase(ye,Pe){const Ae=typeof ye=="string"?ye:ye.type;if(!Ae)throw new Error(_c(12));if(Ae in Z.sliceCaseReducersByType)throw new Error(_c(13));return Z.sliceCaseReducersByType[Ae]=Pe,Q},addMatcher(ye,Pe){return Z.sliceMatchers.push({matcher:ye,reducer:Pe}),Q},exposeAction(ye,Pe){return Z.actionCreators[ye]=Pe,Q},exposeCaseReducer(ye,Pe){return Z.sliceCaseReducersByName[ye]=Pe,Q}};q.forEach(ye=>{const Pe=s[ye],Ae={reducerName:ye,type:L8(N,ye),createNotation:typeof I.reducers=="function"};F8(Pe)?V8(Ae,Pe,Q,g):B8(Ae,Pe,Q)});function oe(){const[ye={},Pe=[],Ae=void 0]=typeof I.extraReducers=="function"?AS(I.extraReducers):[I.extraReducers],Ke={...ye,...Z.sliceCaseReducersByType};return I8(I.initialState,it=>{for(let rt in Ke)it.addCase(rt,Ke[rt]);for(let rt of Z.sliceMatchers)it.addMatcher(rt.matcher,rt.reducer);for(let rt of Pe)it.addMatcher(rt.matcher,rt.reducer);Ae&&it.addDefaultCase(Ae)})}const pe=ye=>ye,ze=new Map;let le;function Se(ye,Pe){return le||(le=oe()),le(ye,Pe)}function te(){return le||(le=oe()),le.getInitialState()}function ge(ye,Pe=!1){function Ae(it){let rt=it[ye];return typeof rt>"u"&&Pe&&(rt=te()),rt}function Ke(it=pe){const rt=_4(ze,Pe,()=>new WeakMap);return _4(rt,it,()=>{const ut={};for(const[Lt,lt]of Object.entries(I.selectors??{}))ut[Lt]=k8(lt,it,te,Pe);return ut})}return{reducerPath:ye,getSelectors:Ke,get selectors(){return Ke(Ae)},selectSlice:Ae}}const xe={name:N,reducer:Se,actions:Z.actionCreators,caseReducers:Z.sliceCaseReducersByName,getInitialState:te,...ge(V),injectInto(ye,{reducerPath:Pe,...Ae}={}){const Ke=Pe??V;return ye.inject({reducerPath:Ke,reducer:Se},Ae),{...xe,...ge(Ke,!0)}}};return xe}}function k8(h,g,b,S){function I(N,...V){let s=g(N);return typeof s>"u"&&S&&(s=b()),h(s,...V)}return I.unwrapped=h,I}var N8=O8();function j8(){function h(g,b){return{_reducerDefinitionType:"asyncThunk",payloadCreator:g,...b}}return h.withTypes=()=>h,{reducer(g){return Object.assign({[g.name](...b){return g(...b)}}[g.name],{_reducerDefinitionType:"reducer"})},preparedReducer(g,b){return{_reducerDefinitionType:"reducerWithPrepare",prepare:g,reducer:b}},asyncThunk:h}}function B8({type:h,reducerName:g,createNotation:b},S,I){let N,V;if("reducer"in S){if(b&&!U8(S))throw new Error(_c(17));N=S.reducer,V=S.prepare}else N=S;I.addCase(h,N).exposeCaseReducer(g,N).exposeAction(g,V?jg(h,V):jg(h))}function F8(h){return h._reducerDefinitionType==="asyncThunk"}function U8(h){return h._reducerDefinitionType==="reducerWithPrepare"}function V8({type:h,reducerName:g},b,S,I){if(!I)throw new Error(_c(18));const{payloadCreator:N,fulfilled:V,pending:s,rejected:q,settled:Z,options:Q}=b,oe=I(h,N,Q);S.exposeAction(g,oe),V&&S.addCase(oe.fulfilled,V),s&&S.addCase(oe.pending,s),q&&S.addCase(oe.rejected,q),Z&&S.addMatcher(oe.settled,Z),S.exposeCaseReducer(g,{fulfilled:V||Ry,pending:s||Ry,rejected:q||Ry,settled:Z||Ry})}function Ry(){}var H8="task",CS="listener",RS="completed",$2="cancelled",q8=`task-${$2}`,G8=`task-${RS}`,o2=`${CS}-${$2}`,$8=`${CS}-${RS}`,w1=class{constructor(h){Gx(this,"name","TaskAbortError");Gx(this,"message");this.code=h,this.message=`${H8} ${$2} (reason: ${h})`}},Z2=(h,g)=>{if(typeof h!="function")throw new TypeError(_c(32))},a1=()=>{},MS=(h,g=a1)=>(h.catch(g),h),IS=(h,g)=>(h.addEventListener("abort",g,{once:!0}),()=>h.removeEventListener("abort",g)),Em=(h,g)=>{const b=h.signal;b.aborted||("reason"in b||Object.defineProperty(b,"reason",{enumerable:!0,value:g,configurable:!0,writable:!0}),h.abort(g))},Am=h=>{if(h.aborted){const{reason:g}=h;throw new w1(g)}};function zS(h,g){let b=a1;return new Promise((S,I)=>{const N=()=>I(new w1(h.reason));if(h.aborted){N();return}b=IS(h,N),g.finally(()=>b()).then(S,I)}).finally(()=>{b=a1})}var Z8=async(h,g)=>{try{return await Promise.resolve(),{status:"ok",value:await h()}}catch(b){return{status:b instanceof w1?"cancelled":"rejected",error:b}}finally{g==null||g()}},o1=h=>g=>MS(zS(h,g).then(b=>(Am(h),b))),DS=h=>{const g=o1(h);return b=>g(new Promise(S=>setTimeout(S,b)))},{assign:Pg}=Object,x4={},T1="listenerMiddleware",W8=(h,g)=>{const b=S=>IS(h,()=>Em(S,h.reason));return(S,I)=>{Z2(S);const N=new AbortController;b(N);const V=Z8(async()=>{Am(h),Am(N.signal);const s=await S({pause:o1(N.signal),delay:DS(N.signal),signal:N.signal});return Am(N.signal),s},()=>Em(N,G8));return I!=null&&I.autoJoin&&g.push(V.catch(a1)),{result:o1(h)(V),cancel(){Em(N,q8)}}}},X8=(h,g)=>{const b=async(S,I)=>{Am(g);let N=()=>{};const s=[new Promise((q,Z)=>{let Q=h({predicate:S,effect:(oe,pe)=>{pe.unsubscribe(),q([oe,pe.getState(),pe.getOriginalState()])}});N=()=>{Q(),Z()}})];I!=null&&s.push(new Promise(q=>setTimeout(q,I,null)));try{const q=await zS(g,Promise.race(s));return Am(g),q}finally{N()}};return(S,I)=>MS(b(S,I))},PS=h=>{let{type:g,actionCreator:b,matcher:S,predicate:I,effect:N}=h;if(g)I=jg(g).match;else if(b)g=b.type,I=b.match;else if(S)I=S;else if(!I)throw new Error(_c(21));return Z2(N),{predicate:I,type:g,effect:N}},LS=Pg(h=>{const{type:g,predicate:b,effect:S}=PS(h);return{id:D8(),effect:S,type:g,predicate:b,pending:new Set,unsubscribe:()=>{throw new Error(_c(22))}}},{withTypes:()=>LS}),v4=(h,g)=>{const{type:b,effect:S,predicate:I}=PS(g);return Array.from(h.values()).find(N=>(typeof b=="string"?N.type===b:N.predicate===I)&&N.effect===S)},l2=h=>{h.pending.forEach(g=>{Em(g,o2)})},Y8=h=>()=>{h.forEach(l2),h.clear()},b4=(h,g,b)=>{try{h(g,b)}catch(S){setTimeout(()=>{throw S},0)}},OS=Pg(jg(`${T1}/add`),{withTypes:()=>OS}),K8=jg(`${T1}/removeAll`),kS=Pg(jg(`${T1}/remove`),{withTypes:()=>kS}),J8=(...h)=>{console.error(`${T1}/error`,...h)},ok=(h={})=>{const g=new Map,{extra:b,onError:S=J8}=h;Z2(S);const I=Q=>(Q.unsubscribe=()=>g.delete(Q.id),g.set(Q.id,Q),oe=>{Q.unsubscribe(),oe!=null&&oe.cancelActive&&l2(Q)}),N=Q=>{const oe=v4(g,Q)??LS(Q);return I(oe)};Pg(N,{withTypes:()=>N});const V=Q=>{const oe=v4(g,Q);return oe&&(oe.unsubscribe(),Q.cancelActive&&l2(oe)),!!oe};Pg(V,{withTypes:()=>V});const s=async(Q,oe,pe,ze)=>{const le=new AbortController,Se=X8(N,le.signal),te=[];try{Q.pending.add(le),await Promise.resolve(Q.effect(oe,Pg({},pe,{getOriginalState:ze,condition:(ge,xe)=>Se(ge,xe).then(Boolean),take:Se,delay:DS(le.signal),pause:o1(le.signal),extra:b,signal:le.signal,fork:W8(le.signal,te),unsubscribe:Q.unsubscribe,subscribe:()=>{g.set(Q.id,Q)},cancelActiveListeners:()=>{Q.pending.forEach((ge,xe,ye)=>{ge!==le&&(Em(ge,o2),ye.delete(ge))})},cancel:()=>{Em(le,o2),Q.pending.delete(le)},throwIfCancelled:()=>{Am(le.signal)}})))}catch(ge){ge instanceof w1||b4(S,ge,{raisedBy:"effect"})}finally{await Promise.all(te),Em(le,$8),Q.pending.delete(le)}},q=Y8(g);return{middleware:Q=>oe=>pe=>{if(!gS(pe))return oe(pe);if(OS.match(pe))return N(pe.payload);if(K8.match(pe)){q();return}if(kS.match(pe))return V(pe.payload);let ze=Q.getState();const le=()=>{if(ze===x4)throw new Error(_c(23));return ze};let Se;try{if(Se=oe(pe),g.size>0){const te=Q.getState(),ge=Array.from(g.values());for(const xe of ge){let ye=!1;try{ye=xe.predicate(pe,te,ze)}catch(Pe){ye=!1,b4(S,Pe,{raisedBy:"predicate"})}ye&&s(xe,pe,Q,le)}}}finally{ze=x4}return Se},startListening:N,stopListening:V,clearListeners:q}};function _c(h){return`Minified Redux Toolkit error #${h}; visit https://redux-toolkit.js.org/Errors?code=${h} for the full message or use the non-minified dev environment for full errors. `}const Q8={currentUser:null,error:null,loading:!1},NS=N8({name:"user",initialState:Q8,reducers:{signInStart:h=>{h.loading=!0},signInSuccess:(h,g)=>{h.currentUser=g.payload,h.loading=!1,h.error=null},signInFailure:(h,g)=>{h.error=g.payload,h.loading=!1},verifyAuthStart:h=>{h.loading=!0},verifyAuthSuccess:(h,g)=>{h.currentUser=g.payload,h.loading=!1,h.error=null},verifyAuthFailure:(h,g)=>{h.currentUser=null,h.error=g.payload,h.loading=!1},updateUserStart:h=>{h.loading=!0},updateUserSuccess:(h,g)=>{h.currentUser=g.payload,h.loading=!1,h.error=null},updateUserFailure:(h,g)=>{h.error=g.payload,h.loading=!1},deleteUserStart:h=>{h.loading=!0},deleteUserSuccess:(h,g)=>{h.currentUser=null,h.loading=!1,h.error=null},deleteUserFailure:(h,g)=>{h.error=g.payload,h.loading=!1},signoutUserStart:h=>{h.loading=!0},signoutUserSuccess:(h,g)=>{h.currentUser=null,h.loading=!1,h.error=null},signoutUserFailure:(h,g)=>{h.error=g.payload,h.loading=!1}}}),{signInStart:lk,signInSuccess:ck,signInFailure:uk,verifyAuthStart:eM,verifyAuthSuccess:tM,verifyAuthFailure:w4,updateUserStart:hk,updateUserSuccess:dk,updateUserFailure:fk,deleteUserStart:pk,deleteUserSuccess:mk,deleteUserFailure:gk,signoutUserStart:S1,signoutUserSuccess:Xa,signoutUserFailure:xp}=NS.actions,iM=NS.reducer,sd=Object.create(null);sd.open="0";sd.close="1";sd.ping="2";sd.pong="3";sd.message="4";sd.upgrade="5";sd.noop="6";const jy=Object.create(null);Object.keys(sd).forEach(h=>{jy[sd[h]]=h});const c2={type:"error",data:"parser error"},jS=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",BS=typeof ArrayBuffer=="function",FS=h=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(h):h&&h.buffer instanceof ArrayBuffer,W2=({type:h,data:g},b,S)=>jS&&g instanceof Blob?b?S(g):T4(g,S):BS&&(g instanceof ArrayBuffer||FS(g))?b?S(g):T4(new Blob([g]),S):S(sd[h]+(g||"")),T4=(h,g)=>{const b=new FileReader;return b.onload=function(){const S=b.result.split(",")[1];g("b"+(S||""))},b.readAsDataURL(h)};function S4(h){return h instanceof Uint8Array?h:h instanceof ArrayBuffer?new Uint8Array(h):new Uint8Array(h.buffer,h.byteOffset,h.byteLength)}let ov;function nM(h,g){if(jS&&h.data instanceof Blob)return h.data.arrayBuffer().then(S4).then(g);if(BS&&(h.data instanceof ArrayBuffer||FS(h.data)))return g(S4(h.data));W2(h,!1,b=>{ov||(ov=new TextEncoder),g(ov.encode(b))})}const E4="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i0=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let h=0;h<E4.length;h++)i0[E4.charCodeAt(h)]=h;const rM=h=>{let g=h.length*.75,b=h.length,S,I=0,N,V,s,q;h[h.length-1]==="="&&(g--,h[h.length-2]==="="&&g--);const Z=new ArrayBuffer(g),Q=new Uint8Array(Z);for(S=0;S<b;S+=4)N=i0[h.charCodeAt(S)],V=i0[h.charCodeAt(S+1)],s=i0[h.charCodeAt(S+2)],q=i0[h.charCodeAt(S+3)],Q[I++]=N<<2|V>>4,Q[I++]=(V&15)<<4|s>>2,Q[I++]=(s&3)<<6|q&63;return Z},sM=typeof ArrayBuffer=="function",X2=(h,g)=>{if(typeof h!="string")return{type:"message",data:US(h,g)};const b=h.charAt(0);return b==="b"?{type:"message",data:aM(h.substring(1),g)}:jy[b]?h.length>1?{type:jy[b],data:h.substring(1)}:{type:jy[b]}:c2},aM=(h,g)=>{if(sM){const b=rM(h);return US(b,g)}else return{base64:!0,data:h}},US=(h,g)=>{switch(g){case"blob":return h instanceof Blob?h:new Blob([h]);case"arraybuffer":default:return h instanceof ArrayBuffer?h:h.buffer}},VS="",oM=(h,g)=>{const b=h.length,S=new Array(b);let I=0;h.forEach((N,V)=>{W2(N,!1,s=>{S[V]=s,++I===b&&g(S.join(VS))})})},lM=(h,g)=>{const b=h.split(VS),S=[];for(let I=0;I<b.length;I++){const N=X2(b[I],g);if(S.push(N),N.type==="error")break}return S};function cM(){return new TransformStream({transform(h,g){nM(h,b=>{const S=b.length;let I;if(S<126)I=new Uint8Array(1),new DataView(I.buffer).setUint8(0,S);else if(S<65536){I=new Uint8Array(3);const N=new DataView(I.buffer);N.setUint8(0,126),N.setUint16(1,S)}else{I=new Uint8Array(9);const N=new DataView(I.buffer);N.setUint8(0,127),N.setBigUint64(1,BigInt(S))}h.data&&typeof h.data!="string"&&(I[0]|=128),g.enqueue(I),g.enqueue(b)})}})}let lv;function My(h){return h.reduce((g,b)=>g+b.length,0)}function Iy(h,g){if(h[0].length===g)return h.shift();const b=new Uint8Array(g);let S=0;for(let I=0;I<g;I++)b[I]=h[0][S++],S===h[0].length&&(h.shift(),S=0);return h.length&&S<h[0].length&&(h[0]=h[0].slice(S)),b}function uM(h,g){lv||(lv=new TextDecoder);const b=[];let S=0,I=-1,N=!1;return new TransformStream({transform(V,s){for(b.push(V);;){if(S===0){if(My(b)<1)break;const q=Iy(b,1);N=(q[0]&128)===128,I=q[0]&127,I<126?S=3:I===126?S=1:S=2}else if(S===1){if(My(b)<2)break;const q=Iy(b,2);I=new DataView(q.buffer,q.byteOffset,q.length).getUint16(0),S=3}else if(S===2){if(My(b)<8)break;const q=Iy(b,8),Z=new DataView(q.buffer,q.byteOffset,q.length),Q=Z.getUint32(0);if(Q>Math.pow(2,21)-1){s.enqueue(c2);break}I=Q*Math.pow(2,32)+Z.getUint32(4),S=3}else{if(My(b)<I)break;const q=Iy(b,I);s.enqueue(X2(N?q:lv.decode(q),g)),S=0}if(I===0||I>h){s.enqueue(c2);break}}}})}const HS=4;function Ta(h){if(h)return hM(h)}function hM(h){for(var g in Ta.prototype)h[g]=Ta.prototype[g];return h}Ta.prototype.on=Ta.prototype.addEventListener=function(h,g){return this._callbacks=this._callbacks||{},(this._callbacks["$"+h]=this._callbacks["$"+h]||[]).push(g),this};Ta.prototype.once=function(h,g){function b(){this.off(h,b),g.apply(this,arguments)}return b.fn=g,this.on(h,b),this};Ta.prototype.off=Ta.prototype.removeListener=Ta.prototype.removeAllListeners=Ta.prototype.removeEventListener=function(h,g){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var b=this._callbacks["$"+h];if(!b)return this;if(arguments.length==1)return delete this._callbacks["$"+h],this;for(var S,I=0;I<b.length;I++)if(S=b[I],S===g||S.fn===g){b.splice(I,1);break}return b.length===0&&delete this._callbacks["$"+h],this};Ta.prototype.emit=function(h){this._callbacks=this._callbacks||{};for(var g=new Array(arguments.length-1),b=this._callbacks["$"+h],S=1;S<arguments.length;S++)g[S-1]=arguments[S];if(b){b=b.slice(0);for(var S=0,I=b.length;S<I;++S)b[S].apply(this,g)}return this};Ta.prototype.emitReserved=Ta.prototype.emit;Ta.prototype.listeners=function(h){return this._callbacks=this._callbacks||{},this._callbacks["$"+h]||[]};Ta.prototype.hasListeners=function(h){return!!this.listeners(h).length};const E1=typeof Promise=="function"&&typeof Promise.resolve=="function"?g=>Promise.resolve().then(g):(g,b)=>b(g,0),ru=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),dM="arraybuffer";function qS(h,...g){return g.reduce((b,S)=>(h.hasOwnProperty(S)&&(b[S]=h[S]),b),{})}const fM=ru.setTimeout,pM=ru.clearTimeout;function A1(h,g){g.useNativeTimers?(h.setTimeoutFn=fM.bind(ru),h.clearTimeoutFn=pM.bind(ru)):(h.setTimeoutFn=ru.setTimeout.bind(ru),h.clearTimeoutFn=ru.clearTimeout.bind(ru))}const mM=1.33;function gM(h){return typeof h=="string"?_M(h):Math.ceil((h.byteLength||h.size)*mM)}function _M(h){let g=0,b=0;for(let S=0,I=h.length;S<I;S++)g=h.charCodeAt(S),g<128?b+=1:g<2048?b+=2:g<55296||g>=57344?b+=3:(S++,b+=4);return b}function GS(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function yM(h){let g="";for(let b in h)h.hasOwnProperty(b)&&(g.length&&(g+="&"),g+=encodeURIComponent(b)+"="+encodeURIComponent(h[b]));return g}function xM(h){let g={},b=h.split("&");for(let S=0,I=b.length;S<I;S++){let N=b[S].split("=");g[decodeURIComponent(N[0])]=decodeURIComponent(N[1])}return g}class vM extends Error{constructor(g,b,S){super(g),this.description=b,this.context=S,this.type="TransportError"}}class Y2 extends Ta{constructor(g){super(),this.writable=!1,A1(this,g),this.opts=g,this.query=g.query,this.socket=g.socket,this.supportsBinary=!g.forceBase64}onError(g,b,S){return super.emitReserved("error",new vM(g,b,S)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(g){this.readyState==="open"&&this.write(g)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(g){const b=X2(g,this.socket.binaryType);this.onPacket(b)}onPacket(g){super.emitReserved("packet",g)}onClose(g){this.readyState="closed",super.emitReserved("close",g)}pause(g){}createUri(g,b={}){return g+"://"+this._hostname()+this._port()+this.opts.path+this._query(b)}_hostname(){const g=this.opts.hostname;return g.indexOf(":")===-1?g:"["+g+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(g){const b=yM(g);return b.length?"?"+b:""}}class bM extends Y2{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(g){this.readyState="pausing";const b=()=>{this.readyState="paused",g()};if(this._polling||!this.writable){let S=0;this._polling&&(S++,this.once("pollComplete",function(){--S||b()})),this.writable||(S++,this.once("drain",function(){--S||b()}))}else b()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(g){const b=S=>{if(this.readyState==="opening"&&S.type==="open"&&this.onOpen(),S.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(S)};lM(g,this.socket.binaryType).forEach(b),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const g=()=>{this.write([{type:"close"}])};this.readyState==="open"?g():this.once("open",g)}write(g){this.writable=!1,oM(g,b=>{this.doWrite(b,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const g=this.opts.secure?"https":"http",b=this.query||{};return this.opts.timestampRequests!==!1&&(b[this.opts.timestampParam]=GS()),!this.supportsBinary&&!b.sid&&(b.b64=1),this.createUri(g,b)}}let $S=!1;try{$S=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const wM=$S;function TM(){}class SM extends bM{constructor(g){if(super(g),typeof location<"u"){const b=location.protocol==="https:";let S=location.port;S||(S=b?"443":"80"),this.xd=typeof location<"u"&&g.hostname!==location.hostname||S!==g.port}}doWrite(g,b){const S=this.request({method:"POST",data:g});S.on("success",b),S.on("error",(I,N)=>{this.onError("xhr post error",I,N)})}doPoll(){const g=this.request();g.on("data",this.onData.bind(this)),g.on("error",(b,S)=>{this.onError("xhr poll error",b,S)}),this.pollXhr=g}}let Lg=class By extends Ta{constructor(g,b,S){super(),this.createRequest=g,A1(this,S),this._opts=S,this._method=S.method||"GET",this._uri=b,this._data=S.data!==void 0?S.data:null,this._create()}_create(){var g;const b=qS(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");b.xdomain=!!this._opts.xd;const S=this._xhr=this.createRequest(b);try{S.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){S.setDisableHeaderCheck&&S.setDisableHeaderCheck(!0);for(let I in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(I)&&S.setRequestHeader(I,this._opts.extraHeaders[I])}}catch{}if(this._method==="POST")try{S.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{S.setRequestHeader("Accept","*/*")}catch{}(g=this._opts.cookieJar)===null||g===void 0||g.addCookies(S),"withCredentials"in S&&(S.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(S.timeout=this._opts.requestTimeout),S.onreadystatechange=()=>{var I;S.readyState===3&&((I=this._opts.cookieJar)===null||I===void 0||I.parseCookies(S.getResponseHeader("set-cookie"))),S.readyState===4&&(S.status===200||S.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof S.status=="number"?S.status:0)},0))},S.send(this._data)}catch(I){this.setTimeoutFn(()=>{this._onError(I)},0);return}typeof document<"u"&&(this._index=By.requestsCount++,By.requests[this._index]=this)}_onError(g){this.emitReserved("error",g,this._xhr),this._cleanup(!0)}_cleanup(g){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=TM,g)try{this._xhr.abort()}catch{}typeof document<"u"&&delete By.requests[this._index],this._xhr=null}}_onLoad(){const g=this._xhr.responseText;g!==null&&(this.emitReserved("data",g),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};Lg.requestsCount=0;Lg.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",A4);else if(typeof addEventListener=="function"){const h="onpagehide"in ru?"pagehide":"unload";addEventListener(h,A4,!1)}}function A4(){for(let h in Lg.requests)Lg.requests.hasOwnProperty(h)&&Lg.requests[h].abort()}const EM=function(){const h=ZS({xdomain:!1});return h&&h.responseType!==null}();class AM extends SM{constructor(g){super(g);const b=g&&g.forceBase64;this.supportsBinary=EM&&!b}request(g={}){return Object.assign(g,{xd:this.xd},this.opts),new Lg(ZS,this.uri(),g)}}function ZS(h){const g=h.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!g||wM))return new XMLHttpRequest}catch{}if(!g)try{return new ru[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const WS=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class CM extends Y2{get name(){return"websocket"}doOpen(){const g=this.uri(),b=this.opts.protocols,S=WS?{}:qS(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(S.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(g,b,S)}catch(I){return this.emitReserved("error",I)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=g=>this.onClose({description:"websocket connection closed",context:g}),this.ws.onmessage=g=>this.onData(g.data),this.ws.onerror=g=>this.onError("websocket error",g)}write(g){this.writable=!1;for(let b=0;b<g.length;b++){const S=g[b],I=b===g.length-1;W2(S,this.supportsBinary,N=>{try{this.doWrite(S,N)}catch{}I&&E1(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const g=this.opts.secure?"wss":"ws",b=this.query||{};return this.opts.timestampRequests&&(b[this.opts.timestampParam]=GS()),this.supportsBinary||(b.b64=1),this.createUri(g,b)}}const cv=ru.WebSocket||ru.MozWebSocket;class RM extends CM{createSocket(g,b,S){return WS?new cv(g,b,S):b?new cv(g,b):new cv(g)}doWrite(g,b){this.ws.send(b)}}class MM extends Y2{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(g){return this.emitReserved("error",g)}this._transport.closed.then(()=>{this.onClose()}).catch(g=>{this.onError("webtransport error",g)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(g=>{const b=uM(Number.MAX_SAFE_INTEGER,this.socket.binaryType),S=g.readable.pipeThrough(b).getReader(),I=cM();I.readable.pipeTo(g.writable),this._writer=I.writable.getWriter();const N=()=>{S.read().then(({done:s,value:q})=>{s||(this.onPacket(q),N())}).catch(s=>{})};N();const V={type:"open"};this.query.sid&&(V.data=`{"sid":"${this.query.sid}"}`),this._writer.write(V).then(()=>this.onOpen())})})}write(g){this.writable=!1;for(let b=0;b<g.length;b++){const S=g[b],I=b===g.length-1;this._writer.write(S).then(()=>{I&&E1(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var g;(g=this._transport)===null||g===void 0||g.close()}}const IM={websocket:RM,webtransport:MM,polling:AM},zM=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,DM=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function u2(h){if(h.length>8e3)throw"URI too long";const g=h,b=h.indexOf("["),S=h.indexOf("]");b!=-1&&S!=-1&&(h=h.substring(0,b)+h.substring(b,S).replace(/:/g,";")+h.substring(S,h.length));let I=zM.exec(h||""),N={},V=14;for(;V--;)N[DM[V]]=I[V]||"";return b!=-1&&S!=-1&&(N.source=g,N.host=N.host.substring(1,N.host.length-1).replace(/;/g,":"),N.authority=N.authority.replace("[","").replace("]","").replace(/;/g,":"),N.ipv6uri=!0),N.pathNames=PM(N,N.path),N.queryKey=LM(N,N.query),N}function PM(h,g){const b=/\/{2,9}/g,S=g.replace(b,"/").split("/");return(g.slice(0,1)=="/"||g.length===0)&&S.splice(0,1),g.slice(-1)=="/"&&S.splice(S.length-1,1),S}function LM(h,g){const b={};return g.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(S,I,N){I&&(b[I]=N)}),b}const h2=typeof addEventListener=="function"&&typeof removeEventListener=="function",Fy=[];h2&&addEventListener("offline",()=>{Fy.forEach(h=>h())},!1);class _p extends Ta{constructor(g,b){if(super(),this.binaryType=dM,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,g&&typeof g=="object"&&(b=g,g=null),g){const S=u2(g);b.hostname=S.host,b.secure=S.protocol==="https"||S.protocol==="wss",b.port=S.port,S.query&&(b.query=S.query)}else b.host&&(b.hostname=u2(b.host).host);A1(this,b),this.secure=b.secure!=null?b.secure:typeof location<"u"&&location.protocol==="https:",b.hostname&&!b.port&&(b.port=this.secure?"443":"80"),this.hostname=b.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=b.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},b.transports.forEach(S=>{const I=S.prototype.name;this.transports.push(I),this._transportsByName[I]=S}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},b),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=xM(this.opts.query)),h2&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Fy.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(g){const b=Object.assign({},this.opts.query);b.EIO=HS,b.transport=g,this.id&&(b.sid=this.id);const S=Object.assign({},this.opts,{query:b,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[g]);return new this._transportsByName[g](S)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const g=this.opts.rememberUpgrade&&_p.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const b=this.createTransport(g);b.open(),this.setTransport(b)}setTransport(g){this.transport&&this.transport.removeAllListeners(),this.transport=g,g.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",b=>this._onClose("transport close",b))}onOpen(){this.readyState="open",_p.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(g){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",g),this.emitReserved("heartbeat"),g.type){case"open":this.onHandshake(JSON.parse(g.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const b=new Error("server error");b.code=g.data,this._onError(b);break;case"message":this.emitReserved("data",g.data),this.emitReserved("message",g.data);break}}onHandshake(g){this.emitReserved("handshake",g),this.id=g.sid,this.transport.query.sid=g.sid,this._pingInterval=g.pingInterval,this._pingTimeout=g.pingTimeout,this._maxPayload=g.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const g=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+g,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},g),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const g=this._getWritablePackets();this.transport.send(g),this._prevBufferLen=g.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let b=1;for(let S=0;S<this.writeBuffer.length;S++){const I=this.writeBuffer[S].data;if(I&&(b+=gM(I)),S>0&&b>this._maxPayload)return this.writeBuffer.slice(0,S);b+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const g=Date.now()>this._pingTimeoutTime;return g&&(this._pingTimeoutTime=0,E1(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),g}write(g,b,S){return this._sendPacket("message",g,b,S),this}send(g,b,S){return this._sendPacket("message",g,b,S),this}_sendPacket(g,b,S,I){if(typeof b=="function"&&(I=b,b=void 0),typeof S=="function"&&(I=S,S=null),this.readyState==="closing"||this.readyState==="closed")return;S=S||{},S.compress=S.compress!==!1;const N={type:g,data:b,options:S};this.emitReserved("packetCreate",N),this.writeBuffer.push(N),I&&this.once("flush",I),this.flush()}close(){const g=()=>{this._onClose("forced close"),this.transport.close()},b=()=>{this.off("upgrade",b),this.off("upgradeError",b),g()},S=()=>{this.once("upgrade",b),this.once("upgradeError",b)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?S():g()}):this.upgrading?S():g()),this}_onError(g){if(_p.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",g),this._onClose("transport error",g)}_onClose(g,b){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),h2&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const S=Fy.indexOf(this._offlineEventListener);S!==-1&&Fy.splice(S,1)}this.readyState="closed",this.id=null,this.emitReserved("close",g,b),this.writeBuffer=[],this._prevBufferLen=0}}}_p.protocol=HS;class OM extends _p{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let g=0;g<this._upgrades.length;g++)this._probe(this._upgrades[g])}_probe(g){let b=this.createTransport(g),S=!1;_p.priorWebsocketSuccess=!1;const I=()=>{S||(b.send([{type:"ping",data:"probe"}]),b.once("packet",oe=>{if(!S)if(oe.type==="pong"&&oe.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",b),!b)return;_p.priorWebsocketSuccess=b.name==="websocket",this.transport.pause(()=>{S||this.readyState!=="closed"&&(Q(),this.setTransport(b),b.send([{type:"upgrade"}]),this.emitReserved("upgrade",b),b=null,this.upgrading=!1,this.flush())})}else{const pe=new Error("probe error");pe.transport=b.name,this.emitReserved("upgradeError",pe)}}))};function N(){S||(S=!0,Q(),b.close(),b=null)}const V=oe=>{const pe=new Error("probe error: "+oe);pe.transport=b.name,N(),this.emitReserved("upgradeError",pe)};function s(){V("transport closed")}function q(){V("socket closed")}function Z(oe){b&&oe.name!==b.name&&N()}const Q=()=>{b.removeListener("open",I),b.removeListener("error",V),b.removeListener("close",s),this.off("close",q),this.off("upgrading",Z)};b.once("open",I),b.once("error",V),b.once("close",s),this.once("close",q),this.once("upgrading",Z),this._upgrades.indexOf("webtransport")!==-1&&g!=="webtransport"?this.setTimeoutFn(()=>{S||b.open()},200):b.open()}onHandshake(g){this._upgrades=this._filterUpgrades(g.upgrades),super.onHandshake(g)}_filterUpgrades(g){const b=[];for(let S=0;S<g.length;S++)~this.transports.indexOf(g[S])&&b.push(g[S]);return b}}let kM=class extends OM{constructor(g,b={}){const S=typeof g=="object"?g:b;(!S.transports||S.transports&&typeof S.transports[0]=="string")&&(S.transports=(S.transports||["polling","websocket","webtransport"]).map(I=>IM[I]).filter(I=>!!I)),super(g,S)}};function NM(h,g="",b){let S=h;b=b||typeof location<"u"&&location,h==null&&(h=b.protocol+"//"+b.host),typeof h=="string"&&(h.charAt(0)==="/"&&(h.charAt(1)==="/"?h=b.protocol+h:h=b.host+h),/^(https?|wss?):\/\//.test(h)||(typeof b<"u"?h=b.protocol+"//"+h:h="https://"+h),S=u2(h)),S.port||(/^(http|ws)$/.test(S.protocol)?S.port="80":/^(http|ws)s$/.test(S.protocol)&&(S.port="443")),S.path=S.path||"/";const N=S.host.indexOf(":")!==-1?"["+S.host+"]":S.host;return S.id=S.protocol+"://"+N+":"+S.port+g,S.href=S.protocol+"://"+N+(b&&b.port===S.port?"":":"+S.port),S}const jM=typeof ArrayBuffer=="function",BM=h=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(h):h.buffer instanceof ArrayBuffer,XS=Object.prototype.toString,FM=typeof Blob=="function"||typeof Blob<"u"&&XS.call(Blob)==="[object BlobConstructor]",UM=typeof File=="function"||typeof File<"u"&&XS.call(File)==="[object FileConstructor]";function K2(h){return jM&&(h instanceof ArrayBuffer||BM(h))||FM&&h instanceof Blob||UM&&h instanceof File}function Uy(h,g){if(!h||typeof h!="object")return!1;if(Array.isArray(h)){for(let b=0,S=h.length;b<S;b++)if(Uy(h[b]))return!0;return!1}if(K2(h))return!0;if(h.toJSON&&typeof h.toJSON=="function"&&arguments.length===1)return Uy(h.toJSON(),!0);for(const b in h)if(Object.prototype.hasOwnProperty.call(h,b)&&Uy(h[b]))return!0;return!1}function VM(h){const g=[],b=h.data,S=h;return S.data=d2(b,g),S.attachments=g.length,{packet:S,buffers:g}}function d2(h,g){if(!h)return h;if(K2(h)){const b={_placeholder:!0,num:g.length};return g.push(h),b}else if(Array.isArray(h)){const b=new Array(h.length);for(let S=0;S<h.length;S++)b[S]=d2(h[S],g);return b}else if(typeof h=="object"&&!(h instanceof Date)){const b={};for(const S in h)Object.prototype.hasOwnProperty.call(h,S)&&(b[S]=d2(h[S],g));return b}return h}function HM(h,g){return h.data=f2(h.data,g),delete h.attachments,h}function f2(h,g){if(!h)return h;if(h&&h._placeholder===!0){if(typeof h.num=="number"&&h.num>=0&&h.num<g.length)return g[h.num];throw new Error("illegal attachments")}else if(Array.isArray(h))for(let b=0;b<h.length;b++)h[b]=f2(h[b],g);else if(typeof h=="object")for(const b in h)Object.prototype.hasOwnProperty.call(h,b)&&(h[b]=f2(h[b],g));return h}const qM=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],GM=5;var Lr;(function(h){h[h.CONNECT=0]="CONNECT",h[h.DISCONNECT=1]="DISCONNECT",h[h.EVENT=2]="EVENT",h[h.ACK=3]="ACK",h[h.CONNECT_ERROR=4]="CONNECT_ERROR",h[h.BINARY_EVENT=5]="BINARY_EVENT",h[h.BINARY_ACK=6]="BINARY_ACK"})(Lr||(Lr={}));class $M{constructor(g){this.replacer=g}encode(g){return(g.type===Lr.EVENT||g.type===Lr.ACK)&&Uy(g)?this.encodeAsBinary({type:g.type===Lr.EVENT?Lr.BINARY_EVENT:Lr.BINARY_ACK,nsp:g.nsp,data:g.data,id:g.id}):[this.encodeAsString(g)]}encodeAsString(g){let b=""+g.type;return(g.type===Lr.BINARY_EVENT||g.type===Lr.BINARY_ACK)&&(b+=g.attachments+"-"),g.nsp&&g.nsp!=="/"&&(b+=g.nsp+","),g.id!=null&&(b+=g.id),g.data!=null&&(b+=JSON.stringify(g.data,this.replacer)),b}encodeAsBinary(g){const b=VM(g),S=this.encodeAsString(b.packet),I=b.buffers;return I.unshift(S),I}}function C4(h){return Object.prototype.toString.call(h)==="[object Object]"}class J2 extends Ta{constructor(g){super(),this.reviver=g}add(g){let b;if(typeof g=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");b=this.decodeString(g);const S=b.type===Lr.BINARY_EVENT;S||b.type===Lr.BINARY_ACK?(b.type=S?Lr.EVENT:Lr.ACK,this.reconstructor=new ZM(b),b.attachments===0&&super.emitReserved("decoded",b)):super.emitReserved("decoded",b)}else if(K2(g)||g.base64)if(this.reconstructor)b=this.reconstructor.takeBinaryData(g),b&&(this.reconstructor=null,super.emitReserved("decoded",b));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+g)}decodeString(g){let b=0;const S={type:Number(g.charAt(0))};if(Lr[S.type]===void 0)throw new Error("unknown packet type "+S.type);if(S.type===Lr.BINARY_EVENT||S.type===Lr.BINARY_ACK){const N=b+1;for(;g.charAt(++b)!=="-"&&b!=g.length;);const V=g.substring(N,b);if(V!=Number(V)||g.charAt(b)!=="-")throw new Error("Illegal attachments");S.attachments=Number(V)}if(g.charAt(b+1)==="/"){const N=b+1;for(;++b&&!(g.charAt(b)===","||b===g.length););S.nsp=g.substring(N,b)}else S.nsp="/";const I=g.charAt(b+1);if(I!==""&&Number(I)==I){const N=b+1;for(;++b;){const V=g.charAt(b);if(V==null||Number(V)!=V){--b;break}if(b===g.length)break}S.id=Number(g.substring(N,b+1))}if(g.charAt(++b)){const N=this.tryParse(g.substr(b));if(J2.isPayloadValid(S.type,N))S.data=N;else throw new Error("invalid payload")}return S}tryParse(g){try{return JSON.parse(g,this.reviver)}catch{return!1}}static isPayloadValid(g,b){switch(g){case Lr.CONNECT:return C4(b);case Lr.DISCONNECT:return b===void 0;case Lr.CONNECT_ERROR:return typeof b=="string"||C4(b);case Lr.EVENT:case Lr.BINARY_EVENT:return Array.isArray(b)&&(typeof b[0]=="number"||typeof b[0]=="string"&&qM.indexOf(b[0])===-1);case Lr.ACK:case Lr.BINARY_ACK:return Array.isArray(b)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class ZM{constructor(g){this.packet=g,this.buffers=[],this.reconPack=g}takeBinaryData(g){if(this.buffers.push(g),this.buffers.length===this.reconPack.attachments){const b=HM(this.reconPack,this.buffers);return this.finishedReconstruction(),b}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const WM=Object.freeze(Object.defineProperty({__proto__:null,Decoder:J2,Encoder:$M,get PacketType(){return Lr},protocol:GM},Symbol.toStringTag,{value:"Module"}));function ih(h,g,b){return h.on(g,b),function(){h.off(g,b)}}const XM=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class YS extends Ta{constructor(g,b,S){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=g,this.nsp=b,S&&S.auth&&(this.auth=S.auth),this._opts=Object.assign({},S),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const g=this.io;this.subs=[ih(g,"open",this.onopen.bind(this)),ih(g,"packet",this.onpacket.bind(this)),ih(g,"error",this.onerror.bind(this)),ih(g,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...g){return g.unshift("message"),this.emit.apply(this,g),this}emit(g,...b){var S,I,N;if(XM.hasOwnProperty(g))throw new Error('"'+g.toString()+'" is a reserved event name');if(b.unshift(g),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(b),this;const V={type:Lr.EVENT,data:b};if(V.options={},V.options.compress=this.flags.compress!==!1,typeof b[b.length-1]=="function"){const Q=this.ids++,oe=b.pop();this._registerAckCallback(Q,oe),V.id=Q}const s=(I=(S=this.io.engine)===null||S===void 0?void 0:S.transport)===null||I===void 0?void 0:I.writable,q=this.connected&&!(!((N=this.io.engine)===null||N===void 0)&&N._hasPingExpired());return this.flags.volatile&&!s||(q?(this.notifyOutgoingListeners(V),this.packet(V)):this.sendBuffer.push(V)),this.flags={},this}_registerAckCallback(g,b){var S;const I=(S=this.flags.timeout)!==null&&S!==void 0?S:this._opts.ackTimeout;if(I===void 0){this.acks[g]=b;return}const N=this.io.setTimeoutFn(()=>{delete this.acks[g];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===g&&this.sendBuffer.splice(s,1);b.call(this,new Error("operation has timed out"))},I),V=(...s)=>{this.io.clearTimeoutFn(N),b.apply(this,s)};V.withError=!0,this.acks[g]=V}emitWithAck(g,...b){return new Promise((S,I)=>{const N=(V,s)=>V?I(V):S(s);N.withError=!0,b.push(N),this.emit(g,...b)})}_addToQueue(g){let b;typeof g[g.length-1]=="function"&&(b=g.pop());const S={id:this._queueSeq++,tryCount:0,pending:!1,args:g,flags:Object.assign({fromQueue:!0},this.flags)};g.push((I,...N)=>S!==this._queue[0]?void 0:(I!==null?S.tryCount>this._opts.retries&&(this._queue.shift(),b&&b(I)):(this._queue.shift(),b&&b(null,...N)),S.pending=!1,this._drainQueue())),this._queue.push(S),this._drainQueue()}_drainQueue(g=!1){if(!this.connected||this._queue.length===0)return;const b=this._queue[0];b.pending&&!g||(b.pending=!0,b.tryCount++,this.flags=b.flags,this.emit.apply(this,b.args))}packet(g){g.nsp=this.nsp,this.io._packet(g)}onopen(){typeof this.auth=="function"?this.auth(g=>{this._sendConnectPacket(g)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(g){this.packet({type:Lr.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},g):g})}onerror(g){this.connected||this.emitReserved("connect_error",g)}onclose(g,b){this.connected=!1,delete this.id,this.emitReserved("disconnect",g,b),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(g=>{if(!this.sendBuffer.some(S=>String(S.id)===g)){const S=this.acks[g];delete this.acks[g],S.withError&&S.call(this,new Error("socket has been disconnected"))}})}onpacket(g){if(g.nsp===this.nsp)switch(g.type){case Lr.CONNECT:g.data&&g.data.sid?this.onconnect(g.data.sid,g.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Lr.EVENT:case Lr.BINARY_EVENT:this.onevent(g);break;case Lr.ACK:case Lr.BINARY_ACK:this.onack(g);break;case Lr.DISCONNECT:this.ondisconnect();break;case Lr.CONNECT_ERROR:this.destroy();const S=new Error(g.data.message);S.data=g.data.data,this.emitReserved("connect_error",S);break}}onevent(g){const b=g.data||[];g.id!=null&&b.push(this.ack(g.id)),this.connected?this.emitEvent(b):this.receiveBuffer.push(Object.freeze(b))}emitEvent(g){if(this._anyListeners&&this._anyListeners.length){const b=this._anyListeners.slice();for(const S of b)S.apply(this,g)}super.emit.apply(this,g),this._pid&&g.length&&typeof g[g.length-1]=="string"&&(this._lastOffset=g[g.length-1])}ack(g){const b=this;let S=!1;return function(...I){S||(S=!0,b.packet({type:Lr.ACK,id:g,data:I}))}}onack(g){const b=this.acks[g.id];typeof b=="function"&&(delete this.acks[g.id],b.withError&&g.data.unshift(null),b.apply(this,g.data))}onconnect(g,b){this.id=g,this.recovered=b&&this._pid===b,this._pid=b,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(g=>this.emitEvent(g)),this.receiveBuffer=[],this.sendBuffer.forEach(g=>{this.notifyOutgoingListeners(g),this.packet(g)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(g=>g()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Lr.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(g){return this.flags.compress=g,this}get volatile(){return this.flags.volatile=!0,this}timeout(g){return this.flags.timeout=g,this}onAny(g){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(g),this}prependAny(g){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(g),this}offAny(g){if(!this._anyListeners)return this;if(g){const b=this._anyListeners;for(let S=0;S<b.length;S++)if(g===b[S])return b.splice(S,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(g){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(g),this}prependAnyOutgoing(g){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(g),this}offAnyOutgoing(g){if(!this._anyOutgoingListeners)return this;if(g){const b=this._anyOutgoingListeners;for(let S=0;S<b.length;S++)if(g===b[S])return b.splice(S,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(g){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const b=this._anyOutgoingListeners.slice();for(const S of b)S.apply(this,g.data)}}}function qg(h){h=h||{},this.ms=h.min||100,this.max=h.max||1e4,this.factor=h.factor||2,this.jitter=h.jitter>0&&h.jitter<=1?h.jitter:0,this.attempts=0}qg.prototype.duration=function(){var h=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var g=Math.random(),b=Math.floor(g*this.jitter*h);h=(Math.floor(g*10)&1)==0?h-b:h+b}return Math.min(h,this.max)|0};qg.prototype.reset=function(){this.attempts=0};qg.prototype.setMin=function(h){this.ms=h};qg.prototype.setMax=function(h){this.max=h};qg.prototype.setJitter=function(h){this.jitter=h};class p2 extends Ta{constructor(g,b){var S;super(),this.nsps={},this.subs=[],g&&typeof g=="object"&&(b=g,g=void 0),b=b||{},b.path=b.path||"/socket.io",this.opts=b,A1(this,b),this.reconnection(b.reconnection!==!1),this.reconnectionAttempts(b.reconnectionAttempts||1/0),this.reconnectionDelay(b.reconnectionDelay||1e3),this.reconnectionDelayMax(b.reconnectionDelayMax||5e3),this.randomizationFactor((S=b.randomizationFactor)!==null&&S!==void 0?S:.5),this.backoff=new qg({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(b.timeout==null?2e4:b.timeout),this._readyState="closed",this.uri=g;const I=b.parser||WM;this.encoder=new I.Encoder,this.decoder=new I.Decoder,this._autoConnect=b.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(g){return arguments.length?(this._reconnection=!!g,g||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(g){return g===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=g,this)}reconnectionDelay(g){var b;return g===void 0?this._reconnectionDelay:(this._reconnectionDelay=g,(b=this.backoff)===null||b===void 0||b.setMin(g),this)}randomizationFactor(g){var b;return g===void 0?this._randomizationFactor:(this._randomizationFactor=g,(b=this.backoff)===null||b===void 0||b.setJitter(g),this)}reconnectionDelayMax(g){var b;return g===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=g,(b=this.backoff)===null||b===void 0||b.setMax(g),this)}timeout(g){return arguments.length?(this._timeout=g,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(g){if(~this._readyState.indexOf("open"))return this;this.engine=new kM(this.uri,this.opts);const b=this.engine,S=this;this._readyState="opening",this.skipReconnect=!1;const I=ih(b,"open",function(){S.onopen(),g&&g()}),N=s=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",s),g?g(s):this.maybeReconnectOnOpen()},V=ih(b,"error",N);if(this._timeout!==!1){const s=this._timeout,q=this.setTimeoutFn(()=>{I(),N(new Error("timeout")),b.close()},s);this.opts.autoUnref&&q.unref(),this.subs.push(()=>{this.clearTimeoutFn(q)})}return this.subs.push(I),this.subs.push(V),this}connect(g){return this.open(g)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const g=this.engine;this.subs.push(ih(g,"ping",this.onping.bind(this)),ih(g,"data",this.ondata.bind(this)),ih(g,"error",this.onerror.bind(this)),ih(g,"close",this.onclose.bind(this)),ih(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(g){try{this.decoder.add(g)}catch(b){this.onclose("parse error",b)}}ondecoded(g){E1(()=>{this.emitReserved("packet",g)},this.setTimeoutFn)}onerror(g){this.emitReserved("error",g)}socket(g,b){let S=this.nsps[g];return S?this._autoConnect&&!S.active&&S.connect():(S=new YS(this,g,b),this.nsps[g]=S),S}_destroy(g){const b=Object.keys(this.nsps);for(const S of b)if(this.nsps[S].active)return;this._close()}_packet(g){const b=this.encoder.encode(g);for(let S=0;S<b.length;S++)this.engine.write(b[S],g.options)}cleanup(){this.subs.forEach(g=>g()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(g,b){var S;this.cleanup(),(S=this.engine)===null||S===void 0||S.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",g,b),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const g=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const b=this.backoff.duration();this._reconnecting=!0;const S=this.setTimeoutFn(()=>{g.skipReconnect||(this.emitReserved("reconnect_attempt",g.backoff.attempts),!g.skipReconnect&&g.open(I=>{I?(g._reconnecting=!1,g.reconnect(),this.emitReserved("reconnect_error",I)):g.onreconnect()}))},b);this.opts.autoUnref&&S.unref(),this.subs.push(()=>{this.clearTimeoutFn(S)})}}onreconnect(){const g=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",g)}}const X_={};function r0(h,g){typeof h=="object"&&(g=h,h=void 0),g=g||{};const b=NM(h,g.path||"/socket.io"),S=b.source,I=b.id,N=b.path,V=X_[I]&&N in X_[I].nsps,s=g.forceNew||g["force new connection"]||g.multiplex===!1||V;let q;return s?q=new p2(S,g):(X_[I]||(X_[I]=new p2(S,g)),q=X_[I]),b.query&&!g.query&&(g.query=b.queryKey),q.socket(b.path,g)}Object.assign(r0,{Manager:p2,Socket:YS,io:r0,connect:r0});const YM="https://urbansetu.onrender.com",KS=async()=>{try{const h=await fetch(`${YM}/api/auth/csrf-token`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!h.ok){const S=await h.text();throw console.error("CSRF token fetch failed:",h.status,S),new Error(`Failed to fetch CSRF token: ${h.status}`)}const g=h.headers.get("content-type");if(!g||!g.includes("application/json")){const S=await h.text();throw console.error("CSRF token response is not JSON:",S),new Error("Server returned non-JSON response")}const b=await h.json();if(!b.csrfToken)throw new Error("No CSRF token received from server");return b.csrfToken}catch(h){throw console.error("Error fetching CSRF token:",h),h}},KM=async()=>await KS(),JM=async(h={})=>{try{const g=await KM();return{...h,headers:{"Content-Type":"application/json","X-CSRF-Token":g,...h.headers},credentials:"include"}}catch(g){console.error("Error creating authenticated fetch options:",g);try{const b=await KS();return{...h,headers:{"Content-Type":"application/json","X-CSRF-Token":b,...h.headers},credentials:"include"}}catch(b){return console.error("Retry failed for CSRF token:",b),{...h,headers:{"Content-Type":"application/json",...h.headers},credentials:"include"}}}},Q2=async(h,g={})=>{try{const b=await JM(g),S=await fetch(h,b);if(!S.ok){const I=S.clone();let N=null;try{const V=S.headers.get("content-type");V&&V.includes("application/json")?N=await I.json():N={message:await I.text()}}catch{try{N={message:await I.text()}}catch{N={message:`HTTP ${S.status}`}}}console.error(`${S.status} response:`,N)}return S}catch(b){throw console.error("Authenticated fetch error:",b),b}},QM=()=>{var h;try{document.cookie="test_cookie=1; path=/; SameSite=None; Secure";const g=(h=document.cookie.split("; ").find(b=>b.startsWith("test_cookie=")))==null?void 0:h.split("=")[1];return document.cookie="test_cookie=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=None; Secure",g==="1"}catch(g){return console.warn("Cookie test failed:",g),!1}},JS=()=>{var g;const h=(g=document.cookie.split("; ").find(b=>b.startsWith("access_token=")))==null?void 0:g.split("=")[1];return h||localStorage.getItem("accessToken")},yk=(h={})=>{const g=JS(),b=QM(),S={credentials:"include",...h};return(!b||!document.cookie.includes("access_token="))&&g&&(S.headers={...S.headers,Authorization:`Bearer ${g}`}),S},xk=async(h,g={})=>Q2(h,g),QS="https://urbansetu.onrender.com";function e6(){const h=JS();return h||console.log("[Socket] getToken: not found"),h}let fn=r0(QS,{auth:{token:e6()},withCredentials:!0,transports:["websocket"]});function eI(){const h=document.cookie.split("; ").find(g=>g.startsWith("session_id="));return h?decodeURIComponent(h.split("=")[1]):null}function t6(){const h=eI();h&&fn&&fn.connected&&fn.emit("registerSession",{sessionId:h})}fn.on("connect",()=>{console.log("[Socket] Connected to server"),t6()});fn.on("disconnect",()=>{console.log("[Socket] Disconnected from server")});fn.on("connect_error",h=>{console.log("[Socket] Connection error:",h)});fn.on("forceLogout",({reason:h})=>{console.log("[Socket] Force logout received:",h);try{localStorage.removeItem("accessToken")}catch{}document.cookie="access_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="refresh_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="session_id=; Max-Age=0; path=/; SameSite=None; Secure",window.location.href="/sign-in?error=forced_logout"});function Dm(){fn&&fn.connected&&fn.disconnect();const h=e6();h&&console.log("[Socket] reconnecting with token"),fn=r0(QS,{auth:{token:h},withCredentials:!0,transports:["websocket"]}),fn.on("connect",()=>{h&&console.log("[Socket] Reconnected to server"),t6()}),fn.on("disconnect",()=>{console.log("[Socket] Disconnected from server")}),fn.on("connect_error",g=>{console.log("[Socket] Connection error:",g)}),fn.on("forceLogout",({reason:g})=>{console.log("[Socket] Force logout received:",g);try{localStorage.removeItem("accessToken")}catch{}document.cookie="access_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="refresh_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="session_id=; Max-Age=0; path=/; SameSite=None; Secure",window.location.href="/sign-in?error=forced_logout"})}var i6={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},R4=Fr.createContext&&Fr.createContext(i6),tI=["attr","size","title"];function iI(h,g){if(h==null)return{};var b=nI(h,g),S,I;if(Object.getOwnPropertySymbols){var N=Object.getOwnPropertySymbols(h);for(I=0;I<N.length;I++)S=N[I],!(g.indexOf(S)>=0)&&Object.prototype.propertyIsEnumerable.call(h,S)&&(b[S]=h[S])}return b}function nI(h,g){if(h==null)return{};var b={};for(var S in h)if(Object.prototype.hasOwnProperty.call(h,S)){if(g.indexOf(S)>=0)continue;b[S]=h[S]}return b}function l1(){return l1=Object.assign?Object.assign.bind():function(h){for(var g=1;g<arguments.length;g++){var b=arguments[g];for(var S in b)Object.prototype.hasOwnProperty.call(b,S)&&(h[S]=b[S])}return h},l1.apply(this,arguments)}function M4(h,g){var b=Object.keys(h);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(h);g&&(S=S.filter(function(I){return Object.getOwnPropertyDescriptor(h,I).enumerable})),b.push.apply(b,S)}return b}function c1(h){for(var g=1;g<arguments.length;g++){var b=arguments[g]!=null?arguments[g]:{};g%2?M4(Object(b),!0).forEach(function(S){rI(h,S,b[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(b)):M4(Object(b)).forEach(function(S){Object.defineProperty(h,S,Object.getOwnPropertyDescriptor(b,S))})}return h}function rI(h,g,b){return g=sI(g),g in h?Object.defineProperty(h,g,{value:b,enumerable:!0,configurable:!0,writable:!0}):h[g]=b,h}function sI(h){var g=aI(h,"string");return typeof g=="symbol"?g:g+""}function aI(h,g){if(typeof h!="object"||!h)return h;var b=h[Symbol.toPrimitive];if(b!==void 0){var S=b.call(h,g);if(typeof S!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(h)}function n6(h){return h&&h.map((g,b)=>Fr.createElement(g.tag,c1({key:b},g.attr),n6(g.child)))}function Gt(h){return g=>Fr.createElement(oI,l1({attr:c1({},h.attr)},g),n6(h.child))}function oI(h){var g=b=>{var{attr:S,size:I,title:N}=h,V=iI(h,tI),s=I||b.size||"1em",q;return b.className&&(q=b.className),h.className&&(q=(q?q+" ":"")+h.className),Fr.createElement("svg",l1({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},b.attr,S,V,{className:q,style:c1(c1({color:h.color||b.color},b.style),h.style),height:s,width:s,xmlns:"http://www.w3.org/2000/svg"}),N&&Fr.createElement("title",null,N),h.children)};return R4!==void 0?Fr.createElement(R4.Consumer,null,b=>g(b)):g(i6)}function vk(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M420.55,301.93a24,24,0,1,1,24-24,24,24,0,0,1-24,24m-265.1,0a24,24,0,1,1,24-24,24,24,0,0,1-24,24m273.7-144.48,47.94-83a10,10,0,1,0-17.27-10h0l-48.54,84.07a301.25,301.25,0,0,0-246.56,0L116.18,64.45a10,10,0,1,0-17.27,10h0l47.94,83C64.53,202.22,8.24,285.55,0,384H576c-8.24-98.45-64.54-181.78-146.85-226.55"},child:[]}]})(h)}function bk(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z"},child:[]}]})(h)}function wk(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"},child:[]}]})(h)}function Tk(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"},child:[]}]})(h)}function Sk(h){return Gt({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"},child:[]}]})(h)}function Ek(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"},child:[]}]})(h)}function Ak(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"},child:[]}]})(h)}function Ck(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"},child:[]}]})(h)}function Rk(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M32 448c0 17.7 14.3 32 32 32h384c17.7 0 32-14.3 32-32V160H32v288zm160-212c0-6.6 5.4-12 12-12h104c6.6 0 12 5.4 12 12v8c0 6.6-5.4 12-12 12H204c-6.6 0-12-5.4-12-12v-8zM480 32H32C14.3 32 0 46.3 0 64v48c0 8.8 7.2 16 16 16h480c8.8 0 16-7.2 16-16V64c0-17.7-14.3-32-32-32z"},child:[]}]})(h)}function lI(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M413.1 222.5l22.2 22.2c9.4 9.4 9.4 24.6 0 33.9L241 473c-9.4 9.4-24.6 9.4-33.9 0L12.7 278.6c-9.4-9.4-9.4-24.6 0-33.9l22.2-22.2c9.5-9.5 25-9.3 34.3.4L184 343.4V56c0-13.3 10.7-24 24-24h32c13.3 0 24 10.7 24 24v287.4l114.8-120.5c9.3-9.8 24.8-10 34.3-.4z"},child:[]}]})(h)}function Mk(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"},child:[]}]})(h)}function Ik(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"},child:[]}]})(h)}function zk(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M97.12 362.63c-8.69-8.69-4.16-6.24-25.12-11.85-9.51-2.55-17.87-7.45-25.43-13.32L1.2 448.7c-4.39 10.77 3.81 22.47 15.43 22.03l52.69-2.01L105.56 507c8 8.44 22.04 5.81 26.43-4.96l52.05-127.62c-10.84 6.04-22.87 9.58-35.31 9.58-19.5 0-37.82-7.59-51.61-21.37zM382.8 448.7l-45.37-111.24c-7.56 5.88-15.92 10.77-25.43 13.32-21.07 5.64-16.45 3.18-25.12 11.85-13.79 13.78-32.12 21.37-51.62 21.37-12.44 0-24.47-3.55-35.31-9.58L252 502.04c4.39 10.77 18.44 13.4 26.43 4.96l36.25-38.28 52.69 2.01c11.62.44 19.82-11.27 15.43-22.03zM263 340c15.28-15.55 17.03-14.21 38.79-20.14 13.89-3.79 24.75-14.84 28.47-28.98 7.48-28.4 5.54-24.97 25.95-45.75 10.17-10.35 14.14-25.44 10.42-39.58-7.47-28.38-7.48-24.42 0-52.83 3.72-14.14-.25-29.23-10.42-39.58-20.41-20.78-18.47-17.36-25.95-45.75-3.72-14.14-14.58-25.19-28.47-28.98-27.88-7.61-24.52-5.62-44.95-26.41-10.17-10.35-25-14.4-38.89-10.61-27.87 7.6-23.98 7.61-51.9 0-13.89-3.79-28.72.25-38.89 10.61-20.41 20.78-17.05 18.8-44.94 26.41-13.89 3.79-24.75 14.84-28.47 28.98-7.47 28.39-5.54 24.97-25.95 45.75-10.17 10.35-14.15 25.44-10.42 39.58 7.47 28.36 7.48 24.4 0 52.82-3.72 14.14.25 29.23 10.42 39.59 20.41 20.78 18.47 17.35 25.95 45.75 3.72 14.14 14.58 25.19 28.47 28.98C104.6 325.96 106.27 325 121 340c13.23 13.47 33.84 15.88 49.74 5.82a39.676 39.676 0 0 1 42.53 0c15.89 10.06 36.5 7.65 49.73-5.82zM97.66 175.96c0-53.03 42.24-96.02 94.34-96.02s94.34 42.99 94.34 96.02-42.24 96.02-94.34 96.02-94.34-42.99-94.34-96.02z"},child:[]}]})(h)}function I4(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"},child:[]}]})(h)}function r6(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"},child:[]}]})(h)}function Dk(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M32,384a95.4,95.4,0,0,0,32,71.09V496a16,16,0,0,0,16,16h32a16,16,0,0,0,16-16V480H384v16a16,16,0,0,0,16,16h32a16,16,0,0,0,16-16V455.09A95.4,95.4,0,0,0,480,384V336H32ZM496,256H80V69.25a21.26,21.26,0,0,1,36.28-15l19.27,19.26c-13.13,29.88-7.61,59.11,8.62,79.73l-.17.17A16,16,0,0,0,144,176l11.31,11.31a16,16,0,0,0,22.63,0L283.31,81.94a16,16,0,0,0,0-22.63L272,48a16,16,0,0,0-22.62,0l-.17.17c-20.62-16.23-49.83-21.75-79.73-8.62L150.22,20.28A69.25,69.25,0,0,0,32,69.25V256H16A16,16,0,0,0,0,272v16a16,16,0,0,0,16,16H496a16,16,0,0,0,16-16V272A16,16,0,0,0,496,256Z"},child:[]}]})(h)}function Pk(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M176 256c44.11 0 80-35.89 80-80s-35.89-80-80-80-80 35.89-80 80 35.89 80 80 80zm352-128H304c-8.84 0-16 7.16-16 16v144H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v352c0 8.84 7.16 16 16 16h32c8.84 0 16-7.16 16-16v-48h512v48c0 8.84 7.16 16 16 16h32c8.84 0 16-7.16 16-16V240c0-61.86-50.14-112-112-112z"},child:[]}]})(h)}function bm(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 512c35.32 0 63.97-28.65 63.97-64H160.03c0 35.35 28.65 64 63.97 64zm215.39-149.71c-19.32-20.76-55.47-51.99-55.47-154.29 0-77.7-54.48-139.9-127.94-155.16V32c0-17.67-14.32-32-31.98-32s-31.98 14.33-31.98 32v20.84C118.56 68.1 64.08 130.3 64.08 208c0 102.3-36.15 133.53-55.47 154.29-6 6.45-8.66 14.16-8.61 21.71.11 16.4 12.98 32 32.1 32h383.8c19.12 0 32-15.6 32.1-32 .05-7.55-2.61-15.27-8.61-21.71z"},child:[]}]})(h)}function Lk(h){return Gt({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M296 160H180.6l42.6-129.8C227.2 15 215.7 0 200 0H56C44 0 33.8 8.9 32.2 20.8l-32 240C-1.7 275.2 9.5 288 24 288h118.7L96.6 482.5c-3.6 15.2 8 29.5 23.3 29.5 8.4 0 16.4-4.4 20.8-12l176-304c9.3-15.9-2.2-36-20.7-36z"},child:[]}]})(h)}function Ok(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 512V48C0 21.49 21.49 0 48 0h288c26.51 0 48 21.49 48 48v464L192 400 0 512z"},child:[]}]})(h)}function kk(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M256.47 216.77l86.73 109.18s-16.6 102.36-76.57 150.12C206.66 523.85 0 510.19 0 510.19s3.8-23.14 11-55.43l94.62-112.17c3.97-4.7-.87-11.62-6.65-9.5l-60.4 22.09c14.44-41.66 32.72-80.04 54.6-97.47 59.97-47.76 163.3-40.94 163.3-40.94zM636.53 31.03l-19.86-25c-5.49-6.9-15.52-8.05-22.41-2.56l-232.48 177.8-34.14-42.97c-5.09-6.41-15.14-5.21-18.59 2.21l-25.33 54.55 86.73 109.18 58.8-12.45c8-1.69 11.42-11.2 6.34-17.6l-34.09-42.92 232.48-177.8c6.89-5.48 8.04-15.53 2.55-22.44z"},child:[]}]})(h)}function Nk(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M511.988 288.9c-.478 17.43-15.217 31.1-32.653 31.1H424v16c0 21.864-4.882 42.584-13.6 61.145l60.228 60.228c12.496 12.497 12.496 32.758 0 45.255-12.498 12.497-32.759 12.496-45.256 0l-54.736-54.736C345.886 467.965 314.351 480 280 480V236c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v244c-34.351 0-65.886-12.035-90.636-32.108l-54.736 54.736c-12.498 12.497-32.759 12.496-45.256 0-12.496-12.497-12.496-32.758 0-45.255l60.228-60.228C92.882 378.584 88 357.864 88 336v-16H32.666C15.23 320 .491 306.33.013 288.9-.484 270.816 14.028 256 32 256h56v-58.745l-46.628-46.628c-12.496-12.497-12.496-32.758 0-45.255 12.498-12.497 32.758-12.497 45.256 0L141.255 160h229.489l54.627-54.627c12.498-12.497 32.758-12.497 45.256 0 12.496 12.497 12.496 32.758 0 45.255L424 197.255V256h56c17.972 0 32.484 14.816 31.988 32.9zM257 0c-61.856 0-112 50.144-112 112h224C369 50.144 318.856 0 257 0z"},child:[]}]})(h)}function jk(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M436 480h-20V24c0-13.255-10.745-24-24-24H56C42.745 0 32 10.745 32 24v456H12c-6.627 0-12 5.373-12 12v20h448v-20c0-6.627-5.373-12-12-12zM128 76c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40c0 6.627-5.373 12-12 12h-40c-6.627 0-12-5.373-12-12V76zm0 96c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40c0 6.627-5.373 12-12 12h-40c-6.627 0-12-5.373-12-12v-40zm52 148h-40c-6.627 0-12-5.373-12-12v-40c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40c0 6.627-5.373 12-12 12zm76 160h-64v-84c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v84zm64-172c0 6.627-5.373 12-12 12h-40c-6.627 0-12-5.373-12-12v-40c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40zm0-96c0 6.627-5.373 12-12 12h-40c-6.627 0-12-5.373-12-12v-40c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40zm0-96c0 6.627-5.373 12-12 12h-40c-6.627 0-12-5.373-12-12V76c0-6.627 5.373-12 12-12h40c6.627 0 12 5.373 12 12v40z"},child:[]}]})(h)}function Bk(h){return Gt({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111.03 8 0 119.03 0 256s111.03 248 248 248 248-111.03 248-248S384.97 8 248 8zm0 432c-101.69 0-184-82.29-184-184 0-101.69 82.29-184 184-184 101.69 0 184 82.29 184 184 0 101.69-82.29 184-184 184zm0-312c-70.69 0-128 57.31-128 128s57.31 128 128 128 128-57.31 128-128-57.31-128-128-128zm0 192c-35.29 0-64-28.71-64-64s28.71-64 64-64 64 28.71 64 64-28.71 64-64 64z"},child:[]}]})(h)}function Fk(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 0H48C22.4 0 0 22.4 0 48v416c0 25.6 22.4 48 48 48h352c25.6 0 48-22.4 48-48V48c0-25.6-22.4-48-48-48zM128 435.2c0 6.4-6.4 12.8-12.8 12.8H76.8c-6.4 0-12.8-6.4-12.8-12.8v-38.4c0-6.4 6.4-12.8 12.8-12.8h38.4c6.4 0 12.8 6.4 12.8 12.8v38.4zm0-128c0 6.4-6.4 12.8-12.8 12.8H76.8c-6.4 0-12.8-6.4-12.8-12.8v-38.4c0-6.4 6.4-12.8 12.8-12.8h38.4c6.4 0 12.8 6.4 12.8 12.8v38.4zm128 128c0 6.4-6.4 12.8-12.8 12.8h-38.4c-6.4 0-12.8-6.4-12.8-12.8v-38.4c0-6.4 6.4-12.8 12.8-12.8h38.4c6.4 0 12.8 6.4 12.8 12.8v38.4zm0-128c0 6.4-6.4 12.8-12.8 12.8h-38.4c-6.4 0-12.8-6.4-12.8-12.8v-38.4c0-6.4 6.4-12.8 12.8-12.8h38.4c6.4 0 12.8 6.4 12.8 12.8v38.4zm128 128c0 6.4-6.4 12.8-12.8 12.8h-38.4c-6.4 0-12.8-6.4-12.8-12.8V268.8c0-6.4 6.4-12.8 12.8-12.8h38.4c6.4 0 12.8 6.4 12.8 12.8v166.4zm0-256c0 6.4-6.4 12.8-12.8 12.8H76.8c-6.4 0-12.8-6.4-12.8-12.8V76.8C64 70.4 70.4 64 76.8 64h294.4c6.4 0 12.8 6.4 12.8 12.8v102.4z"},child:[]}]})(h)}function gp(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V192H0v272zm320-196c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM192 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM64 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM400 64h-48V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H160V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H48C21.5 64 0 85.5 0 112v48h448v-48c0-26.5-21.5-48-48-48z"},child:[]}]})(h)}function cI(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M12 192h424c6.6 0 12 5.4 12 12v260c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V204c0-6.6 5.4-12 12-12zm436-44v-36c0-26.5-21.5-48-48-48h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v36c0 6.6 5.4 12 12 12h424c6.6 0 12-5.4 12-12z"},child:[]}]})(h)}function Uk(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M499.99 176h-59.87l-16.64-41.6C406.38 91.63 365.57 64 319.5 64h-127c-46.06 0-86.88 27.63-103.99 70.4L71.87 176H12.01C4.2 176-1.53 183.34.37 190.91l6 24C7.7 220.25 12.5 224 18.01 224h20.07C24.65 235.73 16 252.78 16 272v48c0 16.12 6.16 30.67 16 41.93V416c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32v-32h256v32c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32v-54.07c9.84-11.25 16-25.8 16-41.93v-48c0-19.22-8.65-36.27-22.07-48H494c5.51 0 10.31-3.75 11.64-9.09l6-24c1.89-7.57-3.84-14.91-11.65-14.91zm-352.06-17.83c7.29-18.22 24.94-30.17 44.57-30.17h127c19.63 0 37.28 11.95 44.57 30.17L384 208H128l19.93-49.83zM96 319.8c-19.2 0-32-12.76-32-31.9S76.8 256 96 256s48 28.71 48 47.85-28.8 15.95-48 15.95zm320 0c-19.2 0-48 3.19-48-15.95S396.8 256 416 256s32 12.76 32 31.9-12.8 31.9-32 31.9z"},child:[]}]})(h)}function Vk(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M112 128c0-29.5 16.2-55 40-68.9V256h48V48h48v208h48V59.1c23.8 13.9 40 39.4 40 68.9v128h48V128C384 57.3 326.7 0 256 0h-64C121.3 0 64 57.3 64 128v128h48zm334.3 213.9l-10.7-32c-4.4-13.1-16.6-21.9-30.4-21.9H42.7c-13.8 0-26 8.8-30.4 21.9l-10.7 32C-5.2 362.6 10.2 384 32 384v112c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V384h256v112c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V384c21.8 0 37.2-21.4 30.3-42.1z"},child:[]}]})(h)}function Hk(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M332.8 320h38.4c6.4 0 12.8-6.4 12.8-12.8V172.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v134.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V76.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v230.4c0 6.4 6.4 12.8 12.8 12.8zm-288 0h38.4c6.4 0 12.8-6.4 12.8-12.8v-70.4c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v70.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V108.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v198.4c0 6.4 6.4 12.8 12.8 12.8zM496 384H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v336c0 17.67 14.33 32 32 32h464c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16z"},child:[]}]})(h)}function qk(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M496 384H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v336c0 17.67 14.33 32 32 32h464c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zM464 96H345.94c-21.38 0-32.09 25.85-16.97 40.97l32.4 32.4L288 242.75l-73.37-73.37c-12.5-12.5-32.76-12.5-45.25 0l-68.69 68.69c-6.25 6.25-6.25 16.38 0 22.63l22.62 22.62c6.25 6.25 16.38 6.25 22.63 0L192 237.25l73.37 73.37c12.5 12.5 32.76 12.5 45.25 0l96-96 32.4 32.4c15.12 15.12 40.97 4.41 40.97-16.97V112c.01-8.84-7.15-16-15.99-16z"},child:[]}]})(h)}function Gk(h){return Gt({attr:{viewBox:"0 0 544 512"},child:[{tag:"path",attr:{d:"M527.79 288H290.5l158.03 158.03c6.04 6.04 15.98 6.53 22.19.68 38.7-36.46 65.32-85.61 73.13-140.86 1.34-9.46-6.51-17.85-16.06-17.85zm-15.83-64.8C503.72 103.74 408.26 8.28 288.8.04 279.68-.59 272 7.1 272 16.24V240h223.77c9.14 0 16.82-7.68 16.19-16.8zM224 288V50.71c0-9.55-8.39-17.4-17.84-16.06C86.99 51.49-4.1 155.6.14 280.37 4.5 408.51 114.83 513.59 243.03 511.98c50.4-.63 96.97-16.87 135.26-44.03 7.9-5.6 8.42-17.23 1.57-24.08L224 288z"},child:[]}]})(h)}function Tm(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"},child:[]}]})(h)}function $k(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505 174.8l-39.6-39.6c-9.4-9.4-24.6-9.4-33.9 0L192 374.7 80.6 263.2c-9.4-9.4-24.6-9.4-33.9 0L7 302.9c-9.4 9.4-9.4 24.6 0 34L175 505c9.4 9.4 24.6 9.4 33.9 0l296-296.2c9.4-9.5 9.4-24.7.1-34zm-324.3 106c6.2 6.3 16.4 6.3 22.6 0l208-208.2c6.2-6.3 6.2-16.4 0-22.6L366.1 4.7c-6.2-6.3-16.4-6.3-22.6 0L192 156.2l-55.4-55.5c-6.2-6.3-16.4-6.3-22.6 0L68.7 146c-6.2 6.3-6.2 16.4 0 22.6l112 112.2z"},child:[]}]})(h)}function Zk(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 480H48c-26.51 0-48-21.49-48-48V80c0-26.51 21.49-48 48-48h352c26.51 0 48 21.49 48 48v352c0 26.51-21.49 48-48 48zm-204.686-98.059l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.248-16.379-6.249-22.628 0L184 302.745l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.25 16.379 6.25 22.628.001z"},child:[]}]})(h)}function Vy(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"},child:[]}]})(h)}function Wk(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"},child:[]}]})(h)}function C1(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"},child:[]}]})(h)}function Xk(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M537.6 226.6c4.1-10.7 6.4-22.4 6.4-34.6 0-53-43-96-96-96-19.7 0-38.1 6-53.3 16.2C367 64.2 315.3 32 256 32c-88.4 0-160 71.6-160 160 0 2.7.1 5.4.2 8.1C40.2 219.8 0 273.2 0 336c0 79.5 64.5 144 144 144h368c70.7 0 128-57.3 128-128 0-61.9-44-113.6-102.4-125.4zM393.4 288H328v112c0 8.8-7.2 16-16 16h-48c-8.8 0-16-7.2-16-16V288h-65.4c-14.3 0-21.4-17.2-11.3-27.3l105.4-105.4c6.2-6.2 16.4-6.2 22.6 0l105.4 105.4c10.1 10.1 2.9 27.3-11.3 27.3z"},child:[]}]})(h)}function Yk(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M537.6 226.6c4.1-10.7 6.4-22.4 6.4-34.6 0-53-43-96-96-96-19.7 0-38.1 6-53.3 16.2C367 64.2 315.3 32 256 32c-88.4 0-160 71.6-160 160 0 2.7.1 5.4.2 8.1C40.2 219.8 0 273.2 0 336c0 79.5 64.5 144 144 144h368c70.7 0 128-57.3 128-128 0-61.9-44-113.6-102.4-125.4z"},child:[]}]})(h)}function Kk(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"},child:[]}]})(h)}function Jk(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32zM128 272c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 0c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 0c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"},child:[]}]})(h)}function Qk(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M416 192c0-88.4-93.1-160-208-160S0 103.6 0 192c0 34.3 14.1 65.9 38 92-13.4 30.2-35.5 54.2-35.8 54.5-2.2 2.3-2.8 5.7-1.5 8.7S4.8 352 8 352c36.6 0 66.9-12.3 88.7-25 32.2 15.7 70.3 25 111.3 25 114.9 0 208-71.6 208-160zm122 220c23.9-26 38-57.7 38-92 0-66.9-53.5-124.2-129.3-148.1.9 6.6 1.3 13.3 1.3 20.1 0 105.9-107.7 192-240 192-10.8 0-21.3-.8-31.7-1.9C207.8 439.6 281.8 480 368 480c41 0 79.1-9.2 111.3-25 21.8 12.7 52.1 25 88.7 25 3.2 0 6.1-1.9 7.3-4.8 1.3-2.9.7-6.3-1.5-8.7-.3-.3-22.4-24.2-35.8-54.5z"},child:[]}]})(h)}function s6(h){return Gt({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M225.38 233.37c-12.5 12.5-12.5 32.76 0 45.25 12.49 12.5 32.76 12.5 45.25 0 12.5-12.5 12.5-32.76 0-45.25-12.5-12.49-32.76-12.49-45.25 0zM248 8C111.03 8 0 119.03 0 256s111.03 248 248 248 248-111.03 248-248S384.97 8 248 8zm126.14 148.05L308.17 300.4a31.938 31.938 0 0 1-15.77 15.77l-144.34 65.97c-16.65 7.61-33.81-9.55-26.2-26.2l65.98-144.35a31.938 31.938 0 0 1 15.77-15.77l144.34-65.97c16.65-7.6 33.8 9.55 26.19 26.2z"},child:[]}]})(h)}function eN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z"},child:[]}]})(h)}function tN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"},child:[]}]})(h)}function iN(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M0 432c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V256H0v176zm192-68c0-6.6 5.4-12 12-12h136c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H204c-6.6 0-12-5.4-12-12v-40zm-128 0c0-6.6 5.4-12 12-12h72c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM576 80v48H0V80c0-26.5 21.5-48 48-48h480c26.5 0 48 21.5 48 48z"},child:[]}]})(h)}function uI(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"},child:[]}]})(h)}function nN(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 0H48C21.5 0 0 21.5 0 48v320c0 26.5 21.5 48 48 48h192l-16 48h-72c-13.3 0-24 10.7-24 24s10.7 24 24 24h272c13.3 0 24-10.7 24-24s-10.7-24-24-24h-72l-16-48h192c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm-16 352H64V64h448v288z"},child:[]}]})(h)}function rN(h){return Gt({attr:{viewBox:"0 0 288 512"},child:[{tag:"path",attr:{d:"M209.2 233.4l-108-31.6C88.7 198.2 80 186.5 80 173.5c0-16.3 13.2-29.5 29.5-29.5h66.3c12.2 0 24.2 3.7 34.2 10.5 6.1 4.1 14.3 3.1 19.5-2l34.8-34c7.1-6.9 6.1-18.4-1.8-24.5C238 74.8 207.4 64.1 176 64V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48h-2.5C45.8 64-5.4 118.7.5 183.6c4.2 46.1 39.4 83.6 83.8 96.6l102.5 30c12.5 3.7 21.2 15.3 21.2 28.3 0 16.3-13.2 29.5-29.5 29.5h-66.3C100 368 88 364.3 78 357.5c-6.1-4.1-14.3-3.1-19.5 2l-34.8 34c-7.1 6.9-6.1 18.4 1.8 24.5 24.5 19.2 55.1 29.9 86.5 30v48c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-48.2c46.6-.9 90.3-28.6 105.7-72.7 21.5-61.6-14.6-124.8-72.5-141.7z"},child:[]}]})(h)}function sN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"},child:[]}]})(h)}function z4(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"},child:[]}]})(h)}function aN(h){return Gt({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"},child:[]}]})(h)}function rd(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"},child:[]}]})(h)}function a6(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},child:[]}]})(h)}function oN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z"},child:[]}]})(h)}function lN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"},child:[]}]})(h)}function Og(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"},child:[]}]})(h)}function au(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"},child:[]}]})(h)}function hI(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm64 236c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-64c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-72v8c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm96-114.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(h)}function cN(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"},child:[]}]})(h)}function uN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.976 0H24.028C2.71 0-8.047 25.866 7.058 40.971L192 225.941V432c0 7.831 3.821 15.17 10.237 19.662l80 55.98C298.02 518.69 320 507.493 320 487.98V225.941l184.947-184.97C520.021 25.896 509.338 0 487.976 0z"},child:[]}]})(h)}function hN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M349.565 98.783C295.978 98.783 251.721 64 184.348 64c-24.955 0-47.309 4.384-68.045 12.013a55.947 55.947 0 0 0 3.586-23.562C118.117 24.015 94.806 1.206 66.338.048 34.345-1.254 8 24.296 8 56c0 19.026 9.497 35.825 24 45.945V488c0 13.255 10.745 24 24 24h16c13.255 0 24-10.745 24-24v-94.4c28.311-12.064 63.582-22.122 114.435-22.122 53.588 0 97.844 34.783 165.217 34.783 48.169 0 86.667-16.294 122.505-40.858C506.84 359.452 512 349.571 512 339.045v-243.1c0-23.393-24.269-38.87-45.485-29.016-34.338 15.948-76.454 31.854-116.95 31.854z"},child:[]}]})(h)}function dN(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M485.5 0L576 160H474.9L405.7 0h79.8zm-128 0l69.2 160H149.3L218.5 0h139zm-267 0h79.8l-69.2 160H0L90.5 0zM0 192h100.7l123 251.7c1.5 3.1-2.7 5.9-5 3.3L0 192zm148.2 0h279.6l-137 318.2c-1 2.4-4.5 2.4-5.5 0L148.2 192zm204.1 251.7l123-251.7H576L357.3 446.9c-2.3 2.7-6.5-.1-5-3.2z"},child:[]}]})(h)}function fN(h){return Gt({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"},child:[]}]})(h)}function pN(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M434.7 64h-85.9c-8 0-15.7 3-21.6 8.4l-98.3 90c-.1.1-.2.3-.3.4-16.6 15.6-16.3 40.5-2.1 56 12.7 13.9 39.4 17.6 56.1 2.7.1-.1.3-.1.4-.2l79.9-73.2c6.5-5.9 16.7-5.5 22.6 1 6 6.5 5.5 16.6-1 22.6l-26.1 23.9L504 313.8c2.9 2.4 5.5 5 7.9 7.7V128l-54.6-54.6c-5.9-6-14.1-9.4-22.6-9.4zM544 128.2v223.9c0 17.7 14.3 32 32 32h64V128.2h-96zm48 223.9c-8.8 0-16-7.2-16-16s7.2-16 16-16 16 7.2 16 16-7.2 16-16 16zM0 384h64c17.7 0 32-14.3 32-32V128.2H0V384zm48-63.9c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16c0-8.9 7.2-16 16-16zm435.9 18.6L334.6 217.5l-30 27.5c-29.7 27.1-75.2 24.5-101.7-4.4-26.9-29.4-24.8-74.9 4.4-101.7L289.1 64h-83.8c-8.5 0-16.6 3.4-22.6 9.4L128 128v223.9h18.3l90.5 81.9c27.4 22.3 67.7 18.1 90-9.3l.2-.2 17.9 15.5c15.9 13 39.4 10.5 52.3-5.4l31.4-38.6 5.4 4.4c13.7 11.1 33.9 9.1 45-4.7l9.5-11.7c11.2-13.8 9.1-33.9-4.6-45.1z"},child:[]}]})(h)}function kg(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M192 208c0-17.67-14.33-32-32-32h-16c-35.35 0-64 28.65-64 64v48c0 35.35 28.65 64 64 64h16c17.67 0 32-14.33 32-32V208zm176 144c35.35 0 64-28.65 64-64v-48c0-35.35-28.65-64-64-64h-16c-17.67 0-32 14.33-32 32v112c0 17.67 14.33 32 32 32h16zM256 0C113.18 0 4.58 118.83 0 256v16c0 8.84 7.16 16 16 16h16c8.84 0 16-7.16 16-16v-16c0-114.69 93.31-208 208-208s208 93.31 208 208h-.12c.08 2.43.12 165.72.12 165.72 0 23.35-18.93 42.28-42.28 42.28H320c0-26.51-21.49-48-48-48h-32c-26.51 0-48 21.49-48 48s21.49 48 48 48h181.72c49.86 0 90.28-40.42 90.28-90.28V256C507.42 118.83 398.82 0 256 0z"},child:[]}]})(h)}function dI(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"},child:[]}]})(h)}function mN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 255.531c.253 136.64-111.18 248.372-247.82 248.468-59.015.042-113.223-20.53-155.822-54.911-11.077-8.94-11.905-25.541-1.839-35.607l11.267-11.267c8.609-8.609 22.353-9.551 31.891-1.984C173.062 425.135 212.781 440 256 440c101.705 0 184-82.311 184-184 0-101.705-82.311-184-184-184-48.814 0-93.149 18.969-126.068 49.932l50.754 50.754c10.08 10.08 2.941 27.314-11.313 27.314H24c-8.837 0-16-7.163-16-16V38.627c0-14.254 17.234-21.393 27.314-11.314l49.372 49.372C129.209 34.136 189.552 8 256 8c136.81 0 247.747 110.78 248 247.531zm-180.912 78.784l9.823-12.63c8.138-10.463 6.253-25.542-4.21-33.679L288 256.349V152c0-13.255-10.745-24-24-24h-16c-13.255 0-24 10.745-24 24v135.651l65.409 50.874c10.463 8.137 25.541 6.253 33.679-4.21z"},child:[]}]})(h)}function Bg(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"},child:[]}]})(h)}function gN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M448 492v20H0v-20c0-6.627 5.373-12 12-12h20V120c0-13.255 10.745-24 24-24h88V24c0-13.255 10.745-24 24-24h112c13.255 0 24 10.745 24 24v72h88c13.255 0 24 10.745 24 24v360h20c6.627 0 12 5.373 12 12zM308 192h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12zm-168 64h40c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12zm104 128h-40c-6.627 0-12 5.373-12 12v84h64v-84c0-6.627-5.373-12-12-12zm64-96h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12zm-116 12c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12v-40zM182 96h26v26a6 6 0 0 0 6 6h20a6 6 0 0 0 6-6V96h26a6 6 0 0 0 6-6V70a6 6 0 0 0-6-6h-26V38a6 6 0 0 0-6-6h-20a6 6 0 0 0-6 6v26h-26a6 6 0 0 0-6 6v20a6 6 0 0 0 6 6z"},child:[]}]})(h)}function _N(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56zM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48z"},child:[]}]})(h)}function o6(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"},child:[]}]})(h)}function yN(h){return Gt({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"},child:[]}]})(h)}function xN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M512 176.001C512 273.203 433.202 352 336 352c-11.22 0-22.19-1.062-32.827-3.069l-24.012 27.014A23.999 23.999 0 0 1 261.223 384H224v40c0 13.255-10.745 24-24 24h-40v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24v-78.059c0-6.365 2.529-12.47 7.029-16.971l161.802-161.802C163.108 213.814 160 195.271 160 176 160 78.798 238.797.001 335.999 0 433.488-.001 512 78.511 512 176.001zM336 128c0 26.51 21.49 48 48 48s48-21.49 48-48-21.49-48-48-48-48 21.49-48 48z"},child:[]}]})(h)}function vN(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"},child:[]}]})(h)}function bN(h){return Gt({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M96.06 454.35c.01 6.29 1.87 12.45 5.36 17.69l17.09 25.69a31.99 31.99 0 0 0 26.64 14.28h61.71a31.99 31.99 0 0 0 26.64-14.28l17.09-25.69a31.989 31.989 0 0 0 5.36-17.69l.04-38.35H96.01l.05 38.35zM0 176c0 44.37 16.45 84.85 43.56 115.78 16.52 18.85 42.36 58.23 52.21 91.45.04.26.07.52.11.78h160.24c.04-.26.07-.51.11-.78 9.85-33.22 35.69-72.6 52.21-91.45C335.55 260.85 352 220.37 352 176 352 78.61 272.91-.3 175.45 0 73.44.31 0 82.97 0 176zm176-80c-44.11 0-80 35.89-80 80 0 8.84-7.16 16-16 16s-16-7.16-16-16c0-61.76 50.24-112 112-112 8.84 0 16 7.16 16 16s-7.16 16-16 16z"},child:[]}]})(h)}function eb(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M80 368H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm0-320H16A16 16 0 0 0 0 64v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16V64a16 16 0 0 0-16-16zm0 160H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm416 176H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"},child:[]}]})(h)}function fI(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"},child:[]}]})(h)}function pI(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"},child:[]}]})(h)}function wN(h){return Gt({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M272 0H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h224c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zM160 480c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm112-108c0 6.6-5.4 12-12 12H60c-6.6 0-12-5.4-12-12V60c0-6.6 5.4-12 12-12h200c6.6 0 12 5.4 12 12v312z"},child:[]}]})(h)}function D4(h){return Gt({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M272 0H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h224c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zM160 480c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"},child:[]}]})(h)}function TN(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M621.16 54.46C582.37 38.19 543.55 32 504.75 32c-123.17-.01-246.33 62.34-369.5 62.34-30.89 0-61.76-3.92-92.65-13.72-3.47-1.1-6.95-1.62-10.35-1.62C15.04 79 0 92.32 0 110.81v317.26c0 12.63 7.23 24.6 18.84 29.46C57.63 473.81 96.45 480 135.25 480c123.17 0 246.34-62.35 369.51-62.35 30.89 0 61.76 3.92 92.65 13.72 3.47 1.1 6.95 1.62 10.35 1.62 17.21 0 32.25-13.32 32.25-31.81V83.93c-.01-12.64-7.24-24.6-18.85-29.47zM48 132.22c20.12 5.04 41.12 7.57 62.72 8.93C104.84 170.54 79 192.69 48 192.69v-60.47zm0 285v-47.78c34.37 0 62.18 27.27 63.71 61.4-22.53-1.81-43.59-6.31-63.71-13.62zM320 352c-44.19 0-80-42.99-80-96 0-53.02 35.82-96 80-96s80 42.98 80 96c0 53.03-35.83 96-80 96zm272 27.78c-17.52-4.39-35.71-6.85-54.32-8.44 5.87-26.08 27.5-45.88 54.32-49.28v57.72zm0-236.11c-30.89-3.91-54.86-29.7-55.81-61.55 19.54 2.17 38.09 6.23 55.81 12.66v48.89z"},child:[]}]})(h)}function SN(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M608 64H32C14.33 64 0 78.33 0 96v320c0 17.67 14.33 32 32 32h576c17.67 0 32-14.33 32-32V96c0-17.67-14.33-32-32-32zM48 400v-64c35.35 0 64 28.65 64 64H48zm0-224v-64h64c0 35.35-28.65 64-64 64zm272 176c-44.19 0-80-42.99-80-96 0-53.02 35.82-96 80-96s80 42.98 80 96c0 53.03-35.83 96-80 96zm272 48h-64c0-35.35 28.65-64 64-64v64zm0-224c-35.35 0-64-28.65-64-64h64v64z"},child:[]}]})(h)}function u1(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"},child:[]}]})(h)}function EN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM240 320h-48v48c0 8.8-7.2 16-16 16h-32c-8.8 0-16-7.2-16-16V144c0-8.8 7.2-16 16-16h96c52.9 0 96 43.1 96 96s-43.1 96-96 96zm0-128h-48v64h48c17.6 0 32-14.4 32-32s-14.4-32-32-32z"},child:[]}]})(h)}function AN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"},child:[]}]})(h)}function CN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"},child:[]}]})(h)}function RN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M112 224c61.9 0 112-50.1 112-112S173.9 0 112 0 0 50.1 0 112s50.1 112 112 112zm0-160c26.5 0 48 21.5 48 48s-21.5 48-48 48-48-21.5-48-48 21.5-48 48-48zm224 224c-61.9 0-112 50.1-112 112s50.1 112 112 112 112-50.1 112-112-50.1-112-112-112zm0 160c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zM392.3.2l31.6-.1c19.4-.1 30.9 21.8 19.7 37.8L77.4 501.6a23.95 23.95 0 0 1-19.6 10.2l-33.4.1c-19.5 0-30.9-21.9-19.7-37.8l368-463.7C377.2 4 384.5.2 392.3.2z"},child:[]}]})(h)}function MN(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M109.25 173.25c24.99-24.99 24.99-65.52 0-90.51-24.99-24.99-65.52-24.99-90.51 0-24.99 24.99-24.99 65.52 0 90.51 25 25 65.52 25 90.51 0zm256 165.49c-24.99-24.99-65.52-24.99-90.51 0-24.99 24.99-24.99 65.52 0 90.51 24.99 24.99 65.52 24.99 90.51 0 25-24.99 25-65.51 0-90.51zm-1.94-231.43l-22.62-22.62c-12.5-12.5-32.76-12.5-45.25 0L20.69 359.44c-12.5 12.5-12.5 32.76 0 45.25l22.62 22.62c12.5 12.5 32.76 12.5 45.25 0l274.75-274.75c12.5-12.49 12.5-32.75 0-45.25z"},child:[]}]})(h)}function uv(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M493.4 24.6l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-36 76.7-98.9 140.5-177.2 177.2l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48C3.9 366.5-2 378.1.6 389.4l24 104C27.1 504.2 36.7 512 48 512c256.1 0 464-207.5 464-464 0-11.2-7.7-20.9-18.6-23.4z"},child:[]}]})(h)}function IN(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M480 192H365.71L260.61 8.06A16.014 16.014 0 0 0 246.71 0h-65.5c-10.63 0-18.3 10.17-15.38 20.39L214.86 192H112l-43.2-57.6c-3.02-4.03-7.77-6.4-12.8-6.4H16.01C5.6 128-2.04 137.78.49 147.88L32 256 .49 364.12C-2.04 374.22 5.6 384 16.01 384H56c5.04 0 9.78-2.37 12.8-6.4L112 320h102.86l-49.03 171.6c-2.92 10.22 4.75 20.4 15.38 20.4h65.5c5.74 0 11.04-3.08 13.89-8.06L365.71 320H480c35.35 0 96-28.65 96-64s-60.65-64-96-64z"},child:[]}]})(h)}function zN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"},child:[]}]})(h)}function tb(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"},child:[]}]})(h)}function DN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 256h-80v-64c0-35.3 28.7-64 64-64h8c13.3 0 24-10.7 24-24V56c0-13.3-10.7-24-24-24h-8c-88.4 0-160 71.6-160 160v240c0 26.5 21.5 48 48 48h128c26.5 0 48-21.5 48-48V304c0-26.5-21.5-48-48-48zm-288 0H96v-64c0-35.3 28.7-64 64-64h8c13.3 0 24-10.7 24-24V56c0-13.3-10.7-24-24-24h-8C71.6 32 0 103.6 0 192v240c0 26.5 21.5 48 48 48h128c26.5 0 48-21.5 48-48V304c0-26.5-21.5-48-48-48z"},child:[]}]})(h)}function zy(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M500.33 0h-47.41a12 12 0 0 0-12 12.57l4 82.76A247.42 247.42 0 0 0 256 8C119.34 8 7.9 119.53 8 256.19 8.1 393.07 119.1 504 256 504a247.1 247.1 0 0 0 166.18-63.91 12 12 0 0 0 .48-17.43l-34-34a12 12 0 0 0-16.38-.55A176 176 0 1 1 402.1 157.8l-101.53-4.87a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12h200.33a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12z"},child:[]}]})(h)}function P4(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M8.309 189.836L184.313 37.851C199.719 24.546 224 35.347 224 56.015v80.053c160.629 1.839 288 34.032 288 186.258 0 61.441-39.581 122.309-83.333 154.132-13.653 9.931-33.111-2.533-28.077-18.631 45.344-145.012-21.507-183.51-176.59-185.742V360c0 20.7-24.3 31.453-39.687 18.164l-176.004-152c-11.071-9.562-11.086-26.753 0-36.328z"},child:[]}]})(h)}function PN(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M32,224H64V416H32A31.96166,31.96166,0,0,1,0,384V256A31.96166,31.96166,0,0,1,32,224Zm512-48V448a64.06328,64.06328,0,0,1-64,64H160a64.06328,64.06328,0,0,1-64-64V176a79.974,79.974,0,0,1,80-80H288V32a32,32,0,0,1,64,0V96H464A79.974,79.974,0,0,1,544,176ZM264,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,264,256Zm-8,128H192v32h64Zm96,0H288v32h64ZM456,256a40,40,0,1,0-40,40A39.997,39.997,0,0,0,456,256Zm-8,128H384v32h64ZM640,256V384a31.96166,31.96166,0,0,1-32,32H576V224h32A31.96166,31.96166,0,0,1,640,256Z"},child:[]}]})(h)}function LN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505.12019,19.09375c-1.18945-5.53125-6.65819-11-12.207-12.1875C460.716,0,435.507,0,410.40747,0,307.17523,0,245.26909,55.20312,199.05238,128H94.83772c-16.34763.01562-35.55658,11.875-42.88664,26.48438L2.51562,253.29688A28.4,28.4,0,0,0,0,264a24.00867,24.00867,0,0,0,24.00582,24H127.81618l-22.47457,22.46875c-11.36521,11.36133-12.99607,32.25781,0,45.25L156.24582,406.625c11.15623,11.1875,32.15619,13.15625,45.27726,0l22.47457-22.46875V488a24.00867,24.00867,0,0,0,24.00581,24,28.55934,28.55934,0,0,0,10.707-2.51562l98.72834-49.39063c14.62888-7.29687,26.50776-26.5,26.50776-42.85937V312.79688c72.59753-46.3125,128.03493-108.40626,128.03493-211.09376C512.07526,76.5,512.07526,51.29688,505.12019,19.09375ZM384.04033,168A40,40,0,1,1,424.05,128,40.02322,40.02322,0,0,1,384.04033,168Z"},child:[]}]})(h)}function m2(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M416 320h-96c-17.6 0-32-14.4-32-32s14.4-32 32-32h96s96-107 96-160-43-96-96-96-96 43-96 96c0 25.5 22.2 63.4 45.3 96H320c-52.9 0-96 43.1-96 96s43.1 96 96 96h96c17.6 0 32 14.4 32 32s-14.4 32-32 32H185.5c-16 24.8-33.8 47.7-47.3 64H416c52.9 0 96-43.1 96-96s-43.1-96-96-96zm0-256c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zM96 256c-53 0-96 43-96 96s96 160 96 160 96-107 96-160-43-96-96-96zm0 128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"},child:[]}]})(h)}function ON(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M635.7 167.2L556.1 31.7c-8.8-15-28.3-20.1-43.5-11.5l-69 39.1L503.3 161c2.2 3.8.9 8.5-2.9 10.7l-13.8 7.8c-3.8 2.2-8.7.9-10.9-2.9L416 75l-55.2 31.3 27.9 47.4c2.2 3.8.9 8.5-2.9 10.7l-13.8 7.8c-3.8 2.2-8.7.9-10.9-2.9L333.2 122 278 153.3 337.8 255c2.2 3.7.9 8.5-2.9 10.7l-13.8 7.8c-3.8 2.2-8.7.9-10.9-2.9l-59.7-101.7-55.2 31.3 27.9 47.4c2.2 3.8.9 8.5-2.9 10.7l-13.8 7.8c-3.8 2.2-8.7.9-10.9-2.9l-27.9-47.5-55.2 31.3 59.7 101.7c2.2 3.7.9 8.5-2.9 10.7l-13.8 7.8c-3.8 2.2-8.7.9-10.9-2.9L84.9 262.9l-69 39.1C.7 310.7-4.6 329.8 4.2 344.8l79.6 135.6c8.8 15 28.3 20.1 43.5 11.5L624.1 210c15.2-8.6 20.4-27.8 11.6-42.8z"},child:[]}]})(h)}function kN(h){return Gt({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M308 96c6.627 0 12-5.373 12-12V44c0-6.627-5.373-12-12-12H12C5.373 32 0 37.373 0 44v44.748c0 6.627 5.373 12 12 12h85.28c27.308 0 48.261 9.958 60.97 27.252H12c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h158.757c-6.217 36.086-32.961 58.632-74.757 58.632H12c-6.627 0-12 5.373-12 12v53.012c0 3.349 1.4 6.546 3.861 8.818l165.052 152.356a12.001 12.001 0 0 0 8.139 3.182h82.562c10.924 0 16.166-13.408 8.139-20.818L116.871 319.906c76.499-2.34 131.144-53.395 138.318-127.906H308c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-58.69c-3.486-11.541-8.28-22.246-14.252-32H308z"},child:[]}]})(h)}function NN(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M0 224v272c0 8.84 7.16 16 16 16h80V192H32c-17.67 0-32 14.33-32 32zm360-48h-24v-40c0-4.42-3.58-8-8-8h-16c-4.42 0-8 3.58-8 8v64c0 4.42 3.58 8 8 8h48c4.42 0 8-3.58 8-8v-16c0-4.42-3.58-8-8-8zm137.75-63.96l-160-106.67a32.02 32.02 0 0 0-35.5 0l-160 106.67A32.002 32.002 0 0 0 128 138.66V512h128V368c0-8.84 7.16-16 16-16h96c8.84 0 16 7.16 16 16v144h128V138.67c0-10.7-5.35-20.7-14.25-26.63zM320 256c-44.18 0-80-35.82-80-80s35.82-80 80-80 80 35.82 80 80-35.82 80-80 80zm288-64h-64v320h80c8.84 0 16-7.16 16-16V224c0-17.67-14.33-32-32-32z"},child:[]}]})(h)}function jN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M304 192v32c0 6.6-5.4 12-12 12H124c-6.6 0-12-5.4-12-12v-32c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm201 284.7L476.7 505c-9.4 9.4-24.6 9.4-33.9 0L343 405.3c-4.5-4.5-7-10.6-7-17V372c-35.3 27.6-79.7 44-128 44C93.1 416 0 322.9 0 208S93.1 0 208 0s208 93.1 208 208c0 48.3-16.4 92.7-44 128h16.3c6.4 0 12.5 2.5 17 7l99.7 99.7c9.3 9.4 9.3 24.6 0 34zM344 208c0-75.2-60.8-136-136-136S72 132.8 72 208s60.8 136 136 136 136-60.8 136-136z"},child:[]}]})(h)}function BN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M304 192v32c0 6.6-5.4 12-12 12h-56v56c0 6.6-5.4 12-12 12h-32c-6.6 0-12-5.4-12-12v-56h-56c-6.6 0-12-5.4-12-12v-32c0-6.6 5.4-12 12-12h56v-56c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v56h56c6.6 0 12 5.4 12 12zm201 284.7L476.7 505c-9.4 9.4-24.6 9.4-33.9 0L343 405.3c-4.5-4.5-7-10.6-7-17V372c-35.3 27.6-79.7 44-128 44C93.1 416 0 322.9 0 208S93.1 0 208 0s208 93.1 208 208c0 48.3-16.4 92.7-44 128h16.3c6.4 0 12.5 2.5 17 7l99.7 99.7c9.3 9.4 9.3 24.6 0 34zM344 208c0-75.2-60.8-136-136-136S72 132.8 72 208s60.8 136 136 136 136-60.8 136-136z"},child:[]}]})(h)}function Cm(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"},child:[]}]})(h)}function FN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z"},child:[]}]})(h)}function UN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"},child:[]}]})(h)}function VN(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528.12 301.319l47.273-208C578.806 78.301 567.391 64 551.99 64H159.208l-9.166-44.81C147.758 8.021 137.93 0 126.529 0H24C10.745 0 0 10.745 0 24v16c0 13.255 10.745 24 24 24h69.883l70.248 343.435C147.325 417.1 136 435.222 136 456c0 30.928 25.072 56 56 56s56-25.072 56-56c0-15.674-6.447-29.835-16.824-40h209.647C430.447 426.165 424 440.326 424 456c0 30.928 25.072 56 56 56s56-25.072 56-56c0-22.172-12.888-41.332-31.579-50.405l5.517-24.276c3.413-15.018-8.002-29.319-23.403-29.319H218.117l-6.545-32h293.145c11.206 0 20.92-7.754 23.403-18.681z"},child:[]}]})(h)}function l0(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"},child:[]}]})(h)}function HN(h){return Gt({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M41 288h238c21.4 0 32.1 25.9 17 41L177 448c-9.4 9.4-24.6 9.4-33.9 0L24 329c-15.1-15.1-4.4-41 17-41z"},child:[]}]})(h)}function qN(h){return Gt({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M279 224H41c-21.4 0-32.1-25.9-17-41L143 64c9.4-9.4 24.6-9.4 33.9 0l119 119c15.2 15.1 4.5 41-16.9 41z"},child:[]}]})(h)}function GN(h){return Gt({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M41 288h238c21.4 0 32.1 25.9 17 41L177 448c-9.4 9.4-24.6 9.4-33.9 0L24 329c-15.1-15.1-4.4-41 17-41zm255-105L177 64c-9.4-9.4-24.6-9.4-33.9 0L24 183c-15.1 15.1-4.4 41 17 41h238c21.4 0 32.1-25.9 17-41z"},child:[]}]})(h)}function $N(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"},child:[]}]})(h)}function ZN(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"},child:[]}]})(h)}function WN(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 416h-16c-26.04 0-45.8-8.42-56.09-17.9-8.9-8.21-19.66-14.1-31.77-14.1h-16.3c-12.11 0-22.87 5.89-31.77 14.1C461.8 407.58 442.04 416 416 416s-45.8-8.42-56.09-17.9c-8.9-8.21-19.66-14.1-31.77-14.1h-16.3c-12.11 0-22.87 5.89-31.77 14.1C269.8 407.58 250.04 416 224 416s-45.8-8.42-56.09-17.9c-8.9-8.21-19.66-14.1-31.77-14.1h-16.3c-12.11 0-22.87 5.89-31.77 14.1C77.8 407.58 58.04 416 32 416H16c-8.84 0-16 7.16-16 16v32c0 8.84 7.16 16 16 16h16c38.62 0 72.72-12.19 96-31.84 23.28 19.66 57.38 31.84 96 31.84s72.72-12.19 96-31.84c23.28 19.66 57.38 31.84 96 31.84s72.72-12.19 96-31.84c23.28 19.66 57.38 31.84 96 31.84h16c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zm-400-32v-96h192v96c19.12 0 30.86-6.16 34.39-9.42 9.17-8.46 19.2-14.34 29.61-18.07V128c0-17.64 14.36-32 32-32s32 14.36 32 32v16c0 8.84 7.16 16 16 16h32c8.84 0 16-7.16 16-16v-16c0-52.94-43.06-96-96-96s-96 43.06-96 96v96H224v-96c0-17.64 14.36-32 32-32s32 14.36 32 32v16c0 8.84 7.16 16 16 16h32c8.84 0 16-7.16 16-16v-16c0-52.94-43.06-96-96-96s-96 43.06-96 96v228.5c10.41 3.73 20.44 9.62 29.61 18.07 3.53 3.27 15.27 9.43 34.39 9.43z"},child:[]}]})(h)}function XN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"},child:[]}]})(h)}function YN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M464 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM224 416H64v-96h160v96zm0-160H64v-96h160v96zm224 160H288v-96h160v96zm0-160H288v-96h160v96z"},child:[]}]})(h)}function KN(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 0H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zM224 480c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"},child:[]}]})(h)}function JN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M0 56v240c0 13.255 10.745 24 24 24h80c13.255 0 24-10.745 24-24V56c0-13.255-10.745-24-24-24H24C10.745 32 0 42.745 0 56zm40 200c0-13.255 10.745-24 24-24s24 10.745 24 24-10.745 24-24 24-24-10.745-24-24zm272 256c-20.183 0-29.485-39.293-33.931-57.795-5.206-21.666-10.589-44.07-25.393-58.902-32.469-32.524-49.503-73.967-89.117-113.111a11.98 11.98 0 0 1-3.558-8.521V59.901c0-6.541 5.243-11.878 11.783-11.998 15.831-.29 36.694-9.079 52.651-16.178C256.189 17.598 295.709.017 343.995 0h2.844c42.777 0 93.363.413 113.774 29.737 8.392 12.057 10.446 27.034 6.148 44.632 16.312 17.053 25.063 48.863 16.382 74.757 17.544 23.432 19.143 56.132 9.308 79.469l.11.11c11.893 11.949 19.523 31.259 19.439 49.197-.156 30.352-26.157 58.098-59.553 58.098H350.723C358.03 364.34 384 388.132 384 430.548 384 504 336 512 312 512z"},child:[]}]})(h)}function QN(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M104 224H24c-13.255 0-24 10.745-24 24v240c0 13.255 10.745 24 24 24h80c13.255 0 24-10.745 24-24V248c0-13.255-10.745-24-24-24zM64 472c-13.255 0-24-10.745-24-24s10.745-24 24-24 24 10.745 24 24-10.745 24-24 24zM384 81.452c0 42.416-25.97 66.208-33.277 94.548h101.723c33.397 0 59.397 27.746 59.553 58.098.084 17.938-7.546 37.249-19.439 49.197l-.11.11c9.836 23.337 8.237 56.037-9.308 79.469 8.681 25.895-.069 57.704-16.382 74.757 4.298 17.598 2.244 32.575-6.148 44.632C440.202 511.587 389.616 512 346.839 512l-2.845-.001c-48.287-.017-87.806-17.598-119.56-31.725-15.957-7.099-36.821-15.887-52.651-16.178-6.54-.12-11.783-5.457-11.783-11.998v-213.77c0-3.2 1.282-6.271 3.558-8.521 39.614-39.144 56.648-80.587 89.117-113.111 14.804-14.832 20.188-37.236 25.393-58.902C282.515 39.293 291.817 0 312 0c24 0 72 8 72 81.452z"},child:[]}]})(h)}function ej(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M298.028 214.267L285.793 96H328c13.255 0 24-10.745 24-24V24c0-13.255-10.745-24-24-24H56C42.745 0 32 10.745 32 24v48c0 13.255 10.745 24 24 24h42.207L85.972 214.267C37.465 236.82 0 277.261 0 328c0 13.255 10.745 24 24 24h136v104.007c0 1.242.289 2.467.845 3.578l24 48c2.941 5.882 11.364 5.893 14.311 0l24-48a8.008 8.008 0 0 0 .845-3.578V352h136c13.255 0 24-10.745 24-24-.001-51.183-37.983-91.42-85.973-113.733z"},child:[]}]})(h)}function Hy(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"},child:[]}]})(h)}function ho(h){return Gt({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(h)}function l6(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M501.1 395.7L384 278.6c-23.1-23.1-57.6-27.6-85.4-13.9L192 158.1V96L64 0 0 64l96 128h62.1l106.6 106.6c-13.6 27.8-9.2 62.3 13.9 85.4l117.1 117.1c14.6 14.6 38.2 14.6 52.7 0l52.7-52.7c14.5-14.6 14.5-38.2 0-52.7zM331.7 225c28.3 0 54.9 11 74.9 31l19.4 19.4c15.8-6.9 30.8-16.5 43.8-29.5 37.1-37.1 49.7-89.3 37.9-136.7-2.2-9-13.5-12.1-20.1-5.5l-74.4 74.4-67.9-11.3L334 98.9l74.4-74.4c6.6-6.6 3.4-17.9-5.7-20.2-47.4-11.7-99.6.9-136.6 37.9-28.5 28.5-41.9 66.1-41.2 103.6l82.1 82.1c8.1-1.9 16.5-2.9 24.7-2.9zm-103.9 82l-56.7-56.7L18.7 402.8c-25 25-25 65.5 0 90.5s65.5 25 90.5 0l123.6-123.6c-7.6-19.9-9.9-41.6-5-62.7zM64 472c-13.2 0-24-10.8-24-24 0-13.3 10.7-24 24-24s24 10.7 24 24c0 13.2-10.7 24-24 24z"},child:[]}]})(h)}function su(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"},child:[]}]})(h)}function tj(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M378.31 378.49L298.42 288h30.63c9.01 0 16.98-5 20.78-13.06 3.8-8.04 2.55-17.26-3.28-24.05L268.42 160h28.89c9.1 0 17.3-5.35 20.86-13.61 3.52-8.13 1.86-17.59-4.24-24.08L203.66 4.83c-6.03-6.45-17.28-6.45-23.32 0L70.06 122.31c-6.1 6.49-7.75 15.95-4.24 24.08C69.38 154.65 77.59 160 86.69 160h28.89l-78.14 90.91c-5.81 6.78-7.06 15.99-3.27 24.04C37.97 283 45.93 288 54.95 288h30.63L5.69 378.49c-6 6.79-7.36 16.09-3.56 24.26 3.75 8.05 12 13.25 21.01 13.25H160v24.45l-30.29 48.4c-5.32 10.64 2.42 23.16 14.31 23.16h95.96c11.89 0 19.63-12.52 14.31-23.16L224 440.45V416h136.86c9.01 0 17.26-5.2 21.01-13.25 3.8-8.17 2.44-17.47-3.56-24.26z"},child:[]}]})(h)}function ij(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M621.3 237.3l-58.5-58.5c-12-12-28.3-18.7-45.3-18.7H480V64c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3 0 64v336c0 44.2 35.8 80 80 80 26.3 0 49.4-12.9 64-32.4 14.6 19.6 37.7 32.4 64 32.4 44.2 0 80-35.8 80-80 0-5.5-.6-10.8-1.6-16h163.2c-1.1 5.2-1.6 10.5-1.6 16 0 44.2 35.8 80 80 80s80-35.8 80-80c0-5.5-.6-10.8-1.6-16H624c8.8 0 16-7.2 16-16v-85.5c0-17-6.7-33.2-18.7-45.2zM80 432c-17.6 0-32-14.4-32-32s14.4-32 32-32 32 14.4 32 32-14.4 32-32 32zm128 0c-17.6 0-32-14.4-32-32s14.4-32 32-32 32 14.4 32 32-14.4 32-32 32zm272-224h37.5c4.3 0 8.3 1.7 11.3 4.7l43.3 43.3H480v-48zm48 224c-17.6 0-32-14.4-32-32s14.4-32 32-32 32 14.4 32 32-14.4 32-32 32z"},child:[]}]})(h)}function mI(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M212.333 224.333H12c-6.627 0-12-5.373-12-12V12C0 5.373 5.373 0 12 0h48c6.627 0 12 5.373 12 12v78.112C117.773 39.279 184.26 7.47 258.175 8.007c136.906.994 246.448 111.623 246.157 248.532C504.041 393.258 393.12 504 256.333 504c-64.089 0-122.496-24.313-166.51-64.215-5.099-4.622-5.334-12.554-.467-17.42l33.967-33.967c4.474-4.474 11.662-4.717 16.401-.525C170.76 415.336 211.58 432 256.333 432c97.268 0 176-78.716 176-176 0-97.267-78.716-176-176-176-58.496 0-110.28 28.476-142.274 72.333h98.274c6.627 0 12 5.373 12 12v48c0 6.627-5.373 12-12 12z"},child:[]}]})(h)}function nj(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 256H152V152.9c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v16c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-16C376 68 307.5-.3 223.5 0 139.5.3 72 69.5 72 153.5V256H48c-26.5 0-48 21.5-48 48v160c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V304c0-26.5-21.5-48-48-48zM264 408c0 22.1-17.9 40-40 40s-40-17.9-40-40v-48c0-22.1 17.9-40 40-40s40 17.9 40 40v48z"},child:[]}]})(h)}function rj(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M296 384h-80c-13.3 0-24-10.7-24-24V192h-87.7c-17.8 0-26.7-21.5-14.1-34.1L242.3 5.7c7.5-7.5 19.8-7.5 27.3 0l152.2 152.2c12.6 12.6 3.7 34.1-14.1 34.1H320v168c0 13.3-10.7 24-24 24zm216-8v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h136v8c0 30.9 25.1 56 56 56h80c30.9 0 56-25.1 56-56v-8h136c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"},child:[]}]})(h)}function g2(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4zm323-128.4l-27.8-28.1c-4.6-4.7-12.1-4.7-16.8-.1l-104.8 104-45.5-45.8c-4.6-4.7-12.1-4.7-16.8-.1l-28.1 27.9c-4.7 4.6-4.7 12.1-.1 16.8l81.7 82.3c4.6 4.7 12.1 4.7 16.8.1l141.3-140.2c4.6-4.7 4.7-12.2.1-16.8z"},child:[]}]})(h)}function sj(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M192 256c61.9 0 112-50.1 112-112S253.9 32 192 32 80 82.1 80 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C51.6 288 0 339.6 0 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zM480 256c53 0 96-43 96-96s-43-96-96-96-96 43-96 96 43 96 96 96zm48 32h-3.8c-13.9 4.8-28.6 8-44.2 8s-30.3-3.2-44.2-8H432c-20.4 0-39.2 5.9-55.7 15.4 24.4 26.3 39.7 61.2 39.7 99.8v38.4c0 2.2-.5 4.3-.6 6.4H592c26.5 0 48-21.5 48-48 0-61.9-50.1-112-112-112z"},child:[]}]})(h)}function L4(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M224 256A128 128 0 1 0 96 128a128 128 0 0 0 128 128zm96 64a63.08 63.08 0 0 1 8.1-30.5c-4.8-.5-9.5-1.5-14.5-1.5h-16.7a174.08 174.08 0 0 1-145.8 0h-16.7A134.43 134.43 0 0 0 0 422.4V464a48 48 0 0 0 48 48h280.9a63.54 63.54 0 0 1-8.9-32zm288-32h-32v-80a80 80 0 0 0-160 0v80h-32a32 32 0 0 0-32 32v160a32 32 0 0 0 32 32h224a32 32 0 0 0 32-32V320a32 32 0 0 0-32-32zM496 432a32 32 0 1 1 32-32 32 32 0 0 1-32 32zm32-144h-64v-80a32 32 0 0 1 64 0z"},child:[]}]})(h)}function Y_(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M622.3 271.1l-115.2-45c-4.1-1.6-12.6-3.7-22.2 0l-115.2 45c-10.7 4.2-17.7 14-17.7 24.9 0 111.6 68.7 188.8 132.9 213.9 9.6 3.7 18 1.6 22.2 0C558.4 489.9 640 420.5 640 296c0-10.9-7-20.7-17.7-24.9zM496 462.4V273.3l95.5 37.3c-5.6 87.1-60.9 135.4-95.5 151.8zM224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm96 40c0-2.5.8-4.8 1.1-7.2-2.5-.1-4.9-.8-7.5-.8h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c6.8 0 13.3-1.5 19.2-4-54-42.9-99.2-116.7-99.2-212z"},child:[]}]})(h)}function Il(h){return Gt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(h)}function Dy(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"},child:[]}]})(h)}function aj(h){return Gt({attr:{viewBox:"0 0 416 512"},child:[{tag:"path",attr:{d:"M207.9 15.2c.8 4.7 16.1 94.5 16.1 128.8 0 52.3-27.8 89.6-68.9 104.6L168 486.7c.7 13.7-10.2 25.3-24 25.3H80c-13.7 0-24.7-11.5-24-25.3l12.9-238.1C27.7 233.6 0 196.2 0 144 0 109.6 15.3 19.9 16.1 15.2 19.3-5.1 61.4-5.4 64 16.3v141.2c1.3 3.4 15.1 3.2 16 0 1.4-25.3 7.9-139.2 8-141.8 3.3-20.8 44.7-20.8 47.9 0 .2 2.7 6.6 116.5 8 141.8.9 3.2 14.8 3.4 16 0V16.3c2.6-21.6 44.8-21.4 48-1.1zm119.2 285.7l-15 185.1c-1.2 14 9.9 26 23.9 26h56c13.3 0 24-10.7 24-24V24c0-13.2-10.7-24-24-24-82.5 0-221.4 178.5-64.9 300.9z"},child:[]}]})(h)}function oj(h){return Gt({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"},child:[]}]})(h)}function lj(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M507.73 109.1c-2.24-9.03-13.54-12.09-20.12-5.51l-74.36 74.36-67.88-11.31-11.31-67.88 74.36-74.36c6.62-6.62 3.43-17.9-5.66-20.16-47.38-11.74-99.55.91-136.58 37.93-39.64 39.64-50.55 97.1-34.05 147.2L18.74 402.76c-24.99 24.99-24.99 65.51 0 90.5 24.99 24.99 65.51 24.99 90.5 0l213.21-213.21c50.12 16.71 107.47 5.68 147.37-34.22 37.07-37.07 49.7-89.32 37.91-136.73zM64 472c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24z"},child:[]}]})(h)}function cj(h){return Gt({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M336 0H48C21.49 0 0 21.49 0 48v464l192-112 192 112V48c0-26.51-21.49-48-48-48zm0 428.43l-144-84-144 84V54a6 6 0 0 1 6-6h276c3.314 0 6 2.683 6 5.996V428.43z"},child:[]}]})(h)}function uj(h){return Gt({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"},child:[]}]})(h)}function hj(h){return Gt({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528.1 171.5L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3 23.7-138.4-100.6-98 139-20.2 62.2-126 62.2 126 139 20.2-100.6 98z"},child:[]}]})(h)}const h1=({user:h,size:g="w-24 h-24",textSize:b="text-2xl",className:S="",showBorder:I=!0})=>{const N=oe=>{if(!oe)return"U";const pe=oe.trim().split(" ");return pe.length===1?pe[0].charAt(0).toUpperCase():pe.length>=2?(pe[0].charAt(0)+pe[1].charAt(0)).toUpperCase():oe.charAt(0).toUpperCase()},V=oe=>{if(!oe)return"bg-gradient-to-br from-gray-500 to-gray-600";const pe=["bg-gradient-to-br from-red-500 to-pink-600","bg-gradient-to-br from-blue-500 to-purple-600","bg-gradient-to-br from-green-500 to-teal-600","bg-gradient-to-br from-yellow-500 to-orange-600","bg-gradient-to-br from-purple-500 to-indigo-600","bg-gradient-to-br from-pink-500 to-rose-600","bg-gradient-to-br from-indigo-500 to-blue-600","bg-gradient-to-br from-teal-500 to-green-600","bg-gradient-to-br from-orange-500 to-red-600","bg-gradient-to-br from-cyan-500 to-blue-600","bg-gradient-to-br from-emerald-500 to-teal-600","bg-gradient-to-br from-violet-500 to-purple-600","bg-gradient-to-br from-fuchsia-500 to-pink-600","bg-gradient-to-br from-sky-500 to-blue-600","bg-gradient-to-br from-lime-500 to-green-600"];let ze=0;for(let le=0;le<oe.length;le++)ze=oe.charCodeAt(le)+((ze<<5)-ze);return pe[Math.abs(ze)%pe.length]},s=I&&!S.includes("border-")?"border-4 border-blue-200":"",q=`${g} rounded-full ${s} flex items-center justify-center text-white font-bold ${S}`;if(h!=null&&h.avatar)return x.jsx("img",{alt:"avatar",src:h.avatar,className:`${q} object-cover shadow-lg aspect-square`,style:{aspectRatio:"1/1"},onError:oe=>{oe.target.onerror=null,oe.target.src=""}});const Z=N(h==null?void 0:h.username),Q=V(h==null?void 0:h.username);return x.jsx("div",{className:`${q} ${Q} shadow-lg aspect-square`,children:x.jsx("span",{className:`${b} font-semibold`,children:Z})})};function c6(h){var g,b,S="";if(typeof h=="string"||typeof h=="number")S+=h;else if(typeof h=="object")if(Array.isArray(h)){var I=h.length;for(g=0;g<I;g++)h[g]&&(b=c6(h[g]))&&(S&&(S+=" "),S+=b)}else for(b in h)h[b]&&(S&&(S+=" "),S+=b);return S}function Rm(){for(var h,g,b=0,S="",I=arguments.length;b<I;b++)(h=arguments[b])&&(g=c6(h))&&(S&&(S+=" "),S+=g);return S}function gI(h){if(typeof document>"u")return;let g=document.head||document.getElementsByTagName("head")[0],b=document.createElement("style");b.type="text/css",g.firstChild?g.insertBefore(b,g.firstChild):g.appendChild(b),b.styleSheet?b.styleSheet.cssText=h:b.appendChild(document.createTextNode(h))}gI(`:root{--toastify-color-light: #fff;--toastify-color-dark: #121212;--toastify-color-info: #3498db;--toastify-color-success: #07bc0c;--toastify-color-warning: #f1c40f;--toastify-color-error: hsl(6, 78%, 57%);--toastify-color-transparent: rgba(255, 255, 255, .7);--toastify-icon-color-info: var(--toastify-color-info);--toastify-icon-color-success: var(--toastify-color-success);--toastify-icon-color-warning: var(--toastify-color-warning);--toastify-icon-color-error: var(--toastify-color-error);--toastify-container-width: fit-content;--toastify-toast-width: 320px;--toastify-toast-offset: 16px;--toastify-toast-top: max(var(--toastify-toast-offset), env(safe-area-inset-top));--toastify-toast-right: max(var(--toastify-toast-offset), env(safe-area-inset-right));--toastify-toast-left: max(var(--toastify-toast-offset), env(safe-area-inset-left));--toastify-toast-bottom: max(var(--toastify-toast-offset), env(safe-area-inset-bottom));--toastify-toast-background: #fff;--toastify-toast-padding: 14px;--toastify-toast-min-height: 64px;--toastify-toast-max-height: 800px;--toastify-toast-bd-radius: 6px;--toastify-toast-shadow: 0px 4px 12px rgba(0, 0, 0, .1);--toastify-font-family: sans-serif;--toastify-z-index: 9999;--toastify-text-color-light: #757575;--toastify-text-color-dark: #fff;--toastify-text-color-info: #fff;--toastify-text-color-success: #fff;--toastify-text-color-warning: #fff;--toastify-text-color-error: #fff;--toastify-spinner-color: #616161;--toastify-spinner-color-empty-area: #e0e0e0;--toastify-color-progress-light: linear-gradient(to right, #4cd964, #5ac8fa, #007aff, #34aadc, #5856d6, #ff2d55);--toastify-color-progress-dark: #bb86fc;--toastify-color-progress-info: var(--toastify-color-info);--toastify-color-progress-success: var(--toastify-color-success);--toastify-color-progress-warning: var(--toastify-color-warning);--toastify-color-progress-error: var(--toastify-color-error);--toastify-color-progress-bgo: .2}.Toastify__toast-container{z-index:var(--toastify-z-index);-webkit-transform:translate3d(0,0,var(--toastify-z-index));position:fixed;width:var(--toastify-container-width);box-sizing:border-box;color:#fff;display:flex;flex-direction:column}.Toastify__toast-container--top-left{top:var(--toastify-toast-top);left:var(--toastify-toast-left)}.Toastify__toast-container--top-center{top:var(--toastify-toast-top);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--top-right{top:var(--toastify-toast-top);right:var(--toastify-toast-right);align-items:end}.Toastify__toast-container--bottom-left{bottom:var(--toastify-toast-bottom);left:var(--toastify-toast-left)}.Toastify__toast-container--bottom-center{bottom:var(--toastify-toast-bottom);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--bottom-right{bottom:var(--toastify-toast-bottom);right:var(--toastify-toast-right);align-items:end}.Toastify__toast{--y: 0;position:relative;touch-action:none;width:var(--toastify-toast-width);min-height:var(--toastify-toast-min-height);box-sizing:border-box;margin-bottom:1rem;padding:var(--toastify-toast-padding);border-radius:var(--toastify-toast-bd-radius);box-shadow:var(--toastify-toast-shadow);max-height:var(--toastify-toast-max-height);font-family:var(--toastify-font-family);z-index:0;display:flex;flex:1 auto;align-items:center;word-break:break-word}@media only screen and (max-width: 480px){.Toastify__toast-container{width:100vw;left:env(safe-area-inset-left);margin:0}.Toastify__toast-container--top-left,.Toastify__toast-container--top-center,.Toastify__toast-container--top-right{top:env(safe-area-inset-top);transform:translate(0)}.Toastify__toast-container--bottom-left,.Toastify__toast-container--bottom-center,.Toastify__toast-container--bottom-right{bottom:env(safe-area-inset-bottom);transform:translate(0)}.Toastify__toast-container--rtl{right:env(safe-area-inset-right);left:initial}.Toastify__toast{--toastify-toast-width: 100%;margin-bottom:0;border-radius:0}}.Toastify__toast-container[data-stacked=true]{width:var(--toastify-toast-width)}.Toastify__toast--stacked{position:absolute;width:100%;transform:translate3d(0,var(--y),0) scale(var(--s));transition:transform .3s}.Toastify__toast--stacked[data-collapsed] .Toastify__toast-body,.Toastify__toast--stacked[data-collapsed] .Toastify__close-button{transition:opacity .1s}.Toastify__toast--stacked[data-collapsed=false]{overflow:visible}.Toastify__toast--stacked[data-collapsed=true]:not(:last-child)>*{opacity:0}.Toastify__toast--stacked:after{content:"";position:absolute;left:0;right:0;height:calc(var(--g) * 1px);bottom:100%}.Toastify__toast--stacked[data-pos=top]{top:0}.Toastify__toast--stacked[data-pos=bot]{bottom:0}.Toastify__toast--stacked[data-pos=bot].Toastify__toast--stacked:before{transform-origin:top}.Toastify__toast--stacked[data-pos=top].Toastify__toast--stacked:before{transform-origin:bottom}.Toastify__toast--stacked:before{content:"";position:absolute;left:0;right:0;bottom:0;height:100%;transform:scaleY(3);z-index:-1}.Toastify__toast--rtl{direction:rtl}.Toastify__toast--close-on-click{cursor:pointer}.Toastify__toast-icon{margin-inline-end:10px;width:22px;flex-shrink:0;display:flex}.Toastify--animate{animation-fill-mode:both;animation-duration:.5s}.Toastify--animate-icon{animation-fill-mode:both;animation-duration:.3s}.Toastify__toast-theme--dark{background:var(--toastify-color-dark);color:var(--toastify-text-color-dark)}.Toastify__toast-theme--light,.Toastify__toast-theme--colored.Toastify__toast--default{background:var(--toastify-color-light);color:var(--toastify-text-color-light)}.Toastify__toast-theme--colored.Toastify__toast--info{color:var(--toastify-text-color-info);background:var(--toastify-color-info)}.Toastify__toast-theme--colored.Toastify__toast--success{color:var(--toastify-text-color-success);background:var(--toastify-color-success)}.Toastify__toast-theme--colored.Toastify__toast--warning{color:var(--toastify-text-color-warning);background:var(--toastify-color-warning)}.Toastify__toast-theme--colored.Toastify__toast--error{color:var(--toastify-text-color-error);background:var(--toastify-color-error)}.Toastify__progress-bar-theme--light{background:var(--toastify-color-progress-light)}.Toastify__progress-bar-theme--dark{background:var(--toastify-color-progress-dark)}.Toastify__progress-bar--info{background:var(--toastify-color-progress-info)}.Toastify__progress-bar--success{background:var(--toastify-color-progress-success)}.Toastify__progress-bar--warning{background:var(--toastify-color-progress-warning)}.Toastify__progress-bar--error{background:var(--toastify-color-progress-error)}.Toastify__progress-bar-theme--colored.Toastify__progress-bar--info,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--success,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--warning,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--error{background:var(--toastify-color-transparent)}.Toastify__close-button{color:#fff;position:absolute;top:6px;right:6px;background:transparent;outline:none;border:none;padding:0;cursor:pointer;opacity:.7;transition:.3s ease;z-index:1}.Toastify__toast--rtl .Toastify__close-button{left:6px;right:unset}.Toastify__close-button--light{color:#000;opacity:.3}.Toastify__close-button>svg{fill:currentColor;height:16px;width:14px}.Toastify__close-button:hover,.Toastify__close-button:focus{opacity:1}@keyframes Toastify__trackProgress{0%{transform:scaleX(1)}to{transform:scaleX(0)}}.Toastify__progress-bar{position:absolute;bottom:0;left:0;width:100%;height:100%;z-index:1;opacity:.7;transform-origin:left}.Toastify__progress-bar--animated{animation:Toastify__trackProgress linear 1 forwards}.Toastify__progress-bar--controlled{transition:transform .2s}.Toastify__progress-bar--rtl{right:0;left:initial;transform-origin:right;border-bottom-left-radius:initial}.Toastify__progress-bar--wrp{position:absolute;overflow:hidden;bottom:0;left:0;width:100%;height:5px;border-bottom-left-radius:var(--toastify-toast-bd-radius);border-bottom-right-radius:var(--toastify-toast-bd-radius)}.Toastify__progress-bar--wrp[data-hidden=true]{opacity:0}.Toastify__progress-bar--bg{opacity:var(--toastify-color-progress-bgo);width:100%;height:100%}.Toastify__spinner{width:20px;height:20px;box-sizing:border-box;border:2px solid;border-radius:100%;border-color:var(--toastify-spinner-color-empty-area);border-right-color:var(--toastify-spinner-color);animation:Toastify__spin .65s linear infinite}@keyframes Toastify__bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0)}60%{opacity:1;transform:translate3d(-25px,0,0)}75%{transform:translate3d(10px,0,0)}90%{transform:translate3d(-5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutRight{20%{opacity:1;transform:translate3d(-20px,var(--y),0)}to{opacity:0;transform:translate3d(2000px,var(--y),0)}}@keyframes Toastify__bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0)}60%{opacity:1;transform:translate3d(25px,0,0)}75%{transform:translate3d(-10px,0,0)}90%{transform:translate3d(5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutLeft{20%{opacity:1;transform:translate3d(20px,var(--y),0)}to{opacity:0;transform:translate3d(-2000px,var(--y),0)}}@keyframes Toastify__bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0)}60%{opacity:1;transform:translate3d(0,-20px,0)}75%{transform:translate3d(0,10px,0)}90%{transform:translate3d(0,-5px,0)}to{transform:translateZ(0)}}@keyframes Toastify__bounceOutUp{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,-2000px,0)}}@keyframes Toastify__bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0)}60%{opacity:1;transform:translate3d(0,25px,0)}75%{transform:translate3d(0,-10px,0)}90%{transform:translate3d(0,5px,0)}to{transform:none}}@keyframes Toastify__bounceOutDown{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,2000px,0)}}.Toastify__bounce-enter--top-left,.Toastify__bounce-enter--bottom-left{animation-name:Toastify__bounceInLeft}.Toastify__bounce-enter--top-right,.Toastify__bounce-enter--bottom-right{animation-name:Toastify__bounceInRight}.Toastify__bounce-enter--top-center{animation-name:Toastify__bounceInDown}.Toastify__bounce-enter--bottom-center{animation-name:Toastify__bounceInUp}.Toastify__bounce-exit--top-left,.Toastify__bounce-exit--bottom-left{animation-name:Toastify__bounceOutLeft}.Toastify__bounce-exit--top-right,.Toastify__bounce-exit--bottom-right{animation-name:Toastify__bounceOutRight}.Toastify__bounce-exit--top-center{animation-name:Toastify__bounceOutUp}.Toastify__bounce-exit--bottom-center{animation-name:Toastify__bounceOutDown}@keyframes Toastify__zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes Toastify__zoomOut{0%{opacity:1}50%{opacity:0;transform:translate3d(0,var(--y),0) scale3d(.3,.3,.3)}to{opacity:0}}.Toastify__zoom-enter{animation-name:Toastify__zoomIn}.Toastify__zoom-exit{animation-name:Toastify__zoomOut}@keyframes Toastify__flipIn{0%{transform:perspective(400px) rotateX(90deg);animation-timing-function:ease-in;opacity:0}40%{transform:perspective(400px) rotateX(-20deg);animation-timing-function:ease-in}60%{transform:perspective(400px) rotateX(10deg);opacity:1}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}@keyframes Toastify__flipOut{0%{transform:translate3d(0,var(--y),0) perspective(400px)}30%{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(-20deg);opacity:1}to{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(90deg);opacity:0}}.Toastify__flip-enter{animation-name:Toastify__flipIn}.Toastify__flip-exit{animation-name:Toastify__flipOut}@keyframes Toastify__slideInRight{0%{transform:translate3d(110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInLeft{0%{transform:translate3d(-110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInUp{0%{transform:translate3d(0,110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInDown{0%{transform:translate3d(0,-110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideOutRight{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(110%,var(--y),0)}}@keyframes Toastify__slideOutLeft{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(-110%,var(--y),0)}}@keyframes Toastify__slideOutDown{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,500px,0)}}@keyframes Toastify__slideOutUp{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,-500px,0)}}.Toastify__slide-enter--top-left,.Toastify__slide-enter--bottom-left{animation-name:Toastify__slideInLeft}.Toastify__slide-enter--top-right,.Toastify__slide-enter--bottom-right{animation-name:Toastify__slideInRight}.Toastify__slide-enter--top-center{animation-name:Toastify__slideInDown}.Toastify__slide-enter--bottom-center{animation-name:Toastify__slideInUp}.Toastify__slide-exit--top-left,.Toastify__slide-exit--bottom-left{animation-name:Toastify__slideOutLeft;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-right,.Toastify__slide-exit--bottom-right{animation-name:Toastify__slideOutRight;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-center{animation-name:Toastify__slideOutUp;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--bottom-center{animation-name:Toastify__slideOutDown;animation-timing-function:ease-in;animation-duration:.3s}@keyframes Toastify__spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
`);var f0=h=>typeof h=="number"&&!isNaN(h),Pm=h=>typeof h=="string",cf=h=>typeof h=="function",_I=h=>Pm(h)||f0(h),_2=h=>Pm(h)||cf(h)?h:null,yI=(h,g)=>h===!1||f0(h)&&h>0?h:g,y2=h=>he.isValidElement(h)||Pm(h)||cf(h)||f0(h);function xI(h,g,b=300){let{scrollHeight:S,style:I}=h;requestAnimationFrame(()=>{I.minHeight="initial",I.height=S+"px",I.transition=`all ${b}ms`,requestAnimationFrame(()=>{I.height="0",I.padding="0",I.margin="0",setTimeout(g,b)})})}function vI({enter:h,exit:g,appendPosition:b=!1,collapse:S=!0,collapseDuration:I=300}){return function({children:N,position:V,preventExitTransition:s,done:q,nodeRef:Z,isIn:Q,playToast:oe}){let pe=b?`${h}--${V}`:h,ze=b?`${g}--${V}`:g,le=he.useRef(0);return he.useLayoutEffect(()=>{let Se=Z.current,te=pe.split(" "),ge=xe=>{xe.target===Z.current&&(oe(),Se.removeEventListener("animationend",ge),Se.removeEventListener("animationcancel",ge),le.current===0&&xe.type!=="animationcancel"&&Se.classList.remove(...te))};Se.classList.add(...te),Se.addEventListener("animationend",ge),Se.addEventListener("animationcancel",ge)},[]),he.useEffect(()=>{let Se=Z.current,te=()=>{Se.removeEventListener("animationend",te),S?xI(Se,q,I):q()};Q||(s?te():(le.current=1,Se.className+=` ${ze}`,Se.addEventListener("animationend",te)))},[Q]),Fr.createElement(Fr.Fragment,null,N)}}function O4(h,g){return{content:u6(h.content,h.props),containerId:h.props.containerId,id:h.props.toastId,theme:h.props.theme,type:h.props.type,data:h.props.data||{},isLoading:h.props.isLoading,icon:h.props.icon,reason:h.removalReason,status:g}}function u6(h,g,b=!1){return he.isValidElement(h)&&!Pm(h.type)?he.cloneElement(h,{closeToast:g.closeToast,toastProps:g,data:g.data,isPaused:b}):cf(h)?h({closeToast:g.closeToast,toastProps:g,data:g.data,isPaused:b}):h}function bI({closeToast:h,theme:g,ariaLabel:b="close"}){return Fr.createElement("button",{className:`Toastify__close-button Toastify__close-button--${g}`,type:"button",onClick:S=>{S.stopPropagation(),h(!0)},"aria-label":b},Fr.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},Fr.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function wI({delay:h,isRunning:g,closeToast:b,type:S="default",hide:I,className:N,controlledProgress:V,progress:s,rtl:q,isIn:Z,theme:Q}){let oe=I||V&&s===0,pe={animationDuration:`${h}ms`,animationPlayState:g?"running":"paused"};V&&(pe.transform=`scaleX(${s})`);let ze=Rm("Toastify__progress-bar",V?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${Q}`,`Toastify__progress-bar--${S}`,{"Toastify__progress-bar--rtl":q}),le=cf(N)?N({rtl:q,type:S,defaultClassName:ze}):Rm(ze,N),Se={[V&&s>=1?"onTransitionEnd":"onAnimationEnd"]:V&&s<1?null:()=>{Z&&b()}};return Fr.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":oe},Fr.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${Q} Toastify__progress-bar--${S}`}),Fr.createElement("div",{role:"progressbar","aria-hidden":oe?"true":"false","aria-label":"notification timer",className:le,style:pe,...Se}))}var TI=1,h6=()=>`${TI++}`;function SI(h,g,b){let S=1,I=0,N=[],V=[],s=g,q=new Map,Z=new Set,Q=xe=>(Z.add(xe),()=>Z.delete(xe)),oe=()=>{V=Array.from(q.values()),Z.forEach(xe=>xe())},pe=({containerId:xe,toastId:ye,updateId:Pe})=>{let Ae=xe?xe!==h:h!==1,Ke=q.has(ye)&&Pe==null;return Ae||Ke},ze=(xe,ye)=>{q.forEach(Pe=>{var Ae;(ye==null||ye===Pe.props.toastId)&&((Ae=Pe.toggle)==null||Ae.call(Pe,xe))})},le=xe=>{var ye,Pe;(Pe=(ye=xe.props)==null?void 0:ye.onClose)==null||Pe.call(ye,xe.removalReason),xe.isActive=!1},Se=xe=>{if(xe==null)q.forEach(le);else{let ye=q.get(xe);ye&&le(ye)}oe()},te=()=>{I-=N.length,N=[]},ge=xe=>{var ye,Pe;let{toastId:Ae,updateId:Ke}=xe.props,it=Ke==null;xe.staleId&&q.delete(xe.staleId),xe.isActive=!0,q.set(Ae,xe),oe(),b(O4(xe,it?"added":"updated")),it&&((Pe=(ye=xe.props).onOpen)==null||Pe.call(ye))};return{id:h,props:s,observe:Q,toggle:ze,removeToast:Se,toasts:q,clearQueue:te,buildToast:(xe,ye)=>{if(pe(ye))return;let{toastId:Pe,updateId:Ae,data:Ke,staleId:it,delay:rt}=ye,ut=Ae==null;ut&&I++;let Lt={...s,style:s.toastStyle,key:S++,...Object.fromEntries(Object.entries(ye).filter(([Jt,wi])=>wi!=null)),toastId:Pe,updateId:Ae,data:Ke,isIn:!1,className:_2(ye.className||s.toastClassName),progressClassName:_2(ye.progressClassName||s.progressClassName),autoClose:ye.isLoading?!1:yI(ye.autoClose,s.autoClose),closeToast(Jt){q.get(Pe).removalReason=Jt,Se(Pe)},deleteToast(){let Jt=q.get(Pe);if(Jt!=null){if(b(O4(Jt,"removed")),q.delete(Pe),I--,I<0&&(I=0),N.length>0){ge(N.shift());return}oe()}}};Lt.closeButton=s.closeButton,ye.closeButton===!1||y2(ye.closeButton)?Lt.closeButton=ye.closeButton:ye.closeButton===!0&&(Lt.closeButton=y2(s.closeButton)?s.closeButton:!0);let lt={content:xe,props:Lt,staleId:it};s.limit&&s.limit>0&&I>s.limit&&ut?N.push(lt):f0(rt)?setTimeout(()=>{ge(lt)},rt):ge(lt)},setProps(xe){s=xe},setToggle:(xe,ye)=>{let Pe=q.get(xe);Pe&&(Pe.toggle=ye)},isToastActive:xe=>{var ye;return(ye=q.get(xe))==null?void 0:ye.isActive},getSnapshot:()=>V}}var ol=new Map,c0=[],x2=new Set,EI=h=>x2.forEach(g=>g(h)),d6=()=>ol.size>0;function AI(){c0.forEach(h=>p6(h.content,h.options)),c0=[]}var CI=(h,{containerId:g})=>{var b;return(b=ol.get(g||1))==null?void 0:b.toasts.get(h)};function f6(h,g){var b;if(g)return!!((b=ol.get(g))!=null&&b.isToastActive(h));let S=!1;return ol.forEach(I=>{I.isToastActive(h)&&(S=!0)}),S}function RI(h){if(!d6()){c0=c0.filter(g=>h!=null&&g.options.toastId!==h);return}if(h==null||_I(h))ol.forEach(g=>{g.removeToast(h)});else if(h&&("containerId"in h||"id"in h)){let g=ol.get(h.containerId);g?g.removeToast(h.id):ol.forEach(b=>{b.removeToast(h.id)})}}var MI=(h={})=>{ol.forEach(g=>{g.props.limit&&(!h.containerId||g.id===h.containerId)&&g.clearQueue()})};function p6(h,g){y2(h)&&(d6()||c0.push({content:h,options:g}),ol.forEach(b=>{b.buildToast(h,g)}))}function II(h){var g;(g=ol.get(h.containerId||1))==null||g.setToggle(h.id,h.fn)}function m6(h,g){ol.forEach(b=>{(g==null||!(g!=null&&g.containerId)||(g==null?void 0:g.containerId)===b.id)&&b.toggle(h,g==null?void 0:g.id)})}function zI(h){let g=h.containerId||1;return{subscribe(b){let S=SI(g,h,EI);ol.set(g,S);let I=S.observe(b);return AI(),()=>{I(),ol.delete(g)}},setProps(b){var S;(S=ol.get(g))==null||S.setProps(b)},getSnapshot(){var b;return(b=ol.get(g))==null?void 0:b.getSnapshot()}}}function DI(h){return x2.add(h),()=>{x2.delete(h)}}function PI(h){return h&&(Pm(h.toastId)||f0(h.toastId))?h.toastId:h6()}function p0(h,g){return p6(h,g),g.toastId}function R1(h,g){return{...g,type:g&&g.type||h,toastId:PI(g)}}function M1(h){return(g,b)=>p0(g,R1(h,b))}function hi(h,g){return p0(h,R1("default",g))}hi.loading=(h,g)=>p0(h,R1("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...g}));function LI(h,{pending:g,error:b,success:S},I){let N;g&&(N=Pm(g)?hi.loading(g,I):hi.loading(g.render,{...I,...g}));let V={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},s=(Z,Q,oe)=>{if(Q==null){hi.dismiss(N);return}let pe={type:Z,...V,...I,data:oe},ze=Pm(Q)?{render:Q}:Q;return N?hi.update(N,{...pe,...ze}):hi(ze.render,{...pe,...ze}),oe},q=cf(h)?h():h;return q.then(Z=>s("success",S,Z)).catch(Z=>s("error",b,Z)),q}hi.promise=LI;hi.success=M1("success");hi.info=M1("info");hi.error=M1("error");hi.warning=M1("warning");hi.warn=hi.warning;hi.dark=(h,g)=>p0(h,R1("default",{theme:"dark",...g}));function OI(h){RI(h)}hi.dismiss=OI;hi.clearWaitingQueue=MI;hi.isActive=f6;hi.update=(h,g={})=>{let b=CI(h,g);if(b){let{props:S,content:I}=b,N={delay:100,...S,...g,toastId:g.toastId||h,updateId:h6()};N.toastId!==h&&(N.staleId=h);let V=N.render||I;delete N.render,p0(V,N)}};hi.done=h=>{hi.update(h,{progress:1})};hi.onChange=DI;hi.play=h=>m6(!0,h);hi.pause=h=>m6(!1,h);function kI(h){var g;let{subscribe:b,getSnapshot:S,setProps:I}=he.useRef(zI(h)).current;I(h);let N=(g=he.useSyncExternalStore(b,S,S))==null?void 0:g.slice();function V(s){if(!N)return[];let q=new Map;return h.newestOnTop&&N.reverse(),N.forEach(Z=>{let{position:Q}=Z.props;q.has(Q)||q.set(Q,[]),q.get(Q).push(Z)}),Array.from(q,Z=>s(Z[0],Z[1]))}return{getToastToRender:V,isToastActive:f6,count:N==null?void 0:N.length}}function NI(h){let[g,b]=he.useState(!1),[S,I]=he.useState(!1),N=he.useRef(null),V=he.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:s,pauseOnHover:q,closeToast:Z,onClick:Q,closeOnClick:oe}=h;II({id:h.toastId,containerId:h.containerId,fn:b}),he.useEffect(()=>{if(h.pauseOnFocusLoss)return pe(),()=>{ze()}},[h.pauseOnFocusLoss]);function pe(){document.hasFocus()||ge(),window.addEventListener("focus",te),window.addEventListener("blur",ge)}function ze(){window.removeEventListener("focus",te),window.removeEventListener("blur",ge)}function le(it){if(h.draggable===!0||h.draggable===it.pointerType){xe();let rt=N.current;V.canCloseOnClick=!0,V.canDrag=!0,rt.style.transition="none",h.draggableDirection==="x"?(V.start=it.clientX,V.removalDistance=rt.offsetWidth*(h.draggablePercent/100)):(V.start=it.clientY,V.removalDistance=rt.offsetHeight*(h.draggablePercent===80?h.draggablePercent*1.5:h.draggablePercent)/100)}}function Se(it){let{top:rt,bottom:ut,left:Lt,right:lt}=N.current.getBoundingClientRect();it.nativeEvent.type!=="touchend"&&h.pauseOnHover&&it.clientX>=Lt&&it.clientX<=lt&&it.clientY>=rt&&it.clientY<=ut?ge():te()}function te(){b(!0)}function ge(){b(!1)}function xe(){V.didMove=!1,document.addEventListener("pointermove",Pe),document.addEventListener("pointerup",Ae)}function ye(){document.removeEventListener("pointermove",Pe),document.removeEventListener("pointerup",Ae)}function Pe(it){let rt=N.current;if(V.canDrag&&rt){V.didMove=!0,g&&ge(),h.draggableDirection==="x"?V.delta=it.clientX-V.start:V.delta=it.clientY-V.start,V.start!==it.clientX&&(V.canCloseOnClick=!1);let ut=h.draggableDirection==="x"?`${V.delta}px, var(--y)`:`0, calc(${V.delta}px + var(--y))`;rt.style.transform=`translate3d(${ut},0)`,rt.style.opacity=`${1-Math.abs(V.delta/V.removalDistance)}`}}function Ae(){ye();let it=N.current;if(V.canDrag&&V.didMove&&it){if(V.canDrag=!1,Math.abs(V.delta)>V.removalDistance){I(!0),h.closeToast(!0),h.collapseAll();return}it.style.transition="transform 0.2s, opacity 0.2s",it.style.removeProperty("transform"),it.style.removeProperty("opacity")}}let Ke={onPointerDown:le,onPointerUp:Se};return s&&q&&(Ke.onMouseEnter=ge,h.stacked||(Ke.onMouseLeave=te)),oe&&(Ke.onClick=it=>{Q&&Q(it),V.canCloseOnClick&&Z(!0)}),{playToast:te,pauseToast:ge,isRunning:g,preventExitTransition:S,toastRef:N,eventHandlers:Ke}}var jI=typeof window<"u"?he.useLayoutEffect:he.useEffect,I1=({theme:h,type:g,isLoading:b,...S})=>Fr.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:h==="colored"?"currentColor":`var(--toastify-icon-color-${g})`,...S});function BI(h){return Fr.createElement(I1,{...h},Fr.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))}function FI(h){return Fr.createElement(I1,{...h},Fr.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))}function UI(h){return Fr.createElement(I1,{...h},Fr.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))}function VI(h){return Fr.createElement(I1,{...h},Fr.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))}function HI(){return Fr.createElement("div",{className:"Toastify__spinner"})}var v2={info:FI,warning:BI,success:UI,error:VI,spinner:HI},qI=h=>h in v2;function GI({theme:h,type:g,isLoading:b,icon:S}){let I=null,N={theme:h,type:g};return S===!1||(cf(S)?I=S({...N,isLoading:b}):he.isValidElement(S)?I=he.cloneElement(S,N):b?I=v2.spinner():qI(g)&&(I=v2[g](N))),I}var $I=h=>{let{isRunning:g,preventExitTransition:b,toastRef:S,eventHandlers:I,playToast:N}=NI(h),{closeButton:V,children:s,autoClose:q,onClick:Z,type:Q,hideProgressBar:oe,closeToast:pe,transition:ze,position:le,className:Se,style:te,progressClassName:ge,updateId:xe,role:ye,progress:Pe,rtl:Ae,toastId:Ke,deleteToast:it,isIn:rt,isLoading:ut,closeOnClick:Lt,theme:lt,ariaLabel:Jt}=h,wi=Rm("Toastify__toast",`Toastify__toast-theme--${lt}`,`Toastify__toast--${Q}`,{"Toastify__toast--rtl":Ae},{"Toastify__toast--close-on-click":Lt}),Fi=cf(Se)?Se({rtl:Ae,position:le,type:Q,defaultClassName:wi}):Rm(wi,Se),Bi=GI(h),Wt=!!Pe||!q,ki={closeToast:pe,type:Q,theme:lt},Ui=null;return V===!1||(cf(V)?Ui=V(ki):he.isValidElement(V)?Ui=he.cloneElement(V,ki):Ui=bI(ki)),Fr.createElement(ze,{isIn:rt,done:it,position:le,preventExitTransition:b,nodeRef:S,playToast:N},Fr.createElement("div",{id:Ke,tabIndex:0,onClick:Z,"data-in":rt,className:Fi,...I,style:te,ref:S,...rt&&{role:ye,"aria-label":Jt}},Bi!=null&&Fr.createElement("div",{className:Rm("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!ut})},Bi),u6(s,h,!g),Ui,!h.customProgressBar&&Fr.createElement(wI,{...xe&&!Wt?{key:`p-${xe}`}:{},rtl:Ae,theme:lt,delay:q,isRunning:g,isIn:rt,closeToast:pe,hide:oe,type:Q,className:ge,controlledProgress:Wt,progress:Pe||0})))},ZI=(h,g=!1)=>({enter:`Toastify--animate Toastify__${h}-enter`,exit:`Toastify--animate Toastify__${h}-exit`,appendPosition:g}),WI=vI(ZI("bounce",!0)),XI={position:"top-right",transition:WI,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light","aria-label":"Notifications Alt+T",hotKeys:h=>h.altKey&&h.code==="KeyT"};function YI(h){let g={...XI,...h},b=h.stacked,[S,I]=he.useState(!0),N=he.useRef(null),{getToastToRender:V,isToastActive:s,count:q}=kI(g),{className:Z,style:Q,rtl:oe,containerId:pe,hotKeys:ze}=g;function le(te){let ge=Rm("Toastify__toast-container",`Toastify__toast-container--${te}`,{"Toastify__toast-container--rtl":oe});return cf(Z)?Z({position:te,rtl:oe,defaultClassName:ge}):Rm(ge,_2(Z))}function Se(){b&&(I(!0),hi.play())}return jI(()=>{var te;if(b){let ge=N.current.querySelectorAll('[data-in="true"]'),xe=12,ye=(te=g.position)==null?void 0:te.includes("top"),Pe=0,Ae=0;Array.from(ge).reverse().forEach((Ke,it)=>{let rt=Ke;rt.classList.add("Toastify__toast--stacked"),it>0&&(rt.dataset.collapsed=`${S}`),rt.dataset.pos||(rt.dataset.pos=ye?"top":"bot");let ut=Pe*(S?.2:1)+(S?0:xe*it);rt.style.setProperty("--y",`${ye?ut:ut*-1}px`),rt.style.setProperty("--g",`${xe}`),rt.style.setProperty("--s",`${1-(S?Ae:0)}`),Pe+=rt.offsetHeight,Ae+=.025})}},[S,q,b]),he.useEffect(()=>{function te(ge){var xe;let ye=N.current;ze(ge)&&((xe=ye.querySelector('[tabIndex="0"]'))==null||xe.focus(),I(!1),hi.pause()),ge.key==="Escape"&&(document.activeElement===ye||ye!=null&&ye.contains(document.activeElement))&&(I(!0),hi.play())}return document.addEventListener("keydown",te),()=>{document.removeEventListener("keydown",te)}},[ze]),Fr.createElement("section",{ref:N,className:"Toastify",id:pe,onMouseEnter:()=>{b&&(I(!1),hi.pause())},onMouseLeave:Se,"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text","aria-label":g["aria-label"]},V((te,ge)=>{let xe=ge.length?{...Q}:{...Q,pointerEvents:"none"};return Fr.createElement("div",{tabIndex:-1,className:le(te),"data-stacked":b,style:xe,key:`c-${te}`},ge.map(({content:ye,props:Pe})=>Fr.createElement($I,{...Pe,stacked:b,collapseAll:Se,isIn:s(Pe.toastId,Pe.containerId),key:`t-${Pe.key}`},ye)))}))}const th="https://urbansetu.onrender.com";function g6({mobile:h=!1}){const{currentUser:g}=fo(xt=>xt.user),[b,S]=he.useState([]),[I,N]=he.useState(0),[V,s]=he.useState(!1),[q,Z]=he.useState(!1),[Q,oe]=he.useState(!1),[pe,ze]=he.useState(0),[le,Se]=he.useState("notifications"),[te,ge]=he.useState([]),[xe,ye]=he.useState(""),[Pe,Ae]=he.useState(""),[Ke,it]=he.useState(""),[rt,ut]=he.useState(!1),[Lt,lt]=he.useState(!1),[Jt,wi]=he.useState(""),[Fi,Bi]=he.useState(""),Wt=he.useRef(null);he.useEffect(()=>{if(V){const xt=document.body.style.overflow,St=document.body.style.position,Ei=document.body.style.width;return document.body.style.overflow="hidden",h&&(document.body.style.position="fixed",document.body.style.width="100%"),()=>{document.body.style.overflow=xt,document.body.style.position=St,document.body.style.width=Ei}}else document.body.style.overflow="",document.body.style.position="",document.body.style.width="";return()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width=""}},[V,h]);const ki=async(xt=!1)=>{if(g)try{const St=await fetch(`${th}/api/notifications/user/${g._id}`,{credentials:"include"}),Ei=await St.json();if(St.ok)if(xt){const Sn=new Date,Mn=Sn.getFullYear(),Nn=Sn.getMonth(),In=Sn.getDate(),qr=(Array.isArray(Ei)?Ei:[]).filter(bs=>{const fa=new Date(bs.createdAt);return fa.getFullYear()===Mn&&fa.getMonth()===Nn&&fa.getDate()===In});S(qr.length>0?qr:Ei),hi.info("Notifications list updated")}else S(Ei)}catch(St){console.error("Error fetching notifications:",St)}},Ui=async()=>{if(g)try{const xt=await fetch(`${th}/api/notifications/user/${g._id}/unread-count`,{credentials:"include"}),St=await xt.json();if(xt.ok){const Ei=St.count;Ei>pe&&pe>0&&Cn(),N(Ei),ze(Ei)}}catch(xt){console.error("Error fetching unread count:",xt)}},Cn=()=>{oe(!0),setTimeout(()=>{oe(!1)},1500)},Qe=async()=>{if(!(!g||!Ii())){lt(!0);try{const xt=await fetch(`${th}/api/notifications/admin/users`,{credentials:"include"}),St=await xt.json();xt.ok?ge(St):(console.error("Failed to fetch users:",St),hi.error("Failed to fetch users: "+(St.message||"Unknown error")))}catch(xt){console.error("Error fetching users:",xt),hi.error("Failed to fetch users: "+xt.message)}finally{lt(!1)}}},Ft=async xt=>{if(xt.preventDefault(),!xe||!Pe.trim()||!Ke.trim()){hi.error("Please fill in all fields");return}ut(!0);try{const St=await fetch(`${th}/api/notifications/admin/send`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({userId:xe,title:Pe.trim(),message:Ke.trim(),type:"admin_message"})}),Ei=await St.json();St.ok?(hi.success(Ei.message),ye(""),Ae(""),it(""),Se("notifications")):hi.error(Ei.message||"Failed to send notification")}catch(St){console.error("Error sending notification:",St),hi.error("Failed to send notification")}finally{ut(!1)}},Di=async xt=>{if(xt.preventDefault(),!Jt.trim()||!Fi.trim()){hi.error("Please fill in title and message");return}ut(!0);try{const St=await fetch(`${th}/api/notifications/admin/send-all`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({title:Jt.trim(),message:Fi.trim(),type:"admin_message"})}),Ei=await St.json();St.ok?(hi.success(Ei.message),wi(""),Bi(""),Se("notifications")):hi.error(Ei.message||"Failed to send notification")}catch(St){console.error("Error sending notification:",St),hi.error("Failed to send notification")}finally{ut(!1)}},Zi=async xt=>{try{(await fetch(`${th}/api/notifications/${xt}/read`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({userId:g._id})})).ok&&(S(Ei=>Ei.map(Sn=>Sn._id===xt?{...Sn,isRead:!0,readAt:new Date}:Sn)),Ui())}catch(St){console.error("Error marking notification as read:",St)}},ii=async()=>{try{let xt,St;Ii()?(xt=`${th}/api/notifications/admin/read-all`,St="All notifications marked as read for all admins"):(xt=`${th}/api/notifications/user/${g._id}/read-all`,St="All notifications marked as read");const Ei=await fetch(xt,{method:"PUT",credentials:"include"});if(Ei.ok){const Sn=await Ei.json();S(Mn=>Mn.map(Nn=>({...Nn,isRead:!0,readAt:new Date}))),N(0),hi.success(St)}}catch(xt){console.error("Error marking all notifications as read:",xt)}},Yi=async xt=>{try{(await fetch(`${th}/api/notifications/${xt}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({userId:g._id})})).ok&&(S(Ei=>Ei.filter(Sn=>Sn._id!==xt)),Ui(),hi.success("Notification deleted"))}catch(St){console.error("Error deleting notification:",St)}},Ti=xt=>{const St=new Date(xt),Sn=new Date-St,Mn=Math.floor(Sn/(1e3*60)),Nn=Math.floor(Sn/(1e3*60*60)),In=Math.floor(Sn/(1e3*60*60*24));return Mn<1?"Just now":Mn<60?`${Mn}m ago`:Nn<24?`${Nn}h ago`:In===1?"Yesterday":In<7?`${In} days ago`:St.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},Mi=xt=>{switch(xt){case"property_edited":return x.jsx(z4,{className:"w-4 h-4 text-blue-500"});case"property_deleted":return x.jsx(su,{className:"w-4 h-4 text-red-500"});case"appointment_updated":return x.jsx(gp,{className:"w-4 h-4 text-green-500"});case"admin_message":return x.jsx(rd,{className:"w-4 h-4 text-purple-500"});case"admin_booked_appointment":return x.jsx(gp,{className:"w-4 h-4 text-orange-500"});case"appointment_booked":return x.jsx(gp,{className:"w-4 h-4 text-blue-500"});case"appointment_cancelled_by_seller":return x.jsx(ho,{className:"w-4 h-4 text-red-500"});case"appointment_cancelled_by_buyer":return x.jsx(ho,{className:"w-4 h-4 text-yellow-500"});case"appointment_cancelled_by_admin":return x.jsx(ho,{className:"w-4 h-4 text-pink-500"});case"appointment_reinitiated_by_admin":return x.jsx(zy,{className:"w-4 h-4 text-green-500"});case"appointment_accepted_by_seller":return x.jsx(Vy,{className:"w-4 h-4 text-green-500"});case"appointment_rejected_by_seller":return x.jsx(ho,{className:"w-4 h-4 text-red-500"});case"appointment_reinitiated_by_user":return x.jsx(zy,{className:"w-4 h-4 text-green-500"});case"refund_appeal_submitted":return x.jsx(mI,{className:"w-4 h-4 text-purple-500"});case"watchlist_price_drop":return x.jsx(au,{className:"w-4 h-4 text-green-500"});case"watchlist_price_update":return x.jsx(au,{className:"w-4 h-4 text-blue-500"});case"watchlist_property_sold":return x.jsx(ho,{className:"w-4 h-4 text-red-500"});case"watchlist_property_removed":return x.jsx(su,{className:"w-4 h-4 text-red-500"});case"watchlist_property_trending":return x.jsx(au,{className:"w-4 h-4 text-orange-500"});case"watchlist_status_update":return x.jsx(z4,{className:"w-4 h-4 text-purple-500"});case"watchlist_update":return x.jsx(au,{className:"w-4 h-4 text-indigo-500"});case"email_service_failure":return x.jsx(rd,{className:"w-4 h-4 text-red-500"});default:return x.jsx(bm,{className:"w-4 h-4 text-gray-500"})}};if(he.useEffect(()=>{if(g){ki(),Ui(),Ii()&&Qe();const xt=setInterval(()=>{Ui()},1e4);return()=>clearInterval(xt)}},[g]),he.useEffect(()=>{V&&le==="send"&&g&&Ii()&&Qe()},[V,le,g]),!g)return null;const Ii=()=>g.role==="admin"||g.role==="rootadmin"||g.isDefaultAdmin||g.isAdmin;return he.useEffect(()=>{const xt=Mn=>{!g||Mn.userId!==g._id||(S(Nn=>[Mn,...Nn]),N(Nn=>Nn+1))},St=Mn=>{if(!g||Mn.adminId!==g._id)return;S(In=>In.map(qr=>({...qr,isRead:!0,readAt:new Date}))),N(0);const Nn=Mn.markedBy===g._id?"You":"Another admin";hi.info(`${Nn} marked all notifications as read for all admins`)},Ei=Mn=>{if(!g||Mn.notificationId){S(In=>In.map(qr=>qr._id===Mn.notificationId?{...qr,isRead:!0,readAt:new Date}:qr)),N(In=>Math.max(0,In-1));const Nn=Mn.markedBy===g._id?"You":Mn.markedByUsername||Mn.markedByEmail||"Another admin";hi.info(`${Nn} marked a notification as read`)}},Sn=Mn=>{!g||Mn.userId!==g._id||(S(Nn=>[Mn.notification,...Nn]),N(Nn=>Nn+1),Cn())};return fn.on("notificationCreated",xt),fn.on("allNotificationsMarkedAsRead",St),fn.on("notificationMarkedAsRead",Ei),fn.on("watchlistNotification",Sn),()=>{fn.off("notificationCreated",xt),fn.off("allNotificationsMarkedAsRead",St),fn.off("notificationMarkedAsRead",Ei),fn.off("watchlistNotification",Sn)}},[g]),x.jsxs("div",{className:"relative",children:[x.jsxs("button",{ref:Wt,onClick:()=>s(!V),className:`relative p-3 text-yellow-500 hover:text-yellow-400 transition-all duration-300 hover:scale-110 bg-yellow-50 hover:bg-yellow-100 rounded-full ${Q?"animate-bell-ring":""} ${V?"bg-yellow-100 text-yellow-600":""}`,title:"Notifications",children:[x.jsx(bm,{className:"w-5 h-5 drop-shadow-lg"}),I>0&&x.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-6 w-6 flex items-center justify-center font-bold shadow-lg animate-pulse",children:I>99?"99+":I})]}),V&&(h?a4.createPortal(x.jsx("div",{className:"fixed inset-0 z-[99999] flex items-center justify-center bg-black bg-opacity-70 backdrop-blur-md",onClick:xt=>{xt.target===xt.currentTarget&&s(!1)},children:x.jsxs("div",{className:"w-full max-w-md mx-auto bg-gradient-to-br from-white via-blue-50 to-purple-50 rounded-3xl shadow-2xl border border-gray-200 max-h-[85vh] overflow-hidden relative animate-fade-in notification-popup transform transition-all duration-300",style:{marginTop:"1rem",marginBottom:"1rem"},children:[x.jsx("button",{onClick:()=>s(!1),className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700 z-10 bg-white rounded-full p-2 shadow-lg hover:shadow-xl transition-all duration-200","aria-label":"Close notifications",children:x.jsx(ho,{className:"w-4 h-4"})}),x.jsxs("div",{className:"pt-12 pb-6 px-6",children:[x.jsxs("div",{className:"border-b border-gray-200 mb-6",children:[x.jsx("h3",{className:"text-2xl font-bold text-gray-800 text-center tracking-wide mb-2",children:"Notifications"}),x.jsx("div",{className:"flex justify-center",children:x.jsx("div",{className:"w-16 h-1 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full"})}),Ii()&&x.jsxs("div",{className:"flex border-b border-gray-200 mt-2",children:[x.jsxs("button",{onClick:()=>Se("notifications"),className:`flex-1 py-2 px-4 text-sm font-medium transition-colors ${le==="notifications"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[x.jsx(bm,{className:"w-4 h-4 inline mr-2"}),"Notifications"]}),x.jsxs("button",{onClick:()=>Se("send"),className:`flex-1 py-2 px-4 text-sm font-medium transition-colors ${le==="send"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[x.jsx(rd,{className:"w-4 h-4 inline mr-2"}),"Send Message"]})]})]}),le==="notifications"?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:x.jsxs("div",{className:"flex items-center gap-2",children:[I>0&&x.jsx("button",{onClick:ii,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:Ii()?"Mark all resolved":"Mark all read"}),x.jsxs("button",{onClick:()=>ki(!0),className:"ml-2 text-sm text-gray-500 hover:text-blue-600 flex items-center gap-1",title:"Refresh notifications",children:[x.jsx(zy,{className:"w-4 h-4"}),"Refresh"]}),b.length>0&&x.jsxs("button",{onClick:()=>{fetch(`${th}/api/notifications/user/${g._id}/all`,{method:"DELETE",credentials:"include"}).then(()=>{S([]),N(0),hi.success("All notifications cleared")})},className:"ml-2 text-sm text-red-600 hover:text-red-800 font-medium flex items-center gap-1",title:"Clear all notifications",children:[x.jsx(su,{className:"w-4 h-4"}),"Clear all"]})]})}),x.jsx("div",{className:"notification-scroll-area-mobile",children:b.length===0?x.jsxs("div",{className:"p-6 text-center text-gray-500",children:[x.jsx(bm,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),x.jsx("p",{children:"No notifications yet"})]}):x.jsx("div",{className:"divide-y divide-gray-100",children:b.map(xt=>x.jsx("div",{className:`relative group p-4 my-2 rounded-2xl shadow-lg bg-white border transition-all duration-300 flex flex-col gap-2 animate-fadeInNotification
                                  ${xt.isRead?"border border-gray-200 hover:border-gray-300":"border-l-4 border-blue-500 bg-gradient-to-r from-blue-50 to-white shadow-blue-100"}
                                  hover:shadow-xl hover:-translate-y-1 hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 active:scale-[0.98]`,style:{animationDelay:`${.05*b.indexOf(xt)}s`},children:x.jsxs("div",{className:"flex items-start gap-3",children:[x.jsx("div",{className:"flex-shrink-0 mt-1",children:Mi(xt.type)}),x.jsx("div",{className:"flex-1 min-w-0",children:x.jsxs("div",{className:"flex items-start justify-between",children:[x.jsxs("div",{className:"flex-1 min-w-0",children:[x.jsxs("h4",{className:"text-base font-bold text-blue-800 flex items-center gap-2",children:[Mi(xt.type),x.jsx("span",{className:"truncate max-w-[180px] md:max-w-[260px]",title:xt.title,children:xt.title})]}),x.jsx("p",{className:"text-sm text-gray-700 mt-1 whitespace-pre-line break-words max-w-xs md:max-w-md lg:max-w-lg font-medium",children:xt.link?x.jsx("span",{className:"text-blue-600 hover:underline cursor-pointer font-semibold",onClick:()=>{Zi(xt._id),xt.link.startsWith("http")?window.open(xt.link,"_blank"):(s(!1),setTimeout(()=>navigate(xt.link),0))},children:xt.message}):x.jsx("span",{className:"text-blue-600 hover:underline cursor-pointer font-semibold",onClick:()=>{Zi(xt._id),s(!1)},children:xt.message})}),x.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[x.jsx("span",{className:"text-xs text-gray-500",children:Ti(xt.createdAt)}),xt.adminId&&!Ii()&&x.jsx("span",{className:"text-xs text-blue-600",children:"by Organization"}),xt.adminId&&Ii()&&x.jsxs("span",{className:"text-xs text-blue-600",children:["by ",xt.adminId.username||xt.adminId.email]})]})]}),x.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[!xt.isRead&&x.jsx("button",{onClick:()=>Zi(xt._id),className:"p-1 text-green-600 hover:text-green-800 transition-colors",title:"Mark as read",children:x.jsx(Vy,{className:"w-3 h-3"})}),x.jsx("button",{onClick:()=>Yi(xt._id),className:"p-1 text-red-600 hover:text-red-800 transition-colors",title:"Delete notification",children:x.jsx(su,{className:"w-3 h-3"})})]})]})})]})},xt._id))})})]}):x.jsxs("div",{className:"p-4 space-y-4 max-h-80 overflow-y-auto",children:[x.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[x.jsxs("h4",{className:"font-semibold text-green-800 mb-3 flex items-center gap-2",children:[x.jsx(Dy,{className:"w-4 h-4"}),"Send to All Users"]}),x.jsxs("form",{onSubmit:Di,className:"space-y-3",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),x.jsx("input",{type:"text",value:Jt,onChange:xt=>wi(xt.target.value),placeholder:"Enter title...",className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-gray-900",required:!0,maxLength:100})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message"}),x.jsx("textarea",{value:Fi,onChange:xt=>Bi(xt.target.value),placeholder:"Enter message...",rows:3,className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none text-gray-900",required:!0,maxLength:500}),x.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[Fi.length,"/500"]})]}),x.jsx("button",{type:"submit",disabled:rt||!Jt.trim()||!Fi.trim(),className:"w-full bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:rt?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Sending..."]}):x.jsxs(x.Fragment,{children:[x.jsx(Dy,{className:"w-3 h-3"}),"Send to All Users"]})})]})]}),x.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[x.jsxs("h4",{className:"font-semibold text-blue-800 mb-3 flex items-center gap-2",children:[x.jsx(Il,{className:"w-4 h-4"}),"Send to Specific User"]}),x.jsxs("form",{onSubmit:Ft,className:"space-y-3",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select User"}),x.jsxs("div",{className:"relative",children:[x.jsxs("select",{value:xe,onChange:xt=>ye(xt.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-gray-900",required:!0,disabled:Lt,children:[x.jsx("option",{value:"",disabled:!0,children:"-- Select a user --"}),te.length===0&&!Lt&&x.jsx("option",{value:"",disabled:!0,children:'No users found. Click "Refresh Users" to load.'}),te.map(xt=>x.jsxs("option",{value:xt._id,children:[xt.email," ",xt.username&&`(${xt.username})`]},xt._id))]}),Lt&&x.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:x.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-500"})})]}),x.jsxs("div",{className:"flex items-center justify-between mt-1",children:[x.jsxs("span",{className:"text-xs text-gray-500",children:[te.length," users available"]}),x.jsx("button",{type:"button",onClick:Qe,disabled:Lt,className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:Lt?"Loading...":"Refresh Users"})]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),x.jsx("input",{type:"text",value:Pe,onChange:xt=>Ae(xt.target.value),placeholder:"Enter title...",className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",required:!0,maxLength:100})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message"}),x.jsx("textarea",{value:Ke,onChange:xt=>it(xt.target.value),placeholder:"Enter message...",rows:3,className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-gray-900",required:!0,maxLength:500}),x.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[Ke.length,"/500"]})]}),x.jsx("button",{type:"submit",disabled:rt||!xe||!Pe.trim()||!Ke.trim(),className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:rt?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Sending..."]}):x.jsxs(x.Fragment,{children:[x.jsx(u1,{className:"w-3 h-3"}),"Send to User"]})})]})]})]})]})]})}),document.body):a4.createPortal(x.jsx("div",{className:"fixed inset-0 z-[9998] bg-black bg-opacity-30 backdrop-blur-sm",onClick:()=>s(!1),style:{pointerEvents:"auto"},children:x.jsxs("div",{className:"fixed w-96 bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-2xl border border-gray-200 z-[9999] max-h-96 overflow-hidden notification-popup transform transition-all duration-300",onClick:xt=>xt.stopPropagation(),style:{top:"80px",right:"20px",maxHeight:"calc(100vh - 120px)",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.05)",position:"fixed",zIndex:9999},children:[x.jsxs("div",{className:"border-b border-gray-200 bg-gradient-to-r from-gray-50 to-white",children:[x.jsxs("div",{className:"flex items-center justify-between p-5",children:[x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center",children:x.jsx(bm,{className:"w-4 h-4 text-white"})}),x.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Notifications"}),I>0&&x.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full px-2 py-1 font-bold",children:I})]}),x.jsx("button",{onClick:()=>s(!1),className:"text-gray-500 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors",children:x.jsx(ho,{className:"w-4 h-4"})})]}),Ii()&&x.jsxs("div",{className:"flex border-b border-gray-200",children:[x.jsxs("button",{onClick:()=>Se("notifications"),className:`flex-1 py-2 px-4 text-sm font-medium transition-colors ${le==="notifications"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[x.jsx(bm,{className:"w-4 h-4 inline mr-2"}),"Notifications"]}),x.jsxs("button",{onClick:()=>Se("send"),className:`flex-1 py-2 px-4 text-sm font-medium transition-colors ${le==="send"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"}`,children:[x.jsx(rd,{className:"w-4 h-4 inline mr-2"}),"Send Message"]})]})]}),le==="notifications"?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:x.jsxs("div",{className:"flex items-center gap-2",children:[I>0&&x.jsx("button",{onClick:ii,className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:Ii()?"Mark all resolved":"Mark all read"}),x.jsxs("button",{onClick:()=>ki(!0),className:"ml-2 text-sm text-gray-500 hover:text-blue-600 flex items-center gap-1",title:"Refresh notifications",children:[x.jsx(zy,{className:"w-4 h-4"}),"Refresh"]}),b.length>0&&x.jsxs("button",{onClick:()=>{fetch(`${th}/api/notifications/user/${g._id}/all`,{method:"DELETE",credentials:"include"}).then(()=>{S([]),N(0),hi.success("All notifications cleared")})},className:"ml-2 text-sm text-red-600 hover:text-red-800 font-medium flex items-center gap-1",title:"Clear all notifications",children:[x.jsx(su,{className:"w-4 h-4"}),"Clear all"]})]})}),x.jsx("div",{className:"notification-scroll-area-desktop",children:b.length===0?x.jsxs("div",{className:"p-6 text-center text-gray-500",children:[x.jsx(bm,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),x.jsx("p",{children:"No notifications yet"})]}):x.jsx("div",{className:"divide-y divide-gray-100",children:b.map(xt=>x.jsx("div",{className:`p-4 hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 transition-all duration-200 border-l-4 ${xt.isRead?"border-transparent hover:border-gray-200":"bg-blue-50 border-blue-500"}`,children:x.jsxs("div",{className:"flex items-start gap-3",children:[x.jsx("div",{className:"flex-shrink-0 mt-1",children:Mi(xt.type)}),x.jsx("div",{className:"flex-1 min-w-0",children:x.jsxs("div",{className:"flex items-start justify-between",children:[x.jsxs("div",{className:"flex-1",children:[x.jsx("h4",{className:"text-sm font-medium text-gray-900",children:xt.title}),x.jsx("p",{className:"text-sm text-gray-600 mt-1 whitespace-pre-line break-words max-w-xs md:max-w-md lg:max-w-lg",children:xt.link?x.jsx("span",{className:"text-blue-600 hover:underline cursor-pointer",onClick:()=>{Zi(xt._id),xt.link.startsWith("http")?window.open(xt.link,"_blank"):(s(!1),setTimeout(()=>navigate(xt.link),0))},children:xt.message}):x.jsx("span",{className:"text-blue-600 hover:underline cursor-pointer",onClick:()=>{Zi(xt._id),s(!1)},children:xt.message})}),x.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[x.jsx("span",{className:"text-xs text-gray-500",children:Ti(xt.createdAt)}),xt.adminId&&!Ii()&&x.jsx("span",{className:"text-xs text-blue-600",children:"by Organization"}),xt.adminId&&Ii()&&x.jsxs("span",{className:"text-xs text-blue-600",children:["by ",xt.adminId.username||xt.adminId.email]})]})]}),x.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[!xt.isRead&&x.jsx("button",{onClick:()=>Zi(xt._id),className:"p-1 text-green-600 hover:text-green-800 transition-colors",title:"Mark as read",children:x.jsx(Vy,{className:"w-3 h-3"})}),x.jsx("button",{onClick:()=>Yi(xt._id),className:"p-1 text-red-600 hover:text-red-800 transition-colors",title:"Delete notification",children:x.jsx(su,{className:"w-3 h-3"})})]})]})})]})},xt._id))})})]}):x.jsxs("div",{className:"p-4 space-y-4 max-h-80 overflow-y-auto",children:[x.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[x.jsxs("h4",{className:"font-semibold text-green-800 mb-3 flex items-center gap-2",children:[x.jsx(Dy,{className:"w-4 h-4"}),"Send to All Users"]}),x.jsxs("form",{onSubmit:Di,className:"space-y-3",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),x.jsx("input",{type:"text",value:Jt,onChange:xt=>wi(xt.target.value),placeholder:"Enter title...",className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-gray-900",required:!0,maxLength:100})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message"}),x.jsx("textarea",{value:Fi,onChange:xt=>Bi(xt.target.value),placeholder:"Enter message...",rows:3,className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none text-gray-900",required:!0,maxLength:500}),x.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[Fi.length,"/500"]})]}),x.jsx("button",{type:"submit",disabled:rt||!Jt.trim()||!Fi.trim(),className:"w-full bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:rt?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Sending..."]}):x.jsxs(x.Fragment,{children:[x.jsx(Dy,{className:"w-3 h-3"}),"Send to All Users"]})})]})]}),x.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[x.jsxs("h4",{className:"font-semibold text-blue-800 mb-3 flex items-center gap-2",children:[x.jsx(Il,{className:"w-4 h-4"}),"Send to Specific User"]}),x.jsxs("form",{onSubmit:Ft,className:"space-y-3",children:[x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select User"}),x.jsxs("div",{className:"relative",children:[x.jsxs("select",{value:xe,onChange:xt=>ye(xt.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-gray-900",required:!0,disabled:Lt,children:[x.jsx("option",{value:"",disabled:!0,children:"-- Select a user --"}),te.length===0&&!Lt&&x.jsx("option",{value:"",disabled:!0,children:'No users found. Click "Refresh Users" to load.'}),te.map(xt=>x.jsxs("option",{value:xt._id,children:[xt.email," ",xt.username&&`(${xt.username})`]},xt._id))]}),Lt&&x.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:x.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-500"})})]}),x.jsxs("div",{className:"flex items-center justify-between mt-1",children:[x.jsxs("span",{className:"text-xs text-gray-500",children:[te.length," users available"]}),x.jsx("button",{type:"button",onClick:Qe,disabled:Lt,className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:Lt?"Loading...":"Refresh Users"})]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),x.jsx("input",{type:"text",value:Pe,onChange:xt=>Ae(xt.target.value),placeholder:"Enter title...",className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",required:!0,maxLength:100})]}),x.jsxs("div",{children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message"}),x.jsx("textarea",{value:Ke,onChange:xt=>it(xt.target.value),placeholder:"Enter message...",rows:3,className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-gray-900",required:!0,maxLength:500}),x.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[Ke.length,"/500"]})]}),x.jsx("button",{type:"submit",disabled:rt||!xe||!Pe.trim()||!Ke.trim(),className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:rt?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),"Sending..."]}):x.jsxs(x.Fragment,{children:[x.jsx(u1,{className:"w-3 h-3"}),"Send to User"]})})]})]})]})]})}),document.body)),x.jsx("style",{jsx:!0,children:`
        @keyframes fadeInNotification {
          from { 
            opacity: 0; 
            transform: translateY(20px) scale(0.95); 
          }
          to { 
            opacity: 1; 
            transform: translateY(0) scale(1); 
          }
        }
        
        @keyframes slideInFromTop {
          from { 
            opacity: 0; 
            transform: translateY(-20px) scale(0.95); 
          }
          to { 
            opacity: 1; 
            transform: translateY(0) scale(1); 
          }
        }
        
        @keyframes bellRing {
          0%, 100% { transform: rotate(0deg); }
          10%, 30%, 50%, 70%, 90% { transform: rotate(10deg); }
          20%, 40%, 60%, 80% { transform: rotate(-10deg); }
        }
        
        .animate-fadeInNotification {
          animation: fadeInNotification 0.5s cubic-bezier(0.4,0,0.2,1) both;
        }
        
        .animate-fade-in {
          animation: slideInFromTop 0.4s cubic-bezier(0.4,0,0.2,1) both;
        }
        
        .animate-bell-ring {
          animation: bellRing 0.5s ease-in-out;
        }
        
        .notification-popup {
          backdrop-filter: blur(10px);
        }
        
        .notification-scroll-area-mobile {
          max-height: calc(85vh - 320px);
          overflow-y: auto;
          scrollbar-width: thin;
          scrollbar-color: #cbd5e0 #f7fafc;
          padding-bottom: 1rem;
          -webkit-overflow-scrolling: touch;
        }
        
        .notification-scroll-area-mobile::-webkit-scrollbar {
          width: 6px;
        }
        
        .notification-scroll-area-mobile::-webkit-scrollbar-track {
          background: #f7fafc;
          border-radius: 3px;
        }
        
        .notification-scroll-area-mobile::-webkit-scrollbar-thumb {
          background: #cbd5e0;
          border-radius: 3px;
        }
        
        .notification-scroll-area-desktop {
          max-height: calc(100vh - 200px);
          overflow-y: auto;
          scrollbar-width: thin;
          scrollbar-color: #cbd5e0 #f7fafc;
        }
        
        .notification-scroll-area-desktop::-webkit-scrollbar {
          width: 6px;
        }
        
        .notification-scroll-area-desktop::-webkit-scrollbar-track {
          background: #f7fafc;
          border-radius: 3px;
        }
        
        .notification-scroll-area-desktop::-webkit-scrollbar-thumb {
          background: #cbd5e0;
          border-radius: 3px;
        }
      `})]})}var ib="persist:",_6="persist/FLUSH",nb="persist/REHYDRATE",y6="persist/PAUSE",x6="persist/PERSIST",v6="persist/PURGE",b6="persist/REGISTER",KI=-1;function qy(h){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?qy=function(b){return typeof b}:qy=function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},qy(h)}function k4(h,g){var b=Object.keys(h);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(h);g&&(S=S.filter(function(I){return Object.getOwnPropertyDescriptor(h,I).enumerable})),b.push.apply(b,S)}return b}function JI(h){for(var g=1;g<arguments.length;g++){var b=arguments[g]!=null?arguments[g]:{};g%2?k4(b,!0).forEach(function(S){QI(h,S,b[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(b)):k4(b).forEach(function(S){Object.defineProperty(h,S,Object.getOwnPropertyDescriptor(b,S))})}return h}function QI(h,g,b){return g in h?Object.defineProperty(h,g,{value:b,enumerable:!0,configurable:!0,writable:!0}):h[g]=b,h}function ez(h,g,b,S){S.debug;var I=JI({},b);return h&&qy(h)==="object"&&Object.keys(h).forEach(function(N){N!=="_persist"&&g[N]===b[N]&&(I[N]=h[N])}),I}function tz(h){var g=h.blacklist||null,b=h.whitelist||null,S=h.transforms||[],I=h.throttle||0,N="".concat(h.keyPrefix!==void 0?h.keyPrefix:ib).concat(h.key),V=h.storage,s;h.serialize===!1?s=function(Ae){return Ae}:typeof h.serialize=="function"?s=h.serialize:s=iz;var q=h.writeFailHandler||null,Z={},Q={},oe=[],pe=null,ze=null,le=function(Ae){Object.keys(Ae).forEach(function(Ke){ge(Ke)&&Z[Ke]!==Ae[Ke]&&oe.indexOf(Ke)===-1&&oe.push(Ke)}),Object.keys(Z).forEach(function(Ke){Ae[Ke]===void 0&&ge(Ke)&&oe.indexOf(Ke)===-1&&Z[Ke]!==void 0&&oe.push(Ke)}),pe===null&&(pe=setInterval(Se,I)),Z=Ae};function Se(){if(oe.length===0){pe&&clearInterval(pe),pe=null;return}var Pe=oe.shift(),Ae=S.reduce(function(Ke,it){return it.in(Ke,Pe,Z)},Z[Pe]);if(Ae!==void 0)try{Q[Pe]=s(Ae)}catch(Ke){console.error("redux-persist/createPersistoid: error serializing state",Ke)}else delete Q[Pe];oe.length===0&&te()}function te(){Object.keys(Q).forEach(function(Pe){Z[Pe]===void 0&&delete Q[Pe]}),ze=V.setItem(N,s(Q)).catch(xe)}function ge(Pe){return!(b&&b.indexOf(Pe)===-1&&Pe!=="_persist"||g&&g.indexOf(Pe)!==-1)}function xe(Pe){q&&q(Pe)}var ye=function(){for(;oe.length!==0;)Se();return ze||Promise.resolve()};return{update:le,flush:ye}}function iz(h){return JSON.stringify(h)}function nz(h){var g=h.transforms||[],b="".concat(h.keyPrefix!==void 0?h.keyPrefix:ib).concat(h.key),S=h.storage;h.debug;var I;return h.deserialize===!1?I=function(V){return V}:typeof h.deserialize=="function"?I=h.deserialize:I=rz,S.getItem(b).then(function(N){if(N)try{var V={},s=I(N);return Object.keys(s).forEach(function(q){V[q]=g.reduceRight(function(Z,Q){return Q.out(Z,q,s)},I(s[q]))}),V}catch(q){throw q}else return})}function rz(h){return JSON.parse(h)}function sz(h){var g=h.storage,b="".concat(h.keyPrefix!==void 0?h.keyPrefix:ib).concat(h.key);return g.removeItem(b,az)}function az(h){}function N4(h,g){var b=Object.keys(h);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(h);g&&(S=S.filter(function(I){return Object.getOwnPropertyDescriptor(h,I).enumerable})),b.push.apply(b,S)}return b}function nf(h){for(var g=1;g<arguments.length;g++){var b=arguments[g]!=null?arguments[g]:{};g%2?N4(b,!0).forEach(function(S){oz(h,S,b[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(b)):N4(b).forEach(function(S){Object.defineProperty(h,S,Object.getOwnPropertyDescriptor(b,S))})}return h}function oz(h,g,b){return g in h?Object.defineProperty(h,g,{value:b,enumerable:!0,configurable:!0,writable:!0}):h[g]=b,h}function lz(h,g){if(h==null)return{};var b=cz(h,g),S,I;if(Object.getOwnPropertySymbols){var N=Object.getOwnPropertySymbols(h);for(I=0;I<N.length;I++)S=N[I],!(g.indexOf(S)>=0)&&Object.prototype.propertyIsEnumerable.call(h,S)&&(b[S]=h[S])}return b}function cz(h,g){if(h==null)return{};var b={},S=Object.keys(h),I,N;for(N=0;N<S.length;N++)I=S[N],!(g.indexOf(I)>=0)&&(b[I]=h[I]);return b}var uz=5e3;function hz(h,g){var b=h.version!==void 0?h.version:KI;h.debug;var S=h.stateReconciler===void 0?ez:h.stateReconciler,I=h.getStoredState||nz,N=h.timeout!==void 0?h.timeout:uz,V=null,s=!1,q=!0,Z=function(oe){return oe._persist.rehydrated&&V&&!q&&V.update(oe),oe};return function(Q,oe){var pe=Q||{},ze=pe._persist,le=lz(pe,["_persist"]),Se=le;if(oe.type===x6){var te=!1,ge=function(rt,ut){te||(oe.rehydrate(h.key,rt,ut),te=!0)};if(N&&setTimeout(function(){!te&&ge(void 0,new Error('redux-persist: persist timed out for persist key "'.concat(h.key,'"')))},N),q=!1,V||(V=tz(h)),ze)return nf({},g(Se,oe),{_persist:ze});if(typeof oe.rehydrate!="function"||typeof oe.register!="function")throw new Error("redux-persist: either rehydrate or register is not a function on the PERSIST action. This can happen if the action is being replayed. This is an unexplored use case, please open an issue and we will figure out a resolution.");return oe.register(h.key),I(h).then(function(it){var rt=h.migrate||function(ut,Lt){return Promise.resolve(ut)};rt(it,b).then(function(ut){ge(ut)},function(ut){ge(void 0,ut)})},function(it){ge(void 0,it)}),nf({},g(Se,oe),{_persist:{version:b,rehydrated:!1}})}else{if(oe.type===v6)return s=!0,oe.result(sz(h)),nf({},g(Se,oe),{_persist:ze});if(oe.type===_6)return oe.result(V&&V.flush()),nf({},g(Se,oe),{_persist:ze});if(oe.type===y6)q=!0;else if(oe.type===nb){if(s)return nf({},Se,{_persist:nf({},ze,{rehydrated:!0})});if(oe.key===h.key){var xe=g(Se,oe),ye=oe.payload,Pe=S!==!1&&ye!==void 0?S(ye,Q,xe,h):xe,Ae=nf({},Pe,{_persist:nf({},ze,{rehydrated:!0})});return Z(Ae)}}}if(!ze)return g(Q,oe);var Ke=g(Se,oe);return Ke===Se?Q:Z(nf({},Ke,{_persist:ze}))}}function j4(h){return pz(h)||fz(h)||dz()}function dz(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function fz(h){if(Symbol.iterator in Object(h)||Object.prototype.toString.call(h)==="[object Arguments]")return Array.from(h)}function pz(h){if(Array.isArray(h)){for(var g=0,b=new Array(h.length);g<h.length;g++)b[g]=h[g];return b}}function B4(h,g){var b=Object.keys(h);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(h);g&&(S=S.filter(function(I){return Object.getOwnPropertyDescriptor(h,I).enumerable})),b.push.apply(b,S)}return b}function b2(h){for(var g=1;g<arguments.length;g++){var b=arguments[g]!=null?arguments[g]:{};g%2?B4(b,!0).forEach(function(S){mz(h,S,b[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(b)):B4(b).forEach(function(S){Object.defineProperty(h,S,Object.getOwnPropertyDescriptor(b,S))})}return h}function mz(h,g,b){return g in h?Object.defineProperty(h,g,{value:b,enumerable:!0,configurable:!0,writable:!0}):h[g]=b,h}var w6={registry:[],bootstrapped:!1},gz=function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:w6,b=arguments.length>1?arguments[1]:void 0;switch(b.type){case b6:return b2({},g,{registry:[].concat(j4(g.registry),[b.key])});case nb:var S=g.registry.indexOf(b.key),I=j4(g.registry);return I.splice(S,1),b2({},g,{registry:I,bootstrapped:I.length===0});default:return g}};function _z(h,g,b){var S=H2(gz,w6,void 0),I=function(q){S.dispatch({type:b6,key:q})},N=function(q,Z,Q){var oe={type:nb,payload:Z,err:Q,key:q};h.dispatch(oe),S.dispatch(oe)},V=b2({},S,{purge:function(){var q=[];return h.dispatch({type:v6,result:function(Q){q.push(Q)}}),Promise.all(q)},flush:function(){var q=[];return h.dispatch({type:_6,result:function(Q){q.push(Q)}}),Promise.all(q)},pause:function(){h.dispatch({type:y6})},persist:function(){h.dispatch({type:x6,register:I,rehydrate:N})}});return V.persist(),V}var K_={},Py={},Ly={},F4;function yz(){if(F4)return Ly;F4=1,Ly.__esModule=!0,Ly.default=I;function h(N){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?h=function(s){return typeof s}:h=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},h(N)}function g(){}var b={getItem:g,setItem:g,removeItem:g};function S(N){if((typeof self>"u"?"undefined":h(self))!=="object"||!(N in self))return!1;try{var V=self[N],s="redux-persist ".concat(N," test");V.setItem(s,"test"),V.getItem(s),V.removeItem(s)}catch{return!1}return!0}function I(N){var V="".concat(N,"Storage");return S(V)?self[V]:b}return Ly}var U4;function xz(){if(U4)return Py;U4=1,Py.__esModule=!0,Py.default=b;var h=g(yz());function g(S){return S&&S.__esModule?S:{default:S}}function b(S){var I=(0,h.default)(S);return{getItem:function(V){return new Promise(function(s,q){s(I.getItem(V))})},setItem:function(V,s){return new Promise(function(q,Z){q(I.setItem(V,s))})},removeItem:function(V){return new Promise(function(s,q){s(I.removeItem(V))})}}}return Py}var V4;function vz(){if(V4)return K_;V4=1,K_.__esModule=!0,K_.default=void 0;var h=g(xz());function g(S){return S&&S.__esModule?S:{default:S}}var b=(0,h.default)("local");return K_.default=b,K_}var bz=vz();const wz=P2(bz),Tz=mS({user:iM}),Sz={key:"root",storage:wz,version:1},Ez=hz(Sz,Tz),T6=R8({reducer:Ez,middleware:h=>h({serializableCheck:!1})}),Fg=_z(T6),S6="https://urbansetu.onrender.com";let hv=null,H4=0;const Az=5*60*1e3,Cz=async()=>{const h=Date.now();if(hv&&h-H4<Az)return hv;try{const b=await(await fetch(`${S6}/api/deployment/active`)).json();if(b.success)return hv=b.data,H4=h,b.data}catch(g){console.error("Error fetching active deployments:",g)}return[]},Rz=async()=>{try{const g=await(await fetch(`${S6}/api/deployment`,{credentials:"include"})).json();if(g.success)return g.data}catch(h){console.error("Error fetching all deployments:",h)}return[]},Mz=async()=>{try{const h=await Cz();console.log("Active deployments:",h);const g=h.find(I=>I.platform==="android"&&I.format==="apk");if(g)return console.log("Found active Android APK:",g),g.url;console.log("No active Android APK found, checking all deployments...");const S=(await Rz()).filter(I=>I.platform==="android"&&I.format==="apk").sort((I,N)=>new Date(N.createdAt)-new Date(I.createdAt))[0];if(S)return console.log("Found latest Android APK:",S),S.url}catch(h){console.error("Error getting latest Android APK:",h)}return console.warn("No Android APK found in deployments"),null},Iz="/downloads/UrbanSetu_debug.apk",q4=async(h="UrbanSetu_debug.apk")=>{try{const g=await Mz();if(!g)return{success:!1,message:"No Android app is currently available for download. Please contact support or check back later."};const b=document.createElement("a");return b.href=g,b.download=h,b.style.display="none",document.body.appendChild(b),b.click(),document.body.removeChild(b),{success:!0,message:"Android app download started!"}}catch(g){console.error("Download failed:",g);try{const b=document.createElement("a");return b.href=Iz,b.download=h,b.style.display="none",document.body.appendChild(b),b.click(),document.body.removeChild(b),{success:!0,message:"Android app download started!"}}catch(b){return console.error("Fallback download failed:",b),{success:!1,message:"Download failed. Please try again or contact support."}}}},zz=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),Dz=()=>/Android/i.test(navigator.userAgent),Pz=()=>Dz()?" Download Android App":zz()?" Download for Android":" Download Android App";function Lz(){const{currentUser:h}=fo(xe=>xe.user),g=vp(),[b,S]=he.useState(""),[I,N]=he.useState(!1),V=Pl(),s=ko(),[q,Z]=he.useState(!1),[Q,oe]=he.useState(!1),pe=he.useRef(null);he.useEffect(()=>{N(!0);const ye=new URLSearchParams(s.search).get("searchTerm");ye&&S(ye)},[s.search]),he.useEffect(()=>{Q&&pe.current&&pe.current.focus()},[Q]),he.useEffect(()=>{if(q){const xe=document.body.style.overflow,ye=document.body.style.position,Pe=document.body.style.width,Ae=document.body.style.top;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top=`-${window.scrollY}px`,document.body.classList.add("mobile-menu-open"),()=>{const Ke=document.body.style.top;document.body.style.overflow=xe,document.body.style.position=ye,document.body.style.width=Pe,document.body.style.top=Ae,document.body.classList.remove("mobile-menu-open"),Ke&&window.scrollTo(0,parseInt(Ke||"0")*-1)}}return()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.top="",document.body.classList.remove("mobile-menu-open")}},[q]);const ze=()=>{const xe=s.pathname,ye=new URLSearchParams(s.search);if(!["/sign-in","/sign-up","/forgot-password","/about","/search","/oauth","/user","/user/home","/user/about","/user/search","/user/profile","/user/create-listing","/user/update-listing","/user/listing","/user/wishlist","/user/appointment","/user/my-appointments","/user/my-listings","/user/change-password","/admin","/admin/appointments","/admin/about","/admin/explore","/admin/create-listing","/admin/listings","/admin/my-listings","/admin/update-listing","/admin/profile","/admin/change-password","/admin/requests","/admin/listing","/admin/appointmentlisting","/listing"].some(Ae=>xe===Ae||xe.startsWith(Ae+"/")||xe===Ae.replace(/\/$/,"")))return"bg-gradient-to-r from-blue-700 to-purple-700";if(xe==="/forgot-password"&&ye.get("step")==="2")return"bg-gradient-to-r from-green-600 to-green-700";switch(xe){case"/sign-in":return"bg-gradient-to-r from-blue-600 to-blue-700";case"/sign-up":return"bg-gradient-to-r from-green-600 to-green-700";case"/forgot-password":return"bg-gradient-to-r from-red-600 to-red-700";case"/change-password":case"/user/change-password":return"bg-gradient-to-r from-blue-600 to-blue-700";default:return"bg-gradient-to-r from-blue-700 to-purple-700"}},le=()=>{const xe=s.pathname,ye=new URLSearchParams(s.search);if(!["/sign-in","/sign-up","/forgot-password","/about","/search","/oauth","/user","/user/home","/user/about","/user/search","/user/profile","/user/create-listing","/user/update-listing","/user/listing","/user/wishlist","/user/appointment","/user/my-appointments","/user/my-listings","/user/change-password","/admin","/admin/appointments","/admin/about","/admin/explore","/admin/create-listing","/admin/listings","/admin/my-listings","/admin/update-listing","/admin/profile","/admin/change-password","/admin/requests","/admin/listing","/admin/appointmentlisting","/listing"].some(Ae=>xe===Ae||xe.startsWith(Ae+"/")||xe===Ae.replace(/\/$/,"")))return"bg-blue-500 hover:bg-blue-600";if(xe==="/forgot-password"&&ye.get("step")==="2")return"bg-green-500 hover:bg-green-600";switch(xe){case"/sign-in":return"bg-blue-500 hover:bg-blue-600";case"/sign-up":return"bg-green-500 hover:bg-green-600";case"/forgot-password":return"bg-red-500 hover:bg-red-600";case"/change-password":case"/user/change-password":return"bg-blue-500 hover:bg-blue-600";default:return"bg-blue-500 hover:bg-blue-600"}},Se=()=>{const xe=s.pathname,ye=new URLSearchParams(s.search);if(xe==="/forgot-password"&&ye.get("step")==="2")return"focus-within:ring-green-500";switch(xe){case"/sign-up":return"focus-within:ring-green-500";case"/forgot-password":return"focus-within:ring-red-500";default:return"focus-within:ring-blue-500"}},te=xe=>{xe.preventDefault();const ye=new URLSearchParams(s.search);ye.set("searchTerm",b);const Pe=ye.toString();V(h?`/user/search?${Pe}`:`/search?${Pe}`),Z(!1),S("")},ge=async()=>{try{const ye=await(await fetch("/api/auth/signout",{method:"GET",credentials:"include"})).json();if(ye.success===!1){console.log(ye.message);return}g(Xa()),await Fg.purge(),localStorage.removeItem("accessToken"),document.cookie="access_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="refresh_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="session_id=; Max-Age=0; path=/; SameSite=None; Secure",fn&&fn.connected&&fn.disconnect(),Dm(),hi.info("You have been signed out."),V("/",{replace:!0})}catch(xe){console.log(xe.message),g(Xa()),await Fg.purge(),localStorage.removeItem("accessToken"),document.cookie="access_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="refresh_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="session_id=; Max-Age=0; path=/; SameSite=None; Secure",fn&&fn.connected&&fn.disconnect(),Dm(),hi.info("You have been signed out."),V("/",{replace:!0})}};return x.jsxs("header",{className:`relative ${ze()} shadow-xl border-b border-white/20 sticky top-0 z-50 transition-all duration-300 ${I?"opacity-100":"opacity-0"}`,children:[x.jsx("div",{className:"bg-black/10 border-b border-white/10",children:x.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:x.jsxs("div",{className:"flex items-center justify-between py-1 text-sm text-white/80",children:[x.jsx("div",{className:"flex items-center gap-4",children:x.jsxs("span",{className:"flex items-center gap-2",children:[x.jsx(Bg,{className:"text-yellow-400"}),x.jsx("span",{children:"Premium Real Estate Platform"})]})}),x.jsxs("div",{className:"flex items-center gap-4",children:[x.jsxs("div",{className:"hidden md:flex items-center gap-4",children:[x.jsx("span",{children:" +1 (555) 123-4567"}),x.jsx("span",{children:" info@urbansetu.com"}),x.jsxs("button",{onClick:async()=>{const xe=await q4();xe.success?hi.success(xe.message):hi.error(xe.message)},className:"flex items-center gap-1 px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-sm rounded-lg transition-colors duration-200 font-medium",title:"Download Android App",children:[x.jsx(D4,{className:"text-xs"}),x.jsx("span",{children:"Download App"})]})]}),!h&&x.jsxs("div",{className:"md:hidden flex items-center gap-3",children:[x.jsxs(Ds,{to:"/sign-up",className:"flex items-center gap-1 text-white/80 hover:text-white text-sm",title:"Sign Up",children:[x.jsx(Il,{className:"text-xs"}),x.jsx("span",{children:"Sign Up"})]}),x.jsx("span",{className:"text-white/40",children:"|"}),x.jsxs(Ds,{to:"/sign-in",className:"flex items-center gap-1 text-white/80 hover:text-white text-sm",title:"Sign In",children:[x.jsx(l0,{className:"text-xs rotate-180"}),x.jsx("span",{children:"Sign In"})]})]}),h&&x.jsxs("button",{onClick:ge,className:"md:hidden flex items-center gap-1 text-white/80 hover:text-white transition-colors text-sm",title:"Sign Out",children:[x.jsx(l0,{className:"text-xs"}),x.jsx("span",{className:"text-xs",children:"Sign Out"})]})]})]})})}),x.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:x.jsxs("div",{className:"flex items-center justify-between py-2",children:[x.jsx(Ds,{to:s.pathname.startsWith("/user")?"/user":"/",className:"flex-shrink-0 group",children:x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsxs("div",{className:"relative",children:[x.jsx("div",{className:"p-2 bg-white/10 backdrop-blur-sm rounded-xl border border-white/20 shadow-lg group-hover:shadow-xl transition-all duration-300 group-hover:scale-105",children:x.jsx(Bg,{className:"text-xl sm:text-2xl text-yellow-400 drop-shadow-lg"})}),x.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-xl blur opacity-30 group-hover:opacity-50 transition-opacity duration-300"})]}),x.jsxs("div",{children:[x.jsxs("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-white drop-shadow-lg",children:[x.jsx("span",{className:"bg-gradient-to-r from-yellow-400 via-orange-400 to-red-400 bg-clip-text text-transparent",children:"Urban"}),x.jsx("span",{className:"bg-gradient-to-r from-blue-400 via-purple-400 to-indigo-400 bg-clip-text text-transparent ml-1",children:"Setu"})]}),x.jsx("p",{className:"text-xs text-white/70 font-medium tracking-wider uppercase",children:"Real Estate Excellence"})]})]})}),x.jsx("nav",{className:"hidden lg:flex items-center space-x-2",children:x.jsx(G4,{})}),x.jsx("div",{className:"lg:hidden",children:x.jsx("button",{className:"p-2 text-white hover:text-yellow-300 focus:outline-none transition-all duration-300 hover:bg-white/10 rounded-lg",onClick:()=>Z(xe=>!xe),"aria-label":"Open navigation menu",children:x.jsx("div",{className:`transition-transform duration-300 ${q?"animate-hamburger-to-x":"animate-x-to-hamburger"}`,children:q?x.jsx(ho,{className:"text-lg"}):x.jsx(r6,{className:"text-lg"})})})})]})}),q&&x.jsx("div",{className:"lg:hidden",children:x.jsxs("div",{className:"fixed inset-0 z-50",children:[x.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-md animate-mobile-backdrop-in",onClick:()=>Z(!1)}),x.jsx("div",{className:"relative ml-auto w-80 max-w-sm h-full bg-white shadow-2xl transform transition-transform duration-300 ease-in-out animate-mobile-menu-in",children:x.jsxs("div",{className:"flex flex-col h-full",children:[x.jsx("div",{className:`${ze()} p-6 text-white`,children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("h2",{className:"text-xl font-bold",children:"Menu"}),x.jsx("button",{className:"p-2 hover:bg-white/20 rounded-lg transition-colors",onClick:()=>Z(!1),"aria-label":"Close menu",children:x.jsx(ho,{className:"text-xl"})})]})}),x.jsx("div",{className:"p-6 border-b border-gray-200",children:x.jsxs("form",{onSubmit:te,className:`flex items-center bg-gray-50 rounded-xl overflow-hidden focus-within:ring-2 ${Se()} focus-within:bg-white transition-all`,children:[x.jsx("input",{type:"text",placeholder:"Search properties...",value:b,onChange:xe=>S(xe.target.value),className:"px-4 py-3 outline-none w-full text-gray-800 bg-transparent"}),x.jsx("button",{className:`${le()} text-white p-3 transition-colors`,type:"submit",children:x.jsx(Cm,{})})]})}),x.jsxs("div",{className:"p-6 border-b border-gray-200",children:[x.jsxs("button",{onClick:async()=>{const xe=await q4();xe.success?hi.success(xe.message):hi.error(xe.message),Z(!1)},className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors duration-200 font-medium",children:[x.jsx(D4,{className:"text-lg"}),x.jsx("span",{children:Pz()})]}),x.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:"Download our Android app for the best mobile experience!"})]}),x.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:x.jsx(G4,{mobile:!0,onNavigate:()=>Z(!1)})})]})})]})})]})}function G4({mobile:h=!1,onNavigate:g}){const{currentUser:b}=fo(ze=>ze.user),S=Pl(),I=vp(),N=ko(),[V,s]=he.useState(!1),[q,Z]=he.useState(""),Q=he.useRef(null);he.useEffect(()=>{V&&Q.current&&Q.current.focus()},[V]);const oe=ze=>{ze.preventDefault();const le=new URLSearchParams(N.search);le.set("searchTerm",q);const Se=le.toString();S(b?`/user/search?${Se}`:`/search?${Se}`),g&&g(),Z(""),s(!1)},pe=async()=>{try{const le=await(await fetch("/api/auth/signout",{method:"GET",credentials:"include"})).json();if(le.success===!1){console.log(le.message);return}I(Xa()),await Fg.purge(),localStorage.removeItem("accessToken"),document.cookie="access_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="refresh_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="session_id=; Max-Age=0; path=/; SameSite=None; Secure",fn&&fn.connected&&fn.disconnect(),Dm(),hi.info("You have been signed out."),S("/",{replace:!0})}catch(ze){console.log(ze.message),I(Xa()),await Fg.purge(),localStorage.removeItem("accessToken"),document.cookie="access_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="refresh_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="session_id=; Max-Age=0; path=/; SameSite=None; Secure",fn&&fn.connected&&fn.disconnect(),Dm(),hi.info("You have been signed out."),S("/",{replace:!0})}};return x.jsxs("ul",{className:`${h?"flex flex-col gap-1":"flex items-center space-x-1"}`,children:[!h&&x.jsx("li",{className:"flex items-center",children:V?x.jsxs("form",{onSubmit:oe,className:"flex items-center bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg overflow-hidden focus-within:ring-2 focus-within:ring-yellow-300 focus-within:bg-white/20 transition-all duration-300 w-48",children:[x.jsx("input",{ref:Q,type:"text",placeholder:"Search...",value:q,onChange:ze=>Z(ze.target.value),onBlur:()=>s(!1),className:"px-3 py-2 outline-none w-full text-white placeholder-white/70 bg-transparent text-sm"}),x.jsx("button",{className:"bg-yellow-400 hover:bg-yellow-500 text-gray-800 p-2 transition-colors",type:"submit",children:x.jsx(Cm,{className:"text-sm"})})]}):x.jsx("button",{className:"p-2 text-white hover:text-yellow-300 focus:outline-none transition-all duration-300 hover:bg-white/10 rounded-lg",onClick:()=>s(!0),"aria-label":"Open search",children:x.jsx(Cm,{className:"text-base"})})}),x.jsx(Ds,{to:N.pathname.startsWith("/user")?"/user":"/",onClick:g,children:x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[x.jsx(Bg,{className:`${h?"text-lg text-blue-500":"text-base text-blue-500"}`}),x.jsx("span",{children:"Home"})]})}),x.jsx(Ds,{to:"/about",onClick:g,children:x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-1":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[x.jsx(o6,{className:`${h?"text-lg text-green-500":"text-base text-green-500"}`}),x.jsx("span",{children:"About"})]})}),x.jsx(Ds,{to:"/search",onClick:g,children:x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-2":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[x.jsx(s6,{className:`${h?"text-lg text-purple-500":"text-base text-purple-500"}`}),x.jsx("span",{children:"Explore"})]})}),b&&x.jsxs(x.Fragment,{children:[x.jsx(Ds,{to:"/user/services",onClick:g,children:x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-3":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[x.jsx(l6,{className:`${h?"text-lg text-purple-600":"text-base text-purple-600"}`}),x.jsx("span",{children:"Services"})]})}),x.jsx(Ds,{to:"/user/route-planner",onClick:g,children:x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-3":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[x.jsx(m2,{className:`${h?"text-lg text-green-600":"text-base text-green-600"}`}),x.jsx("span",{children:h?"Route Planner":"Route"})]})})]}),b&&x.jsxs(x.Fragment,{children:[x.jsx(Ds,{to:"/user/create-listing",onClick:g,children:x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[x.jsx(tb,{className:`${h?"text-lg text-orange-500":"text-base text-orange-500"}`}),x.jsx("span",{children:"Add Property"})]})}),x.jsx(Ds,{to:"/user/my-listings",onClick:g,children:x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-1":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[x.jsx(eb,{className:`${h?"text-lg text-indigo-500":"text-base text-indigo-500"}`}),x.jsx("span",{children:"My Listings"})]})}),x.jsx(Ds,{to:"/user/wishlist",onClick:g,children:x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-2":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[x.jsx(dI,{className:`${h?"text-lg text-red-500":"text-base text-red-500"}`}),x.jsx("span",{children:"Wish List"})]})}),x.jsx(Ds,{to:"/user/my-appointments",onClick:g,children:x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-3":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[x.jsx(gp,{className:`${h?"text-lg text-teal-500":"text-base text-teal-500"}`}),x.jsx("span",{children:"My Appointments"})]})})]}),b?x.jsxs(x.Fragment,{children:[x.jsx("li",{className:`${h?"flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium":"flex items-center relative"}`,children:x.jsx(g6,{mobile:h})}),x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium cursor-pointer animate-mobile-item-in":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base cursor-pointer flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,onClick:()=>{pe(),g&&g()},children:[x.jsx(l0,{className:`${h?"text-lg text-red-500":"text-base text-red-500"}`}),x.jsx("span",{children:"Sign Out"})]}),!h&&x.jsx("li",{children:x.jsx("div",{className:"cursor-pointer transition-transform duration-300 hover:scale-110",onClick:()=>{b.role==="admin"||b.role==="rootadmin"?S("/admin/profile"):S("/user/profile"),g&&g()},title:"Profile",children:x.jsx(h1,{user:b,size:"h-7 w-7",textSize:"text-xs",showBorder:!0})})}),h&&x.jsx("li",{children:x.jsxs("div",{className:"cursor-pointer transition-transform duration-300 hover:scale-110 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 flex items-center gap-3 text-gray-700 font-medium",onClick:()=>{S("/user/profile"),g&&g()},title:"Profile",children:[x.jsx(h1,{user:b,size:"h-7 w-7",textSize:"text-xs",showBorder:!0}),x.jsx("span",{children:"Profile"})]})})]}):x.jsx(Ds,{to:"/sign-in",onClick:g,children:x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[x.jsx(Il,{className:`${h?"text-lg text-blue-500":"text-base text-blue-500"}`}),x.jsx("span",{children:"Sign In"})]})})]})}function Oz(){const{currentUser:h}=fo(ut=>ut.user),g=vp(),b=Pl(),S=ko(),[I,N]=he.useState(""),[V,s]=he.useState(!1),[q,Z]=he.useState(0),[Q,oe]=he.useState(0),pe="https://urbansetu.onrender.com",[ze,le]=he.useState(!1),[Se,te]=he.useState(!1),ge=he.useRef(null);he.useEffect(()=>{s(!0),h&&(h.role==="admin"||h.role==="rootadmin")&&h.adminApprovalStatus==="approved"&&(Ae(),Ke())},[h]),he.useEffect(()=>{Se&&ge.current&&ge.current.focus()},[Se]),he.useEffect(()=>{if(ze){const ut=document.body.style.overflow,Lt=document.body.style.position,lt=document.body.style.width,Jt=document.body.style.top;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top=`-${window.scrollY}px`,document.body.classList.add("mobile-menu-open"),()=>{const wi=document.body.style.top;document.body.style.overflow=ut,document.body.style.position=Lt,document.body.style.width=lt,document.body.style.top=Jt,document.body.classList.remove("mobile-menu-open"),wi&&window.scrollTo(0,parseInt(wi||"0")*-1)}}return()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.top="",document.body.classList.remove("mobile-menu-open")}},[ze]);const xe=()=>{const ut=S.pathname,Lt=new URLSearchParams(S.search);if(ut==="/forgot-password"&&Lt.get("step")==="2")return"bg-gradient-to-r from-green-600 to-green-700";switch(ut){case"/sign-in":return"bg-gradient-to-r from-blue-600 to-blue-700";case"/sign-up":return"bg-gradient-to-r from-green-600 to-green-700";case"/forgot-password":return"bg-gradient-to-r from-red-600 to-red-700";case"/change-password":case"/admin/change-password":return"bg-gradient-to-r from-blue-600 to-blue-700";default:return"bg-gradient-to-r from-blue-700 to-purple-700"}},ye=()=>{const ut=S.pathname,Lt=new URLSearchParams(S.search);if(ut==="/forgot-password"&&Lt.get("step")==="2")return"bg-green-500 hover:bg-green-600";switch(ut){case"/sign-in":return"bg-blue-500 hover:bg-blue-600";case"/sign-up":return"bg-green-500 hover:bg-green-600";case"/forgot-password":return"bg-red-500 hover:bg-red-600";case"/change-password":case"/admin/change-password":return"bg-blue-500 hover:bg-blue-600";default:return"bg-blue-500 hover:bg-blue-600"}},Pe=()=>{const ut=S.pathname,Lt=new URLSearchParams(S.search);if(ut==="/forgot-password"&&Lt.get("step")==="2")return"focus-within:ring-green-500";switch(ut){case"/sign-up":return"focus-within:ring-green-500";case"/forgot-password":return"focus-within:ring-red-500";default:return"focus-within:ring-blue-500"}},Ae=async()=>{try{const ut=await fetch(`${pe}/api/admin/pending-requests`,{headers:{"Content-Type":"application/json"},credentials:"include"});if(ut.ok){const Lt=await ut.json();Z(Lt.length)}}catch(ut){console.error("Failed to fetch pending count:",ut)}},Ke=async()=>{try{const ut=await fetch(`${pe}/api/bookings`,{headers:{"Content-Type":"application/json"},credentials:"include"});if(ut.ok){const Lt=await ut.json();oe(Lt.length)}}catch(ut){console.error("Failed to fetch appointment count:",ut)}},it=async()=>{try{g(S1());const Lt=await(await fetch(`${pe}/api/auth/signout`,{credentials:"include"})).json();Lt.success===!1?g(xp(Lt.message)):(g(Xa()),await Fg.purge(),Dm(),localStorage.removeItem("accessToken"),document.cookie="access_token=; Max-Age=0; path=/; domain="+window.location.hostname+"; secure; samesite=None",hi.info("You have been signed out."),b("/"))}catch(ut){g(xp(ut.message))}},rt=ut=>{ut.preventDefault(),I.trim()&&(b(`/admin/explore?searchTerm=${encodeURIComponent(I)}`),N("")),le(!1),te(!1)};return x.jsxs("header",{className:`relative ${xe()} shadow-xl border-b border-white/20 sticky top-0 z-50 transition-all duration-300 ${V?"opacity-100":"opacity-0"}`,children:[x.jsx("div",{className:"bg-black/20 border-b border-white/10",children:x.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:x.jsxs("div",{className:"flex items-center justify-between py-1 text-sm text-white/80",children:[x.jsxs("div",{className:"flex items-center gap-4",children:[x.jsxs("span",{className:"flex items-center gap-2",children:[x.jsx(g2,{className:"text-yellow-400"}),x.jsx("span",{children:"Admin Control Panel"})]}),h&&x.jsx("span",{className:"text-xs bg-white/20 px-2 py-1 rounded-full",children:h.role==="rootadmin"?"Super Admin":"Administrator"})]}),x.jsxs("div",{className:"flex items-center gap-4",children:[x.jsxs("div",{className:"hidden md:flex items-center gap-4",children:[x.jsx("span",{children:" Secure Admin Access"}),x.jsx("span",{children:" Real-time Analytics"})]}),h&&x.jsxs("button",{onClick:it,className:"md:hidden flex items-center gap-1 text-white/80 hover:text-white transition-colors text-sm",title:"Sign Out",children:[x.jsx(l0,{className:"text-xs"}),x.jsx("span",{className:"text-xs",children:"Sign Out"})]})]})]})})}),x.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:x.jsxs("div",{className:"flex items-center justify-between py-2",children:[x.jsx(Ds,{to:"/admin",className:"flex-shrink-0 group",children:x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsxs("div",{className:"relative",children:[x.jsx("div",{className:"p-2 bg-white/10 backdrop-blur-sm rounded-xl border border-white/20 shadow-lg group-hover:shadow-xl transition-all duration-300 group-hover:scale-105",children:x.jsx(g2,{className:"text-xl sm:text-2xl text-yellow-400 drop-shadow-lg"})}),x.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-xl blur opacity-30 group-hover:opacity-50 transition-opacity duration-300"})]}),x.jsxs("div",{children:[x.jsxs("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-white drop-shadow-lg",children:[x.jsx("span",{className:"bg-gradient-to-r from-yellow-400 via-orange-400 to-red-400 bg-clip-text text-transparent",children:"Admin"}),x.jsx("span",{className:"bg-gradient-to-r from-blue-400 via-purple-400 to-indigo-400 bg-clip-text text-transparent ml-1",children:"Panel"})]}),x.jsx("p",{className:"text-xs text-white/70 font-medium tracking-wider uppercase",children:"Management Dashboard"})]})]})}),x.jsxs("nav",{className:"hidden lg:flex items-center space-x-2",children:[x.jsx("div",{className:"flex items-center",children:Se?x.jsxs("form",{onSubmit:rt,className:"flex items-center bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg overflow-hidden focus-within:ring-2 focus-within:ring-yellow-300 focus-within:bg-white/20 transition-all duration-300 w-48",children:[x.jsx("input",{ref:ge,type:"text",placeholder:"Search...",value:I,onChange:ut=>N(ut.target.value),onBlur:()=>te(!1),className:"px-3 py-2 outline-none w-full text-white placeholder-white/70 bg-transparent text-sm"}),x.jsx("button",{className:"bg-yellow-400 hover:bg-yellow-500 text-gray-800 p-2 transition-colors",type:"submit",children:x.jsx(Cm,{className:"text-sm"})})]}):x.jsx("button",{className:"p-2 text-white hover:text-yellow-300 focus:outline-none transition-all duration-300 hover:bg-white/10 rounded-lg",onClick:()=>te(!0),"aria-label":"Open search",children:x.jsx(Cm,{className:"text-base"})})}),x.jsx($4,{pendingCount:q,handleSignout:it,currentUser:h})]}),x.jsx("div",{className:"lg:hidden",children:x.jsx("button",{className:"p-2 text-white hover:text-yellow-300 focus:outline-none transition-all duration-300 hover:bg-white/10 rounded-lg",onClick:()=>le(ut=>!ut),"aria-label":"Open navigation menu",children:x.jsx("div",{className:`transition-transform duration-300 ${ze?"animate-hamburger-to-x":"animate-x-to-hamburger"}`,children:ze?x.jsx(ho,{className:"text-lg"}):x.jsx(r6,{className:"text-lg"})})})})]})}),ze&&x.jsx("div",{className:"lg:hidden",children:x.jsxs("div",{className:"fixed inset-0 z-50",children:[x.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-md animate-mobile-backdrop-in",onClick:()=>le(!1)}),x.jsx("div",{className:"relative ml-auto w-80 max-w-sm h-full bg-white shadow-2xl transform transition-transform duration-300 ease-in-out animate-mobile-menu-in",children:x.jsxs("div",{className:"flex flex-col h-full",children:[x.jsx("div",{className:`${xe()} p-6 text-white`,children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("h2",{className:"text-xl font-bold",children:"Admin Menu"}),x.jsx("button",{className:"p-2 hover:bg-white/20 rounded-lg transition-colors",onClick:()=>le(!1),"aria-label":"Close menu",children:x.jsx(ho,{className:"text-xl"})})]})}),x.jsx("div",{className:"p-6 border-b border-gray-200",children:x.jsxs("form",{onSubmit:rt,className:`flex items-center bg-gray-50 rounded-xl overflow-hidden focus-within:ring-2 ${Pe()} focus-within:bg-white transition-all`,children:[x.jsx("input",{type:"text",placeholder:"Search properties...",value:I,onChange:ut=>N(ut.target.value),className:"px-4 py-3 outline-none w-full text-gray-800 bg-transparent"}),x.jsx("button",{className:`${ye()} text-white p-3 transition-colors`,type:"submit",children:x.jsx(Cm,{})})]})}),x.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:x.jsx($4,{mobile:!0,onNavigate:()=>le(!1),pendingCount:q,handleSignout:it,currentUser:h})})]})})]})})]})}function $4({mobile:h=!1,onNavigate:g,pendingCount:b,handleSignout:S,currentUser:I}){const N=Pl();return x.jsxs("ul",{className:`${h?"flex flex-col gap-1":"flex items-center space-x-1"}`,children:[x.jsx(Ds,{to:"/admin",onClick:g,children:x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[x.jsx(Bg,{className:`${h?"text-lg text-blue-500":"text-base text-blue-500"}`}),x.jsx("span",{children:"Dashboard"})]})}),x.jsx(Ds,{to:"/admin/create-listing",onClick:g,children:x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-1":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[x.jsx(tb,{className:`${h?"text-lg text-green-500":"text-base text-green-500"}`}),x.jsx("span",{children:"Add Property"})]})}),x.jsx(Ds,{to:"/admin/listings",onClick:g,children:x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-2":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[x.jsx(eb,{className:`${h?"text-lg text-purple-500":"text-base text-purple-500"}`}),x.jsx("span",{children:"All Listings"})]})}),x.jsx(Ds,{to:"/admin/services",onClick:g,children:x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-3":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[x.jsx(l6,{className:`${h?"text-lg text-purple-600":"text-base text-purple-600"}`}),x.jsx("span",{children:"Services"})]})}),I&&(I.role==="admin"||I.role==="rootadmin")&&I.adminApprovalStatus==="approved"&&x.jsx(Ds,{to:"/admin/requests",onClick:g,children:x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium relative animate-mobile-item-in":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base relative flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[x.jsx(g2,{className:`${h?"text-lg text-orange-500":"text-base text-orange-500"}`}),x.jsx("span",{children:"Requests"}),b>0&&x.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center",children:b})]})}),x.jsx(Ds,{to:"/admin/about",onClick:g,children:x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-1":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[x.jsx(o6,{className:`${h?"text-lg text-indigo-500":"text-base text-indigo-500"}`}),x.jsx("span",{children:"About"})]})}),x.jsx(Ds,{to:"/admin/explore",onClick:g,children:x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium animate-mobile-item-in-delay-2":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,children:[x.jsx(s6,{className:`${h?"text-lg text-teal-500":"text-base text-teal-500"}`}),x.jsx("span",{children:"Explore"})]})}),x.jsx("li",{className:`${h?"flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium":"flex items-center"}`,children:x.jsx(g6,{mobile:h})}),x.jsxs("li",{className:`${h?"flex items-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 text-gray-700 font-medium cursor-pointer animate-mobile-item-in":"text-white hover:text-yellow-300 transition-colors duration-300 font-medium text-base cursor-pointer flex items-center gap-1 px-2 py-1 rounded-lg hover:bg-white/10"}`,onClick:()=>{S(),g&&g()},children:[x.jsx(l0,{className:`${h?"text-lg text-red-500":"text-base text-red-500"}`}),x.jsx("span",{children:"Sign Out"})]}),I&&!h&&x.jsx("li",{children:x.jsx("div",{className:"cursor-pointer transition-transform duration-300 hover:scale-110",onClick:()=>{N("/admin/profile"),g&&g()},title:"Profile",children:x.jsx(h1,{user:I,size:"h-7 w-7",textSize:"text-xs",showBorder:!0})})}),I&&h&&x.jsx("li",{children:x.jsxs("div",{className:"cursor-pointer transition-transform duration-300 hover:scale-110 p-3 rounded-lg hover:bg-gray-50 transition-all duration-300 flex items-center gap-3 text-gray-700 font-medium",onClick:()=>{N("/admin/profile"),g&&g()},title:"Profile",children:[x.jsx(h1,{user:I,size:"h-7 w-7",textSize:"text-xs",showBorder:!0}),x.jsx("span",{children:"Profile"})]})})]})}const kz="/assets/duck-go-final-B0lh_5LI.gif",vc=(h,g="UrbanSetu")=>{he.useEffect(()=>{const b=h?`${h}  ${g}`:g;return document.title=b,()=>{document.title="UrbanSetu  Smart Real Estate Platform for Buying, Selling & Renting Properties"}},[h,g])};function sf(){vc("404 Not Found - Page Not Found");const{currentUser:h}=fo(b=>b.user);let g="/";return h&&(h.role==="admin"||h.role==="rootadmin"?g="/admin":g="/user"),x.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-blue-50 to-purple-100 p-8",children:x.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-10 flex flex-col items-center",children:[x.jsx("img",{src:kz,alt:"Lost duck",className:"w-100 h-100 lg:w-72 lg:h-72 object-contain mb-0"}),x.jsx("h1",{className:"text-4xl font-extrabold text-blue-700 mb-2",children:"404"}),x.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Page Not Found"}),x.jsx("p",{className:"text-gray-600 mb-6 text-center max-w-md",children:"Sorry, the page you are looking for does not exist or has been moved."}),x.jsx(Ds,{to:g,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all font-semibold",children:"Go to Home"})]})})}function Nz({bootstrapped:h}){const{currentUser:g,loading:b}=fo(S=>S.user);return!h||b?x.jsx("div",{className:"flex items-center justify-center min-h-screen",children:x.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):g&&g.role==="user"?x.jsx(Qv,{}):x.jsx(sf,{})}function jz({bootstrapped:h}){const{currentUser:g,loading:b}=fo(S=>S.user);if(!h||b)return x.jsx("div",{className:"flex items-center justify-center min-h-screen",children:x.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});if(g&&(g.role==="admin"||g.role==="rootadmin")){if(g.isDefaultAdmin)return x.jsx(Qv,{});if(g.adminApprovalStatus==="approved")return x.jsx(Qv,{})}return x.jsx(sf,{})}const E6=he.createContext(),dv="https://urbansetu.onrender.com",Bz=({children:h})=>{const{currentUser:g}=fo(Q=>Q.user),[b,S]=he.useState([]),[I,N]=he.useState(!1),V=async()=>{if(!g){S([]);return}N(!0);try{const Q=await fetch(`${dv}/api/wishlist/user/${g._id}`,{credentials:"include"});if(Q.ok){const oe=await Q.json();if(!Array.isArray(oe)){S([]),hi.error("Session expired or unauthorized. Please sign in again."),window.location.href="/sign-in";return}const pe=oe.map(ze=>ze.listingId).filter(ze=>ze!==null);S(pe)}else Q.status===401?(S([]),hi.error("Session expired or unauthorized. Please sign in again."),window.location.href="/sign-in"):(console.error("Failed to fetch wishlist"),S([]))}catch(Q){console.error("Error fetching wishlist:",Q),S([])}finally{N(!1)}};he.useEffect(()=>{function Q({type:oe,listing:pe}){S(ze=>oe==="add"?ze.find(le=>le._id===pe._id)?ze:[...ze,pe]:oe==="remove"?ze.filter(le=>le._id!==pe._id):ze)}return fn.on("wishlist_update",Q),()=>{fn.off("wishlist_update",Q)}},[]);const s=async Q=>{if(!g){console.error("User must be logged in to add to wishlist");return}S(oe=>oe.find(pe=>pe._id===Q._id)?oe:(hi.success("Property added to your wishlist!"),[...oe,Q])),fn.emit("wishlist_update",{type:"add",listing:Q});try{const oe=await fetch(`${dv}/api/wishlist/add`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({listingId:Q._id})});if(!oe.ok){S(ze=>ze.filter(le=>le._id!==Q._id));const pe=await oe.json();console.error("Failed to add to wishlist:",pe.message)}}catch(oe){S(pe=>pe.filter(ze=>ze._id!==Q._id)),console.error("Error adding to wishlist:",oe)}},q=async Q=>{if(!g)return console.error("User must be logged in to remove from wishlist"),{success:!1,message:"User must be logged in to remove from wishlist"};S(oe=>oe.filter(pe=>pe._id!==Q)),fn.emit("wishlist_update",{type:"remove",listing:{_id:Q}});try{const oe=await fetch(`${dv}/api/wishlist/remove/${Q}`,{method:"DELETE",credentials:"include"});if(!oe.ok){V();const pe=await oe.json();return console.error("Failed to remove from wishlist:",pe.message),{success:!1,message:"Failed to remove property. Please try again."}}return hi.success("Property removed from your wishlist."),{success:!0}}catch(oe){return V(),console.error("Error removing from wishlist:",oe),{success:!1,message:"Failed to remove property. Please try again."}}},Z=Q=>b.some(oe=>oe._id===Q);return he.useEffect(()=>{V()},[g]),x.jsx(E6.Provider,{value:{wishlist:b,addToWishlist:s,removeFromWishlist:q,isInWishlist:Z,loading:I},children:h})},dj=()=>he.useContext(E6);function A6(h,g){return function(){return h.apply(g,arguments)}}const{toString:Fz}=Object.prototype,{getPrototypeOf:rb}=Object,{iterator:z1,toStringTag:C6}=Symbol,D1=(h=>g=>{const b=Fz.call(g);return h[b]||(h[b]=b.slice(8,-1).toLowerCase())})(Object.create(null)),ah=h=>(h=h.toLowerCase(),g=>D1(g)===h),P1=h=>g=>typeof g===h,{isArray:Gg}=Array,u0=P1("undefined");function m0(h){return h!==null&&!u0(h)&&h.constructor!==null&&!u0(h.constructor)&&zl(h.constructor.isBuffer)&&h.constructor.isBuffer(h)}const R6=ah("ArrayBuffer");function Uz(h){let g;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?g=ArrayBuffer.isView(h):g=h&&h.buffer&&R6(h.buffer),g}const Vz=P1("string"),zl=P1("function"),M6=P1("number"),g0=h=>h!==null&&typeof h=="object",Hz=h=>h===!0||h===!1,Gy=h=>{if(D1(h)!=="object")return!1;const g=rb(h);return(g===null||g===Object.prototype||Object.getPrototypeOf(g)===null)&&!(C6 in h)&&!(z1 in h)},qz=h=>{if(!g0(h)||m0(h))return!1;try{return Object.keys(h).length===0&&Object.getPrototypeOf(h)===Object.prototype}catch{return!1}},Gz=ah("Date"),$z=ah("File"),Zz=ah("Blob"),Wz=ah("FileList"),Xz=h=>g0(h)&&zl(h.pipe),Yz=h=>{let g;return h&&(typeof FormData=="function"&&h instanceof FormData||zl(h.append)&&((g=D1(h))==="formdata"||g==="object"&&zl(h.toString)&&h.toString()==="[object FormData]"))},Kz=ah("URLSearchParams"),[Jz,Qz,eD,tD]=["ReadableStream","Request","Response","Headers"].map(ah),iD=h=>h.trim?h.trim():h.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function _0(h,g,{allOwnKeys:b=!1}={}){if(h===null||typeof h>"u")return;let S,I;if(typeof h!="object"&&(h=[h]),Gg(h))for(S=0,I=h.length;S<I;S++)g.call(null,h[S],S,h);else{if(m0(h))return;const N=b?Object.getOwnPropertyNames(h):Object.keys(h),V=N.length;let s;for(S=0;S<V;S++)s=N[S],g.call(null,h[s],s,h)}}function I6(h,g){if(m0(h))return null;g=g.toLowerCase();const b=Object.keys(h);let S=b.length,I;for(;S-- >0;)if(I=b[S],g===I.toLowerCase())return I;return null}const Sm=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,z6=h=>!u0(h)&&h!==Sm;function w2(){const{caseless:h}=z6(this)&&this||{},g={},b=(S,I)=>{const N=h&&I6(g,I)||I;Gy(g[N])&&Gy(S)?g[N]=w2(g[N],S):Gy(S)?g[N]=w2({},S):Gg(S)?g[N]=S.slice():g[N]=S};for(let S=0,I=arguments.length;S<I;S++)arguments[S]&&_0(arguments[S],b);return g}const nD=(h,g,b,{allOwnKeys:S}={})=>(_0(g,(I,N)=>{b&&zl(I)?h[N]=A6(I,b):h[N]=I},{allOwnKeys:S}),h),rD=h=>(h.charCodeAt(0)===65279&&(h=h.slice(1)),h),sD=(h,g,b,S)=>{h.prototype=Object.create(g.prototype,S),h.prototype.constructor=h,Object.defineProperty(h,"super",{value:g.prototype}),b&&Object.assign(h.prototype,b)},aD=(h,g,b,S)=>{let I,N,V;const s={};if(g=g||{},h==null)return g;do{for(I=Object.getOwnPropertyNames(h),N=I.length;N-- >0;)V=I[N],(!S||S(V,h,g))&&!s[V]&&(g[V]=h[V],s[V]=!0);h=b!==!1&&rb(h)}while(h&&(!b||b(h,g))&&h!==Object.prototype);return g},oD=(h,g,b)=>{h=String(h),(b===void 0||b>h.length)&&(b=h.length),b-=g.length;const S=h.indexOf(g,b);return S!==-1&&S===b},lD=h=>{if(!h)return null;if(Gg(h))return h;let g=h.length;if(!M6(g))return null;const b=new Array(g);for(;g-- >0;)b[g]=h[g];return b},cD=(h=>g=>h&&g instanceof h)(typeof Uint8Array<"u"&&rb(Uint8Array)),uD=(h,g)=>{const S=(h&&h[z1]).call(h);let I;for(;(I=S.next())&&!I.done;){const N=I.value;g.call(h,N[0],N[1])}},hD=(h,g)=>{let b;const S=[];for(;(b=h.exec(g))!==null;)S.push(b);return S},dD=ah("HTMLFormElement"),fD=h=>h.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(b,S,I){return S.toUpperCase()+I}),Z4=(({hasOwnProperty:h})=>(g,b)=>h.call(g,b))(Object.prototype),pD=ah("RegExp"),D6=(h,g)=>{const b=Object.getOwnPropertyDescriptors(h),S={};_0(b,(I,N)=>{let V;(V=g(I,N,h))!==!1&&(S[N]=V||I)}),Object.defineProperties(h,S)},mD=h=>{D6(h,(g,b)=>{if(zl(h)&&["arguments","caller","callee"].indexOf(b)!==-1)return!1;const S=h[b];if(zl(S)){if(g.enumerable=!1,"writable"in g){g.writable=!1;return}g.set||(g.set=()=>{throw Error("Can not rewrite read-only method '"+b+"'")})}})},gD=(h,g)=>{const b={},S=I=>{I.forEach(N=>{b[N]=!0})};return Gg(h)?S(h):S(String(h).split(g)),b},_D=()=>{},yD=(h,g)=>h!=null&&Number.isFinite(h=+h)?h:g;function xD(h){return!!(h&&zl(h.append)&&h[C6]==="FormData"&&h[z1])}const vD=h=>{const g=new Array(10),b=(S,I)=>{if(g0(S)){if(g.indexOf(S)>=0)return;if(m0(S))return S;if(!("toJSON"in S)){g[I]=S;const N=Gg(S)?[]:{};return _0(S,(V,s)=>{const q=b(V,I+1);!u0(q)&&(N[s]=q)}),g[I]=void 0,N}}return S};return b(h,0)},bD=ah("AsyncFunction"),wD=h=>h&&(g0(h)||zl(h))&&zl(h.then)&&zl(h.catch),P6=((h,g)=>h?setImmediate:g?((b,S)=>(Sm.addEventListener("message",({source:I,data:N})=>{I===Sm&&N===b&&S.length&&S.shift()()},!1),I=>{S.push(I),Sm.postMessage(b,"*")}))(`axios@${Math.random()}`,[]):b=>setTimeout(b))(typeof setImmediate=="function",zl(Sm.postMessage)),TD=typeof queueMicrotask<"u"?queueMicrotask.bind(Sm):typeof process<"u"&&process.nextTick||P6,SD=h=>h!=null&&zl(h[z1]),Kt={isArray:Gg,isArrayBuffer:R6,isBuffer:m0,isFormData:Yz,isArrayBufferView:Uz,isString:Vz,isNumber:M6,isBoolean:Hz,isObject:g0,isPlainObject:Gy,isEmptyObject:qz,isReadableStream:Jz,isRequest:Qz,isResponse:eD,isHeaders:tD,isUndefined:u0,isDate:Gz,isFile:$z,isBlob:Zz,isRegExp:pD,isFunction:zl,isStream:Xz,isURLSearchParams:Kz,isTypedArray:cD,isFileList:Wz,forEach:_0,merge:w2,extend:nD,trim:iD,stripBOM:rD,inherits:sD,toFlatObject:aD,kindOf:D1,kindOfTest:ah,endsWith:oD,toArray:lD,forEachEntry:uD,matchAll:hD,isHTMLForm:dD,hasOwnProperty:Z4,hasOwnProp:Z4,reduceDescriptors:D6,freezeMethods:mD,toObjectSet:gD,toCamelCase:fD,noop:_D,toFiniteNumber:yD,findKey:I6,global:Sm,isContextDefined:z6,isSpecCompliantForm:xD,toJSONObject:vD,isAsyncFn:bD,isThenable:wD,setImmediate:P6,asap:TD,isIterable:SD};function lr(h,g,b,S,I){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=h,this.name="AxiosError",g&&(this.code=g),b&&(this.config=b),S&&(this.request=S),I&&(this.response=I,this.status=I.status?I.status:null)}Kt.inherits(lr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Kt.toJSONObject(this.config),code:this.code,status:this.status}}});const L6=lr.prototype,O6={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(h=>{O6[h]={value:h}});Object.defineProperties(lr,O6);Object.defineProperty(L6,"isAxiosError",{value:!0});lr.from=(h,g,b,S,I,N)=>{const V=Object.create(L6);return Kt.toFlatObject(h,V,function(q){return q!==Error.prototype},s=>s!=="isAxiosError"),lr.call(V,h.message,g,b,S,I),V.cause=h,V.name=h.name,N&&Object.assign(V,N),V};const ED=null;function T2(h){return Kt.isPlainObject(h)||Kt.isArray(h)}function k6(h){return Kt.endsWith(h,"[]")?h.slice(0,-2):h}function W4(h,g,b){return h?h.concat(g).map(function(I,N){return I=k6(I),!b&&N?"["+I+"]":I}).join(b?".":""):g}function AD(h){return Kt.isArray(h)&&!h.some(T2)}const CD=Kt.toFlatObject(Kt,{},null,function(g){return/^is[A-Z]/.test(g)});function L1(h,g,b){if(!Kt.isObject(h))throw new TypeError("target must be an object");g=g||new FormData,b=Kt.toFlatObject(b,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Se,te){return!Kt.isUndefined(te[Se])});const S=b.metaTokens,I=b.visitor||Q,N=b.dots,V=b.indexes,q=(b.Blob||typeof Blob<"u"&&Blob)&&Kt.isSpecCompliantForm(g);if(!Kt.isFunction(I))throw new TypeError("visitor must be a function");function Z(le){if(le===null)return"";if(Kt.isDate(le))return le.toISOString();if(Kt.isBoolean(le))return le.toString();if(!q&&Kt.isBlob(le))throw new lr("Blob is not supported. Use a Buffer instead.");return Kt.isArrayBuffer(le)||Kt.isTypedArray(le)?q&&typeof Blob=="function"?new Blob([le]):Buffer.from(le):le}function Q(le,Se,te){let ge=le;if(le&&!te&&typeof le=="object"){if(Kt.endsWith(Se,"{}"))Se=S?Se:Se.slice(0,-2),le=JSON.stringify(le);else if(Kt.isArray(le)&&AD(le)||(Kt.isFileList(le)||Kt.endsWith(Se,"[]"))&&(ge=Kt.toArray(le)))return Se=k6(Se),ge.forEach(function(ye,Pe){!(Kt.isUndefined(ye)||ye===null)&&g.append(V===!0?W4([Se],Pe,N):V===null?Se:Se+"[]",Z(ye))}),!1}return T2(le)?!0:(g.append(W4(te,Se,N),Z(le)),!1)}const oe=[],pe=Object.assign(CD,{defaultVisitor:Q,convertValue:Z,isVisitable:T2});function ze(le,Se){if(!Kt.isUndefined(le)){if(oe.indexOf(le)!==-1)throw Error("Circular reference detected in "+Se.join("."));oe.push(le),Kt.forEach(le,function(ge,xe){(!(Kt.isUndefined(ge)||ge===null)&&I.call(g,ge,Kt.isString(xe)?xe.trim():xe,Se,pe))===!0&&ze(ge,Se?Se.concat(xe):[xe])}),oe.pop()}}if(!Kt.isObject(h))throw new TypeError("data must be an object");return ze(h),g}function X4(h){const g={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(h).replace(/[!'()~]|%20|%00/g,function(S){return g[S]})}function sb(h,g){this._pairs=[],h&&L1(h,this,g)}const N6=sb.prototype;N6.append=function(g,b){this._pairs.push([g,b])};N6.toString=function(g){const b=g?function(S){return g.call(this,S,X4)}:X4;return this._pairs.map(function(I){return b(I[0])+"="+b(I[1])},"").join("&")};function RD(h){return encodeURIComponent(h).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function j6(h,g,b){if(!g)return h;const S=b&&b.encode||RD;Kt.isFunction(b)&&(b={serialize:b});const I=b&&b.serialize;let N;if(I?N=I(g,b):N=Kt.isURLSearchParams(g)?g.toString():new sb(g,b).toString(S),N){const V=h.indexOf("#");V!==-1&&(h=h.slice(0,V)),h+=(h.indexOf("?")===-1?"?":"&")+N}return h}class Y4{constructor(){this.handlers=[]}use(g,b,S){return this.handlers.push({fulfilled:g,rejected:b,synchronous:S?S.synchronous:!1,runWhen:S?S.runWhen:null}),this.handlers.length-1}eject(g){this.handlers[g]&&(this.handlers[g]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(g){Kt.forEach(this.handlers,function(S){S!==null&&g(S)})}}const B6={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},MD=typeof URLSearchParams<"u"?URLSearchParams:sb,ID=typeof FormData<"u"?FormData:null,zD=typeof Blob<"u"?Blob:null,DD={isBrowser:!0,classes:{URLSearchParams:MD,FormData:ID,Blob:zD},protocols:["http","https","file","blob","url","data"]},ab=typeof window<"u"&&typeof document<"u",S2=typeof navigator=="object"&&navigator||void 0,PD=ab&&(!S2||["ReactNative","NativeScript","NS"].indexOf(S2.product)<0),LD=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",OD=ab&&window.location.href||"http://localhost",kD=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ab,hasStandardBrowserEnv:PD,hasStandardBrowserWebWorkerEnv:LD,navigator:S2,origin:OD},Symbol.toStringTag,{value:"Module"})),Oo={...kD,...DD};function ND(h,g){return L1(h,new Oo.classes.URLSearchParams,{visitor:function(b,S,I,N){return Oo.isNode&&Kt.isBuffer(b)?(this.append(S,b.toString("base64")),!1):N.defaultVisitor.apply(this,arguments)},...g})}function jD(h){return Kt.matchAll(/\w+|\[(\w*)]/g,h).map(g=>g[0]==="[]"?"":g[1]||g[0])}function BD(h){const g={},b=Object.keys(h);let S;const I=b.length;let N;for(S=0;S<I;S++)N=b[S],g[N]=h[N];return g}function F6(h){function g(b,S,I,N){let V=b[N++];if(V==="__proto__")return!0;const s=Number.isFinite(+V),q=N>=b.length;return V=!V&&Kt.isArray(I)?I.length:V,q?(Kt.hasOwnProp(I,V)?I[V]=[I[V],S]:I[V]=S,!s):((!I[V]||!Kt.isObject(I[V]))&&(I[V]=[]),g(b,S,I[V],N)&&Kt.isArray(I[V])&&(I[V]=BD(I[V])),!s)}if(Kt.isFormData(h)&&Kt.isFunction(h.entries)){const b={};return Kt.forEachEntry(h,(S,I)=>{g(jD(S),I,b,0)}),b}return null}function FD(h,g,b){if(Kt.isString(h))try{return(g||JSON.parse)(h),Kt.trim(h)}catch(S){if(S.name!=="SyntaxError")throw S}return(b||JSON.stringify)(h)}const y0={transitional:B6,adapter:["xhr","http","fetch"],transformRequest:[function(g,b){const S=b.getContentType()||"",I=S.indexOf("application/json")>-1,N=Kt.isObject(g);if(N&&Kt.isHTMLForm(g)&&(g=new FormData(g)),Kt.isFormData(g))return I?JSON.stringify(F6(g)):g;if(Kt.isArrayBuffer(g)||Kt.isBuffer(g)||Kt.isStream(g)||Kt.isFile(g)||Kt.isBlob(g)||Kt.isReadableStream(g))return g;if(Kt.isArrayBufferView(g))return g.buffer;if(Kt.isURLSearchParams(g))return b.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),g.toString();let s;if(N){if(S.indexOf("application/x-www-form-urlencoded")>-1)return ND(g,this.formSerializer).toString();if((s=Kt.isFileList(g))||S.indexOf("multipart/form-data")>-1){const q=this.env&&this.env.FormData;return L1(s?{"files[]":g}:g,q&&new q,this.formSerializer)}}return N||I?(b.setContentType("application/json",!1),FD(g)):g}],transformResponse:[function(g){const b=this.transitional||y0.transitional,S=b&&b.forcedJSONParsing,I=this.responseType==="json";if(Kt.isResponse(g)||Kt.isReadableStream(g))return g;if(g&&Kt.isString(g)&&(S&&!this.responseType||I)){const V=!(b&&b.silentJSONParsing)&&I;try{return JSON.parse(g)}catch(s){if(V)throw s.name==="SyntaxError"?lr.from(s,lr.ERR_BAD_RESPONSE,this,null,this.response):s}}return g}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Oo.classes.FormData,Blob:Oo.classes.Blob},validateStatus:function(g){return g>=200&&g<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Kt.forEach(["delete","get","head","post","put","patch"],h=>{y0.headers[h]={}});const UD=Kt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),VD=h=>{const g={};let b,S,I;return h&&h.split(`
`).forEach(function(V){I=V.indexOf(":"),b=V.substring(0,I).trim().toLowerCase(),S=V.substring(I+1).trim(),!(!b||g[b]&&UD[b])&&(b==="set-cookie"?g[b]?g[b].push(S):g[b]=[S]:g[b]=g[b]?g[b]+", "+S:S)}),g},K4=Symbol("internals");function J_(h){return h&&String(h).trim().toLowerCase()}function $y(h){return h===!1||h==null?h:Kt.isArray(h)?h.map($y):String(h)}function HD(h){const g=Object.create(null),b=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let S;for(;S=b.exec(h);)g[S[1]]=S[2];return g}const qD=h=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(h.trim());function fv(h,g,b,S,I){if(Kt.isFunction(S))return S.call(this,g,b);if(I&&(g=b),!!Kt.isString(g)){if(Kt.isString(S))return g.indexOf(S)!==-1;if(Kt.isRegExp(S))return S.test(g)}}function GD(h){return h.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(g,b,S)=>b.toUpperCase()+S)}function $D(h,g){const b=Kt.toCamelCase(" "+g);["get","set","has"].forEach(S=>{Object.defineProperty(h,S+b,{value:function(I,N,V){return this[S].call(this,g,I,N,V)},configurable:!0})})}let Dl=class{constructor(g){g&&this.set(g)}set(g,b,S){const I=this;function N(s,q,Z){const Q=J_(q);if(!Q)throw new Error("header name must be a non-empty string");const oe=Kt.findKey(I,Q);(!oe||I[oe]===void 0||Z===!0||Z===void 0&&I[oe]!==!1)&&(I[oe||q]=$y(s))}const V=(s,q)=>Kt.forEach(s,(Z,Q)=>N(Z,Q,q));if(Kt.isPlainObject(g)||g instanceof this.constructor)V(g,b);else if(Kt.isString(g)&&(g=g.trim())&&!qD(g))V(VD(g),b);else if(Kt.isObject(g)&&Kt.isIterable(g)){let s={},q,Z;for(const Q of g){if(!Kt.isArray(Q))throw TypeError("Object iterator must return a key-value pair");s[Z=Q[0]]=(q=s[Z])?Kt.isArray(q)?[...q,Q[1]]:[q,Q[1]]:Q[1]}V(s,b)}else g!=null&&N(b,g,S);return this}get(g,b){if(g=J_(g),g){const S=Kt.findKey(this,g);if(S){const I=this[S];if(!b)return I;if(b===!0)return HD(I);if(Kt.isFunction(b))return b.call(this,I,S);if(Kt.isRegExp(b))return b.exec(I);throw new TypeError("parser must be boolean|regexp|function")}}}has(g,b){if(g=J_(g),g){const S=Kt.findKey(this,g);return!!(S&&this[S]!==void 0&&(!b||fv(this,this[S],S,b)))}return!1}delete(g,b){const S=this;let I=!1;function N(V){if(V=J_(V),V){const s=Kt.findKey(S,V);s&&(!b||fv(S,S[s],s,b))&&(delete S[s],I=!0)}}return Kt.isArray(g)?g.forEach(N):N(g),I}clear(g){const b=Object.keys(this);let S=b.length,I=!1;for(;S--;){const N=b[S];(!g||fv(this,this[N],N,g,!0))&&(delete this[N],I=!0)}return I}normalize(g){const b=this,S={};return Kt.forEach(this,(I,N)=>{const V=Kt.findKey(S,N);if(V){b[V]=$y(I),delete b[N];return}const s=g?GD(N):String(N).trim();s!==N&&delete b[N],b[s]=$y(I),S[s]=!0}),this}concat(...g){return this.constructor.concat(this,...g)}toJSON(g){const b=Object.create(null);return Kt.forEach(this,(S,I)=>{S!=null&&S!==!1&&(b[I]=g&&Kt.isArray(S)?S.join(", "):S)}),b}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([g,b])=>g+": "+b).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(g){return g instanceof this?g:new this(g)}static concat(g,...b){const S=new this(g);return b.forEach(I=>S.set(I)),S}static accessor(g){const S=(this[K4]=this[K4]={accessors:{}}).accessors,I=this.prototype;function N(V){const s=J_(V);S[s]||($D(I,V),S[s]=!0)}return Kt.isArray(g)?g.forEach(N):N(g),this}};Dl.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Kt.reduceDescriptors(Dl.prototype,({value:h},g)=>{let b=g[0].toUpperCase()+g.slice(1);return{get:()=>h,set(S){this[b]=S}}});Kt.freezeMethods(Dl);function pv(h,g){const b=this||y0,S=g||b,I=Dl.from(S.headers);let N=S.data;return Kt.forEach(h,function(s){N=s.call(b,N,I.normalize(),g?g.status:void 0)}),I.normalize(),N}function U6(h){return!!(h&&h.__CANCEL__)}function $g(h,g,b){lr.call(this,h??"canceled",lr.ERR_CANCELED,g,b),this.name="CanceledError"}Kt.inherits($g,lr,{__CANCEL__:!0});function V6(h,g,b){const S=b.config.validateStatus;!b.status||!S||S(b.status)?h(b):g(new lr("Request failed with status code "+b.status,[lr.ERR_BAD_REQUEST,lr.ERR_BAD_RESPONSE][Math.floor(b.status/100)-4],b.config,b.request,b))}function ZD(h){const g=/^([-+\w]{1,25})(:?\/\/|:)/.exec(h);return g&&g[1]||""}function WD(h,g){h=h||10;const b=new Array(h),S=new Array(h);let I=0,N=0,V;return g=g!==void 0?g:1e3,function(q){const Z=Date.now(),Q=S[N];V||(V=Z),b[I]=q,S[I]=Z;let oe=N,pe=0;for(;oe!==I;)pe+=b[oe++],oe=oe%h;if(I=(I+1)%h,I===N&&(N=(N+1)%h),Z-V<g)return;const ze=Q&&Z-Q;return ze?Math.round(pe*1e3/ze):void 0}}function XD(h,g){let b=0,S=1e3/g,I,N;const V=(Z,Q=Date.now())=>{b=Q,I=null,N&&(clearTimeout(N),N=null),h(...Z)};return[(...Z)=>{const Q=Date.now(),oe=Q-b;oe>=S?V(Z,Q):(I=Z,N||(N=setTimeout(()=>{N=null,V(I)},S-oe)))},()=>I&&V(I)]}const d1=(h,g,b=3)=>{let S=0;const I=WD(50,250);return XD(N=>{const V=N.loaded,s=N.lengthComputable?N.total:void 0,q=V-S,Z=I(q),Q=V<=s;S=V;const oe={loaded:V,total:s,progress:s?V/s:void 0,bytes:q,rate:Z||void 0,estimated:Z&&s&&Q?(s-V)/Z:void 0,event:N,lengthComputable:s!=null,[g?"download":"upload"]:!0};h(oe)},b)},J4=(h,g)=>{const b=h!=null;return[S=>g[0]({lengthComputable:b,total:h,loaded:S}),g[1]]},Q4=h=>(...g)=>Kt.asap(()=>h(...g)),YD=Oo.hasStandardBrowserEnv?((h,g)=>b=>(b=new URL(b,Oo.origin),h.protocol===b.protocol&&h.host===b.host&&(g||h.port===b.port)))(new URL(Oo.origin),Oo.navigator&&/(msie|trident)/i.test(Oo.navigator.userAgent)):()=>!0,KD=Oo.hasStandardBrowserEnv?{write(h,g,b,S,I,N){const V=[h+"="+encodeURIComponent(g)];Kt.isNumber(b)&&V.push("expires="+new Date(b).toGMTString()),Kt.isString(S)&&V.push("path="+S),Kt.isString(I)&&V.push("domain="+I),N===!0&&V.push("secure"),document.cookie=V.join("; ")},read(h){const g=document.cookie.match(new RegExp("(^|;\\s*)("+h+")=([^;]*)"));return g?decodeURIComponent(g[3]):null},remove(h){this.write(h,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function JD(h){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(h)}function QD(h,g){return g?h.replace(/\/?\/$/,"")+"/"+g.replace(/^\/+/,""):h}function H6(h,g,b){let S=!JD(g);return h&&(S||b==!1)?QD(h,g):g}const eT=h=>h instanceof Dl?{...h}:h;function Lm(h,g){g=g||{};const b={};function S(Z,Q,oe,pe){return Kt.isPlainObject(Z)&&Kt.isPlainObject(Q)?Kt.merge.call({caseless:pe},Z,Q):Kt.isPlainObject(Q)?Kt.merge({},Q):Kt.isArray(Q)?Q.slice():Q}function I(Z,Q,oe,pe){if(Kt.isUndefined(Q)){if(!Kt.isUndefined(Z))return S(void 0,Z,oe,pe)}else return S(Z,Q,oe,pe)}function N(Z,Q){if(!Kt.isUndefined(Q))return S(void 0,Q)}function V(Z,Q){if(Kt.isUndefined(Q)){if(!Kt.isUndefined(Z))return S(void 0,Z)}else return S(void 0,Q)}function s(Z,Q,oe){if(oe in g)return S(Z,Q);if(oe in h)return S(void 0,Z)}const q={url:N,method:N,data:N,baseURL:V,transformRequest:V,transformResponse:V,paramsSerializer:V,timeout:V,timeoutMessage:V,withCredentials:V,withXSRFToken:V,adapter:V,responseType:V,xsrfCookieName:V,xsrfHeaderName:V,onUploadProgress:V,onDownloadProgress:V,decompress:V,maxContentLength:V,maxBodyLength:V,beforeRedirect:V,transport:V,httpAgent:V,httpsAgent:V,cancelToken:V,socketPath:V,responseEncoding:V,validateStatus:s,headers:(Z,Q,oe)=>I(eT(Z),eT(Q),oe,!0)};return Kt.forEach(Object.keys({...h,...g}),function(Q){const oe=q[Q]||I,pe=oe(h[Q],g[Q],Q);Kt.isUndefined(pe)&&oe!==s||(b[Q]=pe)}),b}const q6=h=>{const g=Lm({},h);let{data:b,withXSRFToken:S,xsrfHeaderName:I,xsrfCookieName:N,headers:V,auth:s}=g;g.headers=V=Dl.from(V),g.url=j6(H6(g.baseURL,g.url,g.allowAbsoluteUrls),h.params,h.paramsSerializer),s&&V.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):"")));let q;if(Kt.isFormData(b)){if(Oo.hasStandardBrowserEnv||Oo.hasStandardBrowserWebWorkerEnv)V.setContentType(void 0);else if((q=V.getContentType())!==!1){const[Z,...Q]=q?q.split(";").map(oe=>oe.trim()).filter(Boolean):[];V.setContentType([Z||"multipart/form-data",...Q].join("; "))}}if(Oo.hasStandardBrowserEnv&&(S&&Kt.isFunction(S)&&(S=S(g)),S||S!==!1&&YD(g.url))){const Z=I&&N&&KD.read(N);Z&&V.set(I,Z)}return g},eP=typeof XMLHttpRequest<"u",tP=eP&&function(h){return new Promise(function(b,S){const I=q6(h);let N=I.data;const V=Dl.from(I.headers).normalize();let{responseType:s,onUploadProgress:q,onDownloadProgress:Z}=I,Q,oe,pe,ze,le;function Se(){ze&&ze(),le&&le(),I.cancelToken&&I.cancelToken.unsubscribe(Q),I.signal&&I.signal.removeEventListener("abort",Q)}let te=new XMLHttpRequest;te.open(I.method.toUpperCase(),I.url,!0),te.timeout=I.timeout;function ge(){if(!te)return;const ye=Dl.from("getAllResponseHeaders"in te&&te.getAllResponseHeaders()),Ae={data:!s||s==="text"||s==="json"?te.responseText:te.response,status:te.status,statusText:te.statusText,headers:ye,config:h,request:te};V6(function(it){b(it),Se()},function(it){S(it),Se()},Ae),te=null}"onloadend"in te?te.onloadend=ge:te.onreadystatechange=function(){!te||te.readyState!==4||te.status===0&&!(te.responseURL&&te.responseURL.indexOf("file:")===0)||setTimeout(ge)},te.onabort=function(){te&&(S(new lr("Request aborted",lr.ECONNABORTED,h,te)),te=null)},te.onerror=function(){S(new lr("Network Error",lr.ERR_NETWORK,h,te)),te=null},te.ontimeout=function(){let Pe=I.timeout?"timeout of "+I.timeout+"ms exceeded":"timeout exceeded";const Ae=I.transitional||B6;I.timeoutErrorMessage&&(Pe=I.timeoutErrorMessage),S(new lr(Pe,Ae.clarifyTimeoutError?lr.ETIMEDOUT:lr.ECONNABORTED,h,te)),te=null},N===void 0&&V.setContentType(null),"setRequestHeader"in te&&Kt.forEach(V.toJSON(),function(Pe,Ae){te.setRequestHeader(Ae,Pe)}),Kt.isUndefined(I.withCredentials)||(te.withCredentials=!!I.withCredentials),s&&s!=="json"&&(te.responseType=I.responseType),Z&&([pe,le]=d1(Z,!0),te.addEventListener("progress",pe)),q&&te.upload&&([oe,ze]=d1(q),te.upload.addEventListener("progress",oe),te.upload.addEventListener("loadend",ze)),(I.cancelToken||I.signal)&&(Q=ye=>{te&&(S(!ye||ye.type?new $g(null,h,te):ye),te.abort(),te=null)},I.cancelToken&&I.cancelToken.subscribe(Q),I.signal&&(I.signal.aborted?Q():I.signal.addEventListener("abort",Q)));const xe=ZD(I.url);if(xe&&Oo.protocols.indexOf(xe)===-1){S(new lr("Unsupported protocol "+xe+":",lr.ERR_BAD_REQUEST,h));return}te.send(N||null)})},iP=(h,g)=>{const{length:b}=h=h?h.filter(Boolean):[];if(g||b){let S=new AbortController,I;const N=function(Z){if(!I){I=!0,s();const Q=Z instanceof Error?Z:this.reason;S.abort(Q instanceof lr?Q:new $g(Q instanceof Error?Q.message:Q))}};let V=g&&setTimeout(()=>{V=null,N(new lr(`timeout ${g} of ms exceeded`,lr.ETIMEDOUT))},g);const s=()=>{h&&(V&&clearTimeout(V),V=null,h.forEach(Z=>{Z.unsubscribe?Z.unsubscribe(N):Z.removeEventListener("abort",N)}),h=null)};h.forEach(Z=>Z.addEventListener("abort",N));const{signal:q}=S;return q.unsubscribe=()=>Kt.asap(s),q}},nP=function*(h,g){let b=h.byteLength;if(b<g){yield h;return}let S=0,I;for(;S<b;)I=S+g,yield h.slice(S,I),S=I},rP=async function*(h,g){for await(const b of sP(h))yield*nP(b,g)},sP=async function*(h){if(h[Symbol.asyncIterator]){yield*h;return}const g=h.getReader();try{for(;;){const{done:b,value:S}=await g.read();if(b)break;yield S}}finally{await g.cancel()}},tT=(h,g,b,S)=>{const I=rP(h,g);let N=0,V,s=q=>{V||(V=!0,S&&S(q))};return new ReadableStream({async pull(q){try{const{done:Z,value:Q}=await I.next();if(Z){s(),q.close();return}let oe=Q.byteLength;if(b){let pe=N+=oe;b(pe)}q.enqueue(new Uint8Array(Q))}catch(Z){throw s(Z),Z}},cancel(q){return s(q),I.return()}},{highWaterMark:2})},O1=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",G6=O1&&typeof ReadableStream=="function",aP=O1&&(typeof TextEncoder=="function"?(h=>g=>h.encode(g))(new TextEncoder):async h=>new Uint8Array(await new Response(h).arrayBuffer())),$6=(h,...g)=>{try{return!!h(...g)}catch{return!1}},oP=G6&&$6(()=>{let h=!1;const g=new Request(Oo.origin,{body:new ReadableStream,method:"POST",get duplex(){return h=!0,"half"}}).headers.has("Content-Type");return h&&!g}),iT=64*1024,E2=G6&&$6(()=>Kt.isReadableStream(new Response("").body)),f1={stream:E2&&(h=>h.body)};O1&&(h=>{["text","arrayBuffer","blob","formData","stream"].forEach(g=>{!f1[g]&&(f1[g]=Kt.isFunction(h[g])?b=>b[g]():(b,S)=>{throw new lr(`Response type '${g}' is not supported`,lr.ERR_NOT_SUPPORT,S)})})})(new Response);const lP=async h=>{if(h==null)return 0;if(Kt.isBlob(h))return h.size;if(Kt.isSpecCompliantForm(h))return(await new Request(Oo.origin,{method:"POST",body:h}).arrayBuffer()).byteLength;if(Kt.isArrayBufferView(h)||Kt.isArrayBuffer(h))return h.byteLength;if(Kt.isURLSearchParams(h)&&(h=h+""),Kt.isString(h))return(await aP(h)).byteLength},cP=async(h,g)=>{const b=Kt.toFiniteNumber(h.getContentLength());return b??lP(g)},uP=O1&&(async h=>{let{url:g,method:b,data:S,signal:I,cancelToken:N,timeout:V,onDownloadProgress:s,onUploadProgress:q,responseType:Z,headers:Q,withCredentials:oe="same-origin",fetchOptions:pe}=q6(h);Z=Z?(Z+"").toLowerCase():"text";let ze=iP([I,N&&N.toAbortSignal()],V),le;const Se=ze&&ze.unsubscribe&&(()=>{ze.unsubscribe()});let te;try{if(q&&oP&&b!=="get"&&b!=="head"&&(te=await cP(Q,S))!==0){let Ae=new Request(g,{method:"POST",body:S,duplex:"half"}),Ke;if(Kt.isFormData(S)&&(Ke=Ae.headers.get("content-type"))&&Q.setContentType(Ke),Ae.body){const[it,rt]=J4(te,d1(Q4(q)));S=tT(Ae.body,iT,it,rt)}}Kt.isString(oe)||(oe=oe?"include":"omit");const ge="credentials"in Request.prototype;le=new Request(g,{...pe,signal:ze,method:b.toUpperCase(),headers:Q.normalize().toJSON(),body:S,duplex:"half",credentials:ge?oe:void 0});let xe=await fetch(le,pe);const ye=E2&&(Z==="stream"||Z==="response");if(E2&&(s||ye&&Se)){const Ae={};["status","statusText","headers"].forEach(ut=>{Ae[ut]=xe[ut]});const Ke=Kt.toFiniteNumber(xe.headers.get("content-length")),[it,rt]=s&&J4(Ke,d1(Q4(s),!0))||[];xe=new Response(tT(xe.body,iT,it,()=>{rt&&rt(),Se&&Se()}),Ae)}Z=Z||"text";let Pe=await f1[Kt.findKey(f1,Z)||"text"](xe,h);return!ye&&Se&&Se(),await new Promise((Ae,Ke)=>{V6(Ae,Ke,{data:Pe,headers:Dl.from(xe.headers),status:xe.status,statusText:xe.statusText,config:h,request:le})})}catch(ge){throw Se&&Se(),ge&&ge.name==="TypeError"&&/Load failed|fetch/i.test(ge.message)?Object.assign(new lr("Network Error",lr.ERR_NETWORK,h,le),{cause:ge.cause||ge}):lr.from(ge,ge&&ge.code,h,le)}}),A2={http:ED,xhr:tP,fetch:uP};Kt.forEach(A2,(h,g)=>{if(h){try{Object.defineProperty(h,"name",{value:g})}catch{}Object.defineProperty(h,"adapterName",{value:g})}});const nT=h=>`- ${h}`,hP=h=>Kt.isFunction(h)||h===null||h===!1,Z6={getAdapter:h=>{h=Kt.isArray(h)?h:[h];const{length:g}=h;let b,S;const I={};for(let N=0;N<g;N++){b=h[N];let V;if(S=b,!hP(b)&&(S=A2[(V=String(b)).toLowerCase()],S===void 0))throw new lr(`Unknown adapter '${V}'`);if(S)break;I[V||"#"+N]=S}if(!S){const N=Object.entries(I).map(([s,q])=>`adapter ${s} `+(q===!1?"is not supported by the environment":"is not available in the build"));let V=g?N.length>1?`since :
`+N.map(nT).join(`
`):" "+nT(N[0]):"as no adapter specified";throw new lr("There is no suitable adapter to dispatch the request "+V,"ERR_NOT_SUPPORT")}return S},adapters:A2};function mv(h){if(h.cancelToken&&h.cancelToken.throwIfRequested(),h.signal&&h.signal.aborted)throw new $g(null,h)}function rT(h){return mv(h),h.headers=Dl.from(h.headers),h.data=pv.call(h,h.transformRequest),["post","put","patch"].indexOf(h.method)!==-1&&h.headers.setContentType("application/x-www-form-urlencoded",!1),Z6.getAdapter(h.adapter||y0.adapter)(h).then(function(S){return mv(h),S.data=pv.call(h,h.transformResponse,S),S.headers=Dl.from(S.headers),S},function(S){return U6(S)||(mv(h),S&&S.response&&(S.response.data=pv.call(h,h.transformResponse,S.response),S.response.headers=Dl.from(S.response.headers))),Promise.reject(S)})}const W6="1.11.0",k1={};["object","boolean","number","function","string","symbol"].forEach((h,g)=>{k1[h]=function(S){return typeof S===h||"a"+(g<1?"n ":" ")+h}});const sT={};k1.transitional=function(g,b,S){function I(N,V){return"[Axios v"+W6+"] Transitional option '"+N+"'"+V+(S?". "+S:"")}return(N,V,s)=>{if(g===!1)throw new lr(I(V," has been removed"+(b?" in "+b:"")),lr.ERR_DEPRECATED);return b&&!sT[V]&&(sT[V]=!0,console.warn(I(V," has been deprecated since v"+b+" and will be removed in the near future"))),g?g(N,V,s):!0}};k1.spelling=function(g){return(b,S)=>(console.warn(`${S} is likely a misspelling of ${g}`),!0)};function dP(h,g,b){if(typeof h!="object")throw new lr("options must be an object",lr.ERR_BAD_OPTION_VALUE);const S=Object.keys(h);let I=S.length;for(;I-- >0;){const N=S[I],V=g[N];if(V){const s=h[N],q=s===void 0||V(s,N,h);if(q!==!0)throw new lr("option "+N+" must be "+q,lr.ERR_BAD_OPTION_VALUE);continue}if(b!==!0)throw new lr("Unknown option "+N,lr.ERR_BAD_OPTION)}}const Zy={assertOptions:dP,validators:k1},nd=Zy.validators;let Mm=class{constructor(g){this.defaults=g||{},this.interceptors={request:new Y4,response:new Y4}}async request(g,b){try{return await this._request(g,b)}catch(S){if(S instanceof Error){let I={};Error.captureStackTrace?Error.captureStackTrace(I):I=new Error;const N=I.stack?I.stack.replace(/^.+\n/,""):"";try{S.stack?N&&!String(S.stack).endsWith(N.replace(/^.+\n.+\n/,""))&&(S.stack+=`
`+N):S.stack=N}catch{}}throw S}}_request(g,b){typeof g=="string"?(b=b||{},b.url=g):b=g||{},b=Lm(this.defaults,b);const{transitional:S,paramsSerializer:I,headers:N}=b;S!==void 0&&Zy.assertOptions(S,{silentJSONParsing:nd.transitional(nd.boolean),forcedJSONParsing:nd.transitional(nd.boolean),clarifyTimeoutError:nd.transitional(nd.boolean)},!1),I!=null&&(Kt.isFunction(I)?b.paramsSerializer={serialize:I}:Zy.assertOptions(I,{encode:nd.function,serialize:nd.function},!0)),b.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?b.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:b.allowAbsoluteUrls=!0),Zy.assertOptions(b,{baseUrl:nd.spelling("baseURL"),withXsrfToken:nd.spelling("withXSRFToken")},!0),b.method=(b.method||this.defaults.method||"get").toLowerCase();let V=N&&Kt.merge(N.common,N[b.method]);N&&Kt.forEach(["delete","get","head","post","put","patch","common"],le=>{delete N[le]}),b.headers=Dl.concat(V,N);const s=[];let q=!0;this.interceptors.request.forEach(function(Se){typeof Se.runWhen=="function"&&Se.runWhen(b)===!1||(q=q&&Se.synchronous,s.unshift(Se.fulfilled,Se.rejected))});const Z=[];this.interceptors.response.forEach(function(Se){Z.push(Se.fulfilled,Se.rejected)});let Q,oe=0,pe;if(!q){const le=[rT.bind(this),void 0];for(le.unshift(...s),le.push(...Z),pe=le.length,Q=Promise.resolve(b);oe<pe;)Q=Q.then(le[oe++],le[oe++]);return Q}pe=s.length;let ze=b;for(oe=0;oe<pe;){const le=s[oe++],Se=s[oe++];try{ze=le(ze)}catch(te){Se.call(this,te);break}}try{Q=rT.call(this,ze)}catch(le){return Promise.reject(le)}for(oe=0,pe=Z.length;oe<pe;)Q=Q.then(Z[oe++],Z[oe++]);return Q}getUri(g){g=Lm(this.defaults,g);const b=H6(g.baseURL,g.url,g.allowAbsoluteUrls);return j6(b,g.params,g.paramsSerializer)}};Kt.forEach(["delete","get","head","options"],function(g){Mm.prototype[g]=function(b,S){return this.request(Lm(S||{},{method:g,url:b,data:(S||{}).data}))}});Kt.forEach(["post","put","patch"],function(g){function b(S){return function(N,V,s){return this.request(Lm(s||{},{method:g,headers:S?{"Content-Type":"multipart/form-data"}:{},url:N,data:V}))}}Mm.prototype[g]=b(),Mm.prototype[g+"Form"]=b(!0)});let fP=class X6{constructor(g){if(typeof g!="function")throw new TypeError("executor must be a function.");let b;this.promise=new Promise(function(N){b=N});const S=this;this.promise.then(I=>{if(!S._listeners)return;let N=S._listeners.length;for(;N-- >0;)S._listeners[N](I);S._listeners=null}),this.promise.then=I=>{let N;const V=new Promise(s=>{S.subscribe(s),N=s}).then(I);return V.cancel=function(){S.unsubscribe(N)},V},g(function(N,V,s){S.reason||(S.reason=new $g(N,V,s),b(S.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(g){if(this.reason){g(this.reason);return}this._listeners?this._listeners.push(g):this._listeners=[g]}unsubscribe(g){if(!this._listeners)return;const b=this._listeners.indexOf(g);b!==-1&&this._listeners.splice(b,1)}toAbortSignal(){const g=new AbortController,b=S=>{g.abort(S)};return this.subscribe(b),g.signal.unsubscribe=()=>this.unsubscribe(b),g.signal}static source(){let g;return{token:new X6(function(I){g=I}),cancel:g}}};function pP(h){return function(b){return h.apply(null,b)}}function mP(h){return Kt.isObject(h)&&h.isAxiosError===!0}const C2={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(C2).forEach(([h,g])=>{C2[g]=h});function Y6(h){const g=new Mm(h),b=A6(Mm.prototype.request,g);return Kt.extend(b,Mm.prototype,g,{allOwnKeys:!0}),Kt.extend(b,g,null,{allOwnKeys:!0}),b.create=function(I){return Y6(Lm(h,I))},b}const Es=Y6(y0);Es.Axios=Mm;Es.CanceledError=$g;Es.CancelToken=fP;Es.isCancel=U6;Es.VERSION=W6;Es.toFormData=L1;Es.AxiosError=lr;Es.Cancel=Es.CanceledError;Es.all=function(g){return Promise.all(g)};Es.spread=pP;Es.isAxiosError=mP;Es.mergeConfig=Lm;Es.AxiosHeaders=Dl;Es.formToJSON=h=>F6(Kt.isHTMLForm(h)?new FormData(h):h);Es.getAdapter=Z6.getAdapter;Es.HttpStatusCode=C2;Es.default=Es;const{Axios:mj,AxiosError:gj,CanceledError:_j,isCancel:yj,CancelToken:xj,VERSION:vj,all:bj,Cancel:wj,isAxiosError:Tj,spread:Sj,toFormData:Ej,AxiosHeaders:Aj,HttpStatusCode:Cj,formToJSON:Rj,getAdapter:Mj,mergeConfig:Ij}=Es;let gP={data:""},_P=h=>typeof window=="object"?((h?h.querySelector("#_goober"):window._goober)||Object.assign((h||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:h||gP,yP=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,xP=/\/\*[^]*?\*\/|  +/g,aT=/\n+/g,pp=(h,g)=>{let b="",S="",I="";for(let N in h){let V=h[N];N[0]=="@"?N[1]=="i"?b=N+" "+V+";":S+=N[1]=="f"?pp(V,N):N+"{"+pp(V,N[1]=="k"?"":g)+"}":typeof V=="object"?S+=pp(V,g?g.replace(/([^,])+/g,s=>N.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,q=>/&/.test(q)?q.replace(/&/g,s):s?s+" "+q:q)):N):V!=null&&(N=/^--/.test(N)?N:N.replace(/[A-Z]/g,"-$&").toLowerCase(),I+=pp.p?pp.p(N,V):N+":"+V+";")}return b+(g&&I?g+"{"+I+"}":I)+S},rf={},K6=h=>{if(typeof h=="object"){let g="";for(let b in h)g+=b+K6(h[b]);return g}return h},vP=(h,g,b,S,I)=>{let N=K6(h),V=rf[N]||(rf[N]=(q=>{let Z=0,Q=11;for(;Z<q.length;)Q=101*Q+q.charCodeAt(Z++)>>>0;return"go"+Q})(N));if(!rf[V]){let q=N!==h?h:(Z=>{let Q,oe,pe=[{}];for(;Q=yP.exec(Z.replace(xP,""));)Q[4]?pe.shift():Q[3]?(oe=Q[3].replace(aT," ").trim(),pe.unshift(pe[0][oe]=pe[0][oe]||{})):pe[0][Q[1]]=Q[2].replace(aT," ").trim();return pe[0]})(h);rf[V]=pp(I?{["@keyframes "+V]:q}:q,b?"":"."+V)}let s=b&&rf.g?rf.g:null;return b&&(rf.g=rf[V]),((q,Z,Q,oe)=>{oe?Z.data=Z.data.replace(oe,q):Z.data.indexOf(q)===-1&&(Z.data=Q?q+Z.data:Z.data+q)})(rf[V],g,S,s),V},bP=(h,g,b)=>h.reduce((S,I,N)=>{let V=g[N];if(V&&V.call){let s=V(b),q=s&&s.props&&s.props.className||/^go/.test(s)&&s;V=q?"."+q:s&&typeof s=="object"?s.props?"":pp(s,""):s===!1?"":s}return S+I+(V??"")},"");function N1(h){let g=this||{},b=h.call?h(g.p):h;return vP(b.unshift?b.raw?bP(b,[].slice.call(arguments,1),g.p):b.reduce((S,I)=>Object.assign(S,I&&I.call?I(g.p):I),{}):b,_P(g.target),g.g,g.o,g.k)}let J6,R2,M2;N1.bind({g:1});let uf=N1.bind({k:1});function wP(h,g,b,S){pp.p=g,J6=h,R2=b,M2=S}function bp(h,g){let b=this||{};return function(){let S=arguments;function I(N,V){let s=Object.assign({},N),q=s.className||I.className;b.p=Object.assign({theme:R2&&R2()},s),b.o=/ *go\d+/.test(q),s.className=N1.apply(b,S)+(q?" "+q:"");let Z=h;return h[0]&&(Z=s.as||h,delete s.as),M2&&Z[0]&&M2(s),J6(Z,s)}return I}}var TP=h=>typeof h=="function",I2=(h,g)=>TP(h)?h(g):h,SP=(()=>{let h=0;return()=>(++h).toString()})(),EP=(()=>{let h;return()=>{if(h===void 0&&typeof window<"u"){let g=matchMedia("(prefers-reduced-motion: reduce)");h=!g||g.matches}return h}})(),AP=20,Q6=(h,g)=>{switch(g.type){case 0:return{...h,toasts:[g.toast,...h.toasts].slice(0,AP)};case 1:return{...h,toasts:h.toasts.map(N=>N.id===g.toast.id?{...N,...g.toast}:N)};case 2:let{toast:b}=g;return Q6(h,{type:h.toasts.find(N=>N.id===b.id)?1:0,toast:b});case 3:let{toastId:S}=g;return{...h,toasts:h.toasts.map(N=>N.id===S||S===void 0?{...N,dismissed:!0,visible:!1}:N)};case 4:return g.toastId===void 0?{...h,toasts:[]}:{...h,toasts:h.toasts.filter(N=>N.id!==g.toastId)};case 5:return{...h,pausedAt:g.time};case 6:let I=g.time-(h.pausedAt||0);return{...h,pausedAt:void 0,toasts:h.toasts.map(N=>({...N,pauseDuration:N.pauseDuration+I}))}}},CP=[],gv={toasts:[],pausedAt:void 0},ob=h=>{gv=Q6(gv,h),CP.forEach(g=>{g(gv)})},RP=(h,g="blank",b)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:g,ariaProps:{role:"status","aria-live":"polite"},message:h,pauseDuration:0,...b,id:(b==null?void 0:b.id)||SP()}),x0=h=>(g,b)=>{let S=RP(g,h,b);return ob({type:2,toast:S}),S.id},gc=(h,g)=>x0("blank")(h,g);gc.error=x0("error");gc.success=x0("success");gc.loading=x0("loading");gc.custom=x0("custom");gc.dismiss=h=>{ob({type:3,toastId:h})};gc.remove=h=>ob({type:4,toastId:h});gc.promise=(h,g,b)=>{let S=gc.loading(g.loading,{...b,...b==null?void 0:b.loading});return typeof h=="function"&&(h=h()),h.then(I=>{let N=g.success?I2(g.success,I):void 0;return N?gc.success(N,{id:S,...b,...b==null?void 0:b.success}):gc.dismiss(S),I}).catch(I=>{let N=g.error?I2(g.error,I):void 0;N?gc.error(N,{id:S,...b,...b==null?void 0:b.error}):gc.dismiss(S)}),h};var MP=uf`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,IP=uf`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,zP=uf`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,DP=bp("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${h=>h.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${MP} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${IP} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${h=>h.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${zP} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,PP=uf`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,LP=bp("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${h=>h.secondary||"#e0e0e0"};
  border-right-color: ${h=>h.primary||"#616161"};
  animation: ${PP} 1s linear infinite;
`,OP=uf`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,kP=uf`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,NP=bp("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${h=>h.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${OP} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${kP} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${h=>h.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,jP=bp("div")`
  position: absolute;
`,BP=bp("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,FP=uf`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,UP=bp("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${FP} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,VP=({toast:h})=>{let{icon:g,type:b,iconTheme:S}=h;return g!==void 0?typeof g=="string"?he.createElement(UP,null,g):g:b==="blank"?null:he.createElement(BP,null,he.createElement(LP,{...S}),b!=="loading"&&he.createElement(jP,null,b==="error"?he.createElement(DP,{...S}):he.createElement(NP,{...S})))},HP=h=>`
0% {transform: translate3d(0,${h*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,qP=h=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${h*-150}%,-1px) scale(.6); opacity:0;}
`,GP="0%{opacity:0;} 100%{opacity:1;}",$P="0%{opacity:1;} 100%{opacity:0;}",ZP=bp("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,WP=bp("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,XP=(h,g)=>{let b=h.includes("top")?1:-1,[S,I]=EP()?[GP,$P]:[HP(b),qP(b)];return{animation:g?`${uf(S)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${uf(I)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}};he.memo(({toast:h,position:g,style:b,children:S})=>{let I=h.height?XP(h.position||g||"top-center",h.visible):{opacity:0},N=he.createElement(VP,{toast:h}),V=he.createElement(WP,{...h.ariaProps},I2(h.message,h));return he.createElement(ZP,{className:h.className,style:{...I,...b,...h.style}},typeof S=="function"?S({icon:N,message:V}):he.createElement(he.Fragment,null,N,V))});wP(he.createElement);N1`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`;var mc=gc;const Q_="https://urbansetu.onrender.com",e5=he.createContext(),zj=()=>{const h=he.useContext(e5);if(!h)throw new Error("useImageFavorites must be used within an ImageFavoritesProvider");return h},YP=({children:h})=>{const{currentUser:g}=fo(xe=>xe.user),[b,S]=he.useState(new Set),[I,N]=he.useState(!1),[V,s]=he.useState([]);he.useEffect(()=>{g?q():(S(new Set),s([]))},[g]);const q=async()=>{var xe;if(g)try{N(!0);const ye=await Es.get(`${Q_}/api/image-favorites/user/${g._id}`,{withCredentials:!0});if(ye.data.success){const Pe=new Set(ye.data.favorites.map(Ae=>Ae.imageId));S(Pe),s(ye.data.favorites)}}catch(ye){console.error("Failed to load favorites:",ye),((xe=ye.response)==null?void 0:xe.status)!==401&&mc.error("Failed to load favorites")}finally{N(!1)}},Z=xe=>{if(!xe)return null;const ye=xe.split("/");return ye[ye.length-1].split("?")[0]||btoa(xe).slice(0,20)},ge={favorites:b,favoritesData:V,loading:I,isFavorite:xe=>{const ye=Z(xe);return ye?b.has(ye):!1},toggleFavorite:async(xe,ye={})=>{var Ke,it,rt;if(!g)return mc.error("Please login to save favorites"),!1;if(!xe)return mc.error("Invalid image URL"),!1;const Pe=Z(xe);if(!Pe)return mc.error("Unable to process image"),!1;const Ae=b.has(Pe);try{if(Ae)return await Es.delete(`${Q_}/api/image-favorites/remove/${Pe}`,{withCredentials:!0}),S(ut=>{const Lt=new Set(ut);return Lt.delete(Pe),Lt}),s(ut=>ut.filter(Lt=>Lt.imageId!==Pe)),mc.success("Removed from favorites"),!1;{const ut={imageUrl:xe,imageId:Pe,listingId:ye.listingId||null,metadata:{imageName:ye.imageName||`image-${Date.now()}`,imageType:ye.imageType||"image",imageSize:ye.imageSize||0,addedFrom:ye.addedFrom||"preview"}},Lt=await Es.post(`${Q_}/api/image-favorites/add`,ut,{withCredentials:!0});if(Lt.data.success)return S(lt=>new Set([...lt,Pe])),s(lt=>[...lt,Lt.data.favorite]),mc.success("Added to favorites"),!0}}catch(ut){console.error("Failed to toggle favorite:",ut);const Lt=((it=(Ke=ut.response)==null?void 0:Ke.data)==null?void 0:it.message)||"Failed to update favorites";return((rt=ut.response)==null?void 0:rt.status)===400&&Lt.includes("already")?(Ae||S(lt=>new Set([...lt,Pe])),mc.success("Added to favorites"),!0):(mc.error(Lt),Ae)}},loadFavorites:q,getFavoritesCount:()=>b.size,getAllFavorites:()=>V,checkMultipleFavorites:xe=>{const ye={};return xe.forEach(Pe=>{const Ae=Z(Pe);Ae&&(ye[Pe]=b.has(Ae))}),ye},bulkAddToFavorites:async xe=>{if(!g){mc.error("Please login to save favorites");return}try{const ye=xe.map(Ae=>({imageUrl:Ae.url,imageId:Z(Ae.url),listingId:Ae.listingId||null,metadata:{imageName:Ae.name||`image-${Date.now()}`,imageType:Ae.type||"image",imageSize:Ae.size||0,addedFrom:Ae.addedFrom||"bulk"}})).filter(Ae=>Ae.imageId),Pe=await Es.post(`${Q_}/api/image-favorites/bulk/add`,{images:ye},{withCredentials:!0});Pe.data.success&&(await q(),mc.success(`${Pe.data.addedCount} images added to favorites`))}catch(ye){console.error("Failed to bulk add favorites:",ye),mc.error("Failed to add images to favorites")}},bulkRemoveFromFavorites:async xe=>{if(g)try{const ye=xe.map(Ae=>Z(Ae)).filter(Boolean),Pe=await Es.post(`${Q_}/api/image-favorites/bulk/remove`,{imageIds:ye},{withCredentials:!0});if(Pe.data.success){const Ae=new Set(ye);S(Ke=>{const it=new Set;return Ke.forEach(rt=>{Ae.has(rt)||it.add(rt)}),it}),s(Ke=>Ke.filter(it=>!Ae.has(it.imageId))),mc.success(`${Pe.data.removedCount} images removed from favorites`)}}catch(ye){console.error("Failed to bulk remove favorites:",ye),mc.error("Failed to remove images from favorites")}},generateImageId:Z};return x.jsx(e5.Provider,{value:ge,children:h})};function t5({isOpen:h,onClose:g,onConfirm:b,title:S="Confirm Action",message:I="Are you sure you want to proceed?",confirmText:N="Confirm",cancelText:V="Cancel",confirmButtonColor:s="bg-blue-600 hover:bg-blue-700",isDestructive:q=!1,isLoading:Z=!1}){if(!h)return null;const Q=()=>{b(),Z||g()},oe=()=>q?x.jsx(a6,{className:"w-6 h-6 text-red-500"}):x.jsx(Vy,{className:"w-6 h-6 text-blue-500"}),pe=()=>q?"bg-red-600 hover:bg-red-700 focus:ring-red-500":s+" focus:ring-blue-500";return x.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-[10000] p-4 animate-fadeIn",children:[x.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full animate-slideUp",children:[x.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[x.jsxs("div",{className:"flex items-center gap-3",children:[oe(),x.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:S})]}),x.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 hover:bg-gray-100 rounded-full",disabled:Z,children:x.jsx(ho,{className:"w-4 h-4"})})]}),x.jsx("div",{className:"p-6",children:x.jsx("p",{className:"text-gray-700 leading-relaxed",children:I})}),x.jsxs("div",{className:"flex gap-3 p-6 pt-0",children:[x.jsx("button",{onClick:g,disabled:Z,className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:V}),x.jsx("button",{onClick:Q,disabled:Z,className:`flex-1 px-4 py-2 text-white rounded-lg transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 ${pe()}`,children:Z?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processing..."]}):x.jsxs(x.Fragment,{children:[q&&x.jsx(su,{className:"w-4 h-4"}),N]})})]})]}),x.jsx("style",{jsx:!0,children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes slideUp {
          from { 
            opacity: 0; 
            transform: translateY(20px) scale(0.95);
          }
          to { 
            opacity: 1; 
            transform: translateY(0) scale(1);
          }
        }
        
        .animate-fadeIn {
          animation: fadeIn 0.3s ease-out;
        }
        
        .animate-slideUp {
          animation: slideUp 0.3s ease-out;
        }
      `})]})}const _v="https://urbansetu.onrender.com";function KP({forceModalOpen:h=!1,onModalClose:g=null}){const{currentUser:b}=fo(ii=>ii.user),[S,I]=he.useState(h);Pl();const N=ko(),[V,s]=he.useState([]),[q,Z]=he.useState(!1),[Q,oe]=he.useState(0),[pe,ze]=he.useState("send"),[le,Se]=he.useState({subject:"",message:"",email:"",name:""}),[te,ge]=he.useState(!1),[xe,ye]=he.useState(""),[Pe,Ae]=he.useState(!0),Ke=he.useRef(null),it=he.useRef(null),[rt,ut]=he.useState(!1),[Lt,lt]=he.useState(null),[Jt,wi]=he.useState(!1);he.useEffect(()=>{h&&I(!0)},[h]),he.useEffect(()=>{S&&b&&Se(ii=>({...ii,name:b.username||"",email:b.email||""})),S||Se({subject:"",message:"",email:"",name:""})},[S,b]),he.useEffect(()=>{b!=null&&b.email&&Wt()},[b]),he.useEffect(()=>{b!=null&&b.email&&pe==="messages"&&Wt()},[b,pe]),he.useEffect(()=>(S?(document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%"):(document.body.style.overflow="",document.body.style.position="",document.body.style.width=""),()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width=""}),[S]);const Fi=he.useCallback(()=>{if(Ke.current){const{scrollTop:ii,scrollHeight:Yi,clientHeight:Ti}=Ke.current,Mi=Yi-ii-Ti<5;Ae(Mi)}},[]);he.useEffect(()=>{const ii=Ke.current;if(ii&&pe==="messages")return ii.addEventListener("scroll",Fi),Fi(),()=>{ii.removeEventListener("scroll",Fi)}},[pe,Fi]);const Bi=he.useCallback(()=>{it.current&&it.current.scrollIntoView({behavior:"smooth"})},[]),Wt=async()=>{Z(!0);try{const Yi=await(await fetch(`${_v}/api/contact/user-messages/${encodeURIComponent(b.email)}`,{credentials:"include"})).json();if(!Array.isArray(Yi)){s([]),oe(0);return}s(Yi);const Ti=Yi.filter(Mi=>Mi.adminReply&&Mi.status==="unread").length;oe(Ti)}catch(ii){console.error("Error fetching user messages:",ii),s([]),oe(0)}finally{Z(!1)}},ki=ii=>{const Yi=new Date(ii),Mi=new Date-Yi,Ii=Math.floor(Mi/(1e3*60)),xt=Math.floor(Mi/(1e3*60*60)),St=Math.floor(Mi/(1e3*60*60*24));return Ii<1?"Just now":Ii<60?`${Ii}m ago`:xt<24?`${xt}h ago`:St<7?`${St}d ago`:Yi.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})},Ui=async ii=>{lt(ii),ut(!0)},Cn=async()=>{if(Lt){wi(!0);try{const ii=await fetch(`${_v}/api/contact/user-messages/${Lt}?email=${encodeURIComponent(b.email)}`,{method:"DELETE",credentials:"include"});if(ii.ok){s(Mi=>Mi.filter(Ii=>Ii._id!==Lt));const Ti=V.filter(Mi=>Mi._id!==Lt).filter(Mi=>Mi.adminReply&&Mi.status==="unread").length;oe(Ti),hi.success("Message deleted successfully!")}else{const Yi=await ii.json();hi.error(Yi.message||"Failed to delete message. Please try again.")}}catch(ii){console.error("Error deleting message:",ii),hi.error("Failed to delete message. Please try again.")}finally{wi(!1),ut(!1),lt(null)}}},Qe=()=>{const ii=N.pathname,Yi=new URLSearchParams(N.search);if(ii==="/forgot-password"&&Yi.get("step")==="2")return"#059669";switch(ii){case"/sign-in":return"#6366f1";case"/sign-up":return"#0891b2";case"/forgot-password":return"#dc2626";default:return"#3b82f6"}},Ft=()=>{I(!1),g&&g()},Di=ii=>{Se({...le,[ii.target.name]:ii.target.value})},Zi=async ii=>{ii.preventDefault(),ge(!0),ye("");try{(await(await fetch(`${_v}/api/contact/support`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(le)})).json()).success?(ye("success"),Se({subject:"",message:"",email:"",name:""}),hi.success("Message sent successfully!"),setTimeout(()=>{Ft(),ye("")},3e3)):(ye("error"),hi.error("Failed to send message. Please try again or contact us directly."))}catch{ye("error"),hi.error("Failed to send message. Please try again or contact us directly.")}finally{ge(!1)}};return x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:x.jsxs("button",{onClick:()=>I(!0),className:"relative group w-12 h-12 rounded-full shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:scale-110 hover:rotate-12 flex items-center justify-center",style:{background:`linear-gradient(135deg, ${Qe()}, ${Qe()}dd)`,boxShadow:`0 10px 25px ${Qe()}40`},title:"Need help? Contact our support team!",children:[x.jsx("div",{className:"absolute inset-0 rounded-full animate-ping",style:{border:`3px solid ${Qe()}55`}}),x.jsx(kg,{className:"w-5 h-5 text-white drop-shadow-lg"}),b&&Q>0&&x.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-6 w-6 flex items-center justify-center font-bold animate-pulse",children:Q>99?"99+":Q}),x.jsxs("div",{className:"absolute bottom-full right-0 mb-3 bg-white text-gray-800 text-sm px-4 py-2 rounded-xl shadow-2xl hidden group-hover:block z-10 whitespace-nowrap border border-gray-100 transform -translate-y-1 transition-all duration-200",children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-lg",children:""}),x.jsx("span",{className:"font-medium",children:b&&Q>0?`${Q} new repl${Q!==1?"ies":"y"}`:"Need help? Contact us!"})]}),x.jsx("div",{className:"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"})]})]})}),S&&x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn",children:x.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto animate-slideUp",children:[x.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white rounded-t-2xl",children:[x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:Qe()},children:x.jsx(kg,{className:"w-5 h-5 text-white"})}),x.jsxs("div",{children:[x.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Contact Support"}),x.jsx("p",{className:"text-sm text-gray-600",children:"We're here to help you!"})]})]}),x.jsx("button",{onClick:Ft,className:"text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-100 rounded-full",children:x.jsx(ho,{className:"w-5 h-5"})})]}),b&&x.jsxs("div",{className:"flex border-b border-gray-200",children:[x.jsx("button",{onClick:()=>ze("send"),className:`flex-1 px-6 py-3 text-sm font-medium transition-colors ${pe==="send"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:"Send Message"}),x.jsxs("button",{onClick:()=>ze("messages"),className:`flex-1 px-6 py-3 text-sm font-medium transition-colors relative ${pe==="messages"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:["My Messages",Q>0&&x.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold",children:Q>99?"99+":Q})]})]}),!b||pe==="send"?x.jsxs("form",{onSubmit:Zi,className:"p-6 space-y-6",children:[xe==="success"&&x.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 text-green-800 rounded-xl flex items-center gap-3 animate-bounce",children:[x.jsx("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:x.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),x.jsxs("div",{children:[x.jsx("p",{className:"font-medium",children:"Message sent successfully!"}),x.jsx("p",{className:"text-sm",children:"We'll get back to you within 24 hours."})]})]}),xe==="error"&&x.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 text-red-800 rounded-xl flex items-center gap-3",children:[x.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center",children:x.jsx(ho,{className:"w-3 h-3 text-white"})}),x.jsxs("div",{children:[x.jsx("p",{className:"font-medium",children:"Failed to send message"}),x.jsx("p",{className:"text-sm",children:"Please try again or contact us directly."})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsxs("label",{htmlFor:"name",className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[x.jsx(Il,{className:"w-4 h-4"}),"Your Name *"]}),x.jsx("input",{type:"text",id:"name",name:"name",value:le.name,onChange:Di,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Enter your full name"})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsxs("label",{htmlFor:"email",className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[x.jsx(rd,{className:"w-4 h-4"}),"Email Address *"]}),x.jsx("input",{type:"email",id:"email",name:"email",value:le.email,onChange:Di,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"your@email.com"})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsxs("label",{htmlFor:"subject",className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[x.jsx(hI,{className:"w-4 h-4"}),"Subject *"]}),x.jsx("input",{type:"text",id:"subject",name:"subject",value:le.subject,onChange:Di,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Brief description of your issue"})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsxs("label",{htmlFor:"message",className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[x.jsx(kg,{className:"w-4 h-4"}),"Message *"]}),x.jsx("textarea",{id:"message",name:"message",value:le.message,onChange:Di,required:!0,rows:5,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 resize-none",placeholder:"Please describe your issue or question in detail..."})]}),x.jsxs("div",{className:"flex gap-3 pt-4",children:[x.jsx("button",{type:"button",onClick:Ft,className:"flex-1 px-6 py-3 text-gray-700 bg-gray-100 rounded-xl hover:bg-gray-200 transition-all duration-200 font-medium contact-support-action-btn",children:"Cancel"}),x.jsx("button",{type:"submit",disabled:te,className:"flex-1 px-6 py-3 text-white rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 font-medium flex items-center justify-center gap-2 contact-support-action-btn",style:{backgroundColor:Qe(),boxShadow:`0 4px 14px ${Qe()}40`},children:te?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Sending..."]}):x.jsxs(x.Fragment,{children:[x.jsx(u1,{className:"w-4 h-4"}),"Send Message"]})})]})]}):x.jsx("div",{className:"p-6",children:q?x.jsxs("div",{className:"text-center py-8",children:[x.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),x.jsx("p",{className:"text-gray-500 font-medium",children:"Loading your messages..."})]}):V.length===0?x.jsxs("div",{className:"text-center py-8 text-gray-500",children:[x.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:x.jsx(rd,{className:"w-10 h-10 text-gray-400"})}),x.jsx("h4",{className:"text-lg font-medium mb-2",children:"No messages yet"}),x.jsx("p",{className:"text-sm mb-4",children:"Send a support message to get started"}),x.jsx("button",{onClick:()=>ze("send"),className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Send Message"})]}):x.jsxs("div",{ref:Ke,className:"space-y-4 max-h-96 overflow-y-auto relative",children:[V.map(ii=>x.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[x.jsx("div",{className:"flex items-start justify-between mb-3",children:x.jsxs("div",{className:"flex-1",children:[x.jsx("h4",{className:"font-semibold text-gray-900",children:ii.subject}),x.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500",children:[x.jsx(C1,{className:"w-3 h-3"}),ki(ii.createdAt),x.jsx("span",{className:"text-gray-400",children:""}),x.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${ii.status==="replied"?"bg-green-100 text-green-800":ii.status==="read"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:ii.status==="replied"?"Replied":ii.status==="read"?"Read":"Unread"})]})]})}),x.jsx("div",{className:"bg-gray-50 p-3 rounded-lg mb-3",children:x.jsx("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed text-sm",children:ii.message})}),ii.adminReply&&x.jsxs("div",{className:"bg-green-50 p-3 rounded-lg border border-green-200",children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsx("h6",{className:"font-medium text-green-700 text-sm",children:"Admin Reply"}),x.jsx("span",{className:"text-xs text-gray-500",children:ki(ii.adminReplyAt)})]}),x.jsx("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed text-sm",children:ii.adminReply})]}),x.jsx("div",{className:"flex items-center justify-end mt-2",children:x.jsx("button",{onClick:()=>Ui(ii._id),className:"text-red-500 hover:text-red-700 transition-colors p-2 rounded-full hover:bg-red-50",title:"Delete this message",children:x.jsx(su,{className:"w-4 h-4"})})})]},ii._id)),x.jsx("div",{ref:it})]})}),!Pe&&V.length>0&&pe==="messages"&&x.jsx("div",{className:"absolute bottom-6 right-6 z-20",children:x.jsx("button",{onClick:Bi,className:"bg-blue-500 hover:bg-blue-600 text-white rounded-full p-3 shadow-lg transition-all duration-200 hover:scale-110 animate-pulse",title:"Scroll to bottom","aria-label":"Scroll to bottom",children:x.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"transform",children:x.jsx("path",{d:"M12 16l-6-6h12l-6 6z"})})})})]})}),x.jsx("style",{jsx:!0,children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from { 
            opacity: 0; 
            transform: translateY(20px) scale(0.95);
          }
          to { 
            opacity: 1; 
            transform: translateY(0) scale(1);
          }
        }
        @keyframes slideDown {
          from { 
            opacity: 0; 
            transform: translateY(-10px);
          }
          to { 
            opacity: 1; 
            transform: translateY(0);
          }
        }
        .animate-fadeIn {
          animation: fadeIn 0.3s ease-out;
        }
        .animate-slideUp {
          animation: slideUp 0.3s ease-out;
        }
        .animate-slideDown {
          animation: slideDown 0.2s ease-out;
        }
        .shadow-3xl {
          box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        /* Mobile button size reduction for Send Message and Cancel */
        @media (max-width: 640px) {
          .contact-support-action-btn {
            padding: 0.5rem 0.75rem !important;
            font-size: 0.95rem !important;
            border-radius: 0.75rem !important;
          }
        }
      `}),x.jsx(t5,{isOpen:rt,onClose:()=>{ut(!1),lt(null)},onConfirm:Cn,title:"Delete Message",message:"Are you sure you want to delete this message? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",isDestructive:!0,isLoading:Jt})]})}const Dg="https://urbansetu.onrender.com";function JP({forceModalOpen:h=!1,onModalClose:g=null}){const[b,S]=he.useState(h),[I,N]=he.useState([]),[V,s]=he.useState(!1),[q,Z]=he.useState(0),[Q,oe]=he.useState(null),[pe,ze]=he.useState(""),[le,Se]=he.useState(null),[te,ge]=he.useState(!1),{currentUser:xe}=fo(St=>St.user),ye=ko();Pl();const[Pe,Ae]=he.useState(""),[Ke,it]=he.useState(!0),rt=he.useRef(null),ut=he.useRef(null),[Lt,lt]=he.useState(!1),[Jt,wi]=he.useState(null),[Fi,Bi]=he.useState(!1);he.useEffect(()=>{h&&S(!0)},[h]);const Wt=xe&&(xe.role==="admin"||xe.role==="rootadmin"),ki=()=>{const St=ye.pathname,Ei=new URLSearchParams(ye.search);if(St==="/forgot-password"&&Ei.get("step")==="2")return"#059669";switch(St){case"/sign-in":return"#6366f1";case"/sign-up":return"#0891b2";case"/forgot-password":return"#dc2626";default:return"#3b82f6"}};he.useEffect(()=>{let St;return Wt&&(Ft(),St=setInterval(Ft,3e4)),()=>St&&clearInterval(St)},[Wt]),he.useEffect(()=>{b&&Wt&&(Qe(),Ft())},[b,Wt]),he.useEffect(()=>(b?(document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%"):(document.body.style.overflow="",document.body.style.position="",document.body.style.width=""),()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width=""}),[b]);const Ui=he.useCallback(()=>{if(rt.current){const{scrollTop:St,scrollHeight:Ei,clientHeight:Sn}=rt.current,Mn=Ei-St-Sn<5;it(Mn)}},[]);he.useEffect(()=>{const St=rt.current;if(St&&b)return St.addEventListener("scroll",Ui),Ui(),()=>{St.removeEventListener("scroll",Ui)}},[b,Ui]);const Cn=he.useCallback(()=>{ut.current&&ut.current.scrollIntoView({behavior:"smooth"})},[]),Qe=async()=>{s(!0),Ae("");try{const St=await fetch(`${Dg}/api/contact/messages`,{credentials:"include"});if(!St.ok){const Sn=await St.json();Ae(Sn.message||"Failed to fetch messages."),N([]);return}const Ei=await St.json();N(Ei)}catch(St){Ae("Network error or server unavailable."),N([]),console.error("Error fetching messages:",St)}finally{s(!1)}},Ft=async()=>{try{const Ei=await(await fetch(`${Dg}/api/contact/unread-count`,{credentials:"include"})).json();Z(Ei.count)}catch(St){console.error("Error fetching unread count:",St)}},Di=async St=>{try{await fetch(`${Dg}/api/contact/messages/${St}/read`,{method:"PUT",credentials:"include"}),N(Ei=>Ei.map(Sn=>Sn._id===St?{...Sn,status:"read"}:Sn)),Ft(),hi.success("Message marked as read")}catch(Ei){console.error("Error marking message as read:",Ei),hi.error("Failed to mark message as read")}},Zi=async St=>{try{await fetch(`${Dg}/api/contact/messages/${St}/replied`,{method:"PUT",credentials:"include"}),N(Ei=>Ei.map(Sn=>Sn._id===St?{...Sn,status:"replied"}:Sn)),Ft(),hi.success("Message marked as replied")}catch(Ei){console.error("Error marking message as replied:",Ei),hi.error("Failed to mark message as replied")}},ii=async St=>{wi(St),lt(!0)},Yi=async()=>{if(Jt){Bi(!0);try{await fetch(`${Dg}/api/contact/messages/${Jt}`,{method:"DELETE",credentials:"include"}),N(St=>St.filter(Ei=>Ei._id!==Jt)),Ft(),hi.success("Message deleted successfully!")}catch(St){console.error("Error deleting message:",St),hi.error("Failed to delete message. Please try again.")}finally{Bi(!1),lt(!1),wi(null)}}},Ti=async St=>{if(!pe.trim()){hi.error("Please enter a reply message");return}ge(!0);try{(await(await fetch(`${Dg}/api/contact/messages/${St}/reply`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({replyMessage:pe.trim()})})).json()).success?(ze(""),Se(null),N(Mn=>Mn.map(Nn=>Nn._id===St?{...Nn,adminReply:pe.trim(),status:"replied"}:Nn)),Ft(),hi.success("Reply sent successfully!")):hi.error("Failed to send reply. Please try again.")}catch(Ei){console.error("Error sending reply:",Ei),hi.error("Failed to send reply. Please try again.")}finally{ge(!1)}},Mi=St=>{const Ei={unread:{color:"bg-red-100 text-red-800 border-red-200",text:"Unread",icon:x.jsx(rd,{className:"w-3 h-3"})},read:{color:"bg-blue-100 text-blue-800 border-blue-200",text:"Read",icon:x.jsx(au,{className:"w-3 h-3"})},replied:{color:"bg-green-100 text-green-800 border-green-200",text:"Replied",icon:x.jsx(P4,{className:"w-3 h-3"})}},Sn=Ei[St]||Ei.unread;return x.jsxs("span",{className:`px-3 py-1 text-xs font-medium rounded-full border flex items-center gap-1 ${Sn.color}`,children:[Sn.icon,Sn.text]})},Ii=()=>{S(!1),g&&g()},xt=St=>{const Ei=new Date(St),Mn=new Date-Ei,Nn=Math.floor(Mn/(1e3*60)),In=Math.floor(Mn/(1e3*60*60)),qr=Math.floor(Mn/(1e3*60*60*24));return Nn<1?"Just now":Nn<60?`${Nn}m ago`:In<24?`${In}h ago`:qr===1?"Yesterday":qr<7?`${qr} days ago`:Ei.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})};return Wt?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"fixed bottom-6 right-6 z-[9999]",children:x.jsxs("button",{onClick:()=>S(!0),className:"relative group w-12 h-12 rounded-full shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:scale-110 hover:rotate-12 flex items-center justify-center",style:{background:`linear-gradient(135deg, ${ki()}, ${ki()}dd)`,boxShadow:`0 10px 25px ${ki()}40`},title:"View support messages",children:[x.jsx("div",{className:"absolute inset-0 rounded-full animate-ping",style:{border:`3px solid ${ki()}55`}}),x.jsx(kg,{className:"w-5 h-5 text-white drop-shadow-lg"}),q>0&&x.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-6 w-6 flex items-center justify-center font-bold animate-pulse",children:q>99?"99+":q}),x.jsxs("div",{className:"absolute bottom-full right-0 mb-3 bg-white text-gray-800 text-sm px-4 py-2 rounded-xl shadow-2xl hidden group-hover:block z-10 whitespace-nowrap border border-gray-100 transform -translate-y-1 transition-all duration-200",children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"text-lg",children:""}),x.jsx("span",{className:"font-medium",children:q>0?`${q} new message${q!==1?"s":""}`:"Support Messages"})]}),x.jsx("div",{className:"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"})]})]})}),b&&x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-[9999] p-4 animate-fadeIn",children:x.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden animate-slideUp",children:[x.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white rounded-t-2xl",children:[x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:ki()},children:x.jsx(kg,{className:"w-5 h-5 text-white"})}),x.jsxs("div",{children:[x.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Support Messages"}),x.jsxs("p",{className:"text-sm text-gray-600",children:[q," unread message",q!==1?"s":"","  ",I.length," total"]})]})]}),x.jsx("button",{onClick:Ii,className:"text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-100 rounded-full",children:x.jsx(ho,{className:"w-5 h-5"})})]}),x.jsxs("div",{ref:rt,className:"overflow-y-auto max-h-[calc(90vh-120px)] relative",children:[Pe&&x.jsx("div",{className:"p-6 text-center text-red-600 font-semibold bg-red-50 border border-red-200 rounded-xl mb-4",children:Pe}),V?x.jsxs("div",{className:"p-12 text-center",children:[x.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),x.jsx("p",{className:"text-gray-500 font-medium",children:"Loading messages..."})]}):I.length===0?x.jsxs("div",{className:"p-12 text-center text-gray-500",children:[x.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:x.jsx(kg,{className:"w-10 h-10 text-gray-400"})}),x.jsx("h4",{className:"text-lg font-medium mb-2",children:"No messages yet"}),x.jsx("p",{className:"text-sm",children:"Support messages from users will appear here"})]}):x.jsxs("div",{className:"divide-y divide-gray-100",children:[I.map(St=>x.jsxs("div",{className:`p-6 hover:bg-gray-50 transition-all duration-200 cursor-pointer ${St.status==="unread"?"bg-blue-50 border-l-4 border-blue-500":""} ${(Q==null?void 0:Q._id)===St._id?"bg-blue-100":""}`,onClick:()=>oe((Q==null?void 0:Q._id)===St._id?null:St),children:[x.jsx("div",{className:"flex items-start justify-between",children:x.jsxs("div",{className:"flex-1 min-w-0",children:[x.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[x.jsxs("div",{className:"flex-1 min-w-0",children:[x.jsx("h4",{className:"font-semibold text-gray-900 truncate",children:St.subject}),x.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[x.jsx(Il,{className:"w-3 h-3 text-gray-400"}),x.jsx("span",{className:"text-sm text-gray-600",children:St.name||"Anonymous"}),x.jsx("span",{className:"text-gray-400",children:""}),x.jsx(rd,{className:"w-3 h-3 text-gray-400"}),x.jsx("span",{className:"text-sm text-gray-600",children:St.email})]})]}),Mi(St.status)]}),x.jsx("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:x.jsxs("div",{className:"flex items-center gap-1",children:[x.jsx(C1,{className:"w-3 h-3"}),xt(St.createdAt)]})}),x.jsx("p",{className:"text-gray-700 mt-3 line-clamp-2",children:St.message})]})}),x.jsxs("div",{className:"flex gap-2 mt-4",children:[St.status==="unread"&&x.jsxs("button",{onClick:Ei=>{Ei.stopPropagation(),Di(St._id)},className:"px-3 py-1 text-xs text-white rounded-lg transition-all duration-200 flex items-center gap-1 hover:scale-105",style:{backgroundColor:ki()},children:[x.jsx(au,{className:"w-3 h-3"}),"Mark Read"]}),St.status!=="replied"&&x.jsxs("button",{onClick:Ei=>{Ei.stopPropagation(),Zi(St._id)},className:"px-3 py-1 text-xs text-white rounded-lg transition-all duration-200 flex items-center gap-1 hover:scale-105",style:{backgroundColor:ki()},children:[x.jsx(P4,{className:"w-3 h-3"}),"Mark Replied"]}),x.jsxs("button",{onClick:Ei=>{Ei.stopPropagation(),ii(St._id)},className:"px-3 py-1 text-xs text-white bg-red-500 rounded-lg transition-all duration-200 flex items-center gap-1 hover:scale-105 hover:bg-red-700",children:[x.jsx(su,{className:"w-3 h-3"}),"Delete"]})]}),(Q==null?void 0:Q._id)===St._id&&x.jsxs("div",{className:"mt-4 p-4 bg-gray-100 rounded-xl animate-slideDown",children:[x.jsxs("div",{className:"flex items-center justify-between mb-3",children:[x.jsx("h5",{className:"font-medium text-gray-900",children:"Full Message"}),x.jsx("span",{className:"text-xs text-gray-500",children:new Date(St.createdAt).toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),x.jsx("div",{className:"bg-white p-4 rounded-lg border mb-4",children:x.jsx("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed",children:St.message})}),St.adminReply&&x.jsxs("div",{className:"mb-4",children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsx("h6",{className:"font-medium text-green-700",children:"Admin Reply"}),x.jsx("span",{className:"text-xs text-gray-500",children:new Date(St.adminReplyAt).toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),x.jsx("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:x.jsx("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed",children:St.adminReply})})]}),!St.adminReply&&x.jsxs("div",{className:"space-y-3",onClick:Ei=>Ei.stopPropagation(),children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("h6",{className:"font-medium text-blue-700",children:"Send Reply"}),x.jsx("button",{onClick:Ei=>{Ei.stopPropagation(),Se(le===St._id?null:St._id)},className:"text-sm text-blue-600 hover:text-blue-800",children:le===St._id?"Cancel":"Reply"})]}),le===St._id&&x.jsxs("div",{className:"space-y-3",children:[x.jsx("textarea",{value:pe,onChange:Ei=>ze(Ei.target.value),onClick:Ei=>Ei.stopPropagation(),onFocus:Ei=>Ei.stopPropagation(),placeholder:"Type your reply here...",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:"4"}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx("button",{onClick:Ei=>{Ei.stopPropagation(),Ti(St._id)},disabled:te,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 admin-contact-support-action-btn",children:te?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Sending..."]}):x.jsxs(x.Fragment,{children:[x.jsx(u1,{className:"w-4 h-4"}),"Send Reply"]})}),x.jsx("button",{onClick:Ei=>{Ei.stopPropagation(),Se(null),ze("")},className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 admin-contact-support-action-btn",children:"Cancel"})]})]})]})]})]},St._id)),x.jsx("div",{ref:ut})]})]}),!Ke&&I.length>0&&x.jsx("div",{className:"absolute bottom-6 right-6 z-20",children:x.jsx("button",{onClick:Cn,className:"bg-blue-500 hover:bg-blue-600 text-white rounded-full p-3 shadow-lg transition-all duration-200 hover:scale-110 animate-pulse",title:"Scroll to bottom","aria-label":"Scroll to bottom",children:x.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"transform",children:x.jsx("path",{d:"M12 16l-6-6h12l-6 6z"})})})})]})}),x.jsx("style",{jsx:!0,children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes slideUp {
          from { 
            opacity: 0; 
            transform: translateY(20px) scale(0.95);
          }
          to { 
            opacity: 1; 
            transform: translateY(0) scale(1);
          }
        }

        @keyframes slideDown {
          from { 
            opacity: 0; 
            transform: translateY(-10px);
          }
          to { 
            opacity: 1; 
            transform: translateY(0);
          }
        }
        
        .animate-fadeIn {
          animation: fadeIn 0.3s ease-out;
        }
        
        .animate-slideUp {
          animation: slideUp 0.3s ease-out;
        }

        .animate-slideDown {
          animation: slideDown 0.2s ease-out;
        }
        
        .shadow-3xl {
          box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
        /* Mobile button size reduction for Send/Cancel in admin contact support */
        @media (max-width: 640px) {
          .admin-contact-support-action-btn {
            padding: 0.5rem 0.75rem !important;
            font-size: 0.95rem !important;
            border-radius: 0.75rem !important;
          }
        }
      `}),x.jsx(t5,{isOpen:Lt,onClose:()=>{lt(!1),wi(null)},onConfirm:Yi,title:"Delete Message",message:"Are you sure you want to delete this message? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",isDestructive:!0,isLoading:Fi})]}):null}function i5(){const{currentUser:h}=fo(I=>I.user),[g,b]=he.useState(!1);Pl(),ko(),he.useEffect(()=>{const I=N=>{b(N.detail.isOpen)};return window.addEventListener("geminiChatboxToggle",I),()=>{window.removeEventListener("geminiChatboxToggle",I)}},[]);const S=h&&(h.role==="admin"||h.role==="rootadmin")&&(h.adminApprovalStatus==="approved"||h.isDefaultAdmin);return g?null:S?x.jsx(JP,{}):x.jsx(KP,{})}const QP=()=>{const[h,g]=he.useState(navigator.onLine),[b,S]=he.useState(!1);return he.useEffect(()=>{const I=()=>{g(!0),b&&setTimeout(()=>S(!1),3e3)},N=()=>{g(!1),S(!0)};return window.addEventListener("online",I),window.addEventListener("offline",N),()=>{window.removeEventListener("online",I),window.removeEventListener("offline",N)}},[b]),{isOnline:h,wasOffline:b}},eL=()=>{const{isOnline:h,wasOffline:g}=QP();return h&&!g?null:h&&g?x.jsx("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-[100] animate-fade-in",children:x.jsxs("div",{className:"bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3 animate-slide-down",children:[x.jsx(Tm,{className:"text-xl animate-pulse"}),x.jsxs("div",{className:"text-center",children:[x.jsx("p",{className:"font-semibold text-sm",children:"Connection Restored!"}),x.jsx("p",{className:"text-xs opacity-90",children:"You're back online"})]})]})}):x.jsx("div",{className:"fixed top-20 left-1/2 transform -translate-x-1/2 z-[100] animate-fade-in",children:x.jsxs("div",{className:"bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3 animate-slide-down",children:[x.jsx(Hy,{className:"text-xl animate-pulse"}),x.jsxs("div",{className:"text-center",children:[x.jsxs("p",{className:"font-semibold text-sm flex items-center gap-2",children:[x.jsx(a6,{className:"text-yellow-300"}),"Internet Not Available"]}),x.jsx("p",{className:"text-xs opacity-90",children:"Please check your connection"})]})]})})},tL=()=>{const h="ontouchstart"in window||navigator.maxTouchPoints>0,g=window.innerWidth<=768,b=navigator.userAgent.toLowerCase(),S=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(b);return h&&(g||S)},n5=(h,g=null)=>{if(h){if(tL()){if(h.focus({preventScroll:!0}),g!==null&&h.setSelectionRange)try{h.setSelectionRange(g,g)}catch{h.focus()}setTimeout(()=>{h.blur(),h.focus({preventScroll:!0})},0)}else if(h.focus(),g!==null&&h.setSelectionRange)try{h.setSelectionRange(g,g)}catch{h.focus()}}},Dj=(h,g=null)=>{if(h&&(h.focus(),g!==null&&h.setSelectionRange))try{h.setSelectionRange(g,g)}catch{h.focus()}},lb=h=>{if(!h)return{score:0,level:"very-weak",feedback:[]};let g=0;const b=[];h.length>=8?g+=1:b.push("At least 8 characters"),h.length>=12&&(g+=1),h.length>=16&&(g+=1),/[a-z]/.test(h)?g+=1:b.push("Lowercase letters"),/[A-Z]/.test(h)?g+=1:b.push("Uppercase letters"),/[0-9]/.test(h)?g+=1:b.push("Numbers"),/[^A-Za-z0-9]/.test(h)?g+=1:b.push("Special characters"),/(.)\1{2,}/.test(h)?b.push("Avoid repeated characters"):g+=1,/123|abc|qwe|asd|zxc/i.test(h)?b.push("Avoid common sequences"):g+=1,/password|123456|qwerty|admin|login/i.test(h)?b.push("Avoid common passwords"):g+=1;let S;return g<=3?S="very-weak":g<=5?S="weak":g<=7?S="medium":g<=9?S="strong":S="very-strong",{score:g,level:S,feedback:b}},r5=h=>({"very-weak":"text-red-600",weak:"text-red-500",medium:"text-yellow-500",strong:"text-green-500","very-strong":"text-green-600"})[h]||"text-gray-500",s5=h=>({"very-weak":"bg-red-100",weak:"bg-red-50",medium:"bg-yellow-50",strong:"bg-green-50","very-strong":"bg-green-100"})[h]||"bg-gray-50",a5=h=>({"very-weak":"Very Weak",weak:"Weak",medium:"Medium",strong:"Strong","very-strong":"Very Strong"})[h]||"Unknown",p1=h=>{const{score:g}=lb(h);return g>=5},oT="https://urbansetu.onrender.com";function iL(){vc("Change Password - Security Settings");const{currentUser:h}=fo(it=>it.user),g=Pl(),b=vp(),S=he.useRef(null),[I,N]=he.useState({previousPassword:"",newPassword:"",confirmNewPassword:""}),[V,s]=he.useState(!1),[q,Z]=he.useState(!1),[Q,oe]=he.useState(!1),[pe,ze]=he.useState(""),[le,Se]=he.useState(!1),[te,ge]=he.useState(""),[xe,ye]=he.useState({score:0,level:"very-weak",feedback:[]});he.useEffect(()=>{S.current&&n5(S.current)},[]);const Pe=it=>{const rt=lb(it);ye(rt)},Ae=it=>{const{name:rt,value:ut}=it.target;N({...I,[rt]:ut}),rt==="newPassword"&&Pe(ut)},Ke=async it=>{if(it.preventDefault(),ze(""),ge(""),I.newPassword!==I.confirmNewPassword){ze("New passwords do not match");return}if(!p1(I.newPassword)){ze("Password does not meet minimum strength requirements");return}if(I.previousPassword===I.newPassword){ze("New password must be different from current password");return}Se(!0);try{const rt=await Q2(`${oT}/api/user/change-password/${h._id}`,{method:"POST",body:JSON.stringify({previousPassword:I.previousPassword,newPassword:I.newPassword})}),ut=await rt.json();if(Se(!1),rt.status===401){ze("Session expired or unauthorized. Please sign in again."),b(S1());try{const lt=await(await fetch(`${oT}/api/auth/signout`,{credentials:"include"})).json();lt.success===!1?b(xp(lt.message)):(b(Xa(lt)),window.persistor&&window.persistor.purge&&await window.persistor.purge(),Dm(),localStorage.removeItem("accessToken"),document.cookie="access_token=; Max-Age=0; path=/; domain="+window.location.hostname+"; secure; samesite=None")}catch(Lt){b(xp(Lt.message))}hi.error("Session expired or unauthorized. Please sign in again."),setTimeout(()=>{g("/sign-in",{replace:!0})},1500);return}!rt.ok||ut.success===!1?ze(ut.message||"Failed to change password"):(ge("Password changed successfully"),setTimeout(()=>{g("/user")},1200))}catch{Se(!1),ze("An error occurred. Please try again.")}};return x.jsxs("div",{className:"min-h-screen flex",children:[x.jsxs("div",{className:"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-blue-600 to-purple-700 relative overflow-hidden",children:[x.jsx("div",{className:"absolute inset-0 bg-black opacity-20"}),x.jsx("div",{className:"relative z-10 flex flex-col justify-center items-center text-white p-12",children:x.jsxs("div",{className:"text-center max-w-md",children:[x.jsx("h1",{className:"text-4xl font-bold mb-6 animate-fade-in",children:"Change Password"}),x.jsx("p",{className:"text-xl mb-8 leading-relaxed animate-fade-in-delay",children:'"Security is not a product, but a process. Keep your account safe with a strong password."'}),x.jsxs("div",{className:"space-y-4 text-lg animate-fade-in-delay-2",children:[x.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[x.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),x.jsx("span",{children:"Secure & Strong"})]}),x.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[x.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"0.5s"}}),x.jsx("span",{children:"Easy to Remember"})]}),x.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[x.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"1s"}}),x.jsx("span",{children:"Keep Your Account Safe"})]})]})]})}),x.jsx("div",{className:"absolute top-20 left-20 w-16 h-16 bg-white bg-opacity-10 rounded-full animate-float"}),x.jsx("div",{className:"absolute bottom-32 right-16 w-12 h-12 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"2s"}}),x.jsx("div",{className:"absolute top-1/2 right-24 w-8 h-8 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"1s"}}),x.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black bg-opacity-20 flex items-center justify-center",children:x.jsx("svg",{className:"w-16 h-16 text-white opacity-30",fill:"currentColor",viewBox:"0 0 20 20",children:x.jsx("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})]}),x.jsx("div",{className:"w-full lg:w-1/2 flex items-center justify-center p-8 bg-gray-50",children:x.jsxs("div",{className:"w-full max-w-md",children:[x.jsxs("div",{className:"text-center mb-8",children:[x.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:" Change Password"}),x.jsx("p",{className:"text-gray-600",children:"Keep your account secure by updating your password regularly."})]}),x.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[x.jsxs("form",{onSubmit:Ke,className:"space-y-6",children:[x.jsxs("div",{children:[x.jsx("label",{htmlFor:"previousPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password"}),x.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"(Enter your existing password)"}),x.jsxs("div",{className:"relative",children:[x.jsx("input",{type:V?"text":"password",placeholder:"Enter your current password",id:"previousPassword",name:"previousPassword",value:I.previousPassword,onChange:Ae,ref:S,disabled:le,className:`w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${le?"bg-gray-100 cursor-not-allowed":""}`,required:!0}),x.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:()=>s(!V),children:V?x.jsx(Og,{className:"text-gray-600"}):x.jsx(au,{className:"text-gray-600"})})]})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),x.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"(Create a strong new password)"}),x.jsxs("div",{className:"relative",children:[x.jsx("input",{type:q?"text":"password",placeholder:"Create a strong password",id:"newPassword",name:"newPassword",value:I.newPassword,onChange:Ae,disabled:le,className:`w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${le?"bg-gray-100 cursor-not-allowed":""}`,required:!0}),x.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:()=>Z(!q),children:q?x.jsx(Og,{className:"text-gray-600"}):x.jsx(au,{className:"text-gray-600"})})]})]}),I.newPassword&&x.jsxs("div",{className:"space-y-3",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Password Strength:"}),x.jsx("span",{className:`text-sm font-semibold ${r5(xe.level)}`,children:a5(xe.level)})]}),x.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:x.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${xe.level==="very-weak"?"bg-red-500 w-1/5":xe.level==="weak"?"bg-red-400 w-2/5":xe.level==="medium"?"bg-yellow-400 w-3/5":xe.level==="strong"?"bg-green-400 w-4/5":"bg-green-500 w-full"}`})}),xe.feedback.length>0&&x.jsxs("div",{className:`p-3 rounded-lg ${s5(xe.level)}`,children:[x.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"To improve your password:"}),x.jsx("ul",{className:"text-xs space-y-1",children:xe.feedback.map((it,rt)=>x.jsxs("li",{className:"flex items-center",children:[x.jsx("span",{className:"mr-2",children:""}),it]},rt))})]}),x.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[x.jsxs("p",{children:[" ",x.jsx("strong",{children:"Tip:"})," Use a unique password for this account"]}),x.jsxs("p",{children:[" ",x.jsx("strong",{children:"Security:"})," Consider using a password manager"]})]})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"confirmNewPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),x.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"(Re-enter your new password)"}),x.jsxs("div",{className:"relative",children:[x.jsx("input",{type:Q?"text":"password",placeholder:"Confirm your new password",id:"confirmNewPassword",name:"confirmNewPassword",value:I.confirmNewPassword,onChange:Ae,disabled:le,className:`w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${le?"bg-gray-100 cursor-not-allowed":""}`,required:!0}),x.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:()=>oe(!Q),children:Q?x.jsx(Og,{className:"text-gray-600"}):x.jsx(au,{className:"text-gray-600"})})]})]}),x.jsx("button",{disabled:le||!p1(I.newPassword)||I.previousPassword===I.newPassword,className:"w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105",children:le?x.jsxs("div",{className:"flex items-center justify-center",children:[x.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Updating..."]}):" Update Password"}),pe&&x.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:x.jsx("p",{className:"text-red-600 text-sm",children:pe})}),te&&x.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:x.jsx("p",{className:"text-blue-600 text-sm",children:te})})]}),x.jsx("div",{className:"mt-6 text-center",children:x.jsxs("p",{className:"text-gray-600",children:["Changed your mind?"," ",x.jsx("button",{onClick:()=>g("/user/profile"),disabled:le,className:`text-blue-600 hover:text-blue-800 font-semibold hover:underline transition-colors duration-200 ${le?"opacity-50 cursor-not-allowed pointer-events-none":""}`,children:"Back to Profile"})]})})]})]})}),x.jsx(i5,{})]})}function nL(){vc("Change Password - Security Settings");const{currentUser:h}=fo(it=>it.user),g=Pl(),b=vp(),S=he.useRef(null),[I,N]=he.useState({previousPassword:"",newPassword:"",confirmNewPassword:""}),[V,s]=he.useState(!1),[q,Z]=he.useState(!1),[Q,oe]=he.useState(!1),[pe,ze]=he.useState(""),[le,Se]=he.useState(!1),[te,ge]=he.useState(""),[xe,ye]=he.useState({score:0,level:"very-weak",feedback:[]});he.useEffect(()=>{S.current&&n5(S.current)},[]);const Pe=it=>{const rt=lb(it);ye(rt)},Ae=it=>{const{name:rt,value:ut}=it.target;N({...I,[rt]:ut}),rt==="newPassword"&&Pe(ut)},Ke=async it=>{if(it.preventDefault(),ze(""),ge(""),I.newPassword!==I.confirmNewPassword){ze("New passwords do not match");return}if(!p1(I.newPassword)){ze("Password does not meet minimum strength requirements");return}if(I.previousPassword===I.newPassword){ze("New password must be different from current password");return}Se(!0);try{const rt=await Q2(`https://urbansetu.onrender.com/api/user/change-password/${h._id}`,{method:"POST",body:JSON.stringify({previousPassword:I.previousPassword,newPassword:I.newPassword})}),ut=await rt.json();if(Se(!1),rt.status===401){ze("Session expired or unauthorized. Please sign in again."),b(S1());try{const lt=await(await fetch("https://urbansetu.onrender.com/api/auth/signout",{credentials:"include"})).json();lt.success===!1?b(xp(lt.message)):(b(Xa(lt)),window.persistor&&window.persistor.purge&&await window.persistor.purge(),Dm(),localStorage.removeItem("accessToken"),document.cookie="access_token=; Max-Age=0; path=/; domain="+window.location.hostname+"; secure; samesite=None")}catch(Lt){b(xp(Lt.message))}hi.error("Session expired or unauthorized. Please sign in again."),setTimeout(()=>{g("/sign-in",{replace:!0})},1500);return}!rt.ok||ut.success===!1?ze(ut.message||"Failed to change password"):(ge("Password changed successfully"),setTimeout(()=>{g("/admin")},1200))}catch{Se(!1),ze("An error occurred. Please try again.")}};return x.jsxs("div",{className:"min-h-screen flex",children:[x.jsxs("div",{className:"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-blue-600 to-purple-700 relative overflow-hidden",children:[x.jsx("div",{className:"absolute inset-0 bg-black opacity-20"}),x.jsx("div",{className:"relative z-10 flex flex-col justify-center items-center text-white p-12",children:x.jsxs("div",{className:"text-center max-w-md",children:[x.jsx("h1",{className:"text-4xl font-bold mb-6 animate-fade-in",children:"Change Password"}),x.jsx("p",{className:"text-xl mb-8 leading-relaxed animate-fade-in-delay",children:'"Security is not a product, but a process. Keep your account safe with a strong password."'}),x.jsxs("div",{className:"space-y-4 text-lg animate-fade-in-delay-2",children:[x.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[x.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),x.jsx("span",{children:"Secure & Strong"})]}),x.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[x.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"0.5s"}}),x.jsx("span",{children:"Easy to Remember"})]}),x.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[x.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"1s"}}),x.jsx("span",{children:"Keep Your Account Safe"})]})]})]})}),x.jsx("div",{className:"absolute top-20 left-20 w-16 h-16 bg-white bg-opacity-10 rounded-full animate-float"}),x.jsx("div",{className:"absolute bottom-32 right-16 w-12 h-12 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"2s"}}),x.jsx("div",{className:"absolute top-1/2 right-24 w-8 h-8 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"1s"}}),x.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black bg-opacity-20 flex items-center justify-center",children:x.jsx("svg",{className:"w-16 h-16 text-white opacity-30",fill:"currentColor",viewBox:"0 0 20 20",children:x.jsx("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})]}),x.jsx("div",{className:"w-full lg:w-1/2 flex items-center justify-center p-8 bg-gray-50",children:x.jsxs("div",{className:"w-full max-w-md",children:[x.jsxs("div",{className:"text-center mb-8",children:[x.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:" Change Password"}),x.jsx("p",{className:"text-gray-600",children:"Keep your account secure by updating your password regularly."})]}),x.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[x.jsxs("form",{onSubmit:Ke,className:"space-y-6",children:[x.jsxs("div",{children:[x.jsx("label",{htmlFor:"previousPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password"}),x.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"(Enter your existing password)"}),x.jsxs("div",{className:"relative",children:[x.jsx("input",{type:V?"text":"password",placeholder:"Enter your current password",id:"previousPassword",name:"previousPassword",value:I.previousPassword,onChange:Ae,ref:S,disabled:le,className:`w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${le?"bg-gray-100 cursor-not-allowed":""}`,required:!0}),x.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:()=>s(!V),children:V?x.jsx(Og,{className:"text-gray-600"}):x.jsx(au,{className:"text-gray-600"})})]})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),x.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"(Create a strong new password)"}),x.jsxs("div",{className:"relative",children:[x.jsx("input",{type:q?"text":"password",placeholder:"Create a strong password",id:"newPassword",name:"newPassword",value:I.newPassword,onChange:Ae,disabled:le,className:`w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${le?"bg-gray-100 cursor-not-allowed":""}`,required:!0}),x.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:()=>Z(!q),children:q?x.jsx(Og,{className:"text-gray-600"}):x.jsx(au,{className:"text-gray-600"})})]})]}),I.newPassword&&x.jsxs("div",{className:"space-y-3",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Password Strength:"}),x.jsx("span",{className:`text-sm font-semibold ${r5(xe.level)}`,children:a5(xe.level)})]}),x.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:x.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${xe.level==="very-weak"?"bg-red-500 w-1/5":xe.level==="weak"?"bg-red-400 w-2/5":xe.level==="medium"?"bg-yellow-400 w-3/5":xe.level==="strong"?"bg-green-400 w-4/5":"bg-green-500 w-full"}`})}),xe.feedback.length>0&&x.jsxs("div",{className:`p-3 rounded-lg ${s5(xe.level)}`,children:[x.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"To improve your password:"}),x.jsx("ul",{className:"text-xs space-y-1",children:xe.feedback.map((it,rt)=>x.jsxs("li",{className:"flex items-center",children:[x.jsx("span",{className:"mr-2",children:""}),it]},rt))})]}),x.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[x.jsxs("p",{children:[" ",x.jsx("strong",{children:"Tip:"})," Use a unique password for this account"]}),x.jsxs("p",{children:[" ",x.jsx("strong",{children:"Security:"})," Consider using a password manager"]})]})]}),x.jsxs("div",{children:[x.jsx("label",{htmlFor:"confirmNewPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),x.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"(Re-enter your new password)"}),x.jsxs("div",{className:"relative",children:[x.jsx("input",{type:Q?"text":"password",placeholder:"Confirm your new password",id:"confirmNewPassword",name:"confirmNewPassword",value:I.confirmNewPassword,onChange:Ae,disabled:le,className:`w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${le?"bg-gray-100 cursor-not-allowed":""}`,required:!0}),x.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:()=>oe(!Q),children:Q?x.jsx(Og,{className:"text-gray-600"}):x.jsx(au,{className:"text-gray-600"})})]})]}),x.jsx("button",{disabled:le||!p1(I.newPassword)||I.previousPassword===I.newPassword,className:"w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105",children:le?x.jsxs("div",{className:"flex items-center justify-center",children:[x.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Updating..."]}):" Update Password"}),pe&&x.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:x.jsx("p",{className:"text-red-600 text-sm",children:pe})}),te&&x.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:x.jsx("p",{className:"text-blue-600 text-sm",children:te})})]}),x.jsx("div",{className:"mt-6 text-center",children:x.jsxs("p",{className:"text-gray-600",children:["Changed your mind?"," ",x.jsx("button",{onClick:()=>g("/admin/profile"),disabled:le,className:`text-blue-600 hover:text-blue-800 font-semibold hover:underline transition-colors duration-200 ${le?"opacity-50 cursor-not-allowed pointer-events-none":""}`,children:"Back to Profile"})]})})]})]})}),x.jsx(i5,{})]})}const lT="https://urbansetu.onrender.com";function rL(){vc("Account Recovery - Restore Account");const{token:h}=ZC(),g=Pl(),[b,S]=he.useState(!0),[I,N]=he.useState(""),[V,s]=he.useState(!1),[q,Z]=he.useState(null),[Q,oe]=he.useState(!1),[pe,ze]=he.useState(!1),[le,Se]=he.useState(null);he.useEffect(()=>{h?te():(N("Invalid or missing token"),S(!1))},[h]);const te=async()=>{try{const xe=await fetch(`${lT}/api/auth/verify-revocation-token/${h}`,{method:"GET",headers:{"Content-Type":"application/json"}}),ye=await xe.json();xe.ok&&ye.success?(Z(ye.accountData),S(!1)):xe.status===410&&ye.error==="PURGED_ACCOUNT"?(ze(!0),Se(ye.details),S(!1)):(N(ye.message||"Invalid or expired token"),S(!1))}catch(xe){console.error("Error verifying token:",xe),N("Failed to verify token. Please try again."),S(!1)}},ge=async()=>{try{oe(!0);const xe=await fetch(`${lT}/api/auth/restore-account`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:h})}),ye=await xe.json();xe.ok&&ye.success?(s(!0),setTimeout(()=>{g("/sign-in")},3e3)):N(ye.message||"Failed to restore account")}catch(xe){console.error("Error restoring account:",xe),N("Failed to restore account. Please try again.")}finally{oe(!1)}};return b?x.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:x.jsxs("div",{className:"text-center",children:[x.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),x.jsx("p",{className:"text-gray-600",children:"Verifying your account restoration link..."})]})}):I?x.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:x.jsxs("div",{className:"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center",children:[x.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:x.jsx(Hy,{className:"w-8 h-8 text-red-600"})}),x.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Invalid Link"}),x.jsx("p",{className:"text-gray-600 mb-6",children:I}),x.jsxs("div",{className:"space-y-3",children:[x.jsx("button",{onClick:()=>g("/"),className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:"Go to Home"}),x.jsx("button",{onClick:()=>g("/sign-in"),className:"w-full bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors",children:"Sign In"})]})]})}):V?x.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:x.jsxs("div",{className:"max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center",children:[x.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:x.jsx(Tm,{className:"w-8 h-8 text-green-600"})}),x.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Account Restored!"}),x.jsx("p",{className:"text-gray-600 mb-6",children:"Your account has been successfully restored. You will be redirected to the sign-in page shortly."}),x.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})]})}):pe?x.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:x.jsxs("div",{className:"max-w-lg w-full bg-white rounded-xl shadow-lg overflow-hidden",children:[x.jsxs("div",{className:"bg-gradient-to-r from-red-600 to-red-700 px-8 py-6 text-white text-center",children:[x.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Account Permanently Deleted"}),x.jsx("p",{className:"text-red-100",children:"This account can no longer be restored"})]}),x.jsxs("div",{className:"p-8",children:[x.jsxs("div",{className:"text-center mb-6",children:[x.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:x.jsx(Hy,{className:"w-8 h-8 text-red-600"})}),x.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Account No Longer Available"}),x.jsx("p",{className:"text-gray-600",children:"This account has been permanently deleted and cannot be restored. However, you can create a new account to continue using our services."})]}),le&&x.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[x.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[x.jsx(Il,{className:"w-4 h-4 mr-2"}),"Previous Account Information"]}),x.jsxs("div",{className:"space-y-3",children:[x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-600",children:"Username:"}),x.jsx("span",{className:"font-medium",children:le.username})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-600",children:"Email:"}),x.jsx("span",{className:"font-medium",children:le.email})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-600",children:"Permanently Deleted:"}),x.jsx("span",{className:"font-medium text-red-600",children:new Date(le.purgedAt).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-600",children:"Days Since Purge:"}),x.jsxs("span",{className:"font-medium text-red-600",children:[Math.ceil((new Date-new Date(le.purgedAt))/(1e3*60*60*24))," days"]})]})]})]}),x.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[x.jsxs("div",{className:"flex items-center mb-2",children:[x.jsx(Hy,{className:"w-4 h-4 text-red-600 mr-2"}),x.jsx("span",{className:"font-semibold text-red-800",children:"Important Notice"})]}),x.jsx("p",{className:"text-red-700 text-sm",children:"This account has been permanently deleted and cannot be restored. All data associated with this account has been permanently removed from our systems."})]}),x.jsxs("div",{className:"space-y-3",children:[x.jsxs("button",{onClick:()=>g("/sign-up"),className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center",children:[x.jsx(Il,{className:"w-4 h-4 mr-2"}),"Create New Account"]}),x.jsx("button",{onClick:()=>g("/sign-in"),className:"w-full bg-gray-600 text-white py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors flex items-center justify-center",children:"Sign In to Existing Account"}),x.jsx("button",{onClick:()=>g("/"),className:"w-full bg-gray-200 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-300 transition-colors",children:"Go to Home"})]}),x.jsx("div",{className:"mt-6 text-center",children:x.jsx("p",{className:"text-sm text-gray-500",children:"By creating a new account, you agree to our Terms of Service and Privacy Policy."})})]})]})}):x.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:x.jsxs("div",{className:"max-w-lg w-full bg-white rounded-xl shadow-lg overflow-hidden",children:[x.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 px-8 py-6 text-white text-center",children:[x.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Restore Your Account"}),x.jsx("p",{className:"text-blue-100",children:"Welcome back to UrbanSetu!"})]}),x.jsxs("div",{className:"p-8",children:[x.jsxs("div",{className:"text-center mb-6",children:[x.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:x.jsx(Il,{className:"w-8 h-8 text-blue-600"})}),x.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Account Found"}),x.jsx("p",{className:"text-gray-600",children:"We found your deleted account. You can restore it with all your previous data intact."})]}),q&&x.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[x.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[x.jsx(Il,{className:"w-4 h-4 mr-2"}),"Account Information"]}),x.jsxs("div",{className:"space-y-3",children:[x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-600",children:"Username:"}),x.jsx("span",{className:"font-medium",children:q.username})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-600",children:"Email:"}),x.jsx("span",{className:"font-medium",children:q.email})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-600",children:"Role:"}),x.jsx("span",{className:"font-medium flex items-center",children:q.role==="admin"?x.jsxs(x.Fragment,{children:[x.jsx(uI,{className:"w-3 h-3 mr-1 text-purple-600"}),"Administrator"]}):"User"})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-600",children:"Account Deleted:"}),x.jsx("span",{className:"font-medium",children:new Date(q.deletedAt).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-600",children:"Days Since Deletion:"}),x.jsxs("span",{className:"font-medium",children:[Math.ceil((new Date-new Date(q.deletedAt))/(1e3*60*60*24))," days"]})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-600",children:"Link Valid Until:"}),x.jsx("span",{className:"font-medium text-green-600",children:new Date(q.expiresAt).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),x.jsxs("div",{className:"flex justify-between",children:[x.jsx("span",{className:"text-gray-600",children:"Days Remaining:"}),x.jsxs("span",{className:"font-medium text-green-600",children:[Math.max(0,Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24)))," days"]})]})]})]}),q&&x.jsxs("div",{className:`rounded-lg p-4 mb-6 ${Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=3?"bg-red-50 border border-red-200":Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=7?"bg-orange-50 border border-orange-200":"bg-green-50 border border-green-200"}`,children:[x.jsxs("div",{className:"flex items-center mb-2",children:[x.jsx("div",{className:`w-3 h-3 rounded-full mr-2 ${Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=3?"bg-red-500":Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=7?"bg-orange-500":"bg-green-500"}`}),x.jsx("span",{className:`font-semibold ${Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=3?"text-red-800":Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=7?"text-orange-800":"text-green-800"}`,children:Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=3?"URGENT: Link expires soon!":Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=7?"WARNING: Link expires in less than a week":"Status: Link is valid"})]}),x.jsx("p",{className:`text-sm ${Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=3?"text-red-700":Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=7?"text-orange-700":"text-green-700"}`,children:Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=3?"Please restore your account immediately to avoid permanent data loss.":Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24))<=7?"Consider restoring your account soon to avoid missing the deadline.":"You have plenty of time to restore your account when convenient."})]}),x.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:[x.jsxs("div",{className:"flex items-center mb-2",children:[x.jsx(C1,{className:"w-4 h-4 text-yellow-600 mr-2"}),x.jsx("span",{className:"font-semibold text-yellow-800",children:"Important Notice"})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsxs("p",{className:"text-yellow-700 text-sm",children:["This restoration link will expire on ",x.jsx("strong",{children:q&&new Date(q.expiresAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})," (30 days from deletion)."]}),x.jsxs("p",{className:"text-yellow-700 text-sm",children:["You have ",x.jsxs("strong",{className:"text-yellow-800",children:[q&&Math.max(0,Math.ceil((new Date(q.expiresAt)-new Date)/(1e3*60*60*24)))," days"]})," remaining to restore your account."]}),x.jsx("p",{className:"text-yellow-700 text-sm",children:"After expiration, your account will be permanently removed and cannot be restored."})]})]}),x.jsx("button",{onClick:ge,disabled:Q,className:"w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:Q?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Restoring Account..."]}):x.jsxs(x.Fragment,{children:[x.jsx(Tm,{className:"w-4 h-4 mr-2"}),"Restore My Account"]})}),x.jsx("div",{className:"mt-6 text-center",children:x.jsx("p",{className:"text-sm text-gray-500",children:"By restoring your account, you agree to our Terms of Service and Privacy Policy."})})]})]})})}function sL(){return vc("Terms & Conditions - Legal Information"),x.jsxs("div",{className:"max-w-4xl mx-auto py-10 px-4",children:[x.jsx("h1",{className:"text-4xl font-bold mb-6 text-blue-700",children:"Terms & Conditions"}),x.jsxs("div",{className:"space-y-6 text-gray-800 text-base",children:[x.jsx("p",{className:"text-lg",children:"Welcome to UrbanSetu, our comprehensive real estate platform. By using our services, you agree to the following terms and conditions. Please read them carefully. By registering, you must select a role (user or admin) and provide explicit consent to our Terms & Privacy Policy."}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"1. Platform Overview & Services"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Real Estate Marketplace:"})," We provide a platform for buying, selling, and renting properties with advanced search and matching capabilities."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Smart Features:"})," AI-powered search, price monitoring, fraud detection, and intelligent property recommendations."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"User Roles:"})," Users can register as buyers, sellers, or administrators with different access levels and responsibilities."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Communication Tools:"})," Built-in messaging, appointment scheduling, and notification systems."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Analytics & Insights:"})," Market data, price trends, and property analytics for informed decision-making."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"2. User Registration & Account Management"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Account Creation:"})," You must provide accurate information including name, email, unique mobile number (10 digits), and select an appropriate role."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Verification:"})," Mobile number verification via OTP is required for account activation and security."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Password Security:"})," Strong password requirements are enforced. You are responsible for maintaining account security."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Account Deletion:"})," You may delete your account at any time. Data will be removed except where retention is legally required."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Multiple Accounts:"})," Creating multiple accounts to circumvent restrictions is prohibited."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"3. Property Listings & Content"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Accurate Information:"})," All property details, images, and descriptions must be truthful and current."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Image Rights:"})," You must own or have permission to use all uploaded images and content."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Pricing:"})," Property prices must be accurate and include all applicable fees and taxes."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Availability:"})," You must promptly update listing status (available, sold, rented) to maintain platform integrity."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Content Moderation:"})," We reserve the right to review, edit, or remove content that violates our guidelines."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"4. Smart Features & AI Services"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Natural Language Search:"})," Our AI processes search queries to provide relevant property recommendations."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Price Monitoring:"})," Watchlist features track price changes and send notifications about market movements."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Fraud Detection:"})," Automated systems monitor for suspicious activities and fraudulent listings."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Recommendations:"})," AI-powered suggestions based on your preferences and browsing history."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Data Usage:"})," Your interaction data helps improve our AI algorithms and service quality."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"5. User Responsibilities & Conduct"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Fair Dealing:"})," All users must act honestly and fairly in all transactions and communications."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"No Discrimination:"})," Discrimination based on race, gender, religion, or any protected status is strictly prohibited."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Respectful Communication:"})," Maintain professional and respectful communication with other users."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Legal Compliance:"})," All activities must comply with applicable local, state, and federal laws."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Prohibited Activities:"})," No spam, harassment, fraud, or misuse of platform features."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"6. Admin Responsibilities"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Impartial Review:"})," Admins must review listings and requests without bias or personal interest."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Platform Integrity:"})," Maintain platform quality by enforcing rules and removing inappropriate content."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"User Support:"})," Provide timely assistance and resolve disputes fairly."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Data Protection:"})," Handle user data responsibly and in accordance with privacy policies."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Security Monitoring:"})," Monitor for security threats and take appropriate action."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"7. Transactions & Payments"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Direct Transactions:"})," Property transactions occur directly between users. We facilitate connections but are not party to transactions."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Payment Processing:"})," Any payment features are provided by third-party services with their own terms."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Transaction Records:"})," We may maintain records of communications and appointments for dispute resolution."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Dispute Resolution:"})," Users are responsible for resolving transaction disputes. We may provide mediation services."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"8. Privacy & Data Protection"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Consent:"})," Explicit consent is required for data processing and certain platform features."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Data Usage:"})," Your data is used to provide services, improve platform functionality, and ensure security."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Third-Party Sharing:"})," We may share data with service providers but do not sell personal information."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Security Measures:"})," We implement industry-standard security measures to protect your data."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"9. Platform Rules & Enforcement"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Content Standards:"})," All content must be appropriate, legal, and relevant to real estate."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Account Suspension:"})," We may suspend or terminate accounts for violations of these terms."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Appeal Process:"})," Users may appeal account actions through our support system."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Platform Modifications:"})," We reserve the right to modify or discontinue features with notice."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"10. Intellectual Property"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Platform Rights:"})," We own all rights to the platform, including software, design, and content."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"User Content:"})," You retain rights to your content but grant us license to use it on the platform."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Prohibited Use:"})," No copying, reverse engineering, or unauthorized use of platform features."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"11. Limitation of Liability"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Service Availability:"})," We strive for uptime but do not guarantee uninterrupted service."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Third-Party Actions:"})," We are not responsible for actions of other users or third parties."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Property Transactions:"})," All property transactions are the responsibility of the involved parties."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Damages:"})," Our liability is limited to the maximum extent permitted by law."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"12. Changes to Terms"}),x.jsx("p",{className:"ml-6",children:"We may update these terms from time to time. Significant changes will be communicated through email or platform notifications. Continued use of the platform constitutes acceptance of the updated terms."}),x.jsxs("div",{className:"mt-8 p-6 bg-blue-50 rounded-lg border border-blue-200",children:[x.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"Contact Information"}),x.jsx("p",{className:"text-gray-700",children:"For questions about these terms or our services, please contact us:"}),x.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[x.jsx("li",{children:" Email: legal@urbansetu.com"}),x.jsx("li",{children:" Phone: +1 (555) 123-4567"}),x.jsx("li",{children:" Address: UrbanSetu Legal Team, Real Estate Platform"})]})]}),x.jsxs("p",{className:"mt-6 text-sm text-gray-600",children:["Last updated: ",new Date().toLocaleDateString()]})]})]})}function aL(){return vc("Privacy Policy - Data Protection"),x.jsxs("div",{className:"max-w-4xl mx-auto py-10 px-4",children:[x.jsx("h1",{className:"text-4xl font-bold mb-6 text-blue-700",children:"Privacy Policy"}),x.jsxs("div",{className:"space-y-6 text-gray-800 text-base",children:[x.jsx("p",{className:"text-lg",children:"Your privacy is important to us. This policy explains how we collect, use, and protect your information as a user or admin of our UrbanSetu real estate platform."}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"1. Information We Collect"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Account Information:"})," Name, email, validated mobile number (unique 10 digits), role selection (user/admin), profile picture, and authentication credentials."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Property Data:"})," Property listings, images, descriptions, pricing, location details, property specifications, and availability status."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Transaction Data:"})," Appointments, bookings, communications, payment information, and transaction history."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Platform Usage:"})," Search queries, watchlist items, wishlist preferences, browsing behavior, and interaction patterns."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Communication Data:"})," Messages, reviews, ratings, support tickets, and feedback."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Technical Data:"})," IP address, browser type, device information, location data, and usage analytics."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Security Data:"})," Login attempts, security events, OTP verification, and fraud prevention data."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"2. How We Use Your Information"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Service Provision:"})," To provide, maintain, and improve our real estate platform services."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"User Experience:"})," To personalize content, provide smart search results, and recommend relevant properties."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Communication:"})," To send notifications about price changes, new listings, appointments, and platform updates."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Security:"})," To prevent fraud, detect suspicious activities, and protect user accounts."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Analytics:"})," To understand user behavior, improve platform performance, and develop new features."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Compliance:"})," To comply with legal obligations and enforce platform terms."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"3. Smart Features & AI Integration"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Natural Language Processing:"})," We use AI to process search queries and provide intelligent property recommendations."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Price Monitoring:"})," We track property prices in your watchlist and notify you of changes."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Smart Notifications:"})," AI-powered alerts for price drops, new listings matching your preferences, and market insights."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Fraud Detection:"})," Automated systems to detect and prevent fraudulent activities and suspicious listings."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Content Moderation:"})," AI-assisted review of listings, images, and user-generated content for quality and compliance."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"4. Data Sharing & Third Parties"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"No Sale Policy:"})," We do not sell your personal information to third parties."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Service Providers:"})," We may share data with trusted partners for payment processing, email services, and analytics."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Legal Requirements:"})," We may disclose information when required by law or to protect our rights and users."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Business Transfers:"})," In case of merger or acquisition, user data may be transferred as part of business assets."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Public Information:"})," Property listings and reviews may be publicly visible as part of the platform's core functionality."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"5. Your Rights & Control"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Access:"})," You can view and download your personal data through your account settings."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Correction:"})," You can update your profile information, preferences, and account settings at any time."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Deletion:"})," You can delete your account, which will remove your personal data (except where retention is legally required)."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Portability:"})," You can export your data in a machine-readable format."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Opt-out:"})," You can unsubscribe from marketing communications while maintaining essential service notifications."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Consent Withdrawal:"})," You can withdraw consent for data processing where applicable."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"6. Data Security & Protection"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Encryption:"})," All data is encrypted in transit and at rest using industry-standard protocols."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Access Controls:"})," Strict access controls and authentication mechanisms protect your data."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Regular Audits:"})," We conduct regular security assessments and vulnerability testing."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Incident Response:"})," We have procedures in place to respond to and notify users of any data breaches."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Staff Training:"})," Our team is trained on data protection and privacy best practices."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"7. Data Retention"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Account Data:"})," Retained while your account is active and for a reasonable period after deletion."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Transaction Records:"})," Kept for legal and accounting purposes as required by law."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Communication Data:"})," Retained for customer service and dispute resolution purposes."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Analytics Data:"})," Aggregated and anonymized data may be retained for business insights."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"8. International Data Transfers"}),x.jsx("p",{className:"ml-6",children:"Your data may be processed and stored in servers located outside your country. We ensure appropriate safeguards are in place to protect your data in accordance with applicable privacy laws."}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"9. Children's Privacy"}),x.jsx("p",{className:"ml-6",children:"Our platform is not intended for users under 18 years of age. We do not knowingly collect personal information from children."}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"10. Changes to This Policy"}),x.jsx("p",{className:"ml-6",children:"We may update this privacy policy from time to time. We will notify you of significant changes through email or platform notifications. Continued use of the platform constitutes acceptance of the updated policy."}),x.jsxs("div",{className:"mt-8 p-6 bg-blue-50 rounded-lg border border-blue-200",children:[x.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"Contact Us"}),x.jsx("p",{className:"text-gray-700",children:"If you have any questions about this privacy policy or our data practices, please contact us:"}),x.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[x.jsx("li",{children:" Email: privacy@urbansetu.com"}),x.jsx("li",{children:" Phone: +1 (555) 123-4567"}),x.jsx("li",{children:" Address: UrbanSetu Privacy Team, Real Estate Platform"})]})]}),x.jsxs("p",{className:"mt-6 text-sm text-gray-600",children:["Last updated: ",new Date().toLocaleDateString()]})]})]})}function oL(){return vc("User Terms & Conditions - Legal Information"),x.jsxs("div",{className:"max-w-4xl mx-auto py-10 px-4",children:[x.jsx("h1",{className:"text-4xl font-bold mb-6 text-blue-700",children:"User Terms & Conditions"}),x.jsxs("div",{className:"space-y-6 text-gray-800 text-base",children:[x.jsx("p",{className:"text-lg",children:"By using UrbanSetu, you agree to these user terms. Please read them carefully."}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"1. Your Responsibilities"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsx("li",{children:"Provide accurate information. Mobile number must be unique and valid."}),x.jsx("li",{children:"Respect privacy and rights of others. No harassment or fraud."}),x.jsx("li",{children:"Ensure your listings are truthful and updated. False listings may lead to action."})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"2. Account & Consent"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsx("li",{children:"Explicit consent is required for our Terms and Privacy Policy."}),x.jsx("li",{children:"You may delete your account; data retention applies where required by law."}),x.jsx("li",{children:"Use strong passwords and keep your account secure."})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"3. Platform Use"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsx("li",{children:"Follow applicable laws and platform rules."}),x.jsx("li",{children:"We may remove content that violates guidelines."}),x.jsx("li",{children:"Admins may suspend accounts for serious violations."})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"4. Smart & AI Features"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsx("li",{children:"Natural language search, recommendations, and watchlist price monitoring."}),x.jsx("li",{children:"Notifications for price drops, new listings, and appointments."})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"5. Liability"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsx("li",{children:"We are not party to property transactions between users."}),x.jsx("li",{children:"We are not responsible for third-party actions."})]}),x.jsxs("p",{className:"mt-6 text-sm text-gray-600",children:["Last updated: ",new Date().toLocaleDateString()]})]})]})}function lL(){return vc("Admin Terms & Conditions - Legal Information"),x.jsxs("div",{className:"max-w-4xl mx-auto py-10 px-4",children:[x.jsx("h1",{className:"text-4xl font-bold mb-6 text-blue-700",children:"Admin Terms & Conditions"}),x.jsxs("div",{className:"space-y-6 text-gray-800 text-base",children:[x.jsx("p",{className:"text-lg",children:"By using UrbanSetu admin tools, you agree to these admin terms."}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"1. Admin Responsibilities"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsx("li",{children:"Act impartially and in users' best interests."}),x.jsx("li",{children:"Do not abuse admin privileges for personal gain."}),x.jsx("li",{children:"Maintain confidentiality of sensitive user and business data."}),x.jsx("li",{children:"Default admin privileges may have additional constraints."})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"2. Security & Compliance"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsx("li",{children:"Use strong authentication and keep sessions secure."}),x.jsx("li",{children:"Follow audit and logging practices for critical actions."}),x.jsx("li",{children:"Comply with applicable laws, regulations, and company policies."})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"3. Platform Rules"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsx("li",{children:"We may revoke admin access for violations."}),x.jsx("li",{children:"Admins must not bypass safeguards or manipulate data improperly."})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"4. Smart & AI Features"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsx("li",{children:"Use AI insights responsibly; verify results for critical actions."}),x.jsx("li",{children:"Do not rely solely on AI for compliance or legal decisions."})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"5. Liability"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsx("li",{children:"Admin actions are traceable; misuse can result in suspension or legal action."}),x.jsx("li",{children:"UrbanSetu is not responsible for third-party actions."})]}),x.jsxs("p",{className:"mt-6 text-sm text-gray-600",children:["Last updated: ",new Date().toLocaleDateString()]})]})]})}function cL(){return vc("User Privacy Policy - Data Protection"),x.jsxs("div",{className:"max-w-4xl mx-auto py-10 px-4",children:[x.jsx("h1",{className:"text-4xl font-bold mb-6 text-blue-700",children:"User Privacy Policy"}),x.jsxs("div",{className:"space-y-6 text-gray-800 text-base",children:[x.jsx("p",{className:"text-lg",children:"Your privacy is important to us. This policy explains how we collect, use, and protect your information as a user of UrbanSetu."}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"1. Information We Collect"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Account Information:"})," Name, email, validated mobile number (unique 10 digits), role (user), profile picture, and authentication credentials."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Property Data:"})," Listings you create, save, watch, or interact with; images and descriptions you upload."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Activity Data:"})," Search queries, wishlist and watchlist items, appointments, messages, and reviews."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Technical Data:"})," IP address, device and browser details, and usage analytics."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Security Data:"})," Login attempts, OTP verification, and fraud prevention signals."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"2. How We Use Your Information"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Provide Services:"})," Enable listings, search, watchlist, wishlist, and appointments."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Personalize Experience:"})," Smart search, recommendations, and relevant suggestions."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Notify:"})," Price-drop alerts, property updates, booking confirmations."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Protect:"})," Security monitoring, fraud detection, and abuse prevention."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Improve:"})," Analytics for product improvements and feature development."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"3. Your Rights"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Access & Correction:"})," View and update your profile data."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Deletion:"})," Delete your account to remove personal data (subject to legal retention)."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Opt-out:"})," Unsubscribe from marketing while keeping essential notifications."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Consent:"})," Withdraw consent for processing where applicable."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"4. Sharing & Third Parties"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"No Sale:"})," We do not sell personal information."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Service Providers:"})," Payments, email and analytics providers under strict agreements."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Legal:"})," Disclosures required by law or to protect rights and users."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"5. Security"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsx("li",{children:"Encryption in transit, access controls, regular audits, and incident response."}),x.jsx("li",{children:"Despite safeguards, no system is perfectuse the platform responsibly."})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"6. AI & Smart Features"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsx("li",{children:"We use NLP for search and recommendations."}),x.jsx("li",{children:"We monitor watchlist prices to send helpful alerts."})]}),x.jsxs("p",{className:"mt-6 text-sm text-gray-600",children:["Last updated: ",new Date().toLocaleDateString()]})]})]})}function uL(){return vc("Admin Privacy Policy - Data Protection"),x.jsxs("div",{className:"max-w-4xl mx-auto py-10 px-4",children:[x.jsx("h1",{className:"text-4xl font-bold mb-6 text-blue-700",children:"Admin Privacy Policy"}),x.jsxs("div",{className:"space-y-6 text-gray-800 text-base",children:[x.jsx("p",{className:"text-lg",children:"This policy explains how we collect, use, and protect your information as an admin on UrbanSetu."}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"1. Information We Collect"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Admin Profile:"})," Name, email, validated mobile number (unique 10 digits), role (admin/rootadmin), and authentication credentials."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Admin Activity:"})," Listing approvals, edits, removals, reviews, unlocks, and other moderation actions."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Operational Data:"})," Security events, OTP lockouts handling, system notices, and audit logs."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Technical Data:"})," IP address, device and browser details, usage analytics, and error logs."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"2. How We Use Admin Information"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"Operations:"})," Perform admin duties and maintain platform integrity."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Security:"})," Monitor threats, manage lockouts, and prevent abuse."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Compliance:"})," Maintain audit trails and follow legal obligations."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Improvement:"})," Use analytics and feedback to improve tooling."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"3. Admin Rights"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsx("li",{children:"Access your data and request corrections."}),x.jsx("li",{children:"Request account deletion (may be limited for default admins)."}),x.jsx("li",{children:"Receive important operational and security notifications."})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"4. Sharing & Third Parties"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsxs("li",{children:[x.jsx("strong",{children:"No Sale:"})," We do not sell admin information."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Service Providers:"})," Infrastructure, monitoring, analytics under strict agreements."]}),x.jsxs("li",{children:[x.jsx("strong",{children:"Legal:"})," Disclosures required by law or to protect our users and platform."]})]}),x.jsx("h2",{className:"text-2xl font-semibold mt-8 mb-4 text-blue-600",children:"5. Security"}),x.jsxs("ul",{className:"list-disc ml-6 space-y-3",children:[x.jsx("li",{children:"Role-based access, encryption, audit logging, and incident response."}),x.jsx("li",{children:"Despite safeguards, no system is perfectuse admin tools responsibly."})]}),x.jsxs("p",{className:"mt-6 text-sm text-gray-600",children:["Last updated: ",new Date().toLocaleDateString()]})]})]})}const Wa="https://urbansetu.onrender.com";function hL(){var cr,$n;vc("Account Management - User & Admin Control");const{currentUser:h}=fo(Ve=>Ve.user),g=Pl(),b=vp(),[S,I]=he.useState([]),[N,V]=he.useState([]),[s,q]=he.useState(!0),[Z,Q]=he.useState("users"),[oe,pe]=he.useState([]),[ze,le]=he.useState({q:"",role:"all",softbannedBy:"",from:"",to:""}),[Se,te]=he.useState(!1),[ge,xe]=he.useState([]),[ye,Pe]=he.useState({q:"",role:"all",purgedBy:"",from:"",to:""}),[Ae,Ke]=he.useState(!1),[it,rt]=he.useState({}),[ut,Lt]=he.useState(!1),[lt,Jt]=he.useState(null),[wi,Fi]=he.useState(!1),[Bi,Wt]=he.useState(""),[ki,Ui]=he.useState(""),[Cn,Qe]=he.useState({category:"",banType:"allow",allowResignupAfterDays:0,notes:""}),[Ft,Di]=he.useState(!1),[Zi,ii]=he.useState(!1),[Yi,Ti]=he.useState(""),[Mi,Ii]=he.useState(""),[xt,St]=he.useState(null),[Ei,Sn]=he.useState(!1),[Mn,Nn]=he.useState(""),[In,qr]=he.useState(""),[bs,fa]=he.useState(null),[Un,es]=he.useState({suspend:{},promote:{},demote:{},softban:!1,restore:!1,purge:!1}),[js,po]=he.useState(!1),[mo,As]=he.useState({listings:0,appointments:0}),[ws,Gr]=he.useState(""),[Yr,Bs]=he.useState("all"),[Fs,Sa]=he.useState("all"),[Or,Ea]=he.useState([]),[Ya,ss]=he.useState(!0),[Ka,Ls]=he.useState(""),[hs,fr]=he.useState(""),[as,bc]=he.useState(!1),[ka,ds]=he.useState(!1),[Ur,No]=he.useState({title:"",message:"",onConfirm:null,confirmText:"Confirm",cancelText:"Cancel",confirmButtonClass:"bg-red-500 hover:bg-red-600"}),pa=he.useRef(null),Mt=he.useRef(null);he.useEffect(()=>{h&&ea()},[h]),he.useEffect(()=>{function Ve({type:Bt,user:Qt}){I(bi=>Bt==="delete"?bi.filter($i=>$i._id!==Qt._id):Bt==="update"?bi.map($i=>$i._id===Qt._id?Qt:$i):Bt==="add"?[Qt,...bi]:bi)}function wt({type:Bt,admin:Qt}){V(bi=>Bt==="delete"?bi.filter($i=>$i._id!==Qt._id):Bt==="update"?bi.map($i=>$i._id===Qt._id?Qt:$i):Bt==="add"?[Qt,...bi]:bi)}return fn.on("user_update",Ve),fn.on("admin_update",wt),()=>{fn.off("user_update",Ve),fn.off("admin_update",wt)}},[]),he.useEffect(()=>{const Ve=wt=>{if((wt.ctrlKey||wt.metaKey)&&wt.key==="f"){wt.preventDefault();const Bt=document.getElementById("admin-management-search");Bt&&Bt.focus()}};return document.addEventListener("keydown",Ve),()=>document.removeEventListener("keydown",Ve)},[]);const ea=async()=>{q(!0);try{const wt=await(await fetch(`${Wa}/api/admin/management/users`,{credentials:"include"})).json();if(I(wt),h.isDefaultAdmin){const Qt=await(await fetch(`${Wa}/api/admin/management/admins`,{credentials:"include"})).json();V(Qt)}try{const Bt=await fetch(`${Wa}/api/auth/password-lockouts`,{credentials:"include"}),Qt=await Bt.json();Bt.ok&&Qt&&Array.isArray(Qt.items)?Ea(Qt.items):Ea([])}catch{Ea([])}try{await go()}catch{}try{await Na()}catch{}}catch{hi.error("Failed to fetch accounts")}finally{q(!1)}},go=async()=>{te(!0);try{const Ve=new URLSearchParams;ze.q&&Ve.set("q",ze.q),ze.role&&ze.role!=="all"&&Ve.set("role",ze.role),ze.softbannedBy&&Ve.set("softbannedBy",ze.softbannedBy),ze.from&&Ve.set("from",ze.from),ze.to&&Ve.set("to",ze.to);const wt=await fetch(`${Wa}/api/admin/deleted-accounts?${Ve.toString()}`,{credentials:"include"}),Bt=await wt.json();wt.ok&&Bt&&Array.isArray(Bt.items)?pe(Bt.items.filter(Qt=>!Qt.purgedAt)):pe([])}catch{pe([])}finally{te(!1)}},Na=async()=>{Ke(!0);try{const Ve=new URLSearchParams;ye.q&&Ve.set("q",ye.q),ye.role&&ye.role!=="all"&&Ve.set("role",ye.role),ye.purgedBy&&Ve.set("purgedBy",ye.purgedBy),ye.from&&Ve.set("from",ye.from),ye.to&&Ve.set("to",ye.to);const wt=await fetch(`${Wa}/api/admin/deleted-accounts?${Ve.toString()}`,{credentials:"include"}),Bt=await wt.json();wt.ok&&Bt&&Array.isArray(Bt.items)?xe(Bt.items.filter(Qt=>Qt.purgedAt)):xe([])}catch{xe([])}finally{Ke(!1)}},He=async(Ve,wt)=>{const Bt=wt==="user"?S.find(Kn=>Kn._id===Ve):N.find(Kn=>Kn._id===Ve),Qt=(Bt==null?void 0:Bt.status)==="active",bi=Qt?"suspend":"activate",$i=Qt?"Suspend":"Activate";if(Qt){St({id:Ve,type:wt}),Ti(""),ii(!0);return}const yr=async()=>{es(Kn=>({...Kn,suspend:{...Kn.suspend,[Ve]:!0}})),wt==="user"?I(Kn=>Kn.map(ar=>ar._id===Ve?{...ar,status:ar.status==="active"?"suspended":"active"}:ar)):V(Kn=>Kn.map(ar=>ar._id===Ve?{...ar,status:ar.status==="active"?"suspended":"active"}:ar));try{const Kn=await fetch(`${Wa}/api/admin/management/suspend/${wt}/${Ve}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:Qt?Yi||"Policy violation":null})}),ar=await Kn.json();Kn.ok?(hi.success(`${wt==="user"?"User":"Admin"} status updated`),rt(Sr=>({...Sr,[Ve]:void 0})),fn.emit(wt==="user"?"user_update":"admin_update",{type:"update",[wt]:ar,userId:Ve}),fn.emit("force_signout",{userId:Ve,action:"suspend",message:`Your account has been ${ar.status==="suspended"?"suspended":"activated"}. You have been signed out.`}),ds(!1)):(ea(),hi.error(ar.message||"Failed to update status"),rt(Sr=>({...Sr,[Ve]:"Can't able to suspend account, may be softbanned or moved"})),setTimeout(()=>rt(Sr=>({...Sr,[Ve]:void 0})),4e3))}catch{ea(),hi.error("Failed to update status"),rt(ar=>({...ar,[Ve]:"Can't able to suspend account, may be deleted or moved"})),setTimeout(()=>rt(ar=>({...ar,[Ve]:void 0})),4e3)}finally{es(Kn=>({...Kn,suspend:{...Kn.suspend,[Ve]:!1}}))}};Ai(`${$i} ${wt==="user"?"User":"Admin"}`,`Are you sure you want to ${bi} this ${wt}? ${Qt?"They will be signed out and unable to access their account.":"They will regain access to their account."}`,yr,{confirmText:$i,confirmButtonClass:Qt?"bg-yellow-500 hover:bg-yellow-600":"bg-green-500 hover:bg-green-600",userId:Ve})},J=async()=>{if(!xt)return;const{id:Ve,type:wt}=xt;es(Bt=>({...Bt,suspend:{...Bt.suspend,[Ve]:!0}})),wt==="user"?I(Bt=>Bt.map(Qt=>Qt._id===Ve?{...Qt,status:"suspended"}:Qt)):V(Bt=>Bt.map(Qt=>Qt._id===Ve?{...Qt,status:"suspended"}:Qt));try{const Bt=await fetch(`${Wa}/api/admin/management/suspend/${wt}/${Ve}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:Yi==="other"?Mi:Yi||"Policy violation"})}),Qt=await Bt.json();Bt.ok?(hi.success(`${wt==="user"?"User":"Admin"} suspended successfully`),rt(bi=>({...bi,[Ve]:void 0})),fn.emit(wt==="user"?"user_update":"admin_update",{type:"update",[wt]:Qt,userId:Ve}),fn.emit("force_signout",{userId:Ve,action:"suspend",message:"Your account has been suspended. You have been signed out."}),ii(!1),St(null),Ti(""),Ii("")):(ea(),hi.error(Qt.message||"Failed to suspend account"),rt(bi=>({...bi,[Ve]:"Can't able to suspend account, may be softbanned or moved"})),setTimeout(()=>rt(bi=>({...bi,[Ve]:void 0})),4e3))}catch{ea(),hi.error("Failed to suspend account"),rt(Qt=>({...Qt,[Ve]:"Can't able to suspend account, may be deleted or moved"})),setTimeout(()=>rt(Qt=>({...Qt,[Ve]:void 0})),4e3)}finally{es(Bt=>({...Bt,suspend:{...Bt.suspend,[Ve]:!1}}))}},ne=async(Ve,wt)=>{Jt({_id:Ve,type:wt}),Wt(""),Ui(""),Qe({category:"",banType:"allow",allowResignupAfterDays:0,notes:""}),Fi(!0)},_e=async()=>{const Ve=lt;if(!Ve)return;const wt=Ve._id,Bt=Ve.type,Qt=Bi==="other"?ki||"":Bi,$i={...Cn,category:Bi==="other"?"other":Bi},yr=async()=>{es(Sr=>({...Sr,softban:!0}));const Kn=[...S],ar=[...N];Bt==="user"?I(Sr=>Sr.filter(Vr=>Vr._id!==wt)):V(Sr=>Sr.filter(Vr=>Vr._id!==wt));try{const Sr=await fetch(`${Wa}/api/admin/management/delete/${Bt}/${wt}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:Qt,policy:$i})}),Vr=await Sr.json();Sr.ok?(hi.success(`${Bt==="user"?"User":"Admin"} softbanned successfully`),fn.emit(Bt==="user"?"user_update":"admin_update",{type:"delete",[Bt]:{_id:wt},userId:wt}),fn.emit("force_signout",{userId:wt,action:"softban",message:"Your account has been softbanned. You have been signed out."}),Z==="softbanned"&&go(),ds(!1),Fi(!1),Jt(null),Wt(""),Ui("")):(Bt==="user"?I(Kn):V(ar),Sr.status===404||Vr.message&&Vr.message.toLowerCase().includes("not found")?hi.error("Account not found. It may have been already softbanned or moved."):hi.error(Vr.message||"Failed to softban account"))}catch(Sr){Bt==="user"?I(Kn):V(ar),Sr.name==="TypeError"&&Sr.message.includes("fetch")?hi.error("Network error. Please check your connection and try again."):hi.error("Failed to softban account. Please try again.")}finally{es(Sr=>({...Sr,softban:!1}))}};Ai("Confirm Softban",`Are you sure you want to softban this ${Bt}? This can be restored later.`,yr,{confirmText:"Softban",confirmButtonClass:"bg-red-500 hover:bg-red-600",accountId:wt})},ke=async(Ve,wt)=>{Di(!0),po(!0),Jt(null),As({listings:0,appointments:0});try{const Bt=await fetch(`${Wa}/api/user/id/${Ve._id}`),Qt=await Bt.json();if(Bt.ok){Jt({...Qt,type:wt});try{const[bi,$i]=await Promise.all([fetch(`${Wa}/api/listing/user/${Ve._id}`,{credentials:"include"}),fetch(`${Wa}/api/bookings/user/${Ve._id}`,{credentials:"include"})]);let yr=0,Kn=0;if(bi.ok){const ar=await bi.json();yr=Array.isArray(ar)?ar.length:0}$i.ok&&(Kn=(await $i.json()).count||0),As({listings:yr,appointments:Kn})}catch(bi){console.error("Error fetching account stats:",bi),As({listings:0,appointments:0})}}else console.error("Failed to fetch account details:",Qt.message),Jt(null)}catch(Bt){console.error("Error in handleAccountClick:",Bt),Jt(null)}po(!1)},Le=async Ve=>{const wt=S.find(Qt=>Qt._id===Ve);if(wt&&wt.status==="suspended"){hi.error("Cannot promote suspended account. Please remove suspension first.");return}Ai("Promote User to Admin","Are you sure you want to promote this user to admin? They will gain administrative privileges.",async()=>{es($i=>({...$i,promote:{...$i.promote,[Ve]:!0}}));const Qt=[...S],bi=[...N];wt&&(I($i=>$i.filter(yr=>yr._id!==Ve)),V($i=>[{...wt,role:"admin",adminApprovalStatus:"approved"},...$i]));try{const $i=await fetch(`${Wa}/api/admin/management/promote/${Ve}`,{method:"PATCH",credentials:"include"}),yr=await $i.json();$i.ok?(hi.success("User promoted to admin successfully"),fn.emit("admin_update",{type:"add",admin:{...wt,...yr},userId:Ve}),fn.emit("user_update",{type:"delete",user:{_id:Ve},userId:Ve}),fn.emit("force_signout",{userId:Ve,action:"promote",message:"Your account has been promoted to admin. You have been signed out. Please sign in again to access admin features."}),ds(!1)):(I(Qt),V(bi),hi.error(yr.message||"Failed to promote user"))}catch{I(Qt),V(bi),hi.error("Failed to promote user")}finally{es($i=>({...$i,promote:{...$i.promote,[Ve]:!1}}))}},{confirmText:"Promote",confirmButtonClass:"bg-purple-500 hover:bg-purple-600",userId:Ve})},Ie=async Ve=>{const wt=N.find(Bt=>Bt._id===Ve);if(wt&&wt.status==="suspended"){hi.error("Cannot demote suspended account. Please remove suspension first.");return}fa({id:Ve}),Nn(""),Sn(!0)},et=async()=>{if(!bs)return;const{id:Ve}=bs,wt=N.find(bi=>bi._id===Ve);es(bi=>({...bi,demote:{...bi.demote,[Ve]:!0}}));const Bt=[...S],Qt=[...N];wt&&(V(bi=>bi.filter($i=>$i._id!==Ve)),I(bi=>[{...wt,role:"user",adminApprovalStatus:void 0},...bi]));try{const bi=await fetch(`${Wa}/api/admin/management/demote/${Ve}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:Mn==="other"?In:Mn||"Administrative decision"})}),$i=await bi.json();bi.ok?(hi.success("Admin demoted to user successfully"),fn.emit("user_update",{type:"add",user:{...wt,...$i},userId:Ve}),fn.emit("admin_update",{type:"delete",admin:{_id:Ve},userId:Ve}),fn.emit("force_signout",{userId:Ve,action:"demote",message:"Your admin privileges have been revoked. You have been signed out. Please sign in again as a regular user."}),Sn(!1),fa(null),Nn(""),qr("")):(I(Bt),V(Qt),hi.error($i.message||"Failed to demote admin"))}catch{I(Bt),V(Qt),hi.error("Failed to demote admin")}finally{es(bi=>({...bi,demote:{...bi.demote,[Ve]:!1}}))}},Be=async Ve=>{try{const wt=await fetch(`${Wa}/api/admin/management/reapprove/${Ve}`,{method:"PATCH",credentials:"include"}),Bt=await wt.json();wt.ok?(V(Qt=>Qt.map(bi=>bi._id===Ve?{...bi,adminApprovalStatus:"approved",status:"active"}:bi)),hi.success("Admin re-approved successfully!"),fn.emit("admin_update",{type:"update",admin:{...Bt},userId:Ve}),fn.emit("force_signout",{userId:Ve,action:"reapprove",message:"Your admin account has been re-approved. You have been signed out. Please sign in again to access admin features."})):hi.error(Bt.message||"Failed to re-approve admin")}catch{hi.error("Failed to re-approve admin")}},Je=Ve=>{let wt=Ve;if(ws.trim()){const Bt=ws.toLowerCase();wt=wt.filter(Qt=>{var bi,$i,yr;return((bi=Qt.username)==null?void 0:bi.toLowerCase().includes(Bt))||(($i=Qt.email)==null?void 0:$i.toLowerCase().includes(Bt))||((yr=Qt.mobileNumber)==null?void 0:yr.toLowerCase().includes(Bt))})}if(Yr!=="all")if(Yr==="locked"){const Bt=new Set(Or.filter(Qt=>new Date(Qt.unlockAt)>new Date).map(Qt=>(Qt.email||"").toLowerCase()));wt=wt.filter(Qt=>Bt.has((Qt.email||"").toLowerCase()))}else wt=wt.filter(Bt=>Bt.status===Yr);return Z==="admins"&&Fs!=="all"&&(wt=wt.filter(Bt=>Bt.adminApprovalStatus===Fs)),wt},zt=Je(S),vt=Je(N),pi=Ve=>{if(!ws.trim()||!Ve)return Ve;const wt=new RegExp(`(${ws})`,"gi");return Ve.split(wt).map((Qt,bi)=>wt.test(Qt)?x.jsx("span",{className:"bg-yellow-200 font-semibold rounded px-1",children:Qt},bi):Qt)},Ai=(Ve,wt,Bt,Qt={})=>{No({title:Ve,message:wt,onConfirm:Bt,confirmText:Qt.confirmText||"Confirm",cancelText:Qt.cancelText||"Cancel",confirmButtonClass:Qt.confirmButtonClass||"bg-red-500 hover:bg-red-600",userId:Qt.userId,accountId:Qt.accountId}),ds(!0)},Vi=()=>{ds(!1),No({title:"",message:"",onConfirm:null,confirmText:"Confirm",cancelText:"Cancel",confirmButtonClass:"bg-red-500 hover:bg-red-600"})},on=()=>{Ur.onConfirm&&Ur.onConfirm()},rn=async Ve=>{Ai("Restore Account","Are you sure you want to restore this account? The user will be able to sign in again.",async()=>{es(Bt=>({...Bt,restore:!0}));try{const Bt=await fetch(`${Wa}/api/admin/deleted-accounts/restore/${Ve}`,{method:"POST",credentials:"include"}),Qt=await Bt.json();Bt.ok?(hi.success("Account restored"),go(),ds(!1)):hi.error(Qt.message||"Restore failed")}catch{hi.error("Failed to restore account")}finally{es(Bt=>({...Bt,restore:!1}))}},{confirmText:"Restore",confirmButtonClass:"bg-green-500 hover:bg-green-600",accountId:Ve})},ln=async Ve=>{Ai("Permanently Purge Account","Are you sure you want to permanently purge this account? This action cannot be undone.",async()=>{es(Bt=>({...Bt,purge:!0}));try{const Bt=await fetch(`${Wa}/api/admin/deleted-accounts/purge/${Ve}`,{method:"DELETE",credentials:"include"}),Qt=await Bt.json();Bt.ok?(hi.success("Account purged"),go(),Na(),ds(!1)):hi.error(Qt.message||"Purge failed")}catch{hi.error("Failed to purge account")}finally{es(Bt=>({...Bt,purge:!1}))}},{confirmText:"Purge",confirmButtonClass:"bg-red-500 hover:bg-red-600",accountId:Ve})},jn=()=>{pa.current&&clearTimeout(pa.current),Mt.current&&clearTimeout(Mt.current),Mt.current=setTimeout(()=>{hi.info("For security reasons, you will be asked to re-enter your password in 1 minute.")},4*60*1e3),pa.current=setTimeout(()=>{ss(!0),hi.info("Session expired for security. Please re-enter your password.")},5*60*1e3)};if(he.useEffect(()=>(Ya?(pa.current&&clearTimeout(pa.current),Mt.current&&clearTimeout(Mt.current)):jn(),()=>{pa.current&&clearTimeout(pa.current),Mt.current&&clearTimeout(Mt.current)}),[Ya]),he.useEffect(()=>(Ft||ka||wi?(document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%"):(document.body.style.overflow="",document.body.style.position="",document.body.style.width=""),()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width=""}),[Ft,ka,wi]),!Array.isArray(S)||Z==="admins"&&!Array.isArray(N)&&h.isDefaultAdmin)return x.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-purple-100",children:x.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[x.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Session expired or unauthorized"}),x.jsx("p",{className:"text-gray-700 mb-4",children:"Please sign in again to access admin management."}),x.jsx("a",{href:"/sign-in",className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:"Go to Sign In"})]})});if(!h)return null;const cn=async Ve=>{Ve.preventDefault(),bc(!0),fr("");try{const wt=await fetch(`${Wa}/api/admin/management/verify-password`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({password:Ka})});if(wt.ok)ss(!1),Ls(""),fr(""),jn();else{const Bt=await wt.json();hi.error("For security reasons, you have been signed out. Please sign in again."),b(S1());try{const bi=await(await fetch(`${Wa}/api/auth/signout`)).json();bi.success===!1?b(xp(bi.message)):b(Xa(bi))}catch(Qt){b(xp(Qt.message))}setTimeout(()=>{g("/sign-in")},800);return}}catch{fr("Network error")}finally{bc(!1)}};return Ya?x.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",children:x.jsxs("form",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs flex flex-col gap-4",onSubmit:cn,children:[x.jsxs("h3",{className:"text-lg font-bold text-blue-700 flex items-center gap-2",children:[x.jsx(fI,{})," Confirm Password"]}),x.jsx("input",{type:"password",className:"border rounded p-2 w-full",placeholder:"Enter your password",value:Ka,onChange:Ve=>Ls(Ve.target.value),autoFocus:!0}),hs&&x.jsx("div",{className:"text-red-600 text-sm",children:hs}),x.jsxs("div",{className:"flex gap-2 justify-end",children:[x.jsx("button",{type:"button",className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold",onClick:()=>g(-1),children:"Cancel"}),x.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-700 text-white font-semibold",disabled:as,children:as?"Verifying...":"Confirm"})]})]})}):x.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100 py-10 px-2 md:px-8 animate-fadeIn",children:[x.jsxs("div",{className:"max-w-6xl mx-auto bg-white rounded-2xl shadow-2xl p-8 animate-slideUp",children:[x.jsxs("div",{className:"flex items-center justify-between mb-8",children:[x.jsx("h1",{className:"text-4xl font-extrabold text-blue-700 drop-shadow animate-fade-in",children:"Accounts Management"}),x.jsxs("button",{onClick:()=>ea(),className:"px-3 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold shadow inline-flex items-center gap-2",title:"Refresh data",children:[x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4 h-4",children:x.jsx("path",{d:"M12 6V3L8 7l4 4V8c2.757 0 5 2.243 5 5a5 5 0 11-9.9-1H5.026A7 7 0 1019 13c0-3.86-3.141-7-7-7z"})}),"Refresh"]})]}),x.jsxs("div",{className:"flex flex-wrap gap-2 sm:gap-4 mb-8 animate-fadeIn",children:[x.jsxs("button",{className:`px-3 sm:px-6 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-lg shadow transition-all duration-200 ${Z==="users"?"bg-gradient-to-r from-blue-500 to-purple-500 text-white scale-105":"bg-gray-100 text-gray-700 hover:bg-blue-50"}`,onClick:()=>{Q("users"),Lt(!1),Gr(""),Bs("all"),Sa("all")},children:["Users (",S.length,")"]}),x.jsxs("button",{className:`px-3 sm:px-6 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-lg shadow transition-all duration-200 ${Z==="admins"?"bg-gradient-to-r from-blue-500 to-purple-500 text-white scale-105":"bg-gray-100 text-gray-700 hover:bg-purple-50"}`,onClick:()=>{h.isDefaultAdmin?(Lt(!1),Q("admins"),Gr(""),Bs("all"),Sa("all")):(Lt(!0),Q("admins"),Gr(""),Bs("all"))},children:["Admins (",N.length,")"]}),x.jsxs("button",{className:`px-3 sm:px-6 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-lg shadow transition-all duration-200 ${Z==="softbanned"?"bg-gradient-to-r from-red-500 to-red-600 text-white scale-105":"bg-gray-100 text-gray-700 hover:bg-rose-50"}`,onClick:()=>{Q("softbanned"),Gr(""),Bs("all"),Sa("all"),go()},children:[x.jsxs("span",{className:"hidden sm:inline",children:["Softbanned Accounts (",oe.length,")"]}),x.jsxs("span",{className:"sm:hidden",children:["Softbanned (",oe.length,")"]})]}),x.jsxs("button",{className:`px-3 sm:px-6 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-lg shadow transition-all duration-200 ${Z==="purged"?"bg-gradient-to-r from-red-500 to-orange-500 text-white scale-105":"bg-gray-100 text-gray-700 hover:bg-red-50"}`,onClick:()=>{Q("purged"),Gr(""),Bs("all"),Sa("all"),Na()},children:[x.jsxs("span",{className:"hidden sm:inline",children:["Purged Accounts (",ge.length,")"]}),x.jsxs("span",{className:"sm:hidden",children:["Purged (",ge.length,")"]})]})]}),x.jsxs("div",{className:"mb-6 animate-fadeIn",children:[Z!=="softbanned"&&Z!=="purged"?x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[x.jsxs("div",{className:"relative",children:[x.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:x.jsx(Cm,{className:"h-5 w-5 text-gray-400 group-hover:text-blue-500 transition-colors duration-200"})}),x.jsx("input",{id:"admin-management-search",type:"text",placeholder:`Search ${Z==="users"?"users":"admins"} by name, email...`,value:ws,onChange:Ve=>Gr(Ve.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-xl leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 shadow-sm"}),ws&&x.jsx("button",{onClick:()=>Gr(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:x.jsx("span",{className:"text-xl",children:""})})]}),x.jsxs("div",{className:"relative",children:[x.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:x.jsx(Tm,{className:"h-5 w-5 text-gray-400 group-hover:text-green-500 transition-colors duration-200"})}),x.jsxs("select",{value:Yr,onChange:Ve=>Bs(Ve.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-xl leading-5 bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 shadow-sm appearance-none cursor-pointer",children:[x.jsx("option",{value:"all",children:"All Status"}),x.jsx("option",{value:"active",children:"Active"}),x.jsx("option",{value:"suspended",children:"Suspended"}),x.jsx("option",{value:"locked",children:"Locked"})]}),x.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:x.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),Z==="admins"&&x.jsxs("div",{className:"relative",children:[x.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:x.jsx(Y_,{className:"h-5 w-5 text-gray-400 group-hover:text-purple-500 transition-colors duration-200"})}),x.jsxs("select",{value:Fs,onChange:Ve=>Sa(Ve.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-xl leading-5 bg-white text-gray-900 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200 shadow-sm appearance-none cursor-pointer",children:[x.jsx("option",{value:"all",children:"All Approval Status"}),x.jsx("option",{value:"pending",children:"Pending"}),x.jsx("option",{value:"approved",children:"Approved"}),x.jsx("option",{value:"rejected",children:"Rejected"})]}),x.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:x.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),x.jsx("div",{className:"flex items-center",children:x.jsxs("button",{onClick:()=>{Gr(""),Bs("all"),Sa("all")},className:"w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-medium transition-colors duration-200 flex items-center justify-center gap-2",children:[x.jsx(ho,{className:"text-sm"}),"Clear All Filters"]})})]}):Z==="softbanned"?x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[x.jsx("input",{value:ze.q,onChange:Ve=>le(wt=>({...wt,q:Ve.target.value})),placeholder:"Search name/email",className:"px-3 py-3 border rounded-xl"}),x.jsxs("select",{value:ze.role,onChange:Ve=>le(wt=>({...wt,role:Ve.target.value})),className:"px-3 py-3 border rounded-xl",children:[x.jsx("option",{value:"all",children:"All Roles"}),x.jsx("option",{value:"user",children:"User"}),h.isDefaultAdmin&&x.jsx("option",{value:"admin",children:"Admin"})]}),x.jsx("input",{type:"date",value:ze.from,onChange:Ve=>le(wt=>({...wt,from:Ve.target.value})),className:"px-3 py-3 border rounded-xl"}),x.jsx("input",{type:"date",value:ze.to,onChange:Ve=>le(wt=>({...wt,to:Ve.target.value})),className:"px-3 py-3 border rounded-xl"}),x.jsx("input",{value:ze.softbannedBy,onChange:Ve=>le(wt=>({...wt,softbannedBy:Ve.target.value})),placeholder:"Softbanned by (id or self)",className:"px-3 py-3 border rounded-xl"}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("button",{onClick:go,className:"px-4 py-3 bg-red-600 text-white rounded-xl",children:"Apply"}),x.jsx("button",{onClick:()=>{le({q:"",role:"all",softbannedBy:"",from:"",to:""}),setTimeout(go,0)},className:"px-4 py-3 bg-gray-100 rounded-xl",children:"Clear"})]}),x.jsx("div",{className:"col-span-full text-sm text-gray-600",children:h.isDefaultAdmin?"You are viewing all softbanned accounts (users + admins).":"You are viewing only softbanned user accounts."})]}):x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[x.jsx("input",{value:ye.q,onChange:Ve=>Pe(wt=>({...wt,q:Ve.target.value})),placeholder:"Search name/email",className:"px-3 py-3 border rounded-xl"}),x.jsxs("select",{value:ye.role,onChange:Ve=>Pe(wt=>({...wt,role:Ve.target.value})),className:"px-3 py-3 border rounded-xl",children:[x.jsx("option",{value:"all",children:"All Roles"}),x.jsx("option",{value:"user",children:"User"}),h.isDefaultAdmin&&x.jsx("option",{value:"admin",children:"Admin"})]}),x.jsx("input",{type:"date",value:ye.from,onChange:Ve=>Pe(wt=>({...wt,from:Ve.target.value})),className:"px-3 py-3 border rounded-xl"}),x.jsx("input",{type:"date",value:ye.to,onChange:Ve=>Pe(wt=>({...wt,to:Ve.target.value})),className:"px-3 py-3 border rounded-xl"}),x.jsx("input",{value:ye.purgedBy,onChange:Ve=>Pe(wt=>({...wt,purgedBy:Ve.target.value})),placeholder:"Purged by (id)",className:"px-3 py-3 border rounded-xl"}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("button",{onClick:Na,className:"px-4 py-3 bg-red-600 text-white rounded-xl",children:"Apply"}),x.jsx("button",{onClick:()=>{Pe({q:"",role:"all",purgedBy:"",from:"",to:""}),setTimeout(Na,0)},className:"px-4 py-3 bg-gray-100 rounded-xl",children:"Clear"})]}),x.jsx("div",{className:"col-span-full text-sm text-gray-600",children:h.isDefaultAdmin?"You are viewing all purged accounts (users + admins). These accounts are permanently removed.":"You are viewing only purged user accounts. These accounts are permanently removed."})]}),Z!=="softbanned"&&Z!=="purged"&&(ws||Yr!=="all"||Fs!=="all")&&x.jsxs("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[x.jsxs("div",{className:"text-sm text-blue-800",children:[x.jsx("span",{className:"font-semibold",children:"Active Filters:"}),ws&&x.jsxs("span",{className:"ml-2 px-2 py-1 bg-blue-200 rounded text-xs",children:['Search: "',ws,'"']}),Yr!=="all"&&x.jsxs("span",{className:"ml-2 px-2 py-1 bg-green-200 rounded text-xs",children:["Status: ",Yr]}),Z==="admins"&&Fs!=="all"&&x.jsxs("span",{className:"ml-2 px-2 py-1 bg-purple-200 rounded text-xs",children:["Approval: ",Fs]})]}),x.jsxs("div",{className:"mt-2 text-sm text-blue-700",children:["Found ",Z==="users"?zt.length:vt.length," ",Z==="users"?"user":"admin",Z==="users"?zt.length!==1?"s":"":vt.length!==1?"s":""," matching your filters"]})]}),x.jsx("div",{className:"mt-2 text-xs text-gray-400",children:" Tip: Press Ctrl+F to quickly focus the search box  Use status filter to view active or suspended accounts"})]}),s?x.jsxs("div",{className:"flex flex-col items-center justify-center h-64 animate-fadeIn",children:[x.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mb-4"}),x.jsx("p",{className:"text-lg text-gray-500 font-semibold",children:"Loading accounts..."})]}):x.jsxs(x.Fragment,{children:[Z==="users"&&x.jsxs("div",{children:[x.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2 animate-fadeIn",children:[x.jsx(Il,{className:"text-blue-500"})," Users (",S.length,")"]}),zt.length===0?x.jsxs("div",{className:"flex flex-col items-center justify-center py-16 animate-fadeIn",children:[x.jsx(L4,{className:"text-6xl text-gray-300 mb-4"}),x.jsx("p",{className:"text-gray-500 text-lg font-medium",children:ws||Yr!=="all"?"No users found matching your filters":"No users found."}),(ws||Yr!=="all")&&x.jsx("button",{onClick:()=>{Gr(""),Bs("all")},className:"mt-4 text-blue-500 hover:text-blue-600 underline",children:"Clear all filters"})]}):x.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 animate-fadeIn",children:zt.map(Ve=>x.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 rounded-2xl shadow-lg p-6 flex flex-col gap-4 hover:scale-105 transition-transform duration-200 animate-slideUp cursor-pointer",onClick:()=>ke(Ve,"user"),title:"Click to view full details",children:[x.jsxs("div",{className:"flex items-center gap-4",children:[x.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-200 flex items-center justify-center text-2xl font-bold text-blue-700 shadow-inner",children:x.jsx(Il,{})}),x.jsxs("div",{children:[x.jsxs("div",{className:"flex flex-wrap items-center gap-2 min-w-0",children:[x.jsx("span",{className:"text-lg font-semibold text-gray-800 truncate max-w-[120px] sm:max-w-[180px] md:max-w-[220px]",title:Ve.username,children:pi(Ve.username)}),x.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-bold break-words whitespace-nowrap mt-1 sm:mt-0 ${Ve.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:Ve.status})]}),x.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm mt-1",children:[x.jsx(rd,{})," ",pi(Ve.email)]}),(()=>{if(!Or||!Array.isArray(Or))return null;const wt=Or.find(bi=>(bi.email||"").toLowerCase()===(Ve.email||"").toLowerCase()&&new Date(bi.unlockAt)>new Date);if(!wt)return null;const Bt=new Date(wt.unlockAt).getTime()-Date.now(),Qt=Math.max(1,Math.ceil(Bt/6e4));return x.jsxs("div",{className:"mt-1 text-xs text-orange-700 bg-orange-50 border border-orange-200 rounded px-2 py-1 inline-block",children:["Locked: about ",Qt," minute",Qt>1?"s":""," left"]})})(),Ve.mobileNumber&&x.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm mt-1",children:[x.jsx(uv,{})," ",pi(Ve.mobileNumber)]}),x.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-xs mt-1",children:[x.jsx(gp,{})," ",new Date(Ve.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})]})]})]}),x.jsxs("div",{className:"flex flex-col gap-2 mt-4 sm:flex-row sm:gap-2",children:[x.jsx("button",{className:`flex-1 px-2 py-1 rounded-lg font-semibold text-sm transition-all duration-200 flex items-center justify-center gap-2 ${Ve.status==="active"?"bg-yellow-400 text-white hover:bg-yellow-500":"bg-green-500 text-white hover:bg-green-600"}`,onClick:wt=>{wt.stopPropagation(),He(Ve._id,"user")},children:Un.suspend[Ve._id]?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),Ve.status==="active"?"Suspending...":"Activating..."]}):x.jsxs(x.Fragment,{children:[Ve.status==="active"?x.jsx(I4,{}):x.jsx(Tm,{}),Ve.status==="active"?"Suspend":"Activate"]})}),x.jsxs("button",{className:"flex-1 px-2 py-1 rounded-lg font-semibold text-sm bg-red-500 text-white hover:bg-red-600 transition-all duration-200 flex items-center justify-center gap-2",onClick:wt=>{wt.stopPropagation(),ne(Ve._id,"user")},children:[x.jsx(su,{})," Softban"]}),h.isDefaultAdmin&&x.jsx("button",{className:"flex-1 px-2 py-1 rounded-lg font-semibold text-sm bg-purple-500 text-white hover:bg-purple-600 transition-all duration-200 flex items-center justify-center gap-2",onClick:wt=>{wt.stopPropagation(),Le(Ve._id)},children:Un.promote[Ve._id]?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Promoting..."]}):x.jsxs(x.Fragment,{children:[x.jsx(Y_,{})," Promote to Admin"]})})]}),it[Ve._id]&&x.jsx("div",{className:"text-red-500 text-xs mt-2 animate-fadeIn",children:it[Ve._id]})]},Ve._id))})]}),Z==="admins"&&!h.isDefaultAdmin&&ut&&x.jsxs("div",{className:"flex flex-col items-center justify-center py-16 animate-fadeIn",children:[x.jsx("div",{className:"text-6xl mb-4",children:""}),x.jsx("p",{className:"text-red-500 text-lg font-medium",children:"Only the current default admin can access admin account management."})]}),Z==="admins"&&h.isDefaultAdmin&&!ut&&x.jsxs("div",{className:"mt-10",children:[x.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2 animate-fadeIn",children:[x.jsx(Y_,{className:"text-purple-500"})," Admins (",N.length,")"]}),vt.length===0?x.jsxs("div",{className:"flex flex-col items-center justify-center py-16 animate-fadeIn",children:[x.jsx(L4,{className:"text-6xl text-gray-300 mb-4"}),x.jsx("p",{className:"text-gray-500 text-lg font-medium",children:ws||Yr!=="all"||Fs!=="all"?"No admins found matching your filters":"No admins found."}),(ws||Yr!=="all"||Fs!=="all")&&x.jsx("button",{onClick:()=>{Gr(""),Bs("all"),Sa("all")},className:"mt-4 text-blue-500 hover:text-blue-600 underline",children:"Clear all filters"})]}):x.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 animate-fadeIn",children:vt.map(Ve=>x.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-100 rounded-2xl shadow-lg p-6 flex flex-col gap-4 hover:scale-105 transition-transform duration-200 animate-slideUp cursor-pointer",onClick:()=>ke(Ve,"admin"),title:"Click to view full details",children:[x.jsxs("div",{className:"flex items-center gap-4",children:[x.jsx("div",{className:"w-16 h-16 rounded-full bg-purple-200 flex items-center justify-center text-2xl font-bold text-purple-700 shadow-inner",children:x.jsx(Y_,{})}),x.jsxs("div",{children:[x.jsxs("div",{className:"flex flex-wrap items-center gap-2 min-w-0",children:[x.jsx("span",{className:"text-lg font-semibold text-gray-800 truncate max-w-[120px] sm:max-w-[180px] md:max-w-[220px]",title:Ve.username,children:pi(Ve.username)}),x.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-bold break-words whitespace-nowrap mt-1 sm:mt-0 ${Ve.adminApprovalStatus==="rejected"?"bg-gray-300 text-gray-700":Ve.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:Ve.adminApprovalStatus==="rejected"?"rejected":Ve.status})]}),x.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm mt-1",children:[x.jsx(rd,{})," ",pi(Ve.email)]}),(()=>{if(!Or||!Array.isArray(Or))return null;const wt=Or.find(bi=>(bi.email||"").toLowerCase()===(Ve.email||"").toLowerCase()&&new Date(bi.unlockAt)>new Date);if(!wt)return null;const Bt=new Date(wt.unlockAt).getTime()-Date.now(),Qt=Math.max(1,Math.ceil(Bt/6e4));return x.jsxs("div",{className:"mt-1 text-xs text-orange-700 bg-orange-50 border border-orange-200 rounded px-2 py-1 inline-block",children:["Locked: about ",Qt," minute",Qt>1?"s":""," left"]})})(),Ve.mobileNumber&&x.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm mt-1",children:[x.jsx(uv,{})," ",pi(Ve.mobileNumber)]}),x.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-xs mt-1",children:[x.jsx(gp,{})," ",new Date(Ve.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})]})]})]}),x.jsxs("div",{className:"flex flex-col gap-2 mt-4 sm:flex-row sm:gap-2",children:[x.jsx("button",{className:`flex-1 px-2 py-1 rounded-lg font-semibold text-sm transition-all duration-200 flex items-center justify-center gap-2 ${Ve.status==="active"?"bg-yellow-400 text-white hover:bg-yellow-500":"bg-green-500 text-white hover:bg-green-600"}`,onClick:wt=>{wt.stopPropagation(),He(Ve._id,"admin")},children:Un.suspend[Ve._id]?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),Ve.status==="active"?"Suspending...":"Activating..."]}):x.jsxs(x.Fragment,{children:[Ve.status==="active"?x.jsx(I4,{}):x.jsx(Tm,{}),Ve.status==="active"?"Suspend":"Activate"]})}),x.jsxs("button",{className:"flex-1 px-2 py-1 rounded-lg font-semibold text-sm bg-red-500 text-white hover:bg-red-600 transition-all duration-200 flex items-center justify-center gap-2",onClick:wt=>{wt.stopPropagation(),ne(Ve._id,"admin")},children:[x.jsx(su,{})," Softban"]}),x.jsx("button",{className:"flex-1 px-2 py-1 rounded-lg font-semibold text-sm bg-blue-500 text-white hover:bg-blue-600 transition-all duration-200 flex items-center justify-center gap-2",onClick:wt=>{wt.stopPropagation(),Ie(Ve._id)},children:Un.demote[Ve._id]?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Demoting..."]}):x.jsxs(x.Fragment,{children:[x.jsx(lI,{})," Demote to User"]})}),h.isDefaultAdmin&&Ve.adminApprovalStatus==="rejected"&&x.jsxs("button",{className:"flex-1 px-2 py-1 rounded-lg font-semibold text-sm bg-green-600 text-white hover:bg-green-700 transition-all duration-200 flex items-center justify-center gap-2",onClick:wt=>{wt.stopPropagation(),Be(Ve._id)},children:[x.jsx(Tm,{})," Re-Approve"]})]}),it[Ve._id]&&x.jsx("div",{className:"text-red-500 text-xs mt-2 animate-fadeIn",children:it[Ve._id]})]},Ve._id))})]}),Z==="softbanned"&&x.jsxs("div",{className:"mt-6",children:[x.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:["Softbanned Accounts (",oe.length,")"]}),Se?x.jsxs("div",{className:"flex items-center justify-center p-8",children:[x.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),x.jsx("span",{className:"ml-3 text-gray-600",children:"Loading..."})]}):oe.length===0?x.jsx("div",{className:"p-6 text-center text-gray-500 border rounded-xl",children:"No softbanned accounts found"}):x.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-200",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"bg-gray-50",children:x.jsxs("tr",{className:"text-left text-gray-700",children:[x.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Name"}),x.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Email"}),x.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Role"}),x.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Date Softbanned"}),x.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Softbanned By"}),x.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Reason"}),x.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Policy"}),x.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Actions"})]})}),x.jsx("tbody",{className:"divide-y divide-gray-200",children:oe.map(Ve=>{var wt;return x.jsxs("tr",{className:"hover:bg-gray-50",children:[x.jsx("td",{className:"px-4 py-2 font-medium text-gray-800 whitespace-nowrap",children:Ve.name}),x.jsx("td",{className:"px-4 py-2 text-gray-700 whitespace-nowrap",children:Ve.email}),x.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:x.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${Ve.role==="admin"?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:Ve.role})}),x.jsx("td",{className:"px-4 py-2 text-gray-600 whitespace-nowrap",children:Ve.deletedAt?new Date(Ve.deletedAt).toLocaleString("en-GB"):"-"}),x.jsx("td",{className:"px-4 py-2 text-gray-600 whitespace-nowrap",children:typeof Ve.deletedBy=="string"?Ve.deletedBy:((wt=Ve.deletedBy)==null?void 0:wt._id)||Ve.deletedBy}),x.jsx("td",{className:"px-4 py-2 text-gray-600 whitespace-nowrap",children:Ve.reason||"-"}),x.jsx("td",{className:"px-4 py-2 text-gray-600",children:Ve.policy?x.jsxs("div",{className:"text-xs",children:[x.jsxs("div",{children:[x.jsx("strong",{children:"Category:"})," ",Ve.policy.category||"-"]}),x.jsxs("div",{children:[x.jsx("strong",{children:"Ban Type:"})," ",Ve.policy.banType||"-"]}),Ve.policy.allowResignupAfterDays>0&&x.jsxs("div",{children:[x.jsx("strong",{children:"Resignup After:"})," ",Ve.policy.allowResignupAfterDays," days"]})]}):"-"}),x.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:h.isDefaultAdmin?x.jsxs("div",{className:"flex gap-2",children:[x.jsx("button",{onClick:()=>rn(Ve._id),className:"px-3 py-1 bg-green-600 text-white rounded-lg text-xs",children:"Restore"}),x.jsx("button",{onClick:()=>ln(Ve._id),className:"px-3 py-1 bg-red-600 text-white rounded-lg text-xs",children:"Purge"})]}):x.jsx("div",{className:"flex gap-2",children:Ve.role==="user"?x.jsx("button",{onClick:()=>rn(Ve._id),className:"px-3 py-1 bg-green-600 text-white rounded-lg text-xs",children:"Restore"}):x.jsx("span",{className:"text-xs text-gray-500",children:"View only"})})})]},Ve._id)})})]})})]}),Z==="purged"&&x.jsxs("div",{className:"mt-6",children:[x.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:["Purged Accounts (Permanently Removed) (",ge.length,")"]}),Ae?x.jsxs("div",{className:"flex items-center justify-center p-8",children:[x.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),x.jsx("span",{className:"ml-3 text-gray-600",children:"Loading..."})]}):ge.length===0?x.jsx("div",{className:"p-6 text-center text-gray-500 border rounded-xl",children:"No purged accounts found"}):x.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-200",children:x.jsxs("table",{className:"min-w-full text-sm",children:[x.jsx("thead",{className:"bg-red-50",children:x.jsxs("tr",{className:"text-left text-gray-700",children:[x.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Name"}),x.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Email"}),x.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Role"}),x.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Date Softbanned"}),x.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Date Purged"}),x.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Purged By"}),x.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Reason"}),x.jsx("th",{className:"px-4 py-2 whitespace-nowrap",children:"Policy"})]})}),x.jsx("tbody",{className:"divide-y divide-gray-200",children:ge.map(Ve=>x.jsxs("tr",{className:"hover:bg-red-50",children:[x.jsx("td",{className:"px-4 py-2 font-medium text-gray-800 whitespace-nowrap",children:Ve.name}),x.jsx("td",{className:"px-4 py-2 text-gray-700 whitespace-nowrap",children:Ve.email}),x.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:x.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${Ve.role==="admin"?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:Ve.role})}),x.jsx("td",{className:"px-4 py-2 text-gray-600 whitespace-nowrap",children:Ve.deletedAt?new Date(Ve.deletedAt).toLocaleString("en-GB"):"-"}),x.jsx("td",{className:"px-4 py-2 text-red-600 font-semibold whitespace-nowrap",children:Ve.purgedAt?new Date(Ve.purgedAt).toLocaleString("en-GB"):"-"}),x.jsx("td",{className:"px-4 py-2 text-gray-600 whitespace-nowrap",children:Ve.purgedBy?typeof Ve.purgedBy=="string"?Ve.purgedBy:Ve.purgedBy._id:"-"}),x.jsx("td",{className:"px-4 py-2 text-gray-600 whitespace-nowrap",children:Ve.reason||"-"}),x.jsx("td",{className:"px-4 py-2 text-gray-600",children:Ve.policy?x.jsxs("div",{className:"text-xs",children:[x.jsxs("div",{children:[x.jsx("strong",{children:"Category:"})," ",Ve.policy.category||"-"]}),x.jsxs("div",{children:[x.jsx("strong",{children:"Ban Type:"})," ",Ve.policy.banType||"-"]}),Ve.policy.allowResignupAfterDays>0&&x.jsxs("div",{children:[x.jsx("strong",{children:"Resignup After:"})," ",Ve.policy.allowResignupAfterDays," days"]})]}):"-"})]},Ve._id))})]})})]})]})]}),Ft&&x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:x.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-xs sm:max-w-md mx-2 sm:mx-4 max-h-[90vh] overflow-y-auto p-0 sm:p-0 relative animate-fadeIn",children:[x.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>Di(!1),title:"Close","aria-label":"Close",children:x.jsx(ho,{className:"w-4 h-4"})}),x.jsxs("div",{className:"flex flex-col items-center justify-center bg-gradient-to-r from-blue-100 to-purple-100 rounded-t-2xl px-6 py-5 border-b border-gray-200",children:[x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx("img",{src:(lt==null?void 0:lt.avatar)||"https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png",alt:"avatar",className:"w-16 h-16 rounded-full object-cover border-4 border-white shadow-lg",onError:Ve=>{Ve.target.onerror=null,Ve.target.src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png"}}),x.jsxs("div",{children:[x.jsx("h2",{className:"text-xl font-bold text-blue-800 flex items-center gap-2",children:lt==null?void 0:lt.username}),x.jsx("p",{className:"text-xs text-gray-500",children:lt==null?void 0:lt.email})]})]}),x.jsx("div",{className:"mt-2 flex flex-col items-center",children:x.jsxs("span",{className:"inline-flex items-center gap-1 text-sm text-purple-700 font-semibold",children:[(lt==null?void 0:lt.type)==="admin"?x.jsx(Y_,{className:"text-purple-500"}):x.jsx(Il,{className:"text-blue-500"}),(lt==null?void 0:lt.type)==="admin"?"Admin":"User"]})})]}),x.jsx("div",{className:"px-4 sm:px-8 py-4 space-y-4",children:js?x.jsx("div",{className:"flex justify-center items-center h-32",children:x.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):lt?x.jsxs(x.Fragment,{children:[x.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[x.jsxs("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:[x.jsx(uv,{className:"text-blue-400"}),x.jsxs("span",{children:[x.jsx("strong",{children:"Mobile:"})," ",lt.mobileNumber||"Not provided"]})]}),x.jsxs("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:[x.jsx(Il,{className:"text-purple-400"}),x.jsxs("span",{children:[x.jsx("strong",{children:"Gender:"})," ",lt.gender?lt.gender.charAt(0).toUpperCase()+lt.gender.slice(1):"Not provided"]})]}),x.jsxs("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:[x.jsx(Bg,{className:"text-green-400"}),x.jsxs("span",{children:[x.jsx("strong",{children:"Address:"})," ",lt.address||"Not provided"]})]}),x.jsxs("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:[x.jsx(gp,{className:"text-purple-400"}),x.jsxs("span",{children:[x.jsx("strong",{children:"Member Since:"})," ",lt.createdAt?new Date(lt.createdAt).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):""]})]}),x.jsxs("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:[x.jsx(gp,{className:"text-blue-400"}),x.jsxs("span",{children:[x.jsx("strong",{children:"Last Updated Profile:"})," ",lt.updatedAt?new Date(lt.updatedAt).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})+" "+new Date(lt.updatedAt).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):"Never"]})]}),x.jsxs("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:[x.jsx(eb,{className:"text-green-400"}),x.jsxs("span",{children:[x.jsx("strong",{children:"Listings:"})," ",mo.listings]})]}),x.jsxs("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:[x.jsx(cI,{className:"text-pink-400"}),x.jsxs("span",{children:[x.jsx("strong",{children:"Appointments:"})," ",mo.appointments]})]})]}),x.jsxs("div",{className:"grid grid-cols-1 gap-2 mt-2",children:[x.jsx("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:x.jsxs("span",{children:[x.jsx("strong",{children:"Status:"})," ",lt.status||"active"]})}),(()=>{if(!Or||!Array.isArray(Or))return null;const Ve=Or.find(Qt=>(Qt.email||"").toLowerCase()===(lt.email||"").toLowerCase()&&new Date(Qt.unlockAt)>new Date);if(!Ve)return null;const wt=new Date(Ve.unlockAt).getTime()-Date.now(),Bt=Math.max(1,Math.ceil(wt/6e4));return x.jsx("div",{className:"flex items-center gap-2 text-orange-700 text-sm",children:x.jsxs("span",{children:[x.jsx("strong",{children:"Time left to unlock:"})," about ",Bt," minute",Bt>1?"s":""]})})})(),lt.status==="suspended"&&x.jsxs("div",{className:"space-y-1",children:[x.jsx("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:x.jsxs("span",{children:[x.jsx("strong",{children:"Suspended on:"})," ",lt.suspendedAt?new Date(lt.suspendedAt).toLocaleString("en-GB",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit",year:"numeric"}):"N/A"]})}),lt.suspendedBy&&x.jsx("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:x.jsxs("span",{children:[x.jsx("strong",{children:"Suspended by:"})," ",((cr=lt.suspendedBy)==null?void 0:cr.username)||(($n=lt.suspendedBy)==null?void 0:$n.email)||lt.suspendedBy]})})]}),lt.type==="admin"&&x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:x.jsxs("span",{children:[x.jsx("strong",{children:"Admin Status:"})," ",lt.adminApprovalStatus]})}),x.jsx("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:x.jsxs("span",{children:[x.jsx("strong",{children:"Admin Approval Date:"})," ",lt.adminApprovalDate?new Date(lt.adminApprovalDate).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A"]})}),x.jsx("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:x.jsxs("span",{children:[x.jsx("strong",{children:"Approved By:"})," ",lt.approvedBy?lt.approvedBy.username||lt.approvedBy.email||lt.approvedBy:"N/A"]})}),x.jsx("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:x.jsxs("span",{children:[x.jsx("strong",{children:"Admin Request Date:"})," ",lt.adminRequestDate?new Date(lt.adminRequestDate).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A"]})}),x.jsx("div",{className:"flex items-center gap-2 text-gray-700 text-sm",children:x.jsxs("span",{children:[x.jsx("strong",{children:"Is Default Admin:"})," ",lt.isDefaultAdmin?"Yes":"No"]})})]})]})]}):x.jsx("p",{className:"text-red-500",children:"Failed to load details."})})]})}),ka&&x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:x.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 animate-fadeIn",children:x.jsxs("div",{className:"p-6",children:[x.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:Ur.title}),x.jsx("p",{className:"text-gray-600 mb-6",children:Ur.message}),x.jsxs("div",{className:"flex gap-3 justify-end",children:[x.jsx("button",{onClick:Vi,className:"px-4 py-2 rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300 font-semibold transition-colors",children:Ur.cancelText}),x.jsx("button",{onClick:on,className:`px-4 py-2 rounded-lg text-white font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 ${Ur.confirmButtonClass}`,disabled:Un.promote[Ur.userId]||Un.demote[Ur.userId]||Un.restore||Un.purge||Un.suspend[Ur.userId]||Un.softban,children:Un.promote[Ur.userId]||Un.demote[Ur.userId]||Un.restore||Un.purge||Un.suspend[Ur.userId]||Un.softban?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),Un.promote[Ur.userId]?"Promoting...":Un.demote[Ur.userId]?"Demoting...":Un.suspend[Ur.userId]?"Activating...":Un.softban?"Processing...":Un.restore?"Restoring...":"Purging..."]}):Ur.confirmText})]})]})})}),wi&&x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:x.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto",children:[x.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Reason for Softban"}),x.jsx("p",{className:"text-gray-600 mb-3",children:"Please select a reason and configure policy to proceed."}),x.jsxs("div",{className:"mb-4",children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason"}),x.jsxs("select",{className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500",value:Bi,onChange:Ve=>Wt(Ve.target.value),children:[x.jsx("option",{value:"",children:"Select a reason"}),(lt==null?void 0:lt.type)==="user"?x.jsxs(x.Fragment,{children:[x.jsx("option",{value:"fraud",children:"Fraudulent activity"}),x.jsx("option",{value:"duplicate",children:"Fake or duplicate account"}),x.jsx("option",{value:"inappropriate",children:"Inappropriate content or behavior"}),x.jsx("option",{value:"policy_violation",children:"Violation of terms & policies"}),x.jsx("option",{value:"requested_by_user",children:"Requested by user (support request)"}),x.jsx("option",{value:"other",children:"Other (textbox optional)"})]}):x.jsxs(x.Fragment,{children:[x.jsx("option",{value:"misuse_privileges",children:"Misuse of admin privileges"}),x.jsx("option",{value:"inactive_admin",children:"Inactive admin account"}),x.jsx("option",{value:"violation_trust",children:"Violation of policies or trust"}),x.jsx("option",{value:"role_restructure",children:"Role restructuring / reassigning"}),x.jsx("option",{value:"other",children:"Other (textbox optional)"})]})]})]}),Bi==="other"&&x.jsxs("div",{className:"mb-4",children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Details"}),x.jsx("input",{type:"text",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500",placeholder:"Optional details",value:ki,onChange:Ve=>Ui(Ve.target.value)})]}),x.jsxs("div",{className:"mb-4",children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ban Type"}),x.jsxs("select",{className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",value:Cn.banType,onChange:Ve=>Qe(wt=>({...wt,banType:Ve.target.value})),children:[x.jsx("option",{value:"allow",children:"Allow re-signup (default)"}),x.jsx("option",{value:"ban",children:"Permanent ban"})]})]}),Cn.banType==="allow"&&x.jsxs("div",{className:"mb-4",children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cooling-off Period (days)"}),x.jsx("input",{type:"number",min:"0",max:"365",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0 for immediate re-signup",value:Cn.allowResignupAfterDays,onChange:Ve=>Qe(wt=>({...wt,allowResignupAfterDays:parseInt(Ve.target.value)||0}))}),x.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Set to 0 for immediate re-signup, or specify days to wait"})]}),x.jsxs("div",{className:"mb-4",children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Policy Notes (Optional)"}),x.jsx("textarea",{className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"2",placeholder:"Additional policy notes...",value:Cn.notes,onChange:Ve=>Qe(wt=>({...wt,notes:Ve.target.value}))})]}),x.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[x.jsx("button",{className:"px-4 py-2 rounded-lg bg-gray-500 text-white hover:bg-gray-600",onClick:()=>{Fi(!1),Jt(null),Qe({category:"",banType:"allow",allowResignupAfterDays:0,notes:""})},children:"Cancel"}),x.jsx("button",{className:"px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",onClick:async()=>{Fi(!1),await _e()},disabled:Un.softban,children:Un.softban?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Processing..."]}):"Confirm Softban"})]})]})}),Zi&&x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:x.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto",children:[x.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Reason for Suspension"}),x.jsx("p",{className:"text-gray-600 mb-3",children:"Please provide a reason for suspending this account. This will be included in the notification email."}),x.jsxs("div",{className:"mb-4",children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Suspension Reason"}),x.jsxs("select",{className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 mb-3",value:Yi,onChange:Ve=>Ti(Ve.target.value),children:[x.jsx("option",{value:"",children:"Select a reason"}),(xt==null?void 0:xt.type)==="user"?x.jsxs(x.Fragment,{children:[x.jsx("option",{value:"inappropriate_content",children:"Inappropriate content or behavior"}),x.jsx("option",{value:"policy_violation",children:"Violation of terms & policies"}),x.jsx("option",{value:"spam_activity",children:"Spam or suspicious activity"}),x.jsx("option",{value:"fraudulent_activity",children:"Fraudulent activity"}),x.jsx("option",{value:"harassment",children:"Harassment or abuse"}),x.jsx("option",{value:"fake_account",children:"Fake or duplicate account"}),x.jsx("option",{value:"other",children:"Other (specify below)"})]}):x.jsxs(x.Fragment,{children:[x.jsx("option",{value:"misuse_privileges",children:"Misuse of admin privileges"}),x.jsx("option",{value:"policy_violation",children:"Violation of admin policies"}),x.jsx("option",{value:"inappropriate_behavior",children:"Inappropriate behavior"}),x.jsx("option",{value:"security_concern",children:"Security concern"}),x.jsx("option",{value:"inactive_admin",children:"Inactive admin account"}),x.jsx("option",{value:"other",children:"Other (specify below)"})]})]}),Yi==="other"&&x.jsx("input",{type:"text",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500",placeholder:"Please specify the reason...",value:Mi,onChange:Ve=>Ii(Ve.target.value)})]}),x.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[x.jsx("button",{className:"px-4 py-2 rounded-lg bg-gray-500 text-white hover:bg-gray-600",onClick:()=>{ii(!1),St(null),Ti(""),Ii("")},children:"Cancel"}),x.jsx("button",{className:"px-4 py-2 rounded-lg bg-yellow-500 text-white hover:bg-yellow-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",onClick:J,disabled:!Yi||Yi==="other"&&!Mi.trim()||Un.suspend[xt==null?void 0:xt.id],children:Un.suspend[xt==null?void 0:xt.id]?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Suspending..."]}):"Suspend Account"})]})]})}),Ei&&x.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:x.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto",children:[x.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Reason for Demotion"}),x.jsx("p",{className:"text-gray-600 mb-3",children:"Please provide a reason for demoting this admin to user. This will be included in the notification email."}),x.jsxs("div",{className:"mb-4",children:[x.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Demotion Reason"}),x.jsxs("select",{className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-3",value:Mn,onChange:Ve=>Nn(Ve.target.value),children:[x.jsx("option",{value:"",children:"Select a reason"}),x.jsx("option",{value:"misuse_privileges",children:"Misuse of admin privileges"}),x.jsx("option",{value:"policy_violation",children:"Violation of admin policies"}),x.jsx("option",{value:"inappropriate_behavior",children:"Inappropriate behavior"}),x.jsx("option",{value:"security_concern",children:"Security concern"}),x.jsx("option",{value:"inactive_admin",children:"Inactive admin account"}),x.jsx("option",{value:"performance_issues",children:"Performance issues"}),x.jsx("option",{value:"organizational_changes",children:"Organizational changes"}),x.jsx("option",{value:"other",children:"Other (specify below)"})]}),Mn==="other"&&x.jsx("input",{type:"text",className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Please specify the reason...",value:In,onChange:Ve=>qr(Ve.target.value)})]}),x.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[x.jsx("button",{className:"px-4 py-2 rounded-lg bg-gray-500 text-white hover:bg-gray-600",onClick:()=>{Sn(!1),fa(null),Nn(""),qr("")},children:"Cancel"}),x.jsx("button",{className:"px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",onClick:et,disabled:!Mn||Mn==="other"&&!In.trim()||Un.demote[bs==null?void 0:bs.id],children:Un.demote[bs==null?void 0:bs.id]?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Demoting..."]}):"Demote Admin"})]})]})}),x.jsx("style",{jsx:!0,children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from { opacity: 0; transform: translateY(20px) scale(0.95); }
          to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .animate-fadeIn { animation: fadeIn 0.4s ease-out; }
        .animate-slideUp { animation: slideUp 0.4s cubic-bezier(0.4,0,0.2,1); }
      `})]})}const cT={messageSent:"/sounds/message-sent.mp3",messageReceived:"/sounds/message-received.mp3",notification:"/sounds/notification.mp3",typing:"/sounds/typing.mp3"},dL=()=>{const h=new(window.AudioContext||window.webkitAudioContext),g=(b,S,I="sine")=>{const N=h.createOscillator(),V=h.createGain();N.connect(V),V.connect(h.destination),N.frequency.setValueAtTime(b,h.currentTime),N.type=I,V.gain.setValueAtTime(.3,h.currentTime),V.gain.exponentialRampToValueAtTime(.01,h.currentTime+S),N.start(h.currentTime),N.stop(h.currentTime+S)};return{messageSent:()=>g(800,.1,"sine"),messageReceived:()=>g(600,.15,"sine"),notification:()=>{g(800,.1,"sine"),setTimeout(()=>g(1e3,.1,"sine"),100)},typing:()=>g(400,.05,"square")}},fL=()=>{const h=he.useRef({}),g=he.useRef(null),b=he.useRef(!1),S=he.useRef(1);he.useEffect(()=>(Object.keys(cT).forEach(s=>{const q=new Audio(cT[s]);q.preload="auto",q.volume=1,h.current[s]=q}),g.current=dL(),()=>{Object.values(h.current).forEach(s=>{s&&(s.pause(),s.src="")})}),[]);const I=s=>{if(!b.current)try{const q=h.current[s];q&&q.readyState>=2?(q.currentTime=0,q.play().catch(()=>{g.current&&g.current[s]&&g.current[s]()})):g.current&&g.current[s]&&g.current[s]()}catch(q){console.warn("Sound playback failed:",q),g.current&&g.current[s]&&g.current[s]()}};return{playMessageSent:()=>I("messageSent"),playMessageReceived:()=>I("messageReceived"),playNotification:()=>I("notification"),playTyping:()=>I("typing"),toggleMute:(s=!1)=>(b.current=!b.current,s||document.querySelectorAll("audio[data-audio-id]").forEach(q=>{q&&(q.muted=b.current)}),b.current),setVolume:(s,q=!1)=>{const Z=Math.max(0,Math.min(1,s));S.current=Z,Object.values(h.current).forEach(Q=>{Q&&(Q.volume=Z)}),q||document.querySelectorAll("audio[data-audio-id]").forEach(Q=>{Q&&(Q.volume=Z)})},isMuted:()=>b.current,getCurrentVolume:()=>S.current}},Pj=({onToggleMute:h,isMuted:g,onVolumeChange:b,currentVolume:S=1})=>x.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white/10 backdrop-blur-sm rounded-lg",children:[x.jsx("button",{onClick:h,className:`p-2 rounded-full transition-colors ${g?"bg-red-500/20 text-red-300 hover:bg-red-500/30":"bg-white/20 text-white hover:bg-white/30"}`,title:g?"Unmute all sounds (notifications & audio messages)":"Mute all sounds (notifications & audio messages)",children:g?x.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:x.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z",clipRule:"evenodd"})}):x.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:x.jsx("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 8.929a1 1 0 010 1.414A1.5 1.5 0 0116 12a1 1 0 102 0 3.5 3.5 0 00-1.929-3.071z",clipRule:"evenodd"})})}),x.jsxs("div",{className:"flex flex-col items-center gap-1",children:[x.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S,onChange:I=>b(parseFloat(I.target.value)),className:"w-20 h-2 bg-white/20 rounded-lg appearance-none cursor-pointer slider accent-white",disabled:g,title:`Volume: ${Math.round(S*100)}% (affects notifications & audio messages)`}),x.jsxs("span",{className:"text-xs text-white/80 font-medium",children:[Math.round(S*100),"%"]})]})]});var Wy={exports:{}},pL=Wy.exports,uT;function mL(){return uT||(uT=1,function(h,g){(function(b,S){h.exports=S()})(pL,function(){var b,S,I;function N(s,q){if(!b)b=q;else if(!S)S=q;else{var Z="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+b+")(sharedChunk); ("+S+")(sharedChunk); self.onerror = null;",Q={};b(Q),I=q(Q),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(I.workerUrl=window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"})))}}N(["exports"],function(s){var q=1e-6,Z=typeof Float32Array<"u"?Float32Array:Array;function Q(n,e){var i=e[0],a=e[1],o=e[2],d=e[3],p=i*d-o*a;return p?(n[0]=d*(p=1/p),n[1]=-a*p,n[2]=-o*p,n[3]=i*p,n):null}function oe(){var n=new Z(9);return Z!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function pe(n,e){var i=e[0],a=e[1],o=e[2],d=e[3],p=e[4],y=e[5],T=e[6],A=e[7],M=e[8];return n[0]=p*M-y*A,n[1]=o*A-a*M,n[2]=a*y-o*p,n[3]=y*T-d*M,n[4]=i*M-o*T,n[5]=o*d-i*y,n[6]=d*A-p*T,n[7]=a*T-i*A,n[8]=i*p-a*d,n}function ze(n,e,i){var a=e[0],o=e[1],d=e[2],p=e[3],y=e[4],T=e[5],A=e[6],M=e[7],z=e[8],P=i[0],j=i[1],B=i[2],W=i[3],Y=i[4],K=i[5],re=i[6],se=i[7],ue=i[8];return n[0]=P*a+j*p+B*A,n[1]=P*o+j*y+B*M,n[2]=P*d+j*T+B*z,n[3]=W*a+Y*p+K*A,n[4]=W*o+Y*y+K*M,n[5]=W*d+Y*T+K*z,n[6]=re*a+se*p+ue*A,n[7]=re*o+se*y+ue*M,n[8]=re*d+se*T+ue*z,n}function le(){var n=new Z(16);return Z!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function Se(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function te(n,e){var i=e[0],a=e[1],o=e[2],d=e[3],p=e[4],y=e[5],T=e[6],A=e[7],M=e[8],z=e[9],P=e[10],j=e[11],B=e[12],W=e[13],Y=e[14],K=e[15],re=i*y-a*p,se=i*T-o*p,ue=i*A-d*p,Re=a*T-o*y,Me=a*A-d*y,Ne=o*A-d*T,Fe=M*W-z*B,Ue=M*Y-P*B,pt=M*K-j*B,$e=z*Y-P*W,yt=z*K-j*W,It=P*K-j*Y,bt=re*It-se*yt+ue*$e+Re*pt-Me*Ue+Ne*Fe;return bt?(n[0]=(y*It-T*yt+A*$e)*(bt=1/bt),n[1]=(o*yt-a*It-d*$e)*bt,n[2]=(W*Ne-Y*Me+K*Re)*bt,n[3]=(P*Me-z*Ne-j*Re)*bt,n[4]=(T*pt-p*It-A*Ue)*bt,n[5]=(i*It-o*pt+d*Ue)*bt,n[6]=(Y*ue-B*Ne-K*se)*bt,n[7]=(M*Ne-P*ue+j*se)*bt,n[8]=(p*yt-y*pt+A*Fe)*bt,n[9]=(a*pt-i*yt-d*Fe)*bt,n[10]=(B*Me-W*ue+K*re)*bt,n[11]=(z*ue-M*Me-j*re)*bt,n[12]=(y*Ue-p*$e-T*Fe)*bt,n[13]=(i*$e-a*Ue+o*Fe)*bt,n[14]=(W*se-B*Re-Y*re)*bt,n[15]=(M*Re-z*se+P*re)*bt,n):null}function ge(n,e,i){var a=e[0],o=e[1],d=e[2],p=e[3],y=e[4],T=e[5],A=e[6],M=e[7],z=e[8],P=e[9],j=e[10],B=e[11],W=e[12],Y=e[13],K=e[14],re=e[15],se=i[0],ue=i[1],Re=i[2],Me=i[3];return n[0]=se*a+ue*y+Re*z+Me*W,n[1]=se*o+ue*T+Re*P+Me*Y,n[2]=se*d+ue*A+Re*j+Me*K,n[3]=se*p+ue*M+Re*B+Me*re,n[4]=(se=i[4])*a+(ue=i[5])*y+(Re=i[6])*z+(Me=i[7])*W,n[5]=se*o+ue*T+Re*P+Me*Y,n[6]=se*d+ue*A+Re*j+Me*K,n[7]=se*p+ue*M+Re*B+Me*re,n[8]=(se=i[8])*a+(ue=i[9])*y+(Re=i[10])*z+(Me=i[11])*W,n[9]=se*o+ue*T+Re*P+Me*Y,n[10]=se*d+ue*A+Re*j+Me*K,n[11]=se*p+ue*M+Re*B+Me*re,n[12]=(se=i[12])*a+(ue=i[13])*y+(Re=i[14])*z+(Me=i[15])*W,n[13]=se*o+ue*T+Re*P+Me*Y,n[14]=se*d+ue*A+Re*j+Me*K,n[15]=se*p+ue*M+Re*B+Me*re,n}function xe(n,e,i){var a,o,d,p,y,T,A,M,z,P,j,B,W=i[0],Y=i[1],K=i[2];return e===n?(n[12]=e[0]*W+e[4]*Y+e[8]*K+e[12],n[13]=e[1]*W+e[5]*Y+e[9]*K+e[13],n[14]=e[2]*W+e[6]*Y+e[10]*K+e[14],n[15]=e[3]*W+e[7]*Y+e[11]*K+e[15]):(o=e[1],d=e[2],p=e[3],y=e[4],T=e[5],A=e[6],M=e[7],z=e[8],P=e[9],j=e[10],B=e[11],n[0]=a=e[0],n[1]=o,n[2]=d,n[3]=p,n[4]=y,n[5]=T,n[6]=A,n[7]=M,n[8]=z,n[9]=P,n[10]=j,n[11]=B,n[12]=a*W+y*Y+z*K+e[12],n[13]=o*W+T*Y+P*K+e[13],n[14]=d*W+A*Y+j*K+e[14],n[15]=p*W+M*Y+B*K+e[15]),n}function ye(n,e,i){var a=i[0],o=i[1],d=i[2];return n[0]=e[0]*a,n[1]=e[1]*a,n[2]=e[2]*a,n[3]=e[3]*a,n[4]=e[4]*o,n[5]=e[5]*o,n[6]=e[6]*o,n[7]=e[7]*o,n[8]=e[8]*d,n[9]=e[9]*d,n[10]=e[10]*d,n[11]=e[11]*d,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Pe(n,e,i){var a=Math.sin(i),o=Math.cos(i),d=e[4],p=e[5],y=e[6],T=e[7],A=e[8],M=e[9],z=e[10],P=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=d*o+A*a,n[5]=p*o+M*a,n[6]=y*o+z*a,n[7]=T*o+P*a,n[8]=A*o-d*a,n[9]=M*o-p*a,n[10]=z*o-y*a,n[11]=P*o-T*a,n}function Ae(n,e,i){var a=Math.sin(i),o=Math.cos(i),d=e[0],p=e[1],y=e[2],T=e[3],A=e[8],M=e[9],z=e[10],P=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*o-A*a,n[1]=p*o-M*a,n[2]=y*o-z*a,n[3]=T*o-P*a,n[8]=d*a+A*o,n[9]=p*a+M*o,n[10]=y*a+z*o,n[11]=T*a+P*o,n}function Ke(n,e,i){var a=Math.sin(i),o=Math.cos(i),d=e[0],p=e[1],y=e[2],T=e[3],A=e[4],M=e[5],z=e[6],P=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*o+A*a,n[1]=p*o+M*a,n[2]=y*o+z*a,n[3]=T*o+P*a,n[4]=A*o-d*a,n[5]=M*o-p*a,n[6]=z*o-y*a,n[7]=P*o-T*a,n}function it(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function rt(n,e,i){var a,o,d,p=i[0],y=i[1],T=i[2],A=Math.sqrt(p*p+y*y+T*T);return A<q?null:(p*=A=1/A,y*=A,T*=A,a=Math.sin(e),o=Math.cos(e),n[0]=p*p*(d=1-o)+o,n[1]=y*p*d+T*a,n[2]=T*p*d-y*a,n[3]=0,n[4]=p*y*d-T*a,n[5]=y*y*d+o,n[6]=T*y*d+p*a,n[7]=0,n[8]=p*T*d+y*a,n[9]=y*T*d-p*a,n[10]=T*T*d+o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function ut(n,e){var i=e[0],a=e[1],o=e[2],d=e[3],p=i+i,y=a+a,T=o+o,A=i*p,M=a*p,z=a*y,P=o*p,j=o*y,B=o*T,W=d*p,Y=d*y,K=d*T;return n[0]=1-z-B,n[1]=M+K,n[2]=P-Y,n[3]=0,n[4]=M-K,n[5]=1-A-B,n[6]=j+W,n[7]=0,n[8]=P+Y,n[9]=j-W,n[10]=1-A-z,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}var Lt=ge;function lt(){var n=new Z(3);return Z!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Jt(n){var e=new Z(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function wi(n){var e=n[0],i=n[1],a=n[2];return Math.sqrt(e*e+i*i+a*a)}function Fi(n,e,i){var a=new Z(3);return a[0]=n,a[1]=e,a[2]=i,a}function Bi(n,e,i,a){return n[0]=e,n[1]=i,n[2]=a,n}function Wt(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function ki(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function Ui(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function Cn(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function Qe(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function Ft(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Di(n,e,i,a){return n[0]=e[0]+i[0]*a,n[1]=e[1]+i[1]*a,n[2]=e[2]+i[2]*a,n}function Zi(n,e){var i=e[0]-n[0],a=e[1]-n[1],o=e[2]-n[2];return i*i+a*a+o*o}function ii(n){var e=n[0],i=n[1],a=n[2];return e*e+i*i+a*a}function Yi(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function Ti(n,e){var i=e[0],a=e[1],o=e[2],d=i*i+a*a+o*o;return d>0&&(d=1/Math.sqrt(d)),n[0]=e[0]*d,n[1]=e[1]*d,n[2]=e[2]*d,n}function Mi(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Ii(n,e,i){var a=e[0],o=e[1],d=e[2],p=i[0],y=i[1],T=i[2];return n[0]=o*T-d*y,n[1]=d*p-a*T,n[2]=a*y-o*p,n}function xt(n,e,i,a){var o=e[0],d=e[1],p=e[2];return n[0]=o+a*(i[0]-o),n[1]=d+a*(i[1]-d),n[2]=p+a*(i[2]-p),n}function St(n,e,i){var a=e[0],o=e[1],d=e[2],p=i[3]*a+i[7]*o+i[11]*d+i[15];return n[0]=(i[0]*a+i[4]*o+i[8]*d+i[12])/(p=p||1),n[1]=(i[1]*a+i[5]*o+i[9]*d+i[13])/p,n[2]=(i[2]*a+i[6]*o+i[10]*d+i[14])/p,n}function Ei(n,e,i){var a=e[0],o=e[1],d=e[2];return n[0]=a*i[0]+o*i[3]+d*i[6],n[1]=a*i[1]+o*i[4]+d*i[7],n[2]=a*i[2]+o*i[5]+d*i[8],n}function Sn(n,e,i){var a=i[0],o=i[1],d=i[2],p=i[3],y=e[0],T=e[1],A=e[2],M=o*A-d*T,z=d*y-a*A,P=a*T-o*y;return n[0]=y+p*(M+=M)+o*(P+=P)-d*(z+=z),n[1]=T+p*z+d*M-a*P,n[2]=A+p*P+a*z-o*M,n}function Mn(n){return n[0]=0,n[1]=0,n[2]=0,n}function Nn(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}var In=ki,qr=Ui,bs=wi;function fa(){var n=new Z(4);return Z!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Un(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function es(n,e){var i=e[0],a=e[1],o=e[2],d=e[3],p=i*i+a*a+o*o+d*d;return p>0&&(p=1/Math.sqrt(p)),n[0]=i*p,n[1]=a*p,n[2]=o*p,n[3]=d*p,n}function js(n,e,i){var a=e[0],o=e[1],d=e[2],p=e[3];return n[0]=i[0]*a+i[4]*o+i[8]*d+i[12]*p,n[1]=i[1]*a+i[5]*o+i[9]*d+i[13]*p,n[2]=i[2]*a+i[6]*o+i[10]*d+i[14]*p,n[3]=i[3]*a+i[7]*o+i[11]*d+i[15]*p,n}function po(){var n=new Z(4);return Z!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function mo(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function As(n,e,i){i*=.5;var a=e[0],o=e[1],d=e[2],p=e[3],y=Math.sin(i),T=Math.cos(i);return n[0]=a*T+p*y,n[1]=o*T+d*y,n[2]=d*T-o*y,n[3]=p*T-a*y,n}function ws(n,e,i){i*=.5;var a=e[0],o=e[1],d=e[2],p=e[3],y=Math.sin(i),T=Math.cos(i);return n[0]=a*T-d*y,n[1]=o*T+p*y,n[2]=d*T+a*y,n[3]=p*T-o*y,n}lt(),fa();var Gr,Yr,Bs,Fs=es,Sa=(Gr=lt(),Yr=Fi(1,0,0),Bs=Fi(0,1,0),function(n,e,i){var a=Mi(e,i);return a<-.999999?(Ii(Gr,Yr,e),bs(Gr)<1e-6&&Ii(Gr,Bs,e),Ti(Gr,Gr),function(o,d,p){p*=.5;var y=Math.sin(p);o[0]=y*d[0],o[1]=y*d[1],o[2]=y*d[2],o[3]=Math.cos(p)}(n,Gr,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Ii(Gr,e,i),n[0]=Gr[0],n[1]=Gr[1],n[2]=Gr[2],n[3]=1+a,Fs(n,n))});function Or(){var n=new Z(2);return Z!=Float32Array&&(n[0]=0,n[1]=0),n}function Ea(n,e){var i=new Z(2);return i[0]=n,i[1]=e,i}function Ya(n,e,i){return n[0]=e,n[1]=i,n}function ss(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n}function Ka(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n}function Ls(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n}function hs(n){var e=n[0],i=n[1];return Math.sqrt(e*e+i*i)}function fr(n,e){var i=e[0],a=e[1],o=i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),n[0]=e[0]*o,n[1]=e[1]*o,n}function as(n,e){return n[0]*e[0]+n[1]*e[1]}po(),po(),oe();var bc,ka,ds=Ka;function Ur(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}Or();var No=function(){if(ka)return bc;function n(e,i,a,o){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(o-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=a,this.p2y=o}return ka=1,bc=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,o=0;o<8;o++){var d=this.sampleCurveX(a)-e;if(Math.abs(d)<i)return a;var p=this.sampleCurveDerivativeX(a);if(Math.abs(p)<1e-6)break;a-=d/p}var y=0,T=1;for(a=e,o=0;o<20&&(d=this.sampleCurveX(a),!(Math.abs(d-e)<i));o++)e>d?y=a:T=a,a=.5*(T-y)+y;return a},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},bc}(),pa=Ur(No);function Mt(n,e){this.x=n,this.y=e}function ea(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!ea(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!ea(n[i],e[i]))return!1;return!0}return n===e}Mt.prototype={clone(){return new Mt(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),i=Math.sin(n),a=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=a,this},_rotateAround(n,e){const i=Math.cos(n),a=Math.sin(n),o=e.y+a*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-a*(this.y-e.y),this.y=o,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Mt},Mt.convert=function(n){if(n instanceof Mt)return n;if(Array.isArray(n))return new Mt(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new Mt(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};const go=Math.PI/180,Na=180/Math.PI;function He(n){return n*go}function J(n){return n*Na}const ne=[[0,0],[1,0],[1,1],[0,1]];function _e(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function ke(n,e,i,a){const o=new pa(n,e,i,a);return function(d){return o.solve(d)}}const Le=ke(.25,.1,.25,1);function Ie(n,e,i){return Math.min(i,Math.max(e,n))}function et(n,e,i){return(i=Ie((i-n)/(e-n),0,1))*i*(3-2*i)}function Be(n,e,i){const a=i-e,o=((n-e)%a+a)%a+e;return o===e?i:o}function Je(n,e,i){if(!n.length)return i(null,[]);let a=n.length;const o=new Array(n.length);let d=null;n.forEach((p,y)=>{e(p,(T,A)=>{T&&(d=T),o[y]=A,--a==0&&i(d,o)})})}let zt=1;function vt(){return zt++}function pi(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log2(n)))}function Ai(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Vi(n,e,i){const a={};for(const o in n)a[o]=e.call(this,n[o],o,n);return a}function on(n,e,i){const a={};for(const o in n)e.call(this,n[o],o,n)&&(a[o]=n[o]);return a}function rn(n){return Array.isArray(n)?n.map(rn):typeof n=="object"&&n?Vi(n,rn):n}function ln(n,e){for(let i=0;i<n.length;i++)if(e.indexOf(n[i])>=0)return!0;return!1}const jn={};function cn(n){jn[n]||(typeof console<"u"&&console.warn(n),jn[n]=!0)}function cr(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function $n(n){let e=0;for(let i,a,o=0,d=n.length,p=d-1;o<d;p=o++)i=n[o],a=n[p],e+=(a.x-i.x)*(i.y+a.y);return e}function Ve([n,e,i]){const a=He(e+90),o=He(i);return{x:n*Math.cos(a)*Math.sin(o),y:n*Math.sin(a)*Math.sin(o),z:n*Math.cos(o),azimuthal:e,polar:i}}function wt(n){return(typeof self<"u"||n!==void 0)&&typeof WorkerGlobalScope<"u"&&(n!==void 0?n:self)instanceof WorkerGlobalScope}function Bt(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,o,d)=>{const p=o||d;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Qt=null;function bi(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function $i(n,e,i,a){for(;e<i;){const o=e+i>>1;n[o]<a?e=o+1:i=o}return e}function yr(n,e,i,a){for(;e<i;){const o=e+i>>1;n[o]<=a?e=o+1:i=o}return e}function Kn(n){return n>0?1/(1.001-n):1+n}function ar(n){return n>0?1-1/(1.001-n):-n}function Sr(n,e,i){return(n-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Vr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Vr.API_URL)return null;try{const n=new URL(Vr.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ja(n){return Vr.API_URL_REGEX.test(n)}function Ja(n){return Vr.API_SPRITE_REGEX.test(n)}let Ll,oh,wc,lh,jo,ad;function Ba(){return Ll==null&&(Ll=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ll}const _o={now:()=>lh!==void 0?lh:performance.now(),setNow(n){lh=n},restoreNow(){lh=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:a}=n;jo||(jo=document.createElement("canvas"));const o=jo.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return(i>jo.width||a>jo.height)&&(jo.width=i,jo.height=a),o.clearRect(-e,-e,i+2*e,a+2*e),o.drawImage(n,0,0,i,a),o.getImageData(-e,-e,i+2*e,a+2*e)},resolveURL:n=>(oh||(oh=document.createElement("a")),oh.href=n,oh.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(wc==null&&(wc=window.matchMedia("(prefers-reduced-motion: reduce)")),wc.matches)},hasCanvasFingerprintNoise(){if(ad!==void 0)return ad;if(!Ba())return ad=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let i=0;for(let o=0;o<n.width;++o)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(o,0,1,1);const a=e.getImageData(0,0,n.width,n.height);i=0;for(let o=0;o<a.data.length;++o)if(o%4!=3&&i++!==a.data[o])return ad=!0,!0;return ad=!1,!1}};function hf(n,e){const i=n.indexOf("?");if(i<0)return`${n}?${new URLSearchParams(e).toString()}`;const a=new URLSearchParams(n.slice(i));for(const o in e)a.set(o,e[o]);return`${n.slice(0,i)}?${a.toString()}`}function ch(n,e={persistentParams:[]}){const i=n.indexOf("?");if(i<0)return n;const a=new URLSearchParams,o=new URLSearchParams(n.slice(i));for(const p of e.persistentParams){const y=o.get(p);y&&a.set(p,y)}const d=a.toString();return`${n.slice(0,i)}${d.length>0?`?${d}`:""}`}const Us="mapbox-tiles";let yo=500,ll=50;const ma=["language","worldview","jobid"];let ga,Tc;function df(){try{return caches}catch{}}function lu(){const n=df();n&&ga==null&&(ga=n.open(Us))}let Sc=1/0;const od={supported:!1,testSupport:function(n){!Aa&&Ac&&(Cc?cu(n):Ec=n)}};let Ec,Ac,Aa=!1,Cc=!1;const Ol=typeof self<"u"?self:{};function cu(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Ac),n.isContextLost())return;od.supported=!0}catch{}n.deleteTexture(e),Aa=!0}Ol.document&&(Ac=Ol.document.createElement("img"),Ac.onload=function(){Ec&&cu(Ec),Ec=null,Cc=!0},Ac.onerror=function(){Aa=!0,Ec=null},Ac.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const uh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(uh);class ff extends Error{constructor(e,i,a){i===401&&ja(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Rc=wt()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,wn=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(Rc())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,o){const d=new AbortController,p=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Rc(),referrerPolicy:a.referrerPolicy,signal:d.signal});let y=!1,T=!1;const A=(M=p.url).indexOf("sku=")>0&&ja(M);var M;a.type==="json"&&p.headers.set("Accept","application/json");const z=(j,B,W)=>{if(T)return;if(j&&j.message!=="SecurityError"&&cn(j.toString()),B&&W)return P(B);const Y=Date.now();fetch(p).then(K=>{if(K.ok){const re=A?K.clone():null;return P(K,re,Y)}return o(new ff(K.statusText,K.status,a.url))}).catch(K=>{K.name!=="AbortError"&&o(new Error(`${K.message} ${a.url}`))})},P=(j,B,W)=>{(a.type==="arrayBuffer"?j.arrayBuffer():a.type==="json"?j.json():j.text()).then(Y=>{T||(B&&W&&function(K,re,se){if(lu(),ga==null)return;const ue=Bt(re.headers.get("Cache-Control")||"");if(ue["no-store"])return;const Re={status:re.status,statusText:re.statusText,headers:new Headers};re.headers.forEach((Fe,Ue)=>Re.headers.set(Ue,Fe)),ue["max-age"]&&Re.headers.set("Expires",new Date(se+1e3*ue["max-age"]).toUTCString());const Me=Re.headers.get("Expires");if(!Me||new Date(Me).getTime()-se<42e4)return;let Ne=ch(K.url,{persistentParams:ma});if(re.status===206){const Fe=K.headers.get("Range");if(!Fe)return;Re.status=200,Ne=hf(Ne,{range:Fe})}(function(Fe,Ue){if(Tc===void 0)try{new Response(new ReadableStream),Tc=!0}catch{Tc=!1}Tc?Ue(Fe.body):Fe.blob().then(Ue).catch(pt=>cn(pt.message))})(re,Fe=>{const Ue=new Response((pt=re.status)!==200&&pt!==404&&[101,103,204,205,304].includes(pt)?null:Fe,Re);var pt;lu(),ga!=null&&ga.then($e=>$e.put(Ne,Ue)).catch($e=>cn($e.message))})}(p,B,W),y=!0,o(null,Y,j.headers.get("Cache-Control"),j.headers.get("Expires")))}).catch(Y=>{T||o(new Error(Y.message))})};return A?function(j,B){if(lu(),ga==null)return B(null);ga.then(W=>{let Y=ch(j.url,{persistentParams:ma});const K=j.headers.get("Range");K&&(Y=hf(Y,{range:K})),W.match(Y).then(re=>{const se=function(ue){if(!ue)return!1;const Re=new Date(ue.headers.get("Expires")||0),Me=Bt(ue.headers.get("Cache-Control")||"");return Number(Re)>Date.now()&&!Me["no-cache"]}(re);W.delete(Y).catch(B),se&&W.put(Y,re.clone()).catch(B),B(null,re,se)}).catch(B)}).catch(B)}(p,z):z(null,null),{cancel:()=>{T=!0,y||d.abort()}}}(n,e);if(wt(self)&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(a,o){const d=new XMLHttpRequest;d.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const p in a.headers)d.setRequestHeader(p,a.headers[p]);return a.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=a.credentials==="include",d.onerror=()=>{o(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let p=d.response;if(a.type==="json")try{p=JSON.parse(d.response)}catch(y){return o(y)}o(null,p,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else o(new ff(d.statusText,d.status,a.url))},d.send(a.body),{cancel:()=>d.abort()}}(n,e)},cl=function(n,e){return wn(Object.assign(n,{type:"arrayBuffer"}),e)};function kl(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const pf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let uu,Nl;uu=[],Nl=0;const jl=function(n,e){if(od.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Nl>=Vr.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return uu.push(d),d}Nl++;let i=!1;const a=()=>{if(!i)for(i=!0,Nl--;uu.length&&Nl<Vr.MAX_PARALLEL_IMAGE_REQUESTS;){const d=uu.shift(),{requestParameters:p,callback:y,cancelled:T}=d;T||(d.cancel=jl(p,y).cancel)}},o=cl(n,(d,p,y,T)=>{a(),d?e(d):p&&(self.createImageBitmap?function(A,M){const z=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(z).then(P=>{M(null,P)}).catch(P=>{M(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(A,M)=>e(A,M,y,T)):function(A,M){const z=new Image;z.onload=()=>{M(null,z),URL.revokeObjectURL(z.src),z.onload=null,requestAnimationFrame(()=>{z.src=pf})},z.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(A)],{type:"image/png"});z.src=A.byteLength?URL.createObjectURL(P):pf}(p,(A,M)=>e(A,M,y,T)))});return{cancel:()=>{o.cancel(),a()}}};var Mc,ld,Ca,Qa={exports:{}},cd={exports:{}},hu={exports:{}},hh=function(){if(Ca)return Qa.exports;Ca=1;var n=(Mc||(Mc=1,cd.exports=function(i,a){var o,d,p,y,T,A,M,z;for(d=i.length-(o=3&i.length),p=a,T=3432918353,A=461845907,z=0;z<d;)M=255&i.charCodeAt(z)|(255&i.charCodeAt(++z))<<8|(255&i.charCodeAt(++z))<<16|(255&i.charCodeAt(++z))<<24,++z,p=27492+(65535&(y=5*(65535&(p=(p^=M=(65535&(M=(M=(65535&M)*T+(((M>>>16)*T&65535)<<16)&4294967295)<<15|M>>>17))*A+(((M>>>16)*A&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(M=0,o){case 3:M^=(255&i.charCodeAt(z+2))<<16;case 2:M^=(255&i.charCodeAt(z+1))<<8;case 1:p^=M=(65535&(M=(M=(65535&(M^=255&i.charCodeAt(z)))*T+(((M>>>16)*T&65535)<<16)&4294967295)<<15|M>>>17))*A+(((M>>>16)*A&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),cd.exports),e=(ld||(ld=1,hu.exports=function(i,a){for(var o,d=i.length,p=a^d,y=0;d>=4;)o=1540483477*(65535&(o=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(o>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),d-=4,++y;switch(d){case 3:p^=(255&i.charCodeAt(y+2))<<16;case 2:p^=(255&i.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),hu.exports);return Qa.exports=n,Qa.exports.murmur3=n,Qa.exports.murmur2=e,Qa.exports}(),dh=Ur(hh);class eo{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class Bl extends eo{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function du(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function Fa(n,e,i){if(i&&i[n]){const a=i[n].indexOf(e);a!==-1&&i[n].splice(a,1)}}class fu{on(e,i){return this._listeners=this._listeners||{},du(e,i,this._listeners),this}off(e,i){return Fa(e,i,this._listeners),Fa(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},du(e,i,this._oneTimeListeners),this):new Promise(a=>{this.once(e,a)})}fire(e,i){const a=typeof e=="string"?new eo(e,i):e,o=a.type;if(this.listens(o)){a.target=this;const d=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const T of d)T.call(this,a);const p=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const T of p)Fa(o,T,this._oneTimeListeners),T.call(this,a);const y=this._eventedParent;if(y){const T=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(a,T),y.fire(a)}}else a instanceof Bl&&console.error(a.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class to{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new to(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,a]=e.split("");return new to({name:i,iconsetId:a})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return to.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var wp,fh={},Tp=function(){if(wp)return fh;wp=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(d){return(d=Math.round(d))<0?0:d>255?255:d}function i(d){return e(d[d.length-1]==="%"?parseFloat(d)/100*255:parseInt(d))}function a(d){return(p=d[d.length-1]==="%"?parseFloat(d)/100:parseFloat(d))<0?0:p>1?1:p;var p}function o(d,p,y){return y<0?y+=1:y>1&&(y-=1),6*y<1?d+(p-d)*y*6:2*y<1?p:3*y<2?d+(p-d)*(2/3-y)*6:d}try{fh.parseCSSColor=function(d){var p,y=d.replace(/ /g,"").toLowerCase();if(y in n)return n[y].slice();if(y[0]==="#")return y.length===4?(p=parseInt(y.substr(1),16))>=0&&p<=4095?[(3840&p)>>4|(3840&p)>>8,240&p|(240&p)>>4,15&p|(15&p)<<4,1]:null:y.length===7&&(p=parseInt(y.substr(1),16))>=0&&p<=16777215?[(16711680&p)>>16,(65280&p)>>8,255&p,1]:null;var T=y.indexOf("("),A=y.indexOf(")");if(T!==-1&&A+1===y.length){var M=y.substr(0,T),z=y.substr(T+1,A-(T+1)).split(","),P=1;switch(M){case"rgba":if(z.length!==4)return null;P=a(z.pop());case"rgb":return z.length!==3?null:[i(z[0]),i(z[1]),i(z[2]),P];case"hsla":if(z.length!==4)return null;P=a(z.pop());case"hsl":if(z.length!==3)return null;var j=(parseFloat(z[0])%360+360)%360/360,B=a(z[1]),W=a(z[2]),Y=W<=.5?W*(B+1):W+B-W*B,K=2*W-Y;return[e(255*o(K,Y,j+1/3)),e(255*o(K,Y,j)),e(255*o(K,Y,j-1/3)),P];default:return null}}return null}}catch{}return fh}();class Vn{constructor(e,i,a,o=1){this.r=e,this.g=i,this.b=a,this.a=o}static parse(e){if(!e)return;if(e instanceof Vn)return e;if(typeof e!="string")return;const i=Tp.parseCSSColor(e);return i?new Vn(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,a,o]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*a)},${o})`}toNonPremultipliedRenderColor(e){const{r:i,g:a,b:o,a:d}=this;return new Om(e,i,a,o,d)}toPremultipliedRenderColor(e){const{r:i,g:a,b:o,a:d}=this;return new mf(e,i*d,a*d,o*d,d)}clone(){return new Vn(this.r,this.g,this.b,this.a)}}class Sp{constructor(e,i,a,o,d,p=!1){if(this.premultiplied=!1,this.premultiplied=p,e){const y=e.image.height,T=y*y;this.premultiplied?(i=d===0?0:i/d*(y-1),a=d===0?0:a/d*(y-1),o=d===0?0:o/d*(y-1)):(i*=y-1,a*=y-1,o*=y-1);const A=Math.floor(i),M=Math.floor(a),z=Math.floor(o),P=Math.ceil(i),j=Math.ceil(a),B=Math.ceil(o),W=i-A,Y=a-M,K=o-z,re=e.image.data,se=4*(A+M*T+z*y),ue=4*(A+M*T+B*y),Re=4*(A+j*T+z*y),Me=4*(A+j*T+B*y),Ne=4*(P+M*T+z*y),Fe=4*(P+M*T+B*y),Ue=4*(P+j*T+z*y),pt=4*(P+j*T+B*y);if(se<0||pt>=re.length)throw new Error("out of range");this.r=zi(zi(zi(re[se],re[ue],K),zi(re[Re],re[Me],K),Y),zi(zi(re[Ne],re[Fe],K),zi(re[Ue],re[pt],K),Y),W)/255*(this.premultiplied?d:1),this.g=zi(zi(zi(re[se+1],re[ue+1],K),zi(re[Re+1],re[Me+1],K),Y),zi(zi(re[Ne+1],re[Fe+1],K),zi(re[Ue+1],re[pt+1],K),Y),W)/255*(this.premultiplied?d:1),this.b=zi(zi(zi(re[se+2],re[ue+2],K),zi(re[Re+2],re[Me+2],K),Y),zi(zi(re[Ne+2],re[Fe+2],K),zi(re[Ue+2],re[pt+2],K),Y),W)/255*(this.premultiplied?d:1),this.a=d}else this.r=i,this.g=a,this.b=o,this.a=d}toArray(){const{r:e,g:i,b:a,a:o}=this;return[255*e,255*i,255*a,o]}toHslaArray(){let{r:e,g:i,b:a,a:o}=this;if(this.premultiplied){if(o===0)return[0,0,0,0];const B=1/o;e*=B,i*=B,a*=B}const d=Math.min(Math.max(e,0),1),p=Math.min(Math.max(i,0),1),y=Math.min(Math.max(a,0),1),T=Math.min(d,p,y),A=Math.max(d,p,y),M=A-T,z=.5*(T+A);if(M===0)return[0,0,100*z,o];const P=z>.5?M/(2-A-T):M/(A+T);let j;switch(A){case d:j=60*((p-y)/M+(p<y?6:0));break;case p:j=60*((y-d)/M+2);break;default:j=60*((d-p)/M+4)}return[j,100*P,100*z,o]}toArray01(){const{r:e,g:i,b:a,a:o}=this;return[e,i,a,o]}toArray01Scaled(e){const{r:i,g:a,b:o}=this;return[i*e,a*e,o*e]}toArray01Linear(){const{r:e,g:i,b:a,a:o}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(a,2.2),o]}}class Om extends Sp{constructor(e,i,a,o,d){super(e,i,a,o,d,!1)}}class mf extends Sp{constructor(e,i,a,o,d){super(e,i,a,o,d,!0)}}function zi(n,e,i){return n*(1-i)+e*i}function Ep(n,e,i){return n.map((a,o)=>zi(a,e[o],i))}Vn.black=new Vn(0,0,0,1),Vn.white=new Vn(1,1,1,1),Vn.transparent=new Vn(0,0,0,0),Vn.red=new Vn(1,0,0,1),Vn.blue=new Vn(0,0,1,1);var io=Object.freeze({__proto__:null,array:Ep,color:function(n,e,i){return new Vn(zi(n.r,e.r,i),zi(n.g,e.g,i),zi(n.b,e.b,i),zi(n.a,e.a,i))},number:zi});class Bo extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class gf{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[a,o]of i)this.bindings[a]=o}concat(e){return new gf(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const xo={kind:"null"},_i={kind:"number"},Hn={kind:"string"},Zn={kind:"boolean"},Ra={kind:"color"},pu={kind:"object"},Bn={kind:"value"},_f={kind:"collator"},Ic={kind:"formatted"},ud={kind:"resolvedImage"};function ta(n,e){return{kind:"array",itemType:n,N:e}}function ts(n){if(n.kind==="array"){const e=ts(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Wg=[xo,_i,Hn,Zn,Ra,Ic,pu,ta(Bn),ud];function hd(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!hd(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of Wg)if(!hd(i,e))return null}}return`Expected ${ts(n)} but found ${ts(e)} instead.`}function dd(n,e){return e.some(i=>i.kind===n.kind)}function Fl(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}function fd(n,e){return n.kind==="array"&&e.kind==="array"?n.N===e.N&&fd(n.itemType,e.itemType):n.kind===e.kind}class Ul{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class pd{constructor(e,i,a,o,d){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=a,this.fontStack=o,this.textColor=d}}class ia{constructor(e){this.sections=e}static fromString(e){return new ia([new pd(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof ia?e:ia.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const o=i.image.getPrimary().id.toString();e.push(["image",o]);continue}e.push(i.text);const a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(a)}return e}}class vo{constructor(e,i={}){if(this.id=to.from(e),this.options=Object.assign({},i),i.transform){const{a,b:o,c:d,d:p,e:y,f:T}=i.transform;this.options.transform=new DOMMatrix([a,o,d,p,y,T])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:a,d:o,e:d,f:p}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:a,d:o,e:d,f:p}})}static parse(e){let i,a,o,d;try{({name:i,iconsetId:a,params:o,transform:d}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:p,b:y,c:T,d:A,e:M,f:z}=d||{};return new vo({name:i,iconsetId:a},{params:o,transform:new DOMMatrix([p,y,T,A,M,z])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class _a{constructor(e,i,a,o,d=!1){this.primaryId=to.from(e),this.primaryOptions=i,a&&(this.secondaryId=to.from(a)),this.secondaryOptions=o,this.available=d}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new vo(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new vo(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?_a.build({name:e}):e}static build(e,i,a,o){return!e||typeof e=="object"&&!("name"in e)?null:new _a(e,a,i,o)}}function mu(n,e,i,a){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,e,i,a]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ph(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Vn||n instanceof Ul||n instanceof ia||n instanceof _a)return!0;if(Array.isArray(n)){for(const e of n)if(!ph(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!ph(n[e]))return!1;return!0}return!1}function fs(n){if(n===null)return xo;if(typeof n=="string")return Hn;if(typeof n=="boolean")return Zn;if(typeof n=="number")return _i;if(n instanceof Vn)return Ra;if(n instanceof Ul)return _f;if(n instanceof ia)return Ic;if(n instanceof _a)return ud;if(Array.isArray(n)){const e=n.length;let i;for(const a of n){const o=fs(a);if(i){if(i===o)continue;i=Bn;break}i=o}return ta(i||Bn,e)}return pu}function Ma(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof ia||n instanceof _a||n instanceof Vn?n.toString():JSON.stringify(n)}class tn{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ph(e[1]))return i.error("invalid value");const a=e[1];let o=fs(a);const d=i.expectedType;return o.kind!=="array"||o.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(o=d),new tn(o,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Vn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ia?this.value.serialize():this.value}}class ni{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Vl={string:Hn,number:_i,boolean:Zn,object:pu};class Ci{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,o=1;const d=e[0];if(d==="array"){let y,T;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in Vl)||A==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=Vl[A],o++}else y=Bn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);T=e[2],o++}a=ta(y,T)}else a=Vl[d];const p=[];for(;o<e.length;o++){const y=i.parse(e[o],o,Bn);if(!y)return null;p.push(y)}return new Ci(a,p)}evaluate(e){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(e);if(!hd(this.type,fs(a)))return a;if(i===this.args.length-1)throw new ni(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${ts(fs(a))} but was expected to be of type ${ts(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){i.push(a.kind);const o=e.N;(typeof o=="number"||this.args.length>1)&&i.push(o)}}return i.concat(this.args.map(a=>a.serialize()))}}class gu{constructor(e){this.type=Ic,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const o=[];let d=!1;for(let p=1;p<=e.length-1;++p){const y=e[p];if(d&&typeof y=="object"&&!Array.isArray(y)){d=!1;let T=null;if(y["font-scale"]&&(T=i.parseObjectValue(y["font-scale"],p,"font-scale",_i),!T))return null;let A=null;if(y["text-font"]&&(A=i.parseObjectValue(y["text-font"],p,"text-font",ta(Hn)),!A))return null;let M=null;if(y["text-color"]&&(M=i.parseObjectValue(y["text-color"],p,"text-color",Ra),!M))return null;const z=o[o.length-1];z.scale=T,z.font=A,z.textColor=M}else{const T=i.parse(e[p],p,Bn);if(!T)return null;const A=T.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,o.push({content:T,scale:null,font:null,textColor:null})}}return new gu(o)}evaluate(e){return new ia(this.sections.map(i=>{const a=i.content.evaluate(e);return fd(fs(a),ud)?new pd("",a,null,null,null):new pd(Ma(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),e.push(a)}return e}}class Hl{constructor(e,i,a,o){this._imageWarnHistory={},this.type=ud,this.namePrimary=e,this.nameSecondary=i,a&&(this.paramsPrimary=a.params,this.iconsetIdPrimary=a.iconset?a.iconset.id:void 0),o&&(this.paramsSecondary=o.params,this.iconsetIdSecondary=o.iconset?o.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let a=1;const o=[];function d(){if(a<e.length){const y=i.parse(e[a],a++,Hn);return y?(o.push({image:y,options:{}}),!0):(i.error(o.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function p(){if(a<e.length){const T=e[a];if((y=T)===null||typeof y!="object"||Array.isArray(y))return!0;const A=T.params,M=T.iconset,z=i.concat(a);if(!A&&!M)return a++,!0;if(A){if(typeof A!="object"||A.constructor!==Object)return z.error('Image options "params" should be an object'),!1;const P={},j=z.concat(void 0,"params");for(const B in A){if(!B)return j.error("Image parameter name should be non-empty"),!1;const W=j.concat(void 0,B).parse(A[B],void 0,Ra,void 0,{typeAnnotation:"coerce"});if(!W)return!1;P[B]=W}o[o.length-1].options.params=P}if(M){if(typeof M!="object"||M.constructor!==Object)return z.error('Image options "iconset" should be an object'),!1;if(!M.id)return z.error('Image options "iconset" should have an "id" property'),!1;o[o.length-1].options.iconset=M}return a++,!0}var y;return!0}for(let y=0;y<2;y++)if(!d()||!p())return;return new Hl(o[0].image,o[1]?o[1].image:void 0,o[0].options,o[1]?o[1].options:void 0)}evaluateParams(e,i){const a={};if(i){for(const o in i)if(i[o])try{a[o]=i[o].evaluate(e)}catch{continue}if(Object.keys(a).length!==0)return{params:a}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},a=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,o=_a.build(i,a,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(o&&e.availableImages){const d=o.getPrimary().id;if(o.available=e.availableImages.some(p=>to.isEqual(p,d)),o.available){const p=o.getSecondary()?o.getSecondary().id:null;p&&(o.available=e.availableImages.some(y=>to.isEqual(y,p)))}}return o}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const a={};if(i&&(a.iconset={id:i}),e){a.params={};for(const o in e)e[o]&&(a.params[o]=e[o].serialize())}return Object.keys(a).length>0?a:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function Ni(n){return _u(n)?"string":yu(n)?"number":xf(n)?"boolean":Array.isArray(n)?"array":n===null?"null":yf(n)?"object":typeof n}function yf(n){return n!=null&&!Array.isArray(n)&&typeof n!="function"&&!(n instanceof String||n instanceof Number||n instanceof Boolean)&&typeof n=="object"}function _u(n){return typeof n=="string"||n instanceof String}function yu(n){return typeof n=="number"||n instanceof Number}function xf(n){return typeof n=="boolean"||n instanceof Boolean}const md={"to-boolean":Zn,"to-color":Ra,"to-number":_i,"to-string":Hn};class $r{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[0],o=[];let d=xo;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const p=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);d=ta(i.expectedType.itemType,p)}else{if(!(p>0&&ph(e[1][0])))return null;d=ta(fs(e[1][0]),p)}for(let y=0;y<p;y++){const T=e[1][y];let A;if(Array.isArray(T))A=i.parse(T,void 0,d.itemType);else{const M=Ni(T);if(M!==d.itemType.kind)return i.error(`Expected ${d.itemType.kind} but found ${M}.`);A=i.registry.literal.parse(["literal",T===void 0?null:T],i)}if(!A)return null;o.push(A)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return i.error("Expected one argument.");d=md[a];for(let p=1;p<e.length;p++){const y=i.parse(e[p],p,Bn);if(!y)return null;o.push(y)}}return new $r(d,o)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,a;for(const o of this.args){if(i=o.evaluate(e),a=null,i instanceof Vn)return i;if(typeof i=="string"){const d=e.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:mu(i[0],i[1],i[2],i[3]),!a))return new Vn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new ni(a||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const a of this.args){if(i=a.evaluate(e),i===null)return 0;const o=Number(i);if(!isNaN(o))return o}throw new ni(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ia.fromString(Ma(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?_a.build(Ma(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):Ma(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new gu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Hl(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Ap=["Unknown","Point","LineString","Polygon"];class ql{constructor(e,i,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=a}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ap[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:a,y:o}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*i-e[0])+this.featureDistanceData.bearing[1]*(o*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Vn.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class ya{constructor(e,i,a,o,d){this.name=e,this.type=i,this._evaluate=a,this.args=o,this._overloadIndex=d}evaluate(e){if(!this._evaluate){const i=ya.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const a=e[0],o=ya.definitions[a];if(!o)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(o)?o[0]:o.type,p=Array.isArray(o)?[[o[1],o[2]]]:o.overloads,y=[];let T=null,A=-1;for(const[M,z]of p){if(Array.isArray(M)&&M.length!==e.length-1)continue;y.push(M),A++,T=new Nc(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const P=[];let j=!1;for(let B=1;B<e.length;B++){const W=e[B],Y=Array.isArray(M)?M[B-1]:M.type,K=T.parse(W,1+P.length,Y);if(!K){j=!0;break}P.push(K)}if(!j)if(Array.isArray(M)&&M.length!==P.length)T.error(`Expected ${M.length} arguments, but found ${P.length} instead.`);else{for(let B=0;B<P.length;B++){const W=Array.isArray(M)?M[B]:M.type,Y=P[B];T.concat(B+1).checkSubtype(W,Y.type)}if(T.errors.length===0)return new ya(a,d,z,P,A)}}if(y.length===1)i.errors.push(...T.errors);else{const M=(y.length?y:p.map(([P])=>P)).map(zc).join(" | "),z=[];for(let P=1;P<e.length;P++){const j=i.parse(e[P],1+z.length);if(!j)return null;z.push(ts(j.type))}i.error(`Expected arguments of type ${M}, but found (${z.join(", ")}) instead.`)}return null}static register(e,i){ya.definitions=i;for(const a in i)e[a]=ya}}function zc(n){return Array.isArray(n)?`(${n.map(ts).join(", ")})`:`(${ts(n.type)}...)`}class Os{constructor(e,i,a){this.type=_f,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const o=a["case-sensitive"]===void 0?i.parse(!1,1,Zn):i.parseObjectValue(a["case-sensitive"],1,"case-sensitive",Zn);if(!o)return null;const d=a["diacritic-sensitive"]===void 0?i.parse(!1,1,Zn):i.parseObjectValue(a["diacritic-sensitive"],1,"diacritic-sensitive",Zn);if(!d)return null;let p=null;return a.locale&&(p=i.parseObjectValue(a.locale,1,"locale",Hn),!p)?null:new Os(o,d,p)}evaluate(e){return new Ul(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Ua(n,e,i=0,a=n.length-1,o=km){for(;a>i;){if(a-i>600){const T=a-i+1,A=e-i+1,M=Math.log(T),z=.5*Math.exp(2*M/3),P=.5*Math.sqrt(M*z*(T-z)/T)*(A-T/2<0?-1:1);Ua(n,e,Math.max(i,Math.floor(e-A*z/T+P)),Math.min(a,Math.floor(e+(T-A)*z/T+P)),o)}const d=n[e];let p=i,y=a;for(Gl(n,i,e),o(n[a],d)>0&&Gl(n,i,a);p<y;){for(Gl(n,p,y),p++,y--;o(n[p],d)<0;)p++;for(;o(n[y],d)>0;)y--}o(n[i],d)===0?Gl(n,i,y):(y++,Gl(n,y,a)),y<=e&&(i=y+1),e<=y&&(a=y-1)}}function Gl(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}function km(n,e){return n<e?-1:n>e?1:0}function gd(n){let e=0;for(let i,a,o=0,d=n.length,p=d-1;o<d;p=o++)i=n[o],a=n[p],e+=(a.x-i.x)*(i.y+a.y);return e}function xu(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function bo(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Cp(n,e,i){const a=n[0]-e[0],o=n[1]-e[1],d=n[0]-i[0],p=n[1]-i[1];return a*p-d*o==0&&a*d<=0&&o*p<=0}function mh(n,e,i=!1){let a=!1;for(let y=0,T=e.length;y<T;y++){const A=e[y];for(let M=0,z=A.length,P=z-1;M<z;P=M++){const j=A[P],B=A[M];if(Cp(n,j,B))return i;(d=j)[1]>(o=n)[1]!=(p=B)[1]>o[1]&&o[0]<(p[0]-d[0])*(o[1]-d[1])/(p[1]-d[1])+d[0]&&(a=!a)}}var o,d,p;return a}function Nm(n,e,i,a){const o=a[0]-i[0],d=a[1]-i[1],p=(n[0]-i[0])*d-o*(n[1]-i[1]),y=(e[0]-i[0])*d-o*(e[1]-i[1]);return p>0&&y<0||p<0&&y>0}function $l(n,e,i,a){return(o=[a[0]-i[0],a[1]-i[1]])[0]*(d=[e[0]-n[0],e[1]-n[1]])[1]-o[1]*d[0]!=0&&!(!Nm(n,e,i,a)||!Nm(i,a,n,e));var o,d}function gh(n){const e=new Mt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Mt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const a of n[0])e.x>a.x&&(e.x=a.x),e.y>a.y&&(e.y=a.y),i.x<a.x&&(i.x=a.x),i.y<a.y&&(i.y=a.y);return{min:e,max:i}}const wo=8192;function Zl(n,e){const i=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,o=Math.pow(2,e.z);return[Math.round(i*o*wo),Math.round(a*o*wo)]}function jm(n,e){for(let i=0;i<e.length;i++)if(mh(n,e[i]))return!0;return!1}function vu(n,e,i){for(const a of i)for(let o=0,d=a.length,p=d-1;o<d;p=o++)if($l(n,e,a[p],a[o]))return!0;return!1}function Wl(n,e){for(let i=0;i<n.length;++i)if(!mh(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(vu(n[i],n[i+1],e))return!1;return!0}function vf(n,e){for(let i=0;i<e.length;i++)if(Wl(n,e[i]))return!0;return!1}function _d(n,e,i){const a=[];for(let o=0;o<n.length;o++){const d=[];for(let p=0;p<n[o].length;p++){const y=Zl(n[o][p],i);xu(e,y),d.push(y)}a.push(d)}return a}function Vs(n,e,i){const a=[];for(let o=0;o<n.length;o++){const d=_d(n[o],e,i);a.push(d)}return a}function Rp(n,e,i,a){if(n[0]<i[0]||n[0]>i[2]){const o=.5*a;let d=n[0]-i[0]>o?-a:i[0]-n[0]>o?a:0;d===0&&(d=n[0]-i[2]>o?-a:i[2]-n[0]>o?a:0),n[0]+=d}xu(e,n)}function Mp(n,e,i,a){const o=Math.pow(2,a.z)*wo,d=[a.x*wo,a.y*wo],p=[];if(!n)return p;for(const y of n)for(const T of y){const A=[T.x+d[0],T.y+d[1]];Rp(A,e,i,o),p.push(A)}return p}function Ip(n,e,i,a){const o=Math.pow(2,a.z)*wo,d=[a.x*wo,a.y*wo],p=[];if(!n)return p;for(const T of n){const A=[];for(const M of T){const z=[M.x+d[0],M.y+d[1]];xu(e,z),A.push(z)}p.push(A)}if(e[2]-e[0]<=o/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const T of p)for(const A of T)Rp(A,e,i,o)}var y;return p}class bu{constructor(e,i){this.type=Zn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ph(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let o=0;o<a.features.length;++o){const d=a.features[o].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new bu(a,a.features[o].geometry)}else if(a.type==="Feature"){const o=a.geometry.type;if(o==="Polygon"||o==="MultiPolygon")return new bu(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new bu(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,a){const o=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const y=_d(a.coordinates,d,p),T=Mp(i.geometry(),o,d,p);if(!bo(o,d))return!1;for(const A of T)if(!mh(A,y))return!1}if(a.type==="MultiPolygon"){const y=Vs(a.coordinates,d,p),T=Mp(i.geometry(),o,d,p);if(!bo(o,d))return!1;for(const A of T)if(!jm(A,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,a){const o=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const y=_d(a.coordinates,d,p),T=Ip(i.geometry(),o,d,p);if(!bo(o,d))return!1;for(const A of T)if(!Wl(A,y))return!1}if(a.type==="MultiPolygon"){const y=Vs(a.coordinates,d,p),T=Ip(i.geometry(),o,d,p);if(!bo(o,d))return!1;for(const A of T)if(!vf(A,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const yd={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},zp=1/298.257223563,bf=zp*(2-zp),wu=Math.PI/180;class Tu{static fromTile(e,i,a){const o=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),d=Math.atan(.5*(Math.exp(o)-Math.exp(-o)))/wu;return new Tu(d,a)}static get units(){return yd}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!yd[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(yd).join(", ")}`);const a=6378.137*wu*(i?yd[i]:1),o=Math.cos(e*wu),d=1/(1-bf*(1-o*o)),p=Math.sqrt(d);this.kx=a*p*o,this.ky=a*p*d*(1-bf)}distance(e,i){const a=Hs(e[0]-i[0])*this.kx,o=(e[1]-i[1])*this.ky;return Math.sqrt(a*a+o*o)}bearing(e,i){const a=Hs(i[0]-e[0])*this.kx;return Math.atan2(a,(i[1]-e[1])*this.ky)/wu}destination(e,i,a){const o=a*wu;return this.offset(e,Math.sin(o)*i,Math.cos(o)*i)}offset(e,i,a){return[e[0]+i/this.kx,e[1]+a/this.ky]}lineDistance(e){let i=0;for(let a=0;a<e.length-1;a++)i+=this.distance(e[a],e[a+1]);return i}area(e){let i=0;for(let a=0;a<e.length;a++){const o=e[a];for(let d=0,p=o.length,y=p-1;d<p;y=d++)i+=Hs(o[d][0]-o[y][0])*(o[d][1]+o[y][1])*(a?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let a=0;if(i<=0)return e[0];for(let o=0;o<e.length-1;o++){const d=e[o],p=e[o+1],y=this.distance(d,p);if(a+=y,a>i)return Ia(d,p,(i-(a-y))/y)}return e[e.length-1]}pointToSegmentDistance(e,i,a){let[o,d]=i,p=Hs(a[0]-o)*this.kx,y=(a[1]-d)*this.ky;if(p!==0||y!==0){const T=(Hs(e[0]-o)*this.kx*p+(e[1]-d)*this.ky*y)/(p*p+y*y);T>1?(o=a[0],d=a[1]):T>0&&(o+=p/this.kx*T,d+=y/this.ky*T)}return p=Hs(e[0]-o)*this.kx,y=(e[1]-d)*this.ky,Math.sqrt(p*p+y*y)}pointOnLine(e,i){let a=1/0,o=e[0][0],d=e[0][1],p=0,y=0;for(let T=0;T<e.length-1;T++){let A=e[T][0],M=e[T][1],z=Hs(e[T+1][0]-A)*this.kx,P=(e[T+1][1]-M)*this.ky,j=0;z===0&&P===0||(j=(Hs(i[0]-A)*this.kx*z+(i[1]-M)*this.ky*P)/(z*z+P*P),j>1?(A=e[T+1][0],M=e[T+1][1]):j>0&&(A+=z/this.kx*j,M+=P/this.ky*j)),z=Hs(i[0]-A)*this.kx,P=(i[1]-M)*this.ky;const B=z*z+P*P;B<a&&(a=B,o=A,d=M,p=T,y=j)}return{point:[o,d],index:p,t:Math.max(0,Math.min(1,y))}}lineSlice(e,i,a){let o=this.pointOnLine(a,e),d=this.pointOnLine(a,i);if(o.index>d.index||o.index===d.index&&o.t>d.t){const A=o;o=d,d=A}const p=[o.point],y=o.index+1,T=d.index;!no(a[y],p[0])&&y<=T&&p.push(a[y]);for(let A=y+1;A<=T;A++)p.push(a[A]);return no(a[T],d.point)||p.push(d.point),p}lineSliceAlong(e,i,a){let o=0;const d=[];for(let p=0;p<a.length-1;p++){const y=a[p],T=a[p+1],A=this.distance(y,T);if(o+=A,o>e&&d.length===0&&d.push(Ia(y,T,(e-(o-A))/A)),o>=i)return d.push(Ia(y,T,(i-(o-A))/A)),d;o>e&&d.push(T)}return d}bufferPoint(e,i){const a=i/this.ky,o=i/this.kx;return[e[0]-o,e[1]-a,e[0]+o,e[1]+a]}bufferBBox(e,i){const a=i/this.ky,o=i/this.kx;return[e[0]-o,e[1]-a,e[2]+o,e[3]+a]}insideBBox(e,i){return Hs(e[0]-i[0])>=0&&Hs(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function no(n,e){return n[0]===e[0]&&n[1]===e[1]}function Ia(n,e,i){const a=Hs(e[0]-n[0]);return[n[0]+a*i,n[1]+(e[1]-n[1])*i]}function Hs(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class _h{constructor(e=[],i=(a,o)=>a<o?-1:a>o?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:a}=this,o=i[e];for(;e>0;){const d=e-1>>1,p=i[d];if(a(o,p)>=0)break;i[e]=p,e=d}i[e]=o}_down(e){const{data:i,compare:a}=this,o=this.length>>1,d=i[e];for(;e<o;){let p=1+(e<<1);const y=p+1;if(y<this.length&&a(i[y],i[p])<0&&(p=y),a(i[p],d)>=0)break;i[e]=i[p],e=p}i[e]=d}}var Vt=8192;function yh(n,e){return e.dist-n.dist}const Dc=100,ro=50;function xh(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}function Pc(n){return n[1]-n[0]+1}function za(n,e){const i=n[1]>=n[0]&&n[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function xd(n,e){if(n[0]>n[1])return[null,null];const i=Pc(n);if(e){if(i===2)return[n,null];const a=Math.floor(i/2);return[[n[0],n[0]+a],[n[0]+a,n[1]]]}{if(i===1)return[n,null];const a=Math.floor(i/2)-1;return[[n[0],n[0]+a],[n[0]+a+1,n[1]]]}}function os(n,e){const i=[1/0,1/0,-1/0,-1/0];if(!za(e,n.length))return i;for(let a=e[0];a<=e[1];++a)xu(i,n[a]);return i}function pn(n){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<n.length;++i)for(let a=0;a<n[i].length;++a)xu(e,n[i][a]);return e}function Fo(n,e,i){if(xh(n)||xh(e))return NaN;let a=0,o=0;return n[2]<e[0]&&(a=e[0]-n[2]),n[0]>e[2]&&(a=n[0]-e[2]),n[1]>e[3]&&(o=n[1]-e[3]),n[3]<e[1]&&(o=e[1]-n[3]),i.distance([0,0],[a,o])}function wf(n){return 360*n-180}function Tf(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Da(n,e){const i=Math.pow(2,e.z),a=(n.y/Vt+e.y)/i;return[wf((n.x/Vt+e.x)/i),Tf(a)]}function To(n,e){const i=[];for(let a=0;a<n.length;++a)i.push(Da(n[a],e));return i}function rr(n,e,i){const a=i.pointOnLine(e,n).point;return i.distance(n,a)}function ul(n,e,i,a,o){const d=i.slice(a[0],a[1]+1);let p=1/0;for(let y=e[0];y<=e[1];++y)if((p=Math.min(p,rr(n[y],d,o)))===0)return 0;return p}function Uo(n,e,i,a,o){const d=Math.min(o.pointToSegmentDistance(n,i,a),o.pointToSegmentDistance(e,i,a)),p=Math.min(o.pointToSegmentDistance(i,n,e),o.pointToSegmentDistance(a,n,e));return Math.min(d,p)}function Su(n,e,i,a,o){if(!za(e,n.length)||!za(a,i.length))return NaN;let d=1/0;for(let p=e[0];p<e[1];++p)for(let y=a[0];y<a[1];++y){if($l(n[p],n[p+1],i[y],i[y+1]))return 0;d=Math.min(d,Uo(n[p],n[p+1],i[y],i[y+1],o))}return d}function Bm(n,e,i,a,o){if(!za(e,n.length)||!za(a,i.length))return NaN;let d=1/0;for(let p=e[0];p<=e[1];++p)for(let y=a[0];y<=a[1];++y)if((d=Math.min(d,o.distance(n[p],i[y])))===0)return d;return d}function Dp(n,e,i){if(mh(n,e,!0))return 0;let a=1/0;for(const o of e){const d=o.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(o[0]!==o[d-1]&&(a=Math.min(a,i.pointToSegmentDistance(n,o[d-1],o[0])))===0||(a=Math.min(a,rr(n,o,i)))===0)return a}return a}function Pp(n,e,i,a){if(!za(e,n.length))return NaN;for(let d=e[0];d<=e[1];++d)if(mh(n[d],i,!0))return 0;let o=1/0;for(let d=e[0];d<e[1];++d)for(const p of i)for(let y=0,T=p.length,A=T-1;y<T;A=y++){if($l(n[d],n[d+1],p[A],p[y]))return 0;o=Math.min(o,Uo(n[d],n[d+1],p[A],p[y],a))}return o}function xa(n,e){for(const i of n)for(let a=0;a<=i.length-1;++a)if(mh(i[a],e,!0))return!0;return!1}function na(n,e,i,a=1/0){const o=pn(n),d=pn(e);if(a!==1/0&&Fo(o,d,i)>=a)return a;if(bo(o,d)){if(xa(n,e))return 0}else if(xa(e,n))return 0;let p=a;for(const y of n)for(let T=0,A=y.length,M=A-1;T<A;M=T++)for(const z of e)for(let P=0,j=z.length,B=j-1;P<j;B=P++){if($l(y[M],y[T],z[B],z[P]))return 0;p=Math.min(p,Uo(y[M],y[T],z[B],z[P],i))}return p}function xr(n,e,i,a,o,d,p){if(d===null||p===null)return;const y=Fo(os(a,d),os(o,p),i);y<e&&n.push({dist:y,range1:d,range2:p})}function Vo(n,e,i,a,o=1/0){let d=Math.min(a.distance(n[0],i[0][0]),o);if(d===0)return d;const p=new _h([{dist:0,range1:[0,n.length-1],range2:[0,0]}],yh),y=e?ro:Dc,T=pn(i);for(;p.length;){const A=p.pop();if(A.dist>=d)continue;const M=A.range1;if(Pc(M)<=y){if(!za(M,n.length))return NaN;if(e){const z=Pp(n,M,i,a);if((d=Math.min(d,z))===0)return d}else for(let z=M[0];z<=M[1];++z){const P=Dp(n[z],i,a);if((d=Math.min(d,P))===0)return d}}else{const z=xd(M,e);if(z[0]!==null){const P=Fo(os(n,z[0]),T,a);P<d&&p.push({dist:P,range1:z[0],range2:[0,0]})}if(z[1]!==null){const P=Fo(os(n,z[1]),T,a);P<d&&p.push({dist:P,range1:z[1],range2:[0,0]})}}}return d}function Ho(n,e,i,a,o,d=1/0){let p=Math.min(d,o.distance(n[0],i[0]));if(p===0)return p;const y=new _h([{dist:0,range1:[0,n.length-1],range2:[0,i.length-1]}],yh),T=e?ro:Dc,A=a?ro:Dc;for(;y.length;){const M=y.pop();if(M.dist>=p)continue;const z=M.range1,P=M.range2;if(Pc(z)<=T&&Pc(P)<=A){if(!za(z,n.length)||!za(P,i.length))return NaN;if(e&&a?p=Math.min(p,Su(n,z,i,P,o)):e||a?e&&!a?p=Math.min(p,ul(i,P,n,z,o)):!e&&a&&(p=Math.min(p,ul(n,z,i,P,o))):p=Math.min(p,Bm(n,z,i,P,o)),p===0)return p}else{const j=xd(z,e),B=xd(P,a);xr(y,p,o,n,i,j[0],B[0]),xr(y,p,o,n,i,j[0],B[1]),xr(y,p,o,n,i,j[1],B[0]),xr(y,p,o,n,i,j[1],B[1])}}return p}function vd(n,e,i,a,o=1/0){let d=o;const p=os(n,[0,n.length-1]);for(const y of i)if(!(d!==1/0&&Fo(p,os(y,[0,y.length-1]),a)>=d)&&(d=Math.min(d,Ho(n,e,y,!0,a,d)),d===0))return d;return d}function hl(n,e,i,a,o=1/0){let d=o;const p=os(n,[0,n.length-1]);for(const y of i){if(d!==1/0&&Fo(p,pn(y),a)>=d)continue;const T=Vo(n,e,y,a,d);if(isNaN(T))return T;if((d=Math.min(d,T))===0)return d}return d}function Sf(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class Lc{constructor(e,i){this.type=_i,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ph(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let o=0;o<a.features.length;++o)if(Sf(a.features[o].geometry.type))return new Lc(a,a.features[o].geometry)}else if(a.type==="Feature"){if(Sf(a.geometry.type))return new Lc(a,a.geometry)}else if(Sf(a.type))return new Lc(a,a)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),a=e.canonicalID();if(i!=null&&a!=null){if(e.geometryType()==="Point")return function(o,d,p){const y=[];for(const A of o)for(const M of A)y.push(Da(M,d));const T=new Tu(y[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?Ho(y,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",T):p.type==="MultiLineString"?vd(y,!1,p.coordinates,T):p.type==="Polygon"||p.type==="MultiPolygon"?hl(y,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,T):null}(i,a,this.geometries);if(e.geometryType()==="LineString")return function(o,d,p){const y=[];for(const A of o){const M=[];for(const z of A)M.push(Da(z,d));y.push(M)}const T=new Tu(y[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return vd(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y,T);if(p.type==="MultiLineString"){let A=1/0;for(let M=0;M<p.coordinates.length;M++){const z=vd(p.coordinates[M],!0,y,T,A);if(isNaN(z))return z;if((A=Math.min(A,z))===0)return A}return A}if(p.type==="Polygon"||p.type==="MultiPolygon"){let A=1/0;for(let M=0;M<y.length;M++){const z=hl(y[M],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,T,A);if(isNaN(z))return z;if((A=Math.min(A,z))===0)return A}return A}return null}(i,a,this.geometries);if(e.geometryType()==="Polygon")return function(o,d,p){const y=[];for(const A of function(M,z){const P=M.length;if(P<=1)return[M];const j=[];let B,W;for(let Y=0;Y<P;Y++){const K=gd(M[Y]);K!==0&&(M[Y].area=Math.abs(K),W===void 0&&(W=K<0),W===K<0?(B&&j.push(B),B=[M[Y]]):B.push(M[Y]))}return B&&j.push(B),j}(o)){const M=[];for(let z=0;z<A.length;++z)M.push(To(A[z],d));y.push(M)}const T=new Tu(y[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return hl(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y,T);if(p.type==="MultiLineString"){let A=1/0;for(let M=0;M<p.coordinates.length;M++){const z=hl(p.coordinates[M],!0,y,T,A);if(isNaN(z))return z;if((A=Math.min(A,z))===0)return A}return A}return p.type==="Polygon"||p.type==="MultiPolygon"?function(A,M,z){let P=1/0;for(const j of A)for(const B of M){const W=na(j,B,z,P);if(isNaN(W))return W;if((P=Math.min(P,W))===0)return P}return P}(p.type==="Polygon"?[p.coordinates]:p.coordinates,y,T):null}(i,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function dl(n){if(n instanceof ya&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof bu||n instanceof Lc)return!1;if(n instanceof Xl)return n.featureConstant;let e=!0;return n.eachChild(i=>{e&&!dl(i)&&(e=!1)}),e}function Oc(n){if(n instanceof ya&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!Oc(i)&&(e=!1)}),e}function kc(n){if(n instanceof Xl)return new Set([n.key]);let e=new Set;return n.eachChild(i=>{e=new Set([...e,...kc(i)])}),e}function fl(n,e){if(n instanceof ya&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(a=>{i&&!fl(a,e)&&(i=!1)}),i}function Lp(n,e,i){return[n,e,i].filter(Boolean).join("")}function bd(n,e){switch(n){case"string":return Ma(e);case"number":return+e;case"boolean":return!!e;case"color":return Vn.parse(e);case"formatted":return ia.fromString(Ma(e));case"resolvedImage":return _a.build(Ma(e))}return e}function Op(n,e,i,a){return a!==void 0&&(n=a*Math.round(n/a)),e!==void 0&&n<e&&(n=e),i!==void 0&&n>i&&(n=i),n}class Xl{constructor(e,i,a,o=!1){this.type=e,this.key=i,this.scope=a,this.featureConstant=o}static parse(e,i){let a=i.expectedType;if(a==null&&(a=Bn),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const o=i.parse(e[1],1);if(!(o instanceof tn))return i.error("Key name of 'config' expression must be a string literal.");let d,p=!0;const y=Ma(o.value);if(e.length>=3){const T=i.parse(e[2],2);if(!(T instanceof tn))return i.error("Scope of 'config' expression must be a string literal.");d=Ma(T.value)}if(i.options){const T=Lp(y,d,i._scope),A=i.options.get(T);A&&(p=dl(A.value||A.default))}return new Xl(a,y,d,p)}evaluate(e){const i=Lp(this.key,this.scope,e.scope),a=e.getConfig(i);if(!a)return null;const{type:o,value:d,values:p,minValue:y,maxValue:T,stepValue:A}=a,M=a.default.evaluate(e);let z=M;if(d){const P=e.scope;e.scope=(P||"").split("").slice(1).join(""),z=d.evaluate(e),e.scope=P}return o&&(z=bd(o,z)),z===void 0||y===void 0&&T===void 0&&A===void 0||(typeof z=="number"?z=Op(z,y,T,A):Array.isArray(z)&&(z=z.map(P=>typeof P=="number"?Op(P,y,T,A):P))),d!==void 0&&z!==void 0&&p&&!p.includes(z)&&(z=M,o&&(z=bd(o,z))),(o&&o!==this.type||z!==void 0&&!fd(fs(z),this.type))&&(z=bd(this.type.kind,z)),z}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class wd{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=e[1];return i.scope.has(a)?new wd(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Nc{constructor(e,i=[],a,o=new gf,d=[],p,y,T){this.registry=e,this.path=i,this.key=i.map(A=>typeof A=="string"?`['${A}']`:`[${A}]`).join(""),this.scope=o,this.errors=d,this.expectedType=a,this._scope=p,this.options=y,this.iconImageUseTheme=T}parse(e,i,a,o,d={}){return i||a?this.concat(i,null,a,o)._parse(e,d):this._parse(e,d)}parseObjectValue(e,i,a,o,d,p={}){return this.concat(i,a,o,d)._parse(e,p)}_parse(e,i){function a(o,d,p){return p==="assert"?new Ci(d,[o]):p==="coerce"?new $r(d,[o]):o}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const o=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(o){let d=o.parse(e,this);if(!d)return null;if(this.expectedType){const p=this.expectedType,y=d.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||y.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(p,y))return null}else d=a(d,p,i.typeAnnotation||"coerce");else d=a(d,p,i.typeAnnotation||"assert")}if(!(d instanceof tn)&&d.type.kind!=="resolvedImage"&&Ef(d)){const p=new ql(this._scope,this.options,this.iconImageUseTheme);try{d=new tn(d.type,d.evaluate(p))}catch(y){return this.error(y.message),null}}return d}return $r.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a,o){let d=typeof e=="number"?this.path.concat(e):this.path;d=typeof i=="string"?d.concat(i):d;const p=o?this.scope.concat(o):this.scope;return new Nc(this.registry,d,a||null,p,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const a=`${this.key}${i.map(o=>`[${o}]`).join("")}`;this.errors.push(new Bo(a,e))}checkSubtype(e,i){const a=hd(e,i);return a&&this.error(a),a}}function Ef(n){if(n instanceof wd)return Ef(n.boundExpression);if(n instanceof ya&&n.name==="error"||n instanceof Os||n instanceof bu||n instanceof Lc||n instanceof Xl)return!1;const e=n instanceof $r||n instanceof Ci;let i=!0;return n.eachChild(a=>{i=e?i&&Ef(a):i&&a instanceof tn}),!!i&&dl(n)&&fl(n,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Yl(n,e){const i=n.length-1;let a,o,d=0,p=i,y=0;for(;d<=p;)if(y=Math.floor((d+p)/2),a=n[y],o=n[y+1],a<=e){if(y===i||e<o)return y;d=y+1}else{if(!(a>e))throw new ni("Input is not a number.");p=y-1}return 0}class Kl{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[o,d]of a)this.labels.push(o),this.outputs.push(d)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(e[1],1,_i);if(!a)return null;const o=[];let d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let p=1;p<e.length;p+=2){const y=p===1?-1/0:e[p],T=e[p+1],A=p,M=p+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(o.length&&o[o.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const z=i.parse(T,M,d);if(!z)return null;d=d||z.type,o.push([y,z])}return new Kl(d,a,o)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const o=this.input.evaluate(e);if(o<=i[0])return a[0].evaluate(e);const d=i.length;return o>=i[d-1]?a[d-1].evaluate(e):a[Yl(i,o)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Td=.95047,vh=1.08883,Sd=4/29,Jl=6/29,kp=3*Jl*Jl,jc=Jl*Jl*Jl,Fm=Math.PI/180,bh=180/Math.PI;function wh(n){return n>jc?Math.pow(n,1/3):n/kp+Sd}function Ed(n){return n>Jl?n*n*n:kp*(n-Sd)}function Th(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function pl(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Va(n){const e=pl(n.r),i=pl(n.g),a=pl(n.b),o=wh((.4124564*e+.3575761*i+.1804375*a)/Td),d=wh((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*d-16,a:500*(o-d),b:200*(d-wh((.0193339*e+.119192*i+.9503041*a)/vh)),alpha:n.a}}function So(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,a=isNaN(n.b)?e:e-n.b/200;return e=1*Ed(e),i=Td*Ed(i),a=vh*Ed(a),new Vn(Th(3.2404542*i-1.5371385*e-.4985314*a),Th(-.969266*i+1.8760108*e+.041556*a),Th(.0556434*i-.2040259*e+1.0572252*a),n.alpha)}function Bc(n,e,i){const a=e-n;return n+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const Fc={forward:Va,reverse:So,interpolate:function(n,e,i){return{l:zi(n.l,e.l,i),a:zi(n.a,e.a,i),b:zi(n.b,e.b,i),alpha:zi(n.alpha,e.alpha,i)}}},Ha={forward:function(n){const{l:e,a:i,b:a}=Va(n),o=Math.atan2(a,i)*bh;return{h:o<0?o+360:o,c:Math.sqrt(i*i+a*a),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Fm,i=n.c;return So({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:Bc(n.h,e.h,i),c:zi(n.c,e.c,i),l:zi(n.l,e.l,i),alpha:zi(n.alpha,e.alpha,i)}}};var ml=Object.freeze({__proto__:null,hcl:Ha,lab:Fc});class zr{constructor(e,i,a,o,d){this.type=e,this.operator=i,this.interpolation=a,this.input=o,this.labels=[],this.outputs=[];for(const[p,y]of d)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(e,i,a,o){let d=0;if(e.name==="exponential")d=Eu(i,e.base,a,o);else if(e.name==="linear")d=Eu(i,1,a,o);else if(e.name==="cubic-bezier"){const p=e.controlPoints;d=new pa(p[0],p[1],p[2],p[3]).solve(Eu(i,1,a,o))}return d}static parse(e,i){let[a,o,d,...p]=e;if(!Array.isArray(o)||o.length===0)return i.error("Expected an interpolation type expression.",1);if(o[0]==="linear")o={name:"linear"};else if(o[0]==="exponential"){const A=o[1];if(typeof A!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);o={name:"exponential",base:A}}else{if(o[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(o[0])}`,1,0);{const A=o.slice(1);if(A.length!==4||A.some(M=>typeof M!="number"||M<0||M>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);o={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,_i),!d)return null;const y=[];let T=null;a==="interpolate-hcl"||a==="interpolate-lab"?T=Ra:i.expectedType&&i.expectedType.kind!=="value"&&(T=i.expectedType);for(let A=0;A<p.length;A+=2){const M=p[A],z=p[A+1],P=A+3,j=A+4;if(typeof M!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(y.length&&y[y.length-1][0]>=M)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const B=i.parse(z,j,T);if(!B)return null;T=T||B.type,y.push([M,B])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new zr(T,a,o,d,y):i.error(`Type ${ts(T)} is not interpolatable.`)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const o=this.input.evaluate(e);if(o<=i[0])return a[0].evaluate(e);const d=i.length;if(o>=i[d-1])return a[d-1].evaluate(e);const p=Yl(i,o),y=zr.interpolationFactor(this.interpolation,o,i[p],i[p+1]),T=a[p].evaluate(e),A=a[p+1].evaluate(e);return this.operator==="interpolate"?io[this.type.kind.toLowerCase()](T,A,y):this.operator==="interpolate-hcl"?Ha.reverse(Ha.interpolate(Ha.forward(T),Ha.forward(A),y)):Fc.reverse(Fc.interpolate(Fc.forward(T),Fc.forward(A),y))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function Eu(n,e,i,a){const o=a-i,d=n-i;return o===0?0:e===1?d/o:(Math.pow(e,d)-1)/(Math.pow(e,o)-1)}class Ad{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null;const o=i.expectedType;o&&o.kind!=="value"&&(a=o);const d=[];for(const y of e.slice(1)){const T=i.parse(y,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!T)return null;a=a||T.type,d.push(T)}const p=o&&d.some(y=>hd(o,y.type));return new Ad(p?Bn:a,d)}evaluate(e){let i,a=null,o=0;for(const d of this.args){if(o++,a=d.evaluate(e),a&&a instanceof _a&&!a.available&&(i||(i=a),a=null,o===this.args.length))return i;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Af{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let d=1;d<e.length-1;d+=2){const p=e[d];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,d);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);const y=i.parse(e[d+1],d+1);if(!y)return null;a.push([p,y])}const o=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return o?new Af(a,o):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,a]of this.bindings)e.push(i,a.serialize());return e.push(this.result.serialize()),e}}class Np{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,_i),o=i.parse(e[2],2,ta(i.expectedType||Bn));return a&&o?new Np(o.type.itemType,a,o):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new ni("Array index out of bounds: negative index");if(i>=a.length)throw new ni("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new ni("Array index must be an integer. Use at-interpolated for fractional indices");return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ts{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,_i),o=i.parse(e[2],2,ta(i.expectedType||Bn));return a&&o?new Ts(o.type.itemType,a,o):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new ni(`Array index out of bounds: ${i} < 0.`);if(i>a.length-1)throw new ni(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i===Math.floor(i))return a[i];const o=Math.floor(i),d=Math.ceil(i),p=a[o],y=a[d];if(typeof p!="number"||typeof y!="number")throw new ni(`Cannot interpolate between non-number values at index ${i}.`);const T=i-o;return p*(1-T)+y*T}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Sh{constructor(e,i){this.type=Zn,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Bn),o=i.parse(e[2],2,Bn);return a&&o?dd(a.type,[Zn,Hn,_i,xo,Bn])?new Sh(a,o):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ts(a.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Fl(i,["boolean","string","number","null"]))throw new ni(`Expected first argument to be of type boolean, string, number or null, but found ${ts(fs(i))} instead.`);if(!Fl(a,["string","array"]))throw new ni(`Expected second argument to be of type array or string, but found ${ts(fs(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ql{constructor(e,i,a){this.type=_i,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Bn),o=i.parse(e[2],2,Bn);if(!a||!o)return null;if(!dd(a.type,[Zn,Hn,_i,xo,Bn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ts(a.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,_i);return d?new Ql(a,o,d):null}return new Ql(a,o)}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Fl(i,["boolean","string","number","null"]))throw new ni(`Expected first argument to be of type boolean, string, number or null, but found ${ts(fs(i))} instead.`);if(!Fl(a,["string","array"]))throw new ni(`Expected second argument to be of type array or string, but found ${ts(fs(a))} instead.`);if(this.fromIndex){const o=this.fromIndex.evaluate(e);return a.indexOf(i,o)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class gl{constructor(e,i,a,o,d,p){this.inputType=e,this.type=i,this.input=a,this.cases=o,this.outputs=d,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const d={},p=[];for(let A=2;A<e.length-1;A+=2){let M=e[A];const z=e[A+1];Array.isArray(M)||(M=[M]);const P=i.concat(A);if(M.length===0)return P.error("Expected at least one branch label.");for(const B of M){if(typeof B!="number"&&typeof B!="string")return P.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return P.error("Numeric branch labels must be integer values.");if(a){if(P.checkSubtype(a,fs(B)))return null}else a=fs(B);if(d[String(B)]!==void 0)return P.error("Branch labels must be unique.");d[String(B)]=p.length}const j=i.parse(z,A,o);if(!j)return null;o=o||j.type,p.push(j)}const y=i.parse(e[1],1,Bn);if(!y)return null;const T=i.parse(e[e.length-1],e.length-1,o);return T?y.type.kind!=="value"&&i.concat(1).checkSubtype(a,y.type)?null:new gl(a,o,y,d,p,T):null}evaluate(e){const i=this.input.evaluate(e);return(fd(fs(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],o={};for(const p of i){const y=o[this.cases[p]];y===void 0?(o[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[y][1].push(p)}const d=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,y]of a)e.push(y.length===1?d(y[0]):y.map(d)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class Cd{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const o=[];for(let p=1;p<e.length-1;p+=2){const y=i.parse(e[p],p,Zn);if(!y)return null;const T=i.parse(e[p+1],p+1,a);if(!T)return null;o.push([y,T]),a=a||T.type}const d=i.parse(e[e.length-1],e.length-1,a);return d?new Cd(a,o,d):null}evaluate(e){for(const[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class _l{constructor(e,i,a,o){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Bn),o=i.parse(e[2],2,_i);if(!a||!o)return null;if(!dd(a.type,[ta(Bn),Hn,Bn]))return i.error(`Expected first argument to be of type array or string, but found ${ts(a.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,_i);return d?new _l(a.type,a,o,d):null}return new _l(a.type,a,o)}evaluate(e){const i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Fl(i,["string","array"]))throw new ni(`Expected first argument to be of type array or string, but found ${ts(fs(i))} instead.`);if(this.endIndex){const o=this.endIndex.evaluate(e);return i.slice(a,o)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Uc{constructor(e,i){this.type=ta(Hn),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Hn),o=i.parse(e[2],2,Hn);return a&&o?new Uc(a,o):void 0}evaluate(e){const i=this.str.evaluate(e),a=this.delimiter.evaluate(e);return i.split(a)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Um(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Cf(n,e,i,a){return a.compare(e,i)===0}function Au(n,e,i){const a=n!=="=="&&n!=="!=";return class o5{constructor(d,p,y){this.type=Zn,this.lhs=d,this.rhs=p,this.collator=y,this.hasUntypedArgument=d.type.kind==="value"||p.type.kind==="value"}static parse(d,p){if(d.length!==3&&d.length!==4)return p.error("Expected two or three arguments.");const y=d[0];let T=p.parse(d[1],1,Bn);if(!T)return null;if(!Um(y,T.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${ts(T.type)}'.`);let A=p.parse(d[2],2,Bn);if(!A)return null;if(!Um(y,A.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${ts(A.type)}'.`);if(T.type.kind!==A.type.kind&&T.type.kind!=="value"&&A.type.kind!=="value")return p.error(`Cannot compare types '${ts(T.type)}' and '${ts(A.type)}'.`);a&&(T.type.kind==="value"&&A.type.kind!=="value"?T=new Ci(A.type,[T]):T.type.kind!=="value"&&A.type.kind==="value"&&(A=new Ci(T.type,[A])));let M=null;if(d.length===4){if(T.type.kind!=="string"&&A.type.kind!=="string"&&T.type.kind!=="value"&&A.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(M=p.parse(d[3],3,_f),!M)return null}return new o5(T,A,M)}evaluate(d){const p=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){const T=fs(p),A=fs(y);if(T.kind!==A.kind||T.kind!=="string"&&T.kind!=="number")throw new ni(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${T.kind}, ${A.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const T=fs(p),A=fs(y);if(T.kind!=="string"||A.kind!=="string")return e(d,p,y)}return this.collator?i(d,p,y,this.collator.evaluate(d)):e(d,p,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[n];return this.eachChild(p=>{d.push(p.serialize())}),d}}}const Vm=Au("==",function(n,e,i){return e===i},Cf),Cu=Au("!=",function(n,e,i){return e!==i},function(n,e,i,a){return!Cf(0,e,i,a)}),jp=Au("<",function(n,e,i){return e<i},function(n,e,i,a){return a.compare(e,i)<0}),Ru=Au(">",function(n,e,i){return e>i},function(n,e,i,a){return a.compare(e,i)>0}),Hm=Au("<=",function(n,e,i){return e<=i},function(n,e,i,a){return a.compare(e,i)<=0}),Vc=Au(">=",function(n,e,i){return e>=i},function(n,e,i,a){return a.compare(e,i)>=0});class Jn{constructor(e,i,a,o,d,p){this.type=Hn,this.number=e,this.locale=i,this.currency=a,this.unit=o,this.minFractionDigits=d,this.maxFractionDigits=p}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const a=i.parse(e[1],1,_i);if(!a)return null;const o=e[2];if(typeof o!="object"||Array.isArray(o))return i.error("NumberFormat options argument must be an object.");let d=null;if(o.locale&&(d=i.parseObjectValue(o.locale,2,"locale",Hn),!d))return null;let p=null;if(o.currency&&(p=i.parseObjectValue(o.currency,2,"currency",Hn),!p))return null;let y=null;if(o.unit&&(y=i.parseObjectValue(o.unit,2,"unit",Hn),!y))return null;let T=null;if(o["min-fraction-digits"]&&(T=i.parseObjectValue(o["min-fraction-digits"],2,"min-fraction-digits",_i),!T))return null;let A=null;return o["max-fraction-digits"]&&(A=i.parseObjectValue(o["max-fraction-digits"],2,"max-fraction-digits",_i),!A)?null:new Jn(a,d,p,y,T,A)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class kr{constructor(e){this.type=_i,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=i.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${ts(a.type)} instead.`):new kr(a):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new ni(`Expected value to be of type string or array, but found ${ts(fs(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function ps(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const ec={"==":Vm,"!=":Cu,">":Ru,"<":jp,">=":Vc,"<=":Hm,array:Ci,at:Np,"at-interpolated":Ts,boolean:Ci,case:Cd,coalesce:Ad,collator:Os,format:gu,image:Hl,in:Sh,"index-of":Ql,interpolate:zr,"interpolate-hcl":zr,"interpolate-lab":zr,length:kr,let:Af,literal:tn,match:gl,number:Ci,"number-format":Jn,object:Ci,slice:_l,step:Kl,string:Ci,"to-boolean":$r,"to-color":$r,"to-number":$r,"to-string":$r,var:wd,within:bu,distance:Lc,config:Xl,split:Uc};function Mu(n,[e,i,a,o]){e=e.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);const d=o?o.evaluate(n):1,p=mu(e,i,a,d);if(p)throw new ni(p);return new Vn(e/255,i/255,a/255,d)}function tc(n,[e,i,a,o]){e=e.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);const d=o?o.evaluate(n):1,p=function(A,M,z,P){return typeof A=="number"&&A>=0&&A<=360?typeof M=="number"&&M>=0&&M<=100&&typeof z=="number"&&z>=0&&z<=100?P===void 0||typeof P=="number"&&P>=0&&P<=1?null:`Invalid hsla value [${[A,M,z,P].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof P=="number"?[A,M,z,P]:[A,M,z]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof P=="number"?[A,M,z,P]:[A,M,z]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,a,d);if(p)throw new ni(p);const y=`hsla(${e}, ${i}%, ${a}%, ${d})`,T=Vn.parse(y);if(!T)throw new ni(`Failed to parse HSLA color: ${y}`);return T}function Eh(n,e){return n in e}function Hc(n,e){const i=e[n];return i===void 0?null:i}function Eo(n){return{type:n}}function Iu(n){return{result:"success",value:n}}function Hr(n){return{result:"error",value:n}}function Rd(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function Ah(n){return n["property-type"]==="data-driven"}function Rf(n){return Rd(n.expression,"measure-light")}function Mf(n){return Rd(n.expression,"zoom")}function If(n){return!!n.expression&&n.expression.interpolated}function Ch(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Md(n){return n}function Rh(n,e){const i=e.type==="color",a=n.stops&&typeof n.stops[0][0]=="object",o=a||!(a||n.property!==void 0),d=n.type||(If(e)?"exponential":"interval");if(i&&((n=Object.assign({},n)).stops&&(n.stops=n.stops.map(A=>[A[0],Vn.parse(A[1])])),n.default=Vn.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!ml[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let p,y,T;if(d==="exponential")p=Mh;else if(d==="interval")p=qo;else if(d==="categorical"){p=Cs,y=Object.create(null);for(const A of n.stops)y[A[0]]=A[1];T=typeof n.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);p=zf}if(a){const A={},M=[];for(let j=0;j<n.stops.length;j++){const B=n.stops[j],W=B[0].zoom;A[W]===void 0&&(A[W]={zoom:W,type:n.type,property:n.property,default:n.default,stops:[]},M.push(W)),A[W].stops.push([B[0].value,B[1]])}const z=[];for(const j of M)z.push([A[j].zoom,Rh(A[j],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:zr.interpolationFactor.bind(void 0,P),zoomStops:z.map(j=>j[0]),evaluate:({zoom:j},B)=>Mh({stops:z,base:n.base},e,j).evaluate(j,B)}}if(o){const A=d==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:zr.interpolationFactor.bind(void 0,A),zoomStops:n.stops.map(M=>M[0]),evaluate:({zoom:M})=>p(n,e,M,y,T)}}return{kind:"source",evaluate(A,M){const z=M&&M.properties?M.properties[n.property]:void 0;return z===void 0?ks(n.default,e.default):p(n,e,z,y,T)}}}function ks(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function Cs(n,e,i,a,o){return ks(typeof i===o?a[i]:void 0,n.default,e.default)}function qo(n,e,i){if(!yu(i))return ks(n.default,e.default);const a=n.stops.length;if(a===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[a-1][0])return n.stops[a-1][1];const o=Yl(n.stops.map(d=>d[0]),i);return n.stops[o][1]}function Mh(n,e,i){const a=n.base!==void 0?n.base:1;if(!yu(i))return ks(n.default,e.default);const o=n.stops.length;if(o===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[o-1][0])return n.stops[o-1][1];const d=Yl(n.stops.map(M=>M[0]),i),p=function(M,z,P,j){const B=j-P,W=M-P;return B===0?0:z===1?W/B:(Math.pow(z,W)-1)/(Math.pow(z,B)-1)}(i,a,n.stops[d][0],n.stops[d+1][0]),y=n.stops[d][1],T=n.stops[d+1][1];let A=io[e.type]||Md;if(n.colorSpace&&n.colorSpace!=="rgb"){const M=ml[n.colorSpace];A=(z,P)=>M.reverse(M.interpolate(M.forward(z),M.forward(P),p))}return typeof y.evaluate=="function"?{evaluate(...M){const z=y.evaluate.apply(void 0,M),P=T.evaluate.apply(void 0,M);if(z!==void 0&&P!==void 0)return A(z,P,p)}}:A(y,T,p)}function zf(n,e,i){return e.type==="color"?i=Vn.parse(i):e.type==="formatted"?i=ia.fromString(i.toString()):e.type==="resolvedImage"?i=_a.build(i.toString()):Ni(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),ks(i,n.default,e.default)}ya.register(ec,{error:[{kind:"error"},[Hn],(n,[e])=>{throw new ni(e.evaluate(n))}],typeof:[Hn,[Bn],(n,[e])=>ts(fs(e.evaluate(n)))],"to-rgba":[ta(_i,4),[Ra],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[ta(_i,4),[Ra],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Ra,[_i,_i,_i],Mu],rgba:[Ra,[_i,_i,_i,_i],Mu],hsl:[Ra,[_i,_i,_i],tc],hsla:[Ra,[_i,_i,_i,_i],tc],has:{type:Zn,overloads:[[[Hn],(n,[e])=>Eh(e.evaluate(n),n.properties())],[[Hn,pu],(n,[e,i])=>Eh(e.evaluate(n),i.evaluate(n))]]},get:{type:Bn,overloads:[[[Hn],(n,[e])=>Hc(e.evaluate(n),n.properties())],[[Hn,pu],(n,[e,i])=>Hc(e.evaluate(n),i.evaluate(n))]]},"feature-state":[Bn,[Hn],(n,[e])=>Hc(e.evaluate(n),n.featureState||{})],properties:[pu,[],n=>n.properties()],"geometry-type":[Hn,[],n=>n.geometryType()],worldview:[Hn,[],n=>n.globals.worldview||""],id:[Bn,[],n=>n.id()],zoom:[_i,[],n=>n.globals.zoom],pitch:[_i,[],n=>n.globals.pitch||0],"distance-from-center":[_i,[],n=>n.distanceFromCenter()],"measure-light":[_i,[Hn],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[_i,[],n=>n.globals.heatmapDensity||0],"line-progress":[_i,[],n=>n.globals.lineProgress||0],"raster-value":[_i,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[_i,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[_i,[],n=>n.globals.skyRadialProgress||0],accumulated:[Bn,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[_i,Eo(_i),(n,e)=>{let i=0;for(const a of e)i+=a.evaluate(n);return i}],"*":[_i,Eo(_i),(n,e)=>{let i=1;for(const a of e)i*=a.evaluate(n);return i}],"-":{type:_i,overloads:[[[_i,_i],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[_i],(n,[e])=>-e.evaluate(n)]]},"/":[_i,[_i,_i],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[_i,[_i,_i],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[_i,[],()=>Math.LN2],pi:[_i,[],()=>Math.PI],e:[_i,[],()=>Math.E],"^":[_i,[_i,_i],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[_i,[_i],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[_i,[_i],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[_i,[_i],(n,[e])=>Math.log(e.evaluate(n))],log2:[_i,[_i],(n,[e])=>Math.log2(e.evaluate(n))],sin:[_i,[_i],(n,[e])=>Math.sin(e.evaluate(n))],cos:[_i,[_i],(n,[e])=>Math.cos(e.evaluate(n))],tan:[_i,[_i],(n,[e])=>Math.tan(e.evaluate(n))],asin:[_i,[_i],(n,[e])=>Math.asin(e.evaluate(n))],acos:[_i,[_i],(n,[e])=>Math.acos(e.evaluate(n))],atan:[_i,[_i],(n,[e])=>Math.atan(e.evaluate(n))],min:[_i,Eo(_i),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[_i,Eo(_i),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[_i,[_i],(n,[e])=>Math.abs(e.evaluate(n))],round:[_i,[_i],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[_i,[_i],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[_i,[_i],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Zn,[Hn,Bn],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Zn,[Bn],(n,[e])=>n.id()===e.value],"filter-type-==":[Zn,[Hn],(n,[e])=>n.geometryType()===e.value],"filter-<":[Zn,[Hn,Bn],(n,[e,i])=>{const a=n.properties()[e.value],o=i.value;return typeof a==typeof o&&a<o}],"filter-id-<":[Zn,[Bn],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[Zn,[Hn,Bn],(n,[e,i])=>{const a=n.properties()[e.value],o=i.value;return typeof a==typeof o&&a>o}],"filter-id->":[Zn,[Bn],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[Zn,[Hn,Bn],(n,[e,i])=>{const a=n.properties()[e.value],o=i.value;return typeof a==typeof o&&a<=o}],"filter-id-<=":[Zn,[Bn],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[Zn,[Hn,Bn],(n,[e,i])=>{const a=n.properties()[e.value],o=i.value;return typeof a==typeof o&&a>=o}],"filter-id->=":[Zn,[Bn],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[Zn,[Bn],(n,[e])=>e.value in n.properties()],"filter-has-id":[Zn,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Zn,[ta(Hn)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Zn,[ta(Bn)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Zn,[Hn,ta(Bn)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Zn,[Hn,ta(Bn)],(n,[e,i])=>function(a,o,d,p){for(;d<=p;){const y=d+p>>1;if(o[y]===a)return!0;o[y]>a?p=y-1:d=y+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Zn,overloads:[[[Zn,Zn],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[Eo(Zn),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Zn,overloads:[[[Zn,Zn],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[Eo(Zn),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Zn,[Zn],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Zn,[Hn],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[Hn,[Hn],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Hn,[Hn],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Hn,Eo(Bn),(n,e)=>e.map(i=>Ma(i.evaluate(n))).join("")],"resolved-locale":[Hn,[_f],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[_i,[_i,_i,Bn],(n,e)=>{const[i,a,o]=e.map(p=>p.evaluate(n));if(i>a||i===a)return i;let d;if(typeof o=="string")d=function(p){let y=0;if(p.length===0)return y;for(let T=0;T<p.length;T++)y=(y<<5)-y+p.charCodeAt(T),y|=0;return y}(o);else{if(typeof o!="number")throw new ni(`Invalid seed input: ${o}`);d=o}return i+ps(d)()*(a-i)}]});class Ih{constructor(e,i,a,o,d){this.expression=e,this._warningHistory={},this._evaluator=new ql(a,o,d),this._defaultValue=i?function(p){return p.type==="color"&&(Ch(p.default)||Array.isArray(p.default))?new Vn(0,0,0,0):p.type==="color"?Vn.parse(p.default)||null:p.default===void 0?null:p.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=kc(e)}evaluateWithoutErrorHandling(e,i,a,o,d,p,y,T){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=o||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,o,d,p,y,T,A){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=o||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=T||null,this._evaluator.iconImageUseTheme=A||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new ni(`Expected value to be one of ${Object.keys(this._enumValues).map(z=>JSON.stringify(z)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${M.message}`)),this._defaultValue}}}function Go(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in ec}function so(n,e,i,a,o){const d=new Nc(ec,[],e?function(y){const T={color:Ra,string:Hn,number:_i,enum:Hn,boolean:Zn,formatted:Ic,resolvedImage:ud};return y.type==="array"?ta(T[y.value]||Bn,y.length):T[y.type]}(e):void 0,void 0,void 0,i,a,o),p=d.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Iu(new Ih(p,e,i,a,o)):Hr(d.errors)}class zu{constructor(e,i,a,o){this.kind=e,this._styleExpression=i,this.isLightConstant=a,this.isLineProgressConstant=o,this.isStateDependent=e!=="constant"&&!Oc(i.expression),this.configDependencies=kc(i.expression)}evaluateWithoutErrorHandling(e,i,a,o,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,o,d,p)}evaluate(e,i,a,o,d,p,y){return this._styleExpression.evaluate(e,i,a,o,d,p,void 0,void 0,y)}}class yl{constructor(e,i,a,o,d,p){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Oc(i.expression),this.isLightConstant=d,this.isLineProgressConstant=p,this.configDependencies=kc(i.expression),this.interpolationType=o}evaluateWithoutErrorHandling(e,i,a,o,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,o,d,p)}evaluate(e,i,a,o,d,p){return this._styleExpression.evaluate(e,i,a,o,d,p)}interpolationFactor(e,i,a){return this.interpolationType?zr.interpolationFactor(this.interpolationType,e,i,a):0}}function Df(n,e,i,a,o){if((n=so(n,e,i,a,o)).result==="error")return n;const d=n.value.expression,p=dl(d);if(!p&&!Ah(e))return Hr([new Bo("","data expressions not supported")]);const y=fl(d,["zoom","pitch","distance-from-center"]);if(!y&&!Mf(e))return Hr([new Bo("","zoom expressions not supported")]);const T=fl(d,["measure-light"]);if(!T&&!Rf(e))return Hr([new Bo("","measure-light expression not supported")]);const A=fl(d,["line-progress"]);if(!A&&!function(P){return Rd(P.expression,"line-progress")}(e))return Hr([new Bo("","line-progress expression not supported")]);const M=e.expression&&e.expression.relaxZoomRestriction,z=zd(d);return z||y||M?z instanceof Bo?Hr([z]):z instanceof zr&&!If(e)?Hr([new Bo("",'"interpolate" expressions cannot be used with this property')]):Iu(z?new yl(p&&A?"camera":"composite",n.value,z.labels,z instanceof zr?z.interpolation:void 0,T,A):new zu(p&&A?"constant":"source",n.value,T,A)):Hr([new Bo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Id{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,Rh(this._parameters,this._specification))}static deserialize(e){return new Id(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function zd(n){let e=null;if(n instanceof Af)e=zd(n.result);else if(n instanceof Ad){for(const i of n.args)if(e=zd(i),e)break}else(n instanceof Kl||n instanceof zr)&&n.input instanceof ya&&n.input.name==="zoom"&&(e=n);return e instanceof Bo||n.eachChild(i=>{const a=zd(i);a instanceof Bo?e=a:e&&a&&e!==a&&(e=new Bo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var zh,Dd,Bp=function(){if(Dd)return zh;Dd=1,zh=e;var n=3;function e(i,a,o){var d=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var p=new Int32Array(this.arrayBuffer);i=p[0],this.d=(a=p[1])+2*(o=p[2]);for(var y=0;y<this.d*this.d;y++){var T=p[n+y],A=p[n+y+1];d.push(T===A?null:p.subarray(T,A))}var M=p[n+d.length+1];this.keys=p.subarray(p[n+d.length],M),this.bboxes=p.subarray(M),this.insert=this._insertReadonly}else{this.d=a+2*o;for(var z=0;z<this.d*this.d;z++)d.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=i,this.padding=o,this.scale=a/i,this.uid=0;var P=o/a*i;this.min=-P,this.max=i+P}return e.prototype.insert=function(i,a,o,d,p){this._forEachCell(a,o,d,p,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(a),this.bboxes.push(o),this.bboxes.push(d),this.bboxes.push(p)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,a,o,d,p,y){this.cells[p].push(y)},e.prototype.query=function(i,a,o,d,p){var y=this.min,T=this.max;if(i<=y&&a<=y&&T<=o&&T<=d&&!p)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(i,a,o,d,this._queryCell,A,{},p),A},e.prototype._queryCell=function(i,a,o,d,p,y,T,A){var M=this.cells[p];if(M!==null)for(var z=this.keys,P=this.bboxes,j=0;j<M.length;j++){var B=M[j];if(T[B]===void 0){var W=4*B;(A?A(P[W+0],P[W+1],P[W+2],P[W+3]):i<=P[W+2]&&a<=P[W+3]&&o>=P[W+0]&&d>=P[W+1])?(T[B]=!0,y.push(z[B])):T[B]=!1}}},e.prototype._forEachCell=function(i,a,o,d,p,y,T,A){for(var M=this._convertToCellCoord(i),z=this._convertToCellCoord(a),P=this._convertToCellCoord(o),j=this._convertToCellCoord(d),B=M;B<=P;B++)for(var W=z;W<=j;W++){var Y=this.d*W+B;if((!A||A(this._convertFromCellCoord(B),this._convertFromCellCoord(W),this._convertFromCellCoord(B+1),this._convertFromCellCoord(W+1)))&&p.call(this,i,a,o,d,Y,y,T,A))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,a=n+this.cells.length+1+1,o=0,d=0;d<this.cells.length;d++)o+=this.cells[d].length;var p=new Int32Array(a+o+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var y=a,T=0;T<i.length;T++){var A=i[T];p[n+T]=y,p.set(A,y),y+=A.length}return p[n+i.length]=y,p.set(this.keys,y),p[n+i.length+1]=y+=this.keys.length,p.set(this.bboxes,y),y+=this.bboxes.length,p.buffer},zh}(),ic=Ur(Bp);const Du={};function ri(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),Du[e]={klass:n,omit:i.omit||[]}}ri(Object,"Object"),ic.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.add(i),{buffer:i}},ic.deserialize=function(n){return new ic(n.buffer)},Object.defineProperty(ic,"name",{value:"Grid"}),ri(ic,"Grid"),delete Mt.prototype.constructor,typeof DOMMatrix<"u"&&ri(DOMMatrix,"DOMMatrix"),ri(Vn,"Color"),ri(Error,"Error"),ri(ia,"Formatted"),ri(pd,"FormattedSection"),ri(ff,"AJAXError"),ri(_a,"ResolvedImage"),ri(Id,"StylePropertyFunction"),ri(Ih,"StyleExpression",{omit:["_evaluator"]}),ri(to,"ImageId"),ri(vo,"ImageVariant"),ri(yl,"ZoomDependentExpression"),ri(zu,"ZoomConstantExpression"),ri(ya,"CompoundExpression",{omit:["_evaluate"]});for(const n in ec)Du[ec[n]._classRegistryKey]||ri(ec[n],`Expression${n}`);function Pf(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function xl(n){return self.ImageBitmap&&n instanceof ImageBitmap}function nc(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Pf(n)||xl(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n))return e&&e.add(n.buffer),n;if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const a of n)i.push(nc(a,e));return i}if(n instanceof Map){const i={$name:"Map",entries:[]};for(const[a,o]of n.entries())i.entries.push(nc(a),nc(o,e));return i}if(n instanceof Set){const i={$name:"Set"};let a=0;for(const o of n.values())i[++a]=nc(o);return i}if(n instanceof DOMMatrix){const i={$name:"DOMMatrix"},a=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const o of a)i[o]=n[o];return i}if(typeof n=="bigint")return{$name:"BigInt",value:n.toString()};if(typeof n=="object"){const i=n.constructor,a=i._classRegistryKey;if(!a)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const o=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const d in n)n.hasOwnProperty(d)&&(Du[a].omit.indexOf(d)>=0||(o[d]=nc(n[d],e)));n instanceof Error&&(o.message=n.message)}if(o.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(o.$name=a),o}throw new Error("can't serialize object of type "+typeof n)}function vl(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Pf(n)||xl(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(vl);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const o=n.entries||[],d=new Map;for(let p=0;p<o.length;p+=2)d.set(vl(o[p]),vl(o[p+1]));return d}if(e==="Set"){const o=new Set;for(const d of Object.keys(n))d!=="$name"&&o.add(vl(n[d]));return o}if(e==="DOMMatrix"){let o;return o=n.is2D?[n.a,n.b,n.c,n.d,n.e,n.f]:[n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44],new DOMMatrix(o)}if(e==="BigInt")return BigInt(n.value);const{klass:i}=Du[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(n);const a=Object.create(i.prototype);for(const o of Object.keys(n))o!=="$name"&&(a[o]=vl(n[o]));return a}throw new Error("can't deserialize object of type "+typeof n)}const Ri={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,Osage:n=>n>=66736&&n<=66815,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function Lf(n){for(const e of n)if(Ld(e.charCodeAt(0)))return!0;return!1}function Fp(n){for(const e of n)if(!Pd(e.charCodeAt(0)))return!1;return!0}function Pd(n){return!(Ri.Arabic(n)||Ri["Arabic Supplement"](n)||Ri["Arabic Extended-A"](n)||Ri["Arabic Presentation Forms-A"](n)||Ri["Arabic Presentation Forms-B"](n))}function Ld(n){return!(n!==746&&n!==747&&(n<4352||!(Ri["Bopomofo Extended"](n)||Ri.Bopomofo(n)||Ri["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Ri["CJK Compatibility Ideographs"](n)||Ri["CJK Compatibility"](n)||Ri["CJK Radicals Supplement"](n)||Ri["CJK Strokes"](n)||!(!Ri["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Ri["CJK Unified Ideographs Extension A"](n)||Ri["CJK Unified Ideographs"](n)||Ri["Enclosed CJK Letters and Months"](n)||Ri["Hangul Compatibility Jamo"](n)||Ri["Hangul Jamo Extended-A"](n)||Ri["Hangul Jamo Extended-B"](n)||Ri["Hangul Jamo"](n)||Ri["Hangul Syllables"](n)||Ri.Hiragana(n)||Ri["Ideographic Description Characters"](n)||Ri.Kanbun(n)||Ri["Kangxi Radicals"](n)||Ri["Katakana Phonetic Extensions"](n)||Ri.Katakana(n)&&n!==12540||!(!Ri["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Ri["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Ri["Unified Canadian Aboriginal Syllabics"](n)||Ri["Unified Canadian Aboriginal Syllabics Extended"](n)||Ri["Vertical Forms"](n)||Ri["Yijing Hexagram Symbols"](n)||Ri["Yi Syllables"](n)||Ri["Yi Radicals"](n))))}function Of(n){return!(Ld(n)||function(e){return!!(Ri["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ri["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ri["Letterlike Symbols"](e)||Ri["Number Forms"](e)||Ri["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ri["Control Pictures"](e)&&e!==9251||Ri["Optical Character Recognition"](e)||Ri["Enclosed Alphanumerics"](e)||Ri["Geometric Shapes"](e)||Ri["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ri["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ri["CJK Symbols and Punctuation"](e)||Ri.Katakana(e)||Ri["Private Use Area"](e)||Ri["CJK Compatibility Forms"](e)||Ri["Small Form Variants"](e)||Ri["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function qm(n){return Ri.Arabic(n)||Ri["Arabic Supplement"](n)||Ri["Arabic Extended-A"](n)||Ri["Arabic Presentation Forms-A"](n)||Ri["Arabic Presentation Forms-B"](n)}function Pu(n){return n>=1424&&n<=2303||Ri["Arabic Presentation Forms-A"](n)||Ri["Arabic Presentation Forms-B"](n)}function Gm(n,e){return!(!e&&Pu(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Ri.Khmer(n))}function kf(n){for(const e of n)if(Pu(e.charCodeAt(0)))return!0;return!1}const ra={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Nf=null,qs=ra.unavailable,rc=null;const Up=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(qs=ra.error),Nf&&Nf(n)};function jf(){Bf.fire(new eo("pluginStateChange",{pluginStatus:qs,pluginURL:rc}))}const Bf=new fu,Dh=function(){return qs},qc=function(){if(qs!==ra.deferred||!rc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");qs=ra.loading,jf(),rc&&cl({url:rc},n=>{n?Up(n):(qs=ra.loaded,jf())})},$o={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>qs===ra.loaded||$o.applyArabicShaping!=null,isLoading:()=>qs===ra.loading,setState(n){qs=n.pluginStatus,rc=n.pluginURL},isParsing:()=>qs===ra.parsing,isParsed:()=>qs===ra.parsed,getPluginURL:()=>rc};class ir{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,a){for(const o of i)if(!Gm(o.charCodeAt(0),a))return!1;return!0}(e,$o.isLoaded())}}class Gc{constructor(e,i,a,o,d){this.property=e,this.value=i,this.expression=function(p,y,T,A,M){if(Ch(p))return new Id(p,y);if(Go(p)||Array.isArray(p)&&p.length>0){const z=Df(p,y,T,A,M);if(z.result==="error")throw new Error(z.value.map(P=>`${P.key}: ${P.message}`).join(", "));return z.value}{let z=p;return typeof p=="string"&&y.type==="color"&&(z=Vn.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>z}}}(i===void 0?e.specification.default:i,e.specification,a,o,d)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,a,o){return this.property.possiblyEvaluate(this,e,i,a,o)}}class Ff{constructor(e,i,a,o){this.property=e,this.value=new Gc(e,void 0,i,a,o)}transitioned(e,i){return new Zo(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Zo(this.property,this.value,null,{},0)}}class $m{constructor(e,i,a,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=a,this._iconImageUseTheme=o,this.configDependencies=new Set}getValue(e){return rn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ff(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Gc(this._values[e].property,i===null?void 0:rn(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const a=this._properties.properties;if(e)for(const o in e){const d=e[o];if(o.endsWith("-transition")){const p=o.slice(0,-11);a[p]&&this.setTransition(p,d)}else a.hasOwnProperty(o)&&this.setValue(o,d)}}getTransition(e){return rn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ff(this._values[e].property)),this._values[e].transition=rn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a);const o=this.getTransition(i);o!==void 0&&(e[`${i}-transition`]=o)}return e}transitioned(e,i){const a=new Uf(this._properties);for(const o of Object.keys(this._values))a._values[o]=this._values[o].transitioned(e,i._values[o]);return a}untransitioned(){const e=new Uf(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Zo{constructor(e,i,a,o,d){const p=o.delay||0,y=o.duration||0;d=d||0,this.property=e,this.value=i,this.begin=d+p,this.end=this.begin+y,e.specification.transition&&(o.delay||o.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){const o=e.now||0,d=this.value.possiblyEvaluate(e,i,a),p=this.prior;if(p){if(o>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(o<this.begin)return p.possiblyEvaluate(e,i,a);{const y=(o-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,a),d,_e(y))}}return d}}class Uf{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){const o=new Zc(this._properties);for(const d of Object.keys(this._values))o._values[d]=this._values[d].possiblyEvaluate(e,i,a);return o}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class $c{constructor(e,i,a,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=a,this._iconImageUseTheme=o,this.configDependencies=new Set}getValue(e){return rn(this._values[e].value)}setValue(e,i){this._values[e]=new Gc(this._values[e].property,i===null?void 0:rn(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a)}return e}possiblyEvaluate(e,i,a,o){const d=new Zc(this._properties);for(const p of Object.keys(this._values))d._values[p]=this._values[p].possiblyEvaluate(e,i,a,o);return d}}class sc{constructor(e,i,a,o){this.property=e,this.value=i,this.parameters=a,this.iconImageUseTheme=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,a,o){return this.property.evaluate(this.value,this.parameters,e,i,a,o,this.iconImageUseTheme)}}class Zc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class kt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,a){const o=io[this.specification.type];return o?o(e,i,a):e}}class Yt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,o,d){return e.expression.kind==="constant"||e.expression.kind==="camera"?new sc(this,{kind:"constant",value:e.expression.evaluate(i,null,{},a,o,void 0,d)},i):new sc(this,e.expression,i,d)}interpolate(e,i,a){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new sc(this,{kind:"constant",value:void 0},e.parameters);const o=io[this.specification.type];return o?new sc(this,{kind:"constant",value:o(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,o,d,p,y){return e.kind==="constant"?e.value:e.evaluate(i,a,o,d,p,void 0,y)}}class Ph{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,o){return!!e.expression.evaluate(i,null,{},a,o)}interpolate(){return!1}}class Rr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new ir(0,{});for(const a in e){const o=e[a];o.specification.overridable&&this.overridableProperties.push(a);const d=this.defaultPropertyValues[a]=new Gc(o,void 0),p=this.defaultTransitionablePropertyValues[a]=new Ff(o);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate(i)}}}ri(Yt,"DataDrivenProperty"),ri(kt,"DataConstantProperty"),ri(Ph,"ColorRampProperty");var qe=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Lh(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function bl(n){if(Array.isArray(n))return n.map(bl);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=bl(n[i]);return e}return Lh(n)}function Od(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Od(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Oh(n,e="",i=null,a="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Od(n)||(n=kd(n));const o=n;let d=!0;try{d=function(M){if(!ao(M))return M;let z=bl(M);return sa(z),z=Wo(z),z}(o)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(o,null,2)}
        `)}let p=null,y=null;if(a!=="background"&&a!=="sky"&&a!=="slot"){y=qe[`filter_${a}`];const M=so(d,y,e,i);if(M.result==="error")throw new Error(M.value.map(z=>`${z.key}: ${z.message}`).join(", "));p=(z,P,j)=>M.value.evaluate(z,P,{},j)}let T=null,A=null;if(d!==o){const M=so(o,y,e,i);if(M.result==="error")throw new Error(M.value.map(z=>`${z.key}: ${z.message}`).join(", "));T=(z,P,j,B,W)=>M.value.evaluate(z,P,{},j,void 0,void 0,B,W),A=!dl(M.value.expression)}return{filter:p,dynamicFilter:T||void 0,needGeometry:Vf(d),needFeature:!!A}}function Wo(n){if(!Array.isArray(n))return n;const e=function(i){if(Wc.has(i[0])){for(let a=1;a<i.length;a++)if(ao(i[a]))return!0}return i}(n);return e===!0?e:e.map(i=>Wo(i))}function sa(n){let e=!1;const i=[];if(n[0]==="case"){for(let a=1;a<n.length-1;a+=2)e=e||ao(n[a]),i.push(n[a+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||ao(n[1]);for(let a=2;a<n.length-1;a+=2)i.push(n[a+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||ao(n[1]);for(let a=1;a<n.length-1;a+=2)i.push(n[a+1])}e&&(n.length=0,n.push("any",...i));for(let a=1;a<n.length;a++)sa(n[a])}function ao(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(ao(n[i]))return!0;return!1}const Wc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Vp(n,e){return n<e?-1:n>e?1:0}function Vf(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(Vf(n[e]))return!0;return!1}function kd(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Hf(n[1],n[2],"=="):e==="!="?jd(Hf(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Hf(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(kd))):e==="all"?["all"].concat(n.slice(1).map(kd)):e==="none"?["all"].concat(n.slice(1).map(kd).map(jd)):e==="in"?Xc(n[1],n.slice(2)):e==="!in"?jd(Xc(n[1],n.slice(2))):e==="has"?Nd(n[1]):e!=="!has"||jd(Nd(n[1]));var i}function Hf(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function Xc(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Vp)]]:["filter-in-small",n,["literal",e]]}}function Nd(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function jd(n){return["!",n]}const kh="";function Lu(n,e){return e?`${n}${kh}${e}`:n}let Nh;const Hp=()=>Nh||(Nh=new Rr({"icon-size":new Yt(qe.layout_symbol["icon-size"]),"icon-image":new Yt(qe.layout_symbol["icon-image"]),"icon-rotate":new Yt(qe.layout_symbol["icon-rotate"]),"icon-offset":new Yt(qe.layout_symbol["icon-offset"])}));class qp{constructor(e,i,a,o,d,p){const y=so(e,qe.appearance.condition);if(y.result==="success"&&(this.condition=y.value),this.name=i,a){this.properties=new Zc(Hp()),this.unevaluatedLayout=new $c(Hp(),o,d,p);for(const T in a)this.unevaluatedLayout.setValue(T,a[T])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.properties&&(e.properties=this.properties),e}}const Gp="-transition",$p=new Set(["fill","line","background","hillshade","raster"]);class aa extends fu{constructor(e,i,a,o,d,p){if(super(),this.id=e.id,this.fqid=Lu(this.id,a),this.type=e.type,this.scope=a,this.lut=o,this.options=d,this.iconImageUseTheme=p,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const y=so(this.filter,qe[`filter_${e.type}`]);y.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...y.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),e.appearances&&e.appearances.forEach(y=>{this.appearances.push(new qp(y.condition,y.name,y.properties,this.scope,d,this.iconImageUseTheme))}),i.layout&&(this._unevaluatedLayout=new $c(i.layout,this.scope,d,this.iconImageUseTheme),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new $m(i.paint,this.scope,d);for(const y in e.paint)this.setPaintProperty(y,e.paint[y]);for(const y in e.layout)this.setLayoutProperty(y,e.layout[y]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Zc(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&$p.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Gp)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const a=this._transitionablePaint,o=a._properties.properties;if(e.endsWith(Gp)){const z=e.slice(0,-11);return o[z]&&a.setTransition(z,i||void 0),!1}if(!o[e])return!1;const d=a._values[e],p=d.value.isDataDriven(),y=d.value;a.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const T=a._values[e].value,A=T.isDataDriven(),M=e.endsWith("pattern")||e==="line-dasharray";return A||p||M||this._handleOverridablePaintPropertyUpdate(e,y,T)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,a){return null}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(i=>i.serialize())),on(e,(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof sc&&Ah(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Oh(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRadius(e){}queryIntersectsFeature(e,i,a,o,d,p,y,T,A){}}const ac={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ls{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class En{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function yn(n,e=1){let i=0,a=0;return{members:n.map(o=>{const d=ac[o.type].BYTES_PER_ELEMENT,p=i=Zp(i,Math.max(e,d)),y=o.components||1;return a=Math.max(a,d),i+=d*y,{name:o.name,type:o.type,components:y,offset:p}}),size:Zp(i,Math.max(a,e)),alignment:e}}function Zp(n,e){return Math.ceil(n/e)*e}class oc extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const o=2*e;return this.int16[o+0]=i,this.int16[o+1]=a,e}}oc.prototype.bytesPerElement=4,ri(oc,"StructArrayLayout2i4");class Yc extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,i,a)}emplace(e,i,a,o){const d=3*e;return this.int16[d+0]=i,this.int16[d+1]=a,this.int16[d+2]=o,e}}Yc.prototype.bytesPerElement=6,ri(Yc,"StructArrayLayout3i6");class Kc extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,o){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,o)}emplace(e,i,a,o,d){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=a,this.int16[p+2]=o,this.int16[p+3]=d,e}}Kc.prototype.bytesPerElement=8,ri(Kc,"StructArrayLayout4i8");class Ao extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Ao.prototype.bytesPerElement=4,ri(Ao,"StructArrayLayout1f4");class Bd extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,i,a)}emplace(e,i,a,o){const d=4*e,p=2*e;return this.int16[d+0]=i,this.int16[d+1]=a,this.float32[p+1]=o,e}}Bd.prototype.bytesPerElement=8,ri(Bd,"StructArrayLayout2i1f8");class Fd extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,i,a)}emplace(e,i,a,o){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=a,this.int16[d+2]=o,e}}Fd.prototype.bytesPerElement=8,ri(Fd,"StructArrayLayout3i8");class qf extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,o,d)}emplace(e,i,a,o,d,p){const y=5*e;return this.int16[y+0]=i,this.int16[y+1]=a,this.int16[y+2]=o,this.int16[y+3]=d,this.int16[y+4]=p,e}}qf.prototype.bytesPerElement=10,ri(qf,"StructArrayLayout5i10");class Ud extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,y){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,a,o,d,p,y)}emplace(e,i,a,o,d,p,y,T){const A=6*e,M=12*e,z=3*e;return this.int16[A+0]=i,this.int16[A+1]=a,this.uint8[M+4]=o,this.uint8[M+5]=d,this.uint8[M+6]=p,this.uint8[M+7]=y,this.float32[z+2]=T,e}}Ud.prototype.bytesPerElement=12,ri(Ud,"StructArrayLayout2i4ub1f12");class oa extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,i,a)}emplace(e,i,a,o){const d=3*e;return this.float32[d+0]=i,this.float32[d+1]=a,this.float32[d+2]=o,e}}oa.prototype.bytesPerElement=12,ri(oa,"StructArrayLayout3f12");class wl extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,o,d)}emplace(e,i,a,o,d,p){const y=6*e,T=3*e;return this.uint16[y+0]=i,this.uint16[y+1]=a,this.uint16[y+2]=o,this.uint16[y+3]=d,this.float32[T+2]=p,e}}wl.prototype.bytesPerElement=12,ri(wl,"StructArrayLayout4ui1f12");class Jc extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,o){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,o)}emplace(e,i,a,o,d){const p=4*e;return this.uint16[p+0]=i,this.uint16[p+1]=a,this.uint16[p+2]=o,this.uint16[p+3]=d,e}}Jc.prototype.bytesPerElement=8,ri(Jc,"StructArrayLayout4ui8");class Vd extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,o,d,p)}emplace(e,i,a,o,d,p,y){const T=6*e;return this.int16[T+0]=i,this.int16[T+1]=a,this.int16[T+2]=o,this.int16[T+3]=d,this.int16[T+4]=p,this.int16[T+5]=y,e}}Vd.prototype.bytesPerElement=12,ri(Vd,"StructArrayLayout6i12");class Hd extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,y,T,A,M,z,P){const j=this.length;return this.resize(j+1),this.emplace(j,e,i,a,o,d,p,y,T,A,M,z,P)}emplace(e,i,a,o,d,p,y,T,A,M,z,P,j){const B=12*e;return this.int16[B+0]=i,this.int16[B+1]=a,this.int16[B+2]=o,this.int16[B+3]=d,this.uint16[B+4]=p,this.uint16[B+5]=y,this.uint16[B+6]=T,this.uint16[B+7]=A,this.int16[B+8]=M,this.int16[B+9]=z,this.int16[B+10]=P,this.int16[B+11]=j,e}}Hd.prototype.bytesPerElement=24,ri(Hd,"StructArrayLayout4i4ui4i24");class qd extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,o,d,p)}emplace(e,i,a,o,d,p,y){const T=10*e,A=5*e;return this.int16[T+0]=i,this.int16[T+1]=a,this.int16[T+2]=o,this.float32[A+2]=d,this.float32[A+3]=p,this.float32[A+4]=y,e}}qd.prototype.bytesPerElement=20,ri(qd,"StructArrayLayout3i3f20");class oo extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,o)}emplace(e,i,a,o,d){const p=4*e;return this.float32[p+0]=i,this.float32[p+1]=a,this.float32[p+2]=o,this.float32[p+3]=d,e}}oo.prototype.bytesPerElement=16,ri(oo,"StructArrayLayout4f16");class Ou extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Ou.prototype.bytesPerElement=4,ri(Ou,"StructArrayLayout1ul4");class Kr extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const o=2*e;return this.uint16[o+0]=i,this.uint16[o+1]=a,e}}Kr.prototype.bytesPerElement=4,ri(Kr,"StructArrayLayout2ui4");class ku extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,y,T,A,M,z,P,j){const B=this.length;return this.resize(B+1),this.emplace(B,e,i,a,o,d,p,y,T,A,M,z,P,j)}emplace(e,i,a,o,d,p,y,T,A,M,z,P,j,B){const W=20*e,Y=10*e;return this.int16[W+0]=i,this.int16[W+1]=a,this.int16[W+2]=o,this.int16[W+3]=d,this.int16[W+4]=p,this.float32[Y+3]=y,this.float32[Y+4]=T,this.float32[Y+5]=A,this.float32[Y+6]=M,this.int16[W+14]=z,this.uint32[Y+8]=P,this.uint16[W+18]=j,this.uint16[W+19]=B,e}}ku.prototype.bytesPerElement=40,ri(ku,"StructArrayLayout5i4f1i1ul2ui40");class Co extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,y){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,a,o,d,p,y)}emplace(e,i,a,o,d,p,y,T){const A=8*e;return this.int16[A+0]=i,this.int16[A+1]=a,this.int16[A+2]=o,this.int16[A+4]=d,this.int16[A+5]=p,this.int16[A+6]=y,this.int16[A+7]=T,e}}Co.prototype.bytesPerElement=16,ri(Co,"StructArrayLayout3i2i2i16");class Gd extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,o,d)}emplace(e,i,a,o,d,p){const y=4*e,T=8*e;return this.float32[y+0]=i,this.float32[y+1]=a,this.float32[y+2]=o,this.int16[T+6]=d,this.int16[T+7]=p,e}}Gd.prototype.bytesPerElement=16,ri(Gd,"StructArrayLayout2f1f2i16");class Wp extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,o,d,p)}emplace(e,i,a,o,d,p,y){const T=20*e,A=5*e;return this.uint8[T+0]=i,this.uint8[T+1]=a,this.float32[A+1]=o,this.float32[A+2]=d,this.float32[A+3]=p,this.float32[A+4]=y,e}}Wp.prototype.bytesPerElement=20,ri(Wp,"StructArrayLayout2ub4f20");class is extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,i,a)}emplace(e,i,a,o){const d=3*e;return this.uint16[d+0]=i,this.uint16[d+1]=a,this.uint16[d+2]=o,e}}is.prototype.bytesPerElement=6,ri(is,"StructArrayLayout3ui6");class Nu extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,y,T,A,M,z,P,j,B,W,Y,K,re,se,ue,Re){const Me=this.length;return this.resize(Me+1),this.emplace(Me,e,i,a,o,d,p,y,T,A,M,z,P,j,B,W,Y,K,re,se,ue,Re)}emplace(e,i,a,o,d,p,y,T,A,M,z,P,j,B,W,Y,K,re,se,ue,Re,Me){const Ne=30*e,Fe=15*e,Ue=60*e;return this.int16[Ne+0]=i,this.int16[Ne+1]=a,this.int16[Ne+2]=o,this.float32[Fe+2]=d,this.float32[Fe+3]=p,this.uint16[Ne+8]=y,this.uint16[Ne+9]=T,this.uint32[Fe+5]=A,this.uint32[Fe+6]=M,this.uint32[Fe+7]=z,this.uint16[Ne+16]=P,this.uint16[Ne+17]=j,this.uint16[Ne+18]=B,this.float32[Fe+10]=W,this.float32[Fe+11]=Y,this.uint8[Ue+48]=K,this.uint8[Ue+49]=re,this.uint8[Ue+50]=se,this.uint32[Fe+13]=ue,this.int16[Ne+28]=Re,this.uint8[Ue+58]=Me,e}}Nu.prototype.bytesPerElement=60,ri(Nu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class lc extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,y,T,A,M,z,P,j,B,W,Y,K,re,se,ue,Re,Me,Ne,Fe,Ue,pt,$e,yt,It,bt,Et,Ot,dt){const At=this.length;return this.resize(At+1),this.emplace(At,e,i,a,o,d,p,y,T,A,M,z,P,j,B,W,Y,K,re,se,ue,Re,Me,Ne,Fe,Ue,pt,$e,yt,It,bt,Et,Ot,dt)}emplace(e,i,a,o,d,p,y,T,A,M,z,P,j,B,W,Y,K,re,se,ue,Re,Me,Ne,Fe,Ue,pt,$e,yt,It,bt,Et,Ot,dt,At){const at=20*e,tt=40*e,Nt=80*e;return this.float32[at+0]=i,this.float32[at+1]=a,this.int16[tt+4]=o,this.int16[tt+5]=d,this.int16[tt+6]=p,this.int16[tt+7]=y,this.int16[tt+8]=T,this.int16[tt+9]=A,this.int16[tt+10]=M,this.int16[tt+11]=z,this.int16[tt+12]=P,this.uint16[tt+13]=j,this.uint16[tt+14]=B,this.uint16[tt+15]=W,this.uint16[tt+16]=Y,this.uint16[tt+17]=K,this.uint16[tt+18]=re,this.uint16[tt+19]=se,this.uint16[tt+20]=ue,this.uint16[tt+21]=Re,this.uint16[tt+22]=Me,this.uint16[tt+23]=Ne,this.uint16[tt+24]=Fe,this.uint16[tt+25]=Ue,this.uint16[tt+26]=pt,this.uint16[tt+27]=$e,this.uint32[at+14]=yt,this.float32[at+15]=It,this.float32[at+16]=bt,this.float32[at+17]=Et,this.float32[at+18]=Ot,this.uint8[Nt+76]=dt,this.uint16[tt+39]=At,e}}lc.prototype.bytesPerElement=80,ri(lc,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class lo extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,o,d,p)}emplace(e,i,a,o,d,p,y){const T=6*e;return this.float32[T+0]=i,this.float32[T+1]=a,this.float32[T+2]=o,this.float32[T+3]=d,this.float32[T+4]=p,this.float32[T+5]=y,e}}lo.prototype.bytesPerElement=24,ri(lo,"StructArrayLayout6f24");class qa extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,o,d)}emplace(e,i,a,o,d,p){const y=5*e;return this.float32[y+0]=i,this.float32[y+1]=a,this.float32[y+2]=o,this.float32[y+3]=d,this.float32[y+4]=p,e}}qa.prototype.bytesPerElement=20,ri(qa,"StructArrayLayout5f20");class Xo extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,y){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,a,o,d,p,y)}emplace(e,i,a,o,d,p,y,T){const A=7*e;return this.float32[A+0]=i,this.float32[A+1]=a,this.float32[A+2]=o,this.float32[A+3]=d,this.float32[A+4]=p,this.float32[A+5]=y,this.float32[A+6]=T,e}}Xo.prototype.bytesPerElement=28,ri(Xo,"StructArrayLayout7f28");class jh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,y,T,A,M,z){const P=this.length;return this.resize(P+1),this.emplace(P,e,i,a,o,d,p,y,T,A,M,z)}emplace(e,i,a,o,d,p,y,T,A,M,z,P){const j=11*e;return this.float32[j+0]=i,this.float32[j+1]=a,this.float32[j+2]=o,this.float32[j+3]=d,this.float32[j+4]=p,this.float32[j+5]=y,this.float32[j+6]=T,this.float32[j+7]=A,this.float32[j+8]=M,this.float32[j+9]=z,this.float32[j+10]=P,e}}jh.prototype.bytesPerElement=44,ri(jh,"StructArrayLayout11f44");class ju extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,y,T,A){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,a,o,d,p,y,T,A)}emplace(e,i,a,o,d,p,y,T,A,M){const z=9*e;return this.float32[z+0]=i,this.float32[z+1]=a,this.float32[z+2]=o,this.float32[z+3]=d,this.float32[z+4]=p,this.float32[z+5]=y,this.float32[z+6]=T,this.float32[z+7]=A,this.float32[z+8]=M,e}}ju.prototype.bytesPerElement=36,ri(ju,"StructArrayLayout9f36");class Tl extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const o=2*e;return this.float32[o+0]=i,this.float32[o+1]=a,e}}Tl.prototype.bytesPerElement=8,ri(Tl,"StructArrayLayout2f8");class Bu extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,o){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,o)}emplace(e,i,a,o,d){const p=6*e;return this.uint32[3*e+0]=i,this.uint16[p+2]=a,this.uint16[p+3]=o,this.uint16[p+4]=d,e}}Bu.prototype.bytesPerElement=12,ri(Bu,"StructArrayLayout1ul3ui12");class Sl extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Sl.prototype.bytesPerElement=2,ri(Sl,"StructArrayLayout1ui2");class Gs extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,y,T,A,M,z,P,j,B,W,Y){const K=this.length;return this.resize(K+1),this.emplace(K,e,i,a,o,d,p,y,T,A,M,z,P,j,B,W,Y)}emplace(e,i,a,o,d,p,y,T,A,M,z,P,j,B,W,Y,K){const re=16*e;return this.float32[re+0]=i,this.float32[re+1]=a,this.float32[re+2]=o,this.float32[re+3]=d,this.float32[re+4]=p,this.float32[re+5]=y,this.float32[re+6]=T,this.float32[re+7]=A,this.float32[re+8]=M,this.float32[re+9]=z,this.float32[re+10]=P,this.float32[re+11]=j,this.float32[re+12]=B,this.float32[re+13]=W,this.float32[re+14]=Y,this.float32[re+15]=K,e}}Gs.prototype.bytesPerElement=64,ri(Gs,"StructArrayLayout16f64");class cc extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,o,d,p,y){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,a,o,d,p,y)}emplace(e,i,a,o,d,p,y,T){const A=10*e,M=5*e;return this.uint16[A+0]=i,this.uint16[A+1]=a,this.uint16[A+2]=o,this.uint16[A+3]=d,this.float32[M+2]=p,this.float32[M+3]=y,this.float32[M+4]=T,e}}cc.prototype.bytesPerElement=20,ri(cc,"StructArrayLayout4ui3f20");class Fu extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Fu.prototype.bytesPerElement=2,ri(Fu,"StructArrayLayout1i2");class Yo extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Yo.prototype.bytesPerElement=1,ri(Yo,"StructArrayLayout1ub1");class Gf extends ls{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Gf.prototype.size=40;class $d extends ku{get(e){return new Gf(this,e)}}ri($d,"CollisionBoxArray");class uc extends ls{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}uc.prototype.size=60;class Ko extends Nu{get(e){return new uc(this,e)}}ri(Ko,"PlacedSymbolArray");class Bh extends ls{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Bh.prototype.size=80;class $f extends lc{get(e){return new Bh(this,e)}}ri($f,"SymbolInstanceArray");class Zf extends Ao{getoffsetX(e){return this.float32[1*e+0]}}ri(Zf,"GlyphOffsetArray");class Fh extends oc{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ri(Fh,"SymbolLineVertexArray");class Uu extends ls{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Uu.prototype.size=12;class Xp extends Bu{get(e){return new Uu(this,e)}}ri(Xp,"FeatureIndexArray");class Yp extends Kr{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ri(Yp,"FillExtrusionCentroidArray");class Uh extends ls{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Uh.prototype.size=6;class hc extends Yc{get(e){return new Uh(this,e)}}ri(hc,"FillExtrusionWallArray");const Zm=yn([{name:"a_pos",components:2,type:"Int16"}],4),Wm=yn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Vu=yn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class qn{constructor(e=[]){this.segments=e}_prepareSegment(e,i,a,o){let d=this.segments[this.segments.length-1];return e>qn.MAX_VERTEX_ARRAY_LENGTH&&cn(`Max vertices per segment is ${qn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>qn.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==o)&&(d={vertexOffset:i,primitiveOffset:a,vertexLength:0,primitiveLength:0},o!==void 0&&(d.sortKey=o),this.segments.push(d)),d}prepareSegment(e,i,a,o){return this._prepareSegment(e,i.length,a.length,o)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,o){return new qn([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:o,vaos:{},sortKey:0}])}}function Vh(n,e){return 256*(n=Ie(Math.floor(n),0,255))+Ie(Math.floor(e),0,255)}qn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ri(qn,"SegmentVector");const Xm=yn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ym=yn([{name:"a_pattern_b",components:4,type:"Uint16"}]),Hh=yn([{name:"a_dash",components:4,type:"Uint16"}]);class Hu{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,a,o){this.ids.push(qh(e)),this.positions.push(i,a,o)}eachPosition(e,i){const a=qh(e);let o=0,d=this.ids.length-1;for(;o<d;){const p=o+d>>1;this.ids[p]>=a?d=p:o=p+1}for(;this.ids[o]===a;)i(this.positions[3*o],this.positions[3*o+1],this.positions[3*o+2]),o++}static serialize(e,i){const a=new Float64Array(e.ids),o=new Uint32Array(e.positions);return Jo(a,o,0,a.length-1),i&&(i.add(a.buffer),i.add(o.buffer)),{ids:a,positions:o}}static deserialize(e){const i=new Hu;let a;i.ids=e.ids,i.positions=e.positions;for(const o of i.ids)o!==a&&i.uniqueIds.push(o),a=o;return i.indexed=!0,i}}function qh(n){const e=+n;return Number.isSafeInteger(e)?e:dh(String(n))}function Jo(n,e,i,a){for(;i<a;){const o=n[i+a>>1];let d=i-1,p=a+1;for(;;){do d++;while(n[d]<o);do p--;while(n[p]>o);if(d>=p)break;Jr(n,d,p),Jr(e,3*d,3*p),Jr(e,3*d+1,3*p+1),Jr(e,3*d+2,3*p+2)}p-i<a-p?(Jo(n,e,i,p),i=p+1):(Jo(n,e,p+1,a),a=p)}}function Jr(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}ri(Hu,"FeaturePositionMap");class Ro{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Gh extends Ro{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class Wn extends Ro{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Qo extends Ro{constructor(e){super(e),this.current=[0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class Zd extends Ro{constructor(e){super(e),this.current=[0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class $h extends Ro{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class Kp extends Ro{constructor(e){super(e),this.current=Vn.transparent.toPremultipliedRenderColor(null)}set(e,i,a){this.fetchUniformLocation(e,i)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const Rs=new Float32Array(16);class la extends Ro{constructor(e){super(e),this.current=Rs}set(e,i,a){if(this.fetchUniformLocation(e,i)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let o=1;o<16;o++)if(a[o]!==this.current[o]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const dc=new Float32Array(9),Km=new Float32Array(4);class Wd extends Ro{constructor(e){super(e),this.current=Km}set(e,i,a){if(this.fetchUniformLocation(e,i)){for(let o=0;o<4;o++)if(a[o]!==this.current[o]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function Xd(n){return[Vh(255*n.r,255*n.g),Vh(255*n.b,255*n.a)]}class Pa{constructor(e,i,a,o){this.value=e,this.uniformNames=i.map(d=>`u_${d}`),this.type=a,this.context=o}setUniform(e,i,a,o,d){const p=o.constantOr(this.value);i.set(e,d,p instanceof Vn?p.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):p)}getBinding(e,i){return this.type==="color"?new Kp(e):new Wn(e)}}class $s{constructor(e,i){this.uniformNames=i.map(a=>`u_${a}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,a,o,d){let p=null;d!=="u_pattern"&&d!=="u_dash"||(p=this.pattern),d==="u_pattern_b"&&(p=this.patternTransition),d==="u_pixel_ratio"&&(p=this.pixelRatio),p&&i.set(e,d,p)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new $h(e):new Wn(e)}}class Zs{constructor(e,i,a,o){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new o}populatePaintArray(e,i,a,o,d,p,y,T){const A=this.paintVertexArray.length,M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new ir(0,{brightness:p,worldview:T}),i,{},d,o,y):this.expression.kind==="constant"&&this.expression.value,z=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ir(0,{brightness:p,worldview:T}),i,{},d,o,y):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(A,e,M,z?null:this.context.lut)}updatePaintArray(e,i,a,o,d,p,y,T){const A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:y,worldview:T},a,o,void 0,d):this.expression.kind==="constant"&&this.expression.value,M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ir(0,{brightness:y,worldview:T}),a,o,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(e,i,A,M?null:this.context.lut)}_setPaintValue(e,i,a,o){if(this.type==="color"){const d=Xd(a.toPremultipliedRenderColor(o));for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,d[0],d[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class El{constructor(e,i,a,o,d,p){this.expression=e,this.uniformNames=i.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=o,this.context=d,this.maxValue=0,this.paintVertexAttributes=i.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,i,a,o,d,p,y,T){const A=this.expression.evaluate(new ir(this.context.zoom,{brightness:p,worldview:T}),i,{},d,o,y),M=this.expression.evaluate(new ir(this.context.zoom+1,{brightness:p,worldview:T}),i,{},d,o,y),z=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ir(0,{brightness:p,worldview:T}),i,{},d,o,y):this.lutExpression.value)==="none",P=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(P,e,A,M,z?null:this.context.lut)}updatePaintArray(e,i,a,o,d,p,y,T){const A=this.expression.evaluate({zoom:this.context.zoom,brightness:y,worldview:T},a,o,void 0,d),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:y,worldview:T},a,o,void 0,d),z=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new ir(0,{brightness:y,worldview:T}),a,o,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(e,i,A,M,z?null:this.context.lut)}_setPaintValue(e,i,a,o,d){if(this.type==="color"){const p=Xd(a.toPremultipliedRenderColor(d)),y=Xd(a.toPremultipliedRenderColor(d));for(let T=e;T<i;T++)this.paintVertexArray.emplace(T,p[0],p[1],y[0],y[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,a,o);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,a,o,d){const p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=Ie(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);i.set(e,d,y)}getBinding(e,i){return new Wn(e)}}class Ms{constructor(e,i,a,o,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(a==="array"?Hh:Xm).members;for(let p=0;p<i.length;++p);this.paintVertexArray=new o,this.paintTransitionVertexArray=new Jc}populatePaintArray(e,i,a,o){const d=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(d,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,o,d,p,y){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,i,a,o){if(!o||!a)return;const d=o[a[0]],p=o[a[1]];if(d){if(d){const{tl:y,br:T,pixelRatio:A}=d;for(let M=e;M<i;M++)this.paintVertexArray.emplace(M,y[0],y[1],T[0],T[1],A)}if(p){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:y,br:T}=p;for(let A=e;A<i;A++)this.paintTransitionVertexArray.emplace(A,y[0],y[1],T[0],T[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Ym.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Qc{constructor(e,i,a=()=>!0){this.binders={},this._buffers=[],this.context=i;const o=[];for(const d in e.paint._values){const p=e.paint.get(d);if(d.endsWith("-use-theme")||!a(d)||!(p instanceof sc&&Ah(p.property.specification)))continue;const y=Gu(d,e.type),T=p.value,A=p.property.specification.type,M=!!p.property.useIntegerZoom,z=d==="line-dasharray"||d.endsWith("pattern"),P=e.paint.get(`${d}-use-theme`),j=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||P&&P.value.kind!=="constant";if(T.kind!=="constant"||j)if(T.kind==="source"||j||z){const B=r(d,A,"source");this.binders[d]=z?new Ms(T,y,A,B,e.id):new Zs(T,y,A,B),o.push(`/a_${d}`)}else{const B=r(d,A,"composite");this.binders[d]=new El(T,y,A,M,i,B),o.push(`/z_${d}`)}else this.binders[d]=z?new $s(T.value,y):new Pa(T.value,y,A,i),o.push(`/u_${d}`);P&&(this.binders[d].lutExpression=P.value)}this.cacheKey=o.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Zs||i instanceof El?i.maxValue:0}populatePaintArrays(e,i,a,o,d,p,y,T){for(const A in this.binders){const M=this.binders[A];M.context=this.context,(M instanceof Zs||M instanceof El||M instanceof Ms)&&M.populatePaintArray(e,i,a,o,d,p,y,T)}}setConstantPatternPositions(e,i){for(const a in this.binders){const o=this.binders[a];o instanceof $s&&o.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof Ms?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,a,o,d,p,y,T,A,M){let z=!1;const P=Object.keys(e),j=P.length!==0&&!T,B=j?P:i.uniqueIds;this.context.lut=d.lut;for(const W in this.binders){const Y=this.binders[W];if(Y.context=this.context,(Y instanceof Zs||Y instanceof El||Y instanceof Ms)&&Y.expression&&Y.expression.kind&&Y.expression.kind!=="constant"&&(Y.expression.isStateDependent===!0||Y.expression.isLightConstant===!1)){const K=d.paint.get(W);Y.expression=K.value;for(const re of B){const se=e[re.toString()];i.eachPosition(re,(ue,Re,Me)=>{const Ne=o.feature(ue);Y.updatePaintArray(Re,Me,Ne,se,p,y,A,M)})}if(!j)for(const re of a.uniqueIds){const se=e[re.toString()];a.eachPosition(re,(ue,Re,Me)=>{const Ne=o.feature(ue);Y.updatePaintArray(Re,Me,Ne,se,p,y,A,M)})}z=!0}}return z}defines(){const e=[];for(const i in this.binders){const a=this.binders[i];(a instanceof Pa||a instanceof $s)&&e.push(...a.uniformNames.map(o=>`#define HAS_UNIFORM_${o}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const a in this.binders){const o=this.binders[a];if(o instanceof Pa||o instanceof $s||o instanceof El)for(const d of o.uniformNames)i.push({name:d,property:a,binding:o.getBinding(e,d)})}return i}setUniforms(e,i,a,o,d){for(const{name:p,property:y,binding:T}of a)this.binders[y].setUniform(e,T,d,o.get(y),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Zs||i instanceof El||i instanceof Ms)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof Ms&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const a=this.binders[i];(a instanceof Zs||a instanceof El||a instanceof Ms)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Zs||i instanceof El||i instanceof Ms)&&i.destroy()}}}class Ns{constructor(e,i,a=()=>!0){this.programConfigurations={};for(const o of e)this.programConfigurations[o.id]=new Qc(o,i,a);this.needsUpload=!1,this._featureMap=new Hu,this._featureMapWithoutIds=new Hu,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,a,o,d,p,y,T,A){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(e,i,o,d,p,y,T,A);i.id!==void 0?this._featureMap.add(i.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,o,d,p,y,T){for(const A of a)this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,A,o,d,p,y||0,T)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const qu={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Gu(n,e){return qu[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const u={"line-pattern":{source:wl,composite:wl},"fill-pattern":{source:wl,composite:wl},"fill-extrusion-pattern":{source:wl,composite:wl},"line-dasharray":{source:Jc,composite:Jc}},t={color:{source:Tl,composite:oo},number:{source:Ao,composite:Tl}};function r(n,e,i){const a=u[n];return a&&a[i]||t[e][i]}ri(Pa,"ConstantBinder"),ri($s,"PatternConstantBinder"),ri(Zs,"SourceExpressionBinder"),ri(Ms,"PatternCompositeBinder"),ri(El,"CompositeExpressionBinder"),ri(Qc,"ProgramConfiguration",{omit:["_buffers"]}),ri(Ns,"ProgramConfigurationSet");const c=Vt/Math.PI/2,m=5,_=6,w=16383,E=64,R=[E,32,16],D=-c,L=c;function F(n,e,i,a=c){return i=He(i),[n*Math.sin(i)*a,-e*a,n*Math.cos(i)*a]}function k(n,e,i){return F(Math.cos(He(n)),Math.sin(He(n)),e,i)}const H=63710088e-1,$=2*Math.PI*H;class G{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new G(Be(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,a=this.lat*i,o=e.lat*i,d=Math.sin(a)*Math.sin(o)+Math.cos(a)*Math.cos(o)*Math.cos((e.lng-this.lng)*i);return H*Math.acos(Math.min(d,1))}toBounds(e=0){const i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new ee({lng:this.lng-a,lat:this.lat-i},{lng:this.lng+a,lat:this.lat+i})}toEcef(e){return k(this.lat,this.lng,c+e*c/H)}static convert(e){if(e instanceof G)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new G(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new G(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ee{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof G?new G(e.lng,e.lat):G.convert(e),this}setSouthWest(e){return this._sw=e instanceof G?new G(e.lng,e.lat):G.convert(e),this}extend(e){const i=this._sw,a=this._ne;let o,d;if(e instanceof G)o=e,d=e;else{if(!(e instanceof ee))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ee.convert(e)):this.extend(G.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(G.convert(e)):this;if(o=e._sw,d=e._ne,!o||!d)return this}return i||a?(i.lng=Math.min(o.lng,i.lng),i.lat=Math.min(o.lat,i.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new G(o.lng,o.lat),this._ne=new G(d.lng,d.lat)),this}getCenter(){return new G((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new G(this.getWest(),this.getNorth())}getSouthEast(){return new G(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=G.convert(e);let o=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(o=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&o}static convert(e){if(e)return e instanceof ee?e:new ee(e)}}const X=0,ie=25.5;function ce(n){return $*Math.cos(n*Math.PI/180)}function de(n){return(180+n)/360}function Te(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function we(n,e){return n/ce(e)}function Ee(n){return 360*n-180}function ve(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function be(n,e){return n*ce(ve(e))}const Ce=85.051129;function We(n){return Math.cos(He(Ie(n,-85.051129,Ce)))}function je(n,e){const i=Ie(e,X,ie),a=Math.pow(2,i);return We(n)*$/(512*a)}function ct(n){return 1/Math.cos(n*Math.PI/180)}function Ze(n,e=0){const i=Math.exp(Math.PI*(1-(n.y+e/Vt)/(1<<n.z)*2));return 80150034*i/(i*i+1)/Vt/(1<<n.z)}class ot{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){const a=G.convert(e);return new ot(de(a.lng),Te(a.lat),we(i,a.lat))}toLngLat(){return new G(Ee(this.x),ve(this.y))}toAltitude(){return be(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/$*ct(ve(this.y))}}function jt(n,e,i,a,o,d,p,y,T){const A=(e+a)/2,M=(i+o)/2,z=new Mt(A,M);y(z),function(P,j,B,W,Y,K){const re=B-Y,se=W-K;return Math.abs((W-j)*re-(B-P)*se)/Math.hypot(re,se)}(z.x,z.y,d.x,d.y,p.x,p.y)>=T?(jt(n,e,i,A,M,d,z,y,T),jt(n,A,M,a,o,z,p,y,T)):n.push(p)}function Ye(n,e,i){let a=n[0],o=a.x,d=a.y;e(a);const p=[a];for(let y=1;y<n.length;y++){const T=n[y],{x:A,y:M}=T;e(T),jt(p,o,d,A,M,a,T,e,i),o=A,d=M,a=T}return p}function Oe(n,e,i,a){if(a(e,i)){const o=e.add(i)._mult(.5);Oe(n,e,o,a),Oe(n,o,i,a)}else n.push(i)}function nt(n,e){let i=n[0];const a=[i];for(let o=1;o<n.length;o++){const d=n[o];Oe(a,i,d,e),i=d}return a}const Ge=Math.pow(2,14)-1,ht=-Ge-1;function _t(n,e){const i=Math.round(n.x*e),a=Math.round(n.y*e);return n.x=Ie(i,ht,Ge),n.y=Ie(a,ht,Ge),(i<n.x||i>n.x+1||a<n.y||a>n.y+1)&&cn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function qt(n,e,i){const a=n.loadGeometry(),o=n.extent,d=Vt/o;if(e&&i&&i.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:y,x:T,y:A,projection:M}=i,z=P=>{const j=Ee((e.x+P.x/o)/p),B=ve((e.y+P.y/o)/p),W=M.project(j,B);P.x=(W.x*y-T)*o,P.y=(W.y*y-A)*o};for(let P=0;P<a.length;P++)if(n.type!==1)a[P]=Ye(a[P],z,1);else{const j=[];for(const B of a[P])B.x<0||B.x>=o||B.y<0||B.y>=o||(z(B),j.push(B));a[P]=j}}for(const p of a)for(const y of p)_t(y,d);return a}function Ct(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?qt(n):[]}}class Tt{constructor(e,i,a,o,d){this.properties={},this.extent=a,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=o,this._values=d,e.readFields(gi,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,a=[];let o,d=1,p=0,y=0,T=0;for(;e.pos<i;){if(p<=0){const A=e.readVarint();d=7&A,p=A>>3}if(p--,d===1||d===2)y+=e.readSVarint(),T+=e.readSVarint(),d===1&&(o&&a.push(o),o=[]),o&&o.push(new Mt(y,T));else{if(d!==7)throw new Error(`unknown command ${d}`);o&&o.push(o[0].clone())}}return o&&a.push(o),a}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let a=1,o=0,d=0,p=0,y=1/0,T=-1/0,A=1/0,M=-1/0;for(;e.pos<i;){if(o<=0){const z=e.readVarint();a=7&z,o=z>>3}if(o--,a===1||a===2)d+=e.readSVarint(),p+=e.readSVarint(),d<y&&(y=d),d>T&&(T=d),p<A&&(A=p),p>M&&(M=p);else if(a!==7)throw new Error(`unknown command ${a}`)}return[y,A,T,M]}toGeoJSON(e,i,a){const o=this.extent*Math.pow(2,a),d=this.extent*e,p=this.extent*i,y=this.loadGeometry();function T(P){return[360*(P.x+d)/o-180,360/Math.PI*Math.atan(Math.exp((1-2*(P.y+p)/o)*Math.PI))-90]}function A(P){return P.map(T)}let M;if(this.type===1){const P=[];for(const B of y)P.push(B[0]);const j=A(P);M=P.length===1?{type:"Point",coordinates:j[0]}:{type:"MultiPoint",coordinates:j}}else if(this.type===2){const P=y.map(A);M=P.length===1?{type:"LineString",coordinates:P[0]}:{type:"MultiLineString",coordinates:P}}else{if(this.type!==3)throw new Error("unknown feature type");{const P=function(B){const W=B.length;if(W<=1)return[B];const Y=[];let K,re;for(let se=0;se<W;se++){const ue=oi(B[se]);ue!==0&&(re===void 0&&(re=ue<0),re===ue<0?(K&&Y.push(K),K=[B[se]]):K&&K.push(B[se]))}return K&&Y.push(K),Y}(y),j=[];for(const B of P)j.push(B.map(A));M=j.length===1?{type:"Polygon",coordinates:j[0]}:{type:"MultiPolygon",coordinates:j}}}const z={type:"Feature",geometry:M,properties:this.properties};return this.id!=null&&(z.id=this.id),z}}function gi(n,e,i){n===1?e.id=i.readVarint():n===2?function(a,o){const d=a.readVarint()+a.pos;for(;a.pos<d;){const p=o._keys[a.readVarint()],y=o._values[a.readVarint()];o.properties[p]=y}}(i,e):n===3?e.type=i.readVarint():n===4&&(e._geometry=i.pos)}function oi(n){let e=0;for(let i,a,o=0,d=n.length,p=d-1;o<d;p=o++)i=n[o],a=n[p],e+=(a.x-i.x)*(i.y+a.y);return e}Tt.types=["Unknown","Point","LineString","Polygon"];class ei{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(li,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new Tt(this._pbf,i,this.extent,this._keys,this._values)}}function li(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push(function(a){let o=null;const d=a.readVarint()+a.pos;for(;a.pos<d;){const p=a.readVarint()>>3;o=p===1?a.readString():p===2?a.readFloat():p===3?a.readDouble():p===4?a.readVarint64():p===5?a.readVarint():p===6?a.readSVarint():p===7?a.readBoolean():null}if(o==null)throw new Error("unknown feature value");return o}(i))}class Li{constructor(e,i){this.layers=e.readFields(Ki,{},i)}}function Ki(n,e,i){if(n===3){const a=new ei(i,i.readVarint()+i.pos);a.length&&(e[a.name]=a)}}const Hi="3d_elevation_id",zn="level";class qi{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,a){return this.get(e,!0,i,a)}optional(e,i,a){return this.get(e,!1,i,a)}success(){return this._valid}get(e,i,a,o){const d=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&d!==void 0&&!Number.isNaN(d)?a(o?o(d):d):i&&(this._valid=!1),this}}class _n{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,a){return this.featureFunc(e,i,a)}parseVertex(e,i,a){return this.vertexFunc(e,i,a)}}const On=new _n((n,e,i)=>n.reset(e).require(Hi,a=>{i.id=a}).optional("fixed_height_relative",a=>{i.constantHeight=a},Xi.decodeRelativeHeight).geometry(a=>{i.bounds=a},gh).success(),(n,e,i)=>n.reset(e).require(Hi,a=>{i.id=a}).require("elevation_idx",a=>{i.idx=a}).require("extent",a=>{i.extent=a}).require("height_relative",a=>{i.height=a},Xi.decodeRelativeHeight).geometry(a=>{i.position=a},Xi.getPoint).success()),or=new _n((n,e,i)=>n.reset(e).require(Hi,a=>{i.id=a}).optional("fixed_height",a=>{i.constantHeight=a},Xi.decodeMetricHeight).geometry(a=>{i.bounds=a},gh).success(),(n,e,i)=>n.reset(e).require(Hi,a=>{i.id=a}).require("elevation_idx",a=>{i.idx=a}).require("extent",a=>{i.extent=a}).require("height",a=>{i.height=a},Xi.decodeMetricHeight).geometry(a=>{i.position=a},Xi.getPoint).success());class Xi{static getPoint(e){return Ea(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?or:void 0:On}static parse(e){const i=[],a=[],o=e.length,d=new qi;for(let p=0;p<o;p++){const y=e.feature(p),T=y.properties.version,A=Xi.getVersionSchema(T);if(A===void 0){cn(`Unknown elevation feature version number ${T||"(unknown)"}`);continue}const M=y.properties.type;if(!M)continue;const z=Tt.types[y.type];if(z==="Point"&&M==="curve_point"){const P={};A.parseVertex(d,y,P)&&i.push(P)}else if(z==="Polygon"&&M==="curve_meta"){const P={};A.parseFeature(d,y,P)&&a.push(P)}}return{vertices:i,features:a}}}class Rn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const o=as(i,this.dir);if(Math.abs(o)<1e-6)return!1;const d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/o;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,!0}}class bn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const o=Mi(i,this.dir);if(Math.abs(o)<1e-6)return!1;const d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/o;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,a[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,i,a){if(function(j,B){var W=j[0],Y=j[1],K=j[2],re=B[0],se=B[1],ue=B[2];return Math.abs(W-re)<=q*Math.max(1,Math.abs(W),Math.abs(re))&&Math.abs(Y-se)<=q*Math.max(1,Math.abs(Y),Math.abs(se))&&Math.abs(K-ue)<=q*Math.max(1,Math.abs(K),Math.abs(ue))}(this.pos,e)||i===0)return a[0]=a[1]=a[2]=0,!1;const[o,d,p]=this.dir,y=this.pos[0]-e[0],T=this.pos[1]-e[1],A=this.pos[2]-e[2],M=o*o+d*d+p*p,z=2*(y*o+T*d+A*p),P=z*z-4*M*(y*y+T*T+A*A-i*i);if(P<0){const j=Math.max(-z/2,0),B=y+o*j,W=T+d*j,Y=A+p*j,K=Math.hypot(B,W,Y);return a[0]=B*i/K,a[1]=W*i/K,a[2]=Y*i/K,!1}{const j=(-z-Math.sqrt(P))/(2*M);if(j<0){const B=Math.hypot(y,T,A);return a[0]=y*i/B,a[1]=T*i/B,a[2]=A*i/B,!1}return a[0]=y+o*j,a[1]=T+d*j,a[2]=A+p*j,!0}}}class Dn{constructor(e,i,a,o,d){this.TL=e,this.TR=i,this.BR=a,this.BL=o,this.horizon=d}static fromInvProjectionMatrix(e,i,a){const o=[-1,1,1],d=[1,1,1],p=[1,-1,1],y=[-1,-1,1],T=St(o,o,e),A=St(d,d,e),M=St(p,p,e),z=St(y,y,e);return new Dn(T,A,M,z,i/a)}}function Qn(n,e,i){let a=1/0,o=-1/0;const d=[];for(const p of n){In(d,p,e);const y=Mi(d,i);a=Math.min(a,y),o=Math.max(o,y)}return[a,o]}function Er(n,e){let i=!0;for(let a=0;a<n.planes.length;a++){const o=n.planes[a];let d=0;for(let p=0;p<e.length;p++)d+=+(Mi(o,e[p])+o[3]>=0);if(d===0)return 0;d!==e.length&&(i=!1)}return i?2:1}function ns(n,e){for(const i of n.projections){const a=Qn(e,n.points[0],i.axis);if(i.projection[1]<a[0]||i.projection[0]>a[1])return 0}return 1}function ur(n,e){let i=0;const a=[0,0,0,0];for(let p=0;p<n.length;p++)a[0]=n[p][0],a[1]=n[p][1],a[2]=n[p][2],a[3]=1,(o=a)[0]*(d=e)[0]+o[1]*d[1]+o[2]*d[2]+o[3]*d[3]>=0&&i++;var o,d;return i}class Ji{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Pi.fromPoints(this.points),this.projections=[],this.frustumEdges=[In([],this.points[2],this.points[3]),In([],this.points[0],this.points[3]),In([],this.points[4],this.points[0]),In([],this.points[5],this.points[1]),In([],this.points[6],this.points[2]),In([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const o=[0,-a[2],a[1]],d=[a[2],0,-a[0]];this.projections.push({axis:o,projection:Qn(this.points,this.points[0],o)}),this.projections.push({axis:d,projection:Qn(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(e,i,a,o){const d=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const M=js([],A,e),z=1/M[3]/i*d;return(P=M)[0]=(j=M)[0]*(B=[z,z,o?1/M[3]:z,z])[0],P[1]=j[1]*B[1],P[2]=j[2]*B[2],P[3]=j[3]*B[3],P;var P,j,B}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const M=Ti([],Ii([],In([],p[A[0]],p[A[1]]),In([],p[A[2]],p[A[1]]))),z=-Mi(M,p[A[1]]);return M.concat(z)}),T=[];for(let A=0;A<p.length;A++)T.push([p[A][0],p[A][1],p[A][2]]);return new Ji(T,y)}intersectsPrecise(e,i,a){for(let o=0;o<i.length;o++)if(!ur(e,i[o]))return 0;for(let o=0;o<this.planes.length;o++)if(!ur(e,this.planes[o]))return 0;for(const o of a)for(const d of this.frustumEdges){const p=Ii([],o,d),y=wi(p);if(y===0)continue;Ft(p,p,1/y);const T=Qn(this.points,this.points[0],p),A=Qn(e,this.points[0],p);if(T[0]>A[1]||A[0]>T[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const a=i[3];if(Mi([i[0],i[1],i[2]],e)+a<0)return!1}return!0}}class Pi{static fromPoints(e){const i=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const o of e)Cn(i,i,o),Qe(a,a,o);return new Pi(i,a)}static fromTileIdAndHeight(e,i,a){const o=1<<e.canonical.z,d=e.canonical.x,p=e.canonical.y;return new Pi([d/o,p/o,i],[(d+1)/o,(p+1)/o,a])}static applyTransform(e,i){const a=e.getCorners();for(let o=0;o<a.length;++o)St(a[o],a[o],i);return Pi.fromPoints(a)}static applyTransformFast(e,i){const a=[i[12],i[13],i[14]],o=[...a];for(let d=0;d<3;d++)for(let p=0;p<3;p++){const y=i[4*p+d],T=y*e.min[p],A=y*e.max[p];a[d]+=Math.min(T,A),o[d]+=Math.max(T,A)}return new Pi(a,o)}static projectAabbCorners(e,i){const a=e.getCorners();for(let o=0;o<a.length;++o)St(a[o],a[o],i);return a}constructor(e,i){this.min=e,this.max=i,this.center=Ft([],Wt([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],a=Jt(this.min),o=Jt(this.max);for(let d=0;d<i.length;d++)a[d]=i[d]?this.min[d]:this.center[d],o[d]=i[d]?this.center[d]:this.max[d];return o[2]=this.max[2],new Pi(a,o)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Er(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Er(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?ns(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?ns(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}ri(Pi,"Aabb");class vn{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,a=i[1],o=-i[0],d=(e.extent+1)*this.metersToTile;return[new Mt(Math.trunc(e.position[0]+a*d),Math.trunc(e.position[1]+o*d)),new Mt(Math.trunc(e.position[0]-a*d),Math.trunc(e.position[1]-o*d))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Mr{constructor(e,i,a,o,d,p){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Or(),Or(),Or(),Or(),Or(),Or(),Or()],this.id=e,this.heightRange={min:a,max:a},this.safeArea=i,this.constantHeight=a,this.constantHeight==null&&(this.constantHeight!=null||o.length!==0)){this.vertices=o,this.edges=d,this.edges=this.edges.filter(y=>{return y.a<this.vertices.length&&y.b<this.vertices.length&&!((T=this.vertices[y.a].position)[0]===(A=this.vertices[y.b].position)[0]&&T[1]===A[1]);var T,A}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const y of this.vertices)this.vertexProps.push({dir:Ea(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,y.height),this.heightRange.max=Math.max(this.heightRange.max,y.height);for(const y of this.edges){const T=this.vertices[y.a].position,A=this.vertices[y.b].position,M=Ka(Or(),A,T),z=hs(M),P=Ls(Or(),M,1/z);this.edgeProps.push({vec:M,dir:P,len:z});const j=this.vertexProps[y.a].dir,B=this.vertexProps[y.b].dir;ss(j,j,P),ss(B,B,P)}for(const y of this.vertexProps)y.dir[0]===0&&y.dir[1]===0||fr(y.dir,y.dir);this.tessellate(p)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[a,o]=i;return zi(this.vertices[this.edges[a].a].height,this.vertices[this.edges[a].b].height,o)}computeSlopeNormal(e,i){const a=this.getClosestEdge(e);if(!a)return Fi(0,0,1);const o=a[0],d=this.edges[o],p=this.edgeProps[o].vec,y=Fi(p[0],p[1],(this.vertices[d.b].height-this.vertices[d.a].height)*i),T=Fi(y[1],-y[0],0);Ii(T,T,y);const A=wi(T);return A>0?Ft(T,T,1/A):Bi(T,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,a=Number.POSITIVE_INFINITY,o=0;const[d,p,y,T,A,M,z]=this._tmpVec2;Ya(z,e.x,e.y);const P=new Rn(z,null);for(let j=0;j<this.edges.length;j++){const B=this.edges[j],W=this.edgeProps[j].dir;P.dir=W;const Y=this.vertices[B.a].position,K=this.vertices[B.b].position,re=P.intersectsPlane(Y,this.vertexProps[B.a].dir,d),se=P.intersectsPlane(K,this.vertexProps[B.b].dir,p);if(!re||!se)continue;Ka(y,p,d),Ka(T,z,d);const ue=as(y,y),Re=ue>0?as(T,y)/ue:0,Me=Ie(Re,0,1),Ne=Math.abs((Re-Me)*this.edgeProps[j].len);Ka(A,z,Y),Ya(M,W[1],-W[0]);const Fe=Ne+Math.abs(as(A,M));Fe<a&&(i=j,a=Fe,o=Me)}return[i,o]}tessellate(e){const i=lt(),a=lt(),o=lt(),d=lt();for(let p=this.edges.length-1;p>=0;--p){const y=this.edges[p].a,T=this.edges[p].b,{position:A,height:M,extent:z}=this.vertices[y],{position:P,height:j,extent:B}=this.vertices[T],W=this.vertexProps[y].dir,Y=this.vertexProps[T].dir;if(Bi(i,A[0]/e,A[1]/e,M),Bi(a,P[0]/e,P[1]/e,j),Bi(o,W[1],-W[0],0),Ft(o,o,z),Bi(d,Y[1],-Y[0],0),Ft(d,d,B),this.distSqLines(Fi(i[0]+.5*o[0],i[1]+.5*o[1],i[2]+.5*o[2]),Fi(a[0]-.5*d[0],a[1]-.5*d[1],a[2]-.5*d[2]),Fi(i[0]-.5*o[0],i[1]-.5*o[1],i[2]-.5*o[2]),Fi(a[0]+.5*d[0],a[1]+.5*d[1],a[2]+.5*d[2]))<=.0025000000000000005)continue;const K=this.vertices.length,re=ss(Or(),A,P);this.vertices.push({position:Ls(re,re,.5),height:.5*(M+j),extent:.5*(z+B)});const se=ss(Or(),W,Y);this.vertexProps.push({dir:fr(se,se)}),this.edges.splice(p,1),this.edgeProps.splice(p,1),this.edges.push({a:y,b:K}),this.edges.push({a:K,b:T});const ue=Ka(Or(),this.vertices[K].position,A),Re=hs(ue),Me={vec:ue,dir:Ls(Or(),ue,1/Re),len:Re};this.edgeProps.push(Me),this.edgeProps.push(Me)}}distSqLines(e,i,a,o){const d=ki(lt(),i,e),p=ki(lt(),o,a),y=ki(lt(),e,a),T=Mi(d,d),A=Mi(d,p),M=Mi(d,y),z=Mi(p,p),P=Mi(p,y),j=T*z-A*A;if(j===0)return Zi(xt(d,a,o,Mi(y,p)/Mi(p,p)),e);const B=(T*P-A*M)/j;return Zi(xt(d,e,i,(A*P-M*z)/j),xt(p,a,o,B))}}class kn{static parseFrom(e,i){const a=Xi.parse(e);if(!a)return[];let{vertices:o,features:d}=a;const p=1/Ze(i);d.sort((M,z)=>M.id-z.id),o.sort((M,z)=>M.id-z.id||M.idx-z.idx),o=o.filter((M,z,P)=>z===P.findIndex(j=>j.id===M.id&&j.idx===M.idx));const y=new Array;let T=0;const A=o.length;for(const M of d){if(M.constantHeight){y.push(new Mr(M.id,M.bounds,M.constantHeight));continue}for(;T!==A&&o[T].id<M.id;)T++;if(T===A||o[T].id!==M.id)continue;const z=new Array,P=new Array,j=T;for(;T!==A&&o[T].id===M.id;){const B=o[T];if(z.push({position:B.position,height:B.height,extent:B.extent}),T!==j&&o[T-1].idx===B.idx-1){const W=T-j;P.push({a:W-1,b:W})}T++}y.push(new Mr(M.id,M.bounds,void 0,z,P,p))}return y}static getElevationFeature(e,i){if(!i)return;const a=+e.properties[Hi];return Number.isNaN(a)?void 0:i.find(o=>o.id===a)}}class Zr{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*Vt,this.yOffset=(e.y*this.zScale-i.y)*Vt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,a){const o=this.constantElevation(i,a);return o??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),a))}computeBiasedHeight(e,i){return i<=0?e:e+i*et(0,i,e>=0?e:Math.abs(.5*e))}}ri(Mr,"ElevationFeature");class ms{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new oc,this.indexArray=new is,this.segments=new qn,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Ao),this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,a,o){const d=this.layers[0],p=[];let y=null;d.type==="circle"&&(y=d.layout.get("circle-sort-key"));for(const{feature:A,id:M,index:z,sourceLayerIndex:P}of e){const j=this.layers[0]._featureFilter.needGeometry,B=Ct(A,j);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom,{worldview:this.worldview}),B,a))continue;const W=y?y.evaluate(B,{},a):void 0,Y={id:M,properties:A.properties,type:A.type,sourceLayerIndex:P,index:z,geometry:j?B.geometry:qt(A,a,o),patterns:{},sortKey:W};p.push(Y)}y&&p.sort((A,M)=>A.sortKey-M.sortKey);let T=null;o.projection.name==="globe"&&(this.globeExtVertexArray=new Vd,T=o.projection);for(const A of p){const{geometry:M,index:z,sourceLayerIndex:P}=A,j=e[z].feature;this.addFeature(A,M,z,i.availableImages,a,T,i.brightness,i.elevationFeatures),i.featureIndex.insert(j,M,z,P,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,a,o,d,p,y){this.programConfigurations.updatePaintArrays(e,i,d,a,o,p,y,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Vu.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Wm.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,a,o,d,p,y,T){let A;this.elevationMode!=="none"&&(A=kn.getElevationFeature(e,T));for(const M of i)for(const z of M){const P=z.x,j=z.y;if(P<0||P>=Vt||j<0||j>=Vt)continue;if(p){const Y=p.projectTilePoint(P,j,d),K=p.upVector(d,P,j);this.addGlobeExtVertex(Y,K),this.addGlobeExtVertex(Y,K),this.addGlobeExtVertex(Y,K),this.addGlobeExtVertex(Y,K)}const B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),W=B.vertexLength;if(this.addCircleVertex(P,j,-1,-1),this.addCircleVertex(P,j,1,-1),this.addCircleVertex(P,j,1,1),this.addCircleVertex(P,j,-1,1),this.elevationMode!=="none"){const Y=A?A.pointElevation(new Mt(P,j)):0;this.hasElevation=this.hasElevation||Y!==0;for(let K=0;K<4;K++)this.elevatedLayoutVertexArray.emplaceBack(Y)}this.indexArray.emplaceBack(W,W+1,W+2),this.indexArray.emplaceBack(W,W+2,W+3),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},o,d,y,void 0,this.worldview)}addCircleVertex(e,i,a,o){this.layoutVertexArray.emplaceBack(2*e+(a+1)/2,2*i+(o+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function Ga(n,e){for(let i=0;i<n.length;i++)if(_s(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(_s(n,e[i]))return!0;return!!Ws(n,e)}function co(n,e,i){return!!_s(n,e)||!!Nr(e,n,i)}function gs(n,e){if(n.length===1)return Qr(e,n[0]);for(let i=0;i<e.length;i++){const a=e[i];for(let o=0;o<a.length;o++)if(_s(n,a[o]))return!0}for(let i=0;i<n.length;i++)if(Qr(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Ws(n,e[i]))return!0;return!1}function ca(n,e,i){if(n.length>1){if(Ws(n,e))return!0;for(let a=0;a<e.length;a++)if(Nr(e[a],n,i))return!0}for(let a=0;a<n.length;a++)if(Nr(n[a],e,i))return!0;return!1}function Ws(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const a=n[i],o=n[i+1];for(let d=0;d<e.length-1;d++)if(ua(a,o,e[d],e[d+1]))return!0}return!1}function ua(n,e,i,a){return cr(n,i,a)!==cr(e,i,a)&&cr(n,e,i)!==cr(n,e,a)}function Mo(n,e,i){return(n.x-i.x)*(e.y-i.y)-(n.y-i.y)*(e.x-i.x)}function Dr(n,e,i,a){const o=Mo(n,e,a),d=Mo(n,e,i);if(Math.sign(o)===Math.sign(d))return;const p=Mo(i,a,n),y=p+d-o;return Math.sign(p)!==Math.sign(y)?[p/(p-y),d/(d-o)]:void 0}function Nr(n,e,i){const a=i*i;if(e.length===1)return n.distSqr(e[0])<a;for(let o=1;o<e.length;o++)if(pr(n,e[o-1],e[o])<a)return!0;return!1}function pr(n,e,i){const a=e.distSqr(i);if(a===0)return n.distSqr(e);const o=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/a;return n.distSqr(o<0?e:o>1?i:i.sub(e)._mult(o)._add(e))}function Qr(n,e){let i,a,o,d=!1;for(let p=0;p<n.length;p++){i=n[p];for(let y=0,T=i.length-1;y<i.length;T=y++)a=i[y],o=i[T],a.y>e.y!=o.y>e.y&&e.x<(o.x-a.x)*(e.y-a.y)/(o.y-a.y)+a.x&&(d=!d)}return d}function _s(n,e){let i=!1;for(let a=0,o=n.length-1;a<n.length;o=a++){const d=n[a],p=n[o];d.y>e.y!=p.y>e.y&&e.x<(p.x-d.x)*(e.y-d.y)/(p.y-d.y)+d.x&&(i=!i)}return i}function Wr(n,e,i,a,o){for(const p of n)if(e<=p.x&&i<=p.y&&a>=p.x&&o>=p.y)return!0;const d=[new Mt(e,i),new Mt(e,o),new Mt(a,o),new Mt(a,i)];if(n.length>2){for(const p of d)if(_s(n,p))return!0}for(let p=0;p<n.length-1;p++)if(Xs(n[p],n[p+1],d))return!0;return!1}function Xs(n,e,i){const a=i[0],o=i[2];if(n.x<a.x&&e.x<a.x||n.x>o.x&&e.x>o.x||n.y<a.y&&e.y<a.y||n.y>o.y&&e.y>o.y)return!1;const d=cr(n,e,i[0]);return d!==cr(n,e,i[1])||d!==cr(n,e,i[2])||d!==cr(n,e,i[3])}function el(n,e,i,a,o,d){let p=e.y-n.y,y=n.x-e.x;if(d=d||0){const T=p*p+y*y;if(T===0)return!0;const A=Math.sqrt(T);p/=A,y/=A}return!((i.x-n.x)*p+(i.y-n.y)*y-d<0||(a.x-n.x)*p+(a.y-n.y)*y-d<0||(o.x-n.x)*p+(o.y-n.y)*y-d<0)}function Al(n,e,i,a,o,d,p){return!(el(n,e,a,o,d,p)||el(e,i,a,o,d,p)||el(i,n,a,o,d,p)||el(a,o,n,e,i,p)||el(o,d,n,e,i,p)||el(d,a,n,e,i,p))}function va(n,e,i){const a=e.paint.get(n).value;return a.kind==="constant"?a.value:i.programConfigurations.get(e.id).getMaxValue(n)}function tl(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function fc(n,e,i,a,o){if(!e[0]&&!e[1])return n;const d=Mt.convert(e)._mult(o);i==="viewport"&&d._rotate(-a);const p=[];for(let y=0;y<n.length;y++)p.push(n[y].sub(d));return p}function il(n,e,i,a){const o=Mt.convert(n)._mult(a);return e==="viewport"&&o._rotate(-i),o}let Zh,Cl;function La(n,e,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[n*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}ri(ms,"CircleBucket",{omit:["layers"]});class Rl{constructor(e,i,a){this.z=e,this.x=i,this.y=a,this.key=Wf(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const a=function(d,p,y){var T=La(256*d,256*(p=Math.pow(2,y)-p-1),y),A=La(256*(d+1),256*(p+1),y);return T[0]+","+T[1]+","+A[0]+","+A[1]}(this.x,this.y,this.z),o=function(d,p,y){let T,A="";for(let M=d;M>0;M--)T=1<<M-1,A+=(p&T?1:0)+(y&T?2:0);return A}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",o).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class jr{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Wf(e,i.z,i.z,i.x,i.y)}}class Ys{constructor(e,i,a,o,d){this.overscaledZ=e,this.wrap=i,this.canonical=new Rl(a,+o,+d),this.key=i===0&&e===a?this.canonical.key:Wf(i,e,a,o,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Ys(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ys(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Wf(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Wf(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Ys(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,o=2*this.canonical.y;return[new Ys(i,this.wrap,i,a,o),new Ys(i,this.wrap,i,a+1,o),new Ys(i,this.wrap,i,a,o+1),new Ys(i,this.wrap,i,a+1,o+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ys(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ys(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new jr(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Wf(n,e,i,a,o){const d=1<<Math.min(i,22);let p=d*(o%d)+a%d;return n&&i<22&&(p+=d*d*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*p+i)+(e-i)}const v0=[n=>{let e=n.canonical.x-1,i=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,i--),new Ys(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,i=n.wrap;return e===1<<n.canonical.z&&(e=0,i++),new Ys(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>new Ys(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new Ys(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];ri(Rl,"CanonicalTileID"),ri(Ys,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const B1=yn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Jm}=B1,F1=yn([{name:"a_pos_3",components:3,type:"Int16"}]);var Jp=yn([{name:"a_pos",type:"Int16",components:2}]);function $u(n){return n*c/H}const Xg=[new Pi([D,D,D],[L,L,L]),new Pi([D,D,D],[0,0,L]),new Pi([0,D,D],[L,0,L]),new Pi([D,0,D],[0,L,L]),new Pi([0,0,D],[L,L,L])];function Qp(n,e,i,a=!0){const o=Ft([],n._camera.position,n.worldSize),d=[e,i,1,1];js(d,d,n.pixelMatrixInverse),Un(d,d,1/d[3]);const p=Ti([],In([],d,o)),y=n.globeMatrix,T=[y[12],y[13],y[14]],A=In([],T,o),M=wi(A),z=Ti([],A),P=n.worldSize/(2*Math.PI),j=Mi(z,p),B=Math.asin(P/M);if(B<Math.acos(j)){if(!a)return null;const pt=[],$e=[];Ft(pt,p,M/j),Ti($e,In($e,pt,A)),Ti(p,Wt(p,A,Ft(p,$e,Math.tan(B)*M)))}const W=[];new bn(o,p).closestPointOnSphere(T,P,W);const Y=Ti([],bi(y,0)),K=Ti([],bi(y,1)),re=Ti([],bi(y,2)),se=Mi(Y,W),ue=Mi(K,W),Re=Mi(re,W),Me=J(Math.asin(-ue/P));let Ne=J(Math.atan2(se,Re));Ne=n.center.lng+function(pt,$e){const yt=($e-pt+180)%360-180;return yt<-180?yt+360:yt}(n.center.lng,Ne);const Fe=de(Ne),Ue=Ie(Te(Me),0,1);return new ot(Fe,Ue)}class Yg{constructor(e,i,a){this.a=In([],e,a),this.b=In([],i,a),this.center=a;const o=Ti([],this.a),d=Ti([],this.b);this.angle=Math.acos(Mi(o,d))}}function Zu(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(a,o,d,p){const y=Math.sin(d);return a*(Math.sin((1-p)*d)/y)+o*(Math.sin(p*d)/y)}(n.a[e],n.b[e],n.angle,Ie(i,0,1))+n.center[e]}function ha(n){if(n.z<=1)return Xg[n.z+2*n.y+n.x];const e=Qm(em(n));return Pi.fromPoints(e)}function nl(n,e,i){return Ft(n,n,1-i),Di(n,n,e,i)}function b0(n,e,i){for(const a of n)St(a,a,e),Ft(a,a,i)}function Kg(n,e,i,a){const o=e/n.worldSize,d=n.globeMatrix;if(i.z<=1){const Ue=ha(i).getCorners();return b0(Ue,d,o),Pi.fromPoints(Ue)}const p=em(i,a),y=Qm(p,c+$u(n._tileCoverLift));b0(y,d,o);const T=Number.MAX_VALUE,A=[-T,-T,-T],M=[T,T,T];if(p.contains(n.center)){for(const $e of y)Cn(M,M,$e),Qe(A,A,$e);A[2]=0;const Ue=n.point,pt=[Ue.x*o,Ue.y*o,0];return Cn(M,M,pt),Qe(A,A,pt),new Pi(M,A)}if(n._tileCoverLift>0){for(const Ue of y)Cn(M,M,Ue),Qe(A,A,Ue);return new Pi(M,A)}const z=[d[12]*o,d[13]*o,d[14]*o],P=p.getCenter(),j=Ie(n.center.lat,-85.051129,Ce),B=Ie(P.lat,-85.051129,Ce),W=de(n.center.lng),Y=Te(j);let K=W-de(P.lng);const re=Y-Te(B);K>.5?K-=1:K<-.5&&(K+=1);let se=0;Math.abs(K)>Math.abs(re)?se=K>=0?1:3:(se=re>=0?0:2,Di(z,z,[d[4]*o,d[5]*o,d[6]*o],-Math.sin(He(re>=0?p.getSouth():p.getNorth()))*c));const ue=y[se],Re=y[(se+1)%4],Me=new Yg(ue,Re,z),Ne=[Zu(Me,0)||ue[0],Zu(Me,1)||ue[1],Zu(Me,2)||ue[2]],Fe=Wh(n.zoom);if(Fe>0){const Ue=function({x:$e,y:yt,z:It},bt,Et,Ot,dt){const At=1/(1<<It);let at=$e*At,tt=at+At,Nt=yt*At,Pt=Nt+At,vi=0;const ai=(at+tt)/2-Ot;return ai>.5?vi=-1:ai<-.5&&(vi=1),at=((at+vi)*bt-(Ot*=bt))*Et+Ot,tt=((tt+vi)*bt-Ot)*Et+Ot,Nt=(Nt*bt-(dt*=bt))*Et+dt,Pt=(Pt*bt-dt)*Et+dt,[[at,Pt,0],[tt,Pt,0],[tt,Nt,0],[at,Nt,0]]}(i,e,n._pixelsPerMercatorPixel,W,Y);for(let $e=0;$e<y.length;$e++)nl(y[$e],Ue[$e],Fe);const pt=Wt([],Ue[se],Ue[(se+1)%4]);Ft(pt,pt,.5),nl(Ne,pt,Fe)}for(const Ue of y)Cn(M,M,Ue),Qe(A,A,Ue);return M[2]=Math.min(ue[2],Re[2]),Cn(M,M,Ne),Qe(A,A,Ne),new Pi(M,A)}function em({x:n,y:e,z:i},a=!1){const o=1/(1<<i),d=new G(Ee(n*o),e===(1<<i)-1&&a?-90:ve((e+1)*o)),p=new G(Ee((n+1)*o),e===0&&a?90:ve(e*o));return new ee(d,p)}function Qm(n,e=c){const i=He(n.getNorth()),a=He(n.getSouth()),o=Math.cos(i),d=Math.cos(a),p=Math.sin(i),y=Math.sin(a),T=n.getWest(),A=n.getEast();return[F(d,y,T,e),F(d,y,A,e),F(o,p,A,e),F(o,p,T,e)]}function tm(n,e,i,a){const o=1<<i.z,d=(n/Vt+i.x)/o;return k(ve((e/Vt+i.y)/o),Ee(d),a)}function Xf({min:n,max:e}){return w/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const Jg=new Float64Array(16);function im(n){const e=Xf(n),i=it(Jg,[e,e,e]);return xe(i,i,Yi([],n.min))}function Qg(n){const e=(a=n.min,(i=Jg)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=a[0],i[13]=a[1],i[14]=a[2],i[15]=1,i);var i,a;const o=1/Xf(n);return ye(e,e,[o,o,o])}function nm(n){const e=Vt/(2*Math.PI);return n/(2*Math.PI)/e}function eg(n,e){return Vt/(512*Math.pow(2,n))*Xf(ha(e))}function w0(n,e,i,a,o){const d=nm(i),p=[n,e,-i/(2*Math.PI)],y=Se(new Float64Array(16));return xe(y,y,p),ye(y,y,[d,d,d]),Pe(y,y,He(-o)),Ae(y,y,He(-a)),y}function Wh(n){return et(m,_,n)}function Yf(n,e){const i=k(e.lat,e.lng),a=function(B){const W=k(B._center.lat,B._center.lng);let Y=Ii([],Fi(0,1,0),W);const K=rt([],-B.angle,W);Y=St(Y,Y,K),rt(K,-B._pitch,Y);const re=Ti([],W);return Ft(re,re,$u(B.cameraToCenterDistance/B.pixelsPerMeter)),St(re,re,K),Wt([],W,re)}(n);return p=(o=ki([],a,i))[0],y=o[1],T=o[2],A=(d=i)[0],M=d[1],z=d[2],j=(P=Math.sqrt((p*p+y*y+T*T)*(A*A+M*M+z*z)))&&Mi(o,d)/P,Math.acos(Math.min(Math.max(j,-1),1));var o,d,p,y,T,A,M,z,P,j}function e_(n,e){return Yf(n,e)>Math.PI/2*1.01}const t_=He(85),Ar=Math.cos(t_),i_=Math.sin(t_),tg=le(),ig=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function n_(n,e,i,a,o,d,p,y,T){if(d&&n.queryGeometry.isAboveHorizon)return!1;d&&(T*=n.pixelToTileUnitsFactor);const A=n.tileID.canonical,M=i.projection.upVectorScale(A,i.center.lat,i.worldSize).metersToTile;for(const z of e)for(const P of z){const j=P.add(y),B=o&&i.elevation?i.elevation.exaggeration()*o.getElevationAt(j.x,j.y,!0):0,W=i.projection.projectTilePoint(j.x,j.y,A);if(B>0){const se=i.projection.upVector(A,j.x,j.y);W.x+=se[0]*M*B,W.y+=se[1]*M*B,W.z+=se[2]*M*B}const Y=d?j:r_(W.x,W.y,W.z,a),K=d?n.tilespaceRays.map(se=>Jf(se,B)):n.queryGeometry.screenGeometry,re=js([],[W.x,W.y,W.z,1],a);if(!p&&d?T*=re[3]/i.cameraToCenterDistance:p&&!d&&(T*=i.cameraToCenterDistance/re[3]),d){const se=ve((P.y/Vt+A.y)/(1<<A.z));T/=i.projection.pixelsPerMeter(se,1)/we(1,se)}if(co(K,Y,T))return!0}return!1}function r_(n,e,i,a){const o=js([],[n,e,i,1],a);return new Mt(o[0]/o[3],o[1]/o[3])}const Kf=Fi(0,0,0),ng=Fi(0,0,1);function Jf(n,e){const i=lt();return Kf[2]=e,n.intersectsPlane(Kf,ng,i),new Mt(i[0],i[1])}class s_ extends ms{}let T0,S0,a_,o_;function rm(n,{width:e,height:i},a,o){if(o){if(o instanceof Uint8ClampedArray)o=new Uint8Array(o.buffer);else if(o.length!==e*i*a)throw new RangeError("mismatched image size")}else o=new Uint8Array(e*i*a);return n.width=e,n.height=i,n.data=o,n}function Xr(n,e,i){const{width:a,height:o}=e;a===n.width&&o===n.height||(sm(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,a),height:Math.min(n.height,o)},i,null),n.width=a,n.height=o,n.data=e.data)}function sm(n,e,i,a,o,d,p,y){if(o.width===0||o.height===0)return e;if(o.width>n.width||o.height>n.height||i.x>n.width-o.width||i.y>n.height-o.height)throw new RangeError("out of range source coordinates for image copy");if(o.width>e.width||o.height>e.height||a.x>e.width-o.width||a.y>e.height-o.height)throw new RangeError("out of range destination coordinates for image copy");const T=n.data,A=e.data,M=d===4&&y;for(let z=0;z<o.height;z++){const P=((i.y+z)*n.width+i.x)*d,j=((a.y+z)*e.width+a.x)*d;if(M)for(let B=0;B<o.width;B++){const W=P+B*d+3,Y=j+B*d;A[Y+0]=255,A[Y+1]=255,A[Y+2]=255,A[Y+3]=T[W]}else if(p)for(let B=0;B<o.width;B++){const W=P+B*d,Y=j+B*d,K=new Vn(T[W+0]/255,T[W+1]/255,T[W+2]/255,T[W+3]).toNonPremultipliedRenderColor(p).toArray();A[Y+0]=K[0],A[Y+1]=K[1],A[Y+2]=K[2],A[Y+3]=K[3]}else for(let B=0;B<o.width*d;B++)A[j+B]=T[P+B]}return e}ri(s_,"HeatmapBucket",{omit:["layers"]});class ys{constructor(e,i){rm(this,e,1,i)}resize(e){Xr(this,new ys(e),1)}clone(){return new ys({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,o,d){sm(e,i,a,o,d,1,null)}}class Ks{constructor(e,i){rm(this,e,4,i)}resize(e){Xr(this,new Ks(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ks({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,o,d,p,y){sm(e,i,a,o,d,4,p,y)}}class rg{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Yd(n){const e={},i=n.resolution||256,a=n.clips?n.clips.length:1,o=n.image||new Ks({width:i,height:a}),d=(p,y,T)=>{e[n.evaluationKey]=T;const A=n.expression.evaluate(e),M=A?A.toNonPremultipliedRenderColor(null):null;M&&(o.data[p+y+0]=Math.floor(255*M.r),o.data[p+y+1]=Math.floor(255*M.g),o.data[p+y+2]=Math.floor(255*M.b),o.data[p+y+3]=Math.floor(255*M.a))};if(n.clips)for(let p=0,y=0;p<a;++p,y+=4*i)for(let T=0,A=0;T<i;T++,A+=4){const M=T/(i-1),{start:z,end:P}=n.clips[p];d(y,A,z*(1-M)+P*M)}else for(let p=0,y=0;p<i;p++,y+=4)d(0,y,p/(i-1));return o}ri(ys,"AlphaImage"),ri(Ks,"RGBAImage");const sg=yn([{name:"a_pos",components:2,type:"Int16"}],4),E0=yn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),A0=yn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),l_=yn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Xh(n,e,i=2){const a=e&&e.length,o=a?e[0]*i:n.length;let d=C0(n,0,o,i,!0);const p=[];if(!d||d.next===d.prev)return p;let y,T,A;if(a&&(d=function(M,z,P,j){const B=[];for(let W=0,Y=z.length;W<Y;W++){const K=C0(M,z[W]*j,W<Y-1?z[W+1]*j:M.length,j,!1);K===K.next&&(K.steiner=!0),B.push(M0(K))}B.sort(u_);for(let W=0;W<B.length;W++)P=H1(B[W],P);return P}(n,e,d,i)),n.length>80*i){y=n[0],T=n[1];let M=y,z=T;for(let P=i;P<o;P+=i){const j=n[P],B=n[P+1];j<y&&(y=j),B<T&&(T=B),j>M&&(M=j),B>z&&(z=B)}A=Math.max(M-y,z-T),A=A!==0?32767/A:0}return am(d,p,i,y,T,A,0),p}function C0(n,e,i,a,o){let d;if(o===function(p,y,T,A){let M=0;for(let z=y,P=T-A;z<T;z+=A)M+=(p[P]-p[z])*(p[z+1]+p[P+1]),P=z;return M}(n,e,i,a)>0)for(let p=e;p<i;p+=a)d=P0(p/a|0,n[p],n[p+1],d);else for(let p=i-a;p>=e;p-=a)d=P0(p/a|0,n[p],n[p+1],d);return d&&Io(d,d.next)&&(om(d),d=d.next),d}function Yh(n,e){if(!n)return n;e||(e=n);let i,a=n;do if(i=!1,a.steiner||!Io(a,a.next)&&rs(a.prev,a,a.next)!==0)a=a.next;else{if(om(a),a=e=a.prev,a===a.next)break;i=!0}while(i||a!==e);return e}function am(n,e,i,a,o,d,p){if(!n)return;!p&&d&&function(T,A,M,z){let P=T;do P.z===0&&(P.z=rl(P.x,P.y,A,M,z)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==T);P.prevZ.nextZ=null,P.prevZ=null,function(j){let B,W=1;do{let Y,K=j;j=null;let re=null;for(B=0;K;){B++;let se=K,ue=0;for(let Me=0;Me<W&&(ue++,se=se.nextZ,se);Me++);let Re=W;for(;ue>0||Re>0&&se;)ue!==0&&(Re===0||!se||K.z<=se.z)?(Y=K,K=K.nextZ,ue--):(Y=se,se=se.nextZ,Re--),re?re.nextZ=Y:j=Y,Y.prevZ=re,re=Y;K=se}re.nextZ=null,W*=2}while(B>1)}(P)}(n,a,o,d);let y=n;for(;n.prev!==n.next;){const T=n.prev,A=n.next;if(d?U1(n,a,o,d):R0(n))e.push(T.i,n.i,A.i),om(n),n=A.next,y=A.next;else if((n=A)===y){p?p===1?am(n=V1(Yh(n),e),e,i,a,o,d,2):p===2&&c_(n,e,i,a,o,d):am(Yh(n),e,i,a,o,d,1);break}}}function R0(n){const e=n.prev,i=n,a=n.next;if(rs(e,i,a)>=0)return!1;const o=e.x,d=i.x,p=a.x,y=e.y,T=i.y,A=a.y,M=Math.min(o,d,p),z=Math.min(y,T,A),P=Math.max(o,d,p),j=Math.max(y,T,A);let B=a.next;for(;B!==e;){if(B.x>=M&&B.x<=P&&B.y>=z&&B.y<=j&&$a(o,y,d,T,p,A,B.x,B.y)&&rs(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function U1(n,e,i,a){const o=n.prev,d=n,p=n.next;if(rs(o,d,p)>=0)return!1;const y=o.x,T=d.x,A=p.x,M=o.y,z=d.y,P=p.y,j=Math.min(y,T,A),B=Math.min(M,z,P),W=Math.max(y,T,A),Y=Math.max(M,z,P),K=rl(j,B,e,i,a),re=rl(W,Y,e,i,a);let se=n.prevZ,ue=n.nextZ;for(;se&&se.z>=K&&ue&&ue.z<=re;){if(se.x>=j&&se.x<=W&&se.y>=B&&se.y<=Y&&se!==o&&se!==p&&$a(y,M,T,z,A,P,se.x,se.y)&&rs(se.prev,se,se.next)>=0||(se=se.prevZ,ue.x>=j&&ue.x<=W&&ue.y>=B&&ue.y<=Y&&ue!==o&&ue!==p&&$a(y,M,T,z,A,P,ue.x,ue.y)&&rs(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;se&&se.z>=K;){if(se.x>=j&&se.x<=W&&se.y>=B&&se.y<=Y&&se!==o&&se!==p&&$a(y,M,T,z,A,P,se.x,se.y)&&rs(se.prev,se,se.next)>=0)return!1;se=se.prevZ}for(;ue&&ue.z<=re;){if(ue.x>=j&&ue.x<=W&&ue.y>=B&&ue.y<=Y&&ue!==o&&ue!==p&&$a(y,M,T,z,A,P,ue.x,ue.y)&&rs(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function V1(n,e){let i=n;do{const a=i.prev,o=i.next.next;!Io(a,o)&&z0(a,i,i.next,o)&&Qf(a,o)&&Qf(o,a)&&(e.push(a.i,i.i,o.i),om(i),om(i.next),i=n=o),i=i.next}while(i!==n);return Yh(i)}function c_(n,e,i,a,o,d){let p=n;do{let y=p.next.next;for(;y!==p.prev;){if(p.i!==y.i&&I0(p,y)){let T=D0(p,y);return p=Yh(p,p.next),T=Yh(T,T.next),am(p,e,i,a,o,d,0),void am(T,e,i,a,o,d,0)}y=y.next}p=p.next}while(p!==n)}function u_(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function H1(n,e){const i=function(o,d){let p=d;const y=o.x,T=o.y;let A,M=-1/0;if(Io(o,p))return p;do{if(Io(o,p.next))return p.next;if(T<=p.y&&T>=p.next.y&&p.next.y!==p.y){const W=p.x+(T-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(W<=y&&W>M&&(M=W,A=p.x<p.next.x?p:p.next,W===y))return A}p=p.next}while(p!==d);if(!A)return null;const z=A,P=A.x,j=A.y;let B=1/0;p=A;do{if(y>=p.x&&p.x>=P&&y!==p.x&&h_(T<j?y:M,T,P,j,T<j?M:y,T,p.x,p.y)){const W=Math.abs(T-p.y)/(y-p.x);Qf(p,o)&&(W<B||W===B&&(p.x>A.x||p.x===A.x&&q1(A,p)))&&(A=p,B=W)}p=p.next}while(p!==z);return A}(n,e);if(!i)return e;const a=D0(i,n);return Yh(a,a.next),Yh(i,i.next)}function q1(n,e){return rs(n.prev,n,e.prev)<0&&rs(e.next,n,n.next)<0}function rl(n,e,i,a,o){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*o|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function M0(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function h_(n,e,i,a,o,d,p,y){return(o-p)*(e-y)>=(n-p)*(d-y)&&(n-p)*(a-y)>=(i-p)*(e-y)&&(i-p)*(d-y)>=(o-p)*(a-y)}function $a(n,e,i,a,o,d,p,y){return!(n===p&&e===y)&&h_(n,e,i,a,o,d,p,y)}function I0(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,a){let o=i;do{if(o.i!==i.i&&o.next.i!==i.i&&o.i!==a.i&&o.next.i!==a.i&&z0(o,o.next,i,a))return!0;o=o.next}while(o!==i);return!1}(n,e)&&(Qf(n,e)&&Qf(e,n)&&function(i,a){let o=i,d=!1;const p=(i.x+a.x)/2,y=(i.y+a.y)/2;do o.y>y!=o.next.y>y&&o.next.y!==o.y&&p<(o.next.x-o.x)*(y-o.y)/(o.next.y-o.y)+o.x&&(d=!d),o=o.next;while(o!==i);return d}(n,e)&&(rs(n.prev,n,e.prev)||rs(n,e.prev,e))||Io(n,e)&&rs(n.prev,n,n.next)>0&&rs(e.prev,e,e.next)>0)}function rs(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Io(n,e){return n.x===e.x&&n.y===e.y}function z0(n,e,i,a){const o=Wu(rs(n,e,i)),d=Wu(rs(n,e,a)),p=Wu(rs(i,a,n)),y=Wu(rs(i,a,e));return o!==d&&p!==y||!(o!==0||!ag(n,i,e))||!(d!==0||!ag(n,a,e))||!(p!==0||!ag(i,n,a))||!(y!==0||!ag(i,e,a))}function ag(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function Wu(n){return n>0?1:n<0?-1:0}function Qf(n,e){return rs(n.prev,n,n.next)<0?rs(n,e,n.next)>=0&&rs(n,n.prev,e)>=0:rs(n,e,n.prev)<0||rs(n,n.next,e)<0}function D0(n,e){const i=d_(n.i,n.x,n.y),a=d_(e.i,e.x,e.y),o=n.next,d=e.prev;return n.next=e,e.prev=n,i.next=o,o.prev=i,a.next=i,i.prev=a,d.next=a,a.prev=d,a}function P0(n,e,i,a){const o=d_(n,e,i);return a?(o.next=a.next,o.prev=a,a.next.prev=o,a.next=o):(o.prev=o,o.next=o),o}function om(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function d_(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function lm(n,e){const i=n.length;if(i<=1)return[n];const a=[];let o,d;for(let p=0;p<i;p++){const y=$n(n[p]);y!==0&&(n[p].area=Math.abs(y),d===void 0&&(d=y<0),d===y<0?(o&&a.push(o),o=[n[p]]):o.push(n[p]))}if(o&&a.push(o),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(Ua(a[p],e,1,a[p].length-1,G1),a[p]=a[p].slice(0,e));return a}function G1(n,e){return e.area-n.area}function L0(n,e,i=1){if(!n)return null;const a=typeof n=="string"?_a.from(n).getPrimary():n.getPrimary(),o=typeof n=="string"?null:n.getSecondary();for(const d of[a,o]){if(!d)continue;const p=d.id.toString();e.has(p)||e.set(p,[]),d.scaleSelf(i),e.get(p).push(d)}return{primary:a.toString(),secondary:o?o.toString():null}}function og(n,e,i,a){const o=a.patternDependencies;let d=!1;for(const p of e){const y=p.paint.get(`${n}-pattern`);y.isConstant()||(d=!0),L0(y.constantOr(null),o,i)&&(d=!0)}return d}function Kh(n,e,i,a,o,d){const p=d.patternDependencies;for(const y of e){const T=y.paint.get(`${n}-pattern`).value;if(T.kind!=="constant"){let A=T.evaluate({zoom:a},i,{},d.availableImages);A=A&&A.name?A.name:A;const M=L0(A,p,o);if(!M)continue;const{primary:z,secondary:P}=M;z&&(i.patterns[y.id]=[z,P].filter(Boolean))}}return i}class ep{constructor(){this.polygons=new Map}add(e,...i){const a=this.polygons.get(e);a?a.push(...i):this.polygons.set(e,i)}merge(e){for(const[i,a]of e.polygons)this.add(i,...a)}}class eu{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=Vt&&i>=Vt}static evaluate(e){if(e.length===0)return new eu;let i=[];for(const T of e)i.push(...T.portals);if(i.length===0)return new eu;for(const T of i){const A=T.va,M=T.vb;(eu.isOnBorder(A.x,M.x)||eu.isOnBorder(A.y,M.y))&&(T.type="border")}const a=i.filter(T=>T.type!=="unevaluated"),o=i.filter(T=>T.type==="unevaluated");if(o.length===0)return new eu;o.sort((T,A)=>T.hash===A.hash?T.isTunnel===A.isTunnel?0:T.isTunnel?-1:1:T.hash<A.hash?1:-1),i=a.concat(o);let d=a.length,p=d,y=d;do if(p++,p===i.length||i[d].hash!==i[p].hash){if(p-d==2){y<d&&(i[y]=i[d],i[d]=null);const T=i[y],A=i[p-1];T.type=T.isTunnel!==A.isTunnel?"tunnel":"polygon",T.connection={a:T.connection.a,b:A.connection.a},y++}d=p}while(d!==i.length);return i.splice(y),i.sort((T,A)=>T.hash<A.hash?1:-1),{portals:i}}}ri(eu,"ElevationPortalGraph"),ri(ep,"ElevationPolygons");class $1{constructor(e,i,a){this.outPositions=e,this.outNormals=i,this.outIndices=a,this.vertexLookup=new Map}addVertex(e,i,a){let o=e[2];a!=null&&(o*=a);const d=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,p=this.vertexLookup.get(d);if(p!=null)return p;const y=this.outPositions.length;this.vertexLookup.set(d,y);const T=Math.trunc(16384*i[0]),A=Math.trunc(16384*i[1]),M=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],o),this.outNormals.emplaceBack(T,A,M),y}addTriangle(e,i,a){this.outIndices.emplaceBack(e,i,a)}addTriangles(e,i,a){if(e.length===0)return;const o=a.length===1,d=lt(),p=lt();for(let y=0;y<e.length;y+=3){const T=i[e[y+0]],A=i[e[y+1]],M=i[e[y+2]],z=o?a[0]:a[e[y+1]],P=o?a[0]:a[e[y+2]];Bi(d,T.x,T.y,o?a[0]:a[e[y+0]]);const j=this.addVertex(d,p);Bi(d,A.x,A.y,z);const B=this.addVertex(d,p);Bi(d,M.x,M.y,P);const W=this.addVertex(d,p);this.outIndices.emplaceBack(j,B,W)}}addQuad(e,i,a,o,d,p){const y=this.addVertex(e,d,p),T=this.addVertex(i,d,p),A=this.addVertex(a,d,p),M=this.addVertex(o,d,p);this.addTriangle(y,T,A),this.addTriangle(A,M,y)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Js{constructor(e,i,a,o){this.unevaluatedPortals=new eu,this.portalPolygons=new ep,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Bd,this.vertexNormals=new Fd,this.indexArray=new is,this.tileToMeters=Ze(e),this.bridgeProgramConfigurations=new Ns(i,{zoom:a,lut:o},d=>d!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Ns(i,{zoom:a,lut:o},d=>d!=="fill-bridge-guard-rail-color")}addVertices(e,i){const a=this.unevalVertices.length;for(let o=0;o<e.length;o++)this.unevalVertices.push(e[o]),this.unevalHeights.push(i[o]);return a}addTriangles(e,i,a){const o=a?this.unevalTunnelTriangles:this.unevalTriangles;for(const d of e)o.push(d+i)}addRenderableRing(e,i,a,o,d,p){const y=[new Mt(d.min.x,d.min.y),new Mt(d.max.x,d.min.y),new Mt(d.max.x,d.max.y),new Mt(d.min.x,d.max.y)];for(let T=0;T<a-1;T++){const A=i+T,M=A+1,z=this.unevalVertices[A],P=this.unevalVertices[M];if(!(z.x>=d.min.x&&z.x<=d.max.x&&z.y>=d.min.y&&z.y<=d.max.y||P.x>=d.min.x&&P.x<=d.max.x&&P.y>=d.min.y&&P.y<=d.max.y||Xs(z,P,y))||this.isOnBorder(z.x,P.x)||this.isOnBorder(z.y,P.y))continue;const j=Js.computeEdgeHash(this.unevalVertices[A],this.unevalVertices[M]);let B,W=this.vertexHashLookup.get(Js.computePosHash(z));W!=null?B=W.next:(W=this.vertexHashLookup.get(Js.computePosHash(P)),B=W!=null?W.prev:j),this.unevalEdges.push({polygonIdx:e,a:A,b:M,hash:j,portalHash:B,isTunnel:o,type:"unevaluated",featureInfo:p})}}addPortalCandidates(e,i,a,o,d){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:d});const p=i[0];this.vertexHashLookup.clear();let y=Js.computeEdgeHash(p[p.length-2],p[p.length-1]);for(let T=0;T<p.length-1;T++){const A=p[T+0],M=p[T+1],z=Ea(M.x-A.x,M.y-A.y),P=hs(z);if(P===0)continue;let j="unevaluated";const B=o.pointElevation(A),W=o.pointElevation(M);Math.abs(B)<.01&&Math.abs(W)<.01?j="entrance":(this.isOnBorder(A.x,M.x)||this.isOnBorder(A.y,M.y))&&(j="border");const Y=Js.computeEdgeHash(A,M);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:A,vb:M,vab:z,length:P,hash:Y,isTunnel:a,type:j});const K=Js.computePosHash(A);this.vertexHashLookup.set(K,{prev:y,next:Y}),y=Y}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),a=P=>{P.primitiveLength=this.indexArray.length-P.primitiveOffset},o=new $1(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const d=i(),p=i(),y=i(),T=(P,j)=>{P.sort((W,Y)=>W.type===j&&Y.type!==j?-1:W.type!==j&&Y.type===j?1:0);const B=P.findIndex(W=>W.type!==j);return B>=0?B:P.length};let A=0;this.unevalEdges.length>0&&(A=T(this.unevalEdges,"none"),this.constructBridgeStructures(o,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},this.tileToMeters)),a(y);const M=i(),z=i();if(this.unevalEdges.length>0){const P=this.unevalEdges.splice(A),j=T(P,"tunnel")+A;this.unevalEdges.push(...P),this.constructTunnelStructures(o,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},{min:A,max:j})}a(M),o.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),a(z),o.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),a(p),o.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),a(d),this.maskSegments=qn.simpleSegment(0,z.primitiveOffset,0,z.primitiveLength),this.depthSegments=qn.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength),this.renderableBridgeSegments=qn.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.renderableTunnelSegments=qn.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.shadowCasterSegments=qn.simpleSegment(0,d.primitiveOffset,0,d.primitiveLength)}update(e,i,a,o,d,p,y,T){this.bridgeProgramConfigurations.updatePaintArrays(e,i,d,a,o,p,y,T),this.tunnelProgramConfigurations.updatePaintArrays(e,i,d,a,o,p,y,T)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,A0.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,l_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,a,o,d){const p=(y,T)=>{for(let A=0;A<T.length-1;A++){const M=T[A].featureIndex,z=T[A+1].vertexStart,P=e.feature(M);y.populatePaintArrays(z,P,M,{},a,i,o,void 0,d)}};p(this.bridgeProgramConfigurations,this.bridgeFeatureSections),p(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,a,o,d){const p=new Map;for(let y=o;y<d;y++){const T=a[y],A=T.a,M=T.b,z=Js.computePosHash(e[A]),P=Js.computePosHash(e[M]);let j=p.get(z);j||(j={},p.set(z,j));let B=p.get(P);B||(B={},p.set(P,B)),i[A]<=0&&i[M]<=0||(j.to=M,B.from=A)}return p}isTerminalVertex(e,i){const a=Js.computePosHash(this.unevalVertices[e]),o=i.get(a);return!o||!o.from||!o.to}constructBridgeStructures(e,i,a,o,d,p){e.clearVertexLookup();const y=this.computeVertexConnections(i,a,o,d.min,d.max),T=1/p,A=.5*T,M=(Et,Ot)=>Bi(Et,i[Ot].x,i[Ot].y,a[Ot]*T),z=lt(),P=lt(),j=lt(),B=lt(),W=lt(),Y=(Et,Ot)=>{const dt=y.get(Js.computePosHash(i[Ot])),At=dt.from,at=dt.to;if(!At||!at)return;M(z,At),M(P,Ot),M(j,at),Mn(B),Nn(z,P)||(In(W,P,z),Ti(B,W)),Nn(j,P)||(In(W,j,P),Wt(B,B,Ti(W,W)));const tt=bs(B);return tt>0?Ft(Et,B,1/tt):void 0};let K=Number.POSITIVE_INFINITY;this.sortSubarray(o,d.min,d.max,(Et,Ot)=>Et.featureInfo.featureIndex-Ot.featureInfo.featureIndex);const re=lt(),se=lt(),ue=lt(),Re=lt(),Me=lt(),Ne=lt(),Fe=lt(),Ue=lt(),pt=lt(),$e=[lt(),lt(),lt(),lt()],yt=[lt(),lt(),lt(),lt()],It=[{coord:new Mt(0,0),height:0},{coord:new Mt(0,0),height:0}],bt=(Et,Ot)=>Et>Ot;for(let Et=d.min;Et<d.max;Et++){const Ot=o[Et];if(!Ot.featureInfo.guardRailEnabled||!this.prepareEdgePoints(It,i,a,Ot,bt))continue;const[dt,At]=It;if(Bi(re,dt.coord.x,dt.coord.y,T*dt.height),Bi(se,At.coord.x,At.coord.y,T*At.height),Nn(re,se))continue;In(ue,se,re),Ti(ue,ue);const at=Y(Ue,Ot.a)||ue,tt=Y(pt,Ot.b)||ue;Bi(Re,at[1],-at[0],0),Ti(Re,Re),Bi(Me,tt[1],-tt[0],0),Ti(Me,Me),Ii(Ue,Re,at),Ti(Ne,Ue),Ii(Ue,Me,tt),Ti(Fe,Ue),Wt($e[0],re,Ft(Ue,In(Ue,Re,Ne),A)),Wt($e[1],re,Ft(Ue,Wt(Ue,Re,Ne),A)),Wt($e[2],re,Ft(Ue,Ne,A)),$e[3]=re,Wt(yt[0],se,Ft(Ue,In(Ue,Me,Fe),A)),Wt(yt[1],se,Ft(Ue,Wt(Ue,Me,Fe),A)),Wt(yt[2],se,Ft(Ue,Fe,A)),yt[3]=se,K=this.addFeatureSection(Ot.featureInfo.featureIndex,K,this.bridgeFeatureSections,e);const Nt=e.addVertex($e[0],Re,p),Pt=e.addVertex($e[1],Re,p),vi=e.addVertex(yt[0],Me,p),ai=e.addVertex(yt[1],Me,p);e.addTriangle(Nt,Pt,vi),e.addTriangle(Pt,ai,vi);const fi=e.addVertex($e[1],Ne,p),Ht=e.addVertex($e[2],Ne,p),xi=e.addVertex(yt[1],Fe,p),Gi=e.addVertex(yt[2],Fe,p);e.addTriangle(fi,Ht,xi),e.addTriangle(Ht,Gi,xi),Yi(Re,Re),Yi(Me,Me);const Xt=e.addVertex($e[2],Re,p),mi=e.addVertex($e[3],Re,p),Oi=e.addVertex(yt[2],Me,p),Qi=e.addVertex(yt[3],Me,p);e.addTriangle(Xt,mi,Oi),e.addTriangle(mi,Qi,Oi);const hn=this.isTerminalVertex(Ot.a,y),nn=this.isTerminalVertex(Ot.b,y);dt.height<.01&&hn&&e.addQuad($e[3],$e[2],$e[1],$e[0],Yi(at,at),p),At.height<.01&&nn&&e.addQuad(yt[0],yt[1],yt[2],yt[3],tt,p)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,a,o,d,p){e.clearVertexLookup();let y=Number.POSITIVE_INFINITY;const T=(K,re)=>K.featureInfo.featureIndex-re.featureInfo.featureIndex;this.sortSubarray(o,d.min,d.max,T),this.sortSubarray(o,p.min,p.max,T);const A=K=>Ti(K,K),M=[{coord:new Mt(0,0),height:0},{coord:new Mt(0,0),height:0}],z=(K,re)=>K<re,P=lt(),j=lt(),B=lt(),W=lt(),Y=lt();for(let K=d.min;K<d.max;K++){if(!this.prepareEdgePoints(M,i,a,o[K],z))continue;const[re,se]=M,ue=A(Bi(Y,-(se.coord.y-re.coord.y),se.coord.x-re.coord.x,0));y=this.addFeatureSection(o[K].featureInfo.featureIndex,y,this.tunnelFeatureSections,e),e.addQuad(Bi(P,re.coord.x,re.coord.y,re.height),Bi(j,se.coord.x,se.coord.y,se.height),Bi(B,se.coord.x,se.coord.y,o[K].isTunnel?-.1:0),Bi(W,re.coord.x,re.coord.y,o[K].isTunnel?-.1:0),ue)}for(let K=p.min;K<p.max;K++){const re=o[K];re.isTunnel&&([re.a,re.b]=[re.b,re.a]);const se=i[re.a],ue=i[re.b],Re=A(Bi(Y,-(ue.y-se.y),ue.x-se.x,0));y=this.addFeatureSection(re.featureInfo.featureIndex,y,this.tunnelFeatureSections,e),e.addQuad(Bi(P,ue.x,ue.y,0),Bi(j,se.x,se.y,0),Bi(B,se.x,se.y,a[re.a]+4),Bi(W,ue.x,ue.y,a[re.b]+4),Re),e.addQuad(Bi(P,se.x,se.y,0),Bi(j,ue.x,ue.y,0),Bi(B,ue.x,ue.y,a[re.b]+4),Bi(W,se.x,se.y,a[re.a]+4),Re)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,a,o){e.coord.x=i,e.coord.y=a,e.height=o}prepareEdgePoints(e,i,a,o,d){let p=i[o.a].x,y=i[o.a].y,T=i[o.b].x,A=i[o.b].y,M=a[o.a],z=a[o.b];const P=d(M,0),j=d(z,0);if(P&&j)return this.setElevatedPoint(e[0],p,y,M),this.setElevatedPoint(e[1],T,A,z),!0;if(!P&&!j)return!1;if(P){if(!j){const B=z/(z-M);T=zi(T,p,B),A=zi(A,y,B),z=zi(z,M,B)}}else{const B=M/(M-z);p=zi(p,T,B),y=zi(y,A,B),M=zi(M,z,B)}return this.setElevatedPoint(e[0],p,y,M),this.setElevatedPoint(e[1],T,A,z),!0}prepareEdges(e,i){if(i.length===0)return;i.sort((y,T)=>y.hash===T.hash?T.polygonIdx-y.polygonIdx:T.hash>y.hash?1:-1);let a=0,o=0,d=0,p=i[a].polygonIdx;do o++,(o===i.length||i[a].hash!==i[o].hash)&&((o-a==1||i[o-1].polygonIdx!==p)&&(d<a&&(i[d]=i[a],i[a]=null),i[d].type="none",d++),a=o,a!==i.length&&(p=i[a].polygonIdx));while(a!==i.length);if(i.splice(d),i.length!==0&&e.length!==0){i.sort((A,M)=>A.portalHash<M.portalHash?1:-1);let y=0,T=0;for(;y!==i.length&&T!==e.length;){const A=i[y],M=e[T];A.portalHash>M.hash?y++:M.hash>A.portalHash?T++:(A.type=M.type,y++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=Vt&&i>=Vt}addFeatureSection(e,i,a,o){return e!==i&&(i=e,a.push({featureIndex:e,vertexStart:o.getVertexCount()}),o.clearVertexLookup()),i}sortSubarray(e,i,a,o){const d=e.slice(i,a);d.sort(o),e.splice(i,d.length,...d)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Js.computePosHash(e))<<32n|BigInt(Js.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var tp,f_={exports:{}},cm=(tp||(tp=1,function(n,e){(function(i){function a(fe,me){return fe>me?1:fe<me?-1:0}var o=function(fe,me){fe===void 0&&(fe=a),me===void 0&&(me=!1),this._compare=fe,this._root=null,this._size=0,this._noDuplicates=!!me},d={size:{configurable:!0}};function p(fe,me,st,ft,Zt){var $t=Zt-ft;if($t>0){var ci=ft+Math.floor($t/2),Si={key:me[ci],data:st[ci],parent:fe};return Si.left=p(Si,me,st,ft,ci),Si.right=p(Si,me,st,ci+1,Zt),Si}return null}function y(fe,me,st,ft,Zt){if(!(st>=ft)){for(var $t=fe[st+ft>>1],ci=st-1,Si=ft+1;;){do ci++;while(Zt(fe[ci],$t)<0);do Si--;while(Zt(fe[Si],$t)>0);if(ci>=Si)break;var dn=fe[ci];fe[ci]=fe[Si],fe[Si]=dn,dn=me[ci],me[ci]=me[Si],me[Si]=dn}y(fe,me,st,Si,Zt),y(fe,me,Si+1,ft,Zt)}}o.prototype.rotateLeft=function(fe){var me=fe.right;me&&(fe.right=me.left,me.left&&(me.left.parent=fe),me.parent=fe.parent),fe.parent?fe===fe.parent.left?fe.parent.left=me:fe.parent.right=me:this._root=me,me&&(me.left=fe),fe.parent=me},o.prototype.rotateRight=function(fe){var me=fe.left;me&&(fe.left=me.right,me.right&&(me.right.parent=fe),me.parent=fe.parent),fe.parent?fe===fe.parent.left?fe.parent.left=me:fe.parent.right=me:this._root=me,me&&(me.right=fe),fe.parent=me},o.prototype._splay=function(fe){for(;fe.parent;){var me=fe.parent;me.parent?me.left===fe&&me.parent.left===me?(this.rotateRight(me.parent),this.rotateRight(me)):me.right===fe&&me.parent.right===me?(this.rotateLeft(me.parent),this.rotateLeft(me)):me.left===fe&&me.parent.right===me?(this.rotateRight(me),this.rotateLeft(me)):(this.rotateLeft(me),this.rotateRight(me)):me.left===fe?this.rotateRight(me):this.rotateLeft(me)}},o.prototype.splay=function(fe){for(var me,st,ft,Zt,$t;fe.parent;)(st=(me=fe.parent).parent)&&st.parent?((ft=st.parent).left===st?ft.left=fe:ft.right=fe,fe.parent=ft):(fe.parent=null,this._root=fe),Zt=fe.left,$t=fe.right,fe===me.left?(st&&(st.left===me?(me.right?(st.left=me.right,st.left.parent=st):st.left=null,me.right=st,st.parent=me):(Zt?(st.right=Zt,Zt.parent=st):st.right=null,fe.left=st,st.parent=fe)),$t?(me.left=$t,$t.parent=me):me.left=null,fe.right=me,me.parent=fe):(st&&(st.right===me?(me.left?(st.right=me.left,st.right.parent=st):st.right=null,me.left=st,st.parent=me):($t?(st.left=$t,$t.parent=st):st.left=null,fe.right=st,st.parent=fe)),Zt?(me.right=Zt,Zt.parent=me):me.right=null,fe.left=me,me.parent=fe)},o.prototype.replace=function(fe,me){fe.parent?fe===fe.parent.left?fe.parent.left=me:fe.parent.right=me:this._root=me,me&&(me.parent=fe.parent)},o.prototype.minNode=function(fe){if(fe===void 0&&(fe=this._root),fe)for(;fe.left;)fe=fe.left;return fe},o.prototype.maxNode=function(fe){if(fe===void 0&&(fe=this._root),fe)for(;fe.right;)fe=fe.right;return fe},o.prototype.insert=function(fe,me){var st=this._root,ft=null,Zt=this._compare;if(this._noDuplicates)for(;st;){if(ft=st,Zt(st.key,fe)===0)return;st=Zt(st.key,fe)<0?st.right:st.left}else for(;st;)ft=st,st=Zt(st.key,fe)<0?st.right:st.left;return st={key:fe,data:me,left:null,right:null,parent:ft},ft?Zt(ft.key,st.key)<0?ft.right=st:ft.left=st:this._root=st,this.splay(st),this._size++,st},o.prototype.find=function(fe){for(var me=this._root,st=this._compare;me;){var ft=st(me.key,fe);if(ft<0)me=me.right;else{if(!(ft>0))return me;me=me.left}}return null},o.prototype.contains=function(fe){for(var me=this._root,st=this._compare;me;){var ft=st(fe,me.key);if(ft===0)return!0;me=ft<0?me.left:me.right}return!1},o.prototype.remove=function(fe){var me=this.find(fe);if(!me)return!1;if(this.splay(me),me.left)if(me.right){var st=this.minNode(me.right);st.parent!==me&&(this.replace(st,st.right),st.right=me.right,st.right.parent=st),this.replace(me,st),st.left=me.left,st.left.parent=st}else this.replace(me,me.left);else this.replace(me,me.right);return this._size--,!0},o.prototype.removeNode=function(fe){if(!fe)return!1;if(this.splay(fe),fe.left)if(fe.right){var me=this.minNode(fe.right);me.parent!==fe&&(this.replace(me,me.right),me.right=fe.right,me.right.parent=me),this.replace(fe,me),me.left=fe.left,me.left.parent=me}else this.replace(fe,fe.left);else this.replace(fe,fe.right);return this._size--,!0},o.prototype.erase=function(fe){var me=this.find(fe);if(me){this.splay(me);var st=me.left,ft=me.right,Zt=null;st&&(st.parent=null,Zt=this.maxNode(st),this.splay(Zt),this._root=Zt),ft&&(st?Zt.right=ft:this._root=ft,ft.parent=Zt),this._size--}},o.prototype.pop=function(){var fe=this._root,me=null;if(fe){for(;fe.left;)fe=fe.left;me={key:fe.key,data:fe.data},this.remove(fe.key)}return me},o.prototype.next=function(fe){var me=fe;if(me)if(me.right)for(me=me.right;me&&me.left;)me=me.left;else for(me=fe.parent;me&&me.right===fe;)fe=me,me=me.parent;return me},o.prototype.prev=function(fe){var me=fe;if(me)if(me.left)for(me=me.left;me&&me.right;)me=me.right;else for(me=fe.parent;me&&me.left===fe;)fe=me,me=me.parent;return me},o.prototype.forEach=function(fe){for(var me=this._root,st=[],ft=!1,Zt=0;!ft;)me?(st.push(me),me=me.left):st.length>0?(fe(me=st.pop(),Zt++),me=me.right):ft=!0;return this},o.prototype.range=function(fe,me,st,ft){for(var Zt=[],$t=this._compare,ci=this._root;Zt.length!==0||ci;)if(ci)Zt.push(ci),ci=ci.left;else{if($t((ci=Zt.pop()).key,me)>0)break;if($t(ci.key,fe)>=0&&st.call(ft,ci))return this;ci=ci.right}return this},o.prototype.keys=function(){for(var fe=this._root,me=[],st=[],ft=!1;!ft;)fe?(me.push(fe),fe=fe.left):me.length>0?(fe=me.pop(),st.push(fe.key),fe=fe.right):ft=!0;return st},o.prototype.values=function(){for(var fe=this._root,me=[],st=[],ft=!1;!ft;)fe?(me.push(fe),fe=fe.left):me.length>0?(fe=me.pop(),st.push(fe.data),fe=fe.right):ft=!0;return st},o.prototype.at=function(fe){for(var me=this._root,st=[],ft=!1,Zt=0;!ft;)if(me)st.push(me),me=me.left;else if(st.length>0){if(me=st.pop(),Zt===fe)return me;Zt++,me=me.right}else ft=!0;return null},o.prototype.load=function(fe,me,st){if(fe===void 0&&(fe=[]),me===void 0&&(me=[]),st===void 0&&(st=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var ft=fe.length;return st&&y(fe,me,0,ft-1,this._compare),this._root=p(null,fe,me,0,ft),this._size=ft,this},o.prototype.min=function(){var fe=this.minNode(this._root);return fe?fe.key:null},o.prototype.max=function(){var fe=this.maxNode(this._root);return fe?fe.key:null},o.prototype.isEmpty=function(){return this._root===null},d.size.get=function(){return this._size},o.createTree=function(fe,me,st,ft,Zt){return new o(st,Zt).load(fe,me,ft)},Object.defineProperties(o.prototype,d);var T=0,A=1,M=2,z=3,P=0,j=1,B=2,W=3;function Y(fe,me,st){me===null?(fe.inOut=!1,fe.otherInOut=!0):(fe.isSubject===me.isSubject?(fe.inOut=!me.inOut,fe.otherInOut=me.otherInOut):(fe.inOut=!me.otherInOut,fe.otherInOut=me.isVertical()?!me.inOut:me.inOut),me&&(fe.prevInResult=!K(me,st)||me.isVertical()?me.prevInResult:me));var ft=K(fe,st);fe.resultTransition=ft?function(Zt,$t){var ci,Si=!Zt.inOut,dn=!Zt.otherInOut;switch($t){case P:ci=Si&&dn;break;case j:ci=Si||dn;break;case W:ci=Si^dn;break;case B:ci=Zt.isSubject?Si&&!dn:dn&&!Si}return ci?1:-1}(fe,st):0}function K(fe,me){switch(fe.type){case T:switch(me){case P:return!fe.otherInOut;case j:return fe.otherInOut;case B:return fe.isSubject&&fe.otherInOut||!fe.isSubject&&!fe.otherInOut;case W:return!0}break;case M:return me===P||me===j;case z:return me===B;case A:return!1}return!1}var re=function(fe,me,st,ft,Zt){this.left=me,this.point=fe,this.otherEvent=st,this.isSubject=ft,this.type=Zt||T,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},se={inResult:{configurable:!0}};function ue(fe,me){return fe[0]===me[0]&&fe[1]===me[1]}re.prototype.isBelow=function(fe){var me=this.point,st=this.otherEvent.point;return this.left?(me[0]-fe[0])*(st[1]-fe[1])-(st[0]-fe[0])*(me[1]-fe[1])>0:(st[0]-fe[0])*(me[1]-fe[1])-(me[0]-fe[0])*(st[1]-fe[1])>0},re.prototype.isAbove=function(fe){return!this.isBelow(fe)},re.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},se.inResult.get=function(){return this.resultTransition!==0},re.prototype.clone=function(){var fe=new re(this.point,this.left,this.otherEvent,this.isSubject,this.type);return fe.contourId=this.contourId,fe.resultTransition=this.resultTransition,fe.prevInResult=this.prevInResult,fe.isExteriorRing=this.isExteriorRing,fe.inOut=this.inOut,fe.otherInOut=this.otherInOut,fe},Object.defineProperties(re.prototype,se);var Re=11102230246251565e-32,Me=134217729,Ne=(3+8*Re)*Re;function Fe(fe,me,st,ft,Zt){var $t,ci,Si,dn,mn=me[0],an=ft[0],Yn=0,Cr=0;an>mn==an>-mn?($t=mn,mn=me[++Yn]):($t=an,an=ft[++Cr]);var sn=0;if(Yn<fe&&Cr<st)for(an>mn==an>-mn?(Si=$t-((ci=mn+$t)-mn),mn=me[++Yn]):(Si=$t-((ci=an+$t)-an),an=ft[++Cr]),$t=ci,Si!==0&&(Zt[sn++]=Si);Yn<fe&&Cr<st;)an>mn==an>-mn?(Si=$t-((ci=$t+mn)-(dn=ci-$t))+(mn-dn),mn=me[++Yn]):(Si=$t-((ci=$t+an)-(dn=ci-$t))+(an-dn),an=ft[++Cr]),$t=ci,Si!==0&&(Zt[sn++]=Si);for(;Yn<fe;)Si=$t-((ci=$t+mn)-(dn=ci-$t))+(mn-dn),mn=me[++Yn],$t=ci,Si!==0&&(Zt[sn++]=Si);for(;Cr<st;)Si=$t-((ci=$t+an)-(dn=ci-$t))+(an-dn),an=ft[++Cr],$t=ci,Si!==0&&(Zt[sn++]=Si);return $t===0&&sn!==0||(Zt[sn++]=$t),sn}function Ue(fe){return new Float64Array(fe)}var pt=33306690738754716e-32,$e=22204460492503146e-32,yt=11093356479670487e-47,It=Ue(4),bt=Ue(8),Et=Ue(12),Ot=Ue(16),dt=Ue(4);function At(fe,me,st){var ft=function(Zt,$t,ci,Si,dn,mn){var an=($t-mn)*(ci-dn),Yn=(Zt-dn)*(Si-mn),Cr=an-Yn;if(an===0||Yn===0||an>0!=Yn>0)return Cr;var sn=Math.abs(an+Yn);return Math.abs(Cr)>=pt*sn?Cr:-function(gr,er,Fn,vr,br,hr,_r){var tr,gn,nr,Pr,ji,Pn,wr,Br,Tr,xs,sr,us,Do,ba,da,Po,id,vs,zs=gr-br,wa=Fn-br,Za=er-hr,Oa=vr-hr;It[0]=(da=(Br=zs-(wr=(Pn=Me*zs)-(Pn-zs)))*(xs=Oa-(Tr=(Pn=Me*Oa)-(Pn-Oa)))-((ba=zs*Oa)-wr*Tr-Br*Tr-wr*xs))-((sr=da-(id=(Br=Za-(wr=(Pn=Me*Za)-(Pn-Za)))*(xs=wa-(Tr=(Pn=Me*wa)-(Pn-wa)))-((Po=Za*wa)-wr*Tr-Br*Tr-wr*xs)))+(ji=da-sr))+(ji-id),It[1]=(Do=ba-((us=ba+sr)-(ji=us-ba))+(sr-ji))-((sr=Do-Po)+(ji=Do-sr))+(ji-Po),It[2]=us-((vs=us+sr)-(ji=vs-us))+(sr-ji),It[3]=vs;var fp=function(nk,U3){for(var V3=U3[0],qx=1;qx<4;qx++)V3+=U3[qx];return V3}(0,It),q_=$e*_r;if(fp>=q_||-fp>=q_||(tr=gr-(zs+(ji=gr-zs))+(ji-br),nr=Fn-(wa+(ji=Fn-wa))+(ji-br),gn=er-(Za+(ji=er-Za))+(ji-hr),Pr=vr-(Oa+(ji=vr-Oa))+(ji-hr),tr===0&&gn===0&&nr===0&&Pr===0)||(q_=yt*_r+Ne*Math.abs(fp),(fp+=zs*Pr+Oa*tr-(Za*nr+wa*gn))>=q_||-fp>=q_))return fp;dt[0]=(da=(Br=tr-(wr=(Pn=Me*tr)-(Pn-tr)))*(xs=Oa-(Tr=(Pn=Me*Oa)-(Pn-Oa)))-((ba=tr*Oa)-wr*Tr-Br*Tr-wr*xs))-((sr=da-(id=(Br=gn-(wr=(Pn=Me*gn)-(Pn-gn)))*(xs=wa-(Tr=(Pn=Me*wa)-(Pn-wa)))-((Po=gn*wa)-wr*Tr-Br*Tr-wr*xs)))+(ji=da-sr))+(ji-id),dt[1]=(Do=ba-((us=ba+sr)-(ji=us-ba))+(sr-ji))-((sr=Do-Po)+(ji=Do-sr))+(ji-Po),dt[2]=us-((vs=us+sr)-(ji=vs-us))+(sr-ji),dt[3]=vs;var JA=Fe(4,It,4,dt,bt);dt[0]=(da=(Br=zs-(wr=(Pn=Me*zs)-(Pn-zs)))*(xs=Pr-(Tr=(Pn=Me*Pr)-(Pn-Pr)))-((ba=zs*Pr)-wr*Tr-Br*Tr-wr*xs))-((sr=da-(id=(Br=Za-(wr=(Pn=Me*Za)-(Pn-Za)))*(xs=nr-(Tr=(Pn=Me*nr)-(Pn-nr)))-((Po=Za*nr)-wr*Tr-Br*Tr-wr*xs)))+(ji=da-sr))+(ji-id),dt[1]=(Do=ba-((us=ba+sr)-(ji=us-ba))+(sr-ji))-((sr=Do-Po)+(ji=Do-sr))+(ji-Po),dt[2]=us-((vs=us+sr)-(ji=vs-us))+(sr-ji),dt[3]=vs;var QA=Fe(JA,bt,4,dt,Et);dt[0]=(da=(Br=tr-(wr=(Pn=Me*tr)-(Pn-tr)))*(xs=Pr-(Tr=(Pn=Me*Pr)-(Pn-Pr)))-((ba=tr*Pr)-wr*Tr-Br*Tr-wr*xs))-((sr=da-(id=(Br=gn-(wr=(Pn=Me*gn)-(Pn-gn)))*(xs=nr-(Tr=(Pn=Me*nr)-(Pn-nr)))-((Po=gn*nr)-wr*Tr-Br*Tr-wr*xs)))+(ji=da-sr))+(ji-id),dt[1]=(Do=ba-((us=ba+sr)-(ji=us-ba))+(sr-ji))-((sr=Do-Po)+(ji=Do-sr))+(ji-Po),dt[2]=us-((vs=us+sr)-(ji=vs-us))+(sr-ji),dt[3]=vs;var eC=Fe(QA,Et,4,dt,Ot);return Ot[eC-1]}(Zt,$t,ci,Si,dn,mn,sn)}(fe[0],fe[1],me[0],me[1],st[0],st[1]);return ft>0?-1:ft<0?1:0}function at(fe,me){var st=fe.point,ft=me.point;return st[0]>ft[0]?1:st[0]<ft[0]?-1:st[1]!==ft[1]?st[1]>ft[1]?1:-1:function(Zt,$t,ci,Si){return Zt.left!==$t.left?Zt.left?1:-1:At(ci,Zt.otherEvent.point,$t.otherEvent.point)!==0?Zt.isBelow($t.otherEvent.point)?-1:1:!Zt.isSubject&&$t.isSubject?1:-1}(fe,me,st)}function tt(fe,me,st){var ft=new re(me,!1,fe,fe.isSubject),Zt=new re(me,!0,fe.otherEvent,fe.isSubject);return ue(fe.point,fe.otherEvent.point)&&console.warn("what is that, a collapsed segment?",fe),ft.contourId=Zt.contourId=fe.contourId,at(Zt,fe.otherEvent)>0&&(fe.otherEvent.left=!0,Zt.left=!1),fe.otherEvent.otherEvent=Zt,fe.otherEvent=ft,st.push(Zt),st.push(ft),st}function Nt(fe,me){return fe[0]*me[1]-fe[1]*me[0]}function Pt(fe,me){return fe[0]*me[0]+fe[1]*me[1]}function vi(fe,me,st){var ft=function(dn,mn,an,Yn,Cr){var sn=[mn[0]-dn[0],mn[1]-dn[1]],gr=[Yn[0]-an[0],Yn[1]-an[1]];function er(Pn,wr,Br){return[Pn[0]+wr*Br[0],Pn[1]+wr*Br[1]]}var Fn=[an[0]-dn[0],an[1]-dn[1]],vr=Nt(sn,gr),br=vr*vr,hr=Pt(sn,sn);if(br>0){var _r=Nt(Fn,gr)/vr;if(_r<0||_r>1)return null;var tr=Nt(Fn,sn)/vr;return tr<0||tr>1?null:_r===0||_r===1?[er(dn,_r,sn)]:tr===0||tr===1?[er(an,tr,gr)]:[er(dn,_r,sn)]}if((br=(vr=Nt(Fn,sn))*vr)>0)return null;var gn=Pt(sn,Fn)/hr,nr=gn+Pt(sn,gr)/hr,Pr=Math.min(gn,nr),ji=Math.max(gn,nr);return Pr<=1&&ji>=0?Pr===1?[er(dn,Pr>0?Pr:0,sn)]:ji===0?[er(dn,ji<1?ji:1,sn)]:[er(dn,Pr>0?Pr:0,sn),er(dn,ji<1?ji:1,sn)]:null}(fe.point,fe.otherEvent.point,me.point,me.otherEvent.point),Zt=ft?ft.length:0;if(Zt===0||Zt===1&&(ue(fe.point,me.point)||ue(fe.otherEvent.point,me.otherEvent.point))||Zt===2&&fe.isSubject===me.isSubject)return 0;if(Zt===1)return ue(fe.point,ft[0])||ue(fe.otherEvent.point,ft[0])||tt(fe,ft[0],st),ue(me.point,ft[0])||ue(me.otherEvent.point,ft[0])||tt(me,ft[0],st),1;var $t=[],ci=!1,Si=!1;return ue(fe.point,me.point)?ci=!0:at(fe,me)===1?$t.push(me,fe):$t.push(fe,me),ue(fe.otherEvent.point,me.otherEvent.point)?Si=!0:at(fe.otherEvent,me.otherEvent)===1?$t.push(me.otherEvent,fe.otherEvent):$t.push(fe.otherEvent,me.otherEvent),ci&&Si||ci?(me.type=A,fe.type=me.inOut===fe.inOut?M:z,ci&&!Si&&tt($t[1].otherEvent,$t[0].point,st),2):Si?(tt($t[0],$t[1].point,st),3):$t[0]!==$t[3].otherEvent?(tt($t[0],$t[1].point,st),tt($t[1],$t[2].point,st),3):(tt($t[0],$t[1].point,st),tt($t[3].otherEvent,$t[2].point,st),3)}function ai(fe,me){if(fe===me)return 0;if(At(fe.point,fe.otherEvent.point,me.point)!==0||At(fe.point,fe.otherEvent.point,me.otherEvent.point)!==0)return ue(fe.point,me.point)?fe.isBelow(me.otherEvent.point)?-1:1:fe.point[0]===me.point[0]?fe.point[1]<me.point[1]?-1:1:at(fe,me)===1?me.isAbove(fe.point)?-1:1:fe.isBelow(me.point)?-1:1;if(fe.isSubject!==me.isSubject)return fe.isSubject?-1:1;var st=fe.point,ft=me.point;return st[0]===ft[0]&&st[1]===ft[1]?(st=fe.otherEvent.point)[0]===(ft=me.otherEvent.point)[0]&&st[1]===ft[1]?0:fe.contourId>me.contourId?1:-1:at(fe,me)===1?1:-1}var fi=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Ht(fe,me,st,ft){var Zt,$t=fe+1,ci=me[fe].point,Si=me.length;for($t<Si&&(Zt=me[$t].point);$t<Si&&Zt[0]===ci[0]&&Zt[1]===ci[1];){if(!st[$t])return $t;++$t<Si&&(Zt=me[$t].point)}for($t=fe-1;st[$t]&&$t>ft;)$t--;return $t}fi.prototype.isExterior=function(){return this.holeOf==null};var xi=Xt,Gi=Xt;function Xt(fe,me){if(!(this instanceof Xt))return new Xt(fe,me);if(this.data=fe||[],this.length=this.data.length,this.compare=me||mi,this.length>0)for(var st=(this.length>>1)-1;st>=0;st--)this._down(st)}function mi(fe,me){return fe<me?-1:fe>me?1:0}Xt.prototype={push:function(fe){this.data.push(fe),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var fe=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),fe}},peek:function(){return this.data[0]},_up:function(fe){for(var me=this.data,st=this.compare,ft=me[fe];fe>0;){var Zt=fe-1>>1,$t=me[Zt];if(st(ft,$t)>=0)break;me[fe]=$t,fe=Zt}me[fe]=ft},_down:function(fe){for(var me=this.data,st=this.compare,ft=this.length>>1,Zt=me[fe];fe<ft;){var $t=1+(fe<<1),ci=$t+1,Si=me[$t];if(ci<this.length&&st(me[ci],Si)<0&&($t=ci,Si=me[ci]),st(Si,Zt)>=0)break;me[fe]=Si,fe=$t}me[fe]=Zt}},xi.default=Gi;var Oi=Math.max,Qi=Math.min,hn=0;function nn(fe,me,st,ft,Zt,$t){var ci,Si,dn,mn,an,Yn;for(ci=0,Si=fe.length-1;ci<Si;ci++)if(mn=fe[ci+1],an=new re(dn=fe[ci],!1,void 0,me),Yn=new re(mn,!1,an,me),an.otherEvent=Yn,dn[0]!==mn[0]||dn[1]!==mn[1]){an.contourId=Yn.contourId=st,$t||(an.isExteriorRing=!1,Yn.isExteriorRing=!1),at(an,Yn)>0?Yn.left=!0:an.left=!0;var Cr=dn[0],sn=dn[1];Zt[0]=Qi(Zt[0],Cr),Zt[1]=Qi(Zt[1],sn),Zt[2]=Oi(Zt[2],Cr),Zt[3]=Oi(Zt[3],sn),ft.push(an),ft.push(Yn)}}var ui=[];function en(fe,me,st){typeof fe[0][0][0]=="number"&&(fe=[fe]),typeof me[0][0][0]=="number"&&(me=[me]);var ft=function(sn,gr,er){var Fn=null;return sn.length*gr.length==0&&(er===P?Fn=ui:er===B?Fn=sn:er!==j&&er!==W||(Fn=sn.length===0?gr:sn)),Fn}(fe,me,st);if(ft)return ft===ui?null:ft;var Zt=[1/0,1/0,-1/0,-1/0],$t=[1/0,1/0,-1/0,-1/0],ci=function(sn,gr,er,Fn,vr){var br,hr,_r,tr,gn,nr,Pr=new xi(null,at);for(_r=0,tr=sn.length;_r<tr;_r++)for(gn=0,nr=(br=sn[_r]).length;gn<nr;gn++)(hr=gn===0)&&hn++,nn(br[gn],!0,hn,Pr,er,hr);for(_r=0,tr=gr.length;_r<tr;_r++)for(gn=0,nr=(br=gr[_r]).length;gn<nr;gn++)hr=gn===0,vr===B&&(hr=!1),hr&&hn++,nn(br[gn],!1,hn,Pr,Fn,hr);return Pr}(fe,me,Zt,$t,st);if(ft=function(sn,gr,er,Fn,vr){var br=null;return(er[0]>Fn[2]||Fn[0]>er[2]||er[1]>Fn[3]||Fn[1]>er[3])&&(vr===P?br=ui:vr===B?br=sn:vr!==j&&vr!==W||(br=sn.concat(gr))),br}(fe,me,Zt,$t,st))return ft===ui?null:ft;for(var Si=function(sn){var gr,er,Fn=function(_r){var tr,gn,nr,Pr,ji=[];for(gn=0,nr=_r.length;gn<nr;gn++)((tr=_r[gn]).left&&tr.inResult||!tr.left&&tr.otherEvent.inResult)&&ji.push(tr);for(var Pn=!1;!Pn;)for(Pn=!0,gn=0,nr=ji.length;gn<nr;gn++)gn+1<nr&&at(ji[gn],ji[gn+1])===1&&(Pr=ji[gn],ji[gn]=ji[gn+1],ji[gn+1]=Pr,Pn=!1);for(gn=0,nr=ji.length;gn<nr;gn++)(tr=ji[gn]).otherPos=gn;for(gn=0,nr=ji.length;gn<nr;gn++)(tr=ji[gn]).left||(Pr=tr.otherPos,tr.otherPos=tr.otherEvent.otherPos,tr.otherEvent.otherPos=Pr);return ji}(sn),vr={},br=[],hr=function(){if(!vr[gr]){var _r=br.length,tr=function(ji,Pn,wr){var Br=new fi;if(ji.prevInResult!=null){var Tr=ji.prevInResult,xs=Tr.outputContourId;if(Tr.resultTransition>0){var sr=Pn[xs];if(sr.holeOf!=null){var us=sr.holeOf;Pn[us].holeIds.push(wr),Br.holeOf=us,Br.depth=Pn[xs].depth}else Pn[xs].holeIds.push(wr),Br.holeOf=xs,Br.depth=Pn[xs].depth+1}else Br.holeOf=null,Br.depth=Pn[xs].depth}else Br.holeOf=null,Br.depth=0;return Br}(Fn[gr],br,_r),gn=function(ji){vr[ji]=!0,ji<Fn.length&&Fn[ji]&&(Fn[ji].outputContourId=_r)},nr=gr,Pr=gr;for(tr.points.push(Fn[gr].point);gn(nr),gn(nr=Fn[nr].otherPos),tr.points.push(Fn[nr].point),!((nr=Ht(nr,Fn,vr,Pr))==Pr||nr>=Fn.length)&&Fn[nr];);br.push(tr)}};for(gr=0,er=Fn.length;gr<er;gr++)hr();return br}(function(sn,gr,er,Fn,vr,br){for(var hr,_r,tr,gn=new o(ai),nr=[],Pr=Math.min(Fn[2],vr[2]);sn.length!==0;){var ji=sn.pop();if(nr.push(ji),br===P&&ji.point[0]>Pr||br===B&&ji.point[0]>Fn[2])break;if(ji.left){_r=hr=gn.insert(ji),hr=hr!==(tr=gn.minNode())?gn.prev(hr):null,_r=gn.next(_r);var Pn=hr?hr.key:null;if(Y(ji,Pn,br),_r&&vi(ji,_r.key,sn)===2&&(Y(ji,Pn,br),Y(_r.key,ji,br)),hr&&vi(hr.key,ji,sn)===2){var wr=hr;Y(Pn,(wr=wr!==tr?gn.prev(wr):null)?wr.key:null,br),Y(ji,Pn,br)}}else _r=hr=gn.find(ji=ji.otherEvent),hr&&_r&&(hr=hr!==tr?gn.prev(hr):null,_r=gn.next(_r),gn.remove(ji),_r&&hr&&vi(hr.key,_r.key,sn))}return nr}(ci,0,0,Zt,$t,st)),dn=[],mn=0;mn<Si.length;mn++){var an=Si[mn];if(an.isExterior()){for(var Yn=[an.points],Cr=0;Cr<an.holeIds.length;Cr++)Yn.push(Si[an.holeIds[Cr]].points);dn.push(Yn)}}return dn}var An={UNION:j,DIFFERENCE:B,INTERSECTION:P,XOR:W};i.diff=function(fe,me){return en(fe,me,B)},i.intersection=function(fe,me){return en(fe,me,P)},i.operations=An,i.union=function(fe,me){return en(fe,me,j)},i.xor=function(fe,me){return en(fe,me,W)},Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,f_.exports)),f_.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function ip(n,e,i,a){const o=[],d=a===0?(p,y,T,A,M,z)=>{p.push(new Mt(z,T+(z-y)/(A-y)*(M-T)))}:(p,y,T,A,M,z)=>{p.push(new Mt(y+(z-T)/(M-T)*(A-y),z))};for(const p of n){const y=[];for(const T of p){if(T.length<=2)continue;const A=[];for(let P=0;P<T.length-1;P++){const j=T[P].x,B=T[P].y,W=T[P+1].x,Y=T[P+1].y,K=a===0?j:B,re=a===0?W:Y;K<e?re>e&&d(A,j,B,W,Y,e):K>i?re<i&&d(A,j,B,W,Y,i):A.push(T[P]),re<e&&K>=e&&d(A,j,B,W,Y,e),re>i&&K<=i&&d(A,j,B,W,Y,i)}let M=T[T.length-1];const z=a===0?M.x:M.y;z>=e&&z<=i&&A.push(M),A.length&&(M=A[A.length-1],A[0].x===M.x&&A[0].y===M.y||A.push(A[0]),y.push(A))}y.length&&o.push(y)}return o}function p_(n,e){const i=cg(n),a=cg([e]),o=cm.intersection(i,a);return o==null?[]:m_(o)}function lg(n,e){let a=cg(n,65536);const o=[];for(;e.valid();e.next()){const[d,p]=e.get(),y=d.x*65536,T=d.y*65536,A=p.x*65536,M=p.y*65536,z=A-y,P=M-T,j=Math.hypot(z,P);if(j===0)continue;const B=Math.trunc(P/j*3),W=-Math.trunc(z/j*3);o.push([[[y,T],[A,M],[A+B,M+W],[y+B,T+W],[y,T]]])}return o.length>0&&(a=cm.diff(a,o)),m_(a,1/65536)}function cg(n,e=1){return[n.map(i=>i.map(a=>[a.x*e,a.y*e]))]}function m_(n,e=1){return n.map(i=>i.map((a,o)=>{const d=a.map(p=>new Mt(p[0]*e,p[1]*e).round());return o>0&&d.reverse(),d}))}class g_{constructor(e,i){this.layoutVertexArray=new oc,this.indexArray=new is,this.lineIndexArray=new Kr,this.triangleSegments=new qn,this.lineSegments=new qn,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Ao)}update(e,i,a,o,d,p,y,T){this.programConfigurations.updatePaintArrays(e,i,d,a,o,p,y,T)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,E0.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,a,o,d,p,y){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,a,o,d,p,void 0,y)}}class ug{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new g_(e,!1),this.elevationBufferData=new g_(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,a,o){this.hasPattern=og("fill",this.layers,this.pixelRatio,i);const d=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:y,id:T,index:A,sourceLayerIndex:M}of e){const z=this.layers[0]._featureFilter.needGeometry,P=Ct(y,z);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom,{worldview:this.worldview}),P,a))continue;const j=d?d.evaluate(P,{},a,i.availableImages):void 0,B={id:T,properties:y.properties,type:y.type,sourceLayerIndex:M,index:A,geometry:z?P.geometry:qt(y,a,o),patterns:{},sortKey:j};p.push(B)}d&&p.sort((y,T)=>y.sortKey-T.sortKey);for(const y of p){const{geometry:T,index:A,sourceLayerIndex:M}=y;if(this.hasPattern){const z=Kh("fill",this.layers,y,this.zoom,this.pixelRatio,i);this.patternFeatures.push(z)}else this.addFeature(y,T,A,a,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[A].feature,T,A,M,this.index)}}update(e,i,a,o,d,p,y){this.bufferData.update(e,i,a,o,d,p,y,this.worldview),this.elevationBufferData.update(e,i,a,o,d,p,y,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,a,o,d,p,y,this.worldview)}addFeatures(e,i,a,o,d,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,a,o,p,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,a,o,d,p=[],y,T){const A=lm(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,A,o,a,T):this.addGeometry(A,this.bufferData),this.bufferData.populatePaintArrays(e,a,d,p,o,y,this.worldview),this.elevationBufferData.populatePaintArrays(e,a,d,p,o,y,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,a,o,d){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,a,o,d,this.worldview))}addElevatedRoadFeature(e,i,a,o,d){const p=new Array,y=kn.getElevationFeature(e,d);if(!y)return void this.addGeometry(i,this.bufferData);{const A=this.clipPolygonsToTile(i,1);A.length>0&&p.push({polygons:A,elevationFeature:y,elevationTileID:a})}const T={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},a),featureIndex:o};for(const A of p)if(A.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Js(A.elevationTileID,this.layers,this.zoom,this.lut));const z=A.elevationFeature.isTunnel();let P=0;e.properties.hasOwnProperty(zn)&&(P=+e.properties[zn]);for(const j of A.polygons)this.elevatedStructures.addPortalCandidates(A.elevationFeature.id,j,z,A.elevationFeature,P)}A.elevationFeature.constantHeight==null&&(A.polygons=this.prepareElevatedPolygons(A.polygons,A.elevationFeature,A.elevationTileID));const M=new Zr(a,A.elevationTileID);this.addElevatedGeometry(A.polygons,M,A.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,o,T)}}addElevatedGeometry(e,i,a,o,d,p){const y={elevation:a,elevationSampler:i,bias:o,index:d,featureInfo:p},[T,A]=this.addGeometry(e,this.elevationBufferData,y);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:T,max:A}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,T),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,A))}addGeometry(e,i,a){let o=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,p=null;a&&(p=a.elevationSampler.constantElevation(a.elevation,a.bias),p!=null&&(o=p,d=p));const y=(T,A,M)=>{if(a!=null)if(A.push(T),p!=null)i.elevatedLayoutVertexArray.emplaceBack(p),M.push(p);else{const z=a.elevationSampler.pointElevation(T,a.elevation,a.bias);i.elevatedLayoutVertexArray.emplaceBack(z),M.push(z),o=Math.min(o,z),d=Math.max(d,z)}};for(const T of e){let A=0;for(const se of T)A+=se.length;const M=i.triangleSegments.prepareSegment(A,i.layoutVertexArray,i.indexArray),z=M.vertexLength,P=[],j=[],B=[],W=[],Y=[],K=i.layoutVertexArray.length;for(const se of T){if(se.length===0)continue;se!==T[0]&&j.push(P.length/2);const ue=i.lineSegments.prepareSegment(se.length,i.layoutVertexArray,i.lineIndexArray),Re=ue.vertexLength;a&&Y.push(i.layoutVertexArray.length-K),y(se[0],B,W),i.layoutVertexArray.emplaceBack(se[0].x,se[0].y),i.lineIndexArray.emplaceBack(Re+se.length-1,Re),P.push(se[0].x),P.push(se[0].y);for(let Me=1;Me<se.length;Me++)y(se[Me],B,W),i.layoutVertexArray.emplaceBack(se[Me].x,se[Me].y),i.lineIndexArray.emplaceBack(Re+Me-1,Re+Me),P.push(se[Me].x),P.push(se[Me].y);ue.vertexLength+=se.length,ue.primitiveLength+=se.length}const re=Xh(P,j);for(let se=0;se<re.length;se+=3)i.indexArray.emplaceBack(z+re[se],z+re[se+1],z+re[se+2]);if(re.length>0&&a&&this.elevationMode==="hd-road-base"){const se=a.elevation.isTunnel(),ue=a.elevation.safeArea,Re=this.elevatedStructures.addVertices(B,W);this.elevatedStructures.addTriangles(re,Re,se);const Me=Y.length;if(Me>0){for(let Ne=0;Ne<Me-1;Ne++)this.elevatedStructures.addRenderableRing(a.index,Y[Ne]+Re,Y[Ne+1]-Y[Ne],se,ue,a.featureInfo);this.elevatedStructures.addRenderableRing(a.index,Y[Me-1]+Re,B.length-Y[Me-1],se,ue,a.featureInfo)}}M.vertexLength+=A,M.primitiveLength+=re.length/3}return[o,d]}prepareElevatedPolygons(e,i,a){const o=1/Ze(a),d=[];for(const p of e){const y=lg(p,new vn(i,o));d.push(...y)}return d}clipPolygonsToTile(e,i){const a=-i,o=-i,d=Vt+i,p=Vt+i;let y=0;const T=[],A=[];for(;y<e.length;y++){const P=e[y],j=gh(P);(j.min.x>=a&&j.max.x<=d&&j.min.y>=o&&j.max.y<=p?T:A).push(P)}if(T.length===e.length)return e;const M=[new Mt(a,o),new Mt(d,o),new Mt(d,p),new Mt(a,p),new Mt(a,o)],z=T;for(const P of A)z.push(...p_(P,M));return z}}let np,O0,k0,N0;ri(ug,"FillBucket",{omit:["layers","patternFeatures"]}),ri(g_,"FillBufferData"),ri(Js,"ElevatedStructures");class Kd{constructor(e,i,a,o){if(this.triangleCount=i.length/3,this.min=new Mt(0,0),this.max=new Mt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[d,p]=[e[0].clone(),e[0].clone()];for(let z=1;z<e.length;++z){const P=e[z];d.x=Math.min(d.x,P.x),d.y=Math.min(d.y,P.y),p.x=Math.max(p.x,P.x),p.y=Math.max(p.y,P.y)}if(o){const z=Math.ceil(Math.max(p.x-d.x,p.y-d.y)/o);a=Math.max(a,z)}if(a===0)return;this.min=d,this.max=p;const y=this.max.sub(this.min);y.x=Math.max(y.x,1),y.y=Math.max(y.y,1);const T=Math.max(y.x,y.y)/a;this.cellsX=Math.max(1,Math.ceil(y.x/T)),this.cellsY=Math.max(1,Math.ceil(y.y/T)),this.xScale=1/T,this.yScale=1/T;const A=[];for(let z=0;z<this.triangleCount;z++){const P=e[i[3*z+0]].sub(this.min),j=e[i[3*z+1]].sub(this.min),B=e[i[3*z+2]].sub(this.min),W=sl(Math.floor(Math.min(P.x,j.x,B.x)),this.xScale,this.cellsX),Y=sl(Math.floor(Math.max(P.x,j.x,B.x)),this.xScale,this.cellsX),K=sl(Math.floor(Math.min(P.y,j.y,B.y)),this.yScale,this.cellsY),re=sl(Math.floor(Math.max(P.y,j.y,B.y)),this.yScale,this.cellsY),se=new Mt(0,0),ue=new Mt(0,0),Re=new Mt(0,0),Me=new Mt(0,0);for(let Ne=K;Ne<=re;++Ne){se.y=ue.y=Ne*T,Re.y=Me.y=(Ne+1)*T;for(let Fe=W;Fe<=Y;++Fe)se.x=Re.x=Fe*T,ue.x=Me.x=(Fe+1)*T,(Al(P,j,B,se,ue,Me)||Al(P,j,B,se,Me,Re))&&A.push({cellIdx:Ne*this.cellsX+Fe,triIdx:z})}}if(A.length===0)return;A.sort((z,P)=>z.cellIdx-P.cellIdx||z.triIdx-P.triIdx);let M=0;for(;M<A.length;){const z=A[M].cellIdx,P={start:this.payload.length,len:0};for(;M<A.length&&A[M].cellIdx===z;)++P.len,this.payload.push(A[M++].triIdx);this.cells[z]=P}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const a=sl(e.x-this.min.x,this.xScale,this.cellsX),o=sl(e.y-this.min.y,this.yScale,this.cellsY),d=this.cells[o*this.cellsX+a];if(d){this._lazyInitLookup();for(let p=0;p<d.len;p++){const y=this.payload[d.start+p],T=Math.floor(y/8),A=1<<y%8;if(!(this.lookup[T]&A)&&(this.lookup[T]|=A,i.push(y),i.length===this.triangleCount))return}}}query(e,i,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const o=sl(e.x-this.min.x,this.xScale,this.cellsX),d=sl(i.x-this.min.x,this.xScale,this.cellsX),p=sl(e.y-this.min.y,this.yScale,this.cellsY),y=sl(i.y-this.min.y,this.yScale,this.cellsY);for(let T=p;T<=y;T++)for(let A=o;A<=d;A++){const M=this.cells[T*this.cellsX+A];if(M)for(let z=0;z<M.len;z++){const P=this.payload[M.start+z],j=Math.floor(P/8),B=1<<P%8;if(!(this.lookup[j]&B)&&(this.lookup[j]|=B,a.push(P),a.length===this.triangleCount))return}}}}function sl(n,e,i){return Math.max(0,Math.min(i-1,Math.floor(n*e)))}ri(Kd,"TriangleGridIndex");class hg{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,i){for(const a of this.footprints)i.push({footprint:a,id:e})}populate(e,i,a,o){const d=[];for(const{feature:p,id:y,index:T,sourceLayerIndex:A}of e){const M=this.layers[0]._featureFilter.needGeometry,z=Ct(p,M);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom,{worldview:this.worldview}),z,a))continue;const P={id:y,properties:p.properties,type:p.type,sourceLayerIndex:A,index:T,geometry:M?z.geometry:qt(p,a,o),patterns:{}};d.push(P)}for(const p of d){const{geometry:y,index:T,sourceLayerIndex:A}=p;this.addFeature(p,y,T,a,{},i.availableImages,i.brightness),i.featureIndex.insert(e[T].feature,y,T,A,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,a,o,d,p,y){}destroy(){}addFeature(e,i,a,o,d,p=[],y){for(const T of lm(i,2)){const A=[],M=[],z=[],P=new Mt(1/0,1/0),j=new Mt(-1/0,-1/0);for(const Y of T)if(Y.length!==0){Y!==T[0]&&z.push(M.length/2);for(let K=0;K<Y.length;K++)M.push(Y[K].x),M.push(Y[K].y),A.push(Y[K]),P.x=Math.min(P.x,Y[K].x),P.y=Math.min(P.y,Y[K].y),j.x=Math.max(j.x,Y[K].x),j.y=Math.max(j.y,Y[K].y)}const B=Xh(M,z),W=new Kd(A,B,8,256);this.footprints.push({vertices:A,indices:B,grid:W,min:P,max:j})}}}ri(hg,"ClipBucket",{omit:["layers"]});const Z1=yn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),um=yn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),W1=yn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),j0=yn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),B0=yn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),F0=yn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:U0}=Z1,Jd=Number.MAX_SAFE_INTEGER,__=Jd-1;function hm(n,e,i,a){return n.order<e||n.order===Jd||!(n.clipMask&i)||function(o,d){return d.length!==0&&d.find(p=>p===o)===void 0}(a,n.clipScope)}function dg(n,e){return n.x-e.x||n.y-e.y}function V0(n,e){return dg(n.min,e.min)===0&&dg(n.max,e.max)===0}function dm(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function rp(n,e){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(n[i].sourceId!==e[i].sourceId||!V0(n[i],e[i])||n[i].order!==e[i].order||n[i].clipMask!==e[i].clipMask||!ea(n[i].clipScope,e[i].clipScope))return!1;return!0}function fm(n,e,i){const a=1/Vt,o=1/(1<<i.canonical.z),d=(e.x*a+i.canonical.x)*o+i.wrap,p=(e.y*a+i.canonical.y)*o;return{min:new Mt((n.x*a+i.canonical.x)*o+i.wrap,(n.y*a+i.canonical.y)*o),max:new Mt(d,p)}}function y_(n,e,i){const a=1<<i.canonical.z,o=((e.x-i.wrap)*a-i.canonical.x)*Vt,d=(e.y*a-i.canonical.y)*Vt;return{min:new Mt(((n.x-i.wrap)*a-i.canonical.x)*Vt,(n.y*a-i.canonical.y)*Vt),max:new Mt(o,d)}}function fg(n,e,i,a,o,d,p){const y=n.indices,T=n.vertices,A=[];for(let M=a;M<a+o;M+=3){const z=e[i[M+0]+d],P=e[i[M+1]+d],j=e[i[M+2]+d],B=Math.min(z.x,P.x,j.x),W=Math.max(z.x,P.x,j.x),Y=Math.min(z.y,P.y,j.y),K=Math.max(z.y,P.y,j.y);A.length=0,n.grid.query(new Mt(B,Y),new Mt(W,K),A);for(let re=0;re<A.length;re++){const se=A[re];if(Al(T[y[3*se+0]],T[y[3*se+1]],T[y[3*se+2]],z,P,j,p))return!0}}return!1}function pg(n,e,i,a){if(!n||!i)return!1;let o=n.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(i.vertices.length<n.vertices.length)return pg(i,a,n,e);const d=e.canonical,p=a.canonical,y=Math.pow(2,p.z-d.z);o=n.vertices.map(T=>new Mt((T.x+d.x*Vt)*y-p.x*Vt,(T.y+d.y*Vt)*y-p.y*Vt))}return fg(i,o,n.indices,0,n.indices.length,0,0)}function Xu(n,e,i,a){const o=Math.pow(2,a.z-i.z);return new Mt((n+i.x*Vt)*o-a.x*Vt,(e+i.y*Vt)*o-a.y*Vt)}function tu(n,e){const i=[];e.grid.queryPoint(n,i);const a=e.indices,o=e.vertices;for(let d=0;d<i.length;d++){const p=i[d];if(_s([o[a[3*p+0]],o[a[3*p+1]],o[a[3*p+2]]],n))return!0}return!1}const iu=[new Mt(0,0),new Mt(Vt,0),new Mt(Vt,Vt),new Mt(0,Vt)];function sp(n,e){const i=[];let a=[];if(!e||n.length<2)return[n];if(n.length===2)return Xs(n[0],n[1],iu)?[n]:[];for(let o=0;o<n.length+2;o++){const d=n[o%n.length],p=n[(o+1)%n.length],y=Xs(o===0?n[n.length-1]:n[(o-1)%n.length],d,iu),T=Xs(d,p,iu),A=y||T;A&&a.push(d),A&&T||a.length>0&&(a.length>1&&i.push(a),a=[])}return a.length>1&&i.push(a),i}const Qd=Tt.types,Jh=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],X1=["fill-extrusion-flood-light-ground-radius"],H0=Math.pow(2,13),pm=Math.pow(2,15)-1,q0=new Mt(0,1),Yu=2147483648;function Qh(n,e,i,a,o,d,p,y){n.emplaceBack((e<<1)+p,(i<<1)+d,(Math.floor(a*H0)<<1)+o,Math.round(y))}function ap(n,e,i){n.emplaceBack(e.x*Vt,e.y*Vt,i?1:0)}function mg(n,e,i,a,o,d){n.emplaceBack(e.x,e.y,(i.x<<1)+a,(i.y<<1)+o,d)}function ed(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class mm{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class x_{constructor(){this.centroidXY=new Mt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Mt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Mt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Mt(this.max.x-this.min.x,this.max.y-this.min.y)}}class op{constructor(){this.acc=new Mt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,a){this.accCount++,this.acc._add(i);let o=!!this.borders;i.x<e.min.x?(e.min.x=i.x,o=!0):i.x>e.max.x&&(e.max.x=i.x,o=!0),i.y<e.min.y?(e.min.y=i.y,o=!0):i.y>e.max.y&&(e.max.y=i.y,o=!0),((i.x===0||i.x===Vt)&&i.x===a.x)!=((i.y===0||i.y===Vt)&&i.y===a.y)&&this.processBorderOverlap(i,a),o&&this.checkBorderIntersection(i,a)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,zi(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Vt!=e.x>Vt&&this.addBorderIntersection(1,zi(i.y,e.y,(Vt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,zi(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Vt!=e.y>Vt&&this.addBorderIntersection(3,zi(i.x,e.x,(Vt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new Mt(0,0):new Mt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function gg(n,e){const i=n.add(e)._unit(),a=Ie(n.x*i.x+n.y*i.y,-1,1);var o,d,p;return o=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(o)))/4*pm*((d=n).x*(p=e).y-d.y*p.x<0?-1:1)}const _g=[n=>n.x<0,n=>n.x>Vt,n=>n.y<0,n=>n.y>Vt];function G0(n,e,i,a){const o=[4];if(a===0)return o;i._mult(a);const d=n.sub(i),p=e.sub(i),y=[n,e,d,p];for(let T=0;T<4;T++)for(const A of y)if(_g[T](A)){o.push(T);break}return o}class v_{constructor(e){this.vertexArray=new qf,this.indexArray=new is,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut},i=>X1.includes(i)),this._segments=new qn,this.hiddenByLandmarkVertexArray=new Yo,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new qn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,a,o=!1){const d=e.length;if(d>2){let p=Math.max(0,this._segments.get().length-1);const y=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[p].length);let T;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{const A=e[0],M=e[1];T=gg(A.sub(e[d-1])._perp()._unit(),M.sub(A)._perp()._unit())}for(let A=0;A<d;A++){const M=A===d-1?0:A+1,z=e[A],P=e[M],j=e[M===d-1?0:M+1],B=P.sub(z)._perp()._unit(),W=gg(B,j.sub(P)._perp()._unit()),Y=T,K=W;if(C(z,P,i)||o&&O(z,i)&&O(P,i)){T=W;continue}const re=y.vertexLength;mg(this.vertexArray,z,P,1,1,Y),mg(this.vertexArray,z,P,1,0,Y),mg(this.vertexArray,z,P,0,1,K),mg(this.vertexArray,z,P,0,0,K),y.vertexLength+=4;const se=G0(z,P,B,a);for(const ue of se)this._segmentToGroundQuads[p].push({id:re,region:ue}),this._segmentToRegionTriCounts[p][ue]+=2,y.primitiveLength+=2;T=W}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let a=0;a<i;a++)this._segmentToGroundQuads[a].sort((o,d)=>o.region-d.region);for(let a=0;a<i;a++){const o=this._segmentToGroundQuads[a],d=e[a],p=this._segmentToRegionTriCounts[a];p.reduce((T,A)=>T+A,0);let y=0;for(let T=0;T<=4;T++){const A=p[T];if(A!==0){let M=this.regionSegments[T];M||(M=this.regionSegments[T]=new qn);const z={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+y,vertexLength:d.vertexLength,primitiveLength:A};M.get().push(z)}y+=A}for(let T=0;T<o.length;T++){const A=o[T].id;this.indexArray.emplaceBack(A,A+1,A+3),this.indexArray.emplaceBack(A,A+3,A+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,a,o,d,p,y){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,a,o,d,p,void 0,y)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,um.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,a,o,d,p,y,T){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,a,o,d,p,y,T)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Yu))}updateHiddenByLandmarkRange(e,i,a){if(!this.hasData())return;const o=i+e;if(i!==0){for(let d=e;d<o;++d)this.hiddenByLandmarkVertexArray.emplace(d,a?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,B0.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class ef{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new is,this.footprintVertices=new oc,this.footprintSegments=[],this.layoutVertexArray=new Kc,this.centroidVertexArray=new Yp,this.wallVertexArray=new hc,this.indexArray=new is,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut},i=>Jh.includes(i)),this.segments=new qn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new v_(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,a,o){this.features=[],this.hasPattern=og("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Ze(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:d,id:p,index:y,sourceLayerIndex:T}of e){const A=this.layers[0]._featureFilter.needGeometry,M=Ct(d,A);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom,{worldview:this.worldview}),M,a))continue;const z={id:p,sourceLayerIndex:T,index:y,geometry:A?M.geometry:qt(d,a,o),properties:d.properties,type:d.type,patterns:{}},P=this.layoutVertexArray.length,j=Qd[z.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:d.id,feature:Kh("fill-extrusion",this.layers,z,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const B of z.geometry)for(const W of sp(B,j))this.addFeature(d.id,z,[W],y,a,{},i.availableImages,o,i.brightness);else this.addFeature(d.id,z,z.geometry,y,a,{},i.availableImages,o,i.brightness);i.featureIndex.insert(d,z.geometry,y,T,this.index,P)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,a,o,d,p){for(const{featureId:y,feature:T}of this.features){const A=Qd[T.type]==="Polygon",{geometry:M}=T;if(this.wallMode)for(const z of M)for(const P of sp(z,A))this.addFeature(y,T,[P],T.index,i,a,o,d,p);else this.addFeature(y,T,M,T.index,i,a,o,d,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,a,o,d,p,y){this.programConfigurations.updatePaintArrays(e,i,d,a,o,p,y,this.worldview),this.groundEffect.update(e,i,d,a,o,p,y,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,U0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,j0.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,F0.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,W1.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,o,d,p,y,T,A){const M=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,z=[new Mt(0,0),new Mt(Vt,Vt)],P=T.projection,j=P.name==="globe",B=this.wallMode||Qd[i.type]==="Polygon",W=new op;W.centroidDataIndex=this.centroidData.length;const Y=new x_;Y.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(Y.buildingId=i.properties.building_id);const K=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},d)<=0,re=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},d);let se;if(Y.height=re,Y.vertexArrayOffset=this.layoutVertexArray.length,Y.groundVertexArrayOffset=this.groundEffect.vertexArray.length,j&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Vd),this.wallMode){if(j)return void cn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(a.length!==1)return;se=function($e){const yt=$e[0].x===$e[$e.length-1].x&&$e[0].y===$e[$e.length-1].y;(function(Ht){let xi=0;const Gi=Ht.length;for(let Xt=0;Xt<Gi;Xt++)xi+=(Ht[(Xt+1)%Gi].x-Ht[Xt].x)*(Ht[(Xt+1)%Gi].y+Ht[Xt].y);return xi>=0})($e)||($e=$e.reverse());const bt={geometry:[],joinNormals:[],indices:[]},Et=[],Ot=[],dt=[];let At=$e.length;for(;At>=2&&$e[At-1].equals($e[At-2]);)At--;if(At<(yt?3:2))return bt;let at,tt,Nt,Pt,vi,ai=0;for(;ai<At-1&&$e[ai].equals($e[ai+1]);)ai++;yt&&(at=$e[At-2],vi=$e[ai].sub(at)._unit()._perp());for(let Ht=ai;Ht<At;Ht++){if(Nt=Ht===At-1?yt?$e[ai+1]:void 0:$e[Ht+1],Nt&&$e[Ht].equals(Nt))continue;vi&&(Pt=vi),at&&(tt=at),at=$e[Ht],vi=Nt?Nt.sub(at)._unit()._perp():Pt,Pt=Pt||vi;let xi=Pt.add(vi);xi.x===0&&xi.y===0||xi._unit();const Gi=xi.x*vi.x+xi.y*vi.y,Xt=Gi!==0?1/Gi:1/0,mi=Pt.x*vi.y-Pt.y*vi.x>0;let Oi="miter";const Qi=2;Oi==="miter"&&Xt>Qi&&(Oi="bevel"),Oi==="bevel"&&(Xt>100&&(Oi="flipbevel"),Xt<Qi&&(Oi="miter"));const hn=(nn,ui,en,An)=>{const fe=new Mt(nn.x,nn.y),me=new Mt(nn.x,nn.y);fe.x+=ui.x*An,fe.y+=ui.y*An,me.x-=ui.x*Math.max(en,1),me.y-=ui.y*Math.max(en,1),dt.push(ui),Et.push(fe),Ot.push(me)};if(Oi==="miter")xi._mult(Xt),hn(at,xi,0,0);else if(Oi==="flipbevel")xi=vi.mult(-1),hn(at,xi,0,0),hn(at,xi.mult(-1),0,0);else{const nn=-Math.sqrt(Xt*Xt-1),ui=mi?nn:0,en=mi?0:nn;tt&&hn(at,Pt,ui,en),Nt&&hn(at,vi,ui,en)}}bt.geometry=[...Et,...Ot.reverse(),Et[0]],bt.joinNormals=[...dt,...dt.reverse(),dt[dt.length-1]];const fi=bt.geometry.length-1;for(let Ht=0;Ht<fi/2;Ht++)if(Ht+1<fi/2){let xi=Ht,Gi=Ht+1,Xt=fi-1-Ht,mi=fi-2-Ht;xi=xi===0?fi-1:xi-1,Gi=Gi===0?fi-1:Gi-1,Xt=Xt===0?fi-1:Xt-1,mi=mi===0?fi-1:mi-1,bt.indices.push(Xt),bt.indices.push(Gi),bt.indices.push(xi),bt.indices.push(Xt),bt.indices.push(mi),bt.indices.push(Gi)}return bt}(a[0]),a=[se.geometry]}const ue=($e,yt)=>$e<(yt.length-1)/2||$e===yt.length-1,Re=this.wallMode?[a]:lm(a,500);for(let $e=Re.length-1;$e>=0;$e--){const yt=Re[$e];(yt.length===0||(Me=yt[0]).every(It=>It.x<=0)||Me.every(It=>It.x>=Vt)||Me.every(It=>It.y<=0)||Me.every(It=>It.y>=Vt))&&Re.splice($e,1)}var Me;let Ne;if(j)Ne=Xe(Re,z,d);else{Ne=[];for(const $e of Re)Ne.push({polygon:$e,bounds:z})}const Fe=B?this.edgeRadius:0,Ue=Fe>0&&this.zoom<17,pt=($e,yt)=>{if($e.length===0)return!1;const It=$e[$e.length-1];return yt.x===It.x&&yt.y===It.y};for(const{polygon:$e,bounds:yt}of Ne){let It=0,bt=0;for(const At of $e)B&&!At[0].equals(At[At.length-1])&&At.push(At[0]),bt+=B?At.length-1:At.length;const Et=this.segments.prepareSegment((B?5:4)*bt,this.layoutVertexArray,this.indexArray);Y.footprintSegIdx<0&&(Y.footprintSegIdx=this.footprintSegments.length),Y.polygonSegIdx<0&&(Y.polygonSegIdx=this.polygonSegments.length);const Ot={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},dt=new mm;if(dt.vertexOffset=this.footprintVertices.length,dt.indexOffset=3*this.footprintIndices.length,dt.ringIndices=[],B){const At=[],at=[];It=Et.vertexLength;for(let Nt=0;Nt<$e.length;Nt++){const Pt=$e[Nt];Pt.length&&Nt!==0&&at.push(At.length/2);const vi=[];let ai,fi;ai=Pt[1].sub(Pt[0])._perp()._unit(),dt.ringIndices.push(Pt.length-1);for(let Ht=1;Ht<Pt.length;Ht++){const xi=Pt[Ht],Gi=Pt[Ht===Pt.length-1?1:Ht+1],Xt=xi.clone();if(Fe){fi=Gi.sub(xi)._perp()._unit();const mi=ai.add(fi)._unit(),Oi=Fe*Math.min(4,1/(ai.x*mi.x+ai.y*mi.y));Xt.x+=Oi*mi.x,Xt.y+=Oi*mi.y,Xt.x=Math.round(Xt.x),Xt.y=Math.round(Xt.y),ai=fi}if(!K||Fe!==0&&!Ue||pt(vi,Xt)||vi.push(Xt),Qh(this.layoutVertexArray,Xt.x,Xt.y,0,0,1,1,0),this.wallMode){const mi=ue(Ht,Pt);ap(this.wallVertexArray,se.joinNormals[Ht],!mi)}Et.vertexLength++,this.footprintVertices.emplaceBack(xi.x,xi.y),At.push(xi.x,xi.y),j&&ed(this.layoutVertexExtArray,P.projectTilePoint(Xt.x,Xt.y,d),P.upVector(d,Xt.x,Xt.y))}K&&(Fe===0||Ue)&&(vi.length!==0&&pt(vi,vi[0])&&vi.pop(),this.groundEffect.addData(vi,yt,M))}const tt=this.wallMode?se.indices:Xh(At,at);for(let Nt=0;Nt<tt.length;Nt+=3)this.footprintIndices.emplaceBack(dt.vertexOffset+tt[Nt+0],dt.vertexOffset+tt[Nt+1],dt.vertexOffset+tt[Nt+2]),this.indexArray.emplaceBack(It+tt[Nt],It+tt[Nt+2],It+tt[Nt+1]),Et.primitiveLength++;dt.indexCount+=tt.length,dt.vertexCount+=this.footprintVertices.length-dt.vertexOffset}for(let At=0;At<$e.length;At++){const at=$e[At];W.startRing(Y,at[0]);let tt=at.length>4&&U(at[at.length-2],at[0],at[1]),Nt=Fe?f(at[at.length-2],at[0],at[1],Fe):0;const Pt=[];let vi,ai,fi;ai=at[1].sub(at[0])._perp()._unit();let Ht=!0;for(let xi=1,Gi=0;xi<at.length;xi++){let Xt=at[xi-1],mi=at[xi];const Oi=at[xi===at.length-1?1:xi+1];if(W.appendEdge(Y,mi,Xt),C(mi,Xt,yt)){Fe&&(ai=Oi.sub(mi)._perp()._unit(),Ht=!Ht);continue}const Qi=mi.sub(Xt)._perp(),hn=Qi.x/(Math.abs(Qi.x)+Math.abs(Qi.y)),nn=Qi.y>0?1:0,ui=Xt.dist(mi);if(Gi+ui>32768&&(Gi=0),Fe){fi=Oi.sub(mi)._perp()._unit();let me=v(Xt,mi,Oi,l(ai,fi),Fe);isNaN(me)&&(me=0);const st=mi.sub(Xt)._unit();Xt=Xt.add(st.mult(Nt))._round(),mi=mi.add(st.mult(-me))._round(),Nt=me,ai=fi,K&&this.zoom>=17&&(pt(Pt,Xt)||Pt.push(Xt),pt(Pt,mi)||Pt.push(mi))}const en=Et.vertexLength,An=at.length>4&&U(Xt,mi,Oi);let fe=ae(Gi,tt,Ht);if(Qh(this.layoutVertexArray,Xt.x,Xt.y,hn,nn,0,0,fe),Qh(this.layoutVertexArray,Xt.x,Xt.y,hn,nn,0,1,fe),this.wallMode){const me=ue(xi-1,at),st=se.joinNormals[xi-1];ap(this.wallVertexArray,st,me),ap(this.wallVertexArray,st,me)}if(Gi+=ui,fe=ae(Gi,An,!Ht),tt=An,Qh(this.layoutVertexArray,mi.x,mi.y,hn,nn,0,0,fe),Qh(this.layoutVertexArray,mi.x,mi.y,hn,nn,0,1,fe),this.wallMode){const me=ue(xi,at),st=se.joinNormals[xi];ap(this.wallVertexArray,st,me),ap(this.wallVertexArray,st,me)}if(Et.vertexLength+=4,this.indexArray.emplaceBack(en+0,en+1,en+2),this.indexArray.emplaceBack(en+1,en+3,en+2),Et.primitiveLength+=2,Fe){const me=It+(xi===1?at.length-2:xi-2),st=xi===1?It:me+1;if(this.indexArray.emplaceBack(en+1,me,en+3),this.indexArray.emplaceBack(me,st,en+3),Et.primitiveLength+=2,vi===void 0&&(vi=en),!C(Oi,at[xi],yt)){const ft=xi===at.length-1?vi:Et.vertexLength;this.indexArray.emplaceBack(en+2,en+3,ft),this.indexArray.emplaceBack(en+3,ft+1,ft),this.indexArray.emplaceBack(en+3,st,ft+1),Et.primitiveLength+=3}Ht=!Ht}if(j){const me=this.layoutVertexExtArray,st=P.projectTilePoint(Xt.x,Xt.y,d),ft=P.projectTilePoint(mi.x,mi.y,d),Zt=P.upVector(d,Xt.x,Xt.y),$t=P.upVector(d,mi.x,mi.y);ed(me,st,Zt),ed(me,st,Zt),ed(me,ft,$t),ed(me,ft,$t)}}B&&(It+=at.length-1),K&&Fe&&this.zoom>=17&&(Pt.length!==0&&pt(Pt,Pt[0])&&Pt.pop(),this.groundEffect.addData(Pt,yt,M,Fe>0))}this.footprintSegments.push(dt),Ot.triangleCount=this.indexArray.length-Ot.triangleArrayOffset,this.polygonSegments.push(Ot),++Y.footprintSegLen,++Y.polygonSegLen}if(Y.vertexCount=this.layoutVertexArray.length-Y.vertexArrayOffset,Y.groundVertexCount=this.groundEffect.vertexArray.length-Y.groundVertexArrayOffset,Y.vertexCount!==0){if(Y.centroidXY=W.borders?q0:this.encodeCentroid(W,Y),this.centroidData.push(Y),W.borders){this.featuresOnBorder.push(W);const $e=this.featuresOnBorder.length-1;for(let yt=0;yt<W.borders.length;yt++)W.borders[yt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[yt].push($e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,o,p,y,d,A,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,o,p,y,d,A,this.worldview),this.maxHeight=Math.max(this.maxHeight,re)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,a)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){const e=[];for(let y=0;y<this.centroidData.length;y++){const T=this.centroidData[y],A=+(T.min.y+T.max.y>Vt),M=2*A+(+(T.min.x+T.max.x>Vt)^A);for(let z=0;z<T.polygonSegLen;z++){const P=T.polygonSegIdx+z;e.push({centroidIdx:y,subtile:M,polygonSegmentIdx:P,triangleSegmentIdx:this.polygonSegments[P].triangleSegIdx})}}const i=new is;e.sort((y,T)=>y.triangleSegmentIdx===T.triangleSegmentIdx?y.subtile-T.subtile:y.triangleSegmentIdx-T.triangleSegmentIdx);let a=0,o=0,d=0;for(const y of e){if(y.triangleSegmentIdx!==a)break;d++}const p=e.length;for(;o!==e.length;){a=e[o].triangleSegmentIdx;let y=0,T=o,A=o;for(let M=T;M<d&&e[M].subtile===y;M++)A++;for(;T!==d;){const M=e[T];y=M.subtile;const z=this.centroidData[M.centroidIdx].min.clone(),P=this.centroidData[M.centroidIdx].max.clone(),j={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let B=T;B<A;B++){const W=e[B],Y=this.polygonSegments[W.polygonSegmentIdx],K=this.centroidData[W.centroidIdx].min,re=this.centroidData[W.centroidIdx].max,se=this.indexArray.uint16;for(let ue=Y.triangleArrayOffset;ue<Y.triangleArrayOffset+Y.triangleCount;ue++)i.emplaceBack(se[3*ue],se[3*ue+1],se[3*ue+2]);j.primitiveLength+=Y.triangleCount,z.x=Math.min(z.x,K.x),z.y=Math.min(z.y,K.y),P.x=Math.max(P.x,re.x),P.y=Math.max(P.y,re.y)}j.primitiveLength>0&&this.triangleSubSegments.push({segment:j,min:z,max:P}),T=A;for(let B=T;B<d&&e[B].subtile===e[T].subtile;B++)A++}o=d;for(let M=o;M<p&&e[M].triangleSegmentIdx===e[o].triangleSegmentIdx;M++)d++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,a){const o=new qn;if(this.wallMode){for(const W of this.triangleSubSegments)o.segments.push(W.segment);return o}let d=0,p=0;const y=1<<e.canonical.z;if(i){const W=i.getMinMaxForTile(e);W&&(d=W.min,p=W.max)}p+=this.maxHeight;const T=e.toUnwrapped();let A;const M=[T.canonical.x/y+T.wrap,T.canonical.y/y],z=[(T.canonical.x+1)/y+T.wrap,(T.canonical.y+1)/y],P=(W,Y,K)=>[W[0]*(1-K[0])+Y[0]*K[0],W[1]*(1-K[1])+Y[1]*K[1]],j=[],B=[];for(const W of this.triangleSubSegments){j[0]=W.min.x/Vt,j[1]=W.min.y/Vt,B[0]=W.max.x/Vt,B[1]=W.max.y/Vt;const Y=P(M,z,j),K=P(M,z,B);if(new Pi([Y[0],Y[1],d],[K[0],K[1],p]).intersectsPrecise(a)===0){A&&(o.segments.push(A),A=void 0);continue}const re=W.segment;A&&A.vertexOffset!==re.vertexOffset&&(o.segments.push(A),A=void 0),A?(A.vertexLength+=re.vertexLength,A.primitiveLength+=re.primitiveLength):A={vertexOffset:re.vertexOffset,primitiveLength:re.primitiveLength,vertexLength:re.vertexLength,primitiveOffset:re.primitiveOffset,sortKey:void 0,vaos:{}}}return A&&o.segments.push(A),o}encodeCentroid(e,i){const a=e.centroid(),o=i.span(),d=Math.min(7,Math.round(o.x*this.tileToMeter/10)),p=Math.min(7,Math.round(o.y*this.tileToMeter/10));return new Mt(Ie(a.x,1,Vt-1)<<3|d,Ie(a.y,1,Vt-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new Mt(0,0);const i=e.borders,a=Number.MAX_VALUE;if(i[0][0]!==a||i[1][0]!==a){const o=i[0][0]!==a?0:1;return new Mt(6|(i[0][0]!==a?0:65528),(i[o][0]+i[o][1])/2<<3|6)}{const o=i[2][0]!==a?2:3;return new Mt((i[o][0]+i[o][1])/2<<3|6,6|(i[2][0]!==a?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,o=e.flags&Yu?q0:e.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==o.y||d!==o.x){for(let p=i;p<a;++p)this.centroidVertexArray.emplace(p,o.x,o.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped());if(rp(this.activeReplacements,o))return;if(this.activeReplacements=o,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const p of this.centroidData)p.flags&=2147483647;const d=[];for(const p of this.activeReplacements){if(p.order<a)continue;const y=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));if(p.footprint.buildingId){const T=p.footprint.buildingId;for(const A of this.centroidData)A.buildingId===T&&(A.flags|=Yu)}else for(const T of this.centroidData)if(!(T.flags&Yu||p.min.x>T.max.x||T.min.x>p.max.x||p.min.y>T.max.y||T.min.y>p.max.y))for(let A=0;A<T.footprintSegLen;A++){const M=this.footprintSegments[T.footprintSegIdx+A];if(d.length=0,gt(this.footprintVertices,M.vertexOffset,M.vertexCount,p.footprintTileId.canonical,e.canonical,d),fg(p.footprint,d,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-y)){T.flags|=Yu;break}}}for(const p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,a){let o=!1;for(let d=0;d<a.footprintSegLen;d++){const p=this.footprintSegments[a.footprintSegIdx+d];let y=0;for(const T of p.ringIndices){for(let A=y,M=T+y-1;A<T+y;M=A++){const z=this.footprintVertices.int16[2*(A+p.vertexOffset)+0],P=this.footprintVertices.int16[2*(A+p.vertexOffset)+1],j=this.footprintVertices.int16[2*(M+p.vertexOffset)+1];P>i!=j>i&&e<(this.footprintVertices.int16[2*(M+p.vertexOffset)+0]-z)*(i-P)/(j-P)+z&&(o=!o)}y=T}}return o}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,o=!0;const d=4*(e+Vt)*Vt+(i+Vt);if(this.partLookup.hasOwnProperty(d)){const p=this.partLookup[d];return p?{height:p.height,hidden:!!(p.flags&Yu)}:void 0}for(const p of this.centroidData)e>p.max.x||p.min.x>e||i>p.max.y||p.min.y>i||p.height<=a||this.footprintContainsPoint(e,i,p)&&(a=p.height,this.partLookup[d]=p,o=!!(p.flags&Yu));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:o};this.partLookup[d]=void 0}}function l(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function f(n,e,i,a){const o=e.sub(n)._perp()._unit(),d=i.sub(e)._perp()._unit();return v(n,e,i,l(o,d),a)}function v(n,e,i,a,o){const d=Math.sqrt(1-a*a);return Math.min(n.dist(e)/3,e.dist(i)/3,o*d/a)}function C(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function O(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function U(n,e,i){if(n.x<0||n.x>=Vt||e.x<0||e.x>=Vt||i.x<0||i.x>=Vt)return!1;const a=i.sub(e),o=a.perp(),d=n.sub(e);return(a.x*d.x+a.y*d.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(d.x*d.x+d.y*d.y))>-.866&&o.x*d.x+o.y*d.y<0}function ae(n,e,i){const a=e?2|n:-3&n;return i?1|a:-2&a}function De(){const n=Math.PI/32,e=Math.tan(n),i=H;return i*Math.sqrt(1+2*e*e)-i}function Xe(n,e,i){const a=1<<i.z,o=Ee(i.x/a),d=Ee((i.x+1)/a),p=ve(i.y/a),y=ve((i.y+1)/a);return function(T,A,M,z,P=0,j){const B=[];if(!T.length||!M||!z)return B;const W=(Me,Ne)=>{for(const Fe of Me)B.push({polygon:Fe,bounds:Ne})},Y=Math.ceil(Math.log2(M)),K=Math.ceil(Math.log2(z)),re=Y-K,se=[];for(let Me=0;Me<Math.abs(re);Me++)se.push(re>0?0:1);for(let Me=0;Me<Math.min(Y,K);Me++)se.push(0),se.push(1);let ue=T;if(ue=ip(ue,A[0].y-P,A[1].y+P,1),ue=ip(ue,A[0].x-P,A[1].x+P,0),!ue.length)return B;const Re=[];for(se.length?Re.push({polygons:ue,bounds:A,depth:0}):W(ue,A);Re.length;){const Me=Re.pop(),Ne=Me.depth,Fe=se[Ne],Ue=Me.bounds[0],pt=Me.bounds[1],$e=Fe===0?Ue.x:Ue.y,yt=Fe===0?pt.x:pt.y,It=j?j(Fe,$e,yt):.5*($e+yt),bt=ip(Me.polygons,$e-P,It+P,Fe),Et=ip(Me.polygons,It-P,yt+P,Fe);if(bt.length){const Ot=[Ue,new Mt(Fe===0?It:pt.x,Fe===1?It:pt.y)];se.length>Ne+1?Re.push({polygons:bt,bounds:Ot,depth:Ne+1}):W(bt,Ot)}if(Et.length){const Ot=[new Mt(Fe===0?It:Ue.x,Fe===1?It:Ue.y),pt];se.length>Ne+1?Re.push({polygons:Et,bounds:Ot,depth:Ne+1}):W(Et,Ot)}}return B}(n,e,Math.ceil((d-o)/11.25),Math.ceil((p-y)/11.25),1,(T,A,M)=>{if(T===0)return .5*(A+M);{const z=ve((i.y+A/Vt)/a);return(Te(.5*(ve((i.y+M/Vt)/a)+z))*a-i.y)*Vt}})}function gt(n,e,i,a,o,d){const p=Math.pow(2,a.z-o.z);for(let y=0;y<i;y++){let T=n.int16[2*(y+e)+0],A=n.int16[2*(y+e)+1];T=(T+o.x*Vt)*p-a.x*Vt,A=(A+o.y*Vt)*p-a.y*Vt,d.push(new Mt(T,A))}}let si,yi;ri(ef,"FillExtrusionBucket",{omit:["layers","features"]}),ri(x_,"PartData"),ri(mm,"FootprintSegment"),ri(op,"BorderCentroidData"),ri(v_,"GroundEffect");class Ut extends Mt{constructor(e,i,a){super(e,i),this.z=a}}class ti extends Ut{constructor(e,i,a,o){super(e,i,a),this.w=o}}function xn(n,e,i,a){const o=i==="x"?"y":"x",d=(a-n[i])/(e[i]-n[i]);n[o]=Math.round(n[o]+(e[o]-n[o])*d),n[i]=a,n.hasOwnProperty("z")&&(n.z=zi(n.z,e.z,d)),n.hasOwnProperty("w")&&(n.w=zi(n.w,e.w,d))}function Xn(n,e,i,a){const o=i,d=a;for(const p of["x","y"]){let y=n,T=e;y[p]>=T[p]&&(y=e,T=n),y[p]<o&&T[p]>o&&xn(y,T,p,o),y[p]<d&&T[p]>d&&xn(T,y,p,d)}}function cs(n,e,i,a,o,d){const p=[];for(let y=0;y<n.length;y++){const T=n[y];let A;const M=p.length;let z=0;for(let P=0;P<T.length-1;P++){let j=T[P],B=T[P+1],W=0;const Y=z;let K,re;d&&(W=Math.hypot(B.x-j.x,B.y-j.y),z+=W,K=j,re=B),j.x<e&&B.x<e||(j.x<e?j=new Mt(e,j.y+(e-j.x)/(B.x-j.x)*(B.y-j.y))._round():B.x<e&&(B=new Mt(e,j.y+(e-j.x)/(B.x-j.x)*(B.y-j.y))._round()),j.y<i&&B.y<i||(j.y<i?j=new Mt(j.x+(i-j.y)/(B.y-j.y)*(B.x-j.x),i)._round():B.y<i&&(B=new Mt(j.x+(i-j.y)/(B.y-j.y)*(B.x-j.x),i)._round()),j.x>=a&&B.x>=a||(j.x>=a?j=new Mt(a,j.y+(a-j.x)/(B.x-j.x)*(B.y-j.y))._round():B.x>=a&&(B=new Mt(a,j.y+(a-j.x)/(B.x-j.x)*(B.y-j.y))._round()),j.y>=o&&B.y>=o||(j.y>=o?j=new Mt(j.x+(o-j.y)/(B.y-j.y)*(B.x-j.x),o)._round():B.y>=o&&(B=new Mt(j.x+(o-j.y)/(B.y-j.y)*(B.x-j.x),o)._round()),A&&j.equals(A[A.length-1])||(A=[j],p.push(A),d&&d.push({progress:{min:Y+mt(K,re,j)*W,max:1},parentIndex:y,prevPoint:K,nextPoint:re})),A.push(B),d&&(d[d.length-1].progress.max=Y+mt(K,re,B)*W,d[d.length-1].nextPoint=re)))))}if(d&&z>0)for(let P=M;P<p.length;P++)d[P].progress.min/=z,d[P].progress.max/=z}return p}function Rt(n,e,i,a,o){if(n.length<2)return void a.push(n);const d=[];for(;e.valid();){const[A,M]=e.get();for(let z=0;z<n.length-1;z++){const P=n[z],j=n[z+1],B=Dr(P,j,A,M);if(B){const[W]=B,Y=new Mt(zi(P.x,j.x,W),zi(P.y,j.y,W));d.push({t:z+W,distance:0,point:Y})}}e.next()}if(d.length===0)return void a.push(n);d.sort((A,M)=>A.t-M.t);let p=0,y=0,T=[];for(a.push(T);p!==n.length;){if(y===d.length){for(;p!==n.length;)T.length!==0&&T[T.length-1].equals(n[p])||T.push(n[p]),p++;break}d[y].t<=p?(T.length!==0&&T[T.length-1].equals(d[y].point)||T.push(d[y].point),Math.trunc(d[y].t),y++):(T.length!==0&&T[T.length-1].equals(n[p])||T.push(n[p]),p++)}}function mt(n,e,i){return n.x!==e.x?(i.x-n.x)/(e.x-n.x):n.y!==e.y?(i.y-n.y)/(e.y-n.y):0}function Dt(n,e){return n.x*e.x+n.y*e.y}function di(n,e){if(n.length===1){let i=0;const a=e[i++];let o;for(;!o||a.equals(o);)if(o=e[i++],!o)return 1/0;for(;i<e.length;i++){const d=e[i],p=n[0],y=o.sub(a),T=d.sub(a),A=p.sub(a),M=Dt(y,y),z=Dt(y,T),P=Dt(T,T),j=Dt(A,y),B=Dt(A,T),W=M*P-z*z,Y=(P*j-z*B)/W,K=(M*B-z*j)/W,re=a.z*(1-Y-K)+o.z*Y+d.z*K;if(isFinite(re))return re}return 1/0}{let i=1/0;for(const a of e)i=Math.min(i,a.z);return i}}function un(n,e,i,a,o,d,p,y){const T=p*o.getElevationAt(n,e,!0,!0),A=d[0]!==0,M=A?d[1]===0?p*(d[0]/7-450):p*function(z,P,j){const B=Math.floor(P[0]/8),W=Math.floor(P[1]/8),Y=10*(P[0]-8*B),K=10*(P[1]-8*W),re=z.getElevationAt(B,W,!0,!0),se=z.getMeterToDEM(j),ue=Math.floor(.5*(Y*se-1)),Re=Math.floor(.5*(K*se-1)),Me=z.tileCoordToPixel(B,W),Ne=2*ue+1,Fe=2*Re+1,Ue=function(Et,Ot,dt,At,at){return[Et.getElevationAtPixel(Ot,dt,!0),Et.getElevationAtPixel(Ot+at,dt,!0),Et.getElevationAtPixel(Ot,dt+at,!0),Et.getElevationAtPixel(Ot+At,dt+at,!0)]}(z,Me.x-ue,Me.y-Re,Ne,Fe),pt=Math.abs(Ue[0]-Ue[1]),$e=Math.abs(Ue[2]-Ue[3]),yt=Math.abs(Ue[0]-Ue[2])+Math.abs(Ue[1]-Ue[3]),It=Math.min(.25,.5*se*(pt+$e)/Ne),bt=Math.min(.25,.5*se*yt/Fe);return re+Math.max(It*Y,bt*K)}(o,d,y):T;return{base:T+(i===0?-1:i),top:A?Math.max(M+a,T+i+2):T+a}}class mr{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Tn{constructor(){this.tasks={},this.taskQueue=[],Ai(["process"],this),this.invoker=new mr(this.process),this.nextId=0}add(e,i){const a=this.nextId++,o=function({type:d,isSymbolTile:p,zoom:y}){return y=y||0,d==="message"?0:d!=="maybePrepare"||p?d!=="parseTile"||p?d==="parseTile"&&p?300-y:d==="maybePrepare"&&p?400-y:500:200-y:100-y}(i);if(o===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:i,priority:o,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let o=0;o<this.taskQueue.length;o++){const d=this.tasks[this.taskQueue[o]];d.priority<i&&(i=d.priority,e=o)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class Ln{constructor(e,i,a){this.target=e,this.parent=i,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Ai(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Tn}send(e,i,a,o,d=!1,p){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=p,this.callbacks[y]=a);const T=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!a,targetMapId:o,mustQueue:d,sourceMapId:this.mapId,data:nc(i,T)},T),{cancel:()=>{a&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const a=i.id;if(a&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const o=this.cancelCallbacks[a];delete this.cancelCallbacks[a],o&&o.cancel()}else if(i.mustQueue||wt(self)){const o=this.callbacks[a],d=this.scheduler.add(()=>this.processTask(a,i),o&&o.metadata||{type:"message"});d&&(this.cancelCallbacks[a]=d)}else this.processTask(a,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(i.error?a(vl(i.error)):a(null,vl(i.data)))}else{const a=new Set,o=i.hasCallback?(p,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?nc(p):null,data:nc(y,a)},a)}:()=>{},d=vl(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,d,o);else if(this.parent.getWorkerSource){const p=i.type.split("."),{source:y,scope:T}=d;this.parent.getWorkerSource(i.sourceMapId,p[0],y,T)[p[1]](d,o)}else o(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Is={workerUrl:"",workerClass:null,workerParams:void 0};const Ir="mapboxgl_preloaded_worker_pool";class zo{constructor(){this.active={}}acquire(e,i=zo.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(Is.workerClass!=null?new Is.workerClass:new self.Worker(Is.workerUrl,Is.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ir]}numActive(){return Object.keys(this.active).length}}zo.workerCount=2;class lp{constructor(e,i,a="Worker",o=zo.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=vt();const d=this.workerPool.acquire(this.id,o);for(let p=0;p<d.length;p++){const y=new lp.Actor(d[p],i,this.id);y.name=`${a} ${p}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,a){Je(this.actors,(o,d)=>{o.send(e,i,d)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let b_,Y1;function $0(){return b_||(b_=new zo),b_}lp.Actor=Ln;class m5{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),a=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,a/i.BYTES_PER_ELEMENT),a}createFloatArray(e){const i=new Float32Array(e),a=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,a/i.BYTES_PER_ELEMENT),a}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let a=0;a<e.length;++a)this.module.heapU8[i+a]=e.charCodeAt(a);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,a=e.facadeGlazingColorRgb,o=e.roofColorRgb,d=e.wallColorRgb,p=e.normalScale;this.module.setStyle(i[0],i[1],i[2],a[0],a[1],a[2],o[0],o[1],o[2],d[0],d[1],d[2],p[0],p[1],p[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,a){this.module.setFauxFacadeOptions(e?1:0,i?1:0,a)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){for(const y of e){const T=this.createStringBuffer(y.roofType),A=[0],M=[];for(const j of y.coordinates)if(Array.isArray(j)){for(const B of j)M.push(B.x),M.push(B.y);A.push(M.length)}const z=this.createIntArray(A),P=this.createFloatArray(M);this.module.addFeature(y.id,y.sourceId,y.minHeight,y.height,T,y.roofType.length,P,z,A.length-1),this.module.free(T),this.module.free(z),this.module.free(P)}for(const y of i){let T;T=y.entrances?JSON.parse(y.entrances):[];const A=this.createFloatArray(T),M=[];for(const P of y.coordinates)M.push(P.x),M.push(P.y);const z=this.createFloatArray(M);this.module.addFacade(y.sourceId,y.crossPerc,y.distanceToRoad,A,T.length,z,M.length),this.module.free(A),this.module.free(z)}if(!this.module.generateMesh()){const y=this.module.getLastError();return this.readStringBuffer(y)}const a=this.module.getMeshCount(),o=new Array(a);for(let y=0;y<a;y++){const T=this.module.getPositionsPtr(y),A=this.module.getPositionsLength(y),M=new Float32Array(this.module.heapF32.buffer,T,A),z=this.module.getNormalsPtr(y),P=this.module.getNormalsLength(y),j=new Float32Array(this.module.heapF32.buffer,z,P),B=this.module.getColorsPtr(y),W=this.module.getColorsLength(y),Y=new Uint8Array(this.module.heapU8.buffer,B,W),K=this.module.getAOPtr(y),re=this.module.getAOLength(y),se=new Float32Array(this.module.heapF32.buffer,K,re),ue=this.module.getUVPtr(y),Re=this.module.getUVLength(y),Me=new Float32Array(this.module.heapF32.buffer,ue,Re),Ne=this.module.getFauxFacadePtr(y),Fe=this.module.getFauxFacadeLength(y),Ue=new Uint8Array(this.module.heapU8.buffer,Ne,Fe),pt=this.module.getIndicesPtr(y),$e=this.module.getIndicesLength(y),yt=new Int32Array(this.module.heap32.buffer,pt,$e),It=this.module.getBuildingPart(y),bt=this.readStringBuffer(It);o[y]={positions:M,normals:j,colors:Y,ao:se,uv:Me,isFauxFacade:Ue,indices:yt,buildingPart:bt}}const d=this.module.getRingCount(),p=[];for(let y=0;y<d;y++){const T=this.module.getRingPtr(y),A=this.module.getRingLength(y),M=new Float32Array(this.module.heapF32.buffer,T,A);p.push(M)}return{meshes:o,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:p}}}let w_,K1,Ku,yg,J1,xg=null,vg=null,cb=null,Z0=null;function ub(){return wt(self)&&self.worker.dracoUrl?self.worker.dracoUrl:K1||Vr.DRACO_URL}function hb(){if(wt(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(yg)return yg;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return yg=WebAssembly.validate(n)?Vr.MESHOPT_SIMD_URL:Vr.MESHOPT_URL,yg}function g5(){return Z0}const W0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},_5={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},T_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function db(n,e,i){const a=i.json.bufferViews.length,o=i.buffers.length;e.bufferView=a,i.json.bufferViews[a]={buffer:o,byteLength:n.byteLength},i.buffers[o]=n}const Q1="KHR_draco_mesh_compression";function y5(n,e){const i=n.extensions&&n.extensions[Q1];if(!i)return;const a=new Ku.Decoder,o=gb(e,i.bufferView),d=new Ku.Mesh;if(!a.DecodeArrayToMesh(o,o.byteLength,d))throw new Error("Failed to decode Draco mesh");const p=e.json.accessors[n.indices],y=W0[p.componentType],T=p.count*y.BYTES_PER_ELEMENT,A=Ku._malloc(T);y===Uint16Array?a.GetTrianglesUInt16Array(d,T,A):a.GetTrianglesUInt32Array(d,T,A),db(Ku.memory.buffer.slice(A,A+T),p,e),Ku._free(A);for(const M of Object.keys(i.attributes)){const z=a.GetAttributeByUniqueId(d,i.attributes[M]),P=e.json.accessors[n.attributes[M]],j=_5[P.componentType],B=P.count*T_[P.type]*W0[P.componentType].BYTES_PER_ELEMENT,W=Ku._malloc(B);a.GetAttributeDataArrayForAllPoints(d,z,Ku[j],B,W),db(Ku.memory.buffer.slice(W,W+B),P,e),Ku._free(W)}a.destroy(),d.destroy(),delete n.extensions[Q1]}const X0="EXT_meshopt_compression";function x5(n,e){if(!n.extensions||!n.extensions[X0])return;const i=n.extensions[X0],a=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),o=new Uint8Array(i.count*i.byteStride);J1.decodeGltfBuffer(o,i.count,i.byteStride,a,i.mode,i.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=o.buffer,delete n.extensions[X0]}const fb=1179937895,pb=new TextDecoder("utf8");function mb(n,e){return new URL(n,e).href}function v5(n,e,i,a){return fetch(mb(n.uri,a)).then(o=>o.arrayBuffer()).then(o=>{e.buffers[i]=o})}function gb(n,e){const i=n.json.bufferViews[e];return new Uint8Array(n.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function b5(n,e,i,a){if(n.uri){const o=mb(n.uri,a);return fetch(o).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{e.images[i]=d})}if(n.bufferView!==void 0){const o=gb(e,n.bufferView),d=new Blob([o],{type:n.mimeType});return createImageBitmap(d).then(p=>{e.images[i]=p})}}function _b(n,e=0,i){const a={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===fb){const M=new Uint32Array(n,e);let z=2;const P=(M[z++]>>2)-3,j=M[z++]>>2;if(z++,a.json=JSON.parse(pb.decode(M.subarray(z,z+j))),z+=j,z<P){const B=M[z++];z++;const W=e+(z<<2);a.buffers[0]=n.slice(W,W+B)}}else a.json=JSON.parse(pb.decode(new Uint8Array(n,e)));const{buffers:o,images:d,meshes:p,extensionsUsed:y,bufferViews:T}=a.json;let A=Promise.resolve();if(o){const M=[];for(let z=0;z<o.length;z++){const P=o[z];P.uri?M.push(v5(P,a,z,i)):a.buffers[z]||(a.buffers[z]=null)}A=Promise.all(M)}return A.then(()=>{const M=[],z=y&&y.includes(Q1),P=y&&y.includes(X0);if(z&&M.push(function(){if(!Ku)return w_??(w_=function(j){let B,W=null;function Y(){B=new Uint8Array(W.buffer)}function K(){throw new Error("Unexpected Draco error.")}const re={a:{a:K,d:function(se,ue,Re){return B.copyWithin(se,ue,ue+Re)},c:function(se){const ue=B.length,Re=Math.max(se>>>0,Math.ceil(1.2*ue)),Me=Math.ceil((Re-ue)/65536);try{return W.grow(Me),Y(),!0}catch{return!1}},b:K}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(j,re):j.then(se=>se.arrayBuffer()).then(se=>WebAssembly.instantiate(se,re))).then(se=>{const{Rb:ue,Qb:Re,P:Me,T:Ne,X:Fe,Ja:Ue,La:pt,Qa:$e,Va:yt,Wa:It,eb:bt,jb:Et,f:Ot,e:dt,yb:At,zb:at,Ab:tt,Bb:Nt,Db:Pt,Gb:vi}=se.instance.exports;W=dt;const ai=(()=>{let fi=0,Ht=0,xi=0,Gi=0;return Xt=>{xi&&(ue(Gi),ue(fi),Ht+=xi,xi=fi=0),fi||(Ht+=128,fi=Re(Ht));const mi=Xt.length+7&-8;let Oi=fi;mi>=Ht&&(xi=mi,Oi=Gi=Re(mi));for(let Qi=0;Qi<Xt.length;Qi++)B[Oi+Qi]=Xt[Qi];return Oi}})();return Y(),Ot(),{memory:dt,_free:ue,_malloc:Re,Mesh:class{constructor(){this.ptr=Me()}destroy(){Ne(this.ptr)}},Decoder:class{constructor(){this.ptr=Ue()}destroy(){Et(this.ptr)}DecodeArrayToMesh(fi,Ht,xi){const Gi=ai(fi),Xt=pt(this.ptr,Gi,Ht,xi.ptr);return!!Fe(Xt)}GetAttributeByUniqueId(fi,Ht){return{ptr:$e(this.ptr,fi.ptr,Ht)}}GetTrianglesUInt16Array(fi,Ht,xi){yt(this.ptr,fi.ptr,Ht,xi)}GetTrianglesUInt32Array(fi,Ht,xi){It(this.ptr,fi.ptr,Ht,xi)}GetAttributeDataArrayForAllPoints(fi,Ht,xi,Gi,Xt){bt(this.ptr,fi.ptr,Ht.ptr,xi,Gi,Xt)}},DT_INT8:At(),DT_UINT8:at(),DT_INT16:tt(),DT_UINT16:Nt(),DT_UINT32:Pt(),DT_FLOAT32:vi()}})}(fetch(ub())),w_.then(j=>{Ku=j,w_=void 0}))}()),P&&M.push(function(){if(J1)return;const j=function(B){let W;const Y=WebAssembly.instantiateStreaming(B,{}).then(se=>{W=se.instance,W.exports.__wasm_call_ctors()}),K={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},re={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Y,supported:!0,decodeGltfBuffer(se,ue,Re,Me,Ne,Fe){(function(Ue,pt,$e,yt,It,bt,Et){const Ot=Ue.exports.sbrk,dt=yt+3&-4,At=Ot(dt*It),at=Ot(bt.length),tt=new Uint8Array(Ue.exports.memory.buffer);tt.set(bt,at);const Nt=pt(At,yt,It,at,bt.length);if(Nt===0&&Et&&Et(At,dt,It),$e.set(tt.subarray(At,At+yt*It)),Ot(At-Ot(0)),Nt!==0)throw new Error(`Malformed buffer data: ${Nt}`)})(W,W.exports[re[Ne]],se,ue,Re,Me,W.exports[K[Fe]])}}}(fetch(hb()));return j.ready.then(()=>{J1=j})}()),d)for(let j=0;j<d.length;j++)M.push(b5(d[j],a,j,i));return(M.length?Promise.all(M):Promise.resolve()).then(()=>{if(z&&p)for(const{primitives:j}of p)for(const B of j)y5(B,a);if(P&&p&&T)for(const j of T)x5(j,a);return a})})}function ex(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function tx(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class ix{constructor(e,i,a,o){this.context=e,this.format=a,this.useMipmap=o&&o.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:o&&o.premultiply})}update(e,i){const a=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,o=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:d}=this,{gl:p}=d,{x:y,y:T}=i&&i.position?i.position:{x:0,y:0},A=y+a,M=T+o;!this.size||this.size[0]===A&&this.size[1]===M||(p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(this.texture),this.texture=p.createTexture(),this.size=null),p.bindTexture(p.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA8&&(!i||i.premultiply!==!1));const z=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&A>0&&M>0){const P=this.useMipmap?Math.floor(Math.log2(Math.max(A,M)))+1:1;p.texStorage2D(p.TEXTURE_2D,P,this.format,A,M),this.size=[A,M]}this.size&&(z?p.texSubImage2D(p.TEXTURE_2D,0,y,T,ex(this.format),tx(this.format),e):"data"in e&&e.data&&p.texSubImage2D(p.TEXTURE_2D,0,y,T,a,o,ex(this.format),tx(this.format),e.data)),this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,i,a=!1){const{context:o}=this,{gl:d}=o;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,a,o,d){const{context:p}=this,{gl:y}=p;y.bindTexture(y.TEXTURE_2D,this.texture),i!==this.magFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap?e===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,a),this.wrapS=a),o!==this.wrapT&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,o),this.wrapT=o),d!==this.compareMode&&(d?(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_MODE,y.COMPARE_REF_TO_TEXTURE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_FUNC,d)):y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_MODE,y.NONE),this.compareMode=d)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class S_{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:a}=this,{gl:o}=a;o.bindTexture(o.TEXTURE_2D,this.texture),e!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,e),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,i),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,i),this.wrapS=i)}}const w5=yn([{name:"a_pos_3f",components:3,type:"Float32"}]),T5=yn([{name:"a_color_3f",components:3,type:"Float32"}]),S5=yn([{name:"a_color_4f",components:4,type:"Float32"}]),E5=yn([{name:"a_uv_2f",components:2,type:"Float32"}]),A5=yn([{name:"a_normal_3f",components:3,type:"Float32"}]),C5=yn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),R5=yn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function yb(n,e){const i=Y0(n.projection,n.zoom,n.width,n.height),a=function(d,p,y,T,A){const M=new G(y.lng-180*cp,y.lat),z=new G(y.lng+180*cp,y.lat),P=d.project(M.lng,M.lat),j=d.project(z.lng,z.lat),B=-Math.atan2(j.y-P.y,j.x-P.x),W=ot.fromLngLat(y);W.y=Ie(W.y,-1+cp,1-cp);const Y=W.toLngLat(),K=d.project(Y.lng,Y.lat),re=ot.fromLngLat(Y);re.x+=cp;const se=re.toLngLat(),ue=d.project(se.lng,se.lat),Re=vb(ue.x-K.x,ue.y-K.y,B),Me=ot.fromLngLat(Y);Me.y+=cp;const Ne=Me.toLngLat(),Fe=d.project(Ne.lng,Ne.lat),Ue=vb(Fe.x-K.x,Fe.y-K.y,B),pt=Math.abs(Re.x)/Math.abs(Ue.y),$e=Se([]);Ke($e,$e,-B*(1-(A?0:T)));const yt=Se([]);return ye(yt,yt,[1,1-(1-pt)*T,1]),yt[4]=-Ue.x/Ue.y*T,Ke(yt,yt,B),ge(yt,$e,yt),yt}(n.projection,0,n.center,i,e),o=xb(n);return ye(a,a,[o,o,1]),a}function xb(n){const e=n.projection,i=Y0(n.projection,n.zoom,n.width,n.height),a=nx(e,n.center),o=nx(e,G.convert(e.center));return Math.pow(2,a*i+(1-i)*o)}function Y0(n,e,i,a,o=1/0){const d=n.range;if(!d)return 0;const p=Math.min(o,Math.max(i,a)),y=Math.log2(p/1024);return et(d[0]+y,d[1]+y,e)}const cp=1/4e4;function nx(n,e){const i=Ie(e.lat,-85.051129,Ce),a=new G(e.lng-180*cp,i),o=new G(e.lng+180*cp,i),d=n.project(a.lng,i),p=n.project(o.lng,i),y=ot.fromLngLat(a),T=ot.fromLngLat(o),A=p.x-d.x,M=p.y-d.y,z=T.x-y.x,P=T.y-y.y,j=Math.sqrt((z*z+P*P)/(A*A+M*M));return Math.log2(j)}function vb(n,e,i){const a=Math.cos(i),o=Math.sin(i);return{x:n*a-e*o,y:n*o+e*a}}function bb(n,e,i){Se(n),Ke(n,n,He(e[2])),Pe(n,n,He(e[0])),Ae(n,n,He(e[1])),ye(n,n,i),ge(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function K0(n,e,i,a,o,d,p,y){const T=[i[0]-e[0],i[1]-e[1],0],A=[a[0]-e[0],a[1]-e[1],0];if(wi(T)<1e-12||wi(A)<1e-12)return mo(n);const M=Ii([],T,A);Ti(M,M),ki(A,a,e),T[2]=(d-o)*y,A[2]=(p-o)*y;const z=T;return Ii(z,T,A),Ti(z,z),Sa(n,M,z)}function rx(n,e,i=!1){const a=Wh(e.zoom),o=function(d,p,y){const T=p.worldSize,A=[d[12],d[13],d[14]],M=ve(A[1]/T),z=Ee(A[0]/T),P=Se([]),j=we(1,M)*T,B=we(1,0)*T*je(M,p.zoom),W=1/nm(T);let Y=B*W;if(y){const ue=Y0(p.projection,p.zoom,p.width,p.height,1024);Y=W*p.projection.pixelSpaceConversion(p.center.lat,T,ue)}const K=k(M,z);Wt(K,K,Ft([],Ti([],K),j*Y*A[2]));const re=function(ue){const Re=[ue[0],ue[1],ue[2]];let Me=[0,1,0];const Ne=Ii([],Me,Re);return Ii(Me,Re,Ne),ii(Me)===0&&(Me=[0,1,0],Ii(Ne,Re,Me)),Ti(Ne,Ne),Ti(Me,Me),Ti(Re,Re),[Ne[0],Ne[1],Ne[2],0,Me[0],Me[1],Me[2],0,Re[0],Re[1],Re[2],0,ue[0],ue[1],ue[2],1]}(K);ye(P,P,[Y,Y,Y*j]),xe(P,P,[-A[0],-A[1],-A[2]]);const se=ge([],p.globeMatrix,re);return ge(se,se,P),ge(se,se,d),se}(n,e,i);if(a>0){const d=function(p,y){const T=y.worldSize,A=we(1,0)*T*je(y.center.lat,y.zoom)/nm(T),M=we(1,y.center.lat)*T,z=Se([]);Ae(z,z,He(y.center.lng)),Pe(z,z,He(y.center.lat)),xe(z,z,[0,0,c]),ye(z,z,[A,A,A*M]);const P=y.point;return xe(z,z,[-P.x,-P.y,0]),ge(z,z,p),ge(z,y.globeMatrix,z)}(n,e);return function(p,y,T){const A=(B,W,Y)=>{const K=wi(B),re=wi(W),se=nl(B,W,Y);return Ft(se,se,1/wi(se)*zi(K,re,Y))},M=A([p[0],p[1],p[2]],[y[0],y[1],y[2]],T),z=A([p[4],p[5],p[6]],[y[4],y[5],y[6]],T),P=A([p[8],p[9],p[10]],[y[8],y[9],y[10]],T),j=nl([p[12],p[13],p[14]],[y[12],y[13],y[14]],T);return[M[0],M[1],M[2],0,z[0],z[1],z[2],0,P[0],P[1],P[2],0,j[0],j[1],j[2],1]}(o,d,a)}return o}function wb(n,e,i,a){const o=Pi.projectAabbCorners(a,i);let d=Number.MAX_VALUE,p=-1;for(let A=0;A<o.length;++A){const M=o[A];M[0]=(.5*M[0]+.5)*e.width,M[1]=(.5-.5*M[1])*e.height,M[2]<d&&(p=A,d=M[2])}const y=A=>new Mt(o[A][0],o[A][1]);let T;switch(p){case 0:case 6:T=[y(1),y(5),y(4),y(7),y(3),y(2),y(1)];break;case 1:case 7:T=[y(0),y(4),y(5),y(6),y(2),y(3),y(0)];break;case 3:case 5:T=[y(1),y(0),y(4),y(7),y(6),y(2),y(1)];break;default:T=[y(1),y(5),y(6),y(7),y(3),y(0),y(1)]}if(Ga(n,T))return d}const gm=64,bg={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Tb(n,e,i,a,o,d,p,y,T,A=!1){const M=i.zoom,z=i.project(a),P=je(a.lat,M),j=1/P;Se(n),xe(n,n,[z.x+p[0]*j,z.y+p[1]*j,p[2]]);let B=1,W=1;const Y=i.worldSize;if(A){if(i.projection.name==="mercator"){let ue=0;i.elevation&&(ue=i.elevation.getAtPointOrZero(new ot(z.x/Y,z.y/Y),0));const Re=js([],[z.x,z.y,ue,1],i.projMatrix)[3]/i.cameraToCenterDistance;B=Re,W=Re*je(i.center.lat,M)}else if(i.projection.name==="globe"){const ue=rx(n,i),Re=[0,0,0,1];js(Re,Re,ge([],i.projMatrix,ue));const Me=Re[3]/i.cameraToCenterDistance,Ne=Wh(M),Fe=i.projection.pixelsPerMeter(a.lat,Y)*je(a.lat,M),Ue=i.projection.pixelsPerMeter(i.center.lat,Y)*je(i.center.lat,M);B=Me/zi(Fe,We(i.center.lat),Ne),W=Me*P/Fe,B*=Ue,W*=Ue}}else B=j;ye(n,n,[B,B,W]);const K=[...n],re=e.orientation,se=[];if(bb(se,[re[0]+o[0],re[1]+o[1],re[2]+o[2]],d),ge(n,K,se),y&&i.elevation){let ue=0;const Re=[];if(T&&i.elevation){ue=function(Ne,Fe,Ue,pt,$e){const yt=Fe.elevation;if(!yt)return 0;const It=Pi.projectAabbCorners(Ue,pt),bt=we(1,$e.lat)*Fe.worldSize,Et=function(Ht,xi){const Gi=[0,0,1],Xt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const mi of Xt){const Oi=Ht[mi.corners[0]],Qi=Ht[mi.corners[1]],hn=Ht[mi.corners[2]],nn=[Qi[0]-Oi[0],Qi[1]-Oi[1],xi*(Qi[2]-Oi[2])],ui=Ii(nn,nn,[hn[0]-Oi[0],hn[1]-Oi[1],xi*(hn[2]-Oi[2])]);Ti(ui,ui),mi.dotProductWithUp=Mi(ui,Gi)}return Xt.sort((mi,Oi)=>mi.dotProductWithUp-Oi.dotProductWithUp),Xt[0].corners}(It,bt),Ot=It[Et[0]],dt=It[Et[1]],At=It[Et[2]],at=It[Et[3]],tt=yt.getAtPointOrZero(new ot(Ot[0]/Fe.worldSize,Ot[1]/Fe.worldSize),0),Nt=yt.getAtPointOrZero(new ot(dt[0]/Fe.worldSize,dt[1]/Fe.worldSize),0),Pt=yt.getAtPointOrZero(new ot(At[0]/Fe.worldSize,At[1]/Fe.worldSize),0),vi=yt.getAtPointOrZero(new ot(at[0]/Fe.worldSize,at[1]/Fe.worldSize),0),ai=(tt+vi)/2,fi=(Nt+Pt)/2;return ai>fi?Nt<Pt?K0(Ne,dt,at,Ot,Nt,vi,tt,bt):K0(Ne,At,Ot,at,Pt,tt,vi,bt):tt<vi?K0(Ne,Ot,dt,At,tt,Nt,Pt,bt):K0(Ne,at,At,dt,vi,Pt,Nt,bt),Math.max(ai,fi)}(Re,i,e.aabb,n,a);const Me=ge([],ut([],Re),se);ge(n,K,Me)}else ue=i.elevation.getAtPointOrZero(new ot(z.x/Y,z.y/Y),0);ue!==0&&(n[14]+=ue)}}function E_(n,e,i=!1){n.uploaded||(n.gfxTexture=new ix(e,n.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function M5(n,e,i){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,w5.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,A5.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,E5.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?T5:S5).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,R5.members,!0)),n.segments=qn.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const a=n.material;a.pbrMetallicRoughness.baseColorTexture&&E_(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&E_(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&E_(a.normalTexture,e),a.occlusionTexture&&E_(a.occlusionTexture,e,i),a.emissionTexture&&E_(a.emissionTexture,e)}function sx(n,e,i){if(n.meshes)for(const a of n.meshes)M5(a,e,i);if(n.children)for(const a of n.children)sx(a,e,i)}function J0(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)J0(e)}function ax(n){if(n.meshes)for(const i of n.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const i of n.children)ax(i)}function _m(n,e){const i=n.json.bufferViews[e.bufferView],a=W0[e.componentType];return new a(n.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==T_[e.type]*a.BYTES_PER_ELEMENT?i.byteStride/a.BYTES_PER_ELEMENT:T_[e.type]))}function ox(n,e,i,a){const o=W0[e.componentType],d=function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(o),p=n.json.bufferViews[e.bufferView],y=p.byteStride?p.byteStride/o.BYTES_PER_ELEMENT:T_[e.type],T=i.float32,A=T.length/i.capacity;for(let M=0,z=0;M<e.count*y;M+=y,z+=A)for(let P=0;P<A;P++)T[z+P]=a[M+P]*d;i._trim()}function I5(n,e,i){const a=n.indices,o=n.attributes,d={};d.indexArray=new is;const p=e.json.accessors[a],y=p.count/3;d.indexArray.reserve(y);const T=_m(e,p);for(let P=0;P<y;P++)d.indexArray.emplaceBack(T[3*P],T[3*P+1],T[3*P+2]);d.indexArray._trim(),d.vertexArray=new oa;const A=e.json.accessors[o.POSITION];d.vertexArray.reserve(A.count);const M=_m(e,A);for(let P=0;P<A.count;P++)d.vertexArray.emplaceBack(M[3*P],M[3*P+1],M[3*P+2]);if(d.vertexArray._trim(),d.aabb=new Pi(A.min,A.max),d.centroid=function(P,j){const B=[0,0,0],W=P.length;if(W>0){for(let Y=0;Y<W;Y++){const K=3*P[Y];B[0]+=j[K],B[1]+=j[K+1],B[2]+=j[K+2]}B[0]/=W,B[1]/=W,B[2]/=W}return B}(T,M),o.COLOR_0!==void 0){const P=e.json.accessors[o.COLOR_0],j=T_[P.type],B=_m(e,P);d.colorArray=j===3?new oa:new oo,d.colorArray.resize(P.count),ox(e,P,d.colorArray,B)}if(o.NORMAL!==void 0){d.normalArray=new oa;const P=e.json.accessors[o.NORMAL];d.normalArray.resize(P.count);const j=_m(e,P);ox(e,P,d.normalArray,j)}if(o.TEXCOORD_0!==void 0&&i.length>0){d.texcoordArray=new Tl;const P=e.json.accessors[o.TEXCOORD_0];d.texcoordArray.resize(P.count);const j=_m(e,P);ox(e,P,d.texcoordArray,j)}if(o._FEATURE_ID_RGBA4444!==void 0){const P=e.json.accessors[o._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=_m(e,P))}o._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(_m(e,e.json.accessors[o._FEATURE_RGBA4444]).buffer));const z=n.material;return d.material=function(P,j){const{emissiveFactor:B=[0,0,0],alphaMode:W="OPAQUE",alphaCutoff:Y=.5,normalTexture:K,occlusionTexture:re,emissiveTexture:se,doubleSided:ue}=P,{baseColorFactor:Re=[1,1,1,1],metallicFactor:Me=1,roughnessFactor:Ne=1,baseColorTexture:Fe,metallicRoughnessTexture:Ue}=P.pbrMetallicRoughness||{},pt=re?j[re.index]:void 0;if(re&&re.extensions&&re.extensions.KHR_texture_transform&&pt){const $e=re.extensions.KHR_texture_transform;pt.offsetScale=[$e.offset[0],$e.offset[1],$e.scale[0],$e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Vn(...Re),metallicFactor:Me,roughnessFactor:Ne,baseColorTexture:Fe?j[Fe.index]:void 0,metallicRoughnessTexture:Ue?j[Ue.index]:void 0},doubleSided:ue,emissiveFactor:new Vn(...B),alphaMode:W,alphaCutoff:Y,normalTexture:K?j[K.index]:void 0,occlusionTexture:pt,emissionTexture:se?j[se.index]:void 0,defined:P.defined===void 0}}(z!==void 0?e.json.materials[z]:{defined:!1},i),d}function Sb(n,e,i){const{matrix:a,rotation:o,translation:d,scale:p,mesh:y,extras:T,children:A}=n,M={};if(M.matrix=a||function(z,P,j,B){var W=P[0],Y=P[1],K=P[2],re=P[3],se=W+W,ue=Y+Y,Re=K+K,Me=W*se,Ne=W*ue,Fe=W*Re,Ue=Y*ue,pt=Y*Re,$e=K*Re,yt=re*se,It=re*ue,bt=re*Re,Et=B[0],Ot=B[1],dt=B[2];return z[0]=(1-(Ue+$e))*Et,z[1]=(Ne+bt)*Et,z[2]=(Fe-It)*Et,z[3]=0,z[4]=(Ne-bt)*Ot,z[5]=(1-(Me+$e))*Ot,z[6]=(pt+yt)*Ot,z[7]=0,z[8]=(Fe+It)*dt,z[9]=(pt-yt)*dt,z[10]=(1-(Me+Ue))*dt,z[11]=0,z[12]=j[0],z[13]=j[1],z[14]=j[2],z[15]=1,z}([],o||[0,0,0,1],d||[0,0,0],p||[1,1,1]),y!==void 0){M.meshes=i[y];const z=M.anchor=[0,0];for(const P of M.meshes){const{min:j,max:B}=P.aabb;z[0]+=j[0]+B[0],z[1]+=j[1]+B[1]}z[0]=Math.floor(z[0]/M.meshes.length/2),z[1]=Math.floor(z[1]/M.meshes.length/2)}if(T&&(T.id&&(M.id=T.id),T.lights&&(M.lights=function(z){if(!z.length)return[];const P=function(K){const re=atob(K),se=new Uint8Array(re.length);for(let ue=0;ue<re.length;ue++)se[ue]=re.codePointAt(ue);return se}(z),j=[],B=P.length/24,W=new Uint16Array(P.buffer),Y=new Float32Array(P.buffer);for(let K=0;K<B;K++){const re=W[2*K*6]/30,se=W[2*K*6+1]/30,ue=W[2*K*6+10]/100,Re=Y[6*K+1],Me=Y[6*K+2],Ne=Y[6*K+3],Fe=Y[6*K+4],Ue=Ne-Re,pt=Fe-Me,$e=Math.hypot(Ue,pt);j.push({pos:[Re+.5*Ue,Me+.5*pt,se],normal:[pt/$e,-Ue/$e,0],width:$e,height:re,depth:ue,points:[Re,Me,Ne,Fe]})}return j}(T.lights))),A){const z=[];for(const P of A)z.push(Sb(e.json.nodes[P],e,i));M.children=z}return M}function z5(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new Kd(n.vertices,n.indices,8,256),[i,a]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:i,max:a}}function D5(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const a=[];for(const p of i){if(!Array.isArray(p)||p.length!==2)continue;const y=p[0],T=p[1];typeof y=="number"&&typeof T=="number"&&a.push(new Mt(y,T))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let o=0;for(let p=0;p<a.length;p++){const y=a[p],T=a[(p+1)%a.length],A=a[(p+2)%a.length];o+=(y.x-T.x)*(A.y-T.y)-(A.x-T.x)*(y.y-T.y)}o>0&&a.reverse();const d=Xh(a.flatMap(p=>[p.x,p.y]),[]);return d.length===0?null:{vertices:a,indices:d}}function P5(n,e){const i=[],a=[];let o=0;const d=[];for(const p of n){o=i.length;const y=p.vertexArray.float32,T=p.indexArray.uint16;for(let A=0;A<p.vertexArray.length;A++)d[0]=y[3*A+0],d[1]=y[3*A+1],d[2]=y[3*A+2],St(d,d,e),i.push(new Mt(d[0],d[1]));for(let A=0;A<3*p.indexArray.length;A++)a.push(T[A]+o)}if(a.length%3!=0)return null;for(let p=0;p<a.length;p+=3){const y=i[a[p+0]],T=i[a[p+1]],A=i[a[p+2]];(y.x-T.x)*(A.y-T.y)-(A.x-T.x)*(y.y-T.y)>0&&([a[p+1],a[p+2]]=[a[p+2],a[p+1]])}return{vertices:i,indices:a}}function Eb(n){const e=function(T,A){const M=[],z=WebGL2RenderingContext;if(T.json.textures)for(const P of T.json.textures){const j={magFilter:z.LINEAR,minFilter:z.NEAREST,wrapS:z.REPEAT,wrapT:z.REPEAT};P.sampler!==void 0&&Object.assign(j,T.json.samplers[P.sampler]),M.push({image:A[P.source],sampler:j,uploaded:!1})}return M}(n,n.images),i=function(T,A){const M=[];for(const z of T.json.meshes){const P=[];for(const j of z.primitives)P.push(I5(j,T,A));M.push(P)}return M}(n,e),{scenes:a,scene:o,nodes:d}=n.json,p=a?a[o||0].nodes:[...d.keys()],y=[];for(const T of p)y.push(Sb(d[T],n,i));return function(T,A,M){const z={},P=new Set;for(let j=0;j<T.length;j++){const B=M[A[j]];if(!B.extras)continue;const W=B.extras["mapbox:footprint:version"],Y=B.extras["mapbox:footprint:id"];(W||Y)&&P.add(j),W==="1.0.0"&&Y&&(z[Y]=j)}for(let j=0;j<T.length;j++){if(P.has(j))continue;const B=T[j],W=M[A[j]];if(!W.extras)continue;let Y=null;B.id in z&&(Y=P5(T[z[B.id]].meshes,B.matrix)),Y||(Y=D5(W)),Y&&(B.footprint=z5(Y))}if(P.size>0){const j=Array.from(P.values()).sort((B,W)=>B-W);for(let B=j.length-1;B>=0;B--)T.splice(j[B],1)}}(y,p,n.json.nodes),y}function L5(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,i=n.aabb.min[0]-1,a=n.aabb.min[1]-1,o=gm/(n.aabb.max[0]-i+2),d=gm/(n.aabb.max[1]-a+2);for(let p=0;p<e.length;p+=3){const y=e[p+2],T=(e[p+0]-i)*o|0,A=(e[p+1]-a)*d|0;y>n.heightmap[A*gm+T]&&(n.heightmap[A*gm+T]=y)}}function Ab(n,e,i,a,o){i.reserve(i.length+4*n.length),a.reserve(a.length+10*n.length),o.reserve(o.length+10*n.length);let d=a.length;for(const p of n){const y=Math.min(10,Math.max(4,1.3*p.height))*e,T=[-p.normal[1],p.normal[0],0],A=Math.min(.29,.1*p.width/p.depth),M=p.width-2*p.depth*e*(A+.01),z=Di([],p.pos,T,M/2),P=Di([],p.pos,T,-M/2),j=[z[0],z[1],z[2]+p.height],B=[P[0],P[1],P[2]+p.height],W=Di([],p.normal,T,A);Ft(W,W,y);const Y=Di([],p.normal,T,-A);Ft(Y,Y,y),Wt(W,z,W),Wt(Y,P,Y),z[2]+=.1,P[2]+=.1,a.emplaceBack(W[0],W[1],W[2]),a.emplaceBack(Y[0],Y[1],Y[2]),a.emplaceBack(z[0],z[1],z[2]),a.emplaceBack(P[0],P[1],P[2]),a.emplaceBack(j[0],j[1],j[2]),a.emplaceBack(B[0],B[1],B[2]),a.emplaceBack(z[0],z[1],z[2]),a.emplaceBack(P[0],P[1],P[2]),a.emplaceBack(W[0],W[1],W[2]),a.emplaceBack(Y[0],Y[1],Y[2]);const K=M/y/2;o.emplaceBack(-K-A,-1,K,.8),o.emplaceBack(K+A,-1,K,.8),o.emplaceBack(-K,0,K,1.3),o.emplaceBack(K,0,K,1.3),o.emplaceBack(K+A,-.8,K,.7),o.emplaceBack(K+A,-.8,K,.7),o.emplaceBack(0,0,K,1.3),o.emplaceBack(0,0,K,1.3),o.emplaceBack(K+A,-1.2,K,.8),o.emplaceBack(K+A,-1.2,K,.8),i.emplaceBack(6+d,4+d,8+d),i.emplaceBack(7+d,9+d,5+d),i.emplaceBack(0+d,1+d,2+d),i.emplaceBack(1+d,3+d,2+d),d+=10}}function O5(n,e){const i={};i.indexArray=new is,i.vertexArray=new oa,i.colorArray=new oo,Ab(n,e,i.indexArray,i.vertexArray,i.colorArray);const a={defined:!0};a.emissiveFactor=Vn.black;const o={};return o.baseColorFactor=Vn.white,a.pbrMetallicRoughness=o,i.material=a,i.aabb=new Pi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const Cb=yn([{name:"a_pos_3f",components:3,type:"Float32"}]),k5=yn([{name:"a_normal_3",components:3,type:"Int16"}]),N5=yn([{name:"a_centroid_3",components:3,type:"Int16"}]),Rb=yn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),j5=yn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),B5=yn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),F5=yn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),U5=yn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),Mb=Tt.types,lx=32767;function V5(n,e){const i=Vt+e;for(const a of n)for(const o of a)if(o.x<-163||o.x>i||o.y<-163||o.y>i)return!1;return!0}class Ib{constructor(){this.layoutVertexArray=new oa,this.layoutAttenuationArray=new oo,this.layoutColorArray=new Kr,this.indexArray=new is,this.indexArrayForConflation=new is,this.segmentsBucket=new qn}}class cx{constructor(){this.layoutVertexArray=new oa,this.layoutNormalArray=new Yc,this.layoutCentroidArray=new Yc,this.layoutColorArray=new Kr,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutAOArray=[],this.indexArray=new is,this.indexArrayForConflation=new is,this.segmentsBucket=new qn,this.entranceBloom=new Ib}}class zb{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new cx,this.buildingWithFacade=new cx,this.indexArrayForConflationUploaded=!1,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new Kr,this.buildingWithFacade.layoutFacadeDataArray=new Jc,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new Kr,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.groundEffect=new v_(e)}updateFootprints(e,i){for(const a of this.footprints)i.push({footprint:a,id:e})}prepare(){return function(){if(Z0!=null||cb!=null)return null;if(vg!=null)return vg;const e=fetch(Vr.BUILDING_GEN_URL);return vg=function(i){let a,o,d,p;function y(){a=new Uint8Array(p.buffer),o=new Int32Array(p.buffer),d=new Float32Array(p.buffer)}function T(){throw new Error("Unexpected BuildingGen error.")}const A=()=>{},M={a:{a:T,f:function(z){const P=a.length,j=Math.max(z>>>0,Math.ceil(1.2*P)),B=Math.ceil((j-P)/65536);try{return p.grow(B),y(),!0}catch{return!1}},g:T,b:A,c:A,d:A,e:A}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,M):i.then(z=>z.arrayBuffer()).then(z=>WebAssembly.instantiate(z,M))).then(z=>{const P=z.instance.exports;return(0,P.g)(),p=P.f,y(),new m5({setStyle:P.h,setAOOptions:P.i,setMetricOptions:P.j,setStructuralOptions:P.k,setFacadeOptions:P.l,setFauxFacadeOptions:P.m,setFacadeClassifierOptions:P.n,addFeature:P.o,addFacade:P.p,generateMesh:P.q,getLastError:P.r,getOuterRingLength:P.s,getMeshCount:P.t,getPositionsPtr:P.u,getPositionsLength:P.v,getNormalsPtr:P.w,getNormalsLength:P.x,getColorsPtr:P.y,getColorsLength:P.z,getAOPtr:P.A,getAOLength:P.B,getUVPtr:P.C,getUVLength:P.D,getFauxFacadePtr:P.E,getFauxFacadeLength:P.F,getIndicesPtr:P.G,getIndicesLength:P.H,getBuildingPart:P.I,getRingCount:P.J,getRingPtr:P.K,getRingLength:P.L,free:P.M,malloc:P.N,heapU8:a,heap32:o,heapF32:d})})}(e).then(i=>(vg=null,Z0=i,Z0)).catch(i=>{cn("Could not load building-gen"),vg=null,cb=i}),vg}()}populate(e,i,a,o){const d=g5();if(!d)return;const p=Ze(a);this.tileToMeter=p,this.brightness=i.brightness,d.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,p],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:p,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),d.setAOOptions(!1,.3),d.setMetricOptions(!1,16),d.setStructuralOptions(!0),d.setFacadeClassifierOptions(3);const y=new Map;for(const{feature:T}of e){if(Mb[T.type]!=="LineString")continue;const A=this.layers[0]._featureFilter.needGeometry,M=Ct(T,A);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom),M,a))continue;const z=A?M.geometry:qt(T,a,o),P=[];for(const Y of z)for(const K of Y)P.push({x:K.x,y:K.y});const j={coordinates:P,crossPerc:T.properties.cross_perc,distanceToRoad:T.properties.distance_to_road,entrances:T.properties.entrances,sourceId:0},B=T.properties.source_id;let W=y.get(B);W||(W=[],y.set(B,W)),W.push(j)}this.maxHeight=0;for(const{feature:T,index:A}of e){if(Mb[T.type]==="LineString")continue;const M=this.layers[0]._featureFilter.needGeometry,z=Ct(T,M);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom),z,a))continue;const P=M?z.geometry:qt(T,a,o),j=lm(P,500);if(!V5(P,163))continue;const B=this.layers[0],W=B.layout.get("building-base").evaluate(T,{},a),Y=B.layout.get("building-height").evaluate(T,{},a),K=B.layout.get("building-roof-shape").evaluate(T,{},a),re=B.paint.get("building-ambient-occlusion-intensity"),se=B.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(K==="flat")continue;const ue=B.layout.get("building-facade").evaluate(T,{},a);d.setFacadeOptions(4,!0),d.setFauxFacadeOptions(ue,!1,1);const Re=T.properties.source_id;let Me;Me=y.has(Re)?y.get(Re):[];let Ne=0,Fe=0,Ue=0,pt=0,$e=0,yt=0;if(ue){let ui=Math.round(B.layout.get("building-facade-floors").evaluate(T,{},a));if(W===0){ui=Math.max(1,ui-(Me.length>0?1:0));let An=4;if(Y>100){const fe=[10,13,15];An=fe[T.id?T.id%fe.length:0],d.setFacadeOptions(An,!0)}$e=1.6803*An/p}else $e=W/p;yt=Y/p,$e=Math.min($e,yt),Ue=B.layout.get("building-facade-unit-width").evaluate(T,{},a)/p,pt=(yt-$e)/ui,d.setFauxFacadeOptions(!0,!0,Ue);const en=B.layout.get("building-facade-window").evaluate(T,{},a);Ne=en[0],Fe=en[1]}const It=[],bt=new Mt(1/0,1/0),Et=new Mt(-1/0,-1/0),Ot=new Mt(0,0);let dt=0;for(const ui of j)if(ui.length>0){const en=[];for(const An of ui){const fe=[];for(let me=An.length-1;me>=0;me--){const st=An[me];fe.push({x:st.x,y:st.y}),bt.x=Math.min(bt.x,st.x),bt.y=Math.min(bt.y,st.y),Et.x=Math.max(Et.x,st.x),Et.y=Math.max(Et.y,st.y),Ot.x+=st.x,Ot.y+=st.y,dt++}en.push(fe)}It.push({id:T.id?T.id:0,height:Y,minHeight:W,sourceId:0,roofType:K,coordinates:en})}Ot.x/=dt||1,Ot.y/=dt||1;const At=d.generateMesh(It,Me);if(typeof At=="string"){cn(`Unable to generate building ${T.id}: ${At}`);continue}if(At.meshes.length===0||At.modifiedPolygonRings.length===0)continue;let at=0;for(const ui of At.meshes)at+=ui.positions.length/3;const tt=ue?this.buildingWithFacade:this.buildingWithoutFacade,Nt=tt.segmentsBucket.prepareSegment(at,tt.layoutVertexArray,tt.indexArray),Pt=[];let vi=null,ai=0,fi=-1;const Ht=tt.indexArray.length;let xi=0;for(const ui of At.meshes){const en=tt.layoutVertexArray.length;if(ui.buildingPart==="entrance"){const ft=new Array;for(let Si=0;Si<ui.indices.length;Si+=12){const dn=ui.positions[Si+0],mn=ui.positions[Si+1],an=ui.positions[Si+3],Yn=ui.positions[Si+4],Cr=ui.positions[Si+2],sn=ui.positions[Si+8]-Cr,gr=1,er=an-dn,Fn=Yn-mn,vr=Math.hypot(er,Fn);ft.push({pos:[dn+.5*er,mn+.5*Fn,Cr],normal:[Fn/vr,-er/vr,0],width:vr,height:sn,depth:gr,points:[dn,mn,an,Yn]})}const Zt=tt.entranceBloom.segmentsBucket.prepareSegment(10*ft.length,tt.entranceBloom.layoutVertexArray,tt.entranceBloom.indexArray),$t=tt.entranceBloom.layoutVertexArray.length;ai=tt.entranceBloom.indexArray.length,Ab(ft,.5/this.tileToMeter,tt.entranceBloom.indexArray,tt.entranceBloom.layoutVertexArray,tt.entranceBloom.layoutAttenuationArray);const ci=tt.entranceBloom.layoutVertexArray.length-$t;fi=tt.entranceBloom.indexArray.length-ai;for(let Si=0;Si<ci;Si++)tt.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Zt.vertexLength+=ci,Zt.primitiveLength+=fi,vi={part:ui.buildingPart,vertexOffset:$t,vertexLength:ci}}for(let ft=0;ft<ui.positions.length;ft+=3)xi=Math.max(xi,ui.positions[ft+2]),tt.layoutVertexArray.emplaceBack(ui.positions[ft],ui.positions[ft+1],ui.positions[ft+2]);const An=Math.floor(Ot.x),fe=Math.floor(Ot.y),me=Math.floor(xi);for(let ft=0;ft<ui.positions.length;ft+=3)tt.layoutCentroidArray.emplaceBack(An,fe,me);for(let ft=0;ft<ui.normals.length;ft+=3)tt.layoutNormalArray.emplaceBack(ui.normals[ft+0]*lx,ui.normals[ft+1]*lx,ui.normals[ft+2]*lx);for(let ft=0;ft<ui.ao.length;ft++)tt.layoutAOArray.push(ui.ao[ft]);for(let ft=0;ft<ui.colors.length;ft+=3){const Zt=1+(ui.ao[ft/3]-1)*re;tt.layoutColorArray.emplaceBack(ui.colors[ft]*Zt<<8|ui.colors[ft+1]*Zt,ui.colors[ft+2]*Zt<<8)}if(ue){for(let ft=0;ft<ui.positions.length;ft+=3)tt.layoutFacadePaintArray.emplaceBack(65535,255);for(let ft=0;ft<ui.isFauxFacade.length;ft++)if(ui.isFauxFacade[ft]){const Zt=1|Math.min(65535,Math.floor(ui.uv[2*ft]*At.outerRingLength)),$t=Math.floor(255*Ne)<<8|Math.floor(255*Fe),ci=Math.floor(65535*Math.min(1,Ue/Vt)),Si=Math.floor(65535*Math.min(1,pt/Vt));tt.layoutFacadeDataArray.emplaceBack(Zt,$t,ci,Si);const dn=Math.floor(65535*Math.min(1,$e/Vt)),mn=Math.floor(65535*Math.min(1,yt/Vt));tt.layoutFacadeVerticalRangeArray.emplaceBack(dn,mn)}else tt.layoutFacadeDataArray.emplaceBack(0,0,0,0),tt.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const st=Nt.vertexLength;for(let ft=0;ft<ui.indices.length;ft+=3)tt.indexArray.emplaceBack(st+ui.indices[ft],st+ui.indices[ft+1],st+ui.indices[ft+2]);Nt.vertexLength+=ui.positions.length/3,Nt.primitiveLength+=ui.indices.length/3,(ui.buildingPart==="roof"||ui.buildingPart==="wall"||ui.buildingPart==="facade_glazing"||ui.buildingPart==="entrance")&&Pt.push({part:ui.buildingPart,vertexOffset:en,vertexLength:ui.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,xi),this.buildingFeatures.push({feature:z,hasFauxFacade:ue,segment:Nt,parts:Pt,buildingBloom:vi});const Gi=tt.indexArray.length-Ht,Xt=[],mi=[],Oi=new Mt(1/0,1/0),Qi=new Mt(-1/0,-1/0),hn=this.groundEffect.vertexArray.length;for(const ui of At.modifiedPolygonRings){const en=[],An=new Mt(1/0,1/0),fe=new Mt(-1/0,-1/0);for(let me=0;me<ui.length;me+=2){const st=ui.length-me-2;An.x=Math.min(An.x,ui[st]),An.y=Math.min(An.y,ui[st+1]),fe.x=Math.max(fe.x,ui[st]),fe.y=Math.max(fe.y,ui[st+1]);const ft=new Mt(ui[st],ui[st+1]);en.push(ft),Xt.push(ft.x,ft.y),mi.push(ft.clone())}Oi.x=Math.min(Oi.x,An.x),Oi.y=Math.min(Oi.y,An.y),Qi.x=Math.max(Qi.x,fe.x),Qi.y=Math.max(Qi.y,fe.y),this.groundEffect.addData(en,[An,fe],se)}const nn=this.groundEffect.vertexArray.length-hn;(bt.x<0||Et.x>Vt||bt.y<0||Et.y>Vt)&&this.featuresOnBorder.push({featureId:T.id,footprintIndex:this.footprints.length});{const ui=Xh(Xt,null,2),en=new Kd(mi,ui,8,256);let An=T.id;T.properties&&T.properties.hasOwnProperty("building_id")&&(An=T.properties.building_id),this.footprints.push({vertices:mi,indices:ui,grid:en,min:Oi,max:Qi,buildingId:An,hiddenFlags:0,indicesOffset:Ht,indicesLength:Gi,bloomIndicesOffset:ai,bloomIndicesLength:fi,groundEffectVertexOffset:hn,groundEffectVertexLength:nn,hasFauxFacade:ue,segment:Nt,height:xi})}this.programConfigurations.populatePaintArrays(tt.layoutVertexArray.length,T,A,{},i.availableImages,a,i.brightness),this.groundEffect.addPaintPropertiesData(T,A,{},i.availableImages,a,i.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,i,a,o,d,p,y){this.programConfigurations.updatePaintArrays(e,i,d,a,o,p,y),this.groundEffect.update(e,i,d,a,o,p,y),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=a=>{a.layoutVertexBuffer=e.createVertexBuffer(a.layoutVertexArray,Cb.members),a.layoutNormalBuffer=e.createVertexBuffer(a.layoutNormalArray,k5.members),a.layoutCentroidBuffer=e.createVertexBuffer(a.layoutCentroidArray,N5.members),a.layoutFacadeDataArray&&a.layoutFacadeDataArray.length&&(a.layoutFacadeDataBuffer=e.createVertexBuffer(a.layoutFacadeDataArray,B5.members)),a.layoutFacadeVerticalRangeArray&&a.layoutFacadeVerticalRangeArray.length&&(a.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(a.layoutFacadeVerticalRangeArray,F5.members)),a.entranceBloom.layoutVertexArray.length&&(a.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(a.entranceBloom.layoutVertexArray,Cb.members),a.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(a.entranceBloom.layoutAttenuationArray,U5.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,a=!0){let o=!1;const d=a?i:0,p=0|(a?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const y of e){const T=this.footprints[y],A=T.hiddenFlags&p|d;T.hiddenFlags!==A&&(T.hiddenFlags=A,o=!0,this.groundEffect.updateHiddenByLandmarkRange(T.groundEffectVertexOffset,T.groundEffectVertexLength,T.hiddenFlags!==0))}return o&&(this.indexArrayForConflationUploaded=!1),o}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=o=>{o.indexArray.length!==0&&(o.indexArrayForConflation.resize(o.indexArray.length),o.indexArrayForConflation.uint16.set(o.indexArray.uint16),o.entranceBloom.indexArrayForConflation.resize(o.entranceBloom.indexArray.length),o.entranceBloom.indexArrayForConflation.uint16.set(o.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const o of this.footprints){const d=o.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,p=o.indicesOffset+o.indicesLength;if(o.hiddenFlags!==0){for(let T=o.indicesOffset;T<p;T++)d.indexArrayForConflation.uint16[3*T+0]=0,d.indexArrayForConflation.uint16[3*T+1]=0,d.indexArrayForConflation.uint16[3*T+2]=0;const y=o.bloomIndicesOffset+o.bloomIndicesLength;for(let T=o.bloomIndicesOffset;T<y;T++)d.entranceBloom.indexArrayForConflation.uint16[3*T+0]=0,d.entranceBloom.indexArrayForConflation.uint16[3*T+1]=0,d.entranceBloom.indexArrayForConflation.uint16[3*T+2]=0}}const a=o=>{o.indexArray.length!==0&&(o.indexBuffer?o.indexBuffer.updateData(o.indexArrayForConflation):o.indexBuffer=e.createIndexBuffer(o.indexArrayForConflation,!0),o.entranceBloom.indexBuffer?o.entranceBloom.indexBuffer.updateData(o.entranceBloom.indexArrayForConflation):o.entranceBloom.indexBuffer=e.createIndexBuffer(o.entranceBloom.indexArrayForConflation,!0))};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=a=>{a.layoutColorBuffer?a.layoutColorBuffer.updateData(a.layoutColorArray):a.layoutColorBuffer=e.createVertexBuffer(a.layoutColorArray,Rb.members,!0),a.layoutFacadePaintArray&&(a.layoutFacadePaintBuffer?a.layoutFacadePaintBuffer.updateData(a.layoutFacadePaintArray):a.layoutFacadePaintBuffer=e.createVertexBuffer(a.layoutFacadePaintArray,j5.members,!0)),a.entranceBloom.layoutColorBuffer?a.entranceBloom.layoutColorBuffer.updateData(a.entranceBloom.layoutColorArray):a.entranceBloom.layoutColorBuffer=e.createVertexBuffer(a.entranceBloom.layoutColorArray,Rb.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const a=e.paint.get("building-ambient-occlusion-intensity");for(const o of this.buildingFeatures){const d=i[o.feature.id],p=o.feature;p.properties["building-part"]="roof";const y=e.paint.get("building-color").evaluate(p,d,this.canonical).toPremultipliedRenderColor(this.lut),T=e.paint.get("building-emissive-strength").evaluate(p,d,this.canonical);p.properties["building-part"]="wall";const A=e.paint.get("building-color").evaluate(p,d,this.canonical).toPremultipliedRenderColor(this.lut),M=e.paint.get("building-emissive-strength").evaluate(p,d,this.canonical);p.properties["building-part"]="window";const z=e.paint.get("building-color").evaluate(p,d,this.canonical).toPremultipliedRenderColor(this.lut),P=e.paint.get("building-emissive-strength").evaluate(p,d,this.canonical);p.properties["building-part"]="door";const j=e.paint.get("building-color").evaluate(p,d,this.canonical).toPremultipliedRenderColor(this.lut),B=e.paint.get("building-emissive-strength").evaluate(p,d,this.canonical),W=o.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const K of o.parts){let re,se=y;K.part==="roof"?(se=y,re=T):K.part==="wall"?(se=A,re=M):K.part==="facade_glazing"?(se=z,re=P):K.part==="entrance"&&(se=j,re=B),re=Ie(re,0,1);for(let ue=0;ue<K.vertexLength;ue++){const Re=K.vertexOffset+ue,Me=1+(W.layoutAOArray[Re]-1)*a;W.layoutColorArray.emplace(Re,se.r*Me*255<<8|se.g*Me*255,se.b*Me*255<<8|255*re),o.hasFauxFacade&&W.layoutFacadePaintArray.emplace(Re,255*z.r<<8|255*z.g,255*z.b<<8|255*P)}}const Y=o.buildingBloom;if(Y)for(let K=0;K<Y.vertexLength;K++)W.entranceBloom.layoutColorArray.emplace(Y.vertexOffset+K,255*j.r<<8|255*j.g,255*j.b<<8|51*B)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped());if(rp(this.activeReplacements,o))return;this.activeReplacements=o;for(const p of this.footprints)p.hiddenFlags&=-2;const d=[];for(const p of this.activeReplacements){if(p.order<=__)continue;const y=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));for(const T of this.footprints)T.min.x>p.max.x||T.max.x<p.min.x||T.min.y>p.max.y||T.max.y<p.min.y||(d.length=0,H5(T.vertices,0,T.vertices.length,p.footprintTileId.canonical,e.canonical,d),fg(p.footprint,d,T.indices,0,T.indices.length,0,-y)&&(T.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const p of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(p.groundEffectVertexOffset,p.groundEffectVertexLength,p.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,o=!0;const d=4*(e+Vt)*Vt+(i+Vt);if(this.footprintLookup.hasOwnProperty(d)){const y=this.footprintLookup[d];return y?{height:y.height,hidden:y.hiddenFlags!==0}:void 0}const p=new Mt(e,i);for(const y of this.footprints)e>y.max.x||y.min.x>e||i>y.max.y||y.min.y>i||y.height<=a||tu(p,y)&&(a=y.height,this.footprintLookup[d]=y,o=y.hiddenFlags!==0);if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:o};this.footprintLookup[d]=void 0}}function H5(n,e,i,a,o,d){const p=Math.pow(2,a.z-o.z);for(let y=0;y<i;y++){let T=n[y+e].x,A=n[y+e].y;T=(T+o.x*Vt)*p-a.x*Vt,A=(A+o.y*Vt)*p-a.y*Vt,d.push(new Mt(T,A))}}let Db,Pb;ri(zb,"BuildingBucket",{omit:["layers"]}),ri(cx,"BuildingGeometry"),ri(Ib,"BuildingBloomGeometry");const q5=yn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),G5=yn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:$5}=q5,Z5=yn([{name:"a_packed",components:3,type:"Float32"}]),{members:W5}=Z5,X5=yn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Y5}=X5;class Lb{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new ys({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const a=this.getKey(e,i);return this.positions[a]}trim(){const e=this.width,i=this.height=pi(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,a){const o=[];let d=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,y=!0;o.push({left:d,right:p,isDash:y,zeroLength:e[0]===0});let T=e[0];for(let A=1;A<e.length;A++){y=!y;const M=e[A];d=T*a,T+=M,p=T*a,o.push({left:d,right:p,isDash:y,zeroLength:M===0})}return o}addRoundDash(e,i,a){const o=i/2;for(let d=-a;d<=a;d++){const p=this.width*(this.nextRow+a+d);let y=0,T=e[y];for(let A=0;A<this.width;A++){A/T.right>1&&(T=e[++y]);const M=Math.abs(A-T.left),z=Math.abs(A-T.right),P=Math.min(M,z);let j;const B=d/a*(o+1);if(T.isDash){const W=o-Math.abs(B);j=Math.sqrt(P*P+W*W)}else j=o-Math.sqrt(P*P+B*B);this.image.data[p+A]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(e,i){for(let T=e.length-1;T>=0;--T){const A=e[T],M=e[T+1];A.zeroLength?e.splice(T,1):M&&M.isDash===A.isDash&&(M.left=A.left,e.splice(T,1))}const a=e[0],o=e[e.length-1];a.isDash===o.isDash&&(a.left=o.left-this.width,o.right=a.right+this.width);const d=this.width*this.nextRow;let p=0,y=e[p];for(let T=0;T<this.width;T++){T/y.right>1&&(y=e[++p]);const A=Math.abs(T-y.left),M=Math.abs(T-y.right),z=Math.min(A,M);this.image.data[d+T]=Math.max(0,Math.min(255,(y.isDash?z:-z)+i+128))}}addDash(e,i){const a=this.getKey(e,i);if(this.positions[a])return this.positions[a];const o=i==="round",d=o?7:0,p=2*d+1;if(this.nextRow+p>this.height)return cn("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let M=0;M<e.length;M++)e[M]<0&&(cn("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),y+=e[M];if(y!==0){const M=this.width/y,z=this.getDashRanges(e,this.width,M);o?this.addRoundDash(z,M,d):this.addRegularDash(z,i==="square"?.5*M:0)}const T=this.nextRow+d;this.nextRow+=p;const A={tl:[T,d],br:[y,0]};return this.positions[a]=A,A}}ri(Lb,"LineAtlas");const K5=Tt.types,J5=Math.cos(Math.PI/180*37.5),Q5=Math.cos(Math.PI/180*5);class ux{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Ud,this.layoutVertexArray2=new oa,this.patternVertexArray=new oa,this.indexArray=new is,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new qn,this.maxLineLength=0,this.zOffsetVertexArray=new oa,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Vt/64,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,a,o){this.hasPattern=og("line",this.layers,this.pixelRatio,i);const d=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Ze(a);const p=this.layers[0].layout.get("line-elevation-reference");if(p==="hd-road-markup")this.elevationType="road";else{const P=this.layers[0].layout.get("line-z-offset"),j=P.isConstant()&&!P.constantOr(0);this.elevationType=p!=="sea"&&p!=="ground"&&j?"none":"offset",this.elevationType==="offset"&&p==="none"&&cn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const y=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&y!==void 0;const T=[];for(const{feature:P,id:j,index:B,sourceLayerIndex:W}of e){const Y=this.layers[0]._featureFilter.needGeometry,K=Ct(P,Y);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom,{worldview:this.worldview}),K,a))continue;const re=d?d.evaluate(K,{},a):void 0,se={id:j,properties:P.properties,type:P.type,sourceLayerIndex:W,index:B,geometry:Y?K.geometry:qt(P,a,o),patterns:{},sortKey:re};T.push(se)}d&&T.sort((P,j)=>P.sortKey-j.sortKey);const{lineAtlas:A,featureIndex:M}=i,z=this.addConstantDashes(A);for(const P of T){const{geometry:j,index:B,sourceLayerIndex:W}=P;if(z&&this.addFeatureDashes(P,A),this.hasPattern){const Y=Kh("line",this.layers,P,this.zoom,this.pixelRatio,i);this.patternFeatures.push(Y)}else this.addFeature(P,j,B,a,A.positions,i.availableImages,i.brightness,i.elevationFeatures);M.insert(e[B].feature,j,B,W,this.index)}}addConstantDashes(e){let i=!1;for(const a of this.layers){const o=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(o.kind!=="constant"||d.kind!=="constant")i=!0;else{const p=d.value,y=o.value;if(!y)continue;e.addDash(y,p)}}return i}addFeatureDashes(e,i){const a=this.zoom;for(const o of this.layers){const d=o.paint.get("line-dasharray").value,p=o.layout.get("line-cap").value;if(d.kind==="constant"&&p.kind==="constant")continue;let y,T;if(d.kind==="constant"){if(y=d.value,!y)continue}else y=d.evaluate({zoom:a},e);T=p.kind==="constant"?p.value:p.evaluate({zoom:a},e),i.addDash(y,T),e.patterns[o.id]=[i.getKey(y,T)]}}update(e,i,a,o,d,p,y,T){this.programConfigurations.updatePaintArrays(e,i,d,a,o,p,y,T)}addFeatures(e,i,a,o,d,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,a,o,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,W5)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Y5)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,G5.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$5),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let a,o;if(i&&i>0?(a=`mapbox_clip_start_${i}`,o=`mapbox_clip_end_${i}`):(a="mapbox_clip_start",o="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(a)&&e.properties.hasOwnProperty(o))return{start:+e.properties[a],end:+e.properties[o]}}addFeature(e,i,a,o,d,p,y,T){const A=this.layers[0].layout,M=A.get("line-join").evaluate(e,{}),z=A.get("line-cap").evaluate(e,{}),P=A.get("line-miter-limit"),j=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const B=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=A.get("line-z-offset").value;const W=this.layers[0].paint.get("line-width").value;if(W.kind!=="constant"&&W.isLineProgressConstant===!1&&(this.variableWidthValue=W),this.elevationType==="road"){const Y=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,o,T,M,z,P,j)){const[K,re]=this.clipRuntimeLinesToTile(i,1);for(let se=0;se<K.length;se++){const ue=K[se],Re=re[se],Me={progress:{min:Re.progress.min,max:Re.progress.max},nextDir:this.computeSegNextDir(Re,ue),prevDir:this.computeSegPrevDir(Re,ue)};this.addLine(ue,e,o,M,z,P,j,Me,B&&Re.parentIndex>0?Re.parentIndex:null)}this.fillNonElevatedRoadSegment(Y)}}else for(let Y=0;Y<i.length;Y++)this.addLine(i[Y],e,o,M,z,P,j,void 0,B&&Y>0?Y:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,p,o,y,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return cs(e,-i,-i,Vt+i,Vt+i)}clipRuntimeLinesToTile(e,i){const a=[];return[cs(e,-i,-i,Vt+i,Vt+i,a),a]}addElevatedRoadFeature(e,i,a,o,d,p,y,T){const A=[],M=kn.getElevationFeature(e,o);if(M){const z=this.clipLinesToTile(i,1),P=this.prepareElevatedLines(z,M,a);for(const j of P)A.push({geometry:j,elevation:M,elevationTileID:a,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(A.length===0)return!1;for(const z of A){const P=this.layoutVertexArray.length;this.addLine(z.geometry,e,a,d,p,y,T);const j=new Zr(a,z.elevationTileID);if(z.elevation)for(let B=P;B<this.layoutVertexArray.length;B++){const W=new Mt(this.layoutVertexArray.int16[6*B]>>1,this.layoutVertexArray.int16[6*B+1]>>1),Y=j.pointElevation(W,z.elevation,.05);this.updateHeightRange(Y),this.zOffsetVertexArray.emplaceBack(Y,0,0)}else this.fillNonElevatedRoadSegment(P)}return!0}prepareElevatedLines(e,i,a){if(i.constantHeight!=null)return e;const o=[],d=1/Ze(a);for(const p of e)Rt(p,new vn(i,d),0,o);return o}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,a,o,d,p,y,T,A){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=A?this.lineFeatureClips(i,A):this.lineClips;const M=o==="none";this.patternJoinNone=this.hasPattern&&M,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const z=T&&T.progress.min>0,P=T&&T.progress.max<1;if(this.lineClips){let Ue={min:this.lineClips.start,max:this.lineClips.end},pt=1;if(T){const It=this.lineClips.end-this.lineClips.start;Ue=function(bt,Et,Ot){return{min:Sr(bt.min,Et,Ot),max:Sr(bt.max,Et,Ot)}}(T.progress,{min:0,max:1},Ue),It>0&&(pt=(Ue.max-Ue.min)/It)}const $e=+i.properties.mapbox_clip_feature_len,yt=+i.properties.mapbox_clip_seg_len;if(Number.isNaN($e)||Number.isNaN(yt)){for(let bt=0;bt<e.length-1;bt++)this.totalDistance+=e[bt].dist(e[bt+1]);const It=this.totalDistance/(Ue.max-Ue.min);this.totalFeatureLength=Number.isFinite(It)?It:0,this.lineClips.start=Ue.min,this.lineClips.end=Ue.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=$e,this.distance=yt*pt,this.lineClips.start=Ue.min,this.lineClips.end=Ue.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const j=K5[i.type]==="Polygon";let B=e.length;for(;B>=2&&e[B-1].equals(e[B-2]);)B--;let W=0;for(;W<B-1&&e[W].equals(e[W+1]);)W++;if(B<(j?3:2))return;o==="bevel"&&(p=1.05);const Y=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray);let K,re,se,ue,Re,Me,Ne,Fe;T&&T.prevDir&&(Me=T.prevDir.perp()),T&&T.nextDir&&(Ne=T.nextDir.perp()),this.e1=this.e2=-1,j&&(K=e[B-2],Re=e[W].sub(K)._unit()._perp());for(let Ue=W;Ue<B;Ue++){if(se=Ue===B-1?j?e[W+1]:void 0:e[Ue+1],se&&e[Ue].equals(se))continue;Re&&(ue=Re),K&&(re=K),K=e[Ue],Fe=this.evaluateLineProgressFeatures(re?re.dist(K):0),Re=se?se.sub(K)._unit()._perp():ue,ue=ue||Re;const pt=re&&se;let $e=pt?o:j||M?"butt":d;const yt=ue.x*Re.x+ue.y*Re.y;if(M){const tt=function(Nt){if(Nt.patternJoinNone){const Pt=Nt.segmentPoints.length/2,vi=Nt.lineSoFar-Nt.segmentStart;for(let ai=0;ai<Pt;++ai){const fi=Nt.segmentPoints[2*ai+1],Ht=Math.round(Nt.segmentPoints[2*ai])+.5+.25*fi;Nt.patternVertexArray.emplaceBack(Ht,vi,Nt.segmentStart),Nt.patternVertexArray.emplaceBack(Ht,vi,Nt.segmentStart)}Nt.segmentPoints.length=0}Nt.e1=Nt.e2=-1};if(pt&&yt<Q5){this.updateDistance(re,K),this.addCurrentVertex(K,ue,1,1,Y,Fe),tt(this),this.addCurrentVertex(K,Re,-1,-1,Y,Fe);continue}if(re){if(!se){this.updateDistance(re,K),this.addCurrentVertex(K,ue,1,1,Y,Fe),tt(this);continue}$e="miter"}}let It=ue.add(Re);It.x===0&&It.y===0||It._unit();const bt=It.x*Re.x+It.y*Re.y,Et=bt!==0?1/bt:1/0,Ot=2*Math.sqrt(2-2*bt),dt=bt<J5&&re&&se,At=ue.x*Re.y-ue.y*Re.x>0,at=this.overscaling<=16?15*Vt/(512*this.overscaling):0;if(pt&&$e==="round"){if(Et<y)$e="miter";else if(Et<=2){const tt=hx(K,-10,Vt+10);$e=this.elevationType==="offset"&&(tt||this.hasCrossSlope)?"miter":"fakeround"}}if($e==="miter"&&Et>p&&($e="bevel"),$e==="bevel"&&(Et>2&&($e="flipbevel"),Et<p&&($e="miter")),re&&!($e==="miter"&&dt)&&this.updateDistance(re,K),$e==="miter")if(dt){const tt=K.dist(re);if(tt>2*at){const Pt=K.sub(K.sub(re)._mult(at/tt)._round());this.updateDistance(re,Pt),this.addCurrentVertex(Pt,ue,0,0,Y,Fe),re=Pt}this.updateDistance(re,K),It._mult(Et),this.addCurrentVertex(K,It,0,0,Y,Fe);const Nt=K.dist(se);if(Nt>2*at){const Pt=K.add(se.sub(K)._mult(at/Nt)._round());this.updateDistance(K,Pt),this.addCurrentVertex(Pt,Re,0,0,Y,Fe),K=Pt}}else It._mult(Et),this.addCurrentVertex(K,It,0,0,Y,Fe);else if($e==="flipbevel"){if(Et>100)It=Re.mult(-1);else{const tt=Et*ue.add(Re).mag()/ue.sub(Re).mag();It._perp()._mult(tt*(At?-1:1))}this.addCurrentVertex(K,It,0,0,Y,Fe),this.addCurrentVertex(K,It.mult(-1),0,0,Y,Fe)}else if($e==="bevel"||$e==="fakeround"){Fe!=null&&re&&this.addCurrentVertex(K,Ne||ue,-1,-1,Y,Fe);const tt=K.dist(re)<=2*at&&$e!=="bevel",Nt=It.mult(At?1:-1);Nt._mult(Et);const Pt=Re.mult(At?-1:1),vi=ue.mult(At?-1:1),ai=this.evaluateLineProgressFeatures(this.distance);if(Fe==null&&(this.addHalfVertex(K,Nt.x,Nt.y,!1,!At,0,Y,ai),tt||this.addHalfVertex(K,Nt.x+2*vi.x,Nt.y+2*vi.y,!1,At,0,Y,ai)),$e==="fakeround"){const fi=Math.round(180*Ot/Math.PI/20);this.addHalfVertex(K,vi.x,vi.y,!1,At,0,Y,ai);for(let Ht=0;Ht<fi;Ht++){let xi=Ht/fi;if(xi!==.5){const Xt=xi-.5;xi+=xi*Xt*(xi-1)*((1.0904+yt*(yt*(3.55645-1.43519*yt)-3.2452))*Xt*Xt+(.848013+yt*(.215638*yt-1.06021)))}const Gi=Pt.sub(vi)._mult(xi)._add(vi)._unit();this.addHalfVertex(K,Gi.x,Gi.y,!1,At,0,Y,ai)}this.addHalfVertex(K,Pt.x,Pt.y,!1,At,0,Y,ai)}tt||Fe!=null||this.addHalfVertex(K,Nt.x+2*Pt.x,Nt.y+2*Pt.y,!1,At,0,Y,ai),Fe!=null&&se&&this.addCurrentVertex(K,Me||Re,1,1,Y,Fe)}else if($e==="butt")this.addCurrentVertex(K,It,0,0,Y,Fe);else if($e==="square"){if(!re){const tt=z?0:-1;this.addCurrentVertex(K,It,tt,tt,Y,Fe)}if(this.addCurrentVertex(K,It,0,0,Y,Fe),re){const tt=P?0:1;this.addCurrentVertex(K,It,tt,tt,Y,Fe)}}else if($e==="round"){if(re){const tt=!pt&&Ne?Ne:ue;this.addCurrentVertex(K,tt,0,0,Y,Fe),!pt&&P||this.addCurrentVertex(K,tt,1,1,Y,Fe,!0)}if(se){const tt=!pt&&Me?Me:Re;!pt&&z||this.addCurrentVertex(K,tt,-1,-1,Y,Fe,!0),this.addCurrentVertex(K,tt,0,0,Y,Fe)}}}}addVerticesTo(e,i,a,o,d,p,y,T,A,M){const z=(i.w-e.w)/this.tessellationStep|0;let P=0;const j=this.scaledDistance;if(z>1){this.lineSoFar=e.w;const W=(i.x-e.x)/z,Y=(i.y-e.y)/z,K=(i.z-e.z)/z,re=(i.w-e.w)/z;for(let se=1;se<z;++se){e.x+=W,e.y+=Y,e.z+=K,this.lineSoFar+=re,P+=re;const ue=this.evaluateLineProgressFeatures(this.prevDistance+P);this.scaledDistance=(this.prevDistance+P)/this.totalDistance,this.addHalfVertex(e,a,o,M,!1,y,A,ue),this.addHalfVertex(e,d,p,M,!0,-T,A,ue)}}this.lineSoFar=i.w,this.scaledDistance=j;const B=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,a,o,M,!1,y,A,B),this.addHalfVertex(i,d,p,M,!0,-T,A,B)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):cn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,a,o,d,p,y=!1){const T=i.x+i.y*a,A=i.y-i.x*a,M=i.y*o-i.x,z=-i.y-i.x*o;if(p!=null){const P=this.elevationType==="offset",j=-10,B=Vt+10,W=p.zOffset,Y=new ti(e.x,e.y,W,this.lineSoFar),K=!!P&&hx(e,j,B),re=this.lineSoFar,se=this.distance;if(this.currentVertex)if(K){const ue=this.currentVertexIsOutside,Re=this.currentVertex,Me=new ti(e.x,e.y,W,this.lineSoFar);if(Xn(Re,Me,j,B),!hx(Me,j,B)){if(ue){this.e1=this.e2=-1,this.distance-=Re.dist(Y),this.lineSoFar=Re.w;const Ne=this.evaluateLineProgressFeatures(Re.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Re,T,A,y,!1,a,d,Ne),this.addHalfVertex(Re,M,z,y,!0,-o,d,Ne),this.prevDistance=this.distance}this.distance=this.prevDistance+Re.dist(Me),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Re,Me,T,A,M,z,a,o,d,y),this.distance=se,this.scaledDistance=this.distance/this.totalDistance}}else{const ue=this.currentVertex;if(this.currentVertexIsOutside){Xn(ue,Y,j,B),this.e1=this.e2=-1,this.distance-=ue.dist(Y),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ue.w;const Re=this.evaluateLineProgressFeatures(ue.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ue,T,A,y,!1,a,d,Re),this.addHalfVertex(ue,M,z,y,!0,-o,d,Re),this.prevDistance=this.distance,this.distance=se,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ue,Y,T,A,M,z,a,o,d,y)}else K||(this.addHalfVertex(e,T,A,y,!1,a,d,p),this.addHalfVertex(e,M,z,y,!0,-o,d,p));this.currentVertex=Y,this.currentVertexIsOutside=K,this.lineSoFar=re}else this.addHalfVertex(e,T,A,y,!1,a,d,p),this.addHalfVertex(e,M,z,y,!0,-o,d,p)}addHalfVertex({x:e,y:i},a,o,d,p,y,T,A){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,y)),this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(i<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*o)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const z=zi(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,z)}const M=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),T.primitiveLength++),p?this.e2=M:this.e1=M,A!=null&&this.zOffsetVertexArray.emplaceBack(A.zOffset,A.variableWidth,A.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function hx(n,e,i){return n.x<e||n.x>i||n.y<e||n.y>i}let Ob,kb;function Nb(n,e,i){return e*(Vt/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}ri(ux,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const jb=(n,e,i)=>(1-i)*n+i*e;function Bb(n,e){return 1/Nb(n,1,e.tileZoom)}function Fb(n,e,i,a){return n.translatePosMatrix(a||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Ub=n=>{const e=[];Vb(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=n.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const a=n.layout.get("line-join").constantOr("miter")==="none",o=!!n.paint.get("line-pattern").constantOr(1);return a&&o&&e.push("LINE_JOIN_NONE"),e};function Vb(n){const e=n.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let dx;const Hb=()=>dx||(dx={layout:Ob||(Ob=new Rr({"line-cap":new Yt(qe.layout_line["line-cap"]),"line-join":new Yt(qe.layout_line["line-join"]),"line-miter-limit":new kt(qe.layout_line["line-miter-limit"]),"line-round-limit":new kt(qe.layout_line["line-round-limit"]),"line-sort-key":new Yt(qe.layout_line["line-sort-key"]),"line-z-offset":new Yt(qe.layout_line["line-z-offset"]),"line-elevation-reference":new kt(qe.layout_line["line-elevation-reference"]),"line-cross-slope":new kt(qe.layout_line["line-cross-slope"]),visibility:new kt(qe.layout_line.visibility),"line-width-unit":new kt(qe.layout_line["line-width-unit"])})),paint:kb||(kb=new Rr({"line-opacity":new Yt(qe.paint_line["line-opacity"]),"line-color":new Yt(qe.paint_line["line-color"]),"line-translate":new kt(qe.paint_line["line-translate"]),"line-translate-anchor":new kt(qe.paint_line["line-translate-anchor"]),"line-width":new Yt(qe.paint_line["line-width"]),"line-gap-width":new Yt(qe.paint_line["line-gap-width"]),"line-offset":new Yt(qe.paint_line["line-offset"]),"line-blur":new Yt(qe.paint_line["line-blur"]),"line-dasharray":new Yt(qe.paint_line["line-dasharray"]),"line-pattern":new Yt(qe.paint_line["line-pattern"]),"line-pattern-cross-fade":new kt(qe.paint_line["line-pattern-cross-fade"]),"line-gradient":new Ph(qe.paint_line["line-gradient"]),"line-trim-offset":new kt(qe.paint_line["line-trim-offset"]),"line-trim-fade-range":new kt(qe.paint_line["line-trim-fade-range"]),"line-trim-color":new kt(qe.paint_line["line-trim-color"]),"line-emissive-strength":new kt(qe.paint_line["line-emissive-strength"]),"line-border-width":new Yt(qe.paint_line["line-border-width"]),"line-border-color":new Yt(qe.paint_line["line-border-color"]),"line-occlusion-opacity":new kt(qe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},dx);class eE extends Yt{possiblyEvaluate(e,i){return i=new ir(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,a,o){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,a,o)}}let A_;function qb(n,e){return e>0?e+2*n:n}const tE=yn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),iE=yn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),nE=yn([{name:"a_projected_pos",components:4,type:"Float32"}],4);yn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const rE=yn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),sE=yn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),aE=yn([{name:"a_texb",components:2,type:"Uint16"}]),oE=yn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),lE=yn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);yn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Gb=yn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cE=yn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);yn([{name:"triangle",components:3,type:"Uint16"}]),yn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),yn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),yn([{type:"Float32",name:"offsetX"}]),yn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Qs=24;function uE(n,e,i){return n.sections.forEach(a=>{a.text=function(o,d,p){const y=d.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?o=o.toLocaleUpperCase():y==="lowercase"&&(o=o.toLocaleLowerCase()),$o.applyArabicShaping&&(o=$o.applyArabicShaping(o)),o}(a.text,e,i)}),n}const C_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function hE(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}function dE(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}const fx=4294967296,$b=1/fx,Zb=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Q0=class{constructor(n=new Uint8Array(16)){this.buf=ArrayBuffer.isView(n)?n:new Uint8Array(n),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(n,e,i=this.length){for(;this.pos<i;){const a=this.readVarint(),o=a>>3,d=this.pos;this.type=7&a,n(o,e,this),this.pos===d&&this.skip(a)}return e}readMessage(n,e){return this.readFields(n,e,this.readVarint()+this.pos)}readFixed32(){const n=this.dataView.getUint32(this.pos,!0);return this.pos+=4,n}readSFixed32(){const n=this.dataView.getInt32(this.pos,!0);return this.pos+=4,n}readFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*fx;return this.pos+=8,n}readSFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*fx;return this.pos+=8,n}readFloat(){const n=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,n}readDouble(){const n=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,n}readVarint(n){const e=this.buf;let i,a;return a=e[this.pos++],i=127&a,a<128?i:(a=e[this.pos++],i|=(127&a)<<7,a<128?i:(a=e[this.pos++],i|=(127&a)<<14,a<128?i:(a=e[this.pos++],i|=(127&a)<<21,a<128?i:(a=e[this.pos],i|=(15&a)<<28,function(o,d,p){const y=p.buf;let T,A;if(A=y[p.pos++],T=(112&A)>>4,A<128||(A=y[p.pos++],T|=(127&A)<<3,A<128)||(A=y[p.pos++],T|=(127&A)<<10,A<128)||(A=y[p.pos++],T|=(127&A)<<17,A<128)||(A=y[p.pos++],T|=(127&A)<<24,A<128)||(A=y[p.pos++],T|=(1&A)<<31,A<128))return wg(o,T,d);throw new Error("Expected varint not more than 10 bytes")}(i,n,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const n=this.readVarint();return n%2==1?(n+1)/-2:n/2}readBoolean(){return!!this.readVarint()}readString(){const n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&Zb?Zb.decode(this.buf.subarray(e,n)):function(i,a,o){let d="",p=a;for(;p<o;){const y=i[p];let T,A,M,z=null,P=y>239?4:y>223?3:y>191?2:1;if(p+P>o)break;P===1?y<128&&(z=y):P===2?(T=i[p+1],(192&T)==128&&(z=(31&y)<<6|63&T,z<=127&&(z=null))):P===3?(T=i[p+1],A=i[p+2],(192&T)==128&&(192&A)==128&&(z=(15&y)<<12|(63&T)<<6|63&A,(z<=2047||z>=55296&&z<=57343)&&(z=null))):P===4&&(T=i[p+1],A=i[p+2],M=i[p+3],(192&T)==128&&(192&A)==128&&(192&M)==128&&(z=(15&y)<<18|(63&T)<<12|(63&A)<<6|63&M,(z<=65535||z>=1114112)&&(z=null))),z===null?(z=65533,P=1):z>65535&&(z-=65536,d+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),d+=String.fromCharCode(z),p+=P}return d}(this.buf,e,n)}readBytes(){const n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e}readPackedVarint(n=[],e){const i=this.readPackedEnd();for(;this.pos<i;)n.push(this.readVarint(e));return n}readPackedSVarint(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSVarint());return n}readPackedBoolean(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readBoolean());return n}readPackedFloat(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFloat());return n}readPackedDouble(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readDouble());return n}readPackedFixed32(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFixed32());return n}readPackedSFixed32(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSFixed32());return n}readPackedFixed64(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFixed64());return n}readPackedSFixed64(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSFixed64());return n}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(n){const e=7&n;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(n,e){this.writeVarint(n<<3|e)}realloc(n){let e=this.length||16;for(;e<this.pos+n;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeSFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*$b),!0),this.pos+=8}writeSFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*$b),!0),this.pos+=8}writeVarint(n){(n=+n||0)>268435455||n<0?function(e,i){let a,o;if(e>=0?(a=e%4294967296|0,o=e/4294967296|0):(a=~(-e%4294967296),o=~(-e/4294967296),4294967295^a?a=a+1|0:(a=0,o=o+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(d,p,y){y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,y.buf[y.pos]=127&(d>>>=7)}(a,0,i),function(d,p){const y=(7&d)<<4;p.buf[p.pos++]|=y|((d>>>=3)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d)))))}(o,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))}writeSVarint(n){this.writeVarint(n<0?2*-n-1:2*n)}writeBoolean(n){this.writeVarint(+n)}writeString(n){n=String(n),this.realloc(4*n.length),this.pos++;const e=this.pos;this.pos=function(a,o,d){for(let p,y,T=0;T<o.length;T++){if(p=o.charCodeAt(T),p>55295&&p<57344){if(!y){p>56319||T+1===o.length?(a[d++]=239,a[d++]=191,a[d++]=189):y=p;continue}if(p<56320){a[d++]=239,a[d++]=191,a[d++]=189,y=p;continue}p=y-55296<<10|p-56320|65536,y=null}else y&&(a[d++]=239,a[d++]=191,a[d++]=189,y=null);p<128?a[d++]=p:(p<2048?a[d++]=p>>6|192:(p<65536?a[d++]=p>>12|224:(a[d++]=p>>18|240,a[d++]=p>>12&63|128),a[d++]=p>>6&63|128),a[d++]=63&p|128)}return d}(this.buf,n,this.pos);const i=this.pos-e;i>=128&&Wb(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(n){this.realloc(4),this.dataView.setFloat32(this.pos,n,!0),this.pos+=4}writeDouble(n){this.realloc(8),this.dataView.setFloat64(this.pos,n,!0),this.pos+=8}writeBytes(n){const e=n.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=n[i]}writeRawMessage(n,e){this.pos++;const i=this.pos;n(e,this);const a=this.pos-i;a>=128&&Wb(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a}writeMessage(n,e,i){this.writeTag(n,2),this.writeRawMessage(e,i)}writePackedVarint(n,e){e.length&&this.writeMessage(n,fE,e)}writePackedSVarint(n,e){e.length&&this.writeMessage(n,pE,e)}writePackedBoolean(n,e){e.length&&this.writeMessage(n,_E,e)}writePackedFloat(n,e){e.length&&this.writeMessage(n,mE,e)}writePackedDouble(n,e){e.length&&this.writeMessage(n,gE,e)}writePackedFixed32(n,e){e.length&&this.writeMessage(n,yE,e)}writePackedSFixed32(n,e){e.length&&this.writeMessage(n,xE,e)}writePackedFixed64(n,e){e.length&&this.writeMessage(n,vE,e)}writePackedSFixed64(n,e){e.length&&this.writeMessage(n,bE,e)}writeBytesField(n,e){this.writeTag(n,2),this.writeBytes(e)}writeFixed32Field(n,e){this.writeTag(n,5),this.writeFixed32(e)}writeSFixed32Field(n,e){this.writeTag(n,5),this.writeSFixed32(e)}writeFixed64Field(n,e){this.writeTag(n,1),this.writeFixed64(e)}writeSFixed64Field(n,e){this.writeTag(n,1),this.writeSFixed64(e)}writeVarintField(n,e){this.writeTag(n,0),this.writeVarint(e)}writeSVarintField(n,e){this.writeTag(n,0),this.writeSVarint(e)}writeStringField(n,e){this.writeTag(n,2),this.writeString(e)}writeFloatField(n,e){this.writeTag(n,5),this.writeFloat(e)}writeDoubleField(n,e){this.writeTag(n,1),this.writeDouble(e)}writeBooleanField(n,e){this.writeVarintField(n,+e)}};function wg(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function Wb(n,e,i){const a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(a);for(let o=i.pos-1;o>=n;o--)i.buf[o+a]=i.buf[o]}function fE(n,e){for(let i=0;i<n.length;i++)e.writeVarint(n[i])}function pE(n,e){for(let i=0;i<n.length;i++)e.writeSVarint(n[i])}function mE(n,e){for(let i=0;i<n.length;i++)e.writeFloat(n[i])}function gE(n,e){for(let i=0;i<n.length;i++)e.writeDouble(n[i])}function _E(n,e){for(let i=0;i<n.length;i++)e.writeBoolean(n[i])}function yE(n,e){for(let i=0;i<n.length;i++)e.writeFixed32(n[i])}function xE(n,e){for(let i=0;i<n.length;i++)e.writeSFixed32(n[i])}function vE(n,e){for(let i=0;i<n.length;i++)e.writeFixed64(n[i])}function bE(n,e){for(let i=0;i<n.length;i++)e.writeSFixed64(n[i])}const px=3;function wE(n,e,i){e.glyphs=[],n===1&&i.readMessage(TE,e)}function TE(n,e,i){if(n===3){const{id:a,bitmap:o,width:d,height:p,left:y,top:T,advance:A}=i.readMessage(SE,{});e.glyphs.push({id:a,bitmap:new ys({width:d+2*px,height:p+2*px},o),metrics:{width:d,height:p,left:y,top:T,advance:A}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function SE(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const EE=px,al={horizontal:1,vertical:2,horizontalOnly:3};class R_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const a=new R_;return a.scale=e||1,a.fontStack=i,a}static forImage(e){const i=new R_;return i.image=e,i}}class Tg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,a){const o=new Tg;for(let d=0;d<e.sections.length;d++){const p=e.sections[d];p.image?o.addImageSection(p,a):o.addTextSection(p,i)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,a){let o="";for(let d=0;d<i.length;d++){const p=i.charCodeAt(d+1)||null,y=i.charCodeAt(d-1)||null;o+=!a&&(p&&Of(p)&&!C_[i[d+1]]||y&&Of(y)&&!C_[i[d-1]])||!C_[i[d]]?i[d]:C_[i[d]]}return o}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&ey[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&ey[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const a=new Tg;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(R_.forText(e.scale,e.fontStack||i));const a=this.sections.length-1;for(let o=0;o<e.text.length;++o)this.sectionIndex.push(a)}addImageSection(e,i){const a=e.image?e.image.getPrimary():null;if(!a)return void cn("Can't add FormattedSection with an empty image.");a.scaleSelf(i);const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push(R_.forImage(a)),this.sectionIndex.push(this.sections.length-1)):cn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function mx(n,e,i,a,o,d,p,y,T,A,M,z,P,j,B,W=1){const Y=Tg.fromFeature(n,o,W);z===al.vertical&&Y.verticalizePunctuation(P);let K=[];const re=function(Ne,Fe,Ue,pt,$e,yt){if(!Ne)return[];const It=[],bt=function(At,at,tt,Nt,Pt,vi){let ai=0;for(let fi=0;fi<At.length();fi++){const Ht=At.getSection(fi);ai+=Xb(At.getCodePoint(fi),Ht,Nt,Pt,at,vi)}return ai/Math.max(1,Math.ceil(ai/tt))}(Ne,Fe,Ue,pt,$e,yt),Et=Ne.text.indexOf("")>=0;let Ot=0;for(let At=0;At<Ne.length();At++){const at=Ne.getSection(At),tt=Ne.getCodePoint(At);if(ey[tt]||(Ot+=Xb(tt,at,pt,$e,Fe,yt)),At<Ne.length()-1){const Nt=!((dt=tt)<11904||!(Ri["Bopomofo Extended"](dt)||Ri.Bopomofo(dt)||Ri["CJK Compatibility Forms"](dt)||Ri["CJK Compatibility Ideographs"](dt)||Ri["CJK Compatibility"](dt)||Ri["CJK Radicals Supplement"](dt)||Ri["CJK Strokes"](dt)||Ri["CJK Symbols and Punctuation"](dt)||Ri["CJK Unified Ideographs Extension A"](dt)||Ri["CJK Unified Ideographs"](dt)||Ri["Enclosed CJK Letters and Months"](dt)||Ri["Halfwidth and Fullwidth Forms"](dt)||Ri.Hiragana(dt)||Ri["Ideographic Description Characters"](dt)||Ri["Kangxi Radicals"](dt)||Ri["Katakana Phonetic Extensions"](dt)||Ri.Katakana(dt)||Ri["Vertical Forms"](dt)||Ri["Yi Radicals"](dt)||Ri["Yi Syllables"](dt)));(AE[tt]||Nt||at.image)&&It.push(Kb(At+1,Ot,bt,It,CE(tt,Ne.getCodePoint(At+1),Nt&&Et),!1))}}var dt;return Jb(Kb(Ne.length(),Ot,bt,It,0,!0))}(Y,A,d,e,a,j),{processBidirectionalText:se,processStyledBidirectionalText:ue}=$o;if(se&&Y.sections.length===1){const Ne=se(Y.toString(),re);for(const Fe of Ne){const Ue=new Tg;Ue.text=Fe,Ue.sections=Y.sections;for(let pt=0;pt<Fe.length;pt++)Ue.sectionIndex.push(0);K.push(Ue)}}else if(ue){const Ne=ue(Y.text,Y.sectionIndex,re);for(const Fe of Ne){const Ue=new Tg;Ue.text=Fe[0],Ue.sectionIndex=Fe[1],Ue.sections=Y.sections,K.push(Ue)}}else K=function(Ne,Fe){const Ue=[],pt=Ne.text;let $e=0;for(const yt of Fe)Ue.push(Ne.substring($e,yt)),$e=yt;return $e<pt.length&&Ue.push(Ne.substring($e,pt.length)),Ue}(Y,re);const Re=[],Me={positionedLines:Re,text:Y.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:z,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Ne,Fe,Ue,pt,$e,yt,It,bt,Et,Ot,dt,At){let at=0,tt=0,Nt=0;const Pt=bt==="right"?1:bt==="left"?0:.5;let vi=!1;for(const Xt of $e){const mi=Xt.getSections();for(const Oi of mi){if(Oi.image)continue;const Qi=Fe[Oi.fontStack];if(Qi&&(vi=Qi.ascender!==void 0&&Qi.descender!==void 0,!vi))break}if(!vi)break}let ai=0;for(const Xt of $e){Xt.trim();const mi=Xt.getMaxScale(),Oi=(mi-1)*Qs,Qi={positionedGlyphs:[],lineOffset:0};Ne.positionedLines[ai]=Qi;const hn=Qi.positionedGlyphs;let nn=0;if(!Xt.length()){tt+=yt,++ai;continue}let ui=0,en=0;for(let fe=0;fe<Xt.length();fe++){const me=Xt.getSection(fe),st=Xt.getSectionIndex(fe),ft=Xt.getCodePoint(fe);let Zt=me.scale,$t=null,ci=null,Si=null,dn=Qs,mn=0,an=Et;an===al.vertical&&((fi=ft)===12312||fi===12313||fi===12316||fi===12540||fi===12448)&&(an=al.horizontal);const Yn=!(an===al.horizontal||!dt&&!Ld(ft)||dt&&(ey[ft]||qm(ft)));if(me.image){const Cr=pt.get(me.image.toString());if(!Cr)continue;Si=me.image,Ne.iconsInText=Ne.iconsInText||!0,ci=Cr.paddedRect;const sn=Cr.displaySize;Zt=Zt*Qs/At,$t={width:sn[0],height:sn[1],left:0,top:-3,advance:Yn?sn[1]:sn[0],localGlyph:!1},mn=vi?-$t.height*Zt:mi*Qs-17-sn[1]*Zt,dn=$t.advance;const gr=(Yn?sn[0]:sn[1])*Zt-Qs*mi;gr>0&&gr>nn&&(nn=gr)}else{const Cr=Ue[me.fontStack];if(!Cr)continue;Cr[ft]&&(ci=Cr[ft]);const sn=Fe[me.fontStack];if(!sn)continue;const gr=sn.glyphs[ft];if(!gr)continue;if($t=gr.metrics,dn=ft!==8203?Qs:0,vi){const er=sn.ascender!==void 0?Math.abs(sn.ascender):0,Fn=sn.descender!==void 0?Math.abs(sn.descender):0,vr=(er+Fn)*Zt;ui<vr&&(ui=vr,en=(er-Fn)/2*Zt),mn=-er*Zt}else mn=(mi-Zt)*Qs-17}Yn?(Ne.verticalizable=!0,hn.push({glyph:ft,image:Si,x:at,y:tt+mn,vertical:Yn,scale:Zt,localGlyph:$t.localGlyph,fontStack:me.fontStack,sectionIndex:st,metrics:$t,rect:ci}),at+=dn*Zt+Ot):(hn.push({glyph:ft,image:Si,x:at,y:tt+mn,vertical:Yn,scale:Zt,localGlyph:$t.localGlyph,fontStack:me.fontStack,sectionIndex:st,metrics:$t,rect:ci}),at+=$t.advance*Zt+Ot)}hn.length!==0&&(Nt=Math.max(at-Ot,Nt),vi?Qb(hn,Pt,nn,en,yt*mi/2):Qb(hn,Pt,nn,0,yt/2)),at=0;const An=yt*mi+nn;Qi.lineOffset=Math.max(nn,Oi),tt+=An,++ai}var fi;const Ht=tt,{horizontalAlign:xi,verticalAlign:Gi}=gx(It);(function(Xt,mi,Oi,Qi,hn,nn){const ui=(mi-Oi)*hn,en=-nn*Qi;for(const An of Xt)for(const fe of An.positionedGlyphs)fe.x+=ui,fe.y+=en})(Ne.positionedLines,Pt,xi,Gi,Nt,Ht),Ne.top+=-Gi*Ht,Ne.bottom=Ne.top+Ht,Ne.left+=-xi*Nt,Ne.right=Ne.left+Nt,Ne.hasBaseline=vi}(Me,e,i,a,K,p,y,T,z,A,P,B),!function(Ne){for(const Fe of Ne)if(Fe.positionedGlyphs.length!==0)return!1;return!0}(Re))return Me}const ey={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},AE={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Xb(n,e,i,a,o,d){if(e.image){const p=a.get(e.image.toString());return p?p.displaySize[0]*e.scale*Qs/d+o:0}{const p=i[e.fontStack],y=p&&p.glyphs[n];return y?y.metrics.advance*e.scale+o:0}}function Yb(n,e,i,a){const o=Math.pow(n-e,2);return a?n<e?o/2:2*o:o+Math.abs(i)*i}function CE(n,e,i){let a=0;return n===10&&(a-=1e4),i&&(a+=150),n!==40&&n!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Kb(n,e,i,a,o,d){let p=null,y=Yb(e,i,o,d);for(const T of a){const A=Yb(e-T.x,i,o,d)+T.badness;A<=y&&(p=T,y=A)}return{index:n,x:e,priorBreak:p,badness:y}}function Jb(n){return n?Jb(n.priorBreak).concat(n.index):[]}function gx(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Qb(n,e,i,a,o){if(!(e||i||a||o))return;const d=n.length-1,p=n[d],y=(p.x+p.metrics.advance*p.scale)*e;for(let T=0;T<=d;T++)n[T].x-=y,n[T].y+=i+a+o}function ew(n){return n.imagePrimary!==void 0&&n.top!==void 0&&n.bottom!==void 0&&n.left!==void 0&&n.right!==void 0}function RE(n,e,i,a){const{horizontalAlign:o,verticalAlign:d}=gx(a),p=i[0]-n.displaySize[0]*o,y=i[1]-n.displaySize[1]*d;return{imagePrimary:n,imageSecondary:e,top:y,bottom:y+n.displaySize[1],left:p,right:p+n.displaySize[0]}}function tw(n,e,i,a,o,d){const p=n.imagePrimary;let y;if(p.content){const Y=p.content,K=p.pixelRatio||1;y=[Y[0]/K,Y[1]/K,p.displaySize[0]-Y[2]/K,p.displaySize[1]-Y[3]/K]}const T=e.left*d,A=e.right*d;let M,z,P,j;i==="width"||i==="both"?(j=o[0]+T-a[3],z=o[0]+A+a[1]):(j=o[0]+(T+A-p.displaySize[0])/2,z=j+p.displaySize[0]);const B=e.top*d,W=e.bottom*d;return i==="height"||i==="both"?(M=o[1]+B-a[0],P=o[1]+W+a[2]):(M=o[1]+(B+W-p.displaySize[1])/2,P=M+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:M,right:z,bottom:P,left:j,collisionPadding:y}}function iw(n){return!n.imagePrimary.stretchX}function nw(n){return!n.imagePrimary.stretchY}function rw(n){return{width:n.right-n.left,height:n.bottom-n.top}}const td=128;function sw(n,e,i){const{expression:a}=e;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new ir(n+1,{worldview:i}))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:d}=a;let p=0;for(;p<o.length&&o[p]<=n;)p++;p=Math.max(0,p-1);let y=p;for(;y<o.length&&o[y]<n+1;)y++;y=Math.min(o.length-1,y);const T=o[p],A=o[y];return a.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:A,interpolationType:d}:{kind:"camera",minZoom:T,maxZoom:A,minSize:a.evaluate(new ir(T,{worldview:i})),maxSize:a.evaluate(new ir(A,{worldview:i})),interpolationType:d}}}function _x(n,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:o}){return n.kind==="source"?a/td:n.kind==="composite"?zi(a/td,o/td,i):e}function M_(n,e,i=1){let a=0,o=0;if(n.kind==="constant")o=n.layoutSize*i;else if(n.kind!=="source"){const{interpolationType:d,minZoom:p,maxZoom:y}=n,T=d?Ie(zr.interpolationFactor(d,e,p,y),0,1):0;n.kind==="camera"?o=zi(n.minSize,n.maxSize,T)*i:a=T*i}return{uSizeT:a,uSize:o}}class tf extends Mt{constructor(e,i,a,o,d){super(e,i),this.angle=o,this.z=a,d!==void 0&&(this.segment=d)}clone(){return new tf(this.x,this.y,this.z,this.angle,this.segment)}}function aw(n,e,i,a,o){if(e.segment===void 0)return!0;let d=e,p=e.segment+1,y=0;for(;y>-i/2;){if(p--,p<0)return!1;y-=n[p].dist(d),d=n[p]}y+=n[p].dist(n[p+1]),p++;const T=[];let A=0;for(;y<i/2;){const M=n[p],z=n[p+1];if(!z)return!1;let P=n[p-1].angleTo(M)-M.angleTo(z);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:y,angleDelta:P}),A+=P;y-T[0].distance>a;)A-=T.shift().angleDelta;if(A>o)return!1;p++,y+=M.dist(z)}return!0}function ow(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function lw(n,e,i){return n?.6*e*i:0}function cw(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function ME(n,e,i,a,o,d){const p=lw(i,o,d),y=cw(i,a)*d;let T=0;const A=ow(n)/2;for(let M=0;M<n.length-1;M++){const z=n[M],P=n[M+1],j=z.dist(P);if(T+j>A){const B=(A-T)/j,W=zi(z.x,P.x,B),Y=zi(z.y,P.y,B),K=new tf(W,Y,0,P.angleTo(z),M);return!p||aw(n,K,y,p,e)?K:void 0}T+=j}}function IE(n,e,i,a,o,d,p,y,T){const A=lw(a,d,p),M=cw(a,o),z=M*p,P=n[0].x===0||n[0].x===T||n[0].y===0||n[0].y===T;return e-z<e/4&&(e=z+e/4),uw(n,P?e/2*y%e:(M/2+2*d)*p*y%e,e,A,i,z,P,!1,T)}function uw(n,e,i,a,o,d,p,y,T){const A=d/2,M=ow(n);let z=0,P=e-i,j=[];for(let B=0;B<n.length-1;B++){const W=n[B],Y=n[B+1],K=W.dist(Y),re=Y.angleTo(W);for(;P+i<z+K;){P+=i;const se=(P-z)/K,ue=zi(W.x,Y.x,se),Re=zi(W.y,Y.y,se);if(ue>=0&&ue<T&&Re>=0&&Re<T&&P-A>=0&&P+A<=M){const Me=new tf(ue,Re,0,re,B);a&&!aw(n,Me,d,a,o)||j.push(Me)}}z+=K}return y||j.length||p||(j=uw(n,z/2,i,a,o,d,p,!0,T)),j}function hw(n){let e=0,i=0;for(const p of n)e+=p.w*p.h,i=Math.max(i,p.w);n.sort((p,y)=>y.h-p.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let o=0,d=0;for(const p of n)for(let y=a.length-1;y>=0;y--){const T=a[y];if(!(p.w>T.w||p.h>T.h)){if(p.x=T.x,p.y=T.y,d=Math.max(d,p.y+p.h),o=Math.max(o,p.x+p.w),p.w===T.w&&p.h===T.h){const A=a.pop();A&&y<a.length&&(a[y]=A)}else p.h===T.h?(T.x+=p.w,T.w-=p.w):p.w===T.w?(T.y+=p.h,T.h-=p.h):(a.push({x:T.x+p.w,y:T.y,w:T.w-p.w,h:p.h}),T.y+=p.h,T.h-=p.h);break}}return{w:o,h:d,fill:e/(o*d)||0}}ri(tf,"Anchor");const ym=1;class I_{static getImagePositionScale(e,i,a){if(i&&e&&e.options&&e.options.transform){const o=e.options.transform;return{x:o.a,y:o.d}}return{x:a,y:a}}constructor(e,i,a,o){this.paddedRect=e;const{pixelRatio:d,version:p,stretchX:y,stretchY:T,content:A,sdf:M,usvg:z}=i;this.pixelRatio=d,this.stretchX=y,this.stretchY=T,this.content=A,this.version=p,this.padding=a,this.sdf=M,this.usvg=z,this.scale=I_.getImagePositionScale(o,z,d)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function yx(n,e,i){const a=vo.parse(n),o=function(d,p,y=[1,1]){return{x:0,y:0,w:(d.data?d.data.width:d.width*y[0])+2*p,h:(d.data?d.data.height:d.height*y[1])+2*p}}(e,i,[a.options.transform.a,a.options.transform.d]);return{bin:o,imagePosition:new I_(o,e,i,a),imageVariant:a}}class dw{constructor(e,i,a){const o=new Map,d=new Map;this.haveRenderCallbacks=[];const p=[];this.addImages(e,o,ym,p),this.addImages(i,d,2,p);const{w:y,h:T}=hw(p),A=new Ks({width:y||1,height:T||1});for(const[M,z]of e.entries()){const P=o.get(M).paddedRect;Ks.copy(z.data,A,{x:0,y:0},{x:P.x+ym,y:P.y+ym},z.data,null,z.sdf)}for(const[M,z]of i.entries()){const P=d.get(M),j=P.paddedRect;let B=P.padding;const W=j.x+B,Y=j.y+B,K=z.data.width,re=z.data.height;B=B>1?B-1:B,Ks.copy(z.data,A,{x:0,y:0},{x:W,y:Y},z.data,a),Ks.copy(z.data,A,{x:0,y:re-B},{x:W,y:Y-B},{width:K,height:B},a),Ks.copy(z.data,A,{x:0,y:0},{x:W,y:Y+re},{width:K,height:B},a),Ks.copy(z.data,A,{x:K-B,y:0},{x:W-B,y:Y},{width:B,height:re},a),Ks.copy(z.data,A,{x:0,y:0},{x:W+K,y:Y},{width:B,height:re},a),Ks.copy(z.data,A,{x:K-B,y:re-B},{x:W-B,y:Y-B},{width:B,height:B},a),Ks.copy(z.data,A,{x:0,y:re-B},{x:W+K,y:Y-B},{width:B,height:B},a),Ks.copy(z.data,A,{x:0,y:0},{x:W+K,y:Y+re},{width:B,height:B},a),Ks.copy(z.data,A,{x:K-B,y:0},{x:W-B,y:Y+re},{width:B,height:B},a)}this.lut=a,this.image=A,this.iconPositions=o,this.patternPositions=d}addImages(e,i,a,o){for(const[d,p]of e.entries()){const{bin:y,imagePosition:T,imageVariant:A}=yx(d,p,a);i.set(d,T),o.push(y),p.hasRenderCallback&&this.haveRenderCallbacks.push(A.id)}}patchUpdatedImages(e,i,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(o=>e.hasImage(o,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const o of e.getUpdatedImages(a)){for(const d of this.iconPositions.keys()){const p=vo.parse(d);if(to.isEqual(p.id,o)){const y=e.getImage(o,a);this.patchUpdatedImage(this.iconPositions.get(d),y,i,null)}}for(const d of this.patternPositions.keys()){const p=vo.parse(d);if(to.isEqual(p.id,o)){const y=e.getImage(o,a);this.patchUpdatedImage(this.patternPositions.get(d),y,i,this.lut)}}}}patchUpdatedImage(e,i,a,o=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[d,p]=e.tl,y=e.sdf;if(this.lut||y){const T={width:i.data.width,height:i.data.height},A=new Ks(T);Ks.copy(i.data,A,{x:0,y:0},{x:0,y:0},T,o,y),a.update(A,{position:{x:d,y:p}})}else a.update(i.data,{position:{x:d,y:p}})}}ri(I_,"ImagePosition"),ri(dw,"ImageAtlas");const ty=1e20;function fw(n,e,i,a,o,d,p,y,T){for(let A=e;A<e+a;A++)pw(n,i*d+A,d,o,p,y,T);for(let A=i;A<i+o;A++)pw(n,A*d+e,1,a,p,y,T)}function pw(n,e,i,a,o,d,p){d[0]=0,p[0]=-1e20,p[1]=ty,o[0]=n[e];for(let y=1,T=0,A=0;y<a;y++){o[y]=n[e+y*i];const M=y*y;do{const z=d[T];A=(o[y]-o[z]+M-z*z)/(y-z)/2}while(A<=p[T]&&--T>-1);T++,d[T]=y,p[T]=A,p[T+1]=ty}for(let y=0,T=0;y<a;y++){for(;p[T+1]<y;)T++;const A=d[T],M=y-A;n[e+y*i]=o[A]+M*M}}const Ju=2,xx={none:0,ideographs:1,all:2};class Sg{constructor(e,i,a){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=a,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const a=[],o=this.url||Vr.GLYPHS_URL;for(const d in e)for(const p of e[d])a.push({stack:d,id:p});Je(a,({stack:d,id:p},y)=>{let T=this.entries[d];T||(T=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=T.glyphs[p];if(A!==void 0)return void y(null,{stack:d,id:p,glyph:A});if(A=this._tinySDF(T,d,p),A)return T.glyphs[p]=A,void y(null,{stack:d,id:p,glyph:A});const M=Math.floor(p/256);if(256*M>65535)return cn("glyphs > 65535 not supported"),void y(null,{stack:d,id:p,glyph:A});if(T.ranges[M])return void y(null,{stack:d,id:p,glyph:A});let z=T.requests[M];z||(z=T.requests[M]=[],Sg.loadGlyphRange(d,M,o,this.requestManager,(P,j)=>{if(j){T.ascender=j.ascender,T.descender=j.descender;for(const B in j.glyphs)this._doesCharSupportLocalGlyph(+B)||(T.glyphs[+B]=j.glyphs[+B]);T.ranges[M]=!0}for(const B of z)B(P,j);delete T.requests[M]})),z.push((P,j)=>{P?y(P):j&&y(null,{stack:d,id:p,glyph:j.glyphs[p]||null})})},(d,p)=>{if(d)i(d);else if(p){const y={};for(const{stack:T,id:A,glyph:M}of p)y[T]===void 0&&(y[T]={}),y[T].glyphs===void 0&&(y[T].glyphs={}),y[T].glyphs[A]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},y[T].ascender=this.entries[T].ascender,y[T].descender=this.entries[T].descender;i(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==xx.none&&(this.localGlyphMode===xx.all?!!this.localFontFamily:!!this.localFontFamily&&(Ri["CJK Unified Ideographs"](e)||Ri["Hangul Syllables"](e)||Ri.Hiragana(e)||Ri.Katakana(e)||Ri["CJK Symbols and Punctuation"](e)||Ri["CJK Unified Ideographs Extension A"](e)||Ri["CJK Unified Ideographs Extension B"](e)||Ri.Osage(e)))}_tinySDF(e,i,a){const o=this.localFontFamily;if(!o||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let W="400";/bold/i.test(i)?W="900":/medium/i.test(i)?W="500":/light/i.test(i)&&(W="200"),d=e.tinySDF=new Sg.TinySDF({fontFamily:o,fontWeight:W,fontSize:24*Ju,buffer:3*Ju,radius:8*Ju}),d.fontWeight=W}if(this.localGlyphs[d.fontWeight][a])return this.localGlyphs[d.fontWeight][a];const p=String.fromCodePoint(a),{data:y,width:T,height:A,glyphWidth:M,glyphHeight:z,glyphLeft:P,glyphTop:j,glyphAdvance:B}=d.draw(p);return this.localGlyphs[d.fontWeight][a]={id:a,bitmap:new ys({width:T,height:A},y),metrics:{width:M/Ju,height:z/Ju,left:P/Ju,top:j/Ju-27,advance:B/Ju,localGlyph:!0}}}}Sg.loadGlyphRange=function(n,e,i,a,o){const d=256*e,p=d+255,y=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${d}-${p}`),uh.Glyphs);cl(y,(T,A)=>{if(T)o(T);else if(A){const M={},z=function(P){return new Q0(P).readFields(wE,{})}(A);for(const P of z.glyphs)M[P.id]=P;o(null,{glyphs:M,ascender:z.ascender,descender:z.descender})}})},Sg.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:o="sans-serif",fontWeight:d="normal",fontStyle:p="normal",lang:y=null}={}){this.buffer=e,this.cutoff=a,this.radius=i,this.lang=y;const T=this.size=n+4*e,A=this._createCanvas(T),M=this.ctx=A.getContext("2d",{willReadFrequently:!0});M.font=`${p} ${d} ${n}px ${o}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:o,actualBoundingBoxRight:d}=this.ctx.measureText(n),p=Math.ceil(i),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-o))),T=Math.min(this.size-this.buffer,p+Math.ceil(a)),A=y+2*this.buffer,M=T+2*this.buffer,z=Math.max(A*M,0),P=new Uint8ClampedArray(z),j={data:P,width:A,height:M,glyphWidth:y,glyphHeight:T,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(y===0||T===0)return j;const{ctx:B,buffer:W,gridInner:Y,gridOuter:K}=this;this.lang&&(B.lang=this.lang),B.clearRect(W,W,y,T),B.fillText(n,W,W+p);const re=B.getImageData(W,W,y,T);K.fill(ty,0,z),Y.fill(0,0,z);for(let se=0;se<T;se++)for(let ue=0;ue<y;ue++){const Re=re.data[4*(se*y+ue)+3]/255;if(Re===0)continue;const Me=(se+W)*A+ue+W;if(Re===1)K[Me]=0,Y[Me]=ty;else{const Ne=.5-Re;K[Me]=Ne>0?Ne*Ne:0,Y[Me]=Ne<0?Ne*Ne:0}}fw(K,0,0,A,M,A,this.f,this.v,this.z),fw(Y,W,W,y,T,A,this.f,this.v,this.z);for(let se=0;se<z;se++){const ue=Math.sqrt(K[se])-Math.sqrt(Y[se]);P[se]=Math.round(255-255*(ue/this.radius+this.cutoff))}return j}};const xm=ym;function mw(n,e){return n+e[1]-e[0]}function gw(n,e,i,a,o=1){const d=[],p=n.imagePrimary,y=p.pixelRatio,T=p.paddedRect.w-2*xm,A=p.paddedRect.h-2*xm,M=(n.right-n.left)*o,z=(n.bottom-n.top)*o,P=p.stretchX||[[0,T]],j=p.stretchY||[[0,A]],B=P.reduce(mw,0),W=j.reduce(mw,0),Y=T-B,K=A-W;let re=0,se=B,ue=0,Re=W,Me=0,Ne=Y,Fe=0,Ue=K;if(p.content&&a){const $e=p.content;re=iy(P,0,$e[0]),ue=iy(j,0,$e[1]),se=iy(P,$e[0],$e[2]),Re=iy(j,$e[1],$e[3]),Me=$e[0]-re,Fe=$e[1]-ue,Ne=$e[2]-$e[0]-se,Ue=$e[3]-$e[1]-Re}const pt=($e,yt,It,bt)=>{const Et=ny($e.stretch-re,se,M,n.left*o),Ot=ry($e.fixed-Me,Ne,$e.stretch,B),dt=ny(yt.stretch-ue,Re,z,n.top*o),At=ry(yt.fixed-Fe,Ue,yt.stretch,W),at=ny(It.stretch-re,se,M,n.left*o),tt=ry(It.fixed-Me,Ne,It.stretch,B),Nt=ny(bt.stretch-ue,Re,z,n.top*o),Pt=ry(bt.fixed-Fe,Ue,bt.stretch,W),vi=new Mt(Et,dt),ai=new Mt(at,dt),fi=new Mt(at,Nt),Ht=new Mt(Et,Nt),xi=new Mt(Ot/y,At/y),Gi=new Mt(tt/y,Pt/y),Xt=e*Math.PI/180;if(Xt){const ui=Math.sin(Xt),en=Math.cos(Xt),An=[en,-ui,ui,en];vi._matMult(An),ai._matMult(An),Ht._matMult(An),fi._matMult(An)}const mi=$e.stretch+$e.fixed,Oi=It.stretch+It.fixed,Qi=yt.stretch+yt.fixed,hn=bt.stretch+bt.fixed,nn=n.imageSecondary;return{tl:vi,tr:ai,bl:Ht,br:fi,texPrimary:{x:p.paddedRect.x+xm+mi,y:p.paddedRect.y+xm+Qi,w:Oi-mi,h:hn-Qi},texSecondary:nn?{x:nn.paddedRect.x+xm+mi,y:nn.paddedRect.y+xm+Qi,w:Oi-mi,h:hn-Qi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xi,pixelOffsetBR:Gi,minFontScaleX:Ne/y/M,minFontScaleY:Ue/y/z,isSDF:i}};if(a&&(p.stretchX||p.stretchY)){const $e=_w(P,Y,B),yt=_w(j,K,W);for(let It=0;It<$e.length-1;It++){const bt=$e[It],Et=$e[It+1];for(let Ot=0;Ot<yt.length-1;Ot++)d.push(pt(bt,yt[Ot],Et,yt[Ot+1]))}}else d.push(pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:A+1}));return d}function iy(n,e,i){let a=0;for(const o of n)a+=Math.max(e,Math.min(i,o[1]))-Math.max(e,Math.min(i,o[0]));return a}function _w(n,e,i){const a=[{fixed:-1,stretch:0}];for(const[o,d]of n){const p=a[a.length-1];a.push({fixed:o-p.stretch,stretch:p.stretch}),a.push({fixed:o-p.stretch,stretch:p.stretch+(d-o)})}return a.push({fixed:e+xm,stretch:i}),a}function ny(n,e,i,a){return n/e*i+a}function ry(n,e,i,a){return n-e*i/a}function zE(n,e,i,a){const o=e+n.positionedLines[a].lineOffset;return a===0?i+o/2:i+(o+(e+n.positionedLines[a-1].lineOffset))/2}function DE(n,e=1,i=!1){let a=1/0,o=1/0,d=-1/0,p=-1/0;const y=n[0];for(let j=0;j<y.length;j++){const B=y[j];(!j||B.x<a)&&(a=B.x),(!j||B.y<o)&&(o=B.y),(!j||B.x>d)&&(d=B.x),(!j||B.y>p)&&(p=B.y)}const T=Math.min(d-a,p-o);let A=T/2;const M=new _h([],PE);if(T===0)return new Mt(a,o);for(let j=a;j<d;j+=T)for(let B=o;B<p;B+=T)M.push(new Eg(j+A,B+A,A,n));let z=function(j){let B=0,W=0,Y=0;const K=j[0];for(let re=0,se=K.length,ue=se-1;re<se;ue=re++){const Re=K[re],Me=K[ue],Ne=Re.x*Me.y-Me.x*Re.y;W+=(Re.x+Me.x)*Ne,Y+=(Re.y+Me.y)*Ne,B+=3*Ne}return new Eg(W/B,Y/B,0,j)}(n),P=M.length;for(;M.length;){const j=M.pop();(j.d>z.d||!z.d)&&(z=j,i&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,P)),j.max-z.d<=e||(A=j.h/2,M.push(new Eg(j.p.x-A,j.p.y-A,A,n)),M.push(new Eg(j.p.x+A,j.p.y-A,A,n)),M.push(new Eg(j.p.x-A,j.p.y+A,A,n)),M.push(new Eg(j.p.x+A,j.p.y+A,A,n)),P+=4)}return i&&(console.log(`num probes: ${P}`),console.log(`best distance: ${z.d}`)),z.p}function PE(n,e){return e.max-n.max}class Eg{constructor(e,i,a,o){this.p=new Mt(e,i),this.h=a,this.d=function(d,p){let y=!1,T=1/0;for(let A=0;A<p.length;A++){const M=p[A];for(let z=0,P=M.length,j=P-1;z<P;j=z++){const B=M[z],W=M[j];B.y>d.y!=W.y>d.y&&d.x<(W.x-B.x)*(d.y-B.y)/(W.y-B.y)+B.x&&(y=!y),T=Math.min(T,pr(d,B,W))}}return(y?1:-1)*Math.sqrt(T)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}}const LE=Object.keys,vx=Number.POSITIVE_INFINITY,OE=Math.sqrt(2);function yw(n,[e,i]){let a=0,o=0;if(i===vx){e<0&&(e=0);const d=e/OE;switch(n){case"top-right":case"top-left":o=d-7;break;case"bottom-right":case"bottom-left":o=7-d;break;case"bottom":o=7-e;break;case"top":o=e-7}switch(n){case"top-right":case"bottom-right":a=-d;break;case"top-left":case"bottom-left":a=d;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":o=i-7;break;case"bottom-right":case"bottom-left":case"bottom":o=7-i}switch(n){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,o]}function sy(n,e,i,a,o,d,p,y,T){if(!e||!e.usvg)return;const A=rw(a),M=rw(o),z=d!=="both"&&d!=="width"||!iw(a)?1:M.width/A.width,P=d!=="both"&&d!=="height"||!nw(a)?1:M.height/A.height;i.scaleSelf(z,P);const j=i.toString();p.set(j,i),y.set(j,e);const{imagePosition:B}=yx(j,e,ym);T.set(j,B)}function xw(n,e,i,a,o,d,p,y,T){if(!n)return;const A=function(M,z,P,j,B,W){if(M.kind==="camera")return M.maxSize;if(M.kind==="composite"){const Y=z.possiblyEvaluate(new ir(M.maxZoom,{worldview:W}),P).evaluate(B,{},P),K=z.possiblyEvaluate(new ir(M.minZoom,{worldview:W}),P).evaluate(B,{},P);return Math.max(Y,K)}return z.possiblyEvaluate(new ir(j,{worldview:W})).evaluate(B,{},P)}(e,i,a,o,d,T);return n.scaleSelf(A*y*p)}function vw(n,e,i,a,o,d,p,y,T){return{iconPrimary:xw(n.getPrimary(),e,i,a,o,d,p,y,T),iconSecondary:xw(n.getSecondary(),e,i,a,o,d,p,y,T)}}function kE(n,e,i){if(!e)return;const a=i.get(n.toString()),o=i.get(e.toString());a&&o&&(a.paddedRect.w===o.paddedRect.w&&a.paddedRect.h===o.paddedRect.h||cn(`Mismatch in icon variant sizes: ${n.toString()} and ${e.toString()}`),a.usvg!==o.usvg&&cn(`Mismatch in icon variant image types: ${n.id} and ${e.id}`))}function bw(n,e,i,a){if(!n)return;const o=e.get(i.toString());if(n.imagePrimary=o,a){const d=e.get(a.toString());n.imageSecondary=d}}function NE(n,e){for(const i in n.horizontal)ww(n.horizontal[i],e);ww(n.vertical,e)}function ww(n,e){if(n){for(const i of n.positionedLines)for(const a of i.positionedGlyphs)if(a.image!==null){const o=a.image.toString();a.rect=e.get(o).paddedRect}}}function bx(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function jE(n,e,i,a,o,d,p,y,T){const A=wx(d.horizontal)||d.vertical,M=i.get("icon-text-fit-padding").evaluate(a,{},o);let z,P=e;return e&&T!=="none"&&(n.allowVerticalPlacement&&d.vertical&&(z=tw(e,d.vertical,T,M,y,p)),A&&(P=tw(e,A,T,M,y,p))),{defaultShapedIcon:P,verticallyShapedIcon:z}}function BE(n,e,i,a,o,d,p,y,T,A,M,z,P,j,B,W,Y,K,re,se){let ue=p.textMaxSize.evaluate(e,{},P);ue===void 0?ue=y*p.textScaleFactor:ue*=p.textScaleFactor;const Re=n.layers[0].layout,Me=wx(i.horizontal)||i.vertical,Ne=j.name==="globe",Fe=Qs,Ue=n.tilePixelRatio*ue/Fe,pt=(Ot=n.overscaling,n.zoom>18&&Ot>2&&(Ot>>=1),Math.max(Vt/(512*Ot),1)*Re.get("symbol-spacing")),$e=Re.get("text-padding")*n.tilePixelRatio,yt=Re.get("icon-padding")*n.tilePixelRatio,It=He(Re.get("text-max-angle")),bt=Re.get("icon-rotation-alignment")==="map"&&se!=="point",Et=pt/2;var Ot;n.hasAnyIconTextFit===!1&&Y!=="none"&&(n.hasAnyIconTextFit=!0);const dt=e.properties?+e.properties[Hi]:null,At=dt&&n.elevationFeatureIdToIndex?n.elevationFeatureIdToIndex.get(dt):65535,at=(tt,Nt,Pt)=>{if(Nt.x<0||Nt.x>=Vt||Nt.y<0||Nt.y>=Vt)return;let vi=null;if(Ne){const{x:ai,y:fi,z:Ht}=j.projectTilePoint(Nt.x,Nt.y,Pt);vi={anchor:new tf(ai,fi,Ht,0,void 0),up:j.upVector(Pt,Nt.x,Nt.y)}}(function(ai,fi,Ht,xi,Gi,Xt,mi,Oi,Qi,hn,nn,ui,en,An,fe,me,st,ft,Zt,$t,ci,Si,dn,mn,an,Yn,Cr,sn,gr){const er=ai.addToLineVertexArray(fi,xi);let Fn,vr,br,hr,_r,tr,gn,nr=0,Pr=0,ji=0,Pn=0,wr=-1,Br=-1;const Tr={};let xs=dh("");const sr=Ht?Ht.anchor:fi,us=sn!=="none";let Do=0,ba=0;if(Qi._unevaluatedLayout.getValue("text-radial-offset")===void 0){const vs=Qi.layout.get("text-offset").evaluate(ci,{},an);Do=vs[0]*Qs,ba=vs[1]*Qs}else Do=Qi.layout.get("text-radial-offset").evaluate(ci,{},an)*Qs,ba=vx;if(ai.allowVerticalPlacement&&Gi.vertical){const vs=Gi.vertical;if(fe)tr=Tx(vs),Oi&&(gn=Tx(Oi));else{const zs=Qi.layout.get("text-rotate").evaluate(ci,{},an)+90;br=ay(hn,sr,fi,nn,ui,en,vs,An,zs,me),Oi&&(hr=ay(hn,sr,fi,nn,ui,en,Oi,ft,zs))}}if(Xt){const vs=ai.iconSizeData,zs=Qi.layout.get("icon-rotate").evaluate(ci,{},an),wa=gw(Xt,zs,dn,us,Si.iconScaleFactor),Za=Oi?gw(Oi,zs,dn,us,Si.iconScaleFactor):void 0;vr=ay(hn,sr,fi,nn,ui,en,Xt,ft,zs,null),nr=4*wa.length;let Oa=null;vs.kind==="source"?(Oa=[td*Qi.layout.get("icon-size").evaluate(ci,{},an)*Si.iconScaleFactor],Oa[0]>up&&cn(`${ai.layerIds[0]}: Value for "icon-size" is >= ${z_}. Reduce your "icon-size".`)):vs.kind==="composite"&&(Oa=[td*Si.compositeIconSizes[0].evaluate(ci,{},an)*Si.iconScaleFactor,td*Si.compositeIconSizes[1].evaluate(ci,{},an)*Si.iconScaleFactor],(Oa[0]>up||Oa[1]>up)&&cn(`${ai.layerIds[0]}: Value for "icon-size" is >= ${z_}. Reduce your "icon-size".`)),ai.addSymbols(ai.icon,wa,Oa,$t,Zt,ci,void 0,Ht,fi,er.lineStartIndex,er.lineLength,-1,mn,an,Yn,Cr),wr=ai.icon.placedSymbolArray.length-1,Za&&(Pr=4*Za.length,ai.addSymbols(ai.icon,Za,Oa,$t,Zt,ci,al.vertical,Ht,fi,er.lineStartIndex,er.lineLength,-1,mn,an,Yn,Cr),Br=ai.icon.placedSymbolArray.length-1)}for(const vs in Gi.horizontal){const zs=vs,wa=Gi.horizontal[zs];Fn||(xs=dh(wa.text),fe?_r=Tx(wa):Fn=ay(hn,sr,fi,nn,ui,en,wa,An,Qi.layout.get("text-rotate").evaluate(ci,{},an),me));const Za=wa.positionedLines.length===1;if(ji+=Tw(ai,Ht,fi,wa,mi,Qi,fe,ci,me,er,Gi.vertical?al.horizontal:al.horizontalOnly,Za?LE(Gi.horizontal):[zs],Tr,wr,Si,mn,an,Yn),Za)break}Gi.vertical&&(Pn+=Tw(ai,Ht,fi,Gi.vertical,mi,Qi,fe,ci,me,er,al.vertical,["vertical"],Tr,Br,Si,mn,an,Yn));let da=-1;const Po=(vs,zs)=>vs?Math.max(vs,zs):zs;da=Po(_r,da),da=Po(tr,da),da=Po(gn,da);const id=da>-1?1:0;ai.glyphOffsetArray.length>=65535&&cn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ci.sortKey!==void 0&&ai.addToSortKeyRanges(ai.symbolInstances.length,ci.sortKey),ai.symbolInstances.emplaceBack(fi.x,fi.y,sr.x,sr.y,sr.z,Tr.right>=0?Tr.right:-1,Tr.center>=0?Tr.center:-1,Tr.left>=0?Tr.left:-1,Tr.vertical>=0?Tr.vertical:-1,wr,Br,xs,Fn!==void 0?Fn:ai.collisionBoxArray.length,Fn!==void 0?Fn+1:ai.collisionBoxArray.length,br!==void 0?br:ai.collisionBoxArray.length,br!==void 0?br+1:ai.collisionBoxArray.length,vr!==void 0?vr:ai.collisionBoxArray.length,vr!==void 0?vr+1:ai.collisionBoxArray.length,hr||ai.collisionBoxArray.length,hr?hr+1:ai.collisionBoxArray.length,nn,ji,Pn,nr,Pr,id,0,Do,ba,da,0,us?1:0,gr)})(n,Nt,vi,tt,i,a,d,o,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,$e,re,A,0,yt,bt,K,e,p,M,z,P,B,W,Y,At)};if(se==="line")for(const tt of cs(e.geometry,0,0,Vt,Vt)){const Nt=IE(tt,pt,It,i.vertical||Me,a,Fe,Ue,n.overscaling,Vt);for(const Pt of Nt)Me&&FE(n,Me.text,Et,Pt)||at(tt,Pt,P)}else if(se==="line-center"){for(const tt of e.geometry)if(tt.length>1){const Nt=ME(tt,It,i.vertical||Me,a,Fe,Ue);Nt&&at(tt,Nt,P)}}else if(e.type==="Polygon")for(const tt of lm(e.geometry,0)){const Nt=DE(tt,16);at(tt[0],new tf(Nt.x,Nt.y,0,0,void 0),P)}else if(e.type==="LineString")for(const tt of e.geometry)at(tt,new tf(tt[0].x,tt[0].y,0,0,void 0),P);else if(e.type==="Point")for(const tt of e.geometry)for(const Nt of tt)at([Nt],new tf(Nt.x,Nt.y,0,0,void 0),P)}const z_=255,up=z_*td;function Tw(n,e,i,a,o,d,p,y,T,A,M,z,P,j,B,W,Y,K){const re=function(Re,Me,Ne,Fe,Ue,pt,$e,yt){const It=[];if(Me.positionedLines.length===0)return It;const bt=Fe.layout.get("text-rotate").evaluate(pt,{})*Math.PI/180,Et=function(tt){const Nt=tt[0],Pt=tt[1],vi=Nt*Pt;return vi>0?[Nt,-Pt]:vi<0?[-Nt,Pt]:Nt===0?[Pt,Nt]:[Pt,-Nt]}(Ne);let Ot=Math.abs(Me.top-Me.bottom);for(const tt of Me.positionedLines)Ot-=tt.lineOffset;const dt=Me.positionedLines.length,At=Ot/dt;let at=Me.top-Ne[1];for(let tt=0;tt<dt;++tt){const Nt=Me.positionedLines[tt];at=zE(Me,At,at,tt);for(const Pt of Nt.positionedGlyphs){if(!Pt.rect)continue;const vi=Pt.rect||{};let ai=EE+1,fi=!0,Ht=1,xi=0;if(Pt.image){const ci=$e.get(Pt.image.toString());if(!ci)continue;if(ci.sdf){cn("SDF images are not supported in formatted text and will be ignored.");continue}fi=!1,Ht=ci.pixelRatio,ai=ym/Ht}const Gi=(Ue||yt)&&Pt.vertical,Xt=Pt.metrics.advance*Pt.scale/2,mi=Pt.metrics,Oi=Pt.rect;if(Oi===null)continue;yt&&Me.verticalizable&&(xi=Pt.image?Xt-Pt.metrics.width*Pt.scale/2:0);const Qi=Ue?[Pt.x+Xt,Pt.y]:[0,0];let hn=[0,0],nn=[0,0],ui=!1;Ue||(Gi?(nn=[Pt.x+Xt+Et[0],Pt.y+Et[1]-xi],ui=!0):hn=[Pt.x+Xt+Ne[0],Pt.y+Ne[1]-xi]);const en=Oi.w*Pt.scale/(Ht*(Pt.localGlyph?Ju:1)),An=Oi.h*Pt.scale/(Ht*(Pt.localGlyph?Ju:1));let fe,me,st,ft;if(Gi){const ci=Pt.y-at,Si=new Mt(-Xt,Xt-ci),dn=-Math.PI/2,mn=new Mt(...nn);fe=new Mt(-Xt+hn[0],hn[1]),fe._rotateAround(dn,Si)._add(mn),fe.x+=-ci+Xt,fe.y-=(mi.left-ai)*Pt.scale;const an=Pt.image?mi.advance*Pt.scale:Qs*Pt.scale,Yn=String.fromCodePoint(Pt.glyph);hE(Yn)?fe.x+=(1-ai)*Pt.scale:dE(Yn)?fe.x+=an-mi.height*Pt.scale+(-ai-1)*Pt.scale:fe.x+=Pt.image||mi.width+2*ai===Oi.w&&mi.height+2*ai===Oi.h?(an-An)/2:(an-(mi.height+2*ai)*Pt.scale)/2,me=new Mt(fe.x,fe.y-en),st=new Mt(fe.x+An,fe.y),ft=new Mt(fe.x+An,fe.y-en)}else{const ci=(mi.left-ai)*Pt.scale-Xt+hn[0],Si=(-mi.top-ai)*Pt.scale+hn[1],dn=ci+en,mn=Si+An;fe=new Mt(ci,Si),me=new Mt(dn,Si),st=new Mt(ci,mn),ft=new Mt(dn,mn)}if(bt){let ci;ci=Ue?new Mt(0,0):ui?new Mt(Et[0],Et[1]):new Mt(Ne[0],Ne[1]),fe._rotateAround(bt,ci),me._rotateAround(bt,ci),st._rotateAround(bt,ci),ft._rotateAround(bt,ci)}const Zt=new Mt(0,0),$t=new Mt(0,0);It.push({tl:fe,tr:me,bl:st,br:ft,texPrimary:vi,texSecondary:void 0,writingMode:Me.writingMode,glyphOffset:Qi,sectionIndex:Pt.sectionIndex,isSDF:fi,pixelOffsetTL:Zt,pixelOffsetBR:$t,minFontScaleX:0,minFontScaleY:0})}}return It}(0,a,T,d,p,y,o,n.allowVerticalPlacement),se=n.textSizeData;let ue=null;se.kind==="source"?(ue=[td*d.layout.get("text-size").evaluate(y,{},Y)*B.textScaleFactor],ue[0]>up&&cn(`${n.layerIds[0]}: Value for "text-size" is >= ${z_}. Reduce your "text-size".`)):se.kind==="composite"&&(ue=[td*B.compositeTextSizes[0].evaluate(y,{},Y)*B.textScaleFactor,td*B.compositeTextSizes[1].evaluate(y,{},Y)*B.textScaleFactor],(ue[0]>up||ue[1]>up)&&cn(`${n.layerIds[0]}: Value for "text-size" is >= ${z_}. Reduce your "text-size".`)),n.addSymbols(n.text,re,ue,T,p,y,M,e,i,A.lineStartIndex,A.lineLength,j,W,Y,K,!1);for(const Re of z)P[Re]=n.text.placedSymbolArray.length-1;return 4*re.length}function wx(n){for(const e in n)return n[e];return null}function ay(n,e,i,a,o,d,p,y,T,A){let M=p.top,z=p.bottom,P=p.left,j=p.right;if(ew(p)&&p.collisionPadding){const B=p.collisionPadding;P-=B[0],M-=B[1],j+=B[2],z+=B[3]}if(T){const B=new Mt(P,M),W=new Mt(j,M),Y=new Mt(P,z),K=new Mt(j,z),re=He(T);let se=new Mt(0,0);A&&(se=new Mt(A[0],A[1])),B._rotateAround(re,se),W._rotateAround(re,se),Y._rotateAround(re,se),K._rotateAround(re,se),P=Math.min(B.x,W.x,Y.x,K.x),j=Math.max(B.x,W.x,Y.x,K.x),M=Math.min(B.y,W.y,Y.y,K.y),z=Math.max(B.y,W.y,Y.y,K.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,P,M,j,z,y,a,o,d),n.length-1}function Tx(n){ew(n)&&n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function FE(n,e,i,a){const o=n.compareText;if(e in o){const d=o[e];for(let p=d.length-1;p>=0;p--)if(a.dist(d[p])<i)return!0}else o[e]=[];return o[e].push(a),!1}function Sw(n,e){const i=n.fovAboveCenter,a=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,o=(n._camera.position[2]*n.worldSize-a)/Math.cos(n._pitch),d=Math.sin(i)*o/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01));let p=Math.sin(n._pitch)*d+o;const y=o*(1/n._horizonShift);if(!n.elevation||n.elevation.exaggeration()===0){let T=Math.max(n.zoom-17,0);n.isOrthographic&&(T/=10),p*=1+T}return Math.min(1.01*p,y)}function D_(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),a=n.x*i,o=(n.x+1)*i,d=n.y*i,p=(n.y+1)*i,y=Ee(a),T=Ee(o),A=ve(d),M=ve(p),z=e.project(y,A),P=e.project(T,A),j=e.project(T,M),B=e.project(y,M);let W=Math.min(z.x,P.x,j.x,B.x),Y=Math.min(z.y,P.y,j.y,B.y),K=Math.max(z.x,P.x,j.x,B.x),re=Math.max(z.y,P.y,j.y,B.y);const se=i/16;function ue(Me,Ne,Fe,Ue,pt,$e){const yt=(Fe+pt)/2,It=(Ue+$e)/2,bt=e.project(Ee(yt),ve(It)),Et=Math.max(0,W-bt.x,Y-bt.y,bt.x-K,bt.y-re);W=Math.min(W,bt.x),K=Math.max(K,bt.x),Y=Math.min(Y,bt.y),re=Math.max(re,bt.y),Et>se&&(ue(Me,bt,Fe,Ue,yt,It),ue(bt,Ne,yt,It,pt,$e))}ue(z,P,a,d,o,d),ue(P,j,o,d,o,p),ue(j,B,o,p,a,p),ue(B,z,a,p,a,d),W-=se,Y-=se,K+=se,re+=se;const Re=1/Math.max(K-W,re-Y);return{scale:Re,x:W*Re,y:Y*Re,x2:K*Re,y2:re*Re,projection:e}}function Ew(n,{x:e,y:i},a=0){return new Mt(((e-a)*n.scale-n.x)*Vt,(i*n.scale-n.y)*Vt)}const UE=Se(new Float32Array(16));class hp{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new G(0,0)}projectTilePoint(e,i,a){return{x:e,y:i,z:0}}locationPoint(e,i,a,o=!0){return e._coordinatePoint(e.locationCoordinate(i,a),o)}pixelsPerMeter(e,i){return we(1,e)*i}pixelSpaceConversion(e,i,a){return 1}farthestPixelDistance(e){return Sw(e,e.pixelsPerMeter)}pointCoordinate(e,i,a,o){const d=e.horizonLineFromTop(!1),p=new Mt(i,Math.max(d,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,o))}pointCoordinate3D(e,i,a){const o=new Mt(i,a);if(e.elevation)return e.elevation.pointCoordinate(o);{const d=this.pointCoordinate(e,o.x,o.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const a=e.horizonLineFromTop();return i.y<a}createInversionMatrix(e,i){return UE}createTileMatrix(e,i,a){let o,d,p;const y=a.canonical,T=Se(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=D_(y,this);o=1,d=A.x+a.wrap*A.scale,p=A.y,ye(T,T,[o/A.scale,o/A.scale,e.pixelsPerMeter/i])}else o=i/e.zoomScale(y.z),d=(y.x+Math.pow(2,y.z)*a.wrap)*o,p=y.y*o;return xe(T,T,[d,p,0]),ye(T,T,[o/Vt,o/Vt,1]),T}upVector(e,i,a){return[0,0,1]}upVectorScale(e,i,a){return{metersToTile:1}}}class VE extends hp{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,a]=this.parallels=e.parallels||[29.5,45.5],o=Math.sin(He(i));this.n=(o+Math.sin(He(a)))/2,this.c=1+o*(2*this.n-o),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:a,c:o,r0:d}=this,p=He(e-this.center[0]),y=He(i),T=Math.sqrt(o-2*a*Math.sin(y))/a;return{x:T*Math.sin(p*a),y:T*Math.cos(p*a)-d,z:0}}unproject(e,i){const{n:a,c:o,r0:d}=this,p=d+i;let y=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(p));const T=He(this.center[0])*a;y=Be(y,-Math.PI-T,Math.PI-T);const A=Ie(J(y/a)+this.center[0],-180,180),M=Math.asin(Ie((o-(e*e+p*p)*a*a)/(2*a),-1,1)),z=Ie(J(M),-85.051129,Ce);return new G(A,z)}}const P_=1.340264,L_=-.081106,O_=893e-6,k_=.003796,oy=Math.sqrt(3)/2;class HE extends hp{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(oy*Math.sin(i)),o=a*a,d=o*o*o;return{x:.5*(e*Math.cos(a)/(oy*(P_+3*L_*o+d*(7*O_+9*k_*o)))/Math.PI+.5),y:1-.5*(a*(P_+L_*o+d*(O_+k_*o))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,o=a*a,d=o*o*o;for(let M,z,P,j=0;j<12&&(z=a*(P_+L_*o+d*(O_+k_*o))-i,P=P_+3*L_*o+d*(7*O_+9*k_*o),M=z/P,a=Ie(a-M,-Math.PI/3,Math.PI/3),o=a*a,d=o*o*o,!(Math.abs(M)<1e-12));++j);const p=oy*e*(P_+3*L_*o+d*(7*O_+9*k_*o))/Math.cos(a),y=Math.asin(Math.sin(a)/oy),T=Ie(180*p/Math.PI,-180,180),A=Ie(180*y/Math.PI,-85.051129,Ce);return new G(T,A)}}class qE extends hp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const a=360*(e-.5),o=Ie(360*(.5-i),-85.051129,Ce);return new G(a,o)}}const Ag=Math.PI/2;function ly(n){return Math.tan((Ag+n)/2)}class GE extends hp{constructor(e){super(e),this.center=e.center||[0,30];const[i,a]=this.parallels=e.parallels||[30,30];let o=He(i),d=He(a);this.southernCenter=o+d<0,this.southernCenter&&(o=-o,d=-d);const p=Math.cos(o),y=ly(o);this.n=o===d?Math.sin(o):Math.log(p/Math.cos(d))/Math.log(ly(d)/y),this.f=p*Math.pow(ly(o),this.n)/this.n}project(e,i){i=He(i),this.southernCenter&&(i=-i),e=He(e-this.center[0]);const a=1e-6,{n:o,f:d}=this;d>0?i<-Ag+a&&(i=-Ag+a):i>Ag-a&&(i=Ag-a);const p=d/Math.pow(ly(i),o);let y=p*Math.sin(o*e),T=d-p*Math.cos(o*e);return y=.5*(y/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:y,y:this.southernCenter?T:1-T,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:a,f:o}=this,d=o-i,p=Math.sign(d),y=Math.sign(a)*Math.sqrt(e*e+d*d);let T=Math.atan2(e,Math.abs(d))*p;d*a<0&&(T-=Math.PI*Math.sign(e)*p);const A=Ie(J(T/a)+this.center[0],-180,180),M=Ie(J(2*Math.atan(Math.pow(o/y,1/a))-Ag),-85.051129,Ce);return new G(A,this.southernCenter?-M:M)}}class Aw extends hp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:de(e),y:Te(i),z:0}}unproject(e,i){const a=Ee(e),o=ve(i);return new G(a,o)}}const Cw=He(Ce);class $E extends hp{project(e,i){const a=(i=He(i))*i,o=a*a;return{x:.5*((e=He(e))*(.8707-.131979*a+o*(o*(.003971*a-.001529*o)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+a*(.015085+o*(.028874*a-.044475-.005916*o)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,o=25,d=0,p=a*a;do{p=a*a;const A=p*p;d=(a*(1.007226+p*(.015085+A*(.028874*p-.044475-.005916*A)))-i)/(1.007226+p*(.045255+A*(.259866*p-.311325-.005916*11*A))),a=Ie(a-d,-Cw,Cw)}while(Math.abs(d)>1e-6&&--o>0);p=a*a;const y=Ie(J(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),T=J(a);return new G(y,T)}}const Rw=He(Ce);class ZE extends hp{project(e,i){i=He(i),e=He(e);const a=Math.cos(i),o=2/Math.PI,d=Math.acos(a*Math.cos(e/2)),p=Math.sin(d)/d,y=.5*(e*o+2*a*Math.sin(e/2)/p)||0,T=.5*(i+Math.sin(i)/p)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(e,i){let a=e=(2*e-.5)*Math.PI,o=i=(2*(1-i)-1)*Math.PI,d=25;const p=1e-6;let y=0,T=0;do{const A=Math.cos(o),M=Math.sin(o),z=2*M*A,P=M*M,j=A*A,B=Math.cos(a/2),W=Math.sin(a/2),Y=2*B*W,K=W*W,re=1-j*B*B,se=re?1/re:0,ue=re?Math.acos(A*B)*Math.sqrt(1/re):0,Re=.5*(2*ue*A*W+2*a/Math.PI)-e,Me=.5*(ue*M+o)-i,Ne=.5*se*(j*K+ue*A*B*P)+1/Math.PI,Fe=se*(Y*z/4-ue*M*W),Ue=.125*se*(z*W-ue*M*j*Y),pt=.5*se*(P*B+ue*K*A)+.5,$e=Fe*Ue-pt*Ne;y=(Me*Fe-Re*pt)/$e,T=(Re*Ue-Me*Ne)/$e,a=Ie(a-y,-Math.PI,Math.PI),o=Ie(o-T,-Rw,Rw)}while((Math.abs(y)>p||Math.abs(T)>p)&&--d>0);return new G(J(a),J(o))}}class Mw extends hp{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(He(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:a,cosPhi:o}=this;return{x:He(e)*o*a+.5,y:-Math.sin(He(i))/o*a+.5,z:0}}unproject(e,i){const{scale:a,cosPhi:o}=this,d=-(i-.5)/a,p=Ie(J((e-.5)/a)/o,-180,180),y=Math.asin(Ie(d*o,-1,1)),T=Ie(J(y),-85.051129,Ce);return new G(p,T)}}class WE extends Aw{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,a){const o=tm(e,i,a);return St(o,o,im(ha(a))),{x:o[0],y:o[1],z:o[2]}}locationPoint(e,i,a){const o=k(i.lat,i.lng),d=Ti([],o),p=a?e._centerAltitude+a:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Di(o,o,d,we(1,0)*Vt*p);const y=Se(new Float64Array(16));return ge(y,e.pixelMatrix,e.globeMatrix),St(o,o,y),new Mt(o[0],o[1])}pixelsPerMeter(e,i){return we(1,0)*i}pixelSpaceConversion(e,i,a){const o=we(1,e)*i,d=zi(we(1,45)*i,o,a);return this.pixelsPerMeter(e,i)/d}createTileMatrix(e,i,a){const o=Qg(ha(a.canonical));return ge(new Float64Array(16),e.globeMatrix,o)}createInversionMatrix(e,i){const{center:a}=e,o=im(ha(i));return Ae(o,o,He(a.lng)),Pe(o,o,He(a.lat)),ye(o,o,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(o)}pointCoordinate(e,i,a,o){return Qp(e,i,a,!0)||new ot(0,0)}pointCoordinate3D(e,i,a){const o=this.pointCoordinate(e,i,a,0);return[o.x,o.y,o.z]}isPointAboveHorizon(e,i){return!Qp(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(o,d){const p=o.cameraToCenterDistance,y=o._centerAltitude*d,T=o._camera,A=o._camera.forward(),M=Wt([],Ft([],A,-p),[0,0,y]),z=o.worldSize/(2*Math.PI),P=[0,0,-z],j=o.width/o.height,B=Math.tan(o.fovAboveCenter),W=Ft([],T.up(),B),Y=Ft([],T.right(),B*j),K=Ti([],Wt([],Wt([],A,W),Y)),re=[];let se;if(new bn(M,K).closestPointOnSphere(P,z,re)){const ue=Wt([],re,P),Re=In([],ue,M);se=Math.cos(o.fovAboveCenter)*wi(Re)}else{const ue=In([],M,P),Re=In([],P,M);Ti(Re,Re);const Me=wi(ue)-z;se=Math.sqrt(Me*(Me+2*z));const Ne=Math.acos(se/(z+Me))-Math.acos(Mi(A,Re));se*=Math.cos(Ne)}return 1.01*se}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Wh(e.zoom);if(a>0){const o=Sw(e,we(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return zi(i,o+d*(1-Math.cos(p)),Math.pow(a,10))}return i}upVector(e,i,a){return tm(i,a,e,1)}upVectorScale(e){return{metersToTile:$u(Xf(ha(e)))}}}function Iw(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new Aw(n);case"equirectangular":return new qE(n);case"naturalEarth":return new $E(n);case"equalEarth":return new HE(n);case"winkelTripel":return new ZE(n);case"albers":return i?new Mw(n):new VE(n);case"lambertConformalConic":return i?new Mw(n):new GE(n);case"globe":return new WE(n)}throw new Error(`Invalid projection name: ${n.name}`)}const XE=Tt.types,YE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function cy(n,e,i,a,o,d,p,y,T,A,M,z,P){const j=y?Math.min(up,Math.round(y[0])):0,B=y?Math.min(up,Math.round(y[1])):0;n.emplaceBack(e,i,Math.round(32*a),Math.round(32*o),d,p,(j<<1)+(T?1:0),B,16*A,16*M,256*z,256*P)}function uy(n,e,i){n.emplaceBack(e,i)}function hy(n,e,i,a,o,d,p){n.emplaceBack(e,i,a,o,d,p)}const dy=(n,e,i,a)=>{for(let o=0;o<e;o++)n.emplaceBack(i[0],i[1],i[2],a[0],a[1],a[2])};function fy(n,e,i,a,o){n.emplaceBack(e,i,a,o),n.emplaceBack(e,i,a,o),n.emplaceBack(e,i,a,o),n.emplaceBack(e,i,a,o)}function KE(n){for(const e of n.sections)if(kf(e.text))return!0;return!1}class Sx{constructor(e){this.layoutVertexArray=new Hd,this.indexArray=new is,this.programConfigurations=e,this.segments=new qn,this.dynamicLayoutVertexArray=new oo,this.opacityVertexArray=new Ou,this.placedSymbolArray=new Ko,this.iconTransitioningVertexArray=new Kr,this.globeExtVertexArray=new qd,this.zOffsetVertexArray=new Ao,this.orientationVertexArray=new lo}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,a,o,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,nE.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,YE,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,aE.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,iE.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,rE.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,sE.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||o)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}ri(Sx,"SymbolBuffers");class Ex{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new qn,this.collisionVertexArray=new Wp,this.collisionVertexArrayExt=new oo}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,oE.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,lE.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ri(Ex,"CollisionBuffers");class py{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Se([]),this.placementViewportMatrix=Se([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=sw(this.zoom,i["text-size"],this.worldview),this.iconSizeData=sw(this.zoom,i["icon-size"],this.worldview);const a=this.layers[0].layout,o=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.lut=e.lut,this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&o.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>al[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new Sx(new Ns(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Sx(new Ns(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Zf,this.lineVertexArray=new Fh,this.symbolInstances=new $f}calculateGlyphDependencies(e,i,a,o,d){for(const p of e){const y=p.codePointAt(0);if(y===void 0)break;if(i[y]=!0,o&&d&&y<=65535){const T=C_[p];T&&(i[T.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!rp(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,i,a,o){const d=this.layers[0],p=d.layout,y=this.projection.name==="globe",T=p.get("text-font"),A=p.get("text-field"),M=p.get("icon-image"),[z,P]=p.get("icon-size-scale-range"),j=Ie(i.scaleFactor||1,z,P),B=(A.value.kind!=="constant"||A.value.value instanceof ia&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),W=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,Y=p.get("symbol-sort-key");if(this.features=[],!B&&!W)return;const K=i.iconDependencies,re=i.glyphDependencies,se=i.availableImages,ue=new ir(this.zoom,{worldview:this.worldview});for(const{feature:Re,id:Me,index:Ne,sourceLayerIndex:Fe}of e){const Ue=d._featureFilter.needGeometry,pt=Ct(Re,Ue);if(!d._featureFilter.filter(ue,pt,a))continue;if(Ue||(pt.geometry=qt(Re,a,o)),y&&Re.type!==1&&a.z<=5){const Et=pt.geometry,Ot=.98078528056,dt=(At,at)=>Mi(tm(At.x,At.y,a,1),tm(at.x,at.y,a,1))<Ot;for(let At=0;At<Et.length;At++)Et[At]=nt(Et[At],dt)}let $e,yt;if(B){const Et=d.getValueAndResolveTokens("text-field",pt,a,se),Ot=ia.factory(Et);KE(Ot)&&(this.hasRTLText=!0),(!this.hasRTLText||Dh()==="unavailable"||this.hasRTLText&&$o.isParsed())&&($e=uE(Ot,d,pt))}if(W){const Et=d.getValueAndResolveTokens("icon-image",pt,a,se);yt=typeof Et=="string"?_a.build(Et):Et}if(!$e&&!yt)continue;const It=this.sortFeaturesByKey?Y.evaluate(pt,{},a):void 0,bt={id:Me,text:$e,icon:yt,index:Ne,sourceLayerIndex:Fe,geometry:pt.geometry,properties:Re.properties,type:XE[Re.type],sortKey:It};if(this.features.push(bt),yt){const Et=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Ot,iconSecondary:dt}=vw(yt,this.iconSizeData,Et["icon-size"],a,this.zoom,bt,this.pixelRatio,j,this.worldview),At=Ot.id.toString();if(K.has(At)?K.get(At).push(Ot):K.set(At,[Ot]),dt){this.hasAnySecondaryIcon=!0;const at=dt.id.toString();K.has(at)?K.get(at).push(dt):K.set(at,[dt])}}if($e){const Et=T.evaluate(pt,{},a).join(","),Ot=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(al.vertical)>=0;for(const dt of $e.sections)if(dt.image){const At=dt.image.getPrimary().scaleSelf(this.pixelRatio),at=At.id.toString(),tt=K.get(at)||[];tt.push(At),K.set(at,tt)}else{const At=Lf($e.toString()),at=dt.fontStack||Et,tt=re[at]=re[at]||{};this.calculateGlyphDependencies(dt.text,tt,Ot,this.allowVerticalPlacement,At)}}}if(p.get("symbol-placement")==="line"&&(this.features=function(Re){const Me={},Ne={},Fe=[];let Ue=0;function pt(bt){Fe.push(Re[bt]),Ue++}function $e(bt,Et,Ot){const dt=Ne[bt];return delete Ne[bt],Ne[Et]=dt,Fe[dt].geometry[0].pop(),Fe[dt].geometry[0]=Fe[dt].geometry[0].concat(Ot[0]),dt}function yt(bt,Et,Ot){const dt=Me[Et];return delete Me[Et],Me[bt]=dt,Fe[dt].geometry[0].shift(),Fe[dt].geometry[0]=Ot[0].concat(Fe[dt].geometry[0]),dt}function It(bt,Et,Ot){const dt=Ot?Et[0][Et[0].length-1]:Et[0][0];return`${bt}:${dt.x}:${dt.y}`}for(let bt=0;bt<Re.length;bt++){const Et=Re[bt],Ot=Et.geometry,dt=Et.text?Et.text.toString():null;if(!dt){pt(bt);continue}const At=It(dt,Ot),at=It(dt,Ot,!0);if(At in Ne&&at in Me&&Ne[At]!==Me[at]){const tt=yt(At,at,Ot),Nt=$e(At,at,Fe[tt].geometry);delete Me[At],delete Ne[at],Ne[It(dt,Fe[Nt].geometry,!0)]=Nt,Fe[tt].geometry=null}else At in Ne?$e(At,at,Ot):at in Me?yt(At,at,Ot):(pt(bt),Me[At]=Ue-1,Ne[at]=Ue-1)}return Fe.filter(bt=>bt.geometry)}(this.features)),p.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Re of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Re.id,this.elevationFeatures.length),this.elevationFeatures.push(Re)}}else p.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Re,Me)=>Re.sortKey-Me.sortKey)}update(e,i,a,o,d,p,y){this.text.programConfigurations.updatePaintArrays(e,i,d,a,o,p,y,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,d,a,o,p,y,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const a=Ze(e),o=1/a;let d=!1,p=!1;for(let y=0;y<this.symbolInstances.length;y++){const T=this.symbolInstances.get(y),A=Fi(1,0,0),M=Fi(0,1,0),{numHorizontalGlyphVertices:z,numVerticalGlyphVertices:P,numIconVertices:j,numVerticalIconVertices:B}=T,W=z>0||P>0,Y=j>0,K=this.elevationFeatures[T.elevationFeatureIndex];if(K){const re=new Mt(T.tileAnchorX,T.tileAnchorY),se=.075+K.pointElevation(re);T.zOffset!==se&&(i=!0,T.zOffset=se);const ue=K.computeSlopeNormal(re,o),Re=Sa(po(),Fi(0,0,1),ue);Sn(A,A,Re),Sn(M,M,Re),A[2]*=a,M[2]*=a,A[0]===1&&A[1]===0&&A[2]===0&&M[0]===0&&M[1]===1&&M[2]===0||(d=d||W,p=p||Y)}if(W&&(dy(this.text.orientationVertexArray,z,A,M),dy(this.text.orientationVertexArray,P,A,M)),Y){const{placedIconSymbolIndex:re,verticalPlacedIconSymbolIndex:se}=T;re>=0&&dy(this.icon.orientationVertexArray,j,A,M),se>=0&&dy(this.icon.orientationVertexArray,B,A,M)}}d||(this.text.orientationVertexArray=void 0),p||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(d,p,y)=>{a+=p,a>d.length&&d.resize(a);for(let T=-p;T<0;T++)d.emplace(T+a,y)},i=(d,p,y)=>{o+=p,o>d.length&&d.resize(o);for(let T=-p;T<0;T++)d.emplace(T+o,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,o=0;for(let d=0;d<this.symbolInstances.length;d++){const p=this.symbolInstances.get(d),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:T,numIconVertices:A}=p,M=p.zOffset,z=A>0;if((y>0||T>0)&&(e(this.text.zOffsetVertexArray,y,M),e(this.text.zOffsetVertexArray,T,M)),z){const{placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:j}=p;P>=0&&i(this.icon.zOffsetVertexArray,A,M),j>=0&&i(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Iw(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:o,y:d}of i)this.lineVertexArray.emplaceBack(o,d);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,o,d,p,y,T,A,M,z,P,j,B,W,Y){const K=e.indexArray,re=e.layoutVertexArray,se=e.globeExtVertexArray,ue=e.segments.prepareSegment(4*i.length,re,K,this.canOverlap?p.sortKey:void 0),Re=this.glyphOffsetArray.length,Me=ue.vertexLength,Ne=this.allowVerticalPlacement&&y===al.vertical?Math.PI/2:0,Fe=p.text&&p.text.sections;for(let pt=0;pt<i.length;pt++){const{tl:$e,tr:yt,bl:It,br:bt,texPrimary:Et,texSecondary:Ot,pixelOffsetTL:dt,pixelOffsetBR:At,minFontScaleX:at,minFontScaleY:tt,glyphOffset:Nt,isSDF:Pt,sectionIndex:vi}=i[pt],ai=ue.vertexLength,fi=Nt[1];if(cy(re,A.x,A.y,$e.x,fi+$e.y,Et.x,Et.y,a,Pt,dt.x,dt.y,at,tt),cy(re,A.x,A.y,yt.x,fi+yt.y,Et.x+Et.w,Et.y,a,Pt,At.x,dt.y,at,tt),cy(re,A.x,A.y,It.x,fi+It.y,Et.x,Et.y+Et.h,a,Pt,dt.x,At.y,at,tt),cy(re,A.x,A.y,bt.x,fi+bt.y,Et.x+Et.w,Et.y+Et.h,a,Pt,At.x,At.y,at,tt),T){const{x:Ht,y:xi,z:Gi}=T.anchor,[Xt,mi,Oi]=T.up;hy(se,Ht,xi,Gi,Xt,mi,Oi),hy(se,Ht,xi,Gi,Xt,mi,Oi),hy(se,Ht,xi,Gi,Xt,mi,Oi),hy(se,Ht,xi,Gi,Xt,mi,Oi),fy(e.dynamicLayoutVertexArray,Ht,xi,Gi,Ne)}else fy(e.dynamicLayoutVertexArray,A.x,A.y,A.z,Ne);if(Y){const Ht=Ot||Et;uy(e.iconTransitioningVertexArray,Ht.x,Ht.y),uy(e.iconTransitioningVertexArray,Ht.x+Ht.w,Ht.y),uy(e.iconTransitioningVertexArray,Ht.x,Ht.y+Ht.h),uy(e.iconTransitioningVertexArray,Ht.x+Ht.w,Ht.y+Ht.h)}K.emplaceBack(ai,ai+1,ai+2),K.emplaceBack(ai+1,ai+2,ai+3),ue.vertexLength+=4,ue.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Nt[0]),pt!==i.length-1&&vi===i[pt+1].sectionIndex||e.programConfigurations.populatePaintArrays(re.length,p,p.index,{},j,B,W,Fe&&Fe[vi],this.worldview)}const Ue=T?T.anchor:A;e.placedSymbolArray.emplaceBack(Ue.x,Ue.y,Ue.z,A.x,A.y,Re,this.glyphOffsetArray.length-Re,Me,M,z,A.segment,a?a[0]:0,a?a[1]:0,o[0],o[1],y,0,0,0,P,0)}_commitLayoutVertex(e,i,a,o,d,p,y){e.emplaceBack(i,a,o,d,p,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,i,a,o,d,p,y){const T=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),A=T.vertexLength,M=y.tileAnchorX,z=y.tileAnchorY;for(let j=0;j<4;j++)a.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,i,e.padding,y.zOffset),this._commitLayoutVertex(a.layoutVertexArray,o,d,p,M,z,new Mt(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,o,d,p,M,z,new Mt(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,o,d,p,M,z,new Mt(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,o,d,p,M,z,new Mt(e.x1,e.y2)),T.vertexLength+=4;const P=a.indexArray;P.emplaceBack(A,A+1),P.emplaceBack(A+1,A+2),P.emplaceBack(A+2,A+3),P.emplaceBack(A+3,A),T.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,a,o,d,p){for(let y=o;y<d;y++){const T=a.get(y),A=this.getSymbolInstanceTextSize(e,p,i,y);this._addCollisionDebugVertices(T,A,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,i,a,o,d,p){for(let y=o;y<d;y++){const T=a.get(y),A=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._addCollisionDebugVertices(T,A,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,i,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ex(Co,Gb.members,Kr),this.iconCollisionBox=new Ex(Co,Gb.members,Kr);const o=M_(this.iconSizeData,e),d=M_(this.textSizeData,e,a);for(let p=0;p<this.symbolInstances.length;p++){const y=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(d,e,i,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(d,e,i,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(o,e,i,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(o,e,i,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,i,a,o){const d=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:o),p=_x(this.textSizeData,e,d)/Qs;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,i,a){const o=this.icon.placedSymbolArray.get(a),d=_x(this.iconSizeData,e,o);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,i,a,o){e.emplaceBack(i,-a,-a,o),e.emplaceBack(i,a,-a,o),e.emplaceBack(i,a,a,o),e.emplaceBack(i,-a,a,o)}_updateTextDebugCollisionBoxes(e,i,a,o,d,p,y){for(let T=o;T<d;T++){const A=a.get(T),M=this.getSymbolInstanceTextSize(e,p,i,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,A.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,i,a,o,d,p,y){for(let T=o;T<d;T++){const A=a.get(T),M=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,A.padding,p.zOffset)}}updateCollisionDebugBuffers(e,i,a,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=M_(this.iconSizeData,e,o),p=M_(this.textSizeData,e,a);for(let y=0;y<this.symbolInstances.length;y++){const T=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(p,e,i,T.textBoxStartIndex,T.textBoxEndIndex,T,a),this._updateTextDebugCollisionBoxes(p,e,i,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T,a),this._updateIconDebugCollisionBoxes(d,e,i,T.iconBoxStartIndex,T.iconBoxEndIndex,T,o),this._updateIconDebugCollisionBoxes(d,e,i,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T,o)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,a,o,d,p,y,T,A){const M={};if(i<a){const{x1:z,y1:P,x2:j,y2:B,padding:W,projectedAnchorX:Y,projectedAnchorY:K,projectedAnchorZ:re,tileAnchorX:se,tileAnchorY:ue,featureIndex:Re}=e.get(i);M.textBox={x1:z,y1:P,x2:j,y2:B,padding:W,projectedAnchorX:Y,projectedAnchorY:K,projectedAnchorZ:re,tileAnchorX:se,tileAnchorY:ue},M.textFeatureIndex=Re}if(o<d){const{x1:z,y1:P,x2:j,y2:B,padding:W,projectedAnchorX:Y,projectedAnchorY:K,projectedAnchorZ:re,tileAnchorX:se,tileAnchorY:ue,featureIndex:Re}=e.get(o);M.verticalTextBox={x1:z,y1:P,x2:j,y2:B,padding:W,projectedAnchorX:Y,projectedAnchorY:K,projectedAnchorZ:re,tileAnchorX:se,tileAnchorY:ue},M.verticalTextFeatureIndex=Re}if(p<y){const{x1:z,y1:P,x2:j,y2:B,padding:W,projectedAnchorX:Y,projectedAnchorY:K,projectedAnchorZ:re,tileAnchorX:se,tileAnchorY:ue,featureIndex:Re}=e.get(p);M.iconBox={x1:z,y1:P,x2:j,y2:B,padding:W,projectedAnchorX:Y,projectedAnchorY:K,projectedAnchorZ:re,tileAnchorX:se,tileAnchorY:ue},M.iconFeatureIndex=Re}if(T<A){const{x1:z,y1:P,x2:j,y2:B,padding:W,projectedAnchorX:Y,projectedAnchorY:K,projectedAnchorZ:re,tileAnchorX:se,tileAnchorY:ue,featureIndex:Re}=e.get(T);M.verticalIconBox={x1:z,y1:P,x2:j,y2:B,padding:W,projectedAnchorX:Y,projectedAnchorY:K,projectedAnchorZ:re,tileAnchorX:se,tileAnchorY:ue},M.verticalIconFeatureIndex=Re}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const a=e.placedSymbolArray.get(i),o=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<o;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),a=Math.cos(e),o=[],d=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const T=this.symbolInstances.get(y);o.push(0|Math.round(i*T.tileAnchorX+a*T.tileAnchorY)),d.push(T.featureIndex)}return p.sort((y,T)=>o[y]-o[T]||d[T]-d[y]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:A}=a;o>=0&&this.addIndicesForPlacedSymbol(this.text,o),d>=0&&d!==o&&this.addIndicesForPlacedSymbol(this.text,d),p>=0&&p!==d&&p!==o&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let zw,Dw,Ax;ri(py,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),py.addDynamicAttributes=fy;class Pw{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:xo,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ri(Pw,"FormatSectionOverride",{omit:["defaultValue"]});const Cx=()=>Ax||(Ax={layout:zw||(zw=new Rr({"symbol-placement":new kt(qe.layout_symbol["symbol-placement"]),"symbol-spacing":new kt(qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new kt(qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Yt(qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new kt(qe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new kt(qe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new kt(qe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new kt(qe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new kt(qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new kt(qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new kt(qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Yt(qe.layout_symbol["icon-size"]),"icon-size-scale-range":new kt(qe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Yt(qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Yt(qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Yt(qe.layout_symbol["icon-image"]),"icon-image-use-theme":new kt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Yt(qe.layout_symbol["icon-rotate"]),"icon-padding":new kt(qe.layout_symbol["icon-padding"]),"icon-keep-upright":new kt(qe.layout_symbol["icon-keep-upright"]),"icon-offset":new Yt(qe.layout_symbol["icon-offset"]),"icon-anchor":new Yt(qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new kt(qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new kt(qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new kt(qe.layout_symbol["text-rotation-alignment"]),"text-field":new Yt(qe.layout_symbol["text-field"]),"text-font":new Yt(qe.layout_symbol["text-font"]),"text-size":new Yt(qe.layout_symbol["text-size"]),"text-size-scale-range":new kt(qe.layout_symbol["text-size-scale-range"]),"text-max-width":new Yt(qe.layout_symbol["text-max-width"]),"text-line-height":new Yt(qe.layout_symbol["text-line-height"]),"text-letter-spacing":new Yt(qe.layout_symbol["text-letter-spacing"]),"text-justify":new Yt(qe.layout_symbol["text-justify"]),"text-radial-offset":new Yt(qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new kt(qe.layout_symbol["text-variable-anchor"]),"text-anchor":new Yt(qe.layout_symbol["text-anchor"]),"text-max-angle":new kt(qe.layout_symbol["text-max-angle"]),"text-writing-mode":new kt(qe.layout_symbol["text-writing-mode"]),"text-rotate":new Yt(qe.layout_symbol["text-rotate"]),"text-padding":new kt(qe.layout_symbol["text-padding"]),"text-keep-upright":new kt(qe.layout_symbol["text-keep-upright"]),"text-transform":new Yt(qe.layout_symbol["text-transform"]),"text-offset":new Yt(qe.layout_symbol["text-offset"]),"text-allow-overlap":new kt(qe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new kt(qe.layout_symbol["text-ignore-placement"]),"text-optional":new kt(qe.layout_symbol["text-optional"]),visibility:new kt(qe.layout_symbol.visibility)})),paint:Dw||(Dw=new Rr({"icon-opacity":new Yt(qe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Yt(qe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Yt(qe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Yt(qe.paint_symbol["text-emissive-strength"]),"icon-color":new Yt(qe.paint_symbol["icon-color"]),"icon-halo-color":new Yt(qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Yt(qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Yt(qe.paint_symbol["icon-halo-blur"]),"icon-translate":new kt(qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new kt(qe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new kt(qe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Yt(qe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Yt(qe.paint_symbol["text-occlusion-opacity"]),"text-color":new Yt(qe.paint_symbol["text-color"],{runtimeType:Ra,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Yt(qe.paint_symbol["text-halo-color"]),"text-halo-width":new Yt(qe.paint_symbol["text-halo-width"]),"text-halo-blur":new Yt(qe.paint_symbol["text-halo-blur"]),"text-translate":new kt(qe.paint_symbol["text-translate"]),"text-translate-anchor":new kt(qe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new kt(qe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new kt(qe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new kt(qe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new kt(qe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Yt(qe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},Ax);class my extends aa{constructor(e,i,a,o){super(e,Cx(),i,a,o,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Se([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const o=[];for(const d of a)o.indexOf(d)<0&&o.push(d);this.layout._values["text-writing-mode"]=o}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,a,o){return this._saturation===e&&this._contrast===i&&this._brightnessMin===a&&this._brightnessMax===o||(this._colorAdjustmentMatrix=function(d,p,y,T){d=ar(d),p=Kn(p);const A=le(),M=d/3,z=1-2*M,P=[z,M,M,0,M,z,M,0,M,M,z,0,0,0,0,1],j=.5-.5*p,B=T-y;return ge(A,[B,0,0,0,0,B,0,0,0,0,B,0,y,y,y,1],[p,0,0,0,0,p,0,0,0,0,p,0,j,j,j,1]),ge(A,A,P),A}(e,i,a,o),this._saturation=e,this._contrast=i,this._brightnessMin=a,this._brightnessMax=o),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,a,o){const d=this.layout.get(e).evaluate(i,{},a,o),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Go(p.value)||!d?d:function(y,T){return T.replace(/{([^{}]+)}/g,(A,M)=>M in y?String(y[M]):"")}(i.properties,d)}createBucket(e){return new py(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Cx().paint.overridableProperties){if(!my.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),a=new Pw(i),o=new Ih(a,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new zu("source",o):new yl("composite",o,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new sc(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&my.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const a=e.get("text-field"),o=Cx().paint.properties[i];let d=!1;const p=y=>{for(const T of y)if(o.overrides&&o.overrides.hasOverride(T))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof ia)p(a.value.value.sections);else if(a.value.kind==="source"){const y=A=>{d||(A instanceof tn&&fs(A.value)===Ic?p(A.value.sections):A instanceof gu?p(A.sections):A.eachChild(y))},T=a.value;T._styleExpression&&y(T._styleExpression.expression)}return d}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,a){return{config:new Qc(this,{zoom:i,lut:a}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Lw,Ow,kw,Nw;var Rx=yn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function gy(n,e,i,a,o,d,p,y){const T=[n,e,1,i,a,1,o,d,1],A=[p,y,1],M=pe([],T),[z,P,j]=Ei(A,A,M);return ze(T,T,[z,0,0,0,P,0,0,0,j])}function jw(n,e,i,a,o,d,p,y){const T=function(A,M,z,P,j,B,W,Y){const K=gy(0,0,1,0,1,1,0,1),re=gy(A,M,z,P,j,B,W,Y);return ze(re,re,pe([],K))}(n,e,i,a,o,d,p,y);return[T[2]/T[8]/Vt,T[5]/T[8]/Vt]}function _y(n){return[n[0],Math.min(Math.max(n[1],-85.051129),Ce)]}class Bw extends fu{constructor(e,i,a,o){super(),this.id=e,this.dispatcher=a,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(o),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new eo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=jl(this.map._requestManager.transformRequest(this.url,uh.Image),(a,o)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Bl(a)):o&&(this.image=o instanceof HTMLImageElement?_o.getImageData(o):o,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new S_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new eo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof S_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],a=e[0][1];for(const d of e)d[1]>a&&(a=d[1]),d[1]<i&&(i=d[1]);const o=(a+i)/2;if(o>Ce?this.onNorthPole=!0:o<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const d=e.map(ot.fromLngLat);this.tileID=function(p){let y=1/0,T=1/0,A=-1/0,M=-1/0;for(const W of p)y=Math.min(y,W.x),T=Math.min(T,W.y),A=Math.max(A,W.x),M=Math.max(M,W.y);const z=Math.max(A-y,M-T),P=Math.max(0,Math.floor(-Math.log2(z))),j=Math.pow(2,P);let B=Math.floor((y+A)/2*j);return B>1&&(B-=1),new Rl(P,B,Math.floor((T+M)/2*j))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new eo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof S_||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const K in this.tiles){const re=this.tiles[K];re.state!=="loaded"&&(re.state="loaded",re.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=D_(new Rl(0,0,0),this.map.transform.projection),a=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(K){const re=K[1].x-K[0].x,se=K[1].y-K[0].y,ue=K[2].x-K[1].x,Re=K[2].y-K[1].y,Me=K[3].x-K[2].x,Ne=K[3].y-K[2].y,Fe=K[0].x-K[3].x,Ue=K[0].y-K[3].y,pt=re*Re-ue*se,$e=ue*Ne-Me*Re,yt=Me*Ue-Fe*Ne,It=Fe*se-re*Ue;return pt>0&&$e>0&&yt>0&&It>0||pt<0&&$e<0&&yt<0&&It<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const o=D_(this.tileID,this.map.transform.projection),[d,p,y,T]=this.coordinates.map(K=>{const re=o.projection.project(K[0],K[1]);return Ew(o,re)._round()});this.perspectiveTransform=jw(d.x,d.y,p.x,p.y,y.x,y.y,T.x,T.y);const A=this._boundsArray=new Kc;A.emplaceBack(d.x,d.y,0,0),A.emplaceBack(p.x,p.y,Vt,0),A.emplaceBack(T.x,T.y,0,Vt),A.emplaceBack(y.x,y.y,Vt,Vt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(A,Rx.members),this.boundsSegments=qn.simpleSegment(0,0,4,2);const M=[],z=[_y((P=this.coordinates)[0]),_y(P[1]),_y(P[2]),_y(P[3])];var P;const[j,B,W,Y]=function(K){let re=K[0][0],se=re,ue=K[0][1],Re=ue;for(let Me=1;Me<K.length;Me++)K[Me][0]<re?re=K[Me][0]:K[Me][0]>se&&(se=K[Me][0]),K[Me][1]<ue?ue=K[Me][1]:K[Me][1]>Re&&(Re=K[Me][1]);return[re,ue,se-re,Re-ue]}(z);{const K=new Kc,[re,se,ue,Re]=function(dt){let At=dt[0].x,at=At,tt=dt[0].y,Nt=tt;for(let Pt=1;Pt<dt.length;Pt++)dt[Pt].x<At?At=dt[Pt].x:dt[Pt].x>at&&(at=dt[Pt].x),dt[Pt].y<tt?tt=dt[Pt].y:dt[Pt].y>Nt&&(Nt=dt[Pt].y);return[At,tt,at-At,Nt-tt]}(a),Me=dt=>[(dt.x-re)/ue,(dt.y-se)/Re],[Ne,Fe,Ue,pt]=a.map(Me),$e=function(dt,At,at,tt,Nt,Pt,vi,ai){const fi=gy(0,0,1,0,1,1,0,1);return ze(fi,fi,pe([],gy(dt,At,at,tt,Nt,Pt,vi,ai)))}(Ne[0],Ne[1],Fe[0],Fe[1],Ue[0],Ue[1],pt[0],pt[1]);this.elevatedGlobePerspectiveTransform=jw(Ne[0],Ne[1],Fe[0],Fe[1],Ue[0],Ue[1],pt[0],pt[1]);const yt=(dt,At)=>{M.push(dt.lng);const at=Math.round((dt.lng-j)/W*Vt),tt=Math.round((dt.lat-B)/Y*Vt),Nt=Me(At),Pt=Ei([],[Nt[0],Nt[1],1],$e),vi=Math.round(Pt[0]/Pt[2]*Vt),ai=Math.round(Pt[1]/Pt[2]*Vt);K.emplaceBack(at,tt,vi,ai)},It=a[3].x-a[0].x,bt=a[3].y-a[0].y,Et=a[2].x-a[1].x,Ot=a[2].y-a[1].y;for(let dt=0;dt<65;dt++){const At=dt/64,at=[a[0].x+At*It,a[0].y+At*bt],tt=[a[1].x+At*Et,a[1].y+At*Ot],Nt=tt[0]-at[0],Pt=tt[1]-at[1];for(let vi=0;vi<65;vi++){const ai=vi/64,fi={x:at[0]+Nt*ai,y:at[1]+Pt*ai};yt(i.projection.unproject(fi.x,fi.y),fi)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(K,Rx.members)}{this.maxLongitudeTriangleSize=0;let K=[],re=new is;const se=(ue,Re,Me)=>{re.emplaceBack(ue,Re,Me);const Ne=M[ue],Fe=M[Re],Ue=M[Me],pt=Math.min(Math.min(Ne,Fe),Ue),$e=Math.max(Math.max(Ne,Fe),Ue)-pt;$e>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=$e),K.push(pt+$e/2)};for(let ue=0;ue<64;ue++)for(let Re=0;Re<64;Re++){const Me=65*ue+Re,Ne=Me+1,Fe=Me+65,Ue=Fe+1;se(Me,Fe,Ne),se(Ne,Fe,Ue)}[K,re]=function(ue,Re){const Me=Array.from({length:ue.length},(Ue,pt)=>pt);Me.sort((Ue,pt)=>ue[Ue]-ue[pt]);const Ne=[],Fe=new is;for(let Ue=0;Ue<Me.length;Ue++){const pt=Me[Ue];Ne.push(ue[pt]);const $e=3*pt,yt=$e+1;Fe.emplaceBack(Re.uint16[$e],Re.uint16[yt],Re.uint16[yt+1])}return[Ne,Fe]}(K,re),this.elevatedGlobeTrianglesCenterLongitudes=K,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(re)}this.elevatedGlobeSegments=qn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,W/Vt,0,Y/Vt,0,0,B,j,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,a=i.gl;!this._dirty||this.texture instanceof S_||(this.texture?this.texture.update(this.image):(this.texture=new ix(i,this.image,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let o=(d=e+180)+360*Math.round((a[0]-d)/360);var d;const p=new qn,y=(z,P)=>{p.segments.push({vertexOffset:0,primitiveOffset:z,vertexLength:i.segments[0].vertexLength,primitiveLength:P,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-o)<=T){const z=yr(a,0,a.length,o+T);return z===a.length||y(z,$i(a,z+1,a.length,o+360-T)-z),p}o<a[0]&&(o+=360);const A=$i(a,0,a.length,o-T);if(A===a.length)return y(0,a.length),p;y(0,A-0);const M=yr(a,A+1,a.length,o+T);return M!==a.length&&y(M,a.length-M),p}}const JE=(Math.pow(256,2)-1)/16907520;class Fw extends aa{constructor(e,i,a,o){super(e,{layout:kw||(kw=new Rr({visibility:new kt(qe.layout_raster.visibility)})),paint:Nw||(Nw=new Rr({"raster-opacity":new kt(qe.paint_raster["raster-opacity"]),"raster-color":new Ph(qe.paint_raster["raster-color"]),"raster-color-mix":new kt(qe.paint_raster["raster-color-mix"]),"raster-color-range":new kt(qe.paint_raster["raster-color-range"]),"raster-hue-rotate":new kt(qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new kt(qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new kt(qe.paint_raster["raster-brightness-max"]),"raster-saturation":new kt(qe.paint_raster["raster-saturation"]),"raster-contrast":new kt(qe.paint_raster["raster-contrast"]),"raster-resampling":new kt(qe.paint_raster["raster-resampling"]),"raster-fade-duration":new kt(qe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new kt(qe.paint_raster["raster-emissive-strength"]),"raster-array-band":new kt(qe.paint_raster["raster-array-band"]),"raster-elevation":new kt(qe.paint_raster["raster-elevation"]),"raster-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,o),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Bw&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[a,o]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(o)||a===this._curRampRange[0]&&o===this._curRampRange[1]||(this.colorRamp=Yd({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:o}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,o])}}let Uw,Vw,Hw,qw,Gw;class $w extends aa{constructor(e,i,a,o){super(e,{layout:Uw||(Uw=new Rr({visibility:new kt(qe["layout_raster-particle"].visibility)})),paint:Vw||(Vw=new Rr({"raster-particle-array-band":new kt(qe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new kt(qe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ph(qe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new kt(qe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new kt(qe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new kt(qe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new kt(qe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new kt(qe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,o),this._updateColorRamp(),this.lastInvalidatedAt=_o.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Yd({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=_o.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class QE extends aa{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Mx(n,e,i){const a=[0,0,1],o=mo([]);return ws(o,o,i?-He(n)+Math.PI:He(n)),As(o,o,-He(e)),Sn(a,a,o),Ti(a,a)}const Zw={None:0,Model:1,Symbol:2,FillExtrusion:4};class yy{constructor(e,i,a,o){this.message=(e?`${e}: `:"")+a,o&&(this.identifier=o),i!=null&&i.__line__&&(this.line=i.__line__)}}function Ix(n,e){const i=n.indexOf("://")===-1;try{return new URL(n,i&&e?"http://example.com":void 0),!0}catch{return!1}}class Ww{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Xw{constructor(){this.instancedDataArray=new Gs,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class zx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,a,o){this.tileToMeter=Ze(a);const d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:p,id:y,index:T,sourceLayerIndex:A}of e){const M=y??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),z=Ct(p,d);if(!this.layers[0]._featureFilter.filter(new ir(this.zoom,{worldview:this.worldview}),z,a))continue;const P={id:M,sourceLayerIndex:A,index:T,geometry:d?z.geometry:qt(p,a,o),properties:p.properties,type:p.type,patterns:{}},j=this.addFeature(P,P.geometry,z);j&&i.featureIndex.insert(p,P.geometry,T,A,this.index,this.instancesPerModel[j].instancedDataArray.length,Vt/32)}this.lookup=null}update(e,i,a,o){for(const d in this.instancesPerModel){const p=this.instancesPerModel[d];for(const y in e)p.idToFeaturesIndex.hasOwnProperty(y)&&(this.evaluate(p.features[p.idToFeaturesIndex[y]],e[y],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];for(const o of a.features){const d=this.layers[0],p=o.feature,y=this.canonical,T=d.paint.get("model-rotation").evaluate(p,{},y),A=d.paint.get("model-scale").evaluate(p,{},y),M=d.paint.get("model-translation").evaluate(p,{},y);Nn(o.rotation,T)&&Nn(o.scale,A)&&Nn(o.translation,M)||(this.evaluate(o,o.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,i,a,o){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const d=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(rp(this.activeReplacements,d))return!1;this.activeReplacements=d;let p=!1;for(const y in this.instancesPerModel){const T=this.instancesPerModel[y],A=T.instancedDataArray;for(const M of T.features){const z=M.instancedDataOffset,P=M.instancedDataCount;for(let j=0;j<P;j++){const B=16*(j+z);let W=A.float32[B+0];const Y=W>Vt;W=Y?W-Vt:W;const K=Math.floor(W),re=A.float32[B+1];let se=!1;for(const ue of this.activeReplacements)if(!hm(ue,a,Zw.Model,o)&&!(ue.min.x>K||K>ue.max.x||ue.min.y>re||re>ue.max.y)&&(se=tu(Xu(K,re,e.canonical,ue.footprintTileId.canonical),ue.footprint),se))break;A.float32[B]=se?W+Vt:W,p=p||se!==Y}}}return p}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,C5.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,a){const o=this.layers[0],d=o.layout.get("model-id").evaluate(a,{},this.canonical);if(!d)return cn(`modelId is not evaluated for layer ${o.id} and it is not going to get rendered.`),d;(Ix(d,!1)||this.styleDefinedModelURLs[d]!==void 0)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new Xw);const p=this.instancesPerModel[d],y=p.instancedDataArray,T=new Ww(a,y.length);for(const A of i)for(const M of A){if(M.x<0||M.x>=Vt||M.y<0||M.y>=Vt)continue;if(this.lookupDim!==0){const P=(this.lookupDim-1)/Vt,j=this.lookupDim*(M.y*P|0)+M.x*P|0;if(this.lookup){if(this.lookup[j]!==0)continue;this.lookup[j]=1}}this.instanceCount++;const z=y.length;y.resize(z+1),p.instancesEvaluatedElevation.push(0),y.float32[16*z]=M.x,y.float32[16*z+1]=M.y}return T.instancedDataCount=p.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(T),this.evaluate(T,{},p,!1)),d}getModelUris(){return this.modelUris}evaluate(e,i,a,o){const d=this.layers[0],p=e.feature,y=this.canonical,T=e.rotation=d.paint.get("model-rotation").evaluate(p,i,y),A=e.scale=d.paint.get("model-scale").evaluate(p,i,y),M=e.translation=d.paint.get("model-translation").evaluate(p,i,y),z=d.paint.get("model-color").evaluate(p,i,y);z.a=d.paint.get("model-color-mix-intensity").evaluate(p,i,y);const P=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]),this.maxScale=Math.max(Math.max(this.maxScale,A[0]),Math.max(A[1],A[2])),bb(P,T,A);const j=Math.round(100*z.a)+z.b/1.05;for(let B=0;B<e.instancedDataCount;++B){const W=e.instancedDataOffset+B,Y=16*W,K=a.instancedDataArray.float32;let re=0;o&&(re=K[Y+6]-a.instancesEvaluatedElevation[W]);const se=0|K[Y+1];K[Y]=(0|K[Y])+z.r/1.05,K[Y+1]=se+z.g/1.05,K[Y+2]=j,K[Y+3]=1/(y.z>10?this.tileToMeter:Ze(y,se)),K[Y+4]=M[0],K[Y+5]=M[1],K[Y+6]=M[2]+re,K[Y+7]=P[0],K[Y+8]=P[1],K[Y+9]=P[2],K[Y+10]=P[4],K[Y+11]=P[5],K[Y+12]=P[6],K[Y+13]=P[8],K[Y+14]=P[9],K[Y+15]=P[10],a.instancesEvaluatedElevation[W]=M[2]}}}let Yw,Kw;ri(zx,"ModelBucket",{omit:["layers"]}),ri(Xw,"PerModelAttributes"),ri(Ww,"ModelFeature");class Cg{constructor(e,i,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(e,i,a){const o=a||e.findDEMTileFor(i);if(!o||!o.dem)return;const d=o.dem,p=o.tileID,y=1<<i.canonical.z-p.canonical.z;return new Cg(o,d.dim/Vt/y,[(i.canonical.x/y-p.canonical.x)*d.dim,(i.canonical.y/y-p.canonical.y)*d.dim])}tileCoordToPixel(e,i){const a=i*this._scale+this._offset[1];return new Mt(Math.floor(e*this._scale+this._offset[0]),Math.floor(a))}getElevationAt(e,i,a,o){const d=e*this._scale+this._offset[0],p=i*this._scale+this._offset[1],y=Math.floor(d),T=Math.floor(p),A=this._dem;return o=!!o,a?zi(zi(A.get(y,T,o),A.get(y,T+1,o),p-T),zi(A.get(y+1,T,o),A.get(y+1,T+1,o),p-T),d-y):A.get(y,T,o)}getElevationAtPixel(e,i,a){return this._dem.get(e,i,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*we(1,e)*this._dem.stride}}const Dx=new Float32Array(262144),vm=new Uint8Array(262144);function Jw(n){let e=0;if(n.meshes)for(const i of n.meshes)e=Math.max(e,i.aabb.max[2]);if(n.children)for(const i of n.children)e=Math.max(e,Jw(i));return e}function Qw(n,e,i){if(n.meshes)for(const a of n.meshes){if(a.aabb.min[0]===1/0)continue;const o=Pi.applyTransform(a.aabb,n.matrix);i.insert(e,o.min[0],o.min[1],o.max[0],o.max[1])}if(n.children)for(const a of n.children)Qw(a,e,i)}const e3=["","wall","door","roof","window","lamp","logo"];class t3{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Jw(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Pi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Pi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=Pi.applyTransformFast(a.aabb,this.node.matrix),i.encapsulate(a.transformedAabb)),e++;this.aabb=i}return this.aabb}}class xy{constructor(e,i,a,o,d,p,y,T){this.id=a,this.layers=e,this.layerIds=this.layers.map(A=>A.fqid),this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id),this.modelTraits|=bg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,o&&(this.modelTraits|=bg.HasMapboxMeshFeatures),d&&(this.modelTraits|=bg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.worldview=T,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const A of i)this.nodesInfo.push(new t3(A)),Qw(A,y.featureIndexArray.length,y.grid),y.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,y.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const a of this.getNodesInfo()){const o=a.node;o.footprint&&i.push({footprint:o.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const a=i?this.stateDependentLayers:this.layers;if(!ea(e,this.states))for(const o of a)this.evaluate(o,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const a of i){const o=a.node;this.uploaded?this.updatePbrBuffer(o):sx(o,e,!0)}for(const a of i)J0(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),i=!0);return i}needsReEvaluation(e,i,a){const o=e.transform.projectionOptions,d=e.style.getBrightness(),p=this.brightness!==d;if(!this.uploaded||this.dirty||o.name!==this.projection.name||N_(a.paint.get("model-color").value,p)||N_(a.paint.get("model-color-mix-intensity").value,p)||N_(a.paint.get("model-roughness").value,p)||N_(a.paint.get("model-emissive-strength").value,p)||N_(a.paint.get("model-height-based-emissive-strength-multiplier").value,p)){this.projection=o,this.brightness=d;const y=this.getNodesInfo();for(const T of y)T.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),o=this.id.canonical;for(const d of a){const p=d.feature;d.evaluatedTranslation=i.paint.get("model-translation").evaluate(p,{},o),d.evaluatedScale=i.paint.get("model-scale").evaluate(p,{},o)}}evaluate(e,i){const a=this.getNodesInfo();for(const o of a){if(!o.node.meshes)continue;const d=o.feature,p=i&&i[d.id];if(ea(p,o.state))continue;o.state=structuredClone(p);const y=o.node.meshes&&o.node.meshes[0].featureData,T=o.evaluatedColor[2],A=o.evaluatedRMEA[2],M=this.id.canonical;if(o.hasTranslucentParts=!1,y){for(let z=0;z<e3.length;z++){const P=e3[z];P.length&&(d.properties.part=P);const j=e.paint.get("model-color").evaluate(d,p,M).toPremultipliedRenderColor(null),B=e.paint.get("model-color-mix-intensity").evaluate(d,p,M);o.evaluatedColor[z]=[j.r,j.g,j.b,B],o.evaluatedRMEA[z][0]=e.paint.get("model-roughness").evaluate(d,p,M),o.evaluatedRMEA[z][2]=e.paint.get("model-emissive-strength").evaluate(d,p,M),o.evaluatedRMEA[z][3]=j.a,o.emissionHeightBasedParams[z]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(d,p,M),!o.hasTranslucentParts&&j.a<1&&(o.hasTranslucentParts=!0)}delete d.properties.part,tA(o,T!==o.evaluatedColor[2]||A!==o.evaluatedRMEA[2],this.modelTraits)}else o.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(d,p,M);o.evaluatedTranslation=e.paint.get("model-translation").evaluate(d,p,M),o.evaluatedScale=e.paint.get("model-scale").evaluate(d,p,M),this.updatePbrBuffer(o.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,a,o){const d=e.findDEMTileFor(a);if(d&&(d.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;const p=Cg.create(e,a,d);if(!p)return;this.modelTraits&bg.HasMapboxMeshFeatures&&this.updateDEM(e,p,a,o);for(const y of this.getNodesInfo()){const T=y.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const A=T.footprint.vertices;let M=p.getElevationAt(A[0].x,A[0].y,!0,!0);for(let z=1;z<A.length;z++)M=Math.min(M,p.getElevationAt(A[z].x,A[z].y,!0,!0));T.elevation=M}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,a,o){let d=i._dem._modifiedForSources[o];if(d===void 0&&(i._dem._modifiedForSources[o]=[],d=i._dem._modifiedForSources[o]),d.includes(a.canonical))return;const p=i._dem.dim;d.push(a.canonical);let y=!1;for(const T of this.getNodesInfo()){const A=T.node;if(!A.footprint||!A.footprint.grid)continue;const M=A.footprint.grid,z=i.tileCoordToPixel(M.min.x,M.min.y),P=i.tileCoordToPixel(M.max.x,M.max.y),j=Math.min(Math.min(p-P.y,z.x),Math.min(z.y,p-P.x));if(j<0)continue;const B=Ie(j,2,5);let W=Math.max(0,z.x-B),Y=Math.max(0,z.y-B),K=Math.min(P.x+B,p-1),re=Math.min(P.y+B,p-1);for(let Me=Y;Me<=re;++Me)for(let Ne=W;Ne<=K;++Ne)vm[Me*p+Ne]=255;let se=0,ue=0;for(let Me=0;Me<M.cellsY;++Me)for(let Ne=0;Ne<M.cellsX;++Ne){if(!M.cells[Me*M.cellsX+Ne])continue;const Fe=i.tileCoordToPixel(M.min.x+Ne/M.xScale,M.min.y+Me/M.yScale),Ue=i.tileCoordToPixel(M.min.x+(Ne+1)/M.xScale,M.min.y+(Me+1)/M.yScale);for(let pt=Fe.y;pt<=Math.min(Ue.y+1,p-1);++pt)for(let $e=Fe.x;$e<=Math.min(Ue.x+1,p-1);++$e)vm[pt*p+$e]===255&&(vm[pt*p+$e]=0,se+=i.getElevationAtPixel($e,pt),ue++)}const Re=se/ue;W=Math.max(1,z.x-B),Y=Math.max(1,z.y-B),K=Math.min(P.x+B,p-2),re=Math.min(P.y+B,p-2),y=!0;for(let Me=Y;Me<=re;++Me)for(let Ne=W;Ne<=K;++Ne)vm[Me*p+Ne]===0&&(Dx[Me*p+Ne]=i._dem.set(Ne,Me,Re));for(let Me=1;Me<B;++Me){W=Math.max(1,z.x-Me),Y=Math.max(1,z.y-Me),K=Math.min(P.x+Me,p-2),re=Math.min(P.y+Me,p-2);for(let Ne=Y;Ne<=re;++Ne)for(let Fe=W;Fe<=K;++Fe){const Ue=Ne*p+Fe;if(vm[Ue]===255){let pt=0,$e=0,yt=-1,It=-1;for(let bt=-1;bt<=1;++bt)for(let Et=-1;Et<=1;++Et){const Ot=(Ne+bt)*p+Fe+Et;if(vm[Ot]>=Me)continue;const dt=Dx[Ot],At=Math.abs(dt);At>$e&&(pt=dt,$e=At,yt=Et,It=bt)}if($e>.1){const bt=1-(Me+.5*Math.abs(yt*It))/B;let Et=i._dem.get(Fe,Ne)+pt*bt;const Ot=i._dem.get(Fe+yt,Ne+It),dt=i._dem.get(Fe-yt,Ne-It,!0);(Et-Ot)*(Et-dt)>0&&(Et=(Ot+dt)/2),Dx[Ue]=i._dem.set(Fe,Ne,Et),vm[Ue]=Me}}}}}y&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=_o.now())}setFilter(e){this.filter=e?Oh(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new ir(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)J0(i.node),ax(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped());for(const o of this.getNodesInfo()){const d=o.node.footprint;o.hiddenByReplacement=!!d&&!a.find(p=>p.footprint===d)}}getHeightAtTileCoord(e,i){const a=[],o=[0,0,0],d=Se([]);for(const p of this.getNodesInfo()){const y=p.node.meshes[0],T=y.transformedAabb;if(e<T.min[0]||i<T.min[1]||e>T.max[0]||i>T.max[1])continue;if(p.node.hidden===!0)return{height:1/0,maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};te(d,p.node.matrix),o[0]=e,o[1]=i,St(o,o,d);const A=(o[0]-y.aabb.min[0])/(y.aabb.max[0]-y.aabb.min[0])*gm|0,M=Math.min(63,(o[1]-y.aabb.min[1])/(y.aabb.max[1]-y.aabb.min[1])*gm|0)*gm+Math.min(63,A),z=y.heightmap[M];if(!(z<0&&p.node.footprint))return p.hiddenByReplacement?void 0:{height:z,maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};if(p.node.footprint.grid.query(new Mt(e,i),new Mt(e,i),a),a.length>0)return{height:void 0,maxHeight:p.feature.properties.height,hidden:p.hiddenByReplacement,verticalScale:p.evaluatedScale[2]}}}}function N_(n,e){return n instanceof zu&&!n.isLightConstant&&e}function eA(n,e,i,a,o,d,p,y){let T=(61440&e|(61440&e)>>4)>>8,A=(3840&e|(3840&e)>>4)>>4,M=240&e|(240&e)>>4;i[3]>0&&(T=zi(T,255*i[0],i[3]),A=zi(A,255*i[1],i[3]),M=zi(M,255*i[2],i[3]));const z=T<<8|A,P=M<<8|Math.floor(255*a[3]),j=function(Me){const Ne=Ie(Me,0,2);return Math.min(Math.round(.5*Ne*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],B=Ie(o[0],0,1),W=Ie(o[1],0,1),Y=Ie(o[2],0,1),K=Ie(o[3],0,1);let re,se,ue,Re;if(B!==W&&p!==d&&W!==B){const Me=p-d;se=1/(Me*(W-B)),ue=-(d+Me*B)/(Me*(W-B));const Ne=Ie(o[4],-1,1);Re=Math.pow(10,Ne),re=255*Y<<8|255*K}else re=65535,se=0,ue=1,Re=1;if(n.emplaceBack(z,P,j,re,se,ue,Re),y){const Me=y.length;y.clear();for(let Ne=0;Ne<Me;Ne++)y.emplaceBack(z,P,j,re,se,ue,Re)}}function tA(n,e,i){const a=n.node;let o=0;const d=i&bg.HasMeshoptCompression;for(const p of a.meshes){if(a.lights&&a.lightMeshIndex===o||!p.featureData)continue;p.featureArray=new cc,p.featureArray.reserve(p.featureData.length);let y=e;for(const T of p.featureData){const A=d?65535&T:T>>16&65535,M=d?T>>16&65535:65535&T,z=(15&M)<8?15&M:0,P=n.evaluatedRMEA[z],j=n.evaluatedColor[z],B=n.emissionHeightBasedParams[z];let W;if(y&&z===2&&a.lights&&(W=new cc,W.resize(10*a.lights.length)),eA(p.featureArray,A,j,P,B,p.aabb.min[2],p.aabb.max[2],W),W&&y){y=!1;const Y=a.meshes[a.lightMeshIndex];Y.featureArray=W,Y.featureArray._trim()}}p.featureArray._trim(),o++}}function i3(n,e,i,a){const o=1<<n.z;e.lat=ve((a/Vt+n.y)/o),e.lng=Ee((i/Vt+n.x)/o)}function iA(n,e,i,a){const o=n.getNodesInfo()[e];if(!o||o.hiddenByReplacement||!o.node.meshes)return;let d=Number.MAX_VALUE;const p=o.node,y=i.tile,T=a.calculatePosMatrix(y.tileID.toUnwrapped(),a.worldSize),A=o.evaluatedScale;let M=0;a.elevation&&p.elevation&&(M=p.elevation*a.elevation.exaggeration()),xe(T,T,[(p.anchor?p.anchor[0]:0)*(A[0]-1),(p.anchor?p.anchor[1]:0)*(A[1]-1),M]),ye(T,T,A);const z=i.queryGeometry,P=z.isPointQuery()?z.screenBounds:z.screenGeometry,j=function(W){const Y=ge([],T,W.matrix);ge(Y,a.expandedFarZProjMatrix,Y);for(let K=0;K<W.meshes.length;++K){const re=W.meshes[K];if(K===W.lightMeshIndex)continue;const se=wb(P,a,Y,re.aabb);se!=null&&(d=Math.min(se,d))}if(W.children)for(const K of W.children)j(K)};if(j(p),d===Number.MAX_VALUE)return;const B=new G(0,0);return i3(y.tileID.canonical,B,o.node.anchor[0],o.node.anchor[1]),{intersectionZ:d,position:B,feature:o.feature}}ri(xy,"Tiled3dModelBucket",{omit:["layers"]}),ri(t3,"Tiled3dModelFeature");const nA={circle:class extends aa{constructor(n,e,i,a){super(n,{layout:Zh||(Zh=new Rr({"circle-sort-key":new Yt(qe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new kt(qe.layout_circle["circle-elevation-reference"]),visibility:new kt(qe.layout_circle.visibility)})),paint:Cl||(Cl=new Rr({"circle-radius":new Yt(qe.paint_circle["circle-radius"]),"circle-color":new Yt(qe.paint_circle["circle-color"]),"circle-blur":new Yt(qe.paint_circle["circle-blur"]),"circle-opacity":new Yt(qe.paint_circle["circle-opacity"]),"circle-translate":new kt(qe.paint_circle["circle-translate"]),"circle-translate-anchor":new kt(qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new kt(qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new kt(qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Yt(qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Yt(qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Yt(qe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new kt(qe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}createBucket(n){return new ms(n)}queryRadius(n){const e=n;return va("circle-radius",this,e)+va("circle-stroke-width",this,e)+tl(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,a,o,d,p,y){const T=il(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return n_(n,a,d,p,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,A)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,i){const a=ig(this);return{config:new Qc(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}is3D(n){return!n&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends aa{createBucket(n){return new s_(n)}constructor(n,e,i,a){super(n,{layout:T0||(T0=new Rr({visibility:new kt(qe.layout_heatmap.visibility)})),paint:S0||(S0=new Rr({"heatmap-radius":new Yt(qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Yt(qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new kt(qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ph(qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new kt(qe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Yd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(n){return va("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,a,o,d,p,y){const T=this.paint.get("heatmap-radius").evaluate(e,i);return n_(n,a,d,p,y,!0,!0,new Mt(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,i){return n==="heatmap"?{config:new Qc(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends aa{constructor(n,e,i,a){super(n,{layout:a_||(a_=new Rr({visibility:new kt(qe.layout_hillshade.visibility)})),paint:o_||(o_=new Rr({"hillshade-illumination-direction":new kt(qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new kt(qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new kt(qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new kt(qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new kt(qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new kt(qe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new kt(qe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}},fill:class extends aa{constructor(n,e,i,a){super(n,{layout:np||(np=new Rr({"fill-sort-key":new Yt(qe.layout_fill["fill-sort-key"]),visibility:new kt(qe.layout_fill.visibility),"fill-elevation-reference":new kt(qe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Yt(qe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:O0||(O0=new Rr({"fill-antialias":new kt(qe.paint_fill["fill-antialias"]),"fill-opacity":new Yt(qe.paint_fill["fill-opacity"]),"fill-color":new Yt(qe.paint_fill["fill-color"]),"fill-outline-color":new Yt(qe.paint_fill["fill-outline-color"]),"fill-translate":new kt(qe.paint_fill["fill-translate"]),"fill-translate-anchor":new kt(qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Yt(qe.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new kt(qe.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new kt(qe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Yt(qe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Yt(qe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Yt(qe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(n,e,i){return{config:new Qc(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new ug(n)}queryRadius(){return tl(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,a,o,d){return!n.queryGeometry.isAboveHorizon&&gs(fc(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),a)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(n){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return n!=null?e&&!n:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends aa{constructor(n,e,i,a){super(n,{layout:si||(si=new Rr({visibility:new kt(qe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new kt(qe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:yi||(yi=new Rr({"fill-extrusion-opacity":new kt(qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Yt(qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new kt(qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new kt(qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Yt(qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new kt(qe["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Yt(qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Yt(qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new kt(qe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new kt(qe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new kt(qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new kt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new kt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new kt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new kt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new kt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new kt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new kt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Yt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Yt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new kt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new kt(qe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new kt(qe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new kt(qe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Yt(qe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Yt(qe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new kt(qe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new ef(n)}queryRadius(){return tl(this.paint.get("fill-extrusion-translate"))}is3D(n){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,i,a,o,d,p,y,T){const A=il(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,i),z=this.paint.get("fill-extrusion-base").evaluate(e,i),P=[0,0],j=y&&d.elevation,B=d.elevation?d.elevation.exaggeration():1,W=n.tile.getBucket(this);if(j&&W instanceof ef){const ue=W.centroidVertexArray,Re=T+1;Re<ue.length&&(P[0]=ue.geta_centroid_pos0(Re),P[1]=ue.geta_centroid_pos1(Re))}if(P[0]===0&&P[1]===1)return!1;d.projection.name==="globe"&&(a=Xe([a],[new Mt(0,0),new Mt(Vt,Vt)],n.tileID.canonical).map(ue=>ue.polygon).flat());const Y=j?y:null,[K,re]=function(ue,Re,Me,Ne,Fe,Ue,pt,$e,yt,It,bt){return ue.projection.name==="globe"?function(Et,Ot,dt,At,at,tt,Nt,Pt,vi,ai,fi){const Ht=[],xi=[],Gi=Et.projection.upVectorScale(fi,Et.center.lat,Et.worldSize).metersToTile,Xt=[0,0,0,1],mi=[0,0,0,1],Oi=(hn,nn,ui,en)=>{hn[0]=nn,hn[1]=ui,hn[2]=en,hn[3]=1},Qi=De();dt>0&&(dt+=Qi),At+=Qi;for(const hn of Ot){const nn=[],ui=[];for(const en of hn){const An=en.x+at.x,fe=en.y+at.y,me=Et.projection.projectTilePoint(An,fe,fi),st=Et.projection.upVector(fi,en.x,en.y);let ft=dt,Zt=At;if(Nt){const $t=un(An,fe,dt,At,Nt,Pt,vi,ai);ft+=$t.base,Zt+=$t.top}dt!==0?Oi(Xt,me.x+st[0]*Gi*ft,me.y+st[1]*Gi*ft,me.z+st[2]*Gi*ft):Oi(Xt,me.x,me.y,me.z),Oi(mi,me.x+st[0]*Gi*Zt,me.y+st[1]*Gi*Zt,me.z+st[2]*Gi*Zt),St(Xt,Xt,tt),St(mi,mi,tt),nn.push(new Ut(Xt[0],Xt[1],Xt[2])),ui.push(new Ut(mi[0],mi[1],mi[2]))}Ht.push(nn),xi.push(ui)}return[Ht,xi]}(ue,Re,Me,Ne,Fe,Ue,pt,$e,yt,It,bt):pt?function(Et,Ot,dt,At,at,tt,Nt,Pt,vi){const ai=[],fi=[],Ht=[0,0,0,1];for(const xi of Et){const Gi=[],Xt=[];for(const mi of xi){const Oi=mi.x+At.x,Qi=mi.y+At.y,hn=un(Oi,Qi,Ot,dt,tt,Nt,Pt,vi);Ht[0]=Oi,Ht[1]=Qi,Ht[2]=hn.base,Ht[3]=1,js(Ht,Ht,at),Ht[3]=Math.max(Ht[3],1e-5);const nn=new Ut(Ht[0]/Ht[3],Ht[1]/Ht[3],Ht[2]/Ht[3]);Ht[0]=Oi,Ht[1]=Qi,Ht[2]=hn.top,Ht[3]=1,js(Ht,Ht,at),Ht[3]=Math.max(Ht[3],1e-5);const ui=new Ut(Ht[0]/Ht[3],Ht[1]/Ht[3],Ht[2]/Ht[3]);Gi.push(nn),Xt.push(ui)}ai.push(Gi),fi.push(Xt)}return[ai,fi]}(Re,Me,Ne,Fe,Ue,pt,$e,yt,It):function(Et,Ot,dt,At,at){const tt=[],Nt=[],Pt=at[8]*Ot,vi=at[9]*Ot,ai=at[10]*Ot,fi=at[11]*Ot,Ht=at[8]*dt,xi=at[9]*dt,Gi=at[10]*dt,Xt=at[11]*dt;for(const mi of Et){const Oi=[],Qi=[];for(const hn of mi){const nn=hn.x+At.x,ui=hn.y+At.y,en=at[0]*nn+at[4]*ui+at[12],An=at[1]*nn+at[5]*ui+at[13],fe=at[2]*nn+at[6]*ui+at[14],me=at[3]*nn+at[7]*ui+at[15],st=en+Pt,ft=An+vi,Zt=fe+ai,$t=Math.max(me+fi,1e-5),ci=en+Ht,Si=An+xi,dn=fe+Gi,mn=Math.max(me+Xt,1e-5);Oi.push(new Ut(st/$t,ft/$t,Zt/$t)),Qi.push(new Ut(ci/mn,Si/mn,dn/mn))}tt.push(Oi),Nt.push(Qi)}return[tt,Nt]}(Re,Me,Ne,Fe,Ue)}(d,a,z,M,A,p,Y,P,B,d.center.lat,n.tileID.canonical),se=n.queryGeometry;return function(ue,Re,Me){let Ne=1/0;gs(Me,Re)&&(Ne=di(Me,Re[0]));for(let Fe=0;Fe<Re.length;Fe++){const Ue=Re[Fe],pt=ue[Fe];for(let $e=0;$e<Ue.length-1;$e++){const yt=Ue[$e],It=[yt,Ue[$e+1],pt[$e+1],pt[$e],yt];Ga(Me,It)&&(Ne=Math.min(Ne,di(Me,It)))}}return Ne!==1/0&&Ne}(K,re,se.isPointQuery()?se.screenBounds:se.screenGeometry)}},building:class extends aa{constructor(n,e,i,a){super(n,{layout:Db||(Db=new Rr({visibility:new kt(qe.layout_building.visibility),"building-facade":new Yt(qe.layout_building["building-facade"]),"building-facade-floors":new Yt(qe.layout_building["building-facade-floors"]),"building-facade-unit-width":new Yt(qe.layout_building["building-facade-unit-width"]),"building-facade-window":new Yt(qe.layout_building["building-facade-window"]),"building-roof-shape":new Yt(qe.layout_building["building-roof-shape"]),"building-height":new Yt(qe.layout_building["building-height"]),"building-base":new Yt(qe.layout_building["building-base"]),"building-flood-light-wall-radius":new Yt(qe.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Yt(qe.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Yt(qe.layout_building["building-flip-roof-orientation"])})),paint:Pb||(Pb=new Rr({"building-opacity":new kt(qe.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new kt(qe.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new kt(qe.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new kt(qe.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new kt(qe.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new kt(qe.paint_building["building-vertical-scale"]),"building-cast-shadows":new kt(qe.paint_building["building-cast-shadows"]),"building-color":new Yt(qe.paint_building["building-color"]),"building-emissive-strength":new Yt(qe.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new kt(qe.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new kt(qe.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new kt(qe.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new kt(qe.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new kt(qe.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new zb(n)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(n){return!0}},line:class extends aa{constructor(n,e,i,a){const o=Hb();super(n,o,e,i,a),o.layout&&(this.layout=new Zc(o.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Kl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if(A_)return A_;const i=Hb();return A_=new eE(i.paint.properties["line-width"].specification),A_.useIntegerZoom=!0,A_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new ux(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,i){const a=Ub(this);return{config:new Qc(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}queryRadius(n){const e=n,i=qb(va("line-width",this,e),va("line-gap-width",this,e)),a=va("line-offset",this,e);return i/2+Math.abs(a)+tl(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,a,o,d){if(n.queryGeometry.isAboveHorizon)return!1;const p=fc(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),y=n.pixelToTileUnitsFactor/2*qb(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),T=this.paint.get("line-offset").evaluate(e,i);return T&&(a=function(A,M){const z=[],P=new Mt(0,0);for(let j=0;j<A.length;j++){const B=A[j],W=[];for(let Y=0;Y<B.length;Y++){const K=B[Y],re=B[Y+1],se=Y===0?P:K.sub(B[Y-1])._unit()._perp(),ue=Y===B.length-1?P:re.sub(K)._unit()._perp(),Re=se._add(ue)._unit();Re._mult(1/(Re.x*ue.x+Re.y*ue.y)),W.push(Re._mult(M)._add(K))}z.push(W)}return z}(a,T*n.pixelToTileUnitsFactor)),function(A,M,z){for(let P=0;P<M.length;P++){const j=M[P];if(A.length>=3){for(let B=0;B<j.length;B++)if(_s(A,j[B]))return!0}if(ca(A,j,z))return!0}return!1}(p,a,y)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(n){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:my,background:class extends aa{constructor(n,e,i,a){super(n,{layout:Lw||(Lw=new Rr({visibility:new kt(qe.layout_background.visibility)})),paint:Ow||(Ow=new Rr({"background-pitch-alignment":new kt(qe.paint_background["background-pitch-alignment"]),"background-color":new kt(qe.paint_background["background-color"]),"background-pattern":new kt(qe.paint_background["background-pattern"]),"background-opacity":new kt(qe.paint_background["background-opacity"]),"background-emissive-strength":new kt(qe.paint_background["background-emissive-strength"]),"background-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}is3D(n){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Fw,"raster-particle":$w,sky:class extends aa{constructor(n,e,i,a){super(n,{layout:Hw||(Hw=new Rr({visibility:new kt(qe.layout_sky.visibility)})),paint:qw||(qw=new Rr({"sky-type":new kt(qe.paint_sky["sky-type"]),"sky-atmosphere-sun":new kt(qe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new kt(qe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new kt(qe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new kt(qe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ph(qe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new kt(qe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new kt(qe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new kt(qe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Yd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),o=!a,d=n.style.light,p=d.properties.get("position");return o&&d.properties.get("anchor")==="viewport"&&cn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),o?Mx(p.azimuthal,90-p.polar,e):Mx(a[0],90-a[1],e)}const i=this.paint.get("sky-gradient-center");return Mx(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends aa{constructor(n,e,i,a){super(n,{paint:Gw||(Gw=new Rr({}))},e,null)}},model:class extends aa{constructor(n,e,i,a){super(n,{layout:Yw||(Yw=new Rr({visibility:new kt(qe.layout_model.visibility),"model-id":new Yt(qe.layout_model["model-id"])})),paint:Kw||(Kw=new Rr({"model-opacity":new Yt(qe.paint_model["model-opacity"]),"model-rotation":new Yt(qe.paint_model["model-rotation"]),"model-scale":new Yt(qe.paint_model["model-scale"]),"model-translation":new Yt(qe.paint_model["model-translation"]),"model-color":new Yt(qe.paint_model["model-color"]),"model-color-mix-intensity":new Yt(qe.paint_model["model-color-mix-intensity"]),"model-type":new kt(qe.paint_model["model-type"]),"model-cast-shadows":new kt(qe.paint_model["model-cast-shadows"]),"model-receive-shadows":new kt(qe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new kt(qe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Yt(qe.paint_model["model-emissive-strength"]),"model-roughness":new Yt(qe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Yt(qe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new kt(qe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new kt(qe.paint_model["model-front-cutoff"]),"model-elevation-reference":new kt(qe.paint_model["model-elevation-reference"]),"model-color-use-theme":new Yt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new zx(n)}getProgramIds(){return["model"]}is3D(n){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof xy?Vt-1:0}queryIntersectsFeature(n,e,i,a,o,d){if(!this.modelManager)return!1;const p=this.modelManager,y=n.tile.getBucket(this);if(!(y&&y instanceof zx))return!1;for(const T in y.instancesPerModel){const A=y.instancesPerModel[T],M=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(A.idToFeaturesIndex.hasOwnProperty(M)){const z=A.features[A.idToFeaturesIndex[M]],P=p.getModel(T,this.scope);if(!P)return!1;let j=le();const B=new G(0,0),W=y.canonical;let Y=Number.MAX_VALUE;for(let K=0;K<z.instancedDataCount;++K){const re=16*(z.instancedDataOffset+K),se=A.instancedDataArray.float32,ue=[se[re+4],se[re+5],se[re+6]];i3(W,B,se[re],0|se[re+1]),Tb(j,P,d,B,z.rotation,z.scale,ue,!1,!1,!1),d.projection.name==="globe"&&(j=rx(j,d));const Re=ge([],d.projMatrix,j),Me=n.queryGeometry,Ne=wb(Me.isPointQuery()?Me.screenBounds:Me.screenGeometry,d,Re,P.aabb);Ne!=null&&(Y=Math.min(Ne,Y))}return Y!==Number.MAX_VALUE&&Y}}return!1}_handleOverridablePaintPropertyUpdate(n,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof yl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends aa{constructor(n,e,i,a){super(n,{layout:k0||(k0=new Rr({"clip-layer-types":new kt(qe.layout_clip["clip-layer-types"]),"clip-layer-scope":new kt(qe.layout_clip["clip-layer-scope"])})),paint:N0||(N0=new Rr({}))},e,i,a)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new hg(n)}is3D(n){return!0}}},Px=new Vn(0,0,0),Lx={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},Ox={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},vy={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},rA={PAINT_ORDER_FILL_AND_STROKE:1},j_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},n3={MASK_TYPE_LUMINANCE:1};function sA(n,e,i){n===1&&e.icons.push(function(a,o){return function(d){if(d.usvg_tree.height||(d.usvg_tree.height=d.usvg_tree.width),!d.metadata)return d;const{metadata:p}=d;if(p.content_area){const{content_area:y}=p;y.left==null&&(y.left=0),y.top==null&&(y.top=y.left),y.width==null&&(y.width=d.usvg_tree.width),y.height==null&&(y.height=y.width)}if(p.text_placeholder){const{text_placeholder:y}=p;y.top==null&&(y.top=y.left),y.height==null&&(y.height=y.width)}return p.stretch_x&&p.stretch_x.length&&r3(p,"x"),p.stretch_y&&p.stretch_y.length&&r3(p,"y"),d}(a.readFields(aA,{name:void 0},o))}(i,i.readVarint()+i.pos))}function r3(n,e){const i=[],a=n[`stretch_${e}`];let o=null;for(let d=0;d<a.length;d++)o===null?o=i.length===0?a[0]:i[i.length-1][1]+a[d]:(i.push([o,o+a[d]]),o=null);n[`stretch_${e}_areas`]=i}function aA(n,e,i){n===1?e.name=i.readString():n===2?e.metadata=function(a,o){return a.readFields(oA,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},o)}(i,i.readVarint()+i.pos):n===3&&(e.usvg_tree=function(a,o){return a.readFields(uA,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},o)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function oA(n,e,i){n===1?e.stretch_x=i.readPackedVarint():n===2?e.stretch_y=i.readPackedVarint():n===3?e.content_area=s3(i,i.readVarint()+i.pos):n===4?e.variables.push(function(a,o){return a.readFields(cA,{name:void 0},o)}(i,i.readVarint()+i.pos)):n===5&&(e.text_placeholder=s3(i,i.readVarint()+i.pos))}function s3(n,e){return n.readFields(lA,{},e)}function lA(n,e,i){n===1?e.left=i.readVarint():n===2?e.width=i.readVarint():n===3?e.top=i.readVarint():n===4&&(e.height=i.readVarint())}function cA(n,e,i){n===1?e.name=i.readString():n===2&&(e.rgb_color=Ty(i.readVarint()),e.value="rgb_color")}function uA(n,e,i){n===1?e.width=e.height=i.readVarint():n===2?e.height=i.readVarint():n===3?e.children.push(by(i,i.readVarint()+i.pos)):n===4?e.linear_gradients.push(function(a,o){return a.readFields(_A,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},o)}(i,i.readVarint()+i.pos)):n===5?e.radial_gradients.push(function(a,o){return a.readFields(xA,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},o)}(i,i.readVarint()+i.pos)):n===7?e.clip_paths.push(function(a,o){return a.readFields(vA,{children:[]},o)}(i,i.readVarint()+i.pos)):n===8&&e.masks.push(function(a,o){const d=a.readFields(bA,{left:0,width:20,mask_type:n3.MASK_TYPE_LUMINANCE,children:[]},o);return d.height==null&&(d.height=d.width),d.top==null&&(d.top=d.left),d}(i,i.readVarint()+i.pos))}function by(n,e){return n.readFields(hA,{},e)}function hA(n,e,i){n===1?(e.group=function(a,o){return a.readFields(dA,{opacity:255,children:[]},o)}(i,i.readVarint()+i.pos),e.node="group"):n===2&&(e.path=function(a,o){return a.readFields(pA,{paint_order:1,commands:[],step:1,diffs:[],rule:Lx.PATH_RULE_NON_ZERO},o)}(i,i.readVarint()+i.pos),e.node="path")}function dA(n,e,i){n===1?e.transform=wy(i,i.readVarint()+i.pos):n===2?e.opacity=i.readVarint():n===5?e.clip_path_idx=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(by(i,i.readVarint()+i.pos))}function wy(n,e){return n.readFields(fA,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function fA(n,e,i){n===1?e.sx=i.readFloat():n===2?e.ky=i.readFloat():n===3?e.kx=i.readFloat():n===4?e.sy=i.readFloat():n===5?e.tx=i.readFloat():n===6&&(e.ty=i.readFloat())}function pA(n,e,i){n===1?e.fill=function(a,o){return a.readFields(mA,{rgb_color:Px,paint:"rgb_color",opacity:255},o)}(i,i.readVarint()+i.pos):n===2?e.stroke=function(a,o){return a.readFields(gA,{rgb_color:Px,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},o)}(i,i.readVarint()+i.pos):n===3?e.paint_order=i.readVarint():n===5?i.readPackedVarint(e.commands):n===6?e.step=i.readFloat():n===7?i.readPackedSVarint(e.diffs):n===8&&(e.rule=i.readVarint())}function mA(n,e,i){n===1?(e.rgb_color=Ty(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5&&(e.opacity=i.readVarint())}function Ty(n){return new Vn((n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1)}function gA(n,e,i){n===1?(e.rgb_color=Ty(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5?i.readPackedFloat(e.dasharray):n===6?e.dashoffset=i.readFloat():n===7?e.miterlimit=i.readFloat():n===8?e.opacity=i.readVarint():n===9?e.width=i.readFloat():n===10?e.linecap=i.readVarint():n===11&&(e.linejoin=i.readVarint())}function _A(n,e,i){n===1?e.transform=wy(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(a3(i,i.readVarint()+i.pos)):n===4?e.x1=i.readFloat():n===5?e.y1=i.readFloat():n===6?e.x2=i.readFloat():n===7&&(e.y2=i.readFloat())}function a3(n,e){return n.readFields(yA,{offset:0,opacity:255,rgb_color:Px},e)}function yA(n,e,i){n===1?e.offset=i.readFloat():n===2?e.opacity=i.readVarint():n===3&&(e.rgb_color=Ty(i.readVarint()))}function xA(n,e,i){n===1?e.transform=wy(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(a3(i,i.readVarint()+i.pos)):n===4?e.cx=i.readFloat():n===5?e.cy=i.readFloat():n===6?e.r=i.readFloat():n===7?e.fx=i.readFloat():n===8?e.fy=i.readFloat():n===9&&(e.fr=i.readFloat())}function vA(n,e,i){n===1?e.transform=wy(i,i.readVarint()+i.pos):n===2?e.clip_path_idx=i.readVarint():n===3&&e.children.push(by(i,i.readVarint()+i.pos))}function bA(n,e,i){n===1?e.left=e.top=i.readFloat():n===2?e.width=e.height=i.readFloat():n===3?e.top=i.readFloat():n===4?e.height=i.readFloat():n===5?e.mask_type=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(by(i,i.readVarint()+i.pos))}class wA{static calculate(e={},i=[]){const a=new Map,o=new Map;if(Object.keys(e).length===0)return a;i.forEach(d=>{o.set(d.name,d.rgb_color||new Vn(0,0,0))});for(const[d,p]of Object.entries(e))o.has(d)?a.set(o.get(d).toString(),p):console.warn(`Ignoring unknown image variable "${d}"`);return a}}function Rg(n,e=255,i){const a=e/255,o=n.toString(),d=i.has(o)?i.get(o).clone():n.clone();return d.a*=a,d.toString()}function B_(n,e){if(!Ba()){const i=document.createElement("canvas");return i.width=n,i.height=e,i}return new OffscreenCanvas(n,e)}function TA(n,e){const i=wA.calculate(e.params,n.metadata?n.metadata.variables:[]),a=n.usvg_tree,o=a.width,d=a.height,p=e.transform?e.transform:new DOMMatrix,y=Math.max(1,Math.round(o*p.a)),T=Math.max(1,Math.round(d*p.d)),A=new DOMMatrix([y/o,0,0,T/d,0,0]),M=B_(y,T).getContext("2d");return kx(M,A,a,a,i),M.getImageData(0,0,y,T)}function kx(n,e,i,a,o){for(const d of a.children)o3(n,e,i,d,o)}function o3(n,e,i,a,o){a.group?(n.save(),function(d,p,y,T,A){const M=T.mask_idx!=null?y.masks[T.mask_idx]:null,z=T.clip_path_idx!=null?y.clip_paths[T.clip_path_idx]:null;if(T.transform&&(p=Mg(T.transform).preMultiplySelf(p)),!function(B,W,Y){return B.opacity!==255||W||Y}(T,z!=null,M!=null))return void kx(d,p,y,T,A);const P=B_(d.canvas.width,d.canvas.height),j=P.getContext("2d");kx(j,p,y,T,A),z&&p3(j,p,y,z),M&&m3(j,p,y,M,A),d.globalAlpha=T.opacity/255,d.drawImage(P,0,0)}(n,e,i,a.group,o),n.restore()):a.path&&(n.save(),function(d,p,y,T,A){d.setTransform(p),T.paint_order===rA.PAINT_ORDER_FILL_AND_STROKE?(l3(d,y,T,A),u3(d,y,T,A)):(u3(d,y,T,A),l3(d,y,T,A))}(n,e,i,a.path,o),n.restore())}function l3(n,e,i,a){const o=i.fill;if(!o)return;const d=o.opacity/255;switch(n.save(),n.beginPath(),g3(i,n),o.paint){case"rgb_color":n.fillStyle=Rg(o.rgb_color,o.opacity,a);break;case"linear_gradient_idx":{const p=e.linear_gradients[o.linear_gradient_idx];p.transform&&n.setTransform(Mg(p.transform).preMultiplySelf(n.getTransform())),n.fillStyle=h3(n,p,d,a);break}case"radial_gradient_idx":{const p=e.radial_gradients[o.radial_gradient_idx];p.transform&&n.setTransform(Mg(p.transform).preMultiplySelf(n.getTransform())),n.fillStyle=d3(n,p,d,a)}}n.fill(c3(i)),n.restore()}function c3(n){return n.rule===Lx.PATH_RULE_NON_ZERO?"nonzero":n.rule===Lx.PATH_RULE_EVEN_ODD?"evenodd":void 0}function u3(n,e,i,a){const o=i.stroke;if(!o)return;const d=_3(i);n.lineWidth=o.width,n.miterLimit=o.miterlimit,n.setLineDash(o.dasharray),n.lineDashOffset=o.dashoffset;const p=o.opacity/255;switch(o.paint){case"rgb_color":n.strokeStyle=Rg(o.rgb_color,o.opacity,a);break;case"linear_gradient_idx":n.strokeStyle=h3(n,e.linear_gradients[o.linear_gradient_idx],p,a,!0);break;case"radial_gradient_idx":n.strokeStyle=d3(n,e.radial_gradients[o.radial_gradient_idx],p,a,!0)}switch(o.linejoin){case vy.LINE_JOIN_MITER_CLIP:case vy.LINE_JOIN_MITER:n.lineJoin="miter";break;case vy.LINE_JOIN_ROUND:n.lineJoin="round";break;case vy.LINE_JOIN_BEVEL:n.lineJoin="bevel"}switch(o.linecap){case Ox.LINE_CAP_BUTT:n.lineCap="butt";break;case Ox.LINE_CAP_ROUND:n.lineCap="round";break;case Ox.LINE_CAP_SQUARE:n.lineCap="square"}n.stroke(d)}function h3(n,e,i,a,o=!1){if(e.stops.length===1){const P=e.stops[0];return Rg(P.rgb_color,P.opacity*i,a)}const{x1:d,y1:p,x2:y,y2:T}=e;let A=new DOMPoint(d,p),M=new DOMPoint(y,T);if(o){const P=Mg(e.transform);A=P.transformPoint(A),M=P.transformPoint(M)}const z=n.createLinearGradient(A.x,A.y,M.x,M.y);for(const P of e.stops)z.addColorStop(P.offset,Rg(P.rgb_color,P.opacity*i,a));return z}function d3(n,e,i,a,o=!1){if(e.stops.length===1){const K=e.stops[0];return Rg(K.rgb_color,K.opacity*i,a)}const d=Mg(e.transform),{fx:p,fy:y,fr:T,cx:A,cy:M,r:z}=e;let P=new DOMPoint(p,y),j=new DOMPoint(A,M),B=T,W=z;if(o){P=d.transformPoint(P),j=d.transformPoint(j);const K=(d.a+d.d)/2;B=T*K,W=e.r*K}const Y=n.createRadialGradient(P.x,P.y,B,j.x,j.y,W);for(const K of e.stops)Y.addColorStop(K.offset,Rg(K.rgb_color,K.opacity*i,a));return Y}function f3(n,e,i,a){const o=a.transform?Mg(a.transform).preMultiplySelf(e):e,d=B_(n.canvas.width,n.canvas.height),p=d.getContext("2d");for(const T of a.children)if(T.group)f3(p,o,i,T.group);else if(T.path){const A=T.path,M=new Path2D;M.addPath(_3(A),o),p.fill(M,c3(A))}const y=a.clip_path_idx!=null?i.clip_paths[a.clip_path_idx]:null;y&&p3(p,o,i,y),n.globalCompositeOperation="source-over",n.drawImage(d,0,0)}function p3(n,e,i,a){const o=B_(n.canvas.width,n.canvas.height);f3(o.getContext("2d"),e,i,a),n.globalCompositeOperation="destination-in",n.drawImage(o,0,0)}function m3(n,e,i,a,o){if(a.children.length===0)return;const d=a.mask_idx!=null?i.masks[a.mask_idx]:null;d&&m3(n,e,i,d,o);const p=n.canvas.width,y=n.canvas.height,T=B_(p,y),A=T.getContext("2d"),M=a.width,z=a.height,P=a.left,j=a.top,B=new Path2D,W=new Path2D;W.rect(P,j,M,z),B.addPath(W,e),A.clip(B);for(const re of a.children)o3(A,e,i,re,o);const Y=A.getImageData(0,0,p,y),K=Y.data;if(a.mask_type===n3.MASK_TYPE_LUMINANCE)for(let re=0;re<K.length;re+=4)K[re+3]=K[re+3]/255*(.2126*K[re]+.7152*K[re+1]+.0722*K[re+2]);A.putImageData(Y,0,0),n.globalCompositeOperation="destination-in",n.drawImage(T,0,0)}function Mg(n){return n?new DOMMatrix([n.sx,n.ky,n.kx,n.sy,n.tx,n.ty]):new DOMMatrix}function g3(n,e){const i=n.step;let a=n.diffs[0]*i,o=n.diffs[1]*i;e.moveTo(a,o);for(let d=0,p=2;d<n.commands.length;d++)switch(n.commands[d]){case j_.PATH_COMMAND_MOVE:a+=n.diffs[p++]*i,o+=n.diffs[p++]*i,e.moveTo(a,o);break;case j_.PATH_COMMAND_LINE:a+=n.diffs[p++]*i,o+=n.diffs[p++]*i,e.lineTo(a,o);break;case j_.PATH_COMMAND_QUAD:{const y=a+n.diffs[p++]*i,T=o+n.diffs[p++]*i;a=y+n.diffs[p++]*i,o=T+n.diffs[p++]*i,e.quadraticCurveTo(y,T,a,o);break}case j_.PATH_COMMAND_CUBIC:{const y=a+n.diffs[p++]*i,T=o+n.diffs[p++]*i,A=y+n.diffs[p++]*i,M=T+n.diffs[p++]*i;a=A+n.diffs[p++]*i,o=M+n.diffs[p++]*i,e.bezierCurveTo(y,T,A,M,a,o);break}case j_.PATH_COMMAND_CLOSE:e.closePath()}return e}function _3(n){return g3(n,new Path2D)}class Sy{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}ri(Sy,"LRUCache");class Nx{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Ks(e,e.data)}getFromCache(e,i,a){return this.cacheMap.has(a)||this.cacheMap.set(a,new Sy(150)),this.cacheMap.get(a).get(Lu(e.toString(),i))}setInCache(e,i,a,o){this.cacheDependenciesMap.has(o)||this.cacheDependenciesMap.set(o,new Map),this.cacheMap.has(o)||this.cacheMap.set(o,new Sy(150));const d=this.cacheDependenciesMap.get(o),p=Lu(e.id.toString(),a);d.get(p)||d.set(p,new Set);const y=this.cacheMap.get(o),T=e.toString();d.get(p).add(T),y.put(Lu(e.toString(),a),i)}removeImagesFromCacheByIds(e,i,a=0){if(!this.cacheMap.has(a)||!this.cacheDependenciesMap.has(a))return;const o=this.cacheMap.get(a),d=this.cacheDependenciesMap.get(a);for(const p of e){const y=Lu(p.toString(),i);if(d.has(y)){for(const T of d.get(y))o.delete(T);d.delete(y)}}}rasterize(e,i,a,o,d=TA){const p=this.getFromCache(e,a,o);if(p)return p.clone();const y=d(i.icon,e.options),T=Nx._getImage(y);return this.setInCache(e,T,a,o),T.clone()}}class y3{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const a=this.toIdx(e,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function x3(n,e,i,a){let o=0,d=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(i[p]<n[p]||i[p]>e[p])return null}else{const y=1/a[p];let T=(n[p]-i[p])*y,A=(e[p]-i[p])*y;if(T>A){const M=T;T=A,A=M}if(T>o&&(o=T),A<d&&(d=A),o>d)return null}return o}function v3(n,e,i,a,o,d,p,y,T,A,M){const z=a-n,P=o-e,j=d-i,B=p-n,W=y-e,Y=T-i,K=M[1]*Y-M[2]*W,re=M[2]*B-M[0]*Y,se=M[0]*W-M[1]*B,ue=z*K+P*re+j*se;if(Math.abs(ue)<1e-15)return null;const Re=1/ue,Me=A[0]-n,Ne=A[1]-e,Fe=A[2]-i,Ue=(Me*K+Ne*re+Fe*se)*Re;if(Ue<0||Ue>1)return null;const pt=Ne*j-Fe*P,$e=Fe*z-Me*j,yt=Me*P-Ne*z,It=(M[0]*pt+M[1]*$e+M[2]*yt)*Re;return It<0||Ue+It>1?null:(B*pt+W*$e+Y*yt)*Re}function b3(n,e,i){return(n-e)/(i-e)}function w3(n,e,i,a,o,d,p,y,T){const A=1<<i,M=d-a,z=p-o,P=(n+1)/A*M+a,j=(e+0)/A*z+o,B=(e+1)/A*z+o;y[0]=(n+0)/A*M+a,y[1]=j,T[0]=P,T[1]=B}class T3{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(d){const p=Math.ceil(Math.log2(d.dim/8)),y=[];let T=Math.ceil(Math.pow(2,p));const A=1/T,M=(j,B,W,Y,K)=>{const re=Y?1:0,se=(j+1)*W-re,ue=B*W,Re=(B+1)*W-re;K[0]=j*W,K[1]=ue,K[2]=se,K[3]=Re};let z=new y3(T);const P=[];for(let j=0;j<T*T;j++){M(j%T,Math.floor(j/T),A,!1,P);const B=dp(P[0],P[1],d),W=dp(P[2],P[1],d),Y=dp(P[2],P[3],d),K=dp(P[0],P[3],d);z.minimums.push(Math.min(B,W,Y,K)),z.maximums.push(Math.max(B,W,Y,K)),z.leaves.push(1)}for(y.push(z),T/=2;T>=1;T/=2){const j=y[y.length-1];z=new y3(T);for(let B=0;B<T*T;B++){M(B%T,Math.floor(B/T),2,!0,P);const W=j.getElevation(P[0],P[1]),Y=j.getElevation(P[2],P[1]),K=j.getElevation(P[2],P[3]),re=j.getElevation(P[0],P[3]),se=j.isLeaf(P[0],P[1]),ue=j.isLeaf(P[2],P[1]),Re=j.isLeaf(P[2],P[3]),Me=j.isLeaf(P[0],P[3]),Ne=Math.min(W.min,Y.min,K.min,re.min),Fe=Math.max(W.max,Y.max,K.max,re.max),Ue=se&&ue&&Re&&Me;z.maximums.push(Fe),z.minimums.push(Ne),z.leaves.push(Fe-Ne<=5&&Ue?1:0)}y.push(z)}return y}(this.dem),a=i.length-1,o=i[a];this._addNode(o.minimums[0],o.maximums[0],o.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(e,i,a,o,d,p,y=1){return x3([e,i,-100],[a,o,this.maximums[0]*y],d,p)}raycast(e,i,a,o,d,p,y=1){if(!this.nodeCount)return null;const T=this.raycastRoot(e,i,a,o,d,p,y);if(T==null)return null;const A=[],M=[],z=[],P=[],j=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;j.length>0;){const{idx:B,t:W,nodex:Y,nodey:K,depth:re}=j.pop();if(this.leaves[B]){w3(Y,K,re,e,i,a,o,z,P);const ue=1<<re,Re=(Y+0)/ue,Me=(Y+1)/ue,Ne=(K+0)/ue,Fe=(K+1)/ue,Ue=dp(Re,Ne,this.dem)*y,pt=dp(Me,Ne,this.dem)*y,$e=dp(Me,Fe,this.dem)*y,yt=dp(Re,Fe,this.dem)*y,It=v3(z[0],z[1],Ue,P[0],z[1],pt,P[0],P[1],$e,d,p),bt=v3(P[0],P[1],$e,z[0],P[1],yt,z[0],z[1],Ue,d,p),Et=Math.min(It!==null?It:Number.MAX_VALUE,bt!==null?bt:Number.MAX_VALUE);if(Et!==Number.MAX_VALUE)return Et;{const Ot=Di([],d,p,W);if(S3(Ue,pt,yt,$e,b3(Ot[0],z[0],P[0]),b3(Ot[1],z[1],P[1]))>=Ot[2])return W}continue}let se=0;for(let ue=0;ue<this._siblingOffset.length;ue++){w3((Y<<1)+this._siblingOffset[ue][0],(K<<1)+this._siblingOffset[ue][1],re+1,e,i,a,o,z,P),z[2]=-100,P[2]=this.maximums[this.childOffsets[B]+ue]*y;const Re=x3(z,P,d,p);if(Re!=null){const Me=Re;A[ue]=Me;let Ne=!1;for(let Fe=0;Fe<se&&!Ne;Fe++)Me>=A[M[Fe]]&&(M.splice(Fe,0,ue),Ne=!0);Ne||(M[se]=ue),se++}}for(let ue=0;ue<se;ue++){const Re=M[ue];j.push({idx:this.childOffsets[B]+Re,t:A[Re],nodex:(Y<<1)+this._siblingOffset[Re][0],nodey:(K<<1)+this._siblingOffset[Re][1],depth:re+1})}}return null}_addNode(e,i,a){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,a,o,d){if(e[o].isLeaf(i,a)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const p=o-1,y=e[p];let T=0,A=0;for(let M=0;M<this._siblingOffset.length;M++){const z=2*i+this._siblingOffset[M][0],P=2*a+this._siblingOffset[M][1],j=y.getElevation(z,P),B=y.isLeaf(z,P),W=this._addNode(j.min,j.max,B);B&&(T|=1<<M),A||(A=W)}for(let M=0;M<this._siblingOffset.length;M++)T&1<<M||this._construct(e,2*i+this._siblingOffset[M][0],2*a+this._siblingOffset[M][1],p,A+M)}}function S3(n,e,i,a,o,d){return zi(zi(n,i,d),zi(e,a,d),o)}function dp(n,e,i){const a=i.dim,o=Ie(n*a-.5,0,a-1),d=Ie(e*a-.5,0,a-1),p=Math.floor(o),y=Math.floor(d),T=Math.min(p+1,a-1),A=Math.min(y+1,a-1);return S3(i.get(p,y),i.get(T,y),i.get(p,A),i.get(T,A),o-p,d-y)}const SA={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function EA(n,e,i){return(256*n*256+256*e+i)/10-1e4}function AA(n,e,i){return 256*n+e+i/256-32768}class Ey{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,a,o=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void cn(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const d=this.dim=i.height-2,p=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=o,this._modifiedForSources={},!o){for(let T=0;T<d;T++)p[this._idx(-1,T)]=p[this._idx(0,T)],p[this._idx(d,T)]=p[this._idx(d-1,T)],p[this._idx(T,-1)]=p[this._idx(T,0)],p[this._idx(T,d)]=p[this._idx(T,d-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(d,-1)]=p[this._idx(d-1,0)],p[this._idx(-1,d)]=p[this._idx(0,d-1)],p[this._idx(d,d)]=p[this._idx(d-1,d-1)]}const y=a==="terrarium"?AA:EA;for(let T=0;T<p.length;++T){const A=4*T;this.floatView[T]=y(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}this._timestamp=_o.now()}_buildQuadTree(){this._tree=new T3(this)}get(e,i,a=!1){a&&(e=Ie(e,-1,this.dim),i=Ie(i,-1,this.dim));const o=this._idx(e,i);return this.floatView[o]}set(e,i,a){const o=this._idx(e,i),d=this.floatView[o];return this.floatView[o]=a,a-d}static getUnpackVector(e){return SA[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const a=[0,0,0,0],o=Ey.getUnpackVector(i);let d=Math.floor((e+o[3])/o[2]);return a[2]=d%256,d=Math.floor(d/256),a[1]=d%256,d=Math.floor(d/256),a[0]=d,a}getPixels(){return new rg({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let o=i*this.dim,d=i*this.dim+this.dim,p=a*this.dim,y=a*this.dim+this.dim;switch(i){case-1:o=d-1;break;case 1:d=o+1}switch(a){case-1:p=y-1;break;case 1:y=p+1}const T=-i*this.dim,A=-a*this.dim;for(let M=p;M<y;M++)for(let z=o;z<d;z++){const P=4*this._idx(z,M),j=4*this._idx(z+T,M+A);this.pixels[P+0]=e.pixels[j+0],this.pixels[P+1]=e.pixels[j+1],this.pixels[P+2]=e.pixels[j+2],this.pixels[P+3]=e.pixels[j+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function CA(n,e,i){n===1?e.headerLength=i.readFixed32():n===2?e.x=i.readVarint():n===3?e.y=i.readVarint():n===4?e.z=i.readVarint():n===5&&e.layers.push(function(a,o){return a.readFields(DA,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},o)}(i,i.readVarint()+i.pos))}function RA(n,e,i){n===1?(e.delta_filter=function(a,o){return a.readFields(MA,{blockSize:0},o)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):n===2?(i.readVarint(),e.filter="zigzag_filter"):n===3?(i.readVarint(),e.filter="bitshuffle_filter"):n===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function MA(n,e,i){n===1&&(e.blockSize=i.readVarint())}function IA(n,e,i){n===1?(i.readVarint(),e.codec="gzip_data"):n===2?(i.readVarint(),e.codec="jpeg_image"):n===3?(i.readVarint(),e.codec="webp_image"):n===4&&(i.readVarint(),e.codec="png_image")}function zA(n,e,i){let a=0,o=0;n===1?e.firstByte=i.readFixed64():n===2?e.lastByte=i.readFixed64():n===3?e.filters.push(function(d,p){return d.readFields(RA,{},p)}(i,i.readVarint()+i.pos)):n===4?e.codec=function(d,p){return d.readFields(IA,{},p)}(i,i.readVarint()+i.pos):n===5?o=i.readFloat():n===6?a=i.readFloat():n===7?e.bands.push(i.readString()):n===8?e.offset=i.readDouble():n===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=o),e.scale===0&&(e.scale=a)}function DA(n,e,i){n===1?e.version=i.readVarint():n===2?e.name=i.readString():n===3?e.units=i.readString():n===4?e.tileSize=i.readVarint():n===5?e.buffer=i.readVarint():n===6?e.pixelFormat=i.readVarint():n===7&&e.dataIndex.push(function(a,o){return a.readFields(zA,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},o)}(i,i.readVarint()+i.pos))}function PA(n,e,i){if(n===2)(function(a,o,d){a.readFields(LA,d,o)})(i,i.readVarint()+i.pos,e);else if(n===3)throw new Error("Not implemented")}function LA(n,e,i){if(n===1){let a=0;const o=i.readVarint()+i.pos;for(;i.pos<o;)e[a++]=i.readVarint()}}function OA(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let a=2;a>=1;a--){const o=a===1?1:0,d=a===2?1:0;for(let p=0;p<e[0];p++){const y=e[1]*p;for(let T=o;T<e[1];T++){const A=e[2]*(T+y);for(let M=d;M<e[2];M++){const z=e[3]*(M+A);for(let P=0;P<e[3];P++){const j=z+P;n[j]+=n[j-i]}}}}i*=e[a]}return n}function kA(n){for(let e=0,i=n.length;e<i;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function NA(n,e){switch(e){case"uint32":return n;case"uint16":for(let i=0;i<n.length;i+=2){const a=n[i],o=n[i+1];n[i]=(240&a)>>4|(61440&a)>>8|(240&o)<<4|61440&o,n[i+1]=15&a|(3840&a)>>4|(15&o)<<8|(3840&o)<<4}return n;case"uint8":for(let i=0;i<n.length;i+=4){const a=n[i],o=n[i+1],d=n[i+2],p=n[i+3];n[i+0]=(192&a)>>6|(192&o)>>4|(192&d)>>2|192&p,n[i+1]=(48&a)>>4|(48&o)>>2|48&d|(48&p)<<2,n[i+2]=(12&a)>>2|12&o|(12&d)<<2|(12&p)<<4,n[i+3]=3&a|(3&o)<<2|(3&d)<<4|(3&p)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}ri(Ey,"DEMData"),ri(T3,"DemMinMaxQuadTree",{omit:["dem"]});var pc=Uint8Array,F_=Uint16Array,jA=Int32Array,E3=new pc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),A3=new pc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),BA=new pc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),C3=function(n,e){for(var i=new F_(31),a=0;a<31;++a)i[a]=e+=1<<n[a-1];var o=new jA(i[30]);for(a=1;a<30;++a)for(var d=i[a];d<i[a+1];++d)o[d]=d-i[a]<<5|a;return{b:i,r:o}},R3=C3(E3,2),M3=R3.b,FA=R3.r;M3[28]=258,FA[258]=28;for(var UA=C3(A3,0).b,I3=new F_(32768),Ss=0;Ss<32768;++Ss){var Ig=(43690&Ss)>>1|(21845&Ss)<<1;I3[Ss]=((65280&(Ig=(61680&(Ig=(52428&Ig)>>2|(13107&Ig)<<2))>>4|(3855&Ig)<<4))>>8|(255&Ig)<<8)>>1}var U_=function(n,e,i){for(var a=n.length,o=0,d=new F_(e);o<a;++o)n[o]&&++d[n[o]-1];var p,y=new F_(e);for(o=1;o<e;++o)y[o]=y[o-1]+d[o-1]<<1;p=new F_(1<<e);var T=15-e;for(o=0;o<a;++o)if(n[o])for(var A=o<<4|n[o],M=e-n[o],z=y[n[o]-1]++<<M,P=z|(1<<M)-1;z<=P;++z)p[I3[z]>>T]=A;return p},V_=new pc(288);for(Ss=0;Ss<144;++Ss)V_[Ss]=8;for(Ss=144;Ss<256;++Ss)V_[Ss]=9;for(Ss=256;Ss<280;++Ss)V_[Ss]=7;for(Ss=280;Ss<288;++Ss)V_[Ss]=8;var z3=new pc(32);for(Ss=0;Ss<32;++Ss)z3[Ss]=5;var VA=U_(V_,9),HA=U_(z3,5),jx=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},Qu=function(n,e,i){var a=e/8|0;return(n[a]|n[a+1]<<8)>>(7&e)&i},Bx=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(7&e)},qA=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],eh=function(n,e,i){var a=new Error(e||qA[n]);if(a.code=n,Error.captureStackTrace&&Error.captureStackTrace(a,eh),!i)throw a;return a},GA=new pc(0),$A=typeof TextDecoder<"u"&&new TextDecoder;try{$A.decode(GA,{stream:!0})}catch{}const ZA={gzip_data:"gzip"};class nu extends Error{constructor(e){super(e),this.name="MRTError"}}const WA={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},D3={uint32:1,uint16:2,uint8:4},XA={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Fx;class Ay{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new nu(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),a=new DataView(e);if(i[0]!==13)throw new nu("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),a=this.getHeaderLength(e);if(i.length<a)throw new nu(`Expected header with length >= ${a} but got buffer of length ${i.length}`);const o=new Fx(i.subarray(0,a)).readFields(CA,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==o.x||this.y!==o.y||this.z!==o.z))throw new nu(`Invalid attempt to parse header ${o.z}/${o.x}/${o.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=o.x,this.y=o.y,this.z=o.z;for(const d of o.layers)this.layers[d.name]=new P3(d,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],a=this.getLayer(e.layerName);for(let o of e.blockIndices){const d=a.dataIndex[o],p=d.firstByte-e.firstByte,y=d.lastByte-e.firstByte;if(a._blocksInProgress.has(o))continue;const T={layerName:a.name,firstByte:p,lastByte:y,pixelFormat:a.pixelFormat,blockIndex:o,blockShape:[d.bands.length].concat(a.bandShape),buffer:a.buffer,codec:d.codec.codec,filters:d.filters.map(A=>A.filter)};a._blocksInProgress.add(o),i.push(T)}return new L3(i,()=>{i.forEach(o=>a._blocksInProgress.delete(o.blockIndex))},(o,d)=>{if(i.forEach(p=>a._blocksInProgress.delete(p.blockIndex)),o)throw o;d.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class P3{constructor({version:e,name:i,units:a,tileSize:o,pixelFormat:d,buffer:p,dataIndex:y},T){if(this.version=e,this.version!==1)throw new nu(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=a,this.tileSize=o,this.buffer=p,this.pixelFormat=WA[d],this.dataIndex=y,this.bandShape=[o+2*p,o+2*p,D3[this.pixelFormat]],this._decodedBlocks=new Sy(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return D3[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[a,o]of this.dataIndex.entries()){for(const[d,p]of o.bands.entries())if(p===e)return{bandIndex:i+d,blockIndex:a,blockBandIndex:d};i+=o.bands.length}break;case"number":for(const[a,o]of this.dataIndex.entries()){if(e>=i&&e<i+o.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-i};i+=o.bands.length}break;default:throw new nu(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,a=-1/0;const o=[],d=new Set;for(const p of e){const{blockIndex:y}=this.getBlockForBand(p);if(y<0)throw new nu(`Invalid band: ${JSON.stringify(p)}`);const T=this.dataIndex[y];o.includes(y)||o.push(y),d.add(y),i=Math.min(i,T.firstByte),a=Math.max(a,T.lastByte)}if(d.size>this.cacheSize)throw new nu(`Number of blocks to decode (${d.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:a,blockIndices:o}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:a}=this.getBlockForBand(e);if(i<0)throw new nu(`Band not found: ${JSON.stringify(e)}`);const o=this._decodedBlocks.get(i.toString());if(!o)throw new nu(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const d=this.dataIndex[i],p=this.bandShape.reduce((A,M)=>A*M,1),y=a*p,T=o.subarray(y,y+p);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:d.offset,scale:d.scale}}}Ay.setPbf=function(n){Fx=n};class L3{constructor(e,i,a){this.tasks=e,this._onCancel=i,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}Ay.performDecoding=function(n,e){const i=new Uint8Array(n);return Promise.all(e.tasks.map(a=>{const{layerName:o,firstByte:d,lastByte:p,pixelFormat:y,blockShape:T,blockIndex:A,filters:M,codec:z}=a,P=i.subarray(d,p+1),j=new Uint32Array(T[0]*T[1]*T[2]);let B;if(z!=="gzip_data")throw new nu(`Unhandled codec: ${z}`);return B=function(W,Y){if(!globalThis.DecompressionStream&&Y==="gzip_data")return Promise.resolve(((ue=function(Ne){Ne[0]==31&&Ne[1]==139&&Ne[2]==8||eh(6,"invalid gzip data");var Fe=Ne[3],Ue=10;4&Fe&&(Ue+=2+(Ne[10]|Ne[11]<<8));for(var pt=(Fe>>3&1)+(Fe>>4&1);pt>0;pt-=!Ne[Ue++]);return Ue+(2&Fe)}(se=W))+8>se.length&&eh(6,"invalid gzip data"),function(Ne,Fe,Ue,pt){var $e=Ne.length;if(!$e||Fe.f&&!Fe.l)return Ue||new pc(0);var yt=!Ue,It=yt||Fe.i!=2,bt=Fe.i;yt&&(Ue=new pc(3*$e));var Et,Ot,dt=function(vr){var br=Ue.length;if(vr>br){var hr=new pc(Math.max(2*br,vr));hr.set(Ue),Ue=hr}},At=Fe.f||0,at=Fe.p||0,tt=Fe.b||0,Nt=Fe.l,Pt=Fe.d,vi=Fe.m,ai=Fe.n,fi=8*$e;do{if(!Nt){At=Qu(Ne,at,1);var Ht=Qu(Ne,at+1,3);if(at+=3,!Ht){var xi=Ne[(fe=4+((at+7)/8|0))-4]|Ne[fe-3]<<8,Gi=fe+xi;if(Gi>$e){bt&&eh(0);break}It&&dt(tt+xi),Ue.set(Ne.subarray(fe,Gi),tt),Fe.b=tt+=xi,Fe.p=at=8*Gi,Fe.f=At;continue}if(Ht==1)Nt=VA,Pt=HA,vi=9,ai=5;else if(Ht==2){var Xt=Qu(Ne,at,31)+257,mi=Qu(Ne,at+10,15)+4,Oi=Xt+Qu(Ne,at+5,31)+1;at+=14;for(var Qi=new pc(Oi),hn=new pc(19),nn=0;nn<mi;++nn)hn[BA[nn]]=Qu(Ne,at+3*nn,7);at+=3*mi;var ui=jx(hn),en=(1<<ui)-1,An=U_(hn,ui);for(nn=0;nn<Oi;){var fe,me=An[Qu(Ne,at,en)];if(at+=15&me,(fe=me>>4)<16)Qi[nn++]=fe;else{var st=0,ft=0;for(fe==16?(ft=3+Qu(Ne,at,3),at+=2,st=Qi[nn-1]):fe==17?(ft=3+Qu(Ne,at,7),at+=3):fe==18&&(ft=11+Qu(Ne,at,127),at+=7);ft--;)Qi[nn++]=st}}var Zt=Qi.subarray(0,Xt),$t=Qi.subarray(Xt);vi=jx(Zt),ai=jx($t),Nt=U_(Zt,vi),Pt=U_($t,ai)}else eh(1);if(at>fi){bt&&eh(0);break}}It&&dt(tt+131072);for(var ci=(1<<vi)-1,Si=(1<<ai)-1,dn=at;;dn=at){var mn=(st=Nt[Bx(Ne,at)&ci])>>4;if((at+=15&st)>fi){bt&&eh(0);break}if(st||eh(2),mn<256)Ue[tt++]=mn;else{if(mn==256){dn=at,Nt=null;break}var an=mn-254;mn>264&&(an=Qu(Ne,at,(1<<(sn=E3[nn=mn-257]))-1)+M3[nn],at+=sn);var Yn=Pt[Bx(Ne,at)&Si],Cr=Yn>>4;if(Yn||eh(3),at+=15&Yn,$t=UA[Cr],Cr>3){var sn=A3[Cr];$t+=Bx(Ne,at)&(1<<sn)-1,at+=sn}if(at>fi){bt&&eh(0);break}It&&dt(tt+131072);var gr=tt+an;if(tt<$t){var er=0-$t,Fn=Math.min($t,gr);for(er+tt<0&&eh(3);tt<Fn;++tt)Ue[tt]=(void 0)[er+tt]}for(;tt<gr;++tt)Ue[tt]=Ue[tt-$t]}}Fe.l=Nt,Fe.p=dn,Fe.b=tt,Fe.f=At,Nt&&(At=1,Fe.m=vi,Fe.d=Pt,Fe.n=ai)}while(!At);return tt!=Ue.length&&yt?(Et=Ue,((Ot=tt)==null||Ot>Et.length)&&(Ot=Et.length),new pc(Et.subarray(0,Ot))):Ue.subarray(0,tt)}(se.subarray(ue,-8),{i:2},new pc(((K=se)[(re=K.length)-4]|K[re-3]<<8|K[re-2]<<16|K[re-1]<<24)>>>0))));var K,re,se,ue;const Re=ZA[Y];if(!Re)throw new Error(`Unhandled codec: ${Y}`);const Me=new globalThis.DecompressionStream(Re);return new Response(new Blob([W]).stream().pipeThrough(Me)).arrayBuffer().then(Ne=>new Uint8Array(Ne))}(P,z).then(W=>(function(Y,K){Y.readFields(PA,K)}(new Fx(W),j),new XA[y](j.buffer))),B.then(W=>{for(let Y=M.length-1;Y>=0;Y--)switch(M[Y]){case"delta_filter":OA(W,T);break;case"zigzag_filter":kA(W);break;case"bitshuffle_filter":NA(W,y);break;default:throw new nu(`Unhandled filter "${M[Y]}"`)}return{layerName:o,blockIndex:A,data:W}}).catch(W=>{throw W})}))},ri(L3,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),ri(Ay,"MapboxRasterTile"),ri(P3,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class O3{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const YA=["id","tile","layer","source","sourceLayer","state"];class zg{constructor(e,i,a,o,d){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=a,this._y=o,this.properties=e.properties,this.id=d}clone(){const e=new zg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of YA)this[i]!==void 0&&(e[i]=this[i]);return e}}class k3{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ic(Vt,16,0),this.featureIndexArray=new Xp,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,a,o,d,p=0,y=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,o,d,p);const A=this.grid;for(let M=0;M<i.length;M++){const z=i[M],P=[1/0,1/0,-1/0,-1/0];for(let j=0;j<z.length;j++){const B=z[j];P[0]=Math.min(P[0],B.x),P[1]=Math.min(P[1],B.y),P[2]=Math.max(P[2],B.x),P[3]=Math.max(P[3],B.y)}y!==0&&(P[0]-=y,P[1]-=y,P[2]+=y,P[3]+=y),P[0]<Vt&&P[1]<Vt&&P[2]>=0&&P[3]>=0&&A.insert(T,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Li(new Q0(this.rawTileData)).layers,this.sourceLayerCoder=new O3(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:a,transform:o,tileTransform:d,pixelPosMatrix:p,availableImages:y,worldview:T}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const A=a.bufferedTilespaceBounds,M=this.grid.query(A.min.x,A.min.y,A.max.x,A.max.y,(B,W,Y,K)=>Wr(a.bufferedTilespaceGeometry,B,W,Y,K));M.sort(KA);let z=null;o.elevation&&M.length>0&&(z=Cg.create(o.elevation,this.tileID));const P={};let j;for(let B=0;B<M.length;B++){const W=M[B];if(W===j)continue;j=W;const Y=this.featureIndexArray.get(W);let K=null;this.is3DTile?this.loadMatchingModelFeature(P,Y,e,a,o,T):this.loadMatchingFeature(P,Y,e,y,T,(re,se,ue,Re=0)=>(K||(K=qt(re,this.tileID.canonical,d)),se.queryIntersectsFeature(a,re,ue,K,this.z,o,p,z,Re)))}return P}loadMatchingFeature(e,i,a,o,d,p){const{featureIndex:y,bucketIndex:T,sourceLayerIndex:A,layoutVertexArrayOffset:M}=i,z=this.bucketLayerIDs[T],P=a.layers,j=Object.keys(P);if(j.length&&!ln(j,z))return;const B=a.sourceCache,W=this.sourceLayerCoder.decode(A),Y=this.vtLayers[W].feature(y),K=this.getId(Y,W);for(let re=0;re<z.length;re++){const se=z[re];if(!P[se])continue;const{styleLayer:ue,targets:Re}=P[se];let Me={};K!==void 0&&(Me=B.getFeatureState(ue.sourceLayer,K));const Ne=!p||p(Y,ue,Me,M);if(!Ne)continue;const Fe=new zg(Y,this.z,this.x,this.y,K);Fe.tile=this.tileID.canonical,Fe.state=Me;let Ue=this.serializedLayersCache.get(se);Ue||(Ue=ue.serialize(),Ue.id=se,this.serializedLayersCache.set(se,Ue)),Fe.source=Ue.source,Fe.sourceLayer=Ue["source-layer"],Fe.layer=Object.assign({},Ue),Fe.layer.paint=N3(Ue.paint,ue.paint,Y,Me,o),Fe.layer.layout=N3(Ue.layout,ue.layout,Y,Me,o);let pt=!1;for(const $e of Re){this.updateFeatureProperties(Fe,$e);const{filter:yt}=$e;if(yt){if(Y.properties=Fe.properties,yt.needGeometry){const It=Ct(Y,!0);if(!yt.filter(new ir(this.tileID.overscaledZ,{worldview:d}),It,this.tileID.canonical))continue}else if(!yt.filter(new ir(this.tileID.overscaledZ,{worldview:d}),Y))continue}pt=!0,$e.targetId&&this.addFeatureVariant(Fe,$e)}pt&&this.appendToResult(e,se,y,Fe,Ne)}}loadMatchingModelFeature(e,i,a,o,d,p){const{featureIndex:y,bucketIndex:T}=i,A=this.bucketLayerIDs[T],M=a.layers,z=Object.keys(M);if(!z.length||ln(z,A))for(let P=0;P<A.length;P++){const j=A[P],{styleLayer:B,targets:W}=M[j];if(B.type!=="model")continue;const Y=o.tile,K=Y.getBucket(B);if(!(K&&K instanceof xy))continue;const re=iA(K,y,o,d);if(!re)continue;const{z:se,x:ue,y:Re}=Y.tileID.canonical,{feature:Me,intersectionZ:Ne,position:Fe}=re;let Ue={};Me.id!==void 0&&(Ue=a.sourceCache.getFeatureState(B.sourceLayer,Me.id));const pt=new zg({},se,ue,Re,Me.id);pt.tile=this.tileID.canonical,pt.state=Ue,pt.properties=Me.properties,pt.geometry={type:"Point",coordinates:[Fe.lng,Fe.lat]};let $e=this.serializedLayersCache.get(j);$e||($e=B.serialize(),$e.id=j,this.serializedLayersCache.set(j,$e)),pt.source=$e.source,pt.sourceLayer=$e["source-layer"],pt.layer=Object.assign({},$e);let yt=!1;for(const It of W){this.updateFeatureProperties(pt,It);const{filter:bt}=It;if(bt){if(Me.properties=pt.properties,bt.needGeometry){if(!bt.filter(new ir(this.tileID.overscaledZ,{worldview:p}),Me,this.tileID.canonical))continue}else if(!bt.filter(new ir(this.tileID.overscaledZ,{worldview:p}),Me))continue}yt=!0,It.targetId&&this.addFeatureVariant(pt,It)}yt&&this.appendToResult(e,j,y,pt,Ne)}}updateFeatureProperties(e,i,a){if(i.properties){const o={};for(const d in i.properties){const p=i.properties[d].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,a);p!=null&&(o[d]=p)}e.properties=o}}addFeatureVariant(e,i,a){const o={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(o.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(o)}appendToResult(e,i,a,o,d){let p=e[i];p===void 0&&(p=e[i]=[]),p.push({featureIndex:a,feature:o,intersectionZ:d})}lookupSymbolFeatures(e,i,a,o,d,p){const y={};this.loadVTLayers();for(const T of e)this.loadMatchingFeature(y,{bucketIndex:i,sourceLayerIndex:a,featureIndex:T,layoutVertexArrayOffset:0},o,d,p);return y}loadFeature(e){const{featureIndex:i,sourceLayerIndex:a}=e;this.loadVTLayers();const o=this.sourceLayerCoder.decode(a),d=this.vtFeatures[o];if(d[i])return d[i];const p=this.vtLayers[o].feature(i);return d[i]=p,p}hasLayer(e){for(const i of this.bucketLayerIDs)for(const a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;if(this.promoteId){const o=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(o!=null)if(Array.isArray(o)){if(!this.promoteIdExpression){const d=so(o);if(d.result!=="success"){const p=d.value.map(y=>`${y.key}: ${y.message}`).join(", ");return void cn(`Failed to create expression for promoteId: ${p}`)}this.promoteIdExpression=d.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new ql),a=this.promoteIdExpression.evaluate({zoom:0},e)}else a=e.properties[o];typeof a=="boolean"&&(a=Number(a))}return a}}function N3(n,e,i,a,o){return Vi(n,(d,p)=>{const y=e instanceof Zc?e.get(p):null;return y&&y.evaluate?y.evaluate(i,a,void 0,o):y})}function KA(n,e){return e-n}ri(k3,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const j3=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ux{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,a]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const o=a>>4;if(o!==1)throw new Error(`Got v${o} data when expected v1.`);const d=j3[15&a];if(!d)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Ux(y,p,d,e)}constructor(e,i=64,a=Float64Array,o){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=j3.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-y%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${a}.`);o&&o instanceof ArrayBuffer?(this.data=o,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=i,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Vx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,a,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:p,nodeSize:y}=this,T=[0,d.length-1,0],A=[];for(;T.length;){const M=T.pop()||0,z=T.pop()||0,P=T.pop()||0;if(z-P<=y){for(let Y=P;Y<=z;Y++){const K=p[2*Y],re=p[2*Y+1];K>=e&&K<=a&&re>=i&&re<=o&&A.push(d[Y])}continue}const j=P+z>>1,B=p[2*j],W=p[2*j+1];B>=e&&B<=a&&W>=i&&W<=o&&A.push(d[j]),(M===0?e<=B:i<=W)&&(T.push(P),T.push(j-1),T.push(1-M)),(M===0?a>=B:o>=W)&&(T.push(j+1),T.push(z),T.push(1-M))}return A}within(e,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:d,nodeSize:p}=this,y=[0,o.length-1,0],T=[],A=a*a;for(;y.length;){const M=y.pop()||0,z=y.pop()||0,P=y.pop()||0;if(z-P<=p){for(let Y=P;Y<=z;Y++)F3(d[2*Y],d[2*Y+1],e,i)<=A&&T.push(o[Y]);continue}const j=P+z>>1,B=d[2*j],W=d[2*j+1];F3(B,W,e,i)<=A&&T.push(o[j]),(M===0?e-a<=B:i-a<=W)&&(y.push(P),y.push(j-1),y.push(1-M)),(M===0?e+a>=B:i+a>=W)&&(y.push(j+1),y.push(z),y.push(1-M))}return T}}function Vx(n,e,i,a,o,d){if(o-a<=i)return;const p=a+o>>1;B3(n,e,p,a,o,d),Vx(n,e,i,a,p-1,1-d),Vx(n,e,i,p+1,o,1-d)}function B3(n,e,i,a,o,d){for(;o>a;){if(o-a>600){const A=o-a+1,M=i-a+1,z=Math.log(A),P=.5*Math.exp(2*z/3),j=.5*Math.sqrt(z*P*(A-P)/A)*(M-A/2<0?-1:1);B3(n,e,i,Math.max(a,Math.floor(i-M*P/A+j)),Math.min(o,Math.floor(i+(A-M)*P/A+j)),d)}const p=e[2*i+d];let y=a,T=o;for(H_(n,e,a,i),e[2*o+d]>p&&H_(n,e,a,o);y<T;){for(H_(n,e,y,T),y++,T--;e[2*y+d]<p;)y++;for(;e[2*T+d]>p;)T--}e[2*a+d]===p?H_(n,e,a,T):(T++,H_(n,e,T,o)),T<=i&&(a=T+1),i<=T&&(o=T-1)}}function H_(n,e,i,a){Hx(n,i,a),Hx(e,2*i,2*a),Hx(e,2*i+1,2*a+1)}function Hx(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}function F3(n,e,i,a){const o=n-i,d=e-a;return o*o+d*d}s.$=xf,s.A=vo,s.B=Lu,s.C=2,s.D=lp,s.E=fu,s.F=I_,s.G=hw,s.H=yf,s.I=to,s.J=Lh,s.K=Ni,s.L=yu,s.M=If,s.N=Ah,s.O=Mf,s.P=Mt,s.Q=Go,s.R=uh,s.S=bl,s.T=ix,s.U=so,s.V=yy,s.W=Df,s.X=fl,s.Y=dl,s.Z=Oc,s._=ya,s.a=function(n){return Vr.API_CDN_URL_REGEX.test(n)},s.a$=ve,s.a0=_u,s.a1=Tp,s.a2=Od,s.a3=class extends yy{},s.a4=Ch,s.a5=Rf,s.a6=qe,s.a7=function(n){const e=n.value;return e?_u(e)?Ix(e,!0)?[]:[new yy(n.key,e,`invalid url "${e}"`)]:[new yy(n.key,e,`string expected, "${Ni(e)}" found`)]:[]},s.a8=$m,s.a9=Rr,s.aA=Ie,s.aB=ge,s.aC=js,s.aD=c,s.aE=_s,s.aF=de,s.aG=Ye,s.aH=function(n,e){const i={};for(let a=0;a<e.length;a++){const o=e[a];o in n&&(i[o]=n[o])}return i},s.aI=ee,s.aJ=Te,s.aK=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,i,a){const o=this.entries[n]=this.entries[n]||{callbacks:[]};if(o.result){const[d,p]=o.result;return this.scheduler?this.scheduler.add(()=>{a(d,p)},e):a(d,p),()=>{}}return o.callbacks.push(a),o.cancel||(o.cancel=i((d,p)=>{o.result=[d,p];for(const y of o.callbacks)this.scheduler?this.scheduler.add(()=>{y(d,p)},e):y(d,p);setTimeout(()=>delete this.entries[n],3e3)})),()=>{o.result||(o.callbacks=o.callbacks.filter(d=>d!==a),o.callbacks.length||(o.cancel(),delete this.entries[n]))}}},s.aL=function(n,e,i){const a=JSON.stringify(n.request);return n.data&&(this.deduped.entries[a]={result:[null,n.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},o=>{const d=cl(n.request,(p,y,T,A)=>{p?o(p):y&&o(null,{vectorTile:i?void 0:new Li(new Q0(y)),rawData:y,cacheControl:T,expires:A})});return()=>{d.cancel(),o()}},e)},s.aM=function(n){Sc++,Sc>ll&&(n.getActor().send("enforceCacheSizeLimit",yo),Sc=0)},s.aN=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log2(n)))},s.aO=Ys,s.aP=Fw,s.aQ=$w,s.aR=G,s.aS=Bw,s.aT=function(n,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<n.length;a++){const o=document.createElement("source");kl(n[a])||(i.crossOrigin="Anonymous"),o.src=n[a],i.appendChild(o)}return{cancel:()=>{}}},s.aU=S_,s.aV=function(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>_b(e,0,n))},s.aW=Eb,s.aX=class{constructor(n,e,i,a){this.id=n,this.position=e!=null?new G(e[0],e[1]):new G(0,0),this.orientation=i??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new Pi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,e){if(ge(n.matrix,e,n.matrix),n.meshes)for(const i of n.meshes){const a=Pi.applyTransformFast(i.aabb,n.matrix);this.aabb.encapsulate(a)}if(n.children)for(const i of n.children)this._applyTransformations(i,n.matrix)}computeBoundsAndApplyParent(){const n=Se([]);for(const e of this.nodes)this._applyTransformations(e,n)}computeModelMatrix(n,e,i,a,o,d,p=!1){Tb(this.matrix,this,n.transform,this.position,e,i,a,o,d,p)}upload(n){if(!this.uploaded){for(const e of this.nodes)sx(e,n);for(const e of this.nodes)J0(e);this.uploaded=!0}}destroy(){for(const n of this.nodes)ax(n)}},s.aY=Ai,s.aZ=D_,s.a_=Ee,s.aa=kt,s.ab=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return Ve(n.expression.evaluate(e))}interpolate(n,e,i){return{x:zi(n.x,e.x,i),y:zi(n.y,e.y,i),z:zi(n.z,e.z,i),azimuthal:zi(n.azimuthal,e.azimuthal,i),polar:zi(n.polar,e.polar,i)}}},s.ac=ir,s.ad=yl,s.ae=ot,s.af=St,s.ag=wi,s.ah=et,s.ai=Zc,s.aj=Wh,s.ak=zi,s.al=Vt,s.am=Ep,s.an=He,s.ao=Vn,s.ap=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return function([i,a]){const o=Ve([1,i,a]);return{x:o.x,y:o.y,z:o.z}}(n.expression.evaluate(e))}interpolate(n,e,i){return{x:zi(n.x,e.x,i),y:zi(n.y,e.y,i),z:zi(n.z,e.z,i)}}},s.aq=function(n,e,i=0,a=!0){const o=new Mt(i,i),d=n.sub(o),p=e.add(o),y=[d,new Mt(p.x,d.y),p,new Mt(d.x,p.y)];return a&&y.push(d.clone()),y},s.ar=function(n,e){const i=[];for(let a=0;a<n.length;a++){const o=Be(a-1,-1,n.length-1),d=Be(a+1,-1,n.length-1),p=n[a],y=n[d],T=n[o].sub(p).unit(),A=y.sub(p).unit(),M=A.angleWithSep(T.x,T.y),z=T.add(A).unit().mult(-1*e/Math.sin(M/2));i.push(p.add(z))}return i},s.as=Ew,s.at=Wr,s.au=function(n,e,i=0){return Fi(((e.x-i)*n.scale-n.x)*Vt,(e.y*n.scale-n.y)*Vt,be(e.z,e.y))},s.av=In,s.aw=Ti,s.ax=bn,s.ay=Nb,s.az=function(n){let e=1/0,i=1/0,a=-1/0,o=-1/0;for(const d of n)e=Math.min(e,d.x),i=Math.min(i,d.y),a=Math.max(a,d.x),o=Math.max(o,d.y);return{min:new Mt(e,i),max:new Mt(a,o)}},s.b=function(n){return Vr.API_FONTS_REGEX.test(n)},s.b$=tu,s.b0=Kc,s.b1=is,s.b2=vt,s.b3=$d,s.b4=py,s.b5=function(){$o.isLoading()||$o.isLoaded()||Dh()!=="deferred"||qc()},s.b6=Oh,s.b7=Ct,s.b8=zg,s.b9=Bt,s.bA=Se,s.bB=Ke,s.bC=le,s.bD=function(n,e){const{x:i,y:a}=n.point,o=w0(i,a,n.worldSize/n._pixelsPerMercatorPixel,0,0);return ge(o,o,Qg(ha(e)))},s.bE=Q,s.bF=Mn,s.bG=function(n,e){var i=e[0]-n[0],a=e[1]-n[1],o=e[2]-n[2];return Math.sqrt(i*i+a*a+o*o)},s.bH=Di,s.bI=Ii,s.bJ=Mi,s.bK=M_,s.bL=al,s.bM=_x,s.bN=function(n,e,i,a,o){const d=5*e+2;n.float32[d+0]=i,n.float32[d+1]=a,n.float32[d+2]=o},s.bO=fy,s.bP=Ea,s.bQ=Ls,s.bR=ss,s.bS=ds,s.bT=Be,s.bU=function(n,e,i,a){var o=new Z(4);return o[0]=n,o[1]=e,o[2]=i,o[3]=a,o},s.bV=cs,s.bW=Ga,s.bX=Qs,s.bY=hm,s.bZ=Zw,s.b_=Xu,s.ba=ux,s.bb=ug,s.bc=qt,s.bd=oc,s.be=Sl,s.bf=Jp,s.bg=qn,s.bh=Xh,s.bi=Rx,s.bj=function(n,e){const i=Wh(e.zoom);if(i===0)return ha(n);const a=em(n),o=Qm(a),d=de(a.getWest())*e.worldSize,p=de(a.getEast())*e.worldSize,y=Te(a.getNorth())*e.worldSize,T=Te(a.getSouth())*e.worldSize,A=[d,y,0],M=[p,y,0],z=[d,T,0],P=[p,T,0],j=te([],e.globeMatrix);return St(A,A,j),St(M,M,j),St(z,z,j),St(P,P,j),o[0]=nl(o[0],z,i),o[1]=nl(o[1],P,i),o[2]=nl(o[2],M,i),o[3]=nl(o[3],A,i),Pi.fromPoints(o)},s.bk=im,s.bl=te,s.bm=tm,s.bn=nl,s.bo=Yc,s.bp=F1,s.bq=it,s.br=xe,s.bs=Ay,s.bt=Q0,s.bu=cl,s.bv=function(n,e){const i=[];for(const a in n)a in e||i.push(a);return i},s.bw=Je,s.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.by=ea,s.bz=function(n){var e=new Z(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},s.c=Ja,s.c$=function(n){return n*n*n*n*n},s.c0=gx,s.c1=yw,s.c2=bx,s.c3=Ux,s.c4=Ft,s.c5=bs,s.c6=mo,s.c7=function(n,e,i){i*=.5;var a=e[0],o=e[1],d=e[2],p=e[3],y=Math.sin(i),T=Math.cos(i);return n[0]=a*T+o*y,n[1]=o*T-a*y,n[2]=d*T+p*y,n[3]=p*T-d*y,n},s.c8=As,s.c9=bi,s.cA=Ji,s.cB=xb,s.cC=Rl,s.cD=Kg,s.cE=function(n,e,i,a,o,d,p,y,T){if(T.name==="globe")return Kg(n,e,new Rl(i,a,o),!1);const A=D_({z:i,x:a,y:o},T);return new Pi([(d+A.x/A.scale)*e,e*(A.y/A.scale),p],[(d+A.x2/A.scale)*e,e*(A.y2/A.scale),y])},s.cF=function(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n[3]=Math.min(e[3],i[3]),n},s.cG=function(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n[3]=Math.max(e[3],i[3]),n},s.cH=function(n){const e=Math.round((n+45+360)%360/90)%4;return ne[e]},s.cI=Ce,s.cJ=Un,s.cK=_,s.cL=function(n){const e=Se(new Float64Array(16));ge(e,n.pixelMatrix,n.globeMatrix);const i=[0,D,0],a=[0,L,0];return St(i,i,e),St(a,a,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!e_(n,new G(n.center.lat,90)),a[0]>0&&a[0]<=n.width&&a[1]>0&&a[1]<=n.height&&!e_(n,new G(n.center.lat,-90))]},s.cM=function(n,e){const{scale:i}=n.tileTransform,a=i*Vt/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return function(o,d,p){var y=d[1],T=d[2],A=d[3],M=p[0],z=p[1];return o[0]=d[0]*M,o[1]=y*M,o[2]=T*z,o[3]=A*z,o}(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},s.cN=Y0,s.cO=Lt,s.cP=yb,s.cQ=function(n){const e=yb(n,!0);return Q([],[e[0],e[1],e[4],e[5]])},s.cR=ye,s.cS=Dn,s.cT=Pe,s.cU=function(n){const{x:e,y:i}=n.point,{lng:a,lat:o}=n._center;return w0(e,i,n.worldSize,a,o)},s.cV=Ui,s.cW=J,s.cX=Wf,s.cY=Xs,s.cZ=m,s.c_=function(n,e,i){let a=0;for(let o=0;o<2;++o)n[o]>0&&(a+=(n[o]-0)*(n[o]-0)),e[o]<0&&(a+=(0-e[o])*(0-e[o]));return a},s.ca=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},s.cb=ut,s.cc=function(n,e,i,a,o){var d=1/Math.tan(e/2);if(n[0]=d/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=d,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,o!=null&&o!==1/0){var p=1/(a-o);n[10]=(o+a)*p,n[14]=2*o*a*p}else n[10]=-1,n[14]=-2*a;return n},s.cd=function(n,e,i,a,o,d,p){var y=1/(e-i),T=1/(a-o),A=1/(d-p);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*T,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*A,n[11]=0,n[12]=(e+i)*y,n[13]=(o+a)*T,n[14]=(p+d)*A,n[15]=1,n},s.ce=we,s.cf=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},s.cg=Gh,s.ch=Zd,s.ci=Wn,s.cj=Qo,s.ck=la,s.cl=Iw,s.cm=function(){var n=new Z(4);return Z!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},s.cn=function(n,e,i){var a=e[0],o=e[1],d=e[2],p=e[3],y=Math.sin(i),T=Math.cos(i);return n[0]=a*T+d*y,n[1]=o*T+p*y,n[2]=a*-y+d*T,n[3]=o*-y+p*T,n},s.co=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},s.cp=Nn,s.cq=function(n){var e=n[0],i=n[1],a=n[2],o=n[3];return Math.sqrt(e*e+i*i+a*a+o*o)},s.cr=Fs,s.cs=Sn,s.ct=jr,s.cu=3,s.cv=2,s.cw=7,s.cx=6,s.cy=xt,s.cz=lt,s.d=function(n){return Vr.API_TILEJSON_REGEX.test(n)},s.d$=Ub,s.d0=ce,s.d1=45,s.d2=$h,s.d3=function(n,e,i){const a=Math.sqrt(n*n+e*e+i*i),o=a>0?Math.acos(i/a)*Na:0;let d=n!==0||e!==0?Math.atan2(-e,-n)*Na+90:0;return d<0&&(d+=360),[a,d,o]},s.d4=Fi,s.d5=Ve,s.d6=Ze,s.d7=Wt,s.d8=Pi,s.d9=ki,s.dA=function(n,e,i){const a=Wh(i.zoom),o=n.style.map._antialias,d=n.terrain&&n.terrain.exaggeration()>0;return a===0&&!o&&!d},s.dB=function(n){const e=n.pixelsPerMeter,i=e/we(1,n.center.lat),a=Se(new Float64Array(16));return xe(a,a,[n.point.x,n.point.y,0]),ye(a,a,[i,i,e]),Float32Array.from(a)},s.dC=em,s.dD=function(n){const e=Ce-5;n=Ie(n,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(He(n))),3);return Math.round(i*(R.length-1))},s.dE=function(n,e,i,a){const o=e.getNorth(),d=e.getSouth(),p=e.getWest(),y=e.getEast(),T=1<<n.z,A=y-p,M=o-d,z=A/E,P=-M/R[i],j=[0,z,0,P,0,0,o,p,0];if(n.z>0){const B=180/a;ze(j,j,[B/A+1,0,0,0,B/M+1,0,-.5*B/z,.5*B/P,1])}return j[2]=T,j[5]=n.x,j[8]=n.y,j},s.dF=ha,s.dG=function(n,e,i){const a=Se(new Float64Array(16)),o=(e/(1<<n)-.5)*Math.PI*2;return Ae(a,i.globeMatrix,o),Float32Array.from(a)},s.dH=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,a=1<<i,o=Math.floor(n.x),d=Math.floor((n.x-o)*a),p=Math.floor(n.y*a),y=this.findDEMTileFor(new Ys(i,o,i,d,p));return!(!y||!y.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||n.y<0||n.y>1)return e;const o=a.getSource().maxzoom,d=1<<o,p=Math.floor(n.x),y=n.x-p,T=new Ys(o,p,o,Math.floor(y*d),Math.floor(n.y*d)),A=this.findDEMTileFor(T);if(!A||!A.dem)return e;const M=A.dem,z=1<<A.tileID.canonical.z,P=(y*z-A.tileID.canonical.x)*M.dim,j=(n.y*z-A.tileID.canonical.y)*M.dim,B=Math.floor(P),W=Math.floor(j);return(i?this.exaggeration():1)*zi(zi(M.get(B,W),M.get(B,W+1),j-W),zi(M.get(B+1,W),M.get(B+1,W+1),j-W),P-B)}getAtTileOffset(n,e,i){const a=1<<n.canonical.z;return this.getAtPointOrZero(new ot(n.wrap+(n.canonical.x+e/Vt)/a,(n.canonical.y+i/Vt)/a))}getAtTileOffsetFunc(n,e,i,a){return o=>{const d=this.getAtTileOffset(n,o.x,o.y),p=a.upVector(n.canonical,o.x,o.y);return Ft(p,p,d*a.upVectorScale(n.canonical,e,i).metersToTile),p}}getForTilePoints(n,e,i,a){if(this.isUsingMockSource())return!1;const o=Cg.create(this,n,a);return!!o&&(e.forEach(d=>{d[2]=this.exaggeration()*o.getElevationAt(d[0],d[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,a=e.tileID,o=1<<n.canonical.z-a.canonical.z;let d=n.canonical.x/o-a.canonical.x,p=n.canonical.y/o-a.canonical.y,y=0;for(let T=0;T<n.canonical.z-a.canonical.z&&!i.leaves[y];T++){d*=2,p*=2;const A=2*Math.floor(p)+Math.floor(d);y=i.childOffsets[y]+A,d%=1,p%=1}return{min:this.exaggeration()*i.minimums[y],max:this.exaggeration()*i.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,i=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const o of n){const d=this.getMinMaxForTile(o.tileID);d&&(i=Math.min(i,d.min),a=Math.max(a,d.max),e=!0)}return e?{min:i,max:a}:null}},s.dI=rg,s.dJ=$u,s.dK=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},s.dL=oe,s.dM=function(n,e){var i=Math.sin(e),a=Math.cos(e);return n[0]=a,n[1]=i,n[2]=0,n[3]=-i,n[4]=a,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},s.dN=Ei,s.dO=eg,s.dP=Kn,s.dQ=ar,s.dR=256,s.dS=function(n,e){const i=[0,0,0];return St(i,i,im(ha(e.canonical))),St(i,i,n),i},s.dT=n=>({u_matrix:new la(n),u_texsize:new Qo(n),u_pixels_to_tile_units:new Wd(n),u_device_pixel_ratio:new Wn(n),u_width_scale:new Wn(n),u_floor_width_scale:new Wn(n),u_image:new Gh(n),u_units_to_pixels:new Qo(n),u_tile_units_to_pixels:new Wn(n),u_alpha_discard_threshold:new Wn(n),u_trim_offset:new Qo(n),u_trim_fade_range:new Qo(n),u_trim_color:new $h(n),u_emissive_strength:new Wn(n),u_zbias_factor:new Wn(n),u_tile_to_meter:new Wn(n),u_ground_shadow_factor:new Zd(n),u_pattern_transition:new Wn(n)}),s.dU=n=>({u_matrix:new la(n),u_pixels_to_tile_units:new Wd(n),u_device_pixel_ratio:new Wn(n),u_width_scale:new Wn(n),u_floor_width_scale:new Wn(n),u_units_to_pixels:new Qo(n),u_dash_image:new Gh(n),u_gradient_image:new Gh(n),u_image_height:new Wn(n),u_texsize:new Qo(n),u_tile_units_to_pixels:new Wn(n),u_alpha_discard_threshold:new Wn(n),u_trim_offset:new Qo(n),u_trim_fade_range:new Qo(n),u_trim_color:new $h(n),u_emissive_strength:new Wn(n),u_zbias_factor:new Wn(n),u_tile_to_meter:new Wn(n),u_ground_shadow_factor:new Zd(n)}),s.dV=n=>({u_camera_to_center_distance:new Wn(n),u_extrude_scale:new Wd(n),u_device_pixel_ratio:new Wn(n),u_matrix:new la(n),u_inv_rot_matrix:new la(n),u_merc_center:new Qo(n),u_tile_id:new Zd(n),u_zoom_transition:new Wn(n),u_up_dir:new Zd(n),u_emissive_strength:new Wn(n)}),s.dW=Gd,s.dX=cE,s.dY=class{constructor(n,e,i,a){this.context=n,this.format=a,this.size=i,this.texture=n.gl.createTexture();const[o,d,p]=this.size,{gl:y}=n;y.bindTexture(y.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&y.texImage3D(y.TEXTURE_3D,0,this.format,o,d,p,0,ex(this.format),tx(this.format),e.data)}bind(n,e){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_3D,this.texture),n!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,n),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},s.dZ=ig,s.d_=(n,e,i,a,o,d)=>{const p=n.transform,y=p.projection.name==="globe";let T;if(d.paint.get("circle-pitch-alignment")==="map")if(y){const M=eg(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;T=Float32Array.from([M,0,0,M])}else T=p.calculatePixelsToTileUnitsMatrix(i);else T=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(p.projection),u_matrix:n.translatePosMatrix(e.projMatrix,i,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:_o.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:tg,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(y){A.u_inv_rot_matrix=a,A.u_merc_center=o,A.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],A.u_zoom_transition=Wh(p.zoom);const M=o[0]*Vt,z=o[1]*Vt;A.u_up_dir=p.projection.upVector(new Rl(0,0,0),M,z)}return A},s.da=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},s.db=Ix,s.dc=function(n,e){return n.readFields(sA,{icons:[]},e)},s.dd=$0,s.de=Sg,s.df=xx,s.dg=Rc,s.dh=Up,s.di=ch,s.dj=dh,s.dk=rn,s.dl=function(n){const e=n.indexOf(kh);return e>=0?n.slice(0,e):n},s.dm=function(n){return n.indexOf(kh)>=0},s.dn=function(n){const e=n.lastIndexOf(kh);return e>=0?n.slice(e+1):""},s.dp=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},s.dq=function(n,e,i,a){return n.type==="custom"?new QE(n,e):new nA[n.type](n,e,i,a)},s.dr=on,s.ds=function(n){const e=n.indexOf(kh);return e>=0?n.slice(e+1):""},s.dt=class extends zg{constructor(n,e){super(n._vectorTileFeature,n._z,n._x,n._y,n.id),n.state&&(this.state=Object.assign({},n.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=n.source,this.sourceLayer=n.sourceLayer,this.layer=n.layer)}toJSON(){const n=super.toJSON();return n.target=this.target,n.namespace=this.namespace,n}},s.du=Bf,s.dv=wn,s.dw=function(n){return n({pluginStatus:qs,pluginURL:rc}),Bf.on("pluginStateChange",n),n},s.dx=Kp,s.dy=class extends Ro{constructor(n){super(n),this.current=dc}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},s.dz=_e,s.e=Vr,s.e$=function(){const n=b_;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(Ir),b_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.e0=_a,s.e1=(n,e,i,a,o,d,p,y,T,A)=>{const M=n.transform,z=M.pitch<15?jb(.07,.7,Ie((14-M.zoom)/5,0,1)):.07,P=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Fb(n,e,i,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:o,u_width_scale:d,u_floor_width_scale:p,u_image:0,u_tile_units_to_pixels:Bb(e,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:y,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(P?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:z,u_tile_to_meter:Ze(e.tileID.canonical,0),u_ground_shadow_factor:T,u_pattern_transition:A}},s.e2=(n,e,i,a,o,d,p,y,T,A)=>{const M=n.transform,z=M.calculatePixelsToTileUnitsMatrix(e),P=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",j=M.pitch<15?jb(.07,.7,Ie((14-M.zoom)/5,0,1)):.07;return{u_matrix:Fb(n,e,i,a),u_pixels_to_tile_units:z,u_device_pixel_ratio:d,u_width_scale:p,u_floor_width_scale:y,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:o,u_texsize:Vb(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Bb(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(P?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:j,u_tile_to_meter:Ze(e.tileID.canonical,0),u_ground_shadow_factor:A}},s.e3=pi,s.e4=Yd,s.e5=be,s.e6=v0,s.e7=ef,s.e8=De,s.e9=Yu,s.eA=Kr,s.eB=Tl,s.eC=function(n,e,i,a,o,d,p,y,T,A,M,z,P,j,B,W){var Y=new Z(16);return Y[0]=n,Y[1]=e,Y[2]=i,Y[3]=a,Y[4]=o,Y[5]=d,Y[6]=p,Y[7]=y,Y[8]=T,Y[9]=A,Y[10]=M,Y[11]=z,Y[12]=P,Y[13]=j,Y[14]=B,Y[15]=W,Y},s.eD=H,s.eE=ju,s.eF=jh,s.eG=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Mt(1/0,1/0),max:new Mt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const i=fm(new Mt(0,0),new Mt(Vt,Vt),n),a=[];if(e&&!dm(i,this._globalClipBounds))return a;for(const o of this._activeRegions){if(o.hiddenByOverlap||!dm(i,o))continue;const d=y_(o.min,o.max,n);a.push({min:d.min,max:d.max,sourceId:this._sourceIds[o.priority],footprint:o.footprint,footprintTileId:o.tileId,order:o.order,clipMask:o.clipMask,clipScope:o.clipScope})}return a}setSources(n){this._setSources(n.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const a of e.cache.getVisibleCoordinates()){const o=e.cache.getTile(a).buckets[e.layer];o&&o.updateFootprints(a.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const i=n.getOrder(),a=n.getClipMask(),o=n.getClipScope();for(const d of e){if(!d.footprint)continue;const p=fm(d.footprint.min,d.footprint.max,d.id);this._activeRegions.push({min:p.min,max:p.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:d.id,footprint:d.footprint,order:i,clipMask:a,clipScope:o})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||dg(e.min,i.min)||dg(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(a,o){const d=(p,y)=>p+y;return a.length-o.length||a.reduce(d,"").localeCompare(o.reduce(d,""))}(e.clipScope,i.clipScope));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const i=this._activeRegions[e],a=this._prevRegions[e];n=i.priority!==a.priority||!V0(i,a)||i.order!==a.order||i.clipMask!==a.clipMask||!ea(i.clipScope,a.clipScope),++e}}if(n){++this._updateTime;for(const i of this._activeRegions)i.order!==Jd&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const a=this._activeRegions;if(i>=a.length)return i;const o=a[i].priority;for(;i<a.length&&a[i].priority===o;)++i;return i};if(this._sourceIds.length>1){let i=0,a=e(i);for(;i!==a;){let o=i;const d=i;for(;o!==a;){const p=this._activeRegions[o];p.hiddenByOverlap=!1;for(let y=0;y<d;y++){const T=this._activeRegions[y];if(!T.hiddenByOverlap&&p.order===Jd&&dm(p,T)&&(p.hiddenByOverlap=pg(p.footprint,p.tileId,T.footprint,T.tileId),p.hiddenByOverlap))break}++o}i=a,a=e(i)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},s.eH=Jd,s.eI=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const i=new oc,a=new is,o=[],d=n+1+2,p=e[0]+1,y=e[0]+1+(1+e.length),T=(A,M,z)=>{let P=A===d-1?A-2:A===0?A:A-1;return P+=z?24575:0,[P,M]};for(let A=0;A<d;++A)i.emplaceBack(...T(A,0,!0));for(let A=0;A<p;++A)for(let M=0;M<d;++M)i.emplaceBack(...T(M,A,(M===0||M===d-1)&&!0));for(let A=0;A<e.length;++A){const M=e[A];for(let z=0;z<d;++z)i.emplaceBack(...T(z,M,!0))}for(let A=0;A<e.length;++A){const M=a.length,z=e[A]+1+2,P=new is;for(let W=0;W<z-1;W++){const Y=W===z-2,K=Y?d*(y-e.length+A-W):d;for(let re=0;re<d-1;re++){const se=W*d+re;W===0||Y||re===0||re===d-2?(P.emplaceBack(se+1,se,se+K),P.emplaceBack(se+K,se+K+1,se+1)):(a.emplaceBack(se+1,se,se+K),a.emplaceBack(se+K,se+K+1,se+1))}}const j=qn.simpleSegment(0,M,i.length,a.length-M);for(let W=0;W<P.uint16.length;W+=3)a.emplaceBack(P.uint16[W],P.uint16[W+1],P.uint16[W+2]);const B=qn.simpleSegment(0,M,i.length,a.length-M);o.push({withoutSkirts:j,withSkirts:B})}return{vertices:i,indices:a,segments:o}}_createGrid(n){const e=this._fillGridMeshWithLods(E,R);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,Jp.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new is;for(let p=0;p<=E;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new qa,a=new qa,o=new qa,d=new qa;this._poleSegments=[];for(let p=0,y=0;p<m;p++){const T=360/(1<<p);i.emplaceBack(0,-c,0,.5,0),a.emplaceBack(0,-c,0,.5,1),o.emplaceBack(0,-c,0,.5,.5),d.emplaceBack(0,-c,0,.5,.5);for(let A=0;A<=E;A++){let M=A/E,z=0;const P=zi(0,T,M),[j,B,W]=F(Ar,i_,P,c);i.emplaceBack(j,B,W,M,z),a.emplaceBack(j,B,W,M,1-z);const Y=He(P);M=.5+.5*Math.sin(Y),z=.5+.5*Math.cos(Y),o.emplaceBack(j,B,W,M,z),d.emplaceBack(j,B,W,M,1-z)}this._poleSegments.push(qn.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,Jm,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(a,Jm,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(o,Jm,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(d,Jm,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},s.eJ=__,s.eK=ke,s.eL=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.eM=Le,s.eN=ct,s.eO=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},s.eP=qr,s.eQ=k,s.eR=ii,s.eS=Bi,s.eT=function([n,e,i]){const a=Math.hypot(n,e,i),o=Math.atan2(n,i),d=.5*Math.PI-Math.acos(-e/a);return new G(J(o),J(d))},s.eU=es,s.eV=nx,s.eW=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!function(i){if(Qt==null){const a=i.navigator?i.navigator.userAgent:null;Qt=!!i.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Qt}(n)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.eX=function(n,e){yo=n,ll=e},s.eY=e_,s.eZ=Yf,s.e_=function(n){const e=[0,0,0],i=Se(new Float64Array(16));return ge(i,n.pixelMatrix,n.globeMatrix),St(e,e,i),new Mt(e[0],e[1])},s.ea=450,s.eb=7,s.ec=je,s.ed=function(n,e){if(n===e){var i=e[1],a=e[2],o=e[3],d=e[6],p=e[7],y=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=i,n[6]=e[9],n[7]=e[13],n[8]=a,n[9]=d,n[11]=e[14],n[12]=o,n[13]=p,n[14]=y}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},s.ee=JE,s.ef=yn,s.eg=Fu,s.eh=256,s.ei=Qg,s.ej=oa,s.ek=Ae,s.el=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},s.em=qa,s.en=Xo,s.eo=ps,s.ep=function(n,e,i,a,o){return Ie((n-e)/(i-e)*(o-a)+a,a,o)},s.eq=ws,s.er=function(n,e){var i=e[0],a=e[1],o=e[2],d=e[3],p=e[4],y=e[5],T=e[6],A=e[7],M=e[8],z=M*p-y*A,P=-M*d+y*T,j=A*d-p*T,B=i*z+a*P+o*j;return B?(n[0]=z*(B=1/B),n[1]=(-M*a+o*A)*B,n[2]=(y*a-o*p)*B,n[3]=P*B,n[4]=(M*i-o*T)*B,n[5]=(-y*i+o*d)*B,n[6]=j*B,n[7]=(-A*i+a*T)*B,n[8]=(p*i-a*d)*B,n):null},s.es=2,s.et=Yi,s.eu=rx,s.ev=[1,1,1],s.ew=Cg,s.ex=fa,s.ey=function(n,e,i,a){var o=e[0],d=e[1],p=e[2],y=e[3];return n[0]=o+a*(i[0]-o),n[1]=d+a*(i[1]-d),n[2]=p+a*(i[2]-p),n[3]=y+a*(i[3]-y),n},s.ez=bg,s.f=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},s.f0=function(){$0().acquire(Ir)},s.f1=Dh,s.f2=function(n,e,i=!1){if(qs===ra.deferred||qs===ra.loading||qs===ra.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");rc=_o.resolveURL(n),qs=ra.deferred,Nf=e,jf(),i||qc()},s.f3=function(n){yg=_o.resolveURL(n),xg||(xg=new lp($0(),new fu)),xg.broadcast("setMeshoptUrl",yg)},s.f4=hb,s.f5=function(n){K1=_o.resolveURL(n),xg||(xg=new lp($0(),new fu)),xg.broadcast("setDracoUrl",K1)},s.f6=ub,s.f7=Is,s.f8=function(n){const e=df();if(!e)return;const i=e.delete(Us);n&&i.then(()=>n()).catch(n)},s.f9=zo,s.fA=function(n){lu(),ga!=null&&ga.then(e=>{e.keys().then(i=>{for(let a=0;a<i.length-n;a++)e.delete(i[a]).catch(o=>cn(o.message))}).catch(i=>cn(i.message))}).catch(e=>cn(e.message))},s.fa=ri,s.fb=ys,s.fc=Ju,s.fd=O3,s.fe=k3,s.ff=Lb,s.fg=Hi,s.fh="hd_road_elevation",s.fi=kn,s.fj=Vi,s.fk=eu,s.fl=yx,s.fm=ym,s.fn=function(n,e,i,a,o,d,p,y=1,T,A,M){n.createArrays(),n.tilePixelRatio=Vt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const z=n.layers[0].layout,P=n.layers[0]._unevaluatedLayout._values,j={};j.scaleFactor=y,j.textSizeScaleRange=z.get("text-size-scale-range"),j.iconSizeScaleRange=z.get("icon-size-scale-range");const[B,W]=j.textSizeScaleRange,[Y,K]=j.iconSizeScaleRange;j.textScaleFactor=Ie(j.scaleFactor,B,W),j.iconScaleFactor=Ie(j.scaleFactor,Y,K);const re=P["text-size"],se=P["icon-size"];if(n.textSizeData.kind==="composite"){const{minZoom:Ue,maxZoom:pt}=n.textSizeData;j.compositeTextSizes=[re.possiblyEvaluate(new ir(Ue,{worldview:M}),d),re.possiblyEvaluate(new ir(pt,{worldview:M}),d)]}if(n.iconSizeData.kind==="composite"){const{minZoom:Ue,maxZoom:pt}=n.iconSizeData;j.compositeIconSizes=[se.possiblyEvaluate(new ir(Ue,{worldview:M}),d),se.possiblyEvaluate(new ir(pt,{worldview:M}),d)]}j.layoutTextSize=re.possiblyEvaluate(new ir(p+1,{worldview:M}),d),j.layoutIconSize=se.possiblyEvaluate(new ir(p+1,{worldview:M}),d),j.textMaxSize=re.possiblyEvaluate(new ir(18,{worldview:M}),d);const ue=z.get("symbol-placement"),Re=z.get("text-rotation-alignment")==="map"&&ue!=="point",Me=z.get("text-size");let Ne=!1;const Fe=[];for(const Ue of n.features){const pt=z.get("text-font").evaluate(Ue,{},d).join(","),$e=Me.evaluate(Ue,{},d)*j.textScaleFactor,yt=j.layoutTextSize.evaluate(Ue,{},d)*j.textScaleFactor,It=j.layoutIconSize.evaluate(Ue,{},d)*j.iconScaleFactor,bt={horizontal:{},vertical:void 0},Et=Ue.text;let Ot,dt=[0,0];if(Et){const mi=Et.toString(),Oi=z.get("text-letter-spacing").evaluate(Ue,{},d)*Qs,Qi=z.get("text-line-height").evaluate(Ue,{},d)*Qs,hn=Fp(mi)?Oi:0,nn=z.get("text-anchor").evaluate(Ue,{},d),ui=z.get("text-variable-anchor");if(!ui){const st=z.get("text-radial-offset").evaluate(Ue,{},d);if(st)dt=yw(nn,[st*Qs,vx]);else{const ft=z.get("text-offset").evaluate(Ue,{},d);dt=[ft[0]*Qs,ft[1]*Qs]}}let en=Re?"center":z.get("text-justify").evaluate(Ue,{},d);const An=ue==="point",fe=An?z.get("text-max-width").evaluate(Ue,{},d)*Qs:1/0,me=st=>{n.allowVerticalPlacement&&Lf(mi)&&(bt.vertical=mx(Et,e,i,o,pt,fe,Qi,nn,st,hn,dt,al.vertical,!0,yt,$e,T))};if(!Re&&ui){const st=en==="auto"?ui.map(Zt=>bx(Zt)):[en];let ft=!1;for(let Zt=0;Zt<st.length;Zt++){const $t=st[Zt];if(!bt.horizontal[$t])if(ft)bt.horizontal[$t]=bt.horizontal[0];else{const ci=mx(Et,e,i,o,pt,fe,Qi,"center",$t,hn,dt,al.horizontal,!1,yt,$e,T);ci&&(bt.horizontal[$t]=ci,ft=ci.positionedLines.length===1)}}me("left")}else{if(en==="auto"&&(en=bx(nn)),An||z.get("text-writing-mode").indexOf("horizontal")>=0||!Lf(mi)){const st=mx(Et,e,i,o,pt,fe,Qi,nn,en,hn,dt,al.horizontal,!1,yt,$e,T);st&&(bt.horizontal[en]=st)}me(An?"left":en)}}let At,at,tt,Nt,Pt,vi,ai=!1;const fi=z.get("icon-text-fit").evaluate(Ue,{},d);if(Ue.icon&&Ue.icon.hasPrimary()){const mi=vw(Ue.icon,n.iconSizeData,P["icon-size"],d,n.zoom,Ue,T,j.iconScaleFactor,M);At=mi.iconPrimary,tt=mi.iconSecondary;const Oi=At.toString();if(at=a.get(Oi),at&&(Pt=z.get("icon-offset").evaluate(Ue,{},d),vi=z.get("icon-anchor").evaluate(Ue,{},d),Ot=RE(o.get(Oi),tt?o.get(tt.toString()):void 0,Pt,vi),ai=at.sdf,n.sdfIcons===void 0?n.sdfIcons=at.sdf:n.sdfIcons!==at.sdf&&cn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(at.pixelRatio!==n.pixelRatio||z.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0)),tt){const Qi=tt.toString();Nt=a.get(Qi)}}Ne=Ne||!(!Ue.icon||!Ue.icon.hasSecondary());const Ht=wx(bt.horizontal)||bt.vertical;n.iconsInText||(n.iconsInText=!!Ht&&Ht.iconsInText);const xi=yt*j.textScaleFactor/Qs,{defaultShapedIcon:Gi,verticallyShapedIcon:Xt}=jE(n,Ot,z,Ue,d,bt,xi,Pt,fi);fi!=="none"&&Ot&&(iw(Ot)||nw(Ot))&&(sy(0,at,At,Ot,Gi,fi,A,a,o),sy(0,Nt,tt,Ot,Gi,fi,A,a,o),Xt&&(sy(0,at,At,Ot,Xt,fi,A,a,o),sy(0,Nt,tt,Ot,Xt,fi,A,a,o))),Ot=Gi,Fe.push({feature:Ue,shapedTextOrientations:bt,shapedText:Ht,shapedIcon:Ot,iconPrimary:At,iconSecondary:tt,iconOffset:Pt,iconAnchor:vi,verticallyShapedIcon:Xt,layoutTextSize:yt,layoutIconSize:It,textOffset:dt,isSDFIcon:ai,iconTextFit:fi})}return{featureData:Fe,sizes:j,hasAnySecondaryIcon:Ne,textAlongLine:Re,symbolPlacement:ue}},s.fo=dw,s.fp=function(n,e,i,a,o,d,p,y,T,A){const{featureData:M,hasAnySecondaryIcon:z,sizes:P,textAlongLine:j,symbolPlacement:B}=e;for(const W of M){const{shapedIcon:Y,verticallyShapedIcon:K,feature:re,shapedTextOrientations:se,shapedText:ue,layoutTextSize:Re,textOffset:Me,isSDFIcon:Ne,iconPrimary:Fe,iconSecondary:Ue,iconTextFit:pt,iconOffset:$e}=W;bw(Y,A.iconPositions,Fe,Ue),bw(K,A.iconPositions,Fe,Ue),NE(se,A.iconPositions),kE(Fe,Ue,A.iconPositions),(ue||Y)&&BE(n,re,se,Y,K,T,P,Re,0,Me,Ne,a,o,p,y,z,pt,$e,j,B)}i&&n.generateCollisionDebugBuffers(d,n.collisionBoxArray,P.textScaleFactor)},s.fq=Li,s.fr=Ey,s.fs=Tt,s.ft=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==fb){const i=new Uint32Array(n,0,7),[,,a,o,d,p]=i;e=i.byteLength+o+d+p+d,(a!==n.byteLength||e>=n.byteLength)&&cn("Invalid b3dm header information.")}return _b(n,e)},s.fu=function(n,e){const i=Eb(n);for(const a of i){for(const o of a.meshes)L5(o);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(O5(a.lights,e)))}return i},s.fv=xy,s.fw=wt,s.fx=Ln,s.fy=$o,s.fz=ra,s.g=function(n,e){return wn(Object.assign(n,{method:"GET"}),e)},s.h=function(n){return n.indexOf("mapbox:")===0},s.i=function(n){return Vr.API_STYLE_REGEX.test(n)&&!Ja(n)},s.j=ja,s.k=od,s.l=function(n){return decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.m=function(n,e){return wn(Object.assign(n,{type:"json"}),e)},s.n=jl,s.o=_o,s.p=function(n,e){return wn(Object.assign(n,{method:"POST"}),e)},s.q=Ks,s.r=Ba,s.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=function(){return Y1||(Y1=new zo),Y1},s.u=function(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()},s.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},s.w=cn,s.x=Nx,s.y=Bl,s.z=eo}),N(["./shared"],function(s){function q(He){const J=He?He.url.toString():void 0;return J?performance.getEntriesByName(J):[]}function Z(He){if(typeof He=="number"||typeof He=="boolean"||typeof He=="string"||He==null)return JSON.stringify(He);if(Array.isArray(He)){let ne="[";for(const _e of He)ne+=`${Z(_e)},`;return`${ne}]`}let J="{";for(const ne of Object.keys(He).sort())J+=`${ne}:${Z(He[ne])},`;return`${J}}`}function Q(He){let J="";for(const ne of s.bx)J+=`/${Z(He[ne])}`;return J}class oe{constructor(J){this.keyCache={},this._layers={},this._layerConfigs={},J&&this.replace(J)}replace(J,ne){this._layerConfigs={},this._layers={},this.update(J,[],ne)}update(J,ne,_e){this._options=_e;for(const Le of J)this._layerConfigs[Le.id]=Le,(this._layers[Le.id]=s.dq(Le,this.scope,null,this._options)).compileFilter(_e),this.keyCache[Le.id]&&delete this.keyCache[Le.id];for(const Le of ne)delete this.keyCache[Le],delete this._layerConfigs[Le],delete this._layers[Le];this.familiesBySource={};const ke=function(Le,Ie){const et={};for(let Je=0;Je<Le.length;Je++){const zt=Le[Je];let vt=Ie&&Ie[zt.id];vt||(zt.type==="symbol"?vt=zt.id:(vt=Q(zt),zt.type==="line"&&zt.paint&&function Ai(Vi){return typeof Vi=="string"&&Vi==="line-progress"||(Array.isArray(Vi)?Vi.some(Ai):!(!Vi||typeof Vi!="object")&&Object.values(Vi).some(Ai))}(zt.paint["line-width"])&&(vt+=`/${Z(zt.paint["line-width"])}`))),Ie&&(Ie[zt.id]=vt);let pi=et[vt];pi||(pi=et[vt]=[]),pi.push(zt)}const Be=[];for(const Je in et)Be.push(et[Je]);return Be}(Object.values(this._layerConfigs),this.keyCache);for(const Le of ke){const Ie=Le.map(pi=>this._layers[pi.id]),et=Ie[0];if(et.visibility==="none")continue;const Be=et.source||"";let Je=this.familiesBySource[Be];Je||(Je=this.familiesBySource[Be]={});const zt=et.sourceLayer||"_geojsonTileLayer";let vt=Je[zt];vt||(vt=Je[zt]=[]),vt.push(Ie)}}}const pe=1*s.fc;class ze{constructor(J){const ne={},_e=[];for(const et in J){const Be=J[et],Je=ne[et]={};for(const zt in Be.glyphs){const vt=Be.glyphs[+zt];if(!vt||vt.bitmap.width===0||vt.bitmap.height===0)continue;const pi=vt.metrics.localGlyph?pe:1,Ai={x:0,y:0,w:vt.bitmap.width+2*pi,h:vt.bitmap.height+2*pi};_e.push(Ai),Je[zt]=Ai}}const{w:ke,h:Le}=s.G(_e),Ie=new s.fb({width:ke||1,height:Le||1});for(const et in J){const Be=J[et];for(const Je in Be.glyphs){const zt=Be.glyphs[+Je];if(!zt||zt.bitmap.width===0||zt.bitmap.height===0)continue;const vt=ne[et][Je],pi=zt.metrics.localGlyph?pe:1;s.fb.copy(zt.bitmap,Ie,{x:0,y:0},{x:vt.x+pi,y:vt.y+pi},zt.bitmap)}}this.image=Ie,this.positions=ne}}s.fa(ze,"GlyphAtlas");class le{constructor(J){this.tileID=new s.aO(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.tileZoom=J.tileZoom,this.uid=J.uid,this.zoom=J.zoom,this.lut=J.lut,this.canonical=J.tileID.canonical,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.scope=J.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.request&&J.request.collectResourceTiming,this.promoteId=J.promoteId,this.isSymbolTile=J.isSymbolTile,this.tileTransform=s.aZ(J.tileID.canonical,J.projection),this.projection=J.projection,this.worldview=J.worldview,this.localizableLayerIds=J.localizableLayerIds,this.brightness=J.brightness,this.extraShadowCaster=!!J.extraShadowCaster,this.tessellationStep=J.tessellationStep,this.scaleFactor=J.scaleFactor,this.worldview=J.worldview}parse(J,ne,_e,ke,Le,Ie){this.status="parsing",this.data=J,this.collisionBoxArray=new s.b3;const et=new s.fd(Object.keys(J.layers).sort()),Be=new s.fe(this.tileID,this.promoteId);Be.bucketLayerIDs=[];const Je={},zt=new s.ff(256,256),vt={featureIndex:Be,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:zt,availableImages:_e,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},pi=[],Ai=ne.familiesBySource[this.source];for(const on in Ai){const rn=J.layers[on];if(!rn)continue;let ln=!1,jn=!1,cn=!1;for(const wt of Ai[on])wt[0].type==="symbol"?ln=!0:jn=!0,wt[0].is3D()&&wt[0].type!=="model"&&(cn=!0);if(this.extraShadowCaster&&!cn||this.isSymbolTile===!0&&!ln||this.isSymbolTile===!1&&!jn)continue;rn.version===1&&s.w(`Vector tile source "${this.source}" layer "${on}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const cr=et.encode(on),$n=[];let Ve=!1;for(let wt=0,Bt=0;wt<rn.length;wt++){const Qt=rn.feature(wt),bi=Be.getId(Qt,on);if(this.localizableLayerIds&&this.localizableLayerIds.has(on)){const $i=Qt.properties?Qt.properties.worldview:null;if(this.worldview&&typeof $i=="string")if($i==="all")Qt.properties.$localized=!0;else{if(!$i.split(",").includes(this.worldview))continue;Qt.properties.$localized=!0,Qt.properties.worldview=this.worldview}}!Ve&&Qt.properties&&Qt.properties.hasOwnProperty(s.fg)&&(Ve=!0),$n.push({feature:Qt,id:bi,index:Bt,sourceLayerIndex:cr}),Bt++}Ve&&!vt.elevationFeatures&&J.layers.hasOwnProperty(s.fh)&&(vt.elevationFeatures=s.fi.parseFrom(J.layers[s.fh],this.canonical));for(const wt of Ai[on]){const Bt=wt[0];if(this.extraShadowCaster&&(!Bt.is3D()||Bt.type==="model")||this.isSymbolTile!==void 0&&Bt.type==="symbol"!==this.isSymbolTile||Bt.minzoom&&this.zoom<Math.floor(Bt.minzoom)||Bt.maxzoom&&this.zoom>=Bt.maxzoom||Bt.visibility==="none")continue;Se(wt,this.zoom,vt.brightness,_e,this.worldview);const Qt=Je[Bt.id]=Bt.createBucket({index:Be.bucketLayerIDs.length,layers:wt,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:cr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:ke,worldview:this.worldview});Be.bucketLayerIDs.push(wt.map($i=>s.B($i.id,$i.scope)));let bi=Qt.prepare?Qt.prepare():null;bi!=null?(bi=bi.then(()=>Qt.populate($n,vt,this.tileID.canonical,this.tileTransform)),pi.push(bi)):Qt.populate($n,vt,this.tileID.canonical,this.tileTransform)}}const Vi=()=>{let on,rn,ln,jn,cn,cr;zt.trim();const $n={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ve=()=>{if(on)return this.status="done",Ie(on);if(this.extraShadowCaster)this.status="done",Ie(null,{buckets:Object.values(Je).filter(Bt=>!Bt.isEmpty()),featureIndex:Be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:vt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(rn&&ln&&jn){const Bt=new ze(rn),Qt=new Map;for(const[yr,Kn]of ln.entries()){const{imagePosition:ar}=s.fl(yr,Kn,s.fm);Qt.set(yr,ar)}const bi={};for(const yr in Je){const Kn=Je[yr];Kn instanceof s.b4&&(Se(Kn.layers,this.zoom,vt.brightness,_e,this.worldview),bi[yr]=s.fn(Kn,rn,Bt.positions,ln,Qt,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,cn,this.worldview))}const $i={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Le,ln,cn,()=>{$i.iconsPending=!1,wt(bi,Bt,$i)}),this.rasterizeIfNeeded(Le,jn,cr,()=>{$i.patternsPending=!1,wt(bi,Bt,$i)})}},wt=(Bt,Qt,bi,$i)=>{if(bi.iconsPending||bi.patternsPending)return;const yr=new s.fo(ln,jn,this.lut);for(const Kn in Je){const ar=Je[Kn];if(Kn in Bt)s.fp(ar,Bt[Kn],this.showCollisionBoxes,_e,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,ln,yr);else if(ar.hasPattern&&(ar instanceof s.ba||ar instanceof s.bb||ar instanceof s.e7)){Se(ar.layers,this.zoom,vt.brightness,_e,this.worldview);const Sr=Object.fromEntries(yr.patternPositions);ar.addFeatures(vt,this.tileID.canonical,Sr,_e,this.tileTransform,this.brightness)}}this.status="done",Ie(null,{buckets:Object.values(Je).filter(Kn=>!Kn.isEmpty()),featureIndex:Be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Qt.image,lineAtlas:zt,imageAtlas:yr,brightness:vt.brightness})};if(!this.extraShadowCaster){const Bt=s.fj(vt.glyphDependencies,$i=>Object.keys($i).map(Number));Object.keys(Bt).length?Le.send("getGlyphs",{uid:this.uid,stacks:Bt},($i,yr)=>{on||(on=$i,rn=yr,Ve())},void 0,!1,$n):rn={};const Qt=Array.from(vt.iconDependencies.keys()).map($i=>s.I.parse($i));Qt.length?Le.send("getImages",{images:Qt,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},($i,yr)=>{on||(on=$i,ln=new Map,cn=this.updateImageMapAndGetImageTaskQueue(ln,yr,vt.iconDependencies),Ve())},void 0,!1,$n):(ln=new Map,cn=new Map);const bi=Array.from(vt.patternDependencies.keys()).map($i=>s.I.parse($i));bi.length?Le.send("getImages",{images:bi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},($i,yr)=>{on||(on=$i,jn=new Map,cr=this.updateImageMapAndGetImageTaskQueue(jn,yr,vt.patternDependencies),Ve())},void 0,!1,$n):(jn=new Map,cr=new Map)}if(vt.elevationFeatures&&vt.elevationFeatures.length>0){const Bt=[];for(const bi of Object.values(Je))if(bi instanceof s.bb){const $i=bi.getUnevaluatedPortalGraph();$i&&Bt.push($i)}const Qt=s.fk.evaluate(Bt);for(const bi of Object.values(Je))if(bi instanceof s.bb){const $i=J.layers[et.decode(bi.sourceLayerIndex)];bi.setEvaluatedPortalGraph(Qt,$i,this.tileID.canonical,vt.availableImages,vt.brightness)}}Ve()};pi.length>0?Promise.allSettled(pi).then(Vi).catch(Ie):Vi()}rasterizeIfNeeded(J,ne,_e,ke){Array.from(ne.values()).some(Le=>Le.usvg)?this.rasterize(J,ne,_e,ke):ke()}updateImageMapAndGetImageTaskQueue(J,ne,_e){const ke=new Map;for(const Le of ne.keys()){const Ie=_e.get(Le)||[];for(const et of Ie){const Be=et.toString(),Je=ne.get(et.id.toString());Je.usvg?ke.has(Be)||(ke.set(Be,et),J.set(Be,Object.assign({},Je))):J.set(Be,Je)}}return ke}rasterize(J,ne,_e,ke){this.rasterizeTask=J.send("rasterizeImages",{scope:this.scope,tasks:_e},(Le,Ie)=>{if(!Le)for(const[et,Be]of Ie.entries()){const Je=Object.assign(ne.get(et),{data:Be});ne.set(et,Je)}ke()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Se(He,J,ne,_e,ke){const Le=new s.ac(J,{brightness:ne,worldview:ke});for(const Ie of He)Ie.recalculate(Le,_e)}class te extends s.E{constructor(J,ne,_e,ke,Le,Ie,et){super(),this.actor=J,this.layerIndex=ne,this.availableImages=_e,this.availableModels=ke,this.loadVectorData=Ie||s.aL,this.loading={},this.loaded={},this.deduped=new s.aK(J.scheduler),this.isSpriteLoaded=Le,this.scheduler=J.scheduler,this.brightness=et}loadTile(J,ne){const _e=J.uid,ke=J&&J.request,Le=ke&&ke.collectResourceTiming,Ie=this.loading[_e]=new le(J);Ie.abort=this.loadVectorData(J,(et,Be)=>{const Je=!this.loading[_e];if(delete this.loading[_e],Ie.cancelRasterize(),Je||et||!Be)return Ie.status="done",Je||(this.loaded[_e]=Ie),ne(et);const zt=Be.rawData,vt={};Be.expires&&(vt.expires=Be.expires),Be.cacheControl&&(vt.cacheControl=Be.cacheControl),Ie.vectorTile=Be.vectorTile||new s.fq(new s.bt(zt));const pi=()=>{Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Ai,Vi)=>{if(Ai||!Vi)return ne(Ai);const on={};if(Le){const rn=q(ke);rn.length>0&&(on.resourceTiming=JSON.parse(JSON.stringify(rn)))}ne(null,Object.assign({rawTileData:zt.slice(0)},Vi,vt,on))})};this.isSpriteLoaded?pi():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(pi,{type:"parseTile",isSymbolTile:J.isSymbolTile,zoom:J.tileZoom}):pi()}),this.loaded=this.loaded||{},this.loaded[_e]=Ie})}reloadTile(J,ne){const _e=this.loaded,ke=J.uid;if(_e&&_e[ke]){const Le=_e[ke];Le.scaleFactor=J.scaleFactor,Le.showCollisionBoxes=J.showCollisionBoxes,Le.projection=J.projection,Le.brightness=J.brightness,Le.tileTransform=s.aZ(J.tileID.canonical,J.projection),Le.extraShadowCaster=J.extraShadowCaster,Le.lut=J.lut,Le.worldview=J.worldview;const Ie=(et,Be)=>{const Je=Le.reloadCallback;Je&&(delete Le.reloadCallback,Le.parse(Le.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Je)),ne(et,Be)};Le.status==="parsing"?Le.reloadCallback=Ie:Le.status==="done"&&(Le.vectorTile?Le.parse(Le.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ie):Ie())}else ne(null,void 0)}abortTile(J,ne){const _e=J.uid,ke=this.loading[_e];ke&&(ke.abort&&ke.abort(),delete this.loading[_e]),ne()}removeTile(J,ne){const _e=this.loaded,ke=J.uid;_e&&_e[ke]&&delete _e[ke],ne()}}class ge{loadTile(J,ne){const{uid:_e,encoding:ke,rawImageData:Le,padding:Ie}=J,et=ImageBitmap&&Le instanceof ImageBitmap?this.getImageData(Le,Ie):Le;ne(null,new s.fr(_e,et,ke,Ie<1))}reloadTile(J,ne){ne(null,null)}abortTile(J,ne){ne()}removeTile(J,ne){ne()}getImageData(J,ne){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(J.width,J.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=J.width,this.offscreenCanvas.height=J.height,this.offscreenCanvasContext.drawImage(J,0,0,J.width,J.height);const _e=this.offscreenCanvasContext.getImageData(-ne,-ne,J.width+2*ne,J.height+2*ne);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),_e}}s.bs.setPbf(s.bt);class xe{constructor(J){this._mrt=new s.bs(J.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=J.uid,this.tileID=J.tileID,this.source=J.source}parse(J,ne){const _e=this._mrt;this.status="parsing",this._entireBuffer=J;try{_e.parseHeader(J),this._isHeaderLoaded=!0;const ke=[];for(const Le in _e.layers){const Ie=_e.getLayer(Le),et=Ie.getDataRange(Ie.getBandList()),Be=_e.createDecodingTask(et),Je=J.slice(et.firstByte,et.lastByte+1),zt=s.bs.performDecoding(Je,Be).then(vt=>Be.complete(null,vt)).catch(vt=>Be.complete(vt,null));ke.push(zt)}Promise.allSettled(ke).then(()=>ne(null,_e)).catch(Le=>ne(Le))}catch(ke){ne(ke)}}}class ye{constructor(J){this.actor=J,this.loading={},this.loaded={}}loadTile(J,ne){const _e=J.uid,ke=J.request,Le=this.loading[_e]=new xe(J),{cancel:Ie}=s.bu(ke,(et,Be,Je,zt)=>{const vt=!this.loading[_e];if(delete this.loading[_e],vt||et||!Be)return Le.status="done",vt||(this.loaded[_e]=Le),ne(et);Le.parse(Be,(pi,Ai)=>{if(pi||!Ai)return ne(pi);ne(null,Ai,Je,zt)}),this.loaded[_e]=Le});Le.abort=Ie}reloadTile(J,ne){ne(null,void 0)}abortTile(J,ne){const _e=J.uid,ke=this.loading[_e];ke&&(ke.abort&&ke.abort(),delete this.loading[_e]),ne()}removeTile(J,ne){const _e=J.uid;this.loaded[_e]&&delete this.loaded[_e],ne()}decodeRasterArray(J,ne){s.bs.performDecoding(J.buffer,J.task).then(_e=>ne(null,_e)).catch(_e=>ne(_e))}}const Pe=s.fs.prototype.toGeoJSON;class Ae{constructor(J){this._feature=J,this.extent=s.al,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))}loadGeometry(){if(this._feature.type===1){const J=[];for(const ne of this._feature.geometry)J.push([new s.P(ne[0],ne[1])]);return J}{const J=[];for(const ne of this._feature.geometry){const _e=[];for(const ke of ne)_e.push(new s.P(ke[0],ke[1]));J.push(_e)}return J}}toGeoJSON(J,ne,_e){return Pe.call(this,J,ne,_e)}}class Ke{constructor(J,ne){this.name=J,this.extent=s.al,this.length=ne.length,this._jsonFeatures=ne}feature(J){return new Ae(this._jsonFeatures[J])}}class it{constructor(J){this.layers={},this.extent=s.al;for(const ne of Object.keys(J))this.layers[ne]=new Ke(ne,J[ne])}}const rt=64/4096,ut=128;class Lt{constructor(){this.features=new Map}clear(){this.features.clear()}load(J=[],ne){for(const _e of J){const ke=_e.id;if(ke==null)continue;let Le=this.features.get(ke);Le&&this.updateCache(Le,ne),_e.geometry?(Le=Jt(_e),this.updateCache(Le,ne),this.features.set(ke,Le)):this.features.delete(ke),this.updateCache(Le,ne)}}updateCache(J,ne){for(const{canonical:_e,uid:ke}of Object.values(ne)){const{z:Le,x:Ie,y:et}=_e;lt(J,Math.pow(2,Le),Ie,et)&&delete ne[ke]}}getTile(J,ne,_e){const ke=Math.pow(2,J),Le=[];for(const Ie of this.features.values())lt(Ie,ke,ne,_e)&&Le.push(Wt(Ie,ke,ne,_e));return{features:Le}}getFeatures(){return[...this.features.values()]}}function lt({minX:He,minY:J,maxX:ne,maxY:_e},ke,Le,Ie){return He<(Le+1+rt)/ke&&J<(Ie+1+rt)/ke&&ne>(Le-rt)/ke&&_e>(Ie-rt)/ke}function Jt(He){const{id:J,geometry:ne,properties:_e}=He;if(!ne)return;if(ne.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ke,coordinates:Le}=ne,Ie={id:J,type:1,geometry:[],tags:_e,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},et=Ie.geometry;if(ke==="Point")wi(Le,et,Ie);else if(ke==="MultiPoint")for(const Be of Le)wi(Be,et,Ie);else if(ke==="LineString")Ie.type=2,Fi(Le,et,Ie);else if(ke==="MultiLineString")Ie.type=2,Bi(Le,et,Ie);else if(ke==="Polygon")Ie.type=3,Bi(Le,et,Ie,!0);else{if(ke!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ie.type=3;for(const Be of Le)Bi(Be,et,Ie,!0)}return Ie}function wi([He,J],ne,_e){const ke=s.aF(He);let Le=s.aJ(J);Le=Le<0?0:Le>1?1:Le,ne.push(ke,Le),_e.minX=Math.min(_e.minX,ke),_e.minY=Math.min(_e.minY,Le),_e.maxX=Math.max(_e.maxX,ke),_e.maxY=Math.max(_e.maxY,Le)}function Fi(He,J,ne,_e=!1,ke=!1){const Le=[];for(const Ie of He)wi(Ie,Le,ne);J.push(Le),_e&&function(Ie,et){let Be=0;for(let Je=0,zt=Ie.length,vt=zt-2;Je<zt;vt=Je,Je+=2)Be+=(Ie[Je]-Ie[vt])*(Ie[Je+1]+Ie[vt+1]);if(Be>0===et)for(let Je=0,zt=Ie.length;Je<zt/2;Je+=2){const vt=Ie[Je],pi=Ie[Je+1];Ie[Je]=Ie[zt-2-Je],Ie[Je+1]=Ie[zt-1-Je],Ie[zt-2-Je]=vt,Ie[zt-1-Je]=pi}}(Le,ke)}function Bi(He,J,ne,_e=!1){for(let ke=0;ke<He.length;ke++)Fi(He[ke],J,ne,_e,ke===0)}function Wt(He,J,ne,_e){const{id:ke,type:Le,geometry:Ie,tags:et}=He,Be=[];if(Le===1)(function(Je,zt,vt,pi,Ai){for(let Vi=0;Vi<Je.length;Vi+=2){const on=Math.round(s.al*(Je[Vi+0]*zt-vt)),rn=Math.round(s.al*(Je[Vi+1]*zt-pi));Ai.push([on,rn])}})(Ie,J,ne,_e,Be);else for(const Je of Ie)ki(Je,J,ne,_e,Be);return{id:ke,type:Le,geometry:Be,tags:et}}function ki(He,J,ne,_e,ke){const Ie=s.al+ut;let et;for(let Be=0;Be<He.length-2;Be+=2){let Je=Math.round(s.al*(He[Be+0]*J-ne)),zt=Math.round(s.al*(He[Be+1]*J-_e)),vt=Math.round(s.al*(He[Be+2]*J-ne)),pi=Math.round(s.al*(He[Be+3]*J-_e));const Ai=vt-Je,Vi=pi-zt;Je<-128&&vt<-128||(Je<-128?(zt+=Math.round(Vi*((-128-Je)/Ai)),Je=-128):vt<-128&&(pi=zt+Math.round(Vi*((-128-Je)/Ai)),vt=-128),zt<-128&&pi<-128||(zt<-128?(Je+=Math.round(Ai*((-128-zt)/Vi)),zt=-128):pi<-128&&(vt=Je+Math.round(Ai*((-128-zt)/Vi)),pi=-128),Je>=Ie&&vt>=Ie||(Je>=Ie?(zt+=Math.round(Vi*((Ie-Je)/Ai)),Je=Ie):vt>=Ie&&(pi=zt+Math.round(Vi*((Ie-Je)/Ai)),vt=Ie),zt>=Ie&&pi>=Ie||(zt>=Ie?(Je+=Math.round(Ai*((Ie-zt)/Vi)),zt=Ie):pi>=Ie&&(vt=Je+Math.round(Ai*((Ie-zt)/Vi)),pi=Ie),et&&Je===et[et.length-1][0]&&zt===et[et.length-1][1]||(et=[[Je,zt]],ke.push(et)),et.push([vt,pi])))))}}function Ui({name:He,features:J},ne){ne.writeStringField(1,He),ne.writeVarintField(5,s.al);const _e=new Map,ke=new Map,Le={keys:_e,values:ke,feature:null};for(const Ie of J)Le.feature=Ie,ne.writeMessage(2,Cn,Le);for(const Ie of _e.keys())ne.writeStringField(3,Ie);for(const Ie of ke.keys())ne.writeMessage(4,ii,Ie)}function Cn(He,J){const ne=He.feature;ne.id!==void 0&&Number.isSafeInteger(+ne.id)&&J.writeVarintField(1,+ne.id),ne.tags&&J.writeMessage(2,Qe,He),J.writeVarintField(3,ne.type),J.writeMessage(4,Zi,ne)}function Qe({keys:He,values:J,feature:ne},_e){for(const ke of Object.keys(ne.tags)){let Le=ne.tags[ke];if(Le===null)continue;let Ie=He.get(ke);Ie===void 0&&(Ie=He.size,He.set(ke,Ie)),_e.writeVarint(Ie);const et=typeof Le;et!=="string"&&et!=="boolean"&&et!=="number"&&(Le=JSON.stringify(Le));let Be=J.get(Le);Be===void 0&&(Be=J.size,J.set(Le,Be)),_e.writeVarint(Be)}}function Ft(He,J){return(J<<3)+(7&He)}function Di(He){return He<<1^He>>31}function Zi(He,J){const{geometry:ne,type:_e}=He;let ke=0,Le=0;if(_e===1){J.writeVarint(Ft(1,ne.length));for(const Ie of ne){const et=Ie[0]-ke,Be=Ie[1]-Le;J.writeVarint(Di(et)),J.writeVarint(Di(Be)),ke+=et,Le+=Be}}else for(const Ie of ne){J.writeVarint(Ft(1,1));const et=Ie.length-(_e===3?1:0);for(let Be=0;Be<et;Be++){Be===1&&J.writeVarint(Ft(2,et-1));const Je=Ie[Be][0]-ke,zt=Ie[Be][1]-Le;J.writeVarint(Di(Je)),J.writeVarint(Di(zt)),ke+=Je,Le+=zt}_e===3&&J.writeVarint(Ft(7,1))}}function ii(He,J){const ne=typeof He;ne==="string"?J.writeStringField(1,He):ne==="boolean"?J.writeBooleanField(7,He):ne==="number"&&(He%1!=0?J.writeDoubleField(3,He):He<0?J.writeSVarintField(6,He):J.writeVarintField(5,He))}const Yi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:He=>He},Ti=Math.fround||(Mi=new Float32Array(1),He=>(Mi[0]=+He,Mi[0]));var Mi;const Ii=3,xt=5,St=6;class Ei{constructor(J){this.options=Object.assign(Object.create(Yi),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){const{log:ne,minZoom:_e,maxZoom:ke}=this.options;ne&&console.time("total time");const Le=`prepare ${J.length} points`;ne&&console.time(Le),this.points=J;const Ie=[];for(let Be=0;Be<J.length;Be++){const Je=J[Be];if(!Je.geometry)continue;const[zt,vt]=Je.geometry.coordinates,pi=Ti(Nn(zt)),Ai=Ti(In(vt));Ie.push(pi,Ai,1/0,Be,-1,1),this.options.reduce&&Ie.push(0)}let et=this.trees[ke+1]=this._createTree(Ie);ne&&console.timeEnd(Le);for(let Be=ke;Be>=_e;Be--){const Je=+Date.now();et=this.trees[Be]=this._createTree(this._cluster(et,Be)),ne&&console.log("z%d: %d clusters in %dms",Be,et.numItems,+Date.now()-Je)}return ne&&console.timeEnd("total time"),this}getClusters(J,ne){let _e=((J[0]+180)%360+360)%360-180;const ke=Math.max(-90,Math.min(90,J[1]));let Le=J[2]===180?180:((J[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)_e=-180,Le=180;else if(_e>Le){const vt=this.getClusters([_e,ke,180,Ie],ne),pi=this.getClusters([-180,ke,Le,Ie],ne);return vt.concat(pi)}const et=this.trees[this._limitZoom(ne)],Be=et.range(Nn(_e),In(Ie),Nn(Le),In(ke)),Je=et.data,zt=[];for(const vt of Be){const pi=this.stride*vt;zt.push(Je[pi+xt]>1?Sn(Je,pi,this.clusterProps):this.points[Je[pi+Ii]])}return zt}getChildren(J){const ne=this._getOriginId(J),_e=this._getOriginZoom(J),ke="No cluster with the specified id.",Le=this.trees[_e];if(!Le)throw new Error(ke);const Ie=Le.data;if(ne*this.stride>=Ie.length)throw new Error(ke);const et=this.options.radius/(this.options.extent*Math.pow(2,_e-1)),Be=Le.within(Ie[ne*this.stride],Ie[ne*this.stride+1],et),Je=[];for(const zt of Be){const vt=zt*this.stride;Ie[vt+4]===J&&Je.push(Ie[vt+xt]>1?Sn(Ie,vt,this.clusterProps):this.points[Ie[vt+Ii]])}if(Je.length===0)throw new Error(ke);return Je}getLeaves(J,ne,_e){const ke=[];return this._appendLeaves(ke,J,ne=ne||10,_e=_e||0,0),ke}getTile(J,ne,_e){const ke=this.trees[this._limitZoom(J)],Le=Math.pow(2,J),{extent:Ie,radius:et}=this.options,Be=et/Ie,Je=(_e-Be)/Le,zt=(_e+1+Be)/Le,vt={features:[]};return this._addTileFeatures(ke.range((ne-Be)/Le,Je,(ne+1+Be)/Le,zt),ke.data,ne,_e,Le,vt),ne===0&&this._addTileFeatures(ke.range(1-Be/Le,Je,1,zt),ke.data,Le,_e,Le,vt),ne===Le-1&&this._addTileFeatures(ke.range(0,Je,Be/Le,zt),ke.data,-1,_e,Le,vt),vt.features.length?vt:null}getClusterExpansionZoom(J){let ne=this._getOriginZoom(J)-1;for(;ne<=this.options.maxZoom;){const _e=this.getChildren(J);if(ne++,_e.length!==1)break;J=_e[0].properties.cluster_id}return ne}_appendLeaves(J,ne,_e,ke,Le){const Ie=this.getChildren(ne);for(const et of Ie){const Be=et.properties;if(Be&&Be.cluster?Le+Be.point_count<=ke?Le+=Be.point_count:Le=this._appendLeaves(J,Be.cluster_id,_e,ke,Le):Le<ke?Le++:J.push(et),J.length===_e)break}return Le}_createTree(J){const ne=new s.c3(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let _e=0;_e<J.length;_e+=this.stride)ne.add(J[_e],J[_e+1]);return ne.finish(),ne.data=J,ne}_addTileFeatures(J,ne,_e,ke,Le,Ie){for(const et of J){const Be=et*this.stride,Je=ne[Be+xt]>1;let zt,vt,pi;if(Je)zt=Mn(ne,Be,this.clusterProps),vt=ne[Be],pi=ne[Be+1];else{const on=this.points[ne[Be+Ii]];zt=on.properties;const[rn,ln]=on.geometry.coordinates;vt=Nn(rn),pi=In(ln)}const Ai={type:1,geometry:[[Math.round(this.options.extent*(vt*Le-_e)),Math.round(this.options.extent*(pi*Le-ke))]],tags:zt};let Vi;Vi=Je||this.options.generateId?ne[Be+Ii]:this.points[ne[Be+Ii]].id,Vi!==void 0&&(Ai.id=Vi),Ie.features.push(Ai)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,ne){const{radius:_e,extent:ke,reduce:Le,minPoints:Ie}=this.options,et=_e/(ke*Math.pow(2,ne)),Be=J.data,Je=[],zt=this.stride;for(let vt=0;vt<Be.length;vt+=zt){if(Be[vt+2]<=ne)continue;Be[vt+2]=ne;const pi=Be[vt],Ai=Be[vt+1],Vi=J.within(Be[vt],Be[vt+1],et),on=Be[vt+xt];let rn=on;for(const ln of Vi){const jn=ln*zt;Be[jn+2]>ne&&(rn+=Be[jn+xt])}if(rn>on&&rn>=Ie){let ln,jn=pi*on,cn=Ai*on,cr=-1;const $n=(vt/zt<<5)+(ne+1)+this.points.length;for(const Ve of Vi){const wt=Ve*zt;if(Be[wt+2]<=ne)continue;Be[wt+2]=ne;const Bt=Be[wt+xt];jn+=Be[wt]*Bt,cn+=Be[wt+1]*Bt,Be[wt+4]=$n,Le&&(ln||(ln=this._map(Be,vt,!0),cr=this.clusterProps.length,this.clusterProps.push(ln)),Le(ln,this._map(Be,wt)))}Be[vt+4]=$n,Je.push(jn/rn,cn/rn,1/0,$n,-1,rn),Le&&Je.push(cr)}else{for(let ln=0;ln<zt;ln++)Je.push(Be[vt+ln]);if(rn>1)for(const ln of Vi){const jn=ln*zt;if(!(Be[jn+2]<=ne)){Be[jn+2]=ne;for(let cn=0;cn<zt;cn++)Je.push(Be[jn+cn])}}}}return Je}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,ne,_e){if(J[ne+xt]>1){const Ie=this.clusterProps[J[ne+St]];return _e?Object.assign({},Ie):Ie}const ke=this.points[J[ne+Ii]].properties,Le=this.options.map(ke);return _e&&Le===ke?Object.assign({},Le):Le}}function Sn(He,J,ne){return{type:"Feature",id:He[J+Ii],properties:Mn(He,J,ne),geometry:{type:"Point",coordinates:[(_e=He[J],360*(_e-.5)),qr(He[J+1])]}};var _e}function Mn(He,J,ne){const _e=He[J+xt],ke=_e>=1e4?`${Math.round(_e/1e3)}k`:_e>=1e3?Math.round(_e/100)/10+"k":_e,Le=He[J+St],Ie=Le===-1?{}:Object.assign({},ne[Le]);return Object.assign(Ie,{cluster:!0,cluster_id:He[J+Ii],point_count:_e,point_count_abbreviated:ke})}function Nn(He){return He/360+.5}function In(He){const J=Math.sin(He*Math.PI/180),ne=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return ne<0?0:ne>1?1:ne}function qr(He){const J=(180-360*He)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function bs(He,J,ne,_e){let ke=_e;const Le=J+(ne-J>>1);let Ie,et=ne-J;const Be=He[J],Je=He[J+1],zt=He[ne],vt=He[ne+1];for(let pi=J+3;pi<ne;pi+=3){const Ai=fa(He[pi],He[pi+1],Be,Je,zt,vt);if(Ai>ke)Ie=pi,ke=Ai;else if(Ai===ke){const Vi=Math.abs(pi-Le);Vi<et&&(Ie=pi,et=Vi)}}ke>_e&&(Ie-J>3&&bs(He,J,Ie,_e),He[Ie+2]=ke,ne-Ie>3&&bs(He,Ie,ne,_e))}function fa(He,J,ne,_e,ke,Le){let Ie=ke-ne,et=Le-_e;if(Ie!==0||et!==0){const Be=((He-ne)*Ie+(J-_e)*et)/(Ie*Ie+et*et);Be>1?(ne=ke,_e=Le):Be>0&&(ne+=Ie*Be,_e+=et*Be)}return Ie=He-ne,et=J-_e,Ie*Ie+et*et}function Un(He,J,ne,_e){const ke={id:He??null,type:J,geometry:ne,tags:_e,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(J==="Point"||J==="MultiPoint"||J==="LineString")es(ke,ne);else if(J==="Polygon")es(ke,ne[0]);else if(J==="MultiLineString")for(const Le of ne)es(ke,Le);else if(J==="MultiPolygon")for(const Le of ne)es(ke,Le[0]);return ke}function es(He,J){for(let ne=0;ne<J.length;ne+=3)He.minX=Math.min(He.minX,J[ne]),He.minY=Math.min(He.minY,J[ne+1]),He.maxX=Math.max(He.maxX,J[ne]),He.maxY=Math.max(He.maxY,J[ne+1])}function js(He,J,ne,_e){if(!J.geometry)return;const ke=J.geometry.coordinates;if(ke&&ke.length===0)return;const Le=J.geometry.type,Ie=Math.pow(ne.tolerance/((1<<ne.maxZoom)*ne.extent),2);let et=[],Be=J.id;if(ne.promoteId?Be=J.properties[ne.promoteId]:ne.generateId&&(Be=_e||0),Le==="Point")po(ke,et);else if(Le==="MultiPoint")for(const Je of ke)po(Je,et);else if(Le==="LineString")mo(ke,et,Ie,!1);else if(Le==="MultiLineString"){if(ne.lineMetrics){for(const Je of ke)et=[],mo(Je,et,Ie,!1),He.push(Un(Be,"LineString",et,J.properties));return}As(ke,et,Ie,!1)}else if(Le==="Polygon")As(ke,et,Ie,!0);else{if(Le!=="MultiPolygon"){if(Le==="GeometryCollection"){for(const Je of J.geometry.geometries)js(He,{id:Be,geometry:Je,properties:J.properties},ne,_e);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Je of ke){const zt=[];As(Je,zt,Ie,!0),et.push(zt)}}He.push(Un(Be,Le,et,J.properties))}function po(He,J){J.push(ws(He[0]),Gr(He[1]),0)}function mo(He,J,ne,_e){let ke,Le,Ie=0;for(let Be=0;Be<He.length;Be++){const Je=ws(He[Be][0]),zt=Gr(He[Be][1]);J.push(Je,zt,0),Be>0&&(Ie+=_e?(ke*zt-Je*Le)/2:Math.sqrt(Math.pow(Je-ke,2)+Math.pow(zt-Le,2))),ke=Je,Le=zt}const et=J.length-3;J[2]=1,bs(J,0,et,ne),J[et+2]=1,J.size=Math.abs(Ie),J.start=0,J.end=J.size}function As(He,J,ne,_e){for(let ke=0;ke<He.length;ke++){const Le=[];mo(He[ke],Le,ne,_e),J.push(Le)}}function ws(He){return He/360+.5}function Gr(He){const J=Math.sin(He*Math.PI/180),ne=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return ne<0?0:ne>1?1:ne}function Yr(He,J,ne,_e,ke,Le,Ie,et){if(_e/=J,Le>=(ne/=J)&&Ie<_e)return He;if(Ie<ne||Le>=_e)return null;const Be=[];for(const Je of He){const zt=Je.geometry;let vt=Je.type;const pi=ke===0?Je.minX:Je.minY,Ai=ke===0?Je.maxX:Je.maxY;if(pi>=ne&&Ai<_e){Be.push(Je);continue}if(Ai<ne||pi>=_e)continue;let Vi=[];if(vt==="Point"||vt==="MultiPoint")Bs(zt,Vi,ne,_e,ke);else if(vt==="LineString")Fs(zt,Vi,ne,_e,ke,!1,et.lineMetrics);else if(vt==="MultiLineString")Or(zt,Vi,ne,_e,ke,!1);else if(vt==="Polygon")Or(zt,Vi,ne,_e,ke,!0);else if(vt==="MultiPolygon")for(const on of zt){const rn=[];Or(on,rn,ne,_e,ke,!0),rn.length&&Vi.push(rn)}if(Vi.length){if(et.lineMetrics&&vt==="LineString"){for(const on of Vi)Be.push(Un(Je.id,vt,on,Je.tags));continue}vt!=="LineString"&&vt!=="MultiLineString"||(Vi.length===1?(vt="LineString",Vi=Vi[0]):vt="MultiLineString"),vt!=="Point"&&vt!=="MultiPoint"||(vt=Vi.length===3?"Point":"MultiPoint"),Be.push(Un(Je.id,vt,Vi,Je.tags))}}return Be.length?Be:null}function Bs(He,J,ne,_e,ke){for(let Le=0;Le<He.length;Le+=3){const Ie=He[Le+ke];Ie>=ne&&Ie<=_e&&Ea(J,He[Le],He[Le+1],He[Le+2])}}function Fs(He,J,ne,_e,ke,Le,Ie){let et=Sa(He);const Be=ke===0?Ya:ss;let Je,zt,vt=He.start;for(let rn=0;rn<He.length-3;rn+=3){const ln=He[rn],jn=He[rn+1],cn=He[rn+2],cr=He[rn+3],$n=He[rn+4],Ve=ke===0?ln:jn,wt=ke===0?cr:$n;let Bt=!1;Ie&&(Je=Math.sqrt(Math.pow(ln-cr,2)+Math.pow(jn-$n,2))),Ve<ne?wt>ne&&(zt=Be(et,ln,jn,cr,$n,ne),Ie&&(et.start=vt+Je*zt)):Ve>_e?wt<_e&&(zt=Be(et,ln,jn,cr,$n,_e),Ie&&(et.start=vt+Je*zt)):Ea(et,ln,jn,cn),wt<ne&&Ve>=ne&&(zt=Be(et,ln,jn,cr,$n,ne),Bt=!0),wt>_e&&Ve<=_e&&(zt=Be(et,ln,jn,cr,$n,_e),Bt=!0),!Le&&Bt&&(Ie&&(et.end=vt+Je*zt),J.push(et),et=Sa(He)),Ie&&(vt+=Je)}let pi=He.length-3;const Ai=He[pi],Vi=He[pi+1],on=ke===0?Ai:Vi;on>=ne&&on<=_e&&Ea(et,Ai,Vi,He[pi+2]),pi=et.length-3,Le&&pi>=3&&(et[pi]!==et[0]||et[pi+1]!==et[1])&&Ea(et,et[0],et[1],et[2]),et.length&&J.push(et)}function Sa(He){const J=[];return J.size=He.size,J.start=He.start,J.end=He.end,J}function Or(He,J,ne,_e,ke,Le){for(const Ie of He)Fs(Ie,J,ne,_e,ke,Le,!1)}function Ea(He,J,ne,_e){He.push(J,ne,_e)}function Ya(He,J,ne,_e,ke,Le){const Ie=(Le-J)/(_e-J);return Ea(He,Le,ne+(ke-ne)*Ie,1),Ie}function ss(He,J,ne,_e,ke,Le){const Ie=(Le-ne)/(ke-ne);return Ea(He,J+(_e-J)*Ie,Le,1),Ie}function Ka(He,J){const ne=[];for(let _e=0;_e<He.length;_e++){const ke=He[_e],Le=ke.type;let Ie;if(Le==="Point"||Le==="MultiPoint"||Le==="LineString")Ie=Ls(ke.geometry,J);else if(Le==="MultiLineString"||Le==="Polygon"){Ie=[];for(const et of ke.geometry)Ie.push(Ls(et,J))}else if(Le==="MultiPolygon"){Ie=[];for(const et of ke.geometry){const Be=[];for(const Je of et)Be.push(Ls(Je,J));Ie.push(Be)}}ne.push(Un(ke.id,Le,Ie,ke.tags))}return ne}function Ls(He,J){const ne=[];ne.size=He.size,He.start!==void 0&&(ne.start=He.start,ne.end=He.end);for(let _e=0;_e<He.length;_e+=3)ne.push(He[_e]+J,He[_e+1],He[_e+2]);return ne}function hs(He,J){if(He.transformed)return He;const ne=1<<He.z,_e=He.x,ke=He.y;for(const Le of He.features){const Ie=Le.geometry,et=Le.type;if(Le.geometry=[],et===1)for(let Be=0;Be<Ie.length;Be+=2)Le.geometry.push(fr(Ie[Be],Ie[Be+1],J,ne,_e,ke));else for(let Be=0;Be<Ie.length;Be++){const Je=[];for(let zt=0;zt<Ie[Be].length;zt+=2)Je.push(fr(Ie[Be][zt],Ie[Be][zt+1],J,ne,_e,ke));Le.geometry.push(Je)}}return He.transformed=!0,He}function fr(He,J,ne,_e,ke,Le){return[Math.round(ne*(He*_e-ke)),Math.round(ne*(J*_e-Le))]}function as(He,J,ne,_e,ke){const Le=J===ke.maxZoom?0:ke.tolerance/((1<<J)*ke.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:He.length,source:null,x:ne,y:_e,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const et of He)bc(Ie,et,Le,ke);return Ie}function bc(He,J,ne,_e){const ke=J.geometry,Le=J.type,Ie=[];if(He.minX=Math.min(He.minX,J.minX),He.minY=Math.min(He.minY,J.minY),He.maxX=Math.max(He.maxX,J.maxX),He.maxY=Math.max(He.maxY,J.maxY),Le==="Point"||Le==="MultiPoint")for(let et=0;et<ke.length;et+=3)Ie.push(ke[et],ke[et+1]),He.numPoints++,He.numSimplified++;else if(Le==="LineString")ka(Ie,ke,He,ne,!1,!1);else if(Le==="MultiLineString"||Le==="Polygon")for(let et=0;et<ke.length;et++)ka(Ie,ke[et],He,ne,Le==="Polygon",et===0);else if(Le==="MultiPolygon")for(let et=0;et<ke.length;et++){const Be=ke[et];for(let Je=0;Je<Be.length;Je++)ka(Ie,Be[Je],He,ne,!0,Je===0)}if(Ie.length){let et=J.tags||null;if(Le==="LineString"&&_e.lineMetrics){et={};for(const Je in J.tags)et[Je]=J.tags[Je];et.mapbox_clip_start=ke.start/ke.size,et.mapbox_clip_end=ke.end/ke.size}const Be={geometry:Ie,type:Le==="Polygon"||Le==="MultiPolygon"?3:Le==="LineString"||Le==="MultiLineString"?2:1,tags:et};J.id!==null&&(Be.id=J.id),He.features.push(Be)}}function ka(He,J,ne,_e,ke,Le){const Ie=_e*_e;if(_e>0&&J.size<(ke?Ie:_e))return void(ne.numPoints+=J.length/3);const et=[];for(let Be=0;Be<J.length;Be+=3)(_e===0||J[Be+2]>Ie)&&(ne.numSimplified++,et.push(J[Be],J[Be+1])),ne.numPoints++;ke&&function(Be,Je){let zt=0;for(let vt=0,pi=Be.length,Ai=pi-2;vt<pi;Ai=vt,vt+=2)zt+=(Be[vt]-Be[Ai])*(Be[vt+1]+Be[Ai+1]);if(zt>0===Je)for(let vt=0,pi=Be.length;vt<pi/2;vt+=2){const Ai=Be[vt],Vi=Be[vt+1];Be[vt]=Be[pi-2-vt],Be[vt+1]=Be[pi-1-vt],Be[pi-2-vt]=Ai,Be[pi-1-vt]=Vi}}(et,Le),He.push(et)}const ds={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ur{constructor(J,ne){const _e=(ne=this.options=function(Le,Ie){for(const et in Ie)Le[et]=Ie[et];return Le}(Object.create(ds),ne)).debug;if(_e&&console.time("preprocess data"),ne.maxZoom<0||ne.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ne.promoteId&&ne.generateId)throw new Error("promoteId and generateId cannot be used together.");let ke=function(Le,Ie){const et=[];if(Le.type==="FeatureCollection")for(let Be=0;Be<Le.features.length;Be++)js(et,Le.features[Be],Ie,Be);else js(et,Le.type==="Feature"?Le:{geometry:Le},Ie);return et}(J,ne);this.tiles={},this.tileCoords=[],_e&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ne.indexMaxZoom,ne.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ke=function(Le,Ie){const et=Ie.buffer/Ie.extent;let Be=Le;const Je=Yr(Le,1,-1-et,et,0,-1,2,Ie),zt=Yr(Le,1,1-et,2+et,0,-1,2,Ie);return(Je||zt)&&(Be=Yr(Le,1,-et,1+et,0,-1,2,Ie)||[],Je&&(Be=Ka(Je,1).concat(Be)),zt&&(Be=Be.concat(Ka(zt,-1)))),Be}(ke,ne),ke.length&&this.splitTile(ke,0,0,0),_e&&(ke.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(J,ne,_e,ke,Le,Ie,et){const Be=[J,ne,_e,ke],Je=this.options,zt=Je.debug;for(;Be.length;){ke=Be.pop(),_e=Be.pop(),ne=Be.pop(),J=Be.pop();const vt=1<<ne,pi=No(ne,_e,ke);let Ai=this.tiles[pi];if(!Ai&&(zt>1&&console.time("creation"),Ai=this.tiles[pi]=as(J,ne,_e,ke,Je),this.tileCoords.push({z:ne,x:_e,y:ke}),zt)){zt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ne,_e,ke,Ai.numFeatures,Ai.numPoints,Ai.numSimplified),console.timeEnd("creation"));const Bt=`z${ne}`;this.stats[Bt]=(this.stats[Bt]||0)+1,this.total++}if(Ai.source=J,Le==null){if(ne===Je.indexMaxZoom||Ai.numPoints<=Je.indexMaxPoints)continue}else{if(ne===Je.maxZoom||ne===Le)continue;if(Le!=null){const Bt=Le-ne;if(_e!==Ie>>Bt||ke!==et>>Bt)continue}}if(Ai.source=null,J.length===0)continue;zt>1&&console.time("clipping");const Vi=.5*Je.buffer/Je.extent,on=.5-Vi,rn=.5+Vi,ln=1+Vi;let jn=null,cn=null,cr=null,$n=null,Ve=Yr(J,vt,_e-Vi,_e+rn,0,Ai.minX,Ai.maxX,Je),wt=Yr(J,vt,_e+on,_e+ln,0,Ai.minX,Ai.maxX,Je);J=null,Ve&&(jn=Yr(Ve,vt,ke-Vi,ke+rn,1,Ai.minY,Ai.maxY,Je),cn=Yr(Ve,vt,ke+on,ke+ln,1,Ai.minY,Ai.maxY,Je),Ve=null),wt&&(cr=Yr(wt,vt,ke-Vi,ke+rn,1,Ai.minY,Ai.maxY,Je),$n=Yr(wt,vt,ke+on,ke+ln,1,Ai.minY,Ai.maxY,Je),wt=null),zt>1&&console.timeEnd("clipping"),Be.push(jn||[],ne+1,2*_e,2*ke),Be.push(cn||[],ne+1,2*_e,2*ke+1),Be.push(cr||[],ne+1,2*_e+1,2*ke),Be.push($n||[],ne+1,2*_e+1,2*ke+1)}}getTile(J,ne,_e){J=+J,ne=+ne,_e=+_e;const ke=this.options,{extent:Le,debug:Ie}=ke;if(J<0||J>24)return null;const et=1<<J,Be=No(J,ne=ne+et&et-1,_e);if(this.tiles[Be])return hs(this.tiles[Be],Le);Ie>1&&console.log("drilling down to z%d-%d-%d",J,ne,_e);let Je,zt=J,vt=ne,pi=_e;for(;!Je&&zt>0;)zt--,vt>>=1,pi>>=1,Je=this.tiles[No(zt,vt,pi)];return Je&&Je.source?(Ie>1&&(console.log("found parent tile z%d-%d-%d",zt,vt,pi),console.time("drilling down")),this.splitTile(Je.source,zt,vt,pi,J,ne,_e),Ie>1&&console.timeEnd("drilling down"),this.tiles[Be]?hs(this.tiles[Be],Le):null):null}}function No(He,J,ne){return 32*((1<<He)*ne+J)+He}function pa(He,J){const ne=He.tileID.canonical;if(!this._geoJSONIndex)return void J(null,null);const _e=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);if(!_e)return void J(null,null);const ke=Je=>Je.tags&&"3d_elevation_id"in Je.tags&&"source"in Je.tags&&Je.tags.source==="elevation",Le=_e.features.filter(Je=>ke(Je));let Ie={_geojsonTileLayer:_e.features};Le.length>0&&(Ie={_geojsonTileLayer:_e.features.filter(Je=>!ke(Je)),hd_road_elevation:Le});const et=new it(Ie),Be=function(Je){const zt=new s.bt;for(const vt of Object.keys(Je))zt.writeMessage(3,Ui,{name:vt,features:Je[vt]});return zt.finish()}(Ie).buffer;J(null,{vectorTile:et,rawData:Be})}class Mt extends te{constructor(J,ne,_e,ke,Le,Ie,et){super(J,ne,_e,ke,Le,pa,et),Ie&&(this.loadGeoJSON=Ie),this._dynamicIndex=new Lt}loadData(J,ne){const _e=J&&J.request,ke=_e&&_e.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(J,(Le,Ie)=>{if(Le||!Ie)return ne(Le);if(typeof Ie!="object")return ne(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));{try{if(J.filter){const Be=s.U(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map(Je=>`${Je.key}: ${Je.message}`).join(", "));Ie.features=Ie.features.filter(Je=>Be.value.evaluate({zoom:0},Je))}J.dynamic?(Ie.type==="Feature"&&(Ie={type:"FeatureCollection",features:[Ie]}),J.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ie.features,this.loaded),J.cluster&&(Ie.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=J.cluster?new Ei(function({superclusterOptions:Be,clusterProperties:Je}){if(!Je||!Be)return Be;const zt={},vt={},pi={accumulated:null,zoom:0},Ai={properties:null},Vi=Object.keys(Je);for(const on of Vi){const[rn,ln]=Je[on],jn=s.U(ln),cn=s.U(typeof rn=="string"?[rn,["accumulated"],["get",on]]:rn);zt[on]=jn.value,vt[on]=cn.value}return Be.map=on=>{Ai.properties=on;const rn={};for(const ln of Vi)rn[ln]=zt[ln].evaluate(pi,Ai);return rn},Be.reduce=(on,rn)=>{Ai.properties=rn;for(const ln of Vi)pi.accumulated=on[ln],on[ln]=vt[ln].evaluate(pi,Ai)},Be}(J)).load(Ie.features):J.dynamic?this._dynamicIndex:function(Be,Je){return new Ur(Be,Je)}(Ie,J.geojsonVtOptions)}catch(Be){return ne(Be)}const et={};if(ke){const Be=q(_e);Be&&(et.resourceTiming={},et.resourceTiming[J.source]=JSON.parse(JSON.stringify(Be)))}ne(null,et)}})}reloadTile(J,ne){const _e=this.loaded;return _e&&_e[J.uid]?J.partial?ne(null,void 0):super.reloadTile(J,ne):this.loadTile(J,ne)}loadGeoJSON(J,ne){if(J.request)s.m(J.request,ne);else{if(typeof J.data!="string")return ne(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ne(null,JSON.parse(J.data))}catch{return ne(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(J,ne){try{ne(null,this._geoJSONIndex.getClusterExpansionZoom(J.clusterId))}catch(_e){ne(_e)}}getClusterChildren(J,ne){try{ne(null,this._geoJSONIndex.getChildren(J.clusterId))}catch(_e){ne(_e)}}getClusterLeaves(J,ne){try{ne(null,this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset))}catch(_e){ne(_e)}}}class ea{constructor(J,ne,_e){this.tileID=new s.aO(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.tileZoom=J.tileZoom,this.uid=J.uid,this.zoom=J.zoom,this.canonical=J.tileID.canonical,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=J.projection,this.brightness=ne,this.worldview=_e}parse(J,ne,_e,ke){this.status="parsing";const Le=new s.aO(_e.tileID.overscaledZ,_e.tileID.wrap,_e.tileID.canonical.z,_e.tileID.canonical.x,_e.tileID.canonical.y),Ie=[],et=ne.familiesBySource[_e.source],Be=new s.fe(Le,_e.promoteId);Be.bucketLayerIDs=[],Be.is3DTile=!0,s.ft(J).then(Je=>{if(!Je)return ke(new Error("Could not parse tile"));const zt=Je.json.extensionsUsed&&Je.json.extensionsUsed.includes("MAPBOX_mesh_features")||Je.json.asset.extras&&Je.json.asset.extras.MAPBOX_mesh_features,vt=Je.json.extensionsUsed&&Je.json.extensionsUsed.includes("EXT_meshopt_compression"),pi=new s.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Ai in et)for(const Vi of et[Ai]){const on=Vi[0];Be.bucketLayerIDs.push(Vi.map(jn=>s.B(jn.id,jn.scope))),on.recalculate(pi,[]);const rn=s.fu(Je,1/s.d6(_e.tileID.canonical)),ln=new s.fv(Vi,rn,Le,zt,vt,this.brightness,Be,this.worldview);zt||(ln.needsUpload=!0),Ie.push(ln),ln.evaluate(on)}this.status="done",ke(null,{buckets:Ie,featureIndex:Be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Je=>ke(new Error(Je.message)))}}class go{constructor(J,ne,_e,ke,Le,Ie,et,Be){this.actor=J,this.layerIndex=ne,this.availableImages=_e,this.availableModels=ke,this.brightness=et,this.loading={},this.loaded={},this.worldview=Be}loadTile(J,ne){const _e=J.uid,ke=this.loading[_e]=new ea(J,this.brightness,this.worldview);s.bu(J.request,(Le,Ie)=>{const et=!this.loading[_e];return delete this.loading[_e],et||Le?(ke.status="done",et||(this.loaded[_e]=ke),ne(Le)):Ie&&Ie.byteLength!==0?void ke.parse(Ie,this.layerIndex,J,(Be,Je)=>{ke.status="done",this.loaded=this.loaded||{},this.loaded[_e]=ke,Be||!Je?ne(Be):ne(null,Je)}):(ke.status="done",this.loaded[_e]=ke,ne())})}reloadTile(J,ne){const _e=this.loaded,ke=J.uid;if(_e&&_e[ke]){const Le=_e[ke];Le.projection=J.projection,Le.brightness=J.brightness;const Ie=(et,Be)=>{Le.reloadCallback&&(delete Le.reloadCallback,this.loadTile(J,ne)),ne(et,Be)};Le.status==="parsing"?Le.reloadCallback=Ie:Le.status==="done"&&this.loadTile(J,ne)}}abortTile(J,ne){const _e=J.uid;this.loading[_e]&&delete this.loading[_e],ne()}removeTile(J,ne){const _e=this.loaded,ke=J.uid;_e&&_e[ke]&&delete _e[ke],ne()}}class Na{constructor(J){this.self=J,this.actor=new s.fx(J,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.cl({name:"mercator"}),this.workerSourceTypes={vector:te,geojson:Mt,"raster-dem":ge,"raster-array":ye,"batched-model":go},this.workerSources={},this.self.registerWorkerSource=(ne,_e)=>{if(this.workerSourceTypes[ne])throw new Error(`Worker source with name "${ne}" already registered.`);this.workerSourceTypes[ne]=_e},this.self.registerRTLTextPlugin=ne=>{if(s.fy.isParsed())throw new Error("RTL text plugin already registered.");s.fy.setState({pluginStatus:s.fz.parsed,pluginURL:s.fy.getPluginURL()}),s.fy.applyArabicShaping=ne.applyArabicShaping,s.fy.processBidirectionalText=ne.processBidirectionalText,s.fy.processStyledBidirectionalText=ne.processStyledBidirectionalText;for(const _e of this.rtlPluginParsingListeners)_e(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(J,ne,_e){delete this.layerIndexes[J],delete this.availableImages[J],delete this.availableModels[J],delete this.workerSources[J],_e()}checkIfReady(J,ne,_e){_e()}setReferrer(J,ne){this.referrer=ne}spriteLoaded(J,ne){this.isSpriteLoaded[J]||(this.isSpriteLoaded[J]={});const{scope:_e,isLoaded:ke}=ne;if(this.isSpriteLoaded[J][_e]=ke,this.workerSources[J]&&this.workerSources[J][_e])for(const Le in this.workerSources[J][_e]){const Ie=this.workerSources[J][_e][Le];for(const et in Ie){const Be=Ie[et];Be instanceof te&&(Be.isSpriteLoaded=ke,Be.fire(new s.z("isSpriteLoaded")))}}}setImages(J,ne,_e){this.availableImages[J]||(this.availableImages[J]={});const{scope:ke,images:Le}=ne;if(this.availableImages[J][ke]=Le,this.workerSources[J]&&this.workerSources[J][ke]){for(const Ie in this.workerSources[J][ke]){const et=this.workerSources[J][ke][Ie];for(const Be in et)et[Be].availableImages=Le}_e()}else _e()}setModels(J,{scope:ne,models:_e},ke){if(this.availableModels[J]||(this.availableModels[J]={}),this.availableModels[J][ne]=_e,this.workerSources[J]&&this.workerSources[J][ne]){for(const Le in this.workerSources[J][ne]){const Ie=this.workerSources[J][ne][Le];for(const et in Ie)Ie[et].availableModels=_e}ke()}else ke()}setProjection(J,ne){this.projections[J]=s.cl(ne)}setBrightness(J,ne,_e){this.brightness=ne,_e()}setWorldview(J,ne,_e){this.worldview=ne,_e()}setLayers(J,ne,_e){this.getLayerIndex(J,ne.scope).replace(ne.layers,ne.options),_e()}updateLayers(J,ne,_e){this.getLayerIndex(J,ne.scope).update(ne.layers,ne.removedIds,ne.options),_e()}loadTile(J,ne,_e){ne.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,ne.type,ne.source,ne.scope).loadTile(ne,_e)}decodeRasterArray(J,ne,_e){this.getWorkerSource(J,ne.type,ne.source,ne.scope).decodeRasterArray(ne,_e)}reloadTile(J,ne,_e){ne.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,ne.type,ne.source,ne.scope).reloadTile(ne,_e)}abortTile(J,ne,_e){this.getWorkerSource(J,ne.type,ne.source,ne.scope).abortTile(ne,_e)}removeTile(J,ne,_e){this.getWorkerSource(J,ne.type,ne.source,ne.scope).removeTile(ne,_e)}removeSource(J,ne,_e){if(!(this.workerSources[J]&&this.workerSources[J][ne.scope]&&this.workerSources[J][ne.scope][ne.type]&&this.workerSources[J][ne.scope][ne.type][ne.source]))return;const ke=this.workerSources[J][ne.scope][ne.type][ne.source];delete this.workerSources[J][ne.scope][ne.type][ne.source],ke.removeSource!==void 0?ke.removeSource(ne,_e):_e()}loadWorkerSource(J,ne,_e){try{this.self.importScripts(ne.url),_e()}catch(ke){_e(ke.toString())}}syncRTLPluginState(J,ne,_e){if(s.fy.isParsed())_e(null,!0);else if(s.fy.isParsing())this.rtlPluginParsingListeners.push(_e);else try{s.fy.setState(ne);const ke=s.fy.getPluginURL();!s.fy.isLoaded()||s.fy.isParsed()||s.fy.isParsing()||ke==null||(s.fy.setState({pluginStatus:s.fz.parsing,pluginURL:s.fy.getPluginURL()}),this.self.importScripts(ke),s.fy.isParsed()?_e(null,!0):this.rtlPluginParsingListeners.push(_e))}catch(ke){_e(ke.toString())}}setDracoUrl(J,ne){this.dracoUrl=ne}getAvailableImages(J,ne){this.availableImages[J]||(this.availableImages[J]={});let _e=this.availableImages[J][ne];return _e||(_e=[]),_e}getAvailableModels(J,ne){this.availableModels[J]||(this.availableModels[J]={});let _e=this.availableModels[J][ne];return _e||(_e={}),_e}getLayerIndex(J,ne){this.layerIndexes[J]||(this.layerIndexes[J]={});let _e=this.layerIndexes[J][ne];return _e||(_e=this.layerIndexes[J][ne]=new oe,_e.scope=ne),_e}getWorkerSource(J,ne,_e,ke){const Le=this.workerSources;return Le[J]||(Le[J]={}),Le[J][ke]||(Le[J][ke]={}),Le[J][ke][ne]||(Le[J][ke][ne]={}),this.isSpriteLoaded[J]||(this.isSpriteLoaded[J]={}),Le[J][ke][ne][_e]||(Le[J][ke][ne][_e]=new this.workerSourceTypes[ne]({send:(Ie,et,Be,Je,zt,vt)=>this.actor.send(Ie,et,Be,J,zt,vt),scheduler:this.actor.scheduler},this.getLayerIndex(J,ke),this.getAvailableImages(J,ke),this.getAvailableModels(J,ke),this.isSpriteLoaded[J][ke],void 0,this.brightness,this.worldview)),Le[J][ke][ne][_e]}rasterizeImagesWorker(J,ne,_e){const ke=new Map;for(const[Le,{image:Ie,imageVariant:et}]of ne.tasks.entries()){const Be=this.imageRasterizer.rasterize(et,Ie,ne.scope,J);ke.set(Le,Be)}_e(void 0,ke)}removeRasterizedImages(J,ne,_e){this.imageRasterizer.removeImagesFromCacheByIds(ne.imageIds,ne.scope,J),_e()}enforceCacheSizeLimit(J,ne){s.fA(ne)}getWorkerPerformanceMetrics(J,ne,_e){_e(void 0,void 0)}}return s.fw(self)&&(self.worker=new Na(self)),Na}),N(["./shared"],function(s){var q="3.15.0";const Z={create:"create",load:"load",fullLoad:"fullLoad"},Q={mark(u){performance.mark(u)},measure(u,t,r){performance.measure(u,t,r)}};function oe(u){const t=u.name.split("?")[0];return s.a(t)&&t.includes("mapbox-gl.js")?"javascript":s.a(t)&&t.includes("mapbox-gl.css")?"css":s.b(t)?"fontRange":s.c(t)?"sprite":s.i(t)?"style":s.d(t)?"tilejson":"other"}var pe,ze={},le=function(){if(pe)return ze;function u(c){return!t(c)}function t(c){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,w,E=new Blob([""],{type:"text/javascript"}),R=URL.createObjectURL(E);try{w=new Worker(R),_=!0}catch{_=!1}return w&&w.terminate(),URL.revokeObjectURL(R),_}()?function(){var _=document.createElement("canvas");_.width=_.height=1;var w=_.getContext("2d");if(!w)return!1;var E=w.getImageData(0,0,1,1);return E&&E.width===_.width}()?(r[m=c&&c.failIfMajorPerformanceCaveat]===void 0&&(r[m]=function(_){var w,E=function(R){var D=document.createElement("canvas"),L=Object.create(u.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=R,D.getContext("webgl2",L)}(_);if(!E)return!1;try{w=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!w||E.isContextLost())&&(E.shaderSource(w,"void main() {}"),E.compileShader(w),E.getShaderParameter(w,E.COMPILE_STATUS)===!0)}(m)),r[m]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var m}pe=1,ze.supported=u,ze.notSupportedReason=t;var r={};return u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ze}();function Se(u,t,r){const c=document.createElement(u);return t!=null&&(c.className=t),r&&r.appendChild(c),c}function te(u,t,r){const c=document.createElementNS("http://www.w3.org/2000/svg",u);for(const m of Object.keys(t))c.setAttributeNS(null,m,String(t[m]));return r&&r.appendChild(c),c}const ge=typeof document<"u"?document.documentElement&&document.documentElement.style:null,xe=ge&&ge.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ye;function Pe(){ge&&xe&&(ye=ge[xe],ge[xe]="none")}function Ae(){ge&&xe&&(ge[xe]=ye)}function Ke(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",Ke,!0)}function it(){window.addEventListener("click",Ke,!0),window.setTimeout(()=>{window.removeEventListener("click",Ke,!0)},0)}function rt(u,t){const r=u.getBoundingClientRect();return lt(u,r,t)}function ut(u,t){const r=u.getBoundingClientRect(),c=[];for(let m=0;m<t.length;m++)c.push(lt(u,r,t[m]));return c}function Lt(u){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&u.button===2&&u.ctrlKey?0:u.button}function lt(u,t,r){const c=u.offsetWidth===t.width?1:u.offsetWidth/t.width;return new s.P((r.clientX-t.left)*c,(r.clientY-t.top)*c)}const Jt="01",wi="NO_ACCESS_TOKEN";class Fi{constructor(t,r,c){this._transformRequestFn=t,this._customAccessToken=r,this._silenceAuthErrors=!!c,this._createSkuToken()}_createSkuToken(){const t=function(){let r="";for(let c=0;c<10;c++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Jt,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeStyleURL(t,r){if(!s.h(t))return t;const c=Wt(t);return c.params.push(`sdk=js-${q}`),c.path=`/styles/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||r)}normalizeGlyphsURL(t,r){if(!s.h(t))return t;const c=Wt(t);return c.path=`/fonts/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||r)}normalizeModelURL(t,r){if(!s.h(t))return t;const c=Wt(t);return c.path=`/models/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||r)}normalizeSourceURL(t,r,c,m){if(!s.h(t))return t;const _=Wt(t);return _.path=`/v4/${_.authority}.json`,_.params.push("secure"),c&&_.params.push(`language=${c}`),m&&_.params.push(`worldview=${m}`),this._makeAPIURL(_,this._customAccessToken||r)}normalizeIconsetURL(t,r){const c=Wt(t);return s.h(t)?(c.path=`/styles/v1${c.path}/iconset.pbf`,this._makeAPIURL(c,this._customAccessToken||r)):ki(c)}normalizeSpriteURL(t,r,c,m){const _=Wt(t);return s.h(t)?(_.path=`/styles/v1${_.path}/sprite${r}${c}`,this._makeAPIURL(_,this._customAccessToken||m)):(_.path+=`${r}${c}`,ki(_))}normalizeTileURL(t,r,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!s.h(t))return t;const m=Wt(t);m.path=m.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||c&&m.authority!=="raster"&&c===512?"@2x":""}${s.k.supported?".webp":"$1"}`),m.authority==="raster"?m.path=`/${s.e.RASTER_URL_PREFIX}${m.path}`:m.authority==="rasterarrays"?m.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${m.path}`:m.authority==="3dtiles"?m.path=`/${s.e.TILES3D_URL_PREFIX}${m.path}`:(m.path=m.path.replace(/^.+\/v4\//,"/"),m.path=`/${s.e.TILE_URL_VERSION}${m.path}`);const _=this._customAccessToken||function(w){for(const E of w){const R=E.match(/^access_token=(.*)$/);if(R)return R[1]}return null}(m.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&_&&this._skuToken&&m.params.push(`sku=${this._skuToken}`),this._makeAPIURL(m,_)}canonicalizeTileURL(t,r){const c=Wt(t);if(!c.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!c.path.match(/\.[\w]+$/))return t;let m="mapbox://";c.path.match(/^\/raster\/v1\//)?m+=`raster/${c.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:c.path.match(/^\/rasterarrays\/v1\//)?m+=`rasterarrays/${c.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:m+=`tiles/${c.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let _=c.params;return r&&(_=_.filter(w=>!w.match(/^access_token=/))),_.length&&(m+=`?${_.join("&")}`),m}canonicalizeTileset(t,r){const c=!!r&&s.h(r),m=[];for(const _ of t.tiles||[])s.j(_)?m.push(this.canonicalizeTileURL(_,c)):m.push(_);return m}_makeAPIURL(t,r){const c="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",m=Wt(s.e.API_URL);if(t.protocol=m.protocol,t.authority=m.authority,t.protocol==="http"){const _=t.params.indexOf("secure");_>=0&&t.params.splice(_,1)}if(m.path!=="/"&&(t.path=`${m.path}${t.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return ki(t);if(r=r||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${c}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${c}`)}return t.params=t.params.filter(_=>_.indexOf("access_token")===-1),t.params.push(`access_token=${r||""}`),ki(t)}}const Bi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Wt(u){const t=u.match(Bi);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ki(u){const t=u.params.length?`?${u.params.join("&")}`:"";return`${u.protocol}://${u.authority}${u.path}${t}`}const Ui="mapbox.eventData";function Cn(u){if(!u)return null;const t=u.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(s.l(t[1]))}catch{return null}}class Qe{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const r=Cn(s.e.ACCESS_TOKEN);let c="";return c=r&&r.u?s.f(r.u):s.e.ACCESS_TOKEN||"",t?`${Ui}.${t}:${c}`:`${Ui}:${c}`}fetchEventData(){const t=s.s("localStorage"),r=this.getStorageKey(),c=this.getStorageKey("uuid");if(t)try{const m=localStorage.getItem(r);m&&(this.eventData=JSON.parse(m));const _=localStorage.getItem(c);_&&(this.anonId=_)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const t=s.s("localStorage"),r=this.getStorageKey(),c=this.getStorageKey("uuid"),m=this.anonId;if(t&&m)try{localStorage.setItem(c,m),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,r,c,m){if(!s.e.EVENTS_URL)return;const _=Wt(s.e.EVENTS_URL);_.params.push(`access_token=${m||s.e.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(t).toISOString()},E=r?Object.assign(w,r):w,R={url:ki(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([E])};this.pendingRequest=s.p(R,D=>{this.pendingRequest=null,c(D),this.saveEventData(),this.processRequests(m)})}queueRequest(t,r){this.queue.push(t),this.processRequests(r)}}const Ft=new class extends Qe{constructor(u){super("appUserTurnstile"),this._customAccessToken=u}postTurnstileEvent(u,t){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(u)&&u.some(r=>s.h(r)||s.j(r))&&this.queueRequest(Date.now(),t)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Cn(s.e.ACCESS_TOKEN),r=t?t.u:s.e.ACCESS_TOKEN;let c=r!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),c=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),w=new Date(m),E=(m-this.eventData.lastSuccess)/864e5;c=c||E>=1||E<-1||_.getDate()!==w.getDate()}else c=!0;c?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:q,skuId:Jt,"enabled.telemetry":!1,userId:this.anonId},_=>{_||(this.eventData.lastSuccess=m,this.eventData.tokenU=r)},u):this.processRequests()}},Di=Ft.postTurnstileEvent.bind(Ft),Zi=new class extends Qe{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(u,t,r,c){this.skuToken=t,this.errorCb=c,s.e.EVENTS_URL&&(r||s.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},r):this.errorCb(new Error(wi)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:q,skuId:Jt,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},u))}remove(){this.errorCb=null}},ii=Zi.postMapLoadEvent.bind(Zi),Yi=new class extends Qe{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(u){let t=this.mapInstanceIdMap.get(u);return t||(t=s.u(),this.mapInstanceIdMap.set(u,t)),t}getEventId(u){const t=this.eventIdPerMapInstanceMap.get(u)||0;return this.eventIdPerMapInstanceMap.set(u,t+1),t}postStyleLoadEvent(u,t){const{map:r,style:c,importedStyles:m}=t;if(!s.e.EVENTS_URL||!u&&!s.e.ACCESS_TOKEN)return;const _=this.getMapInstanceId(r),w={mapInstanceId:_,eventId:this.getEventId(_),style:c};m.length&&(w.importedStyles=m),this.queueRequest({timestamp:Date.now(),payload:w},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:r}=this.queue.shift();this.postEvent(t,r,()=>{},u)}},Ti=Yi.postStyleLoadEvent.bind(Yi),Mi=new class extends Qe{constructor(){super("gljs.performance")}postPerformanceEvent(u,t){s.e.EVENTS_URL&&(u||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:r}=this.queue.shift(),c=function(m){const _=performance.getEntriesByType("resource"),w=performance.getEntriesByType("mark"),E=function(H){const $={};if(H){for(const G in H)if(G!=="other")for(const ee of H[G]){const X=`${G}ResolveRangeMin`,ie=`${G}ResolveRangeMax`,ce=`${G}RequestCount`,de=`${G}RequestCachedCount`;$[X]=Math.min($[X]||1/0,ee.startTime),$[ie]=Math.max($[ie]||-1/0,ee.responseEnd);const Te=we=>{$[we]===void 0&&($[we]=0),++$[we]};ee.transferSize!==void 0&&ee.transferSize===0&&Te(de),Te(ce)}}return $}(function(H,$){const G={};if(H)for(const ee of H){const X=$(ee);G[X]===void 0&&(G[X]=[]),G[X].push(ee)}return G}(_,oe)),R=window.devicePixelRatio,D=navigator.connection||navigator.mozConnection||navigator.webkitConnection,L=D?D.effectiveType:void 0,F={counters:[],metadata:[],attributes:[]},k=(H,$,G)=>{G!=null&&H.push({name:$,value:G.toString()})};for(const H in E)k(F.counters,H,E[H]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(k(F.counters,"interactionRangeMin",m.interactionRange[0]),k(F.counters,"interactionRangeMax",m.interactionRange[1])),w)for(const H of Object.keys(Z)){const $=Z[H],G=w.find(ee=>ee.name===$);G&&k(F.counters,$,G.startTime)}return k(F.counters,"visibilityHidden",m.visibilityHidden),k(F.attributes,"style",function(H){if(H)for(const $ of H){const G=$.name.split("?")[0];if(s.i(G)){const ee=G.split("/").slice(-2);if(ee.length===2)return`mapbox://styles/${ee[0]}/${ee[1]}`}}}(_)),k(F.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),k(F.attributes,"fogEnabled",m.fogEnabled?"true":"false"),k(F.attributes,"projection",m.projection),k(F.attributes,"zoom",m.zoom),k(F.metadata,"devicePixelRatio",R),k(F.metadata,"connectionEffectiveType",L),k(F.metadata,"navigatorUserAgent",navigator.userAgent),k(F.metadata,"screenWidth",window.screen.width),k(F.metadata,"screenHeight",window.screen.height),k(F.metadata,"windowWidth",window.innerWidth),k(F.metadata,"windowHeight",window.innerHeight),k(F.metadata,"mapWidth",m.width/R),k(F.metadata,"mapHeight",m.height/R),k(F.metadata,"webglRenderer",m.renderer),k(F.metadata,"webglVendor",m.vendor),k(F.metadata,"sdkVersion",q),k(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(r);for(const m of c.metadata);for(const m of c.counters);for(const m of c.attributes);this.postEvent(t,c,()=>{},u)}},Ii=Mi.postPerformanceEvent.bind(Mi),xt=new class extends Qe{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(u,t,r,c){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const m=Wt(s.e.API_URL+s.e.SESSION_PATH);m.params.push(`sku=${t||""}`),m.params.push(`access_token=${c||s.e.ACCESS_TOKEN||""}`);const _={url:ki(m),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(_,w=>{this.pendingRequest=null,r(w),this.saveEventData(),this.processRequests(c)})}getSessionAPI(u,t,r,c){this.skuToken=t,this.errorCb=c,s.e.SESSION_PATH&&s.e.API_URL&&(r||s.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},r):this.errorCb(new Error(wi)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},u)}remove(){this.errorCb=null}},St=xt.getSessionAPI.bind(xt),Ei=new Set;function Sn(u,t){t?Ei.add(u):Ei.delete(u)}class Mn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,r){this._updatedSourceCaches[t]=r,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const r=t.scope;this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._updatedLayers[r].add(t.id),this.setDirty()}removeLayer(t){const r=t.scope;this._removedLayers[r]=this._removedLayers[r]||{},this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._removedLayers[r][t.id]=t,this._updatedLayers[r].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const r in this._updatedLayers)t[r]=t[r]||{},t[r].updatedIds=Array.from(this._updatedLayers[r].values());for(const r in this._removedLayers)t[r]=t[r]||{},t[r].removedIds=Object.keys(this._removedLayers[r]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,r){this._updatedImages[r]=this._updatedImages[r]||new Set,this._updatedImages[r].add(s.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Nn(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class In extends s.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&s.r()&&(this.imageRasterizerDispatcher=new s.D(s.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new s.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const r=this.atlasTexture.get(t);r&&(r.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,r){this.imageProviders.has(r)||this.imageProviders.set(r,new Map),this.imageProviders.get(r).set(t.id,t)}removeImageProvider(t,r){this.imageProviders.has(r)&&this.imageProviders.get(r).delete(t)}getPendingImageProviders(){const t=[];for(const r of this.imageProviders.values())for(const c of r.values())c.hasPendingRequests()&&t.push(c);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,r){if(this.loaded.get(r)!==t&&(this.loaded.set(r,t),t)){for(const{ids:c,callback:m}of this.requestors)this._notify(c,r,m);this.requestors=[]}}hasImage(t,r){return!!this.getImage(t,r)}getImage(t,r){return this.images.get(r).get(t.toString())}addImage(t,r,c){this._validate(t,c)&&this.images.get(r).set(t.toString(),c)}_validate(t,r){let c=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),c=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),c=!1),this._validateContent(r.content,r)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "content" value`))),c=!1),c}_validateStretch(t,r){if(!t)return!0;let c=0;for(const m of t){if(m[0]<c||m[1]<m[0]||r<m[1])return!1;c=m[1]}return!0}_validateContent(t,r){return t?t.length!==4||!r.usvg&&(t[0]<0||r.data.width<t[0]||t[1]<0||r.data.height<t[1]||t[2]<0||r.data.width<t[2]||t[3]<0||r.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,r,c){const m=this.images.get(r).get(t.toString());c.version=m.version+1,this.images.get(r).set(t.toString(),c),this.updatedImages.get(r).add(t),this.removeFromImageRasterizerCache(t,r)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,r){this.spriteFormat!=="raster"&&(s.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:r}):this.imageRasterizer.removeImagesFromCacheByIds([t],r))}removeImage(t,r){const c=this.images.get(r),m=c.get(t.toString());c.delete(t.toString()),this.patterns.get(r).delete(t.toString()),this.removeFromImageRasterizerCache(t,r),m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(r=>s.I.from(r))}getImages(t,r,c){const m=[],_=[],w=this.imageProviders.get(r);for(const L of t){if(!L.iconsetId){m.push(L);continue}const F=w.get(L.iconsetId);F&&(this.getImage(L,r)?_.push(L):F.addPendingRequest(L))}if(m.length===0)return void this._notify(_,r,c);let E=!0;const R=!!this.loaded.get(r),D=this.images.get(r);if(!R)for(const L of m)D.has(L.toString())||(E=!1);R||E?this._notify(m,r,c):this.requestors.push({ids:m,scope:r,callback:c})}rasterizeImages(t,r){const c=new Map,{tasks:m,scope:_}=t;for(const[w,E]of m.entries()){const R=this.getImage(E.id,_);R&&c.set(w,{image:R,imageVariant:E})}this._rasterizeImages(_,c,r)}_rasterizeImages(t,r,c){if(s.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:r,scope:t},c);else{const m=new Map;for(const[_,{image:w,imageVariant:E}]of r.entries())m.set(_,this.imageRasterizer.rasterize(E,w,t,0));c(void 0,m)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,r,c){const m=this.images.get(r),_=new Map;for(const w of t){if(!m.get(w.toString())){if(w.iconsetId)continue;this.fire(new s.z("styleimagemissing",{id:w.name}))}const E=m.get(w.toString());if(!E){s.w(`Image "${w.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const R={data:E.usvg?null:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,usvg:E.usvg,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)};E.usvg&&Object.assign(R,{width:E.icon.usvg_tree.width,height:E.icon.usvg_tree.height}),_.set(s.I.toString(w),R)}c(null,_)}getPixelSize(t){const{width:r,height:c}=this.atlasImage.get(t);return{width:r,height:c}}getPattern(t,r,c){const m=t.toString(),_=this.patterns.get(r),w=_.get(m),E=this.getImage(t,r);if(!E)return null;if(w){if(w.position.version===E.version)return w.position;w.position.version=E.version}else{if(E.usvg&&!E.data){const R=this.getPatternInFlightId(m,r);if(this.patternsInFlight.has(R))return null;this.patternsInFlight.add(R);const D=new s.A(t).scaleSelf(s.o.devicePixelRatio),L=new Map([[D.toString(),{image:E,imageVariant:D}]]);return this._rasterizeImages(r,L,(F,k)=>this.storePatternImage(D,r,E,c,k)),null}this.storePattern(t,r,E)}return this._updatePatternAtlas(r,c),_.get(m).position}getPatternInFlightId(t,r){return s.B(t,r)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,r,c,m,_){const w=t.toString(),E=_?_.get(w):void 0;E&&(c.data=E,this.storePattern(t.id,r,c),this._updatePatternAtlas(r,m),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),r)))}storePattern(t,r,c){const m={w:c.data.width+2*s.C,h:c.data.height+2*s.C,x:0,y:0},_=new s.F(m,c,s.C);this.patterns.get(r).set(t.toString(),{bin:m,position:_})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,r){const c=t.gl;let m=this.atlasTexture.get(r);m?this.dirty&&(m.update(this.atlasImage.get(r)),this.dirty=!1):(m=new s.T(t,this.atlasImage.get(r),c.RGBA8),this.atlasTexture.set(r,m)),m.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(t,r){const c=this.patterns.get(t),m=Array.from(c.values()).map(({bin:D})=>D),{w:_,h:w}=s.G(m),E=this.atlasImage.get(t);E.resize({width:_||1,height:w||1});const R=this.images.get(t);for(const[D,{bin:L,position:F}]of c.entries()){let k=F.padding;const H=L.x+k,$=L.y+k,G=R.get(D).data,ee=G.width,X=G.height;k=k>1?k-1:k,s.q.copy(G,E,{x:0,y:0},{x:H,y:$},{width:ee,height:X},r),s.q.copy(G,E,{x:0,y:X-k},{x:H,y:$-k},{width:ee,height:k},r),s.q.copy(G,E,{x:0,y:0},{x:H,y:$+X},{width:ee,height:k},r),s.q.copy(G,E,{x:ee-k,y:0},{x:H-k,y:$},{width:k,height:X},r),s.q.copy(G,E,{x:0,y:0},{x:H+ee,y:$},{width:k,height:X},r),s.q.copy(G,E,{x:ee-k,y:X-k},{x:H-k,y:$-k},{width:k,height:k},r),s.q.copy(G,E,{x:0,y:X-k},{x:H+ee,y:$-k},{width:k,height:k},r),s.q.copy(G,E,{x:0,y:0},{x:H+ee,y:$+X},{width:k,height:k},r),s.q.copy(G,E,{x:ee-k,y:0},{x:H-k,y:$+X},{width:k,height:k},r)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,r){const c=this.images.get(r);for(const m of t){if(this.callbackDispatchedThisFrame.get(r).has(m.toString()))continue;this.callbackDispatchedThisFrame.get(r).add(m.toString());const _=c.get(m.toString());Nn(_)&&this.updateImage(m,r,_)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function qr(u){const t=u.value,r=u.valueSpec,c=u.style,m=u.styleSpec,_=u.key,w=u.arrayElementValidator||fr;if(!Array.isArray(t))return[new s.V(_,t,`array expected, ${s.K(t)} found`)];if(r.length&&t.length!==r.length)return[new s.V(_,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new s.V(_,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let E={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};m.$version<7&&(E.function=r.function),s.H(r.value)&&(E=r.value);let R=[];for(let D=0;D<t.length;D++)R=R.concat(w({array:t,arrayIndex:D,value:t[D],valueSpec:E,style:c,styleSpec:m,key:`${_}[${D}]`},!0));return R}function bs(u){const t=u.key,r=u.value,c=u.valueSpec;if(!s.L(r))return[new s.V(t,r,`number expected, ${s.K(r)} found`)];if(r!=r)return[new s.V(t,r,"number expected, NaN found")];if("minimum"in c){let m=c.minimum;if(Array.isArray(c.minimum)&&(m=c.minimum[u.arrayIndex]),r<m)return[new s.V(t,r,`${r} is less than the minimum value ${m}`)]}if("maximum"in c){let m=c.maximum;if(Array.isArray(c.maximum)&&(m=c.maximum[u.arrayIndex]),r>m)return[new s.V(t,r,`${r} is greater than the maximum value ${m}`)]}return[]}function fa(u){const t=u.key,r=u.value;if(!s.H(r))return[new s.V(t,r,`object expected, ${s.K(r)} found`)];const c=u.valueSpec,m=s.J(r.type);let _,w,E,R={};const D=m!=="categorical"&&r.property===void 0,L=!D,F=function(G){const ee=G.stops;return Array.isArray(ee)&&Array.isArray(ee[0])&&s.H(ee[0][0])}(r),k=as({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(G){if(m==="identity")return[new s.V(G.key,G.value,'identity function may not have a "stops" property')];let ee=[];const X=G.value;return ee=ee.concat(qr({key:G.key,value:X,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:H})),Array.isArray(X)&&X.length===0&&ee.push(new s.V(G.key,X,"array must have at least one stop")),ee},default:function(G){return fr({key:G.key,value:G.value,valueSpec:c,style:G.style,styleSpec:G.styleSpec})}}});return m==="identity"&&D&&k.push(new s.V(u.key,u.value,'missing required property "property"')),m==="identity"||r.stops||k.push(new s.V(u.key,u.value,'missing required property "stops"')),m==="exponential"&&c.expression&&!s.M(c)&&k.push(new s.V(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(L&&!s.N(c)?k.push(new s.V(u.key,u.value,"property functions not supported")):D&&!s.O(c)&&k.push(new s.V(u.key,u.value,"zoom functions not supported"))),m!=="categorical"&&!F||r.property!==void 0||k.push(new s.V(u.key,u.value,'"property" property is required')),k;function H(G){let ee=[];const X=G.value,ie=G.key;if(!Array.isArray(X))return[new s.V(ie,X,`array expected, ${s.K(X)} found`)];if(X.length!==2)return[new s.V(ie,X,`array length 2 expected, length ${X.length} found`)];if(F){if(!s.H(X[0]))return[new s.V(ie,X,`object expected, ${s.K(X[0])} found`)];const ce=X[0];if(ce.zoom===void 0)return[new s.V(ie,X,"object stop key must have zoom")];if(ce.value===void 0)return[new s.V(ie,X,"object stop key must have value")];const de=s.J(ce.zoom);if(typeof de!="number")return[new s.V(ie,ce.zoom,"stop zoom values must be numbers")];if(E&&E>de)return[new s.V(ie,ce.zoom,"stop zoom values must appear in ascending order")];de!==E&&(E=de,w=void 0,R={}),ee=ee.concat(as({key:`${ie}[0]`,value:X[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:bs,value:$}}))}else ee=ee.concat($({key:`${ie}[0]`,value:X[0],style:G.style,styleSpec:G.styleSpec},X));return s.Q(s.S(X[1]))?ee.concat([new s.V(`${ie}[1]`,X[1],"expressions are not allowed in function stops.")]):ee.concat(fr({key:`${ie}[1]`,value:X[1],valueSpec:c,style:G.style,styleSpec:G.styleSpec}))}function $(G,ee){const X=s.K(G.value),ie=s.J(G.value),ce=G.value!==null?G.value:ee;if(_){if(X!==_)return[new s.V(G.key,ce,`${X} stop domain type must match previous stop domain type ${_}`)]}else _=X;if(X!=="number"&&X!=="string"&&X!=="boolean"&&typeof ie!="number"&&typeof ie!="string"&&typeof ie!="boolean")return[new s.V(G.key,ce,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&m!=="categorical"){let de=`number expected, ${X} found`;return s.N(c)&&m===void 0&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(G.key,ce,de)]}return m!=="categorical"||X!=="number"||typeof ie=="number"&&isFinite(ie)&&Math.floor(ie)===ie?m!=="categorical"&&X==="number"&&typeof ie=="number"&&typeof w=="number"&&w!==void 0&&ie<w?[new s.V(G.key,ce,"stop domain values must appear in ascending order")]:(w=ie,m==="categorical"&&ie in R?[new s.V(G.key,ce,"stop domain values must be unique")]:(R[ie]=!0,[])):[new s.V(G.key,ce,`integer expected, found ${String(ie)}`)]}}function Un(u){const t=(u.expressionContext==="property"?s.W:s.U)(s.S(u.value),u.valueSpec);if(t.result==="error")return t.value.map(c=>new s.V(`${u.key}${c.key}`,u.value,c.message));const r=t.value.expression||t.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!r.outputDefined())return[new s.V(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!s.Z(r))return[new s.V(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter")return es(r,u);if(u.expressionContext==="appearance")return js(r,u);if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!s.X(r,["zoom","feature-state"]))return[new s.V(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!s.Y(r))return[new s.V(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function es(u,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const m of t.valueSpec.expression.parameters)r.delete(m);if(r.size===0)return[];const c=[];return u instanceof s._&&r.has(u.name)?[new s.V(t.key,t.value,`["${u.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(u.eachChild(m=>{c.push(...es(m,t))}),c)}function js(u,t){const r=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const m of t.valueSpec.expression.parameters)r.add(m);if(r.size===0)return[];const c=[];return u instanceof s._&&!r.has(u.name)?[new s.V(t.key,t.value,`["${u.name}"] is not an allowed parameter`)]:(u.eachChild(m=>{c.push(...js(m,t))}),c)}function po(u){const t=u.key,r=u.value,c=u.valueSpec,m=[];return Array.isArray(c.values)?c.values.indexOf(s.J(r))===-1&&m.push(new s.V(t,r,`expected one of [${c.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(c.values).indexOf(s.J(r))===-1&&m.push(new s.V(t,r,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(r)} found`)),m}function mo(u){return s.a2(s.S(u.value))?Un(Object.assign({},u,{expressionContext:"filter",valueSpec:u.styleSpec[`filter_${u.layerType||"fill"}`]})):As(u)}function As(u){const t=u.value,r=u.key;if(!Array.isArray(t))return[new s.V(r,t,`array expected, ${s.K(t)} found`)];if(t.length<1)return[new s.V(r,t,"filter array must have at least 1 element")];const c=u.styleSpec;let m=po({key:`${r}[0]`,value:t[0],valueSpec:c.filter_operator});switch(s.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&s.J(t[1])==="$type"&&m.push(new s.V(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new s.V(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(s.a0(t[1])||m.push(new s.V(`${r}[1]`,t[1],`string expected, ${s.K(t[1])} found`)));for(let _=2;_<t.length;_++)s.J(t[1])==="$type"?m=m.concat(po({key:`${r}[${_}]`,value:t[_],valueSpec:c.geometry_type})):s.a0(t[_])||s.L(t[_])||s.$(t[_])||m.push(new s.V(`${r}[${_}]`,t[_],`string, number, or boolean expected, ${s.K(t[_])} found.`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)m=m.concat(As({key:`${r}[${_}]`,value:t[_],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":t.length!==2?m.push(new s.V(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):s.a0(t[1])||m.push(new s.V(`${r}[1]`,t[1],`string expected, ${s.K(t[1])} found`))}return m}function ws(u,t){const r=u.key,c=u.style,m=u.layer,_=u.styleSpec,w=u.value,E=u.objectKey,R=_[`${t}_${u.layerType}`];if(!R)return[];const D=E.match(/^(.*)-use-theme$/);if(D&&R[D[1]])return s.Q(w)?[].concat(fr({key:u.key,value:w,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:c,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:E})):fr({key:r,value:w,valueSpec:{type:"string"},style:c,styleSpec:_});const L=E.match(/^(.*)-transition$/);if(t==="paint"&&L&&R[L[1]]&&R[L[1]].transition)return fr({key:r,value:w,valueSpec:_.transition,style:c,styleSpec:_});const F=u.valueSpec||R[E];if(!F)return[new s.a3(r,w,`unknown property "${E}"`)];let k;if(s.a0(w)&&s.N(F)&&!F.tokens&&(k=/^{([^}]+)}$/.exec(w))){const $=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new s.V(r,w,`"${E}" does not support interpolation syntax
Use an identity property function instead: ${$}.`)]}const H=[];if(u.layerType==="symbol")E!=="text-field"||!c||c.glyphs||c.imports||H.push(new s.V(r,w,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&s.a4(s.S(w))&&s.J(w.type)==="identity"&&H.push(new s.V(r,w,'"text-font" does not support identity functions'));else if(u.layerType==="model"&&t==="paint"&&m&&m.layout&&m.layout.hasOwnProperty("model-id")&&s.N(F)&&(s.a5(F)||s.O(F))){const $=s.W(s.S(w),F),G=$.value.expression||$.value._styleExpression.expression;G&&!s.X(G,["measure-light"])&&(E==="model-emissive-strength"&&s.Y(G)&&s.Z(G)||H.push(new s.V(r,w,`${E} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return H.concat(fr({key:u.key,value:w,valueSpec:F,style:c,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:E}))}function Gr(u){return ws(u,"paint")}function Yr(u){return ws(u,"layout")}function Bs(u){let t=[];const r=u.value,c=u.key,m=u.style,_=u.styleSpec;if(!s.H(r))return[new s.V(c,r,"object expected")];r.type||r.ref||t.push(new s.V(c,r,'either "type" or "ref" is required'));let w=s.J(r.type);const E=s.J(r.ref);if(r.id){const R=s.J(r.id);for(let D=0;D<u.arrayIndex;D++){const L=m.layers[D];s.J(L.id)===R&&t.push(new s.V(c,r.id,`duplicate layer id "${R}", previously used at line ${L.id.__line__}`))}}if("ref"in r){let R;["type","source","source-layer","filter","layout"].forEach(D=>{D in r&&t.push(new s.V(c,r[D],`"${D}" is prohibited for ref layers`))}),m.layers.forEach(D=>{s.J(D.id)===E&&(R=D)}),R?R.ref?t.push(new s.V(c,r.ref,"ref cannot reference another ref layer")):w=s.J(R.type):typeof E=="string"&&t.push(new s.V(c,r.ref,`ref layer "${E}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(r.source)if(s.a0(r.source)){const R=m.sources&&m.sources[r.source],D=R&&s.J(R.type);R?D==="vector"&&w==="raster"?t.push(new s.V(c,r.source,`layer "${r.id}" requires a raster source`)):D==="raster"&&w!=="raster"?t.push(new s.V(c,r.source,`layer "${r.id}" requires a vector source`)):D!=="vector"||r["source-layer"]?D==="raster-dem"&&w!=="hillshade"?t.push(new s.V(c,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="raster-array"||["raster","raster-particle"].includes(w)?w==="line"&&r.paint&&(r.paint["line-gradient"]||r.paint["line-trim-offset"])&&D==="geojson"&&!R.lineMetrics?t.push(new s.V(c,r,`layer "${r.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):w==="raster-particle"&&D!=="raster-array"&&t.push(new s.V(c,r.source,`layer "${r.id}" requires a 'raster-array' source.`)):t.push(new s.V(c,r.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new s.V(c,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new s.V(c,r.source,`source "${r.source}" not found`))}else t.push(new s.V(`${c}.source`,r.source,'"source" must be a string'));else t.push(new s.V(c,r,'missing required property "source"'));return t=t.concat(as({key:c,value:r,valueSpec:_.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>fr({key:`${c}.type`,value:r.type,valueSpec:_.layer.type,style:u.style,styleSpec:u.styleSpec,object:r,objectKey:"type"}),filter:R=>mo(Object.assign({layerType:w},R)),layout:R=>as({layer:r,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":D=>Yr(Object.assign({layerType:w},D))}}),paint:R=>as({layer:r,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":D=>Gr(Object.assign({layerType:w,layer:r},D))}}),appearances(R){const D=qr({key:R.key,value:R.value,valueSpec:R.valueSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:k=>function(H){const{key:$,layer:G,layerType:ee}=H,X=s.J(H.value),ie=s.J(X.name),ce=s.J(X.condition),de=as({key:$,value:X,valueSpec:H.styleSpec.appearance,style:H.style,styleSpec:H.styleSpec,objectElementValidators:{condition:Te=>function(we){const Ee=[];return Ee.push(...Un({key:we.key,value:we.object.condition,valueSpec:s.a6.appearance.condition,expressionContext:"appearance"})),Ee}(Object.assign({layer:G,layerType:ee},Te)),properties:Te=>function(we){const Ee=[],{styleSpec:ve,layer:be,layerType:Ce}=we,We=ve[`paint_${Ce}`],je=ve[`layout_${Ce}`],ct=we.object[we.objectKey];for(const Ze in ct){const ot=Ze in We?"paint":Ze in je?"layout":void 0;if(!ot){Ee.push(new s.V(we.key,Ze,`unknown property "${Ze}" for layer type "${Ce}"`));continue}const jt=Object.assign({},we,{key:`${we.key}.${Ze}`,object:ct,objectKey:Ze,layer:be,layerType:Ce,value:ct[Ze],valueSpec:ot==="paint"?We[Ze]:je[Ze]});Ee.push(...ws(jt,ot))}return Ee}(Object.assign({layer:G,layerType:ee},Te))}});return ie==="hidden"||ce||de.push(new s.V(H.key,"name",'Appearance with name different than "hidden" must have a condition')),de}(Object.assign({layerType:w,layer:r},k))}),L=Array.isArray(R.value)?R.value:[],F=new Set;return L.forEach((k,H)=>{const $=s.J(k.name);if($)if(F.has($)){const G=s.J(r.id);D.push(new s.V(R.key,$,`Duplicated appearance name "${$}" for layer "${G}"`))}else F.add($)}),D}}})),t}function Fs({key:u,value:t}){return s.a0(t)?[]:[new s.V(u,t,`string expected, ${s.K(t)} found`)]}const Sa={promoteId:function u({key:t,value:r}){if(s.a0(r))return Fs({key:t,value:r});if(Array.isArray(r)){const m=[],_=s.S(r),w=s.U(_);return w.result==="error"&&w.value.forEach(E=>{m.push(new s.V(`${t}${E.key}`,null,`${E.message}`))}),s.X(w.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||m.push(new s.V(`${t}`,null,"promoteId expression should be only feature dependent")),m}if(!s.H(r))return[new s.V(t,r,`string, expression or object expected, "${s.K(r)}" found`)];const c=[];for(const m in r)c.push(...u({key:`${t}.${m}`,value:r[m]}));return c}};function Or(u){const t=u.value,r=u.key,c=u.styleSpec,m=u.style;if(!s.H(t))return[new s.V(r,t,`object expected, ${s.K(t)} found`)];if(!("type"in t))return[new s.V(r,t,'"type" is required')];const _=s.J(t.type);let w=[];switch(["vector","raster","raster-dem","raster-array"].includes(_)&&("url"in t||"tiles"in t||w.push(new s.a3(r,t,'Either "url" or "tiles" is required.'))),_){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(as({key:r,value:t,valueSpec:c[`source_${_.replace("-","_")}`],style:u.style,styleSpec:c,objectElementValidators:Sa})),w;case"geojson":if(w=as({key:r,value:t,valueSpec:c.source_geojson,style:m,styleSpec:c,objectElementValidators:Sa}),"cluster"in t&&"clusterProperties"in t){if(!s.H(t.clusterProperties))return[new s.V(`${r}.clusterProperties`,t,`object expected, ${s.K(t)} found`)];for(const E in t.clusterProperties){const R=t.clusterProperties[E];if(!Array.isArray(R))return[new s.V(`${r}.clusterProperties.${E}`,R,"array expected")];const[D,L]=R,F=typeof D=="string"?[D,["accumulated"],["get",E]]:D;w.push(...Un({key:`${r}.${E}.map`,value:L,expressionContext:"cluster-map"})),w.push(...Un({key:`${r}.${E}.reduce`,value:F,expressionContext:"cluster-reduce"}))}}return w;case"video":return as({key:r,value:t,valueSpec:c.source_video,style:m,styleSpec:c});case"image":return as({key:r,value:t,valueSpec:c.source_image,style:m,styleSpec:c});case"canvas":return[new s.V(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return po({key:`${r}.type`,value:t.type,valueSpec:{values:Ea(c)}})}}function Ea(u){return u.source.reduce((t,r)=>{const c=u[r];return c.type.type==="enum"&&(t=t.concat(Object.keys(c.type.values))),t},[])}function Ya(u){const t=u.value,r=u.styleSpec,c=r.light,m=u.style;if(t===void 0)return[];if(!s.H(t))return[new s.V("light",t,`object expected, ${s.K(t)} found`)];let _=[];for(const w in t){const E=w.match(/^(.*)-transition$/),R=w.match(/^(.*)-use-theme$/);_=_.concat(R&&c[R[1]]?fr({key:w,value:t[w],valueSpec:{type:"string"},style:m,styleSpec:r}):E&&c[E[1]]&&c[E[1]].transition?fr({key:w,value:t[w],valueSpec:r.transition,style:m,styleSpec:r}):c[w]?fr({key:w,value:t[w],valueSpec:c[w],style:m,styleSpec:r}):[new s.V(w,t[w],`unknown property "${w}"`)])}return _}function ss(u){const t=u.value;if(!t)return[];const r=u.key;if(!s.H(t))return[new s.V(r,t,`object expected, ${s.K(t)} found`)];let c=[];const m=u.styleSpec,_=m["light-3d"],w=u.style,E=u.style.lights;for(const L of["type","id"])if(!(L in t))return c=c.concat([new s.V(r,t,`missing property "${L}"`)]),c;if(!s.a0(t.type))return c=c.concat([new s.V(`${r}.type`,t.type,"string expected")]),c;if(E)for(let L=0;L<u.arrayIndex;L++){const F=s.J(t.type),k=E[L];s.J(k.type)===F&&c.push(new s.V(r,t.id,`duplicate light type "${t.type}", previously defined at line ${k.id.__line__}`))}const R=`properties_light_${t.type}`;if(!(R in m))return c=c.concat([new s.V(`${r}.type`,t,`Invalid light type ${t.type}`)]),c;const D=m[R];for(const L in t)if(L==="properties"){const F=t[L];if(!s.H(F))return c=c.concat([new s.V("properties",F,`object expected, ${s.K(F)} found`)]),c;for(const k in F){const H=k.match(/^(.*)-transition$/),$=k.match(/^(.*)-use-theme$/);c=c.concat($&&D[$[1]]?fr({key:L,value:F[k],valueSpec:{type:"string"},style:w,styleSpec:m}):H&&D[H[1]]&&D[H[1]].transition?fr({key:L,value:t[L],valueSpec:m.transition,style:w,styleSpec:m}):D[k]?fr({key:k,value:F[k],valueSpec:D[k],style:w,styleSpec:m}):[new s.a3(u.key,F[k],`unknown property "${k}"`)])}}else c=c.concat(_[L]?fr({key:L,value:t[L],valueSpec:_[L],style:w,styleSpec:m}):[new s.a3(L,t[L],`unknown property "${L}"`)]);return c}function Ka(u){const t=u.value,r=u.key,c=u.style,m=u.styleSpec,_=m.terrain;if(t==null)return[];if(!s.H(t))return[new s.V("terrain",t,`object expected, ${s.K(t)} found`)];let w=[];for(const E in t){const R=E.match(/^(.*)-transition$/),D=E.match(/^(.*)-use-theme$/);w=w.concat(D&&_[D[1]]?fr({key:E,value:t[E],valueSpec:{type:"string"},style:c,styleSpec:m}):R&&_[R[1]]&&_[R[1]].transition?fr({key:E,value:t[E],valueSpec:m.transition,style:c,styleSpec:m}):_[E]?fr({key:E,value:t[E],valueSpec:_[E],style:c,styleSpec:m}):[new s.a3(E,t[E],`unknown property "${E}"`)])}if(t.source)if(s.a0(t.source)){const E=c.sources&&c.sources[t.source],R=E&&s.J(E.type);E?R!=="raster-dem"&&w.push(new s.V(`${r}.source`,t.source,`terrain cannot be used with a source of type ${R}, it only be used with a "raster-dem" source type`)):w.push(new s.V(`${r}.source`,t.source,`source "${t.source}" not found`))}else w.push(new s.V(`${r}.source`,t.source,"source must be a string"));else w.push(new s.V(r,t,'terrain is missing required property "source"'));return w}function Ls(u){const t=u.value,r=u.style,c=u.styleSpec,m=c.fog;if(t===void 0)return[];if(!s.H(t))return[new s.V("fog",t,`object expected, ${s.K(t)} found`)];let _=[];for(const w in t){const E=w.match(/^(.*)-transition$/),R=w.match(/^(.*)-use-theme$/);_=_.concat(R&&m[R[1]]?fr({key:w,value:t[w],valueSpec:{type:"string"},style:r,styleSpec:c}):E&&m[E[1]]&&m[E[1]].transition?fr({key:w,value:t[w],valueSpec:c.transition,style:r,styleSpec:c}):m[w]?fr({key:w,value:t[w],valueSpec:m[w],style:r,styleSpec:c}):[new s.a3(w,t[w],`unknown property "${w}"`)])}return _}const hs={"*":()=>[],array:qr,boolean:function(u){const t=u.value,r=u.key;return s.$(t)?[]:[new s.V(r,t,`boolean expected, ${s.K(t)} found`)]},number:bs,color:function({key:u,value:t}){return s.a0(t)?s.a1.parseCSSColor(t)===null?[new s.V(u,t,`color expected, "${t}" found`)]:[]:[new s.V(u,t,`color expected, ${s.K(t)} found`)]},enum:po,filter:mo,function:fa,layer:Bs,object:as,source:Or,model:s.a7,light:Ya,"light-3d":ss,terrain:Ka,fog:Ls,string:Fs,formatted:function(u){return Fs(u).length===0?[]:Un(u)},resolvedImage:function(u){return Fs(u).length===0?[]:Un(u)},projection:function(u){const t=u.value,r=u.styleSpec,c=r.projection,m=u.style;if(s.H(t)){let _=[];for(const w in t)_=_.concat(fr({key:w,value:t[w],valueSpec:c[w],style:m,styleSpec:r}));return _}return s.a0(t)?[]:[new s.V("projection",t,`object or string expected, ${s.K(t)} found`)]},import:function(u){const t=u.key,{value:r,styleSpec:c}=u;if(!s.H(r))return[new s.V(t,r,"import must be an object")];const{data:m,..._}=r;Object.defineProperty(_,"__line__",{value:r.__line__,enumerable:!1});let w=as(Object.assign({},u,{value:_,valueSpec:c.import}));return s.J(_.id)===""&&w.push(new s.V(`${u.key}.id`,_,"import id can't be an empty string")),m&&(w=w.concat(ka(m,c,{key:`${u.key}.data`}))),w},iconset:function(u){const t=u.value,r=u.key,c=u.styleSpec,m=u.style;if(!s.H(t))return[new s.V(r,t,"object expected")];if(!t.type)return[new s.V(r,t,'"type" is required')];const _=s.J(t.type);let w=[];if(w=w.concat(as({key:r,value:t,valueSpec:c[`iconset_${_}`],style:m,styleSpec:c})),function(E,R){return!(E!=="source"||!R.source)}(_,t)){const E=m.sources&&m.sources[t.source],R=E&&s.J(E.type);E?R!=="raster-array"&&w.push(new s.V(r,t.source,`iconset cannot be used with a source of type ${String(R)}, it only be used with a "raster-array" source type`)):w.push(new s.V(r,t.source,`source "${t.source}" not found`))}return w}};function fr(u,t=!1){const r=u.value,c=u.valueSpec,m=u.styleSpec;if(c.expression){if(s.a4(s.J(r)))return fa(u);if(s.Q(s.S(r)))return Un(u)}if(c.type&&hs[c.type]){const _=hs[c.type](u);return t===!0&&_.length>0&&Array.isArray(u.value)?Un(u):_}return as(Object.assign({},u,{valueSpec:c.type?m[c.type]:c}))}function as(u){const t=u.key,r=u.value,c=u.valueSpec||{},m=u.objectElementValidators||{},_=u.style,w=u.styleSpec;if(!s.H(r))return[new s.V(t,r,`object expected, ${s.K(r)} found`)];let E=[];for(const R in r){const D=R.split(".")[0];let L;m[D]?L=m[D]:c[D]?L=fr:m["*"]?L=m["*"]:c["*"]&&(L=fr),L?E=E.concat(L({key:(t&&`${t}.`)+R,value:r[R],valueSpec:c[D]||c["*"],style:_,styleSpec:w,object:r,objectKey:R},r)):E.push(new s.a3(t,r[R],`unknown property "${R}"`))}for(const R in c)m[R]||c[R].required&&c[R].default===void 0&&r[R]===void 0&&E.push(new s.V(t,r,`missing required property "${R}"`));return E}function bc({key:u,value:t}){const r=Fs({key:u,value:t});if(r.length)return r;const c=t;return c.indexOf("{fontstack}")===-1&&r.push(new s.V(u,t,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&r.push(new s.V(u,t,'"glyphs" url must include a "{range}" token')),r}function ka(u,t=s.a6,r={}){return as({key:r.key||"",value:u,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:u,objectElementValidators:{glyphs:bc}})}function ds(u,t=s.a6){return Le(ka(u,t))}const Ur=u=>Le(Or(u)),No=u=>Le(Ya(u)),pa=u=>Le(ss(u)),Mt=u=>Le(Ka(u)),ea=u=>Le(Ls(u)),go=u=>Le(function(t){const r=t.value,c=t.style,m=t.styleSpec,_=m.snow;if(r===void 0)return[];if(!s.H(r))return[new s.V("snow",r,`object expected, ${s.K(r)} found`)];let w=[];for(const E in r){const R=E.match(/^(.*)-transition$/);w=w.concat(R&&_[R[1]]&&_[R[1]].transition?fr({key:E,value:r[E],valueSpec:m.transition,style:c,styleSpec:m}):_[E]?fr({key:E,value:r[E],valueSpec:_[E],style:c,styleSpec:m}):[new s.a3(E,r[E],`unknown property "${E}"`)])}return w}(u)),Na=u=>Le(function(t){const r=t.value,c=t.style,m=t.styleSpec,_=m.rain;if(r===void 0)return[];if(!s.H(r))return[new s.V("rain",r,`object expected, ${s.K(r)} found`)];let w=[];for(const E in r){const R=E.match(/^(.*)-transition$/);w=w.concat(R&&_[R[1]]&&_[R[1]].transition?fr({key:E,value:r[E],valueSpec:m.transition,style:c,styleSpec:m}):_[E]?fr({key:E,value:r[E],valueSpec:_[E],style:c,styleSpec:m}):[new s.a3(E,r[E],`unknown property "${E}"`)])}return w}(u)),He=u=>Le(Bs(u)),J=u=>Le(mo(u)),ne=u=>Le(Gr(u)),_e=u=>Le(Yr(u)),ke=u=>Le(s.a7(u));function Le(u){return u.slice().sort((t,r)=>t.line&&r.line?t.line-r.line:0)}function Ie(u,t){let r=!1;if(t&&t.length)for(const c of t)c instanceof s.a3?s.w(c.message):(u.fire(new s.y(new Error(c.message))),r=!0);return r}let et;class Be extends s.E{constructor(t,r="flat"){super(),this._transitionable=new s.a8(et||(et=new s.a9({anchor:new s.aa(s.a6.light.anchor),position:new s.ab(s.a6.light.position),color:new s.aa(s.a6.light.color),intensity:new s.aa(s.a6.light.intensity)}))),this.setLight(t,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r,c={}){this._validate(No,t,c)||(this._transitionable.setTransitionOrValue(t),this.id=r)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,c){return(!c||c.validate!==!1)&&Ie(this,t.call(ds,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let Je=class extends s.E{constructor(u,t,r,c,m){super(),this.scope=r,this._transitionable=new s.a8(new s.a9({source:new s.aa(s.a6.terrain.source),exaggeration:new s.aa(s.a6.terrain.exaggeration)}),r,c),this._transitionable.setTransitionOrValue(u,c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=m}get(){return this._transitionable.serialize()}set(u,t){this._transitionable.setTransitionOrValue(u,t)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}getExaggeration(u){return this._transitioning.possiblyEvaluate(new s.ac(u,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const u=this._transitionable._values.exaggeration;if(!u)return null;const t=u.value.expression;if(!t)return null;let r=-1,c=-1,m=1;for(const _ of t.zoomStops)m=t.evaluate(new s.ac(_,{worldview:this.worldview})),m>.01?(r=_,c=-1):c=_;return m<.01&&r>0&&c>r?[r,c]:null}isZoomDependent(){const u=this._transitionable._values.exaggeration;return u!=null&&u.value!=null&&u.value.expression!=null&&u.value.expression instanceof s.ad}};const zt=45,vt=65,pi=.05;function Ai(u,t,r,c){const m=s.ah(zt,vt,r),[_,w]=Vi(u,c);let E=1-Math.min(1,Math.exp((t-_)/(w-_)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*m*u.alpha}function Vi(u,t){const r=.5/Math.tan(.5*t);return[u.range[0]+r,u.range[1]+r]}function on(u,t,r,c,m){const _=s.af([],[t,r,c],m.mercatorFogMatrix);return Ai(u,s.ag(_),m.pitch,m._fov)}function rn(u,t,r,c,m,_,w){const E=[[r,c,0],[m,c,0],[m,_,0],[r,_,0]];let R=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(const L of E){const F=s.af([],L,t),k=s.ag(F);R=Math.min(R,k),D=Math.max(D,k)}return[Ai(u,R,w.pitch,w._fov),Ai(u,D,w.pitch,w._fov)]}class ln extends s.E{constructor(t,r,c,m){super();const _=new s.a9({range:new s.aa(s.a6.fog.range),color:new s.aa(s.a6.fog.color),"color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.aa(s.a6.fog["high-color"]),"high-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.aa(s.a6.fog["space-color"]),"space-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.aa(s.a6.fog["horizon-blend"]),"star-intensity":new s.aa(s.a6.fog["star-intensity"]),"vertical-range":new s.aa(s.a6.fog["vertical-range"])});this._transitionable=new s.a8(_,c,new Map(m)),this.set(t,m),this._transitioning=this._transitionable.untransitioned(),this._transform=r,this.properties=new s.ai(_),this.scope=c}get state(){const t=this._transform,r=t.projection.name==="globe",c=s.aj(t.zoom),m=this.properties.get("range"),_=[.5,3];return{range:r?[s.ak(_[0],m[0],c),s.ak(_[1],m[1],c)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,r,c={}){if(this._validate(ea,t,c))return;const m=Object.assign({},t);for(const _ of Object.keys(s.a6.fog))m[_]===void 0&&(m[_]=s.a6.fog[_].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,r)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ah(zt,vt,t))*r.a}getOpacityAtLatLng(t,r){return this._transform.projection.supportsFog?function(c,m,_){const w=s.ae.fromLngLat(m),E=_.elevation?_.elevation.getAtPointOrZero(w):0;return on(c,w.x,w.y,E,_)}(this.state,t,r):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(t.toUnwrapped());return rn(this.state,r,0,0,s.al,s.al,this._transform)}getOpacityForBounds(t,r,c,m,_){return this._transform.projection.supportsFog?rn(this.state,t,r,c,m,_,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Vi(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const c of r){const m=t.points[c];let _;if(m[2]>=0)_=m;else{const w=t.points[c-4];_=s.am(w,m,w[2]/(w[2]-m[2]))}if(on(this.state,_[0],_[1],0,this._transform)>=pi)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,c){return(!c||c.validate!==!1)&&Ie(this,t.call(ds,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let jn,cn,cr,$n,Ve=class extends s.E{constructor(u,t,r,c){super();const m=jn||(jn=new s.a9({density:new s.aa(s.a6.snow.density),intensity:new s.aa(s.a6.snow.intensity),color:new s.aa(s.a6.snow.color),opacity:new s.aa(s.a6.snow.opacity),vignette:new s.aa(s.a6.snow.vignette),"vignette-color":new s.aa(s.a6.snow["vignette-color"]),"center-thinning":new s.aa(s.a6.snow["center-thinning"]),direction:new s.aa(s.a6.snow.direction),"flake-size":new s.aa(s.a6.snow["flake-size"])}));this._transitionable=new s.a8(m,r,new Map(c)),this.set(u,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(m),this.scope=r}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),r=this.properties.get("direction"),c=s.an(r[0]),m=-Math.max(s.an(r[1]),.01),_=[Math.cos(c)*Math.cos(m),Math.sin(c)*Math.cos(m),Math.sin(m)],w=this.properties.get("vignette"),E=this.properties.get("vignette-color");return E.a=w,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(t.r,t.g,t.b,t.a*u),direction:_,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(u,t,r={}){if(this._validate(go,u,r))return;const c=Object.assign({},u);for(const m of Object.keys(s.a6.snow))c[m]===void 0&&(c[m]=s.a6.snow[m].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,r){return(!r||r.validate!==!1)&&Ie(this,u.call(ds,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}},wt=class extends s.E{constructor(u,t,r,c){super();const m=cn||(cn=new s.a9({density:new s.aa(s.a6.rain.density),intensity:new s.aa(s.a6.rain.intensity),color:new s.aa(s.a6.rain.color),opacity:new s.aa(s.a6.rain.opacity),vignette:new s.aa(s.a6.rain.vignette),"vignette-color":new s.aa(s.a6.rain["vignette-color"]),"center-thinning":new s.aa(s.a6.rain["center-thinning"]),direction:new s.aa(s.a6.rain.direction),"droplet-size":new s.aa(s.a6.rain["droplet-size"]),"distortion-strength":new s.aa(s.a6.rain["distortion-strength"])}));this._transitionable=new s.a8(m,r,new Map(c)),this.set(u,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(m),this.scope=r}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),r=this.properties.get("direction"),c=s.an(r[0]),m=-Math.max(s.an(r[1]),.01),_=[Math.cos(c)*Math.cos(m),Math.sin(c)*Math.cos(m),Math.sin(m)],w=this.properties.get("vignette-color");return w.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(t.r,t.g,t.b,t.a*u),direction:_,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(u,t,r={}){if(this._validate(Na,u,r))return;const c=Object.assign({},u);for(const m of Object.keys(s.a6.rain))c[m]===void 0&&(c[m]=s.a6.rain[m].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,r){return(!r||r.validate!==!1)&&Ie(this,u.call(ds,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}};class Bt extends s.E{constructor(t,r,c,m){super(),this.scope=c,this._options=t,this.properties=new s.ai(r),this._transitionable=new s.a8(r,c,new Map(m)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,r){this._options=t,this._transitionable.setTransitionOrValue(t.properties,r)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Qt{constructor(t,r,c){this.screenBounds=t,this.cameraPoint=c.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=r,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,c)}static createFromScreenPoints(t,r){let c,m;if(t instanceof s.P||typeof t[0]=="number"){const _=s.P.convert(t);c=[_],m=r.isPointAboveHorizon(_)}else{const _=s.P.convert(t[0]),w=s.P.convert(t[1]),E=_.add(w)._div(2);c=[_,w],m=s.aq(_,w).every(R=>r.isPointAboveHorizon(R))&&r.isPointAboveHorizon(E)}return new Qt(c,m,r)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return s.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const r=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],m=s.aq(r,c,0,!1);return this.cameraPoint.y>c.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<c.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=c.x?m[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(m[3]=this.cameraPoint)),s.ar(m,t)}bufferedCameraGeometryGlobe(t){const r=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],m=s.aq(r,c,t),_=this.cameraPoint.clone();switch(3*((_.y>r.y)+(_.y>c.y))+((_.x>r.x)+(_.x>c.x))){case 0:m[0]=_,m[4]=_.clone();break;case 1:m.splice(1,0,_);break;case 2:m[1]=_;break;case 3:m.splice(4,0,_);break;case 5:m.splice(2,0,_);break;case 6:m[3]=_;break;case 7:m.splice(3,0,_);break;case 8:m[2]=_}return m}containsTile(t,r,c,m=0){const _=t.queryPadding/r._pixelsPerMercatorPixel+1,w=c?this._bufferedCameraMercator(_,r):this._bufferedScreenMercator(_,r);let E=t.tileID.wrap+(w.unwrapped?m:0);const R=w.polygon.map(ee=>s.as(t.tileTransform,ee,E));if(!s.at(R,0,0,s.al,s.al))return;E=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const D=this.screenGeometryMercator.polygon.map(ee=>s.au(t.tileTransform,ee,E)),L=D.map(ee=>new s.P(ee[0],ee[1])),F=r.getFreeCameraOptions().position||new s.ae(0,0,0),k=s.au(t.tileTransform,F,E),H=D.map(ee=>{const X=s.av(ee,ee,k);return s.aw(X,X),new s.ax(k,X)}),$=s.ay(t,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:H,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(G=s.az(R),G.min.x=s.aA(G.min.x,0,s.al),G.min.y=s.aA(G.min.y,0,s.al),G.max.x=s.aA(G.max.x,0,s.al),G.max.y=s.aA(G.max.y,0,s.al),G),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:$};var G}_bufferedScreenMercator(t,r){const c=yr(t);if(this._screenRaycastCache[c])return this._screenRaycastCache[c];{let m;return m=r.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),r):{polygon:this.bufferedScreenGeometry(t).map(_=>r.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[c]=m,m}}_bufferedCameraMercator(t,r){const c=yr(t);if(this._cameraRaycastCache[c])return this._cameraRaycastCache[c];{let m;return m=r.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),r):{polygon:this.bufferedCameraGeometry(t).map(_=>r.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[c]=m,m}}_projectAndResample(t,r){const c=function(_,w){const E=s.aB([],w.pixelMatrix,w.globeMatrix),R=[0,-s.aD,0,1],D=[0,s.aD,0,1],L=[0,0,0,1];s.aC(R,R,E),s.aC(D,D,E),s.aC(L,L,E);const F=new s.P(R[0]/R[3],R[1]/R[3]),k=new s.P(D[0]/D[3],D[1]/D[3]),H=s.aE(_,F)&&R[3]<L[3],$=s.aE(_,k)&&D[3]<L[3];if(!H&&!$)return null;const G=function(Ee,ve,be){for(let Ce=1;Ce<Ee.length;Ce++){const We=$i(ve.pointCoordinate3D(Ee[Ce-1]).x),je=$i(ve.pointCoordinate3D(Ee[Ce]).x);if(be<0){if(We<je)return{idx:Ce,t:-We/(je-1-We)}}else if(je<We)return{idx:Ce,t:(1-We)/(je+1-We)}}return null}(_,w,H?-1:1);if(!G)return null;const{idx:ee,t:X}=G;let ie=ee>1?bi(_.slice(0,ee),w):[],ce=ee<_.length?bi(_.slice(ee),w):[];ie=ie.map(Ee=>new s.P($i(Ee.x),Ee.y)),ce=ce.map(Ee=>new s.P($i(Ee.x),Ee.y));const de=[...ie];de.length===0&&de.push(ce[ce.length-1]);const Te=s.ak(de[de.length-1].y,(ce.length===0?ie[0]:ce[0]).y,X);let we;return we=H?[new s.P(0,Te),new s.P(0,0),new s.P(1,0),new s.P(1,Te)]:[new s.P(1,Te),new s.P(1,1),new s.P(0,1),new s.P(0,Te)],de.push(...we),ce.length===0?de.push(ie[0]):de.push(...ce),{polygon:de.map(Ee=>new s.ae(Ee.x,Ee.y)),unwrapped:!1}}(t,r);if(c)return c;const m=function(_,w){let E=!1,R=-1/0,D=0;for(let F=0;F<_.length-1;F++)_[F].x>R&&(R=_[F].x,D=F);for(let F=0;F<_.length-1;F++){const k=(D+F)%(_.length-1),H=_[k],$=_[k+1];Math.abs(H.x-$.x)>.5&&(H.x<$.x?(H.x+=1,k===0&&(_[_.length-1].x+=1)):($.x+=1,k+1===_.length-1&&(_[0].x+=1)),E=!0)}const L=s.aF(w.center.lng);return E&&L<Math.abs(L-1)&&_.forEach(F=>{F.x-=1}),{polygon:_,unwrapped:E}}(bi(t,r).map(_=>new s.P($i(_.x),_.y)),r);return{polygon:m.polygon.map(_=>new s.ae(_.x,_.y)),unwrapped:m.unwrapped}}}function bi(u,t){return s.aG(u,r=>{const c=t.pointCoordinate3D(r);r.x=c.x,r.y=c.y},1/256)}function $i(u){return u<0?1+u%1:u%1}function yr(u){return 100*u|0}function Kn(u,t,r,c,m){const _=function(E,R){if(E)return m(E);if(R){if(u.url&&R.tiles&&u.tiles&&delete u.tiles,R.variants){if(!Array.isArray(R.variants))return m(new Error("variants must be an array"));for(const L of R.variants){if(L==null||typeof L!="object"||L.constructor!==Object)return m(new Error("variant must be an object"));if(!Array.isArray(L.capabilities))return m(new Error("capabilities must be an array"));if(L.capabilities.length===1&&L.capabilities[0]==="meshopt"){R=Object.assign(R,L);break}}}const D=s.aH(Object.assign({},R,u),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);D.tiles=t.canonicalizeTileset(D,u.url),m(null,D)}},w=function(E,R,D){if(!E)return null;if(!R&&!D)return E;D=D||E.worldview_default;const L=Object.values(E.language||{});if(L.length===0)return null;const F=Object.values(E.worldview||{});if(F.length===0)return null;const k=L.every($=>$===R),H=F.every($=>$===D);return k&&H?E:R in(E.language_options||{})||D in(E.worldview_options||{})?null:E.language_options&&E.worldview_options?E:null}(u.data,r,c);return w?s.o.frame(()=>_(null,w)):u.url?s.m(t.transformRequest(t.normalizeSourceURL(u.url,null,r,c),s.R.Source),_):s.o.frame(()=>{const{data:E,...R}=u;_(null,R)})}function ar(u,t){const r=Math.pow(2,t.z),c=Math.floor(s.aF(u.getWest())*r),m=Math.floor(s.aJ(u.getNorth())*r),_=Math.ceil(s.aF(u.getEast())*r),w=Math.ceil(s.aJ(u.getSouth())*r);return t.x>=c&&t.x<_&&t.y>=m&&t.y<w}class Sr{constructor(t,r,c){this.bounds=t?s.aI.convert(this.validateBounds(t)):null,this.minzoom=r||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const r of t)this.extraBounds.push(s.aI.convert(this.validateBounds(r)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!ar(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const r of this.extraBounds)if(ar(r,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const r=new Sr(t.bounds,t.minzoom,t.maxzoom);return r.addExtraBounds(t.extra_bounds),r}}class Vr extends s.E{constructor(t,r,c,m){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,s.aH(r,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new s.aK}load(t){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=Kn(this._options,this.map._requestManager,r,c,(m,_)=>{if(this._tileJSONRequest=null,this._loaded=!0,m)r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),c&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new s.y(m));else if(_){if(Object.assign(this,_),this.hasWorldviews=!!_.worldview_options,_.worldview_default&&(this.worldviewDefault=_.worldview_default),_.vector_layers){this.vectorLayers=_.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const w of _.vector_layers)this.vectorLayerIds.push(w.id),_.worldview&&_.worldview[w.source]&&this.localizableLayerIds.add(w.id)}this.tileBounds=Sr.fromTileJSON(_),Di(_.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(m)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,r){const c=t.tileID.canonical.url(this.tiles,this.scheme),m=this.map._requestManager.normalizeTileURL(c),_=this.map._requestManager.transformRequest(m,s.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,E=w?{image:w.image.clone()}:null,R={request:_,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:E,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&s.h(c)&&(R.localizableLayerIds=this.localizableLayerIds),R.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=r:t.request=t.actor.send("reloadTile",R,D.bind(this));else if(t.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",R,D.bind(this),void 0,!0);else{const L=s.aL.call({deduped:this._deduped},R,(F,k)=>{F||!k?D.call(this,F):(R.data={cacheControl:k.cacheControl,expires:k.expires,rawData:k.rawData.slice(0)},t.actor&&t.actor.send("loadTile",R,D.bind(this),void 0,!0))},!0);t.request={cancel:L}}function D(L,F){return delete t.request,t.aborted?r(null):L&&L.status!==404?r(L):(F&&F.resourceTiming&&(t.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&t.setExpiryData(F),t.loadVectorData(F,this.map.painter),s.aM(this.dispatcher),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,r){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ja extends s.E{constructor(t,r,c,m){super(),this.id=t,this.dispatcher=c,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},r),Object.assign(this,s.aH(r,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const r=this.map.getWorldview();this._tileJSONRequest=Kn(this._options,this.map._requestManager,null,r,(c,m)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new s.y(c)):m&&(Object.assign(this,m),m.raster_layers&&(this.rasterLayers=m.raster_layers,this.rasterLayerIds=this.rasterLayers.map(_=>_.id)),this.tileBounds=Sr.fromTileJSON(m),Di(m.tiles),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(c)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const c=s.o.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),c,this.tileSize);t.request=s.n(this.map._requestManager.transformRequest(m,s.R.Tile),(_,w,E,R)=>(delete t.request,t.aborted?(t.state="unloaded",r(null)):_?(t.state="errored",r(_)):w?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:E,expires:R}),t.setTexture(w,this.map.painter),t.state="loaded",s.aM(this.dispatcher),void r(null)):r(null)))}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r&&r()}unloadTile(t,r){t.texture&&t.texture instanceof s.T?(t.destroy(!0),t.texture&&t.texture instanceof s.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),r&&r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Ja([u,t],r,c,{scaled:m=!0}={}){const{tileSize:_,buffer:w}=c,{x:E,y:R,z:D}=r;if(!isFinite(E)||!isFinite(R)||!isFinite(D))throw new Error("Invalid MRT header");const L=2**D,F=L*s.aF(u),k=L*s.aJ(t);return function([H,$],G,{scaled:ee=!0}={}){if(!G)throw new Error("bandView is undefined");const{data:X,tileSize:ie,buffer:ce,offset:de,scale:Te,dimension:we}=G;if(H<-ce||H>ie+ce||$<-ce||$>ie+ce)throw new Error(`Point (${H}, ${$}) out of bounds for tileSize=${ie}, buffer=${ce}`);const Ee=($+ce)*(ie+2*ce)+(H+ce);if(new Uint32Array(X.buffer)[Ee]===4294967295)return null;let ve=[];ve=ee?[]:new G.data.constructor(we);for(let be=0;be<we;be++)ve[be]=Math.round(1e12*(X[we*Ee+be]*Te+de))/1e12;return ve}([Math.min(Math.max(-w,Math.floor((F-E)*_)),_-1+w),Math.min(Math.max(-w,Math.floor((k-R)*_)),_-1+w)],c,{scaled:m})}class Ll extends ja{constructor(t,r,c,m){super(t,r,c,m),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},r)}triggerRepaint(t){const r=this.map.painter._terrain,c=this.map.style.getSourceCache(this.id);r&&r.enabled&&c&&r._clearRenderCacheForTile(c.id,t.tileID),this.map.triggerRepaint()}loadTile(t,r){const c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(c,s.R.Tile),_={request:m,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=m,t.actor||(t.actor=this.dispatcher.getActor());const w=(E,R,D,L)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(E)return E.name==="AbortError"?void 0:(t.state="errored",r(E));if(this.map._refreshExpiredTiles&&R&&t.setExpiryData({cacheControl:D,expires:L}),this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!R)return r(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=R}r(null)};t.request=this.partial?t.fetchHeader(void 0,w.bind(this)):t.actor.send("loadTile",_,w.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,r){const c=t.texturePerLayer;if(t.flushAllQueues(),c.size){t.destroy(!0);for(const m of c.values())this.map.painter.saveTileTexture(m)}else t.destroy()}prepareTile(t,r,c,m){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(r,c,m,(_,w)=>{if(_)return t.state="errored",this.fire(new s.y(_)),void this.triggerRepaint(t);w&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(c,w,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const r=this.rasterLayers.find(({id:_})=>_===t),c=r&&r.fields,m=c&&c.bands&&c.bands;return m?m[0]:0}getTextureDescriptor(t,r,c){if(!t)return;const m=r.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!m)return;let _=null;r instanceof s.aP?_=r.paint.get("raster-array-band"):r instanceof s.aQ&&(_=r.paint.get("raster-particle-array-band"));const w=_||this.getInitialBand(m);if(w==null)return;if(!t.textureDescriptorPerLayer.get(r.id))return void this.prepareTile(t,m,r.id,w);if(t.updateNeeded(r.id,w)&&!c)return;const E=t.textureDescriptorPerLayer.get(r.id);return Object.assign({},E,{texture:t.texturePerLayer.get(r.id)})}getImages(t,r){const c=new Map;for(const m of t)for(const _ of r){const[w,E]=_.split("/"),R=m.getLayer(w);if(!R||!R.hasBand(E)||!R.hasDataForBand(E))continue;const{bytes:D,tileSize:L,buffer:F}=R.getBandView(E),k=L+2*F,H={data:new s.q({width:k,height:k},D),pixelRatio:2,sdf:!1,usvg:!1,version:0};c.set(_,H)}return c}queryRasterArrayValueByBandId(t,r,c){const m=r._mrt;return new Promise(_=>{const w={},E=new Set;for(const[R,D]of Object.entries(m.layers)){if(c.layerName&&R!==c.layerName)continue;const L={};w[R]=L;for(const{bands:F}of D.dataIndex)for(const k of F)c.bands&&!c.bands.includes(k)||(E.add(s.B(R,k)),r.fetchBand(R,null,k,H=>{s.o.frame(()=>{L[k]=H?null:Ja([t.lng,t.lat],m,D.getBandView(k)),E.delete(s.B(R,k)),E.size===0&&_(w)})},!1))}E.size===0&&_(w)})}_loadTileForQuery(t,r){if(this._loadTileLoaded[t.uid])return void r(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(r);this._loadTilePending[t.uid]=[r];const c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(c,s.R.Tile);t.actor.send("loadTile",{request:m,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(_,w,E,R)=>_?(this._loadTilePending[t.uid].forEach(D=>D(_,null)),void delete this._loadTilePending[t.uid]):w?(this.map._refreshExpiredTiles&&w&&t.setExpiryData({cacheControl:E,expires:R}),t._mrt=w,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach(D=>D(null,w)),this._loadTileLoaded[t.uid]=!0,void delete this._loadTilePending[t.uid]):(this._loadTilePending[t.uid].forEach(D=>D(null,null)),void delete this._loadTilePending[t.uid]),void 0,!0)}queryRasterArrayValueByAllBands(t,r,c){return new Promise((m,_)=>{this._loadTileForQuery(r,(w,E)=>{w?_(w):m(E?this.queryRasterArrayValueByBandId(t,r,c):null)})})}queryRasterArrayValue(t,r){const c=s.aR.convert(t),m=this.findLoadedParent(c);return m&&m._mrt?r.bands||!this.partial?this.queryRasterArrayValueByBandId(c,m,r):this.queryRasterArrayValueByAllBands(c,m,r):Promise.resolve(null)}findLoadedParent(t){const r=s.ae.fromLngLat(t,this.map.transform.tileSize),c=this.maxzoom+1,m=1<<c,_=Math.floor(r.x),w=Math.floor((r.x-_)*m),E=Math.floor(r.y*m),R=this.map.style.getSourceCache(this.id),D=new s.aO(c,_,c,w,E);return R.findLoadedParent(D,this.minzoom)}}const oh={vector:Vr,raster:ja,"raster-dem":class extends ja{constructor(u,t,r,c){super(u,t,r,c),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(u,t){const r=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function c(m,_){m&&(u.state="errored",t(m)),_&&(u.dem=_,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",t(null))}u.request=s.n(this.map._requestManager.transformRequest(r,s.R.Tile),(function(m,_,w,E){if(delete u.request,u.aborted)u.state="unloaded",t(null);else if(m)u.state="errored",t(m);else if(_){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:w,expires:E});const R=ImageBitmap&&_ instanceof ImageBitmap&&s.r(),D=1-(_.width-s.aN(_.width))/2;D<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const L=R?_:s.o.getImageData(_,D),F={uid:u.uid,tileID:u.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:D};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadTile",F,c.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(u){const t=u.canonical,r=Math.pow(2,t.z),c=(t.x-1+r)%r,m=t.x===0?u.wrap-1:u.wrap,_=(t.x+1+r)%r,w=t.x+1===r?u.wrap+1:u.wrap,E={};return E[new s.aO(u.overscaledZ,m,t.z,c,t.y).key]={backfilled:!1},E[new s.aO(u.overscaledZ,w,t.z,_,t.y).key]={backfilled:!1},t.y>0&&(E[new s.aO(u.overscaledZ,m,t.z,c,t.y-1).key]={backfilled:!1},E[new s.aO(u.overscaledZ,u.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},E[new s.aO(u.overscaledZ,w,t.z,_,t.y-1).key]={backfilled:!1}),t.y+1<r&&(E[new s.aO(u.overscaledZ,m,t.z,c,t.y+1).key]={backfilled:!1},E[new s.aO(u.overscaledZ,u.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},E[new s.aO(u.overscaledZ,w,t.z,_,t.y+1).key]={backfilled:!1}),E}},"raster-array":Ll,geojson:class extends s.E{constructor(u,t,r,c){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(c),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const m=s.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*m,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*m,extent:s.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:s.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*m,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}updateData(u){if(!this._options.dynamic)return this.fire(new s.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof u!="string"&&(u.type==="Feature"&&(u={type:"FeatureCollection",features:[u]}),u.type!=="FeatureCollection"))return this.fire(new s.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof u!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const r of this._data.features)t.set(r.id,r);for(const r of u.features)t.set(r.id,r);this._data.features=[...t.values()]}else this._data=u;return this._updateWorkerData(!0),this}getClusterExpansionZoom(u,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterChildren(u,t){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterLeaves(u,t,r,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:u,limit:t,offset:r},c),this}_updateWorkerData(u=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:u},this.workerOptions);t.scope=this.scope;const r=this._data;typeof r=="string"?(t.request=this.map._requestManager.transformRequest(s.o.resolveURL(r),s.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(c,m)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new s.y(c));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(_.resourceTiming=m.resourceTiming[this.id]),u&&(this._partialReload=!0),this.fire(new s.z("data",_)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(u),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const u=s.B(this.id,this.scope);this.map.style.clearSource(u),this._updateWorkerData()}loadTile(u,t){const r=u.actor?"reloadTile":"loadTile";u.actor=this.actor;const c=this.map.style?this.map.style.getLut(this.scope):null,m=c?{image:c.image.clone()}:null,_=this._partialReload,w={type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:m,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:u.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:_,worldview:this.map.getWorldview()};u.request=this.actor.send(r,w,(E,R)=>_&&!R?(u.state="loaded",t(null)):(delete u.request,u.destroy(),u.aborted?t(null):E?t(E):(u.loadVectorData(R,this.map.painter,r==="reloadTile"),t(null))),void 0,r==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u,t){this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}onRemove(u){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aS{constructor(u,t,r,c){super(u,t,r,c),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const t of u.urls)this.urls.push(this.map._requestManager.transformRequest(t,s.R.Source).url);s.aT(this.urls,(t,r)=>{this._loaded=!0,t?this.fire(new s.y(t)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const t=this.video.seekable;u<t.start(0)||u>t.end(0)?this.fire(new s.y(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,t=u.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(u,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aS,model:class extends s.E{constructor(u,t,r,c){super(),this.id=u,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const u=[];for(const t in this._options.models){const r=this._options.models[t],c=s.aV(this.map._requestManager.transformRequest(r.uri,s.R.Model).url).then(m=>{if(!m)return;const _=s.aW(m),w=new s.aX(t,r.position,r.orientation,_);w.computeBoundsAndApplyParent(),this.models.push(w)}).catch(m=>{this.fire(new s.y(new Error(`Could not load model ${t} from ${r.uri}: ${m.message}`)))});u.push(c)}Promise.allSettled(u).then(()=>{this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new s.y(new Error(`Could not load models: ${t.message}`)))})}onAdd(u){this.map=u,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(u,t){}serialize(){return this._options}},"batched-model":class extends s.E{constructor(u,t,r,c){super(),this.type="batched-model",this.id=u,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(c)}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest();const u=s.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(u))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(u){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map.getWorldview();this._tileJSONRequest=Kn(this._options,this.map._requestManager,t,r,(c,m)=>{this._tileJSONRequest=null,this._loaded=!0,c?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),r&&r.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new s.y(c))):m&&(Object.assign(this,m),m.bounds&&(this.tileBounds=new Sr(m.bounds,this.minzoom,this.maxzoom)),Di(m.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),u&&u(c)})}hasTransition(){return!1}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loaded(){return this._loaded}loadTile(u,t){const r=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),c={request:this.map._requestManager.transformRequest(r,s.R.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.o.devicePixelRatio,promoteId:this.promoteId};if(u.actor&&u.state!=="expired")if(u.state==="loading")u.reloadCallback=t;else{if(u.buckets){const _=Object.values(u.buckets);for(const w of _)w.dirty=!0;return void(u.state="loaded")}u.request=u.actor.send("reloadTile",c,m.bind(this))}else u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",c,m.bind(this),void 0,!0);function m(_,w){return u.aborted?t(null):_&&_.status!==404?t(_):(this.map._refreshExpiredTiles&&w&&u.setExpiryData(w),u.loadModelData(w,this.map.painter),u.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends s.aS{constructor(u,t,r,c){super(u,t,r,c),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(_=>typeof _!="number"))||this.fire(new s.y(new s.V(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.y(new s.V(`sources.${u}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new s.y(new s.V(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new s.y(new s.V(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.y(new s.V(`sources.${u}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(u){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!u&&!this._playing||this.texture instanceof s.aU||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends s.E{constructor(u,t,r,c){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=t,this.setEventedParent(c),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Sr(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,s.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this.map=u,this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:t,y:r,z:c}=u.canonical;return this._implementation.hasTile({x:t,y:r,z:c})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,t){const{x:r,y:c,z:m}=u.tileID.canonical,_=new AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:r,y:c,z:m},{signal:_.signal})).then((function(w){return delete u.request,u.aborted?(u.state="unloaded",t(null)):w===void 0?(u.state="errored",t(null)):w===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",t(null)):function(E){return E instanceof ImageData||E instanceof HTMLCanvasElement||E instanceof ImageBitmap||E instanceof HTMLImageElement}(w)?(this.loadTileData(u,w),u.state="loaded",void t(null)):(u.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.name!=="AbortError"&&(u.state="errored",t(w))}),u.request.cancel=()=>_.abort()}loadTileData(u,t){u.setTexture(t,this.map.painter)}unloadTile(u,t){if(u.texture&&u.texture instanceof s.T?(u.destroy(!0),u.texture&&u.texture instanceof s.T&&this.map.painter.saveTileTexture(u.texture)):u.destroy(),this._implementation.unloadTile){const{x:r,y:c,z:m}=u.tileID.canonical;this._implementation.unloadTile({x:r,y:c,z:m})}t&&t()}abortTile(u,t){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){const u=s.B(this.id,this.scope);this.map.style.clearSource(u)}_update(){this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}}},wc=function(u,t,r,c){const m=new oh[t.type](u,t,r,c);if(m.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${m.id}`);return s.aY(["load","abort","unload","serialize","prepare"],m),m};function lh(u,t,r=""){return`${r}:${t.id||""}:${t.layer.id}:${function(c){if("layerId"in c)return`layer:${c.layerId}`;{const{featuresetId:m,importId:_}=c;return`featureset:${m}${_?`:import:${_}`:""}`}}(u.target)}`}function jo(u,t,r,c=""){if(u.uniqueFeatureID){const m=lh(u,t,c);if(r.has(m))return!0;r.add(m)}return!1}function ad(u,t,r,c,m=!1){const _=t.sourceCache.transform,w=t.sourceCache.tilesIn(u,t.has3DLayers,m);w.sort(hf);const E=[];for(const R of w){const D=R.tile.queryRenderedFeatures(t,R,r,c,_,m);Object.keys(D).length&&E.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:D})}return E.length===0?{}:function(R){const D={},L={};for(const F of R){const k=F.queryResults,H=F.wrappedTileID,$=L[H]=L[H]||{};for(const G in k){const ee=k[G],X=$[G]=$[G]||{},ie=D[G]=D[G]||[];for(const ce of ee)X[ce.featureIndex]||(X[ce.featureIndex]=!0,ie.push(ce))}}return D}(E)}function Ba(u,t,r,c,m,_){const w={},E=c.queryRenderedSymbols(u),R=[];for(const D of Object.keys(E).map(Number))R.push(m[D]);R.sort(hf);for(const D of R){const L=D.featureIndex.lookupSymbolFeatures(E[D.bucketInstanceId],D.bucketIndex,D.sourceLayerIndex,t,r,_);for(const F in L){const k=w[F]=w[F]||[],H=L[F];H.sort(($,G)=>{const ee=D.featureSortOrder;if(ee){const X=ee.indexOf($.featureIndex);return ee.indexOf(G.featureIndex)-X}return G.featureIndex-$.featureIndex});for(const $ of H)k.push($)}}return w}function _o(u,t){const r=u.getRenderableIds().map(_=>u.getTileByID(_)),c=[],m={};for(let _=0;_<r.length;_++){const w=r[_],E=w.tileID.canonical.key;m[E]||(m[E]=!0,w.querySourceFeatures(c,t))}return c}function hf(u,t){const r=u.tileID,c=t.tileID;return r.overscaledZ-c.overscaledZ||r.canonical.y-c.canonical.y||r.wrap-c.wrap||r.canonical.x-c.canonical.x}function ch(u,t){const r={};if(!t)return r;for(const c of u){const m=c.layerIds.map(_=>t.getLayer(_)).filter(Boolean);if(m.length!==0){c.layers=m,c.stateDependentLayerIds&&(c.stateDependentLayers=c.stateDependentLayerIds.map(_=>m.filter(w=>w.id===_)[0]));for(const _ of m)r[_.fqid]=c}}return r}const Us=32,yo=33,ll=new Uint16Array(8184);for(let u=0;u<2046;u++){let t=u+2,r=0,c=0,m=0,_=0,w=0,E=0;for(1&t?m=_=w=Us:r=c=E=Us;(t>>=1)>1;){const D=r+m>>1,L=c+_>>1;1&t?(m=r,_=c,r=w,c=E):(r=m,c=_,m=w,_=E),w=D,E=L}const R=4*u;ll[R+0]=r,ll[R+1]=c,ll[R+2]=m,ll[R+3]=_}const ma=new Uint16Array(2178),ga=new Uint8Array(1089),Tc=new Uint16Array(1089);function df(u){return u===0?-.03125:u===32?.03125:0}const lu={type:2,extent:s.al,loadGeometry:()=>[[new s.P(0,0),new s.P(s.al+1,0),new s.P(s.al+1,s.al+1),new s.P(0,s.al+1),new s.P(0,0)]]};class Sc{constructor(t,r,c,m,_,w){this.tileID=t,this.uid=s.b2(),this.uses=0,this.tileSize=r,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,m&&m.style&&(this._lastUpdatedBrightness=m.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection),this.worldview=w}registerFadeDuration(t){const r=t+this.timeAdded;r<s.o.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,c){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=ch(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const _=this.buckets[m];if(_ instanceof s.b4){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const _=this.buckets[m];if(_ instanceof s.b4&&_.hasRTLText){this.hasRTLText=!0,s.b5();break}}this.queryPadding=0;for(const m in this.buckets){const _=this.buckets[m],w=r.style.getOwnLayer(m);if(!w)continue;const E=w.queryRadius(_);this.queryPadding=Math.max(this.queryPadding,E)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new s.b3}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,r,c){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,ch(t.buckets,r.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const m in this.buckets){const _=this.buckets[m];_.uploadPending()&&_.upload(t)}const r=t.gl,c=this.imageAtlas;c&&!c.uploaded&&(this.imageAtlasTexture=new s.T(t,c.image,r.RGBA8,{useMipmap:!!c.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(t,this.glyphAtlasImage,r.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(t,this.lineAtlas.image,r.R8),this.lineAtlas.uploaded=!0)}prepare(t,r,c){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,c),!r||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const m=r.style.getBrightness();(this._lastUpdatedBrightness||m)&&(this._lastUpdatedBrightness&&m&&Math.abs(this._lastUpdatedBrightness-m)<.001||(this.updateBuckets(r,this._lastUpdatedBrightness!==m),this._lastUpdatedBrightness=m))}queryRenderedFeatures(t,r,c,m,_,w){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const E=function(R,D){const L=s.bq([],[.5*R.width,.5*-R.height,1]);return s.br(L,L,[1,-1,0]),s.aB(L,L,R.calculateProjMatrix(D.toUnwrapped())),Float32Array.from(L)}(_,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:r,pixelPosMatrix:E,transform:m,availableImages:c,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,r){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const m=c.loadVTLayers(),_=r?r.sourceLayer:"",w=m._geojsonTileLayer||m[_];if(!w)return;const E=s.b6(r&&r.filter),{z:R,x:D,y:L}=this.tileID.canonical,F={z:R,x:D,y:L};for(let k=0;k<w.length;k++){const H=w.feature(k);if(E.needGeometry){const ee=s.b7(H,!0);if(!E.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ee,this.tileID.canonical))continue}else if(!E.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),H))continue;const $=c.getId(H,_),G=new s.b8(H,R,D,L,$);G.tile=F,t.push(G)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const c=s.b9(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let m=!1;if(this.expirationTime>c)m=!1;else if(r)if(this.expirationTime<r)m=!0;else{const _=this.expirationTime-r;_?this.expirationTime=c+Math.max(_,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,r){if(!this.latestFeatureIndex||!t.style)return;const c=this.latestFeatureIndex.loadVTLayers(),m=t.style.listImages(),_=t.style.getBrightness();for(const w in this.buckets){if(!t.style.hasLayer(w))continue;const E=this.buckets[w],R=E.layers[0],D=R.sourceLayer||"_geojsonTileLayer",L=c[D],F=t.style.getLayerSourceCache(R);let k={};F&&(k=F._state.getState(D,void 0));const H=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},$=Object.keys(k).length>0&&!r;($&&E.stateDependentLayers.length!==0||r)&&E.update(k,L,m,H,$?E.stateDependentLayers:E.layers,r,_),(E instanceof s.ba||E instanceof s.bb)&&t._terrain&&t._terrain.enabled&&F&&E.uploadPending()&&t._terrain._clearRenderCacheForTile(F.id,this.tileID);const G=t&&t.style&&t.style.getOwnLayer(w);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.o.now()+t}setTexture(t,r){const c=r.context,m=c.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t):(this.texture=new s.T(c,t,m.RGBA8,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(t,r){const c={};for(const m of r)c[m]=!0;this.dependencies[t]=c}hasDependency(t,r){for(const c of t){const m=this.dependencies[c];if(m){for(const _ of r)if(m[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const c=s.bc(lu,this.tileID.canonical,this.tileTransform)[0],m=new s.bd,_=new s.be;for(let w=0;w<c.length;w++){const{x:E,y:R}=c[w];m.emplaceBack(E,R),_.emplaceBack(w)}_.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(_),this._tileDebugBuffer=t.createVertexBuffer(m,s.bf.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,m.length,_.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const c=s.bc(lu,this.tileID.canonical,this.tileTransform)[0];let m,_;if(this.isRaster){const w=function(E,R){const D=s.aZ(E,R),L=Math.pow(2,E.z);for(let ee=0;ee<yo;ee++)for(let X=0;X<yo;X++){const ie=s.a_((E.x+(X+df(X))/Us)/L),ce=s.a$((E.y+(ee+df(ee))/Us)/L),de=R.project(ie,ce),Te=ee*yo+X;ma[2*Te+0]=Math.round((de.x*D.scale-D.x)*s.al),ma[2*Te+1]=Math.round((de.y*D.scale-D.y)*s.al)}ga.fill(0),Tc.fill(0);for(let ee=2045;ee>=0;ee--){const X=4*ee,ie=ll[X+0],ce=ll[X+1],de=ll[X+2],Te=ll[X+3],we=ie+de>>1,Ee=ce+Te>>1,ve=we+Ee-ce,be=Ee+ie-we,Ce=ce*yo+ie,We=Te*yo+de,je=Ee*yo+we,ct=Math.hypot((ma[2*Ce+0]+ma[2*We+0])/2-ma[2*je+0],(ma[2*Ce+1]+ma[2*We+1])/2-ma[2*je+1])>=16;ga[je]=ga[je]||(ct?1:0),ee<1022&&(ga[je]=ga[je]||ga[(ce+be>>1)*yo+(ie+ve>>1)]||ga[(Te+be>>1)*yo+(de+ve>>1)])}const F=new s.b0,k=new s.b1;let H=0;function $(ee,X){const ie=X*yo+ee;return Tc[ie]===0&&(F.emplaceBack(ma[2*ie+0],ma[2*ie+1],ee*s.al/Us,X*s.al/Us),Tc[ie]=++H),Tc[ie]-1}function G(ee,X,ie,ce,de,Te){const we=ee+ie>>1,Ee=X+ce>>1;if(Math.abs(ee-de)+Math.abs(X-Te)>1&&ga[Ee*yo+we])G(de,Te,ee,X,we,Ee),G(ie,ce,de,Te,we,Ee);else{const ve=$(ee,X),be=$(ie,ce),Ce=$(de,Te);k.emplaceBack(ve,be,Ce)}}return G(0,0,Us,Us,Us,0),G(Us,Us,0,0,0,Us),{vertices:F,indices:k}}(this.tileID.canonical,r);m=w.vertices,_=w.indices}else{m=new s.b0,_=new s.b1;for(const{x:E,y:R}of c)m.emplaceBack(E,R,0,0);const w=s.bh(m.int16.subarray(0,4*m.length),void 0,4);for(let E=0;E<w.length;E+=3)_.emplaceBack(w[E],w[E+1],w[E+2])}this._tileBoundsBuffer=t.createVertexBuffer(m,s.bi.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(_),this._tileBoundsSegments=s.bg.simpleSegment(0,0,m.length,_.length)}_makeGlobeTileDebugBuffers(t,r){const c=r.projection;if(!c||c.name!=="globe"||r.freezeTileCoverage)return;const m=this.tileID.canonical,_=s.bj(m,r),w=s.bk(_),E=s.aj(r.zoom);let R;E>0&&(R=s.bl(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,m,r,w,R,E),this._makeGlobeTileDebugTextBuffer(t,m,r,w,R,E)}_globePoint(t,r,c,m,_,w,E){let R=s.bm(t,r,c);if(w){const D=1<<c.z,L=s.aF(m.center.lng),F=s.aJ(m.center.lat),k=(c.x+.5)/D-L;let H=0;k>.5?H=-1:k<-.5&&(H=1);let $=(t/s.al+c.x)/D+H,G=(r/s.al+c.y)/D;$=($-L)*m._pixelsPerMercatorPixel+L,G=(G-F)*m._pixelsPerMercatorPixel+F;const ee=[$*m.worldSize,G*m.worldSize,0];s.af(ee,ee,w),R=s.bn(R,ee,E)}return s.af(R,R,_)}_makeGlobeTileDebugBorderBuffer(t,r,c,m,_,w){const E=new s.bd,R=new s.be,D=new s.bo,L=(k,H,$,G,ee)=>{const X=($-k)/(ee-1),ie=(G-H)/(ee-1),ce=E.length;for(let de=0;de<ee;de++){const Te=k+de*X,we=H+de*ie;E.emplaceBack(Te,we);const Ee=this._globePoint(Te,we,r,c,m,_,w);D.emplaceBack(Ee[0],Ee[1],Ee[2]),R.emplaceBack(ce+de)}},F=s.al;L(0,0,F,0,16),L(F,0,F,F,16),L(F,F,0,F,16),L(0,F,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(R),this._tileDebugBuffer=t.createVertexBuffer(E,s.bf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(D,s.bp.members),this._tileDebugSegments=s.bg.simpleSegment(0,0,E.length,R.length)}_makeGlobeTileDebugTextBuffer(t,r,c,m,_,w){const E=s.al/4,R=new s.bd,D=new s.b1,L=new s.bo,F=25;D.reserve(32),R.reserve(F),L.reserve(F);const k=(H,$)=>F*H+$;for(let H=0;H<F;H++){const $=H*E;for(let G=0;G<F;G++){const ee=G*E;R.emplaceBack(ee,$);const X=this._globePoint(ee,$,r,c,m,_,w);L.emplaceBack(X[0],X[1],X[2])}}for(let H=0;H<4;H++)for(let $=0;$<4;$++){const G=k(H,$),ee=k(H,$+1),X=k(H+1,$),ie=k(H+1,$+1);D.emplaceBack(G,ee,X),D.emplaceBack(X,ee,ie)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(D),this._tileDebugTextBuffer=t.createVertexBuffer(R,s.bf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(L,s.bp.members),this._tileDebugTextSegments=s.bg.simpleSegment(0,0,F,32)}destroy(t=!1){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bs.setPbf(s.bt);class od extends Sc{constructor(t,r,c,m,_){super(t,r,c,m,_),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,r,c){const m=c.context,_=m.gl;let w=this.texturePerLayer.get(t)||c.getTileTexture(r.width);w&&w instanceof s.T?w.update(r,{premultiply:!1}):w=new s.T(m,r,_.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,w)}flushQueues(t){const r=this._workQueuePerLayer.get(t)||[],c=this._fetchQueuePerLayer.get(t)||[];for(;r.length;)r.pop()();for(;c.length;)c.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const r=this._workQueuePerLayer.get(t)||[];for(;r.length;)r.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const r=this._fetchQueuePerLayer.get(t)||[];for(;r.length;)r.pop()()}}fetchHeader(t=16384,r){const c=this._mrt=new s.bs(30),m=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=s.bu(m,(_,w,E,R)=>{if(_)r(_);else try{const D=c.getHeaderLength(w);if(D>t)return void(this.request=this.fetchHeader(D,r));c.parseHeader(w),this._isHeaderLoaded=!0;let L=0;for(const F of Object.values(c.layers))L=Math.max(L,F.dataIndex[F.dataIndex.length-1].lastByte);w.byteLength>=L&&(this.entireBuffer=w),r(null,this.entireBuffer||w,E,R)}catch(D){r(D)}}),this.request}fetchBandForRender(t,r,c,m){this.fetchBand(t,r,c,_=>{if(_)return void m(_);this.updateTextureDescriptor(t,r,c);const w=this.textureDescriptorPerLayer.get(r);m(null,w?w.img:null)})}fetchBand(t,r,c,m,_=!0){const w=this._mrt;if(!this._isHeaderLoaded||!w)return void m(new Error("Tile header is not ready"));const E=this.actor;if(!E)return void m(new Error("Can't fetch tile band without an actor"));let R;const D=s.B(String(c),s.B(this.tileID.key,t));let L=this._taskQueue.get(D);L?L.add(m):(L=new Set,L.add(m),this._taskQueue.set(D,L));const F=(G,ee)=>{R.complete(G,ee),G?m(G):(L.values().forEach(X=>X(null,ee)),this._taskQueue.delete(D))},k=(G,ee)=>{if(G)return m(G);const X=E.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ee,task:R},F,void 0,!0);if(r!==null){const ie=this._workQueuePerLayer.get(r)||[];ie.push(()=>{X&&X.cancel(),R.cancel()}),this._workQueuePerLayer.has(r)||this._workQueuePerLayer.set(r,ie)}};let H;try{H=w.getLayer(t)}catch(G){if(this.state==="reloading")return;throw G}if(!H)return void m(new Error(`Unknown sourceLayer "${t}"`));if(H.hasDataForBand(c))return L.values().forEach(G=>G(null,null)),void this._taskQueue.delete(D);const $=H.getDataRange([c]);if(R=w.createDecodingTask($),!R||R.tasks.length)if(r!==null&&this.flushQueues(r),this.entireBuffer)k(null,this.entireBuffer.slice($.firstByte,$.lastByte+1));else{const G=Object.assign({},this.requestParams,{headers:{Range:`bytes=${$.firstByte}-${$.lastByte}`}}),ee=s.bu(G,k);if(r!==null){const X=this._fetchQueuePerLayer.get(r)||[];X.push(()=>{ee.cancel(),R.cancel()}),this._fetchQueuePerLayer.has(r)||this._fetchQueuePerLayer.set(r,X)}}}updateNeeded(t,r){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==r||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,r,c){if(!this._mrt)return;const m=this._mrt.getLayer(t);if(!m||!m.hasBand(c)||!m.hasDataForBand(c))return;const{bytes:_,tileSize:w,buffer:E,offset:R,scale:D}=m.getBandView(c),L=w+2*E,F=new s.q({width:L,height:L},_),k=this.texturePerLayer.get(r);k&&k instanceof s.T&&k.update(F,{premultiply:!1}),this.textureDescriptorPerLayer.set(r,{layer:t,band:c,img:F,buffer:E,offset:R,tileSize:w,format:m.pixelFormat,mix:[D,256*D,65536*D,16777216*D]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const r of this.texturePerLayer.values())r&&r instanceof s.T&&r.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Ec{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,c){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const _={value:r,timeout:void 0};if(c!==void 0&&(_.timeout=setTimeout(()=>{this.remove(t,_)},c)),this.data[m].push(_),this.order.push(m),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const c=t.wrapped().key,m=r===void 0?0:this.data[c].indexOf(r),_=this.data[c][m];return this.data[c].splice(m,1),_.timeout&&clearTimeout(_.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(_.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const c in this.data)for(const m of this.data[c])t(m.value)||r.push(m);for(const c of r)this.remove(c.value.tileID,c)}}class Ac{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,c){const m=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},Object.assign(this.stateChanges[t][m],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==m&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const _ in this.state[t][m])c[_]||(this.deletedStates[t][m][_]=null)}else for(const _ in c)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][_]===null&&delete this.deletedStates[t][m][_]}removeFeatureState(t,r,c){if(this.deletedStates[t]===null)return;const m=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&r!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][c]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(c in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][c]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,r){const c=this.state[t]||{},m=this.stateChanges[t]||{},_=this.deletedStates[t];if(_===null)return{};if(r!==void 0){const E=String(r),R=Object.assign({},c[E],m[E]);if(_){const D=_[r];if(D===null)return{};for(const L in D)delete R[L]}return R}const w=Object.assign({},c,m);if(_)for(const E in _)delete w[E];return w}initializeTileState(t,r){t.refreshFeatureState(r)}coalesceChanges(t,r){const c={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const _={};for(const w in this.stateChanges[m])this.state[m][w]||(this.state[m][w]={}),Object.assign(this.state[m][w],this.stateChanges[m][w]),_[w]=this.state[m][w];c[m]=_}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const _={};if(this.deletedStates[m]===null)for(const w in this.state[m])_[w]={},this.state[m][w]={};else for(const w in this.deletedStates[m]){if(this.deletedStates[m][w]===null)this.state[m][w]={};else if(this.state[m][w])for(const E of Object.keys(this.deletedStates[m][w]))delete this.state[m][w][E];_[w]=this.state[m][w]}c[m]=c[m]||{},Object.assign(c[m],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const m in t)t[m].refreshFeatureState(r)}}class Aa extends s.E{constructor(t,r,c){super(),this.id=t,this._onlySymbols=c,r.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new Ec(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Ac,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,r){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const c=this._tiles[r];c.upload(t),c.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Cc).map(t=>t.key)}getRenderableIds(t,r){const c=[];for(const m in this._tiles)this._isIdRenderable(+m,t,r)&&c.push(this._tiles[m]);return t?c.sort((m,_)=>{const w=m.tileID,E=_.tileID,R=new s.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),D=new s.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-E.overscaledZ||D.y-R.y||D.x-R.x}).map(m=>m.tileID.key):c.map(m=>m.tileID).sort(Cc).map(m=>m.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r,c){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())&&(c||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,r){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=r),this._loadTile(c,this._tileLoaded.bind(this,c,t,r)))}_tileLoaded(t,r,c,m){if(m)if(t.state="errored",m.status!==404)this._source.fire(new s.y(m,{tile:t}));else{if(this._source.fire(new s.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=s.o.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new s.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const r=this.getRenderableIds();for(let m=0;m<r.length;m++){const _=r[m];if(t.neighboringTiles&&t.neighboringTiles[_]){const w=this.getTileByID(_);c(t,w),c(w,t)}}function c(m,_){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let w=_.tileID.canonical.x-m.tileID.canonical.x;const E=_.tileID.canonical.y-m.tileID.canonical.y,R=Math.pow(2,m.tileID.canonical.z),D=_.tileID.key;w===0&&E===0||Math.abs(E)>1||(Math.abs(w)>1&&(Math.abs(w+R)===1?w+=R:Math.abs(w-R)===1&&(w-=R)),_.dem&&m.dem&&(m.dem.backfillBorder(_.dem,w,E),m.neighboringTiles&&m.neighboringTiles[D]&&(m.neighboringTiles[D].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,c,m){for(const _ in this._tiles){let w=this._tiles[_];if(m[_]||!w.hasData()||w.tileID.overscaledZ<=r||w.tileID.overscaledZ>c)continue;let E=w.tileID;for(;w&&w.tileID.overscaledZ>r+1;){const D=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[D.key],w&&w.hasData()&&(E=D)}let R=E;for(;R.overscaledZ>r;)if(R=R.scaledTo(R.overscaledZ-1),t[R.key]){m[E.key]=E;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=r?c:null}for(let c=t.overscaledZ-1;c>=r;c--){const m=t.scaledTo(c),_=this._getLoadedTile(m);if(_)return _}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,r){r=r||this._source.tileSize;const c=Math.ceil(t.width/r)+1,m=Math.ceil(t.height/r)+1,_=Math.floor(c*m*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(E)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const c={};for(const m in this._tiles){const _=this._tiles[m];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+r),c[_.tileID.key]=_}this._tiles=c;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(t,r,c,m,_){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;this.updateCacheSize(t,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const w=this._source.type==="batched-model";let E,R=this._source.maxzoom;const D=this.map&&this.map.painter?this.map.painter._terrain:null;if(D&&D.sourceCache===this&&D.attenuationRange()){const k=D.attenuationRange()[0],H=Math.floor(k)-Math.log2(D.getDemUpscale());R>H&&(R=H)}if(this.used||this.usedForTerrain){if(this._source.tileID)E=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new s.aO(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y));else if(this.tileCoverLift!==0){const k=t.clone();k.tileCoverLift=this.tileCoverLift,E=k.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.minzoom<=1&&t.projection.name==="globe"&&(E.push(new s.aO(1,0,1,0,0)),E.push(new s.aO(1,0,1,1,0)),E.push(new s.aO(1,0,1,0,1)),E.push(new s.aO(1,0,1,1,1)))}else if(E=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.hasTile){const k=this._source.hasTile.bind(this._source);E=E.filter(H=>k(H))}}else E=[];if(E.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Ol(this._source.type)){const k=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!c}),H=Math.min(k,this._source.maxzoom);if(w){const $=t.extendTileCover(E,H);for(const G of $)E.push(G)}else if(_){const $=t.extendTileCoverToNearPlane(E,this.transform.getFrustum(H),H);for(const G of $)E.push(G)}else if(this.castsShadows&&m){const $=t.extendTileCover(E,H,m);for(const G of $)this._shadowCasterTiles[G.key]=!0,E.push(G)}}const L=this._updateRetainedTiles(E);if(Ol(this._source.type)&&E.length!==0){const k={},H={},$=Object.keys(L);for(const ee of $){const X=L[ee],ie=this._tiles[ee];if(!ie||ie.fadeEndTime&&ie.fadeEndTime<=s.o.now())continue;const ce=this.findLoadedParent(X,Math.max(X.overscaledZ-Aa.maxOverzooming,this._source.minzoom));ce&&(this._addTile(ce.tileID),k[ce.tileID.key]=ce.tileID),H[ee]=X}const G=E[E.length-1].overscaledZ;for(const ee in this._tiles){const X=this._tiles[ee];if(L[ee]||!X.hasData())continue;let ie=X.tileID;for(;ie.overscaledZ>G;){ie=ie.scaledTo(ie.overscaledZ-1);const ce=this._tiles[ie.key];if(ce&&ce.hasData()&&H[ie.key]){L[ee]=X.tileID;break}}}for(const ee in k)L[ee]||(this._coveredTiles[ee]=!0,L[ee]=k[ee])}for(const k in L)this._tiles[k].clearFadeHold();const F=s.bv(this._tiles,L);for(const k of F){const H=this._tiles[k];H.hasSymbolBuckets&&!H.holdingForFade()?H.setHoldDuration(this.map._fadeDuration):H.hasSymbolBuckets&&!H.symbolFadeFinished()||this._removeTile(+k)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const r={};if(t.length===0)return r;const c={},m=t.reduce((D,L)=>Math.min(D,L.overscaledZ),1/0),_=t[0].overscaledZ,w=Math.max(_-Aa.maxOverzooming,this._source.minzoom),E=Math.max(_+Aa.maxUnderzooming,this._source.minzoom),R={};for(const D of t){const L=this._addTile(D);r[D.key]=D,L.hasData()||m<this._source.maxzoom&&(R[D.key]=D)}this._retainLoadedChildren(R,m,E,r);for(const D of t){let L=this._tiles[D.key];if(L.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const k=D.children(this._source.maxzoom)[0],H=this.getTile(k);if(H&&H.hasData()){r[k.key]=k;continue}}else{const k=D.children(this._source.maxzoom);if(r[k[0].key]&&r[k[1].key]&&r[k[2].key]&&r[k[3].key])continue}let F=L.wasRequested();for(let k=D.overscaledZ-1;k>=w;--k){const H=D.scaledTo(k);if(c[H.key]||(c[H.key]=!0,L=this.getTile(H),!L&&F&&(L=this._addTile(H)),L&&(r[H.key]=H,F=L.wasRequested(),L.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let c,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){c=this._loadedParentTiles[m.key];break}r.push(m.key);const _=m.scaledTo(m.overscaledZ-1);if(c=this._getLoadedTile(_),c)break;m=_}for(const _ of r)this._loadedParentTiles[_]=c}}_addTile(t){let r=this._tiles[t.key];if(r)return r.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const c=!!r;if(!c){const m=this.map?this.map.painter:null,_=this._source.tileSize*t.overscaleFactor();r=this._source.type==="raster-array"?new od(t,_,this.transform.tileZoom,m,this._isRaster):new Sc(t,_,this.transform.tileZoom,m,this._isRaster,this._source.worldview),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r.uses++,this._tiles[t.key]=r,c||this._source.fire(new s.z("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=r.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"||r.state==="empty"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,c){const m=[],_=this.transform;if(!_)return m;const w=_.projection.name==="globe",E=s.aF(_.center.lng);for(const R in this._tiles){const D=this._tiles[R];if(c&&D.clearQueryDebugViz(),D.holdingForFade())continue;let L;if(w){const F=D.tileID.canonical;if(F.z===0){const k=[Math.abs(s.aA(E,...cu(F,-1))-E),Math.abs(s.aA(E,...cu(F,1))-E)];L=[0,2*k.indexOf(Math.min(...k))-1]}else{const k=[Math.abs(s.aA(E,...cu(F,-1))-E),Math.abs(s.aA(E,...cu(F,0))-E),Math.abs(s.aA(E,...cu(F,1))-E)];L=[k.indexOf(Math.min(...k))-1]}}else L=[0];for(const F of L){const k=t.containsTile(D,_,r,F);k&&m.push(k)}}return m}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,r){const c=this.getRenderableIds(t,r).map(_=>this._tiles[_].tileID),m=this.transform.projection.name==="globe";for(const _ of c)_.projMatrix=this.transform.calculateProjMatrix(_.toUnwrapped()),_.expandedProjMatrix=m?this.transform.calculateProjMatrix(_.toUnwrapped(),!1,!0):_.projMatrix;return c}sortCoordinatesByDistance(t){const r=t.slice(),c=this.transform._camera.position,m=this.transform._camera.forward(),_={};for(const w of r){const E=1/(1<<w.canonical.z);_[w.key]=((w.canonical.x+.5)*E+w.wrap-c[0])*m[0]+((w.canonical.y+.5)*E-c[1])*m[1]-c[2]*m[2]}return r.sort((w,E)=>_[w.key]-_[E.key]),r}hasTransition(){if(this._source.hasTransition())return!0;if(Ol(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=s.o.now())return!0}return!1}setFeatureState(t,r,c){this._state.updateState(t=t||"_geojsonTileLayer",r,c)}removeFeatureState(t,r,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,c)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,c){const m=this._tiles[t];m&&m.setDependencies(r,c)}reloadTilesForDependencies(t,r){for(const c in this._tiles)this._tiles[c].hasDependency(t,r)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(t,r))}_preloadTiles(t,r){if(!this._sourceLoaded){const R=()=>{this._sourceLoaded&&(this._source.off("data",R),this._preloadTiles(t,r))};return void this._source.on("data",R)}const c=new Map,m=Array.isArray(t)?t:[t],_=this.map.painter.terrain,w=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const R of m){const D=R.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of D)c.set(L.key,L);this.usedForTerrain&&R.updateElevation(!1)}const E=Array.from(c.values());s.bw(E,(R,D)=>{const L=new Sc(R,this._source.tileSize*R.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(L,F=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),D(F,L)})},r)}}function Cc(u,t){const r=Math.abs(2*u.wrap)-+(u.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return u.overscaledZ-t.overscaledZ||c-r||t.canonical.y-u.canonical.y||t.canonical.x-u.canonical.x}function Ol(u){return u==="raster"||u==="image"||u==="video"||u==="custom"}function cu(u,t){const r=1<<u.z;return[u.x/r+t,(u.x+1)/r+t]}Aa.maxOverzooming=10,Aa.maxUnderzooming=3;class uh{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,r=!1;for(const c in this.style._mergedLayers){const m=this.style._mergedLayers[c];if(m.type==="fill-extrusion"||m.type==="building")this.layers.push({layer:m,visible:t,visibilityChanged:r});else if(m.type==="model"){const _=this.style.getLayerSource(m);_&&_.type==="batched-model"&&this.layers.push({layer:m,visible:t,visibilityChanged:r})}}}onNewFrame(t){this.layersGotHidden=!1;for(const r of this.layers){const c=r.layer;let m=!1;c.type==="fill-extrusion"?m=!c.isHidden(t)&&c.paint.get("fill-extrusion-opacity")>0:c.type==="building"?m=!c.isHidden(t)&&c.paint.get("building-opacity")>0:c.type==="model"&&(m=!c.isHidden(t)&&c.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!m&&r.visible,r.visible=m}}updateZOffset(t,r){this.currentBuildingBuckets=[];for(const m of this.layers){const _=m.layer,w=this.style.getLayerSourceCache(_);let E=1;_.type==="fill-extrusion"?E=m.visible?_.paint.get("fill-extrusion-vertical-scale"):0:_.type==="building"&&(E=m.visible?_.paint.get("building-vertical-scale"):0);let R=w?w.getTile(r):null;if(!R&&w)for(const D in w._tiles){const L=w._tiles[D];if(r.canonical.isChildOf(L.tileID.canonical)){R=L;break}}this.currentBuildingBuckets.push({bucket:R?R.getBucket(_):null,tileID:R?R.tileID:r,verticalScale:E})}t.hasAnyZOffset=!1;let c=!1;for(let m=0;m<t.symbolInstances.length;m++){const _=t.symbolInstances.get(m),w=_.zOffset,E=this._getHeightAtTileOffset(r,_.tileAnchorX,_.tileAnchorY);_.zOffset=E!==Number.NEGATIVE_INFINITY?E:w,c||w===_.zOffset||(c=!0),t.hasAnyZOffset||_.zOffset===0||(t.hasAnyZOffset=!0)}c&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,r,c,m){let _=r,w=c;if(t.canonical.z!==m.canonical.z){const E=m.canonical,R=1/(1<<t.canonical.z-E.z);_=(r+t.canonical.x*s.al)*R-E.x*s.al|0,w=(c+t.canonical.y*s.al)*R-E.y*s.al|0}return{tileX:_,tileY:w}}_getHeightAtTileOffset(t,r,c){let m,_;for(let w=0;w<this.layers.length;++w){const E=this.layers[w].layer;if(E.type!=="fill-extrusion"&&E.type!=="building")continue;const{bucket:R,tileID:D,verticalScale:L}=this.currentBuildingBuckets[w];if(!R)continue;const{tileX:F,tileY:k}=this._mapCoordToOverlappingTile(t,r,c,D),H=R.getHeightAtTileCoord(F,k);H&&H.height!==void 0&&(H.hidden?m=H.height:_=Math.max(H.height*L,_||0))}if(_!==void 0)return _;for(let w=0;w<this.layers.length;++w){const E=this.layers[w];if(E.layer.type!=="model"||!E.visible)continue;const{bucket:R,tileID:D}=this.currentBuildingBuckets[w];if(!R)continue;const{tileX:L,tileY:F}=this._mapCoordToOverlappingTile(t,r,c,D),k=R.getHeightAtTileCoord(L,F);if(k&&!k.hidden)return k.height===void 0&&m!==void 0?Math.min(k.maxHeight,m)*k.verticalScale:k.height?k.height*k.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ff(u,t){const r={};for(const c in u)c!=="ref"&&(r[c]=u[c]);return s.bx.forEach(c=>{c in t&&(r[c]=t[c])}),r}function Rc(u){u=u.slice();const t=Object.create(null);for(let r=0;r<u.length;r++)t[u[r].id]=u[r];for(let r=0;r<u.length;r++)"ref"in u[r]&&(u[r]=ff(u[r],t[u[r].ref]));return u}const wn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function cl(u,t,r){r.push({command:wn.addSource,args:[u,t[u]]})}function kl(u,t,r){t.push({command:wn.removeSource,args:[u]}),r[u]=!0}function pf(u,t,r,c){kl(u,r,c),cl(u,t,r)}function uu(u,t,r){let c;for(c in u[r])if(u[r].hasOwnProperty(c)&&c!=="data"&&!s.by(u[r][c],t[r][c]))return!1;for(c in t[r])if(t[r].hasOwnProperty(c)&&c!=="data"&&!s.by(u[r][c],t[r][c]))return!1;return!0}function Nl(u,t,r,c,m,_){let w;for(w in t=t||{},u=u||{})u.hasOwnProperty(w)&&(s.by(u[w],t[w])||r.push({command:_,args:[c,w,t[w],m]}));for(w in t)t.hasOwnProperty(w)&&!u.hasOwnProperty(w)&&(s.by(u[w],t[w])||r.push({command:_,args:[c,w,t[w],m]}))}function jl(u){return u.id}function Mc(u,t){return u[t.id]=t,u}function ld(u,t,r){const c=t.createTileMatrix(u,u.worldSize,r.toUnwrapped());return s.aB(new Float32Array(16),u.projMatrix,c)}function Ca(u,t,r){if(t.projection.name===r.projection.name)return u.projMatrix;const c=r.clone();return c.setProjection(t.projection),ld(c,t.getProjection(),u)}function Qa(u,t,r){return t.name===r.projection.name?u.projMatrix:ld(r,t,u)}class cd{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.aA(t,0,1);let r=1,c=this._distances[r];const m=t*this.paddedLength+this.padding;for(;c<m&&r<this._distances.length;)c=this._distances[++r];const _=r-1,w=this._distances[_],E=c-w,R=E>0?(m-w)/E:0;return this.points[_].mult(1-R).add(this.points[r].mult(R))}}class hu{constructor(t,r,c){const m=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(r/c);for(let w=0;w<this.xCellCount*this.yCellCount;w++)m.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,c,m,_){this._forEachCell(r,c,m,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(_)}insertCircle(t,r,c,m){this._forEachCell(r-m,c-m,r+m,c+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(c),this.circles.push(m)}_insertBoxCell(t,r,c,m,_,w){this.boxCells[_].push(w)}_insertCircleCell(t,r,c,m,_,w){this.circleCells[_].push(w)}_query(t,r,c,m,_,w){if(c<0||t>this.width||m<0||r>this.height)return!_&&[];const E=[];if(t<=0&&r<=0&&this.width<=c&&this.height<=m){if(_)return!0;for(let R=0;R<this.boxKeys.length;R++)E.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const D=this.circles[3*R],L=this.circles[3*R+1],F=this.circles[3*R+2];E.push({key:this.circleKeys[R],x1:D-F,y1:L-F,x2:D+F,y2:L+F})}return w?E.filter(w):E}return this._forEachCell(t,r,c,m,this._queryCell,E,{hitTest:_,seenUids:{box:{},circle:{}}},w),_?E.length>0:E}_queryCircle(t,r,c,m,_){const w=t-c,E=t+c,R=r-c,D=r+c;if(E<0||w>this.width||D<0||R>this.height)return!m&&[];const L=[];return this._forEachCell(w,R,E,D,this._queryCellCircle,L,{hitTest:m,circle:{x:t,y:r,radius:c},seenUids:{box:{},circle:{}}},_),m?L.length>0:L}query(t,r,c,m,_){return this._query(t,r,c,m,!1,_)}hitTest(t,r,c,m,_){return this._query(t,r,c,m,!0,_)}hitTestCircle(t,r,c,m){return this._queryCircle(t,r,c,!0,m)}_queryCell(t,r,c,m,_,w,E,R){const D=E.seenUids,L=this.boxCells[_];if(L!==null){const k=this.bboxes;for(const H of L)if(!D.box[H]){D.box[H]=!0;const $=4*H;if(t<=k[$+2]&&r<=k[$+3]&&c>=k[$+0]&&m>=k[$+1]&&(!R||R(this.boxKeys[H]))){if(E.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[H],x1:k[$],y1:k[$+1],x2:k[$+2],y2:k[$+3]})}}}const F=this.circleCells[_];if(F!==null){const k=this.circles;for(const H of F)if(!D.circle[H]){D.circle[H]=!0;const $=3*H;if(this._circleAndRectCollide(k[$],k[$+1],k[$+2],t,r,c,m)&&(!R||R(this.circleKeys[H]))){if(E.hitTest)return w.push(!0),!0;{const G=k[$],ee=k[$+1],X=k[$+2];w.push({key:this.circleKeys[H],x1:G-X,y1:ee-X,x2:G+X,y2:ee+X})}}}}}_queryCellCircle(t,r,c,m,_,w,E,R){const D=E.circle,L=E.seenUids,F=this.boxCells[_];if(F!==null){const H=this.bboxes;for(const $ of F)if(!L.box[$]){L.box[$]=!0;const G=4*$;if(this._circleAndRectCollide(D.x,D.y,D.radius,H[G+0],H[G+1],H[G+2],H[G+3])&&(!R||R(this.boxKeys[$])))return w.push(!0),!0}}const k=this.circleCells[_];if(k!==null){const H=this.circles;for(const $ of k)if(!L.circle[$]){L.circle[$]=!0;const G=3*$;if(this._circlesCollide(H[G],H[G+1],H[G+2],D.x,D.y,D.radius)&&(!R||R(this.circleKeys[$])))return w.push(!0),!0}}}_forEachCell(t,r,c,m,_,w,E,R){const D=this._convertToXCellCoord(t),L=this._convertToYCellCoord(r),F=this._convertToXCellCoord(c),k=this._convertToYCellCoord(m);for(let H=D;H<=F;H++)for(let $=L;$<=k;$++)if(_.call(this,t,r,c,m,this.xCellCount*$+H,w,E,R))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,c,m,_,w){const E=m-t,R=_-r,D=c+w;return D*D>E*E+R*R}_circleAndRectCollide(t,r,c,m,_,w,E){const R=(w-m)/2,D=Math.abs(t-(m+R));if(D>R+c)return!1;const L=(E-_)/2,F=Math.abs(r-(_+L));if(F>L+c)return!1;if(D<=R||F<=L)return!0;const k=D-R,H=F-L;return k*k+H*H<=c*c}}const hh={unknown:0,flipRequired:1,flipNotRequired:2},dh=Math.tan(85*Math.PI/180);function eo(u,t,r,c,m,_,w){const E=s.bC();if(r)if(_.name==="globe"){const R=s.bD(m,t);s.aB(E,E,R)}else{const R=s.bE([],w);E[0]=R[0],E[1]=R[1],E[4]=R[2],E[5]=R[3],c||s.bB(E,E,m.angle)}else s.aB(E,m.labelPlaneMatrix,u);return E}function Bl(u,t,r,c,m,_,w){const E=eo(u,t,r,c,m,_,w);return _.name==="globe"&&r||(E[2]=E[6]=E[10]=E[14]=0),E}function du(u,t,r,c,m,_,w){if(r){if(_.name==="globe"){const E=eo(u,t,r,c,m,_,w);return s.bl(E,E),s.aB(E,u,E),E}{const E=s.bz(u),R=s.bA([]);return R[0]=w[0],R[1]=w[1],R[4]=w[2],R[5]=w[3],s.aB(E,E,R),c||s.bB(E,E,-m.angle),E}}return m.glCoordMatrix}function Fa(u,t,r,c){const m=[u,t,r,1];r?s.aC(m,m,c):Ep(m,m,c);const _=m[3];return m[0]/=_,m[1]/=_,m[2]/=_,m}function fu(u,t){return Math.min(.5+u/t*.5,1.5)}function to(u,t){const r=u[0]/u[3],c=u[1]/u[3];return r>=-t[0]&&r<=t[0]&&c>=-t[1]&&c<=t[1]}function wp(u,t,r,c,m,_,w,E,R,D){const L=r.transform,F=c?u.textSizeData:u.iconSizeData,k=s.bK(F,r.transform.zoom),H=L.projection.name==="globe",$=[256/r.width*2+1,256/r.height*2+1],G=c?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;G.clear();let ee=null;H&&(ee=c?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const X=u.lineVertexArray,ie=c?u.text.placedSymbolArray:u.icon.placedSymbolArray,ce=r.transform.width/r.transform.height;let de,Te=!1;for(let we=0;we<ie.length;we++){const Ee=ie.get(we),{numGlyphs:ve,writingMode:be}=Ee;if(be!==s.bL.vertical||Te||de===s.bL.horizontal||(Te=!0),de=be,(Ee.hidden||be===s.bL.vertical)&&!Te){zi(ve,G);continue}Te=!1;const Ce=new s.P(Ee.tileAnchorX,Ee.tileAnchorY);let{x:We,y:je,z:ct}=L.projection.projectTilePoint(Ce.x,Ce.y,D.canonical);if(R){const[Tt,gi,oi]=R(Ce);We+=Tt,je+=gi,ct+=oi}const Ze=[We,je,ct,1];if(s.aC(Ze,Ze,t),!to(Ze,$)){zi(ve,G);continue}const ot=Ze[3],jt=fu(r.transform.getCameraToCenterDistance(L.projection),ot),Ye=s.bM(F,k,Ee),Oe=w?Ye/jt:Ye*jt,nt=Fa(We,je,ct,m);if(nt[3]<=0){zi(ve,G);continue}let Ge={};const ht=s.an(u.layers[0].layout.get("text-max-angle")),_t=Math.cos(ht),qt=w?null:R,Ct=Vn(Ee,Oe,!1,E,t,m,_,u.glyphOffsetArray,X,G,ee,nt,Ce,Ge,ce,qt,L.projection,D,w,_t);Te=Ct.useVertical,qt&&Ct.needsFlipping&&(Ge={}),(Ct.notEnoughRoom||Te||Ct.needsFlipping&&Vn(Ee,Oe,!0,E,t,m,_,u.glyphOffsetArray,X,G,ee,nt,Ce,Ge,ce,qt,L.projection,D,w,_t).notEnoughRoom)&&zi(ve,G)}c?(u.text.dynamicLayoutVertexBuffer.updateData(G),ee&&u.text.globeExtVertexBuffer&&u.text.globeExtVertexBuffer.updateData(ee)):(u.icon.dynamicLayoutVertexBuffer.updateData(G),ee&&u.icon.globeExtVertexBuffer&&u.icon.globeExtVertexBuffer.updateData(ee))}function fh(u,t,r,c,m,_,w,E,R,D,L,F,k,H,$,G,ee){const{lineStartIndex:X,glyphStartIndex:ie,segment:ce}=E,de=ie+E.numGlyphs,Te=X+E.lineLength,we=t.getoffsetX(ie),Ee=t.getoffsetX(de-1),ve=mf(u*we,r,c,m,_,w,ce,X,Te,R,D,L,F,k,!0,H,$,G,ee);if(!ve)return null;const be=mf(u*Ee,r,c,m,_,w,ce,X,Te,R,D,L,F,k,!0,H,$,G,ee);return be?{first:ve,last:be}:null}function Tp(u,t,r,c){return u===s.bL.horizontal&&Math.abs(c)>Math.abs(r)?{useVertical:!0}:u===s.bL.vertical?c>0?{needsFlipping:!0}:null:t!==hh.unknown&&function(m,_){return m===0||Math.abs(_/m)>dh}(r,c)?t===hh.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function Vn(u,t,r,c,m,_,w,E,R,D,L,F,k,H,$,G,ee,X,ie,ce){const de=t/24,Te=u.lineOffsetX*de,we=u.lineOffsetY*de,{lineStartIndex:Ee,glyphStartIndex:ve,numGlyphs:be,segment:Ce,writingMode:We,flipState:je}=u,ct=Ee+u.lineLength,Ze=ot=>{if(L){const[nt,Ge,ht]=ot.up,_t=D.length;s.bN(L,_t+0,nt,Ge,ht),s.bN(L,_t+1,nt,Ge,ht),s.bN(L,_t+2,nt,Ge,ht),s.bN(L,_t+3,nt,Ge,ht)}const[jt,Ye,Oe]=ot.point;s.bO(D,jt,Ye,Oe,ot.angle)};if(be>1){const ot=fh(de,E,Te,we,r,F,k,u,R,_,H,G,!1,ee,X,ie,ce);if(!ot)return{notEnoughRoom:!0};if(c&&!r){let[jt,Ye,Oe]=ot.first.point,[nt,Ge,ht]=ot.last.point;[jt,Ye]=Fa(jt,Ye,Oe,w),[nt,Ge]=Fa(nt,Ge,ht,w);const _t=Tp(We,je,(nt-jt)*$,Ge-Ye);if(u.flipState=_t&&_t.needsFlipping?hh.flipRequired:hh.flipNotRequired,_t)return _t}Ze(ot.first);for(let jt=ve+1;jt<ve+be-1;jt++){const Ye=mf(de*E.getoffsetX(jt),Te,we,r,F,k,Ce,Ee,ct,R,_,H,G,!1,!1,ee,X,ie,ce);if(!Ye)return D.length-=4*(jt-ve),{notEnoughRoom:!0};Ze(Ye)}Ze(ot.last)}else{if(c&&!r){const jt=Fa(k.x,k.y,0,m),Ye=Ee+Ce+1,Oe=new s.P(R.getx(Ye),R.gety(Ye)),nt=Fa(Oe.x,Oe.y,0,m),Ge=nt[3]>0?nt:Om(k,Oe,jt,1,m,void 0,ee,X.canonical),ht=Tp(We,je,(Ge[0]-jt[0])*$,Ge[1]-jt[1]);if(u.flipState=ht&&ht.needsFlipping?hh.flipRequired:hh.flipNotRequired,ht)return ht}const ot=mf(de*E.getoffsetX(ve),Te,we,r,F,k,Ce,Ee,ct,R,_,H,G,!1,!1,ee,X,ie,ce);if(!ot)return{notEnoughRoom:!0};Ze(ot)}return{}}function Sp(u,t,r,c,m){const{x:_,y:w,z:E}=c.projectTilePoint(u.x,u.y,t);if(!m)return Fa(_,w,E,r);const[R,D,L]=m(u);return Fa(_+R,w+D,E+L,r)}function Om(u,t,r,c,m,_,w,E){const R=Sp(u.sub(t)._unit()._add(u),E,m,w,_);return s.av(R,r,R),s.aw(R,R),s.bH(R,r,R,c)}function mf(u,t,r,c,m,_,w,E,R,D,L,F,k,H,$,G,ee,X,ie){const ce=c?u-t:u+t;let de=ce>0?1:-1,Te=0;c&&(de*=-1,Te=Math.PI),de<0&&(Te+=Math.PI);let we=E+w+(de>0?0:1)|0,Ee=m,ve=m,be=0,Ce=0;const We=Math.abs(ce),je=[],ct=[];let Ze=_,ot=Ze,jt=s.bF([]);const Ye=()=>Om(ot,Ze,ve,We-be+1,L,k,G,ee.canonical);for(;be+Ce<=We;){if(we+=de,we<E||we>=R)return null;if(ve=Ee,ot=Ze,je.push(ve),H&&ct.push(ot),Ze=new s.P(D.getx(we),D.gety(we)),Ee=F[we],!Ee){const oi=Sp(Ze,ee.canonical,L,G,k);Ee=oi[3]>0?F[we]=oi:Ye()}be+=Ce;const Tt=s.av([],Ee,ve),gi=s.bG(ve,Ee);if(r&&gi>0&&Ce>0&&s.bJ(jt,Tt)/(Ce*gi)<ie)return null;Ce=gi,jt=Tt}$&&k&&(F[we]&&(Ee=Ye(),Ce=s.bG(ve,Ee),jt=s.av([],Ee,ve)),F[we]=Ee);const Oe=(We-be)/Ce,nt=Ze.sub(ot)._mult(Oe)._add(ot),Ge=s.bH([],ve,jt,Oe);let ht=[0,0,1],_t=jt[0],qt=jt[1];if(X&&(ht=G.upVector(ee.canonical,nt.x,nt.y),ht[0]!==0||ht[1]!==0||ht[2]!==1)){const Tt=[ht[2],0,-ht[0]],gi=s.bI([],ht,Tt);s.aw(Tt,Tt),s.aw(gi,gi),_t=s.bJ(jt,Tt),qt=s.bJ(jt,gi)}if(r){const Tt=s.bI([],ht,jt);s.aw(Tt,Tt),s.bH(Ge,Ge,Tt,r*de)}const Ct=Te+Math.atan2(qt,_t);return je.push(Ge),H&&ct.push(nt),{point:Ge,angle:Ct,path:je,tilePath:ct,up:ht}}function zi(u,t){const r=t.length,c=r+4*u;t.resize(c),t.float32.fill(-1/0,4*r,4*c)}function Ep(u,t,r){const c=t[0],m=t[1];return u[0]=r[0]*c+r[4]*m+r[12],u[1]=r[1]*c+r[5]*m+r[13],u[3]=r[3]*c+r[7]*m+r[15],u}const io=100;class Bo{constructor(t,r,c=new hu(t.width+200,t.height+200,25),m=new hu(t.width+200,t.height+200,25)){this.transform=t,this.grid=c,this.ignoredGrid=m,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+io,this.screenBottomBoundary=t.height+io,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=r}placeCollisionBox(t,r,c,m,_,w,E,R,D,L,F){let k=c.projectedAnchorX,H=c.projectedAnchorY,$=c.projectedAnchorZ;const G=c.tileAnchorX,ee=c.tileAnchorY,X=c.elevation,ie=c.tileID,ce=t.getProjection();if(X&&ie){const[ct,Ze,ot]=ce.upVector(ie.canonical,c.tileAnchorX,c.tileAnchorY),jt=ce.upVectorScale(ie.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;k+=ct*X*jt,H+=Ze*X*jt,$+=ot*X*jt}const de=t.projection.name==="globe",Te=t.projection.name==="globe"?s.aj(this.transform.zoom):0;if(ie&&de&&Te<1&&!w){const ct=1<<ie.canonical.z,Ze=s.bP(G,ee);s.bQ(Ze,Ze,1/s.al),s.bR(Ze,Ze,s.bP(ie.canonical.x,ie.canonical.y)),s.bQ(Ze,Ze,1/ct),s.bS(Ze,Ze,s.bP(m[0],m[1])),Ze[0]=s.bT(Ze[0],-.5,.5),s.bQ(Ze,Ze,s.al);const ot=s.bU(Ze[0],Ze[1],s.al/(2*Math.PI),1);s.aC(ot,ot,_),k=s.ak(k,ot[0],Te),H=s.ak(H,ot[1],Te),$=s.ak($,ot[2],Te)}const we=this.projectAndGetPerspectiveRatio(L,k,H,$,c.tileID,ce.name==="globe"||!!X||this.transform.pitch>0,ce),Ee=D*we.perspectiveRatio,ve=(c.x1*r+E.x-c.padding)*Ee+we.point.x,be=(c.y1*r+E.y-c.padding)*Ee+we.point.y,Ce=(c.x2*r+E.x+c.padding)*Ee+we.point.x,We=(c.y2*r+E.y+c.padding)*Ee+we.point.y,je=we.perspectiveRatio<=.55||we.occluded;return!this.isInsideGrid(ve,be,Ce,We)||!R&&this.grid.hitTest(ve,be,Ce,We,F)||je?{box:[],offscreen:!1,occluded:we.occluded}:{box:[ve,be,Ce,We],offscreen:this.isOffscreen(ve,be,Ce,We),occluded:!1}}placeCollisionCircles(t,r,c,m,_,w,E,R,D,L,F,k,H,$,G){const ee=[],X=this.transform.elevation,ie=t.getProjection(),ce=X?X.getAtTileOffsetFunc(G,this.transform.center.lat,this.transform.worldSize,ie):null,de=new s.P(c.tileAnchorX,c.tileAnchorY);let{x:Te,y:we,z:Ee}=ie.projectTilePoint(de.x,de.y,G.canonical);if(ce){const[ht,_t,qt]=ce(de);Te+=ht,we+=_t,Ee+=qt}const ve=ie.name==="globe",be=this.projectAndGetPerspectiveRatio(E,Te,we,Ee,G,ve||!!X||this.transform.pitch>0,ie),{perspectiveRatio:Ce}=be,We=(F?w/Ce:w*Ce)/s.bX,je=Fa(Te,we,Ee,R),ct=c.lineOffsetX*We,Ze=c.lineOffsetY*We,ot=s.an(t.layers[0].layout.get("text-max-angle")),jt=Math.cos(ot),Ye=be.signedDistanceFromCamera>0?fh(We,_,ct,Ze,!1,je,de,c,m,R,{},X&&!F?ce:null,F&&!!X,ie,G,F,jt):null;let Oe=!1,nt=!1,Ge=!0;if(Ye&&!be.occluded){const ht=.5*H*Ce+$,_t=new s.P(-100,-100),qt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Ct=new cd,{first:Tt,last:gi}=Ye,oi=Tt.path.length;let ei=[];for(let Ki=oi-1;Ki>=1;Ki--)ei.push(Tt.path[Ki]);for(let Ki=1;Ki<gi.path.length;Ki++)ei.push(gi.path[Ki]);const li=2.5*ht;D&&(ei=ei.map(([Ki,Hi,zn],qi)=>(ce&&!ve&&(zn=ce(qi<oi-1?Tt.tilePath[oi-1-qi]:gi.tilePath[qi-oi+2])[2]),Fa(Ki,Hi,zn,D))),ei.some(Ki=>Ki[3]<=0)&&(ei=[]));let Li=[];if(ei.length>0){let Ki=1/0,Hi=-1/0,zn=1/0,qi=-1/0;for(const _n of ei)Ki=Math.min(Ki,_n[0]),zn=Math.min(zn,_n[1]),Hi=Math.max(Hi,_n[0]),qi=Math.max(qi,_n[1]);Hi>=_t.x&&Ki<=qt.x&&qi>=_t.y&&zn<=qt.y&&(Li=[ei.map(_n=>new s.P(_n[0],_n[1]))],(Ki<_t.x||Hi>qt.x||zn<_t.y||qi>qt.y)&&(Li=s.bV(Li,_t.x,_t.y,qt.x,qt.y)))}for(const Ki of Li){Ct.reset(Ki,.25*ht);let Hi=0;Hi=Ct.length<=.5*ht?1:Math.ceil(Ct.paddedLength/li)+1;for(let zn=0;zn<Hi;zn++){const qi=zn/Math.max(Hi-1,1),_n=Ct.lerp(qi),On=_n.x+io,or=_n.y+io;ee.push(On,or,ht,0);const Xi=On-ht,Rn=or-ht,bn=On+ht,Dn=or+ht;if(Ge=Ge&&this.isOffscreen(Xi,Rn,bn,Dn),nt=nt||this.isInsideGrid(Xi,Rn,bn,Dn),!r&&this.grid.hitTestCircle(On,or,ht,k)&&(Oe=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Oe,occluded:!1}}}}return{circles:!L&&Oe||!nt?[]:ee,offscreen:Ge,collisionDetected:Oe,occluded:be.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let c=1/0,m=1/0,_=-1/0,w=-1/0;for(const L of t){const F=new s.P(L.x+io,L.y+io);c=Math.min(c,F.x),m=Math.min(m,F.y),_=Math.max(_,F.x),w=Math.max(w,F.y),r.push(F)}const E=this.grid.query(c,m,_,w).concat(this.ignoredGrid.query(c,m,_,w)),R={},D={};for(const L of E){const F=L.key;if(R[F.bucketInstanceId]===void 0&&(R[F.bucketInstanceId]={}),R[F.bucketInstanceId][F.featureIndex])continue;const k=[new s.P(L.x1,L.y1),new s.P(L.x2,L.y1),new s.P(L.x2,L.y2),new s.P(L.x1,L.y2)];s.bW(r,k)&&(R[F.bucketInstanceId][F.featureIndex]=!0,D[F.bucketInstanceId]===void 0&&(D[F.bucketInstanceId]=[]),D[F.bucketInstanceId].push(F.featureIndex))}return D}insertCollisionBox(t,r,c,m,_){(r?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:m,collisionGroupID:_},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,c,m,_){const w=r?this.ignoredGrid:this.grid,E={bucketInstanceId:c,featureIndex:m,collisionGroupID:_};for(let R=0;R<t.length;R+=4)w.insertCircle(E,t[R],t[R+1],t[R+2])}projectAndGetPerspectiveRatio(t,r,c,m,_,w,E){const R=[r,c,m,1];let D=!1;m||this.transform.pitch>0?(s.aC(R,R,t),this.fogState&&_&&E.name!=="globe"&&(D=function(k,H,$,G,ee,X){const ie=X.calculateFogTileMatrix(ee),ce=[H,$,G];return s.af(ce,ce,ie),Ai(k,s.ag(ce),X.pitch,X._fov)}(this.fogState,r,c,m,_.toUnwrapped(),this.transform)>.9)):Ep(R,R,t);const L=R[3];return{point:new s.P((R[0]/L+1)/2*this.transform.width+io,(-R[1]/L+1)/2*this.transform.height+io),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/L*.5,1.5),signedDistanceFromCamera:L,occluded:w&&R[2]>L||D}}isOffscreen(t,r,c,m){return c<io||t>=this.screenRightBoundary||m<io||r>this.screenBottomBoundary}isInsideGrid(t,r,c,m){return c>=0&&t<this.gridRightBoundary&&m>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=s.bA([]);return s.br(t,t,[-100,-100,0]),t}}class gf{constructor(t,r,c,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):m&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class xo{constructor(t,r,c,m,_,w=!1){this.text=new gf(t?t.text:null,r,c,_),this.icon=new gf(t?t.icon:null,r,m,_),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _i{constructor(t,r,c,m=!1){this.text=t,this.icon=r,this.skipFade=c,this.clipped=m}}class Hn{constructor(){this.invProjMatrix=s.bC(),this.viewportMatrix=s.bC(),this.circles=[]}}class Zn{constructor(t,r,c,m,_){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=c,this.bucketIndex=m,this.tileID=_}}class Ra{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:c=>c.collisionGroupID===r}}return this.collisionGroups[t]}}function pu(u,t,r,c,m){const{horizontalAlign:_,verticalAlign:w}=s.c0(u),E=-(_-.5)*t,R=-(w-.5)*r,D=s.c1(u,c);return new s.P(E+D[0]*m,R+D[1]*m)}function Bn(u,t,r,c,m){const _=new s.P(u,t);return r&&_._rotate(c?m:-m),_}class _f{constructor(t,r,c,m,_,w){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Bo(this.transform,_),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new Ra(c),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,c,m,_=1){const w=c.getBucket(r),E=c.latestFeatureIndex;if(!w||!E||r.fqid!==w.layerIds[0])return;const R=w.layers[0].layout,D=w.layers[0].paint,L=c.collisionBoxArray,F=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),k=c.tileSize/s.al,H=c.tileID.toUnwrapped();this.transform.setProjection(w.projection);const $=(G=c.tileID,ee=w.getProjection(),X=this.transform,ee.name===this.projection?X.calculateProjMatrix(G.toUnwrapped()):ld(X,ee,G));var G,ee,X;const ie=R.get("text-pitch-alignment")==="map",ce=R.get("text-rotation-alignment")==="map";r.compileFilter(r.options);const de=r.dynamicFilter(),Te=r.dynamicFilterNeedsFeature(),we=this.transform.calculatePixelsToTileUnitsMatrix(c),Ee=Bl($,c.tileID.canonical,ie,ce,this.transform,w.getProjection(),we);let ve=null;const be=w.getProjection().createInversionMatrix(this.transform,c.tileID.canonical);if(ie){const Oe=du($,c.tileID.canonical,ie,ce,this.transform,w.getProjection(),we);ve=s.aB([],this.transform.labelPlaneMatrix,Oe)}let Ce=null;de&&c.latestFeatureIndex&&(Ce={unwrappedTileID:H,dynamicFilter:de,dynamicFilterNeedsFeature:Te}),this.retainedQueryData[w.bucketInstanceId]=new Zn(w.bucketInstanceId,E,w.sourceLayerIndex,w.index,c.tileID);const[We,je]=w.layers[0].layout.get("text-size-scale-range"),ct=s.aA(_,We,je),[Ze,ot]=R.get("icon-size-scale-range"),jt=s.aA(_,Ze,ot),Ye={bucket:w,layout:R,paint:D,posMatrix:$,invMatrix:be,mercatorCenter:[s.aF(this.transform.center.lng),s.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ee,labelToScreenMatrix:ve,clippingData:Ce,scale:F,textPixelRatio:k,holdingForFade:c.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:s.bK(w.textSizeData,this.transform.zoom,ct),partiallyEvaluatedIconSize:s.bK(w.iconSizeData,this.transform.zoom,jt),collisionGroup:this.collisionGroups.get(w.sourceID),latestFeatureIndex:c.latestFeatureIndex};if(m)for(const Oe of w.sortKeyRanges){const{sortKey:nt,symbolInstanceStart:Ge,symbolInstanceEnd:ht}=Oe;t.push({sortKey:nt,symbolInstanceStart:Ge,symbolInstanceEnd:ht,parameters:Ye})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Ye})}attemptAnchorPlacement(t,r,c,m,_,w,E,R,D,L,F,k,H,$,G,ee,X,ie,ce,de,Te){const{textOffset0:we,textOffset1:Ee,crossTileID:ve}=G,be=[we,Ee],Ce=pu(t,w,E,be,R),We=this.collisionIndex.placeCollisionBox(X,R,r,c,m,_,Bn(Ce.x,Ce.y,D,L,this.transform.angle),$,F,k,H.predicate);if(ce){const je=X.getSymbolInstanceIconSize(Te,this.transform.zoom,G.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(X,je,ce,c,m,_,Bn(Ce.x,Ce.y,D,L,this.transform.angle),$,F,k,H.predicate).box.length===0)return}if(We.box.length>0){let je;return this.prevPlacement&&this.prevPlacement.variableOffsets[ve]&&this.prevPlacement.placements[ve]&&this.prevPlacement.placements[ve].text&&(je=this.prevPlacement.variableOffsets[ve].anchor),this.variableOffsets[ve]={textOffset:be,width:w,height:E,anchor:t,textScale:R,prevAnchor:je},this.markUsedJustification(X,t,G,ie),X.allowVerticalPlacement&&(this.markUsedOrientation(X,ie,G),this.placedOrientations[ve]=ie),{shift:Ce,placedGlyphBoxes:We}}}placeLayerBucketPart(t,r,c,m,_=1){const{bucket:w,layout:E,paint:R,posMatrix:D,textLabelPlaneMatrix:L,labelToScreenMatrix:F,clippingData:k,textPixelRatio:H,mercatorCenter:$,invMatrix:G,holdingForFade:ee,collisionBoxArray:X,partiallyEvaluatedTextSize:ie,partiallyEvaluatedIconSize:ce,collisionGroup:de,latestFeatureIndex:Te}=t.parameters,we=E.get("text-optional"),Ee=E.get("icon-optional"),ve=E.get("text-allow-overlap"),be=E.get("icon-allow-overlap"),Ce=E.get("text-rotation-alignment")==="map",We=E.get("icon-rotation-alignment")==="map",je=E.get("text-pitch-alignment")==="map",ct=R.get("symbol-z-offset"),Ze=E.get("symbol-elevation-reference")==="sea",ot=E.get("symbol-placement"),[jt,Ye]=E.get("text-size-scale-range"),[Oe,nt]=E.get("icon-size-scale-range"),Ge=s.aA(_,jt,Ye),ht=s.aA(_,Oe,nt),_t=E.get("text-variable-anchor"),qt=Ce&&ot!=="point",Ct=We&&ot!=="point",Tt=_t&&w.hasTextData(),gi=w.hasIconTextFit()&&Tt&&w.hasIconData();this.transform.setProjection(w.projection);const oi=Tt||qt,ei=Ct||gi;let li=ve&&(be||!w.hasIconData()||Ee),Li=be&&(ve||!w.hasTextData()||we);const Ki=!ct.isConstant();!w.collisionArrays&&X&&w.deserializeCollisionBoxes(X),c&&m&&w.updateCollisionDebugBuffers(this.transform.zoom,X,Ge,ht);const Hi=(qi,_n,On)=>{const{crossTileID:or,numVerticalGlyphVertices:Xi}=qi;let Rn=null;if(k&&k.dynamicFilterNeedsFeature||Ki){const Dr=this.retainedQueryData[w.bucketInstanceId];Rn=Te.loadFeature({featureIndex:qi.featureIndex,bucketIndex:Dr.bucketIndex,sourceLayerIndex:Dr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(k&&!(0,k.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Rn,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new s.P(qi.tileAnchorX,qi.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[or]=new _i(!1,!1,!1,!0),void r.add(or);const bn=ct.evaluate(Rn,{});if(r.has(or))return;if(ee)return void(this.placements[or]=new _i(!1,!1,!1));let Dn=!1,Qn=!1,Er=!0,ns=!1,ur=!1,Ji=null,Pi={box:null,offscreen:null,occluded:null},vn={box:null},Mr=null,kn=null,Zr=null,ms=0,Ga=0,co=0;On.textFeatureIndex?ms=On.textFeatureIndex:qi.useRuntimeCollisionCircles&&(ms=qi.featureIndex),On.verticalTextFeatureIndex&&(Ga=On.verticalTextFeatureIndex);const gs=Dr=>{Dr.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const Nr=this.transform.elevation;Dr.elevation=Ze?bn:bn+(Nr?Nr.getAtTileOffset(Dr.tileID,Dr.tileAnchorX,Dr.tileAnchorY):0),Dr.elevation+=qi.zOffset},ca=On.textBox;if(ca){gs(ca);const Dr=pr=>{let Qr=s.bL.horizontal;if(w.allowVerticalPlacement&&!pr&&this.prevPlacement){const _s=this.prevPlacement.placedOrientations[or];_s&&(this.placedOrientations[or]=_s,Qr=_s,this.markUsedOrientation(w,Qr,qi))}return Qr},Nr=(pr,Qr)=>{if(w.allowVerticalPlacement&&Xi>0&&On.verticalTextBox){for(const _s of w.writingModes)if(_s===s.bL.vertical?(Pi=Qr(),vn=Pi):Pi=pr(),Pi&&Pi.box&&Pi.box.length)break}else Pi=pr()};if(_t){let pr=_t;if(this.prevPlacement&&this.prevPlacement.variableOffsets[or]){const Wr=this.prevPlacement.variableOffsets[or];pr.indexOf(Wr.anchor)>0&&(pr=pr.filter(Xs=>Xs!==Wr.anchor),pr.unshift(Wr.anchor))}const Qr=(Wr,Xs,el)=>{const Al=w.getSymbolInstanceTextSize(ie,qi,this.transform.zoom,_n),va=(Wr.x2-Wr.x1)*Al+2*Wr.padding,tl=(Wr.y2-Wr.y1)*Al+2*Wr.padding,fc=qi.hasIconTextFit&&!be?Xs:null;fc&&gs(fc);let il={box:[],offscreen:!1,occluded:!1};const Zh=ve?2*pr.length:pr.length;for(let Cl=0;Cl<Zh;++Cl){const La=this.attemptAnchorPlacement(pr[Cl%pr.length],Wr,$,G,oi,va,tl,Al,Ce,je,H,D,de,Cl>=pr.length,qi,_n,w,el,fc,ie,ce);if(La&&(il=La.placedGlyphBoxes,il&&il.box&&il.box.length)){Dn=!0,Ji=La.shift;break}}return il};Nr(()=>Qr(ca,On.iconBox,s.bL.horizontal),()=>{const Wr=On.verticalTextBox;return Wr&&gs(Wr),w.allowVerticalPlacement&&!(Pi&&Pi.box&&Pi.box.length)&&Xi>0&&Wr?Qr(Wr,On.verticalIconBox,s.bL.vertical):{box:null,offscreen:null,occluded:null}}),Pi&&(Dn=Pi.box,Er=Pi.offscreen,ns=Pi.occluded);const _s=Dr(!(!Pi||!Pi.box));if(!Dn&&this.prevPlacement){const Wr=this.prevPlacement.variableOffsets[or];Wr&&(this.variableOffsets[or]=Wr,this.markUsedJustification(w,Wr.anchor,qi,_s))}}else{const pr=(Qr,_s)=>{const Wr=w.getSymbolInstanceTextSize(ie,qi,this.transform.zoom,_n),Xs=this.collisionIndex.placeCollisionBox(w,Wr,Qr,$,G,oi,new s.P(0,0),ve,H,D,de.predicate);return Xs&&Xs.box&&Xs.box.length&&(this.markUsedOrientation(w,_s,qi),this.placedOrientations[or]=_s),Xs};Nr(()=>pr(ca,s.bL.horizontal),()=>{const Qr=On.verticalTextBox;return w.allowVerticalPlacement&&Xi>0&&Qr?(gs(Qr),pr(Qr,s.bL.vertical)):{box:null,offscreen:null,occluded:null}}),Dr(!!(Pi&&Pi.box&&Pi.box.length))}}if(Mr=Pi,Dn=Mr&&Mr.box&&Mr.box.length>0,Er=Mr&&Mr.offscreen,ns=Mr&&Mr.occluded,qi.useRuntimeCollisionCircles){const Dr=w.text.placedSymbolArray.get(qi.centerJustifiedTextSymbolIndex>=0?qi.centerJustifiedTextSymbolIndex:qi.verticalPlacedTextSymbolIndex),Nr=s.bM(w.textSizeData,ie,Dr),pr=E.get("text-padding");kn=this.collisionIndex.placeCollisionCircles(w,ve,Dr,w.lineVertexArray,w.glyphOffsetArray,Nr,D,L,F,c,je,de.predicate,qi.collisionCircleDiameter*Nr/s.bX,pr,this.retainedQueryData[w.bucketInstanceId].tileID),Dn=ve||kn.circles.length>0&&!kn.collisionDetected,Er=Er&&kn.offscreen,ns=kn.occluded}if(On.iconFeatureIndex&&(co=On.iconFeatureIndex),On.iconBox){const Dr=Nr=>{gs(Nr);const pr=qi.hasIconTextFit&&Ji?Bn(Ji.x,Ji.y,Ce,je,this.transform.angle):new s.P(0,0),Qr=w.getSymbolInstanceIconSize(ce,this.transform.zoom,qi.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Qr,Nr,$,G,ei,pr,be,H,D,de.predicate)};vn&&vn.box&&vn.box.length&&On.verticalIconBox?(Zr=Dr(On.verticalIconBox),Qn=Zr.box.length>0):(Zr=Dr(On.iconBox),Qn=Zr.box.length>0),Er=Er&&Zr.offscreen,ur=Zr.occluded}const Ws=we||qi.numHorizontalGlyphVertices===0&&Xi===0,ua=Ee||qi.numIconVertices===0;if(Ws||ua?ua?Ws||(Qn=Qn&&Dn):Dn=Qn&&Dn:Qn=Dn=Qn&&Dn,Dn&&Mr&&Mr.box&&this.collisionIndex.insertCollisionBox(Mr.box,E.get("text-ignore-placement"),w.bucketInstanceId,vn&&vn.box&&Ga?Ga:ms,de.ID),Qn&&Zr&&this.collisionIndex.insertCollisionBox(Zr.box,E.get("icon-ignore-placement"),w.bucketInstanceId,co,de.ID),kn&&(Dn&&this.collisionIndex.insertCollisionCircles(kn.circles,E.get("text-ignore-placement"),w.bucketInstanceId,ms,de.ID),c)){const Dr=w.bucketInstanceId;let Nr=this.collisionCircleArrays[Dr];Nr===void 0&&(Nr=this.collisionCircleArrays[Dr]=new Hn);for(let pr=0;pr<kn.circles.length;pr+=4)Nr.circles.push(kn.circles[pr+0]),Nr.circles.push(kn.circles[pr+1]),Nr.circles.push(kn.circles[pr+2]),Nr.circles.push(kn.collisionDetected?1:0)}const Mo=w.projection.name!=="globe";li=li&&(Mo||!ns),Li=Li&&(Mo||!ur),this.placements[or]=new _i(Dn||li,Qn||Li,Er||w.justReloaded),r.add(or)},zn=this.retainedQueryData[w.bucketInstanceId].tileID;if(w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,zn),w.elevationType==="road"&&w.updateRoadElevation(zn.canonical),w.updateZOffset(),w.sortFeaturesByY){const qi=w.getSortedSymbolIndexes(this.transform.angle);for(let _n=qi.length-1;_n>=0;--_n){const On=qi[_n];Hi(w.symbolInstances.get(On),On,w.collisionArrays[On])}w.hasAnyZOffset&&s.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const qi=w.getSortedIndexesByZOffset();for(let _n=0;_n<qi.length;++_n){const On=qi[_n];Hi(w.symbolInstances.get(On),On,w.collisionArrays[On])}}else for(let qi=t.symbolInstanceStart;qi<t.symbolInstanceEnd;qi++)Hi(w.symbolInstances.get(qi),qi,w.collisionArrays[qi]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){const qi=this.collisionCircleArrays[w.bucketInstanceId];s.bl(qi.invProjMatrix,D),qi.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(t,r,c,m){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:R,crossTileID:D}=c,L=s.c2(r),F=m===s.bL.vertical?R:L==="left"?_:L==="center"?w:L==="right"?E:-1;_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=F>=0&&_!==F?0:D),w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=F>=0&&w!==F?0:D),E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=F>=0&&E!==F?0:D),R>=0&&(t.text.placedSymbolArray.get(R).crossTileID=F>=0&&R!==F?0:D)}markUsedOrientation(t,r,c){const m=r===s.bL.horizontal||r===s.bL.horizontalOnly?r:0,_=r===s.bL.vertical?r:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:D}=c,L=t.text.placedSymbolArray;w>=0&&(L.get(w).placedOrientation=m),E>=0&&(L.get(E).placedOrientation=m),R>=0&&(L.get(R).placedOrientation=m),D>=0&&(L.get(D).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let c=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const m=r?r.symbolFadeChange(t):1,_=r?r.opacities:{},w=r?r.variableOffsets:{},E=r?r.placedOrientations:{};for(const R in this.placements){const D=this.placements[R],L=_[R];L?(this.opacities[R]=new xo(L,m,D.text,D.icon,null,D.clipped),c=c||D.text!==L.text.placed||D.icon!==L.icon.placed):(this.opacities[R]=new xo(null,m,D.text,D.icon,D.skipFade,D.clipped),c=c||D.text||D.icon)}for(const R in _){const D=_[R];if(!this.opacities[R]){const L=new xo(D,m,!1,!1);L.isHidden()||(this.opacities[R]=L,c=c||D.text.placed||D.icon.placed)}}for(const R in w)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=w[R]);for(const R in E)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=E[R]);c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r,c,m){const _=new Set;for(const w of r){const E=w.getBucket(t);E&&w.latestFeatureIndex&&t.fqid===E.layerIds[0]&&(this.updateBucketOpacities(E,_,w,w.collisionBoxArray,c,m,w.tileID,t.scope),E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,w.tileID),E.elevationType==="road"&&E.updateRoadElevation(w.tileID.canonical),E.updateZOffset())}}updateBucketOpacities(t,r,c,m,_,w,E,R){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const D=t.layers[0].layout,L=t.layers[0].paint,F=!!t.layers[0].dynamicFilter(),k=new xo(null,0,!1,!1,!0),H=D.get("text-allow-overlap"),$=D.get("icon-allow-overlap"),G=D.get("text-variable-anchor"),ee=D.get("text-rotation-alignment")==="map",X=D.get("text-pitch-alignment")==="map",ie=L.get("symbol-z-offset"),ce=D.get("symbol-elevation-reference")==="sea",de=!ie.isConstant(),Te=new xo(null,0,H&&($||!t.hasIconData()||D.get("icon-optional")),$&&(H||!t.hasTextData()||D.get("text-optional")),!0);!t.collisionArrays&&m&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(m);const we=(ve,be,Ce)=>{for(let We=0;We<be/4;We++)ve.opacityVertexArray.emplaceBack(Ce)};let Ee=0;w&&t.updateReplacement(E,w);for(let ve=0;ve<t.symbolInstances.length;ve++){const be=t.symbolInstances.get(ve),{numHorizontalGlyphVertices:Ce,numVerticalGlyphVertices:We,crossTileID:je,numIconVertices:ct,tileAnchorX:Ze,tileAnchorY:ot}=be;let jt=null;const Ye=this.retainedQueryData[t.bucketInstanceId];de&&be&&Ye&&(jt=c.latestFeatureIndex.loadFeature({featureIndex:be.featureIndex,bucketIndex:Ye.bucketIndex,sourceLayerIndex:Ye.sourceLayerIndex,layoutVertexArrayOffset:0}));const Oe=ie.evaluate(jt,{}),nt=r.has(je);let Ge=this.opacities[je];nt?Ge=k:Ge||(Ge=Te,this.opacities[je]=Ge),r.add(je);const ht=Ce>0||We>0,_t=ct>0,qt=this.placedOrientations[je],Ct=qt===s.bL.vertical,Tt=qt===s.bL.horizontal||qt===s.bL.horizontalOnly;!ht&&!_t||Ge.isHidden()||Ee++;let gi=!1;if((ht||_t)&&w)for(const oi of t.activeReplacements){if(s.bY(oi,_,s.bZ.Symbol,R)||oi.min.x>Ze||Ze>oi.max.x||oi.min.y>ot||ot>oi.max.y)continue;const ei=s.b_(Ze,ot,E.canonical,oi.footprintTileId.canonical);if(gi=s.b$(ei,oi.footprint),gi)break}if(ht){const oi=gi?Ul:fd(Ge.text);we(t.text,Ce,Ct?Ul:oi),we(t.text,We,Tt?Ul:oi);const ei=Ge.text.isHidden(),{leftJustifiedTextSymbolIndex:li,centerJustifiedTextSymbolIndex:Li,rightJustifiedTextSymbolIndex:Ki,verticalPlacedTextSymbolIndex:Hi}=be,zn=t.text.placedSymbolArray,qi=ei||Ct?1:0;li>=0&&(zn.get(li).hidden=qi),Li>=0&&(zn.get(Li).hidden=qi),Ki>=0&&(zn.get(Ki).hidden=qi),Hi>=0&&(zn.get(Hi).hidden=ei||Tt?1:0);const _n=this.variableOffsets[je];_n&&this.markUsedJustification(t,_n.anchor,be,qt);const On=this.placedOrientations[je];On&&(this.markUsedJustification(t,"left",be,On),this.markUsedOrientation(t,On,be))}if(_t){const oi=gi?Ul:fd(Ge.icon),{placedIconSymbolIndex:ei,verticalPlacedIconSymbolIndex:li}=be,Li=t.icon.placedSymbolArray,Ki=Ge.icon.isHidden()?1:0;ei>=0&&(we(t.icon,ct,Ct?Ul:oi),Li.get(ei).hidden=Ki),li>=0&&(we(t.icon,be.numVerticalIconVertices,Tt?Ul:oi),Li.get(li).hidden=Ki)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const oi=t.collisionArrays[ve];if(oi){let ei=new s.P(0,0),li=!0;if(oi.textBox||oi.verticalTextBox){if(G){const Ki=this.variableOffsets[je];Ki?(ei=pu(Ki.anchor,Ki.width,Ki.height,Ki.textOffset,Ki.textScale),ee&&ei._rotate(X?this.transform.angle:-this.transform.angle)):li=!1}F&&(li=!Ge.clipped),oi.textBox&&Ic(t.textCollisionBox.collisionVertexArray,Ge.text.placed,!li||Ct,Oe,ce,ei.x,ei.y),oi.verticalTextBox&&Ic(t.textCollisionBox.collisionVertexArray,Ge.text.placed,!li||Tt,Oe,ce,ei.x,ei.y)}const Li=li&&!!(!Tt&&oi.verticalIconBox);oi.iconBox&&Ic(t.iconCollisionBox.collisionVertexArray,Ge.icon.placed,Li,Oe,ce,be.hasIconTextFit?ei.x:0,be.hasIconTextFit?ei.y:0),oi.verticalIconBox&&Ic(t.iconCollisionBox.collisionVertexArray,Ge.icon.placed,!Li,Oe,ce,be.hasIconTextFit?ei.x:0,be.hasIconTextFit?ei.y:0)}}}if(t.fullyClipped=Ee===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ve=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ve.invProjMatrix,t.placementViewportMatrix=ve.viewportMatrix,t.collisionCircleArray=ve.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const c=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function Ic(u,t,r,c,m,_,w){u.emplaceBack(t?1:0,r?1:0,_||0,w||0,c,m?1:0),u.emplaceBack(t?1:0,r?1:0,_||0,w||0,c,m?1:0),u.emplaceBack(t?1:0,r?1:0,_||0,w||0,c,m?1:0),u.emplaceBack(t?1:0,r?1:0,_||0,w||0,c,m?1:0)}const ud=Math.pow(2,25),ta=Math.pow(2,24),ts=Math.pow(2,17),Wg=Math.pow(2,16),hd=Math.pow(2,9),dd=Math.pow(2,8),Fl=Math.pow(2,1);function fd(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,r=Math.floor(127*u.opacity);return r*ud+t*ta+r*ts+t*Wg+r*hd+t*dd+r*Fl+t}const Ul=0;class pd{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,r,c,m,_,w){const E=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(E,m,t[this._currentTileIndex],this._sortAcrossTiles,w),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((R,D)=>R.sortKey-D.sortKey));this._currentPartIndex<E.length;){const R=E[this._currentPartIndex];if(r.placeLayerBucketPart(R,this._seenCrossTileIDs,c,R.symbolInstanceStart===0,w),this._currentPartIndex++,_())return!0}return!1}}class ia{constructor(t,r,c,m,_,w,E,R,D){this.placement=new _f(t,_,w,E,R,D),this._currentPlacementIndex=r.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,r,c,m,_){const w=s.o.now(),E=()=>{const R=s.o.now()-w;return!this._forceFullPlacement&&R>2};for(;this._currentPlacementIndex>=0;){const R=r[t[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=D)&&(!R.maxzoom||R.maxzoom>D)){const L=R,F=L.layout.get("symbol-z-elevate"),k=L.layout.get("symbol-sort-key").constantOr(1)!==void 0,H=L.layout.get("symbol-z-order"),$=H==="viewport-y"||H==="auto"&&!(H!=="viewport-y"&&k),G=L.layout.get("text-allow-overlap")||L.layout.get("icon-allow-overlap")||L.layout.get("text-ignore-placement")||L.layout.get("icon-ignore-placement"),ee=$&&G,X=this._inProgressLayer=this._inProgressLayer||new pd(L),ie=s.B(R.source,R.scope);if(X.continuePlacement(F||ee?m[ie]:c[ie],this.placement,this._showCollisionBoxes,R,E,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const vo=512/s.al/2;class _a{constructor(t,r,c){this.tileID=t,this.bucketInstanceId=c,this.index=new s.c3(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const m=t.canonical.x*s.al,_=t.canonical.y*s.al;for(let w=0;w<r.length;w++){const{key:E,crossTileID:R,tileAnchorX:D,tileAnchorY:L}=r.get(w),F=Math.floor((m+D)*vo),k=Math.floor((_+L)*vo);this.index.add(F,k),this.keys.push(E),this.crossTileIDs.push(R)}this.index.finish()}findMatches(t,r,c){const m=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),_=vo/Math.pow(2,r.canonical.z-this.tileID.canonical.z),w=r.canonical.x*s.al,E=r.canonical.y*s.al;for(let R=0;R<t.length;R++){const D=t.get(R);if(D.crossTileID)continue;const{key:L,tileAnchorX:F,tileAnchorY:k}=D,H=Math.floor((w+F)*_),$=Math.floor((E+k)*_),G=this.index.range(H-m,$-m,H+m,$+m).sort((ee,X)=>ee-X);for(const ee of G){const X=this.crossTileIDs[ee];if(this.keys[ee]===L&&!c.has(X)){c.add(X),D.crossTileID=X;break}}}}}class mu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ph{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const c in this.indexes){const m=this.indexes[c],_={};for(const w in m){const E=m[w];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+r),_[E.tileID.key]=E}this.indexes[c]=_}this.lng=t}addBucket(t,r,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<r.symbolInstances.length;_++)r.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const m=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const w=this.indexes[_];if(Number(_)>t.overscaledZ)for(const E in w){const R=w[E];R.tileID.isChildOf(t)&&R.findMatches(r.symbolInstances,t,m)}else{const E=w[t.scaledTo(Number(_)).key];E&&E.findMatches(r.symbolInstances,t,m)}}for(let _=0;_<r.symbolInstances.length;_++){const w=r.symbolInstances.get(_);w.crossTileID||(w.crossTileID=c.generate(),m.add(w.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new _a(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const c of r.crossTileIDs)this.usedCrossTileIDs[t].delete(c)}removeStaleBuckets(t){let r=!1;for(const c in this.indexes){const m=this.indexes[c];for(const _ in m)t[m[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,m[_]),delete m[_],r=!0)}return r}}class fs{constructor(){this.layerIndexes={},this.crossTileIDs=new mu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,c,m){let _=this.layerIndexes[t.fqid];_===void 0&&(_=this.layerIndexes[t.fqid]=new ph);let w=!1;const E={};m.name!=="globe"&&_.handleWrapJump(c);for(const R of r){const D=R.getBucket(t);D&&t.fqid===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(R.tileID,D,this.crossTileIDs)&&(w=!0),E[D.bucketInstanceId]=!0)}return _.removeStaleBuckets(E)&&(w=!0),w}pruneUnusedLayers(t){const r={};t.forEach(c=>{r[c]=!0});for(const c in this.layerIndexes)r[c]||delete this.layerIndexes[c]}}const Ma=771;class tn{constructor(t,r,c,m){this.blendFunction=t,this.blendColor=r.toNonPremultipliedRenderColor(null),this.mask=c,this.blendEquation=m}}tn.Replace=[1,0,1,0],tn.disabled=new tn(tn.Replace,s.ao.transparent,[!1,!1,!1,!1]),tn.unblended=new tn(tn.Replace,s.ao.transparent,[!0,!0,!0,!0]),tn.alphaBlended=new tn([1,Ma,1,Ma],s.ao.transparent,[!0,!0,!0,!0]),tn.alphaBlendedNonPremultiplied=new tn([770,Ma,770,Ma],s.ao.transparent,[!0,!0,!0,!0]),tn.multiply=new tn([774,0,774,0],s.ao.transparent,[!0,!0,!0,!0]);class ni{constructor(t,r,c){this.func=t,this.mask=r,this.range=c}}ni.ReadOnly=!1,ni.ReadWrite=!0,ni.disabled=new ni(519,ni.ReadOnly,[0,1]);const Vl=7680;class Ci{constructor(t,r,c,m,_,w){this.test=t,this.ref=r,this.mask=c,this.fail=m,this.depthFail=_,this.pass=w}}Ci.disabled=new Ci({func:519,mask:0},0,0,Vl,Vl,Vl);const gu=1029,Hl=2305;class Ni{constructor(t,r,c){this.enable=t,this.mode=r,this.frontFace=c}}function yf(u,t){const r=s.c9(u,3);s.cb(u,t),s.cf(u,3,r)}function _u(u,t){const r=s.c6([]);return s.c7(r,r,-t),s.c8(r,r,-u),r}function yu(u,t){const r=[u[0],u[1],0],c=[t[0],t[1],0];if(s.ag(r)>=1e-15){const w=s.aw([],r);s.c4(c,w,s.bJ(c,w)),t[0]=c[0],t[1]=c[1]}const m=s.bI([],t,u);if(s.c5(m)<1e-15)return null;const _=Math.atan2(-m[1],m[0]);return _u(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),_)}Ni.disabled=new Ni(!1,gu,Hl),Ni.backCCW=new Ni(!0,gu,Hl),Ni.backCW=new Ni(!0,gu,2304),Ni.frontCW=new Ni(!0,1028,2304),Ni.frontCCW=new Ni(!0,1028,Hl);class xf{constructor(t,r){this.position=t,this.orientation=r}get position(){return this._position}set position(t){if(t){const r=t instanceof s.ae?t:new s.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(r.x=s.bT(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(t,r){if(this.orientation=null,!this.position)return;const c=this.position,m=this._elevation?this._elevation.getAtPointOrZero(s.ae.fromLngLat(t)):0,_=s.ae.fromLngLat(t,m),w=[_.x-c.x,_.y-c.y,_.z-c.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=yu(w,r)}setPitchBearing(t,r){this.orientation=_u(s.an(t),s.an(-r))}}class md{constructor(t,r){this._transform=s.bA([]),this.orientation=r,this.position=t}get mercatorPosition(){const t=this.position;return new s.ae(t[0],t[1],t[2])}get position(){const t=s.c9(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var r;t&&s.cf(this._transform,3,[(r=t)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||s.c6([]),t&&yf(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),r=this.right();return{bearing:Math.atan2(-r[1],r[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,r){this._orientation=_u(t,r),yf(this._transform,this._orientation)}forward(){const t=s.c9(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=s.c9(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=s.c9(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,r){const c=new Float64Array(16);return s.bl(c,this.getWorldToCamera(t,r)),c}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,r,c){const m=this.position;s.c4(m,m,-t);const _=new Float64Array(16);return s.bq(_,[c,c,c]),s.br(_,_,m),_[10]*=r,_}getWorldToCamera(t,r){const c=new Float64Array(16),m=new Float64Array(4),_=this.position;return s.ca(m,this._orientation),s.c4(_,_,-t),s.cb(c,m),s.br(c,c,_),c[1]*=-1,c[5]*=-1,c[9]*=-1,c[13]*=-1,c[8]*=r,c[9]*=r,c[10]*=r,c[11]*=r,c}getCameraToClipPerspective(t,r,c,m){const _=new Float64Array(16);return s.cc(_,t,r,c,m),_}getCameraToClipOrthographic(t,r,c,m,_,w){const E=new Float64Array(16);return s.cd(E,t,r,c,m,_,w),E}getDistanceToElevation(t,r=!1){const c=t===0?0:s.ce(t,r?s.a$(this.position[1]):this.position[1]),m=this.forward();return(c-this.position[2])/m[2]}clone(){return new md([...this.position],[...this.orientation])}}const $r={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Ap{constructor(t=0,r=0,c=0,m=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(c)||c<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=c,this.right=m}interpolate(t,r,c){return r.top!=null&&t.top!=null&&(this.top=s.ak(t.top,r.top,c)),r.bottom!=null&&t.bottom!=null&&(this.bottom=s.ak(t.bottom,r.bottom,c)),r.left!=null&&t.left!=null&&(this.left=s.ak(t.left,r.left,c)),r.right!=null&&t.right!=null&&(this.right=s.ak(t.right,r.right,c)),this}getCenter(t,r){const c=s.aA((this.left+t-this.right)/2,0,t),m=s.aA((this.top+r-this.bottom)/2,0,r);return new s.P(c,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Ap(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ql=15;class ya{constructor(t,r,c,m,_,w,E){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=c??0,this._maxPitch=m??60,this.setProjection(w),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new s.aR(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ap,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new md,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new ya(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<ql}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,r=!1){const c=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||c)&&this._updateCameraOnTerrain(),(t||c)&&this._constrainCamera(r),this._calcMatrices()}getProjection(){return s.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=s.cl(this.projectionOptions);const c=this.getProjection(),m=!s.by(r,c);return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.cl({name:"mercator"});const r=t!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bT(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const r=-t*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=s.cm(),s.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=s.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=s.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._setZoom(r),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,r=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!r||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;r||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&c.exaggeration()&&this._centerAltitudeValidForExaggeration!==c.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*c.exaggeration(),this._centerAltitudeValidForExaggeration=c.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=c.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],c=this.horizonLineFromTop();let m=0,_=0;for(let w=0;w<r.length;w++){const E=new s.P(r[w][0]*this.width,c+r[w][1]*(this.height-c)),R=t.pointCoordinate(E);if(!R)continue;const D=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);m+=R[3]*D,_+=D}return _===0?NaN:m/_}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,r=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),c=this.pixelsPerMeter/this.worldSize*r,m=this._mercatorZfromZoom(t),_=this._mercatorZfromZoom(this._maxZoom),w=Math.max(m-c,_);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let c;c=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];const m=s.ag(s.av([],this._camera.position,c));return s.aA(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let r=!1;if(t.orientation&&!s.co(t.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(t.orientation)),t.position){const c=[t.position.x,t.position.y,t.position.z];s.cp(c,this._camera.position)||(this._setCameraPosition(c),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,r=new xf;return r.position=new s.ae(t[0],t[1],t[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(t){if(!s.cq(t))return!1;s.cr(t,t);const r=s.cs([],[0,0,-1],t),c=s.cs([],[0,-1,0],t);if(c[2]<0)return!1;const m=yu(r,c);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(t){const r=this.zoomScale(this.minZoom)*this.tileSize,c=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;t[2]=s.aA(t[2],m/c,m/r),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,c){this._unmodified=!1,this._edgeInsets.interpolate(t,r,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new s.ct(0,t)];if(this.renderWorldCopies){const c=this.pointCoordinate(new s.P(0,0)),m=this.pointCoordinate(new s.P(this.width,0)),_=this.pointCoordinate(new s.P(this.width,this.height)),w=this.pointCoordinate(new s.P(0,this.height)),E=Math.floor(Math.min(c.x,m.x,_.x,w.x)),R=Math.floor(Math.max(c.x,m.x,_.x,w.x)),D=1;for(let L=E-D;L<=R+D;L++)L!==0&&r.push(new s.ct(L,t))}return r}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,r,c){let m=[];const _=c!=null,w=!_;if(w&&this.zoom<r||_&&c[0]===0&&c[1]===0)return m;const E=new Set,R=(L,F,k,H,$)=>{const G=s.cX(F,L,k,H,$);E.has(G)||(m.push(new s.aO(L,F,k,H,$)),E.add(G))};for(let L=0;L<t.length;L++){const F=t[L];if(w&&F.canonical.z!==r)continue;const k=F.canonical,H=F.overscaledZ,$=F.wrap,G=1<<k.z,ee=k.x+1<G,X=k.x>0,ie=k.y+1<G,ce=k.y>0,de=F.wrap-(X?0:1),Te=F.wrap+(ee?0:1),we=X?k.x-1:G-1,Ee=ee?k.x+1:0;if(_)c[0]<0?(R(H,Te,k.z,Ee,k.y),c[1]<0&&ie&&(R(H,$,k.z,k.x,k.y+1),R(H,Te,k.z,Ee,k.y+1)),c[1]>0&&ce&&(R(H,$,k.z,k.x,k.y-1),R(H,Te,k.z,Ee,k.y-1))):c[0]>0?(R(H,de,k.z,we,k.y),c[1]<0&&ie&&(R(H,$,k.z,k.x,k.y+1),R(H,de,k.z,we,k.y+1)),c[1]>0&&ce&&(R(H,$,k.z,k.x,k.y-1),R(H,de,k.z,we,k.y-1))):c[1]<0&&ie?R(H,$,k.z,k.x,k.y+1):ce&&R(H,$,k.z,k.x,k.y-1);else{const ve=F.visibleQuadrants;1&ve&&(R(H,de,k.z,we,k.y),ce&&(R(H,$,k.z,k.x,k.y-1),R(H,de,k.z,we,k.y-1))),2&ve&&(R(H,Te,k.z,Ee,k.y),ce&&(R(H,$,k.z,k.x,k.y-1),R(H,Te,k.z,Ee,k.y-1))),4&ve&&(R(H,de,k.z,we,k.y),ie&&(R(H,$,k.z,k.x,k.y+1),R(H,de,k.z,we,k.y+1))),8&ve&&(R(H,Te,k.z,Ee,k.y),ie&&(R(H,$,k.z,k.x,k.y+1),R(H,Te,k.z,Ee,k.y+1)))}}const D=[];for(const L of m)m.some(F=>L.isChildOf(F))||D.push(L);if(m=D.filter(L=>!t.some(F=>!!(L.overscaledZ<r&&F.isChildOf(L))||L.equals(F)||L.isChildOf(F))),w){const L=1<<r,F=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),k=[L*F.x,L*F.y],H=4,$=H*H;m=m.filter(G=>{const ee=G.canonical.x+.5-k[0],X=G.canonical.y+.5-k[1];return ee*ee+X*X<$})}return m}extendTileCoverToNearPlane(t,r,c){const m=[],_=new Set;for(const ie of t)_.add(ie.key);const w=(ie,ce,de,Te,we)=>{const Ee=s.cX(ce,ie,de,Te,we);_.has(Ee)||(m.push(new s.aO(ie,ce,de,Te,we)),_.add(Ee))},E=t.reduce((ie,ce)=>Math.max(ie,ce.overscaledZ),c),R=1<<c,D=[new s.P(0,0),new s.P(s.al,0),new s.P(s.al,s.al),new s.P(0,s.al)],L=new s.P(0,0),F=new s.P(0,0),k=(ie,ce)=>{const de=Math.floor(ie[0]),Te=Math.floor(ie[1]),we=(ie[0]-de)*s.al,Ee=(ie[1]-Te)*s.al,ve=Math.floor(ce[0]),be=Math.floor(ce[1]),Ce=(ce[0]-ve)*s.al,We=(ce[1]-be)*s.al;for(let je=-1;je<=1;je++){const ct=de+je;if(!(ct<0||ct>=R)){L.x=we-je*s.al,F.x=Ce-(ct-ve)*s.al;for(let Ze=-1;Ze<=1;Ze++){const ot=Te+Ze;L.y=Ee-Ze*s.al,F.y=We-(ot-be)*s.al,s.cY(L,F,D)&&w(E,0,c,ct,ot)}}}},H=r.points,$=H[s.cu],G=H[s.cv],ee=this._projectToGround($,H[s.cw]),X=this._projectToGround(G,H[s.cx]);return k($,ee),k(G,X),m}_projectToGround(t,r){return s.cy(s.cz(),t,r,t[2]/(t[2]-r[2]))}coveringTiles(t){let r=this.coveringZoomLevel(t);const c=r,m=this.elevation&&this.elevation.exaggeration(),_=m&&!t.isTerrainDEM,w=this.projection.name==="mercator";if(t.minzoom!==void 0&&r<t.minzoom)return[];t.maxzoom!==void 0&&r>t.maxzoom&&(r=t.maxzoom);const E=this.locationCoordinate(this.center),R=this.center.lat,D=1<<r,L=[D*E.x,D*E.y,0],F=this.projection.name==="globe",k=!F,H=s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,k),$=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=D*s.ce(1,this.center.lat),ee=this._camera.position[2]/s.ce(1,this.center.lat),X=[D*$.x,D*$.y,ee*(k?1:G)],ie=F||m,ce=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),de=this.isLODDisabled(!0)?r:0;let Te;if(this._elevation&&t.isTerrainDEM)Te=1e4*this._elevation.exaggeration();else if(this._elevation){const Oe=this._elevation.getMinMaxForVisibleTiles();Te=Oe?Oe.max:this._centerAltitude}else Te=this._centerAltitude;const we=t.isTerrainDEM?-Te:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ee=this.projection.isReprojectedInTileSpace?s.cB(this):1,ve=Oe=>{const Ge=new s.ae(Oe.x+25e-6,Oe.y,Oe.z),ht=new s.ae(Oe.x,Oe.y+25e-6,Oe.z),_t=Oe.toLngLat(),qt=Ge.toLngLat(),Ct=ht.toLngLat(),Tt=this.locationCoordinate(_t),gi=this.locationCoordinate(qt),oi=this.locationCoordinate(Ct),ei=Math.hypot(gi.x-Tt.x,gi.y-Tt.y),li=Math.hypot(oi.x-Tt.x,oi.y-Tt.y);return Math.sqrt(ei*li)*Ee/25e-6},be=Oe=>{const nt=Te,Ge=we;return{aabb:s.cE(this,D,0,0,0,Oe,Ge,nt,this.projection),zoom:0,x:0,y:0,minZ:Ge,maxZ:nt,wrap:Oe,fullyVisible:!1}},Ce=[];let We=[];const je=r,ct=t.reparseOverscaled?c:r,Ze=(ee-this._centerAltitude)*G,ot=Oe=>{if(!this._elevation||!Oe.tileID||!w)return;const nt=this._elevation.getMinMaxForTile(Oe.tileID),Ge=Oe.aabb;nt?(Ge.min[2]=nt.min,Ge.max[2]=nt.max,Ge.center[2]=(Ge.min[2]+Ge.max[2])/2):(Oe.shouldSplit=Ye(Oe),Oe.shouldSplit||(Ge.min[2]=Ge.max[2]=Ge.center[2]=this._centerAltitude))},jt=(Oe,nt)=>{if(.707*nt<Oe)return 1;const Ge=nt/Oe;return Ge/(1.4144271570014144+(Math.pow(1.1,Ge-1.4144271570014144+1)-1)/(1.1-1)-1)},Ye=Oe=>{if(Oe.zoom<de)return!0;if(Oe.zoom===je)return!1;if(Oe.shouldSplit!=null)return Oe.shouldSplit;const nt=Oe.aabb.distanceX(X),Ge=Oe.aabb.distanceY(X);let ht=Ze,_t=1;if(F){ht=Oe.aabb.distanceZ(X);const li=Math.pow(2,Oe.zoom),Li=s.a$((Oe.y+1)/li),Ki=s.a$(Oe.y/li),Hi=Math.min(Math.max(R,Li),Ki),zn=s.d0(Hi)/s.d0(R);if(_t=Hi===R?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,zn/this._mercatorScaleRatio),this.zoom<=s.cZ&&Oe.zoom===je-1&&zn>=.9)return!0}else if(_&&(ht=Oe.aabb.distanceZ(X)*G),this.projection.isReprojectedInTileSpace&&c<=5){const li=Math.pow(2,Oe.zoom),Li=ve(new s.ae((Oe.x+.5)/li,(Oe.y+.5)/li));_t=Li>.85?1:Li}if(!w){const li=Math.sqrt(nt*nt+Ge*Ge+ht*ht);let Li=(1<<je-Oe.zoom)*ce*_t;return Li*=jt(Math.max(ht,Ze),li),li<Li}let qt=Number.MAX_VALUE,Ct=0;const Tt=Oe.aabb.getCorners(),gi=[];for(const li of Tt){s.av(gi,li,X),F||(_?gi[2]*=G:gi[2]=Ze);const Li=s.bJ(gi,this._camera.forward());Li<qt&&(qt=Li,Ct=Math.abs(gi[2]))}let oi=(1<<je-Oe.zoom)*ce*_t;if(oi*=jt(Math.max(Ct,Ze),qt),qt<oi)return!0;const ei=Oe.aabb.closestPoint(L);return ei[0]===L[0]&&ei[1]===L[1]};if(this.renderWorldCopies)for(let Oe=1;Oe<=3;Oe++)Ce.push(be(-Oe)),Ce.push(be(Oe));for(Ce.push(be(0));Ce.length>0;){const Oe=Ce.pop(),nt=Oe.x,Ge=Oe.y;let ht=Oe.fullyVisible;const _t=()=>this.projection.name==="globe"&&(Oe.y===0||Oe.y===(1<<Oe.zoom)-1);if(!ht){let qt=ie?Oe.aabb.intersects(H):Oe.aabb.intersectsFlat(H);if(qt===0&&_t()){const Ct=new s.cC(Oe.zoom,nt,Ge);qt=s.cD(this,D,Ct,!0).intersects(H)}if(qt===0)continue;ht=qt===2}if(Oe.zoom!==je&&Ye(Oe))for(let qt=0;qt<4;qt++){const Ct=(nt<<1)+qt%2,Tt=(Ge<<1)+(qt>>1),gi={aabb:w?Oe.aabb.quadrant(qt):s.cE(this,D,Oe.zoom+1,Ct,Tt,Oe.wrap,Oe.minZ,Oe.maxZ,this.projection),zoom:Oe.zoom+1,x:Ct,y:Tt,wrap:Oe.wrap,fullyVisible:ht,tileID:void 0,shouldSplit:void 0,minZ:Oe.minZ,maxZ:Oe.maxZ};_&&!F&&(gi.tileID=new s.aO(Oe.zoom+1===je?ct:Oe.zoom+1,Oe.wrap,Oe.zoom+1,Ct,Tt),ot(gi)),Ce.push(gi)}else{const qt=Oe.zoom===je?ct:Oe.zoom;if(t.minzoom&&t.minzoom>qt)continue;let Ct=0;if(!ht){let ei=ie?Oe.aabb.intersectsPrecise(H):Oe.aabb.intersectsPreciseFlat(H);if(ei===0&&_t()){const li=new s.cC(Oe.zoom,nt,Ge);ei=s.cD(this,D,li,!0).intersectsPrecise(H)}if(ei===0)continue;if(t.calculateQuadrantVisibility)if(H.containsPoint(Oe.aabb.center))Ct=15;else for(let li=0;li<4;li++)Oe.aabb.quadrant(li).intersects(H)!==0&&(Ct|=1<<li)}const Tt=L[0]-(.5+nt+(Oe.wrap<<Oe.zoom))*(1<<r-Oe.zoom),gi=L[1]-.5-Ge,oi=Oe.tileID?Oe.tileID:new s.aO(qt,Oe.wrap,Oe.zoom,nt,Ge);t.calculateQuadrantVisibility&&(oi.visibleQuadrants=Ct),We.push({tileID:oi,distanceSq:Tt*Tt+gi*gi})}}if(this.fogCullDistSq){const Oe=this.fogCullDistSq,nt=this.horizonLineFromTop();We=We.filter(Ge=>{const ht=[0,0,0,1],_t=[s.al,s.al,0,1],qt=this.calculateFogTileMatrix(Ge.tileID.toUnwrapped());s.aC(ht,ht,qt),s.aC(_t,_t,qt);const Ct=s.cF([],ht,_t),Tt=s.cG([],ht,_t),gi=s.c_(Ct,Tt);if(gi===0)return!0;let oi=!1;const ei=this._elevation;if(ei&&gi>Oe&&nt!==0){const li=this.calculateProjMatrix(Ge.tileID.toUnwrapped());let Li;t.isTerrainDEM||(Li=ei.getMinMaxForTile(Ge.tileID)),Li||(Li={min:we,max:Te});const Ki=s.cH(this.rotation),Hi=[Ki[0]*s.al,Ki[1]*s.al,Li.max];s.af(Hi,Hi,li),oi=(1-Hi[1])*this.height*.5<nt}return gi<Oe||oi})}return We.sort((Oe,nt)=>Oe.distanceSq-nt.distanceSq).map(Oe=>Oe.tileID)}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const r=s.aA(t.lat,-s.cI,s.cI),c=this.projection.project(t.lng,r);return new s.P(c.x*this.worldSize,c.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,r){let c,m;const _=this.centerPoint;if(this.projection.name==="globe"){const E=this.worldSize;c=(r.x-_.x)/E,m=(r.y-_.y)/E}else{const E=this.pointCoordinate(r),R=this.pointCoordinate(_);c=E.x-R.x,m=E.y-R.y}const w=this.locationCoordinate(t);this.setLocation(new s.ae(w.x-c,w.y-m))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,r){return this.projection.locationPoint(this,t,r)}locationPoint3D(t,r){return this.projection.locationPoint(this,t,r,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,r){return this.coordinateLocation(this.pointCoordinate3D(t,r))}locationCoordinate(t,r){const c=r?s.ce(r,t.lat):void 0,m=this.projection.project(t.lng,t.lat);return new s.ae(m.x,m.y,c)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,r){const c=r??this._centerAltitude,m=[t.x,t.y,0,1],_=[t.x,t.y,1,1];s.aC(m,m,this.pixelMatrixInverse),s.aC(_,_,this.pixelMatrixInverse);const w=_[3];s.cJ(m,m,1/m[3]),s.cJ(_,_,1/w);const E=m[2],R=_[2];return{p0:m,p1:_,t:E===R?0:(c-E)/(R-E)}}screenPointToMercatorRay(t){const r=[t.x,t.y,0,1],c=[t.x,t.y,1,1];return s.aC(r,r,this.pixelMatrixInverse),s.aC(c,c,this.pixelMatrixInverse),s.cJ(r,r,1/r[3]),s.cJ(c,c,1/c[3]),r[2]=s.ce(r[2],this._center.lat)*this.worldSize,c[2]=s.ce(c[2],this._center.lat)*this.worldSize,s.cJ(r,r,1/this.worldSize),s.cJ(c,c,1/this.worldSize),new s.ax([r[0],r[1],r[2]],s.aw([],s.av([],c,r)))}rayIntersectionCoordinate(t){const{p0:r,p1:c,t:m}=t,_=s.ce(r[2],this._center.lat),w=s.ce(c[2],this._center.lat);return new s.ae(s.ak(r[0],c[0],m)/this.worldSize,s.ak(r[1],c[1],m)/this.worldSize,s.ak(_,w,m))}pointCoordinate(t,r=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,r)}pointCoordinate3D(t,r){if(!this.elevation)return this.pointCoordinate(t,r);let c=this.projection.pointCoordinate3D(this,t.x,t.y);if(c)return new s.ae(c[0],c[1],c[2]);let m=0,_=this.horizonLineFromTop();if(t.y>_)return this.pointCoordinate(t,r);const w=.02*_,E=t.clone();for(let R=0;R<10&&_-m>w;R++){E.y=s.ak(m,_,.66);const D=this.projection.pointCoordinate3D(this,E.x,E.y);D?(_=E.y,c=D):m=E.y}return c?new s.ae(c[0],c[1],c[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=s.cK)return!this.isPointAboveHorizon(t);const r=this.pointCoordinate(t);return r.y>=0&&r.y<=1}_coordinatePoint(t,r){const c=r&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,m=[t.x*this.worldSize,t.y*this.worldSize,c+t.toAltitude(),1];return s.aC(m,m,this.pixelMatrix),m[3]>0?new s.P(m[0]/m[3],m[1]/m[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:r}=this._edgeInsets,c=this.height-this._edgeInsets.bottom,m=this.width-this._edgeInsets.right,_=this.pointLocation3D(new s.P(r,t)),w=this.pointLocation3D(new s.P(m,t)),E=this.pointLocation3D(new s.P(m,c)),R=this.pointLocation3D(new s.P(r,c));let D=Math.min(_.lng,w.lng,E.lng,R.lng),L=Math.max(_.lng,w.lng,E.lng,R.lng),F=Math.min(_.lat,w.lat,E.lat,R.lat),k=Math.max(_.lat,w.lat,E.lat,R.lat);const H=Math.pow(2,-this.zoom)/16*270,$=this.projection.name==="globe"?1:4,G=(ee,X,ie,ce,de)=>{const Te=(ee+ie)/2,we=(X+ce)/2,Ee=new s.P(Te,we),{lng:ve,lat:be}=this.pointLocation3D(Ee),Ce=Math.max(0,D-ve,F-be,ve-L,be-k);D=Math.min(D,ve),L=Math.max(L,ve),F=Math.min(F,be),k=Math.max(k,be),(de<$||Ce>H)&&(G(ee,X,Te,we,de+1),G(Te,we,ie,ce,de+1))};if(G(r,t,m,t,1),G(m,t,m,c,1),G(m,c,r,c,1),G(r,c,r,t,1),this.projection.name==="globe"){const[ee,X]=s.cL(this);ee?(k=90,L=180,D=-180):X&&(F=-90,L=180,D=-180)}return new s.aI(new s.aR(D,F),new s.aR(L,k))}_getBoundsRectangular(t,r){const{top:c,left:m}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,E=new s.P(m,c),R=new s.P(w,c),D=new s.P(w,_),L=new s.P(m,_);let F=this.pointCoordinate(E,t),k=this.pointCoordinate(R,t);const H=this.pointCoordinate(D,r),$=this.pointCoordinate(L,r),G=(ee,X)=>(X.y-ee.y)/(X.x-ee.x);return F.y>1&&k.y>=0?F=new s.ae((1-$.y)/G($,F)+$.x,1):F.y<0&&k.y<=1&&(F=new s.ae(-$.y/G($,F)+$.x,0)),k.y>1&&F.y>=0?k=new s.ae((1-H.y)/G(H,k)+H.x,1):k.y<0&&F.y<=1&&(k=new s.ae(-H.y/G(H,k)+H.x,0)),new s.aI().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(H))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const r=t.visibleDemTiles.reduce((c,m)=>{if(m.dem){const _=m.dem.tree;c.min=Math.min(c.min,_.minimums[0]),c.max=Math.max(c.max,_.maximums[0])}return c},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(r.min*t.exaggeration(),r.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const r=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,c=this.height/2-r*(1-this._horizonShift);return t?Math.max(0,c):c}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-s.cI,this.maxLat=s.cI,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aF(this.minLng)*this.tileSize,this.worldMaxX=s.aF(this.maxLng)*this.tileSize,this.worldMinY=s.aJ(this.maxLat)*this.tileSize,this.worldMaxY=s.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,r){return this.projection.createTileMatrix(this,r,t)}calculateDistanceTileData(t){const r=t.key,c=this._distanceTileDataCache;if(c[r])return c[r];const m=t.canonical,_=1/this.height,w=this.cameraWorldSize,E=w/this.zoomScale(m.z),R=(m.x+Math.pow(2,m.z)*t.wrap)*E,D=m.y*E,L=this.point;L.x*=w/this.worldSize,L.y*=w/this.worldSize;const F=this.angle,k=Math.sin(-F),H=-Math.cos(-F);return c[r]={bearing:[k,H],center:[(L.x-R)*_,(L.y-D)*_],scale:E/s.al*_},c[r]}calculateFogTileMatrix(t){const r=t.key,c=this._fogTileMatrixCache;if(c[r])return c[r];const m=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return s.aB(m,this.worldToFogMatrix,m),c[r]=new Float32Array(m),c[r]}calculateProjMatrix(t,r=!1,c=!1){const m=t.key;let _;if(_=c?this._expandedProjMatrixCache:r?this._alignedProjMatrixCache:this._projMatrixCache,_[m])return _[m];const w=this.calculatePosMatrix(t,this.worldSize);let E;return E=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.expandedFarZProjMatrix:r?this.alignedProjMatrix:this.projMatrix,s.aB(w,E,w),_[m]=new Float32Array(w),_[m]}calculatePixelsToTileUnitsMatrix(t){const r=t.tileID.key,c=this._pixelsToTileUnitsCache;if(c[r])return c[r];const m=s.cM(t,this);return c[r]=m,c[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,r=s.bq([],[t,t,t]);return s.aB(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const r=s.ce(1,this._center.lat)*this.worldSize,c=this._computeCameraPosition(r),m=this._camera.forward(),_=s.ce(1,this._center.lat);c[2]/=_,m[2]/=_,s.aw(m,m);const w=t.raycast(c,m,t.exaggeration());if(w){const E=s.bH([],c,m,w),R=new s.ae(E[0],E[1],s.ce(E[2],s.a$(E[1]))),D=(R.z+s.ag([R.x-c[0],R.y-c[1],R.z-c[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const r=this._elevation,c=s.ce(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),_=r.getAtPointOrZero(new s.ae(...m)),w=this.pixelsPerMeter/this.worldSize*_,E=this._minimumHeightOverTerrain(),R=m[2]-w;if(R<=E)if(R<0||t){const D=this.locationCoordinate(this._center,this._centerAltitude),L=[m[0],m[1],D.z-m[2]],F=s.ag(L);L[2]-=(E-R)/this._pixelsPerMercatorPixel;const k=s.ag(L);if(k===0)return;s.c4(L,L,F/k*this._pixelsPerMercatorPixel),this._camera.position=[m[0],m[1],D.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const k=this.center;return k.lat=s.aA(k.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(k.lng=s.aA(k.lng,this.minLng,this.maxLng)),this.center=k,void(this._constraining=!1)}const r=this._unmodified,{x:c,y:m}=this.point;let _=0,w=c,E=m;const R=this.width/2,D=this.height/2,L=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(m-D<L&&(E=L+D),m+D>F&&(E=F-D),F-L<this.height&&(_=Math.max(_,this.height/(F-L)),E=(F+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const k=this.worldMinX*this.scale,H=this.worldMaxX*this.scale,$=this.worldSize/2-(k+H)/2;w=(c+$+this.worldSize)%this.worldSize-$,w-R<k&&(w=k+R),w+R>H&&(w=H-R),H-k<this.width&&(_=Math.max(_,this.width/(H-k)),w=(H+k)/2)}w===c&&E===m||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(w,E))),_&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r=this.projection.name==="globe",c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.ce(1,this.center.lat)/s.ce(1,s.d1));const m=s.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this.projection.zAxisUnit==="meters"?c:1,w=this._camera.getWorldToCamera(this.worldSize,_);let E;const R=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(R[8]=2*-t.x/this.width,R[9]=2*t.y/this.height,this.isOrthographic){let be=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ce=be*this.aspect,We=-Ce,je=-be;Ce-=t.x,We-=t.x,be+=t.y,je+=t.y,E=this._camera.getCameraToClipOrthographic(We,Ce,je,be,this._nearZ,this._farZ),((ct,Ze,ot,jt)=>{for(let Ye=0;Ye<16;Ye++)ct[Ye]=s.ak(Ze[Ye],ot[Ye],jt)})(E,E,R,s.c$(this.pitch>=ql?1:this.pitch/ql))}else E=R;const D=s.cO([],R,w);let L=s.cO([],E,w);if(this.projection.isReprojectedInTileSpace){const be=this.locationCoordinate(this.center),Ce=s.bA([]);s.br(Ce,Ce,[be.x*this.worldSize,be.y*this.worldSize,0]),s.aB(Ce,Ce,s.cP(this)),s.br(Ce,Ce,[-be.x*this.worldSize,-be.y*this.worldSize,0]),s.aB(L,L,Ce),s.aB(D,D,Ce),this.inverseAdjustmentMatrix=s.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cR([],L,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=L,this.invProjMatrix=s.bl(new Float64Array(16),this.projMatrix),r){const be=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);be[8]=2*-t.x/this.width,be[9]=2*t.y/this.height,this.expandedFarZProjMatrix=s.cO([],be,w)}else this.expandedFarZProjMatrix=this.projMatrix;const F=s.bl([],E);this.frustumCorners=s.cS.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const k=new Float32Array(16);s.bA(k),s.cR(k,k,[1,-1,1]),s.cT(k,k,this._pitch),s.bB(k,k,this.angle);const H=s.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bz(H);const $=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;H[8]=2*-t.x/this.width,H[9]=2*(t.y+$)/this.height,this.skyboxMatrix=s.aB(k,H,k);const G=this.point,ee=G.x,X=G.y,ie=this.width%2/2,ce=this.height%2/2,de=Math.cos(this.angle),Te=Math.sin(this.angle),we=ee-Math.round(ee)+de*ie+Te*ce,Ee=X-Math.round(X)+de*ce+Te*ie,ve=new Float64Array(L);if(s.br(ve,ve,[we>.5?we-1:we,Ee>.5?Ee-1:Ee,0]),this.alignedProjMatrix=ve,L=s.bC(),s.cR(L,L,[this.width/2,-this.height/2,1]),s.br(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=s.bC(),s.cR(L,L,[1,-1,1]),s.br(L,L,[-1,-1,0]),s.cR(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=s.aB(new Float64Array(16),this.labelPlaneMatrix,D),this._calcFogMatrices(),this._distanceTileDataCache={},L=s.bl(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cU(this);const be=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.af(be,be,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,c=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,_=[t,t,r];s.c4(_,_,m),s.c4(c,c,-1),s.cV(c,c,_);const w=s.bC();s.br(w,w,c),s.cR(w,w,_),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,r,m)}_computeCameraPosition(t){const r=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,c=this._camera.forward(),m=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*r-t/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-c[0]*_,m.y/this.worldSize-c[1]*_,t/this.worldSize*this._centerAltitude-c[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),c=this._camera.position[2],m=t[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),m>0&&(_=Math.min((r-c)/m,1)),this._camera.position=s.bH([],this._camera.position,t,_),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,r=this._camera.forward(),{pitch:c,bearing:m}=this._camera.getPitchBearing(),_=s.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.an(this._maxPitch)),E=Math.max((t[2]-_)/Math.cos(c),w),R=this._zoomFromMercatorZ(E);s.bH(t,t,r,E),this._pitch=s.aA(c,s.an(this.minPitch),s.an(this.maxPitch)),this.angle=s.bT(m,-Math.PI,Math.PI),this._setZoom(s.aA(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let r=0,c=s.cK,m=0,_=1/0;for(;c-r>1e-6&&c>r;){const w=r+.5*(c-r),E=this.tileSize*Math.pow(2,w),R=this.getCameraToCenterDistance(this.projection,w,E),D=this.scaleZoom(R/(Math.max(0,t)*this.tileSize)),L=Math.abs(w-D);L<_&&(_=L,m=w),w<D?r=w:c=w}return m}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,r){const c=Math.min(t.x,r.x),m=Math.max(t.x,r.x),_=Math.min(t.y,r.y),w=Math.max(t.y,r.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new s.P(c,_),new s.P(m,w),new s.P(c,w),new s.P(m,_)],R=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const L of E){const F=this.pointRayIntersection(L);if(F.t<0)return!0;const k=this.rayIntersectionCoordinate(F);if(k.x<R||k.y<0||k.x>D||k.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(t,r){const c=s.ag(s.av([],this._camera.position,t)),m=this._zoomFromMercatorZ(c)+r;return c-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([r,c,m],_){const w=[r,c,m,1];s.aC(w,w,_);const E=w[3]=Math.max(w[3],1e-6);return w[0]/=E,w[1]/=E,w[2]/=E,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}}getCameraToCenterDistance(t,r=this.zoom,c=this.worldSize){const m=s.cN(t,r,this.width,this.height,1024),_=t.pixelSpaceConversion(this.center.lat,c,m);let w=.5/Math.tan(.5*this._fov)*this.height*_;return this.isOrthographic&&(w=s.ak(1,w,s.c$(this.pitch>=ql?1:this.pitch/ql))),w}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.aB(t,t,this.globeMatrix),t}getFrustum(t){return s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const zc=(u,t)=>{if(t>0&&u.terrain&&s.w("Cutoff is currently disabled on terrain"),t<=0||u.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const r=u.transform,c=Math.max(Math.abs(r._zoom-(u.minCutoffZoom-1)),1),m=r.isLODDisabled(!1)?s.ah(60,45,r.pitch):s.ah(30,15,r.pitch),_=r._farZ-r._nearZ,w=t*r.height,E=((1-(R=m))*r.cameraToCenterDistance+R*(r._farZ+w))*c;var R;return{shouldRenderCutoff:m<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(E-r._nearZ)/_,(E-w-r._nearZ)/_]}}},Os={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Ua{constructor(t,r){this.aabb=t,this.lastCascade=r}}class Gl{add(t,r){const c=this.receivers[t.key];c!==void 0?(c.aabb.min[0]=Math.min(c.aabb.min[0],r.min[0]),c.aabb.min[1]=Math.min(c.aabb.min[1],r.min[1]),c.aabb.min[2]=Math.min(c.aabb.min[2],r.min[2]),c.aabb.max[0]=Math.max(c.aabb.max[0],r.max[0]),c.aabb.max[1]=Math.max(c.aabb.max[1],r.max[1]),c.aabb.max[2]=Math.max(c.aabb.max[2],r.max[2])):this.receivers[t.key]=new Ua(r,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,r,c){const m=s.d8.fromPoints(t.points);let _=0;for(const w in this.receivers){const E=this.receivers[w];if(!E||!m.intersectsAabb(E.aabb))continue;E.aabb.min=m.closestPoint(E.aabb.min),E.aabb.max=m.closestPoint(E.aabb.max);const R=E.aabb.getCorners();for(let D=0;D<c.length;D++){let L=!0;for(const F of R){const k=[F[0]*r,F[1]*r,F[2]];if(s.af(k,k,c[D].matrix),k[0]<-1||k[0]>1||k[1]<-1||k[1]>1){L=!1;break}}if(E.lastCascade=D,_=Math.max(_,D),L)break}}return _+1}}class km{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Gl,this._depthMode=new ni(t.context.gl.LEQUAL,ni.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(Os,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Os,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Os,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,r){const c=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const m=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||m<=0||(this._shadowLayerCount=c.style.order.reduce(($,G)=>{const ee=c.style._mergedLayers[G];return $+(ee.hasShadowPass()&&!ee.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const _=c.context,w=Os.shadowMapResolution,E=Os.shadowMapResolution;if(this._cascades.length===0||Os.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let $=0;$<Os.cascadeCount;++$){const G=c._shadowMapDebug,ee=_.gl,X=_.createFramebuffer(w,E,G,"texture"),ie=new s.T(_,{width:w,height:E,data:null},ee.DEPTH_COMPONENT16);if(X.depthAttachment.set(ie.texture),G){const ce=new s.T(_,{width:w,height:E,data:null},ee.RGBA8);X.colorAttachment.set(ce.texture)}this._cascades.push({framebuffer:X,texture:ie,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cA,scale:0})}}this.shadowDirection=xu(r);let R=0;if(t.elevation){const $=t.elevation,G=[1e4,-1e4];$.visibleDemTiles.filter(ee=>ee.dem).forEach(ee=>{const X=ee.dem.tree;G[0]=Math.min(G[0],X.minimums[0]),G[1]=Math.max(G[1],X.maximums[0])}),G[0]!==1e4&&(R=(G[1]-G[0])*$.exaggeration())}const D=1.5*t.cameraToCenterDistance,L=3*D,F=new Float64Array(16);for(let $=0;$<this._cascades.length;++$){const G=this._cascades[$];let ee=t.height/50,X=1;Os.cascadeCount===1?X=L:$===0?X=D:(ee=D,X=L);const[ie,ce]=Cp(t,this.shadowDirection,ee,X,Os.shadowMapResolution,R);G.scale=t.scale,G.matrix=ie,G.boundingSphereRadius=ce,s.bl(F,G.matrix),G.frustum=s.cA.fromInvProjectionMatrix(F,1,0,!0),G.far=X}const k=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[k].far,this._cascades[k].far],this._uniformValues.u_shadow_intensity=m,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Os.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Os.shadowMapResolution,this._uniformValues.u_shadowmap_0=$r.ShadowMap0,this._uniformValues.u_shadowmap_1=$r.ShadowMap0+1,this._groundShadowTiles=c.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const H=c.transform.elevation;for(const $ of this._groundShadowTiles){let G={min:0,max:0};if(H){const ee=H.getMinMaxForTile($);ee&&(G=ee)}this.addShadowReceiver($.toUnwrapped(),G.min,G.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,r){if(!this.enabled)return;const c=this.painter,m=c.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(c.transform.getFrustum(0),c.transform.worldSize,this._cascades),m.viewport.set([0,0,Os.shadowMapResolution,Os.shadowMapResolution]);for(let _=0;_<this._numCascadesToRender;++_){c.currentShadowCascade=_,m.bindFramebuffer.set(this._cascades[_].framebuffer.framebuffer),m.clear({color:s.ao.white,depth:1});for(const w of t.order){const E=t._mergedLayers[w];if(!E.hasShadowPass()||E.isHidden(c.transform.zoom))continue;const R=t.getLayerSourceCache(E),D=R?r[R.id]:void 0;(E.type==="model"||D&&D.length)&&c.renderLayer(c,R,E,D)}}c.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,r=t.style,c=t.context,m=c.gl,_=r.directionalLight,w=r.ambientLight;if(!_||!w)return;const E=[],R=zc(t,t.longestCutoffRange);R.shouldRenderCutoff&&E.push("RENDER_CUTOFF"),E.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&E.push("NORMAL_OFFSET");const D=bo(r,_,w),L=new ni(m.LEQUAL,ni.ReadOnly,t.depthRangeFor3D),F=new Ci({func:m.EQUAL,mask:255},0,255,m.KEEP,m.KEEP,m.KEEP);for(const k of this._groundShadowTiles){const H=k.toUnwrapped(),$=t.isTileAffectedByFog(k),G=t.getOrCreateProgram("groundShadow",{defines:E,overrideFog:$});this.setupShadows(H,G),t.uploadCommonUniforms(c,G,H,null,R);const ee={u_matrix:t.transform.calculateProjMatrix(H),u_ground_shadow_factor:D};G.draw(t,m.TRIANGLES,L,F,tn.multiply,Ni.disabled,ee,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?tn.unblended:tn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const r=this.painter.transform,c=r.calculatePosMatrix(t,r.worldSize);return s.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,c),Float32Array.from(c)}calculateShadowPassMatrixFromMatrix(t){return s.aB(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,r,c){if(!this.enabled)return;const m=this.painter.transform,_=this.painter.context,w=_.gl,E=this._uniformValues,R=new Float64Array(16),D=m.calculatePosMatrix(t,m.worldSize);for(let L=0;L<this._cascades.length;L++)s.aB(R,this._cascades[L].matrix,D),E[L===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),_.activeTexture.set(w.TEXTURE0+$r.ShadowMap0+L),this._cascades[L].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=!!c,this.useNormalOffset){const L=s.d6(t.canonical),F=2/m.tileSize*s.al/Os.shadowMapResolution,k=F*this._cascades[0].boundingSphereRadius,H=F*this._cascades[this._cascades.length-1].boundingSphereRadius,$=(c==="vector-tile"?1:3)*function(G,ee,X,ie,ce){const de=s.aA((G-22)/-22,0,1);return .125*(1-de)+4*de}(m.zoom);E.u_shadow_normal_offset=[L,k*$,H*$],E.u_shadow_bias=[1e-4,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(_,E)}setupShadowsFromMatrix(t,r,c=!1){if(!this.enabled)return;const m=this.painter.context,_=m.gl,w=this._uniformValues,E=new Float64Array(16);for(let R=0;R<Os.cascadeCount;R++)s.aB(E,this._cascades[R].matrix,t),w[R===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),m.activeTexture.set(_.TEXTURE0+$r.ShadowMap0+R),this._cascades[R].texture.bindExtraParam(_.LINEAR,_.LINEAR,_.CLAMP_TO_EDGE,_.CLAMP_TO_EDGE,_.GREATER);if(this.useNormalOffset=c,c){const R=Os.normalOffset;w.u_shadow_normal_offset=[1,R,R],w.u_shadow_bias=[6e-5,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(m,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,r,c,m){if(m[2]>=0)return{};const _=function(R,D,L){const F=L/(1<<R.canonical.z);return new s.d8([R.canonical.x*F+R.wrap*L,R.canonical.y*F+R.wrap*L,0],[(R.canonical.x+1)*F+R.wrap*L,(R.canonical.y+1)*F+R.wrap*L,D])}(t,r,c).getCorners(),w=r/-m[2];m[0]<0?(s.d7(_[0],_[0],[m[0]*w,0,0]),s.d7(_[3],_[3],[m[0]*w,0,0])):m[0]>0&&(s.d7(_[1],_[1],[m[0]*w,0,0]),s.d7(_[2],_[2],[m[0]*w,0,0])),m[1]<0?(s.d7(_[0],_[0],[0,m[1]*w,0]),s.d7(_[1],_[1],[0,m[1]*w,0])):m[1]>0&&(s.d7(_[2],_[2],[0,m[1]*w,0]),s.d7(_[3],_[3],[0,m[1]*w,0]));const E={};return E.vertices=_,E.planes=[gd(_[1],_[0],_[4]),gd(_[2],_[1],_[5]),gd(_[3],_[2],_[6]),gd(_[0],_[3],_[7])],E}addShadowReceiver(t,r,c){this._receivers.add(t,s.d8.fromTileIdAndHeight(t,r,c))}getMaxCascadeForTile(t){const r=this._receivers.get(t);return r&&r.lastCascade?r.lastCascade:0}}function gd(u,t,r){const c=s.av([],r,t),m=s.av([],u,t),_=s.bI([],c,m),w=s.ag(_);return w===0?[0,0,1,0]:(s.c4(_,_,1/w),[_[0],_[1],_[2],-s.bJ(_,t)])}function xu(u){const t=u.properties.get("direction"),r=s.d3(t.x,t.y,t.z);r[2]=s.aA(r[2],0,75);const c=s.d5([r[0],r[1],r[2]]);return s.d4(c.x,c.y,c.z)}function bo(u,t,r){const c=t.properties.get("color-use-theme")==="none",m=t.properties.get("color"),_=t.properties.get("intensity"),w=t.properties.get("direction"),E=[w.x,w.y,w.z],R=r.properties.get("color-use-theme")==="none",D=r.properties.get("color"),L=r.properties.get("intensity"),F=Math.max(s.bJ([0,0,1],E),0),k=[0,0,0];s.c4(k,D.toPremultipliedRenderColor(R?null:u.getLut(t.scope)).toArray01Linear().slice(0,3),L);const H=[0,0,0];return s.c4(H,m.toPremultipliedRenderColor(c?null:u.getLut(r.scope)).toArray01Linear().slice(0,3),F*_),s.da([k[0]>0?k[0]/(k[0]+H[0]):0,k[1]>0?k[1]/(k[1]+H[1]):0,k[2]>0?k[2]/(k[2]+H[2]):0])}function Cp(u,t,r,c,m,_){const w=u.zoom,E=u.scale,R=u.worldSize,D=1/R,L=u.aspect,F=Math.sqrt(1+L*L)*Math.tan(.5*u.fovX),k=F*F,H=c-r,$=c+r;let G,ee;k>H/$?(G=c,ee=c*F):(G=.5*$*(1+k),ee=.5*Math.sqrt(H*H+2*(c*c+r*r)*k+$*$*k*k));const X=u.projection.pixelsPerMeter(u.center.lat,R),ie=u._camera.getCameraToWorldMercator(),ce=[0,0,-G*D];s.af(ce,ce,ie);let de=ee*D;const Te=u._edgeInsets;if(!(Te.left===0&&Te.top===0&&Te.right===0&&Te.bottom===0||Te.left===Te.right&&Te.top===Te.bottom)){const ht=u._camera.getWorldToCamera(u.worldSize,u.projection.zAxisUnit==="meters"?X:1),_t=u._camera.getCameraToClipPerspective(u._fov,u.width/u.height,r,c);_t[8]=2*-u.centerOffset.x/u.width,_t[9]=2*u.centerOffset.y/u.height;const qt=new Float64Array(16);s.cO(qt,_t,ht);const Ct=new Float64Array(16);s.bl(Ct,qt);const Tt=s.cA.fromInvProjectionMatrix(Ct,R,w,!0);for(const gi of Tt.points){const oi=((we=gi)[0]/=E,we[1]/=E,we[2]=s.ce(we[2],u._center.lat),we);de=Math.max(de,s.c5(s.d9([],ce,oi)))}}var we;de*=m/(m-1);const Ee=Math.acos(t[2]),ve=Math.atan2(-t[0],-t[1]),be=new md;be.position=ce,be.setPitchBearing(Ee,ve);const Ce=be.getWorldToCamera(R,X),We=de*R,je=Math.min(u._mercatorZfromZoom(17)*R*-2,-2*We),ct=be.getCameraToClipOrthographic(-We,We,-We,We,je,(We+_*X)/t[2]),Ze=new Float64Array(16);s.aB(Ze,ct,Ce);const ot=s.d4(Math.floor(1e6*ce[0])/1e6*R,Math.floor(1e6*ce[1])/1e6*R,0),jt=.5*m,Ye=[0,0,0];s.af(Ye,ot,Ze),s.c4(Ye,Ye,jt);const Oe=[Math.floor(Ye[0]),Math.floor(Ye[1]),Math.floor(Ye[2])],nt=[0,0,0];s.av(nt,Ye,Oe),s.c4(nt,nt,-1/jt);const Ge=new Float64Array(16);return s.bA(Ge),s.br(Ge,Ge,nt),s.aB(Ze,Ge,Ze),[Ze,We]}class mh extends s.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,r){return s.aV(this.requestManager.transformRequest(r,s.R.Model).url).then(c=>{if(!c)return;const m=s.aW(c),_=new s.aX(t,void 0,void 0,m);return _.computeBoundsAndApplyParent(),_}).catch(c=>{if(c&&c.status===404)return null;this.fire(new s.y(new Error(`Could not load model ${t} from ${r}: ${c.message}`)))})}load(t,r,c={forceReload:!1}){this.models[r]||(this.models[r]={});const m=Object.keys(t),_=[],w=[];for(const E of m){const R=t[E];this.hasURLBeenRequested(R)&&!c.forceReload||(this.modelByURL[R]={modelId:E,scope:r},_.push(this.loadModel(E,R)),w.push(E)),this.models[r][E]||(this.models[r][E]={model:null,numReferences:1})}this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+w.length,Promise.allSettled(_).then(E=>{for(let R=0;R<E.length;R++){const{status:D}=E[R];if(D==="rejected")continue;const{value:L}=E[R];this.models[r][w[R]]||(this.models[r][w[R]]={model:null,numReferences:1}),this.models[r][w[R]].model=L}this.numModelsLoading[r]-=w.length,this.fire(new s.z("data",{dataType:"style"}))}).catch(E=>{this.fire(new s.y(new Error(`Could not load models: ${E.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,r,c={exactIdMatch:!1}){return!!(c.exactIdMatch?this.getModel(t,r):this.getModelByURL(this.modelUris[r][t]))}getModel(t,r){return this.models[r]||(this.models[r]={}),this.models[r][t]?this.models[r][t].model:void 0}getModelByURL(t){if(!t)return null;const r=this.modelByURL[t];return r?this.models[r.scope][r.modelId].model:null}hasModelBeenAdded(t,r){return this.models[r]&&this.models[r][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,r,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const m=this.requestManager.normalizeModelURL(r);if((this.hasModel(t,c,{exactIdMatch:!0})||this.hasModelBeenAdded(t,c))&&this.modelUris[c][t]===m)this.models[c][t].numReferences++;else if(this.hasURLBeenRequested(m)){const{scope:_,modelId:w}=this.modelByURL[m];this.models[_][w].numReferences++}else this.modelUris[c][t]=m,this.load({[t]:this.modelUris[c][t]},c)}addModelURLs(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const c=this.modelUris[r];for(const m in t)c[m]=this.requestManager.normalizeModelURL(t[m])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const c={};for(const m of t)this.hasModel(m,r,{exactIdMatch:!0})||this.hasURLBeenRequested(m)?this.models[r][m].numReferences++:this.modelUris[r][m]&&!this.hasURLBeenRequested(m)?c[m]=this.modelUris[r][m]:!this.hasURLBeenRequested(m)&&s.db(m,!1)&&(this.modelUris[r][m]=this.requestManager.normalizeModelURL(m),c[m]=this.modelUris[r][m]);this.load(c,r)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,r,c=!1,m=!1){if(this.models[r]&&this.models[r][t]&&(this.models[r][t].numReferences--,this.models[r][t].numReferences===0||m)){const _=this.modelUris[r][t];c||delete this.modelUris[r][t],delete this.modelByURL[_];const w=this.models[r][t].model;if(!w)return;delete this.models[r][t],w.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const r of Object.keys(this.models[t])){const c=this.models[t][r].model;delete this.models[t][r],c&&c.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,r){this.models[r]||(this.models[r]={});for(const c in this.models[r])this.models[r][c].model&&this.models[r][c].model.upload(t.context)}}const Nm=new s.a9({data:new s.aa(s.a6.colorTheme.data)});function $l(u){if(!u.metadata||!u.metadata.content_area)return;const t=s.o.devicePixelRatio,{left:r,top:c,width:m,height:_}=u.metadata.content_area,w=r*t,E=c*t;return[w,E,w+m*t,E+_*t]}function gh(u){if(u)return u.map(([t,r])=>[t*s.o.devicePixelRatio,r*s.o.devicePixelRatio])}class wo{constructor(t,r,c){this.id=t,this.scope=r,this.sourceCache=c,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const r=this.sourceCache.getVisibleCoordinates();if(r.length===0)return t;const c=this.sourceCache.getSource();if(!(c instanceof Ll))return t;const m=r.map(w=>this.sourceCache.getTile(w)),_=c.getImages(m,Array.from(this.pendingRequests));for(const[w,E]of _)t.set(s.I.from({name:w,iconsetId:this.id}),E),this.pendingRequests.delete(w);for(const w of this.pendingRequests)this.missingRequests.add(w);return this.pendingRequests.clear(),t}}const Zl=(u,t)=>Ie(u,t&&t.filter(r=>r.identifier!=="source.canvas")),jm=s.aH(wn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),vu=s.aH(wn,["setCenter","setZoom","setBearing","setPitch"]),Wl=new Set(["background","sky","slot","custom"]),vf={version:8,layers:[],sources:{}},_d={duration:300,delay:0};class Vs extends s.E{constructor(t,r={}){super(),this.map=t,this.scope=r.scope||"",this.globalId=null,this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=Object.assign({},_d),this._buildingIndex=new uh(this),this.crossTileSymbolIndex=new fs,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=r.styleChanges||new Mn,this.dispatcher=r.dispatcher?r.dispatcher:new s.D(s.dd(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new In(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new s.de(t._requestManager,r.localFontFamily?s.df.all:r.localIdeographFontFamily?s.df.ideographs:s.df.none,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new mh(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=r.configOptions?r.configOptions:new Map,this._configDependentLayers=r.configDependentLayers?r.configDependentLayers:new Set,this._config=r.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:r.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=r.initialConfig,this.dispatcher.broadcast("setReferrer",s.dg());const c=this;this._rtlTextPluginCallback=Vs.registerForPluginStateChange(m=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(_,w)=>{if(s.dh(_),w&&w.every(E=>E))for(const E in c._sourceCaches){const R=c._sourceCaches[E],D=R.getSource().type;D!=="vector"&&D!=="geojson"||R.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const _=this.getOwnSource(m.sourceId);if(_&&_.vectorLayerIds)for(const w in this._layers){const E=this._layers[w];E.source===_.id&&this._validateLayer(E)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(s.h(t))return t;const r=s.di(t);if(!r.startsWith("http"))try{return new URL(r,location.href).toString()}catch{return r}return r}return`json://${s.dj(JSON.stringify(t))}`}_diffStyle(t,r,c){this.globalId=this._getGlobalId(t);const m=(_,w)=>{try{w(null,this.setState(_,c))}catch(E){w(E,!1)}};if(typeof t=="string"){const _=this.map._requestManager.normalizeStyleURL(t),w=this.map._requestManager.transformRequest(_,s.R.Style);s.m(w,(E,R)=>{E?this.fire(new s.y(E)):R&&m(R,r)})}else typeof t=="object"&&m(t,r)}loadURL(t,r={}){this.fire(new s.z("dataloading",{dataType:"style"}));const c=typeof r.validate=="boolean"?r.validate:!s.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,r.accessToken),this.resolvedImports.add(t);const m=this.importsCache.get(t);if(m)return this._load(m,c);const _=this.map._requestManager.transformRequest(t,s.R.Style);this._request=s.m(_,(w,E)=>{if(this._request=null,w)this.fire(new s.y(w));else if(E)return this.importsCache.set(t,E),this._load(E,c)})}loadJSON(t,r={}){this.fire(new s.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=s.o.frame(()=>{this._request=null,this._load(t,r.validate!==!1)})}loadEmpty(){this.fire(new s.z("dataloading",{dataType:"style"})),this._load(vf,!1)}_loadImports(t,r,c){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const m=[];for(const _ of t){const w=this._createFragmentStyle(_),E=new Promise(L=>{w.once("style.import.load",L),w.once("error",L)}).then(()=>this.mergeAll());if(m.push(E),this.resolvedImports.has(_.url)){w.loadEmpty();continue}const R=_.data||this.importsCache.get(_.url);R?(w.loadJSON(R,{validate:r}),this._isInternalStyle(R)&&(w.globalId=null)):_.url?w.loadURL(_.url,{validate:r}):w.loadEmpty();const D={style:w,id:_.id,config:_.config};if(c){const L=this.fragments.findIndex(({id:F})=>F===c);this.fragments=this.fragments.slice(0,L).concat(D).concat(this.fragments.slice(L))}else this.fragments.push(D)}return Promise.allSettled(m)}getImportGlobalIds(t=this,r=new Set){for(const c of t.fragments)c.style.globalId&&r.add(c.style.globalId),this.getImportGlobalIds(c.style,r);return[...r.values()]}_createFragmentStyle(t){const r=this.scope?s.B(t.id,this.scope):t.id;let c;const m=this._initialConfig&&this._initialConfig[r];(t.config||m)&&(c=Object.assign({},t.config,m));const _=new Vs(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:c,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return _.setEventedParent(this.map,{style:_}),_}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,r){if(this._isInternalStyle(t)){const _=Object.assign({},vf,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(_,r)}if(this.updateConfig(this._config,t.schema),r&&Zl(this,ds(t)))return;this._loaded=!0,this.stylesheet=s.dk(t);const c=()=>{for(const R in t.sources)this.addSource(R,t.sources[R],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const R in t.iconsets)this.addIconset(R,t.iconsets[R]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const _=Rc(this.stylesheet.layers);if(this._order=_.map(R=>R.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const R=this.stylesheet.lights[0];this.light=new Be(R.properties,R.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Be(this.stylesheet.light)),this._layers={};for(const R of _){const D=s.dq(R,this.scope,this._styleColorTheme.lut,this.options);D.configDependencies.size!==0&&this._configDependentLayers.add(D.fqid),D.setEventedParent(this,{layer:{id:D.id}}),this._layers[D.id]=D;const L=this.getOwnLayerSourceCache(D),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();L&&D.canCastShadows()&&F&&(L.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const w=this.stylesheet.terrain;w&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(w,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.z("data",{dataType:"style"}));const E=this.isRootStyle();t.imports?this._loadImports(t.imports,r).then(()=>{this._reloadImports(),this.fire(new s.z(E?"style.load":"style.import.load"))}).catch(R=>{this.fire(new s.y(new Error("Failed to load imports",R))),this.fire(new s.z(E?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.z(E?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const m=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(m){const _=this._evaluateColorThemeData(m);this._loadColorTheme(_).then(()=>{c()}).catch(w=>{s.w(`Couldn't load color theme from the stylesheet: ${w}`),c()})}else this._styleColorTheme.lut=null,c()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,r,c,m,_,w,E,R,D,L;const F={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(k=>{if(k.stylesheet){if(k.light!=null&&(t=k.light),k.stylesheet.lights)for(const H of k.stylesheet.lights)H.type==="ambient"&&k.ambientLight!=null&&(r=k.ambientLight),H.type==="directional"&&k.directionalLight!=null&&(c=k.directionalLight);m=this._prioritizeTerrain(m,k.terrain,k.stylesheet.terrain),k.stylesheet.fog&&k.fog!=null&&(_=k.fog),k.stylesheet.snow&&k.snow!=null&&(w=k.snow),k.stylesheet.rain&&k.rain!=null&&(E=k.rain),k.stylesheet.camera!=null&&(L=k.stylesheet.camera),k.stylesheet.projection!=null&&(R=k.stylesheet.projection),k.stylesheet.transition!=null&&(D=k.stylesheet.transition),F[k.scope]=k._styleColorTheme}}),this.light=t,this.ambientLight=r,this.directionalLight=c,this.fog=_,this.snow=w,this.rain=E,this._styleColorThemeForScope=F,m===null?delete this.terrain:this.terrain=m,this.camera=L||{"camera-projection":"perspective"},this.projection=R||{name:"mercator"},this.transition=Object.assign({},_d,D),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const r=c=>{for(const m of c.fragments)r(m.style);t(c)};r(this)}_prioritizeTerrain(t,r,c){const m=t&&t.drapeRenderMode===0;return c===null?r&&r.drapeRenderMode===0?r:m?t:null:r!=null&&(!t||m||r&&r.drapeRenderMode===1)?r:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(r=>{t=this._prioritizeTerrain(t,r.terrain,r.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(r=>{r.stylesheet.projection!=null&&(t=r.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},r={},c={};this.forEachFragmentStyle(m=>{for(const _ in m._sourceCaches){const w=s.B(_,m.scope);t[w]=m._sourceCaches[_]}for(const _ in m._otherSourceCaches){const w=s.B(_,m.scope);r[w]=m._otherSourceCaches[_]}for(const _ in m._symbolSourceCaches){const w=s.B(_,m.scope);c[w]=m._symbolSourceCaches[_]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=c}mergeLayers(){const t={},r=[],c={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(const E of w._order){const R=w._layers[E];if(R.type==="slot"){const D=s.dl(E);if(t[D])continue;t[D]=[]}R.slot&&t[R.slot]?t[R.slot].push(R):r.push(R)}}),this._mergedOrder=[];let m=-1;const _=(w=[])=>{for(const E of w)if(E.type==="slot"){const R=s.dl(E.id);t[R]&&_(t[R]),this._mergedSlots.push(R)}else{const R=s.B(E.id,E.scope);this._mergedOrder.push(R),c[R]=E,E.is3D(!!this.terrain)&&(this._has3DLayers=!0,m=this._mergedOrder.length-1),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0),E.type==="clip"&&(this._clipLayerPresent=!0)}};if(_(r),this._has3DLayers){const w={};for(let E=0;E<this._mergedOrder.length;++E){const R=this._mergedOrder[E];w[R]=E===m?1:E<m?c[R].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((E,R)=>w[E]-w[R])}this._mergedLayers=c,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(r,c,m,_){const w=Object.assign({},c);for(const R of Object.keys(s.a6.colorTheme))w[R]===void 0&&(w[R]=s.a6.colorTheme[R].default);const E=new s.a8(Nm,r,new Map(m));return E.setTransitionOrValue(w,m),E.untransitioned().possiblyEvaluate(new s.ac(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const r=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((c,m)=>{const _="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void c();let w=t;w.startsWith(_)||(w=_+w);const E=s.I.from("mapbox-reserved-lut"),R=new Image;R.src=w,R.onerror=()=>{this._styleColorTheme.lutLoading=!1,m(new Error("Failed to load image data"))},R.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==r)return void c();this._styleColorTheme.lutLoading=!1;const{width:D,height:L,data:F}=s.o.getImageData(R);if(L>32)return void m(new Error("The height of the image must be less than or equal to 32 pixels."));if(D!==L*L)return void m(new Error("The width of the image must be equal to the height squared."));this.getImage(E)&&this.removeImage(E),this.addImage(E,{data:new s.q({width:D,height:L},F),pixelRatio:1,sdf:!1,usvg:!1,version:0});const k=this.imageManager.getImage(E,this.scope);k?(this._styleColorTheme.lut={image:k.data,data:t},c()):m(new Error("Missing LUT image."))}})}getLut(t){const r=this._styleColorThemeForScope[t];return r?r.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(r,c,m){let _,w,E;const R=s.o.devicePixelRatio>1?"@2x":"";let D=s.m(c.transformRequest(c.normalizeSpriteURL(r,R,".json"),s.R.SpriteJSON),(k,H)=>{D=null,E||(E=k,_=H,F())}),L=s.n(c.transformRequest(c.normalizeSpriteURL(r,R,".png"),s.R.SpriteImage),(k,H)=>{L=null,E||(E=k,w=H,F())});function F(){if(E)m(E);else if(_&&w){const k=s.o.getImageData(w),H={};for(const $ in _){const{width:G,height:ee,x:X,y:ie,sdf:ce,pixelRatio:de,stretchX:Te,stretchY:we,content:Ee}=_[$],ve=new s.q({width:G,height:ee});s.q.copy(k,ve,{x:X,y:ie},{x:0,y:0},{width:G,height:ee},null),H[$]={data:ve,pixelRatio:de!==void 0?de:1,sdf:ce!==void 0&&ce,stretchX:Te,stretchY:we,content:Ee,usvg:!1,version:0}}m(null,H)}}return{cancel(){D&&(D.cancel(),D=null),L&&(L.cancel(),L=null)}}}(t,this.map._requestManager,(r,c)=>{if(this._spriteRequest=null,r)this.fire(new s.y(r));else if(c){const m=new Map;for(const _ in c)m.set(s.I.from(_),c[_]);this.addImages(m)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))})}addIconset(t,r){if(r.type==="sprite")return void this._loadSprite(r.url);const c=this.getOwnSourceCache(r.source);if(!c)return void this.fire(new s.y(new Error(`Source "${r.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const m=c.getSource();if(m.type!=="raster-array")return void this.fire(new s.y(new Error(`Source "${r.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));m.partial=!1;const _=new wo(t,this.scope,c);this.imageManager.addImageProvider(_,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!s.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const r=this.map._spriteFormat==="auto";var c,m;this._spriteRequest=(m=(_,w)=>{if(this._spriteRequest=null,_)r?this._loadSprite(t):this.fire(new s.y(_));else if(w){const E=new Map;for(const R in w)E.set(s.I.from(R),w[R]);this.addImages(E)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))},s.bu((c=this.map._requestManager).transformRequest(c.normalizeIconsetURL(t),s.R.Iconset),(_,w)=>{if(_)return void m(_);const E={},R=s.dc(new s.bt(w));for(const D of R.icons){const L={version:1,pixelRatio:s.o.devicePixelRatio,content:$l(D),stretchX:D.metadata?gh(D.metadata.stretch_x_areas):void 0,stretchY:D.metadata?gh(D.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:D};E[D.name]=L}m(null,E)}))}_validateLayer(t){const r=this.getOwnSource(t.source);if(!r)return;const c=t.sourceLayer;c&&(r.type==="geojson"||r.vectorLayerIds&&r.vectorLayerIds.indexOf(c)===-1)&&this.fire(new s.y(new Error(`Source layer "${c}" does not exist on source "${r.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,r)=>{const c=this.fragments[r];return c&&c.style&&(t.data=c.style.serialize()),t})}_serializeSources(){const t={};for(const r in this._sourceCaches){const c=this._sourceCaches[r].getSource();t[c.id]||(t[c.id]=c.serialize())}return t}_serializeLayers(t){const r=[];for(const c of t){const m=this._layers[c];m&&m.type!=="custom"&&r.push(m.serialize())}return r}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const r=this.getOwnLayer(t);if(r)return r;this.fire(new s.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const r=this.getOwnSource(t);if(r)return r;this.fire(new s.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,r){const c=this.map.painter;if(c)for(let m=t.minzoom||0;m<(t.maxzoom||25.5);m++){const _=t.getProgramIds();if(_)for(const w of _){const E=t.getDefaultProgramParams(w,r.zoom,this._styleColorTheme.lut);E&&(c.style=this,this.fog&&(c._fogVisible=!0,E.overrideFog=!0,c.getOrCreateProgram(w,E)),c._fogVisible=!1,E.overrideFog=!1,c.getOrCreateProgram(w,E),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(E.overrideRtt=!0,c.getOrCreateProgram(w,E)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const r=this.calculateLightsBrightness();t.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const c=this._changes.isDirty();let m=!1;if(this._changes.isDirty()){const E=this._changes.getLayerUpdatesByScope();for(const R in E){const{updatedIds:D,removedIds:L}=E[R];(D||L)&&(this._updateWorkerLayers(R,D,L),m=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const _={};for(const E in this._mergedSourceCaches){const R=this._mergedSourceCaches[E];_[E]=R.used,R.used=!1,R.tileCoverLift=0}for(const E of this._mergedOrder){const R=this._mergedLayers[E];if(R.recalculate(t,this._availableImages),!R.isHidden(t.zoom)){const D=this.getLayerSourceCache(R);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,R.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(R,t)}):this.precompilePrograms(R,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&m&&this.mergeLayers();const w=this.imageManager.getPendingImageProviders();for(const E of w)E.sourceCache.used=!0;for(const E in _){const R=this._mergedSourceCaches[E];_[E]!==R.used&&R.getSource().fire(new s.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:R.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),c&&this.fire(new s.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const r of t){const c=r.resolvePendingRequests(),m=this.getFragmentStyle(r.scope);m&&m.addImages(c)}}_updateTilesForChangedImages(){const t={};for(const r in this._mergedSourceCaches){const c=this._mergedSourceCaches[r].getSource().scope;t[c]=t[c]||this._changes.getUpdatedImages(c),t[c].length!==0&&this._mergedSourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t[c])}for(const r in t)this._changes.resetUpdatedImages(r)}_updateWorkerLayers(t,r,c){const m=this.getFragmentStyle(t);m&&this.dispatcher.broadcast("updateLayers",{layers:r?m._serializeLayers(r):[],scope:t,removedIds:c||[],options:m.options})}setState(t,r){if(this._checkLoaded(),Zl(this,ds(t)))return!1;(t=s.dk(t)).layers=Rc(t.layers);const c=function(w,E){if(!w)return[{command:wn.setStyle,args:[E]}];let R=[];try{if(!s.by(w.version,E.version))return[{command:wn.setStyle,args:[E]}];if(s.by(w.center,E.center)||R.push({command:wn.setCenter,args:[E.center]}),s.by(w.zoom,E.zoom)||R.push({command:wn.setZoom,args:[E.zoom]}),s.by(w.bearing,E.bearing)||R.push({command:wn.setBearing,args:[E.bearing]}),s.by(w.pitch,E.pitch)||R.push({command:wn.setPitch,args:[E.pitch]}),s.by(w.sprite,E.sprite)||R.push({command:wn.setSprite,args:[E.sprite]}),s.by(w.glyphs,E.glyphs)||R.push({command:wn.setGlyphs,args:[E.glyphs]}),s.by(w.imports,E.imports)||function(H=[],$=[],G){$=$||[];const ee=(H=H||[]).map(jl),X=$.map(jl),ie=H.reduce(Mc,{}),ce=$.reduce(Mc,{}),de=ee.slice();let Te,we,Ee,ve;for(Te=0,we=0;Te<ee.length;Te++)Ee=ee[Te],ce.hasOwnProperty(Ee)?we++:(G.push({command:wn.removeImport,args:[Ee]}),de.splice(de.indexOf(Ee,we),1));for(Te=0,we=0;Te<X.length;Te++)Ee=X[X.length-1-Te],de[de.length-1-Te]!==Ee&&(ie.hasOwnProperty(Ee)?(G.push({command:wn.removeImport,args:[Ee]}),de.splice(de.lastIndexOf(Ee,de.length-we),1)):we++,ve=de[de.length-Te],G.push({command:wn.addImport,args:[ce[Ee],ve]}),de.splice(de.length-Te,0,Ee));for(const be of $){const Ce=ie[be.id];Ce&&(delete Ce.data,s.by(Ce,be)||G.push({command:wn.updateImport,args:[be.id,be]}))}}(w.imports,E.imports,R),s.by(w.transition,E.transition)||R.push({command:wn.setTransition,args:[E.transition]}),s.by(w.light,E.light)||R.push({command:wn.setLight,args:[E.light]}),s.by(w.fog,E.fog)||R.push({command:wn.setFog,args:[E.fog]}),s.by(w.snow,E.snow)||R.push({command:wn.setSnow,args:[E.snow]}),s.by(w.rain,E.rain)||R.push({command:wn.setRain,args:[E.rain]}),s.by(w.projection,E.projection)||R.push({command:wn.setProjection,args:[E.projection]}),s.by(w.lights,E.lights)||R.push({command:wn.setLights,args:[E.lights]}),s.by(w.camera,E.camera)||R.push({command:wn.setCamera,args:[E.camera]}),s.by(w.iconsets,E.iconsets)||function(H,$,G){let ee;for(ee in $=$||{},H=H||{})H.hasOwnProperty(ee)&&($.hasOwnProperty(ee)||G.push({command:wn.removeIconset,args:[ee]}));for(ee in $){if(!$.hasOwnProperty(ee))continue;const X=$[ee];H.hasOwnProperty(ee)?s.by(H[ee],X)||(G.push({command:wn.removeIconset,args:[ee]}),G.push({command:wn.addIconset,args:[ee,X]})):G.push({command:wn.addIconset,args:[ee,X]})}}(w.iconsets,E.iconsets,R),!s.by(w["color-theme"],E["color-theme"]))return[{command:wn.setStyle,args:[E]}];const D={},L=[];(function(H,$,G,ee){let X;for(X in $=$||{},H=H||{})H.hasOwnProperty(X)&&($.hasOwnProperty(X)||kl(X,G,ee));for(X in $){if(!$.hasOwnProperty(X))continue;const ie=$[X];H.hasOwnProperty(X)?s.by(H[X],ie)||(H[X].type==="geojson"&&ie.type==="geojson"&&uu(H,$,X)?G.push({command:wn.setGeoJSONSourceData,args:[X,ie.data]}):pf(X,$,G,ee)):cl(X,$,G)}})(w.sources,E.sources,L,D);const F=[];w.layers&&w.layers.forEach(H=>{H.source&&D[H.source]?R.push({command:wn.removeLayer,args:[H.id]}):F.push(H)});let k=w.terrain;k&&D[k.source]&&(R.push({command:wn.setTerrain,args:[void 0]}),k=void 0),R=R.concat(L),s.by(k,E.terrain)||R.push({command:wn.setTerrain,args:[E.terrain]}),function(H,$,G){$=$||[];const ee=(H=H||[]).map(jl),X=$.map(jl),ie=H.reduce(Mc,{}),ce=$.reduce(Mc,{}),de=ee.slice(),Te=Object.create(null);let we,Ee,ve,be,Ce,We,je;for(we=0,Ee=0;we<ee.length;we++)ve=ee[we],ce.hasOwnProperty(ve)?Ee++:(G.push({command:wn.removeLayer,args:[ve]}),de.splice(de.indexOf(ve,Ee),1));for(we=0,Ee=0;we<X.length;we++)ve=X[X.length-1-we],de[de.length-1-we]!==ve&&(ie.hasOwnProperty(ve)?(G.push({command:wn.removeLayer,args:[ve]}),de.splice(de.lastIndexOf(ve,de.length-Ee),1)):Ee++,We=de[de.length-we],G.push({command:wn.addLayer,args:[ce[ve],We]}),de.splice(de.length-we,0,ve),Te[ve]=!0);for(we=0;we<X.length;we++)if(ve=X[we],be=ie[ve],Ce=ce[ve],!Te[ve]&&!s.by(be,Ce))if(s.by(be.source,Ce.source)&&s.by(be["source-layer"],Ce["source-layer"])&&s.by(be.type,Ce.type)){for(je in Nl(be.layout,Ce.layout,G,ve,null,wn.setLayoutProperty),Nl(be.paint,Ce.paint,G,ve,null,wn.setPaintProperty),s.by(be.slot,Ce.slot)||G.push({command:wn.setSlot,args:[ve,Ce.slot]}),s.by(be.filter,Ce.filter)||G.push({command:wn.setFilter,args:[ve,Ce.filter]}),s.by(be.minzoom,Ce.minzoom)&&s.by(be.maxzoom,Ce.maxzoom)||G.push({command:wn.setLayerZoomRange,args:[ve,Ce.minzoom,Ce.maxzoom]}),be)be.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&je!=="slot"&&(je.indexOf("paint.")===0?Nl(be[je],Ce[je],G,ve,je.slice(6),wn.setPaintProperty):s.by(be[je],Ce[je])||G.push({command:wn.setLayerProperty,args:[ve,je,Ce[je]]}));for(je in Ce)Ce.hasOwnProperty(je)&&!be.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&je!=="slot"&&(je.indexOf("paint.")===0?Nl(be[je],Ce[je],G,ve,je.slice(6),wn.setPaintProperty):s.by(be[je],Ce[je])||G.push({command:wn.setLayerProperty,args:[ve,je,Ce[je]]}))}else G.push({command:wn.removeLayer,args:[ve]}),We=de[de.lastIndexOf(ve)+1],G.push({command:wn.addLayer,args:[Ce,We]})}(F,E.layers,R)}catch(D){console.warn("Unable to compute style diff:",D),R=[{command:wn.setStyle,args:[E]}]}return R}(this.serialize(),t).filter(w=>!(w.command in vu));if(c.length===0)return!1;const m=c.filter(w=>!(w.command in jm));if(m.length>0)throw new Error(`Unimplemented: ${m.map(w=>w.command).join(", ")}.`);const _=[];return c.forEach(w=>{_.push(this[w.command](...w.args))}),r&&Promise.all(_).then(r).catch(r),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[r,c]of t.entries()){if(this.getImage(r))return this.fire(new s.y(new Error(`An image with the name "${r.name}" already exists.`)));this.imageManager.addImage(r,this.scope,c),this._changes.updateImage(r,this.scope)}return this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this}addImage(t,r){return this.getImage(t)?this.fire(new s.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,r),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this)}updateImage(t,r,c=!1){this.imageManager.updateImage(t,this.scope,r),c&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new s.z("data",{dataType:"style"})),this}addModel(t,r,c={}){return this._checkLoaded(),this._validate(ke,`models.${t}`,r,null,c)||(this.modelManager.addModel(t,r,this.scope),this.fire(new s.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,r,c={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(Ur,`sources.${t}`,r,null,c))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const m=wc(t,r,this.dispatcher,this);m.scope=this.scope,m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(m.id),source:m.serialize(),sourceId:m.id}));const _=w=>{const E=(w?"symbol:":"other:")+m.id,R=s.B(E,this.scope),D=this._sourceCaches[E]=new Aa(R,m,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[m.id]=D,D.onAdd(this.map)};_(!1),r.type!=="vector"&&r.type!=="geojson"||_(!0),m.onAdd&&m.onAdd(this.map),c.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const r=this.getOwnSource(t);if(!r)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===t)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const m=Object.entries(this.stylesheet.iconsets).find(([_,w])=>w.type==="source"&&w.source===t);if(m)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while iconset "${m[0]}" is using it.`)))}const c=this.getOwnSourceCaches(t);for(const m of c){const _=s.dl(m.id);delete this._sourceCaches[_],this._changes.discardSourceCacheUpdate(m.id),m.fire(new s.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,r){this._checkLoaded(),this.getOwnSource(t).setData(r),this._changes.setDirty()}getOwnSource(t){const r=this.getOwnSourceCache(t);return r&&r.getSource()}getOwnSources(){const t=[];for(const r in this._otherSourceCaches){const c=this.getOwnSourceCache(r);c&&t.push(c.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const r in t){const c=t[r]._tiles;for(const m in c){const _=c[m];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const _ of t){if(this._validate(pa,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(_),w.updateTransitions(r)}else this.ambientLight=new Bt(_,cr||(cr=new s.a9({color:new s.aa(s.a6.properties_light_ambient.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(_),w.updateTransitions(r)}else this.directionalLight=new Bt(_,$n||($n=new s.a9({direction:new s.ap(s.a6.properties_light_directional.direction),color:new s.aa(s.a6.properties_light_directional.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_directional.intensity),"cast-shadows":new s.aa(s.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new s.aa(s.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.aa(s.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const c=Object.assign(r,{worldview:this.map.getWorldview()}),m=new s.ac(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(m),this.directionalLight&&this.directionalLight.recalculate(m),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,r=this.ambientLight;if(!t||!r)return;const c=k=>.2126*(k[0]<=.03928?k[0]/12.92:Math.pow((k[0]+.055)/1.055,2.4))+.7152*(k[1]<=.03928?k[1]/12.92:Math.pow((k[1]+.055)/1.055,2.4))+.0722*(k[2]<=.03928?k[2]/12.92:Math.pow((k[2]+.055)/1.055,2.4)),m=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),_=t.properties.get("intensity"),w=t.properties.get("direction"),E=1-s.d3(w.x,w.y,w.z)[2]/90,R=c(m)*_*E,D=r.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),L=r.properties.get("intensity"),F=c(D)*L;return Number(((R+F)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(s.dm(t)){const r=s.dn(t),c=this.fragments.find(({id:_})=>_===r);if(!c)return;const m=s.dl(t);return c.style.getFragmentStyle(m)}{const r=this.fragments.find(({id:c})=>c===t);return r?r.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const r={},c=(m,_="")=>`${m}::${_}`;this._featuresetSelectors={};for(const m in t){const _=this._featuresetSelectors[m]=[];for(const w of t[m].selectors){if(w.featureNamespace){const R=this.getOwnLayer(w.layer);if(!R){s.w(`Layer is undefined for selector: ${w.layer}`);continue}const D=c(R.source,R.sourceLayer);if(D in r&&r[D]!==w.featureNamespace){s.w(`"featureNamespace ${w.featureNamespace} of featureset ${m}'s selector is not associated to the same source, skip this selector`);continue}r[D]=w.featureNamespace}let E;if(w.properties)for(const R in w.properties){const D=s.U(w.properties[R]);D.result==="success"&&(E=E||{},E[R]=D.value)}_.push({layerId:w.layer,namespace:w.featureNamespace,properties:E,uniqueFeatureID:w._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const r=this.getFragmentStyle(t);if(!r||!r.stylesheet.featuresets)return[];const c=[];for(const m in r.stylesheet.featuresets)c.push({featuresetId:m,importId:r.scope?r.scope:void 0});return c}getFeaturesetLayers(t,r){const c=this.getFragmentStyle(r),m=c.stylesheet.featuresets;if(!m||!m[t])return this.fire(new s.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const _=[];for(const w of m[t].selectors){const E=c.getOwnLayer(w.layer);E&&_.push(E)}return _}getConfigProperty(t,r){const c=this.getFragmentStyle(t);if(!c)return null;const m=s.B(r,c.scope),_=c.options.get(m),w=_?_.value||_.default:null;return w?w.serialize():null}setConfigProperty(t,r,c){const m=this.getFragmentStyle(t);if(!m)return;const _=m.stylesheet.schema;if(!_||!_[r])return;const w=s.U(c);if(w.result!=="success")return void Zl(this,w.value);const E=w.value.expression,R=s.B(r,m.scope),D=m.options.get(R);if(!D)return;let L;const{minValue:F,maxValue:k,stepValue:H,type:$,values:G}=_[r],ee=s.U(_[r].default);ee.result==="success"&&(L=ee.value.expression),L?(this.options.set(R,Object.assign({},D,{value:E,default:L,minValue:F,maxValue:k,stepValue:H,type:$,values:G})),this.updateConfigDependencies(r)):this.fire(new s.y(new Error(`No schema defined for the config option "${r}" in the "${t}" fragment.`)))}getConfig(t){const r=this.getFragmentStyle(t);if(!r)return null;const c=r.stylesheet.schema;if(!c)return null;const m={};for(const _ in c){const w=s.B(_,r.scope),E=r.options.get(w),R=E?E.value||E.default:null;m[_]=R?R.serialize():null}return m}setConfig(t,r){const c=this.getFragmentStyle(t);c&&(c.updateConfig(r,c.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const r=this.getFragmentStyle(t);return r?r.stylesheet.schema:null}setSchema(t,r){const c=this.getFragmentStyle(t);c&&(c.stylesheet.schema=r,c.updateConfig(c._config,r),this.updateConfigDependencies())}updateConfig(t,r){if(this._config=t,t||r)if(r)for(const c in r){let m,_;const w=s.U(r[c].default);if(w.result==="success"&&(m=w.value.expression),t&&t[c]!==void 0){const k=s.U(t[c]);k.result==="success"&&(_=k.value.expression)}const{minValue:E,maxValue:R,stepValue:D,type:L,values:F}=r[c];if(m){const k=s.B(c,this.scope);this.options.set(k,{default:m,value:_,minValue:E,maxValue:R,stepValue:D,type:L,values:F})}else this.fire(new s.y(new Error(`No schema defined for config option "${c}".`)))}else this.fire(new s.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const r of this._configDependentLayers){const c=this.getLayer(r);if(c){if(t&&!c.configDependencies.has(t))continue;c.possiblyEvaluateVisibility(),this._updateLayer(c)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(r=>{const c=r._styleColorTheme.colorThemeOverride?r._styleColorTheme.colorThemeOverride:r._styleColorTheme.colorTheme;if(c){const m=r._evaluateColorThemeData(c);(!r._styleColorTheme.lut&&m!==""||r._styleColorTheme.lut&&m!==r._styleColorTheme.lut.data)&&r.setColorTheme(c)}}),this._changes.setDirty()}addLayer(t,r,c={}){this._checkLoaded();const m=t.id;if(this._layers[m])return void this.fire(new s.y(new Error(`Layer with id "${m}" already exists on this map`)));let _;if(t.type==="custom"){if(Zl(this,s.dp(t)))return;_=s.dq(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=s.dk(t),t=Object.assign(t,{source:m})),this._validate(He,`layers.${m}`,t,{arrayIndex:-1},c))return;_=s.dq(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(_),_.setEventedParent(this,{layer:{id:m}})}_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid);let w=this._order.length;if(r){const L=this._order.indexOf(r);if(L===-1)return void this.fire(new s.y(new Error(`Layer with id "${r}" does not exist on this map.`)));_.slot===this._layers[r].slot?w=L:s.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,m),this._layerOrderChanged=!0,this._layers[m]=_;const E=this.getOwnLayerSourceCache(_),R=!!this.directionalLight&&this.directionalLight.shadowsEnabled();E&&_.canCastShadows()&&R&&(E.castsShadows=!0);const D=this._changes.getRemovedLayer(_);if(D&&_.source&&E&&_.type!=="custom"){this._changes.discardLayerRemoval(_);const L=s.B(_.source,_.scope);D.type!==_.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),E.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),_.scope=this.scope,this.mergeLayers()}moveLayer(t,r){this._checkLoaded();const c=this._checkLayer(t);if(!c||t===r)return;const m=this._order.indexOf(t);this._order.splice(m,1);let _=this._order.length;if(r){const w=this._order.indexOf(r);if(w===-1)return void this.fire(new s.y(new Error(`Layer with id "${r}" does not exist on this map.`)));c.slot===this._layers[r].slot?_=w:s.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(_,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const r=this._checkLayer(t);if(!r)return;r.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(r.fqid),this._changes.removeLayer(r);const m=this.getOwnLayerSourceCache(r);if(m&&m.castsShadows){let _=!1;for(const w in this._layers)if(this._layers[w].source===r.source&&this._layers[w].canCastShadows()){_=!0;break}m.castsShadows=_}r.onRemove&&r.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const r in this._layers)if(this._layers[r].type===t)return!0;return!1}setLayerZoomRange(t,r,c){this._checkLoaded();const m=this._checkLayer(t);m&&(m.minzoom===r&&m.maxzoom===c||(r!=null&&(m.minzoom=r),c!=null&&(m.maxzoom=c),this._updateLayer(m)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,r){this._checkLoaded();const c=this._checkLayer(t);c&&c.slot!==r&&(c.slot=r,this._updateLayer(c))}setFilter(t,r,c={}){this._checkLoaded();const m=this._checkLayer(t);if(m&&!s.by(m.filter,r))return r==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(J,`layers.${m.id}.filter`,r,{layerType:m.type},c)||(m.filter=s.dk(r),this._updateLayer(m)))}getFilter(t){const r=this._checkLayer(t);if(r)return s.dk(r.filter)}setLayoutProperty(t,r,c,m={}){this._checkLoaded();const _=this._checkLayer(t);if(_&&!s.by(_.getLayoutProperty(r),c)){if(c!=null&&(!m||m.validate!==!1)&&Zl(_,_e.call(ds,{key:`layers.${t}.layout.${r}`,layerType:_.type,objectKey:r,value:c,styleSpec:s.a6,style:{glyphs:!0,sprite:!0}})))return;_.setLayoutProperty(r,c),_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),this._updateLayer(_)}}getLayoutProperty(t,r){const c=this._checkLayer(t);if(c)return c.getLayoutProperty(r)}setPaintProperty(t,r,c,m={}){this._checkLoaded();const _=this._checkLayer(t);if(!_||s.by(_.getPaintProperty(r),c)||c!=null&&(!m||m.validate!==!1)&&Zl(_,ne.call(ds,{key:`layers.${t}.paint.${r}`,layerType:_.type,objectKey:r,value:c,styleSpec:s.a6})))return;const w=_.setPaintProperty(r,c);_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),w&&this._updateLayer(_),this._changes.updatePaintProperties(_)}getPaintProperty(t,r){const c=this._checkLayer(t);if(c)return c.getPaintProperty(r)}setFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:R,importId:D}=t.target,L=this.getFragmentStyle(D),F=L.getFeaturesetLayers(R);for(const{source:k,sourceLayer:H}of F)L.setFeatureState({id:t.id,source:k,sourceLayer:H},r)}else if("layerId"in t.target){const{layerId:R}=t.target,D=this.getLayer(R);this.setFeatureState({id:t.id,source:D.source,sourceLayer:D.sourceLayer},r)}return}const c=t.source,m=t.sourceLayer,_=this._checkSource(c);if(!_)return;const w=_.type;if(w==="geojson"&&m)return void this.fire(new s.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!m)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided.")));const E=this.getOwnSourceCaches(c);for(const R of E)R.setFeatureState(m,t.id,r)}removeFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:R,importId:D}=t.target,L=this.getFragmentStyle(D),F=L.getFeaturesetLayers(R);for(const{source:k,sourceLayer:H}of F)L.removeFeatureState({id:t.id,source:k,sourceLayer:H},r)}else if("layerId"in t.target){const{layerId:R}=t.target,D=this.getLayer(R);this.removeFeatureState({id:t.id,source:D.source,sourceLayer:D.sourceLayer},r)}return}const c=t.source,m=this._checkSource(c);if(!m)return;const _=m.type,w=_==="vector"?t.sourceLayer:void 0;if(_==="vector"&&!w)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new s.y(new Error("A feature id is required to remove its specific state property.")));const E=this.getOwnSourceCaches(c);for(const R of E)R.removeFeatureState(w,t.id,r)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let _;if("featuresetId"in t.target){const{featuresetId:w,importId:E}=t.target,R=this.getFragmentStyle(E),D=R.getFeaturesetLayers(w);for(const{source:L,sourceLayer:F}of D){const k=R.getFeatureState({id:t.id,source:L,sourceLayer:F});if(k&&!_)_=k;else if(!s.by(_,k))return void this.fire(new s.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:w}=t.target,E=this.getLayer(w);_=this.getFeatureState({id:t.id,source:E.source,sourceLayer:E.sourceLayer})}return _}const r=t.source,c=t.sourceLayer,m=this._checkSource(r);if(m){if(m.type!=="vector"||c)return t.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(c,t.id);this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),r=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return s.dr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateFilteredLayers(t){for(const r of Object.values(this._mergedLayers))t(r)&&this._updateLayer(r)}_updateLayer(t){this._changes.updateLayer(t);const r=this.getLayerSourceCache(t),c=s.B(t.source,t.scope),m=this._changes.getUpdatedSourceCaches();t.source&&!m[c]&&r&&r.getSource().type!=="raster"&&(this._changes.updateSourceCache(c,"reload"),r.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const r=E=>this._mergedLayers[E].is3D(!!this.terrain),c=this.order,m={},_=[];for(let E=c.length-1;E>=0;E--){const R=c[E];if(r(R)){m[R]=E;for(const D of t){const L=D[R];if(L)for(const F of L)_.push(F)}}}_.sort((E,R)=>R.intersectionZ-E.intersectionZ);const w=[];for(let E=c.length-1;E>=0;E--){const R=c[E];if(r(R))for(let D=_.length-1;D>=0;D--){const L=_[D].feature;if(L.layer&&m[L.layer.id]<E)break;w.push(L),_.pop()}else for(const D of t){const L=D[R];if(L)for(const F of L)w.push(F.feature)}}return w}queryRasterValue(t,r,c){const m=this.getOwnSource(t);return m?m.type!=="raster-array"?(this.fire(new s.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):m.queryRasterArrayValue(r,c):(this.fire(new s.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,r,c){let m;r&&!Array.isArray(r)&&r.filter&&(this._validate(J,"queryRenderedFeatures.filter",r.filter,null,r),m=s.b6(r.filter));const _={},w=L=>{if(Wl.has(L.type))return;const F=this.getOwnLayerSourceCache(L),k=_[F.id]=_[F.id]||{sourceCache:F,layers:{},has3DLayers:!1};L.is3D(!!this.terrain)&&(k.has3DLayers=!0),k.layers[L.fqid]=k.layers[L.fqid]||{styleLayer:L,targets:[]},k.layers[L.fqid].targets.push({filter:m})};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new s.y(new Error("parameters.layers must be an Array."))),[];for(const L of r.layers){const F=this._layers[L];if(!F)return this.fire(new s.y(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];w(F)}}else for(const L in this._layers)w(this._layers[L]);const E=this._queryRenderedFeatures(t,_,c),R=this._flattenAndSortRenderedFeatures(E),D=[];for(const L of R)s.ds(L.layer.id)===this.scope&&D.push(L);return D}queryRenderedFeatureset(t,r,c){let m;r&&!Array.isArray(r)&&r.filter&&(this._validate(J,"queryRenderedFeatures.filter",r.filter,null,r),m=s.b6(r.filter));const _="mock",w=[];if(r&&r.target)w.push(Object.assign({},r,{targetId:_,filter:m}));else{const L=this.getFeaturesetDescriptors();for(const F of L)w.push({targetId:_,filter:m,target:F});for(const{style:F}of this.fragments){const k=F.getFeaturesetDescriptors();for(const H of k)w.push({targetId:_,filter:m,target:H})}}const E=this.queryRenderedTargets(t,w,c),R=[],D=new Set;for(const L of E)for(const F of L.variants[_])jo(F,L,D)||R.push(new s.dt(L,F));return R}queryRenderedTargets(t,r,c){const m={},_=(E,R,D,L)=>{const F=m[R.id]=m[R.id]||{sourceCache:R,layers:{},has3DLayers:!1};if(F.layers[E.fqid]=F.layers[E.fqid]||{styleLayer:E,targets:[]},E.is3D(!!this.terrain)&&(F.has3DLayers=!0),!L)return D.uniqueFeatureID=!1,void F.layers[E.fqid].targets.push(D);F.layers[E.fqid].targets.push(Object.assign({},D,{namespace:L.namespace,properties:L.properties,uniqueFeatureID:L.uniqueFeatureID}))};for(const E of r)if("featuresetId"in E.target){const{featuresetId:R,importId:D}=E.target,L=this.getFragmentStyle(D);if(!L||!L._featuresetSelectors)continue;const F=L._featuresetSelectors[R];if(!F){this.fire(new s.y(new Error(`The featureset '${R}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const k of F){const H=L.getOwnLayer(k.layerId);H&&!Wl.has(H.type)&&_(H,L.getOwnLayerSourceCache(H),E,k)}}else if("layerId"in E.target){const{layerId:R}=E.target,D=this.getLayer(R);if(!D||Wl.has(D.type))continue;_(D,this.getLayerSourceCache(D),E)}const w=this._queryRenderedFeatures(t,m,c);return this._flattenAndSortRenderedFeatures(w)}_queryRenderedFeatures(t,r,c){const m=[],_=!!this.map._showQueryGeometry,w=Qt.createFromScreenPoints(t,c);for(const E in r){const R=ad(w,r[E],this._availableImages,c,_);Object.keys(R).length&&m.push(R)}if(this.placement)for(const E in r){if(!r[E].sourceCache._onlySymbols)continue;const R=Ba(w.screenGeometry,r[E],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(R).length&&m.push(R)}return m}querySourceFeatures(t,r){const c=r&&r.filter;c&&this._validate(J,"querySourceFeatures.filter",c,null,r);let m=[];const _=this.getOwnSourceCaches(t);for(const w of _)m=m.concat(_o(w,r));return m}addSourceType(t,r,c){return Vs.getSourceType(t)?c(new Error(`A source type called "${t}" already exists.`)):(Vs.setSourceType(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},c):c(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,r,c={}){this._checkLoaded();const m=this.light.getLight();let _=!1;for(const E in t)if(!s.by(t[E],m[E])){_=!0;break}if(!_)return;const w=this._getTransitionParameters();this.light.setLight(t,r,c),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,r=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),r===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let c=t;const m=t.source==null;if(r===1){if(this.disableElevatedTerrain)return;if(typeof c.source=="object"){const E="terrain-dem-src";this.addSource(E,c.source),c=s.dk(c),c=Object.assign(c,{source:E})}const _=Object.assign({},c),w={};if(this.terrain&&m){_.source=this.terrain.get().source;const E=this.terrain?this.getFragmentStyle(this.terrain.scope):null;E&&(w.style=E.serialize())}if(this._validate(Mt,"terrain",_,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!m||this.terrain&&r!==this.terrain.drapeRenderMode){if(!c)return;this._createTerrain(c,r),this.fire(new s.z("data",{dataType:"style"}))}else{const _=this.terrain,w=_.get();for(const E of Object.keys(s.a6.terrain))!c.hasOwnProperty(E)&&s.a6.terrain[E].default&&(c[E]=s.a6.terrain[E].default);for(const E in t)if(!s.by(t[E],w[E])){_.set(t,this.options),this.stylesheet.terrain=t;const R=this._getTransitionParameters({duration:0});_.updateTransitions(R),this.fire(new s.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const r=this.fog=new ln(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}_createSnow(t){const r=this.snow=new Ve(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}_createRain(t){const r=this.rain=new wt(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!s.by(r.get(),t)){r.set(t,this.options),this.stylesheet.fog=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const r=this.snow;if(!s.by(r.get(),t)){r.set(t,this.options),this.stylesheet.snow=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const r=this.rain;if(!s.by(r.get(),t)){r.set(t,this.options),this.stylesheet.rain=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const m in this._layers)this._layers[m].lut=this._styleColorTheme.lut;for(const m in this._sourceCaches)this._sourceCaches[m].clearTiles()},r=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!r)return this._styleColorTheme.lut=null,void t();const c=this._evaluateColorThemeData(r);this._loadColorTheme(c).then(()=>{this.fire(new s.z("colorthemeset")),t()}).catch(m=>{s.w(`Couldn't set color theme: ${m}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,r){const c=this.getFragmentStyle(t);c&&(c._styleColorTheme.colorThemeOverride=r,c._reloadColorTheme())}_getTransitionParameters(t){return{now:s.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],r=[];for(const c of this._mergedOrder)this.isLayerDraped(this._mergedLayers[c])?t.push(c):r.push(c);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...r)}_createTerrain(t,r){const c=this.terrain=new Je(t,r,this.scope,this.options,this.map.getWorldview());r===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}_force3DLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="fill-extrusion"&&this._updateLayer(r)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="symbol"&&this._updateLayer(r)}}_validate(t,r,c,m,_={}){if(_&&_.validate===!1)return!1;const w=Object.assign({},this.serialize());return Zl(this,t.call(ds,Object.assign({key:r,style:w,value:c,styleSpec:s.a6},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.du.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const r=this.getSourceCaches(t);for(const c of r)c.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const r=this._mergedLayers[t];r._clear&&r._clear()}}reloadSource(t){const r=this.getSourceCaches(t);for(const c of r)c.resume(),c.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let r;this.directionalLight&&(r=xu(this.directionalLight));const c=new Set;for(const m in this._mergedLayers){const _=this._mergedLayers[m];_.hasElevation()&&!c.has(_.source)&&c.add(_.source)}for(const m in this._mergedSourceCaches){const _=this._mergedSourceCaches[m],w=c.has(_._source.id);_.update(t,void 0,void 0,r,w)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const r=this._sourceCaches[t];r.resume(),r.reload()}}_updatePlacement(t,r,c,m,_,w,E=!1){let R=!1,D=!1;const L={},F={};for(const k of this._mergedOrder){const H=this._mergedLayers[k];if(H.type!=="symbol")continue;const $=s.B(H.source,H.scope);let G=L[$];if(!G){const X=this.getLayerSourceCache(H);if(!X)continue;const ie=X.getRenderableIds(!0).map(ce=>X.getTileByID(ce));F[$]=ie.slice(),G=L[$]=ie.sort((ce,de)=>de.tileID.overscaledZ-ce.tileID.overscaledZ||(ce.tileID.isLessThan(de.tileID)?-1:1))}const ee=this.crossTileSymbolIndex.addLayer(H,G,r.center.lng,r.projection);R=R||ee}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),E=E||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new s.z("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.o.now(),r.zoom))&&(this.pauseablePlacement=new ia(r,this._mergedOrder,E,c,m,_,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,F,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.o.now()),D=!0),R&&this.pauseablePlacement.placement.setStale()),D||R){this._buildingIndex.onNewFrame(r.zoom);for(let k=0;k<this._mergedOrder.length;k++){const H=this._mergedLayers[this._mergedOrder[k]];if(H.type!=="symbol")continue;const $=this.isLayerClipped(H);this.placement.updateLayerOpacities(H,L[s.B(H.source,H.scope)],k,$?w:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,r){this._checkLoaded();const c=this.stylesheet.imports=this.stylesheet.imports||[];if(c.findIndex(({id:_})=>_===t.id)!==-1)return void this.fire(new s.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!r)return c.push(t),this._loadImports([t],!0);const m=c.findIndex(({id:_})=>_===r);return m===-1&&this.fire(new s.y(new Error(`Import with id "${r}" does not exist on this map.`))),this.stylesheet.imports=c.slice(0,m).concat(t).concat(c.slice(m)),this._loadImports([t],!0,r)}updateImport(t,r){this._checkLoaded();const c=this.stylesheet.imports||[],m=this.getImportIndex(t);return m===-1?this:typeof r=="string"?(this.setImportUrl(t,r),this):(r.url&&r.url!==c[m].url&&this.setImportUrl(t,r.url),s.by(r.config,c[m].config)||this.setImportConfig(t,r.config,r.data.schema),s.by(r.data,c[m].data)||this.setImportData(t,r.data),this)}moveImport(t,r){this._checkLoaded();let c=this.stylesheet.imports||[];const m=this.getImportIndex(t);if(m===-1)return this;const _=this.getImportIndex(r);if(_===-1)return this;const w=c[m],E=this.fragments[m];return c=c.filter(({id:R})=>R!==t),this.fragments=this.fragments.filter(({id:R})=>R!==t),this.stylesheet.imports=c.slice(0,_).concat(w).concat(c.slice(_)),this.fragments=this.fragments.slice(0,_).concat(E).concat(this.fragments.slice(_)),this.mergeLayers(),this}setImportUrl(t,r){this._checkLoaded();const c=this.stylesheet.imports||[],m=this.getImportIndex(t);if(m===-1)return this;c[m].url=r;const _=this.fragments[m];return _.style=this._createFragmentStyle(c[m]),_.style.on("style.import.load",()=>this.mergeAll()),_.style.loadURL(r),this}setImportData(t,r){this._checkLoaded();const c=this.getImportIndex(t),m=this.stylesheet.imports||[];return c===-1?this:r?(this.fragments[c].style.setState(r),this._reloadImports(),this):(delete m[c].data,this.setImportUrl(t,m[c].url))}setImportConfig(t,r,c){this._checkLoaded();const m=this.getImportIndex(t),_=this.stylesheet.imports||[];if(m===-1)return this;r?_[m].config=r:delete _[m].config;const w=this.fragments[m];c&&w.style.stylesheet&&(w.style.stylesheet.schema=c);const E=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=r,w.style.updateConfig(r,E),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const r=this.stylesheet.imports||[],c=this.getImportIndex(t);c!==-1&&(r.splice(c,1),this.fragments[c].style._remove(),this.fragments.splice(c,1),this._reloadImports())}getImportIndex(t){const r=(this.stylesheet.imports||[]).findIndex(c=>c.id===t);return r===-1&&this.fire(new s.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),r}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const r in this._mergedOtherSourceCaches){const c=this._mergedOtherSourceCaches[r];c&&t.push(c.getSource())}return t}getSource(t,r){const c=this.getSourceCache(t,r);return c&&c.getSource()}getLayerSource(t){const r=this.getLayerSourceCache(t);return r&&r.getSource()}getSourceCache(t,r){const c=s.B(t,r);return this._mergedOtherSourceCaches[c]}getLayerSourceCache(t){const r=s.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const r=[];return this._mergedOtherSourceCaches[t]&&r.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&r.push(this._mergedSymbolSourceCaches[t]),r}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const r in t){const c=t[r];c==="reload"?this.reloadSource(r):c==="clear"&&this.clearSource(r)}}updateLayers(t){const r=this._changes.getUpdatedPaintProperties();for(const c of r){const m=this.getLayer(c);m&&m.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,r,c){this.imageManager.getImages(r.images,r.scope,c),this._updateTilesForChangedImages();const m=w=>{if(w){const E=r.images.map(R=>s.I.toString(R));w.setDependencies(r.tileID.key,r.type,E)}},_=s.B(r.source,r.scope);m(this._mergedOtherSourceCaches[_]),m(this._mergedSymbolSourceCaches[_]),r.images.some(w=>w.iconsetId)&&this.fire(new s.z("data",{dataType:"style"}))}rasterizeImages(t,r,c){this.imageManager.rasterizeImages(r,c)}getGlyphs(t,r,c){this.glyphManager.getGlyphs(r.stacks,c)}getResource(t,r,c){return s.dv(r,c)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const r=[];return this._otherSourceCaches[t]&&r.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&r.push(this._symbolSourceCaches[t]),r}_isSourceCacheLoaded(t){const r=this.getOwnSourceCaches(t);return r.length===0?(this.fire(new s.y(new Error(`There is no source with ID '${t}'`))),!1):r.every(c=>c.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,r){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const c=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),m=t.type==="building";if(t.is3D(!!this.terrain)){if(c||m||r&&r.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Vs.getSourceType=function(u){return oh[u]},Vs.setSourceType=function(u,t){oh[u]=t},Vs.registerForPluginStateChange=s.dw;class Rp{execute(t){const r=this._makeBuildingsQueryArea(t),c=this._makeFloorsQueryArea(t),m=t.queryRenderedFeatures(r).reduce((D,L)=>{const F=L.properties.id;return L.properties.type!=="building"||D.some(k=>k.properties.id===F)||D.push(L),D},[]),_=t.queryRenderedFeatures(c).reduce((D,L)=>{const F=L.properties.id;return L.properties.type!=="floor"||D.some(k=>k.properties.id===F)||D.push(L),D},[]),w=[t.getCenter().lng,t.getCenter().lat],E=this._findBuildingAtCenter(w,m),R=m.length>0?m[0]:null;return{floors:_.map(D=>({id:D.properties.id,name:D.properties.name,isDefault:D.properties.is_default,zIndex:D.properties.z_index,connectedFloorIds:D.properties.connected_floor_ids,conflictedFloorIds:D.properties.conflicted_floor_ids,buildingIds:D.properties.building_ids})),building:E?{id:E.properties.id,name:E.properties.name}:{id:R.properties.id,name:R.properties.name}}}_makeBuildingsQueryArea(t){const r=t.transform.width,c=t.transform.height,m=Math.min(r,c)*(1/8),_=.5*(r-m),w=.5*(c-m);return[new s.P(_,w),new s.P(_+m,w+m)]}_makeFloorsQueryArea(t){const r=t.transform.width,c=t.transform.height;return[new s.P(0,0),new s.P(r,c)]}_findBuildingAtCenter(t,r){for(const c of r)if(c.geometry.type==="Polygon"&&this._pointInPolygon(t,c.geometry.coordinates[0]))return c;return null}_pointInPolygon(t,r){let c=!1;for(let m=0,_=r.length-1;m<r.length;_=m++){const w=r[m][0],E=r[m][1],R=r[_][1];E>t[1]!=R>t[1]&&t[0]<(r[_][0]-w)*(t[1]-E)/(R-E)+w&&(c=!c)}return c}}class Mp{constructor(){this._floors=new Map,this._buildings=new Map}append(t){const r=t.building;let c=!1;if(r){const m=r.id;m&&(this._buildings.set(m,r),c||this._buildings.has(m)||(c=!0))}return t.floors.forEach(m=>{const _=m.id;c||this._floors.has(_)||(c=!0),this._floors.set(_,m)}),c}clear(){this._floors.clear(),this._buildings.clear()}getFloors(t=null){const r=Array.from(this._floors.values());return t?r.filter(c=>{const m=c.buildingIds;return!!m&&m.split(";").includes(t)}):r}}class Ip{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage=new Mp}setIndoorData(t){const r=this._featuresStorage.append(t);return this._selectedBuildingId=t.building?t.building.id:null,r}setFloorId(t){const r=this._selectedFloorId!==t;return r&&(this._selectedFloorId=t),r}getCurrentBuildingSelection(){if(!this._selectedBuildingId)return{selectedFloorId:null,floors:[]};const t=this._featuresStorage.getFloors(this._selectedBuildingId),r=this.getActiveFloors().find(c=>{const m=c.buildingIds;if(!m)return!1;const _=m.split(";");return!!this._selectedBuildingId&&_.includes(this._selectedBuildingId)});return{selectedFloorId:r?r.id:null,floors:t}}getActiveFloors(t=!1){const r=this._featuresStorage.getFloors(),c=r.find(R=>R.id===this._selectedFloorId),m=r.filter(R=>R.isDefault===!0);let _=[];if(c)return _=this._calculateCurrentActiveFloors(r,c,m,t),_;if(m.length===0){const R=this._featuresStorage.getFloors(this._selectedBuildingId);_=R.length>0?[R[0]]:[]}else _=m;const w=this._getNonConflictingLastActiveFloors(_),E=[..._,...w];return this._lastActiveFloors=E,E}hasBuildingChanged(t){return this._selectedBuildingId!==(t.building?t.building.id:null)}hasActiveBuilding(){return this._selectedBuildingId!==null}isEmpty(){return this._selectedFloorId===null&&this._selectedBuildingId===null&&this._lastActiveFloors.length===0}_calculateCurrentActiveFloors(t,r,c,m){if(!r)return this._getNonConflictingDefaultFloors(this._lastActiveFloors,c);const _=this._getConnectedFloors(r,t);return m?this._buildExplicitSelectionFloors(r,_,c):this._buildImplicitSelectionFloors(_,c)}_getConnectedFloors(t,r){const c=t.connectedFloorIds;if(!c)return[];const m=new Set(c.split(";"));return r.filter(_=>m.has(_.id))}_buildExplicitSelectionFloors(t,r,c){const m=[t,...r],_=this._getNonConflictingLastActiveFloors(m),w=[...m,..._],E=this._deduplicateFloors(w),R=this._getConflictingFloorIdsFrom(E),D=c.filter(F=>!R.has(F.id)),L=[...E,...D];return this._lastActiveFloors=L,L}_buildImplicitSelectionFloors(t,r){const c=this._getConflictingFloorIdsFrom(this._lastActiveFloors),m=r.filter(w=>!c.has(w.id)),_=this._deduplicateFloors([...this._lastActiveFloors,...m]);return this._lastActiveFloors=_,_}_getNonConflictingDefaultFloors(t,r){const c=this._getConflictingFloorIdsFrom(t),m=r.filter(w=>!c.has(w.id)),_=this._deduplicateFloors([...t,...m]);return this._lastActiveFloors=_,_}_deduplicateFloors(t){const r=new Set;return t.filter(c=>{const m=c.id;return!r.has(m)&&(r.add(m),!0)})}_getConflictingFloorIdsFrom(t){const r=new Set;return t.forEach(c=>{const m=c.conflictedFloorIds;m&&m.split(";").forEach(_=>r.add(_))}),r}_getNonConflictingLastActiveFloors(t){if(!this._lastActiveFloors||this._lastActiveFloors.length===0)return[];const r=new Set(t.map(m=>m.id)),c=this._getConflictingFloorIdsFrom(t);return this._lastActiveFloors.filter(m=>{const _=m.id;return!r.has(_)&&!c.has(_)})}_isFloorConflicted(t,r){const c=t.id;return r.some(m=>{const _=m.conflictedFloorIds;return!!_&&_.split(";").includes(c)})}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage.clear()}}class bu extends s.E{constructor(t){super(),s.aY(["_onLoad","_onMove"],this),this._map=t,this._floorSelectionState=new Ip,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.off("load",this._onLoad),this._map.off("move",this._onMove),this._map=null,this._floorSelectionState=null}selectFloor(t){this._floorSelectionState.setFloorId(t)&&this._updateIndoorConfig(!0)}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new s.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=t.scope,this._indoorDataQuery=new Rp))}),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<15)return void this._clearIndoorData();const t=this._indoorDataQuery.execute(this._map);if(!t||t.floors.length===0||this._map.transform.zoom<16)this._clearIndoorData();else if(this._floorSelectionState.hasBuildingChanged(t)){if(!t.building&&this._floorSelectionState.getActiveFloors().length<=0)return void this._clearIndoorData();this._setIndoorData(t),t.building&&this._updateIndoorSelector()}else this._setIndoorData(t)}_setIndoorData(t){this._floorSelectionState.setIndoorData(t)&&this._updateIndoorConfig()}_clearIndoorData(){this._floorSelectionState.isEmpty()||(this._floorSelectionState.reset(),this._updateIndoorSelector(),this._map.setConfigProperty(this._scope,"activeFloors",["literal",[]]))}_updateIndoorSelector(){const t=this._floorSelectionState.getCurrentBuildingSelection(),r=t.floors.map(c=>({id:c.id,name:c.name,shortName:c.zIndex.toString(),levelOrder:c.zIndex}));this.fire(new s.z("indoorupdate",{selectedFloorId:t.selectedFloorId,floors:r}))}_updateIndoorConfig(t=!1){const r=this._floorSelectionState.getActiveFloors(t).map(c=>c.id)||[];this._map.setConfigProperty(this._scope,"activeFloors",["literal",r])}}var yd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,zp=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,bf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,wu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Tu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,no=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ia=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Hs=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,_h=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Vt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,yh=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Dc=[];os(yd,Dc),os(bf,Dc),os(zp,Dc);const ro={"_prelude_fog.vertex.glsl":no,"_prelude_terrain.vertex.glsl":Tu,"_prelude_shadow.vertex.glsl":Vt,"_prelude_fog.fragment.glsl":Ia,"_prelude_shadow.fragment.glsl":yh,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Hs,"_prelude_raster_particle.glsl":_h},xh={};pn("",Tu),pn(Ia,no),pn(yh,Vt),pn(Hs,""),pn(_h,"");const Pc=pn(zp,bf),za=yd;var xd={background:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:pn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:pn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:pn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:pn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:pn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:pn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:pn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:pn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:pn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:pn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:pn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:pn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:pn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:pn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:pn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:pn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:pn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:pn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:pn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:pn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,wu),skyboxGradient:pn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,wu),skyboxCapture:pn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:pn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:pn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:pn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:pn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:pn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:pn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:pn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function os(u,t){const r=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let c of r)if(c=c.trim(),c[0]==="#"&&c.includes("if")&&!c.includes("endif")){c=c.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const m=c.split(" ");for(const _ of m)t.includes(_)||t.push(_)}}function pn(u,t){const r=/#include\s+"([^"]+)"/g,c=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,m={},_=[],w=[];if(u=u.replace(r,(R,D)=>(w.push(D),"")),(t=t.replace(r,(R,D)=>(_.push(D),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let E=[...Dc];os(u,E),os(t,E);for(const R of[..._,...w])ro[R]||console.error(`Undefined include: ${R}`),xh[R]||(xh[R]=[],os(ro[R],xh[R])),E=[...E,...xh[R]];return{fragmentSource:u=u.replace(c,(R,D,L,F,k)=>(m[k]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${k}
in ${L} ${F} ${k};
#else
uniform ${L} ${F} u_${k};
#endif
`:D==="initialize"?`
#ifdef HAS_UNIFORM_u_${k}
    ${L} ${F} ${k} = u_${k};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${k}
    in ${L} ${F} ${k};
#endif
`:D==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(c,(R,D,L,F,k)=>{const H=F==="float"?"vec2":F,$=k.match(/color/)?"color":H;return D==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${k}
in ${L} ${F} a_${k};
#endif
`:m[k]?D==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
in ${L} ${H} a_${k};
out ${L} ${F} ${k};
#else
uniform ${L} ${F} u_${k};
#endif
`:D==="initialize"?$==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = a_${k};
#else
    ${L} ${F} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = unpack_mix_${$}(a_${k}, u_${k}_t);
#else
    ${L} ${F} ${k} = u_${k};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${k}
    in ${L} ${F} a_${k};
    out ${L} ${F} ${k};
#endif
`:D==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${k}
    ${k} = a_${k};
#endif
`:void 0:D==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
in ${L} ${H} a_${k};
#else
uniform ${L} ${F} u_${k};
#endif
`:D==="define-instanced"?$==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${k}0;
in vec4 a_${k}1;
in vec4 a_${k}2;
in vec4 a_${k}3;
#else
uniform ${L} ${F} u_${k};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${L} ${H} a_${k};
#else
uniform ${L} ${F} u_${k};
#endif
`:D==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${k}
    ${L} ${F} ${k} = a_${k};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${L} ${F} ${k} = a_${k};
#else
    ${L} ${F} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${L} ${F} ${k} = unpack_mix_${$}(a_${k}, u_${k}_t);
#else
    ${L} ${F} ${k} = u_${k};
#endif
`}),usedDefines:E,vertexIncludes:_,fragmentIncludes:w}}class Fo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,r,c,m,_,w,E,R){this.context=t;let D=this.boundPaintVertexBuffers.length!==m.length;for(let F=0;!D&&F<m.length;F++)this.boundPaintVertexBuffers[F]!==m[F]&&(D=!0);let L=this.boundDynamicVertexBuffers.length!==E.length;for(let F=0;!L&&F<E.length;F++)this.boundDynamicVertexBuffers[F]!==E[F]&&(L=!0);if(!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==c||D||L||this.boundIndexBuffer!==_||this.boundVertexOffset!==w)this.freshBind(r,c,m,_,w,E,R);else{t.bindVertexArrayOES.set(this.vao);for(const F of E)F&&(F.bind(),R&&F.instanceCount&&F.setVertexAttribDivisor(t.gl,r,R));_&&_.dynamicDraw&&_.bind()}}freshBind(t,r,c,m,_,w,E){const R=this.context,D=R.gl;this.vao&&this.destroy(),this.vao=R.gl.createVertexArray(),R.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=m,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=w,r.enableAttributes(D,t),r.bind(),r.setVertexAttribPointers(D,t,_);for(const L of c)L.enableAttributes(D,t),L.bind(),L.setVertexAttribPointers(D,t,_);for(const L of w)L&&(L.enableAttributes(D,t),L.bind(),L.setVertexAttribPointers(D,t,_),E&&L.instanceCount&&L.setVertexAttribDivisor(D,t,E));m&&m.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function wf(u,t){const r=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new s.ae(0,c/r).toLngLat().lat,new s.ae(0,(c+1)/r).toLngLat().lat]}function Tf(u,t,r,c,m,_,w){const E=u.context,R=E.gl,D=r.hillshadeFBO;if(!D)return;u.prepareDrawTile();const L=u.isTileAffectedByFog(t),F=u.getOrCreateProgram("hillshade",{overrideFog:L});E.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,D.colorAttachment.get());const k=((ee,X,ie,ce)=>{const de=ie.paint.get("hillshade-shadow-color"),Te=ie.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",we=ie.paint.get("hillshade-highlight-color"),Ee=ie.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ve=ie.paint.get("hillshade-accent-color"),be=ie.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ce=ie.paint.get("hillshade-emissive-strength");let We=s.an(ie.paint.get("hillshade-illumination-direction"));if(ie.paint.get("hillshade-illumination-anchor")==="viewport")We-=ee.transform.angle;else if(ee.style&&ee.style.enable3dLights()&&ee.style.directionalLight){const ct=ee.style.directionalLight.properties.get("direction"),Ze=s.d3(ct.x,ct.y,ct.z);We=s.an(Ze[1])}const je=!ee.options.moving;return{u_matrix:ce||ee.transform.calculateProjMatrix(X.tileID.toUnwrapped(),je),u_image:0,u_latrange:wf(0,X.tileID),u_light:[ie.paint.get("hillshade-exaggeration"),We],u_shadow:de.toPremultipliedRenderColor(Te?null:ie.lut),u_highlight:we.toPremultipliedRenderColor(Ee?null:ie.lut),u_emissive_strength:Ce,u_accent:ve.toPremultipliedRenderColor(be?null:ie.lut)}})(u,r,c,u.terrain?t.projMatrix:null);u.uploadCommonUniforms(E,F,t.toUnwrapped());const{tileBoundsBuffer:H,tileBoundsIndexBuffer:$,tileBoundsSegments:G}=u.getTileBoundsBuffers(r);F.draw(u,R.TRIANGLES,m,_,w,Ni.disabled,k,c.id,H,$,G)}function Da(u,t,r){if(!t.needsDEMTextureUpload)return;const c=u.context,m=c.gl;c.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(r.stride);const _=r.getPixels();t.demTexture?t.demTexture.update(_,{premultiply:!1}):t.demTexture=new s.T(c,_,m.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function To(u,t,r){const c=u.context,m=c.gl;if(!t.dem)return;const _=t.dem;if(c.activeTexture.set(m.TEXTURE1),Da(u,t,_),!t.demTexture)return;t.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE);const w=_.dim;c.activeTexture.set(m.TEXTURE0);let E=t.hillshadeFBO;if(!E){const k=new s.T(c,{width:w,height:w,data:null},m.RGBA8);k.bind(m.LINEAR,m.CLAMP_TO_EDGE),E=t.hillshadeFBO=c.createFramebuffer(w,w,!0,"renderbuffer"),E.colorAttachment.set(k.texture)}c.bindFramebuffer.set(E.framebuffer),c.viewport.set([0,0,w,w]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:D,tileBoundsSegments:L}=u.getMercatorTileBoundsBuffers(),F=[];u.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),u.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(u,m.TRIANGLES,ni.disabled,Ci.disabled,tn.unblended,Ni.disabled,((k,H)=>{const $=H.stride,G=s.bC();return s.cd(G,0,s.al,-s.al,0,0,1),s.br(G,G,[0,-s.al,0]),{u_matrix:G,u_image:1,u_dimension:[$,$],u_zoom:k.overscaledZ}})(t.tileID,_),r.id,R,D,L),t.needsHillshadePrepare=!1}class rr{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ul extends rr{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Uo extends rr{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Su extends rr{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Bm extends rr{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Dp extends rr{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Pp extends rr{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class xa extends rr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class na extends rr{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class xr extends rr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class Vo extends rr{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ho extends rr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class vd extends rr{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class hl extends rr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class Sf extends rr{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Lc extends rr{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class dl extends rr{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Oc extends rr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class kc extends rr{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class fl extends rr{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Lp=class extends rr{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class bd extends rr{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Op extends rr{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Xl extends rr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class wd extends rr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Nc extends rr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ef extends rr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Yl extends rr{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Kl extends rr{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Td extends rr{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class vh extends rr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Sd extends rr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Jl extends rr{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class kp extends Jl{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class jc extends Jl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,this.attachment(),r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Fm extends Jl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,this.attachment(),r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class bh extends jc{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const wh=(u,t,r)=>({u_matrix:u,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:r}),Ed=(u,t,r,c,m,_,w,E,R,D,L,F,k,H,$,G)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(c),u_merc_matrix:r,u_zoom_transition:m,u_merc_center:_,u_image0:0,u_frustum_tl:w,u_frustum_tr:E,u_frustum_br:R,u_frustum_bl:D,u_globe_pos:L,u_globe_radius:F,u_viewport:k,u_grid_matrix:G?Float32Array.from(G):new Float32Array(9),u_skirt_height:H,u_far_z_cutoff:$});function Th(u,t){return u!=null&&t!=null&&!(!u.hasData()||!t.hasData())&&u.demTexture!=null&&t.demTexture!=null&&u.tileID.key!==t.tileID.key}const pl=new class{constructor(){this.operations={}}newMorphing(u,t,r,c,m){if(u in this.operations){const _=this.operations[u];_.to.tileID.key!==r.tileID.key&&(_.queued=r)}else this.operations[u]={startTime:c,phase:0,duration:m,from:t,to:r,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const t=this.operations[u];return{from:t.from,to:t.to,phase:t.phase}}update(u){for(const t in this.operations){const r=this.operations[t];for(r.phase=(u-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,u)){delete this.operations[t];break}}}_nextOp(u,t){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=t,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},Va={0:null,1:"TERRAIN_VERTEX_MORPHING"};function So(u,t,r){if(t===0)return 0;const c=t<1&&r===514?.25/t:1;return 6*Math.pow(1.5,22-u)*Math.max(t,1)*c}function Bc(u,t){const r=1<<u.z;return!t&&(u.x===0||u.x===r-1)||u.y===0||u.y===r-1}const Fc=u=>({u_matrix:u});function Ha(u,t,r,c,m){if(m>0){const _=s.o.now(),w=(_-u.timeAdded)/m,E=t?(_-t.timeAdded)/m:-1,R=r.getSource(),D=c.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),L=!t||Math.abs(t.tileID.overscaledZ-D)>Math.abs(u.tileID.overscaledZ-D),F=L&&u.refreshedUponExpiration?1:s.aA(L?w:1-E,0,1);return t?{opacity:1,mix:1-F,isFading:w<1}:{opacity:F,mix:0,isFading:w<1}}return{opacity:1,mix:0,isFading:!1}}class ml extends Aa{constructor(t){const r=wc("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",r,!1),r.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,r){t.state="loaded",r(null)}}class zr extends Aa{constructor(t){const r=wc("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,r,c){if(t.freezeTileCoverage)return;this.transform=t;const m=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,w)=>{if(_[w.key]="",!this._tiles[w.key]){const E=new Sc(w,this._source.tileSize*w.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);E.state="loaded",this._tiles[w.key]=E}return _},{});for(const _ in this._tiles)_ in m||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(t){const r=this.proxyCachedFBO[t];if(r!==void 0){const c=Object.values(r);this.renderCachePool.push(...c),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Eu extends s.aO{constructor(t,r,c){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=r,this.projMatrix=c}}class Ad extends s.dH{constructor(t,r){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[c,m,_]=function(R){const D=new s.bd,L=new s.b1,F=131;D.reserve(17161),L.reserve(33800);const k=s.al/128,H=s.al+k/2,$=H+k;for(let ee=-k;ee<$;ee+=k)for(let X=-k;X<$;X+=k){const ie=X<0||X>H||ee<0||ee>H?24575:0,ce=s.aA(Math.round(X),0,s.al),de=s.aA(Math.round(ee),0,s.al);D.emplaceBack(ce+ie,de)}const G=(ee,X)=>{const ie=X*F+ee;L.emplaceBack(ie+1,ie,ie+F),L.emplaceBack(ie+F,ie+F+1,ie+1)};for(let ee=1;ee<129;ee++)for(let X=1;X<129;X++)G(X,ee);return[0,129].forEach(ee=>{for(let X=0;X<130;X++)G(X,ee),G(ee,X)}),[D,L,32768]}(),w=t.context;this.gridBuffer=w.createVertexBuffer(c,s.bf.members),this.gridIndexBuffer=w.createIndexBuffer(m),this.gridSegments=s.bg.simpleSegment(0,0,c.length,m.length),this.gridNoSkirtSegments=s.bg.simpleSegment(0,0,c.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new zr(r.map),this.orthoMatrix=s.bC(),s.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.al,0,s.al,0,1);const E=w.gl;this._overlapStencilMode=new Ci({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ml(r.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,r,c){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const m=t.terrain.properties,_=t.terrain.drapeRenderMode===0,w=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.o.now();const E=t.terrain&&t.terrain.scope,R=m.get("source"),D=_?this._mockSourceCache:t.getSourceCache(R,E);if(!D)return void s.w(`Couldn't find terrain source "${R}".`);if(this.sourceCache=D,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=w?this.calculateExaggeration(r):m.get("exaggeration"),!r.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;const L=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const F=this.getScaledDemTileSize();this.sourceCache.update(r,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),r.updateElevation(!0,c),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const r=this._previousCameraAltitude,c=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=c;const m=r!=null?c-r:Number.MAX_VALUE;if(Math.abs(m)<2)return this._exaggeration;const _=t.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(_);let E=_-this._previousZoom;const R=this._previousUpdateTimestamp;let D=_;this._evaluationZoom!=null&&(D=this._evaluationZoom,Math.abs(_-D)>.5&&(E=.5*(_-D+E)),E*m<0&&(D+=E)),this._evaluationZoom=D;const L=w.getExaggeration(D),F=L===w.getExaggeration(Math.max(0,D-.1));if(F&&Math.abs(L-this._exaggeration)<.01)return L;let k=Math.min(.1,.00375*(this._updateTimestamp-R));return(F||L<.1||Math.abs(E)<1e-4)&&(k=Math.min(.2,4*k)),s.ak(this._exaggeration,L,k)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,c=this.painter.transform;this._initializing&&(this._initializing=c._centerAltitude===0&&this.getAtPointOrZero(s.ae.fromLngLat(c.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=r.getIds().map(R=>{const D=r.getTileByID(R).tileID;return D.projMatrix=c.calculateProjMatrix(D.toUnwrapped()),D});(function(R,D){const L=D.transform.pointCoordinate(D.transform.getCameraPoint()),F=new s.P(L.x,L.y);R.sort((k,H)=>{if(H.overscaledZ-k.overscaledZ)return H.overscaledZ-k.overscaledZ;const $=new s.P(k.canonical.x+(1<<k.canonical.z)*k.wrap,k.canonical.y),G=new s.P(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),ee=F.mult(1<<k.canonical.z);return ee.x-=.5,ee.y-=.5,ee.distSqr($)-ee.distSqr(G)})})(m,this.painter);const _=this.proxyToSource||{};this.proxyToSource={},m.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const w=this._style._mergedSourceCaches;for(const R in w){const D=w[R];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,t[R],_),D.usedForTerrain))continue;const L=t[R];D.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[r.id]=m.map(R=>new Eu(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1;const E={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const D=this.terrainTileForTile[R.key];if(!D)continue;const L=D.tileID.key;L in E||(this._visibleDemTiles.push(D),E[L]=L)}}_assignTerrainTiles(t){this._initializing||t.forEach(r=>{if(this.terrainTileForTile[r.key])return;const c=this._findTileCoveringTileID(r,this.sourceCache);c&&(this.terrainTileForTile[r.key]=c)})}_prepareDEMTextures(){const t=this.painter.context,r=t.gl;for(const c in this.terrainTileForTile){const m=this.terrainTileForTile[c],_=m.dem;!_||m.demTexture&&!m.needsDEMTextureUpload||(t.activeTexture.set(r.TEXTURE1),Da(this.painter,m,_))}}_prepareDemTileUniforms(t,r,c,m){if(!r||r.demTexture==null)return!1;const _=t.tileID.canonical,w=Math.pow(2,r.tileID.canonical.z-_.z),E=m||"";return c[`u_dem_tl${E}`]=[_.x*w%1,_.y*w%1],c[`u_dem_scale${E}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const r=this._visibleDemTiles.reduce((c,m)=>{if(!m.dem)return c;const _=m.dem.tree.minimums[0];return _>0&&t++,c+_},0);return t?r/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,r=t.gl;t.activeTexture.set(r.TEXTURE2);const c=this._getLoadedAreaMinimum(),m=new s.dI({width:1,height:1},new Float32Array([c]));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(m,{premultiply:!1}):_=this._emptyDEMTexture=new s.T(t,m,r.R32F,{premultiply:!1}),_}setupElevationDraw(t,r,c){const m=this.painter.context,_=m.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};w.u_exaggeration=this.exaggeration();let E=null,R=null,D=1;if(c&&c.morphing&&this._useVertexMorphing){const H=c.morphing.srcDemTile,$=c.morphing.dstDemTile;D=c.morphing.phase,H&&$&&(this._prepareDemTileUniforms(t,H,w,"_prev")&&(R=H),this._prepareDemTileUniforms(t,$,w)&&(E=$))}const L=H=>H&&H.demTexture&&this.painter.linearFloatFilteringSupported()?_.LINEAR:_.NEAREST;let F=null;var k;if(this.enabled?R&&E?(F=E.demTexture,m.activeTexture.set(_.TEXTURE4),R.demTexture.bind(L(R),_.CLAMP_TO_EDGE),w.u_dem_lerp=D):(E=this.terrainTileForTile[t.tileID.key],F=this._prepareDemTileUniforms(t,E,w)?E.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,m.activeTexture.set(_.TEXTURE2),F&&(w.u_dem_size=(k=F).size[0]===1?1:k.size[0]-2,F.bind(L(E),_.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(c&&c.useDepthForOcclusion,r,w),c&&c.useMeterToDem&&E){const H=(1<<E.tileID.canonical.z)*s.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=H}if(c&&c.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=c.labelPlaneMatrixInv),r.setTerrainUniformValues(m,w),this.painter.transform.projection.name==="globe"){const H=this.globeUniformValues(this.painter.transform,t.tileID.canonical,c&&c.useDenormalizedUpVectorScale);r.setGlobeUniformValues(m,H)}}globeUniformValues(t,r,c){const m=t.projection;return{u_tile_tl_up:m.upVector(r,0,0),u_tile_tr_up:m.upVector(r,s.al,0),u_tile_br_up:m.upVector(r,s.al,s.al),u_tile_bl_up:m.upVector(r,0,s.al),u_tile_up_scale:c?s.dJ(1):m.upVectorScale(r,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const r=this.painter,c=this.painter.context;t.length!==0&&(c.bindFramebuffer.set(null),c.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,_,w,E,R){if(m.transform.projection.name==="globe")(function(D,L,F,k,H){const $=D.context,G=$.gl;let ee,X;const ie=D.transform,ce=s.dA(D,$,ie),de=(ct,Ze)=>{if(X===Ze)return;const ot=[Va[Ze],"PROJECTION_GLOBE_VIEW"];ce&&ot.push("CUSTOM_ANTIALIASING");const jt=D.isTileAffectedByFog(ct);ee=D.getOrCreateProgram("globeRaster",{defines:ot,overrideFog:jt}),X=Ze},Te=D.colorModeForRenderPass(),we=new ni(G.LEQUAL,ni.ReadWrite,D.depthRangeFor3D);pl.update(H);const Ee=s.dB(ie),ve=[s.aF(ie.center.lng),s.aJ(ie.center.lat)],be=D.globeSharedBuffers,Ce=[ie.width*s.o.devicePixelRatio,ie.height*s.o.devicePixelRatio],We=Float32Array.from(ie.globeMatrix),je={useDenormalizedUpVectorScale:!0};{const ct=D.transform,Ze=So(ct.zoom,L.exaggeration(),L.sourceCache._source.tileSize);X=-1;const ot=G.TRIANGLES;for(const jt of k){const Ye=F.getTile(jt),Oe=Ci.disabled,nt=L.prevTerrainTileForTile[jt.key],Ge=L.terrainTileForTile[jt.key];Th(nt,Ge)&&pl.newMorphing(jt.key,nt,Ge,H,250),$.activeTexture.set(G.TEXTURE0),Ye.texture&&Ye.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const ht=pl.getMorphValuesForProxy(jt.key),_t=ht?1:0;ht&&Object.assign(je,{morphing:{srcDemTile:ht.from,dstDemTile:ht.to,phase:s.dz(ht.phase)}});const qt=s.dC(jt.canonical),Ct=s.dD(qt.getCenter().lat),Tt=s.dE(jt.canonical,qt,Ct,ct.worldSize/ct._pixelsPerMercatorPixel),gi=s.bk(s.dF(jt.canonical)),oi=Ed(ct.expandedFarZProjMatrix,We,Ee,gi,s.aj(ct.zoom),ve,ct.frustumCorners.TL,ct.frustumCorners.TR,ct.frustumCorners.BR,ct.frustumCorners.BL,ct.globeCenterInViewSpace,ct.globeRadius,Ce,Ze,ct._farZ,Tt);if(de(jt,_t),ee&&(L.setupElevationDraw(Ye,ee,je),D.uploadCommonUniforms($,ee,jt.toUnwrapped()),be)){const[ei,li,Li]=be.getGridBuffers(Ct,Ze!==0);ee.draw(D,ot,we,Oe,Te,Ni.backCCW,oi,"globe_raster",ei,li,Li)}}}if(be&&(D.renderDefaultNorthPole||D.renderDefaultSouthPole)){const ct=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ce&&ct.push("CUSTOM_ANTIALIASING"),ee=D.getOrCreateProgram("globeRaster",{defines:ct});for(const Ze of k){const{x:ot,y:jt,z:Ye}=Ze.canonical,Oe=jt===0,nt=jt===(1<<Ye)-1,[Ge,ht,_t,qt]=be.getPoleBuffers(Ye,!1);if(qt&&(Oe||nt)){const Ct=F.getTile(Ze);$.activeTexture.set(G.TEXTURE0),Ct.texture&&Ct.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let Tt=s.dG(Ye,ot,ie);const gi=s.bk(s.dF(Ze.canonical)),oi=(ei,li)=>ei.draw(D,G.TRIANGLES,we,Ci.disabled,Te,Ni.disabled,Ed(ie.expandedFarZProjMatrix,Tt,Tt,gi,0,ve,ie.frustumCorners.TL,ie.frustumCorners.TR,ie.frustumCorners.BR,ie.frustumCorners.BL,ie.globeCenterInViewSpace,ie.globeRadius,Ce,0,ie._farZ),"globe_pole_raster",li,_t,qt);L.setupElevationDraw(Ct,ee,je),D.uploadCommonUniforms($,ee,Ze.toUnwrapped()),Oe&&D.renderDefaultNorthPole&&oi(ee,Ge),nt&&D.renderDefaultSouthPole&&(Tt=s.cR(s.bC(),Tt,[1,-1,1]),oi(ee,ht))}}}})(m,_,w,E,R);else{const D=m.context,L=D.gl;let F,k;const H=m.shadowRenderer,$=zc(m,m.longestCutoffRange),G=Te=>{if(k===Te)return;const we=[];we.push(Va[Te]),$.shouldRenderCutoff&&we.push("RENDER_CUTOFF"),H&&(we.push("RENDER_SHADOWS","DEPTH_TEXTURE"),H.useNormalOffset&&we.push("NORMAL_OFFSET")),F=m.getOrCreateProgram("terrainRaster",{defines:we}),k=Te},ee=m.colorModeForRenderPass(),X=new ni(L.LEQUAL,ni.ReadWrite,m.depthRangeFor3D);pl.update(R);const ie=m.transform,ce=So(ie.zoom,_.exaggeration(),_.sourceCache._source.tileSize);let de=[0,0,0];if(H){const Te=m.style.directionalLight,we=m.style.ambientLight;Te&&we&&(de=bo(m.style,Te,we))}{k=-1;const Te=L.TRIANGLES,[we,Ee]=[_.gridIndexBuffer,_.gridSegments];for(const ve of E){const be=w.getTile(ve),Ce=Ci.disabled,We=_.prevTerrainTileForTile[ve.key],je=_.terrainTileForTile[ve.key];Th(We,je)&&pl.newMorphing(ve.key,We,je,R,250),D.activeTexture.set(L.TEXTURE0),be.texture&&be.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const ct=pl.getMorphValuesForProxy(ve.key),Ze=ct?1:0;let ot;ct&&(ot={morphing:{srcDemTile:ct.from,dstDemTile:ct.to,phase:s.dz(ct.phase)}});const jt=wh(ve.projMatrix,Bc(ve.canonical,ie.renderWorldCopies)?ce/10:ce,de);if(G(Ze),!F)continue;_.setupElevationDraw(be,F,ot);const Ye=ve.toUnwrapped();H&&H.setupShadows(Ye,F),m.uploadCommonUniforms(D,F,Ye,null,$),F.draw(m,Te,X,Ce,ee,Ni.backCCW,jt,"terrain_raster",_.gridBuffer,we,Ee)}}}}(r,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const r=this.painter,c=this.painter.context,m=this.proxySourceCache,_=this.proxiedCoords[m.id],w=this._drapedRenderBatches.shift(),E=r.style.order,R=[];let D=0;for(const L of _){const F=m.getTileByID(L.proxyTileKey),k=m.proxyCachedFBO[L.key]?m.proxyCachedFBO[L.key][t]:void 0,H=k!==void 0?m.renderCache[k]:this.pool[D++],$=k!==void 0;if(F.texture=H.tex,$&&!H.dirty){R.push(F.tileID);continue}let G;c.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(c.clear({color:s.ao.transparent,stencil:0}),H.dirty=!1);for(let ee=w.start;ee<=w.end;++ee){const X=r.style._mergedLayers[E[ee]];if(X.isHidden(r.transform.zoom))continue;const ie=r.style.getLayerSourceCache(X),ce=ie?this.proxyToSource[L.key][ie.id]:[L];if(!ce)continue;const de=ce;c.viewport.set([0,0,H.fb.width,H.fb.height]),G!==(ie?ie.id:null)&&(this._setupStencil(H,ce,X,ie),G=ie?ie.id:null),r.renderLayer(r,ie,X,de)}if(this._drapedRenderBatches.length===0)for(const ee of this._pendingGroundEffectLayers){const X=r.style._mergedLayers[E[ee]];if(X.isHidden(r.transform.zoom))continue;const ie=r.style.getLayerSourceCache(X),ce=ie?this.proxyToSource[L.key][ie.id]:[L];if(!ce)continue;const de=ce;c.viewport.set([0,0,H.fb.width,H.fb.height]),G!==(ie?ie.id:null)&&(this._setupStencil(H,ce,X,ie),G=ie?ie.id:null),r.renderLayer(r,ie,X,de)}this.renderedToTile?(H.dirty=!0,R.push(F.tileID)):$||--D,D===5&&(D=0,this.renderToBackBuffer(R))}return this.renderToBackBuffer(R),this.renderingToTexture=!1,c.bindFramebuffer.set(null),c.viewport.set([0,0,r.width,r.height]),w.end+1}postRender(){}isLayerOrderingCorrect(t){const r=t.order.length;let c=-1,m=r;for(let _=0;_<r;++_)this._style.isLayerDraped(t._mergedLayers[t.order[_]])?c=Math.max(c,_):m=Math.min(m,_);return m>c}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(r=>r.dem).forEach(r=>{t=Math.min(t,r.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,r,c){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const w=_.tileID,E=1<<w.overscaledZ,{x:R,y:D}=w.canonical,L=R/E,F=(R+1)/E,k=D/E,H=(D+1)/E;return{minx:L,miny:k,maxx:F,maxy:H,t:_.dem.tree.raycastRoot(L,k,F,H,t,r,c),tile:_}});m.sort((_,w)=>(_.t!==null?_.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const _ of m){if(_.t==null)return null;const w=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,t,r,c);if(w!=null)return w}return null}_createFBO(){const t=this.painter.context,r=t.gl,c=this.drapeBufferSize;t.activeTexture.set(r.TEXTURE0);const m=new s.T(t,{width:c[0],height:c[1],data:null},r.RGBA8);m.bind(r.LINEAR,r.CLAMP_TO_EDGE);const _=t.createFramebuffer(c[0],c[1],!0,null);return _.colorAttachment.set(m.texture),_.depthAttachment=new bh(t,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,c[0],c[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:_,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const r=this._style._mergedLayers[t],c=r.isHidden(this.painter.transform.zoom);return r.type==="hillshade"||r.type==="custom"?!c&&r.shouldRedrape():!c&&r.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const c of this._style.getSources())if(c instanceof Vr){t=!0;break}if(!t)return;const r={};for(let c=0;c<this._style.order.length;++c){const m=this._style._mergedLayers[this._style.order[c]],_=this._style.getLayerSourceCache(m);if(_&&!r[_.id]&&!m.isHidden(this.painter.transform.zoom)&&m.type==="line"&&m.widthExpression()instanceof s.ad){r[_.id]=!0;for(const w of this.proxyCoords){const E=this.proxyToSource[w.key][_.id];if(E)for(const R of E)this._clearRenderCacheForTile(_.id,R)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c]._source instanceof ja){t=!0;break}if(!t)return;const r={};for(let c=0;c<this._style.order.length;++c){const m=this._style._mergedLayers[this._style.order[c]],_=this._style.getLayerSourceCache(m);if(!_||r[_.id]||m.isHidden(this.painter.transform.zoom)||m.type!=="raster")continue;const w=m.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const R=this.proxyToSource[E.key][_.id];if(R)for(const D of R){const L=Ha(_.getTile(D),_.findLoadedParent(D,0),_,this.painter.transform,w);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(_.id,D)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,r=t.length;if(r===0)return;const c=[];this._pendingGroundEffectLayers=[];let m,_=0,w=this._style._mergedLayers[t[_]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++_<r;)w=this._style._mergedLayers[t[_]];for(;_<r;++_){const E=this._style._mergedLayers[t[_]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?m===void 0&&(m=_):(E.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(_),m!==void 0&&(c.push({start:m,end:_-1}),m=void 0)))}if(m!==void 0&&c.push({start:m,end:_-1}),c.length!==0){const E=c[c.length-1];this._pendingGroundEffectLayers.every(R=>R>E.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=c}_setupRenderCache(t){const r=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,r.renderCache.length>r.renderCachePool.length){const w=Object.values(r.proxyCachedFBO);r.proxyCachedFBO={};for(let E=0;E<w.length;++E){const R=Object.values(w[E]);r.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const c=this.proxyCoords,m=this._tilesDirty;for(let w=c.length-1;w>=0;w--){const E=c[w];if(r.getTileByID(E.key),r.proxyCachedFBO[E.key]!==void 0){const R=t[E.key],D=this.proxyToSource[E.key];let L=0;for(const F in D){const k=D[F],H=R[F];if(!H||H.length!==k.length||k.some(($,G)=>$!==H[G]||m[F]&&m[F].hasOwnProperty($.key))){L=-1;break}++L}for(const F in r.proxyCachedFBO[E.key])r.renderCache[r.proxyCachedFBO[E.key][F]].dirty=L<0||L!==Object.values(R).length}}const _=[...this._drapedRenderBatches];_.sort((w,E)=>E.end-E.start-(w.end-w.start));for(const w of _)for(const E of c){if(r.proxyCachedFBO[E.key])continue;let R=r.renderCachePool.pop();R===void 0&&r.renderCache.length<50&&(R=r.renderCache.length,r.renderCache.push(this._createFBO())),R!==void 0&&(r.proxyCachedFBO[E.key]={},r.proxyCachedFBO[E.key][w.start]=R,r.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(t,r,c,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,w=_.gl;if(r.length<=1)return void(this._overlapStencilType=!1);let E;if(c.isTileClipped())E=r.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(r[0].overscaledZ>r[r.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,c.isTileClipped()&&this._renderTileClippingMasks(r,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Ci.disabled}_renderTileClippingMasks(t,r){const c=this.painter,m=this.painter.context,_=m.gl;c._tileClippingMaskIDs={},m.setColorMode(tn.disabled),m.setDepthMode(ni.disabled);const w=c.getOrCreateProgram("clippingMask");for(const E of t){const R=c._tileClippingMaskIDs[E.key]=--r;w.draw(c,_.TRIANGLES,ni.disabled,new Ci({func:_.ALWAYS,mask:0},R,255,_.KEEP,_.KEEP,_.REPLACE),tn.disabled,Ni.disabled,Fc(E.projMatrix),"$clipping",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}pointCoordinate(t){const r=this.painter.transform;if(t.x<0||t.x>r.width||t.y<0||t.y>r.height)return null;const c=[t.x,t.y,1,1];s.aC(c,c,r.pixelMatrixInverse),s.cJ(c,c,1/c[3]),c[0]/=r.worldSize,c[1]/=r.worldSize;const m=r._camera.position,_=s.ce(1,r.center.lat),w=[m[0],m[1],m[2]/_,0],E=s.d9([],c.slice(0,3),w);s.aw(E,E);const R=this.raycast(w,E,this._exaggeration);return R!==null&&R?(s.bH(w,w,E,R),w[3]=w[2],w[2]*=_,w):null}_setupProxiedCoordsForOrtho(t,r,c){if(t.getSource()instanceof s.aS)return this._setupProxiedCoordsForImageSource(t,r,c);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const m=this.proxiedCoords[t.id]=[],_=this.proxyCoords;for(let R=0;R<_.length;R++){const D=_[R],L=this._findTileCoveringTileID(D,t);if(L){const F=this._createProxiedId(D,L,c[D.key]&&c[D.key][t.id]);m.push(F),this.proxyToSource[D.key][t.id]=[F]}}let w=!1;const E=new Set;for(let R=0;R<r.length;R++){const D=t.getTile(r[R]);if(!D||!D.hasData())continue;const L=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==D.tileID.canonical.z){const F=this.proxyToSource[L.tileID.key][t.id],k=this._createProxiedId(L.tileID,D,c[L.tileID.key]&&c[L.tileID.key][t.id]);F?F.splice(F.length-1,0,k):this.proxyToSource[L.tileID.key][t.id]=[k];const H=this.proxyToSource[L.tileID.key][t.id];E.has(H)||E.add(H),m.push(k),w=!0}}if(this._sourceTilesOverlap[t.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(const R of E)R.sort((D,L)=>L.overscaledZ-D.overscaledZ)}_setupProxiedCoordsForImageSource(t,r,c){if(!t.getSource().loaded())return;const m=this.proxiedCoords[t.id]=[],_=this.proxyCoords,w=t.getSource(),E=w.tileID;if(!E)return;const R=new s.P(E.x,E.y)._div(1<<E.z),D=w.coordinates.map(s.ae.fromLngLat).reduce((F,k)=>(F.min.x=Math.min(F.min.x,k.x-R.x),F.min.y=Math.min(F.min.y,k.y-R.y),F.max.x=Math.max(F.max.x,k.x-R.x),F.max.y=Math.max(F.max.y,k.y-R.y),F),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(F,k)=>{const H=F.wrap+F.canonical.x/(1<<F.canonical.z),$=F.canonical.y/(1<<F.canonical.z),G=s.al/(1<<F.canonical.z),ee=k.wrap+k.canonical.x/(1<<k.canonical.z),X=k.canonical.y/(1<<k.canonical.z);return H+G<ee+D.min.x||H>ee+D.max.x||$+G<X+D.min.y||$>X+D.max.y};for(let F=0;F<_.length;F++){const k=_[F];for(let H=0;H<r.length;H++){const $=t.getTile(r[H]);if(!$||!$.hasData()||L(k,$.tileID))continue;const G=this._createProxiedId(k,$,c[k.key]&&c[k.key][t.id]),ee=this.proxyToSource[k.key][t.id];ee?ee.push(G):this.proxyToSource[k.key][t.id]=[G],m.push(G)}}}_createProxiedId(t,r,c){let m=this.orthoMatrix;if(c){const _=c.find(w=>w.key===r.tileID.key);if(_)return _}if(r.tileID.key!==t.key){const _=t.canonical.z-r.tileID.canonical.z;let w,E,R;m=s.bC();const D=r.tileID.wrap-t.wrap<<t.overscaledZ;_>0?(w=s.al>>_,E=w*((r.tileID.canonical.x<<_)-t.canonical.x+D),R=w*((r.tileID.canonical.y<<_)-t.canonical.y)):(w=s.al<<-_,E=s.al*(r.tileID.canonical.x-(t.canonical.x+D<<-_)),R=s.al*(r.tileID.canonical.y-(t.canonical.y<<-_))),s.cd(m,0,w,0,w,0,1),s.br(m,m,[E,R,0])}return new Eu(r.tileID,t.key,m)}_findTileCoveringTileID(t,r){let c=r.getTile(t);if(c&&c.hasData())return c;const m=this._findCoveringTileCache[r.id],_=m[t.key];if(c=_?r.getTileByID(_):null,c&&c.hasData()||_===null)return c;let w=c?c.tileID:t,E=w.overscaledZ;const R=r.getSource().minzoom,D=[];if(!_){const F=r.getSource().maxzoom;if(t.canonical.z>=F){const k=t.canonical.z-F;r.getSource().reparseOverscaled?(E=Math.max(t.canonical.z+2,r.transform.tileZoom),w=new s.aO(E,t.wrap,F,t.canonical.x>>k,t.canonical.y>>k)):k!==0&&(E=F,w=new s.aO(E,t.wrap,F,t.canonical.x>>k,t.canonical.y>>k))}w.key!==t.key&&(D.push(w.key),c=r.getTile(w))}const L=F=>{D.forEach(k=>{m[k]=F}),D.length=0};for(E-=1;E>=R&&(!c||!c.hasData());E--){c&&L(c.tileID.key);const F=w.calculateScaledKey(E);if(c=r.getTileByID(F),c&&c.hasData())break;const k=m[F];if(k===null)break;k===void 0?D.push(F):c=r.getTileByID(k)}return L(c?c.tileID.key:null),c&&c.hasData()?c:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,r){let c=this._tilesDirty[t];c||(c=this._tilesDirty[t]={}),c[r.key]=!0}}function Af(u,t,r){const c=function(E,R,D){const L=s.bJ(R,E),F=s.bJ(D,[.2126,.7152,.0722]),k=($,G,ee)=>(1-ee)*$+ee*G,H=k(1-.3*Math.min(F,1),1,Math.min(L+1,1));return k(.92,1,Math.asin(s.aA(R[2],-1,1))/Math.PI+.5)*H}(u,[0,0,1],t),m=[0,0,0];s.c4(m,r.slice(0,3),c);const _=[0,0,0];s.c4(_,t.slice(0,3),u[2]);const w=[0,0,0];return s.d7(w,m,_),s.da(w)}const Np=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ts=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Sh{static cacheKey(t,r,c,m){let _=`${r}${m?m.cacheKey:""}`;for(const w of c)t.usedDefines.includes(w)&&(_+=`/${w}`);return _}constructor(t,r,c,m,_,w){const E=t.gl;this.program=E.createProgram(),this.configuration=m,this.name=r,this.fixedDefines=[...w];let R=m?m.defines():[];R=R.concat(w.map($=>`#define ${$}`));const D=`#version 300 es
`;let L=D+R.concat("precision mediump float;",za,Pc.fragmentSource).join(`
`);for(const $ of c.fragmentIncludes)L+=`
${ro[$]}`;L+=`
${c.fragmentSource}`;let F=D+R.concat("precision highp float;",za,Pc.vertexSource).join(`
`);for(const $ of c.vertexIncludes)F+=`
${ro[$]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&c.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(F+=`
uniform int u_instanceID;
`),F+=`
${c.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(F=F.replaceAll("gl_InstanceID","u_instanceID"));const k=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(k,L),E.compileShader(k),E.attachShader(this.program,k);const H=E.createShader(E.VERTEX_SHADER);E.isContextLost()?this.failedToCreate=!0:(E.shaderSource(H,F),E.compileShader(H),E.attachShader(this.program,H),this.attributes={},E.linkProgram(this.program),E.deleteShader(H),E.deleteShader(k),this.fixedUniforms=_(t),this.binderUniforms=m?m.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=($=>({u_instanceID:new s.cg($)}))(t)),(w.includes("TERRAIN")||r.indexOf("symbol")!==-1||r.indexOf("circle")!==-1)&&(this.terrainUniforms=($=>({u_dem:new s.cg($),u_dem_prev:new s.cg($),u_dem_tl:new s.cj($),u_dem_scale:new s.ci($),u_dem_tl_prev:new s.cj($),u_dem_scale_prev:new s.ci($),u_dem_size:new s.ci($),u_dem_lerp:new s.ci($),u_exaggeration:new s.ci($),u_depth:new s.cg($),u_depth_size_inv:new s.cj($),u_depth_range_unpack:new s.cj($),u_occluder_half_size:new s.ci($),u_occlusion_depth_offset:new s.ci($),u_meter_to_dem:new s.ci($),u_label_plane_matrix_inv:new s.ck($)}))(t)),w.includes("GLOBE")&&(this.globeUniforms=($=>({u_tile_tl_up:new s.ch($),u_tile_tr_up:new s.ch($),u_tile_br_up:new s.ch($),u_tile_bl_up:new s.ch($),u_tile_up_scale:new s.ci($)}))(t)),w.includes("FOG")&&(this.fogUniforms=($=>({u_fog_matrix:new s.ck($),u_fog_range:new s.cj($),u_fog_color:new s.d2($),u_fog_horizon_blend:new s.ci($),u_fog_vertical_limit:new s.cj($),u_fog_temporal_offset:new s.ci($),u_frustum_tl:new s.ch($),u_frustum_tr:new s.ch($),u_frustum_br:new s.ch($),u_frustum_bl:new s.ch($),u_globe_pos:new s.ch($),u_globe_radius:new s.ci($),u_globe_transition:new s.ci($),u_is_globe:new s.cg($),u_viewport:new s.cj($)}))(t)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=($=>({u_cutoff_params:new s.d2($)}))(t)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=($=>({u_lighting_ambient_color:new s.ch($),u_lighting_directional_dir:new s.ch($),u_lighting_directional_color:new s.ch($),u_ground_radiance:new s.ch($)}))(t)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=($=>({u_light_matrix_0:new s.ck($),u_light_matrix_1:new s.ck($),u_fade_range:new s.cj($),u_shadow_normal_offset:new s.ch($),u_shadow_intensity:new s.ci($),u_shadow_texel_size:new s.ci($),u_shadow_map_resolution:new s.ci($),u_shadow_direction:new s.ch($),u_shadow_bias:new s.ch($),u_shadowmap_0:new s.cg($),u_shadowmap_1:new s.cg($)}))(t)))}getAttributeLocation(t,r){let c=this.attributes[r];return c===void 0&&(c=this.attributes[r]=t.getAttribLocation(this.program,r)),c}setTerrainUniformValues(t,r){if(!this.terrainUniforms)return;const c=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in r)c[m]&&c[m].set(this.program,m,r[m])}}setGlobeUniformValues(t,r){if(!this.globeUniforms)return;const c=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in r)c[m]&&c[m].set(this.program,m,r[m])}}setFogUniformValues(t,r){if(!this.fogUniforms)return;const c=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in r)c[m].set(this.program,m,r[m])}}setCutoffUniformValues(t,r){if(!this.cutoffUniforms)return;const c=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in r)c[m].set(this.program,m,r[m])}}setLightsUniformValues(t,r){if(!this.lightsUniforms)return;const c=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in r)c[m].set(this.program,m,r[m])}}setShadowUniformValues(t,r){if(this.failedToCreate||!this.shadowUniforms)return;const c=this.shadowUniforms;t.program.set(this.program);for(const m in r)c[m].set(this.program,m,r[m])}_drawDebugWireframe(t,r,c,m,_,w,E,R,D,L){const F=t.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;const k=t.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||t._terrain&&t._terrain.renderingToTexture||!Np.includes(this.name))||!(!F.layers3D||!Ts.includes(this.name))))return;const H=k.gl,$=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,_,k);if(!$)return;const G=[...this.fixedDefines];G.push("DEBUG_WIREFRAME");const ee=t.getOrCreateProgram(this.name,{config:this.configuration,defines:G});k.program.set(ee.program);const X=(de,Te,we)=>{if(Te[de]&&we[de])for(const Ee in Te[de])we[de][Ee]&&we[de][Ee].set(we.program,Ee,Te[de][Ee].current)};D&&D.setUniforms(ee.program,k,ee.binderUniforms,E,{zoom:R}),X("fixedUniforms",this,ee),X("terrainUniforms",this,ee),X("globeUniforms",this,ee),X("fogUniforms",this,ee),X("lightsUniforms",this,ee),X("shadowUniforms",this,ee),$.bind(),k.setColorMode(new tn([H.ONE,H.ONE_MINUS_SRC_ALPHA,H.ZERO,H.ONE],s.ao.transparent,[!0,!0,!0,!1])),k.setDepthMode(new ni(r.func===H.LESS?H.LEQUAL:r.func,ni.ReadOnly,r.range)),k.setStencilMode(Ci.disabled);const ie=3*w.primitiveLength*2,ce=3*w.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const de=L||1;for(let Te=0;Te<de;++Te)ee.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Te),H.drawElements(H.LINES,ie,H.UNSIGNED_SHORT,ce)}else L&&L>1?H.drawElementsInstanced(H.LINES,ie,H.UNSIGNED_SHORT,ce,L):H.drawElements(H.LINES,ie,H.UNSIGNED_SHORT,ce);_.bind(),k.program.set(this.program),k.setDepthMode(r),k.setStencilMode(c),k.setColorMode(m)}checkUniforms(t,r,c){if(this.fixedDefines.includes(r)){for(const m of Object.keys(c))if(!c[m].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${m} not set but required by ${r} being defined`)}}draw(t,r,c,m,_,w,E,R,D,L,F,k,H,$,G,ee){const X=t.context,ie=X.gl;if(this.failedToCreate)return;X.program.set(this.program),X.setDepthMode(c),X.setStencilMode(m),X.setColorMode(_),X.setCullFace(w);for(const Te of Object.keys(this.fixedUniforms))this.fixedUniforms[Te].set(this.program,Te,E[Te]);$&&$.setUniforms(this.program,X,this.binderUniforms,k,{zoom:H});const ce={[ie.POINTS]:1,[ie.LINES]:2,[ie.TRIANGLES]:3,[ie.LINE_STRIP]:1}[r];this.checkUniforms(R,"RENDER_SHADOWS",this.shadowUniforms);const de=ee&&ee>0?1:void 0;for(const Te of F.get()){const we=Te.vaos||(Te.vaos={});if((we[R]||(we[R]=new Fo)).bind(X,this,D,$?$.getPaintVertexBuffers():[],L,Te.vertexOffset,G||[],de),this.forceManualRenderingForInstanceIDShaders){const Ee=ee||1;for(let ve=0;ve<Ee;++ve)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ve),L?ie.drawElements(r,Te.primitiveLength*ce,ie.UNSIGNED_SHORT,Te.primitiveOffset*ce*2):ie.drawArrays(r,Te.vertexOffset,Te.vertexLength)}else ee&&ee>1?ie.drawElementsInstanced(r,Te.primitiveLength*ce,ie.UNSIGNED_SHORT,Te.primitiveOffset*ce*2,ee):L?ie.drawElements(r,Te.primitiveLength*ce,ie.UNSIGNED_SHORT,Te.primitiveOffset*ce*2):ie.drawArrays(r,Te.vertexOffset,Te.vertexLength);r===ie.TRIANGLES&&L&&this._drawDebugWireframe(t,c,m,_,L,Te,k,H,$,ee)}}}function Ql(u,t,r=0){const c=Math.pow(2,t.tileID.overscaledZ),m=t.tileSize*Math.pow(2,u.transform.tileZoom)/c,_=m*(t.tileID.canonical.x+t.tileID.wrap*c),w=m*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(t,1,u.transform.tileZoom),u_pixel_coord_upper:[_>>16,w>>16],u_pixel_coord_lower:[65535&_,65535&w],u_pattern_transition:r}}const gl={terrain:0,flat:1},Cd=s.bC(),_l=(u,t,r,c,m,_,w,E,R,D,L,F,k,H,$,G,ee,X)=>{const ie=t.style.light,ce=ie.properties.get("position"),de=[ce.x,ce.y,ce.z],Te=s.dL();ie.properties.get("anchor")==="viewport"&&(s.dM(Te,-t.transform.angle),s.dN(de,de,Te));const we=ie.properties.get("color").toPremultipliedRenderColor(null),Ee=t.transform,ve={u_matrix:u,u_lightpos:de,u_lightintensity:ie.properties.get("intensity"),u_lightcolor:[we.r,we.g,we.b],u_vertical_gradient:+r,u_opacity:c,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Cd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:gl[D],u_base_type:gl[L],u_ao:m,u_edge_radius:_,u_width_scale:w,u_flood_light_color:$,u_vertical_scale:G,u_flood_light_intensity:ee,u_ground_shadow_factor:X};return Ee.projection.name==="globe"&&(ve.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],ve.u_zoom_transition=F,ve.u_inv_rot_matrix=H,ve.u_merc_center=k,ve.u_up_dir=Ee.projection.upVector(new s.cC(0,0,0),k[0]*s.al,k[1]*s.al),ve.u_height_lift=R),ve},Uc=(u,t,r,c,m,_)=>({u_matrix:u,u_edge_radius:t,u_width_scale:r,u_vertical_scale:c,u_height_type:gl[m],u_base_type:gl[_]}),Um=(u,t,r,c,m,_,w,E,R,D,L,F,k,H,$,G,ee,X)=>{const ie=_l(u,t,r,c,m,_,w,E,D,L,F,k,H,$,G,ee,1,[0,0,0]),ce={u_height_factor:-Math.pow(2,E.overscaledZ)/R.tileSize/8};return Object.assign(ie,Ql(t,R,X),ce)},Cf=(u,t,r)=>({u_matrix:u,u_emissive_strength:t,u_ground_shadow_factor:r}),Au=(u,t,r,c,m,_=0)=>Object.assign(Cf(u,t,m),Ql(r,c,_)),Vm=(u,t,r,c)=>({u_matrix:u,u_world:r,u_emissive_strength:t,u_ground_shadow_factor:c}),Cu=(u,t,r,c,m,_,w=0)=>Object.assign(Au(u,t,r,c,_,w),{u_world:m}),jp=(u,t)=>({u_matrix:u,u_ground_shadow_factor:t}),Ru=(u,t,r,c,m)=>({u_matrix:u,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:r,u_height_scale:c,u_reset_depth:m}),Hm=(u,t,r,c,m,_,w)=>({u_matrix:u,u_normal_matrix:t,u_opacity:r,u_faux_facade_ao_intensity:c,u_camera_pos:m,u_tile_to_meter:_,u_facade_emissive_chance:w}),Vc=u=>({u_matrix:u}),Jn=u=>({u_matrix:u}),kr=(u,t,r,c,m,_,w,E)=>{const R=s.al/_.tileSize;return{u_matrix:u,u_inv_rot_matrix:t,u_camera_to_center_distance:r.getCameraToCenterDistance(E),u_extrude_scale:[r.pixelsToGLUnits[0]/R,r.pixelsToGLUnits[1]/R],u_zoom_transition:c,u_tile_id:w,u_merc_center:m}},ps=(u,t,r=1)=>({u_matrix:u,u_color:t,u_overlay:0,u_overlay_scale:r}),ec=s.bC(),Mu=(u,t,r,c,m,_,w)=>{const E=u.transform,R=E.projection.name==="globe",D=R?s.dO(E.zoom,t.canonical)*E._pixelsPerMercatorPixel:s.ay(r,1,_),L={u_matrix:t.projMatrix,u_extrude_scale:D,u_intensity:w,u_inv_rot_matrix:ec,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){L.u_inv_rot_matrix=c,L.u_merc_center=m,L.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],L.u_zoom_transition=s.aj(E.zoom);const F=m[0]*s.al,k=m[1]*s.al;L.u_up_dir=E.projection.upVector(new s.cC(0,0,0),F,k)}return L};function tc(u,[t,r,c,m],[_,w]){if(_===w)return[0,0,0,0];const E=255*(u-1)/(u*(w-_));return[t*E,r*E,c*E,m*E]}function Eh(u,t,[r,c]){return r===c?0:.5/u+(t-r)*(u-1)/(u*(c-r))}const Hc=(u,t,r,c,m,_,w,E,R,D,L,F,k,H,$,G,ee,X,ie,ce,de)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:c,u_grid_matrix:m,u_tl_parent:_,u_scale_parent:D,u_fade_t:L.mix,u_opacity:L.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:s.dQ(F.paint.get("raster-saturation")),u_contrast_factor:s.dP(F.paint.get("raster-contrast")),u_spin_weights:Eo(F.paint.get("raster-hue-rotate")),u_perspective_transform:k,u_raster_elevation:H,u_zoom_transition:w,u_merc_center:E,u_cutoff_params:R,u_colorization_mix:tc(s.dR,G,X),u_colorization_offset:Eh(s.dR,ee,X),u_color_ramp:$,u_texture_offset:[ce/(ie+2*ce),ie/(ie+2*ce)],u_texture_res:[ie+2*ce,ie+2*ce],u_emissive_strength:de});function Eo(u){u*=Math.PI/180;const t=Math.sin(u),r=Math.cos(u);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const Iu=.05,Hr=(u,t,r,c,m,_,w,E,R,D,L,F)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:c,u_grid_matrix:m,u_tl_parent:_,u_scale_parent:D,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:w,u_merc_center:E,u_cutoff_params:R}),Rd=(u,t,r,c,m,_,w,E,R,D)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_tile_offset:r,u_velocity:c,u_color_ramp:_,u_velocity_res:m,u_max_speed:w,u_uv_offset:E,u_data_scale:[255*R[0],255*R[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[Iu,Iu]}),Ah=(u,t,r,c,m,_,w,E,R,D)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_velocity:r,u_velocity_res:c,u_max_speed:m,u_speed_factor:_,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:E,u_data_scale:[255*R[0],255*R[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[Iu,Iu]}),Rf=s.bC(),Mf=(u,t,r,c,m,_,w,E,R,D,L,F,k,H,$,G,ee,X,ie,ce,de,Te,we,Ee)=>{const ve=m.transform,be={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ve.getCameraToCenterDistance(ie),u_rotate_symbol:+r,u_aspect_ratio:ve.width/ve.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:w,u_coord_matrix:E,u_is_text:+D,u_elevation_from_sea:R?1:0,u_pitch_with_map:+c,u_texsize:L,u_texsize_icon:F,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Rf,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Rf,u_up_vector:[0,-1,0],u_color_adj_mat:Te,u_icon_transition:we||0,u_gamma_scale:c?m.transform.getCameraToCenterDistance(ie)*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:s.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ee||1,u_ground_shadow_factor:ce,u_inv_matrix:s.bl(s.bC(),w),u_normal_scale:de,u_lutTexture:$r.LUT};return ie.name==="globe"&&(be.u_tile_id=[H.canonical.x,H.canonical.y,1<<H.canonical.z],be.u_zoom_transition=$,be.u_inv_rot_matrix=ee,be.u_merc_center=G,be.u_camera_forward=ve._camera.forward(),be.u_ecef_origin=s.dS(ve.globeMatrix,H.toUnwrapped()),be.u_tile_matrix=Float32Array.from(ve.globeMatrix),be.u_up_vector=X),be},If=(u,t,r,c)=>({u_matrix:u,u_emissive_strength:t,u_opacity:r,u_color:c}),Ch=(u,t,r,c,m,_,w,E,R)=>Object.assign(function(D,L,F,k,H,$){const{width:G,height:ee}=k.imageManager.getPixelSize(L),X=Math.pow(2,$.tileID.overscaledZ),ie=$.tileSize*Math.pow(2,k.transform.tileZoom)/X,ce=ie*($.tileID.canonical.x+$.tileID.wrap*X),de=ie*$.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[G,ee],u_pattern_size:F.displaySize,u_pattern_units_to_pixels:H?[k.transform.width,-1*k.transform.height]:[1/s.ay($,1,k.transform.tileZoom),1/s.ay($,1,k.transform.tileZoom)],u_pixel_coord_upper:[ce>>16,de>>16],u_pixel_coord_lower:[65535&ce,65535&de]}}(0,_,w,c,E,R),{u_matrix:u,u_emissive_strength:t,u_opacity:r}),Md=new Float32Array(s.bA([])),Rh=(u,t,r,c,m,_,w,E,R,D,L,F,k,H=[0,0,0],$)=>{const G=m.style.light,ee=G.properties.get("position"),X=[-ee.x,-ee.y,ee.z],ie=s.dL();G.properties.get("anchor")==="viewport"&&(s.dM(ie,-m.transform.angle),s.dN(X,X,ie));const ce=L.alphaMode==="MASK",de=G.properties.get("color").toNonPremultipliedRenderColor(null),Te=k.paint.get("model-ambient-occlusion-intensity"),we=k.paint.get("model-color").constantOr(s.ao.white).toNonPremultipliedRenderColor(null);return we.a=k.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:u,u_lighting_matrix:t,u_normal_matrix:r,u_node_matrix:c||Md,u_lightpos:X,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_camera_pos:H,u_opacity:_,u_baseTextureIsAlpha:0,u_alphaMask:+ce,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:w.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:R,u_roughnessFactor:D,u_baseColorTexture:$r.BaseColor,u_metallicRoughnessTexture:$r.MetallicRoughness,u_normalTexture:$r.Normal,u_occlusionTexture:$r.Occlusion,u_emissionTexture:$r.Emission,u_lutTexture:$r.LUT,u_color_mix:we.toArray01(),u_aoIntensity:Te,u_emissive_strength:F,u_occlusionTextureTransform:$||[0,0,0,0]}},ks=(u,t=Md,r=Md)=>({u_matrix:u,u_instance:t,u_node_matrix:r}),Cs={fillExtrusion:u=>({u_matrix:new s.ck(u),u_lightpos:new s.ch(u),u_lightintensity:new s.ci(u),u_lightcolor:new s.ch(u),u_vertical_gradient:new s.ci(u),u_opacity:new s.ci(u),u_edge_radius:new s.ci(u),u_width_scale:new s.ci(u),u_ao:new s.cj(u),u_height_type:new s.cg(u),u_base_type:new s.cg(u),u_tile_id:new s.ch(u),u_zoom_transition:new s.ci(u),u_inv_rot_matrix:new s.ck(u),u_merc_center:new s.cj(u),u_up_dir:new s.ch(u),u_height_lift:new s.ci(u),u_flood_light_color:new s.ch(u),u_vertical_scale:new s.ci(u),u_flood_light_intensity:new s.ci(u),u_ground_shadow_factor:new s.ch(u)}),fillExtrusionDepth:u=>({u_matrix:new s.ck(u),u_edge_radius:new s.ci(u),u_width_scale:new s.ci(u),u_vertical_scale:new s.ci(u),u_height_type:new s.cg(u),u_base_type:new s.cg(u)}),fillExtrusionPattern:u=>({u_matrix:new s.ck(u),u_lightpos:new s.ch(u),u_lightintensity:new s.ci(u),u_lightcolor:new s.ch(u),u_vertical_gradient:new s.ci(u),u_height_factor:new s.ci(u),u_edge_radius:new s.ci(u),u_width_scale:new s.ci(u),u_ao:new s.cj(u),u_height_type:new s.cg(u),u_base_type:new s.cg(u),u_tile_id:new s.ch(u),u_zoom_transition:new s.ci(u),u_inv_rot_matrix:new s.ck(u),u_merc_center:new s.cj(u),u_up_dir:new s.ch(u),u_height_lift:new s.ci(u),u_image:new s.cg(u),u_texsize:new s.cj(u),u_pixel_coord_upper:new s.cj(u),u_pixel_coord_lower:new s.cj(u),u_tile_units_to_pixels:new s.ci(u),u_opacity:new s.ci(u),u_pattern_transition:new s.ci(u)}),fillExtrusionGroundEffect:u=>({u_matrix:new s.ck(u),u_opacity:new s.ci(u),u_ao_pass:new s.ci(u),u_meter_to_tile:new s.ci(u),u_ao:new s.cj(u),u_flood_light_intensity:new s.ci(u),u_flood_light_color:new s.ch(u),u_attenuation:new s.ci(u),u_edge_radius:new s.ci(u),u_fb:new s.cg(u),u_fb_size:new s.ci(u),u_dynamic_offset:new s.ci(u)}),fill:u=>({u_matrix:new s.ck(u),u_emissive_strength:new s.ci(u),u_ground_shadow_factor:new s.ch(u)}),fillPattern:u=>({u_matrix:new s.ck(u),u_emissive_strength:new s.ci(u),u_image:new s.cg(u),u_texsize:new s.cj(u),u_pixel_coord_upper:new s.cj(u),u_pixel_coord_lower:new s.cj(u),u_tile_units_to_pixels:new s.ci(u),u_ground_shadow_factor:new s.ch(u),u_pattern_transition:new s.ci(u)}),fillOutline:u=>({u_matrix:new s.ck(u),u_emissive_strength:new s.ci(u),u_world:new s.cj(u),u_ground_shadow_factor:new s.ch(u)}),fillOutlinePattern:u=>({u_matrix:new s.ck(u),u_emissive_strength:new s.ci(u),u_world:new s.cj(u),u_image:new s.cg(u),u_texsize:new s.cj(u),u_pixel_coord_upper:new s.cj(u),u_pixel_coord_lower:new s.cj(u),u_tile_units_to_pixels:new s.ci(u),u_ground_shadow_factor:new s.ch(u),u_pattern_transition:new s.ci(u)}),building:u=>({u_matrix:new s.ck(u),u_normal_matrix:new s.ck(u),u_opacity:new s.ci(u),u_faux_facade_ao_intensity:new s.ci(u),u_camera_pos:new s.ch(u),u_tile_to_meter:new s.ci(u),u_facade_emissive_chance:new s.ci(u)}),buildingBloom:u=>({u_matrix:new s.ck(u)}),buildingDepth:u=>({u_matrix:new s.ck(u)}),elevatedStructuresDepth:u=>({u_matrix:new s.ck(u),u_depth_bias:new s.ci(u)}),elevatedStructures:u=>({u_matrix:new s.ck(u),u_ground_shadow_factor:new s.ch(u)}),elevatedStructuresDepthReconstruct:u=>({u_matrix:new s.ck(u),u_camera_pos:new s.ch(u),u_depth_bias:new s.ci(u),u_height_scale:new s.ci(u),u_reset_depth:new s.ci(u)}),circle:s.dV,collisionBox:u=>({u_matrix:new s.ck(u),u_inv_rot_matrix:new s.ck(u),u_camera_to_center_distance:new s.ci(u),u_extrude_scale:new s.cj(u),u_zoom_transition:new s.ci(u),u_merc_center:new s.cj(u),u_tile_id:new s.ch(u)}),collisionCircle:u=>({u_matrix:new s.ck(u),u_inv_matrix:new s.ck(u),u_camera_to_center_distance:new s.ci(u),u_viewport_size:new s.cj(u)}),debug:u=>({u_color:new s.dx(u),u_matrix:new s.ck(u),u_overlay:new s.cg(u),u_overlay_scale:new s.ci(u)}),clippingMask:u=>({u_matrix:new s.ck(u)}),heatmap:u=>({u_extrude_scale:new s.ci(u),u_intensity:new s.ci(u),u_matrix:new s.ck(u),u_inv_rot_matrix:new s.ck(u),u_merc_center:new s.cj(u),u_tile_id:new s.ch(u),u_zoom_transition:new s.ci(u),u_up_dir:new s.ch(u)}),heatmapTexture:u=>({u_image:new s.cg(u),u_color_ramp:new s.cg(u),u_opacity:new s.ci(u)}),hillshade:u=>({u_matrix:new s.ck(u),u_image:new s.cg(u),u_latrange:new s.cj(u),u_light:new s.cj(u),u_shadow:new s.dx(u),u_highlight:new s.dx(u),u_emissive_strength:new s.ci(u),u_accent:new s.dx(u)}),hillshadePrepare:u=>({u_matrix:new s.ck(u),u_image:new s.cg(u),u_dimension:new s.cj(u),u_zoom:new s.ci(u)}),line:s.dU,linePattern:s.dT,raster:u=>({u_matrix:new s.ck(u),u_normalize_matrix:new s.ck(u),u_globe_matrix:new s.ck(u),u_merc_matrix:new s.ck(u),u_grid_matrix:new s.dy(u),u_tl_parent:new s.cj(u),u_scale_parent:new s.ci(u),u_fade_t:new s.ci(u),u_opacity:new s.ci(u),u_image0:new s.cg(u),u_image1:new s.cg(u),u_brightness_low:new s.ci(u),u_brightness_high:new s.ci(u),u_saturation_factor:new s.ci(u),u_contrast_factor:new s.ci(u),u_spin_weights:new s.ch(u),u_perspective_transform:new s.cj(u),u_raster_elevation:new s.ci(u),u_zoom_transition:new s.ci(u),u_merc_center:new s.cj(u),u_cutoff_params:new s.d2(u),u_colorization_mix:new s.d2(u),u_colorization_offset:new s.ci(u),u_color_ramp:new s.cg(u),u_texture_offset:new s.cj(u),u_texture_res:new s.cj(u),u_emissive_strength:new s.ci(u)}),rasterParticle:u=>({u_matrix:new s.ck(u),u_normalize_matrix:new s.ck(u),u_globe_matrix:new s.ck(u),u_merc_matrix:new s.ck(u),u_grid_matrix:new s.dy(u),u_tl_parent:new s.cj(u),u_scale_parent:new s.ci(u),u_fade_t:new s.ci(u),u_opacity:new s.ci(u),u_image0:new s.cg(u),u_image1:new s.cg(u),u_raster_elevation:new s.ci(u),u_zoom_transition:new s.ci(u),u_merc_center:new s.cj(u),u_cutoff_params:new s.d2(u)}),rasterParticleTexture:u=>({u_texture:new s.cg(u),u_opacity:new s.ci(u)}),rasterParticleDraw:u=>({u_particle_texture:new s.cg(u),u_particle_texture_side_len:new s.ci(u),u_tile_offset:new s.cj(u),u_velocity:new s.cg(u),u_color_ramp:new s.cg(u),u_velocity_res:new s.cj(u),u_max_speed:new s.ci(u),u_uv_offset:new s.cj(u),u_data_scale:new s.cj(u),u_data_offset:new s.ci(u),u_particle_pos_scale:new s.ci(u),u_particle_pos_offset:new s.cj(u)}),rasterParticleUpdate:u=>({u_particle_texture:new s.cg(u),u_particle_texture_side_len:new s.ci(u),u_velocity:new s.cg(u),u_velocity_res:new s.cj(u),u_max_speed:new s.ci(u),u_speed_factor:new s.ci(u),u_reset_rate:new s.ci(u),u_rand_seed:new s.ci(u),u_uv_offset:new s.cj(u),u_data_scale:new s.cj(u),u_data_offset:new s.ci(u),u_particle_pos_scale:new s.ci(u),u_particle_pos_offset:new s.cj(u)}),symbol:u=>({u_is_size_zoom_constant:new s.cg(u),u_is_size_feature_constant:new s.cg(u),u_size_t:new s.ci(u),u_size:new s.ci(u),u_camera_to_center_distance:new s.ci(u),u_rotate_symbol:new s.cg(u),u_aspect_ratio:new s.ci(u),u_fade_change:new s.ci(u),u_matrix:new s.ck(u),u_label_plane_matrix:new s.ck(u),u_coord_matrix:new s.ck(u),u_is_text:new s.cg(u),u_elevation_from_sea:new s.cg(u),u_pitch_with_map:new s.cg(u),u_texsize:new s.cj(u),u_texsize_icon:new s.cj(u),u_texture:new s.cg(u),u_texture_icon:new s.cg(u),u_gamma_scale:new s.ci(u),u_device_pixel_ratio:new s.ci(u),u_tile_id:new s.ch(u),u_zoom_transition:new s.ci(u),u_inv_rot_matrix:new s.ck(u),u_merc_center:new s.cj(u),u_camera_forward:new s.ch(u),u_tile_matrix:new s.ck(u),u_up_vector:new s.ch(u),u_ecef_origin:new s.ch(u),u_is_halo:new s.cg(u),u_icon_transition:new s.ci(u),u_color_adj_mat:new s.ck(u),u_scale_factor:new s.ci(u),u_ground_shadow_factor:new s.ch(u),u_inv_matrix:new s.ck(u),u_normal_scale:new s.ci(u),u_lutTexture:new s.cg(u)}),background:u=>({u_matrix:new s.ck(u),u_emissive_strength:new s.ci(u),u_opacity:new s.ci(u),u_color:new s.dx(u)}),backgroundPattern:u=>({u_matrix:new s.ck(u),u_emissive_strength:new s.ci(u),u_opacity:new s.ci(u),u_image:new s.cg(u),u_pattern_tl:new s.cj(u),u_pattern_br:new s.cj(u),u_texsize:new s.cj(u),u_pattern_size:new s.cj(u),u_pixel_coord_upper:new s.cj(u),u_pixel_coord_lower:new s.cj(u),u_pattern_units_to_pixels:new s.cj(u)}),terrainRaster:u=>({u_matrix:new s.ck(u),u_image0:new s.cg(u),u_skirt_height:new s.ci(u),u_ground_shadow_factor:new s.ch(u)}),skybox:u=>({u_matrix:new s.ck(u),u_sun_direction:new s.ch(u),u_cubemap:new s.cg(u),u_opacity:new s.ci(u),u_temporal_offset:new s.ci(u)}),skyboxGradient:u=>({u_matrix:new s.ck(u),u_color_ramp:new s.cg(u),u_center_direction:new s.ch(u),u_radius:new s.ci(u),u_opacity:new s.ci(u),u_temporal_offset:new s.ci(u)}),skyboxCapture:u=>({u_matrix_3f:new s.dy(u),u_sun_direction:new s.ch(u),u_sun_intensity:new s.ci(u),u_color_tint_r:new s.d2(u),u_color_tint_m:new s.d2(u),u_luminance:new s.ci(u)}),globeRaster:u=>({u_proj_matrix:new s.ck(u),u_globe_matrix:new s.ck(u),u_normalize_matrix:new s.ck(u),u_merc_matrix:new s.ck(u),u_zoom_transition:new s.ci(u),u_merc_center:new s.cj(u),u_image0:new s.cg(u),u_grid_matrix:new s.dy(u),u_skirt_height:new s.ci(u),u_far_z_cutoff:new s.ci(u),u_frustum_tl:new s.ch(u),u_frustum_tr:new s.ch(u),u_frustum_br:new s.ch(u),u_frustum_bl:new s.ch(u),u_globe_pos:new s.ch(u),u_globe_radius:new s.ci(u),u_viewport:new s.cj(u)}),globeAtmosphere:u=>({u_frustum_tl:new s.ch(u),u_frustum_tr:new s.ch(u),u_frustum_br:new s.ch(u),u_frustum_bl:new s.ch(u),u_horizon:new s.ci(u),u_transition:new s.ci(u),u_fadeout_range:new s.ci(u),u_atmosphere_fog_color:new s.d2(u),u_high_color:new s.d2(u),u_space_color:new s.d2(u),u_temporal_offset:new s.ci(u),u_horizon_angle:new s.ci(u)}),model:u=>({u_matrix:new s.ck(u),u_lighting_matrix:new s.ck(u),u_normal_matrix:new s.ck(u),u_node_matrix:new s.ck(u),u_lightpos:new s.ch(u),u_lightintensity:new s.ci(u),u_lightcolor:new s.ch(u),u_camera_pos:new s.ch(u),u_opacity:new s.ci(u),u_baseColorFactor:new s.d2(u),u_emissiveFactor:new s.d2(u),u_metallicFactor:new s.ci(u),u_roughnessFactor:new s.ci(u),u_baseTextureIsAlpha:new s.cg(u),u_alphaMask:new s.cg(u),u_alphaCutoff:new s.ci(u),u_baseColorTexture:new s.cg(u),u_metallicRoughnessTexture:new s.cg(u),u_normalTexture:new s.cg(u),u_occlusionTexture:new s.cg(u),u_emissionTexture:new s.cg(u),u_lutTexture:new s.cg(u),u_color_mix:new s.d2(u),u_aoIntensity:new s.ci(u),u_emissive_strength:new s.ci(u),u_occlusionTextureTransform:new s.d2(u)}),modelDepth:u=>({u_matrix:new s.ck(u),u_instance:new s.ck(u),u_node_matrix:new s.ck(u)}),groundShadow:u=>({u_matrix:new s.ck(u),u_ground_shadow_factor:new s.ch(u)}),stars:u=>({u_matrix:new s.ck(u),u_up:new s.ch(u),u_right:new s.ch(u),u_intensity_multiplier:new s.ci(u)}),snowParticle:u=>({u_modelview:new s.ck(u),u_projection:new s.ck(u),u_time:new s.ci(u),u_cam_pos:new s.ch(u),u_velocityConeAperture:new s.ci(u),u_velocity:new s.ci(u),u_horizontalOscillationRadius:new s.ci(u),u_horizontalOscillationRate:new s.ci(u),u_boxSize:new s.ci(u),u_billboardSize:new s.ci(u),u_simpleShapeParameters:new s.cj(u),u_screenSize:new s.cj(u),u_thinningCenterPos:new s.cj(u),u_thinningShape:new s.ch(u),u_thinningAffectedRatio:new s.ci(u),u_thinningParticleOffset:new s.ci(u),u_particleColor:new s.d2(u),u_direction:new s.ch(u)}),rainParticle:u=>({u_modelview:new s.ck(u),u_projection:new s.ck(u),u_time:new s.ci(u),u_cam_pos:new s.ch(u),u_texScreen:new s.cg(u),u_velocityConeAperture:new s.ci(u),u_velocity:new s.ci(u),u_boxSize:new s.ci(u),u_rainDropletSize:new s.cj(u),u_distortionStrength:new s.ci(u),u_rainDirection:new s.ch(u),u_color:new s.d2(u),u_screenSize:new s.cj(u),u_thinningCenterPos:new s.cj(u),u_thinningShape:new s.ch(u),u_thinningAffectedRatio:new s.ci(u),u_thinningParticleOffset:new s.ci(u),u_shapeDirectionalPower:new s.ci(u),u_shapeNormalPower:new s.ci(u),u_mode:new s.ci(u)}),vignette:u=>({u_vignetteShape:new s.ch(u),u_vignetteColor:new s.d2(u)}),occlusion:u=>({u_matrix:new s.ck(u),u_anchorPos:new s.ch(u),u_screenSizePx:new s.cj(u),u_occluderSizePx:new s.cj(u),u_color:new s.d2(u)})};class qo{constructor(t,r,c,m){this.id=qo.uniqueIdxCounter,qo.uniqueIdxCounter++,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||m||r.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=qo.uniqueIdxCounter,qo.uniqueIdxCounter++;const r=this.context.gl;this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}qo.uniqueIdxCounter=0;const Mh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zf{constructor(t,r,c,m,_,w){this.length=r.length,this.attributes=c,this.itemSize=r.bytesPerElement,this.dynamicDraw=m,this.instanceCount=w,this.context=t;const E=t.gl;this.buffer=E.createBuffer(),t.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||_||r.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let c=0;c<this.attributes.length;c++){const m=r.getAttributeLocation(t,this.attributes[c].name);m!==-1&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,r,c){for(let m=0;m<this.attributes.length;m++){const _=this.attributes[m],w=r.getAttributeLocation(t,_.name);w!==-1&&t.vertexAttribPointer(w,_.components,t[Mh[_.type]],!1,this.itemSize,_.offset+this.itemSize*(c||0))}}setVertexAttribDivisor(t,r,c){for(let m=0;m<this.attributes.length;m++){const _=r.getAttributeLocation(t,this.attributes[m].name);_!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(_,c)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ih{constructor(t,r,c,m,_){this.context=t,this.width=r,this.height=c;const w=this.framebuffer=t.gl.createFramebuffer();m&&(this.colorAttachment=new kp(t,w)),_&&(this.depthAttachmentType=_,this.depthAttachment=_==="renderbuffer"?new jc(t,w):new Fm(t,w))}destroy(){const t=this.context.gl;if(this.colorAttachment){const r=this.colorAttachment.get();r&&t.deleteTexture(r)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r)}else{const r=this.depthAttachment.get();r&&t.deleteTexture(r)}t.deleteFramebuffer(this.framebuffer)}}class Go{constructor(t,r){this.gl=t,this.clearColor=new ul(this),this.clearDepth=new Uo(this),this.clearStencil=new Su(this),this.colorMask=new Bm(this),this.depthMask=new Dp(this),this.stencilMask=new Pp(this),this.stencilFunc=new xa(this),this.stencilOp=new na(this),this.stencilTest=new xr(this),this.depthRange=new Vo(this),this.depthTest=new Ho(this),this.depthFunc=new vd(this),this.blend=new hl(this),this.blendFunc=new Sf(this),this.blendColor=new Lc(this),this.blendEquation=new dl(this),this.cullFace=new Oc(this),this.cullFaceSide=new kc(this),this.frontFace=new fl(this),this.program=new Lp(this),this.activeTexture=new bd(this),this.viewport=new Op(this),this.bindFramebuffer=new Xl(this),this.bindRenderbuffer=new wd(this),this.bindTexture=new Nc(this),this.bindVertexBuffer=new Ef(this),this.bindElementBuffer=new Yl(this),this.bindVertexArrayOES=new Kl(this),this.pixelStoreUnpack=new Td(this),this.pixelStoreUnpackPremultiplyAlpha=new vh(this),this.pixelStoreUnpackFlipY=new Sd(this),this.options=r?Object.assign({},r):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=r&&!!r.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r,c){return new qo(this,t,r,c)}createVertexBuffer(t,r,c,m,_){return new zf(this,t,r,c,m,_)}createRenderbuffer(t,r,c){const m=this.gl,_=m.createRenderbuffer();return this.bindRenderbuffer.set(_),m.renderbufferStorage(m.RENDERBUFFER,t,r,c),this.bindRenderbuffer.set(null),_}createFramebuffer(t,r,c,m){return new Ih(this,t,r,c,m)}clear({color:t,depth:r,stencil:c,colorMask:m}){const _=this.gl;let w=0;t&&(w|=_.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(m||[!0,!0,!0,!0])),r!==void 0&&(w|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),c!==void 0&&(w|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),_.clear(w)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.by(t.blendFunction,tn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let so;function zu(u,t,r,c,m,_,w){const E=u.context,R=E.gl,D=u.transform,L=[s.aF(D.center.lng),s.aJ(D.center.lat)],F=r.layout.get("symbol-placement"),k=r.layout.get("text-variable-anchor"),H=r.layout.get("icon-rotation-alignment")==="map",$=r.layout.get("text-rotation-alignment")==="map",G=F!=="point",ee=[];let X=0,ie=0;for(let be=0;be<c.length;be++){const Ce=c[be],We=t.getTile(Ce),je=We.getBucket(r);if(!je)continue;const ct=je.getProjection().createInversionMatrix(D,Ce.canonical),Ze=[],ot=Ca(Ce,je,D),jt=!w&&H&&G,Ye=w&&$&&G,Oe=k&&je.hasTextData(),nt=je.hasIconTextFit()&&Oe&&je.hasIconData(),Ge=jt||Ye||w&&Oe||nt,ht=je.projection.name==="globe",_t=ht?s.aj(D.zoom):0;ht&&(Ze.push("PROJECTION_GLOBE_VIEW"),Ge&&Ze.push("PROJECTED_POS_ON_VIEWPORT"));const qt=u.getOrCreateProgram("collisionBox",{defines:Ze});let Ct=ot;m[0]===0&&m[1]===0||(Ct=u.translatePosMatrix(ot,We,m,_));const Tt=w?je.textCollisionBox:je.iconCollisionBox,gi=je.collisionCircleArray;if(gi.length>0){const ei=s.bC(),li=Ct;s.cO(ei,je.placementInvProjMatrix,D.glCoordMatrix),s.cO(ei,ei,je.placementViewportMatrix),ee.push({circleArray:gi,circleOffset:ie,transform:li,invTransform:ei,projection:je.getProjection()}),X+=gi.length/4,ie=X}if(!Tt)continue;u.terrain&&u.terrain.setupElevationDraw(We,qt);const oi=ht?[Ce.canonical.x,Ce.canonical.y,1<<Ce.canonical.z]:[0,0,0];qt.draw(u,R.LINES,ni.disabled,Ci.disabled,u.colorModeForRenderPass(),Ni.disabled,kr(Ct,ct,D,_t,L,We,oi,je.getProjection()),r.id,Tt.layoutVertexBuffer,Tt.indexBuffer,Tt.segments,null,D.zoom,null,[Tt.collisionVertexBuffer,Tt.collisionVertexBufferExt])}if(!w||!ee.length)return;const ce=u.getOrCreateProgram("collisionCircle"),de=new s.dW;de.resize(4*X),de._trim();let Te=0;for(const be of ee)for(let Ce=0;Ce<be.circleArray.length/4;Ce++){const We=4*Ce,je=be.circleArray[We+0],ct=be.circleArray[We+1],Ze=be.circleArray[We+2],ot=be.circleArray[We+3];de.emplace(Te++,je,ct,Ze,ot,0),de.emplace(Te++,je,ct,Ze,ot,1),de.emplace(Te++,je,ct,Ze,ot,2),de.emplace(Te++,je,ct,Ze,ot,3)}(!so||so.length<2*X)&&(so=function(be){const Ce=2*be,We=new s.b1;We.resize(Ce),We._trim();for(let je=0;je<Ce;je++){const ct=6*je;We.uint16[ct+0]=4*je+0,We.uint16[ct+1]=4*je+1,We.uint16[ct+2]=4*je+2,We.uint16[ct+3]=4*je+2,We.uint16[ct+4]=4*je+3,We.uint16[ct+5]=4*je+0}return We}(X));const we=E.createIndexBuffer(so,!0),Ee=E.createVertexBuffer(de,s.dX.members,!0);for(const be of ee){const Ce={u_matrix:be.transform,u_inv_matrix:be.invTransform,u_camera_to_center_distance:(ve=D).getCameraToCenterDistance(be.projection),u_viewport_size:[ve.width,ve.height]};ce.draw(u,R.TRIANGLES,ni.disabled,Ci.disabled,u.colorModeForRenderPass(),Ni.disabled,Ce,r.id,Ee,we,s.bg.simpleSegment(0,2*be.circleOffset,be.circleArray.length,be.circleArray.length/2),null,D.zoom)}var ve;Ee.destroy(),we.destroy()}const yl=s.bC();function Df(u){const t=u._camera.getWorldToCamera(u.worldSize,1),r=s.aB([],t,u.globeMatrix);s.bl(r,r);const c=[0,0,0],m=[0,1,0,0];return s.aC(m,m,r),c[0]=m[0],c[1]=m[1],c[2]=m[2],s.aw(c,c),c}function Id({width:u,height:t,anchor:r,textOffset:c,textScale:m},_){const{horizontalAlign:w,verticalAlign:E}=s.c0(r),R=-(w-.5)*u,D=-(E-.5)*t,L=s.c1(r,c);return new s.P((R/m+L[0])*_,(D/m+L[1])*_)}function zd(u,t,r,c,m,_,w,E,R,D){const L=u.text.placedSymbolArray,F=u.text.dynamicLayoutVertexArray,k=u.icon.dynamicLayoutVertexArray,H={},$=u.getProjection(),G=Qa(w,$,m),ee=m.elevation,X=$.upVectorScale(w.canonical,m.center.lat,m.worldSize).metersToTile;F.clear();for(let ie=0;ie<L.length;ie++){const ce=L.get(ie),{tileAnchorX:de,tileAnchorY:Te,numGlyphs:we}=ce,Ee=ce.hidden||!ce.crossTileID||u.allowVerticalPlacement&&!ce.placedOrientation?null:c[ce.crossTileID];if(Ee){let ve=0,be=0,Ce=0;if(ee){const nt=ee?ee.getAtTileOffset(w,de,Te):0,[Ge,ht,_t]=$.upVector(w.canonical,de,Te);ve=nt*Ge*X,be=nt*ht*X,Ce=nt*_t*X}let[We,je,ct,Ze]=Fa(ce.projectedAnchorX+ve,ce.projectedAnchorY+be,ce.projectedAnchorZ+Ce,r?G:_);const ot=fu(m.getCameraToCenterDistance($),Ze);let jt=s.bM(u.textSizeData,R,ce)*ot/s.bX;r&&(jt*=u.tilePixelRatio/E);const Ye=Id(Ee,jt);r?({x:We,y:je,z:ct}=$.projectTilePoint(de+Ye.x,Te+Ye.y,w.canonical),[We,je,ct]=Fa(We+ve,je+be,ct+Ce,_)):(t&&Ye._rotate(-m.angle),We+=Ye.x,je+=Ye.y,ct=0);const Oe=u.allowVerticalPlacement&&ce.placedOrientation===s.bL.vertical?Math.PI/2:0;for(let nt=0;nt<we;nt++)s.bO(F,We,je,ct,Oe);D&&ce.associatedIconIndex>=0&&(H[ce.associatedIconIndex]={x:We,y:je,z:ct,angle:Oe})}else zi(we,F)}if(D){k.clear();const ie=u.icon.placedSymbolArray;for(let ce=0;ce<ie.length;ce++){const de=ie.get(ce),{numGlyphs:Te}=de,we=H[ce];if(de.hidden||!we)zi(Te,k);else{const{x:Ee,y:ve,z:be,angle:Ce}=we;for(let We=0;We<Te;We++)s.bO(k,Ee,ve,be,Ce)}}u.icon.dynamicLayoutVertexBuffer.updateData(k)}u.text.dynamicLayoutVertexBuffer.updateData(F)}function zh(u,t,r,c,m,_,w={}){const E=r.paint.get("icon-translate"),R=r.paint.get("text-translate"),D=r.paint.get("icon-translate-anchor"),L=r.paint.get("text-translate-anchor"),F=r.layout.get("icon-rotation-alignment"),k=r.layout.get("text-rotation-alignment"),H=r.layout.get("icon-pitch-alignment"),$=r.layout.get("text-pitch-alignment"),G=r.layout.get("icon-keep-upright"),ee=r.layout.get("text-keep-upright"),X=r.paint.get("icon-color-saturation"),ie=r.paint.get("icon-color-contrast"),ce=r.paint.get("icon-color-brightness-min"),de=r.paint.get("icon-color-brightness-max"),Te=r.layout.get("symbol-elevation-reference")==="sea",we=r.layout.get("icon-image-use-theme")==="none",Ee=u.context,ve=Ee.gl,be=u.transform,Ce=F==="map",We=k==="map",je=H==="map",ct=$==="map",Ze=r.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ot=!1;const jt=u.depthModeForSublayer(0,ni.ReadOnly),Ye=new ni(u.context.gl.LEQUAL,ni.ReadOnly,u.depthRangeFor3D),Oe=[s.aF(be.center.lng),s.aJ(be.center.lat)],nt=r.layout.get("text-variable-anchor"),Ge=be.projection.name==="globe",ht=[],_t=[0,-1,0];for(const qt of c){const Ct=t.getTile(qt),Tt=Ct.getBucket(r);if(!Tt||Tt.projection.name==="mercator"&&Ge||Tt.fullyClipped)continue;const gi=Tt.projection.name==="globe",oi=gi?s.aj(be.zoom):0,ei=Qa(qt,Tt.getProjection(),be),li=be.calculatePixelsToTileUnitsMatrix(Ct),Li=nt&&Tt.hasTextData(),Ki=Tt.hasIconTextFit()&&Li&&Tt.hasIconData(),Hi=Tt.getProjection().createInversionMatrix(be,qt.canonical),zn=(1<<Ct.tileID.canonical.z)*s.al/u.transform.worldSize,qi=ur=>{let Ji=[0,0,0];if(ur){const Pi=u.style.directionalLight,vn=u.style.ambientLight;Pi&&vn&&(Ji=bo(u.style,Pi,vn))}return Ji},_n=ur=>{be.depthOcclusionForSymbolsAndCircles&&(r.hasOcclusionOpacityProperties||u.terrain)&&(ur.push("DEPTH_D24"),ur.push("DEPTH_OCCLUSION"))},On=ur=>{r.lut&&!we&&(r.lut.texture||(r.lut.texture=new s.dY(u.context,r.lut.image,[r.lut.image.height,r.lut.image.height,r.lut.image.height],Ee.gl.RGBA8)),Ee.activeTexture.set(Ee.gl.TEXTURE0+$r.LUT),r.lut.texture&&r.lut.texture.bind(Ee.gl.LINEAR,Ee.gl.CLAMP_TO_EDGE),ur.push("APPLY_LUT_ON_GPU"))},or=()=>{const ur=Ce&&r.layout.get("symbol-placement")!=="point",Ji=[];_n(Ji),On(Ji);const Pi=ur||Ki,vn=Tt.elevationType==="road",Mr=u.shadowRenderer,kn=vn&&je&&!!Mr&&Mr.enabled,Zr=qi(kn),ms=vn&&je&&!u.terrain?Ye:jt,Ga=r.paint.get("icon-image-cross-fade");u.terrainRenderModeElevated()&&je&&Ji.push("PITCH_WITH_MAP_TERRAIN"),gi&&(Ji.push("PROJECTION_GLOBE_VIEW"),Pi&&Ji.push("PROJECTED_POS_ON_VIEWPORT")),Ga>0&&Tt.hasAnySecondaryIcon&&Ji.push("ICON_TRANSITION"),!Tt.icon.zOffsetVertexBuffer||vn&&u.terrain||Ji.push("Z_OFFSET"),X===0&&ie===0&&ce===0&&de===1||Ji.push("COLOR_ADJUSTMENT"),Tt.sdfIcons&&Ji.push("RENDER_SDF"),kn&&Ji.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),vn&&je&&!u.terrain&&Tt.icon.orientationVertexBuffer&&Ji.push("ELEVATED_ROADS");const co=Tt.icon.programConfigurations.get(r.id),gs=u.getOrCreateProgram("symbol",{config:co,defines:Ji}),ca=Ct.imageAtlasTexture?Ct.imageAtlasTexture.size:[0,0],Ws=Tt.iconSizeData,ua=s.bK(Ws,be.zoom),Mo=je||!be.isOrthographic,Dr=eo(ei,Ct.tileID.canonical,je,Ce,be,Tt.getProjection(),li),Nr=du(ei,Ct.tileID.canonical,je,Ce,be,Tt.getProjection(),li),pr=u.translatePosMatrix(Nr,Ct,E,D,!0),Qr=u.translatePosMatrix(ei,Ct,E,D),_s=Pi?yl:Dr,Wr=Ce&&!je&&!ur;let Xs=_t;!Ge&&!be.mercatorFromTransition||Ce||(Xs=Df(be));const el=gi?Xs:_t,Al=r.getColorAdjustmentMatrix(X,ie,ce,de),va=Mf(Ws.kind,ua,Wr,je,u,Qr,_s,pr,Te,!1,ca,[0,0],0,qt,oi,Oe,Hi,el,Tt.getProjection(),Zr,zn,Al,Ga,null),tl=Ct.imageAtlasTexture?Ct.imageAtlasTexture:null,fc=r.layout.get("icon-size").constantOr(0)!==1||Tt.iconsNeedLinear,il=Tt.sdfIcons||u.options.rotating||u.options.zooming||fc||Mo?ve.LINEAR:ve.NEAREST,Zh=Tt.sdfIcons&&r.paint.get("icon-halo-width").constantOr(1)!==0,Cl=u.terrain&&je&&ur?s.bl(s.bC(),Dr):yl;if(ur&&Tt.icon){const La=be.elevation,Rl=La?La.getAtTileOffsetFunc(qt,be.center.lat,be.worldSize,Tt.getProjection()):null,jr=Bl(ei,Ct.tileID.canonical,je,Ce,be,Tt.getProjection(),li);wp(Tt,ei,u,!1,jr,Nr,je,G,Rl,qt)}return{program:gs,buffers:Tt.icon,uniformValues:va,atlasTexture:tl,atlasTextureIcon:null,atlasInterpolation:il,atlasInterpolationIcon:null,isSDF:Tt.sdfIcons,hasHalo:Zh,depthMode:ms,tile:Ct,renderWithShadows:kn,labelPlaneMatrixInv:Cl}},Xi=()=>{const ur=We&&r.layout.get("symbol-placement")!=="point",Ji=[],Pi=ur||nt||Ki,vn=Tt.elevationType==="road",Mr=u.shadowRenderer,kn=vn&&ct&&!!Mr&&Mr.enabled,Zr=qi(kn),ms=vn&&ct&&!u.terrain?Ye:jt;u.terrainRenderModeElevated()&&ct&&Ji.push("PITCH_WITH_MAP_TERRAIN"),gi&&(Ji.push("PROJECTION_GLOBE_VIEW"),Pi&&Ji.push("PROJECTED_POS_ON_VIEWPORT")),!Tt.text.zOffsetVertexBuffer||vn&&u.terrain||Ji.push("Z_OFFSET"),Tt.iconsInText&&Ji.push("RENDER_TEXT_AND_SYMBOL"),Ji.push("RENDER_SDF"),kn&&Ji.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),vn&&ct&&!u.terrain&&Tt.text.orientationVertexBuffer&&Ji.push("ELEVATED_ROADS"),_n(Ji);const Ga=Tt.text.programConfigurations.get(r.id),co=u.getOrCreateProgram("symbol",{config:Ga,defines:Ji});let gs,ca=[0,0],Ws=null;const ua=Tt.textSizeData;Tt.iconsInText&&(ca=Ct.imageAtlasTexture?Ct.imageAtlasTexture.size:[0,0],Ws=Ct.imageAtlasTexture?Ct.imageAtlasTexture:null,gs=ct||!be.isOrthographic||u.options.rotating||u.options.zooming||ua.kind==="composite"||ua.kind==="camera"?ve.LINEAR:ve.NEAREST);const Mo=Ct.glyphAtlasTexture?Ct.glyphAtlasTexture.size:[0,0],Dr=r.layout.get("text-size-scale-range"),Nr=s.aA(u.scaleFactor,Dr[0],Dr[1]),pr=s.bK(ua,be.zoom,Nr),Qr=eo(ei,Ct.tileID.canonical,ct,We,be,Tt.getProjection(),li),_s=du(ei,Ct.tileID.canonical,ct,We,be,Tt.getProjection(),li),Wr=u.translatePosMatrix(_s,Ct,R,L,!0),Xs=u.translatePosMatrix(ei,Ct,R,L),el=Pi?yl:Qr,Al=We&&!ct&&!ur;let va=_t;!Ge&&!be.mercatorFromTransition||We||(va=Df(be));const tl=Mf(ua.kind,pr,Al,ct,u,Xs,el,Wr,Te,!0,Mo,ca,0,qt,oi,Oe,Hi,gi?va:_t,Tt.getProjection(),Zr,zn,null,null,Nr),fc=Ct.glyphAtlasTexture?Ct.glyphAtlasTexture:null,il=ve.LINEAR,Zh=r.paint.get("text-halo-width").constantOr(1)!==0,Cl=u.terrain&&ct&&ur?s.bl(s.bC(),Qr):yl;if(ur&&Tt.text){const La=be.elevation,Rl=La?La.getAtTileOffsetFunc(qt,be.center.lat,be.worldSize,Tt.getProjection()):null,jr=Bl(ei,Ct.tileID.canonical,ct,We,be,Tt.getProjection(),li);wp(Tt,ei,u,!0,jr,_s,ct,ee,Rl,qt)}return{program:co,buffers:Tt.text,uniformValues:tl,atlasTexture:fc,atlasTextureIcon:Ws,atlasInterpolation:il,atlasInterpolationIcon:gs,isSDF:!0,hasHalo:Zh,depthMode:ms,tile:Ct,renderWithShadows:kn,labelPlaneMatrixInv:Cl}},Rn=Tt.icon.segments.get().length,bn=Tt.text.segments.get().length,Dn=Rn&&!w.onlyText?or():null,Qn=bn&&!w.onlyIcons?Xi():null,Er=r.paint.get("icon-opacity").constantOr(1),ns=r.paint.get("text-opacity").constantOr(1);if(Ze&&Tt.canOverlap){ot=!0;const ur=Er&&!w.onlyText?Tt.icon.segments.get():[],Ji=ns&&!w.onlyIcons?Tt.text.segments.get():[];for(const Pi of ur)ht.push({segments:new s.bg([Pi]),sortKey:Pi.sortKey,state:Dn});for(const Pi of Ji)ht.push({segments:new s.bg([Pi]),sortKey:Pi.sortKey,state:Qn})}else w.onlyText||ht.push({segments:Er?Tt.icon.segments:new s.bg([]),sortKey:0,state:Dn}),w.onlyIcons||ht.push({segments:ns?Tt.text.segments:new s.bg([]),sortKey:0,state:Qn})}ot&&ht.sort((qt,Ct)=>qt.sortKey-Ct.sortKey);for(const qt of ht){const Ct=qt.state;if(Ct)if(u.terrain?u.terrain.setupElevationDraw(Ct.tile,Ct.program,{useDepthForOcclusion:be.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ct.labelPlaneMatrixInv}):u.setupDepthForOcclusion(be.depthOcclusionForSymbolsAndCircles,Ct.program),Ee.activeTexture.set(ve.TEXTURE0),Ct.atlasTexture&&Ct.atlasTexture.bind(Ct.atlasInterpolation,ve.CLAMP_TO_EDGE,!0),Ct.atlasTextureIcon&&(Ee.activeTexture.set(ve.TEXTURE1),Ct.atlasTextureIcon&&Ct.atlasTextureIcon.bind(Ct.atlasInterpolationIcon,ve.CLAMP_TO_EDGE,!0)),Ct.renderWithShadows&&u.shadowRenderer.setupShadows(Ct.tile.tileID.toUnwrapped(),Ct.program,"vector-tile"),u.uploadCommonLightUniforms(u.context,Ct.program),Ct.hasHalo){const Tt=Ct.uniformValues;Tt.u_is_halo=1,Dd(Ct.buffers,qt.segments,r,u,Ct.program,Ct.depthMode,m,_,Tt,2),Tt.u_is_halo=0}else{if(Ct.isSDF){const Tt=Ct.uniformValues;Ct.hasHalo&&(Tt.u_is_halo=1,Dd(Ct.buffers,qt.segments,r,u,Ct.program,Ct.depthMode,m,_,Tt,1)),Tt.u_is_halo=0}Dd(Ct.buffers,qt.segments,r,u,Ct.program,Ct.depthMode,m,_,Ct.uniformValues,1)}}}function Dd(u,t,r,c,m,_,w,E,R,D){const L=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.iconTransitioningVertexBuffer,u.globeExtVertexBuffer,u.zOffsetVertexBuffer,u.orientationVertexBuffer];m.draw(c,c.context.gl.TRIANGLES,_,w,E,Ni.disabled,R,r.id,u.layoutVertexBuffer,u.indexBuffer,t,r.paint,c.transform.zoom,u.programConfigurations.get(r.id),L,D)}function Bp(u,t){const r=1<<u.canonical.z,c=(t.x*r-u.canonical.x-u.wrap*r)*s.al,m=(t.y*r-u.canonical.y)*s.al,_=s.e5(t.z,t.y);return s.d4(c,m,_)}function ic(u,t,r,c,m){if(!r.layout||r.layout.get("fill-elevation-reference")==="none")return;const _=u.context.gl,w=new ni(u.context.gl.LEQUAL,ni.ReadWrite,u.depthRangeFor3D),E=new ni(u.context.gl.GREATER,ni.ReadWrite,u.depthRangeFor3D),R=function(H){let $=.01;return H.isOrthographic&&($=s.ak(1e-4,$,s.c$(H.pitch>=ql?1:H.pitch/ql))),2*$}(u.transform),D=u.transform.getFreeCameraOptions().position,L="elevatedStructuresDepthReconstruct",F=u.getOrCreateProgram(L,{defines:["DEPTH_RECONSTRUCTION"]}),k=u.getOrCreateProgram(L);for(const H of c){const $=t.getTile(H),G=$.getBucket(r);if(!G)continue;const ee=G.elevatedStructures;if(!ee)continue;const X=G.elevationBufferData.heightRange,ie=Bp(H.toUnwrapped(),D),ce=u.translatePosMatrix(H.projMatrix,$,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));let de,Te,we,Ee;if(m==="initialize"){if(!X||X.min>=1||ee.depthSegments.segments[0].primitiveLength===0)continue;de=Ru(ce,ie,R,1,0),Te=w,we=ee.depthSegments,Ee=F}else if(m==="reset"){if(!X||X.min>=0||ee.maskSegments.segments[0].primitiveLength===0)continue;de=Ru(ce,ie,0,0,1),Te=E,we=ee.maskSegments,Ee=F}else if(m==="geometry"){if(ee.depthSegments.segments[0].primitiveLength===0)continue;de=Ru(ce,ie,R,1,0),Te=w,we=ee.depthSegments,Ee=k}Ee.draw(u,_.TRIANGLES,Te,Ci.disabled,tn.disabled,Ni.disabled,de,r.id,ee.vertexBuffer,ee.indexBuffer,we,r.paint,u.transform.zoom)}}function Du(u,t,r){const{painter:c,sourceCache:m,layer:_,coords:w,colorMode:E,elevationType:R,terrainEnabled:D,pass:L}=u,F=c.context.gl,k=_.paint.get("fill-pattern"),H=_.paint.get("fill-pattern-cross-fade"),$=k.constantOr(null);let G=R;R!=="road"||t&&!D||(G="none");const ee=G==="road",X=u.painter.shadowRenderer,ie=ee&&!!X&&X.enabled,ce=new ni(c.context.gl.LEQUAL,ni.ReadOnly,c.depthRangeFor3D);let de=[0,0,0];if(ie){const Ee=c.style.directionalLight,ve=c.style.ambientLight;Ee&&ve&&(de=bo(c.style,Ee,ve))}const Te=k&&k.constantOr(1),we=(Ee,ve)=>{let be,Ce,We,je,ct;ve?(be=Te&&!_.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",We=F.LINES):(be=Te?"fillPattern":"fill",We=F.TRIANGLES);for(const Ze of w){const ot=m.getTile(Ze);if(Te&&!ot.patternsLoaded())continue;const jt=ot.getBucket(_);if(!jt)continue;const Ye=t?jt.elevationBufferData:jt.bufferData;if(Ye.isEmpty())continue;c.prepareDrawTile();const Oe=Ye.programConfigurations.get(_.id),nt=c.isTileAffectedByFog(Ze),Ge=[],ht=[];ee&&(Ge.push("ELEVATED_ROADS"),ht.push(Ye.elevatedLayoutVertexBuffer)),ie&&Ge.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Te&&(c.context.activeTexture.set(F.TEXTURE0),ot.imageAtlasTexture&&ot.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Oe.updatePaintBuffers());let _t=!1;if($&&ot.imageAtlas){const oi=ot.imageAtlas,ei=s.e0.from($),li=ei.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),Li=ei.getSecondary(),Ki=oi.patternPositions.get(li),Hi=Li?oi.patternPositions.get(Li.scaleSelf(s.o.devicePixelRatio).toString()):null;_t=!!Ki&&!!Hi,Ki&&Oe.setConstantPatternPositions(Ki,Hi)}H>0&&(_t||Oe.getPatternTransitionVertexBuffer("fill-pattern"))&&Ge.push("FILL_PATTERN_TRANSITION");const qt=c.getOrCreateProgram(be,{config:Oe,overrideFog:nt,defines:Ge}),Ct=c.translatePosMatrix(Ze.projMatrix,ot,_.paint.get("fill-translate"),_.paint.get("fill-translate-anchor"));ie&&X.setupShadows(ot.tileID.toUnwrapped(),qt,"vector-tile");const Tt=_.paint.get("fill-emissive-strength");if(ve){je=Ye.lineIndexBuffer,ct=Ye.lineSegments;const oi=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[F.drawingBufferWidth,F.drawingBufferHeight];Ce=be==="fillOutlinePattern"&&Te?Cu(Ct,Tt,c,ot,oi,de,H):Vm(Ct,Tt,oi,de)}else je=Ye.indexBuffer,ct=Ye.triangleSegments,Ce=Te?Au(Ct,Tt,c,ot,de,H):Cf(Ct,Tt,de);c.uploadCommonUniforms(c.context,qt,Ze.toUnwrapped());let gi=Ee;(R==="road"&&!D||R==="offset")&&(gi=ce),qt.draw(c,We,gi,r||c.stencilModeForClipping(Ze),E,Ni.disabled,Ce,_.id,Ye.layoutVertexBuffer,je,ct,_.paint,c.transform.zoom,Oe,ht)}};c.renderPass===L&&we(c.depthModeForSublayer(1,c.renderPass==="opaque"?ni.ReadWrite:ni.ReadOnly),!1),G==="none"&&c.renderPass==="translucent"&&_.paint.get("fill-antialias")&&we(c.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,ni.ReadOnly),!0)}function ri(u,t,r,c,m,_,w,E){r.resetLayerRenderingStats(u);const R=u.context,D=R.gl,L=u.transform,F=r.paint.get("fill-extrusion-pattern"),k=r.paint.get("fill-extrusion-pattern-cross-fade"),H=F.constantOr(null),$=F.constantOr(1),G=r.paint.get("fill-extrusion-opacity"),ee=u.style.enable3dLights(),X=r.paint.get(ee&&!$?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ie=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),X],ce=r.layout.get("fill-extrusion-edge-radius"),de=ce>0&&!r.paint.get("fill-extrusion-rounded-roof"),Te=de?0:ce,we=L.projection.name==="globe"?s.e8():0,Ee=L.projection.name==="globe",ve=Ee?s.aj(L.zoom):0,be=[s.aF(L.center.lng),s.aJ(L.center.lat)],Ce=r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",We=r.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ce?null:r.lut).toArray01().slice(0,3),je=r.paint.get("fill-extrusion-flood-light-intensity"),ct=r.paint.get("fill-extrusion-vertical-scale"),Ze=r.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ot=r.paint.get("fill-extrusion-height-alignment"),jt=r.paint.get("fill-extrusion-base-alignment"),Ye=zc(u,r.paint.get("fill-extrusion-cutoff-fade-range")),Oe=[];let nt;Ee&&Oe.push("PROJECTION_GLOBE_VIEW"),ie[0]>0&&Oe.push("FAUX_AO"),de&&Oe.push("ZERO_ROOF_RADIUS"),E&&Oe.push("HAS_CENTROID"),je>0&&Oe.push("FLOOD_LIGHT"),Ye.shouldRenderCutoff&&Oe.push("RENDER_CUTOFF"),Ze&&Oe.push("RENDER_WALL_MODE");const Ge=u.renderPass==="shadow",ht=u.shadowRenderer,_t=Ge&&!!ht,qt=Ge?Ni.disabled:Ni.backCCW;u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0);let Ct=[0,0,0];if(ht){const oi=u.style.directionalLight,ei=u.style.ambientLight;oi&&ei&&(Ct=bo(u.style,oi,ei)),Ge||(Oe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ht.useNormalOffset&&Oe.push("NORMAL_OFFSET")),nt=Oe.concat(["SHADOWS_SINGLE_CASCADE"])}const Tt=_t?"fillExtrusionDepth":$?"fillExtrusionPattern":"fillExtrusion",gi=r.getLayerRenderingStats();for(const oi of c){const ei=t.getTile(oi),li=ei.getBucket(r);if(!li||li.projection.name!==L.projection.name)continue;let Li=!1;ht&&(Li=ht.getMaxCascadeForTile(oi.toUnwrapped())===0);const Ki=u.isTileAffectedByFog(oi),Hi=li.programConfigurations.get(r.id);let zn=!1;if(H&&ei.imageAtlas){const bn=ei.imageAtlas,Dn=s.e0.from(H),Qn=Dn.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),Er=Dn.getSecondary(),ns=bn.patternPositions.get(Qn),ur=Er?bn.patternPositions.get(Er.scaleSelf(s.o.devicePixelRatio).toString()):null;zn=!!ns&&!!ur,ns&&Hi.setConstantPatternPositions(ns,ur)}k>0&&(zn||Hi.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Oe.push("FILL_EXTRUSION_PATTERN_TRANSITION");const qi=u.getOrCreateProgram(Tt,{config:Hi,defines:Li?nt:Oe,overrideFog:Ki});if(u.terrain&&u.terrain.setupElevationDraw(ei,qi,{useMeterToDem:!0}),!li.centroidVertexBuffer){const bn=qi.getAttributeLocation(D,"a_centroid_pos");bn!==-1&&D.vertexAttrib2f(bn,0,0)}!Ge&&ht&&ht.setupShadows(ei.tileID.toUnwrapped(),qi,"vector-tile"),$&&(u.context.activeTexture.set(D.TEXTURE0),ei.imageAtlasTexture&&ei.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Hi.updatePaintBuffers());const _n=r.paint.get("fill-extrusion-vertical-gradient"),On=1/li.tileToMeter;let or;if(Ge&&ht){if(Fp(ei.tileID,li.maxHeight,u))continue;const bn=ht.calculateShadowPassMatrixFromTile(ei.tileID.toUnwrapped());or=Uc(bn,Te,On,ct,ot,jt)}else{const bn=u.translatePosMatrix(oi.expandedProjMatrix,ei,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Dn=L.projection.createInversionMatrix(L,oi.canonical);or=$?Um(bn,u,_n,G,ie,Te,On,oi,ei,we,ot,jt,ve,be,Dn,We,ct,k):_l(bn,u,_n,G,ie,Te,On,oi,we,ot,jt,ve,be,Dn,We,ct,je,Ct)}u.uploadCommonUniforms(R,qi,oi.toUnwrapped(),null,Ye);let Xi=li.segments;if(L.projection.name==="mercator"&&!Ge&&(Xi=li.getVisibleSegments(ei.tileID,u.terrain,u.transform.getFrustum(0)),!Xi.get().length))continue;if(gi)if(Ge)for(const bn of Xi.get())gi.numRenderedVerticesInShadowPass+=bn.primitiveLength;else for(const bn of Xi.get())gi.numRenderedVerticesInTransparentPass+=bn.primitiveLength;const Rn=[];(u.terrain||E)&&Rn.push(li.centroidVertexBuffer),Ee&&Rn.push(li.layoutVertexExtBuffer),Ze&&Rn.push(li.wallVertexBuffer),qi.draw(u,R.gl.TRIANGLES,m,_,w,qt,or,r.id,li.layoutVertexBuffer,li.indexBuffer,Xi,r.paint,u.transform.zoom,Hi,Rn)}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1)}class Pf{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function xl(u,t,r,c,m,_,w,E,R,D,L,F,k,H,$,G,ee,X,ie,ce){const de=t.context,Te=de.gl,we=t.transform,Ee=t.transform.zoom,ve=[],be=u.translate,Ce=u.translateAnchor,We=u.edgeRadius,je=zc(t,u.cutoffFadeRange);L==="clear"?(ve.push("CLEAR_SUBPASS"),ce&&(ve.push("CLEAR_FROM_TEXTURE"),de.activeTexture.set(Te.TEXTURE0),ce.bind(Te.LINEAR,Te.CLAMP_TO_EDGE))):L==="sdf"&&ve.push("SDF_SUBPASS"),X&&ve.push("HAS_CENTROID"),je.shouldRenderCutoff&&ve.push("RENDER_CUTOFF");const ct=(Ze,ot,jt,Ye,Oe)=>{const nt=ot.programConfigurations.get(c.id),Ge=t.isTileAffectedByFog(Ze),ht=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:nt,defines:ve,overrideFog:Ge}),_t=((Ct,Tt,gi,oi,ei,li,Li,Ki,Hi,zn,qi)=>({u_matrix:Tt,u_opacity:gi,u_ao_pass:oi?1:0,u_meter_to_tile:ei,u_ao:li,u_flood_light_intensity:Li,u_flood_light_color:Ki,u_attenuation:Hi,u_edge_radius:zn,u_fb:0,u_fb_size:qi,u_dynamic_offset:1}))(0,Ye,F,D,Oe,[k,H*Oe],$,G,ee,Ee>=17?0:We*Oe,ce?ce.size[0]:0),qt=[];X&&qt.push(ot.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(de,ht,Ze.toUnwrapped(),null,je),ht.draw(t,de.gl.TRIANGLES,_,w,E,R,_t,c.id,ot.vertexBuffer,ot.indexBuffer,jt,c.paint,Ee,nt,qt)};for(const Ze of m){const ot=r.getTile(Ze),jt=ot.getBucket(c);if(!jt||jt.projection.name!==we.projection.name||!jt.groundEffect||jt.groundEffect&&!jt.groundEffect.hasData())continue;const Ye=jt.groundEffect,Oe=1/jt.tileToMeter;{const nt=t.translatePosMatrix(Ze.projMatrix,ot,be,Ce),Ge=Ye.getDefaultSegment();ct(Ze,Ye,Ge,nt,Oe)}if(ie)for(let nt=0;nt<4;nt++){const Ge=s.e6[nt](Ze),ht=r.getTile(Ge);if(!ht)continue;const _t=ht.getBucket(c);if(!_t||_t.projection.name!==we.projection.name||!_t.groundEffect||_t.groundEffect&&!_t.groundEffect.hasData())continue;const qt=_t.groundEffect;let Ct,Tt;nt===0?(Ct=[-s.al,0,0],Tt=1):nt===1?(Ct=[s.al,0,0],Tt=0):nt===2?(Ct=[0,-s.al,0],Tt=3):(Ct=[0,s.al,0],Tt=2);const gi=qt.regionSegments[Tt];if(!gi)continue;const oi=new Float32Array(16);s.br(oi,Ze.projMatrix,Ct),ct(Ze,qt,gi,t.translatePosMatrix(oi,ot,be,Ce),Oe)}}}function nc(u,t,r,c,m,_,w){c.centroidVertexArray.length===0&&c.createCentroidsBuffer();const E=_?_.findDEMTileFor(r):null;if(!(E&&E.dem||w))return;_&&E&&E.dem&&c.selfDEMTileTimestamp!==E.dem._timestamp&&(c.borderDoneWithNeighborZ=[-1,-1,-1,-1],c.selfDEMTileTimestamp=E.dem._timestamp);const R=X=>new s.P(Math.ceil((X+s.ea)*s.eb),0),D=X=>{const ie=t.getSource().minzoom,ce=Te=>{const we=t.getTileByID(Te);if(we&&we.hasData())return we.getBucket(m)},de=[0,-1,1];for(const Te of de){if(X.overscaledZ+Te<ie)continue;const we=ce(X.calculateScaledKey(X.overscaledZ+Te));if(we)return we}},L=[0,0,0],F=(X,ie)=>(L[0]=Math.min(X.min.y,ie.min.y),L[1]=Math.max(X.max.y,ie.max.y),L[2]=s.al-ie.min.x>X.max.x?ie.min.x-s.al:X.max.x,L),k=(X,ie)=>(L[0]=Math.min(X.min.x,ie.min.x),L[1]=Math.max(X.max.x,ie.max.x),L[2]=s.al-ie.min.y>X.max.y?ie.min.y-s.al:X.max.y,L),H=[(X,ie)=>F(X,ie),(X,ie)=>F(ie,X),(X,ie)=>k(X,ie),(X,ie)=>k(ie,X)],$=(X,ie,ce,de,Te,we,Ee)=>{if(!_)return 0;const ve=[[we?ce:X,we?X:ce,0],[we?ce:ie,we?ie:ce,0]],be=Ee<0?s.al+Ee:Ee,Ce=[we?be:(X+ie)/2,we?(X+ie)/2:be,0];return ce===0&&Ee<0||ce!==0&&Ee>0?_.getForTilePoints(Te,[Ce],!0,de):ve.push(Ce),_.getForTilePoints(r,ve,!0,E),Math.max(ve[0][2],ve[1][2],Ce[2])/_.exaggeration()};for(let X=0;X<4;X++){const ie=c.borderFeatureIndices[X];if(ie.length===0)continue;const ce=s.e6[X](r),de=D(ce);if(!(de&&de instanceof s.e7))continue;const Te=_?_.findDEMTileFor(ce):null;if(!(Te&&Te.dem||w)||(_&&Te&&Te.dem&&c.borderDEMTileTimestamp[X]!==Te.dem._timestamp&&(c.borderDoneWithNeighborZ[X]=-1,c.borderDEMTileTimestamp[X]=Te.dem._timestamp),c.borderDoneWithNeighborZ[X]===de.canonical.z))continue;de.centroidVertexArray.length===0&&de.createCentroidsBuffer();const we=(X<2?1:5)-X,Ee=de.borderDoneWithNeighborZ[we]!==c.canonical.z,ve=de.borderFeatureIndices[we];let be=0;if(c.canonical.z!==de.canonical.z){for(const Ce of ie)c.showCentroid(c.featuresOnBorder[Ce]);if(Ee)for(const Ce of ve)de.showCentroid(de.featuresOnBorder[Ce]);c.borderDoneWithNeighborZ[X]=de.canonical.z,de.borderDoneWithNeighborZ[we]=c.canonical.z}for(const Ce of ie){const We=c.featuresOnBorder[Ce],je=c.centroidData[We.centroidDataIndex],ct=We.borders[X];let Ze;for(;be<ve.length;){Ze=de.featuresOnBorder[ve[be]];const ot=Ze.borders[we];if(ot[1]>ct[0]+3||ot[0]>ct[0]-3)break;de.showCentroid(Ze),be++}if(Ze&&be<ve.length){const ot=be;let jt=0;for(;!(Ze.borders[we][0]>ct[1]-3)&&(jt++,++be!==ve.length);)Ze=de.featuresOnBorder[ve[be]];Ze=de.featuresOnBorder[ve[ot]];let Ye=!1;if(jt>=1){const Ge=Ze.borders[we];Math.abs(ct[0]-Ge[0])<3&&Math.abs(ct[1]-Ge[1])<3&&(jt=1,Ye=!0,be=ot+1)}else if(jt===0){c.showCentroid(We);continue}const Oe=de.centroidData[Ze.centroidDataIndex];w&&Ye&&(((G=je).flags|(ee=Oe).flags)&s.e9?(G.flags|=s.e9,ee.flags|=s.e9):(G.flags&=~s.e9,ee.flags&=~s.e9));const nt=We.intersectsCount()>1||Ze.intersectsCount()>1;if(jt>1)be=ot,je.centroidXY=Oe.centroidXY=new s.P(0,0);else if(Te&&Te.dem&&!nt){const Ge=H[X](je,Oe),ht=X%2?s.al-1:0,_t=$(Ge[0],Math.min(s.al-1,Ge[1]),ht,Te,ce,X<2,Ge[2]);je.centroidXY=Oe.centroidXY=R(_t)}else nt?je.centroidXY=Oe.centroidXY=new s.P(0,0):(je.centroidXY=c.encodeBorderCentroid(We),Oe.centroidXY=de.encodeBorderCentroid(Ze));c.writeCentroidToBuffer(je),de.writeCentroidToBuffer(Oe)}else c.showCentroid(We)}c.borderDoneWithNeighborZ[X]=de.canonical.z,de.borderDoneWithNeighborZ[we]=c.canonical.z}var G,ee;(c.needsCentroidUpdate||!c.centroidVertexBuffer&&c.centroidVertexArray.length!==0)&&c.uploadCentroid(u)}const vl=[1,0,0],Ri=[0,1,0],Lf=[0,0,1];function Fp(u,t,r){const c=r.transform,m=r.shadowRenderer;if(!m)return!0;const _=u.toUnwrapped(),w=c.tileSize*m._cascades[r.currentShadowCascade].scale;let E=t;if(c.elevation){const G=c.elevation.getMinMaxForTile(u);G&&(E+=G.max)}const R=[...m.shadowDirection];R[2]=-R[2];const D=m.computeSimplifiedTileShadowVolume(_,E,w,R);if(!D)return!1;const L=[vl,Ri,Lf,R,[R[0],0,R[2]],[0,R[1],R[2]]],F=c.projection.name==="globe",k=c.scaleZoom(w),H=s.cA.fromInvProjectionMatrix(c.invProjMatrix,c.worldSize,k,!F),$=m.getCurrentCascadeFrustum();return H.intersectsPrecise(D.vertices,D.planes,L)===0||$.intersectsPrecise(D.vertices,D.planes,L)===0}function Pd(u){const{painter:t,source:r,layer:c,coords:m}=u;let _=u.defines;const w=t.context,E=t.renderPass==="shadow",R=t.renderPass==="light-beam",D=t.shadowRenderer,L=s.ec(t.transform.center.lat,t.transform.zoom),F=zc(t,c.paint.get("building-cutoff-fade-range"));F.shouldRenderCutoff&&(_=_.concat("RENDER_CUTOFF"));for(const k of m){const H=r.getTile(k),$=H.getBucket(c);if(!$)continue;D&&D.getMaxCascadeForTile(k.toUnwrapped())===0&&(_=_.concat("SHADOWS_SINGLE_CASCADE"));const G=$.programConfigurations.get(c.id);let ee,X,ie,ce=t.translatePosMatrix(k.expandedProjMatrix,H,[0,0],"map");if(ce=s.cR(s.bC(),ce,[1,1,u.verticalScale]),E&&D){if(Fp(H.tileID,$.maxHeight*L,t))continue;let Te=D.calculateShadowPassMatrixFromTile(H.tileID.toUnwrapped());Te=s.cR(s.bC(),Te,[1,1,u.verticalScale]),ie=Jn(Te),ee=X=t.getOrCreateProgram("buildingDepth",{config:G,defines:_,overrideFog:!1})}else if(R)ee=X=t.getOrCreateProgram("buildingBloom",{config:G,defines:_,overrideFog:!1}),ie=Vc(ce);else{const Te=t.transform.calculatePosMatrix(k.toUnwrapped(),t.transform.worldSize);s.cR(Te,Te,[1,1,u.verticalScale]);const we=s.bC();s.cR(we,Te,[1,-1,1/L]),s.bl(we,we),s.ed(we,we);const Ee=t.transform.getFreeCameraOptions().position,ve=1<<k.canonical.z;ie=Hm(ce,we,u.opacity,u.facadeAOIntensity,[((Ee.x-k.wrap)*ve-k.canonical.x)*s.al,(Ee.y*ve-k.canonical.y)*s.al,Ee.z*ve*s.al],$.tileToMeter,u.facadeEmissiveChance),X=t.getOrCreateProgram("building",{config:G,defines:_,overrideFog:!1});const be=_.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);ee=t.getOrCreateProgram("building",{config:G,defines:be,overrideFog:!1}),D&&(D.setupShadowsFromMatrix(Te,X,!0),D.setupShadowsFromMatrix(Te,ee,!0))}const de=(Te,we)=>{if(R){const Ee=Te.entranceBloom;we.draw(t,w.gl.TRIANGLES,u.depthMode,Ci.disabled,u.blendMode,Ni.disabled,ie,c.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segmentsBucket,c.paint,t.transform.zoom,G,[Ee.layoutAttenuationBuffer,Ee.layoutColorBuffer])}else{const Ee=Te.segmentsBucket;let ve=[Te.layoutNormalBuffer,Te.layoutCentroidBuffer,Te.layoutColorBuffer];Te.layoutFacadePaintBuffer&&(ve=ve.concat([Te.layoutFacadeDataBuffer,Te.layoutFacadeVerticalRangeBuffer,Te.layoutFacadePaintBuffer])),we.draw(t,w.gl.TRIANGLES,u.depthMode,Ci.disabled,u.blendMode,E?Ni.disabled:Ni.backCW,ie,c.id,Te.layoutVertexBuffer,Te.indexBuffer,Ee,c.paint,t.transform.zoom,G,ve)}};t.uploadCommonUniforms(w,X,k.toUnwrapped(),null,F),$.buildingWithoutFacade&&de($.buildingWithoutFacade,X),ee!==X&&t.uploadCommonUniforms(w,ee,k.toUnwrapped(),null,F),$.buildingWithFacade&&de($.buildingWithFacade,ee)}}function Ld(u){return[u[0]*s.ee,u[1]*s.ee,u[2]*s.ee,0]}function Of(u,t,r,c,m,_,w,E,R){const D=c.getSource(),L=r.globeSharedBuffers;if(!L)return;let F,k,H;if(t&&(F=c.getTile(t)),D instanceof s.aS?(k=D.texture,H=s.dG(0,0,r.transform)):F&&t&&(k=F.texture,H=s.dG(t.canonical.z,t.canonical.x,r.transform)),!k||!H)return;u||(H=s.cR(s.bC(),H,[1,-1,1]));const $=r.context,G=$.gl,ee=m.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR,X=r.colorModeForDrapableLayerRenderPass(_),ie=w.defines;ie.push("GLOBE_POLES");const ce=new ni(G.LEQUAL,ni.ReadWrite,r.depthRangeFor3D),de=Float32Array.from(r.transform.expandedFarZProjMatrix),Te=Float32Array.from(s.bk(s.dF(new s.cC(0,0,0))));r.terrain&&r.terrain.prepareDrawTile(),$.activeTexture.set(G.TEXTURE0),k.bind(ee,G.CLAMP_TO_EDGE),$.activeTexture.set(G.TEXTURE1),k.bind(ee,G.CLAMP_TO_EDGE),"useMipmap"in k&&$.extTextureFilterAnisotropic&&r.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,$.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,$.extTextureFilterAnisotropicMax);const[we,Ee,ve,be]=t?L.getPoleBuffers(t.canonical.z,!1):L.getPoleBuffers(0,!0),Ce=m.paint.get("raster-elevation");let We;u?(We=we,r.renderDefaultNorthPole=Ce!==0):(We=Ee,r.renderDefaultSouthPole=Ce!==0);const je=Ld(w.mix),ct=((ot,jt,Ye,Oe,nt,Ge,ht,_t,qt,Ct,Tt,gi,oi)=>Hc(ot,jt,Ye,new Float32Array(16),new Float32Array(9),[0,0],Oe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ge,[0,0],_t,2,Ct,Tt,gi,1,0,oi))(de,Te,H,s.aj(r.transform.zoom),0,m,0,Ce,0,je,w.offset,w.range,_),Ze=r.getOrCreateProgram("raster",{defines:ie});r.uploadCommonUniforms($,Ze,null),Ze.draw(r,G.TRIANGLES,ce,R,X,E,ct,m.id,We,ve,be)}function qm(u){const t=u._nearZ,r=u.projection.farthestPixelDistance(u),c=r-t,m=.2*u.height,_=t+m;return[t,r,(_-m-t)/c,(_-t)/c]}function Pu(u,t,r,c){if(u)return t instanceof Ll&&u instanceof od?t.getTextureDescriptor(u,r,!0):{texture:u.texture,mix:Ld(c.mix),offset:c.offset,buffer:0,tileSize:1}}var Gm=s.ef([{name:"a_index",type:"Int16",components:1}]);class kf{constructor(t,r,c,m){const _={width:c[0],height:c[1],data:null},w=t.gl;this.targetColorTexture=new s.T(t,_,w.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(t,_,w.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(r,m),this.lastInvalidatedAt=0}updateParticleTexture(t,r){if(this.particleTextureDimension===r.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const c=this.context.gl,m=r.width*r.height;this.particleTexture0=new s.T(this.context,r,c.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,r,c.RGBA8,{premultiply:!1,useMipmap:!1});const _=new s.eg;_.reserve(m);for(let w=0;w<m;w++)_.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(_,Gm.members,!0),this.particleSegment=s.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=r.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=s.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function ra(u,t,r){if(!u)return null;const c=t.getTextureDescriptor(u,r,!0);if(!c)return null;let{texture:m,mix:_,offset:w,tileSize:E,buffer:R,format:D}=c;if(!m||!D)return null;let L=!1;return D==="uint32"&&(L=!0,_[3]=0,_=tc(s.eh,_,[0,r.paint.get("raster-particle-max-speed")]),w=Eh(s.eh,w,[0,r.paint.get("raster-particle-max-speed")])),{texture:m,textureOffset:[R/(E+2*R),E/(E+2*R)],tileSize:E,scalarData:L,scale:_,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[D]]}}function Nf(u){const t=u._nearZ,r=u.projection.farthestPixelDistance(u),c=r-t,m=.2*u.height,_=t+m;return[t,r,(_-m-t)/c,(_-t)/c]}const qs=new s.ao(1,0,0,1),rc=new s.ao(0,1,0,1),Up=new s.ao(0,0,1,1),jf=new s.ao(1,0,1,1),Bf=new s.ao(0,1,1,1);function Dh(u,t,r,c,m,_){for(let w=0;w<r.length;w++)if(m){const D=new s.ao(c.r*.8,c.g*.8,c.b*.8,1);qc(u,t,r[w],c,-1,-1,_),qc(u,t,r[w],c,-1,1,_),qc(u,t,r[w],c,1,1,_),qc(u,t,r[w],c,1,-1,_),qc(u,t,r[w],D,0,0,_)}else qc(u,t,r[w],c,0,0,_)}function qc(u,t,r,c,m,_,w){const E=u.context,R=u.transform,D=E.gl,L=R.projection.name==="globe",F=L?["PROJECTION_GLOBE_VIEW"]:[];let k=s.bz(r.projMatrix);if(L&&s.aj(R.zoom)>0){const je=s.bj(r.canonical,R),ct=s.ei(je);k=s.aB(new Float32Array(16),R.globeMatrix,ct),s.aB(k,R.projMatrix,k)}const H=s.bC();H[12]+=2*m/(s.o.devicePixelRatio*R.width),H[13]+=2*_/(s.o.devicePixelRatio*R.height),s.aB(k,H,k);const $=u.getOrCreateProgram("debug",{defines:F}),G=t.getTileByID(r.key);u.terrain&&u.terrain.setupElevationDraw(G,$);const ee=ni.disabled,X=Ci.disabled,ie=u.colorModeForRenderPass(),ce="$debug";E.activeTexture.set(D.TEXTURE0),u.emptyTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),L?G._makeGlobeTileDebugBuffers(u.context,R):G._makeDebugTileBoundsBuffers(u.context,R.projection);const de=G._tileDebugBuffer||u.debugBuffer,Te=G._tileDebugIndexBuffer||u.debugIndexBuffer,we=G._tileDebugSegments||u.debugSegments;if($.draw(u,D.LINE_STRIP,ee,X,ie,Ni.disabled,ps(k,c.toPremultipliedRenderColor(null)),ce,de,Te,we,null,null,null,[G._globeTileDebugBorderBuffer]),w){const je=G.latestRawTileData,ct=Math.floor((je&&je.byteLength||0)/1024);let Ze=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(Ze+=` => ${r.overscaledZ}`),Ze+=` ${G.state}`,Ze+=` ${ct}kb`,function(ot,jt){ot.initDebugOverlayCanvas();const Ye=ot.debugOverlayCanvas,Oe=ot.context.gl,nt=ot.debugOverlayCanvas.getContext("2d");nt.clearRect(0,0,Ye.width,Ye.height),nt.shadowColor="white",nt.shadowBlur=2,nt.lineWidth=1.5,nt.strokeStyle="white",nt.textBaseline="top",nt.font="bold 36px Open Sans, sans-serif",nt.fillText(jt,5,5),nt.strokeText(jt,5,5),ot.debugOverlayTexture.update(Ye),ot.debugOverlayTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE)}(u,Ze)}const Ee=t.getTile(r).tileSize,ve=512/Math.min(Ee,512)*(r.overscaledZ/R.zoom)*.5,be=G._tileDebugTextBuffer||u.debugBuffer,Ce=G._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,We=G._tileDebugTextSegments||u.debugSegments;$.draw(u,D.TRIANGLES,ee,X,tn.alphaBlended,Ni.disabled,ps(k,s.ao.transparent.toPremultipliedRenderColor(null),ve),ce,be,Ce,We,null,null,null,[G._globeTileDebugTextBuffer])}function $o(u,t,r,c){Gc(u,0,t+r/2,u.transform.width,r,c)}function ir(u,t,r,c){Gc(u,t-r/2,0,r,u.transform.height,c)}function Gc(u,t,r,c,m,_){const w=u.context,E=w.gl;E.enable(E.SCISSOR_TEST),E.scissor(t*s.o.devicePixelRatio,r*s.o.devicePixelRatio,c*s.o.devicePixelRatio,m*s.o.devicePixelRatio),w.clear({color:_}),E.disable(E.SCISSOR_TEST)}const Ff=s.ef([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:$m}=Ff;function Zo(u,t,r,c){u.emplaceBack(t,r,c)}class Uf{constructor(t){this.vertexArray=new s.ej,this.indices=new s.b1,Zo(this.vertexArray,-1,-1,1),Zo(this.vertexArray,1,-1,1),Zo(this.vertexArray,-1,1,1),Zo(this.vertexArray,1,1,1),Zo(this.vertexArray,-1,-1,-1),Zo(this.vertexArray,1,-1,-1),Zo(this.vertexArray,-1,1,-1),Zo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,$m),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=s.bg.simpleSegment(0,0,36,12)}}function $c(u,t,r,c,m,_){const w=u.context.gl,E=t.paint.get("sky-atmosphere-color"),R=t.paint.get("sky-atmosphere-halo-color"),D=t.paint.get("sky-atmosphere-sun-intensity"),L=((F,k,H,$,G)=>({u_matrix_3f:F,u_sun_direction:k,u_sun_intensity:H,u_color_tint_r:[$.r,$.g,$.b,$.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(s.el(s.dL(),c),m,D,E.toPremultipliedRenderColor(null),R.toPremultipliedRenderColor(null));w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+_,t.skyboxTexture,0),r.draw(u,w.TRIANGLES,ni.disabled,Ci.disabled,tn.unblended,Ni.frontCW,L,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const sc=s.ef([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Zc{constructor(t){const r=new s.em;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const c=new s.b1;c.emplaceBack(0,1,2),c.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(r,sc.members),this.indexBuffer=t.createIndexBuffer(c),this.segments=s.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const kt=s.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Yt{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ph{constructor(t){this.colorModeAlphaBlendedWriteRGB=new tn([1,Ma,1,Ma],s.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new tn([1,0,1,0],s.ao.transparent,[!1,!1,!1,!0]),this.params=new Yt,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const r=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Zc(r);const c=this.params.sizeRange,m=this.params.intensityRange,_=function(L){const F=s.eo(30),k=[];for(let H=0;H<L;++H){const $=2*Math.PI*F(),G=Math.acos(1-2*F())-.5*Math.PI;k.push(s.d4(Math.cos(G)*Math.cos($),Math.cos(G)*Math.sin($),Math.sin(G)))}return k}(this.params.starsCount),w=s.eo(300),E=new s.en,R=new s.b1;let D=0;for(let L=0;L<_.length;++L){const F=s.c4([],_[L],200),k=Math.max(0,1+.01*c*(1*w()-.5)),H=Math.max(0,1+.01*m*(1*w()-.5));E.emplaceBack(F[0],F[1],F[2],-1,-1,k,H),E.emplaceBack(F[0],F[1],F[2],1,-1,k,H),E.emplaceBack(F[0],F[1],F[2],1,1,k,H),E.emplaceBack(F[0],F[1],F[2],-1,1,k,H),R.emplaceBack(D+0,D+1,D+2),R.emplaceBack(D+0,D+2,D+3),D+=4}this.starsVx=r.createVertexBuffer(E,kt.members),this.starsIdx=r.createIndexBuffer(R),this.starsSegments=s.bg.simpleSegment(0,0,E.length,R.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,r){const c=t.context,m=c.gl,_=t.transform,w=new ni(m.LEQUAL,ni.ReadOnly,[0,1]),E=s.aj(_.zoom),R=t.style.getLut(r.scope),D=r.properties.get("color-use-theme")==="none",L=r.properties.get("color").toNonPremultipliedRenderColor(D?null:R),F=r.properties.get("high-color-use-theme")==="none",k=r.properties.get("high-color").toNonPremultipliedRenderColor(F?null:R),H=r.properties.get("space-color-use-theme")==="none",$=r.properties.get("space-color").toNonPremultipliedRenderColor(H?null:R),G=5e-4,ee=s.ep(r.properties.get("horizon-blend"),0,1,G,.25),X=s.dA(t,c,_)&&ee===G?_.worldSize/(2*Math.PI*1.025)-1:_.globeRadius,ie=t.frameCounter/1e3%1,ce=s.ag(_.globeCenterInViewSpace),de=Math.sqrt(Math.pow(ce,2)-Math.pow(X,2)),Te=Math.acos(de/ce),we=Ee=>{const ve=_.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ee&&ve.push("ALPHA_PASS");const be=t.getOrCreateProgram("globeAtmosphere",{defines:ve}),Ce=((je,ct,Ze,ot,jt,Ye,Oe,nt,Ge,ht,_t,qt)=>({u_frustum_tl:je,u_frustum_tr:ct,u_frustum_br:Ze,u_frustum_bl:ot,u_horizon:jt,u_transition:Ye,u_fadeout_range:Oe,u_atmosphere_fog_color:nt.toArray01(),u_high_color:Ge.toArray01(),u_space_color:ht.toArray01(),u_temporal_offset:_t,u_horizon_angle:qt}))(_.frustumCorners.TL,_.frustumCorners.TR,_.frustumCorners.BR,_.frustumCorners.BL,_.frustumCorners.horizon,E,ee,L,k,$,ie,Te);t.uploadCommonUniforms(c,be);const We=this.atmosphereBuffer;We&&be.draw(t,m.TRIANGLES,w,Ci.disabled,Ee?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ni.backCW,Ce,Ee?"atmosphere_glow_alpha":"atmosphere_glow",We.vertexBuffer,We.indexBuffer,We.segments)};we(!1),we(!0)}drawStars(t,r){const c=s.aA(r.properties.get("star-intensity"),0,1);if(c===0)return;const m=t.context,_=m.gl,w=t.transform,E=t.getOrCreateProgram("stars"),R=s.c6([]);s.c8(R,R,-w._pitch),s.c7(R,R,-w.angle),s.c8(R,R,s.an(w._center.lat)),s.eq(R,R,-s.an(w._center.lng));const D=s.cb(new Float32Array(16),R),L=s.aB([],w.starsProjMatrix,D),F=s.el([],D),k=s.er([],F),H=[0,1,0];s.dN(H,H,k),s.c4(H,H,this.params.sizeMultiplier);const $=[1,0,0];s.dN($,$,k),s.c4($,$,this.params.sizeMultiplier);const G=(ee=H,X=$,ie=c,{u_matrix:Float32Array.from(L),u_up:ee,u_right:X,u_intensity_multiplier:ie});var ee,X,ie;t.uploadCommonUniforms(m,E),this.starsVx&&this.starsIdx&&E.draw(t,_.TRIANGLES,ni.disabled,Ci.disabled,this.colorModeAlphaBlendedWriteRGB,Ni.disabled,G,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Rr{constructor(){this.visibleTiles=[]}updateBorders(t,r){const c=[],m=[],_=t._getRenderableCoordinates(!1,!0);for(const R of _){const D=t.getTile(R);if(!D.hasData())continue;const L=D.getBucket(r);L&&(L.isEmpty()||(c.push(R.key),m.push({bucket:L,tileID:R.canonical})))}let w=c.length!==this.visibleTiles.length;if(!w){c.sort();for(let R=0;R<c.length;R++)if(c[R]!==this.visibleTiles[R]){w=!0;break}}if(!w)return;const E=new Set;this.visibleTiles=c,m.sort((R,D)=>R.tileID.z-D.tileID.z||R.tileID.x-D.tileID.x||R.tileID.y-D.tileID.y);for(const R of m){const D=new Array,L=new Array,F=R.bucket;for(const k of F.featuresOnBorder)E.has(k.featureId)?L.push(k.footprintIndex):(E.add(k.featureId),D.push(k.footprintIndex));F.updateFootprintHiddenFlags(D,s.es,!1),F.updateFootprintHiddenFlags(L,s.es,!0)}}}function qe(u,t){const r=[...u],c=t.cameraWorldSizeForFog/t.worldSize,m=s.bA([]);return s.cR(m,m,[c,c,1]),s.aB(r,m,r),s.aB(r,t.worldToFogMatrix,r),r}function Lh(u,t,r,c,m){const _=r.material,w=c.context,{baseColorTexture:E,metallicRoughnessTexture:R}=_.pbrMetallicRoughness,{normalTexture:D,occlusionTexture:L,emissionTexture:F}=_;function k($,G,ee){if($&&(u.push(G),w.activeTexture.set(w.gl.TEXTURE0+ee),$.gfxTexture)){const{minFilter:X,magFilter:ie,wrapS:ce,wrapT:de}=$.sampler;$.gfxTexture.bindExtraParam(X,ie,ce,de)}}k(E,"HAS_TEXTURE_u_baseColorTexture",$r.BaseColor),k(R,"HAS_TEXTURE_u_metallicRoughnessTexture",$r.MetallicRoughness),k(D,"HAS_TEXTURE_u_normalTexture",$r.Normal),k(L,"HAS_TEXTURE_u_occlusionTexture",$r.Occlusion),k(F,"HAS_TEXTURE_u_emissionTexture",$r.Emission),m&&(m.texture||(m.texture=new s.dY(c.context,m.image,[m.image.height,m.image.height,m.image.height],w.gl.RGBA8)),w.activeTexture.set(w.gl.TEXTURE0+$r.LUT),m.texture&&m.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),u.push("APPLY_LUT_ON_GPU")),r.texcoordBuffer&&(u.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(r.texcoordBuffer)),r.colorBuffer&&(u.push(r.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(r.colorBuffer)),r.normalBuffer&&(u.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(r.normalBuffer)),r.pbrBuffer&&(u.push("HAS_ATTRIBUTE_a_pbr"),u.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(r.pbrBuffer)),_.alphaMode!=="OPAQUE"&&_.alphaMode!=="MASK"||u.push("UNPREMULT_TEXTURE_IN_SHADER"),_.defined||u.push("DIFFUSE_SHADED");const H=c.shadowRenderer;H&&(u.push("RENDER_SHADOWS","DEPTH_TEXTURE"),H.useNormalOffset&&u.push("NORMAL_OFFSET"))}function bl(u,t,r,c,m,_){const w=r.paint.get("model-opacity").constantOr(1),E=t.context,R=new ni(t.context.gl.LEQUAL,ni.ReadWrite,t.depthRangeFor3D),D=t.transform,L=u.mesh,F=L.material,k=F.pbrMetallicRoughness,H=t.style.fog;let $;$=t.transform.projection.zAxisUnit==="pixels"?[...u.nodeModelMatrix]:s.aB([],c.zScaleMatrix,u.nodeModelMatrix),s.aB($,c.negCameraPosMatrix,$);const G=s.bl([],$);s.ed(G,G);const ee=r.paint.get("model-color-use-theme").constantOr("default")==="none",X=r.paint.get("model-emissive-strength").constantOr(0),ie=Rh(new Float32Array(u.worldViewProjection),new Float32Array($),new Float32Array(G),null,t,w,k.baseColorFactor,F.emissiveFactor,k.metallicFactor,k.roughnessFactor,F,X,r),ce={defines:[]},de=[],Te=t.shadowRenderer;Te&&(Te.useNormalOffset=!1),Lh(ce.defines,de,L,t,ee?null:r.lut);let we=null;if(H){const be=qe(u.nodeModelMatrix,t.transform);if(we=new Float32Array(be),D.projection.name!=="globe"){const Ce=L.aabb.min,We=L.aabb.max,[je,ct]=H.getOpacityForBounds(be,Ce[0],Ce[1],We[0],We[1]);ce.overrideFog=je>=pi||ct>=pi}}const Ee=zc(t,r.paint.get("model-cutoff-fade-range"));Ee.shouldRenderCutoff&&ce.defines.push("RENDER_CUTOFF");const ve=t.getOrCreateProgram("model",ce);t.uploadCommonUniforms(E,ve,null,we,Ee),t.renderPass!=="shadow"&&Te&&Te.setupShadowsFromMatrix(u.nodeModelMatrix,ve),ve.draw(t,E.gl.TRIANGLES,R,m,_,L.material.doubleSided?Ni.disabled:Ni.backCCW,ie,r.id,L.vertexBuffer,L.indexBuffer,L.segments,r.paint,t.transform.zoom,void 0,de)}function Od(u,t,r,c,m,_,w){let E;E=u.projection.name==="globe"?s.eu(r,u):[...r],s.aB(E,E,t.matrix);const R=s.aB([],c,E);if(t.meshes)for(const D of t.meshes){if(D.material.alphaMode!=="BLEND"){w.push({mesh:D,depth:0,modelIndex:m,worldViewProjection:R,nodeModelMatrix:E});continue}const L=s.af([],D.centroid,R);!u.isOrthographic&&L[2]<=0||_.push({mesh:D,depth:L[2],modelIndex:m,worldViewProjection:R,nodeModelMatrix:E})}if(t.children)for(const D of t.children)Od(u,D,r,c,m,_,w)}function Oh(u,t,r,c){const m=r.shadowRenderer;if(!m)return;const _=m.getShadowPassDepthMode(),w=m.getShadowPassColorMode(),E=m.calculateShadowPassMatrixFromMatrix(t),R=ks(E);r.getOrCreateProgram("modelDepth",{defines:r._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,_,Ci.disabled,w,Ni.backCCW,R,c.id,u.vertexBuffer,u.indexBuffer,u.segments,c.paint,r.transform.zoom,void 0,void 0)}function Wo(u,t,r){const c=t.updateZoomBasedPaintProperties(),m=function(_,w,E){let R,D,L,F=_.terrain?_.terrain.exaggeration():0;if(_.terrain&&F>0){const k=_.terrain,H=k.findDEMTileFor(E);H&&H.dem?R=s.ew.create(k,E,H):F=0}if(F===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),F===w.validForExaggeration&&(F===0||R&&R._demTile&&R._demTile.tileID===w.validForDEMTile.id&&R._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(const k in w.instancesPerModel){const H=w.instancesPerModel[k];for(let $=0;$<H.instancedDataArray.length;++$){const G=(R?F*R.getElevationAt(0|H.instancedDataArray.float32[16*$],0|H.instancedDataArray.float32[16*$+1],!0,!0):0)+H.instancesEvaluatedElevation[$];H.instancedDataArray.float32[16*$+6]=G,D=D?Math.min(w.terrainElevationMin,G):G,L=L?Math.max(w.terrainElevationMax,G):G}}return w.terrainElevationMin=D||0,w.terrainElevationMax=L||0,w.validForExaggeration=F,w.validForDEMTile=R&&R._demTile?{id:R._demTile.tileID,timestamp:R._dem._timestamp}:{id:void 0,timestamp:0},!0}(u,t,r);(c||m)&&(t.uploaded=!1,t.upload(u.context))}const sa={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.d8([0,0,0],[s.al,s.al,0])};function ao(u,t){const r=1<<u.canonical.z,c=t.getFreeCameraOptions().position,m=t.elevation,_=u.canonical.x/r,w=(u.canonical.x+1)/r,E=u.canonical.y/r,R=(u.canonical.y+1)/r;let D=t._centerAltitude;if(m){const H=m.getMinMaxForTile(u);H&&H.max>D&&(D=H.max)}const L=s.aA(c.x,_,w)-c.x,F=s.aA(c.y,E,R)-c.y,k=s.ce(D,t.center.lat)-c.z;return t._zoomFromMercatorZ(Math.sqrt(L*L+F*F+k*k))}function Wc(u,t,r,c,m,_,w){const E=u.context,R=u.renderPass==="shadow",D=u.shadowRenderer,L=R&&D?D.getShadowPassDepthMode():new ni(E.gl.LEQUAL,ni.ReadWrite,u.depthRangeFor3D),F=u.isTileAffectedByFog(_);if(r.meshes)for(const k of r.meshes){const H=["MODEL_POSITION_ON_GPU"],$=[];let G,ee,X;c.instancedDataArray.length>20&&H.push("INSTANCED_ARRAYS");const ie=zc(u,t.paint.get("model-cutoff-fade-range"));if(ie.shouldRenderCutoff&&H.push("RENDER_CUTOFF"),R&&D)G=u.getOrCreateProgram("modelDepth",{defines:H}),ee=ks(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(r.matrix)),X=D.getShadowPassColorMode();else{Lh(H,$,k,u,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),G=u.getOrCreateProgram("model",{defines:H,overrideFog:F});const de=k.material,Te=de.pbrMetallicRoughness,we=t.paint.get("model-opacity").constantOr(1),Ee=t.paint.get("model-emissive-strength").constantOr(0);ee=Rh(_.expandedProjMatrix,Float32Array.from(r.matrix),new Float32Array(16),null,u,we,Te.baseColorFactor,de.emissiveFactor,Te.metallicFactor,Te.roughnessFactor,de,Ee,t,m),D&&(w.shadowUniformsInitialized?G.setShadowUniformValues(E,D.getShadowUniformValues()):(D.setupShadows(_.toUnwrapped(),G,"model-tile"),w.shadowUniformsInitialized=!0)),X=ie.shouldRenderCutoff||we<1||de.alphaMode!=="OPAQUE"?tn.alphaBlended:tn.unblended}u.uploadCommonUniforms(E,G,_.toUnwrapped(),null,ie);const ce=k.material.doubleSided?Ni.disabled:Ni.backCCW;if(c.instancedDataArray.length>20)$.push(c.instancedDataBuffer),G.draw(u,E.gl.TRIANGLES,L,Ci.disabled,X,ce,ee,t.id,k.vertexBuffer,k.indexBuffer,k.segments,t.paint,u.transform.zoom,void 0,$,c.instancedDataArray.length);else{const de=R?"u_instance":"u_normal_matrix";for(let Te=0;Te<c.instancedDataArray.length;++Te)ee[de]=new Float32Array(c.instancedDataArray.arrayBuffer,64*Te,16),G.draw(u,E.gl.TRIANGLES,L,Ci.disabled,X,ce,ee,t.id,k.vertexBuffer,k.indexBuffer,k.segments,t.paint,u.transform.zoom,void 0,$)}}if(r.children)for(const k of r.children)Wc(u,t,k,c,m,_,w)}const Vp=[1,-1,1];function Vf(u,t,r,c){if(!r.modelManager)return!0;const m=r.modelManager;if(!r.shadowRenderer)return!0;const _=r.shadowRenderer,w=t.aabb;let E=!0,R=u.maxHeight;if(R===0){let L=0;for(const F in u.instancesPerModel){const k=m.getModel(F,c);k?L=Math.max(L,Math.max(Math.max(k.aabb.max[0],k.aabb.max[1]),k.aabb.max[2])):E=!1}R=u.maxScale*L*1.41+u.maxVerticalOffset,E&&(u.maxHeight=R)}w.max[2]=R,w.min[2]+=u.terrainElevationMin,w.max[2]+=u.terrainElevationMax,s.af(w.min,w.min,t.tileMatrix),s.af(w.max,w.max,t.tileMatrix);const D=w.intersects(_.getCurrentCascadeFrustum());return r.currentShadowCascade===0&&(u.isInsideFirstShadowMapFrustum=D===2),D===0}function kd(u,t){const r=u.uniformValues.u_cutoff_params[0],c=u.uniformValues.u_cutoff_params[1],m=u.uniformValues.u_cutoff_params[2],_=u.uniformValues.u_cutoff_params[3];return c===r||_===m?1:s.aA(((t-r)/(c-r)-m)/(_-m),0,1)}function Hf(u,t,r,c){if(t.pitch<20)return 1;const m=t.getWorldToCameraMatrix();s.aB(m,m,u);const _=s.bU(r.min[0],r.min[1],r.min[2],1);let w=s.aC(s.ex(),_,m),E=w,R=w;_[1]=r.max[1],w=s.aC(s.ex(),_,m),E=w[1]<E[1]?w:E,R=w[1]>R[1]?w:R,_[0]=r.max[0],w=s.aC(s.ex(),_,m),E=w[1]<E[1]?w:E,R=w[1]>R[1]?w:R,_[1]=r.min[1],w=s.aC(s.ex(),_,m),E=w[1]<E[1]?w:E,R=w[1]>R[1]?w:R;const D=s.aA(c[0],0,1),L=100*t.pixelsPerMeter*s.aA(c[1],0,1),F=s.aA(c[2],0,1),k=s.ey(s.ex(),E,R,D),H=Math.tan(.5*t.fovX),$=-k[2]*H;if(L===0)return k[1]<-Math.abs($)?F:1;const G=(-Math.abs($)-k[1])/L,ee=(ie,ce,de)=>(1-de)*ie+de*ce,X=s.aA(ee(1,F,G),F,1);return ee(1,X,s.aA((t.pitch-20)/20,0,1))}class Xc{}class Nd{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,r,c){{const F=this._storage.get(r.id);if(F)return F.lastUsedFrameIdx=t,F.buf}const m=c.gl,_=m.getBufferParameter(m.ELEMENT_ARRAY_BUFFER,m.BUFFER_SIZE),w=new ArrayBuffer(_),E=new Int16Array(w);m.getBufferSubData(m.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));const R=new s.eA;for(let F=0;F<_/2;F+=3){const k=E[F],H=E[F+1],$=E[F+2];R.emplaceBack(k,H),R.emplaceBack(H,$),R.emplaceBack($,k)}const D=c.bindVertexArrayOES.current,L=new Xc;return L.buf=new qo(c,R),L.lastUsedFrameIdx=t,this._storage.set(r.id,L),c.bindVertexArrayOES.set(D),L.buf}update(t){for(const[r,c]of this._storage)t-c.lastUsedFrameIdx>30&&(c.buf.destroy(),this._storage.delete(r))}destroy(){for(const[t,r]of this._storage)r.buf.destroy(),this._storage.delete(t)}}class jd{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const kh=s.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Lu{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Nh{constructor(t,r){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...r,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...r,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Hp=s.ef([{type:"Float32",name:"a_pos_2f",components:2}]);class qp{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,r){const c=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const w=new s.eB,E=new s.b1;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(1,1),w.emplaceBack(-1,1),E.emplaceBack(0,1,2),E.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(w,Hp.members),this.vignetteIdx=t.context.createIndexBuffer(E)}const m=s.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,c);const w={u_vignetteShape:(_={vignetteShape:[r.start,r.range,Math.pow(10,r.fadePower)],vignetteColor:[r.color.r,r.color.g,r.color.b,r.color.a*r.strength]}).vignetteShape,u_vignetteColor:_.vignetteColor};c.draw(t,t.context.gl.TRIANGLES,ni.disabled,Ci.disabled,tn.alphaBlended,Ni.disabled,w,"vignette",this.vignetteVx,this.vignetteIdx,m)}var _}}class Gp{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,r){const c=t.getFreeCameraOptions().position,m=c.toAltitude(),_=c.toLngLat(),w=s.an(_.lng),E=s.an(_.lat),R=t.pixelsPerMeter/r,D=w*s.eD,L=s.eD*Math.log(Math.tan(Math.PI/4+E/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const F=-this._offsetYPrev+L,k=-this._elevationPrev+m;this._accumulatedOffsetX+=(-this._offsetXPrev+D)*R,this._accumulatedOffsetY+=F*R,this._accumulatedElevation+=k*R,this._offsetXPrev=D,this._offsetYPrev=L,this._elevationPrev=m}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function $p(u,t){return[-(u[0]-Math.floor(u[0]/t)*t),-(u[1]-Math.floor(u[1]/t)*t),-(u[2]-Math.floor(u[2]/t)*t)]}function aa(u){const t=s.eo(1323123451230),r=[];for(let c=0;c<u;++c){const m=2*t()-1,_=2*t()-1,w=2*t()-1;r.push(s.d4(m,_,w))}return r}function ac(u,t,r,c,m){const _=s.aA((m-r)/(c-r),0,1);return(1-_)*u+_*t}class ls{constructor(t){this._movement=new Gp,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new qp,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,r){const c=t.transform;this._movement.update(c,this._ppmScaleFactor);const m=c.starsProjMatrix,_=s.c6([]);s.c8(_,_,s.an(90)-c._pitch),s.c7(_,_,-c.angle);const w=s.cb(new Float32Array(16),_),E=s.eC(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),R=s.ed([],E),D=s.aB([],R,w),L=Date.now()/1e3;return this._accumulatedTimeFromStart+=(L-this._prevTime)*r,this._prevTime=L,{projectionMatrix:m,modelviewMatrix:D}}}class En extends ls{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Nh(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const c=aa(this.particlesCount),m=new s.eE,_=new s.b1;let w=0;const E=s.eo(1323123451230);for(let R=0;R<c.length;++R){const D=c[R],L=[2*E()-1,E(),E(),E()];m.emplaceBack(D[0],D[1],D[2],-1,-1,...L),m.emplaceBack(D[0],D[1],D[2],1,-1,...L),m.emplaceBack(D[0],D[1],D[2],1,1,...L),m.emplaceBack(D[0],D[1],D[2],-1,1,...L),_.emplaceBack(w+0,w+1,w+2),_.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=r.createVertexBuffer(m,kh.members),this.particlesIdx=r.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const r=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},c=t.transform.zoom;if(r.revealStart>c)return;const m=ac(0,1,r.revealStart,r.revealStart+r.revealRange,c);if(!this.particlesVx||!this.particlesIdx)return;const _=structuredClone(this._params);let w=[-_.direction.x,_.direction.y,-100];s.aw(w,w);const E=structuredClone(this._vignetteParams);E.strength*=m,_.overrideStyleParameters||(_.intensity=t.style.rain.state.density,_.timeFactor=t.style.rain.state.intensity,_.color=structuredClone(t.style.rain.state.color),w=structuredClone(t.style.rain.state.direction),_.screenThinning.intensity=t.style.rain.state.centerThinning,_.dropletSizeX=t.style.rain.state.dropletSize[0],_.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],_.distortionStrength=100*t.style.rain.state.distortionStrength,E.strength=1,E.color=structuredClone(t.style.rain.state.vignetteColor));const R=this.updateOnRender(t,_.timeFactor),D=t.context,L=D.gl,F=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new s.T(D,{width:t.width,height:t.height,data:null},L.RGBA8)),_.distortionStrength>0&&(D.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),L.copyTexSubImage2D(L.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const k=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(D,k),D.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const H=[_.color.r,_.color.g,_.color.b,_.color.a],$=(G,ee)=>{const X=$p(this._movement.getPosition(),G),ie=_.dropletSizeX,ce=_.dropletSizeX*_.dropletSizeYScale,de=t.width/2,Te=t.height/2,we=ac(0,_.screenThinning.start,0,1,_.screenThinning.intensity),Ee=ac(.001,_.screenThinning.range,0,1,_.screenThinning.intensity),ve=ac(0,_.screenThinning.particleOffset,0,1,_.screenThinning.intensity),be=(Ce={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:X,velocityConeAperture:_.velocityConeAperture,velocity:_.velocity,boxSize:G,rainDropletSize:[ie,ce],distortionStrength:_.distortionStrength,rainDirection:w,color:H,screenSize:[F.width,F.height],thinningCenterPos:[de,Te],thinningShape:[we,Ee,Math.pow(10,_.screenThinning.fadePower)],thinningAffectedRatio:_.screenThinning.affectedRatio,thinningParticleOffset:ve,shapeDirectionalPower:_.shapeDirPower,shapeNormalPower:_.shapeNormalPower,mode:ee?0:1},{u_modelview:Float32Array.from(Ce.modelview),u_projection:Float32Array.from(Ce.projection),u_time:Ce.time,u_cam_pos:Ce.camPos,u_texScreen:0,u_velocityConeAperture:Ce.velocityConeAperture,u_velocity:Ce.velocity,u_boxSize:Ce.boxSize,u_rainDropletSize:Ce.rainDropletSize,u_distortionStrength:Ce.distortionStrength,u_rainDirection:Ce.rainDirection,u_color:Ce.color,u_screenSize:Ce.screenSize,u_thinningCenterPos:Ce.thinningCenterPos,u_thinningShape:Ce.thinningShape,u_thinningAffectedRatio:Ce.thinningAffectedRatio,u_thinningParticleOffset:Ce.thinningParticleOffset,u_shapeDirectionalPower:Ce.shapeDirectionalPower,u_shapeNormalPower:Ce.shapeNormalPower,u_mode:Ce.mode});var Ce;const We=Math.round(_.intensity*this.particlesCount),je=s.bg.simpleSegment(0,0,4*We,2*We);k.draw(t,L.TRIANGLES,ni.disabled,Ci.disabled,tn.alphaBlended,Ni.disabled,be,"rain_particles",this.particlesVx,this.particlesIdx,je)};_.distortionStrength>0&&$(_.boxSize,!0),$(_.boxSize,!1),this._vignette.draw(t,E)}}const yn=s.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Zp extends ls{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Nh(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const c=aa(this.particlesCount),m=new s.eF,_=new s.b1;let w=0;const E=s.eo(1323123451230);for(let R=0;R<c.length;++R){const D=c[R],L=E(),F=E(),k=E(),H=[R/c.length,L,F,k],$=[E(),E()];m.emplaceBack(D[0],D[1],D[2],-1,-1,...H,...$),m.emplaceBack(D[0],D[1],D[2],1,-1,...H,...$),m.emplaceBack(D[0],D[1],D[2],1,1,...H,...$),m.emplaceBack(D[0],D[1],D[2],-1,1,...H,...$),_.emplaceBack(w+0,w+1,w+2),_.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=r.createVertexBuffer(m,yn.members),this.particlesIdx=r.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const r=structuredClone(this._params);let c=[-r.direction.x,r.direction.y,-100];s.aw(c,c);const m=structuredClone(this._vignetteParams),_=r.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},w=t.transform.zoom;if(_.revealStart>w)return;const E=ac(0,1,_.revealStart,_.revealStart+_.revealRange,w);m.strength*=E,r.overrideStyleParameters||(r.intensity=t.style.snow.state.density,r.timeFactor=t.style.snow.state.intensity,r.color=structuredClone(t.style.snow.state.color),c=structuredClone(t.style.snow.state.direction),r.screenThinning.intensity=t.style.snow.state.centerThinning,r.billboardSize=2.79*t.style.snow.state.flakeSize,m.strength=1,m.color=structuredClone(t.style.snow.state.vignetteColor));const R=this.updateOnRender(t,r.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const D=t.context,L=D.gl,F=t.transform,k=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(D,k),((H,$,G)=>{const ee=$p(this._movement.getPosition(),H),X=F.width/2,ie=F.height/2,ce=ac(0,G.screenThinning.start,0,1,G.screenThinning.intensity),de=ac(.001,G.screenThinning.range,0,1,G.screenThinning.intensity),Te=ac(0,G.screenThinning.particleOffset,0,1,G.screenThinning.intensity),we=(Ee={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ee,velocityConeAperture:G.velocityConeAperture,velocity:G.velocity,horizontalOscillationRadius:G.horizontalOscillationRadius,horizontalOscillationRate:G.horizontalOscillationRate,boxSize:H,billboardSize:1*G.billboardSize,simpleShapeParameters:[G.shapeFadeStart,G.shapeFadePower],screenSize:[F.width,F.height],thinningCenterPos:[X,ie],thinningShape:[ce,de,Math.pow(10,G.screenThinning.fadePower)],thinningAffectedRatio:G.screenThinning.affectedRatio,thinningParticleOffset:Te,color:[G.color.r,G.color.g,G.color.b,G.color.a],direction:c},{u_modelview:Float32Array.from(Ee.modelview),u_projection:Float32Array.from(Ee.projection),u_time:Ee.time,u_cam_pos:Ee.camPos,u_velocityConeAperture:Ee.velocityConeAperture,u_velocity:Ee.velocity,u_horizontalOscillationRadius:Ee.horizontalOscillationRadius,u_horizontalOscillationRate:Ee.horizontalOscillationRate,u_boxSize:Ee.boxSize,u_billboardSize:Ee.billboardSize,u_simpleShapeParameters:Ee.simpleShapeParameters,u_screenSize:Ee.screenSize,u_thinningCenterPos:Ee.thinningCenterPos,u_thinningShape:Ee.thinningShape,u_thinningAffectedRatio:Ee.thinningAffectedRatio,u_thinningParticleOffset:Ee.thinningParticleOffset,u_particleColor:Ee.color,u_direction:Ee.direction});var Ee;const ve=Math.round(G.intensity*this.particlesCount),be=s.bg.simpleSegment(0,0,4*ve,2*ve);this.particlesVx&&this.particlesIdx&&k.draw(t,L.TRIANGLES,ni.disabled,Ci.disabled,tn.alphaBlended,Ni.disabled,we,"snow_particles",this.particlesVx,this.particlesIdx,be)})(r.boxSize,0,r),this._vignette.draw(t,m)}}const oc={symbol:function(u,t,r,c,m){if(u.renderPass!=="translucent")return;const _=Ci.disabled,w=u.colorModeForRenderPass(),E=r.layout.get("text-variable-anchor"),R=r.layout.get("text-size-scale-range"),D=s.aA(u.scaleFactor,R[0],R[1]);E&&function(k,H,$,G,ee,X,ie,ce){const de=H.transform,Te=ee==="map",we=X==="map";for(const Ee of k){const ve=G.getTile(Ee),be=ve.getBucket($);if(!be||!be.text||!be.text.segments.get().length)continue;const Ce=s.bK(be.textSizeData,de.zoom,ce),We=Qa(Ee,be.getProjection(),de),je=de.calculatePixelsToTileUnitsMatrix(ve),ct=eo(We,ve.tileID.canonical,we,Te,de,be.getProjection(),je),Ze=be.hasIconTextFit()&&be.hasIconData();Ce&&zd(be,Te,we,ie,de,ct,Ee,Math.pow(2,de.zoom-ve.tileID.overscaledZ),Ce,Ze)}}(c,u,r,t,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),m,D);const L=r.paint.get("icon-opacity").constantOr(1)!==0,F=r.paint.get("text-opacity").constantOr(1)!==0;r.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(L||F)?zh(u,t,r,c,_,w):(L&&zh(u,t,r,c,_,w,{onlyIcons:!0}),F&&zh(u,t,r,c,_,w,{onlyText:!0})),t.map.showCollisionBoxes&&(zu(u,t,r,c,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),zu(u,t,r,c,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(u,t,r,c){if(u.renderPass!=="translucent")return;const m=r.paint.get("circle-opacity"),_=r.paint.get("circle-stroke-width"),w=r.paint.get("circle-stroke-opacity"),E=r.layout.get("circle-sort-key").constantOr(1)!==void 0,R=r.paint.get("circle-emissive-strength");if(m.constantOr(1)===0&&(_.constantOr(1)===0||w.constantOr(1)===0))return;const D=u.context,L=D.gl,F=u.transform,k=!(!u.terrain||!u.terrain.enabled),H=r.layout.get("circle-elevation-reference"),$=u.depthModeForSublayer(0,ni.ReadOnly),G=new ni(u.context.gl.LEQUAL,ni.ReadOnly,u.depthRangeFor3D),ee=H==="none"||k?$:G,X=Ci.disabled,ie=u.colorModeForDrapableLayerRenderPass(R),ce=F.projection.name==="globe",de=[s.aF(F.center.lng),s.aJ(F.center.lat)],Te=[];for(let Ee=0;Ee<c.length;Ee++){const ve=c[Ee],be=t.getTile(ve),Ce=be.getBucket(r);if(!Ce||Ce.projection.name!==F.projection.name)continue;const We=Ce.programConfigurations.get(r.id),je=Ce.layoutVertexBuffer,ct=Ce.globeExtVertexBuffer,Ze=Ce.indexBuffer,ot=s.dZ(r),jt=[ct],Ye=u.isTileAffectedByFog(ve);ce&&ot.push("PROJECTION_GLOBE_VIEW"),ot.push("DEPTH_D24"),u.terrain&&F.depthOcclusionForSymbolsAndCircles&&ot.push("DEPTH_OCCLUSION"),Ce.hasElevation&&!u.terrain&&(ot.push("ELEVATED_ROADS"),jt.push(Ce.elevatedLayoutVertexBuffer));const Oe=u.getOrCreateProgram("circle",{config:We,defines:ot,overrideFog:Ye}),nt=F.projection.createInversionMatrix(F,ve.canonical),Ge={programConfiguration:We,program:Oe,layoutVertexBuffer:je,dynamicBuffers:jt,indexBuffer:Ze,uniformValues:s.d_(u,ve,be,nt,de,r),tile:be};if(E){const ht=Ce.segments.get();for(const _t of ht)Te.push({segments:new s.bg([_t]),sortKey:_t.sortKey,state:Ge})}else Te.push({segments:Ce.segments,sortKey:0,state:Ge})}E&&Te.sort((Ee,ve)=>Ee.sortKey-ve.sortKey);const we={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(const Ee of Te){const{programConfiguration:ve,program:be,layoutVertexBuffer:Ce,dynamicBuffers:We,indexBuffer:je,uniformValues:ct,tile:Ze}=Ee.state,ot=Ee.segments;u.terrain&&u.terrain.setupElevationDraw(Ze,be,we),u.uploadCommonUniforms(D,be,Ze.tileID.toUnwrapped()),be.draw(u,L.TRIANGLES,ee,X,ie,Ni.disabled,ct,r.id,Ce,je,ot,r.paint,F.zoom,ve,We)}},heatmap:function(u,t,r,c){if(r.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const m=u.context,_=m.gl,w=Ci.disabled,E=new tn([_.ONE,_.ONE,_.ONE,_.ONE],s.ao.transparent,[!0,!0,!0,!0]);(function(H,$,G,ee){const X=H.gl,ie=$.width*ee,ce=$.height*ee;H.activeTexture.set(X.TEXTURE1),H.viewport.set([0,0,ie,ce]);let de=G.heatmapFbo;if(!de||de&&(de.width!==ie||de.height!==ce)){de&&de.destroy();const Te=X.createTexture();X.bindTexture(X.TEXTURE_2D,Te),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.LINEAR),de=G.heatmapFbo=H.createFramebuffer(ie,ce,!0,null),function(we,Ee,ve,be,Ce,We){const je=we.gl;je.texImage2D(je.TEXTURE_2D,0,we.extRenderToTextureHalfFloat?je.RGBA16F:je.RGBA,Ce,We,0,je.RGBA,we.extRenderToTextureHalfFloat?je.HALF_FLOAT:je.UNSIGNED_BYTE,null),be.colorAttachment.set(ve)}(H,0,Te,de,ie,ce)}else X.bindTexture(X.TEXTURE_2D,de.colorAttachment.get()),H.bindFramebuffer.set(de.framebuffer)})(m,u,r,u.transform.projection.name==="globe"?.5:.25),m.clear({color:s.ao.transparent});const R=u.transform,D=R.projection.name==="globe",L=D?["PROJECTION_GLOBE_VIEW"]:[],F=D?Ni.frontCCW:Ni.disabled,k=[s.aF(R.center.lng),s.aJ(R.center.lat)];for(let H=0;H<c.length;H++){const $=c[H];if(t.hasRenderableParent($))continue;const G=t.getTile($),ee=G.getBucket(r);if(!ee||ee.projection.name!==R.projection.name)continue;const X=u.isTileAffectedByFog($),ie=ee.programConfigurations.get(r.id),ce=u.getOrCreateProgram("heatmap",{config:ie,defines:L,overrideFog:X}),{zoom:de}=u.transform;u.terrain&&u.terrain.setupElevationDraw(G,ce),u.uploadCommonUniforms(m,ce,$.toUnwrapped());const Te=R.projection.createInversionMatrix(R,$.canonical);ce.draw(u,_.TRIANGLES,ni.disabled,w,E,F,Mu(u,$,G,Te,k,de,r.paint.get("heatmap-intensity")),r.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,r.paint,u.transform.zoom,ie,D?[ee.globeExtVertexBuffer]:null)}m.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(m,_){const w=m.context,E=w.gl,R=_.heatmapFbo;if(!R)return;w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,R.colorAttachment.get()),w.activeTexture.set(E.TEXTURE1);let D=_.colorRampTexture;D||(D=_.colorRampTexture=new s.T(w,_.colorRamp,E.RGBA8)),D.bind(E.LINEAR,E.CLAMP_TO_EDGE),m.getOrCreateProgram("heatmapTexture").draw(m,E.TRIANGLES,ni.disabled,Ci.disabled,m.colorModeForRenderPass(),Ni.disabled,((L,F,k,H)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,_),_.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,_.paint,m.transform.zoom)}(u,r))},line:function(u,t,r,c){if(u.renderPass!=="translucent")return;const m=r.paint.get("line-opacity"),_=r.paint.get("line-width");if(m.constantOr(1)===0||_.constantOr(1)===0)return;const w=r.paint.get("line-emissive-strength"),E=r.paint.get("line-occlusion-opacity"),R=r.layout.get("line-elevation-reference"),D=r.layout.get("line-width-unit")==="meters",L=R==="sea",F=!(!u.terrain||!u.terrain.enabled),k=u.context,H=k.gl;if(r.hasElevatedBuckets&&u.transform.projection.name==="globe")return;const $=r.layout.get("line-cross-slope"),G=$!==void 0,ee=$<1,X=u.colorModeForDrapableLayerRenderPass(w),ie=u.terrain&&u.terrain.renderingToTexture,ce=ie?1:s.o.devicePixelRatio,de=r.paint.get("line-dasharray"),Te=de.constantOr(1),we=r.layout.get("line-cap"),Ee=de.constantOr(null),ve=we.constantOr(null),be=r.paint.get("line-pattern"),Ce=be.constantOr(1),We=r.paint.get("line-pattern-cross-fade"),je=be.constantOr(null),ct=r.paint.get("line-opacity").constantOr(1);let Ze=!Ce&&ct!==1||u.depthOcclusion&&E>0&&E<1;const ot=r.paint.get("line-gradient"),jt=Ce?"linePattern":"line",Ye=s.d$(r);let Oe;if(ie&&u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(Ze=!1),E!==0&&u.depthOcclusion){const _t=r.paint._values["line-opacity"];_t&&_t.value&&_t.value.kind==="constant"?Oe=_t.value:s.w(`Occlusion opacity for layer ${r.id} is supported only when line-opacity isn't data-driven.`)}_.value.kind!=="constant"&&_.value.isLineProgressConstant===!1&&Ye.push("VARIABLE_LINE_WIDTH");const nt=(_t,qt,Ct,Tt,gi,oi)=>{for(const ei of _t){const li=t.getTile(ei);if(Ce&&!li.patternsLoaded())continue;const Li=li.getBucket(r);if(!Li||Li.elevationType!=="none"&&!gi||Li.elevationType==="none"&&gi)continue;u.prepareDrawTile();const Ki=[...qt],Hi=u.shadowRenderer,zn=Li.elevationType==="road"&&!!Hi&&Hi.enabled;let qi=[0,0,0];if(zn){const Ji=u.style.directionalLight,Pi=u.style.ambientLight;Ji&&Pi&&(qi=bo(u.style,Ji,Pi)),Ki.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const _n=Li.programConfigurations.get(r.id);let On=!1;if(je&&li.imageAtlas){const Ji=s.e0.from(je),Pi=Ji.getPrimary().scaleSelf(ce).toString(),vn=li.imageAtlas.patternPositions.get(Pi),Mr=Ji.getSecondary(),kn=Mr?li.imageAtlas.patternPositions.get(Mr.scaleSelf(ce).toString()):null;On=!!vn&&!!kn,vn&&_n.setConstantPatternPositions(vn,kn)}We>0&&(On||_n.getPatternTransitionVertexBuffer("line-pattern"))&&Ki.push("LINE_PATTERN_TRANSITION");const or=u.isTileAffectedByFog(ei),Xi=u.getOrCreateProgram(jt,{config:_n,defines:Ki,overrideFog:or});if(!Ce&&Ee&&ve&&li.lineAtlas){const Ji=li.lineAtlas.getDash(Ee,ve);Ji&&_n.setConstantPatternPositions(Ji)}zn&&Hi.setupShadows(li.tileID.toUnwrapped(),Xi,"vector-tile");let[Rn,bn]=r.paint.get("line-trim-offset");(ve==="round"||ve==="square")&&Rn!==bn&&(Rn===0&&(Rn-=1),bn===1&&(bn+=1));const Dn=ie?ei.projMatrix:null,Qn=D?1/Li.tileToMeter/s.ay(li,1,u.transform.zoom):1,Er=D?1/Li.tileToMeter/s.ay(li,1,Math.floor(u.transform.zoom)):1,ns=Ce?s.e1(u,li,r,Dn,ce,Qn,Er,[Rn,bn],qi,We):s.e2(u,li,r,Dn,Li.lineClipsArray.length,ce,Qn,Er,[Rn,bn],qi);if(ot){const Ji=Li.gradients[r.id];let Pi=Ji.texture;if(r.gradientVersion!==Ji.version){let vn=256;if(r.stepInterpolant){const Mr=t.getSource().maxzoom,kn=ei.canonical.z===Mr?Math.ceil(1<<u.transform.maxZoom-ei.canonical.z):1;vn=s.aA(s.e3(Li.maxLineLength/s.al*1024*kn),256,k.maxTextureSize)}Ji.gradient=s.e4({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:vn,image:Ji.gradient||void 0,clips:Li.lineClipsArray}),Ji.texture?Ji.texture.update(Ji.gradient):Ji.texture=new s.T(k,Ji.gradient,H.RGBA8),Ji.version=r.gradientVersion,Pi=Ji.texture}k.activeTexture.set(H.TEXTURE1),Pi.bind(r.stepInterpolant?H.NEAREST:H.LINEAR,H.CLAMP_TO_EDGE)}Te&&(k.activeTexture.set(H.TEXTURE0),li.lineAtlasTexture&&li.lineAtlasTexture.bind(H.LINEAR,H.REPEAT),_n.updatePaintBuffers()),Ce&&(k.activeTexture.set(H.TEXTURE0),li.imageAtlasTexture&&li.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),_n.updatePaintBuffers()),gi&&!L&&u.terrain.setupElevationDraw(li,Xi),u.uploadCommonUniforms(k,Xi,ei.toUnwrapped());const ur=Ji=>{Oe!=null&&(Oe.value=ct*E),Xi.draw(u,H.TRIANGLES,Ct,Ji,X,Ni.disabled,ns,r.id,Li.layoutVertexBuffer,Li.indexBuffer,Li.segments,r.paint,u.transform.zoom,_n,[Li.layoutVertexBuffer2,Li.patternVertexBuffer,Li.zOffsetVertexBuffer]),Oe!=null&&(Oe.value=ct)};if(Ze&&!gi){const Ji=u.stencilModeForClipping(ei).ref;Ji===0&&ie&&k.clear({stencil:0});const Pi={func:H.EQUAL,mask:255};ns.u_alpha_discard_threshold=.8,ur(new Ci(Pi,Ji,255,H.KEEP,H.KEEP,H.INVERT)),ns.u_alpha_discard_threshold=0,ur(new Ci(Pi,Ji,255,H.KEEP,H.KEEP,H.KEEP))}else ns.u_alpha_discard_threshold=Ze&&gi&&oi?.8:0,ur(gi?Tt:u.stencilModeForClipping(ei))}};let Ge=u.depthModeForSublayer(0,ni.ReadOnly);const ht=new ni(u.depthOcclusion?H.GREATER:H.LEQUAL,ni.ReadOnly,u.depthRangeFor3D);if(r.hasNonElevatedBuckets){const _t=!ie&&u.terrain;E!==0&&_t?s.w(`Occlusion opacity for layer ${r.id} is supported on terrain only if the layer has line-z-offset enabled.`):_t?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${r.id}.`):nt(c,Ye,Ge,Ci.disabled,!1,!0)}if(r.hasElevatedBuckets){R==="hd-road-markup"?F||(Ge=ht,Ye.push("ELEVATED_ROADS")):(Ye.push("ELEVATED"),Ge=ht,G&&Ye.push(ee?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),L&&Ye.push("ELEVATION_REFERENCE_SEA"));const _t=Ze?u.stencilModeFor3D():Ci.disabled;u.forceTerrainMode=!0,nt(c,Ye,Ge,_t,!0,!0),Ze&&nt(c,Ye,Ge,_t,!0,!1),u.forceTerrainMode=!1}Ze&&(u.resetStencilClippingMasks(),ie&&k.clear({stencil:0})),E===0||u.depthOcclusion||ie||u.layersWithOcclusionOpacity.push(u.currentLayer)},fill:function(u,t,r,c){const m=r.paint.get("fill-color"),_=r.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const w=r.paint.get("fill-emissive-strength"),E=u.colorModeForDrapableLayerRenderPass(w),R=r.paint.get("fill-pattern"),D=u.opaquePassEnabledForLayer()&&!R.constantOr(1)&&m.constantOr(s.ao.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";let L="none";r.layout.get("fill-elevation-reference")!=="none"?L="road":r.paint.get("fill-z-offset").constantOr(1)!==0&&(L="offset");const F=!(!u.terrain||!u.terrain.enabled),k={painter:u,sourceCache:t,layer:r,coords:c,colorMode:E,elevationType:L,terrainEnabled:F,pass:D};if(u.renderPass!=="shadow")if(L!=="offset"){if(Du(k,!1),L==="road"){const H=!F&&u.renderPass==="translucent";H&&ic(u,t,r,c,"geometry"),Du(k,!0,Ci.disabled),H&&function($){const{painter:G,sourceCache:ee,layer:X,coords:ie,colorMode:ce}=$,de=G.context.gl,Te=$.painter.shadowRenderer,we=!!Te&&Te.enabled,Ee=new ni(G.context.gl.LEQUAL,ni.ReadOnly,G.depthRangeFor3D);let ve=[0,0,0];if(we){const Ce=G.style.directionalLight,We=G.style.ambientLight;Ce&&We&&(ve=bo(G.style,Ce,We))}const be=Ce=>{for(const We of ie){const je=ee.getTile(We),ct=je.getBucket(X);if(!ct)continue;const Ze=ct.elevatedStructures;if(!Ze)continue;let ot,jt;if(Ce?(ot=Ze.renderableBridgeSegments,jt=Ze.bridgeProgramConfigurations.get(X.id)):(ot=Ze.renderableTunnelSegments,jt=Ze.tunnelProgramConfigurations.get(X.id)),!ot||ot.segments[0].primitiveLength===0)continue;jt.updatePaintBuffers(),G.prepareDrawTile();const Ye=G.isTileAffectedByFog(We),Oe=[];we&&Oe.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const nt=G.getOrCreateProgram("elevatedStructures",{config:jt,overrideFog:Ye,defines:Oe}),Ge=G.translatePosMatrix(We.projMatrix,je,X.paint.get("fill-translate"),X.paint.get("fill-translate-anchor"));we&&Te.setupShadows(je.tileID.toUnwrapped(),nt,"vector-tile");const ht=jp(Ge,ve);G.uploadCommonUniforms(G.context,nt,We.toUnwrapped()),nt.draw(G,de.TRIANGLES,Ee,Ci.disabled,ce,Ni.backCCW,ht,X.id,Ze.vertexBuffer,Ze.indexBuffer,ot,X.paint,G.transform.zoom,jt,[Ze.vertexBufferNormal])}};be(!0),be(!1)}(k)}}else Du(k,!1,u.stencilModeFor3D());else u.shadowRenderer&&L==="road"&&!F&&function(H){const{painter:$,sourceCache:G,layer:ee,coords:X}=H,ie=$.context.gl,ce=H.painter.shadowRenderer;for(const de of X){const Te=G.getTile(de),we=Te.getBucket(ee);if(!we)continue;const Ee=we.elevatedStructures;if(!Ee||!Ee.shadowCasterSegments||Ee.shadowCasterSegments.segments[0].primitiveLength===0)continue;$.prepareDrawTile();const ve=we.bufferData.programConfigurations.get(ee.id),be=$.isTileAffectedByFog(de),Ce=$.getOrCreateProgram("elevatedStructuresDepth",{config:ve,overrideFog:be}),We=ce.calculateShadowPassMatrixFromTile(Te.tileID.toUnwrapped());$.uploadCommonUniforms($.context,Ce,de.toUnwrapped());const je={u_matrix:We,u_depth_bias:0};Ce.draw($,ie.TRIANGLES,ce.getShadowPassDepthMode(),Ci.disabled,ce.getShadowPassColorMode(),Ni.disabled,je,ee.id,Ee.vertexBuffer,Ee.indexBuffer,Ee.shadowCasterSegments,ee.paint,$.transform.zoom,ve)}}(k)},"fill-extrusion":function(u,t,r,c){const m=r.paint.get("fill-extrusion-opacity"),_=u.context,w=_.gl,E=u.terrain,R=E&&E.renderingToTexture;if(m===0)return;const D=u.conflationActive&&u.style.isLayerClipped(r,t.getSource()),L=u.style.order.indexOf(r.fqid);if(D&&function(F,k,H,$,G){for(const ee of $){const X=k.getTile(ee).getBucket(H);X&&(X.updateReplacement(ee,F.replacementSource,G),X.uploadCentroid(F.context))}}(u,t,r,c,L),E||D)for(const F of c){const k=t.getTile(F).getBucket(r);k&&nc(u.context,t,F,k,r,E,D)}if(u.renderPass==="shadow"&&u.shadowRenderer){const F=u.shadowRenderer;if(E&&m<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ad)return;const k=F.getShadowPassDepthMode(),H=F.getShadowPassColorMode();ri(u,t,r,c,k,Ci.disabled,H,D)}else if(u.renderPass==="translucent"){const F=!r.paint.get("fill-extrusion-pattern").constantOr(1),k=r.paint.get("fill-extrusion-color").constantOr(s.ao.white);if(!R&&k.a!==0){const H=new ni(u.context.gl.LEQUAL,ni.ReadWrite,u.depthRangeFor3D);m===1&&F?ri(u,t,r,c,H,Ci.disabled,tn.unblended,D):(ri(u,t,r,c,H,Ci.disabled,tn.disabled,D),ri(u,t,r,c,H,u.stencilModeFor3D(),u.colorModeForRenderPass(),D),u.resetStencilClippingMasks())}if(u.style.enable3dLights()&&F&&(!E&&u.transform.projection.name!=="globe"||R)){const H=r.paint.get("fill-extrusion-opacity"),$=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),G=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ee=r.paint.get("fill-extrusion-flood-light-intensity"),X=r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ie=r.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(X?null:r.lut).toArray01().slice(0,3),ce=$>0&&G>0,de=ee>0,Te=(ve,be,Ce)=>(1-Ce)*ve+Ce*be,we=new Pf;we.translate=r.paint.get("fill-extrusion-translate"),we.translateAnchor=r.paint.get("fill-extrusion-translate-anchor"),we.edgeRadius=r.layout.get("fill-extrusion-edge-radius"),we.cutoffFadeRange=r.paint.get("fill-extrusion-cutoff-fade-range");const Ee=ve=>{const be=u.depthModeForSublayer(1,ni.ReadOnly,w.LEQUAL,!0),Ce=r.paint.get(ve?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),We=Te(.1,3,Ce),je=u._showOverdrawInspector;if(!je){const ct=new Ci({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Ze=new tn([w.ONE,w.ONE,w.ONE,w.ONE],s.ao.transparent,[!1,!1,!1,!0],w.MIN);xl(we,u,t,r,c,be,ct,Ze,Ni.disabled,ve,"sdf",H,$,G,ee,ie,We,D,!1)}{const ct=je?Ci.disabled:new Ci({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Ze=je?u.colorModeForRenderPass():new tn([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],s.ao.transparent,[!0,!0,!0,!0]);xl(we,u,t,r,c,be,ct,Ze,Ni.disabled,ve,"color",H,$,G,ee,ie,We,D,!1)}};if(R){const ve=(be,Ce,We)=>{const je=u.depthModeForSublayer(1,ni.ReadOnly,w.LEQUAL,!1),ct=r.paint.get(be?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ze=Te(.1,3,ct);{const ot=new tn([w.ONE,w.ONE,w.ONE,w.ONE],s.ao.transparent,[!1,!1,!1,!0]);xl(we,u,t,r,c,je,Ci.disabled,ot,Ni.disabled,be,"clear",H,$,G,ee,ie,Ze,D,Ce)}{const ot=new Ci({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),jt=new tn([w.ONE,w.ONE,w.ONE,w.ONE],s.ao.transparent,[!1,!1,!1,!0],w.MIN);xl(we,u,t,r,c,je,ot,jt,Ni.disabled,be,"sdf",H,$,G,ee,ie,Ze,D,Ce)}{const ot=be?w.ZERO:w.ONE_MINUS_DST_ALPHA,jt=new Ci({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Ye=new tn([ot,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],s.ao.transparent,[!0,!0,!0,!0]);xl(we,u,t,r,c,je,jt,Ye,Ni.disabled,be,"color",H,$,G,ee,ie,Ze,D,Ce)}{const ot=new tn([w.ONE,w.ONE,w.ONE,be?w.ZERO:w.ONE],s.ao.transparent,[!1,!1,!1,!0],be?w.FUNC_ADD:w.MAX);xl(we,u,t,r,c,je,Ci.disabled,ot,Ni.disabled,be,"clear",H,$,G,ee,ie,Ze,D,Ce,We)}};if(ce||de){let be;if(u.prepareDrawTile(),E){const Ce=E.drapeBufferSize[0],We=E.drapeBufferSize[1];be=E.framebufferCopyTexture,be&&(!be||be.size[0]===Ce&&be.size[1]===We)||(be&&be.destroy(),be=E.framebufferCopyTexture=new s.T(_,new s.q({width:Ce,height:We}),w.RGBA8)),be.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexSubImage2D(w.TEXTURE_2D,0,0,0,0,0,Ce,We)}ce&&ve(!0,!1,be),de&&ve(!1,!0,be)}}else ce&&Ee(!0),de&&Ee(!1),(ce||de)&&u.resetStencilClippingMasks()}}},building:function(u,t,r,c){u.currentLayer<u.firstLightBeamLayer&&(u.firstLightBeamLayer=u.currentLayer);const m=r.paint.get("building-ambient-occlusion-ground-intensity"),_=r.paint.get("building-ambient-occlusion-ground-radius"),w=r.paint.get("building-ambient-occlusion-ground-attenuation"),E=r.paint.get("building-opacity");if(E<=0)return;let R=m>0&&_>0,D=!0;const L=r.paint.get("building-vertical-scale");(!u.shadowRenderer||L<1)&&(D=!1);const F=u.conflationActive&&u.style.isLayerClipped(r,t.getSource()),k=u.style.order.indexOf(r.fqid);if(function(H,$,G,ee,X,ie){for(const ce of ie){const de=$.getTile(ce).getBucket(G);de&&(X&&de.updateReplacement(ce,H.replacementSource,ee),de.uploadUpdatedIndexBuffer(H.context))}}(u,t,r,k,F,c),function(H,$,G,ee){for(const X of ee){const ie=$.getTile(X).getBucket(G);ie&&ie.needsEvaluation()&&ie.uploadUpdatedColorBuffer(H.context)}}(u,t,r,c),r.resetLayerRenderingStats(u),u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0),u.renderPass==="shadow"&&u.shadowRenderer){const H=u.shadowRenderer,$=[],G=H.getShadowPassDepthMode();Pd({painter:u,source:t,layer:r,coords:c,defines:$,blendMode:H.getShadowPassColorMode(),depthMode:G,opacity:E,verticalScale:L,facadeEmissiveChance:0,facadeAOIntensity:0})}else if(u.renderPass==="translucent"){let H=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];D&&(H=H.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),u.shadowRenderer&&u.shadowRenderer.useNormalOffset&&(H=H.concat("NORMAL_OFFSET"));const $=r.paint.get("building-facade-emissive-chance"),G=r.paint.get("building-ambient-occlusion-intensity"),ee=new ni(u.context.gl.LEQUAL,ni.ReadWrite,u.depthRangeFor3D);E<1&&Pd({painter:u,source:t,layer:r,coords:c,defines:H,blendMode:tn.disabled,depthMode:ee,opacity:E,verticalScale:L,facadeEmissiveChance:$,facadeAOIntensity:G});const X=u.colorModeForRenderPass();Pd({painter:u,source:t,layer:r,coords:c,defines:H,blendMode:X,depthMode:ee,opacity:E,verticalScale:L,facadeEmissiveChance:$,facadeAOIntensity:G}),R&&function(ie,ce,de,Te,we,Ee,ve,be,Ce,We,je,ct,Ze){const ot=ie.context.gl,jt=ie.depthModeForSublayer(1,ni.ReadOnly,ot.LEQUAL,!0),Ye=.1*(1-(Oe=je))+3*Oe;var Oe;const nt=ie._showOverdrawInspector,Ge=ct,ht=new Pf;nt||xl(ht,ie,ce,de,Te,jt,new Ci({func:ot.ALWAYS,mask:255},255,255,ot.KEEP,ot.KEEP,ot.REPLACE),new tn([ot.ONE,ot.ONE,ot.ONE,ot.ONE],s.ao.transparent,[!1,!1,!1,!0],ot.MIN),Ni.disabled,we,"sdf",Ee,ve,be,0,We,Ye,Ge,!1);{const _t=nt?Ci.disabled:new Ci({func:ot.EQUAL,mask:255},255,255,ot.KEEP,ot.DECR,ot.DECR),qt=nt?ie.colorModeForRenderPass():new tn([ot.ONE_MINUS_DST_ALPHA,ot.DST_ALPHA,ot.ONE,ot.ONE],s.ao.transparent,[!0,!0,!0,!0]);xl(ht,ie,ce,de,Te,jt,_t,qt,Ni.disabled,we,"color",Ee,ve,be,0,We,Ye,Ge,!1)}}(u,t,r,c,!0,E,m,_,0,[0,0,0],w,F)}else if(u.renderPass==="light-beam"){const H=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],$=new ni(u.context.gl.LEQUAL,ni.ReadOnly,u.depthRangeFor3D);Pd({painter:u,source:t,layer:r,coords:c,defines:H,blendMode:tn.alphaBlended,depthMode:$,opacity:E,verticalScale:L,facadeEmissiveChance:0,facadeAOIntensity:0})}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1),u.resetStencilClippingMasks()},hillshade:function(u,t,r,c){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent"||u.style.disableElevatedTerrain)return;const m=u.context,_=u.terrain&&u.terrain.renderingToTexture,[w,E]=u.renderPass!=="translucent"||_?[{},c]:u.stencilConfigForOverlap(c);for(const R of E){const D=t.getTile(R);if(D.needsHillshadePrepare&&u.renderPass==="offscreen")To(u,D,r);else if(u.renderPass==="translucent"){const L=u.depthModeForSublayer(0,ni.ReadOnly),F=r.paint.get("hillshade-emissive-strength"),k=u.colorModeForDrapableLayerRenderPass(F),H=_&&u.terrain?u.terrain.stencilModeForRTTOverlap(R):w[R.overscaledZ];Tf(u,R,D,r,L,H,k)}}m.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,t,r,c,m,_){if(u.renderPass!=="translucent"||r.paint.get("raster-opacity")===0)return;const w=u.transform.projection.name==="globe",E=r.paint.get("raster-elevation")!==0,R=E&&w;if(u.renderElevatedRasterBackface&&!R)return;const D=u.context,L=D.gl,F=t.getSource(),k=function(we,Ee,ve,be){const Ce=Ee.paint.get("raster-color"),We=we.type==="raster-array",je=[],ct=Ee.paint.get("raster-resampling"),Ze=Ee.paint.get("raster-color-mix");let ot=Ee.paint.get("raster-color-range");const jt=[Ze[0],Ze[1],Ze[2],0],Ye=Ze[3];let Oe=ct==="nearest"?be.NEAREST:be.LINEAR;if(We&&(je.push("RASTER_ARRAY"),Ce||je.push("RASTER_COLOR"),ct==="linear"&&je.push("RASTER_ARRAY_LINEAR"),Oe=be.NEAREST,!ot&&we.rasterLayers)){const nt=we.rasterLayers.find(({id:Ge})=>Ge===Ee.sourceLayer);nt&&nt.fields&&nt.fields.range&&(ot=nt.fields.range)}if(ot=ot||[0,1],Ce){je.push("RASTER_COLOR"),ve.activeTexture.set(be.TEXTURE2),Ee.updateColorRamp(ot);let nt=Ee.colorRampTexture;nt||(nt=Ee.colorRampTexture=new s.T(ve,Ee.colorRamp,be.RGBA8)),nt.bind(be.LINEAR,be.CLAMP_TO_EDGE)}return{mix:jt,range:ot,offset:Ye,defines:je,resampling:Oe}}(F,r,D,L);if(F instanceof s.aS&&!c.length&&!w)return;const H=r.paint.get("raster-emissive-strength"),$=u.colorModeForDrapableLayerRenderPass(H),G=u.terrain&&u.terrain.renderingToTexture,ee=!u.options.moving,X=r.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(F instanceof s.aS&&!c.length&&(F.onNorthPole||F.onSouthPole)){const we=E?u.stencilModeFor3D():Ci.disabled;return void Of(!!F.onNorthPole,null,u,t,r,H,k,Ni.disabled,we)}if(!c.length)return;const[ie,ce]=F instanceof s.aS||G?[{},c]:u.stencilConfigForOverlap(c),de=ce[ce.length-1].overscaledZ;R&&k.defines.push("PROJECTION_GLOBE_VIEW"),E&&k.defines.push("RENDER_CUTOFF");const Te=(we,Ee,ve)=>{for(const be of we){const Ce=be.toUnwrapped(),We=t.getTile(be);if(G&&(!We||!We.hasData()))continue;D.activeTexture.set(L.TEXTURE0);const je=Pu(We,F,r,k);if(!je||!je.texture)continue;const{texture:ct,mix:Ze,offset:ot,tileSize:jt,buffer:Ye}=je;let Oe,nt;G?(Oe=ni.disabled,nt=be.projMatrix):E?(Oe=new ni(L.LEQUAL,ni.ReadWrite,u.depthRangeFor3D),nt=w?Float32Array.from(u.transform.expandedFarZProjMatrix):u.transform.calculateProjMatrix(Ce,ee)):(Oe=u.depthModeForSublayer(be.overscaledZ-de,r.paint.get("raster-opacity")===1?ni.ReadWrite:ni.ReadOnly,L.LESS),nt=u.transform.calculateProjMatrix(Ce,ee));const Ge=u.terrain&&G?u.terrain.stencilModeForRTTOverlap(be):ie[be.overscaledZ],ht=_?0:r.paint.get("raster-fade-duration");We.registerFadeDuration(ht);const _t=t.findLoadedParent(be,0),qt=Ha(We,_t,t,u.transform,ht);let Ct,Tt;!qt.isFading&&We.refreshedUponExpiration&&(We.refreshedUponExpiration=!1),u.terrain&&u.terrain.prepareDrawTile(),D.activeTexture.set(L.TEXTURE0),ct.bind(X,L.CLAMP_TO_EDGE),D.activeTexture.set(L.TEXTURE1),_t?(_t.texture&&_t.texture.bind(X,L.CLAMP_TO_EDGE),Ct=Math.pow(2,_t.tileID.overscaledZ-We.tileID.overscaledZ),Tt=[We.tileID.canonical.x*Ct%1,We.tileID.canonical.y*Ct%1]):ct.bind(X,L.CLAMP_TO_EDGE),"useMipmap"in ct&&D.extTextureFilterAnisotropic&&u.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const gi=u.transform;let oi;const ei=E?qm(gi):[0,0,0,0];let li,Li,Ki,Hi,zn,qi=0;if(R&&F instanceof s.aS&&F.coordinates.length>3)li=Float32Array.from(s.bk(s.dF(new s.cC(0,0,0)))),Li=Float32Array.from(gi.globeMatrix),Ki=Float32Array.from(s.dB(gi)),Hi=[s.aF(gi.center.lng),s.aJ(gi.center.lat)],oi=F.elevatedGlobePerspectiveTransform,zn=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(R){const Xi=s.dC(be.canonical);qi=s.dD(Xi.getCenter().lat),li=Float32Array.from(s.bk(s.dF(be.canonical))),Li=Float32Array.from(gi.globeMatrix),Ki=Float32Array.from(s.dB(gi)),Hi=[s.aF(gi.center.lng),s.aJ(gi.center.lat)],oi=[0,0],zn=Float32Array.from(s.dE(be.canonical,Xi,qi,gi.worldSize/gi._pixelsPerMercatorPixel))}else oi=F instanceof s.aS?F.perspectiveTransform:[0,0],li=new Float32Array(16),Li=new Float32Array(9),Ki=new Float32Array(16),Hi=[0,0],zn=new Float32Array(9);const _n=Hc(nt,li,Li,Ki,zn,Tt||[0,0],s.aj(u.transform.zoom),Hi,ei,Ct||1,qt,r,oi,E?r.paint.get("raster-elevation"):0,2,Ze,ot,k.range,jt,Ye,H),On=u.isTileAffectedByFog(be),or=u.getOrCreateProgram("raster",{defines:k.defines,overrideFog:On});if(u.uploadCommonUniforms(D,or,Ce),F instanceof s.aS){const Xi=F.elevatedGlobeVertexBuffer,Rn=F.elevatedGlobeIndexBuffer;if(G||!w)F.boundsBuffer&&F.boundsSegments&&or.draw(u,L.TRIANGLES,Oe,Ci.disabled,$,Ni.disabled,_n,r.id,F.boundsBuffer,u.quadTriangleIndexBuffer,F.boundsSegments);else if(Xi&&Rn){const bn=gi.zoom<=s.cZ?F.elevatedGlobeSegments:F.getSegmentsForLongitude(gi.center.lng);bn&&or.draw(u,L.TRIANGLES,Oe,Ci.disabled,$,Ee,_n,r.id,Xi,Rn,bn)}}else if(R){Oe=new ni(L.LEQUAL,ni.ReadOnly,u.depthRangeFor3D);const Xi=u.globeSharedBuffers;if(Xi){const[Rn,bn,Dn]=Xi.getGridBuffers(qi,!1);or.draw(u,L.TRIANGLES,Oe,ve||Ge,u.colorModeForRenderPass(),Ee,_n,r.id,Rn,bn,Dn)}}else{const{tileBoundsBuffer:Xi,tileBoundsIndexBuffer:Rn,tileBoundsSegments:bn}=u.getTileBoundsBuffers(We);or.draw(u,L.TRIANGLES,Oe,Ge,$,Ni.disabled,_n,r.id,Xi,Rn,bn)}}if(!(F instanceof s.aS)&&R)for(const be of we){const Ce=be.canonical.y===(1<<be.canonical.z)-1;be.canonical.y===0&&Of(!0,be,u,t,r,H,k,Ee,ve||Ci.disabled),Ce&&Of(!1,be,u,t,r,H,k,Ee===Ni.frontCW?Ni.backCW:Ni.frontCW,ve||Ci.disabled)}};R?Te(ce,u.renderElevatedRasterBackface?Ni.backCW:Ni.frontCW,u.stencilModeFor3D()):Te(ce,Ni.disabled,void 0),u.resetStencilClippingMasks()},"raster-particle":function(u,t,r,c,m,_){u.renderPass==="offscreen"&&function(w,E,R,D){if(!D.length)return;const L=w.context,F=L.gl,k=E.getSource();if(!(k instanceof Ll))return;const H=Math.ceil(Math.sqrt(R.paint.get("raster-particle-count")));let $=R.particlePositionRGBAImage;if(!$||$.width!==H){const ce=function(de){const Te=de*de,we=new Uint8Array(4*Te),Ee=function(be){return be|=0,be=Math.imul(2747636419^be,2654435769),be=Math.imul(be^be>>>16,2654435769),((be=Math.imul(be^be>>>16,2654435769))>>>0)/4294967296},ve=1/1.1;for(let be=0;be<Te;be++){const Ce=ve*(Ee(2*be+0)+Iu),We=ve*(Ee(2*be+1)+Iu),je=255*Ce%1,ct=255*We%1,Ze=je,ot=We-ct/255,jt=ct;we[4*be+0]=255*(Ce-je/255),we[4*be+1]=255*Ze,we[4*be+2]=255*ot,we[4*be+3]=255*jt}return we}(H);$=R.particlePositionRGBAImage=new s.q({width:H,height:H},ce)}let G=R.particleFramebuffer;G?G.width!==H&&(G.destroy(),G=R.particleFramebuffer=L.createFramebuffer(H,H,!0,null)):G=R.particleFramebuffer=L.createFramebuffer(H,H,!0,null);const ee=[];for(const ce of D){const de=E.getTile(ce);if(!(de instanceof od))continue;const Te=ra(de,k,R);if(!Te)continue;const we=[de.tileSize,de.tileSize];let Ee=R.tileFramebuffer;Ee||(Ee=R.tileFramebuffer=L.createFramebuffer(we[0],we[1],!0,null));let ve=de.rasterParticleState;ve||(ve=de.rasterParticleState=new kf(L,ce,we,$));const be=ve.update(R.lastInvalidatedAt);ve.particleTextureDimension!==H&&ve.updateParticleTexture(ce,$);const Ce=ve.targetColorTexture;ve.targetColorTexture=ve.backgroundColorTexture,ve.backgroundColorTexture=Ce;const We=ve.particleTexture0;ve.particleTexture0=ve.particleTexture1,ve.particleTexture1=We,ee.push([ce,Te,ve,be])}if(ee.length===0)return;const X=s.o.now(),ie=R.previousDrawTimestamp?.001*(X-R.previousDrawTimestamp):.0167;if(R.previousDrawTimestamp=X,R.hasColorMap()){L.activeTexture.set(F.TEXTURE0+2);let ce=R.colorRampTexture;ce||(ce=R.colorRampTexture=new s.T(L,R.colorRamp,F.RGBA8)),ce.bind(F.LINEAR,F.CLAMP_TO_EDGE)}L.bindFramebuffer.set(R.tileFramebuffer.framebuffer),function(ce,de,Te){const we=ce.context,Ee=we.gl,ve=de.tileFramebuffer;we.activeTexture.set(Ee.TEXTURE0);const be={u_texture:0,u_opacity:1.05*(We=de.paint.get("raster-particle-fade-opacity-factor"))/(We+.05)},Ce=ce.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var We;for(const je of Te){const[,,ct,Ze]=je;ve.colorAttachment.set(ct.targetColorTexture.texture),we.viewport.set([0,0,ve.width,ve.height]),we.clear({color:s.ao.transparent}),Ze&&(ct.backgroundColorTexture.bind(Ee.NEAREST,Ee.CLAMP_TO_EDGE),Ce.draw(ce,Ee.TRIANGLES,ni.disabled,Ci.disabled,tn.alphaBlended,Ni.disabled,be,de.id,ce.viewportBuffer,ce.quadTriangleIndexBuffer,ce.viewportSegments))}}(w,R,ee),function(ce,de,Te,we){const Ee=ce.context,ve=Ee.gl,be=Te.tileFramebuffer,Ce=ce.transform.projection.name==="globe",We=Te.paint.get("raster-particle-max-speed");for(const je of we){const[ct,Ze,ot]=je;Ee.activeTexture.set(ve.TEXTURE0+0),Ze.texture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE),be.colorAttachment.set(ot.targetColorTexture.texture);const jt=ce.getOrCreateProgram("rasterParticleDraw",{defines:Ze.defines,overrideFog:!1});Ee.activeTexture.set(ve.TEXTURE0+1);const Ye=Ze.scalarData?[]:[0,1,2,3].map(Ge=>s.e6[Ge](ct));Ye.push(ct);const Oe=ct.canonical.x,nt=ct.canonical.y;for(const Ge of Ye){const ht=de.getTile(Ce?Ge.wrapped():Ge);if(!ht)continue;const _t=ht.rasterParticleState;if(!_t)continue;const qt=Ge.canonical.x+(1<<Ge.canonical.z)*(Ge.wrap-ct.wrap),Ct=Ge.canonical.y;_t.particleTexture0.bind(ve.NEAREST,ve.CLAMP_TO_EDGE);const Tt=Rd(1,_t.particleTexture0.size[0],[qt-Oe,Ct-nt],0,Ze.texture.size,2,We,Ze.textureOffset,Ze.scale,Ze.offset);jt.draw(ce,ve.POINTS,ni.disabled,Ci.disabled,tn.alphaBlended,Ni.disabled,Tt,Te.id,_t.particleIndexBuffer,void 0,_t.particleSegment)}}}(w,E,R,ee),L.bindFramebuffer.set(R.particleFramebuffer.framebuffer),function(ce,de,Te,we){const Ee=ce.context,ve=Ee.gl,be=de.paint.get("raster-particle-max-speed"),Ce=we*de.paint.get("raster-particle-speed-factor")*.15,We=function(ct){return Math.pow(ct,6)}(.01+1*de.paint.get("raster-particle-reset-rate-factor")),je=de.particleFramebuffer;Ee.viewport.set([0,0,je.width,je.height]);for(const ct of Te){const[,Ze,ot]=ct;Ee.activeTexture.set(ve.TEXTURE0+0),Ze.texture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE),Ee.activeTexture.set(ve.TEXTURE0+1);const jt=ot.particleTexture0;jt.bind(ve.NEAREST,ve.CLAMP_TO_EDGE);const Ye=Ah(1,jt.size[0],0,Ze.texture.size,be,Ce,We,Ze.textureOffset,Ze.scale,Ze.offset);je.colorAttachment.set(ot.particleTexture1.texture),Ee.clear({color:s.ao.transparent}),ce.getOrCreateProgram("rasterParticleUpdate",{defines:Ze.defines}).draw(ce,ve.TRIANGLES,ni.disabled,Ci.disabled,tn.unblended,Ni.disabled,Ye,de.id,ce.viewportBuffer,ce.quadTriangleIndexBuffer,ce.viewportSegments)}}(w,R,ee,ie)}(u,t,r,c),u.renderPass==="translucent"&&(function(w,E,R,D,L){const F=w.context,k=F.gl,H=E.getSource().tileSize,$=5*(1-s.ah(s.cK,s.cK+1,w.transform.zoom))*H+R.paint.get("raster-particle-elevation"),G=!w.options.moving,ee=w.transform.projection.name==="globe";if(!D.length)return;const[X,ie]=w.stencilConfigForOverlap(D),ce=[];ee&&ce.push("PROJECTION_GLOBE_VIEW");const de=w.stencilModeFor3D();for(const Te of ie){const we=Te.toUnwrapped(),Ee=E.getTile(Te);if(!Ee.rasterParticleState)continue;const ve=Ee.rasterParticleState,be=100;Ee.registerFadeDuration(be);const Ce=E.findLoadedParent(Te,0),We=Ha(Ee,Ce,E,w.transform,be);let je,ct;w.terrain&&w.terrain.prepareDrawTile(),F.activeTexture.set(k.TEXTURE0),ve.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),F.activeTexture.set(k.TEXTURE1),Ce&&Ce.rasterParticleState?(Ce.rasterParticleState.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),je=Math.pow(2,Ce.tileID.overscaledZ-Ee.tileID.overscaledZ),ct=[Ee.tileID.canonical.x*je%1,Ee.tileID.canonical.y*je%1]):ve.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const Ze=ee?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(we,G),ot=w.transform,jt=Nf(ot),Ye=s.dC(Te.canonical),Oe=s.dD(Ye.getCenter().lat);let nt,Ge,ht,_t,qt;ee?(nt=Float32Array.from(s.bk(s.dF(Te.canonical))),Ge=Float32Array.from(ot.globeMatrix),ht=Float32Array.from(s.dB(ot)),_t=[s.aF(ot.center.lng),s.aJ(ot.center.lat)],qt=Float32Array.from(s.dE(Te.canonical,Ye,Oe,ot.worldSize/ot._pixelsPerMercatorPixel))):(nt=new Float32Array(16),Ge=new Float32Array(9),ht=new Float32Array(16),_t=[0,0],qt=new Float32Array(9));const Ct=Hr(Ze,nt,Ge,ht,qt,ct||[0,0],s.aj(w.transform.zoom),_t,jt,je||1,We,$),Tt=w.isTileAffectedByFog(Te),gi=w.getOrCreateProgram("rasterParticle",{defines:ce,overrideFog:Tt});if(w.uploadCommonUniforms(F,gi,we),ee){const oi=new ni(k.LEQUAL,ni.ReadOnly,w.depthRangeFor3D),ei=0,li=w.globeSharedBuffers;if(li){const[Li,Ki,Hi]=li.getGridBuffers(Oe,ei!==0);gi.draw(w,k.TRIANGLES,oi,de,tn.alphaBlended,w.renderElevatedRasterBackface?Ni.frontCCW:Ni.backCCW,Ct,R.id,Li,Ki,Hi)}}else{const oi=w.depthModeForSublayer(0,ni.ReadOnly),ei=X[Te.overscaledZ],{tileBoundsBuffer:li,tileBoundsIndexBuffer:Li,tileBoundsSegments:Ki}=w.getTileBoundsBuffers(Ee);gi.draw(w,k.TRIANGLES,oi,ei,tn.alphaBlended,Ni.disabled,Ct,R.id,li,Li,Ki)}}w.resetStencilClippingMasks()}(u,t,r,c),u.style.map.triggerRepaint())},background:function(u,t,r,c){const m=r.paint.get("background-color"),_=r.paint.get("background-color-use-theme").constantOr("default")==="none",w=r.paint.get("background-opacity"),E=r.paint.get("background-emissive-strength"),R=r.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const D=u.context,L=D.gl,F=u.transform,k=F.tileSize,H=r.paint.get("background-pattern");let $;if(H!==void 0&&(H===null||($=u.imageManager.getPattern(s.I.from(H.toString()),r.scope,u.style.getLut(r.scope)),!$)))return;const G=!H&&m.a===1&&w===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==G)return;const ee=Ci.disabled,X=u.depthModeForSublayer(0,G==="opaque"?ni.ReadWrite:ni.ReadOnly),ie=u.colorModeForDrapableLayerRenderPass(E),ce=H?"backgroundPattern":"background";let de,Te=c;if(Te||(de=u.getBackgroundTiles(),Te=Object.values(de).map(we=>we.tileID)),H&&(D.activeTexture.set(L.TEXTURE0),u.imageManager.bind(u.context,r.scope)),R){const we=u.getOrCreateProgram(ce,{overrideFog:!1,overrideRtt:!0}),Ee=new Float32Array(s.bA([])),ve=new s.aO(0,0,0,0,0),be=H?Ch(Ee,E,w,u,0,r.scope,$,R,{tileID:ve,tileSize:k}):If(Ee,E,w,m.toPremultipliedRenderColor(_?null:r.lut));we.draw(u,L.TRIANGLES,X,ee,ie,Ni.disabled,be,r.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments)}else for(const we of Te){const Ee=u.isTileAffectedByFog(we),ve=u.getOrCreateProgram(ce,{overrideFog:Ee}),be=we.toUnwrapped(),Ce=c?we.projMatrix:u.transform.calculateProjMatrix(be);u.prepareDrawTile();const We=t?t.getTile(we):de?de[we.key]:new Sc(we,k,F.zoom,u),je=H?Ch(Ce,E,w,u,0,r.scope,$,R,{tileID:we,tileSize:k}):If(Ce,E,w,m.toPremultipliedRenderColor(_?null:r.lut));u.uploadCommonUniforms(D,ve,be);const{tileBoundsBuffer:ct,tileBoundsIndexBuffer:Ze,tileBoundsSegments:ot}=u.getTileBoundsBuffers(We);ve.draw(u,L.TRIANGLES,X,ee,ie,Ni.disabled,je,r.id,ct,Ze,ot)}},sky:function(u,t,r){const c=u._atmosphere?s.aj(u.transform.zoom):1,m=r.paint.get("sky-opacity")*c;if(m===0)return;const _=u.context,w=r.paint.get("sky-type"),E=new ni(_.gl.LEQUAL,ni.ReadOnly,[0,1]),R=u.frameCounter/1e3%1;w==="atmosphere"?u.renderPass==="offscreen"?r.needsSkyboxCapture(u)&&(function(D,L,F,k){const H=D.context,$=H.gl;let G=L.skyboxFbo;if(!G){G=L.skyboxFbo=H.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new Uf(H),L.skyboxTexture=H.gl.createTexture(),$.bindTexture($.TEXTURE_CUBE_MAP,L.skyboxTexture),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MAG_FILTER,$.LINEAR);for(let ce=0;ce<6;++ce)$.texImage2D($.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,$.RGBA,32,32,0,$.RGBA,$.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(G.framebuffer),H.viewport.set([0,0,32,32]);const ee=L.getCenter(D,!0),X=D.getOrCreateProgram("skyboxCapture"),ie=new Float64Array(16);s.bA(ie),s.ek(ie,ie,.5*-Math.PI),$c(D,L,X,ie,ee,0),s.bA(ie),s.ek(ie,ie,.5*Math.PI),$c(D,L,X,ie,ee,1),s.bA(ie),s.cT(ie,ie,.5*-Math.PI),$c(D,L,X,ie,ee,2),s.bA(ie),s.cT(ie,ie,.5*Math.PI),$c(D,L,X,ie,ee,3),s.bA(ie),$c(D,L,X,ie,ee,4),s.bA(ie),s.ek(ie,ie,Math.PI),$c(D,L,X,ie,ee,5),H.viewport.set([0,0,D.width,D.height])}(u,r),r.markSkyboxValid(u)):u.renderPass==="sky"&&function(D,L,F,k,H){const $=D.context,G=$.gl,ee=D.transform,X=D.getOrCreateProgram("skybox");$.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,L.skyboxTexture);const ie=((ce,de,Te,we,Ee)=>({u_matrix:ce,u_sun_direction:de,u_cubemap:0,u_opacity:we,u_temporal_offset:Ee}))(ee.skyboxMatrix,L.getCenter(D,!1),0,k,H);D.uploadCommonUniforms($,X),X.draw(D,G.TRIANGLES,F,Ci.disabled,D.colorModeForRenderPass(),Ni.backCW,ie,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(u,r,E,m,R):w==="gradient"&&u.renderPass==="sky"&&function(D,L,F,k,H){const $=D.context,G=$.gl,ee=D.transform,X=D.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new Uf($)),$.activeTexture.set(G.TEXTURE0);let ie=L.colorRampTexture;ie||(ie=L.colorRampTexture=new s.T($,L.colorRamp,G.RGBA8)),ie.bind(G.LINEAR,G.CLAMP_TO_EDGE);const ce=((de,Te,we,Ee,ve)=>({u_matrix:de,u_color_ramp:0,u_center_direction:Te,u_radius:s.an(we),u_opacity:Ee,u_temporal_offset:ve}))(ee.skyboxMatrix,L.getCenter(D,!1),L.paint.get("sky-gradient-radius"),k,H);D.uploadCommonUniforms($,X),X.draw(D,G.TRIANGLES,F,Ci.disabled,D.colorModeForRenderPass(),Ni.backCW,ce,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(u,r,E,m,R)},custom:function(u,t,r,c){const m=u.context,_=r.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&r.isDraped(t)){if(u.renderPass==="offscreen"){const w=_.prerender;if(w){if(u.setCustomLayerDefaults(),m.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){const E=u.transform.pointMerc;w.call(_,m.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),s.aj(u.transform.zoom),[E.x,E.y],u.transform.pixelsPerMeterRatio)}else w.call(_,m.gl,u.transform.customLayerMatrix());m.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){const E=_.renderToTile;if(E){const R=c[0].canonical,D={x:R.x+c[0].wrap*(_.wrapTileId?0:1<<R.z),y:R.y,z:R.z};m.setDepthMode(ni.disabled),m.setStencilMode(Ci.disabled),m.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),E.call(_,m.gl,D),m.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),m.setColorMode(u.colorModeForRenderPass()),m.setStencilMode(Ci.disabled);const w=_.renderingMode==="3d"?new ni(u.context.gl.LEQUAL,ni.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,ni.ReadOnly);if(m.setDepthMode(w),u.transform.projection.name==="globe"){const E=u.transform.pointMerc;_.render(m.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),s.aj(u.transform.zoom),[E.x,E.y],u.transform.pixelsPerMeterRatio)}else _.render(m.gl,u.transform.customLayerMatrix());m.setDirty(),u.setBaseState(),m.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(u,t,r,c){if(u.renderPass==="opaque")return;const m=r.paint.get("model-opacity").constantOr(1);if(m===0)return;const _=r.paint.get("model-cast-shadows");if(u.renderPass==="shadow"&&(!_||u.terrain&&m<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof s.ad))return;const w=u.shadowRenderer,E=r.paint.get("model-receive-shadows");w&&(w.useNormalOffset=!0,E||(w.enabled=!1));const R=()=>{w&&(w.useNormalOffset=!0,E||(w.enabled=!0))},D=t.getSource();if(u.renderPass==="light-beam"&&D.type!=="batched-model")return;if(D.type==="vector"||D.type==="geojson")return function(X,ie,ce,de,Te){const we=X.transform;if(we.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${we.projection.name} projection is not yet implemented`);const Ee=we.getFreeCameraOptions().position;if(!X.modelManager)return;const ve=X.modelManager;ce.modelManager=ve;const be=X.shadowRenderer;if(!ce._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ce=ce._unevaluatedLayout._values["model-id"],We=Object.assign({},ce.layout.get("model-id").parameters),je=X.style.order.indexOf(ce.fqid);for(const ct of de){const Ze=ie.getTile(ct).getBucket(ce);if(!Ze||Ze.projection.name!==we.projection.name)continue;const ot=Ze.getModelUris();ot&&!Ze.modelsRequested&&(ve.addModelsFromBucket(ot,Te),Ze.modelsRequested=!0);const jt=ao(ct,we);We.zoom=jt;const Ye=Ce.possiblyEvaluate(We);if(Wo(X,Ze,ct),sa.shadowUniformsInitialized=!1,sa.useSingleShadowCascade=!!be&&be.getMaxCascadeForTile(ct.toUnwrapped())===0,X.renderPass==="shadow"&&be){if(X.currentShadowCascade===1&&Ze.isInsideFirstShadowMapFrustum)continue;const Ge=we.calculatePosMatrix(ct.toUnwrapped(),we.worldSize);if(sa.tileMatrix.set(Ge),sa.shadowTileMatrix=Float32Array.from(be.calculateShadowPassMatrixFromMatrix(Ge)),sa.aabb.min=[0,0,0],sa.aabb.max[0]=sa.aabb.max[1]=s.al,sa.aabb.max[2]=0,Vf(Ze,sa,X,ce.scope))continue}const Oe=1<<ct.canonical.z,nt=[((Ee.x-ct.wrap)*Oe-ct.canonical.x)*s.al,(Ee.y*Oe-ct.canonical.y)*s.al,Ee.z*Oe*s.al];X.conflationActive&&Object.keys(Ze.instancesPerModel).length>0&&X.style.isLayerClipped(ce,ie.getSource())&&Ze.updateReplacement(ct,X.replacementSource,je,Te)&&(Ze.uploaded=!1,Ze.upload(X.context));for(let Ge in Ze.instancesPerModel){const ht=Ze.instancesPerModel[Ge];ht.features.length>0&&(Ge=Ye.evaluate(ht.features[0].feature,{}));const _t=ve.getModel(Ge,Te);if(_t||ve.hasURLBeenRequested(Ge)||Ze.modelUris.includes(Ge)||(Ze.modelUris.push(Ge),Ze.modelsRequested=!1),_t&&_t.uploaded)for(const qt of _t.nodes)Wc(X,ce,qt,ht,nt,ct,sa)}}}(u,t,r,c,D.type==="vector"?r.scope:""),void R();if(!D.loaded())return;if(D.type==="batched-model")return function(X,ie,ce,de){ce.resetLayerRenderingStats(X);const Te=X.context,we=X.transform,Ee=X.style.fog,ve=X.shadowRenderer;if(we.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${we.projection.name} projection is not yet implemented`);const be=X.transform.getFreeCameraOptions().position,Ce=s.c4([],[be.x,be.y,be.z],X.transform.worldSize),We=s.et([],Ce),je=s.bA([]),ct=s.ec(we.center.lat,we.zoom),Ze=s.bq([],[1,1,1/ct]);s.br(je,je,We);const ot=ce.paint.get("model-opacity").constantOr(1),jt=new ni(Te.gl.LEQUAL,ni.ReadWrite,X.depthRangeFor3D),Ye=new ni(Te.gl.LEQUAL,ni.ReadOnly,X.depthRangeFor3D),Oe=new s.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),nt=X.renderPass==="shadow",Ge=nt&&ve?ve.getCurrentCascadeFrustum():we.getFrustum(we.scaleZoom(we.worldSize)),ht=ce.paint.get("model-front-cutoff"),_t=ht[2]<1,qt=zc(X,ce.paint.get("model-cutoff-fade-range")),Ct=ce.getLayerRenderingStats();(function(Tt,gi,oi,ei){const li=Tt.terrain?Tt.terrain.exaggeration():0,Li=Tt.transform.zoom;for(const Ki of ei){const Hi=gi.getTile(Ki).getBucket(oi);Hi&&(Hi.setFilter(oi.filter),Tt.conflationActive&&Hi.updateReplacement(Ki,Tt.replacementSource),Hi.evaluateTransform(Tt,oi),Tt.terrain&&li>0&&Hi.elevationUpdate(Tt.terrain,li,Ki,oi.source),Hi.needsReEvaluation(Tt,Li,oi)&&Hi.evaluate(oi))}})(X,ie,ce,de),function(){let Tt,gi,oi;_t?(Tt=de.length-1,gi=-1,oi=-1):(Tt=0,gi=de.length,oi=1);const ei=new Float64Array(16),li=s.cz(),Li=new s.P(0,0);for(let Ki=Tt;Ki!==gi;Ki+=oi){const Hi=de[Ki],zn=ie.getTile(Hi).getBucket(ce);if(!zn||!zn.uploaded)continue;let qi=!1;ve&&(qi=ve.getMaxCascadeForTile(Hi.toUnwrapped())===0);const _n=we.calculatePosMatrix(Hi.toUnwrapped(),we.worldSize),On=zn.modelTraits;!nt&&_t&&(s.bl(ei,_n),s.af(li,Ce,ei),Li.x=li[0],Li.y=li[1]);const or=[];zn.setFilter(ce.filter);for(const Xi of zn.getNodesInfo()){if(Xi.hiddenByReplacement||!Xi.node.meshes)continue;const Rn=Xi.node;let bn=0;X.terrain&&Rn.elevation&&(bn=Rn.elevation*X.terrain.exaggeration());const Dn=(()=>{const ms=Xi.aabb;return Oe.min=[...ms.min],Oe.max=[...ms.max],Oe.min[2]+=bn,Oe.max[2]+=bn,s.af(Oe.min,Oe.min,_n),s.af(Oe.max,Oe.max,_n),Oe})(),Qn=Xi.evaluatedScale;if(Qn[0]<=1&&Qn[1]<=1&&Qn[2]<=1&&Dn.intersects(Ge)===0)continue;if(!nt&&_t){const ms=.16666666666666666;Xi.cameraCollisionOpacity=Ce[0]>Dn.min[0]&&Ce[0]<Dn.max[0]&&Ce[1]>Dn.min[1]&&Ce[1]<Dn.max[1]&&Ce[2]*ct<Dn.max[2]&&Rn.footprint&&s.b$(Li,Rn.footprint)?Math.max(Xi.cameraCollisionOpacity-ms,0):Math.min(1,Xi.cameraCollisionOpacity+ms)}const Er=[..._n],ns=1/s.d6(Hi.canonical),ur=Rn.anchor?Rn.anchor[0]:0,Ji=Rn.anchor?Rn.anchor[1]:0;s.br(Er,Er,[ur*(Qn[0]-1)+Xi.evaluatedTranslation[0]*ns,Ji*(Qn[1]-1)+Xi.evaluatedTranslation[1]*ns,bn+Xi.evaluatedTranslation[2]]),s.cp(Qn,s.ev)||s.cR(Er,Er,Qn);const Pi=s.aB([],Er,Rn.matrix),vn=s.aB([],we.expandedFarZProjMatrix,Pi),Mr=s.aB([],we.expandedFarZProjMatrix,Er),kn=s.aC([],[ur,Ji,bn,1],vn)[2];Rn.hidden=!1;let Zr=ot;nt||(_t&&(Zr*=Xi.cameraCollisionOpacity,Zr*=Hf(Er,we,Xi.aabb,ht)),Zr*=kd(qt,kn)),Zr!==0?or.push({nodeInfo:Xi,depth:kn,opacity:Zr,wvpForNode:vn,wvpForTile:Mr,nodeModelMatrix:Pi,tileModelMatrix:Er}):Rn.hidden=!0}nt||or.sort((Xi,Rn)=>!_t||Xi.opacity===1&&Rn.opacity===1?Xi.depth<Rn.depth?-1:1:Xi.opacity===1?-1:Rn.opacity===1?1:Xi.depth>Rn.depth?-1:1);for(const Xi of or){const Rn=Xi.nodeInfo,bn=Rn.node;let Dn=s.aB([],Ze,Xi.tileModelMatrix);s.aB(Dn,je,Dn);const Qn=s.bl([],Dn);s.ed(Qn,Qn),s.cR(Qn,Qn,Vp),Dn=s.aB(Dn,Dn,bn.matrix);const Er=X.renderPass==="light-beam",ns=ce.paint.get("model-color-use-theme").constantOr("default")==="none",ur=On&s.ez.HasMapboxMeshFeatures,Ji=ur?0:Rn.evaluatedRMEA[0][2];for(let Pi=0;Pi<bn.meshes.length;++Pi){const vn=bn.meshes[Pi],Mr=Pi===bn.lightMeshIndex;let kn=Xi.wvpForNode;if(Mr){if(!Er&&!X.terrain&&X.shadowRenderer){X.currentLayer<X.firstLightBeamLayer&&(X.firstLightBeamLayer=X.currentLayer);continue}kn=Xi.wvpForTile}else if(Er)continue;const Zr={defines:[]},ms=[];if(!nt&&ve&&(ve.useNormalOffset=!!vn.normalBuffer),Lh(Zr.defines,ms,vn,X,ns?null:ce.lut),ur||Zr.defines.push("DIFFUSE_SHADED"),qi&&Zr.defines.push("SHADOWS_SINGLE_CASCADE"),Ct&&(nt?Ct.numRenderedVerticesInShadowPass+=vn.vertexArray.length:Ct.numRenderedVerticesInTransparentPass+=vn.vertexArray.length),nt){Oh(vn,Xi.nodeModelMatrix,X,ce);continue}let Ga=null;if(Ee){const Mo=qe(Xi.nodeModelMatrix,X.transform);if(Ga=new Float32Array(Mo),we.projection.name!=="globe"){const Dr=vn.aabb.min,Nr=vn.aabb.max,[pr,Qr]=Ee.getOpacityForBounds(Mo,Dr[0],Dr[1],Nr[0],Nr[1]);Zr.overrideFog=pr>=pi||Qr>=pi}}const co=vn.material;let gs;co.occlusionTexture&&co.occlusionTexture.offsetScale&&(gs=co.occlusionTexture.offsetScale,Zr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const ca=X.getOrCreateProgram("model",Zr);!nt&&ve&&ve.setupShadowsFromMatrix(Xi.tileModelMatrix,ca,ve.useNormalOffset),X.uploadCommonUniforms(Te,ca,null,Ga);const Ws=co.pbrMetallicRoughness;Ws.metallicFactor=.9,Ws.roughnessFactor=.5;const ua=Rh(new Float32Array(kn),new Float32Array(Dn),new Float32Array(Qn),new Float32Array(bn.matrix),X,Xi.opacity,Ws.baseColorFactor,co.emissiveFactor,Ws.metallicFactor,Ws.roughnessFactor,co,Ji,ce,[0,0,0],gs);!Mr&&(Rn.hasTranslucentParts||Xi.opacity<1)&&ca.draw(X,Te.gl.TRIANGLES,jt,Ci.disabled,tn.disabled,Ni.backCCW,ua,ce.id,vn.vertexBuffer,vn.indexBuffer,vn.segments,ce.paint,X.transform.zoom,void 0,ms),ca.draw(X,Te.gl.TRIANGLES,Mr?Ye:jt,Ci.disabled,Mr||Xi.opacity<1||Rn.hasTranslucentParts?tn.alphaBlended:tn.unblended,Ni.backCCW,ua,ce.id,vn.vertexBuffer,vn.indexBuffer,vn.segments,ce.paint,X.transform.zoom,void 0,ms)}}}}()}(u,t,r,c),void R();if(D.type!=="model")return;const L=D.getModels(),F=[],k=u.transform.getFreeCameraOptions().position,H=s.c4([],[k.x,k.y,k.z],u.transform.worldSize);s.et(H,H);const $=[],G=[];let ee=0;for(const X of L){const ie=r.paint.get("model-rotation").constantOr(null),ce=r.paint.get("model-scale").constantOr(null),de=r.paint.get("model-translation").constantOr(null);X.computeModelMatrix(u,ie,ce,de,!0,!0,!1);const Te=s.bA([]),we=s.ec(X.position.lat,u.transform.zoom),Ee=s.bq([],[1,1,1/we]);s.br(Te,Te,H),F.push({zScaleMatrix:Ee,negCameraPosMatrix:Te});for(const ve of X.nodes)Od(u.transform,ve,X.matrix,u.transform.expandedFarZProjMatrix,ee,$,G);ee++}if($.sort((X,ie)=>ie.depth-X.depth),u.renderPass!=="shadow"){if(m===1)for(const X of G)bl(X,u,r,F[X.modelIndex],Ci.disabled,u.colorModeForRenderPass());else{for(const X of G)bl(X,u,r,F[X.modelIndex],Ci.disabled,tn.disabled);for(const X of G)bl(X,u,r,F[X.modelIndex],u.stencilModeFor3D(),u.colorModeForRenderPass());u.resetStencilClippingMasks()}for(const X of $)bl(X,u,r,F[X.modelIndex],Ci.disabled,u.colorModeForRenderPass());R()}else{for(const X of G)Oh(X.mesh,X.nodeModelMatrix,u,r);for(const X of $)Oh(X.mesh,X.nodeModelMatrix,u,r);R()}}},Yc={line:function(u,t,r){if(u.hasElevatedBuckets=!1,u.hasNonElevatedBuckets=!1,u._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||u._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const c=t.getVisibleCoordinates();for(const m of c){const _=t.getTile(m).getBucket(u);if(_&&(_.elevationType!=="none"?u.hasElevatedBuckets=!0:u.hasNonElevatedBuckets=!0,u.hasElevatedBuckets&&u.hasNonElevatedBuckets))break}}}else u.hasNonElevatedBuckets=!0},model:function(u,t,r){const c=t.getSource();if(!c.loaded())return;if(c.type==="vector"||c.type==="geojson")return void(r.modelManager&&r.modelManager.upload(r,c.type==="vector"?u.scope:""));if(c.type==="batched-model"||c.type!=="model")return;const m=c.getModels();for(const _ of m)_.upload(r.context)},raster:function(u,t,r){const c=t.getSource();if(!(c instanceof Ll&&c.loaded()))return;const m=u.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!m)return;const _=u.paint.get("raster-array-band")||c.getInitialBand(m);if(_==null)return;const w=t.getIds().map(E=>t.getTileByID(E));for(const E of w)E.updateNeeded(u.id,_)&&c.prepareTile(E,m,u.id,_)},"raster-particle":function(u,t,r){const c=t.getSource();if(!(c instanceof Ll&&c.loaded()))return;const m=u.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!m)return;const _=u.paint.get("raster-particle-array-band")||c.getInitialBand(m);if(_==null)return;const w=t.getIds().map(E=>t.getTileByID(E));for(const E of w)E.updateNeeded(u.id,_)&&c.prepareTile(E,m,u.id,_)}},Kc={fill:ic},Ao={fill:function(u,t,r,c){if(!r.layout||r.layout.get("fill-elevation-reference")==="none")return;const m=u.context.gl,_=new ni(m.LEQUAL,ni.ReadOnly,u.depthRangeFor3D),w=new Ci({func:m.ALWAYS,mask:255},255,255,m.KEEP,m.KEEP,m.REPLACE),E=u.transform.getFreeCameraOptions().position,R=u.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const D of c){const L=t.getTile(D),F=L.getBucket(r);if(!F)continue;const k=F.elevatedStructures;if(!k||k.depthSegments.segments[0].primitiveLength===0)continue;const H=Bp(D.toUnwrapped(),E),$=u.translatePosMatrix(D.projMatrix,L,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),G=Ru($,H,0,1,0);R.draw(u,m.TRIANGLES,_,w,tn.disabled,Ni.disabled,G,r.id,k.vertexBuffer,k.indexBuffer,k.depthSegments,r.paint,u.transform.zoom)}}};class Bd{constructor(t,r,c,m,_,w){this.context=new Go(t,r),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._timeStamp=s.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const E=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const D of E)this._debugParams.enabledLayers[D]=!0;_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),_.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),_.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),_.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const D of E)_.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],D);this.occlusionParams=new jd(_),this.setup(),this.numSublayers=Aa.maxUnderzooming+Aa.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.eG,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new km(this),this._wireframeDebugCache=new Nd,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const R=new s.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,R,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=m,this.worldview=w}updateTerrain(t,r){const c=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(c||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ad(this,t));const m=this._terrain;this.transform.elevation=c?m:null,m.update(t,this.transform,r),this.transform.elevation&&!m.enabled&&(this.transform.elevation=null)}_updateFog(t){const r=t.fog;if(!r||this.transform.projection.name==="globe"||r.getOpacity(this.transform.pitch)<1||r.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[c,m]=r.getFovAdjustedRange(this.transform._fov);if(c>m)return void(this.transform.fogCullDistSq=null);const _=c+.78*(m-c);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Ad(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,r){if(this.width=t*s.o.devicePixelRatio,this.height=r*s.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style.order)this.style._mergedLayers[c].resize()}setup(){const t=this.context,r=new s.bd;r.emplaceBack(0,0),r.emplaceBack(s.al,0),r.emplaceBack(0,s.al),r.emplaceBack(s.al,s.al),this.tileExtentBuffer=t.createVertexBuffer(r,s.bf.members),this.tileExtentSegments=s.bg.simpleSegment(0,0,4,2);const c=new s.bd;c.emplaceBack(0,0),c.emplaceBack(s.al,0),c.emplaceBack(0,s.al),c.emplaceBack(s.al,s.al),this.debugBuffer=t.createVertexBuffer(c,s.bf.members),this.debugSegments=s.bg.simpleSegment(0,0,4,5);const m=new s.bd;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,s.bf.members),this.viewportSegments=s.bg.simpleSegment(0,0,4,2);const _=new s.b0;_.emplaceBack(0,0,0,0),_.emplaceBack(s.al,0,s.al,0),_.emplaceBack(0,s.al,0,s.al),_.emplaceBack(s.al,s.al,s.al,s.al),this.mercatorBoundsBuffer=t.createVertexBuffer(_,s.bi.members),this.mercatorBoundsSegments=s.bg.simpleSegment(0,0,4,2);const w=new s.b1;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(w);const E=new s.be;for(const D of[0,1,3,2,0])E.emplaceBack(D);this.debugIndexBuffer=t.createIndexBuffer(E),this.emptyTexture=new s.T(t,new s.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=s.bC();const R=this.context.gl;this.stencilClearMode=new Ci({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,ni.disabled,this.stencilClearMode,tn.disabled,Ni.disabled,Fc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,r,c){if(!r||this.currentStencilSource===r.id||!t.isTileClipped()||!c||c.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const R of c)if(this._tileClippingMaskIDs[R.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=r.id;const m=this.context,_=m.gl;this.nextStencilID+c.length>256&&this.clearStencil(),m.setColorMode(tn.disabled),m.setDepthMode(ni.disabled);const w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of c){const R=r.getTile(E),D=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:F,tileBoundsSegments:k}=this.getTileBoundsBuffers(R);w.draw(this,_.TRIANGLES,ni.disabled,new Ci({func:_.ALWAYS,mask:0},D,255,_.KEEP,_.KEEP,_.REPLACE),tn.disabled,Ni.disabled,Fc(E.projMatrix),"$clipping",L,F,k)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new Ci({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const r=this.context.gl;return new Ci({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,c=t.sort((w,E)=>E.overscaledZ-w.overscaledZ),m=c[c.length-1].overscaledZ,_=c[0].overscaledZ-m+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const w={};for(let E=0;E<_;E++)w[E+m]=new Ci({func:r.GEQUAL,mask:255},E+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=_,[w,c]}return[{[m]:Ci.disabled},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new tn([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new s.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?tn.unblended:tn.alphaBlended}colorModeForDrapableLayerRenderPass(t){const r=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new tn([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new s.ao(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,r,c,m=!1){if(this.depthOcclusion)return new ni(this.context.gl.GREATER,ni.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!m)return ni.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ni(c||this.context.gl.LEQUAL,r,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,r=Math.ceil(this.width),c=Math.ceil(this.height),m=this.context.bindFramebuffer.get(),_=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===r&&this.depthFBO.height===c||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),r!==0&&c!==0&&(this.depthFBO=new Ih(this.context,r,c,!1,"texture"),this.depthTexture=new s.T(this.context,{width:r,height:c,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(m),t.bindTexture(t.TEXTURE_2D,_),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,r,c,0,0,r,c,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,r)=>t+r/this._fpsHistory.length,0))}render(t,r){const c=s.o.now();this._dt=c-this._timeStamp,this._timeStamp=c,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=r;const m=this.style._mergedLayers,_=!(!this.terrain||!this.terrain.enabled),w=()=>this.style._getOrder(_).filter(Ye=>{const Oe=m[Ye];return!(Oe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Oe.type]});let E=w(),R=!1,D=!1,L=null;for(const Ye of E){const Oe=m[Ye];Oe.type==="circle"?R=!0:Oe.type==="building"?L=Oe:Oe.type==="symbol"&&(Oe.hasOcclusionOpacityProperties?D=!0:R=!0)}let F=E.map(Ye=>m[Ye]);const k=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.o.now()),this.imageManager.beginFrame();let H=0,$=!1;for(const Ye in k){const Oe=k[Ye];Oe.used&&(Oe.prepare(this.context),Oe.getSource().usedInConflation&&++H)}let G=!1;for(const Ye of F)Ye.isHidden(this.transform.zoom)||(Ye.type==="clip"&&(G=!0),this.prepareLayer(Ye));const ee={},X={},ie={},ce={},de={};for(const Ye in k){const Oe=k[Ye];ee[Ye]=Oe.getVisibleCoordinates(),X[Ye]=ee[Ye].slice().reverse(),ie[Ye]=Oe.getVisibleCoordinates(!0).reverse(),ce[Ye]=Oe.getShadowCasterCoordinates(),de[Ye]=Oe.sortCoordinatesByDistance(ee[Ye])}const Te=Ye=>{const Oe=this.style.getLayerSourceCache(Ye);return Oe&&Oe.used?Oe.getSource():null};if(H||G||this._clippingActiveLastFrame){const Ye=[],Oe=[];let nt=0;for(const Ge of F)this.isSourceForClippingOrConflation(Ge,Te(Ge))&&(Ye.push(Ge),Oe.push(nt)),nt++;if(Ye&&(G||Ye.length>1)||this._clippingActiveLastFrame){G=!1;const Ge=[];for(let ht=0;ht<Ye.length;ht++){const _t=Ye[ht],qt=Oe[ht],Ct=this.style.getLayerSourceCache(_t);if(!Ct||!Ct.used||!Ct.getSource().usedInConflation&&_t.type!=="clip"&&_t.type!=="building")continue;let Tt=s.eH,gi=s.bZ.None;const oi=[];let ei=!0;if(_t.type==="building")Tt=s.eJ;else if(_t.type==="clip"){Tt=qt;for(const li of _t.layout.get("clip-layer-types"))gi|=li==="model"?s.bZ.Model:li==="symbol"?s.bZ.Symbol:s.bZ.FillExtrusion;for(const li of _t.layout.get("clip-layer-scope"))oi.push(li);_t.isHidden(this.transform.zoom)?ei=!1:G=!0}ei&&Ge.push({layer:_t.fqid,cache:Ct,order:Tt,clipMask:gi,clipScope:oi})}this.replacementSource.setSources(Ge),$=!0}}this._clippingActiveLastFrame=G,$||this.replacementSource.clear(),this.conflationActive=$,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ye=0;Ye<F.length;Ye++){const Oe=F[Ye],nt=Oe.cutoffRange();if(this.longestCutoffRange=Math.max(nt,this.longestCutoffRange),nt>0){const Ge=Te(Oe);Ge&&(this.minCutoffZoom=Math.max(Ge.minzoom,this.minCutoffZoom)),Oe.minzoom&&(this.minCutoffZoom=Math.max(Oe.minzoom,this.minCutoffZoom))}Oe.is3D(_)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ye),this._lastOcclusionLayer=Ye)}const we=this.style&&this.style.fog;we?(this._fogVisible=we.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=we.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ie),this.opaquePassCutoff=0,E=w(),F=E.map(Ye=>m[Ye]));const Ee=this._shadowRenderer;if(Ee){Ee.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ye in k)for(const Oe of ee[Ye]){let nt={min:0,max:0};this.terrain&&(nt=this.terrain.getMinMaxForTile(Oe)||nt),Ee.addShadowReceiver(Oe.toUnwrapped(),nt.min,nt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eI(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ph(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ve=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),be=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ve&&!this._snow&&(this._snow=new Zp(this)),!ve&&this._snow&&(this._snow.destroy(),delete this._snow),be&&!this._rain&&(this._rain=new En(this)),!be&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),L){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Rr);const Ye=this.style.getLayerSourceCache(L);this.buildingTileBorderManager.updateBorders(Ye,L)}if(!Ei.has(this.context.gl))return;this.renderPass="offscreen";for(const Ye of F){const Oe=t.getLayerSourceCache(Ye);if(!Ye.hasOffscreenPass()||Ye.isHidden(this.transform.zoom))continue;const nt=Oe?X[Oe.id]:void 0;(Ye.type==="custom"||Ye.type==="raster"||Ye.type==="raster-particle"||Ye.isSky()||nt&&nt.length)&&this.renderLayer(this,Oe,Ye,nt)}this.depthRangeFor3D=[0,1-(F.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ce)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ce=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),We=(()=>{if(r.showOverdrawInspector)return s.ao.black;const Ye=this.style.fog;if(Ye&&this.transform.projection.supportsFog){const Oe=this.style.getLut(Ye.scope);if(!Ce){const nt=Ye.properties.get("color-use-theme")==="none",Ge=Ye.properties.get("color").toNonPremultipliedRenderColor(nt?null:Oe).toArray01();return new s.ao(...Ge)}if(Ce){const nt=Ye.properties.get("space-color-use-theme")==="none",Ge=Ye.properties.get("space-color").toNonPremultipliedRenderColor(nt?null:Oe).toArray01();return new s.ao(...Ge)}}return s.ao.transparent})();if(this.context.clear({color:We,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ce&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=E.length-1;this.currentLayer>=0;this.currentLayer--){const Ye=F[this.currentLayer],Oe=t.getLayerSourceCache(Ye);if(Ye.isSky())continue;const nt=Oe?(Ye.is3D(_)?de:X)[Oe.id]:void 0;this._renderTileClippingMasks(Ye,Oe,nt),this.renderLayer(this,Oe,Ye,nt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ce&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<E.length;this.currentLayer++){const Ye=F[this.currentLayer],Oe=t.getLayerSourceCache(Ye);Ye.isSky()&&this.renderLayer(this,Oe,Ye,Oe?X[Oe.id]:void 0)}function je(Ye,Oe){let nt;return Oe&&(nt=(Ye.type==="symbol"?ie:Ye.is3D(_)?de:X)[Oe.id]),nt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<E.length;){const Ye=F[this.currentLayer];if(Ye.type==="raster"||Ye.type==="raster-particle"){const Oe=t.getLayerSourceCache(Ye);this.renderLayer(this,Oe,Ye,je(Ye,Oe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ct=0;Ee&&(ct=Ee.getShadowCastingLayerCount());let Ze=!1,ot=-1;for(let Ye=0;Ye<E.length;++Ye){const Oe=F[Ye];Oe.isHidden(this.transform.zoom)||Oe.is3D(_)&&(ot=Ye)}D&&ot===-1&&(R=!0);let jt=!1;for(;this.currentLayer<E.length;){const Ye=F[this.currentLayer],Oe=t.getLayerSourceCache(Ye);if(Ye.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ye)){if(Ye.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!jt&&Ye.is3D(_)&&!_){const nt=this.currentLayer,Ge=ht=>{for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){const _t=F[this.currentLayer];if(Kc[_t.type]){const qt=this.style.getLayerSourceCache(_t);Kc[_t.type](this,qt,_t,je(_t,qt),ht)}}};Ge("initialize"),Ge("reset"),this.currentLayer=nt,jt=!0}if(R&&!Ze&&this.terrain&&!this.transform.isOrthographic&&(Ze=!0,this.blitDepth()),D&&ot!==-1&&this.currentLayer===ot+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ye,Oe,Oe?ee[Oe.id]:void 0),this.renderLayer(this,Oe,Ye,je(Ye,Oe)),!this.terrain&&Ee&&ct>0&&Ye.hasShadowPass()&&--ct==0){{this.clearStencil(),this.resetStencilClippingMasks();const nt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){const Ge=F[this.currentLayer];if(Ao[Ge.type]){const ht=this.style.getLayerSourceCache(Ge);Ao[Ge.type](this,ht,Ge,je(Ge,ht))}}this.currentLayer=nt}if(Ee.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const nt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=nt;this.currentLayer++){const Ge=F[this.currentLayer];if(!Ge.hasLightBeamPass())continue;const ht=t.getLayerSourceCache(Ge);this.renderLayer(this,ht,Ge,ht?X[ht.id]:void 0)}this.currentLayer=nt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const nt=this.currentLayer;this.depthOcclusion=!0;for(const Ge of this.layersWithOcclusionOpacity){this.currentLayer=Ge;const ht=F[this.currentLayer],_t=t.getLayerSourceCache(ht),qt=_t?X[_t.id]:void 0;this.terrain||this._renderTileClippingMasks(ht,_t,_t?ee[_t.id]:void 0),this.renderLayer(this,_t,ht,qt)}this.depthOcclusion=!1,this.currentLayer=nt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ye=null;F.forEach(Oe=>{const nt=t.getLayerSourceCache(Oe);nt&&!Oe.isHidden(this.transform.zoom)&&nt.getVisibleCoordinates().length&&(!Ye||Ye.getSource().maxzoom<nt.getSource().maxzoom)&&(Ye=nt)}),Ye&&this.options.showTileBoundaries&&Dh(this,Ye,Ye.getVisibleCoordinates(),s.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Dh(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ye){const Oe=Ye.transform.padding;$o(Ye,Ye.transform.height-(Oe.top||0),3,qs),$o(Ye,Oe.bottom||0,3,rc),ir(Ye,Oe.left||0,3,Up),ir(Ye,Ye.transform.width-(Oe.right||0),3,jf);const nt=Ye.transform.centerPoint;(function(Ge,ht,_t,qt){Gc(Ge,ht-1,_t-10,2,20,qt),Gc(Ge,ht-10,_t-1,20,2,qt)})(Ye,nt.x,Ye.transform.height-nt.y,Bf)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),$||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:r}=this.transform.projection,c=!r||!r.includes(t.type);if(Yc[t.type]&&(c||this.terrain&&t.type==="custom")){const m=this.style.getLayerSourceCache(t);Yc[t.type](t,m,this)}this.gpuTimingEnd()}renderLayer(t,r,c,m){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="sky"||c.type==="custom"||c.type==="model"||c.type==="raster"||c.type==="raster-particle"||m&&m.length)&&(this.id=c.id,this.gpuTimingStart(c),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(c.type)&&(!t.terrain||c.type!=="custom")||c.type==="clip"||oc[c.type](t,r,c,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery,c=this.context.gl;let m=this.gpuTimers[t.id];m||(m=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:c.createQuery()}),m.calls++,c.beginQuery(r.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,r=this.context.gl,c=r.createQuery();this.deferredRenderGpuTimeQueries.push(c),r.beginQuery(t.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const r={};for(const c in t){const m=t[c],_=this.context.extTimerQuery,w=_.getQueryParameter(m.query,this.context.gl.QUERY_RESULT)/1e6;_.deleteQueryEXT(m.query),r[c]=w}return r}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const r=this.context.gl;let c=0;for(const m of t)c+=r.getQueryParameter(m,r.QUERY_RESULT)/1e6,r.deleteQuery(m);return c}translatePosMatrix(t,r,c,m,_){if(!c[0]&&!c[1])return t;const w=_?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(w){const D=Math.sin(w),L=Math.cos(w);c=[c[0]*L-c[1]*D,c[0]*D+c[1]*L]}const E=[_?c[0]:s.ay(r,c[0],this.transform.zoom),_?c[1]:s.ay(r,c[1],this.transform.zoom),0],R=new Float32Array(16);return s.br(R,t,E),R}saveTileTexture(t){if(t.context!==this.context)return;const r=t.size[0],c=this._tileTextures[r];c?c.push(t):this._tileTextures[r]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,r,c){const m=c===void 0?this.terrain&&this.terrain.renderingToTexture:c,_=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(_.push("LIGHTING_3D_MODE"),_.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):m||_.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||_.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(_.push("TERRAIN"),this.linearFloatFilteringSupported()&&_.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&_.push("GLOBE"),!this._fogVisible||m||r!==void 0&&!r||_.push("FOG","FOG_DITHERING"),m&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}getOrCreateProgram(t,r){this.cache=this.cache||{};const c=r&&r.defines||[],m=r&&r.config,_=this.currentGlobalDefines(t,r&&r.overrideFog,r&&r.overrideRtt).concat(c),w=Sh.cacheKey(xd[t],t,_,m);return this.cache[w]||(this.cache[w]=new Sh(this.context,t,xd[t],m,Cs[t],_)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,r){if(this.style.enable3dLights()){const c=this.style.directionalLight,m=this.style.ambientLight;if(c&&m){const _=((w,E,R)=>{const D=w.properties.get("direction"),L=w.properties.get("color-use-theme")==="none",F=w.properties.get("color").toNonPremultipliedRenderColor(L?null:R.getLut(w.scope)).toArray01(),k=w.properties.get("intensity"),H=E.properties.get("color-use-theme")==="none",$=E.properties.get("color").toNonPremultipliedRenderColor(H?null:R.getLut(E.scope)).toArray01(),G=E.properties.get("intensity"),ee=[D.x,D.y,D.z],X=s.dK($,G),ie=s.dK(F,k);return{u_lighting_ambient_color:X,u_lighting_directional_dir:ee,u_lighting_directional_color:ie,u_ground_radiance:Af(ee,ie,X)}})(c,m,this.style);r.setLightsUniformValues(t,_)}}}uploadCommonUniforms(t,r,c,m,_){if(this.uploadCommonLightUniforms(t,r),this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const E=w.getOpacity(this.transform.pitch),R=((D,L,F,k,H,$,G,ee,X,ie,ce,de)=>{const Te=D.transform,we=L.properties.get("color-use-theme")==="none",Ee=L.properties.get("color").toNonPremultipliedRenderColor(we?null:D.style.getLut(L.scope)).toArray01();Ee[3]=k;const ve=D.frameCounter/1e3%1,[be,Ce]=L.properties.get("vertical-range");return{u_fog_matrix:F?Te.calculateFogTileMatrix(F):de||D.identityMat,u_fog_range:L.getFovAdjustedRange(Te._fov),u_fog_color:Ee,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(be,Ce),Ce],u_fog_temporal_offset:ve,u_frustum_tl:H,u_frustum_tr:$,u_frustum_br:G,u_frustum_bl:ee,u_globe_pos:X,u_globe_radius:ie,u_viewport:ce,u_globe_transition:s.aj(Te.zoom),u_is_globe:+(Te.projection.name==="globe")}})(this,w,c,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.o.devicePixelRatio,this.transform.height*s.o.devicePixelRatio],m);r.setFogUniformValues(t,R)}_&&r.setCutoffUniformValues(t,_.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),r}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,r=this._backgroundTiles={},c=this.transform.coveringTiles({tileSize:512});for(const m of c)r[m.key]=t[m.key]||new Sc(m,512,this.transform.tileZoom,this,void 0,this.worldview);return r}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,r){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!r||r.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let r=this._cachedTileFogOpacities[t.key];return r||(this._cachedTileFogOpacities[t.key]=r=this.style.fog.getOpacityForTile(t)),r[0]>=pi||r[1]>=pi}setupDepthForOcclusion(t,r,c){const m=this.context,_=m.gl,w=!!c;var E;c||(c={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),m.activeTexture.set(_.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),c.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],c.u_depth_range_unpack=[2/((E=this.depthRangeFor3D)[1]-E[0]),-1-2*E[0]/(E[1]-E[0])],c.u_occluder_half_size=.5*this.occlusionParams.occluderSize,c.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),m.activeTexture.set(_.TEXTURE0),w||r.setTerrainUniformValues(m,c)}}function Fd(u,t){let r=!1,c=null;const m=()=>{c=null,r&&(u(),c=setTimeout(m,t),r=!1)};return()=>(r=!0,c||m(),c)}class qf{constructor(t){this._hashName=t&&encodeURIComponent(t),s.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Fd(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const r=Ud(t);if(this._hashName){const c=this._hashName;let m=!1;const _=location.hash.slice(1).split("&").map(w=>{const E=w.split("=")[0];return E===c?(m=!0,`${E}=${r}`):w}).filter(w=>w);return m||_.push(`${c}=${r}`),`#${_.join("&")}`}return`#${r}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let r;return t.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(r=c)}),(r&&r[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const r=this._getCurrentHash();if(r.length>=3&&!r.some(c=>isNaN(Number(c)))){const c=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(r[3]||0):t.getBearing();return t.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:c,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ud(u,t){const r=u.getCenter(),c=Math.round(100*u.getZoom())/100,m=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,m),w=Math.round(r.lng*_)/_,E=Math.round(r.lat*_)/_,R=u.getBearing(),D=u.getPitch();let L=t?`/${w}/${E}/${c}`:`${c}/${E}/${w}`;return(R||D)&&(L+="/"+Math.round(10*R)/10),D&&(L+=`/${Math.round(D)}`),L}const oa={linearity:.3,easing:s.eK(0,0,.3,1)},wl=Object.assign({deceleration:2500,maxSpeed:1400},oa),Jc=Object.assign({deceleration:20,maxSpeed:1400},oa),Vd=Object.assign({deceleration:1e3,maxSpeed:360},oa),Hd=Object.assign({deceleration:1e3,maxSpeed:90},oa);class qd{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=s.o.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const r={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)r.zoom+=_.zoomDelta||0,r.bearing+=_.bearingDelta||0,r.pitch+=_.pitchDelta||0,_.panDelta&&r.pan._add(_.panDelta),_.around&&(r.around=_.around),_.pinchAround&&(r.pinchAround=_.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(r.pan.mag()){const _=Ou(r.pan.mag(),c,Object.assign({},wl,t||{}));m.offset=r.pan.mult(_.amount/r.pan.mag()),m.center=this._map.transform.center,oo(m,_)}if(r.zoom){const _=Ou(r.zoom,c,Jc);m.zoom=this._map.transform.zoom+_.amount,oo(m,_)}if(r.bearing){const _=Ou(r.bearing,c,Vd);m.bearing=this._map.transform.bearing+s.aA(_.amount,-179,179),oo(m,_)}if(r.pitch){const _=Ou(r.pitch,c,Hd);m.pitch=this._map.transform.pitch+_.amount,oo(m,_)}if(m.zoom||m.bearing){const _=r.pinchAround===void 0?r.around:r.pinchAround;m.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function oo(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function Ou(u,t,r){const{maxSpeed:c,linearity:m,deceleration:_}=r,w=s.aA(u*m/(t/1e3),-c,c),E=Math.abs(w)/(_*m);return{easing:r.easing,duration:1e3*E,amount:w*(E/2)}}class Kr extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,c,m={}){const _=rt(r.getCanvasContainer(),c),w=r.unproject(_);super(t,Object.assign({point:_,lngLat:w,originalEvent:c},m)),this._defaultPrevented=!1,this.target=r}}class ku extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,c){const m=t==="touchend"?c.changedTouches:c.touches,_=ut(r.getCanvasContainer(),m),w=_.map(R=>r.unproject(R)),E=_.reduce((R,D,L,F)=>R.add(D.div(F.length)),new s.P(0,0));super(t,{points:_,point:E,lngLats:w,lngLat:r.unproject(E),originalEvent:c}),this._defaultPrevented=!1}}class Co extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r){super("wheel",{originalEvent:r}),this._defaultPrevented=!1}}class Gd{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Co(this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new Kr(t.type,this._map,t))}mouseup(t){this._map.fire(new Kr(t.type,this._map,t))}preclick(t){const r=new MouseEvent("preclick",t);this._map.fire(new Kr(r.type,this._map,r))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Kr(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Kr(t.type,this._map,t))}mouseover(t){this._map.fire(new Kr(t.type,this._map,t))}mouseout(t){this._map.fire(new Kr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ku(t.type,this._map,t))}touchmove(t){this._map.fire(new ku(t.type,this._map,t))}touchend(t){this._map.fire(new ku(t.type,this._map,t))}touchcancel(t){this._map.fire(new ku(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wp{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Kr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Kr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Kr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class is{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(Pe(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const c=r,m=this._startPos,_=this._lastPos;if(!m||!_||_.equals(c)||!this._box&&c.dist(m)<this._clickTolerance)return;this._lastPos=c,this._box||(this._box=Se("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const w=Math.min(m.x,c.x),E=Math.max(m.x,c.x),R=Math.min(m.y,c.y),D=Math.max(m.y,c.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${R}px)`,this._box.style.width=E-w+"px",this._box.style.height=D-R+"px")})}mouseupWindow(t,r){if(!this._active)return;const c=this._startPos,m=r;if(c&&t.button===0){if(this.reset(),it(),c.x!==m.x||c.y!==m.y)return this._map.fire(new s.z("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(c,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ae(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new s.z(t,{originalEvent:r}))}}function Nu(u,t){const r={};for(let c=0;c<u.length;c++)r[u[c].identifier]=t[c];return r}class lc{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,r,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=function(m){const _=new s.P(0,0);for(const w of m)_._add(w);return _.div(m.length)}(r),this.touches=Nu(c,r)))}touchmove(t,r,c){if(this.aborted||!this.centroid)return;const m=Nu(c,r);for(const _ in this.touches){const w=m[_];(!w||w.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,r,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class lo{constructor(t){this.singleTap=new lc(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,r,c){this.singleTap.touchstart(t,r,c)}touchmove(t,r,c){this.singleTap.touchmove(t,r,c)}touchend(t,r,c){const m=this.singleTap.touchend(t,r,c);if(m){const _=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(m)<30;if(_&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class qa{constructor(){this._zoomIn=new lo({numTouches:1,numTaps:2}),this._zoomOut=new lo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,c){this._zoomIn.touchstart(t,r,c),this._zoomOut.touchstart(t,r,c)}touchmove(t,r,c){this._zoomIn.touchmove(t,r,c),this._zoomOut.touchmove(t,r,c)}touchend(t,r,c){const m=this._zoomIn.touchend(t,r,c),_=this._zoomOut.touchend(t,r,c);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(m)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Xo={0:1,2:2},jh={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class ju{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,r){return!1}_move(t,r){return{}}mousedown(t,r){if(this._lastPoint)return;const c=Lt(t);this._correctButton(t,c)&&(this._lastPoint=r,this._eventButton=c)}mousemoveWindow(t,r){const c=this._lastPoint;if(c){if(t.preventDefault(),this._eventButton!=null&&function(m,_){const w=Xo[_];return m.buttons===void 0||(m.buttons&w)!==w}(t,this._eventButton))this.reset();else if(this._moved||!(r.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(c,r)}}mouseupWindow(t){this._lastPoint&&Lt(t)===this._eventButton&&(this._moved&&it(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tl extends ju{mousedown(t,r){super.mousedown(t,r),this._lastPoint&&(this._active=!0)}_correctButton(t,r){return r===0&&!t.ctrlKey}_move(t,r){return{around:r,panDelta:r.sub(t)}}}class Bu extends ju{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?jh[t.pitchRotateKey]:void 0}_correctButton(t,r){return this._pitchRotateKey?r===0&&t[this._pitchRotateKey]:r===0&&t.ctrlKey||r===2}_move(t,r){const c=.8*(r.x-t.x);if(c)return this._active=!0,{bearingDelta:c}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Sl extends ju{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?jh[t.pitchRotateKey]:void 0}_correctButton(t,r){return this._pitchRotateKey?r===0&&t[this._pitchRotateKey]:r===0&&t.ctrlKey||r===2}_move(t,r){const c=-.5*(r.y-t.y);if(c)return this._active=!0,{pitchDelta:c}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Gs{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),s.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(t,r,c){return this._calculateTransform(t,r,c)}touchmove(t,r,c){if(this._active&&!(c.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(c.length===1&&!s.eL())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,r,c)}}touchend(t,r,c){this._calculateTransform(t,r,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,c){c.length>0&&(this._active=!0);const m=Nu(c,r),_=new s.P(0,0),w=new s.P(0,0);let E=0;for(const D in m){const L=m[D],F=this._touches[D];F&&(_._add(L),w._add(L.sub(F)),E++,m[D]=L)}if(this._touches=m,E<this._minTouches||!w.mag())return;const R=w.div(E);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(E),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Se("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class cc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,r,c){return{}}touchstart(t,r,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,c){const m=this._firstTwoTouches;if(!m)return;t.preventDefault();const[_,w]=m,E=Fu(c,r,_),R=Fu(c,r,w);if(!E||!R)return;const D=this._aroundCenter?null:E.add(R).div(2);return this._move([E,R],D,t)}touchend(t,r,c){if(!this._firstTwoTouches)return;const[m,_]=this._firstTwoTouches,w=Fu(c,r,m),E=Fu(c,r,_);w&&E||(this._active&&it(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Fu(u,t,r){for(let c=0;c<u.length;c++)if(u[c].identifier===r)return t[c]}function Yo(u,t){return Math.log2(u/t)}class Gf extends cc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Yo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Yo(this._distance,c),pinchAround:r}}}function $d(u,t){return 180*u.angleWith(t)/Math.PI}class uc extends cc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const c=this._vector;if(this._vector=t[0].sub(t[1]),c&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:$d(this._vector,c),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,c=this._startVector;if(!c)return!1;const m=$d(t,c);return Math.abs(m)<r}}function Ko(u){return Math.abs(u.y)>Math.abs(u.x)}class Bh extends cc{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Ko(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,c){const m=this._lastPoints;if(!m)return;const _=t[0].sub(m[0]),w=t[1].sub(m[1]);return this._map._cooperativeGestures&&!s.eL()&&c.touches.length<3||(this._valid=this.gestureBeginsVertically(_,w,c.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+w.y)/2*-.5})}gestureBeginsVertically(t,r,c){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,_=r.mag()>=2;if(!m&&!_)return;if(!m||!_)return this._firstMove==null&&(this._firstMove=c),c-this._firstMove<100&&void 0;const w=t.y>0==r.y>0;return Ko(t)&&Ko(r)&&w}}const $f={panStep:100,bearingStep:15,pitchStep:10};class Zf{constructor(){const t=$f;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,c=0,m=0,_=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(c=0,m=0),{cameraAnimation:E=>{const R=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:Fh,zoom:r?Math.round(R)+r*(t.shiftKey?2:1):R,bearing:E.getBearing()+c*this._bearingStep,pitch:E.getPitch()+m*this._pitchStep,offset:[-_*this._panStep,-w*this._panStep],center:E.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Fh(u){return u*(2-u)}const Uu=4.000244140625,Xp=1/450;class Yp{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Xp,s.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||s.eL()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=s.o.now(),m=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,r!==0&&r%Uu==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=r,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=rt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:r,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>Uu?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&L!==0&&(L=1/L);const F=r(),k=Math.pow(2,F),H=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):k;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(H*L))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const c=typeof this._targetZoom=="number"?this._targetZoom:r(),m=this._startZoom,_=this._easing;let w,E=!1;if(this._type==="wheel"&&m&&_){const D=Math.min((s.o.now()-this._lastWheelEventTime)/200,1),L=_(D);w=s.ak(m,c,L),D<1?this._frameId||(this._frameId=!0):E=!0}else w=c,E=!0;this._active=!0,E&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let R=w-r();return R*this._lastDelta<0&&(R=0),{noInertia:!0,needsRenderFrame:!E,zoomDelta:R,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=s.eM;if(this._prevEase){const c=this._prevEase,m=(s.o.now()-c.start)/c.duration,_=c.easing(m+.01)-c.easing(m),w=.27/Math.sqrt(_*_+1e-4)*.01,E=Math.sqrt(.0729-w*w);r=s.eK(w,E,.25,1)}return this._prevEase={start:s.o.now(),duration:t,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Se("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Uh{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hc{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,r){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:c.getZoom()+(t.shiftKey?-1:1),around:c.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zm{constructor(){this._tap=new lo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,r,c){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=r[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(t,r,c))}touchmove(t,r,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const m=r[0],_=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,r,c)}touchend(t,r,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(t,r,c)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wm{constructor(t,r,c){this._el=t,this._mousePan=r,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vu{constructor(t,r,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class qn{constructor(t,r,c,m){this._el=t,this._touchZoom=r,this._touchRotate=c,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Vh=u=>u.zoom||u.drag||u.pitch||u.rotate;class Xm extends s.z{}class Ym{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,r){const c=s.av([],r,t);this.radius=s.ag(c[2]<0?s.eO([],c,this.constants):[c[0],c[1],0])}projectRay(t){s.eO(t,t,this.constants),s.aw(t,t),s.eP(t,t,this.constants);const r=s.c4([],t,this.radius);if(r[2]>0){const c=s.c4([],[0,0,1],s.bJ(r,[0,0,1])),m=s.c4([],s.aw([],[r[0],r[1],0]),this.radius),_=s.d7([],r,s.c4([],s.av([],s.d7([],m,c),r),2));r[0]=_[0],r[1]=_[1]}return r}}function Hh(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class Hu{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qd(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ym,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),s.aY(["handleEvent","handleWindowEvent"],this);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,_,w]of this._listeners){const E=m===document?this.handleWindowEvent:this.handleEvent;m.addEventListener(_,E,w)}}destroy(){for(const[t,r,c]of this._listeners){const m=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(r,m,c)}}_addDefaultHandlers(t){const r=this._map,c=r.getCanvasContainer();this._add("mapEvent",new Gd(r,t));const m=r.boxZoom=new is(r,t);this._add("boxZoom",m);const _=new qa,w=new hc;r.doubleClickZoom=new Uh(w,_),this._add("tapZoom",_),this._add("clickZoom",w);const E=new Zm;this._add("tapDragZoom",E);const R=r.touchPitch=new Bh(r);this._add("touchPitch",R);const D=new Bu(t),L=new Sl(t);r.dragRotate=new Vu(t,D,L),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const F=new Tl(t),k=new Gs(r,t);r.dragPan=new Wm(c,F,k),this._add("mousePan",F),this._add("touchPan",k,["touchZoom","touchRotate"]);const H=new uc,$=new Gf;r.touchZoomRotate=new qn(c,$,H,E),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Wp(r));const G=r.scrollZoom=new Yp(r,this);this._add("scrollZoom",G,["mousePan"]);const ee=r.keyboard=new Zf;this._add("keyboard",ee);for(const X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[X]&&r[X].enable(t[X])}_add(t,r,c){this._handlers.push({handlerName:t,handler:r,allowed:c}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Vh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,r,c){for(const m in t)if(m!==c&&(!r||r.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const r=[];for(const c of t)this._el.contains(c.target)&&r.push(c);return r}handleEvent(t,r){this._updatingCamera=!0;const c=t.type==="renderFrame",m=c?void 0:t,_={needsRenderFrame:!1},w={},E={},R=t.touches?this._getMapTouches(t.touches):void 0,D=R?ut(this._el,R):c?void 0:rt(this._el,t);for(const{handlerName:k,handler:H,allowed:$}of this._handlers){if(!H.isEnabled())continue;let G;this._blockedByActive(E,$,k)?H.reset():H[r||t.type]&&(G=H[r||t.type](t,D,R),this.mergeHandlerResult(_,w,G,k,m),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||H.isActive())&&(E[k]=H)}const L={};for(const k in this._previousActiveHandlers)E[k]||(L[k]=m);this._previousActiveHandlers=E,(Object.keys(L).length||Hh(_))&&(this._changes.push([_,w,L]),this._triggerRenderFrame()),(Object.keys(E).length||Hh(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=_;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(t,r,c,m,_){if(!c)return;Object.assign(t,c);const w={handlerName:m,originalEvent:c.originalEvent||_};c.zoomDelta!==void 0&&(r.zoom=w),c.panDelta!==void 0&&(r.drag=w),c.pitchDelta!==void 0&&(r.pitch=w),c.bearingDelta!==void 0&&(r.rotate=w)}_applyChanges(){const t={},r={},c={};for(const[m,_,w]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.aroundCoord!==void 0&&(t.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),Object.assign(r,_),Object.assign(c,w);this._updateMapTransform(t,r,c),this._changes=[]}_updateMapTransform(t,r,c){const m=this._map,_=m.transform,w=ie=>[ie.x,ie.y,ie.z];if((ie=>{const ce=this._eventsInProgress.drag;return ce&&!this._handlersById[ce.handlerName].isActive()})()&&!Hh(t)){const ie=_.zoom;_.cameraElevationReference="sea",this._originalZoom!=null&&_._orthographicProjectionAtLowPitch&&_.projection.name!=="globe"&&_.pitch===0?(_.cameraElevationReference="ground",_.zoom=this._originalZoom):(_.recenterOnTerrain(),_.cameraElevationReference="ground"),ie!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&m._stop(!0),!Hh(t))return void this._fireEvents(r,c,!0);let{panDelta:E,zoomDelta:R,bearingDelta:D,pitchDelta:L,around:F,aroundCoord:k,pinchAround:H}=t;_._isCameraConstrained&&(R>0&&(R=0),_._isCameraConstrained=!1),H!==void 0&&(F=H),(R||(ie=>r[ie]&&!this._eventsInProgress[ie])("drag"))&&F&&(this._dragOrigin=w(_.pointCoordinate3D(F)),this._originalZoom=_.zoom,this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",m._stop(!0),F=F||m.transform.centerPoint,D&&(_.bearing+=D),L&&(_.pitch+=L),_._updateCameraState();const $=[0,0,0];if(E)if(_.projection.name==="mercator"){const ie=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(F).dir),ce=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(F.sub(E)).dir);$[0]=ce[0]-ie[0],$[1]=ce[1]-ie[1]}else{const ie=_.pointCoordinate(F);if(_.projection.name==="globe"){E=E.rotate(-_.angle);const ce=_._pixelsPerMercatorPixel/_.worldSize;$[0]=-E.x*s.eN(s.a$(ie.y))*ce,$[1]=-E.y*s.eN(_.center.lat)*ce}else{const ce=_.pointCoordinate(F.sub(E));ie&&ce&&($[0]=ce.x-ie.x,$[1]=ce.y-ie.y)}}const G=_.zoom,ee=[0,0,0];if(R){const ie=w(k||_.pointCoordinate3D(F)),ce={dir:s.aw([],s.av([],ie,_._camera.position))};if(ce.dir[2]<0){const de=_.zoomDeltaToMovement(ie,R);s.c4(ee,ce.dir,de)}}const X=s.d7($,$,ee);_._translateCameraConstrained(X),R&&Math.abs(_.zoom-G)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,c,!0)}_fireEvents(t,r,c){const m=Vh(this._eventsInProgress),_=Vh(t),w={};for(const L in t){const{originalEvent:F}=t[L];this._eventsInProgress[L]||(w[`${L}start`]=F),this._eventsInProgress[L]=t[L]}!m&&_&&this._fireEvent("movestart",_.originalEvent);for(const L in w)this._fireEvent(L,w[L]);_&&this._fireEvent("move",_.originalEvent);for(const L in t){const{originalEvent:F}=t[L];this._fireEvent(L,F)}const E={};let R;for(const L in this._eventsInProgress){const{handlerName:F,originalEvent:k}=this._eventsInProgress[L];this._handlersById[F].isActive()||(delete this._eventsInProgress[L],R=r[F]||k,E[`${L}end`]=R)}for(const L in E)this._fireEvent(L,E[L]);const D=Vh(this._eventsInProgress);if(c&&(m||_)&&!D){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=k=>k!==0&&-this._bearingSnap<k&&k<this._bearingSnap;L?(F(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:R})):(this._map.fire(new s.z("moveend",{originalEvent:R})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new s.z(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Xm("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const qh="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Jo extends s.E{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=r.respectPrefersReducedMotion!==!1,s.aY(["_renderFrameCallback"],this)}getCenter(){return new s.aR(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,c){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},r),c)}panTo(t,r,c){return this.easeTo(Object.assign({center:t},r),c)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,c){return this.easeTo(Object.assign({zoom:t},r),c)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,c){return this.easeTo(Object.assign({bearing:t},r),c)}resetNorth(t,r){return this.rotateTo(0,Object.assign({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=s.aI.convert(t);const c=r&&r.bearing||0,m=r&&r.pitch||0,_=t.getNorthWest(),w=t.getSouthEast();return this._cameraForBounds(this.transform,_,w,c,m,r)}_extendPadding(t){const r={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},r,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},r,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,r){const c=r.max[0]-r.min[0],m=r.max[1]-r.min[1];return c/m>t.aspect?c/(2*Math.tan(.5*t.fovX)*t.aspect):m/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,r,c,m,_,w){const E=t.clone(),R=this._extendCameraOptions(w);E.bearing=m,E.pitch=_;const D=s.aR.convert(r),L=s.aR.convert(c),F=.5*(D.lat+L.lat),k=.5*(D.lng+L.lng),H=s.eQ(F,k),$=s.aw([],H),G=s.aw([],s.bI([],$,[0,1,0])),ee=s.bI([],G,$),X=[G[0],G[1],G[2],0,ee[0],ee[1],ee[2],0,$[0],$[1],$[2],0,0,0,0,1],ie=[H,s.eQ(D.lat,D.lng),s.eQ(L.lat,D.lng),s.eQ(L.lat,L.lng),s.eQ(D.lat,L.lng),s.eQ(F,D.lng),s.eQ(F,L.lng),s.eQ(D.lat,k),s.eQ(L.lat,k)];let ce=s.d8.fromPoints(ie.map(Ge=>[s.bJ(G,Ge),s.bJ(ee,Ge),s.bJ($,Ge)]));const de=s.af([],ce.center,X);s.eR(de)===0&&s.eS(de,0,0,1),s.aw(de,de),s.c4(de,de,s.aD),E.center=s.eT(de);const Te=E.getWorldToCameraMatrix(),we=s.bl(new Float64Array(16),Te);ce=s.d8.applyTransform(ce,s.aB([],Te,X));const Ee=this._extendAABB(ce,E,R,m);if(!Ee)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=Ee,s.af(de,de,Te);const ve=.5*(ce.max[2]-ce.min[2]),be=this._minimumAABBFrustumDistance(E,ce),Ce=s.c4([],[0,0,1],ve),We=s.d7(Ce,de,Ce),je=be+(E.pitch===0?0:s.bG(de,We)),ct=E.globeCenterInViewSpace,Ze=s.av([],de,[ct[0],ct[1],ct[2]]);s.aw(Ze,Ze),s.c4(Ze,Ze,je);const ot=s.d7([],de,Ze);s.af(ot,ot,we);const jt=s.eD/s.aD,Ye=s.ag(ot),Oe=s.ce(Math.max(Ye*jt-s.eD,Number.EPSILON),0),nt=Math.min(E.zoomFromMercatorZAdjusted(Oe),R.maxZoom);return nt>.5*(s.cZ+s.cK)?(E.setProjection({name:"mercator"}),E.zoom=nt,this._cameraForBounds(E,r,c,m,_,w)):{center:E.center,zoom:nt,bearing:m,pitch:_}}_extendAABB(t,r,c,m){const _=.5*((c.padding.left||0)+(c.padding.right||0)),w=.5*((c.padding.top||0)+(c.padding.bottom||0)),E=w,R=_,D=_,L=w,F=r.width-(R+D),k=r.height-(E+L),H=s.av([],t.max,t.min),$=Math.min(F/H[0],k/H[1]),G=Math.min(r.scaleZoom(r.scale*$),c.maxZoom);if(isNaN(G))return null;const ee=r.scale/r.zoomScale(G),X=new s.d8([t.min[0]-R*ee,t.min[1]-L*ee,t.min[2]],[t.max[0]+D*ee,t.max[1]+E*ee,t.max[2]]),ie=(typeof c.offset.x=="number"&&typeof c.offset.y=="number"?new s.P(c.offset.x,c.offset.y):s.P.convert(c.offset)).rotate(-s.an(m));return X.center[0]-=ie.x*ee,X.center[1]+=ie.y*ee,X}queryTerrainElevation(t,r){const c=this.transform.elevation;return c?(r=Object.assign({},{exaggerated:!0},r),c.getAtPoint(s.ae.fromLngLat(t),null,r.exaggerated)):null}_cameraForBounds(t,r,c,m,_,w){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,r,c,m,_,w);const E=t.clone(),R=this._extendCameraOptions(w);E.bearing=m,E.pitch=_;const D=s.aR.convert(r),L=s.aR.convert(c),F=new s.aR(D.lng,L.lat),k=new s.aR(L.lng,D.lat),H=E.project(D),$=E.project(L),G=this.queryTerrainElevation(D),ee=this.queryTerrainElevation(L),X=this.queryTerrainElevation(F),ie=this.queryTerrainElevation(k),ce=[[H.x,H.y,Math.min(G||0,ee||0,X||0,ie||0)],[$.x,$.y,Math.max(G||0,ee||0,X||0,ie||0)]];let de=s.d8.fromPoints(ce);const Te=E.getWorldToCameraMatrix(),we=s.bl(new Float64Array(16),Te);de=s.d8.applyTransform(de,Te);const Ee=this._extendAABB(de,E,R,m);if(!Ee)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");de=Ee;const ve=.5*s.av([],de.max,de.min)[2],be=this._minimumAABBFrustumDistance(E,de),Ce=[0,0,1,0];s.aC(Ce,Ce,Te),s.eU(Ce,Ce);const We=s.c4([],Ce,be+ve),je=s.d7([],de.center,We);s.af(de.center,de.center,we),s.af(je,je,we);const ct=E.unproject(new s.P(de.center[0],de.center[1])),Ze=s.eV(E.projection,ct),ot=Math.pow(2,Ze),jt=Math.min(E._zoomFromMercatorZ(je[2]*E.pixelsPerMeter*ot/E.worldSize),R.maxZoom);return E.mercatorFromTransition&&jt<.5*(s.cZ+s.cK)?(E.setProjection({name:"globe"}),E.zoom=jt,this._cameraForBounds(E,r,c,m,_,w)):{center:ct,zoom:jt,bearing:m,pitch:_}}fitBounds(t,r,c){const m=this.cameraForBounds(t,r);return this._fitInternal(m,r,c)}fitScreenCoordinates(t,r,c,m,_){const w=s.P.convert(t),E=s.P.convert(r),R=new s.P(Math.min(w.x,E.x),Math.min(w.y,E.y)),D=new s.P(Math.max(w.x,E.x),Math.max(w.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,E))return this;const L=this.transform.pointLocation3D(R),F=this.transform.pointLocation3D(D),k=this.transform.pointLocation3D(new s.P(R.x,D.y)),H=this.transform.pointLocation3D(new s.P(D.x,R.y)),$=[Math.min(L.lng,F.lng,k.lng,H.lng),Math.min(L.lat,F.lat,k.lat,H.lat)],G=[Math.max(L.lng,F.lng,k.lng,H.lng),Math.max(L.lat,F.lat,k.lat,H.lat)],ee=m&&m.pitch?m.pitch:this.getPitch(),X=this._cameraForBounds(this.transform,$,G,c,ee,m);return this._fitInternal(X,m,_)}_fitInternal(t,r,c){return t?(r=Object.assign(t,r)).linear?this.easeTo(r,c):this.flyTo(r,c):this}jumpTo(t,r){this.stop();const c=t.preloadOnly?this.transform.clone():this.transform;let m=!1,_=!1,w=!1;"zoom"in t&&c.zoom!==+t.zoom&&(m=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=s.aR.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(_=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(w=!0,c.pitch=+t.pitch);const E=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!c.isPaddingEqual(E))if(t.retainPadding===!1){const R=c.clone();R.padding=E,c.setLocationAtPoint(c.center,R.centerPoint)}else c.padding=E;return t.preloadOnly?(this._preloadTiles(c),this):(this.fire(new s.z("movestart",r)).fire(new s.z("move",r)),m&&this.fire(new s.z("zoomstart",r)).fire(new s.z("zoom",r)).fire(new s.z("zoomend",r)),_&&this.fire(new s.z("rotatestart",r)).fire(new s.z("rotate",r)).fire(new s.z("rotateend",r)),w&&this.fire(new s.z("pitchstart",r)).fire(new s.z("pitch",r)).fire(new s.z("pitchend",r)),this.fire(new s.z("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(qh),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,r){const c=this.transform;if(!c.projection.supportsFreeCamera)return s.w(qh),this;this.stop();const m=c.zoom,_=c.pitch,w=c.bearing;c.setFreeCameraOptions(t);const E=m!==c.zoom,R=_!==c.pitch,D=w!==c.bearing;return this.fire(new s.z("movestart",r)).fire(new s.z("move",r)),E&&this.fire(new s.z("zoomstart",r)).fire(new s.z("zoom",r)).fire(new s.z("zoomend",r)),D&&this.fire(new s.z("rotatestart",r)).fire(new s.z("rotate",r)).fire(new s.z("rotateend",r)),R&&this.fire(new s.z("pitchstart",r)).fire(new s.z("pitch",r)).fire(new s.z("pitchend",r)),this.fire(new s.z("moveend",r)),this}easeTo(t,r){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:s.eM},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const c=this.transform,m=this.getZoom(),_=this.getBearing(),w=this.getPitch(),E=this.getPadding(),R="zoom"in t?+t.zoom:m,D="bearing"in t?this._normalizeBearing(t.bearing,_):_,L="pitch"in t?+t.pitch:w,F=this._extendPadding(t.padding),k=s.P.convert(t.offset);let H,$,G;if(c.projection.name==="globe"){const Ce=s.ae.fromLngLat(c.center),We=k.rotate(-c.angle);Ce.x+=We.x/c.worldSize,Ce.y+=We.y/c.worldSize;const je=Ce.toLngLat(),ct=s.aR.convert(t.center||je);this._normalizeCenter(ct),H=c.centerPoint.add(We),$=new s.P(Ce.x,Ce.y).mult(c.worldSize),G=new s.P(s.aF(ct.lng),s.aJ(ct.lat)).mult(c.worldSize).sub($)}else{H=c.centerPoint.add(k);const Ce=c.pointLocation(H),We=s.aR.convert(t.center||Ce);this._normalizeCenter(We),$=c.project(Ce),G=c.project(We).sub($)}const ee=c.zoomScale(R-m);let X,ie;t.around&&(X=s.aR.convert(t.around),ie=c.locationPoint(X));const ce=this._zooming||R!==m,de=this._rotating||_!==D,Te=this._pitching||L!==w,we=!c.isPaddingEqual(F),Ee=t.retainPadding===!1?c.clone():c,ve=Ce=>We=>{if(ce&&(Ce.zoom=s.ak(m,R,We)),de&&(Ce.bearing=s.ak(_,D,We)),Te&&(Ce.pitch=s.ak(w,L,We)),we&&(Ee.interpolatePadding(E,F,We),H=Ee.centerPoint.add(k)),X)Ce.setLocationAtPoint(X,ie);else{const je=Ce.zoomScale(Ce.zoom-m),ct=R>m?Math.min(2,ee):Math.max(.5,ee),Ze=Math.pow(ct,1-We),ot=Ce.unproject($.add(G.mult(We*Ze)).mult(je));Ce.setLocationAtPoint(Ce.renderWorldCopies?ot.wrap():ot,H)}return t.preloadOnly||this._fireMoveEvents(r),Ce};if(t.preloadOnly){const Ce=this._emulate(ve,t.duration,c);return this._preloadTiles(Ce),this}const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ce,this._rotating=de,this._pitching=Te,this._padding=we,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,be),this._ease(ve(c),Ce=>{c.cameraElevationReference==="sea"&&c.recenterOnTerrain(),this._afterEase(r,Ce)},t),this}_prepareEase(t,r,c={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),r||c.moving||this.fire(new s.z("movestart",t)),this._zooming&&!c.zooming&&this.fire(new s.z("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new s.z("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new s.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.z("move",t)),this._zooming&&this.fire(new s.z("zoom",t)),this._rotating&&this.fire(new s.z("rotate",t)),this._pitching&&this.fire(new s.z("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const c=this._zooming,m=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new s.z("zoomend",t)),m&&this.fire(new s.z("rotateend",t)),_&&this.fire(new s.z("pitchend",t)),this.fire(new s.z("moveend",t))}flyTo(t,r){if(this._prefersReducedMotion(t)){const Ge=s.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ge,r)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:s.eM},t);const c=this.transform,m=this.getZoom(),_=this.getBearing(),w=this.getPitch(),E=this.getPadding(),R="zoom"in t?s.aA(+t.zoom,c.minZoom,c.maxZoom):m,D="bearing"in t?this._normalizeBearing(t.bearing,_):_,L="pitch"in t?+t.pitch:w,F=this._extendPadding(t.padding),k=c.zoomScale(R-m),H=s.P.convert(t.offset);let $=c.centerPoint.add(H);const G=c.pointLocation($),ee=s.aR.convert(t.center||G);this._normalizeCenter(ee);const X=c.project(G),ie=c.project(ee).sub(X);let ce=t.curve;const de=Math.max(c.width,c.height),Te=de/k,we=ie.mag();if("minZoom"in t){const Ge=s.aA(Math.min(t.minZoom,m,R),c.minZoom,c.maxZoom),ht=de/c.zoomScale(Ge-m);ce=Math.sqrt(ht/we*2)}const Ee=ce*ce;function ve(Ge){const ht=(Te*Te-de*de+(Ge?-1:1)*Ee*Ee*we*we)/(2*(Ge?Te:de)*Ee*we);return Math.log(Math.sqrt(ht*ht+1)-ht)}function be(Ge){return(Math.exp(Ge)-Math.exp(-Ge))/2}function Ce(Ge){return(Math.exp(Ge)+Math.exp(-Ge))/2}const We=ve(0);let je=function(Ge){return Ce(We)/Ce(We+ce*Ge)},ct=function(Ge){return de*((Ce(We)*(be(ht=We+ce*Ge)/Ce(ht))-be(We))/Ee)/we;var ht},Ze=(ve(1)-We)/ce;if(Math.abs(we)<1e-6||!isFinite(Ze)){if(Math.abs(de-Te)<1e-6)return this.easeTo(t,r);const Ge=Te<de?-1:1;Ze=Math.abs(Math.log(Te/de))/ce,ct=function(){return 0},je=function(ht){return Math.exp(Ge*ce*ht)}}t.duration="duration"in t?+t.duration:1e3*Ze/("screenSpeed"in t?+t.screenSpeed/ce:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const ot=_!==D,jt=L!==w,Ye=!c.isPaddingEqual(F),Oe=t.retainPadding===!1?c.clone():c,nt=Ge=>ht=>{const _t=ht*Ze,qt=1/je(_t);Ge.zoom=ht===1?R:m+Ge.scaleZoom(qt),ot&&(Ge.bearing=s.ak(_,D,ht)),jt&&(Ge.pitch=s.ak(w,L,ht)),Ye&&(Oe.interpolatePadding(E,F,ht),$=Oe.centerPoint.add(H));const Ct=ht===1?ee:Ge.unproject(X.add(ie.mult(ct(_t))).mult(qt));return Ge.setLocationAtPoint(Ge.renderWorldCopies?Ct.wrap():Ct,$),Ge._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(r),Ge};if(t.preloadOnly){const Ge=this._emulate(nt,t.duration,c);return this._preloadTiles(Ge),this}return this._zooming=!0,this._rotating=ot,this._pitching=jt,this._padding=Ye,this._prepareEase(r,!1),this._ease(nt(c),()=>this._afterEase(r),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const c=this._onEaseEnd;this._onEaseEnd=void 0,c.call(this,r)}if(!t){const c=this.handlers;c&&c.stop(!1)}return this}_ease(t,r,c){c.animate===!1||c.duration===0?(t(1),r()):(this._easeStart=s.o.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.o.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=s.bT(t,-180,180);const c=Math.abs(t-r);return Math.abs(t-360-r)<c&&(t-=360),Math.abs(t+360-r)<c&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(r.maxBounds||r.projection.name!=="globe"&&!r.renderWorldCopies)return;const c=t.lng-r.center.lng;t.lng+=c>180?-360:c<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&s.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,r,c){const m=Math.ceil(15*r/1e3),_=[],w=t(c.clone());for(let E=0;E<=m;E++){const R=w(E/m);_.push(R.clone())}return _}_preloadTiles(t,r){}}class Jr{constructor(t={}){this.options=t,s.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const r=this.options&&this.options.compact,c=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Se("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",c);const m=Se("span","mapboxgl-ctrl-icon",this._compactButton);return m.setAttribute("aria-hidden","true"),m.setAttribute("title",c),this._innerContainer=Se("div","mapboxgl-ctrl-attrib-inner",this._container),r&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),r===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(t){const c=r.reduce((m,_,w)=>(_.value&&(m+=`${_.key}=${_.value}${w<r.length-1?"&":""}`),m),"?");t.href=`${s.e.FEEDBACK_URL}/${c}#${Ud(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const r=this._map.style._mergedSourceCaches;for(const m in r){const _=r[m];if(_.used){const w=_.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t.sort((m,_)=>m.length-_.length),t=t.filter((m,_)=>{for(let w=_+1;w<t.length;w++)if(t[w].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ro{constructor(){s.aY(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Se("div","mapboxgl-ctrl");const r=Se("a","mapboxgl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://www.mapbox.com/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const r in t){const c=t[r].getSource();if(c.hasOwnProperty("mapbox_logo")&&!c.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const r=t[0];this._map.getCanvasContainer().offsetWidth<250?r.classList.add("mapboxgl-compact"):r.classList.remove("mapboxgl-compact")}}}class Gh{constructor(){s.aY(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",r=>this._onIndoorUpdate({selectedFloorId:r.selectedFloorId,floors:r.floors})),this._container}_createButton(t,r){const c=Se("button",t,this._container);return c.type="button",c.addEventListener("click",r),c}_createSeparator(){return Se("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,r){this._map&&(t.setAttribute("aria-label",r),t.textContent=r)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return void(this._container.style.display="none");const r=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px";const c=t.floors.sort((m,_)=>_.levelOrder-m.levelOrder);r?(Array.from(this._container.children).forEach(m=>m.remove()),this.addCurrentFloors(c)):this.addCurrentFloors(c)}addCurrentFloors(t){for(let r=0;r<t.length;r++){const c=t[r],m=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(c.id),this._model&&(this._model.selectedFloorId=c.id),Array.from(this._container.children).forEach(_=>{_.classList.contains("mapboxgl-ctrl-level-button")&&_.classList.remove("mapboxgl-ctrl-level-button-selected")}),m.classList.add("mapboxgl-ctrl-level-button-selected")});this._setButtonTitle(m,c.shortName),this._model&&c.id===this._model.selectedFloorId&&m.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(m),r<t.length-1&&this._createSeparator()}}}class Wn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,c=r?this._queue.concat(r):this._queue;for(const m of c)if(m.id===t)return void(m.cancelled=!0)}run(t=0){const r=this._currentlyRunning=this._queue;this._queue=[];for(const c of r)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Qo{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const r=s.dz((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,r,c){this._start=this.getValue(r),this._end=t,this._startTime=r,this._endTime=r+c}}const Zd={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class $h extends s.z{constructor(t,r,c,m){const{point:_,lngLat:w,originalEvent:E,target:R}=t;super(t.type,{point:_,lngLat:w,originalEvent:E,target:R}),this.preventDefault=()=>{t.preventDefault()},this.id=r,this.interaction=c,this.feature=m}}class Kp{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,r){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const c=r.filter;let m=r.type;c&&this.filters.set(t,s.b6(c)),m==="mouseover"&&(m="mouseenter"),m==="mouseout"&&(m="mouseleave");const _=this.interactionsByType.get(m)||new Map;m==="mouseenter"||m==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,r)):_.size===0&&this.map.on(m,this.handleType),_.size===0&&this.interactionsByType.set(m,_),_.set(t,r),this.typeById.set(t,m)}get(t){const r=this.typeById.get(t);if(!r)return;const c=this.interactionsByType.get(r);return c?c.get(t):void 0}remove(t){const r=this.typeById.get(t);if(!r)return;this.typeById.delete(t),this.filters.delete(t);const c=this.interactionsByType.get(r);c&&(c.delete(t),r==="mouseenter"||r==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):c.size===0&&this.map.off(r,this.handleType))}queryTargets(t,r){const c=[];for(const[m,_]of r)_.target&&c.push({targetId:m,target:_.target,filter:this.filters.get(m)});return this.map.style.queryRenderedTargets(t,c,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const r=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());r.length&&(t.type="mouseenter",this.handleType(t,r));const c=new Map;for(const[m,{feature:_}]of this.prevHoveredFeatures)this.hoveredFeatures.has(m)||c.set(_.id,_);c.size&&(t.type="mouseleave",this.handleType(t,Array.from(c.values())))}handleOut(t){const r=Array.from(this.hoveredFeatures.values()).map(({feature:c})=>c);r.length&&(t.type="mouseleave",this.handleType(t,r)),this.hoveredFeatures.clear()}handleType(t,r){const c=t.type==="mouseenter";if(c&&!this.interactionsByType.has(t.type))return void s.w("mouseenter interaction required for mouseleave to work.");const m=Array.from(this.interactionsByType.get(t.type)).reverse(),_=!!r;r=r||this.queryTargets(t.point,m);let w=!1;const E=new Set;for(const R of r){for(const[D,L]of m){if(!L.target)continue;const F=R.variants?R.variants[D]:null;if(F){for(const k of F){if(jo(k,R,E,D))continue;const H=new s.dt(R,k),$=lh(k,R,D);_&&(H.state=this.map.getFeatureState(H));const G=c?this.prevHoveredFeatures.get($):null,ee=new $h(t,D,L,H),X=G?G.stop:L.handler(ee);if(c&&this.hoveredFeatures.set($,{feature:R,stop:X}),X!==!1){w=!0;break}}if(w)break}}if(w)break}if(!w)for(const[R,D]of m){const{handler:L,target:F}=D;if(!F&&L(new $h(t,R,D,null))!==!1)break}}}function Rs(u,t){if(Array.isArray(u)&&Array.isArray(t)){const r=new Set(u),c=new Set(t);return r.size===c.size&&u.every(m=>c.has(m))}return s.by(u,t)}const la={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},dc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Km{constructor(t,r,c=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new Bu({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,c&&(this.mousePitch=new Sl({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(t,r){this.mouseRotate.mousedown(t,r),this.mousePitch&&this.mousePitch.mousedown(t,r),Pe()}move(t,r){const c=this.map,m=this.mouseRotate.mousemoveWindow(t,r),_=m&&m.bearingDelta;if(_&&c.setBearing(c.getBearing()+_),this.mousePitch){const w=this.mousePitch.mousemoveWindow(t,r),E=w&&w.pitchDelta;E&&c.setPitch(c.getPitch()+E)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ae(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),rt(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,rt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ut(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=ut(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Wd(u,t,r){if(u=new s.aR(u.lng,u.lat),t){const c=new s.aR(u.lng-360,u.lat),m=new s.aR(u.lng+360,u.lat),_=360*Math.ceil(Math.abs(u.lng-r.center.lng)/360),w=r.locationPoint3D(u).distSqr(t),E=t.x<0||t.y<0||t.x>r.width||t.y>r.height;r.locationPoint3D(c).distSqr(t)<w&&(E||Math.abs(c.lng-r.center.lng)<_)?u=c:r.locationPoint3D(m).distSqr(t)<w&&(E||Math.abs(m.lng-r.center.lng)<_)&&(u=m)}for(;Math.abs(u.lng-r.center.lng)>180;){const c=r.locationPoint3D(u);if(c.x>=0&&c.y>=0&&c.x<=r.width&&c.y<=r.height)break;u.lng>r.center.lng?u.lng-=360:u.lng+=360}return u}const Xd={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Pa={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class $s extends s.E{constructor(t,r){super(),(t instanceof HTMLElement||r)&&(t=Object.assign({element:t},r)),s.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:c="center",color:m="#3FB1CE",scale:_=1,draggable:w=!1,clickTolerance:E=0,rotation:R=Pa.rotation,rotationAlignment:D=Pa.rotationAlignment,pitchAlignment:L=Pa.pitchAlignment,occludedOpacity:F=Pa.occludedOpacity,altitude:k=Pa.altitude}=t||{};this._anchor=c,this._color=m,this._scale=_,this._draggable=w,this._clickTolerance=E,this._rotation=R,this._rotationAlignment=D,this._pitchAlignment=L,this._occludedOpacity=F,this._altitude=k,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",G=>{G.preventDefault()}),this._element.addEventListener("mousedown",G=>{G.preventDefault()});const H=this._element.classList;for(const G in Xd)H.remove(`mapboxgl-marker-anchor-${G}`);H.add(`mapboxgl-marker-anchor-${this._anchor}`);const $=t&&t.className?t.className.trim().split(/\s+/):[];H.add(...$),this._popup=null}_createDefaultMarker(){const t=Se("div"),r=te("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const c=te("radialGradient",{id:"shadowGradient"},te("defs",{},r));te("stop",{offset:"10%","stop-opacity":.4},c),te("stop",{offset:"100%","stop-opacity":.05},c),te("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},r)}return te("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},r),te("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},r),te("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},r),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.aR.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Pa.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const r=t.code,c=t.charCode||t.keyCode;r!=="Space"&&r!=="Enter"&&c!==32&&c!==13||this.togglePopup()}_onMapClick(t){const r=t.originalEvent.target,c=this._element;this._popup&&(r===c||c.contains(r))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,r=this._pos;if(!t||!r)return!1;const c=t.unproject(r,this._altitude),m=t.getFreeCameraOptions();if(!m.position)return!1;const _=m.position.toLngLat();return _.distanceTo(c)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)return void this._clearFadeTimer();const c=t.unproject(r,this._altitude);let m;t._showingGlobe()&&s.eY(t.transform,this._lngLat)?m=0:(m=1-t._queryFogOpacity(c),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(m*=this._occludedOpacity)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const r=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Xd[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${r.x}px,${r.y}px)
        `}_calculateXYTransform(){const t=this._pos,r=this._map,c=this.getPitchAlignment();if(!r||!t||c!=="map")return"";if(!r._showingGlobe()){const R=r.getPitch();return R?`rotateX(${R}deg)`:""}const m=s.cW(s.eZ(r.transform,this._lngLat)),_=t.sub(s.e_(r.transform)),w=Math.abs(_.x)+Math.abs(_.y);if(w===0)return"";const E=m/w;return`rotateX(${-_.y*E}deg) rotateY(${_.x*E}deg)`}_calculateZTransform(){const t=this._pos,r=this._map;if(!r||!t)return"";let c=0;const m=this.getRotationAlignment();if(m==="map")if(r._showingGlobe()){const _=r.project(new s.aR(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),w=r.project(new s.aR(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(_);c=s.cW(Math.atan2(w.y,w.x))-90}else c=-r.getBearing();else if(m==="horizon"){const _=s.ah(4,6,r.getZoom()),w=s.e_(r.transform);w.y+=_*r.transform.height;const E=t.sub(w),R=s.cW(Math.atan2(E.y,E.x));c=(R>90?R-270:R+90)*(1-_)}return c+=this._rotation,c?`rotateZ(${c}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const r=this._map;r&&(r.transform.renderWorldCopies&&(this._lngLat=Wd(this._lngLat,this._pos,r.transform)),this._pos=r.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),r._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(r._showingGlobe()||r.getTerrain()||r.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const r=this._map;if(!r)return;const c=this._pointerdownPos,m=this._positionDelta;if(c&&m){if(!this._isDragging){const _=this._clickTolerance||r._clickTolerance;if(t.point.dist(c)<_)return;this._isDragging=!0}this._pos=t.point.sub(m),this._lngLat=r.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.z("dragstart"))),this.fire(new s.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.z("dragend")),this._state="inactive"}_addDragHandler(t){const r=this._map,c=this._pos;r&&c&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(c),this._pointerdownPos=t.point,this._state="pending",r.on("mousemove",this._onMove),r.on("touchmove",this._onMove),r.once("mouseup",this._onUp),r.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const r=this._map;return r&&(t?(r.on("mousedown",this._addDragHandler),r.on("touchstart",this._addDragHandler)):(r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Pa.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Pa.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Pa.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Pa.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Zs={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},El={maxWidth:100,unit:"metric"},Ms={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Qc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Ns=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function qu(u=new s.P(0,0),t="bottom"){if(typeof u=="number"){const r=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(t){case"top":return new s.P(0,u);case"top-left":return new s.P(r,r);case"top-right":return new s.P(-r,r);case"bottom":return new s.P(0,-u);case"bottom-left":return new s.P(r,-r);case"bottom-right":return new s.P(-r,-r);case"left":return new s.P(u,0);case"right":return new s.P(-u,0)}return new s.P(0,0)}return u instanceof s.P||Array.isArray(u)?s.P.convert(u):s.P.convert(u[t]||[0,0])}return{version:q,supported:le.supported,setRTLTextPlugin:s.f2,getRTLTextPluginStatus:s.f1,Map:class extends Jo{constructor(u){Q.mark(Z.create);const t=u;if((u=Object.assign({},la,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&s.eW(window)&&(u.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ya(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies,null,null),u),this._repaint=!!u.repaint,this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new Wn,this._domRenderTaskQueue=new Wn,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.b2(),this._locale=Object.assign({},Zd,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._tessellationStep=u.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=u.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Qo(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=u.scaleFactor,this._requestManager=new Fi(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,this._contextCreateOptions=u.contextCreateOptions?Object.assign({},u.contextCreateOptions):{},typeof u.container=="string"){const r=document.getElementById(u.container);if(!r)throw new Error(`Container '${u.container.toString()}' not found.`);this._container=r}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),this._spriteFormat=u.spriteFormat,s.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Lu),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Hu(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,(u.style||!u.testMode)&&this.setStyle(u.style||s.e.DEFAULT_STYLE,{config:u.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this.indoor=new bu(this),u.hash&&(this._hash=new qf(typeof u.hash=="string"&&u.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch});const r=u.bounds;r&&(this.resize(),this.fitBounds(r,Object.assign({},u.fitBoundsOptions,{duration:0})))}this.resize(),u.attributionControl&&this.addControl(new Jr({customAttribution:u.customAttribution})),this._logoControl=new Ro,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new s.z(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new s.z(`${r.dataType}dataloading`,r))}),this._interactions=new Kp(this)}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new s.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=u.onAdd(this);this._controls.push(u);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(r,c.firstChild):c.appendChild(r),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new s.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new s.z("movestart",u)).fire(new s.z("move",u)),this.fire(new s.z("resize",u)),t&&this.fire(new s.z("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(s.aI.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(u){return this._scaleFactor=u,this.painter.scaleFactor=u,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(t=>t==="auto"?navigator.language:t):u}setLanguage(u){const t=this._parseLanguage(u);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,t=u.projection.name;let r;t==="globe"&&u.zoom>=s.cK?(u.setMercatorFromTransition(),r=!0):t==="mercator"&&u.zoom<s.cK&&(u.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(u,t){return this._updateProjection(u||t||{name:"mercator"})}_updateProjection(u){let t;return t=u.name==="globe"&&this.transform.zoom>=s.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(u,t){return this.transform.locationPoint3D(s.aR.convert(u),t)}unproject(u,t){return this.transform.pointLocation3D(s.P.convert(u),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,t,r){const c=m=>{let _=[];if(Array.isArray(t)){const w=t.filter(E=>this.getLayer(E));_=w.length?this.queryRenderedFeatures(m,{layers:w}):[]}else _=this.queryRenderedFeatures(m,{target:t});return _};if(u==="mouseenter"||u==="mouseover"){let m=!1;return{listener:r,targets:t,delegates:{mousemove:w=>{const E=c(w.point);E.length?m||(m=!0,r.call(this,new Kr(u,this,w.originalEvent,{features:E}))):m=!1},mouseout:()=>{m=!1}}}}if(u==="mouseleave"||u==="mouseout"){let m=!1;return{listener:r,targets:t,delegates:{mousemove:E=>{c(E.point).length?m=!0:m&&(m=!1,r.call(this,new Kr(u,this,E.originalEvent)))},mouseout:E=>{m&&(m=!1,r.call(this,new Kr(u,this,E.originalEvent)))}}}}{const m=_=>{const w=c(_.point);w.length&&(_.features=w,r.call(this,_),delete _.features)};return{listener:r,targets:t,delegates:{[u]:m}}}}on(u,t,r){if(typeof t=="function"||r===void 0)return super.on(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._createDelegatedListener(u,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(c);for(const m in c.delegates)this.on(m,c.delegates[m]);return this}once(u,t,r){if(typeof t=="function"||r===void 0)return super.once(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._createDelegatedListener(u,t,r);for(const m in c.delegates)this.once(m,c.delegates[m]);return this}off(u,t,r){if(typeof t=="function"||r===void 0)return super.off(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._delegatedListeners?this._delegatedListeners[u]:void 0;return c&&(m=>{for(let _=0;_<m.length;_++){const w=m[_];if(w.listener===r&&Rs(w.targets,t)){for(const E in w.delegates)this.off(E,w.delegates[E]);return m.splice(_,1),this}}})(c),this}queryRenderedFeatures(u,t){if(!this.style)return[];if(u===void 0||u instanceof s.P||Array.isArray(u)||t!==void 0||(t=u,u=void 0),u=u||[[0,0],[this.transform.width,this.transform.height]],!t){const _=this.style.queryRenderedFeatures(u,void 0,this.transform),w=this.style.queryRenderedFeatureset(u,void 0,this.transform);return _.concat(w)}let r=!0;if(t.target&&(r=this._isTargetValid(t.target),r&&!t.layers))return this.style.queryRenderedFeatureset(u,t,this.transform);let c=!0;if(t.layers&&Array.isArray(t.layers)){for(const _ of t.layers)if(!this._isValidId(_)){c=!1;break}if(c&&!t.target)return this.style.queryRenderedFeatures(u,t,this.transform)}let m=[];return c&&(m=m.concat(this.style.queryRenderedFeatures(u,t,this.transform))),r&&(m=m.concat(this.style.queryRenderedFeatureset(u,t,this.transform))),m}querySourceFeatures(u,t){return!u||typeof u=="string"&&!this._isValidId(u)?[]:this.style.querySourceFeatures(u,t)}queryRasterValue(u,t,r){return this._isValidId(u)?this.style.queryRasterValue(u,t,r):Promise.resolve(null)}isPointOnSurface(u){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&s.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(u))}addInteraction(u,t){return this._interactions.add(u,t),this}removeInteraction(u){return this._interactions.remove(u),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(u){return this._cooperativeGestures=u,this}setStyle(u,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&u&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(u,(r,c)=>{if(r){const m=typeof r=="string"?r:r instanceof Error?r.message:r.error;s.w(`Unable to perform style diff: ${m}. Rebuilding the style from scratch.`),this._updateStyle(u,t)}else c&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(u,t))}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u){const r=Object.assign({},t);t&&t.config&&(r.initialConfig=t.config,delete r.config),this.style=new Vs(this,r).load(u),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Vs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(u){return u==null?(this.fire(new s.y(new Error("IDs can't be empty."))),!1):!s.dm(u)||(this.fire(new s.y(new Error(`IDs can't contain special symbols: "${u}".`))),!1)}_isTargetValid(u){return"featuresetId"in u?this._isValidId("importId"in u?u.importId:u.featuresetId):"layerId"in u&&this._isValidId(u.layerId)}_areTargetsValid(u){if(Array.isArray(u)){for(const t of u)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(u)}addSource(u,t){return this._isValidId(u)?(this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)):this}isSourceLoaded(u){return!!this._isValidId(u)&&!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(u,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,r)}removeSource(u){return this._isValidId(u)?(this.style.removeSource(u),this._updateTerrain(),this._update(!0)):this}getSource(u){return this._isValidId(u)?this.style.getOwnSource(u):null}addImage(u,t,{pixelRatio:r=1,sdf:c=!1,stretchX:m,stretchY:_,content:w}={}){this._lazyInitEmptyStyle();const E=s.I.from(u);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:R,height:D,data:L}=s.o.getImageData(t);this.style.addImage(E,{data:new s.q({width:R,height:D},L),pixelRatio:r,stretchX:m,stretchY:_,content:w,sdf:c,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new s.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:R,height:D}=t,L=t;this.style.addImage(E,{data:new s.q({width:R,height:D},new Uint8Array(L.data)),pixelRatio:r,stretchX:m,stretchY:_,content:w,sdf:c,usvg:!1,version:0,userImage:L}),L.onAdd&&L.onAdd(this,u)}}updateImage(u,t){this._lazyInitEmptyStyle();const r=s.I.from(u),c=this.style.getImage(r);if(!c)return void this.fire(new s.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?s.o.getImageData(t):t,{width:_,height:w,data:E}=m;if(_===void 0||w===void 0)return void this.fire(new s.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==(c.usvg?c.icon.usvg_tree.width:c.data.width)||w!==(c.usvg?c.icon.usvg_tree.height:c.data.height))return void this.fire(new s.y(new Error(`The width and height of the updated image (${_}, ${w})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`)));const R=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let D=!1;c.usvg?(c.data=new s.q({width:_,height:w},new Uint8Array(E)),c.usvg=!1,c.icon=void 0,D=!0):c.data.replace(E,R),this.style.updateImage(r,c,D)}hasImage(u){return u?!!this.style&&!!this.style.getImage(s.I.from(u)):(this.fire(new s.y(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(s.I.from(u))}loadImage(u,t){s.n(this._requestManager.transformRequest(u,s.R.Image),(r,c)=>{t(r,c instanceof HTMLImageElement?s.o.getImageData(c):c)})}listImages(){return this.style.listImages().map(u=>u.name)}addModel(u,t){this._lazyInitEmptyStyle(),this.style.addModel(u,t)}hasModel(u){return u?this.style.hasModel(u):(this.fire(new s.y(new Error("Missing required model id"))),!1)}removeModel(u){this.style.removeModel(u)}listModels(){return this.style.listModels()}addLayer(u,t){return this._isValidId(u.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)):this}getSlot(u){const t=this.getLayer(u);return t&&t.slot||null}setSlot(u,t){return this.style.setSlot(u,t),this.style.mergeLayers(),this._update(!0)}addImport(u,t){return this.style.addImport(u,t).catch(r=>this.fire(new s.y(new Error("Failed to add import",r)))),this}updateImport(u,t){return typeof t!="string"&&t.id!==u?(this.removeImport(u),this.addImport(t)):(this.style.updateImport(u,t),this._update(!0))}removeImport(u){return this.style.removeImport(u),this}moveImport(u,t){return this.style.moveImport(u,t),this._update(!0)}moveLayer(u,t){return this._isValidId(u)?(this.style.moveLayer(u,t),this._update(!0)):this}removeLayer(u){return this._isValidId(u)?(this.style.removeLayer(u),this._update(!0)):this}getLayer(u){if(!this._isValidId(u))return null;const t=this.style.getOwnLayer(u);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(u,t,r){return this._isValidId(u)?(this.style.setLayerZoomRange(u,t,r),this._update(!0)):this}setFilter(u,t,r={}){return this._isValidId(u)?(this.style.setFilter(u,t,r),this._update(!0)):this}getFilter(u){return this._isValidId(u)?this.style.getFilter(u):null}setPaintProperty(u,t,r,c={}){return this._isValidId(u)?(this.style.setPaintProperty(u,t,r,c),this._update(!0)):this}getPaintProperty(u,t){return this._isValidId(u)?this.style.getPaintProperty(u,t):null}setLayoutProperty(u,t,r,c={}){return this._isValidId(u)?(this.style.setLayoutProperty(u,t,r,c),this._update(!0)):this}getLayoutProperty(u,t){return this._isValidId(u)?this.style.getLayoutProperty(u,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(u){return this.style.setGlyphsUrl(u),this._update(!0)}getSchema(u){return this.style.getSchema(u)}setSchema(u,t){return this.style.setSchema(u,t),this._update(!0)}getConfig(u){return this.style.getConfig(u)}setConfig(u,t){return this.style.setConfig(u,t),this._update(!0)}getConfigProperty(u,t){return this.style.getConfigProperty(u,t)}setConfigProperty(u,t,r){return this.style.setConfigProperty(u,t,r),this._update(!0)}getFeaturesetDescriptors(u){return this.style.getFeaturesetDescriptors(u)}setLights(u){if(this._lazyInitEmptyStyle(),u&&u.length===1&&u[0].type==="flat"){const t=u[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(u),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const u=this.style.getLights()||[];return u.length===0&&u.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),u}setLight(u,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:u}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(u){return this._lazyInitEmptyStyle(),this.style.setSnow(u),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(u){return this._lazyInitEmptyStyle(),this.style.setRain(u),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(u){return this._lazyInitEmptyStyle(),this.style.setColorTheme(u),this._update(!0)}setImportColorTheme(u,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(u,t),this._update(!0)}setCamera(u){return this.style.setCamera(u),this._triggerCameraUpdate(u)}_triggerCameraUpdate(u){return this._update(this.transform.setOrthographicProjectionAtLowPitch(u["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.aR.convert(u),this.transform):0}setFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.setFeatureState(u,t),this._update())}removeFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.removeFeatureState(u,t),this._update())}getFeatureState(u){return u.source&&!this._isValidId(u.source)?null:this.style.getFeatureState(u)}_selectIndoorFloor(u){this.indoor.selectFloor(u)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Gh),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let r,c,m,_=this._container;for(;_&&(!c||!m);){const w=window.getComputedStyle(_).transform;w&&w!=="none"&&(r=w.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&r[0]!=="0"&&r[0]!=="1"&&(c=r[0]),r[3]&&r[3]!=="0"&&r[3]!=="1"&&(m=r[3])),_=_.parentElement}this._containerWidth=c?Math.abs(u/c):u,this._containerHeight=m?Math.abs(t/m):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=Se("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Se("div","mapboxgl-canvas-container",u);this._canvas=Se("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=Se("div","mapboxgl-control-container",u),c=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(m=>{c[m]=Se("div",`mapboxgl-ctrl-${m}`,r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,t){const r=s.o.devicePixelRatio||1;this._canvas.width=r*Math.ceil(u),this._canvas.height=r*Math.ceil(t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const t=this._markers.indexOf(u);t!==-1&&this._markers.splice(t,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const t=this._popups.indexOf(u);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const u=Object.assign({},le.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",u);t?(Sn(t,!0),this.painter=new Bd(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",r=>{r.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.k.testSupport(t)):this.fire(new s.y(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.z("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.z("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let t;this.fire(new s.z("renderstart")),++this._frameId;const r=this.painter.context.extTimerQuery,c=s.o.now(),m=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=m.createQuery(),m.beginQuery(r.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,L=this.transform.pitch,F=s.o.now(),k=new s.ac(D,{now:F,fadeDuration:_,pitch:L,transition:this.style.transition,worldview:this._worldview});this.style.update(k)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(c),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(c);const E=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),E&&(this._placementDirty=E.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Q.mark(Z.load),this.fire(new s.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const D=s.o.now()-c;m.endQuery(r.TIME_ELAPSED_EXT),setTimeout(()=>{const L=m.getQueryParameter(t,m.QUERY_RESULT)/1e6;m.deleteQuery(t),this.fire(new s.z("gpu-timing-frame",{cpuTime:D,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){const D=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(D);this.fire(new s.z("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){const D=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const L=this.painter.queryGpuTimeDeferredRender(D);this.fire(new s.z("gpu-timing-deferred-render",{gpuTime:L}))},50)}const R=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(R||this._repaint)this.triggerRepaint();else{const D=this.idle();if(D&&(w=this._updateAverageElevation(c,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),D&&(this.fire(new s.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new s.z("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,Q.mark(Z.fullLoad),this._performanceMetricsCollection&&Ii(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const t of this._markers)u&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!u||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(u,t=!1){const r=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&r(0);const c=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(c||(t||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const m=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=u;const w=Math.abs(m-_);if(w>1){if(this._isInitialLoad||c)return this._averageElevation.jumpTo(_),r(_);this._averageElevation.easeTo(_,u,300)}else if(w>1e-4)return this._averageElevation.jumpTo(_),r(_)}return!!this._averageElevation.isEasing(u)&&r(this._averageElevation.getValue(u))}_authenticate(){St(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===wi||u.status===401)){const t=this.painter.context.gl;Sn(t,!1),this._logoControl instanceof Ro&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ii(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Ti(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,c=r.createFramebuffer();function m(_){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,_,0);const w=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,w),w}return r.bindFramebuffer(r.FRAMEBUFFER,c),this._canvasPixelComparison(m(u),t.canvasCopies.map(m),t.timeStamps)}_canvasPixelComparison(u,t,r){let c=r[1]-r[0];const m=u.length/4;for(let _=0;_<t.length;_++){const w=t[_];let E=0;for(let R=0;R<w.length;R+=4)w[R]===u[R]&&w[R+1]===u[R+1]&&w[R+2]===u[R+2]&&w[R+3]===u[R+3]&&(E+=1);c+=(r[_+2]-r[_+1])*(1-E/m)}return c}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ei.delete(this.painter.context.gl),xt.remove(),Zi.remove(),this._removed=!0,this.fire(new s.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=s.o.frame(t=>{const r=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,r&&this._render(t)}))}_preloadTiles(u){const t=this.style?this.style.getSourceCaches():[];return s.bw(t,(r,c)=>r._preloadTiles(u,c),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(u){this._showParseStatus!==u&&(this._showParseStatus=u,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(u){this._showLayers2DWireframe!==u&&(this._showLayers2DWireframe=u,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(u){this._showLayers3DWireframe!==u&&(this._showLayers3DWireframe=u,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,this._tp.refreshUI(),u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,this._tp.refreshUI(),u&&this._update())}_setCacheLimits(u,t){s.eX(u,t)}get version(){return q}},NavigationControl:class{constructor(u={}){this.options=Object.assign({},dc,u),this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(s.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Se("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Se("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const r=this._map;r&&(this.options.visualizePitch?r.resetNorthPitch({},{originalEvent:t}):r.resetNorth({},{originalEvent:t}))}),this._compassIcon=Se("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const t=u.getZoom(),r=t===u.getMaxZoom(),c=t===u.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Km(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,t){const r=Se("button",u,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(u,t){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${t}`);u.setAttribute("aria-label",r),u.firstElementChild&&u.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends s.E{constructor(u={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},Zs,u),s.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Fd(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const t=(r=!!this.options.geolocation)=>{this._supportsGeolocation=r,u(r)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(r=>t(r.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),r=u.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new s.z("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("geolocate",u)),this._finish()}}_updateCamera(u){const t=new s.aR(u.coords.longitude,u.coords.latitude),r=u.coords.accuracy,c=this._map.getBearing(),m=Object.assign({bearing:c},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(r),m,{geolocateSource:!0})}_updateMarker(u){if(u){const t=new s.aR(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,t=s.ce(1,u._center.lat)*u.worldSize,r=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Se("button","mapboxgl-ctrl-geolocate",this._container),Se("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Se("div","mapboxgl-user-location"),this._dotElement.appendChild(Se("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Se("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new $s({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Se("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $s({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.z("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Jr,ScaleControl:class{constructor(u={}){this.options=Object.assign({},El,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,c=t._containerWidth/2-u/2,m=t.unproject([c,r]),_=t.unproject([c+u,r]),w=m.distanceTo(_);if(this.options.unit==="imperial"){const E=3.2808*w;E>5280?this._setScale(u,E/5280,"mile"):this._setScale(u,E,"foot")}else this.options.unit==="nautical"?this._setScale(u,w/1852,"nautical-mile"):w>=1e3?this._setScale(u,w/1e3,"kilometer"):this._setScale(u,w,"meter")}_setScale(u,t,r){this._map._requestDomTask(()=>{const c=function(_){const w=Math.pow(10,`${Math.floor(_)}`.length-1);let E=_/w;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(R){const D=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*D)/D}(E),w*E}(t),m=c/t;this._container.innerHTML=this._isNumberFormatSupported&&r!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(c):`${c}&nbsp;${Ms[r]}`,this._container.style.width=u*m+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=Se("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u={}){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:s.w("Full screen control 'container' must be a DOM element.")),s.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=Se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=Se("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Se("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Gh,Popup:class extends s.E{constructor(u){super(),this.options=Object.assign(Object.create(Qc),u),this._altitude=this.options.altitude,s.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new s.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new s.z("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=s.aR.convert(u),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(u){return this._altitude=u,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const t=document.createDocumentFragment(),r=document.createElement("body");let c;for(r.innerHTML=u;c=r.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Se("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(u),this.options.closeButton){const r=this._closeButton=Se("button","mapboxgl-popup-close-button",t);r.type="button",r.setAttribute("aria-label","Close popup"),r.innerHTML='<span aria-hidden="true">&#215;</span>',r.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let t;return this._classList.delete(u)?t=!1:(this._classList.add(u),t=!0),this._updateClassList(),t}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,c=this._pos;if(!t||!r||!c)return"bottom";const m=r.offsetWidth,_=r.offsetHeight,w=c.x<m/2,E=c.x>t.transform.width-m/2;if(c.y+u<_)return w?"top-left":E?"top-right":"top";if(c.y>t.transform.height-_){if(w)return"bottom-left";if(E)return"bottom-right"}return w?"left":E?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),u.className=t.join(" ")}_update(u){const t=this._map,r=this._content;if(!t||!this._lngLat&&!this._trackPointer||!r)return;let c=this._container;if(c||(c=this._container=Se("div","mapboxgl-popup",t.getContainer()),this._tip=Se("div","mapboxgl-popup-tip",c),c.appendChild(r)),this.options.maxWidth&&c.style.maxWidth!==this.options.maxWidth&&(c.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Wd(this._lngLat,this._pos,t.transform)),!this._trackPointer||u){const m=this._pos=this._trackPointer&&u instanceof s.P?u:t.project(this._lngLat,this._altitude),_=qu(this.options.offset),w=this._anchor=this._getAnchor(_.y),E=qu(this.options.offset,w),R=m.add(E).round();t._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${Xd[w]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&t._showingGlobe()){const m=s.eY(t.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Ns);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:$s,Style:Vs,LngLat:s.aR,LngLatBounds:s.aI,Point:s.P,MercatorCoordinate:s.ae,FreeCameraOptions:xf,Evented:s.E,config:s.e,prewarm:s.f0,clearPrewarmedResources:s.e$,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(u){s.e.ACCESS_TOKEN=u},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(u){s.e.API_URL=u},get workerCount(){return s.f9.workerCount},set workerCount(u){s.f9.workerCount=u},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){s.e.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){s.f8(u)},get workerUrl(){return s.f7.workerUrl},set workerUrl(u){s.f7.workerUrl=u},get workerClass(){return s.f7.workerClass},set workerClass(u){s.f7.workerClass=u},get workerParams(){return s.f7.workerParams},set workerParams(u){s.f7.workerParams=u},get dracoUrl(){return s.f6()},set dracoUrl(u){s.f5(u)},get meshoptUrl(){return s.f4()},set meshoptUrl(u){s.f3(u)},setNow:s.o.setNow,restoreNow:s.o.restoreNow}});var V=I;return V})}(Wy)),Wy.exports}var gL=mL();const e0=P2(gL);var yv,hT;function Zg(){if(hT)return yv;hT=1,yv=g;var h=Object.prototype.hasOwnProperty;function g(){for(var b={},S=0;S<arguments.length;S++){var I=arguments[S];for(var N in I)h.call(I,N)&&(b[N]=I[N])}return b}return yv}var xv={exports:{}},dT;function _L(){return dT||(dT=1,function(h,g){(function(){var b={};h.exports=b,b.simpleFilter=function(S,I){return I.filter(function(N){return b.test(S,N)})},b.test=function(S,I){return b.match(S,I)!==null},b.match=function(S,I,N){N=N||{};var V=0,s=[],q=I.length,Z=0,Q=0,oe=N.pre||"",pe=N.post||"",ze=N.caseSensitive&&I||I.toLowerCase(),le;S=N.caseSensitive&&S||S.toLowerCase();for(var Se=0;Se<q;Se++)le=I[Se],ze[Se]===S[V]?(le=oe+le+pe,V+=1,Q+=1+Q):Q=0,Z+=Q,s[s.length]=le;return V===S.length?(Z=ze===S?1/0:Z,{rendered:s.join(""),score:Z}):null},b.filter=function(S,I,N){return!I||I.length===0?[]:typeof S!="string"?I:(N=N||{},I.reduce(function(V,s,q,Z){var Q=s;N.extract&&(Q=N.extract(s));var oe=b.match(S,Q,N);return oe!=null&&(V[V.length]={string:oe.rendered,score:oe.score,index:q,original:s}),V},[]).sort(function(V,s){var q=s.score-V.score;return q||V.index-s.index}))}})()}(xv)),xv.exports}var vv,fT;function yL(){if(fT)return vv;fT=1;var h=function(g){return this.component=g,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,g.el.parentNode.insertBefore(this.wrapper,g.el.nextSibling),this};return h.prototype.show=function(){this.element.style.display="block"},h.prototype.hide=function(){this.element.style.display="none"},h.prototype.add=function(g){this.items.push(g)},h.prototype.clear=function(){this.items=[],this.active=0},h.prototype.isEmpty=function(){return!this.items.length},h.prototype.isVisible=function(){return this.element.style.display==="block"},h.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var g=0;g<this.items.length;g++)this.drawItem(this.items[g],this.active===g);this.show()},h.prototype.drawItem=function(g,b){var S=document.createElement("li"),I=document.createElement("a");b&&(S.className+=" active"),I.innerHTML=g.string,S.appendChild(I),this.element.appendChild(S),S.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),S.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,g)}).bind(this))},h.prototype.handleMouseUp=function(g){this.selectingListItem=!1,this.component.value(g.original),this.clear(),this.draw()},h.prototype.move=function(g){this.active=g,this.draw()},h.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)},h.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},h.prototype.drawError=function(g){var b=document.createElement("li");b.innerHTML=g,this.element.appendChild(b),this.show()},vv=h,vv}var bv,pT;function xL(){if(pT)return bv;pT=1;var h=Zg(),g=_L(),b=yL(),S=function(I,N,V){return V=V||{},this.options=h({minLength:2,limit:5,filter:!0,hideOnBlur:!0},V),this.el=I,this.data=N||[],this.list=new b(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(s){this.handleKeyUp(s.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(s){this.handleKeyDown(s)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(s){this.handlePaste(s)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};return S.prototype.handleKeyUp=function(I){I===40||I===38||I===27||I===13||I===9||this.handleInputChange(this.el.value)},S.prototype.handleKeyDown=function(I){switch(I.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&I.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},S.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},S.prototype.handlePaste=function(I){if(I.clipboardData)this.handleInputChange(I.clipboardData.getData("Text"));else{var N=this;setTimeout(function(){N.handleInputChange(I.target.value)},100)}},S.prototype.handleInputChange=function(I){if(this.query=this.normalize(I),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(N){for(var V=0;V<N.length&&(this.list.add(N[V]),V!==this.options.limit-1);V++);this.list.draw()}).bind(this))},S.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},S.prototype.update=function(I){this.data=I,this.handleKeyUp()},S.prototype.clear=function(){this.data=[],this.list.clear()},S.prototype.normalize=function(I){return I=I.toLowerCase(),I},S.prototype.match=function(I,N){return I.indexOf(N)>-1},S.prototype.value=function(I){if(this.selected=I,this.el.value=this.getItemValue(I),document.createEvent){var N=document.createEvent("HTMLEvents");N.initEvent("change",!0,!1),this.el.dispatchEvent(N)}else this.el.fireEvent("onchange")},S.prototype.getCandidates=function(I){var N={pre:"<strong>",post:"</strong>",extract:(function(s){return this.getItemValue(s)}).bind(this)},V;this.options.filter?(V=g.filter(this.query,this.data,N),V=V.map((function(s){return{original:s.original,string:this.render(s.original,s.string)}}).bind(this))):V=this.data.map((function(s){var q=this.render(s);return{original:s,string:q}}).bind(this)),I(V)},S.prototype.getItemValue=function(I){return I},S.prototype.render=function(I,N){if(N)return N;for(var V=I.original?this.getItemValue(I.original):this.getItemValue(I),s=this.normalize(V),q=s.lastIndexOf(this.query);q>-1;){var Z=q+this.query.length;V=V.slice(0,q)+"<strong>"+V.slice(q,Z)+"</strong>"+V.slice(Z),q=s.slice(0,q).lastIndexOf(this.query)}return V},S.prototype.renderError=function(I){this.list.drawError(I)},bv=S,bv}var wv,mT;function vL(){if(mT)return wv;mT=1;var h=xL();return wv=h,typeof window<"u"&&(window.Suggestions=h),wv}var Tv,gT;function bL(){if(gT)return Tv;gT=1;var h="Expected a function",g=NaN,b="[object Symbol]",S=/^\s+|\s+$/g,I=/^[-+]0x[0-9a-f]+$/i,N=/^0b[01]+$/i,V=/^0o[0-7]+$/i,s=parseInt,q=typeof mp=="object"&&mp&&mp.Object===Object&&mp,Z=typeof self=="object"&&self&&self.Object===Object&&self,Q=q||Z||Function("return this")(),oe=Object.prototype,pe=oe.toString,ze=Math.max,le=Math.min,Se=function(){return Q.Date.now()};function te(Ae,Ke,it){var rt,ut,Lt,lt,Jt,wi,Fi=0,Bi=!1,Wt=!1,ki=!0;if(typeof Ae!="function")throw new TypeError(h);Ke=Pe(Ke)||0,ge(it)&&(Bi=!!it.leading,Wt="maxWait"in it,Lt=Wt?ze(Pe(it.maxWait)||0,Ke):Lt,ki="trailing"in it?!!it.trailing:ki);function Ui(Mi){var Ii=rt,xt=ut;return rt=ut=void 0,Fi=Mi,lt=Ae.apply(xt,Ii),lt}function Cn(Mi){return Fi=Mi,Jt=setTimeout(Di,Ke),Bi?Ui(Mi):lt}function Qe(Mi){var Ii=Mi-wi,xt=Mi-Fi,St=Ke-Ii;return Wt?le(St,Lt-xt):St}function Ft(Mi){var Ii=Mi-wi,xt=Mi-Fi;return wi===void 0||Ii>=Ke||Ii<0||Wt&&xt>=Lt}function Di(){var Mi=Se();if(Ft(Mi))return Zi(Mi);Jt=setTimeout(Di,Qe(Mi))}function Zi(Mi){return Jt=void 0,ki&&rt?Ui(Mi):(rt=ut=void 0,lt)}function ii(){Jt!==void 0&&clearTimeout(Jt),Fi=0,rt=wi=ut=Jt=void 0}function Yi(){return Jt===void 0?lt:Zi(Se())}function Ti(){var Mi=Se(),Ii=Ft(Mi);if(rt=arguments,ut=this,wi=Mi,Ii){if(Jt===void 0)return Cn(wi);if(Wt)return Jt=setTimeout(Di,Ke),Ui(wi)}return Jt===void 0&&(Jt=setTimeout(Di,Ke)),lt}return Ti.cancel=ii,Ti.flush=Yi,Ti}function ge(Ae){var Ke=typeof Ae;return!!Ae&&(Ke=="object"||Ke=="function")}function xe(Ae){return!!Ae&&typeof Ae=="object"}function ye(Ae){return typeof Ae=="symbol"||xe(Ae)&&pe.call(Ae)==b}function Pe(Ae){if(typeof Ae=="number")return Ae;if(ye(Ae))return g;if(ge(Ae)){var Ke=typeof Ae.valueOf=="function"?Ae.valueOf():Ae;Ae=ge(Ke)?Ke+"":Ke}if(typeof Ae!="string")return Ae===0?Ae:+Ae;Ae=Ae.replace(S,"");var it=N.test(Ae);return it||V.test(Ae)?s(Ae.slice(2),it?2:8):I.test(Ae)?g:+Ae}return Tv=te,Tv}var Oy={exports:{}},_T;function wL(){if(_T)return Oy.exports;_T=1;var h=typeof Reflect=="object"?Reflect:null,g=h&&typeof h.apply=="function"?h.apply:function(Ae,Ke,it){return Function.prototype.apply.call(Ae,Ke,it)},b;h&&typeof h.ownKeys=="function"?b=h.ownKeys:Object.getOwnPropertySymbols?b=function(Ae){return Object.getOwnPropertyNames(Ae).concat(Object.getOwnPropertySymbols(Ae))}:b=function(Ae){return Object.getOwnPropertyNames(Ae)};function S(Pe){console&&console.warn&&console.warn(Pe)}var I=Number.isNaN||function(Ae){return Ae!==Ae};function N(){N.init.call(this)}Oy.exports=N,Oy.exports.once=ge,N.EventEmitter=N,N.prototype._events=void 0,N.prototype._eventsCount=0,N.prototype._maxListeners=void 0;var V=10;function s(Pe){if(typeof Pe!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Pe)}Object.defineProperty(N,"defaultMaxListeners",{enumerable:!0,get:function(){return V},set:function(Pe){if(typeof Pe!="number"||Pe<0||I(Pe))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Pe+".");V=Pe}}),N.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},N.prototype.setMaxListeners=function(Ae){if(typeof Ae!="number"||Ae<0||I(Ae))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Ae+".");return this._maxListeners=Ae,this};function q(Pe){return Pe._maxListeners===void 0?N.defaultMaxListeners:Pe._maxListeners}N.prototype.getMaxListeners=function(){return q(this)},N.prototype.emit=function(Ae){for(var Ke=[],it=1;it<arguments.length;it++)Ke.push(arguments[it]);var rt=Ae==="error",ut=this._events;if(ut!==void 0)rt=rt&&ut.error===void 0;else if(!rt)return!1;if(rt){var Lt;if(Ke.length>0&&(Lt=Ke[0]),Lt instanceof Error)throw Lt;var lt=new Error("Unhandled error."+(Lt?" ("+Lt.message+")":""));throw lt.context=Lt,lt}var Jt=ut[Ae];if(Jt===void 0)return!1;if(typeof Jt=="function")g(Jt,this,Ke);else for(var wi=Jt.length,Fi=le(Jt,wi),it=0;it<wi;++it)g(Fi[it],this,Ke);return!0};function Z(Pe,Ae,Ke,it){var rt,ut,Lt;if(s(Ke),ut=Pe._events,ut===void 0?(ut=Pe._events=Object.create(null),Pe._eventsCount=0):(ut.newListener!==void 0&&(Pe.emit("newListener",Ae,Ke.listener?Ke.listener:Ke),ut=Pe._events),Lt=ut[Ae]),Lt===void 0)Lt=ut[Ae]=Ke,++Pe._eventsCount;else if(typeof Lt=="function"?Lt=ut[Ae]=it?[Ke,Lt]:[Lt,Ke]:it?Lt.unshift(Ke):Lt.push(Ke),rt=q(Pe),rt>0&&Lt.length>rt&&!Lt.warned){Lt.warned=!0;var lt=new Error("Possible EventEmitter memory leak detected. "+Lt.length+" "+String(Ae)+" listeners added. Use emitter.setMaxListeners() to increase limit");lt.name="MaxListenersExceededWarning",lt.emitter=Pe,lt.type=Ae,lt.count=Lt.length,S(lt)}return Pe}N.prototype.addListener=function(Ae,Ke){return Z(this,Ae,Ke,!1)},N.prototype.on=N.prototype.addListener,N.prototype.prependListener=function(Ae,Ke){return Z(this,Ae,Ke,!0)};function Q(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function oe(Pe,Ae,Ke){var it={fired:!1,wrapFn:void 0,target:Pe,type:Ae,listener:Ke},rt=Q.bind(it);return rt.listener=Ke,it.wrapFn=rt,rt}N.prototype.once=function(Ae,Ke){return s(Ke),this.on(Ae,oe(this,Ae,Ke)),this},N.prototype.prependOnceListener=function(Ae,Ke){return s(Ke),this.prependListener(Ae,oe(this,Ae,Ke)),this},N.prototype.removeListener=function(Ae,Ke){var it,rt,ut,Lt,lt;if(s(Ke),rt=this._events,rt===void 0)return this;if(it=rt[Ae],it===void 0)return this;if(it===Ke||it.listener===Ke)--this._eventsCount===0?this._events=Object.create(null):(delete rt[Ae],rt.removeListener&&this.emit("removeListener",Ae,it.listener||Ke));else if(typeof it!="function"){for(ut=-1,Lt=it.length-1;Lt>=0;Lt--)if(it[Lt]===Ke||it[Lt].listener===Ke){lt=it[Lt].listener,ut=Lt;break}if(ut<0)return this;ut===0?it.shift():Se(it,ut),it.length===1&&(rt[Ae]=it[0]),rt.removeListener!==void 0&&this.emit("removeListener",Ae,lt||Ke)}return this},N.prototype.off=N.prototype.removeListener,N.prototype.removeAllListeners=function(Ae){var Ke,it,rt;if(it=this._events,it===void 0)return this;if(it.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):it[Ae]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete it[Ae]),this;if(arguments.length===0){var ut=Object.keys(it),Lt;for(rt=0;rt<ut.length;++rt)Lt=ut[rt],Lt!=="removeListener"&&this.removeAllListeners(Lt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Ke=it[Ae],typeof Ke=="function")this.removeListener(Ae,Ke);else if(Ke!==void 0)for(rt=Ke.length-1;rt>=0;rt--)this.removeListener(Ae,Ke[rt]);return this};function pe(Pe,Ae,Ke){var it=Pe._events;if(it===void 0)return[];var rt=it[Ae];return rt===void 0?[]:typeof rt=="function"?Ke?[rt.listener||rt]:[rt]:Ke?te(rt):le(rt,rt.length)}N.prototype.listeners=function(Ae){return pe(this,Ae,!0)},N.prototype.rawListeners=function(Ae){return pe(this,Ae,!1)},N.listenerCount=function(Pe,Ae){return typeof Pe.listenerCount=="function"?Pe.listenerCount(Ae):ze.call(Pe,Ae)},N.prototype.listenerCount=ze;function ze(Pe){var Ae=this._events;if(Ae!==void 0){var Ke=Ae[Pe];if(typeof Ke=="function")return 1;if(Ke!==void 0)return Ke.length}return 0}N.prototype.eventNames=function(){return this._eventsCount>0?b(this._events):[]};function le(Pe,Ae){for(var Ke=new Array(Ae),it=0;it<Ae;++it)Ke[it]=Pe[it];return Ke}function Se(Pe,Ae){for(;Ae+1<Pe.length;Ae++)Pe[Ae]=Pe[Ae+1];Pe.pop()}function te(Pe){for(var Ae=new Array(Pe.length),Ke=0;Ke<Ae.length;++Ke)Ae[Ke]=Pe[Ke].listener||Pe[Ke];return Ae}function ge(Pe,Ae){return new Promise(function(Ke,it){function rt(Lt){Pe.removeListener(Ae,ut),it(Lt)}function ut(){typeof Pe.removeListener=="function"&&Pe.removeListener("error",rt),Ke([].slice.call(arguments))}ye(Pe,Ae,ut,{once:!0}),Ae!=="error"&&xe(Pe,rt,{once:!0})})}function xe(Pe,Ae,Ke){typeof Pe.on=="function"&&ye(Pe,"error",Ae,Ke)}function ye(Pe,Ae,Ke,it){if(typeof Pe.on=="function")it.once?Pe.once(Ae,Ke):Pe.on(Ae,Ke);else if(typeof Pe.addEventListener=="function")Pe.addEventListener(Ae,function rt(ut){it.once&&Pe.removeEventListener(Ae,rt),Ke(ut)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Pe)}return Oy.exports}var Sv,yT;function TL(){return yT||(yT=1,Sv={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}),Sv}var Ev,xT;function SL(){if(xT)return Ev;xT=1;function h(S){var I=S.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return I?{key:I[1],value:I[2]}:null}function g(S){var I=S.match(/<?([^>]*)>(.*)/);if(!I)return null;var N=I[1],V=I[2].split(";"),s=null,q=V.reduce(function(Z,Q){var oe=h(Q);return oe?oe.key==="rel"?(s||(s=oe.value),Z):(Z[oe.key]=oe.value,Z):Z},{});return s?{url:N,rel:s,params:q}:null}function b(S){return S?S.split(/,\s*</).reduce(function(I,N){var V=g(N);if(!V)return I;var s=V.rel.split(/\s+/);return s.forEach(function(q){I[q]||(I[q]={url:V.url,params:V.params})}),I},{}):{}}return Ev=b,Ev}var Av,vT;function EL(){if(vT)return Av;vT=1;var h=SL();function g(b,S){this.request=b,this.headers=S.headers,this.rawBody=S.body,this.statusCode=S.statusCode;try{this.body=JSON.parse(S.body||"{}")}catch{this.body=S.body}this.links=h(this.headers.link)}return g.prototype.hasNextPage=function(){return!!this.links.next},g.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},Av=g,Av}var Cv,bT;function j1(){return bT||(bT=1,Cv={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}),Cv}var Rv,wT;function AL(){if(wT)return Rv;wT=1;var h=j1();function g(b){var S=b.type||h.ERROR_HTTP,I;if(b.body)try{I=JSON.parse(b.body)}catch{I=b.body}else I=null;var N=b.message||null;N||(typeof I=="string"?N=I:I&&typeof I.message=="string"?N=I.message:S===h.ERROR_REQUEST_ABORTED&&(N="Request aborted")),this.message=N,this.type=S,this.statusCode=b.statusCode||null,this.request=b.request,this.body=I}return Rv=g,Rv}var Mv,TT;function CL(){if(TT)return Mv;TT=1;function h(b){var S=b.indexOf(":"),I=b.substring(0,S).trim().toLowerCase(),N=b.substring(S+1).trim();return{name:I,value:N}}function g(b){var S={};return b&&b.trim().split(/[\r|\n]+/).forEach(function(I){var N=h(I);S[N.name]=N.value}),S}return Mv=g,Mv}var Iv,ST;function RL(){if(ST)return Iv;ST=1;var h=EL(),g=AL(),b=j1(),S=CL(),I={};function N(oe){var pe=I[oe.id];pe&&(pe.abort(),delete I[oe.id])}function V(oe,pe){return new h(oe,{body:pe.response,headers:S(pe.getAllResponseHeaders()),statusCode:pe.status})}function s(oe){var pe=oe.total,ze=oe.loaded,le=100*ze/pe;return{total:pe,transferred:ze,percent:le}}function q(oe,pe){return new Promise(function(ze,le){pe.onprogress=function(ge){oe.emitter.emit(b.EVENT_PROGRESS_DOWNLOAD,s(ge))};var Se=oe.file;Se&&(pe.upload.onprogress=function(ge){oe.emitter.emit(b.EVENT_PROGRESS_UPLOAD,s(ge))}),pe.onerror=function(ge){le(ge)},pe.onabort=function(){var ge=new g({request:oe,type:b.ERROR_REQUEST_ABORTED});le(ge)},pe.onload=function(){if(delete I[oe.id],pe.status<200||pe.status>=400){var ge=new g({request:oe,body:pe.response,statusCode:pe.status});le(ge);return}ze(pe)};var te=oe.body;typeof te=="string"?pe.send(te):te?pe.send(JSON.stringify(te)):Se?pe.send(Se):pe.send(),I[oe.id]=pe}).then(function(ze){return V(oe,ze)})}function Z(oe,pe){var ze=oe.url(pe),le=new window.XMLHttpRequest;return le.open(oe.method,ze),Object.keys(oe.headers).forEach(function(Se){le.setRequestHeader(Se,oe.headers[Se])}),le}function Q(oe){return Promise.resolve().then(function(){var pe=Z(oe,oe.client.accessToken);return q(oe,pe)})}return Iv={browserAbort:N,sendRequestXhr:q,browserSend:Q,createRequestXhr:Z},Iv}var n0={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */var ML=n0.exports,ET;function IL(){return ET||(ET=1,function(h,g){(function(b){var S=g,I=h&&h.exports==S&&h,N=typeof mp=="object"&&mp;(N.global===N||N.window===N)&&(b=N);var V=function(le){this.message=le};V.prototype=new Error,V.prototype.name="InvalidCharacterError";var s=function(le){throw new V(le)},q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Z=/[\t\n\f\r ]/g,Q=function(le){le=String(le).replace(Z,"");var Se=le.length;Se%4==0&&(le=le.replace(/==?$/,""),Se=le.length),(Se%4==1||/[^+a-zA-Z0-9/]/.test(le))&&s("Invalid character: the string to be decoded is not correctly encoded.");for(var te=0,ge,xe,ye="",Pe=-1;++Pe<Se;)xe=q.indexOf(le.charAt(Pe)),ge=te%4?ge*64+xe:xe,te++%4&&(ye+=String.fromCharCode(255&ge>>(-2*te&6)));return ye},oe=function(le){le=String(le),/[^\0-\xFF]/.test(le)&&s("The string to be encoded contains characters outside of the Latin1 range.");for(var Se=le.length%3,te="",ge=-1,xe,ye,Pe,Ae,Ke=le.length-Se;++ge<Ke;)xe=le.charCodeAt(ge)<<16,ye=le.charCodeAt(++ge)<<8,Pe=le.charCodeAt(++ge),Ae=xe+ye+Pe,te+=q.charAt(Ae>>18&63)+q.charAt(Ae>>12&63)+q.charAt(Ae>>6&63)+q.charAt(Ae&63);return Se==2?(xe=le.charCodeAt(ge)<<8,ye=le.charCodeAt(++ge),Ae=xe+ye,te+=q.charAt(Ae>>10)+q.charAt(Ae>>4&63)+q.charAt(Ae<<2&63)+"="):Se==1&&(Ae=le.charCodeAt(ge),te+=q.charAt(Ae>>2)+q.charAt(Ae<<4&63)+"=="),te},pe={encode:oe,decode:Q,version:"0.1.0"};if(S&&!S.nodeType)if(I)I.exports=pe;else for(var ze in pe)pe.hasOwnProperty(ze)&&(S[ze]=pe[ze]);else b.base64=pe})(ML)}(n0,n0.exports)),n0.exports}var zv,AT;function l5(){if(AT)return zv;AT=1;var h=IL(),g={};function b(N){if(g[N])return g[N];var V=N.split("."),s=V[0],q=V[1];if(!q)throw new Error("Invalid token");var Z=S(q),Q={usage:s,user:Z.u};return I(Z,"a")&&(Q.authorization=Z.a),I(Z,"exp")&&(Q.expires=Z.exp*1e3),I(Z,"iat")&&(Q.created=Z.iat*1e3),I(Z,"scopes")&&(Q.scopes=Z.scopes),I(Z,"client")&&(Q.client=Z.client),I(Z,"ll")&&(Q.lastLogin=Z.ll),I(Z,"iu")&&(Q.impersonator=Z.iu),g[N]=Q,Q}function S(N){try{return JSON.parse(h.decode(N))}catch{throw new Error("Invalid token")}}function I(N,V){return Object.prototype.hasOwnProperty.call(N,V)}return zv=b,zv}var Dv={exports:{}},CT;function zL(){return CT||(CT=1,function(h){var g=Object.prototype.hasOwnProperty,b="~";function S(){}Object.create&&(S.prototype=Object.create(null),new S().__proto__||(b=!1));function I(q,Z,Q){this.fn=q,this.context=Z,this.once=Q||!1}function N(q,Z,Q,oe,pe){if(typeof Q!="function")throw new TypeError("The listener must be a function");var ze=new I(Q,oe||q,pe),le=b?b+Z:Z;return q._events[le]?q._events[le].fn?q._events[le]=[q._events[le],ze]:q._events[le].push(ze):(q._events[le]=ze,q._eventsCount++),q}function V(q,Z){--q._eventsCount===0?q._events=new S:delete q._events[Z]}function s(){this._events=new S,this._eventsCount=0}s.prototype.eventNames=function(){var Z=[],Q,oe;if(this._eventsCount===0)return Z;for(oe in Q=this._events)g.call(Q,oe)&&Z.push(b?oe.slice(1):oe);return Object.getOwnPropertySymbols?Z.concat(Object.getOwnPropertySymbols(Q)):Z},s.prototype.listeners=function(Z){var Q=b?b+Z:Z,oe=this._events[Q];if(!oe)return[];if(oe.fn)return[oe.fn];for(var pe=0,ze=oe.length,le=new Array(ze);pe<ze;pe++)le[pe]=oe[pe].fn;return le},s.prototype.listenerCount=function(Z){var Q=b?b+Z:Z,oe=this._events[Q];return oe?oe.fn?1:oe.length:0},s.prototype.emit=function(Z,Q,oe,pe,ze,le){var Se=b?b+Z:Z;if(!this._events[Se])return!1;var te=this._events[Se],ge=arguments.length,xe,ye;if(te.fn){switch(te.once&&this.removeListener(Z,te.fn,void 0,!0),ge){case 1:return te.fn.call(te.context),!0;case 2:return te.fn.call(te.context,Q),!0;case 3:return te.fn.call(te.context,Q,oe),!0;case 4:return te.fn.call(te.context,Q,oe,pe),!0;case 5:return te.fn.call(te.context,Q,oe,pe,ze),!0;case 6:return te.fn.call(te.context,Q,oe,pe,ze,le),!0}for(ye=1,xe=new Array(ge-1);ye<ge;ye++)xe[ye-1]=arguments[ye];te.fn.apply(te.context,xe)}else{var Pe=te.length,Ae;for(ye=0;ye<Pe;ye++)switch(te[ye].once&&this.removeListener(Z,te[ye].fn,void 0,!0),ge){case 1:te[ye].fn.call(te[ye].context);break;case 2:te[ye].fn.call(te[ye].context,Q);break;case 3:te[ye].fn.call(te[ye].context,Q,oe);break;case 4:te[ye].fn.call(te[ye].context,Q,oe,pe);break;default:if(!xe)for(Ae=1,xe=new Array(ge-1);Ae<ge;Ae++)xe[Ae-1]=arguments[Ae];te[ye].fn.apply(te[ye].context,xe)}}return!0},s.prototype.on=function(Z,Q,oe){return N(this,Z,Q,oe,!1)},s.prototype.once=function(Z,Q,oe){return N(this,Z,Q,oe,!0)},s.prototype.removeListener=function(Z,Q,oe,pe){var ze=b?b+Z:Z;if(!this._events[ze])return this;if(!Q)return V(this,ze),this;var le=this._events[ze];if(le.fn)le.fn===Q&&(!pe||le.once)&&(!oe||le.context===oe)&&V(this,ze);else{for(var Se=0,te=[],ge=le.length;Se<ge;Se++)(le[Se].fn!==Q||pe&&!le[Se].once||oe&&le[Se].context!==oe)&&te.push(le[Se]);te.length?this._events[ze]=te.length===1?te[0]:te:V(this,ze)}return this},s.prototype.removeAllListeners=function(Z){var Q;return Z?(Q=b?b+Z:Z,this._events[Q]&&V(this,Q)):(this._events=new S,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=b,s.EventEmitter=s,h.exports=s}(Dv)),Dv.exports}var Pv,RT;function DL(){if(RT)return Pv;RT=1;function h(V){return V.map(encodeURIComponent).join(",")}function g(V){return Array.isArray(V)?h(V):encodeURIComponent(String(V))}function b(V,s,q){if(q===!1||q===null)return V;var Z=/\?/.test(V)?"&":"?",Q=encodeURIComponent(s);return q!==void 0&&q!==""&&q!==!0&&(Q+="="+g(q)),""+V+Z+Q}function S(V,s){if(!s)return V;var q=V;return Object.keys(s).forEach(function(Z){var Q=s[Z];Q!==void 0&&(Array.isArray(Q)&&(Q=Q.filter(function(oe){return oe!=null}).join(",")),q=b(q,Z,Q))}),q}function I(V,s){if(!s||V.slice(0,4)==="http")return V;var q=V[0]==="/"?"":"/";return""+s.replace(/\/$/,"")+q+V}function N(V,s){return s?V.replace(/\/:([a-zA-Z0-9]+)/g,function(q,Z){var Q=s[Z];if(Q===void 0)throw new Error("Unspecified route parameter "+Z);var oe=g(Q);return"/"+oe}):V}return Pv={appendQueryObject:S,appendQueryParam:b,prependOrigin:I,interpolateRouteParams:N},Pv}var Lv,MT;function PL(){if(MT)return Lv;MT=1;var h=l5(),g=Zg(),b=zL(),S=DL(),I=j1(),N=1;function V(s,q){if(!s)throw new Error("MapiRequest requires a client");if(!q||!q.path||!q.method)throw new Error("MapiRequest requires an options object with path and method properties");var Z={};q.body&&(Z["content-type"]="application/json");var Q=g(Z,q.headers),oe=Object.keys(Q).reduce(function(pe,ze){return pe[ze.toLowerCase()]=Q[ze],pe},{});this.id=N++,this._options=q,this.emitter=new b,this.client=s,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=q.path,this.method=q.method,this.origin=q.origin||s.origin,this.query=q.query||{},this.params=q.params||{},this.body=q.body||null,this.file=q.file||null,this.encoding=q.encoding||"utf8",this.sendFileAs=q.sendFileAs||null,this.headers=oe}return V.prototype.url=function(q){var Z=S.prependOrigin(this.path,this.origin);Z=S.appendQueryObject(Z,this.query);var Q=this.params,oe=q??this.client.accessToken;if(oe){Z=S.appendQueryParam(Z,"access_token",oe);var pe=h(oe).user;Q=g({ownerId:pe},Q)}return Z=S.interpolateRouteParams(Z,Q),Z},V.prototype.send=function(){var q=this;if(q.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return q.sent=!0,q.client.sendRequest(q).then(function(Z){return q.response=Z,q.emitter.emit(I.EVENT_RESPONSE,Z),Z},function(Z){throw q.error=Z,q.emitter.emit(I.EVENT_ERROR,Z),Z})},V.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},V.prototype.eachPage=function(q){var Z=this;function Q(ze){function le(){delete Z._nextPageRequest;var Se=ze.nextPage();Se&&(Z._nextPageRequest=Se,pe(Se))}q(null,ze,le)}function oe(ze){q(ze,null,function(){})}function pe(ze){ze.send().then(Q,oe)}pe(this)},V.prototype.clone=function(){return this._extend()},V.prototype._extend=function(q){var Z=g(this._options,q);return new V(this.client,Z)},Lv=V,Lv}var Ov,IT;function c5(){if(IT)return Ov;IT=1;var h=l5(),g=PL(),b=j1();function S(I){if(!I||!I.accessToken)throw new Error("Cannot create a client without an access token");h(I.accessToken),this.accessToken=I.accessToken,this.origin=I.origin||b.API_ORIGIN}return S.prototype.createRequest=function(N){return new g(this,N)},Ov=S,Ov}var kv,zT;function u5(){if(zT)return kv;zT=1;var h=RL(),g=c5();function b(I){g.call(this,I)}b.prototype=Object.create(g.prototype),b.prototype.constructor=b,b.prototype.sendRequest=h.browserSend,b.prototype.abortRequest=h.browserAbort;function S(I){return new b(I)}return kv=S,kv}var Nv,DT;function LL(){if(DT)return Nv;DT=1;var h=u5();return Nv=h,Nv}var jv,PT;function OL(){if(PT)return jv;PT=1;var h=Object.prototype.toString;return jv=function(g){var b;return h.call(g)==="[object Object]"&&(b=Object.getPrototypeOf(g),b===null||b===Object.getPrototypeOf({}))},jv}var Bv,LT;function kL(){if(LT)return Bv;LT=1;var h=OL(),g=Zg(),b="value",S=`
  `,I={};I.assert=function(le,Se){return Se=Se||{},function(te){var ge=V(le,te);if(ge){var xe=s(ge,Se);throw Se.apiName&&(xe=Se.apiName+": "+xe),new Error(xe)}}},I.shape=function(Se){var te=ze(Se);return function(xe){var ye=V(I.plainObject,xe);if(ye)return ye;for(var Pe,Ae,Ke=[],it=0;it<te.length;it++)Pe=te[it].key,Ae=te[it].value,ye=V(Ae,xe[Pe]),ye&&Ke.push([Pe].concat(ye));return Ke.length<2?Ke[0]:function(rt){Ke=Ke.map(function(lt){var Jt=lt[0],wi=s(lt,rt).split(`
`).join(S);return"- "+Jt+": "+wi});var ut=rt.path.join("."),Lt=ut===b?"":" of "+ut;return"The following properties"+Lt+" have invalid values:"+S+Ke.join(S)}}},I.strictShape=function(Se){var te=I.shape(Se);return function(xe){var ye=te(xe);if(ye)return ye;var Pe=Object.keys(xe).reduce(function(Ae,Ke){return Se[Ke]===void 0&&Ae.push(Ke),Ae},[]);if(Pe.length!==0)return function(){return"The following keys are invalid: "+Pe.join(", ")}}},I.arrayOf=function(Se){return N(Se)},I.tuple=function(){var Se=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return N(Se)};function N(le){var Se=Array.isArray(le),te=function(ge){return Se?le[ge]:le};return function(xe){var ye=V(I.plainArray,xe);if(ye)return ye;if(Se&&xe.length!==le.length)return"an array with "+le.length+" items";for(var Pe=0;Pe<xe.length;Pe++)if(ye=V(te(Pe),xe[Pe]),ye)return[Pe].concat(ye)}}I.required=function(Se){function te(ge){return ge==null?function(xe){return oe(xe,pe(xe.path)?"cannot be undefined/null.":"is required.")}:Se.apply(this,arguments)}return te.__required=!0,te},I.oneOfType=function(){var Se=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(ge){var xe=Se.map(function(ye){return V(ye,ge)}).filter(Boolean);if(xe.length===Se.length)return xe.every(function(ye){return ye.length===1&&typeof ye[0]=="string"})?q(xe.map(function(ye){return ye[0]})):xe.reduce(function(ye,Pe){return Pe.length>ye.length?Pe:ye})}},I.equal=function(Se){return function(ge){if(ge!==Se)return JSON.stringify(Se)}},I.oneOf=function(){var Se=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),te=Se.map(function(ge){return I.equal(ge)});return I.oneOfType.apply(this,te)},I.range=function(Se){var te=Se[0],ge=Se[1];return function(ye){var Pe=V(I.number,ye);if(Pe||ye<te||ye>ge)return"number between "+te+" & "+ge+" (inclusive)"}},I.any=function(){},I.boolean=function(Se){if(typeof Se!="boolean")return"boolean"},I.number=function(Se){if(typeof Se!="number")return"number"},I.plainArray=function(Se){if(!Array.isArray(Se))return"array"},I.plainObject=function(Se){if(!h(Se))return"object"},I.string=function(Se){if(typeof Se!="string")return"string"},I.func=function(Se){if(typeof Se!="function")return"function"};function V(le,Se){if(!(Se==null&&!le.hasOwnProperty("__required"))){var te=le(Se);if(te)return Array.isArray(te)?te:[te]}}function s(le,Se){var te=le.length,ge=le[te-1],xe=le.slice(0,te-1);return xe.length===0&&(xe=[b]),Se=g(Se,{path:xe}),typeof ge=="function"?ge(Se):oe(Se,Z(ge))}function q(le){return le.length<2?le[0]:le.length===2?le.join(" or "):le.slice(0,-1).join(", ")+", or "+le.slice(-1)}function Z(le){return"must be "+Q(le)+"."}function Q(le){return/^an? /.test(le)?le:/^[aeiou]/i.test(le)?"an "+le:/^[a-z]/i.test(le)?"a "+le:le}function oe(le,Se){var te=pe(le.path),ge=le.path.join(".")+" "+Se,xe=te?"Item at position ":"";return xe+ge}function pe(le){return typeof le[le.length-1]=="number"||typeof le[0]=="number"}function ze(le){return Object.keys(le||{}).map(function(Se){return{key:Se,value:le[Se]}})}return I.validate=V,I.processMessage=s,Bv=I,Bv}var Fv,OT;function NL(){if(OT)return Fv;OT=1;var h=Zg(),g=kL();function b(V){if(typeof window<"u")return V instanceof mp.Blob||V instanceof mp.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof V=="string"||V.pipe!==void 0))return"Filename or Readable stream"}function S(V,s){return g.assert(g.strictShape(V),s)}function I(V){var s="date";if(typeof V=="boolean")return s;try{var q=new Date(V);if(q.getTime&&isNaN(q.getTime()))return s}catch{return s}}function N(V){return g.tuple(g.number,g.number)(V)}return Fv=h(g,{file:b,date:I,coordinates:N,assertShape:S}),Fv}var Uv,kT;function jL(){if(kT)return Uv;kT=1;function h(g,b){var S=function(I,N){return b.indexOf(I)!==-1&&N!==void 0};return typeof b=="function"&&(S=b),Object.keys(g).filter(function(I){return S(I,g[I])}).reduce(function(I,N){return I[N]=g[N],I},{})}return Uv=h,Uv}var Vv,NT;function BL(){if(NT)return Vv;NT=1;function h(g,b){return Object.keys(g).reduce(function(S,I){return S[I]=b(I,g[I]),S},{})}return Vv=h,Vv}var Hv,jT;function FL(){if(jT)return Hv;jT=1;var h=BL();function g(b){return h(b,function(S,I){return typeof I=="boolean"?JSON.stringify(I):I})}return Hv=g,Hv}var qv,BT;function UL(){if(BT)return qv;BT=1;var h=c5(),g=u5();function b(S){return function(I){var N;h.prototype.isPrototypeOf(I)?N=I:N=g(I);var V=Object.create(S);return V.client=N,V}}return qv=b,qv}var Gv,FT;function VL(){if(FT)return Gv;FT=1;var h=Zg(),g=NL(),b=jL(),S=FL(),I=UL(),N={},V=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];return N.forwardGeocode=function(s){g.assertShape({query:g.required(g.string),mode:g.oneOf("mapbox.places","mapbox.places-permanent"),countries:g.arrayOf(g.string),proximity:g.oneOf(g.coordinates,"ip"),types:g.arrayOf(g.oneOf(V)),autocomplete:g.boolean,bbox:g.arrayOf(g.number),limit:g.number,language:g.arrayOf(g.string),routing:g.boolean,fuzzyMatch:g.boolean,worldview:g.string,session_token:g.string})(s),s.mode=s.mode||"mapbox.places";var q=S(h({country:s.countries},b(s,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:b(s,["mode","query"]),query:q})},N.reverseGeocode=function(s){g.assertShape({query:g.required(g.coordinates),mode:g.oneOf("mapbox.places","mapbox.places-permanent"),countries:g.arrayOf(g.string),types:g.arrayOf(g.oneOf(V)),bbox:g.arrayOf(g.number),limit:g.number,language:g.arrayOf(g.string),reverseMode:g.oneOf("distance","score"),routing:g.boolean,worldview:g.string,session_token:g.string})(s),s.mode=s.mode||"mapbox.places";var q=S(h({country:s.countries},b(s,["country","types","bbox","limit","language","reverseMode","routing","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:b(s,["mode","query"]),query:q})},Gv=I(N),Gv}let HL="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",h5=h=>crypto.getRandomValues(new Uint8Array(h)),d5=(h,g,b)=>{let S=(2<<Math.log(h.length-1)/Math.LN2)-1,I=-~(1.6*S*g/h.length);return(N=g)=>{let V="";for(;;){let s=b(I),q=I|0;for(;q--;)if(V+=h[s[q]&S]||"",V.length===N)return V}}},qL=(h,g=21)=>d5(h,g,h5),GL=(h=21)=>crypto.getRandomValues(new Uint8Array(h)).reduce((g,b)=>(b&=63,b<36?g+=b.toString(36):b<62?g+=(b-26).toString(36).toUpperCase():b>62?g+="-":g+="_",g),"");const $L=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:qL,customRandom:d5,nanoid:GL,random:h5,urlAlphabet:HL},Symbol.toStringTag,{value:"Module"})),ZL=rC($L);var $v,UT;function WL(){if(UT)return $v;UT=1;var h=ZL.nanoid;function g(b){this.origin=b.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=b.accessToken,this.version="0.3.0",this.pluginSessionID=this.generateSessionID(),this.sessionIncrementer=0,this.userAgent=this.getUserAgent(),this.options=b,this.send=this.send.bind(this),this.countries=b.countries?b.countries.split(","):null,this.types=b.types?b.types.split(","):null,this.bbox=b.bbox?b.bbox:null,this.language=b.language?b.language.split(","):null,this.limit=b.limit?+b.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(b),this.eventQueue=new Array,this.flushInterval=b.flushInterval||1e3,this.maxQueueSize=b.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}return g.prototype={select:function(b,S){var I=this.getEventPayload("search.select",S,{selectedFeature:b});if(I&&!(I.resultIndex===this.lastSentIndex&&I.queryString===this.lastSentInput||I.resultIndex==-1))return this.lastSentIndex=I.resultIndex,this.lastSentInput=I.queryString,this.push(I)},start:function(b){var S=this.getEventPayload("search.start",b);if(S)return this.push(S)},keyevent:function(b,S){if(b.key&&!(b.metaKey||[9,27,37,39,13,38,40].indexOf(b.keyCode)!==-1)){var I=this.getEventPayload("search.keystroke",S,{key:b.key});if(I)return this.push(I)}},send:function(b,S){if(!this.enableEventLogging)return S?S():void 0;var I=this.getRequestOptions(b);this.request(I,(function(N){if(N)return this.handleError(N,S);if(S)return S()}).bind(this))},getRequestOptions:function(b){Array.isArray(b)||(b=[b]);var S={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(b)};return S},getEventPayload:function(b,S,I={}){if(b==="search.select"&&!I.selectedFeature||b==="search.keystroke"&&!I.key)return null;var N;if(!S.options.proximity)N=null;else if(typeof S.options.proximity=="object")N=[S.options.proximity.longitude,S.options.proximity.latitude];else if(S.options.proximity==="ip"){var V=S._headers?S._headers["ip-proximity"]:null;V&&typeof V=="string"?N=V.split(",").map(parseFloat):N=[999,999]}else N=S.options.proximity;var s=S._map?S._map.getZoom():void 0,q={event:b,version:this.getEventSchemaVersion(b),created:+new Date,sessionIdentifier:this.getSessionId(),country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:S.options.autocomplete,fuzzyMatch:S.options.fuzzyMatch,proximity:N,limit:S.options.limit,routing:S.options.routing,worldview:S.options.worldview,mapZoom:s,keyboardLocale:this.locale};if(b==="search.select"?q.queryString=S.inputString:b!="search.select"&&S._inputEl?q.queryString=S._inputEl.value:q.queryString=S.inputString,["search.keystroke","search.select"].includes(b)&&(q.path="geocoding/v5/mapbox.places"),b==="search.keystroke"&&I.key)q.lastAction=I.key;else if(b==="search.select"&&I.selectedFeature){var Z=I.selectedFeature,Q=this.getSelectedIndex(Z,S);if(q.resultIndex=Q,q.resultPlaceName=Z.place_name,q.resultId=Z.id,Z.properties&&(q.resultMapboxId=Z.properties.mapbox_id),S._typeahead){var oe=S._typeahead.data;oe&&oe.length>0&&(q.suggestionIds=this.getSuggestionIds(oe),q.suggestionNames=this.getSuggestionNames(oe),q.suggestionTypes=this.getSuggestionTypes(oe),q.suggestionSources=this.getSuggestionSources(oe))}}return this.validatePayload(q)?q:null},request:function(b,S){var I=new XMLHttpRequest;I.onreadystatechange=function(){if(this.readyState==4)return this.status==204?S(null):S(this.statusText)},I.open(b.method,b.host+"/"+b.path,!0);for(var N in b.headers){var V=b.headers[N];I.setRequestHeader(N,V)}I.send(b.body)},handleError:function(b,S){if(S)return S(b)},generateSessionID:function(){return h()},getSessionId:function(){return this.pluginSessionID+"."+this.sessionIncrementer},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(b,S){if(S._typeahead){var I=S._typeahead.data,N=b.id,V=I.map(function(q){return q.id}),s=V.indexOf(N);return s}},getSuggestionIds:function(b){return b.map(function(S){return S.properties?S.properties.mapbox_id||"":S.id||""})},getSuggestionNames:function(b){return b.map(function(S){return S.place_name||""})},getSuggestionTypes:function(b){return b.map(function(S){return S.place_type&&Array.isArray(S.place_type)&&S.place_type[0]||""})},getSuggestionSources:function(b){return b.map(function(S){return S._source||""})},getEventSchemaVersion:function(b){return["search.keystroke","search.select"].includes(b)?"2.2":"2.0"},validatePayload:function(b){if(!b||!b.event)return!1;var S=["event","created","sessionIdentifier","queryString"],I=["event","created","sessionIdentifier","queryString","lastAction"],N=["event","created","sessionIdentifier","queryString","resultIndex","path","suggestionIds"],V=b.event;return V==="search.start"?this.objectHasRequiredProps(b,S):V==="search.keystroke"?this.objectHasRequiredProps(b,I):V==="search.select"?this.objectHasRequiredProps(b,N):!0},objectHasRequiredProps:function(b,S){return S.every(function(I){return I==="queryString"?typeof b[I]=="string"&&b[I].length>0:b[I]!==void 0})},shouldEnableLogging:function(b){return!(b.enableEventLogging===!1||b.origin&&b.origin!=="https://api.mapbox.com")},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(b,S){this.eventQueue.push(b),(this.eventQueue.length>=this.maxQueueSize||S)&&this.flush()},remove:function(){this.flush()}},$v=g,$v}var Zv,VT;function XL(){if(VT)return Zv;VT=1;var h={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""};return Zv={placeholder:h},Zv}var Xy={exports:{}},YL=Xy.exports,HT;function KL(){return HT||(HT=1,function(h){(function(g,b,S){h.exports?h.exports=S():g[b]=S()})(YL,"subtag",function(){var g="",b=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function S(q){return q.match(b)||[]}function I(q){return S(q).filter(function(Z,Q){return Z&&Q})}function N(q){return q=S(q),{language:q[1]||g,extlang:q[2]||g,script:q[3]||g,region:q[4]||g}}function V(q,Z,Q){Object.defineProperty(q,Z,{value:Q,enumerable:!0})}function s(q,Z,Q){function oe(pe){return S(pe)[q]||g}V(oe,"pattern",Z),V(N,Q,oe)}return s(1,/^[a-zA-Z]{2,3}$/,"language"),s(2,/^[a-zA-Z]{3}$/,"extlang"),s(3,/^[a-zA-Z]{4}$/,"script"),s(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),V(N,"split",I),N})}(Xy)),Xy.exports}var Wv,qT;function JL(){if(qT)return Wv;qT=1;function h(){}return h.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const g={enableHighAccuracy:!0};return new Promise(function(b,S){window.navigator.geolocation.getCurrentPosition(b,S,g)})}},Wv=h,Wv}var Xv,GT;function QL(){if(GT)return Xv;GT=1;function h(S,I){const N=g(S),V=["address","street","place","country"];var s;if(typeof I=="function")return I(N);const q=V.indexOf(I);return q===-1?s=V:s=V.slice(q),s.reduce(function(Z,Q){return N[Q]?(Z!==""&&(Z=Z+", "),Z+N[Q]):Z},"")}function g(S){const I=S.address||"",N=S.text||"",V=S.place_name||"",q={address:V.split(",")[0],houseNumber:I,street:N,placeName:V};return S.context.forEach(function(Z){const Q=Z.id.split(".")[0];q[Q]=Z.text}),q}return Xv={transformFeatureToGeolocationText:h,getAddressInfo:g,REVERSE_GEOCODE_COORD_RGX:/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/},Xv}var Yv,$T;function eO(){if($T)return Yv;$T=1;var h=vL(),g=bL(),b=Zg(),S=wL().EventEmitter,I=TL(),N=LL(),V=VL(),s=WL(),q=XL(),Z=KL(),Q=JL(),oe=QL();const pe={FORWARD:0,LOCAL:1,REVERSE:2};function ze(){var te=document.createElement("div");return te.className="mapboxgl-ctrl-geocoder--powered-by",te.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',te}function le(te){this._eventEmitter=new S,this.options=b({},this.options,te),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Q}function Se(te){return te?String(te).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}return le.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",useBrowserFocus:!1,getItemValue:function(te){return te.place_name},render:function(te){var ge=Se(te.place_name).split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+ge[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+ge.splice(1,ge.length).join(",")+"</div></div>"}},_headers:{},addTo:function(te){function ge(xe,ye){if(!document.body.contains(ye))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const Pe=xe.onAdd();ye.appendChild(Pe)}if(te._controlContainer)te.addControl(this);else if(te instanceof HTMLElement)ge(this,te);else if(typeof te=="string"){const xe=document.querySelectorAll(te);if(xe.length===0)throw new Error("Element ",te,"not found.");if(xe.length>1)throw new Error("Geocoder can only be added to a single html element");ge(this,xe[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(te){if(te&&typeof te!="string"&&(this._map=te),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=V(N({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new s(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this),this._onSuggestionItemFocus=this._onSuggestionItemFocus.bind(this),this._onSuggestionItemKeyDown=this._onSuggestionItemKeydown.bind(this);var ge=this.container=document.createElement("div");ge.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var xe=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",g(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(Jt){this.eventManager.keyevent(Jt,this)}).bind(this));var ye=document.createElement("div");ye.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var Pe=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(Pe),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),ye.appendChild(this._clearEl),ye.appendChild(this._loadingEl),ge.appendChild(xe),ge.appendChild(this._inputEl),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var Ae=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(Ae),ye.appendChild(this._geolocateEl),this._showGeolocateButton()}var Ke=this._typeahead=new h(this._inputEl,[],{hideOnBlur:!this.options.useBrowserFocus,filter:!1,minLength:this.options.minLength,limit:this.options.limit});ge.insertBefore(ye,Ke.list.wrapper),this.setRenderFunction(this.options.render),Ke.getItemValue=this.options.getItemValue;const it=this._typeahead.handleKeyDown.bind(this._typeahead),rt=this._typeahead.handleKeyUp.bind(this._typeahead);this._typeahead.handleKeyUp,this.options.useBrowserFocus&&(this._typeahead.handleKeyDown=(function(Jt){if(!(Jt.keyCode===9&&!Ke.list.isEmpty())){if(Jt.keyCode===40){this._typeahead.list.active=0,this._typeahead.list.element.querySelectorAll("li").forEach(function(wi){wi.classList.remove("active")}),this._typeahead.list.element.querySelectorAll("li")[0].classList.add("active"),this._typeahead.list.element.querySelectorAll("li")[0].focus();return}else if(Jt.keyCode===38){this._typeahead.list.active=Ke.list.items.length-1,this._typeahead.list.element.querySelectorAll("li").forEach(function(wi){wi.classList.remove("active")}),this._typeahead.list.element.querySelectorAll("li")[this._typeahead.list.active].classList.add("active"),this._typeahead.list.element.querySelectorAll("li")[this._typeahead.list.active].focus();return}it(Jt)}}).bind(this),this._typeahead.handleKeyUp=function(Jt){if(Jt&&Jt.keyCode===16){Jt.preventDefault();return}rt(Jt)});var ut=Ke.list.draw,Lt=this._footerNode=ze(),lt=this;return Ke.list.draw=function(){lt.options.useBrowserFocus&&Ke.list.element.querySelectorAll("li").forEach(function(Jt){Jt.removeEventListener("focus",lt._onSuggestionItemFocus),Jt.removeEventListener("keydown",lt._onSuggestionItemKeyDown)}),ut.call(this),lt.options.useBrowserFocus&&Ke.list.element.querySelectorAll("li").forEach((function(Jt,wi){wi===0&&Jt.focus(),Jt.setAttribute("data-index",wi),Jt.tabIndex=0,Jt.addEventListener("focus",this._onSuggestionItemFocus),Jt.addEventListener("keydown",this._onSuggestionItemKeyDown)}).bind(lt)),Lt.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),Lt.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(Lt)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),ge},_onSuggestionItemKeydown(te){const ge=te.keyCode;if(ge!==9){if(ge===13){te.preventDefault();const xe=this._typeahead.list.element.querySelector(".active");if(xe){const ye=xe.getAttribute("data-index"),Pe=this._typeahead.list.items[ye];Pe&&(this._typeahead.value(Pe.original),this._typeahead.list.hide())}}else if(ge===38||ge===40){const xe=this._typeahead.list.element.querySelectorAll("li");if(xe.length>0){if(ge===38)if(this._typeahead.list.active>0)te.preventDefault(),this._typeahead.list.active--;else{this._typeahead.el.focus();return}else if(ge===40)if(te.preventDefault(),this._typeahead.list.active<xe.length-1)this._typeahead.list.active++;else return;xe.forEach(function(Pe){Pe.classList.remove("active")});const ye=xe[this._typeahead.list.active];ye&&(ye.classList.add("active"),ye.focus())}}}},_onSuggestionItemFocus(te){this._typeahead.list.active=te.target.getAttribute("data-index"),this._typeahead.list.element.querySelectorAll("li").forEach(function(ge){ge.classList.remove("active")}),te.target.classList.add("active")},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(te){this._hideLoadingIcon();const ge={geometry:{type:"Point",coordinates:[te.coords.longitude,te.coords.latitude]}};this._handleMarker(ge),this._fly(ge),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(ge),this._showClearButton(),this.fresh=!1;const xe={limit:1,language:[this.options.language],query:ge.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const ye=ge.geometry.coordinates[0]+","+ge.geometry.coordinates[1];this._setInputValue(ye),this._eventEmitter.emit("result",{result:ge})}else this.geocoderService.reverseGeocode(xe).send().then((function(ye){const Pe=ye.body.features[0];if(Pe){const Ae=oe.transformFeatureToGeolocationText(Pe,this.options.addressAccuracy);this._setInputValue(Ae),Pe.user_coordinates=ge.geometry.coordinates,this._eventEmitter.emit("result",{result:Pe})}else this._eventEmitter.emit("result",{result:{user_coordinates:ge.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(te){te.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(te,ge){var xe=document.createElementNS("http://www.w3.org/2000/svg","svg");return xe.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+te),xe.setAttribute("viewBox","0 0 18 18"),xe.setAttribute("xml:space","preserve"),xe.setAttribute("width",18),xe.setAttribute("height",18),xe.innerHTML=ge,xe},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(te){this._inputEl.value=te,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(te){var ge=(te.clipboardData||window.clipboardData).getData("text");ge.length>=this.options.minLength&&this._geocode(ge)},_onKeyDown:function(te){var ge=27,xe=9;if(te.keyCode===ge&&this.options.clearAndBlurOnEsc)return this._clear(te),this._inputEl.blur();var ye=te.target&&te.target.shadowRoot?te.target.shadowRoot.activeElement:te.target,Pe=ye?ye.value:"";if(!Pe)return this.fresh=!0,te.keyCode!==xe&&this.clear(te),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(te.metaKey||[xe,ge,37,39,13,38,40].indexOf(te.keyCode)!==-1)&&ye.value.length>=this.options.minLength&&this._geocode(ye.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(te){this.options.clearOnBlur&&this._clearOnBlur(te),this.options.collapsed&&this._collapse()},_onChange:function(){var te=this._typeahead.selected;te&&JSON.stringify(te)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(te),this.options.marker&&this._mapboxgl&&this._handleMarker(te),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(te),this._eventEmitter.emit("result",{result:te}),this.eventManager.select(te,this))},_fly:function(te){var ge;if(te.properties&&I[te.properties.short_code])ge=b({},this.options.flyTo),this._map&&this._map.fitBounds(I[te.properties.short_code].bbox,ge);else if(te.bbox){var xe=te.bbox;ge=b({},this.options.flyTo),this._map&&this._map.fitBounds([[xe[0],xe[1]],[xe[2],xe[3]]],ge)}else{var ye={zoom:this.options.zoom};ge=b({},ye,this.options.flyTo),te.center?ge.center=te.center:te.geometry&&te.geometry.type&&te.geometry.type==="Point"&&te.geometry.coordinates&&(ge.center=te.geometry.coordinates),this._map&&this._map.flyTo(ge)}},_requestType:function(te,ge){var xe;return te.localGeocoderOnly?xe=pe.LOCAL:te.reverseGeocode&&oe.REVERSE_GEOCODE_COORD_RGX.test(ge)?xe=pe.REVERSE:xe=pe.FORWARD,xe},_setupConfig:function(te,ge){const xe=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],ye=/[\s,]+/;var Pe=this,Ae=xe.reduce(function(it,rt){if(Pe.options[rt]===void 0||Pe.options[rt]===null)return it;["countries","types","language"].indexOf(rt)>-1?it[rt]=Pe.options[rt].split(ye):it[rt]=Pe.options[rt];const ut=typeof Pe.options[rt].longitude=="number"&&typeof Pe.options[rt].latitude=="number";if(rt==="proximity"&&ut){const Lt=Pe.options[rt].longitude,lt=Pe.options[rt].latitude;it[rt]=[Lt,lt]}return it},{});switch(te){case pe.REVERSE:{var Ke=ge.split(ye).map(function(it){return parseFloat(it,10)});Pe.options.flipCoordinates||Ke.reverse(),Ae.types&&Ae.types[0],Ae=b(Ae,{query:Ke,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(it){it in Ae&&delete Ae[it]})}break;case pe.FORWARD:{const it=ge.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(it)&&(ge=ge.replace(/,/g," ")),Ae=b(Ae,{query:ge})}break}return Ae.session_token=this.eventManager.getSessionId(),Ae},_geocode:function(te){this.inputString=te,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:te});const ge=this._requestType(this.options,te),xe=this._setupConfig(ge,te);var ye;switch(ge){case pe.LOCAL:ye=Promise.resolve();break;case pe.FORWARD:ye=this.geocoderService.forwardGeocode(xe).send();break;case pe.REVERSE:ye=this.geocoderService.reverseGeocode(xe).send();break}var Pe=this.options.localGeocoder?this.options.localGeocoder(te)||[]:[],Ae=[],Ke=null;return ye.catch((function(it){Ke=it}).bind(this)).then((function(it){this._hideLoadingIcon();var rt={};return it?it.statusCode=="200"&&(rt=it.body,rt.request=it.request,rt.headers=it.headers,this._headers=it.headers):rt={type:"FeatureCollection",features:[]},rt.config=xe,this.fresh&&(this.eventManager.start(this),this.fresh=!1),rt.features&&rt.features.length&&rt.features.map(function(ut){ut._source="mapbox"}),rt.features=rt.features?Pe.concat(rt.features):Pe,this.options.externalGeocoder?(Ae=this.options.externalGeocoder(te,rt.features)||Promise.resolve([]),Ae.then(function(ut){return rt.features=rt.features?ut.concat(rt.features):ut,rt},function(){return rt})):rt}).bind(this)).then((function(it){if(Ke)throw Ke;this.options.filter&&it.features.length&&(it.features=it.features.filter(this.options.filter)),it.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",it),this._typeahead.update(it.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",it))}).bind(this)).catch((function(it){this._hideLoadingIcon(),this._hideAttribution(),Pe.length&&this.options.localGeocoder||Ae.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(Pe)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:Pe}),this._eventEmitter.emit("error",{error:it})}).bind(this)),ye},_clear:function(te){te&&te.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this.eventManager.sessionIncrementer++,this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(te){this._clear(te),this._inputEl.focus(),this.options.useBrowserFocus&&this._typeahead.list.hide()},_clearOnBlur:function(te){var ge=this;te.relatedTarget&&ge._clear(te)},_onQueryResult:function(te){var ge=te.body;if(ge.features.length){var xe=ge.features[0];this._typeahead.selected=xe,this._inputEl.value=xe.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var te=this._map.getCenter().wrap();this.setProximity({longitude:te.lng,latitude:te.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(te){return this._geocode(te).then(this._onQueryResult),this},_renderError:function(){var te="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(te)},_renderLocationError:function(){var te="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(te)},_renderNoResults:function(){var te="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(te)},_renderUserDeniedGeolocationError:function(){var te="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(te)},_renderMessage:function(te){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(te)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var te=this.options.language.split(",")[0],ge=Z.language(te),xe=q.placeholder[ge];if(xe)return xe}return"Search"},setInput:function(te,ge){return ge===void 0&&(ge=!1),this._inputEl.value=te,this._typeahead.selected=null,this._typeahead.clear(),te.length>=this.options.minLength&&(ge?this._geocode(te):this._onChange()),this},setProximity:function(te,ge=!0){return this.options.proximity=te,ge&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(te){return te&&typeof te=="function"&&(this._typeahead.render=te),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(te){var ge=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=te||this.options.language||ge,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(te){return this.options.zoom=te,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(te){return this.options.flyTo=te,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(te){return this.options.placeholder=te||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(te){return this.options.bbox=te,this},getCountries:function(){return this.options.countries},setCountries:function(te){return this.options.countries=te,this},getTypes:function(){return this.options.types},setTypes:function(te){return this.options.types=te,this},getMinLength:function(){return this.options.minLength},setMinLength:function(te){return this.options.minLength=te,this._typeahead&&(this._typeahead.options.minLength=te),this},getLimit:function(){return this.options.limit},setLimit:function(te){return this.options.limit=te,this._typeahead&&(this._typeahead.options.limit=te),this},getFilter:function(){return this.options.filter},setFilter:function(te){return this.options.filter=te,this},setOrigin:function(te){return this.options.origin=te,this.geocoderService=V(N({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(te){return this.options.accessToken=te,this.geocoderService=V(N({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(te){return this.options.autocomplete=te,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(te){return this.options.fuzzyMatch=te,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(te){return this.options.routing=te,this},getRouting:function(){return this.options.routing},setWorldview:function(te){return this.options.worldview=te,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(te){if(this._map){this._removeMarker();var ge={color:"#4668F2"},xe=b({},ge,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(xe),te.center?this.mapMarker.setLngLat(te.center).addTo(this._map):te.geometry&&te.geometry.type&&te.geometry.type==="Point"&&te.geometry.coordinates&&this.mapMarker.setLngLat(te.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(te,ge){return this._eventEmitter.on(te,ge),this},off:function(te,ge){return this._eventEmitter.removeListener(te,ge),this.eventManager.remove(),this}},Yv=le,Yv}eO();const ZT=void 0;function f5(){vc("Route Planner - Navigation Tool");const[h,g]=he.useState([{address:"",coordinates:null}]),[b,S]=he.useState(!1),[I,N]=he.useState([]),[V,s]=he.useState(null),[q,Z]=he.useState([]),[Q,oe]=he.useState(!1),[pe,ze]=he.useState(null),[le,Se]=he.useState(null),te=he.useRef(null);he.useRef([]);const ge=he.useRef([]),xe=()=>g(lt=>[...lt,{address:"",coordinates:null}]),ye=lt=>g(Jt=>Jt.filter((wi,Fi)=>Fi!==lt)),Pe=(lt,Jt,wi=null)=>{g(Fi=>Fi.map((Bi,Wt)=>Wt===lt?{address:Jt,coordinates:wi}:Bi))};he.useEffect(()=>{{console.warn("Mapbox access token not found. Please set VITE_MAPBOX_ACCESS_TOKEN in your environment variables."),Se("Mapbox access token not configured");return}},[]),he.useEffect(()=>{if(!(!Q||!te.current||pe)){try{const lt=new e0.Map({container:te.current,style:"mapbox://styles/mapbox/streets-v12",center:[77.209,28.6139],zoom:11,attributionControl:!1});lt.on("load",()=>{console.log("Map loaded successfully"),ze(lt),Se(null),lt.addControl(new e0.NavigationControl,"top-right"),lt.addControl(new e0.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0}),"top-right")}),lt.on("error",Jt=>{console.error("Map error:",Jt),Se("Map failed to load. Please check your internet connection.")}),lt.on("style.load",()=>{console.log("Map style loaded successfully")}),lt.on("style.error",Jt=>{console.error("Map style error:",Jt),Se("Map style failed to load")})}catch(lt){console.error("Error creating map:",lt),Se("Failed to create map instance")}return()=>{pe&&(pe.remove(),ze(null))}}},[Q]);const Ae=he.useCallback(()=>{ge.current.forEach(lt=>{lt&&lt.remove()}),ge.current=[]},[]),Ke=he.useCallback(()=>{!pe||!pe.isStyleLoaded()||(Ae(),h.forEach((lt,Jt)=>{if(lt.coordinates){const wi=new e0.Marker({color:Jt===0?"#10b981":Jt===h.length-1?"#ef4444":"#3b82f6"}).setLngLat(lt.coordinates).addTo(pe);ge.current.push(wi)}}))},[pe,h,Ae]);he.useEffect(()=>{pe&&pe.isStyleLoaded()&&Ke()},[pe,h,Ke]);const it=()=>{const lt=h.map(wi=>wi.address.trim()).filter(Boolean),Jt=new Date;return lt.map((wi,Fi)=>({addr:wi,eta:new Date(Jt.getTime()+Fi*20*6e4)}))},rt=async()=>{const lt=h.filter(Jt=>Jt.address.trim()&&Jt.coordinates);if(lt.length<2){hi.error("Please add at least 2 valid addresses with coordinates");return}if(!pe||!pe.isStyleLoaded()){hi.error("Map is not ready. Please wait for the map to load.");return}S(!0);try{const Jt=lt.map(Bi=>Bi.coordinates).join(";"),wi=await fetch(`https://api.mapbox.com/directions/v5/mapbox/driving/${Jt}?geometries=geojson&overview=full&steps=true&access_token=${ZT}`);if(!wi.ok)throw new Error(`HTTP error! status: ${wi.status}`);const Fi=await wi.json();if(Fi.routes&&Fi.routes.length>0){const Bi=Fi.routes[0];try{pe.getSource("route")&&(pe.getLayer("route")&&pe.removeLayer("route"),pe.removeSource("route"))}catch(Qe){console.warn("Error removing existing route:",Qe)}pe.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:Bi.geometry}}),pe.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3b82f6","line-width":4,"line-opacity":.8}});const Wt=Fi.waypoints||[],ki=Date.now();let Ui=0;const Cn=lt.map((Qe,Ft)=>{var Di;if(Ft>0){const Zi=((Di=Bi.legs[Ft-1])==null?void 0:Di.duration)*1e3||0;Ui+=Zi}return{addr:Qe.address,eta:new Date(ki+Ui),coordinates:Qe.coordinates}});if(N(Cn),Bi.geometry.coordinates.length>0){const Qe=Bi.geometry.coordinates.reduce((Ft,Di)=>Ft.extend(Di),new e0.LngLatBounds(Bi.geometry.coordinates[0],Bi.geometry.coordinates[0]));pe.fitBounds(Qe,{padding:50})}hi.success("Route planned successfully!")}else throw new Error("No routes found")}catch(Jt){console.error("Route planning failed:",Jt),hi.error("Route planning failed. Showing approximate itinerary."),N(it())}finally{S(!1)}},ut=he.useCallback(async(lt,Jt)=>{if(Pe(lt,Jt),!Jt||Jt.length<3){Z(wi=>{const Fi=[...wi];return Fi[lt]=[],Fi});return}try{const wi=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(Jt)}.json?country=in&types=address,poi&limit=5&access_token=${ZT}`);if(wi.ok){const Fi=await wi.json();Z(Bi=>{const Wt=[...Bi];return Wt[lt]=Fi.features||[],Wt})}}catch(wi){console.error("Geocoding error:",wi)}},[]),Lt=(lt,Jt)=>{Pe(lt,Jt.place_name,Jt.center),Z(wi=>{const Fi=[...wi];return Fi[lt]=[],Fi})};return x.jsxs("div",{className:"max-w-6xl mx-auto px-2 sm:px-4 py-6 sm:py-10",children:[x.jsxs("h1",{className:"text-2xl font-bold mb-6 flex items-center gap-2",children:[x.jsx(m2,{className:"text-blue-600"})," Property Visit Route Planner"]}),x.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[x.jsxs("div",{className:"bg-white rounded-xl shadow p-4 sm:p-5 space-y-3",children:[x.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Plan Your Route"}),h.map((lt,Jt)=>x.jsxs("div",{className:"flex flex-col gap-1 relative",children:[x.jsxs("div",{className:"flex gap-2",children:[x.jsxs("div",{className:"flex-1 relative",children:[x.jsx("input",{className:"w-full border rounded p-2 text-sm sm:text-base pr-8",value:lt.address,onChange:wi=>ut(Jt,wi.target.value),placeholder:`Stop ${Jt+1} address`}),lt.coordinates&&x.jsx(pI,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-green-500"})]}),h.length>1&&x.jsx("button",{onClick:()=>ye(Jt),className:"px-3 rounded bg-red-100 text-red-600 hover:bg-red-200 transition-colors",children:x.jsx(su,{})})]}),q[Jt]&&q[Jt].length>0&&x.jsx("ul",{className:"absolute z-10 top-full left-0 right-0 bg-white border border-gray-200 rounded shadow max-h-56 overflow-auto",children:q[Jt].map((wi,Fi)=>x.jsxs("li",{className:"px-3 py-2 text-sm hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",onMouseDown:()=>Lt(Jt,wi),children:[x.jsx("div",{className:"font-medium",children:wi.place_name}),wi.context&&x.jsx("div",{className:"text-xs text-gray-500",children:wi.context.map(Bi=>Bi.text).join(", ")})]},Fi))})]},Jt)),x.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 pt-2",children:[x.jsxs("button",{onClick:xe,className:"px-3 py-2 rounded bg-gray-100 hover:bg-gray-200 flex items-center gap-2 justify-center transition-colors",children:[x.jsx(tb,{})," Add Stop"]}),x.jsx("button",{onClick:rt,disabled:b||!pe||!pe.isStyleLoaded(),className:"px-4 py-2 rounded bg-gradient-to-r from-blue-600 to-purple-600 text-white disabled:opacity-60 hover:from-blue-700 hover:to-purple-700 transition-all",children:b?"Planning...":"Plan Route"})]})]}),x.jsx("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:x.jsx("div",{className:"h-64 sm:h-80 lg:h-96 flex items-center justify-center text-gray-500",children:x.jsxs("div",{className:"text-center",children:[x.jsx(m2,{className:"text-4xl mb-2 mx-auto"}),x.jsx("p",{children:"Tip: Set VITE_MAPBOX_ACCESS_TOKEN to enable interactive map and directions."})]})})})]}),I.length>0&&x.jsxs("div",{className:"mt-6 bg-white rounded-xl shadow p-5",children:[x.jsxs("h2",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[x.jsx(C1,{className:"text-blue-600"})," Visit Itinerary"]}),x.jsx("ol",{className:"space-y-3",children:I.map((lt,Jt)=>x.jsxs("li",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[x.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm ${Jt===0?"bg-green-500":Jt===I.length-1?"bg-red-500":"bg-blue-500"}`,children:Jt+1}),x.jsxs("div",{className:"flex-1",children:[x.jsx("div",{className:"font-medium text-gray-900",children:lt.addr}),x.jsxs("div",{className:"text-sm text-gray-500",children:["ETA: ",lt.eta.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]},Jt))}),x.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:x.jsxs("p",{className:"text-sm text-blue-800",children:[x.jsx("strong",{children:"Route optimized using Mapbox Directions API"})," - Real-time routing with traffic considerations."]})})]})]})}const tO=Object.freeze(Object.defineProperty({__proto__:null,default:f5},Symbol.toStringTag,{value:"Module"}));function iO(){return vc("Route Planner Admin - Navigation Management"),x.jsx(f5,{})}const WT=he.lazy(()=>Gn(()=>import("./PublicHome-DM5XTeVe.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),XT=he.lazy(()=>Gn(()=>import("./Home-DDOVir-n.js"),__vite__mapDeps([8,1,2,3,4,5,6,7]))),nO=he.lazy(()=>Gn(()=>import("./PublicAbout-DF_p1aZ-.js"),[])),rO=he.lazy(()=>Gn(()=>import("./About-JNj-ESpJ.js"),[])),sO=he.lazy(()=>Gn(()=>import("./PublicSearch-69IhuwzT.js"),__vite__mapDeps([9,4,5,10]))),aO=he.lazy(()=>Gn(()=>import("./Search-Cc1NfajN.js"),__vite__mapDeps([11,4,5,6,7,12,10]))),oO=he.lazy(()=>Gn(()=>import("./Profile-B42om_9p.js"),__vite__mapDeps([13,14]))),lO=he.lazy(()=>Gn(()=>import("./SignIn-CYsxHyDj.js"),__vite__mapDeps([15,16,14]))),cO=he.lazy(()=>Gn(()=>import("./SignUp-BM_rII5G.js"),__vite__mapDeps([17,16,14]))),uO=he.lazy(()=>Gn(()=>import("./ForgotPassword-Czo9hX3S.js"),__vite__mapDeps([18,14]))),hO=he.lazy(()=>Gn(()=>import("./CreateListing-JrCDPfvV.js"),__vite__mapDeps([19,12,10]))),dO=he.lazy(()=>Gn(()=>import("./EditListing-DhoeRaI5.js"),__vite__mapDeps([20,12,10]))),Kv=he.lazy(()=>Gn(()=>import("./Listing-EsAmA3kM.js"),__vite__mapDeps([21,1,22,23,5,24]))),fO=he.lazy(()=>Gn(()=>import("./WishList-D3vOeKZ-.js"),__vite__mapDeps([25,4,5]))),pO=he.lazy(()=>Gn(()=>import("./Watchlist-CnDGHM2r.js"),__vite__mapDeps([26,4,5]))),mO=he.lazy(()=>Gn(()=>import("./Appointment-BS9KmywZ.js"),__vite__mapDeps([27,28]))),gO=he.lazy(()=>Gn(()=>import("./AdminAppointments-C_aivUzU.js"),__vite__mapDeps([29,7,23,30]))),_O=he.lazy(()=>Gn(()=>import("./AdminDashboard-B9Qev4ff.js"),__vite__mapDeps([31,4,5,6,7]))),yO=he.lazy(()=>Gn(()=>import("./MyAppointments-DQ5sdelk.js"),__vite__mapDeps([32,7,23,30,28]))),xO=he.lazy(()=>Gn(()=>import("./MyListings-B_ZwwoYm.js"),__vite__mapDeps([33,5]))),vO=he.lazy(()=>Gn(()=>import("./AdminAbout-CcFP8YqT.js"),[])),bO=he.lazy(()=>Gn(()=>import("./AdminExplore-D6m__y_m.js"),__vite__mapDeps([34,4,5,6,7,12,10]))),wO=he.lazy(()=>Gn(()=>import("./AdminCreateListing-B7hVQC-e.js"),__vite__mapDeps([35,12,10]))),TO=he.lazy(()=>Gn(()=>import("./AdminProfile-CyMqJOgB.js"),__vite__mapDeps([36,13,14]))),SO=he.lazy(()=>Gn(()=>import("./AdminDeploymentManagement-BkfBDavL.js"),[])),EO=he.lazy(()=>Gn(()=>import("./AdminRequests-B-IzVIm3.js"),[])),AO=he.lazy(()=>Gn(()=>import("./AdminListings-DfqakGLo.js"),__vite__mapDeps([37,5]))),CO=he.lazy(()=>Gn(()=>import("./AdminMyListings-QMdkIv9f.js"),__vite__mapDeps([38,5]))),RO=he.lazy(()=>Gn(()=>import("./AdminEditListing-BlOulmo8.js"),__vite__mapDeps([39,12,10]))),MO=he.lazy(()=>Gn(()=>import("./Oauth-BSWlNrx8.js"),[])),IO=he.lazy(()=>Gn(()=>import("./AdminAppointmentListing-DgcS3NRL.js"),[])),zO=he.lazy(()=>Gn(()=>import("./AdminReviews-C2aVnisg.js"),[])),DO=he.lazy(()=>Gn(()=>import("./AdminServices-BTXmZRA5.js"),[])),PO=he.lazy(()=>Gn(()=>import("./OnDemandServices-BkGzZ_He.js"),[])),LO=he.lazy(()=>Gn(()=>Promise.resolve().then(()=>tO),void 0)),OO=he.lazy(()=>Gn(()=>import("./UserReviews-CEsZ0Cf5.js"),__vite__mapDeps([40,22]))),kO=he.lazy(()=>Gn(()=>import("./AdminFraudManagement-72VghFhH.js"),[])),NO=he.lazy(()=>Gn(()=>import("./PaymentDashboard-CIWUYa1_.js"),[])),jO=he.lazy(()=>Gn(()=>import("./AdminSecurityModeration-CzH9g9_z.js"),[])),BO=he.lazy(()=>Gn(()=>import("./MyPayments-DCLkZtAT.js"),[])),YT=he.lazy(()=>Gn(()=>import("./DeviceManagement-5X89RMlU.js"),[])),FO=he.lazy(()=>Gn(()=>import("./SessionManagement-BXhrCjZ4.js"),[])),UO=he.lazy(()=>Gn(()=>import("./SessionAuditLogs-BDJ3zxPV.js"),[])),VO=he.lazy(()=>Gn(()=>import("./Contact-DBKT3sjF.js"),__vite__mapDeps([41,0,1,2,3,4,5,6,7]))),HO=he.lazy(()=>Gn(()=>import("./UserContact-EZYElgyQ.js"),__vite__mapDeps([42,8,1,2,3,4,5,6,7]))),qO=he.lazy(()=>Gn(()=>import("./AdminSupport-B6q9DdFg.js"),__vite__mapDeps([43,31,4,5,6,7]))),GO=he.lazy(()=>Gn(()=>import("./PublicAI-CumC4PG8.js"),__vite__mapDeps([44,6,7,0,1,2,3,4,5]))),$O=he.lazy(()=>Gn(()=>import("./UserAI-WWOENtIT.js"),__vite__mapDeps([45,6,7,8,1,2,3,4,5]))),ZO=he.lazy(()=>Gn(()=>import("./AdminAI-CJsmysRg.js"),__vite__mapDeps([46,6,7,31,4,5]))),KT=()=>x.jsxs("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-100 via-purple-100 to-pink-100 animate-fade-in",children:[x.jsxs("div",{className:"relative flex flex-col items-center",children:[x.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-tr from-blue-500 via-purple-500 to-pink-500 animate-spin-slow shadow-2xl border-8 border-white/40 flex items-center justify-center",children:x.jsx(Bg,{className:"text-5xl text-yellow-400 drop-shadow-lg animate-bounce-slow",style:{filter:"drop-shadow(0 2px 8px #facc15)"}})}),x.jsxs("span",{className:"mt-8 text-3xl font-extrabold bg-gradient-to-r from-yellow-400 via-pink-500 to-purple-600 bg-clip-text text-transparent animate-gradient-x drop-shadow",children:["Urban ",x.jsx("span",{className:"bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 bg-clip-text text-transparent",children:"Setu"})]}),x.jsx("span",{className:"mt-2 text-xl font-bold text-purple-700 drop-shadow animate-fade-in-up",children:"Loading..."})]}),x.jsx("style",{children:`
      @keyframes spin-slow { 100% { transform: rotate(360deg); } }
      .animate-spin-slow { animation: spin-slow 2s linear infinite; }
      @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
      .animate-fade-in { animation: fade-in 0.7s ease; }
      @keyframes fade-in-up { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
      .animate-fade-in-up { animation: fade-in-up 0.8s ease; }
      @keyframes gradient-x { 0%,100%{background-position:0 50%}50%{background-position:100% 50%} }
      .animate-gradient-x { background-size: 200% 200%; animation: gradient-x 3s ease-in-out infinite; }
      @keyframes bounce-slow { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }
      .animate-bounce-slow { animation: bounce-slow 2s infinite; }
    `})]}),Yy="https://urbansetu.onrender.com";function WO(h,g){h.length>1&&h.endsWith("/")&&(h=h.slice(0,-1));const b=["about","search","terms","privacy","listing","home","reviews","wishlist","profile","appointment","explore","contact","ai"];function S(s){const q=s.match(/^\/(user|admin)?\/?([^\/]+)?(\/.*)?$/);return{prefix:q&&q[1]?q[1]:null,base:q&&q[2]?q[2]:null,rest:q&&q[3]?q[3]:""}}const{prefix:I,base:N,rest:V}=S(h);return g==="public"?(I==="user"||I==="admin")&&b.includes(N)?`/${N}${V}`:I==="user"&&!b.includes(N)||I==="admin"&&!b.includes(N)?null:h:g==="user"?!h.startsWith("/user")&&b.includes(N)?`/user/${N}${V}`:I==="admin"?b.includes(N)?`/user/${N}${V}`:null:h:g==="admin"?!h.startsWith("/admin")&&b.includes(N)?`/admin/${N}${V}`:I==="user"?b.includes(N)?`/admin/${N}${V}`:null:h:h}function XO({children:h}){const g=ko(),{currentUser:b}=fo(N=>N.user),S=b?b.role==="admin"||b.role==="rootadmin"?"admin":"user":"public",I=he.useMemo(()=>WO(g.pathname,S),[g.pathname,S]);return I===null?x.jsx(sf,{}):I!==g.pathname?x.jsx(Ml,{to:I,replace:!0}):h}function YO({bootstrapped:h}){const g=ko(),b=vp(),{currentUser:S,loading:I}=fo(pe=>pe.user),[N,V]=he.useState(!1),s=Pl(),{playNotification:q}=fL();he.useEffect(()=>{let le=null,Se=null,te=null;const ge=()=>{te&&clearTimeout(te),te=setTimeout(()=>{window.location.reload()},6e5)},xe=()=>{if(document.hidden)le=Date.now(),ge();else{if(le&&(Date.now()-le)/6e4>=10){const Ke=sessionStorage.getItem("has_visited")==="1";sessionStorage.setItem("has_visited","1"),Ke&&window.location.reload()}te&&clearTimeout(te)}},ye=()=>{if(Se&&(Date.now()-Se)/6e4>=10){const Ke=sessionStorage.getItem("has_visited")==="1";sessionStorage.setItem("has_visited","1"),Ke&&window.location.reload()}te&&clearTimeout(te)},Pe=()=>{Se=Date.now(),ge()};return document.addEventListener("visibilitychange",xe),window.addEventListener("focus",ye),window.addEventListener("blur",Pe),sessionStorage.getItem("has_visited")||sessionStorage.setItem("has_visited","1"),ge(),()=>{document.removeEventListener("visibilitychange",xe),window.removeEventListener("focus",ye),window.removeEventListener("blur",Pe),te&&clearTimeout(te)}},[]),he.useEffect(()=>{h&&(async()=>{b(eM());try{const ze=await fetch(`${Yy}/api/auth/verify`,{method:"GET",credentials:"include"}),le=await ze.json();ze.ok?b(tM(le)):(b(w4(le.message||"Session invalid")),b(Xa()))}catch{b(w4("Network error")),b(Xa())}finally{V(!0)}})()},[h,b]),he.useEffect(()=>{if(!S)return;const pe=te=>{te.userId===S._id&&(b(Xa()),hi.error("Your account has been suspended. You have been signed out."),setTimeout(()=>{s("/sign-in")},1800))};fn.on("account_suspended",pe);const ze=te=>{te.userId===S._id&&(b(Xa()),hi.error(te.message||"You have been signed out."),setTimeout(()=>{s("/sign-in")},1800))};fn.on("force_signout",ze);const le=te=>{var ge;(te.userId===S._id||((ge=te.user)==null?void 0:ge._id)===S._id)&&(te.type==="update"?b(updateUserSuccess(te.user)):te.type==="delete"?(b(Xa()),hi.error("Your account has been deleted. You have been signed out."),setTimeout(()=>{s("/sign-in")},1800)):te.type==="add"&&b(updateUserSuccess(te.user)))},Se=te=>{var ge;(te.adminId===S._id||((ge=te.admin)==null?void 0:ge._id)===S._id)&&(te.type==="update"?b(updateUserSuccess(te.admin)):te.type==="delete"?(b(Xa()),hi.error("Your admin account has been deleted. You have been signed out."),setTimeout(()=>{s("/sign-in")},1800)):te.type==="add"&&b(updateUserSuccess(te.admin)))};return fn.on("user_update",le),fn.on("admin_update",Se),()=>{fn.off("account_suspended",pe),fn.off("force_signout",ze),fn.off("user_update",le),fn.off("admin_update",Se)}},[b,s,S]);const[Z,Q]=he.useState(null);if(he.useEffect(()=>{const pe=le=>{Q(le.detail.appointmentId)},ze=()=>{Q(null)};return window.addEventListener("chatOpened",pe),window.addEventListener("chatClosed",ze),()=>{window.removeEventListener("chatOpened",pe),window.removeEventListener("chatClosed",ze)}},[]),he.useEffect(()=>{if(!S||S.role==="admin"||S.role==="rootadmin")return;const pe=async ze=>{if(ze.comment&&ze.comment.senderEmail!==S.email){const le=window.location.pathname,Se=le.includes("/my-appointments")||le.includes("/user/my-appointments");if(Z===ze.appointmentId)return;const ge=Array.isArray(ze.comment.reactions)&&ze.comment.reactions.length>0,xe=!!ze.messageId;if(ge||xe)return;let ye=ze.comment.senderEmail||"User";if(ze.comment.senderEmail!==ze.buyerEmail&&ze.comment.senderEmail!==ze.sellerEmail)ye="UrbanSetu";else try{const Ae=await fetch(`${Yy}/api/user/check-email/${encodeURIComponent(ze.comment.senderEmail)}`,{credentials:"include"});Ae.ok&&(ye=(await Ae.json()).username||ze.comment.senderEmail)}catch{ye=ze.comment.senderEmail}try{q()}catch{}Se?hi.info(`New message from ${ye}`,{onClick:()=>{window.dispatchEvent(new CustomEvent("openChatFromNotification",{detail:{appointmentId:ze.appointmentId,fromNotification:!0,preferUnread:!0}}))},autoClose:5e3,closeOnClick:!0,pauseOnHover:!1}):hi.info(`New message from ${ye}`,{onClick:()=>{s("/user/my-appointments",{state:{openChatForAppointment:ze.appointmentId,fromNotification:!0}})},autoClose:5e3,closeOnClick:!0,pauseOnHover:!1})}};return fn.on("commentUpdate",pe),()=>{fn.off("commentUpdate",pe)}},[b,s,S,q,Z]),he.useEffect(()=>{if(!S)return;const pe=setInterval(async()=>{try{const ze=await fetch(`${Yy}/api/auth/verify`,{credentials:"include"});if(ze.status===401)b(Xa()),s("/sign-in");else if(ze.status===403)try{const le=await ze.clone().json();le.message&&le.message.toLowerCase().includes("suspended")&&(b(Xa()),hi.error(le.message||"Your account has been suspended. You have been signed out."),s("/sign-in"))}catch{}}catch{}},3e4);return()=>clearInterval(pe)},[b,s,S]),!h||!N)return x.jsx(KT,{});const oe=["/appointments"];return x.jsxs(x.Fragment,{children:[x.jsx(eL,{}),!oe.includes(g.pathname)&&(S&&(S.role==="admin"||S.role==="rootadmin")?x.jsx(Oz,{}):x.jsx(Lz,{})),x.jsx(he.Suspense,{fallback:x.jsx(KT,{}),children:x.jsx(XO,{children:x.jsxs(lR,{children:[x.jsx(Wi,{path:"/",element:S?x.jsx(sf,{}):x.jsx(WT,{bootstrapped:h,sessionChecked:N})}),x.jsx(Wi,{path:"/home",element:S?x.jsx(sf,{}):x.jsx(WT,{bootstrapped:h,sessionChecked:N})}),x.jsx(Wi,{path:"/about",element:S?x.jsx(Ml,{to:"/user/about"}):x.jsx(nO,{bootstrapped:h,sessionChecked:N})}),x.jsx(Wi,{path:"/search",element:S?x.jsx(Ml,{to:"/user/search"}):x.jsx(sO,{bootstrapped:h,sessionChecked:N})}),x.jsx(Wi,{path:"/listing/:listingId",element:S?x.jsx(sf,{}):x.jsx(Kv,{})}),x.jsx(Wi,{path:"/sign-in",element:x.jsx(lO,{bootstrapped:h,sessionChecked:N})}),x.jsx(Wi,{path:"/sign-up",element:x.jsx(cO,{bootstrapped:h,sessionChecked:N})}),x.jsx(Wi,{path:"/forgot-password",element:x.jsx(uO,{bootstrapped:h,sessionChecked:N})}),x.jsx(Wi,{path:"/oauth",element:x.jsx(MO,{bootstrapped:h,sessionChecked:N})}),x.jsx(Wi,{path:"/terms",element:S?x.jsx(sf,{}):x.jsx(sL,{bootstrapped:h,sessionChecked:N})}),x.jsx(Wi,{path:"/privacy",element:S?x.jsx(sf,{}):x.jsx(aL,{bootstrapped:h,sessionChecked:N})}),x.jsx(Wi,{path:"/contact",element:S?x.jsx(Ml,{to:"/user/contact"}):x.jsx(VO,{})}),x.jsx(Wi,{path:"/ai",element:S?x.jsx(Ml,{to:"/user/ai"}):x.jsx(GO,{})}),x.jsx(Wi,{path:"/restore-account/:token",element:x.jsx(rL,{})}),x.jsxs(Wi,{element:x.jsx(Nz,{bootstrapped:h}),children:[x.jsx(Wi,{path:"/user",element:x.jsx(XT,{})}),x.jsx(Wi,{path:"/user/home",element:x.jsx(XT,{})}),x.jsx(Wi,{path:"/user/about",element:x.jsx(rO,{})}),x.jsx(Wi,{path:"/user/search",element:x.jsx(aO,{})}),x.jsx(Wi,{path:"/user/profile",element:x.jsx(oO,{})}),x.jsx(Wi,{path:"/user/create-listing",element:x.jsx(hO,{})}),x.jsx(Wi,{path:"/user/update-listing/:listingId",element:x.jsx(dO,{})}),x.jsx(Wi,{path:"/user/listing/:listingId",element:x.jsx(Kv,{},g.pathname)}),x.jsx(Wi,{path:"/user/wishlist",element:x.jsx(fO,{})}),x.jsx(Wi,{path:"/user/watchlist",element:x.jsx(pO,{})}),x.jsx(Wi,{path:"/user/appointment",element:x.jsx(mO,{})}),x.jsx(Wi,{path:"/user/my-appointments",element:x.jsx(yO,{})}),x.jsx(Wi,{path:"/user/my-payments",element:x.jsx(BO,{})}),x.jsx(Wi,{path:"/user/my-listings",element:x.jsx(xO,{})}),x.jsx(Wi,{path:"/user/services",element:x.jsx(PO,{})}),x.jsx(Wi,{path:"/user/route-planner",element:x.jsx(LO,{})}),x.jsx(Wi,{path:"/user/change-password",element:x.jsx(iL,{})}),x.jsx(Wi,{path:"/user/terms",element:x.jsx(oL,{})}),x.jsx(Wi,{path:"/user/privacy",element:x.jsx(cL,{})}),x.jsx(Wi,{path:"/user/reviews",element:x.jsx(OO,{})}),x.jsx(Wi,{path:"/user/device-management",element:x.jsx(YT,{})}),x.jsx(Wi,{path:"/user/contact",element:x.jsx(HO,{})}),x.jsx(Wi,{path:"/user/ai",element:x.jsx($O,{})}),x.jsx(Wi,{path:"/contact",element:x.jsx(Ml,{to:"/user/contact"})}),x.jsx(Wi,{path:"/admin/contact",element:x.jsx(Ml,{to:"/user/contact"})}),x.jsx(Wi,{path:"/ai",element:x.jsx(Ml,{to:"/user/ai"})})]}),x.jsxs(Wi,{element:x.jsx(jz,{bootstrapped:h}),children:[x.jsx(Wi,{path:"/admin",element:x.jsx(_O,{})}),x.jsx(Wi,{path:"/admin/appointments",element:x.jsx(gO,{})}),x.jsx(Wi,{path:"/admin/about",element:x.jsx(vO,{})}),x.jsx(Wi,{path:"/admin/explore",element:x.jsx(bO,{})}),x.jsx(Wi,{path:"/admin/create-listing",element:x.jsx(wO,{})}),x.jsx(Wi,{path:"/admin/listings",element:x.jsx(AO,{})}),x.jsx(Wi,{path:"/admin/my-listings",element:x.jsx(CO,{})}),x.jsx(Wi,{path:"/admin/update-listing/:listingId",element:x.jsx(RO,{})}),x.jsx(Wi,{path:"/admin/profile",element:x.jsx(TO,{})}),x.jsx(Wi,{path:"/admin/deployment-management",element:x.jsx(SO,{})}),x.jsx(Wi,{path:"/admin/change-password",element:x.jsx(nL,{})}),x.jsx(Wi,{path:"/admin/requests",element:x.jsx(EO,{})}),x.jsx(Wi,{path:"/admin/listing/:listingId",element:x.jsx(Kv,{},g.pathname)}),x.jsx(Wi,{path:"/admin/appointmentlisting",element:x.jsx(IO,{})}),x.jsx(Wi,{path:"/admin/terms",element:x.jsx(lL,{})}),x.jsx(Wi,{path:"/admin/privacy",element:x.jsx(uL,{})}),x.jsx(Wi,{path:"/admin/management",element:x.jsx(hL,{})}),x.jsx(Wi,{path:"/admin/reviews",element:x.jsx(zO,{})}),x.jsx(Wi,{path:"/admin/services",element:x.jsx(DO,{})}),x.jsx(Wi,{path:"/admin/route-planner",element:x.jsx(iO,{})}),x.jsx(Wi,{path:"/admin/fraudmanagement",element:x.jsx(kO,{})}),x.jsx(Wi,{path:"/admin/payments",element:x.jsx(NO,{})}),x.jsx(Wi,{path:"/admin/security-moderation",element:x.jsx(jO,{})}),x.jsx(Wi,{path:"/admin/device-management",element:x.jsx(YT,{})}),x.jsx(Wi,{path:"/admin/session-management",element:x.jsx(FO,{})}),x.jsx(Wi,{path:"/admin/session-audit-logs",element:x.jsx(UO,{})}),x.jsx(Wi,{path:"/admin/support",element:x.jsx(qO,{})}),x.jsx(Wi,{path:"/admin/ai",element:x.jsx(ZO,{})}),x.jsx(Wi,{path:"/contact",element:x.jsx(Ml,{to:"/admin/support"})}),x.jsx(Wi,{path:"/support",element:x.jsx(Ml,{to:"/admin/support"})}),x.jsx(Wi,{path:"/user/contact",element:x.jsx(Ml,{to:"/admin/support"})}),x.jsx(Wi,{path:"/user/support",element:x.jsx(Ml,{to:"/admin/support"})}),x.jsx(Wi,{path:"/ai",element:x.jsx(Ml,{to:"/admin/ai"})}),x.jsx(Wi,{path:"/user/ai",element:x.jsx(Ml,{to:"/admin/ai"})})]}),x.jsx(Wi,{path:"*",element:x.jsx(sf,{})})]})})}),x.jsx(YI,{position:"top-center",autoClose:2e3,hideProgressBar:!1,newestOnTop:!0,closeOnClick:!0,pauseOnFocusLoss:!1,draggable:!1,pauseOnHover:!1,rtl:!1,theme:"light",limit:3})]})}function KO(){const h=vp(),[g,b]=he.useState(!1);return he.useEffect(()=>{(async()=>{try{(await(await fetch(`${Yy}/api/auth/verify`)).json()).success===!1&&h(Xa())}catch(I){console.error("Auth check failed:",I),h(Xa())}finally{b(!0)}})()},[h]),x.jsx(Bz,{children:x.jsx(YP,{children:x.jsx(zR,{children:x.jsx(YO,{bootstrapped:g})})})})}function Ky(h){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ky=function(b){return typeof b}:Ky=function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},Ky(h)}function JO(h,g){if(!(h instanceof g))throw new TypeError("Cannot call a class as a function")}function QO(h,g){for(var b=0;b<g.length;b++){var S=g[b];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(h,S.key,S)}}function ek(h,g,b){return g&&QO(h.prototype,g),h}function tk(h,g){return g&&(Ky(g)==="object"||typeof g=="function")?g:Jy(h)}function z2(h){return z2=Object.setPrototypeOf?Object.getPrototypeOf:function(b){return b.__proto__||Object.getPrototypeOf(b)},z2(h)}function Jy(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function ik(h,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(g&&g.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),g&&D2(h,g)}function D2(h,g){return D2=Object.setPrototypeOf||function(S,I){return S.__proto__=I,S},D2(h,g)}function Qy(h,g,b){return g in h?Object.defineProperty(h,g,{value:b,enumerable:!0,configurable:!0,writable:!0}):h[g]=b,h}var p5=function(h){ik(g,h);function g(){var b,S;JO(this,g);for(var I=arguments.length,N=new Array(I),V=0;V<I;V++)N[V]=arguments[V];return S=tk(this,(b=z2(g)).call.apply(b,[this].concat(N))),Qy(Jy(S),"state",{bootstrapped:!1}),Qy(Jy(S),"_unsubscribe",void 0),Qy(Jy(S),"handlePersistorState",function(){var s=S.props.persistor,q=s.getState(),Z=q.bootstrapped;Z&&(S.props.onBeforeLift?Promise.resolve(S.props.onBeforeLift()).finally(function(){return S.setState({bootstrapped:!0})}):S.setState({bootstrapped:!0}),S._unsubscribe&&S._unsubscribe())}),S}return ek(g,[{key:"componentDidMount",value:function(){this._unsubscribe=this.props.persistor.subscribe(this.handlePersistorState),this.handlePersistorState()}},{key:"componentWillUnmount",value:function(){this._unsubscribe&&this._unsubscribe()}},{key:"render",value:function(){return typeof this.props.children=="function"?this.props.children(this.state.bootstrapped):this.state.bootstrapped?this.props.children:this.props.loading}}]),g}(he.PureComponent);Qy(p5,"defaultProps",{children:null,loading:null});fC.createRoot(document.getElementById("root")).render(x.jsx(t8,{store:T6,children:x.jsx(p5,{loading:null,persistor:Fg,children:h=>x.jsx(KO,{bootstrapped:h})})}));export{HN as $,lk as A,QM as B,i5 as C,ck as D,Dm as E,fN as F,Vy as G,z4 as H,a5 as I,r5 as J,s5 as K,Ds as L,p1 as M,lb as N,sf as O,ZC as P,fn as Q,Tm as R,su as S,QN as T,h1 as U,P4 as V,CN as W,a6 as X,I4 as Y,ho as Z,GN as _,Bk as a,cI as a$,qN as a0,Fr as a1,TN as a2,qk as a3,RN as a4,gp as a5,Fk as a6,P2 as a7,Rm as a8,m1 as a9,Vk as aA,ON as aB,LN as aC,Qk as aD,fI as aE,YN as aF,Cm as aG,aj as aH,gN as aI,NN as aJ,VN as aK,IN as aL,Uk as aM,tj as aN,WN as aO,oj as aP,Ok as aQ,r6 as aR,tb as aS,uN as aT,lI as aU,Es as aV,YI as aW,mI as aX,Rk as aY,Y_ as aZ,Il as a_,N8 as aa,x8 as ab,ak as ac,a4 as ad,sk as ae,ok as af,jg as ag,R8 as ah,mS as ai,t8 as aj,$N as ak,pI as al,Ik as am,MN as an,jk as ao,Bg as ap,Yk as aq,dj as ar,Mk as as,oN as at,hN as au,FN as av,dI as aw,Pk as ax,Dk as ay,EN as az,ZN as b,KN as b$,Jk as b0,tN as b1,hj as b2,aN as b3,o6 as b4,XN as b5,Zk as b6,bN as b7,$k as b8,u1 as b9,xk as bA,uI as bB,l6 as bC,m2 as bD,xN as bE,Xk as bF,l0 as bG,hk as bH,yk as bI,fk as bJ,S1 as bK,xp as bL,Xa as bM,Fg as bN,dk as bO,mk as bP,rj as bQ,mN as bR,D4 as bS,bk as bT,Ck as bU,YM as bV,zk as bW,dN as bX,DN as bY,pN as bZ,nN as b_,Dj as ba,Wk as bb,fL as bc,ej as bd,Pj as be,iN as bf,lN as bg,Gt as bh,vN as bi,Gn as bj,_N as bk,cN as bl,wk as bm,Ek as bn,Tk as bo,Ak as bp,Sk as bq,zj as br,BN as bs,jN as bt,eN as bu,AN as bv,zN as bw,uj as bx,yN as by,Kk as bz,Dy as c,PN as c0,cj as c1,JN as c2,kN as c3,Hk as c4,Gk as c5,ij as c6,kk as c7,Lk as c8,lj as c9,Nk as ca,rN as cb,zy as cc,SN as cd,C1 as ce,nj as cf,KP as cg,JP as ch,mp as ci,UN as d,sj as e,rd as f,uv as g,wN as h,fo as i,x as j,vk as k,sN as l,Pz as m,q4 as n,ko as o,Pl as p,kz as q,he as r,vp as s,n5 as t,vc as u,Og as v,au as w,uk as x,hi as y,Q2 as z};
