import{u as M,i as R,r as d,j as s,c6 as O,a5 as L,al as P,y as a,c7 as q,c8 as E,c9 as z,ca as B,bC as H}from"./index-BKRdPXJO.js";const J=[{key:"cleaning",name:"Cleaning",icon:s.jsx(q,{className:"text-blue-600"})},{key:"electrician",name:"Electrician",icon:s.jsx(E,{className:"text-yellow-600"})},{key:"plumber",name:"Plumber",icon:s.jsx(z,{className:"text-indigo-600"})},{key:"pest",name:"Pest Control",icon:s.jsx(B,{className:"text-green-700"})},{key:"handyman",name:"Handyman",icon:s.jsx(H,{className:"text-purple-700"})}];function I(){M("On-Demand Services - Service Requests");const{currentUser:l}=R(e=>e.user),[p,j]=d.useState([]),[c,y]=d.useState({date:"",address:"",notes:""}),[f,N]=d.useState(!1),[w,S]=d.useState([]),[m,v]=d.useState({q:"",status:"all"}),[i,x]=d.useState({from:"",to:"",date:"",size:"1BHK",notes:""}),[C,D]=d.useState(!1),[_,k]=d.useState([]),[o,b]=d.useState({q:"",status:"all"}),n="https://urbansetu.onrender.com",h=async()=>{if(l)try{const t=await(await fetch(`${n}/api/requests/services`,{credentials:"include"})).json();S(Array.isArray(t)?t:[])}catch{}},g=async()=>{if(l)try{const t=await(await fetch(`${n}/api/requests/movers`,{credentials:"include"})).json();k(Array.isArray(t)?t:[])}catch{}};d.useEffect(()=>{h(),g()},[l==null?void 0:l._id]);const A=e=>{j(t=>t.includes(e)?t.filter(r=>r!==e):[...t,e])},$=async()=>{if(p.length===0||!c.date||!c.address){a.error("Select at least one service and fill required fields");return}N(!0);try{if((await fetch(`${n}/api/requests/services`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({services:p,preferredDate:c.date,address:c.address,notes:c.notes})})).ok){a.success("Service request submitted"),h();try{await fetch(`${n}/api/notifications/notify-admins`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"New Service Request",message:`${(l==null?void 0:l.username)||"A user"} requested services: ${p.join(", ")} on ${c.date}.`})})}catch{}}else a.error("Failed to submit request");j([]),y({date:"",address:"",notes:""})}catch{a.error("Failed")}finally{N(!1)}},F=async e=>{if(e.preventDefault(),!i.from||!i.to||!i.date){a.error("Please fill From, To and Date");return}D(!0);try{if((await fetch(`${n}/api/requests/movers`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromAddress:i.from,toAddress:i.to,moveDate:i.date,size:i.size,notes:i.notes})})).ok){a.success("Movers request submitted"),g();try{await fetch(`${n}/api/notifications/notify-admins`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"New Movers Request",message:`${(l==null?void 0:l.username)||"A user"} requested movers from "${i.from}" to "${i.to}" on ${i.date}.`})})}catch{}}else a.error("Failed to submit movers request");x({from:"",to:"",date:"",size:"1BHK",notes:""})}catch{a.error("Failed to submit movers request")}finally{D(!1)}};return s.jsxs("div",{className:"max-w-5xl mx-auto px-2 sm:px-4 py-6 sm:py-10",children:[s.jsx("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:s.jsx("h1",{className:"text-2xl font-bold",children:"On-Demand Services"})}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3 sm:gap-4 mb-6 sm:mb-8",children:J.map(e=>s.jsxs("button",{onClick:()=>A(e.key),className:`bg-white rounded-xl shadow p-4 flex flex-col items-center gap-2 hover:shadow-lg ${p.includes(e.key)?"ring-2 ring-blue-500":""}`,children:[e.icon,s.jsx("span",{className:"text-sm font-semibold",children:e.name})]},e.key))}),s.jsxs("div",{className:"bg-white rounded-xl shadow p-4 sm:p-5",children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Request Details"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-gray-600",children:"Preferred Date"}),s.jsx("input",{type:"date",className:"w-full border rounded p-2",value:c.date,onChange:e=>y(t=>({...t,date:e.target.value})),min:new Date().toISOString().split("T")[0]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-gray-600",children:"Service Address"}),s.jsx("input",{className:"w-full border rounded p-2",value:c.address,onChange:e=>y(t=>({...t,address:e.target.value})),placeholder:"Address"})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"text-sm text-gray-600",children:"Notes"}),s.jsx("textarea",{className:"w-full border rounded p-2",rows:3,value:c.notes,onChange:e=>y(t=>({...t,notes:e.target.value})),placeholder:"Describe the issue"})]})]}),s.jsx("button",{onClick:$,disabled:f,className:"mt-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-2 rounded disabled:opacity-60",children:f?"Submitting...":"Submit Request"})]}),s.jsxs("div",{className:"mt-10 border-t border-gray-200 pt-8",children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[s.jsx(O,{className:"text-blue-600"})," Packers & Movers"]})}),s.jsxs("form",{onSubmit:F,className:"bg-white rounded-xl shadow p-4 sm:p-5 space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-gray-600",children:"From Address"}),s.jsx("input",{className:"w-full border rounded p-2",value:i.from,onChange:e=>x(t=>({...t,from:e.target.value})),placeholder:"Pickup address"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-gray-600",children:"To Address"}),s.jsx("input",{className:"w-full border rounded p-2",value:i.to,onChange:e=>x(t=>({...t,to:e.target.value})),placeholder:"Drop address"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-gray-600",children:"Move Date"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(L,{className:"text-gray-500"}),s.jsx("input",{type:"date",className:"w-full border rounded p-2",value:i.date,onChange:e=>x(t=>({...t,date:e.target.value})),min:new Date().toISOString().split("T")[0]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-gray-600",children:"Home Size"}),s.jsx("select",{className:"w-full border rounded p-2",value:i.size,onChange:e=>x(t=>({...t,size:e.target.value})),children:["1RK","1BHK","2BHK","3BHK","Villa","Office"].map(e=>s.jsx("option",{value:e,children:e},e))})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm text-gray-600",children:"Notes"}),s.jsx("textarea",{className:"w-full border rounded p-2",rows:3,value:i.notes,onChange:e=>x(t=>({...t,notes:e.target.value})),placeholder:"Additional details"})]}),s.jsx("button",{disabled:C,className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-2 rounded hover:from-blue-700 hover:to-purple-700 disabled:opacity-50",children:C?"Submitting...":"Request Quote"})]}),s.jsxs("div",{className:"mt-6 text-sm text-gray-600 flex items-center gap-2",children:[s.jsx(P,{})," Service available in major cities."]}),l&&s.jsxs("div",{className:"mt-6 sm:mt-8 bg-white rounded-xl shadow p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h3",{className:"text-lg font-semibold",children:"My Movers Requests"}),s.jsx("button",{onClick:g,className:"px-3 py-1.5 bg-gray-100 rounded hover:bg-gray-200 text-sm",children:"Refresh"})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mb-3",children:[s.jsx("input",{className:"border rounded p-2 text-sm",placeholder:"Search",value:o.q,onChange:e=>b(t=>({...t,q:e.target.value}))}),s.jsx("select",{className:"border rounded p-2 text-sm",value:o.status,onChange:e=>b(t=>({...t,status:e.target.value})),children:["all","pending","in_progress","completed","cancelled"].map(e=>s.jsx("option",{value:e,children:e},e))}),s.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded text-sm",onClick:()=>b({q:"",status:"all"}),children:"Clear"})]}),_.length===0?s.jsx("p",{className:"text-sm text-gray-600",children:"No requests yet."}):s.jsx("ul",{className:"divide-y",children:_.filter(e=>{const t=o.q.trim()?(e.fromAddress||"").toLowerCase().includes(o.q.toLowerCase())||(e.toAddress||"").toLowerCase().includes(o.q.toLowerCase())||(e.size||"").toLowerCase().includes(o.q.toLowerCase()):!0,r=o.status==="all"?!0:e.status===o.status;return t&&r}).map(e=>s.jsxs("li",{className:"py-2",children:[s.jsxs("div",{className:"text-xs text-gray-500",children:[new Date(e.createdAt).toLocaleString()," — ",s.jsx("span",{className:`px-2 py-0.5 rounded text-white text-[10px] ${e.status==="completed"?"bg-green-600":e.status==="in_progress"?"bg-blue-600":e.status==="cancelled"?"bg-gray-500":"bg-orange-500"}`,children:e.status})]}),s.jsxs("div",{className:"text-sm text-gray-800",children:["From: ",e.fromAddress]}),s.jsxs("div",{className:"text-sm text-gray-800",children:["To: ",e.toAddress]}),s.jsxs("div",{className:"text-sm text-gray-800",children:["Date: ",e.moveDate]}),s.jsxs("div",{className:"text-sm text-gray-800",children:["Size: ",e.size]}),e.notes&&s.jsxs("div",{className:"text-sm text-gray-700",children:["Notes: ",e.notes]}),s.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.status==="pending"&&s.jsx("button",{onClick:async()=>{try{await fetch(`${n}/api/requests/movers/${e._id}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"cancelled"})}),a.success("Movers request cancelled"),g()}catch{a.error("Failed to cancel")}},className:"text-xs px-2 py-1 rounded bg-gray-200",children:"Cancel"}),e.status==="cancelled"&&(e.reinitiateCount??0)<2&&s.jsxs("button",{onClick:async()=>{try{const t=await fetch(`${n}/api/requests/movers/${e._id}/reinitiate`,{method:"POST",credentials:"include"}),r=await t.json();t.ok?(a.success("Movers request re-initiated"),g()):a.error(r.message||"Failed to reinitiate")}catch{a.error("Failed to reinitiate")}},className:"text-xs px-2 py-1 rounded bg-blue-100 text-blue-700",children:["Re-initiate (",2-(e.reinitiateCount||0)," left)"]}),s.jsx("button",{onClick:async()=>{if(confirm("Delete this request permanently?"))try{const t=await fetch(`${n}/api/requests/movers/${e._id}`,{method:"DELETE",credentials:"include"});if(t.ok)a.success("Deleted"),k(r=>r.filter(u=>u._id!==e._id));else{const r=await t.json();a.error(r.message||"Delete failed")}}catch{a.error("Delete failed")}},className:"text-xs px-2 py-1 rounded bg-red-100 text-red-700",children:"Delete"})]})]},e._id))})]})]}),l&&s.jsxs("div",{className:"mt-6 sm:mt-8 bg-white rounded-xl shadow p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h3",{className:"text-lg font-semibold",children:"My Service Requests"}),s.jsx("button",{onClick:h,className:"px-3 py-1.5 bg-gray-100 rounded hover:bg-gray-200 text-sm",children:"Refresh"})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 mb-3",children:[s.jsx("input",{className:"border rounded p-2 text-sm",placeholder:"Search",value:m.q,onChange:e=>v(t=>({...t,q:e.target.value}))}),s.jsx("select",{className:"border rounded p-2 text-sm",value:m.status,onChange:e=>v(t=>({...t,status:e.target.value})),children:["all","pending","in_progress","completed","cancelled"].map(e=>s.jsx("option",{value:e,children:e},e))}),s.jsx("button",{className:"px-3 py-2 bg-gray-100 rounded text-sm",onClick:()=>v({q:"",status:"all"}),children:"Clear"})]}),w.length===0?s.jsx("p",{className:"text-sm text-gray-600",children:"No requests yet."}):s.jsx("ul",{className:"divide-y",children:w.filter(e=>{const t=m.q.trim()?(e.address||"").toLowerCase().includes(m.q.toLowerCase())||(Array.isArray(e.services)?e.services.join(", "):"").toLowerCase().includes(m.q.toLowerCase()):!0,r=m.status==="all"?!0:e.status===m.status;return t&&r}).map(e=>{var t;return s.jsxs("li",{className:"py-2",children:[s.jsxs("div",{className:"text-xs text-gray-500",children:[new Date(e.createdAt).toLocaleString()," — ",s.jsx("span",{className:`px-2 py-0.5 rounded text-white text-[10px] ${e.status==="completed"?"bg-green-600":e.status==="in_progress"?"bg-blue-600":e.status==="cancelled"?"bg-gray-500":"bg-orange-500"}`,children:e.status})]}),s.jsxs("div",{className:"text-sm text-gray-800",children:["Services: ",(t=e.services)==null?void 0:t.join(", ")]}),s.jsxs("div",{className:"text-sm text-gray-800",children:["Date: ",e.preferredDate]}),s.jsxs("div",{className:"text-sm text-gray-800",children:["Address: ",e.address]}),e.notes&&s.jsxs("div",{className:"text-sm text-gray-700",children:["Notes: ",e.notes]}),s.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.status==="pending"&&s.jsx("button",{onClick:async()=>{try{await fetch(`${n}/api/requests/services/${e._id}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"cancelled"})}),a.success("Service request cancelled"),h()}catch{a.error("Failed to cancel")}},className:"text-xs px-2 py-1 rounded bg-gray-200",children:"Cancel"}),e.status==="cancelled"&&(e.reinitiateCount??0)<2&&s.jsxs("button",{onClick:async()=>{try{const r=await fetch(`${n}/api/requests/services/${e._id}/reinitiate`,{method:"POST",credentials:"include"}),u=await r.json();r.ok?(a.success("Service request re-initiated"),h()):a.error(u.message||"Failed to reinitiate")}catch{a.error("Failed to reinitiate")}},className:"text-xs px-2 py-1 rounded bg-blue-100 text-blue-700",children:["Re-initiate (",2-(e.reinitiateCount||0)," left)"]}),s.jsx("button",{onClick:async()=>{if(confirm("Delete this request permanently?"))try{const r=await fetch(`${n}/api/requests/services/${e._id}`,{method:"DELETE",credentials:"include"});if(r.ok)a.success("Deleted"),S(u=>u.filter(T=>T._id!==e._id));else{const u=await r.json();a.error(u.message||"Delete failed")}}catch{a.error("Delete failed")}},className:"text-xs px-2 py-1 rounded bg-red-100 text-red-700",children:"Delete"})]})]},e._id)})})]})]})}export{I as default};
