import{u as Ye,i as Ze,r as c,Q as M,aV as Te,j as e,a3 as Ge,b5 as Qe,c4 as Fe,aD as Xe,X as Ke,G as P,b as S,V as ie,Y as V,c5 as es,ap as Pe,c as ss,am as ts,y as m,U as Ue,R as de,T as $e,Z as ce,w as as,S as ls,C as rs,_ as ns,$ as os,a0 as is}from"./index-AwWxf1fH.js";const v="https://urbansetu.onrender.com";function cs(){var Ce,ke,_e,Ae;Ye("Review Management - Content Moderation");const{currentUser:h}=Ze(s=>s.user),[C,p]=c.useState([]),[z,me]=c.useState(!0),[xe,ge]=c.useState(""),[u,he]=c.useState(1),[k,Ee]=c.useState(1),[U,Ie]=c.useState(""),[W,De]=c.useState("date"),[$,pe]=c.useState("desc"),[o,ue]=c.useState(null),[H,J]=c.useState(!1),[_,q]=c.useState(null),[E,Y]=c.useState(""),[Z,G]=c.useState(""),[Q,X]=c.useState(!1),[A,K]=c.useState(null),[N,fe]=c.useState({}),[ee,be]=c.useState({}),[je,se]=c.useState({}),[ye,Oe]=c.useState(""),[x,Le]=c.useState({totalReviews:0,pendingReviews:0,approvedReviews:0,rejectedReviews:0,removedReviews:0,averageRating:0,sentiment:{positive:0,negative:0,neutral:0,topWords:[]},recentActivity:[],topProperties:[],topUsers:[],ratingDistribution:{},monthlyTrends:[],responseRate:0}),[te,Be]=c.useState(!1);c.useEffect(()=>{h&&(h.role==="admin"||h.role==="rootadmin")&&(ve(),Me());const s=t=>{p(r=>t.status==="removed"||t.deleted?r.filter(i=>i._id!==t._id):r.some(i=>i._id===t._id)?r.map(i=>i._id===t._id?{...i,...t}:i):[t,...r])};M.on("reviewUpdated",s);const l=t=>{p(r=>r.map(d=>d.userId===t.userId?{...d,userName:t.username,userAvatar:t.avatar}:d))};return M.on("profileUpdated",l),()=>{M.off("reviewUpdated",s),M.off("profileUpdated",l)}},[h,u,U,W,$]),c.useEffect(()=>{try{window.scrollTo({top:0,left:0,behavior:"auto"}),document.documentElement.scrollTop=0,document.body.scrollTop=0}catch{}},[]),c.useEffect(()=>(o||H&&_||Q&&A?(document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%"):(document.body.style.overflow="",document.body.style.position="",document.body.style.width=""),()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width=""}),[o,H,_,Q,A]);const ve=async()=>{try{const s=new URLSearchParams({page:1,limit:10,sort:"date",order:"desc"});U&&s.append("status",U);const l=await fetch(`${v}/api/review/admin/all?${s}`,{credentials:"include"}),t=await l.json();if(l.ok){const r=Array.isArray(t.reviews)?[...t.reviews].sort((d,i)=>new Date(i.createdAt)-new Date(d.createdAt)):[];p(r),Ee(t.pages)}else ge(t.message||"Failed to load reviews")}catch{ge("Network error. Please try again.")}finally{me(!1)}},Me=async()=>{try{const s=await Te.get(`${v}/api/review/admin/stats`,{withCredentials:!0}),l=await Te.get(`${v}/api/review/admin/all?limit=1000&sort=date&order=desc`,{withCredentials:!0}),t=l.data.reviews||l.data||[],r=s.data,d={};t.forEach(a=>{const n=a.rating||0;d[n]=(d[n]||0)+1});const i={};t.forEach(a=>{const n=new Date(a.createdAt).toISOString().substring(0,7);i[n]=(i[n]||0)+1}),console.log("Monthly trends data:",i),console.log("Total reviews for trends:",t.length);const f={};t.forEach(a=>{if(a.listingId){const n=typeof a.listingId=="object"?a.listingId._id:a.listingId,j=typeof a.listingId=="object"?a.listingId.name:"Unknown Property";f[n]||(f[n]={name:j,count:0,avgRating:0,totalRating:0}),f[n].count++,f[n].totalRating+=a.rating||0}}),Object.values(f).forEach(a=>{a.avgRating=a.totalRating/a.count});const re=Object.values(f).sort((a,n)=>n.count-a.count).slice(0,5),b={};t.forEach(a=>{const n=a.userId,j=a.userName||"Unknown User";b[n]||(b[n]={name:j,count:0,avgRating:0,totalRating:0}),b[n].count++,b[n].totalRating+=a.rating||0}),Object.values(b).forEach(a=>{a.avgRating=a.totalRating/a.count});const ne=Object.values(b).sort((a,n)=>n.count-a.count).slice(0,5),g=t.filter(a=>a.ownerResponse&&a.ownerResponse.trim()),D=t.length>0?g.length/t.length*100:0,O=["good","great","excellent","amazing","love","nice","helpful","fast","clean","spacious","recommended","recommend"],L=["bad","poor","terrible","awful","hate","dirty","small","slow","rude","noisy","not recommended","worst"];let T=0,F=0,w=0;const R={};t.filter(a=>a.status==="approved").forEach(a=>{const n=(a.comment||"").toLowerCase();if(!n.trim()){w++;return}let j=0;O.forEach(y=>{n.includes(y)&&j++}),L.forEach(y=>{n.includes(y)&&j--}),j>0?T++:j<0?F++:w++,n.split(/[^a-zA-Z]+/).forEach(y=>{y.length>3&&(R[y]=(R[y]||0)+1)})});const B=Object.entries(R).sort((a,n)=>n[1]-a[1]).slice(0,10).map(([a,n])=>({word:a,count:n}));Le({totalReviews:r.totalReviews||t.length,pendingReviews:r.pendingReviews||0,approvedReviews:t.filter(a=>a.status==="approved").length,rejectedReviews:t.filter(a=>a.status==="rejected").length,removedReviews:t.filter(a=>a.status==="removed"||a.status==="removed_by_user").length,averageRating:r.averageRating||0,sentiment:{positive:T,negative:F,neutral:w,topWords:B},recentActivity:t.slice(0,10),topProperties:re,topUsers:ne,ratingDistribution:d,monthlyTrends:Object.entries(i).sort(([a],[n])=>a.localeCompare(n)).map(([a,n])=>({month:a,count:n})),responseRate:D})}catch(s){console.error("Error fetching analytics:",s)}},Ne=async(s,l,t="")=>{try{const r=await fetch(`${v}/api/review/admin/status/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:l,adminNote:t})}),d=await r.json();r.ok?(p(C.map(i=>i._id===s?{...i,status:l,adminNote:t}:i)),m.success(`Review ${l} successfully`)):m.error(d.message||"Failed to update review status")}catch{m.error("Network error. Please try again.")}},Ve=async()=>{if(!E){m.error("Please select a removal reason");return}try{const s=await fetch(`${v}/api/review/admin/remove/${_._id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:E,note:Z})}),l=await s.json();s.ok?(p(C.map(t=>t._id===_._id?{...t,status:"removed",removalReason:E,removalNote:Z}:t)),J(!1),q(null),Y(""),G(""),m.success("Review removed successfully")):m.error(l.message||"Failed to remove review")}catch{m.error("Network error. Please try again.")}},ze=async s=>{try{const l=await fetch(`${v}/api/review/admin/restore/${s}`,{method:"PUT",credentials:"include"}),t=await l.json();l.ok?(p(C.map(r=>r._id===s?{...r,...t.review}:r)),m.success("Review restored and approved")):m.error(t.message||"Failed to restore review")}catch{m.error("Network error. Please try again.")}},We=()=>{A&&(p(C.filter(s=>s._id!==A._id)),X(!1),K(null),m.success("Review deleted from table successfully"))},He=(s,l)=>{fe(t=>({...t,[s]:l}))},Je=async(s,l)=>{be(t=>({...t,[s]:!0})),se(t=>({...t,[s]:""}));try{const t=await fetch(`${v}/api/review/respond/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({ownerResponse:N[s]})}),r=await t.json();t.ok?(p(d=>d.map(i=>i._id===s?{...i,ownerResponse:N[s]}:i)),fe(d=>({...d,[s]:""})),m.success("Owner response submitted successfully")):(se(d=>({...d,[s]:r.message||"Failed to submit response"})),m.error(r.message||"Failed to submit response"))}catch{se(r=>({...r,[s]:"Network error. Please try again."}))}finally{be(t=>({...t,[s]:!1}))}},we=s=>[...Array(5)].map((l,t)=>e.jsx(S,{className:`text-sm ${t<s?"text-yellow-400":"text-gray-300"}`},t)),I=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),Re=s=>{const t={pending:{color:"bg-yellow-100 text-yellow-800",icon:P},approved:{color:"bg-green-100 text-green-800",icon:P},rejected:{color:"bg-red-100 text-red-800",icon:ce},removed:{color:"bg-gray-100 text-gray-800",icon:V},removed_by_user:{color:"bg-orange-100 text-orange-800",icon:V}}[s],r=t.icon;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.color}`,children:[e.jsx(r,{className:"mr-1"}),s==="removed_by_user"?"Removed by User":s.charAt(0).toUpperCase()+s.slice(1)]})},ae=s=>W!==s?e.jsx(ns,{className:"text-gray-400"}):$==="desc"?e.jsx(os,{className:"text-blue-600"}):e.jsx(is,{className:"text-blue-600"}),le=s=>{W===s?(pe($==="desc"?"asc":"desc"),m.info(`Sorted by ${s} (${$==="desc"?"ascending":"descending"})`)):(De(s),pe("desc"),m.info(`Sorted by ${s} (descending)`))},qe=async()=>{try{me(!0),await ve(),m.success("Reviews refreshed successfully")}catch{m.error("Failed to refresh reviews")}},Se=C.filter(s=>{var D,O,L,T,F,w,R,oe,B,a;const l=((D=s.userName)==null?void 0:D.toLowerCase())||"",t=((O=s.userEmail)==null?void 0:O.toLowerCase())||"",r=((T=(L=s.listingId)==null?void 0:L.name)==null?void 0:T.toLowerCase())||"",d=((w=(F=s.listingId)==null?void 0:F.city)==null?void 0:w.toLowerCase())||"",i=((oe=(R=s.listingId)==null?void 0:R.state)==null?void 0:oe.toLowerCase())||"",f=String(s.rating),re=((B=s.comment)==null?void 0:B.toLowerCase())||"",b=((a=s.adminNote)==null?void 0:a.toLowerCase())||"",ne=I(s.createdAt).toLowerCase(),g=ye.toLowerCase();return l.includes(g)||t.includes(g)||r.includes(g)||d.includes(g)||i.includes(g)||f===g||re.includes(g)||b.includes(g)||ne.includes(g)||g===""});return!h||h.role!=="admin"&&h.role!=="rootadmin"?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You don't have permission to access this page."})]})}):z?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading reviews..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100 py-4 sm:py-10 px-1 sm:px-2 md:px-8 animate-fadeIn",children:[e.jsxs("div",{className:"max-w-full sm:max-w-3xl md:max-w-6xl mx-auto bg-white rounded-2xl shadow-2xl p-2 sm:p-4 md:p-8 animate-slideUp",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-8",children:[e.jsx("h1",{className:"text-2xl sm:text-4xl font-extrabold text-blue-700 drop-shadow animate-fade-in",children:"Review Management"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>Be(!te),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition ${te?"bg-gradient-to-r from-green-500 to-emerald-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,title:"Toggle Analytics",children:[e.jsx(Ge,{}),"Analytics"]}),e.jsxs("button",{onClick:qe,disabled:z,className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg hover:from-blue-600 hover:to-purple-600 transition disabled:opacity-50 disabled:cursor-not-allowed shadow",title:"Refresh reviews",children:[e.jsx(Qe,{className:`${z?"animate-spin":""}`}),"Refresh"]})]})]}),te&&e.jsxs("div",{className:"mb-8 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 border border-blue-200",children:[e.jsxs("h2",{className:"text-2xl font-bold text-blue-800 mb-6 flex items-center gap-2",children:[e.jsx(Fe,{className:"text-blue-600"}),"Review Analytics & Insights"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Reviews"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:x.totalReviews})]}),e.jsx(Xe,{className:"text-2xl text-blue-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:x.pendingReviews})]}),e.jsx(Ke,{className:"text-2xl text-yellow-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:x.approvedReviews})]}),e.jsx(P,{className:"text-2xl text-green-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Rating"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:x.averageRating.toFixed(1)})]}),e.jsx(S,{className:"text-2xl text-purple-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Response Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-indigo-600",children:[x.responseRate.toFixed(1),"%"]})]}),e.jsx(ie,{className:"text-2xl text-indigo-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Removed"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:x.removedReviews})]}),e.jsx(V,{className:"text-2xl text-red-500"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(es,{className:"text-green-600"}),"Sentiment Analysis"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Positive"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:x.sentiment.positive})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Neutral"}),e.jsx("p",{className:"text-2xl font-bold text-gray-600",children:x.sentiment.neutral})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Negative"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:x.sentiment.negative})]})]}),x.sentiment.topWords.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Top Words"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:x.sentiment.topWords.slice(0,8).map((s,l)=>e.jsxs("span",{className:"text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded-full",children:[s.word," (",s.count,")"]},l))})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Fe,{className:"text-blue-600"}),"Rating Distribution"]}),e.jsx("div",{className:"space-y-2",children:[5,4,3,2,1].map(s=>{const l=x.ratingDistribution[s]||0,t=x.totalReviews>0?l/x.totalReviews*100:0;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 w-8",children:[e.jsx("span",{className:"text-sm font-medium",children:s}),e.jsx(S,{className:"text-yellow-400 text-xs"})]}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-400 h-2 rounded-full transition-all duration-300",style:{width:`${t}%`}})}),e.jsx("span",{className:"text-sm text-gray-600 w-12 text-right",children:l})]},s)})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Pe,{className:"text-purple-600"}),"Top Reviewed Properties"]}),x.topProperties.length>0?e.jsx("div",{className:"space-y-3",children:x.topProperties.map((s,l)=>e.jsx("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800 truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"text-yellow-400 text-sm"}),e.jsx("span",{className:"text-sm text-gray-600",children:s.avgRating.toFixed(1)})]}),e.jsx("span",{className:"text-sm text-gray-500",children:"•"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.count," reviews"]})]})]})},l))}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No data available"})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(ss,{className:"text-indigo-600"}),"Most Active Reviewers"]}),x.topUsers.length>0?e.jsx("div",{className:"space-y-3",children:x.topUsers.map((s,l)=>e.jsx("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800 truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"text-yellow-400 text-sm"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.avgRating.toFixed(1)," avg"]})]}),e.jsx("span",{className:"text-sm text-gray-500",children:"•"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.count," reviews"]})]})]})},l))}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No data available"})]})]}),x.monthlyTrends.length>0&&e.jsxs("div",{className:"mt-6 bg-white rounded-lg p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(ts,{className:"text-green-600"}),"Monthly Review Trends"]}),e.jsx("div",{className:"flex items-end gap-2 h-32",children:x.monthlyTrends.map((s,l)=>{const t=Math.max(...x.monthlyTrends.map(d=>d.count)),r=s.count/t*100;return e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("div",{className:"w-full bg-gradient-to-t from-blue-500 to-purple-500 rounded-t transition-all duration-300",style:{height:`${r}%`},title:`${s.month}: ${s.count} reviews`}),e.jsx("span",{className:"text-xs text-gray-500 mt-2 transform -rotate-45 origin-left",children:s.month.split("-")[1]})]},l)})})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4 mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by user email, name, property name, city, state, stars, comment, admin note, or review date...",className:"border border-gray-300 rounded-lg px-3 py-2 w-full sm:w-1/2",value:ye,onChange:s=>{Oe(s.target.value)}})}),e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 sm:mb-6 gap-2 sm:gap-0",children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-4 w-full",children:[e.jsxs("select",{value:U,onChange:s=>{Ie(s.target.value),s.target.value?m.info(`Filtered by status: ${s.target.value}`):m.info("Showing all reviews")},className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"removed",children:"Removed"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 w-full",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sort:"}),e.jsxs("button",{onClick:()=>le("date"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200",children:["Date ",ae("date")]}),e.jsxs("button",{onClick:()=>le("rating"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200",children:["Rating ",ae("rating")]}),e.jsxs("button",{onClick:()=>le("helpful"),className:"flex items-center gap-1 px-3 py-1 text-sm bg-gray-100 rounded-lg hover:bg-gray-200",children:["Helpful ",ae("helpful")]})]})]})}),xe&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-800",children:xe})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"flex flex-col gap-4 sm:table w-full",children:Se.map((s,l)=>{var t,r,d;return e.jsxs("div",{className:"flex flex-col sm:table-row bg-white rounded-lg shadow-sm sm:shadow-none p-3 sm:p-0 border sm:border-0"+(l!==Se.length-1?" sm:border-b sm:border-gray-200":""),style:{marginBottom:"1.5rem",border:"1px solid #e5e7eb",borderRadius:"0.75rem",boxShadow:"0 1px 3px rgba(0,0,0,0.04)"},children:[e.jsx("div",{className:"flex flex-row items-center gap-3 sm:table-cell sm:align-top sm:w-1/4 mb-2 sm:mb-0",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ue,{user:{username:s.userName,avatar:s.userAvatar},size:"w-10 h-10",textSize:"text-sm",showBorder:!1}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.userName}),s.isVerified&&e.jsx(de,{className:"text-green-600 text-sm",title:"Verified user"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:(t=s.listingId)!=null&&t.name?e.jsx("a",{href:`/admin/listing/${typeof s.listingId=="object"?s.listingId._id:s.listingId}`,className:"text-blue-600 hover:underline",target:"_blank",rel:"noopener noreferrer",children:s.listingId.name}):"Property not found"}),e.jsxs("div",{className:"text-xs text-gray-400",children:[(r=s.listingId)==null?void 0:r.city,", ",(d=s.listingId)==null?void 0:d.state]})]})]})}),e.jsxs("div",{className:"flex flex-col sm:table-cell sm:align-top sm:w-1/4 mb-2 sm:mb-0",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[we(s.rating),e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:[s.rating," star",s.rating>1?"s":""]}),s.helpfulCount>0&&e.jsxs("div",{className:"flex items-center ml-4 text-sm text-gray-500",children:[e.jsx($e,{className:"mr-1"}),s.helpfulCount]})]}),e.jsx("p",{className:"text-sm text-gray-900 line-clamp-2",children:s.comment}),s.verifiedByBooking&&e.jsx("span",{className:"inline-block mt-1 text-xs text-green-600 bg-green-50 px-2 py-1 rounded",children:"Booked this property"})]}),e.jsxs("div",{className:"flex flex-col gap-1 sm:table-cell sm:align-top sm:w-1/4 mb-2 sm:mb-0",children:[e.jsx("div",{className:"mb-2",children:Re(s.status)}),e.jsx("div",{className:"text-sm text-gray-500",children:I(s.createdAt)}),s.adminNote&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Note: ",s.adminNote]}),s.removalReason&&e.jsxs("div",{className:"text-xs text-red-600 mt-1",children:["Removed: ",s.removalReason]}),s.ownerResponse&&e.jsx("div",{className:"mt-2 p-2 bg-blue-50 rounded-md border border-blue-200",children:e.jsxs("p",{className:"text-sm text-blue-800 flex items-center gap-2",children:[e.jsx(ie,{className:"inline-block text-blue-500"}),e.jsx("strong",{children:"Owner Response:"})," ",s.ownerResponse]})})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:table-cell sm:align-top sm:w-1/4 mb-2 sm:mb-0",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>Ne(s._id,"approved"),className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow font-semibold flex items-center gap-2",title:"Approve review",children:[e.jsx(P,{})," Approve"]}),e.jsxs("button",{onClick:()=>Ne(s._id,"rejected"),className:"bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow font-semibold flex items-center gap-2",title:"Reject review",children:[e.jsx(ce,{})," Reject"]})]}),s.status==="approved"&&e.jsxs("button",{onClick:i=>{i.stopPropagation(),q(s),J(!0)},className:"bg-gradient-to-r from-yellow-500 to-yellow-600 text-white px-4 py-2 rounded-lg hover:from-yellow-600 hover:to-yellow-700 transition-all transform hover:scale-105 shadow font-semibold flex items-center gap-2",title:"Remove review",children:[e.jsx(V,{})," Remove"]}),(s.status==="removed"||s.status==="removed_by_user")&&e.jsxs("button",{onClick:()=>ze(s._id),className:"bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow font-semibold flex items-center gap-2",title:"Restore review",children:[e.jsx(P,{})," Restore"]}),e.jsxs("button",{onClick:()=>ue(s),className:"bg-gradient-to-r from-blue-400 to-blue-600 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow font-semibold flex items-center gap-2",title:"View details",children:[e.jsx(as,{})," View"]}),e.jsxs("button",{onClick:i=>{i.stopPropagation(),K(s),X(!0)},className:"bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-2 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow font-semibold flex items-center gap-2",title:"Delete from table",children:[e.jsx(ls,{})," Delete"]})]}),h&&s.listingId&&h._id===s.listingId.userRef&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-blue-700 mb-1 flex items-center gap-1",children:[e.jsx(ie,{})," Respond as Owner"]}),e.jsx("textarea",{className:"w-full border border-blue-300 rounded-md p-2 text-sm mb-2",rows:"2",placeholder:"Write a response to this review...",value:N[s._id]!==void 0?N[s._id]:s.ownerResponse||"",onChange:i=>He(s._id,i.target.value),disabled:ee[s._id]}),e.jsx("button",{className:"bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 text-sm",onClick:()=>Je(s._id,s.listingId.userRef),disabled:ee[s._id]||!N[s._id]||N[s._id].trim()===(s.ownerResponse||"").trim(),children:ee[s._id]?"Saving...":s.ownerResponse?"Update Response":"Add Response"}),je[s._id]&&e.jsx("div",{className:"text-red-600 text-xs mt-1",children:je[s._id]})]})]})]},s._id)})})}),k>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-6 gap-2",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Page ",u," of ",k]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsx("button",{onClick:()=>{he(Math.max(1,u-1)),m.info(`Navigated to page ${Math.max(1,u-1)}`)},disabled:u===1,className:"px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed w-full sm:w-auto",children:"Previous"}),e.jsx("button",{onClick:()=>{he(Math.min(k,u+1)),m.info(`Navigated to page ${Math.min(k,u+1)}`)},disabled:u===k,className:"px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed w-full sm:w-auto",children:"Next"})]})]})]}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-xs sm:max-w-2xl mx-2 sm:mx-4 max-h-[90vh] overflow-y-auto p-0 sm:p-0 relative animate-fadeIn",children:[e.jsx("button",{onClick:()=>ue(null),className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-10 shadow","aria-label":"Close",children:e.jsx(ce,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex flex-col items-center justify-center bg-gradient-to-r from-blue-100 to-purple-100 rounded-t-2xl px-6 py-5 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ue,{user:{username:o.userName,avatar:o.userAvatar},size:"w-14 h-14",textSize:"text-lg",showBorder:!0,className:"border-4 border-white shadow-lg"}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-blue-800 flex items-center gap-2",children:[o.userName,o.isVerified&&e.jsx(de,{className:"text-green-600 text-base",title:"Verified user"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:(Ce=o.userId)==null?void 0:Ce.email})]})]}),e.jsxs("div",{className:"mt-2 flex flex-col items-center",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-sm text-purple-700 font-semibold",children:[e.jsx(S,{className:"text-yellow-400"}),o.rating," / 5"]}),e.jsx("div",{className:"flex gap-1 mt-1",children:we(o.rating)})]})]}),e.jsxs("div",{className:"px-4 sm:px-8 py-4 space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 flex flex-col gap-1 border border-blue-100",children:[e.jsxs("div",{className:"font-semibold text-blue-700 flex items-center gap-2",children:[e.jsx(Pe,{className:"text-blue-400"}),((ke=o.listingId)==null?void 0:ke.name)||"Property not found"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[(_e=o.listingId)==null?void 0:_e.city,", ",(Ae=o.listingId)==null?void 0:Ae.state]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsx("h4",{className:"font-medium mb-1 text-gray-700",children:"Status"}),Re(o.status)]}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsx("h4",{className:"font-medium mb-1 text-gray-700",children:"Date"}),e.jsx("p",{className:"text-gray-700",children:I(o.createdAt)})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-1 text-gray-700",children:"Comment"}),e.jsx("p",{className:"text-gray-800 bg-gray-50 rounded-md p-3 border border-gray-100 shadow-inner",children:o.comment})]}),o.helpfulCount>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-1 text-gray-700",children:"Helpful Votes"}),e.jsxs("div",{className:"flex items-center text-gray-700",children:[e.jsx($e,{className:"mr-2 text-blue-500"}),o.helpfulCount," people found this helpful"]})]}),o.isVerified&&e.jsxs("div",{className:"bg-green-50 p-3 rounded-md flex items-center gap-2 border border-green-100",children:[e.jsx(de,{className:"text-green-600"}),e.jsx("span",{className:"text-green-800 font-medium",children:"Verified user"}),o.verifiedByBooking&&e.jsx("span",{className:"ml-2 text-xs text-green-700",children:"Booked this property"})]}),o.adminNote&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-1 text-gray-700",children:"Admin Note"}),e.jsx("p",{className:"text-gray-700 bg-yellow-50 p-3 rounded-md border border-yellow-100 shadow-inner",children:o.adminNote})]}),(o.status==="removed"||o.status==="removed_by_user")&&o.removalReason&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-1 text-gray-700",children:"Removal Details"}),e.jsxs("div",{className:"bg-red-50 p-3 rounded-md border border-red-200",children:[e.jsxs("p",{className:"text-red-800",children:[e.jsx("strong",{children:"Reason:"})," ",o.removalReason]}),o.removalNote&&e.jsxs("p",{className:"text-red-700 mt-1",children:[e.jsx("strong",{children:"Note:"})," ",o.removalNote]}),o.removedAt&&e.jsxs("p",{className:"text-red-600 text-sm mt-1",children:["Removed on ",I(o.removedAt)]})]})]})]})]})}),H&&_&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-xs sm:max-w-md w-full mx-2 sm:mx-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Remove Review"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to remove this review? This action cannot be undone."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Removal Reason *"}),e.jsxs("select",{value:E,onChange:s=>{Y(s.target.value),s.target.value&&m.info(`Selected removal reason: ${s.target.value}`)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select a reason"}),e.jsx("option",{value:"spam",children:"Spam"}),e.jsx("option",{value:"inappropriate",children:"Inappropriate content"}),e.jsx("option",{value:"fake",children:"Fake review"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Note (Optional)"}),e.jsx("textarea",{value:Z,onChange:s=>G(s.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Provide additional details..."})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{onClick:Ve,className:"flex-1 bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700",children:"Remove Review"}),e.jsx("button",{onClick:()=>{J(!1),q(null),Y(""),G(""),m.info("Review removal cancelled")},className:"flex-1 bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600",children:"Cancel"})]})]})}),Q&&A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 sm:p-6 max-w-xs sm:max-w-md w-full mx-2 sm:mx-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-red-600",children:"Delete Review"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to delete this review from the table? This will only remove it from your current view and won't affect the actual review data."}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3 mb-4",children:e.jsxs("p",{className:"text-yellow-800 text-sm",children:[e.jsx("strong",{children:"Note:"})," This action only removes the review from your current table view. The review data remains in the database."]})}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{onClick:We,className:"flex-1 bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition-colors",children:"Delete from Table"}),e.jsx("button",{onClick:()=>{X(!1),K(null),m.info("Delete action cancelled")},className:"flex-1 bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})}),e.jsx(rs,{})]})}export{cs as default};
