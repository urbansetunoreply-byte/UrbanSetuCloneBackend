import{u as A,i as I,r as i,y as j,j as e}from"./index-D5SGkqik.js";const B=()=>{A("Session Audit Logs - Security History");const{currentUser:M}=I(s=>s.user),[l,y]=i.useState([]),[b,g]=i.useState(!0),[r,c]=i.useState(1),[x,v]=i.useState(0),[p,N]=i.useState(null),[u,w]=i.useState(!1),d=i.useRef(null),[t,m]=i.useState({action:"",isSuspicious:"",userId:""});i.useEffect(()=>(h(),()=>{d.current&&clearInterval(d.current)}),[r,t]);const h=async()=>{try{const s=new URLSearchParams({page:r,limit:50});t.action&&s.append("action",t.action),t.isSuspicious!==""&&s.append("isSuspicious",t.isSuspicious),t.userId&&s.append("userId",t.userId);const a=new AbortController,o=await fetch(`https://urbansetu.onrender.com/api/session-management/admin/audit-logs?${s}`,{credentials:"include",headers:{"Content-Type":"application/json"},signal:a.signal});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const n=await o.json();n.success?(y(n.logs),v(n.total),N(new Date)):j.error(n.message||"Failed to fetch audit logs")}catch(s){console.error("Error fetching audit logs:",s),j.error("Failed to fetch audit logs")}finally{g(!1)}},k=()=>{w(s=>{const a=!s;return a?d.current=setInterval(()=>{h()},3e4):d.current&&(clearInterval(d.current),d.current=null),a})},L=s=>new Date(s).toLocaleString(),S=s=>{switch(s){case"login":return"bg-green-100 text-green-800";case"logout":return"bg-blue-100 text-blue-800";case"suspicious_login":return"bg-red-100 text-red-800";case"forced_logout":return"bg-orange-100 text-orange-800";case"session_expired":return"bg-gray-100 text-gray-800";case"session_cleaned":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},C=s=>{switch(s){case"rootadmin":return"bg-red-100 text-red-800";case"admin":return"bg-blue-100 text-blue-800";case"user":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return b?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading audit logs..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col space-y-4 sm:flex-row sm:items-center sm:justify-between sm:space-y-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Session Audit Logs"}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm sm:text-base",children:"Monitor all session-related activities and security events"})]}),e.jsxs("div",{className:"flex flex-col space-y-3 sm:flex-row sm:items-center sm:space-y-0 sm:space-x-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>{g(!0),h()},className:"flex-1 sm:flex-none inline-flex items-center justify-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:"Refresh logs",children:[e.jsx("svg",{className:"h-4 w-4 sm:mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v6h6M20 20v-6h-6M20 8a8 8 0 10-3.879 6.804"})}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),e.jsxs("button",{onClick:k,className:`flex-1 sm:flex-none inline-flex items-center justify-center px-3 py-2 border ${u?"border-green-300 text-green-700":"border-gray-300 text-gray-700"} shadow-sm text-sm leading-4 font-medium rounded-md bg-white hover:bg-gray-50`,title:"Auto refresh every 30s",children:[e.jsx("svg",{className:`h-4 w-4 sm:mr-2 ${u?"text-green-600":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"hidden sm:inline",children:u?"Auto: On":"Auto: Off"})]})]}),e.jsxs("div",{className:"text-center sm:text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Logs"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-blue-600",children:x}),p&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Updated ",p.toLocaleTimeString()]})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"action-filter",className:"block text-sm font-medium text-gray-700",children:"Action"}),e.jsxs("select",{id:"action-filter",value:t.action,onChange:s=>m({...t,action:s.target.value}),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",children:[e.jsx("option",{value:"",children:"All Actions"}),e.jsx("option",{value:"login",children:"Login"}),e.jsx("option",{value:"logout",children:"Logout"}),e.jsx("option",{value:"suspicious_login",children:"Suspicious Login"}),e.jsx("option",{value:"forced_logout",children:"Forced Logout"}),e.jsx("option",{value:"session_expired",children:"Session Expired"}),e.jsx("option",{value:"session_cleaned",children:"Session Cleaned"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"suspicious-filter",className:"block text-sm font-medium text-gray-700",children:"Suspicious Activity"}),e.jsxs("select",{id:"suspicious-filter",value:t.isSuspicious,onChange:s=>m({...t,isSuspicious:s.target.value}),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"true",children:"Suspicious Only"}),e.jsx("option",{value:"false",children:"Normal Only"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"user-filter",className:"block text-sm font-medium text-gray-700",children:"User ID"}),e.jsx("input",{type:"text",id:"user-filter",value:t.userId,onChange:s=>m({...t,userId:s.target.value}),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Enter user ID"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>m({action:"",isSuspicious:"",userId:""}),className:"w-full inline-flex justify-center items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Clear Filters"})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Audit Logs"})}),l.length===0?e.jsxs("div",{className:"px-6 py-12 text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No audit logs found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"No logs found for the selected filters."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Timestamp"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Device & IP"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(s=>{var a,o,n,f;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:L(s.timestamp)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8",children:e.jsx("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-gray-700",children:((o=(a=s.userId)==null?void 0:a.username)==null?void 0:o.charAt(0).toUpperCase())||"?"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((n=s.userId)==null?void 0:n.username)||"Unknown User"}),e.jsx("div",{className:"text-sm text-gray-500",children:((f=s.userId)==null?void 0:f.email)||"N/A"}),e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${C(s.role)}`,children:s.role})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${S(s.action)}`,children:s.action.replace("_"," ").toUpperCase()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.device}),e.jsx("div",{className:"text-gray-500",children:s.ip}),e.jsx("div",{className:"text-gray-500",children:s.location||"Unknown"})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("div",{className:"truncate",children:s.additionalInfo||"N/A"}),s.suspiciousReason&&e.jsxs("div",{className:"text-red-600 text-xs mt-1",children:["Reason: ",s.suspiciousReason]}),s.performedBy&&e.jsxs("div",{className:"text-gray-500 text-xs mt-1",children:["Performed by: ",s.performedBy.username]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.isSuspicious?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx("svg",{className:"w-2 h-2 mr-1",fill:"currentColor",viewBox:"0 0 8 8",children:e.jsx("circle",{cx:"4",cy:"4",r:"3"})}),"Suspicious"]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx("svg",{className:"w-2 h-2 mr-1",fill:"currentColor",viewBox:"0 0 8 8",children:e.jsx("circle",{cx:"4",cy:"4",r:"3"})}),"Normal"]})})]},s._id)})})]})})]}),x>50&&e.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6 mt-6 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>c(Math.max(1,r-1)),disabled:r===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>c(r+1),disabled:l.length<50,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing page ",e.jsx("span",{className:"font-medium",children:r})," of"," ",e.jsx("span",{className:"font-medium",children:Math.ceil(x/50)})]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[e.jsx("button",{onClick:()=>c(Math.max(1,r-1)),disabled:r===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>c(r+1),disabled:l.length<50,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:"Next"})]})})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-8 w-8 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Normal Activities"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:l.filter(s=>!s.isSuspicious).length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-8 w-8 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Suspicious Activities"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:l.filter(s=>s.isSuspicious).length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-8 w-8 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Logs"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:x})]})]})})]})]})})};export{B as default};
