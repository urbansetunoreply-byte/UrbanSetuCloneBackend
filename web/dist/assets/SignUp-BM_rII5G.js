import{u as ve,r as a,p as we,i as Se,j as e,G as Z,H as Pe,v as me,w as ue,I as Ce,J as Ee,K as ke,L as Y,M as Oe,C as Te,z,N as Re}from"./index-AwWxf1fH.js";import Ve from"./Oauth-BSWlNrx8.js";import{R as W}from"./RecaptchaWidget-BqjJeuRj.js";const G="https://urbansetu.onrender.com";function Le({bootstrapped:Q,sessionChecked:X}){ve("Sign Up - Join Our Community");const[l,xe]=a.useState({username:"",email:"",password:"",confirmPassword:"",role:"",mobileNumber:""}),[d,ge]=a.useState({score:0,level:"very-weak",feedback:[]}),[F,fe]=a.useState(!1),[$,he]=a.useState(!1),[ee,m]=a.useState(""),[f,E]=a.useState({email:"",mobileNumber:""}),[k,h]=a.useState(!1),[se,x]=a.useState(""),O=we(),{currentUser:T}=Se(s=>s.user),[te,pe]=a.useState(!1),[p,R]=a.useState(null),[ae,b]=a.useState(""),[L,q]=a.useState(0),[be,re]=a.useState(!1),w=a.useRef(null),[n,H]=a.useState(!1),[u,V]=a.useState(!1),[y,A]=a.useState(""),[o,le]=a.useState(!1),[g,ne]=a.useState(!1),[j,i]=a.useState(""),[N,ie]=a.useState(!1),[M,D]=a.useState(!1),[S,P]=a.useState(0),[oe,C]=a.useState(!0),[r,I]=a.useState(null),ye=s=>{const t=Re(s);ge(t)},J=s=>{R(s),b(""),re(!0),setTimeout(()=>re(!1),1e3),M&&setTimeout(()=>{D(!1),i("")},1e3)},U=()=>{R(null),b("reCAPTCHA expired. Please verify again."),q(s=>s+1)},_=s=>{R(null),b("reCAPTCHA verification failed. Please try again."),q(t=>t+1)},je=()=>{w.current&&w.current.reset(),R(null),b(""),q(s=>s+1)};a.useEffect(()=>{let s=null;return S>0&&(s=setInterval(()=>{P(t=>t<=1?(C(!0),0):t-1)},1e3)),()=>{s&&clearInterval(s)}},[S]);const v=s=>{const{id:t,value:B}=s.target;xe({...l,[t]:B}),(t==="email"||t==="mobileNumber")&&E(c=>({...c,[t]:""})),t==="email"&&(N?(H(!1),V(!1),A(""),i(""),P(0),C(!0),ie(!1)):n||(V(!1),A(""),i(""),P(0),C(!0))),t==="password"&&ye(B)},ce=async()=>{if(!l.email){i("Please enter an email address first");return}if(oe){le(!0),i("");try{const t=await(await z(`${G}/api/auth/send-otp`,{method:"POST",body:JSON.stringify({email:l.email,...p?{recaptchaToken:p}:{}})})).json();t.success?(V(!0),x("OTP sent successfully to your email"),setTimeout(()=>x(""),3e3),P(30),C(!1),D(!1)):(i(t.message),(t.requiresCaptcha||t.message&&t.message.toLowerCase().includes("recaptcha"))&&D(!0))}catch{i("Failed to send OTP. Please try again.")}finally{le(!1)}}},de=async()=>{if(!y){i("Please enter the OTP");return}ne(!0),i("");try{const t=await(await z(`${G}/api/auth/verify-otp`,{method:"POST",body:JSON.stringify({email:l.email,otp:y})})).json();t.success?(H(!0),x("Email verified successfully!"),setTimeout(()=>x(""),3e3)):i(t.message)}catch{i("Failed to verify OTP. Please try again.")}finally{ne(!1)}},Ne=async s=>{if(s.preventDefault(),!te){m("You must agree to the Terms of Use and Privacy Policy.");return}if(!n){m("Please verify your email address before creating an account.");return}if(!p){m("Please complete the reCAPTCHA verification.");return}if(h(!0),I("form"),m(""),x(""),E({email:"",mobileNumber:""}),b(""),l.password!==l.confirmPassword){m("Passwords are not matching"),h(!1);return}if(!l.role){m("Please select a role"),h(!1);return}try{const t=`${G}/api/auth/signup`,c=await(await z(t,{method:"POST",body:JSON.stringify({...l,emailVerified:!0,recaptchaToken:p})})).json();if(c.success===!1)c.message.includes("email already exists")?E(K=>({...K,email:c.message})):c.message.includes("mobile number already exists")?E(K=>({...K,mobileNumber:c.message})):c.message.includes("reCAPTCHA")?(b(c.message),je()):m(c.message),h(!1);else{m(""),h(!1),l.role==="admin"||l.role==="rootadmin"?x("Admin account created successfully. Please wait for an existing admin to approve your request."):x("Account created successfully, please sign in!"),setTimeout(()=>{x(""),O("/sign-in")},2e3);return}}catch(t){m(t.message),h(!1)}finally{I(null)}};return a.useEffect(()=>{Q&&X&&T&&(T.role==="admin"||T.role==="rootadmin"?O("/admin",{replace:!0}):O("/user",{replace:!0}))},[Q,X,T,O]),e.jsxs("div",{className:"min-h-screen flex",children:[e.jsxs("div",{className:"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-green-600 to-blue-700 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black opacity-20"}),e.jsx("div",{className:"relative z-10 flex flex-col justify-center items-center text-white p-12",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("h1",{className:"text-4xl font-bold mb-6 animate-fade-in",children:"Join Our Community"}),e.jsx("p",{className:"text-xl mb-8 leading-relaxed animate-fade-in-delay",children:`"Every house has a story. Let's write yours together."`}),e.jsxs("div",{className:"space-y-4 text-lg animate-fade-in-delay-2",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),e.jsx("span",{children:"Find Your Perfect Home"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"0.5s"}}),e.jsx("span",{children:"List Your Properties"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"1s"}}),e.jsx("span",{children:"Connect with Buyers & Sellers"})]})]})]})}),e.jsx("div",{className:"absolute top-20 left-20 w-16 h-16 bg-white bg-opacity-10 rounded-full animate-float"}),e.jsx("div",{className:"absolute bottom-32 right-16 w-12 h-12 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"2s"}}),e.jsx("div",{className:"absolute top-1/2 right-24 w-8 h-8 bg-white bg-opacity-10 rounded-full animate-float",style:{animationDelay:"1s"}}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black bg-opacity-20",children:e.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 100 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M10 2L2 8V18H18V8L10 2Z",fill:"white",fillOpacity:"0.1"}),e.jsx("path",{d:"M8 12H12V18H8V12Z",fill:"white",fillOpacity:"0.2"}),e.jsx("circle",{cx:"10",cy:"5",r:"1",fill:"white",fillOpacity:"0.3"}),e.jsx("path",{d:"M15 6L18 8V18H22V8L15 6Z",fill:"white",fillOpacity:"0.1"}),e.jsx("path",{d:"M17 12H20V18H17V12Z",fill:"white",fillOpacity:"0.2"})]})})]}),e.jsx("div",{className:"w-full lg:w-1/2 flex items-center justify-center p-4 sm:p-8 bg-gray-50",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-800 mb-2",children:"Create Account"}),e.jsx("p",{className:"text-gray-600 text-sm sm:text-base",children:"Join thousands of users finding their perfect homes"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-4 sm:p-8 border border-gray-100",children:[e.jsxs("form",{onSubmit:Ne,className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-2",children:["Full Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",placeholder:"Enter your full name",id:"username",onChange:v,disabled:r==="google",className:`w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${r==="google"?"bg-gray-100 cursor-not-allowed":""}`,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:["Email Address ",e.jsx("span",{className:"text-red-500",children:"*"}),n&&e.jsx("span",{className:"ml-2 text-green-600",children:e.jsx(Z,{className:"inline"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"email",placeholder:"Enter your email",id:"email",value:l.email,onChange:v,readOnly:(n||u)&&!N||o,className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${(n||u)&&!N||o?"bg-gray-100 cursor-not-allowed border-green-500":f.email?"border-red-500":n?"border-green-500":"border-gray-300"} ${r==="google"?"bg-gray-100 cursor-not-allowed":""}`,disabled:r==="google"||(n||u)&&!N||o,required:!0}),f.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.email}),!n&&!u&&e.jsx("button",{type:"button",onClick:ce,disabled:o||!oe||!l.email,className:"absolute right-3 top-1/2 -translate-y-1/2 px-3 py-1 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Sending...":"Send OTP"}),(n||u&&!n)&&!N&&e.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{ie(!0),V(!1),A(""),C(!0),P(0),H(!1)},className:"text-blue-600 hover:text-blue-800 transition-colors duration-200 p-1 rounded hover:bg-blue-50",title:"Edit email",children:e.jsx(Pe,{className:"text-sm"})}),e.jsx("div",{className:"text-green-600",children:e.jsx(Z,{className:"text-xl"})})]}),n&&N&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"text-green-600",children:e.jsx(Z,{className:"text-xl"})})})]}),u&&!n&&e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["OTP sent to ",l.email]}),j&&!u&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:j}),M&&!u&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(W,{ref:w,onVerify:J,onExpire:U,onError:_,disabled:o,className:"transform scale-90"},`signup-otp-email-${L}`)}),j&&e.jsx("p",{className:"text-red-500 text-sm mt-2 text-center",children:j})]})]}),u&&!n&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"otp",className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter OTP"}),e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx("input",{type:"text",placeholder:"Enter 6-digit OTP",id:"otp",value:y,disabled:g,onChange:s=>{const t=s.target.value.replace(/[^0-9]/g,"");A(t)},onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),y&&y.length===6&&!g&&de())},className:`flex-1 px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 text-sm sm:text-base ${g?"bg-gray-100 cursor-not-allowed":""}`,maxLength:"6"}),e.jsx("button",{type:"button",onClick:de,disabled:g||y.length!==6,className:"px-3 py-2 sm:px-4 sm:py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 text-sm sm:text-base whitespace-nowrap",children:g?"Verifying...":"Verify"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Enter the 6-digit code sent to your email"}),e.jsx("div",{className:"flex items-center gap-2",children:S>0?e.jsxs("span",{className:"text-xs text-gray-500",children:["Resend in ",Math.floor(S/60),":",(S%60).toString().padStart(2,"0")]}):e.jsx("button",{type:"button",onClick:ce,disabled:o||g,className:"text-xs text-blue-600 hover:text-blue-800 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Sending...":"Resend OTP"})})]}),j&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:j}),M&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsx(W,{ref:w,onVerify:J,onExpire:U,onError:_,disabled:o,className:"transform scale-90"},`otp-${L}`)})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"mobileNumber",className:"block text-sm font-medium text-gray-700 mb-2",children:["Mobile Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",placeholder:"Enter 10-digit mobile number",id:"mobileNumber",onChange:s=>{const t=s.target.value.replace(/[^0-9]/g,"");v({target:{id:"mobileNumber",value:t}})},value:l.mobileNumber||"",inputMode:"numeric",pattern:"[0-9]{10}",maxLength:"10",className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${f.mobileNumber?"border-red-500":"border-gray-300"} ${r==="google"?"bg-gray-100 cursor-not-allowed":""}`,disabled:r==="google",required:!0}),f.mobileNumber&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:f.mobileNumber})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-2",children:["I want to ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"role",onChange:v,disabled:r==="google",className:`w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${r==="google"?"bg-gray-100 cursor-not-allowed":""}`,required:!0,children:[e.jsx("option",{value:"",children:"Select your role"}),e.jsx("option",{value:"user",children:"Buy/Sell Properties"}),e.jsx("option",{value:"admin",children:"Manage Platform (Admin)"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:["Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:F?"text":"password",placeholder:"Create a strong password",id:"password",onChange:v,disabled:r==="google",className:`w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${r==="google"?"bg-gray-100 cursor-not-allowed":""}`,required:!0}),e.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:()=>fe(!F),children:F?e.jsx(me,{className:"text-gray-600"}):e.jsx(ue,{className:"text-gray-600"})})]})]}),l.password&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Password Strength:"}),e.jsx("span",{className:`text-sm font-semibold ${Ee(d.level)}`,children:Ce(d.level)})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${d.level==="very-weak"?"bg-red-500 w-1/5":d.level==="weak"?"bg-red-400 w-2/5":d.level==="medium"?"bg-yellow-400 w-3/5":d.level==="strong"?"bg-green-400 w-4/5":"bg-green-500 w-full"}`})}),d.feedback.length>0&&e.jsxs("div",{className:`p-3 rounded-lg ${ke(d.level)}`,children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"To improve your password:"}),e.jsx("ul",{className:"text-xs space-y-1",children:d.feedback.map((s,t)=>e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2",children:"â€¢"}),s]},t))})]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Use a unique password for this account"]}),e.jsxs("p",{children:["ðŸ”’ ",e.jsx("strong",{children:"Security:"})," Consider using a password manager"]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:["Confirm Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:$?"text":"password",placeholder:"Confirm your password",id:"confirmPassword",onChange:v,disabled:r==="google",className:`w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 ${r==="google"?"bg-gray-100 cursor-not-allowed":""}`,required:!0}),e.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:()=>he(!$),children:$?e.jsx(me,{className:"text-gray-600"}):e.jsx(ue,{className:"text-gray-600"})})]})]}),e.jsxs("div",{className:"flex items-start mb-2",children:[e.jsx("input",{type:"checkbox",id:"consent",checked:te,onChange:s=>pe(s.target.checked),disabled:r==="google",className:`mt-1 mr-2 ${r==="google"?"opacity-50 cursor-not-allowed":""}`,required:!0}),e.jsxs("label",{htmlFor:"consent",className:"text-sm text-gray-700 select-none",children:["I agree to the ",e.jsx(Y,{to:"/terms",className:"text-blue-600 hover:underline",target:"_blank",rel:"noopener noreferrer",onClick:s=>{s.preventDefault(),window.open("/terms","_blank","noopener,noreferrer")},children:"Terms of Use"})," and ",e.jsx(Y,{to:"/privacy",className:"text-blue-600 hover:underline",target:"_blank",rel:"noopener noreferrer",onClick:s=>{s.preventDefault(),window.open("/privacy","_blank","noopener,noreferrer")},children:"Privacy Policy"}),"."]})]}),(!p||be)&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(W,{ref:w,onVerify:J,onExpire:U,onError:_,disabled:k,className:"transform scale-90"},L)}),ae&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:e.jsx("p",{className:"text-red-600 text-sm",children:ae})}),e.jsx("button",{disabled:k||!Oe(l.password)||!n||!p||r==="google",className:"w-full py-3 px-4 bg-gradient-to-r from-green-600 to-blue-600 text-white font-semibold rounded-lg hover:from-green-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105",children:k?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Creating Account..."]}):"Create Account"}),se&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mt-4",children:e.jsx("p",{className:"text-green-700 text-sm font-semibold",children:se})}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"OR"})})]}),e.jsx(Ve,{pageType:"signUp",disabled:r!==null,onAuthStart:I}),ee&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-600 text-sm",children:ee})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600",children:["Already have an account?"," ",e.jsx(Y,{to:"/sign-in",className:`text-blue-600 hover:text-blue-800 font-semibold hover:underline transition-colors duration-200 ${r!==null||k||o||g?"opacity-50 cursor-not-allowed pointer-events-none":""}`,children:"Sign In"})]})})]})]})}),e.jsx(Te,{})]})}export{Le as default};
