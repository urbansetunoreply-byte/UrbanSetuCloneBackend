import{u as W,r as m,i as H,p as _,P as J,o as K,j as e,y as L}from"./index-C5FYe_cc.js";import{L as Y}from"./LocationSelector-CD0rQlAB.js";import"./countries_states_cities-CCOM4uJJ.js";const N="https://urbansetu.onrender.com";function ee(){W("Edit Listing - Update Property");const[a,u]=m.useState({imageUrls:[],videoUrls:[],name:"",description:"",propertyNumber:"",landmark:"",city:"",state:"",pincode:"",address:"",type:"sale",bedrooms:1,bathrooms:1,regularPrice:0,discountPrice:0,offer:!1,parking:!1,furnished:!1,locationLink:"",area:"",floor:"",propertyAge:""}),[E,d]=m.useState(""),[w,U]=m.useState(!1),[f,p]=m.useState({}),[y,P]=m.useState({}),[b,h]=m.useState({}),[j,k]=m.useState({}),{currentUser:g}=H(s=>s.user),S=_(),C=J(),q=K(),[I,M]=m.useState(!1),[v,F]=m.useState({state:"",district:"",city:"",cities:[]}),V=()=>{var t;const s=(t=q.state)==null?void 0:t.from;return s||(g.role==="admin"||g.role==="rootadmin"?"/admin/my-listings":"/user/my-listings")};m.useEffect(()=>{(async()=>{const t=C.listingId,r=`${N}/api/listing/get/${t}`,l=await(await fetch(r,{credentials:"include"})).json();if(l.success===!1){d(l.message);return}u({...a,...l}),F({state:l.state||"",district:l.district||"",city:l.city||"",cities:[]})})()},[C.listingId]),m.useEffect(()=>{u(s=>({...s,state:v.state,city:v.city||""}))},[v]);const A=s=>{if(!s)return!0;try{new URL(s)}catch{return!1}const r=[".jpg",".jpeg",".png",".gif",".webp",".svg"].some(l=>s.toLowerCase().includes(l)),o=s.includes("cloudinary.com");return r||s.includes("images")||s.includes("img")||o},D=s=>{if(!s)return!0;try{new URL(s)}catch{return!1}const r=[".mp4",".webm",".ogg",".mov",".mkv"].some(l=>s.toLowerCase().includes(l)),o=s.includes("cloudinary.com");return r||s.includes("video")||o},$=(s,t)=>{const r=[...a.imageUrls];r[s]=t,u({...a,imageUrls:r});const o={...f};t&&!A(t)?o[s]="Please enter a valid image URL":delete o[s],p(o)},R=s=>{u({...a,imageUrls:a.imageUrls.filter((o,l)=>l!==s)});const t={...f};delete t[s],p(t);const r={...y};delete r[s],P(r)},B=s=>{u({...a,videoUrls:a.videoUrls.filter((o,l)=>l!==s)});const t={...b};delete t[s],h(t);const r={...j};delete r[s],k(r)},O=async(s,t)=>{if(t){if(!t.type.startsWith("image/")){p(r=>({...r,[s]:"Please select an image file"}));return}if(t.size>5*1024*1024){p(r=>({...r,[s]:"File size must be less than 5MB"}));return}P(r=>({...r,[s]:!0})),p(r=>({...r,[s]:""}));try{const r=new FormData;r.append("image",t);const o=await fetch(`${N}/api/upload/image`,{method:"POST",credentials:"include",body:r}),l=await o.json();if(o.ok){const i=[...a.imageUrls];i[s]=l.imageUrl,u(c=>({...c,imageUrls:i})),p(c=>{const x={...c};return delete x[s],x})}else p(i=>({...i,[s]:l.message||"Upload failed"}))}catch(r){console.error("Upload error:",r),p(o=>({...o,[s]:"Upload failed. Please try again."}))}finally{P(r=>({...r,[s]:!1}))}}},G=(s,t)=>{const r=[...a.videoUrls];r[s]=t,u({...a,videoUrls:r});const o={...b};t&&!D(t)?o[s]="Please enter a valid video URL":delete o[s],h(o)},T=async(s,t)=>{if(t){if(!t.type.startsWith("video/")){h(r=>({...r,[s]:"Please select a video file"}));return}if(t.size>5*1024*1024){h(r=>({...r,[s]:"File size must be less than 5MB"}));return}k(r=>({...r,[s]:!0})),h(r=>({...r,[s]:""}));try{const r=new FormData;r.append("video",t);const o=await fetch(`${N}/api/upload/video`,{method:"POST",credentials:"include",body:r}),l=await o.json();if(o.ok){const i=[...a.videoUrls];i[s]=l.videoUrl,u(c=>({...c,videoUrls:i})),h(c=>{const x={...c};return delete x[s],x})}else h(i=>({...i,[s]:l.message||"Upload failed"}))}catch(r){console.error("Video upload error:",r),h(o=>({...o,[s]:"Upload failed. Please try again."}))}finally{k(r=>({...r,[s]:!1}))}}},n=s=>{const{id:t,value:r,checked:o,type:l,name:i}=s.target;let c=l==="checkbox"?o:r;["regularPrice","discountPrice","bedrooms","bathrooms"].includes(t)&&(c=Number(r)),u({...a,[i||t]:c})},z=async s=>{if(s.preventDefault(),!a.type)return d("Please select a listing type (Sale or Rent)");if(a.regularPrice<a.discountPrice)return d("Discount price should be less than regular price");if(!a.propertyNumber)return d("Property number is required");if(!a.city)return d("City is required");if(!a.state)return d("State is required");if(!a.pincode)return d("Pincode is required");if(Object.keys(f).length>0)return d("Please fix the image URL errors before submitting");if(Object.keys(b).length>0)return d("Please fix the video URL errors before submitting");if(g.role!=="admin"&&g.role!=="rootadmin"&&!I)return d("You must confirm that the data provided is genuine.");U(!0),d("");try{const t=`${N}/api/listing/update/${C.listingId}`;let r=a;g.role==="admin"||g.role==="rootadmin"?r=a:r={...a,userRef:g._id};const o={method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(r)},l=await fetch(t,o),i=await l.json();if(l.ok)L.success(i.message||"Property Details Updated Successfully!!"),S(V());else{const c=i.message||"Failed to update listing";d(c),L.error(c)}U(!1)}catch(t){const r=t.message||"An error occurred while updating the listing";d(r),L.error(r),U(!1)}};return e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:[e.jsx("h3",{className:"text-3xl font-extrabold text-blue-700 mb-6 text-center drop-shadow",children:"Edit Listing"}),e.jsxs("form",{onSubmit:z,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Basic Information"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("input",{type:"text",id:"name",placeholder:"Property Name",required:!0,onChange:n,value:a.name,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("textarea",{id:"description",placeholder:"Property Description",required:!0,onChange:n,value:a.description,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mt-4 resize-y",rows:4})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Address Information"}),e.jsx("div",{className:"mb-4",children:e.jsx(Y,{value:v,onChange:F,mode:"form"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",id:"propertyNumber",placeholder:"Property Number/Flat Number",required:!0,onChange:n,value:a.propertyNumber,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",id:"landmark",placeholder:"Landmark (optional)",onChange:n,value:a.landmark,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",id:"pincode",placeholder:"Pincode",required:!0,onChange:n,value:a.pincode,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",id:"locationLink",placeholder:"Google Maps Location Link (Optional)",onChange:n,value:a.locationLink,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Type"}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 p-3 bg-white rounded-lg shadow-sm",children:[e.jsx("input",{type:"radio",name:"type",value:"sale",onChange:n,checked:a.type==="sale",className:"text-blue-600"}),e.jsx("span",{className:"font-medium",children:"For Sale"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-3 bg-white rounded-lg shadow-sm",children:[e.jsx("input",{type:"radio",name:"type",value:"rent",onChange:n,checked:a.type==="rent",className:"text-blue-600"}),e.jsx("span",{className:"font-medium",children:"For Rent"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Area (sq ft) *"}),e.jsx("input",{type:"number",id:"area",placeholder:"Enter property area in square feet",required:!0,onChange:n,value:a.area,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Area refers to the total built-up area of the property including all rooms, kitchen, bathrooms, and common areas"})]})}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Floor Number *"}),e.jsx("input",{type:"number",id:"floor",placeholder:"Enter floor number (e.g., 0, 1, 2...)",required:!0,min:"0",onChange:n,value:a.floor,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Floor number refers to which floor the property is located on (Ground floor = 0, First floor = 1, Second floor = 2, etc.)"})]})}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Property Age (years) *"}),e.jsx("input",{type:"number",id:"propertyAge",placeholder:"Enter property age in years (0 for new construction)",required:!0,min:"0",onChange:n,value:a.propertyAge,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Property age refers to how many years ago the property was constructed/built"})]})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Details"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Bedrooms"}),e.jsx("input",{type:"number",id:"bedrooms",onChange:n,value:a.bedrooms,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Bathrooms"}),e.jsx("input",{type:"number",id:"bathrooms",onChange:n,value:a.bathrooms,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Regular Price (₹)"}),e.jsx("input",{type:"number",id:"regularPrice",onChange:n,value:a.regularPrice,placeholder:"Enter price",className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Discount Price (₹)"}),e.jsx("input",{type:"number",id:"discountPrice",onChange:n,value:a.discountPrice,placeholder:"Enter discount",className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Features"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:["parking","furnished","offer"].map(s=>e.jsxs("label",{className:"flex items-center space-x-2 p-3 bg-white rounded-lg shadow-sm",children:[e.jsx("input",{type:"checkbox",id:s,onChange:n,checked:a[s],className:"text-blue-600"}),e.jsx("span",{className:"text-gray-700 font-medium capitalize",children:s})]},s))})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Images"}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:"Upload images directly or add image URLs. Supported formats: JPG, PNG, GIF, WebP, SVG (max 5MB per image)"}),e.jsxs("div",{className:"space-y-3",children:[a.imageUrls.map((s,t)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",placeholder:`Image URL ${t+1} (e.g., https://example.com/image.jpg)`,value:s||"",onChange:r=>$(t,r.target.value),className:`flex-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${f[t]?"border-red-500":""}`}),e.jsxs("label",{className:`p-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-all flex items-center gap-2 ${y[t]?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:r=>O(t,r.target.files[0]),disabled:y[t]}),y[t]?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"text-sm text-gray-600",children:"Upload"})]})]}),e.jsx("button",{type:"button",onClick:()=>R(t),className:"bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition",title:"Remove this photo",children:"×"})]}),f[t]&&e.jsx("p",{className:"text-red-500 text-sm",children:f[t]})]},t)),e.jsx("button",{type:"button",onClick:()=>u({...a,imageUrls:[...a.imageUrls,""]}),className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition mt-2",children:"Add Photo"})]}),a.imageUrls.some(s=>s)&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-2",children:"Image Preview:"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:a.imageUrls.map((s,t)=>s&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s,alt:"listing",className:"w-full h-24 object-cover rounded-lg",onError:r=>{r.target.src="https://via.placeholder.com/400x300?text=Image+Not+Found",r.target.className="w-full h-24 object-cover rounded-lg opacity-50"}}),e.jsx("button",{onClick:()=>R(t),type:"button",className:"absolute top-0 right-0 bg-red-500 text-white text-xs px-2 py-1 rounded-full hover:bg-red-600 transition",children:"×"})]},s))})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Videos"}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:"Upload videos directly or add video URLs. Supported formats: MP4, WebM, OGG, MOV, MKV (max 5MB per video)"}),e.jsxs("div",{className:"space-y-3",children:[a.videoUrls.map((s,t)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",placeholder:`Video URL ${t+1} (e.g., https://example.com/video.mp4)`,value:s||"",onChange:r=>G(t,r.target.value),className:`flex-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${b[t]?"border-red-500":""}`}),e.jsxs("label",{className:`p-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-all flex items-center gap-2 ${j[t]?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("input",{type:"file",accept:"video/*",className:"hidden",onChange:r=>T(t,r.target.files[0]),disabled:j[t]}),j[t]?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"text-sm text-gray-600",children:"Upload"})]})]}),e.jsx("button",{type:"button",onClick:()=>B(t),className:"bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition",title:"Remove this video",children:"×"})]}),b[t]&&e.jsx("p",{className:"text-red-500 text-sm",children:b[t]}),s&&e.jsx("div",{className:"w-full rounded-lg overflow-hidden bg-black",children:e.jsx("div",{className:"relative w-full",style:{paddingTop:"56.25%"},children:e.jsx("video",{src:s,className:"absolute inset-0 w-full h-full object-contain bg-black",controls:!0})})})]},t)),e.jsx("button",{type:"button",onClick:()=>u({...a,videoUrls:[...a.videoUrls,""]}),className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition mt-2",children:"Add Video"})]})]}),g.role!=="admin"&&g.role!=="rootadmin"&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",id:"consent",checked:I,onChange:s=>M(s.target.checked),className:"accent-blue-600 w-4 h-4",required:!0}),e.jsxs("label",{htmlFor:"consent",className:"text-sm text-gray-700 select-none",children:["I confirm that ",e.jsx("span",{className:"font-semibold text-blue-700",children:"all the information provided in this listing is true and genuine to the best of my knowledge"}),". Providing false information may result in account suspension or legal action."]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:()=>S(V()),disabled:w,className:"flex-1 bg-gray-500 text-white p-3 rounded-lg hover:bg-gray-600 transition-all transform hover:scale-105 shadow-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:w,className:"flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white p-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:w?"Updating...":"Update Listing"})]}),E&&e.jsx("p",{className:"text-red-500 text-center",children:E})]})]})})}export{ee as default};
