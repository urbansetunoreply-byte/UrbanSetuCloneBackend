import{u as C,i as L,r as i,y as n,j as e}from"./index-DFkuEFH9.js";const R=()=>{C("Device Management - Security Settings");const{currentUser:d}=L(s=>s.user),[a,y]=i.useState([]),[w,m]=i.useState(!0),[u,x]=i.useState(null),[h,N]=i.useState(null),[c,b]=i.useState(!1),o=i.useRef(null);i.useEffect(()=>(l(),()=>{o.current&&clearInterval(o.current)}),[]);const l=async()=>{try{const s=new AbortController,t=await fetch("https://urbansetu.onrender.com/api/session-management/my-sessions",{credentials:"include",headers:{"Content-Type":"application/json"},signal:s.signal});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();r.success?(y(r.sessions),N(new Date)):n.error(r.message||"Failed to fetch sessions")}catch(s){console.error("Error fetching sessions:",s),n.error("Failed to fetch sessions")}finally{m(!1)}},k=()=>{b(s=>{const t=!s;return t?o.current=setInterval(()=>{l()},3e4):o.current&&(clearInterval(o.current),o.current=null),t})},S=async s=>{var t;x(s);try{const r=await fetch("https://urbansetu.onrender.com/api/session-management/revoke-session",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:s})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const v=await r.json();if(v.success){n.success("Session revoked successfully");const p=(t=document.cookie.split("; ").find(j=>j.startsWith("session_id=")))==null?void 0:t.split("=")[1];if(p&&p===s){try{localStorage.removeItem("accessToken")}catch{}document.cookie="access_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="refresh_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="session_id=; Max-Age=0; path=/; SameSite=None; Secure",window.location.href="/sign-in?error=session_revoked";return}l()}else n.error(v.message||"Failed to revoke session")}catch(r){console.error("Error revoking session:",r),n.error("Failed to revoke session")}finally{x(null)}},M=async()=>{if(window.confirm("Are you sure you want to log out all devices? This will log you out of all sessions except the current one."))try{const s=await fetch("https://urbansetu.onrender.com/api/session-management/revoke-all-sessions",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const t=await s.json();if(t.success){n.success(t.message);try{localStorage.removeItem("accessToken")}catch{}document.cookie="access_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="refresh_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="session_id=; Max-Age=0; path=/; SameSite=None; Secure",window.location.href="/sign-in?error=all_sessions_revoked"}else n.error(t.message||"Failed to revoke sessions")}catch(s){console.error("Error revoking all sessions:",s),n.error("Failed to revoke all sessions")}},f=s=>new Date(s).toLocaleString(),A=s=>s.includes("Mobile")||s.includes("Android")||s.includes("iPhone")||s.includes("iPad")?"ðŸ“±":s.includes("Windows")||s.includes("Mac")?"ðŸ’»":s.includes("Linux")?"ðŸ–¥ï¸":"ðŸ’»",g=()=>{if(!d)return 5;switch(d.role){case"rootadmin":return 1;case"admin":return 2;case"user":default:return 5}};return w?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading sessions..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col space-y-4 sm:flex-row sm:items-center sm:justify-between sm:space-y-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Device Management"}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm sm:text-base",children:"Manage your active login sessions and devices"})]}),e.jsxs("div",{className:"flex flex-col space-y-3 sm:flex-row sm:items-center sm:space-y-0 sm:space-x-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>{m(!0),l()},className:"flex-1 sm:flex-none inline-flex items-center justify-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:"Refresh sessions",children:[e.jsx("svg",{className:"h-4 w-4 sm:mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v6h6M20 20v-6h-6M20 8a8 8 0 10-3.879 6.804"})}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),e.jsxs("button",{onClick:k,className:`flex-1 sm:flex-none inline-flex items-center justify-center px-3 py-2 border ${c?"border-green-300 text-green-700":"border-gray-300 text-gray-700"} shadow-sm text-sm leading-4 font-medium rounded-md bg-white hover:bg-gray-50`,title:"Auto refresh every 30s",children:[e.jsx("svg",{className:`h-4 w-4 sm:mr-2 ${c?"text-green-600":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"hidden sm:inline",children:c?"Auto: On":"Auto: Off"})]})]}),e.jsxs("div",{className:"text-center sm:text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Active Sessions"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-blue-600",children:a.length}),h&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Updated ",h.toLocaleTimeString()]})]})]})]})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-700",children:["You can have up to ",e.jsxs("strong",{children:[g()," active session",g()!==1?"s":""]})," at a time. If you exceed this limit, the oldest sessions will be automatically logged out."]})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Active Sessions"}),a.length>1&&e.jsxs("button",{onClick:M,className:"inline-flex items-center px-3 py-2 border border-red-300 shadow-sm text-sm leading-4 font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[e.jsx("svg",{className:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"Logout All Others"]})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:a.length===0?e.jsxs("div",{className:"px-6 py-12 text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No active sessions"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"You don't have any active sessions right now."})]}):a.map((s,t)=>e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("span",{className:"text-2xl",children:A(s.device)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s.isCurrent?`${s.device} (This Device)`:s.device})}),e.jsxs("div",{className:"mt-1 text-sm text-gray-500",children:[e.jsxs("p",{children:["IP Address: ",s.ip]}),e.jsxs("p",{children:["Location: ",s.location]}),e.jsxs("p",{children:["Last Active: ",f(s.lastActive)]}),e.jsxs("p",{children:["Login Time: ",f(s.loginTime)]})]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:!s.isCurrent&&e.jsx("button",{onClick:()=>S(s.sessionId),disabled:u===s.sessionId,className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:u===s.sessionId?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Revoking..."]}):"Revoke"})})]})},s.sessionId))})]}),e.jsx("div",{className:"mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.726-1.36 3.491 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Security Tips"}),e.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Regularly review your active sessions and revoke any you don't recognize"}),e.jsx("li",{children:"Always log out from shared or public computers"}),e.jsx("li",{children:"If you notice suspicious activity, change your password immediately"}),e.jsx("li",{children:"Consider using a password manager for better security"})]})})]})]})})]})})};export{R as default};
