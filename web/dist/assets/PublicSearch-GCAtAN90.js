import{u as L,o as C,p as A,r as i,j as e,q as T,C as _}from"./index-C5FYe_cc.js";import{L as E}from"./ListingItem-w7rjcaHu.js";import{d as $}from"./countries_states_cities-CCOM4uJJ.js";import"./addressMasking-3vIUwCOC.js";const j="https://urbansetu.onrender.com";function B(){L("Search Properties - Find Your Dream Home");const d=C(),y=A(),[r,l]=i.useState({searchTerm:"",type:"all",parking:!1,furnished:!1,offer:!1,sort:"createdAt",order:"desc",minPrice:"",maxPrice:"",city:"",state:"",bedrooms:"",bathrooms:""}),[c,m]=i.useState([]),[h,x]=i.useState(!1),[v,u]=i.useState(!1),[g,p]=i.useState(null),[f,b]=i.useState({state:"",district:"",city:""});i.useEffect(()=>{const t=new URLSearchParams(d.search);l({searchTerm:t.get("searchTerm")||"",type:t.get("type")||"all",parking:t.get("parking")==="true",furnished:t.get("furnished")==="true",offer:t.get("offer")==="true",sort:t.get("sort")||"createdAt",order:t.get("order")||"desc",minPrice:t.get("minPrice")||"",maxPrice:t.get("maxPrice")||"",city:"",state:t.get("state")||"",bedrooms:t.get("bedrooms")||"",bathrooms:t.get("bathrooms")||""}),b({state:t.get("state")||"",district:t.get("district")||"",city:""}),(async()=>{x(!0),p(null);try{const s=await fetch(`${j}/api/listing/get?${t.toString()}`);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const o=await s.json();m(Array.isArray(o)?o:[]),u(Array.isArray(o)&&o.length>8)}catch(s){console.error("Error fetching listings:",s),p("Failed to load listings. Please try again."),m([]),u(!1)}x(!1)})()},[d.search]);const n=t=>{const{name:a,value:s,checked:o,type:k}=t.target;l(S=>({...S,[a]:k==="checkbox"?o:s}))},w=t=>{t.preventDefault();const a=new URLSearchParams(r);y(`?${a.toString()}`)},N=async()=>{try{const t=new URLSearchParams(d.search);t.set("startIndex",c.length);const a=await fetch(`${j}/api/listing/get?${t.toString()}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=await a.json();Array.isArray(s)&&(m(o=>[...o,...s]),u(s.length>=8))}catch(t){console.error("Error fetching more listings:",t)}},P=t=>{const a={...t,city:""};b(a),l(s=>({...s,state:t.state,district:t.district,city:""}))};return h?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading properties..."})]})}):e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:[e.jsxs("div",{className:"max-w-6xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:[e.jsx("h3",{className:"text-3xl font-extrabold text-blue-700 mb-6 text-center drop-shadow",children:"Explore Properties"}),e.jsxs("form",{onSubmit:w,className:"grid md:grid-cols-2 gap-4 bg-gray-100 p-4 rounded-lg mb-6",children:[e.jsx("input",{type:"text",name:"searchTerm",placeholder:"Search...",value:r.searchTerm,onChange:n,className:"p-2 border rounded-md w-full"}),e.jsxs("select",{name:"sort_order",onChange:t=>{const[a,s]=t.target.value.split("_");l(o=>({...o,sort:a,order:s}))},value:`${r.sort}_${r.order}`,className:"p-2 border rounded-md w-full",children:[e.jsx("option",{value:"regularPrice_desc",children:"Price high to low"}),e.jsx("option",{value:"regularPrice_asc",children:"Price low to high"}),e.jsx("option",{value:"createdAt_desc",children:"Latest"}),e.jsx("option",{value:"createdAt_asc",children:"Oldest"})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold text-gray-700",children:"State"}),e.jsxs("select",{className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500",value:f.state||"",onChange:t=>P({...f,state:t.target.value,city:""}),children:[e.jsx("option",{value:"",children:"Select State"}),(()=>{const t=$.find(s=>s.name==="India");return(t?t.states:[]).map(s=>e.jsx("option",{value:s.name,children:s.name},s.state_code))})()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-semibold text-gray-700 text-gray-400",children:"City (Not Available)"}),e.jsx("select",{className:"w-full p-2 border rounded-md bg-gray-100 text-gray-500 cursor-not-allowed",disabled:!0,children:e.jsx("option",{value:"",children:"City filter disabled"})})]})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"type",value:"all",checked:r.type==="all",onChange:n})," ","All"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"type",value:"rent",checked:r.type==="rent",onChange:n})," ","Rent"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"type",value:"sale",checked:r.type==="sale",onChange:n})," ","Sale"]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"parking",onChange:n,checked:r.parking})," ","Parking"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"furnished",onChange:n,checked:r.furnished})," ","Furnished"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"offer",onChange:n,checked:r.offer})," ","Offer"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",name:"minPrice",placeholder:"Min Price",value:r.minPrice,onChange:n,className:"p-2 border rounded-md w-full",min:0}),e.jsx("input",{type:"number",name:"maxPrice",placeholder:"Max Price",value:r.maxPrice,onChange:n,className:"p-2 border rounded-md w-full",min:0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",name:"bedrooms",placeholder:"Bedrooms",value:r.bedrooms,onChange:n,className:"p-2 border rounded-md w-full",min:1}),e.jsx("input",{type:"number",name:"bathrooms",placeholder:"Bathrooms",value:r.bathrooms,onChange:n,className:"p-2 border rounded-md w-full",min:1})]}),e.jsxs("button",{type:"submit",className:"w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-4-4m0 0A7 7 0 104 4a7 7 0 0013 13z"})}),"Search"]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Listings"}),h&&e.jsx("p",{className:"text-center text-lg font-semibold text-blue-600 animate-pulse",children:"Loading..."}),g&&e.jsx("p",{className:"text-center text-red-600 text-lg mb-4",children:g}),!h&&!g&&c.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("img",{src:T,alt:"No listings found",className:"w-72 h-72 object-contain mx-auto mb-0"}),e.jsx("h3",{className:"text-xl font-bold text-gray-700 mb-2",children:"No Listings Found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Try adjusting your search criteria or filters"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:c&&c.map(t=>e.jsx(E,{listing:t},t._id))}),v&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx("button",{type:"button",onClick:N,className:"mt-4 bg-gray-600 text-white p-2 rounded-md w-500",children:"Show More"})})]})]}),e.jsx(_,{})]})}export{B as default};
