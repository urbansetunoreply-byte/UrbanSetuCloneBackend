import{r as c,u as k,k as C,j as e,C as _,H as d}from"./index-WPqAAPOK.js";const p="https://urbansetu.onrender.com",D=()=>{const[l,m]=c.useState([]),[f,u]=c.useState(!0),[h,v]=c.useState(null),[n,b]=c.useState("all"),{currentUser:s}=k(t=>t.user),x=C();c.useEffect(()=>{if(s){if(s.role!=="admin"&&s.role!=="rootadmin"&&!s.isDefaultAdmin){x("/sign-in");return}y()}},[s,x]);const y=async()=>{try{u(!0);const t=await fetch(`${p}/api/admin/all-requests`,{headers:{"Content-Type":"application/json"},credentials:"include"}),r=await t.json();if(!t.ok)throw new Error(r.message||"Failed to fetch requests");m(r)}catch(t){v(t.message)}finally{u(!1)}},N=async t=>{try{const r=await fetch(`${p}/api/admin/approve/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({currentUserId:s._id,rootAdminPassword:"Salendra@2004"})}),i=await r.json();if(!r.ok)throw new Error(i.message||"Failed to approve request");m(o=>o.map(a=>a._id===t?{...a,adminApprovalStatus:"approved",role:"admin"}:a)),d.success("Admin request approved successfully!")}catch(r){d.error(r.message)}},w=async t=>{try{const r=await fetch(`${p}/api/admin/reject/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({currentUserId:s._id,rootAdminPassword:"Salendra@2004"})}),i=await r.json();if(!r.ok)throw new Error(i.message||"Failed to reject request");m(o=>o.map(a=>a._id===t?{...a,adminApprovalStatus:"rejected",role:"user"}:a)),d.success("Admin request rejected successfully!")}catch(r){d.error(r.message)}},A=async t=>{try{const r=await fetch(`${p}/api/admin/reapprove/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({currentUserId:s._id,rootAdminPassword:"Salendra@2004"})}),i=await r.json();if(!r.ok)throw new Error(i.message||"Failed to reapprove request");m(o=>o.map(a=>a._id===t?{...a,adminApprovalStatus:"approved",role:"admin"}:a)),d.success("Admin request reapproved successfully!")}catch(r){d.error(r.message)}},g=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),j=l.filter(t=>n==="all"?!0:n==="pending"?t.adminApprovalStatus==="pending":n==="approved"?t.adminApprovalStatus==="approved":n==="rejected"?t.adminApprovalStatus==="rejected":!0),S=t=>{switch(t){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"approved":return"bg-green-100 text-green-800 border-green-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},R=t=>t.adminApprovalStatus==="pending"?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>N(t._id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center space-x-2",children:[e.jsx("span",{children:"âœ“"}),e.jsx("span",{children:"Approve"})]}),e.jsxs("button",{onClick:()=>w(t._id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center space-x-2",children:[e.jsx("span",{children:"âœ•"}),e.jsx("span",{children:"Reject"})]})]}):t.adminApprovalStatus==="rejected"?e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>A(t._id),className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center space-x-2",children:[e.jsx("span",{children:"â†»"}),e.jsx("span",{children:"Re-approve"})]})}):t.adminApprovalStatus==="approved"?e.jsxs("div",{className:"flex items-center text-green-600 font-medium",children:[e.jsx("span",{className:"mr-2",children:"âœ“"}),e.jsx("span",{children:"Approved"})]}):null;return s?f?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading admin requests..."})]})}):s.isDefaultAdmin||s.role==="rootadmin"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin Requests"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage pending admin approval requests (Root Admin Only)"}),e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Welcome, ",s.email," (Root Admin)"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"bg-blue-100 text-blue-800 px-3 py-2 rounded-full text-sm font-medium",children:[l.filter(t=>t.adminApprovalStatus==="pending").length," Pending"]}),e.jsxs("div",{className:"bg-green-100 text-green-800 px-3 py-2 rounded-full text-sm font-medium",children:[l.filter(t=>t.adminApprovalStatus==="approved").length," Approved"]}),e.jsxs("div",{className:"bg-red-100 text-red-800 px-3 py-2 rounded-full text-sm font-medium",children:[l.filter(t=>t.adminApprovalStatus==="rejected").length," Rejected"]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:[{key:"all",label:"All Requests",count:l.length},{key:"pending",label:"Pending",count:l.filter(t=>t.adminApprovalStatus==="pending").length},{key:"approved",label:"Approved",count:l.filter(t=>t.adminApprovalStatus==="approved").length},{key:"rejected",label:"Rejected",count:l.filter(t=>t.adminApprovalStatus==="rejected").length}].map(({key:t,label:r,count:i})=>e.jsxs("button",{onClick:()=>b(t),className:`px-4 py-2 rounded-lg font-medium transition-all duration-200 ${n===t?"bg-blue-500 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[r," (",i,")"]},t))}),h&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6",children:h}),j.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"ðŸ“‹"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:n==="all"?"No Admin Requests":`No ${n.charAt(0).toUpperCase()+n.slice(1)} Requests`}),e.jsx("p",{className:"text-gray-600",children:n==="all"?"No admin requests have been submitted yet.":`No admin requests with ${n} status found.`})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:j.map(t=>e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-6 border border-gray-200 hover:shadow-lg transition-all duration-200",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:t.username}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${S(t.adminApprovalStatus)}`,children:t.adminApprovalStatus})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{className:"truncate",children:[e.jsx("strong",{children:"Email:"})," ",t.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Mobile:"})," ",t.mobileNumber||"Not provided"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",t.role]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Requested:"})," ",g(t.adminRequestDate||t.createdAt)]}),t.adminApprovalDate&&e.jsxs("p",{children:[e.jsx("strong",{children:"Processed:"})," ",g(t.adminApprovalDate)]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:R(t)})]})},t._id))})]})})}),e.jsx(_,{})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"ðŸš«"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"Only the default admin or root admin can approve new admin requests."}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Current user: ",s.email]}),e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("button",{onClick:()=>x("/admin"),className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2 text-base mx-auto",children:"Back to Dashboard"})})]})})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})};export{D as default};
