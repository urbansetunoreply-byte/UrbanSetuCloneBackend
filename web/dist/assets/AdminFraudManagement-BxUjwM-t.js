import{u as He,r as f,p as Je,j as e,L as We}from"./index-DFkuEFH9.js";const te="https://urbansetu.onrender.com";function Xe(){He("Fraud Management - Security Monitoring");const[O,se]=f.useState(!0),[ne,ie]=f.useState(""),[E,ae]=f.useState({suspiciousListings:0,suspectedFakeReviews:0,lastScan:null}),[$,oe]=f.useState([]),[z,re]=f.useState([]),[I,we]=f.useState("all"),[k,ve]=f.useState(""),[y,je]=f.useState("all"),[C,ye]=f.useState("severity"),[B,P]=f.useState(1),[q,U]=f.useState(1),D=10,[S,T]=f.useState({listings:new Set,reviews:new Set}),[V,Se]=f.useState(!1),[be,Ge]=f.useState(()=>new Set(JSON.parse(localStorage.getItem("fraud_resolved_listings")||"[]"))),[Ne,Ze]=f.useState(()=>new Set(JSON.parse(localStorage.getItem("fraud_resolved_reviews")||"[]"))),[b,H]=f.useState(!1),Re=Je(),ce=async()=>{try{se(!0),ie("");const[s,c,d]=await Promise.all([fetch(`${te}/api/ai/fraud/stats`),fetch(`${te}/api/listing/get?limit=10000`),fetch(`${te}/api/review/admin/all?status=approved&limit=1000&sort=date&order=desc`,{credentials:"include"})]),g=await s.json(),p=await c.json(),u=await d.json();ae(g);const j=p.map(t=>t.offer&&t.discountPrice?t.discountPrice:t.regularPrice).filter(Boolean),N=j.length?j.reduce((t,n)=>t+n,0)/j.length:0,_e=j.length?j.reduce((t,n)=>t+Math.pow(n-N,2),0)/j.length:0,le=Math.sqrt(_e)||1,Ie=N+3*le,ke=Math.max(0,N-3*le),J=new Map,W=new Map,G=new Map,Z=new Map,Ce=Date.now(),Q=/\b(?:\+?\d[\s-]?){7,15}\b/g,K=/[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}/g,F=t=>(t||"").toLowerCase().replace(/\s+/g," ").trim();(p||[]).forEach(t=>{const n=F(t.description||"");n&&J.set(n,(J.get(n)||0)+1);const i=F(t.address||`${t.propertyNumber||""} ${t.landmark||""}`),a=`${t.city||""},${t.state||""}`;if(i){const l=W.get(i)||new Set;l.add(a),W.set(i,l)}new Set([...n.match(Q)||[],...n.match(K)||[]]).forEach(l=>{const h=l,w=G.get(h)||new Set;w.add(t.userRef&&(t.userRef._id||t.userRef)||"unknown"),G.set(h,w)});const r=new Date(t.createdAt||0).getTime();if(Ce-r<=24*60*60*1e3){const l=t.userRef&&(t.userRef._id||t.userRef)||"unknown";Z.set(l,(Z.get(l)||0)+1)}});const Le=["advance payment only","send money before visit","contact on whatsapp only","no site visit","only online deal","pay booking amount first","urgent sale","quick deal","cash only","no broker","direct owner","immediate possession","bank loan not required","black money accepted","under table","negotiable","call now","whatsapp me","serious buyers only","time wasters stay away"],X=new Map,de=new Map,ue=t=>{try{return new URL(t,window.location.origin).origin===window.location.origin}catch{return!1}},Ae=async t=>{try{if(!ue(t))return null;const n=new Image;n.crossOrigin="anonymous";const i=await new Promise((m,v)=>{n.onload=m,n.onerror=v,n.src=t}),a=document.createElement("canvas");a.width=8,a.height=8;const o=a.getContext("2d");o.drawImage(n,0,0,8,8);const r=o.getImageData(0,0,8,8).data,l=[];for(let m=0;m<r.length;m+=4){const v=r[m],R=r[m+1],x=r[m+2];l.push(Math.round(.299*v+.587*R+.114*x))}const h=l.reduce((m,v)=>m+v,0)/l.length;let w="";return l.forEach(m=>{w+=m>=h?"1":"0"}),w}catch{return null}},Me=(p||[]).map(async t=>{const n=(t.imageUrls||[]).slice(0,2),i=[];for(const a of n){const o=await Ae(a);o&&i.push(o)}de.set(t._id,i),i.forEach(a=>{const o=X.get(a)||[];o.push(t._id),X.set(a,o)})});await Promise.all(Me);const Ee=async t=>{try{if(!ue(t))return!1;const n=new Image;n.crossOrigin="anonymous",await new Promise((w,m)=>{n.onload=w,n.onerror=m,n.src=t});const i=document.createElement("canvas"),a=64,o=64;i.width=a,i.height=o;const r=i.getContext("2d");r.drawImage(n,0,0,a,o);const l=[[0,0,16,16],[a-16,0,16,16],[0,o-16,16,16],[a-16,o-16,16,16]];let h=0;for(const[w,m,v,R]of l){const x=r.getImageData(w,m,v,R).data;let ee=0,_=0;for(let M=0;M<x.length;M+=4){const Be=x[M],qe=x[M+1],Ve=x[M+2],fe=Math.round(.299*Be+.587*qe+.114*Ve);fe>235&&ee++,fe<20&&_++}const $e=ee/(x.length/4),ze=_/(x.length/4);$e>.25&&ze>.05&&h++}return h>=2}catch{return!1}},Pe=p.map(t=>{const n=t.offer&&t.discountPrice?t.discountPrice:t.regularPrice,i=[];(!t.imageUrls||t.imageUrls.length===0)&&i.push("No images"),n&&(n>Ie||n<ke)&&i.push("Price outlier"),n&&n<1e5&&i.push("Unrealistically low price"),n&&n<=1e3&&i.push("Suspiciously low absolute price");const a=F(t.description||"");a&&(J.get(a)||0)>=2&&i.push("Description duplicated"),a&&Le.some(v=>a.includes(v))&&i.push("Suspicious language");const o=new Set([...a.match(Q)||[],...a.match(K)||[]]),r=t.userRef&&(t.userRef._id||t.userRef)||"unknown";let l=!1;o.forEach(v=>{(G.get(v)||new Set).size>1&&(l=!0)}),l&&i.push("Contact reused across accounts");const h=F(t.address||`${t.propertyNumber||""} ${t.landmark||""}`);h&&(W.get(h)||new Set).size>1&&i.push("Same address in different cities"),(Z.get(r)||0)>=5&&i.push("High posting velocity"),a&&a.length<20&&i.push("Very short description"),a&&a===a.toUpperCase()&&a.length>10&&i.push("All caps description"),a&&(a.match(/!/g)||[]).length>=3&&i.push("Excessive exclamation marks");const w=(a.match(Q)||[]).length,m=(a.match(K)||[]).length;return(w>=2||m>=2)&&i.push("Multiple contact methods"),n&&t.bedrooms&&t.bedrooms>=3&&n<5e5&&i.push("Low price for multi-bedroom property"),t.city&&t.city.toLowerCase().includes("test")&&i.push("Test city name"),{...t,_fraudReasons:i}}).filter(t=>t._fraudReasons.length>0),Y=new Map;(u.reviews||u||[]).forEach(t=>{const n=(t.comment||"").trim().toLowerCase();n&&Y.set(n,(Y.get(n)||0)+1)});const Ue=new Set(Array.from(Y.entries()).filter(([,t])=>t>=3).map(([t])=>t)),De=["scam","fraud","don't book","best deal","don't miss","very cheap","cheat","fake","beware","don't trust","spam","promotion","too good to be true","advance payment","deposit first","pay first","upi","gpay","paytm","whatsapp only","no visit","online only","deal outside platform","refund for review","cashback for review","5 star for discount","paid review","incentivized review","excellent service","highly recommended","must try","amazing experience","perfect","outstanding","brilliant","fantastic","wonderful","incredible","superb","exceptional","marvelous","phenomenal","extraordinary","remarkable"],me=u.reviews||u||[],L=new Map,A=new Map;me.forEach(t=>{const n=t.listingId&&(t.listingId._id||t.listingId)||t.listingId,i=t.userId&&(t.userId._id||t.userId)||t.userId,a=new Date(t.createdAt||0).getTime();L.has(n)||L.set(n,[]),L.get(n).push(t),A.has(i)||A.set(i,[]),A.get(i).push(t),t._created=a});const Te=Date.now()-3*24*60*60*1e3,pe=new Map;L.forEach((t,n)=>{const i=t.filter(r=>r._created>=Te),a=i.filter(r=>(r.rating||0)>=5).length,o=i.filter(r=>(r.rating||0)<=1).length;pe.set(n,{fiveStar:a,oneStar:o})});const Fe=new Map;L.forEach((t,n)=>{const i=[...t].sort((o,r)=>o._created-r._created);let a=!1;for(let o=0;o<i.length;o++){const r=i[o]._created;let l=1;for(let h=o+1;h<i.length&&i[h]._created-r<=30*60*1e3;h++)l++;if(l>=5){a=!0;break}}Fe.set(n,a)});const he=new Map;A.forEach((t,n)=>{const i=[...t].sort((o,r)=>o._created-r._created);let a=!1;for(let o=0;o<i.length;o++){const r=i[o].listingId&&i[o].listingId.city||"";for(let l=o+1;l<i.length;l++){const h=i[l].listingId&&i[l].listingId.city||"";if(r&&h&&r!==h&&i[l]._created-i[o]._created<=60*60*1e3){a=!0;break}}if(a)break}he.set(n,a)});const Oe=me.map(t=>{const n=[],i=(t.comment||"").trim().toLowerCase();Ue.has(i)&&n.push("Identical text across accounts"),De.some(x=>i.includes(x))&&n.push("Suspicious language");const a=t.listingId&&(t.listingId._id||t.listingId)||t.listingId,o=pe.get(a)||{fiveStar:0,oneStar:0};o.fiveStar>=10&&n.push("5-star flood"),o.oneStar>=10&&n.push("1-star flood");const r=t.userId&&(t.userId._id||t.userId)||t.userId;he.get(r)&&n.push("Reviewer multi-city in short time"),i.length<10&&n.push("Very short review"),t.comment&&t.comment===t.comment.toUpperCase()&&t.comment.length>10&&n.push("All caps review"),t.comment&&((t.comment.match(/!/g)||[]).length>=3||(t.comment.match(/\?/g)||[]).length>=3)&&n.push("Excessive punctuation");const l=t.rating||0,h=["good","great","excellent","amazing","love","nice","helpful","fast","clean","spacious","recommended"],w=["bad","poor","terrible","awful","hate","dirty","small","slow","rude","noisy","not recommended","worst"];let m=0;h.forEach(x=>{i.includes(x)&&m++}),w.forEach(x=>{i.includes(x)&&m--}),l>=4&&m<0&&n.push("Rating-comment mismatch (high rating, negative sentiment)"),l<=2&&m>0&&n.push("Rating-comment mismatch (low rating, positive sentiment)"),["good property","nice place","worth it","satisfied","happy with","recommended","good service","nice experience","will visit again"].some(x=>i.includes(x))&&i.length<30&&n.push("Generic template review");const R=A.get(r)||[];if(R.length>=3){const x=R.map(_=>_.rating||0);x.every(_=>_===x[0])&&(x[0]===5||x[0]===1)&&n.push("Suspicious rating pattern")}return{...t,_fraudReasons:n}}).filter(t=>t._fraudReasons.length>0),ge=(await Promise.all(Pe.map(async t=>{const n=new Set(t._fraudReasons||[]),i=de.get(t._id)||[];let a=!1;for(const h of i)if((X.get(h)||[]).filter(v=>String(v)!==String(t._id)).length>=1){a=!0;break}a&&n.add("Stolen images suspected");const o=(t.imageUrls||[])[0];o&&await Ee(o)&&n.add("Watermark/logo detected");const r=(t.description||"").toLowerCase();return(r.match(/\d/g)||[]).length>=10&&(/([0-9])\1{5,}/.test(r)||/(123456|987654)/.test(r))&&n.add("Suspicious phone number pattern"),{...t,_fraudReasons:Array.from(n)}}))).filter(t=>!be.has(String(t._id))),xe=Oe.filter(t=>!Ne.has(String(t._id)));oe(ge),re(xe),ae(t=>({...t,suspiciousListings:ge.length,suspectedFakeReviews:xe.length,lastScan:new Date().toISOString()}))}catch{ie("Failed to load fraud data.")}finally{se(!1)}};return f.useEffect(()=>{ce()},[]),e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-6 sm:py-10 px-2 md:px-8",children:e.jsxs("div",{className:"w-full mx-auto bg-white rounded-xl shadow-lg p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 gap-2 flex-wrap",children:[e.jsx("h3",{className:"text-3xl font-extrabold text-blue-700 drop-shadow",children:"Fraud Management"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{className:"px-3 py-2 bg-blue-600 text-white rounded-lg disabled:opacity-60 text-sm",disabled:O,onClick:ce,children:O?"Scanning…":"Scan Now"}),e.jsx("button",{className:"px-3 py-2 bg-gray-200 rounded-lg text-sm",onClick:()=>Re("/admin"),children:"Back"}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:V,onChange:s=>{Se(s.target.checked),P(1),U(1)}}),"Include low severity"]})]})]}),O?e.jsx("p",{children:"Loading..."}):ne?e.jsx("p",{className:"text-red-600",children:ne}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 sm:gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Suspicious Listings"}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:E.suspiciousListings})]}),e.jsxs("div",{className:"p-4 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Suspected Fake Reviews"}),e.jsx("div",{className:"text-2xl font-bold text-red-700",children:E.suspectedFakeReviews})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Last Scan"}),e.jsx("div",{className:"text-sm font-semibold text-gray-800",children:E.lastScan?new Date(E.lastScan).toLocaleString():"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-4 flex-wrap",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"View:"}),e.jsxs("select",{value:I,onChange:s=>we(s.target.value),className:"border rounded p-2 text-sm",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"listings",children:"Suspicious Listings"}),e.jsx("option",{value:"reviews",children:"Suspected Fake Reviews"})]}),e.jsxs("select",{value:y,onChange:s=>{je(s.target.value),P(1),U(1)},className:"border rounded p-2 text-sm",children:[e.jsx("option",{value:"all",children:"All reasons"}),e.jsx("option",{value:"Price outlier",children:"Price outlier"}),e.jsx("option",{value:"Unrealistically low price",children:"Unrealistically low price"}),e.jsx("option",{value:"Suspiciously low absolute price",children:"Suspiciously low absolute price"}),e.jsx("option",{value:"Description duplicated",children:"Description duplicated"}),e.jsx("option",{value:"Suspicious language",children:"Suspicious language"}),e.jsx("option",{value:"Contact reused across accounts",children:"Contact reused"}),e.jsx("option",{value:"Same address in different cities",children:"Address conflict"}),e.jsx("option",{value:"High posting velocity",children:"High posting velocity"}),e.jsx("option",{value:"No images",children:"No images"}),e.jsx("option",{value:"Very short description",children:"Very short description"}),e.jsx("option",{value:"All caps description",children:"All caps description"}),e.jsx("option",{value:"Excessive exclamation marks",children:"Excessive exclamation marks"}),e.jsx("option",{value:"Multiple contact methods",children:"Multiple contact methods"}),e.jsx("option",{value:"Low price for multi-bedroom property",children:"Low price for multi-bedroom"}),e.jsx("option",{value:"Test city name",children:"Test city name"}),e.jsx("option",{value:"Identical text across accounts",children:"Identical text"}),e.jsx("option",{value:"5-star flood",children:"5-star flood"}),e.jsx("option",{value:"1-star flood",children:"1-star flood"}),e.jsx("option",{value:"Reviewer multi-city in short time",children:"Reviewer anomaly"}),e.jsx("option",{value:"Very short review",children:"Very short review"}),e.jsx("option",{value:"All caps review",children:"All caps review"}),e.jsx("option",{value:"Excessive punctuation",children:"Excessive punctuation"}),e.jsx("option",{value:"Rating-comment mismatch (high rating, negative sentiment)",children:"Rating-comment mismatch"}),e.jsx("option",{value:"Generic template review",children:"Generic template review"}),e.jsx("option",{value:"Suspicious rating pattern",children:"Suspicious rating pattern"}),e.jsx("option",{value:"Incentivized review",children:"Incentivized review"}),e.jsx("option",{value:"Paid promotion",children:"Paid promotion"}),e.jsx("option",{value:"External contact promotion",children:"External contact promotion"}),e.jsx("option",{value:"Coordinated review activity",children:"Coordinated review activity"}),e.jsx("option",{value:"Unverified owner claim",children:"Unverified owner claim"}),e.jsx("option",{value:"Stolen images suspected",children:"Stolen images suspected"}),e.jsx("option",{value:"Image-text mismatch",children:"Image-text mismatch"}),e.jsx("option",{value:"Contact off-platform",children:"Contact off-platform"}),e.jsx("option",{value:"Advance payment solicitation",children:"Advance payment solicitation"}),e.jsx("option",{value:"Third-party payment request",children:"Third-party payment request"})]}),e.jsxs("select",{value:C,onChange:s=>{ye(s.target.value)},className:"border rounded p-2 text-sm",children:[e.jsx("option",{value:"severity",children:"Sort: Severity"}),e.jsx("option",{value:"recent",children:"Sort: Most Recent"}),e.jsx("option",{value:"alpha",children:"Sort: Alphabetical"})]}),e.jsx("input",{className:"border rounded p-2 text-sm flex-1 min-w-[180px]",placeholder:"Search text, reasons, city, user, listing…",value:k,onChange:s=>ve(s.target.value)}),e.jsx("button",{className:"px-3 py-2 bg-green-600 text-white rounded-lg text-sm",onClick:()=>{const c=[["Type","Listing","User","Reasons","Comment"],...$.map(u=>["listing",u.name,"",(u._fraudReasons||[]).join("|"),(u.description||"").replace(/\n/g," ")]),...z.map(u=>{var j,N;return["review",((j=u.listingId)==null?void 0:j.name)||String(u.listingId),((N=u.userId)==null?void 0:N.email)||String(u.userId),(u._fraudReasons||[]).join("|"),(u.comment||"").replace(/\n/g," ")]})].map(u=>u.map(j=>`"${String(j).replace(/"/g,'""')}"`).join(",")).join(`
`),d=new Blob([c],{type:"text/csv;charset=utf-8;"}),g=URL.createObjectURL(d),p=document.createElement("a");p.href=g,p.download="fraud-report.csv",p.click(),URL.revokeObjectURL(g)},children:"Export CSV"}),b?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-3 py-2 bg-red-600 text-white rounded-lg text-sm",onClick:()=>{const s=new Set(JSON.parse(localStorage.getItem("fraud_resolved_listings")||"[]"));S.listings.forEach(d=>s.add(String(d))),localStorage.setItem("fraud_resolved_listings",JSON.stringify(Array.from(s)));const c=new Set(JSON.parse(localStorage.getItem("fraud_resolved_reviews")||"[]"));S.reviews.forEach(d=>c.add(String(d))),localStorage.setItem("fraud_resolved_reviews",JSON.stringify(Array.from(c))),oe(d=>d.filter(g=>!S.listings.has(g._id))),re(d=>d.filter(g=>!S.reviews.has(g._id))),T({listings:new Set,reviews:new Set}),H(!1)},children:"Resolve Selected"}),e.jsx("button",{className:"px-3 py-2 bg-gray-500 text-white rounded-lg text-sm",onClick:()=>{H(!1),T({listings:new Set,reviews:new Set})},children:"Cancel"})]}):e.jsx("button",{className:"px-3 py-2 bg-blue-600 text-white rounded-lg text-sm",onClick:()=>{H(!0)},children:"Select"})]}),(I==="all"||I==="listings")&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-xl font-bold text-gray-800 mb-3",children:"Suspicious Listings"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full w-full border text-xs sm:text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[b&&e.jsx("th",{className:"p-2 text-left w-8",children:"Select"}),e.jsx("th",{className:"p-2 text-left",children:"Name"}),e.jsx("th",{className:"p-2 text-left",children:"City"}),e.jsx("th",{className:"p-2 text-left",children:"Reasons"}),e.jsx("th",{className:"p-2 text-left",children:"Actions"})]})}),e.jsxs("tbody",{children:[$.filter(s=>{const c=k.trim().toLowerCase();return c?[s.name,s.city,s.state,s.description||"",(s._fraudReasons||[]).join(" ")].join(" ").toLowerCase().includes(c):!0}).filter(s=>V?!0:(s._fraudReasons||[]).length>=2).filter(s=>y==="all"?!0:(s._fraudReasons||[]).includes(y)).sort((s,c)=>{if(C==="alpha")return String(s.name||"").localeCompare(String(c.name||""));if(C==="recent")return new Date(c.createdAt||0)-new Date(s.createdAt||0);const d=(s._fraudReasons||[]).length;return(c._fraudReasons||[]).length-d}).slice((B-1)*D,B*D).map(s=>e.jsxs("tr",{className:"border-t",children:[b&&e.jsx("td",{className:"p-2 text-sm",children:e.jsx("input",{type:"checkbox",checked:S.listings.has(s._id),onChange:c=>{const d=new Set(S.listings);c.target.checked?d.add(s._id):d.delete(s._id),T(g=>({...g,listings:d}))}})}),e.jsx("td",{className:"p-2",children:s.name}),e.jsxs("td",{className:"p-2",children:[s.city,", ",s.state]}),e.jsx("td",{className:"p-2",children:(s._fraudReasons||[]).join(", ")}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(We,{to:`/admin/listing/${s._id}`,className:"px-2 py-1 bg-blue-600 text-white rounded text-xs sm:text-sm",children:"Open"}),e.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded text-xs sm:text-sm",onClick:()=>window.open(`/admin/listing/${s._id}`,"_blank"),children:"New Tab"})]})})]},s._id)),$.filter(s=>{const c=k.trim().toLowerCase();return c?[s.name,s.city,s.state,s.description||"",(s._fraudReasons||[]).join(" ")].join(" ").toLowerCase().includes(c):!0}).filter(s=>y==="all"?!0:(s._fraudReasons||[]).includes(y)).length===0&&e.jsx("tr",{children:e.jsx("td",{className:"p-3 text-sm text-gray-500",colSpan:b?5:4,children:"No suspicious listings"})})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3",children:[e.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded text-xs",onClick:()=>P(s=>Math.max(1,s-1)),children:"Prev"}),e.jsxs("span",{className:"text-xs",children:["Page ",B]}),e.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded text-xs",onClick:()=>P(s=>s+1),children:"Next"})]})]}),(I==="all"||I==="reviews")&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xl font-bold text-gray-800 mb-3",children:"Suspected Fake Reviews"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full w-full border text-xs sm:text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[b&&e.jsx("th",{className:"p-2 text-left w-8",children:"Select"}),e.jsx("th",{className:"p-2 text-left",children:"Listing"}),e.jsx("th",{className:"p-2 text-left",children:"User"}),e.jsx("th",{className:"p-2 text-left",children:"Comment"}),e.jsx("th",{className:"p-2 text-left",children:"Reasons"}),e.jsx("th",{className:"p-2 text-left",children:"Actions"})]})}),e.jsxs("tbody",{children:[z.filter(s=>{var g,p;const c=k.trim().toLowerCase();return c?[((g=s.listingId)==null?void 0:g.name)||String(s.listingId||""),((p=s.userId)==null?void 0:p.email)||String(s.userId||""),s.comment||"",(s._fraudReasons||[]).join(" ")].join(" ").toLowerCase().includes(c):!0}).filter(s=>V?!0:(s._fraudReasons||[]).length>=2).filter(s=>y==="all"?!0:(s._fraudReasons||[]).includes(y)).sort((s,c)=>{var p,u;if(C==="alpha")return String(((p=s.listingId)==null?void 0:p.name)||"").localeCompare(String(((u=c.listingId)==null?void 0:u.name)||""));if(C==="recent")return new Date(c.createdAt||0)-new Date(s.createdAt||0);const d=(s._fraudReasons||[]).length;return(c._fraudReasons||[]).length-d}).slice((q-1)*D,q*D).map(s=>{var c,d,g;return e.jsxs("tr",{className:"border-t",children:[b&&e.jsx("td",{className:"p-2 text-sm",children:e.jsx("input",{type:"checkbox",checked:S.reviews.has(s._id),onChange:p=>{const u=new Set(S.reviews);p.target.checked?u.add(s._id):u.delete(s._id),T(j=>({...j,reviews:u}))}})}),e.jsx("td",{className:"p-2",children:((c=s.listingId)==null?void 0:c.name)||s.listingId}),e.jsx("td",{className:"p-2",children:((d=s.userId)==null?void 0:d.email)||s.userId}),e.jsx("td",{className:"p-2 max-w-[10rem] sm:max-w-md truncate",title:s.comment,children:s.comment}),e.jsx("td",{className:"p-2",children:(s._fraudReasons||[]).join(", ")}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("a",{href:`/admin/listing/${((g=s.listingId)==null?void 0:g._id)||s.listingId}`,className:"px-2 py-1 bg-blue-600 text-white rounded text-xs sm:text-sm",children:"Open"}),e.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded text-xs sm:text-sm",onClick:()=>{var p;return window.open(`/admin/listing/${((p=s.listingId)==null?void 0:p._id)||s.listingId}`,"_blank")},children:"New Tab"})]})})]},s._id)}),z.filter(s=>{var g,p;const c=k.trim().toLowerCase();return c?[((g=s.listingId)==null?void 0:g.name)||String(s.listingId||""),((p=s.userId)==null?void 0:p.email)||String(s.userId||""),s.comment||"",(s._fraudReasons||[]).join(" ")].join(" ").toLowerCase().includes(c):!0}).filter(s=>y==="all"?!0:(s._fraudReasons||[]).includes(y)).length===0&&e.jsx("tr",{children:e.jsx("td",{className:"p-3 text-sm text-gray-500",colSpan:b?6:5,children:"No suspected fake reviews"})})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3",children:[e.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded text-xs",onClick:()=>U(s=>Math.max(1,s-1)),children:"Prev"}),e.jsxs("span",{className:"text-xs",children:["Page ",q]}),e.jsx("button",{className:"px-2 py-1 bg-gray-200 rounded text-xs",onClick:()=>U(s=>s+1),children:"Next"})]})]})]})]})})}export{Xe as default};
