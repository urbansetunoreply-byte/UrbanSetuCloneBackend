import{j as o,r as v}from"./index-AwWxf1fH.js";const N=(c,x=!1)=>{if(!c||typeof c!="string")return c;const b=c.split(`
`),z=[],A=new Map;return b.forEach((a,l)=>{if(!a||typeof a!="string")return;const g=a.trim().match(/^(\d+)\.\s+/),w=a.trim().match(/^[-•]\s+/);if(g||w){let n="";if(g){const t=a.match(/^(\s*)(\d+)\.\s+(.*)$/);t&&(n=t[3])}else if(w){const t=a.match(/^(\s*)[-•]\s+(.*)$/);t&&(n=t[2])}let i=n;const u=[],p=[{regex:/\*\*(.*?)\*\*/g,tag:"strong"},{regex:/\*(.*?)\*/g,tag:"em"},{regex:/__(.*?)__/g,tag:"u"},{regex:/~~(.*?)~~/g,tag:"del"}],r=[];p.forEach(t=>{let s;for(;(s=t.regex.exec(i))!==null;)r.push({start:s.index,end:s.index+s[0].length,content:s[1],tag:t.tag,full:s[0]})}),r.sort((t,s)=>t.start-s.start);const h=[];r.forEach(t=>{h.some(f=>t.start>=f.start&&t.start<f.end||t.end>f.start&&t.end<=f.end)||h.push(t)}),h.sort((t,s)=>t.start-s.start);let e=0;h.forEach((t,s)=>{t.start>e&&u.push(i.slice(e,t.start));const f=t.tag;u.push(o.jsx(f,{className:t.tag==="u"?"underline":"",children:t.content},`${l}-${s}`)),e=t.end}),e<i.length&&u.push(i.slice(e)),A.set(l,u)}else{let n=a;const i=[],u=[{regex:/\*\*(.*?)\*\*/g,tag:"strong"},{regex:/\*(.*?)\*/g,tag:"em"},{regex:/__(.*?)__/g,tag:"u"},{regex:/~~(.*?)~~/g,tag:"del"}],p=[];u.forEach(e=>{let t;for(;(t=e.regex.exec(n))!==null;)p.push({start:t.index,end:t.index+t[0].length,content:t[1],tag:e.tag,full:t[0]})}),p.sort((e,t)=>e.start-t.start);const r=[];p.forEach(e=>{r.some(s=>e.start>=s.start&&e.start<s.end||e.end>s.start&&e.end<=s.end)||r.push(e)}),r.sort((e,t)=>e.start-t.start);let h=0;r.forEach((e,t)=>{e.start>h&&i.push(n.slice(h,e.start));const s=e.tag;i.push(o.jsx(s,{className:e.tag==="u"?"underline":"",children:e.content},`${l}-${t}`)),h=e.end}),h<n.length&&i.push(n.slice(h)),A.set(l,i)}if(a.trim().match(/^(\d+)\.\s+/)){const n=a.match(/^(\s*)(\d+)\.\s+(.*)$/);if(n){const[,i,u,p]=n,r=x?"text-blue-200":"text-blue-600",h=A.get(l);z.push(o.jsxs("div",{className:`${i?"ml-4":""} mb-1`,children:[o.jsxs("span",{className:`font-medium ${r}`,children:[u,"."]})," ",h&&h.length>0?h:p]},l));return}}else if(a.trim().match(/^[-•]\s+/)){const n=a.match(/^(\s*)[-•]\s+(.*)$/);if(n){const[,i,u]=n,p=x?"text-blue-200":"text-blue-600",r=A.get(l);z.push(o.jsxs("div",{className:`${i?"ml-4":""} mb-1`,children:[o.jsx("span",{className:p,children:"•"})," ",r&&r.length>0?r:u]},l));return}}else if(a.trim().match(/^>\s+/)){const n=a.match(/^>\s+(.*)$/);if(n){const i=n[1],u=x?"text-gray-200":"text-gray-600",p=x?"border-gray-400":"border-gray-300",r=A.get(l);z.push(o.jsx("div",{className:`border-l-4 ${p} pl-3 ml-2 italic ${u} mb-1`,children:r&&r.length>0?r:i},l));return}}const m=A.get(l);m&&m.length>0?z.push(o.jsx("span",{children:m},l)):a.trim()&&z.push(o.jsx("span",{children:a},l)),l<b.length-1&&a.trim()&&z.push(o.jsx("br",{},`br-${l}`))}),z},F=(c,x=!1)=>{if(!c||typeof c!="string")return c||"";const b=/(https?:\/\/[^\s]+|www\.[^\s]+\.[^\s]{2,}(?:\/[^\s]*)?|[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*\.[a-zA-Z]{2,}(?:\/[^\s]*)?|(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}(?:\/[^\s]*)?)/gi;return c.split(b).map((A,a)=>{if(/(https?:\/\/[^\s]+|www\.[^\s]+\.[^\s]{2,}(?:\/[^\s]*)?|[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*\.[a-zA-Z]{2,}(?:\/[^\s]*)?|(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}(?:\/[^\s]*)?)/gi.test(A)){let g=A;!g.startsWith("http://")&&!g.startsWith("https://")&&(g="https://"+g);const w=x?"text-white hover:text-blue-200 underline transition-colors duration-200 cursor-pointer":"text-blue-600 hover:text-blue-800 underline transition-colors duration-200 cursor-pointer";return o.jsx("a",{href:g,target:"_blank",rel:"noopener noreferrer",className:w,onClick:m=>m.stopPropagation(),children:A},a)}return A})},E=({text:c,isSentMessage:x=!1,className:b=""})=>{if(!c||typeof c!="string")return o.jsx("span",{className:b,children:c});const A=N(c,x).map((a,l)=>{if(typeof a=="string"){const g=/@\[([^\]]+)\]\(([^)]+)\)/g,w=/(https?:\/\/[^\s]+|www\.[^\s]+\.[^\s]{2,}(?:\/[^\s]*)?|[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*\.[a-zA-Z]{2,}(?:\/[^\s]*)?|(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}(?:\/[^\s]*)?)/gi;let m=a;const n=[...a.matchAll(g)],i=[];n.forEach((e,t)=>{const[s,f,$]=e,d=`__MENTION_${l}_${t}__`;m=m.replace(s,d),i.push({placeholder:d,name:f,listingId:$,full:s})});const u=[...m.matchAll(w)],p=[];u.forEach((e,t)=>{const[s]=e,f=`__URL_${l}_${t}__`;m=m.replace(s,f),p.push({placeholder:f,url:s})});const r=[...i,...p];let h;if(r.length>0){const e=new RegExp(`(${r.map(t=>t.placeholder).join("|")})`,"g");h=m.split(e)}else h=[m];return h.map((e,t)=>{if(!e)return null;const s=i.find($=>$.placeholder===e);if(s){const{name:$,listingId:d}=s,_=`${window.location.pathname.includes("/admin")?"/admin/listing/":"/user/listing/"}${d}`,j=x?"text-white underline decoration-dotted hover:text-blue-200 cursor-pointer":"text-blue-600 underline decoration-dotted hover:text-blue-800 cursor-pointer";return o.jsxs("a",{href:_,onClick:k=>k.stopPropagation(),className:j,title:`Open ${$}`,children:["@",$]},`mention-${l}-${t}`)}const f=p.find($=>$.placeholder===e);if(f){const{url:$}=f;let d=$;!d.startsWith("http://")&&!d.startsWith("https://")&&(d="https://"+d);const Z=x?"text-white hover:text-blue-200 underline transition-colors duration-200 cursor-pointer":"text-blue-600 hover:text-blue-800 underline transition-colors duration-200 cursor-pointer";return o.jsx("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:Z,onClick:_=>_.stopPropagation(),children:$},`url-${l}-${t}`)}return e})}return a});return o.jsx("span",{className:b,children:A})},T=({text:c,isSentMessage:x=!1,className:b="",searchQuery:z="",maxLines:A=4})=>{const[a,l]=v.useState(!1),[g,w]=v.useState(!1),m=v.useRef(null);v.useEffect(()=>{if(m.current&&c){const h=A*20,e=m.current.scrollHeight;w(e>h)}},[c,A]);const n=z&&z.trim()?C:E;if(a||!g)return o.jsxs("div",{className:"relative",children:[o.jsx("div",{ref:m,children:o.jsx(n,{text:c,isSentMessage:x,className:b,searchQuery:z})}),g&&o.jsx("div",{className:"mt-1",children:o.jsx("button",{onClick:()=>l(!1),className:`text-xs font-medium transition-colors duration-200 ${x?"text-blue-200 hover:text-white":"text-blue-600 hover:text-blue-800"}`,children:"Read less"})})]});const i=c.split(`
`);let u="",p=0;for(let r=0;r<i.length&&p<A;r++){p>0&&(u+=`
`),u+=i[r],p++;const h=Math.ceil(i[r].length/50);p+=h-1}return p>=A&&u.length<c.length&&(u+="..."),o.jsxs("div",{className:"relative",children:[o.jsx("div",{ref:m,children:o.jsx(n,{text:u,isSentMessage:x,className:b,searchQuery:z})}),g&&o.jsx("div",{className:"mt-1",children:o.jsx("button",{onClick:()=>l(!0),className:`text-xs font-medium transition-colors duration-200 ${x?"text-blue-200 hover:text-white":"text-blue-600 hover:text-blue-800"}`,children:"Read more"})})]})},C=({text:c,isSentMessage:x=!1,className:b="",searchQuery:z=""})=>{if(!c||typeof c!="string")return o.jsx("span",{className:b,children:c});const a=N(c,x).map((l,g)=>{if(typeof l=="string"){const w=/@\[([^\]]+)\]\(([^)]+)\)/g,m=/(https?:\/\/[^\s]+|www\.[^\s]+\.[^\s]{2,}(?:\/[^\s]*)?|[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*\.[a-zA-Z]{2,}(?:\/[^\s]*)?|(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}(?:\/[^\s]*)?)/gi;let n=l;const i=[...l.matchAll(w)],u=[];i.forEach((t,s)=>{const[f,$,d]=t,Z=`__MENTION_${g}_${s}__`;n=n.replace(f,Z),u.push({placeholder:Z,name:$,listingId:d,full:f})});const p=[...n.matchAll(m)],r=[];p.forEach((t,s)=>{const[f]=t,$=`__URL_${g}_${s}__`;n=n.replace(f,$),r.push({placeholder:$,url:f})});const h=[...u,...r];let e;if(h.length>0){const t=new RegExp(`(${h.map(s=>s.placeholder).join("|")})`,"g");e=n.split(t)}else e=[n];return e.map((t,s)=>{if(!t)return null;const f=u.find(d=>d.placeholder===t);if(f){const{name:d,listingId:Z}=f,j=`${window.location.pathname.includes("/admin")?"/admin/listing/":"/user/listing/"}${Z}`,k=x?"text-white underline decoration-dotted hover:text-blue-200 cursor-pointer":"text-blue-600 underline decoration-dotted hover:text-blue-800 cursor-pointer";return o.jsxs("a",{href:j,onClick:R=>R.stopPropagation(),className:k,title:`Open ${d}`,children:["@",d]},`mention-${g}-${s}`)}const $=r.find(d=>d.placeholder===t);if($){const{url:d}=$;let Z=d;!Z.startsWith("http://")&&!Z.startsWith("https://")&&(Z="https://"+Z);const _=x?"text-white hover:text-blue-200 underline transition-colors duration-200 cursor-pointer":"text-blue-600 hover:text-blue-800 underline transition-colors duration-200 cursor-pointer";return o.jsx("a",{href:Z,target:"_blank",rel:"noopener noreferrer",className:_,onClick:j=>j.stopPropagation(),children:d},`url-${g}-${s}`)}if(z&&z.trim()){const d=new RegExp(`(${z.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return t.split(d).map((_,j)=>d.test(_)?o.jsx("span",{className:"search-text-highlight bg-yellow-200 text-black px-1 rounded",children:_},`search-${g}-${s}-${j}`):_)}return t})}return l});return o.jsx("span",{className:b,children:a})};export{T as F,F as f};
