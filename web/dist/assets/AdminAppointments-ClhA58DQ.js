import{u as Ra,i as Ta,r as c,aV as T,Q as z,j as e,L as zo,aW as Pa,aX as Jt,aY as er,aG as Tr,y as g,Z as me,U as Fa,aZ as ks,a_ as Pr,f as Ua,g as Ba,a$ as za,a1 as v,b0 as Qs,b1 as Gt,b as bt,b2 as Xs,S as Ze,b3 as Dr,l as pt,b4 as Ar,W as Er,ak as Oo,b5 as To,b6 as Oa,b7 as qa,a5 as Ha,Y as Yt,b8 as Mr,G as Po,b9 as Va,t as Wa,ba as Ga}from"./index-BKRdPXJO.js";import{F as Fo}from"./linkFormatter-DjBy7uUE.js";import{I as Ya}from"./ImagePreview-Urd8OuCW.js";import{E as Ja,e as Za,L as Uo,a as vs}from"./ExportChatModal-wtNIYUQa.js";const L="https://urbansetu.onrender.com";function oi(){Ra("Appointment Management - Admin Panel");const{currentUser:i}=Ta(h=>h.user),[m,$]=c.useState([]),[Ee,Zt]=c.useState([]),[Ke,re]=c.useState([]),[Qe,ue]=c.useState(!0),[O,Tt]=c.useState("all"),[oe,Pt]=c.useState(""),[ve,wt]=c.useState(1),[Oe,Me]=c.useState(1),[ae,ie]=c.useState(1),[he,tr]=c.useState(1),[Ns,sr]=c.useState([]),[ne,rr]=c.useState(null),[Kt,Xe]=c.useState(!1),[le,et]=c.useState(!1),[Y,Ft]=c.useState(!1),[ge,jt]=c.useState(""),[Re,Qt]=c.useState(""),[be,ke]=c.useState(null),[vt,N]=c.useState(""),[I,q]=c.useState(!1),[J,kt]=c.useState(!1),[Te,Ut]=c.useState(!1),[Pe,Bt]=c.useState(!1),[tt,qe]=c.useState(!1),[Xt,H]=c.useState(null),[Nt,He]=c.useState(!1),[st,es]=c.useState(""),zt=[{emoji:"ðŸ˜€",keywords:["grinning","happy","smile","joy"]},{emoji:"ðŸ˜ƒ",keywords:["grinning","happy","smile","joy","smiley"]},{emoji:"ðŸ˜„",keywords:["grinning","happy","smile","joy","laugh"]},{emoji:"ðŸ˜",keywords:["grinning","happy","smile","joy","beaming"]},{emoji:"ðŸ˜†",keywords:["grinning","happy","smile","joy","laugh","squinting"]},{emoji:"ðŸ˜…",keywords:["grinning","happy","smile","sweat","relief"]},{emoji:"ðŸ˜‚",keywords:["joy","laugh","tears","funny","lol","crying"]},{emoji:"ðŸ¤£",keywords:["rolling","laugh","funny","lol","rofl"]},{emoji:"ðŸ˜Š",keywords:["smiling","happy","blush","smile"]},{emoji:"ðŸ˜‡",keywords:["innocent","angel","halo","good"]},{emoji:"ðŸ™‚",keywords:["slightly","smiling","happy"]},{emoji:"ðŸ™ƒ",keywords:["upside","down","silly","sarcastic"]},{emoji:"ðŸ˜‰",keywords:["winking","flirt","wink"]},{emoji:"ðŸ˜Œ",keywords:["relieved","peaceful","calm"]},{emoji:"ðŸ˜",keywords:["heart","eyes","love","adore","crush"]},{emoji:"ðŸ¥°",keywords:["smiling","hearts","love","adore"]},{emoji:"ðŸ˜˜",keywords:["kiss","love","heart"]},{emoji:"ðŸ˜—",keywords:["kissing","kiss"]},{emoji:"ðŸ˜™",keywords:["kissing","smiling","eyes"]},{emoji:"ðŸ˜š",keywords:["kissing","closed","eyes"]},{emoji:"ðŸ˜‹",keywords:["yummy","delicious","tongue"]},{emoji:"ðŸ˜›",keywords:["tongue","out","playful"]},{emoji:"ðŸ˜",keywords:["tongue","winking","playful"]},{emoji:"ðŸ˜œ",keywords:["tongue","winking","crazy"]},{emoji:"ðŸ¤ª",keywords:["zany","crazy","wild"]},{emoji:"ðŸ¤¨",keywords:["raised","eyebrow","suspicious"]},{emoji:"ðŸ§",keywords:["monocle","thinking","pondering"]},{emoji:"ðŸ¤“",keywords:["nerd","geek","glasses"]},{emoji:"ðŸ˜Ž",keywords:["cool","sunglasses","awesome"]},{emoji:"ðŸ¤©",keywords:["star","struck","excited"]},{emoji:"ðŸ¥³",keywords:["party","celebration","hat"]},{emoji:"ðŸ˜",keywords:["smirk","sly","mischievous"]},{emoji:"ðŸ˜’",keywords:["unamused","bored","meh"]},{emoji:"ðŸ˜ž",keywords:["disappointed","sad"]},{emoji:"ðŸ˜”",keywords:["pensive","sad","thoughtful"]},{emoji:"ðŸ˜Ÿ",keywords:["worried","concerned"]},{emoji:"ðŸ˜•",keywords:["confused","slightly","frowning"]},{emoji:"ðŸ™",keywords:["slightly","frowning","sad"]},{emoji:"â˜¹ï¸",keywords:["frowning","sad"]},{emoji:"ðŸ˜£",keywords:["persevering","struggling"]},{emoji:"ðŸ˜–",keywords:["confounded","frustrated"]},{emoji:"ðŸ˜«",keywords:["tired","exhausted"]},{emoji:"ðŸ˜©",keywords:["weary","tired"]},{emoji:"ðŸ¥º",keywords:["pleading","puppy","eyes"]},{emoji:"ðŸ˜¢",keywords:["crying","sad","tear"]},{emoji:"ðŸ˜­",keywords:["loudly","crying","sad","bawling"]},{emoji:"ðŸ˜¤",keywords:["huffing","angry","steam"]},{emoji:"ðŸ˜ ",keywords:["angry","mad"]},{emoji:"ðŸ˜¡",keywords:["pouting","angry","rage"]},{emoji:"ðŸ¤¬",keywords:["swearing","cursing","angry"]},{emoji:"ðŸ¤¯",keywords:["exploding","head","mind","blown"]},{emoji:"ðŸ˜³",keywords:["flushed","embarrassed"]},{emoji:"ðŸ¥µ",keywords:["hot","sweating"]},{emoji:"ðŸ¥¶",keywords:["cold","freezing"]},{emoji:"ðŸ˜±",keywords:["screaming","fear","shocked"]},{emoji:"ðŸ˜¨",keywords:["fearful","scared"]},{emoji:"ðŸ˜°",keywords:["anxious","sweat","worried"]},{emoji:"ðŸ˜¥",keywords:["sad","relieved","disappointed"]},{emoji:"ðŸ˜“",keywords:["downcast","sweat","sad"]},{emoji:"ðŸ¤—",keywords:["hugging","hug","embrace"]},{emoji:"ðŸ¤”",keywords:["thinking","pondering"]},{emoji:"ðŸ¤­",keywords:["hand","over","mouth","giggle"]},{emoji:"ðŸ¤«",keywords:["shushing","quiet","secret"]},{emoji:"ðŸ¤¥",keywords:["lying","pinocchio"]},{emoji:"ðŸ˜¶",keywords:["no","mouth","speechless"]},{emoji:"ðŸ˜",keywords:["neutral","expressionless"]},{emoji:"ðŸ˜‘",keywords:["expressionless","blank"]},{emoji:"ðŸ˜¯",keywords:["hushed","surprised"]},{emoji:"ðŸ˜¦",keywords:["frowning","open","mouth"]},{emoji:"ðŸ˜§",keywords:["anguished","shocked"]},{emoji:"ðŸ˜®",keywords:["open","mouth","surprised","wow"]},{emoji:"ðŸ˜²",keywords:["astonished","shocked"]},{emoji:"ðŸ¥±",keywords:["yawning","tired","sleepy"]},{emoji:"ðŸ˜´",keywords:["sleeping","zzz","tired"]},{emoji:"ðŸ¤¤",keywords:["drooling","sleepy"]},{emoji:"ðŸ˜ª",keywords:["sleepy","tired"]},{emoji:"ðŸ˜µ",keywords:["dizzy","confused"]},{emoji:"ðŸ¤",keywords:["zipper","mouth","quiet"]},{emoji:"ðŸ¥´",keywords:["woozy","drunk","dizzy"]},{emoji:"ðŸ¤¢",keywords:["nauseated","sick"]},{emoji:"ðŸ¤®",keywords:["vomiting","sick"]},{emoji:"ðŸ¤§",keywords:["sneezing","sick"]},{emoji:"ðŸ˜·",keywords:["mask","sick","medical"]},{emoji:"ðŸ¤’",keywords:["thermometer","sick","fever"]},{emoji:"ðŸ¤•",keywords:["bandage","hurt","injured"]},{emoji:"ðŸ¤‘",keywords:["money","mouth","rich"]},{emoji:"ðŸ¤ ",keywords:["cowboy","hat"]},{emoji:"ðŸ’€",keywords:["skull","death","dead"]},{emoji:"ðŸ‘»",keywords:["ghost","spooky"]},{emoji:"ðŸ‘½",keywords:["alien","extraterrestrial"]},{emoji:"ðŸ‘¾",keywords:["alien","monster","game"]},{emoji:"ðŸ¤–",keywords:["robot","bot"]},{emoji:"ðŸ˜ˆ",keywords:["smiling","devil","evil"]},{emoji:"ðŸ‘¿",keywords:["angry","devil","evil"]},{emoji:"ðŸ‘¹",keywords:["ogre","monster"]},{emoji:"ðŸ‘º",keywords:["goblin","monster"]},{emoji:"ðŸ’ª",keywords:["flexed","biceps","strong","muscle"]},{emoji:"ðŸ‘",keywords:["thumbs","up","good","yes","like","approve"]},{emoji:"ðŸ‘Ž",keywords:["thumbs","down","bad","no","dislike"]},{emoji:"ðŸ‘Œ",keywords:["ok","okay","perfect"]},{emoji:"âœŒï¸",keywords:["victory","peace","two"]},{emoji:"ðŸ¤ž",keywords:["crossed","fingers","luck"]},{emoji:"ðŸ¤Ÿ",keywords:["love","you","gesture"]},{emoji:"ðŸ¤˜",keywords:["rock","on","horns"]},{emoji:"ðŸ¤™",keywords:["call","me","hang","loose"]},{emoji:"ðŸ‘ˆ",keywords:["pointing","left"]},{emoji:"ðŸ‘‰",keywords:["pointing","right"]},{emoji:"ðŸ‘†",keywords:["pointing","up"]},{emoji:"ðŸ‘‡",keywords:["pointing","down"]},{emoji:"â˜ï¸",keywords:["index","pointing","up"]},{emoji:"ðŸ‘‹",keywords:["waving","hand","hello","goodbye"]},{emoji:"ðŸ¤š",keywords:["raised","back","hand"]},{emoji:"ðŸ–ï¸",keywords:["hand","five","fingers"]},{emoji:"âœ‹",keywords:["raised","hand","stop"]},{emoji:"ðŸ––",keywords:["vulcan","salute","spock"]},{emoji:"ðŸ¤Œ",keywords:["pinched","fingers"]},{emoji:"ðŸ¤",keywords:["pinching","hand"]},{emoji:"ðŸ¶",keywords:["dog","puppy","pet"]},{emoji:"ðŸ±",keywords:["cat","kitten","pet"]},{emoji:"ðŸ­",keywords:["mouse","rodent"]},{emoji:"ðŸ¹",keywords:["hamster","pet"]},{emoji:"ðŸ°",keywords:["rabbit","bunny"]},{emoji:"ðŸ¦Š",keywords:["fox"]},{emoji:"ðŸ»",keywords:["bear"]},{emoji:"ðŸ¼",keywords:["panda","bear"]},{emoji:"ðŸ¨",keywords:["koala"]},{emoji:"ðŸ¯",keywords:["tiger"]},{emoji:"ðŸ¦",keywords:["lion"]},{emoji:"ðŸ®",keywords:["cow"]},{emoji:"ðŸ·",keywords:["pig"]},{emoji:"ðŸ¸",keywords:["frog"]},{emoji:"ðŸµ",keywords:["monkey"]},{emoji:"ðŸ™ˆ",keywords:["see","no","evil","monkey"]},{emoji:"ðŸ™‰",keywords:["hear","no","evil","monkey"]},{emoji:"ðŸ™Š",keywords:["speak","no","evil","monkey"]},{emoji:"ðŸ’",keywords:["monkey"]},{emoji:"ðŸ”",keywords:["chicken"]},{emoji:"ðŸ§",keywords:["penguin"]},{emoji:"ðŸ¦",keywords:["bird"]},{emoji:"ðŸ¤",keywords:["baby","chick"]},{emoji:"ðŸ£",keywords:["hatching","chick"]},{emoji:"ðŸ¦†",keywords:["duck"]},{emoji:"ðŸ¦…",keywords:["eagle"]},{emoji:"ðŸ¦‰",keywords:["owl"]},{emoji:"ðŸ¦‡",keywords:["bat"]},{emoji:"ðŸº",keywords:["wolf"]},{emoji:"ðŸ—",keywords:["boar"]},{emoji:"ðŸ´",keywords:["horse"]},{emoji:"ðŸ¦„",keywords:["unicorn","magical"]},{emoji:"ðŸ",keywords:["bee","honeybee"]},{emoji:"ðŸ›",keywords:["bug","insect"]},{emoji:"ðŸ¦‹",keywords:["butterfly"]},{emoji:"ðŸŒ",keywords:["snail"]},{emoji:"ðŸž",keywords:["ladybug","beetle"]},{emoji:"ðŸœ",keywords:["ant"]},{emoji:"ðŸ¦Ÿ",keywords:["mosquito"]},{emoji:"ðŸ¦—",keywords:["cricket"]},{emoji:"ðŸ•·ï¸",keywords:["spider"]},{emoji:"ðŸ•¸ï¸",keywords:["spider","web"]},{emoji:"ðŸ¦‚",keywords:["scorpion"]},{emoji:"ðŸ¢",keywords:["turtle"]},{emoji:"ðŸ",keywords:["snake"]},{emoji:"ðŸ¦Ž",keywords:["lizard"]},{emoji:"ðŸ¦–",keywords:["t-rex","dinosaur"]},{emoji:"ðŸ¦•",keywords:["sauropod","dinosaur"]},{emoji:"ðŸ™",keywords:["octopus"]},{emoji:"ðŸ¦‘",keywords:["squid"]},{emoji:"ðŸ¦",keywords:["shrimp"]},{emoji:"ðŸ¦ž",keywords:["lobster"]},{emoji:"ðŸ¦€",keywords:["crab"]},{emoji:"ðŸ¡",keywords:["blowfish"]},{emoji:"ðŸ ",keywords:["tropical","fish"]},{emoji:"ðŸŸ",keywords:["fish"]},{emoji:"ðŸ¬",keywords:["dolphin"]},{emoji:"ðŸ³",keywords:["spouting","whale"]},{emoji:"ðŸ‹",keywords:["whale"]},{emoji:"ðŸ¦ˆ",keywords:["shark"]},{emoji:"ðŸŠ",keywords:["crocodile"]},{emoji:"ðŸŽ",keywords:["apple","fruit","red"]},{emoji:"ðŸ",keywords:["pear","fruit"]},{emoji:"ðŸŠ",keywords:["orange","fruit"]},{emoji:"ðŸ‹",keywords:["lemon","fruit","sour"]},{emoji:"ðŸŒ",keywords:["banana","fruit"]},{emoji:"ðŸ‰",keywords:["watermelon","fruit"]},{emoji:"ðŸ‡",keywords:["grapes","fruit"]},{emoji:"ðŸ“",keywords:["strawberry","fruit"]},{emoji:"ðŸ«",keywords:["blueberries","fruit"]},{emoji:"ðŸˆ",keywords:["melon","fruit"]},{emoji:"ðŸ’",keywords:["cherries","fruit"]},{emoji:"ðŸ‘",keywords:["peach","fruit"]},{emoji:"ðŸ¥­",keywords:["mango","fruit"]},{emoji:"ðŸ",keywords:["pineapple","fruit"]},{emoji:"ðŸ¥¥",keywords:["coconut","fruit"]},{emoji:"ðŸ¥",keywords:["kiwi","fruit"]},{emoji:"ðŸ…",keywords:["tomato","vegetable"]},{emoji:"ðŸ†",keywords:["eggplant","vegetable"]},{emoji:"ðŸ¥‘",keywords:["avocado","fruit"]},{emoji:"ðŸ¥¦",keywords:["broccoli","vegetable"]},{emoji:"ðŸ¥¬",keywords:["leafy","greens","vegetable"]},{emoji:"ðŸ¥’",keywords:["cucumber","vegetable"]},{emoji:"ðŸŒ¶ï¸",keywords:["hot","pepper","spicy"]},{emoji:"ðŸ«‘",keywords:["bell","pepper","vegetable"]},{emoji:"ðŸŒ½",keywords:["corn","vegetable"]},{emoji:"ðŸ¥•",keywords:["carrot","vegetable"]},{emoji:"ðŸ«’",keywords:["olive"]},{emoji:"ðŸ§„",keywords:["garlic"]},{emoji:"ðŸ§…",keywords:["onion"]},{emoji:"ðŸ¥”",keywords:["potato","vegetable"]},{emoji:"ðŸ ",keywords:["roasted","sweet","potato"]},{emoji:"ðŸ¥",keywords:["croissant","bread"]},{emoji:"ðŸ¥¯",keywords:["bagel","bread"]},{emoji:"ðŸž",keywords:["bread","loaf"]},{emoji:"ðŸ¥–",keywords:["baguette","bread"]},{emoji:"ðŸ¥¨",keywords:["pretzel"]},{emoji:"ðŸ§€",keywords:["cheese"]},{emoji:"ðŸ¥š",keywords:["egg"]},{emoji:"ðŸ³",keywords:["cooking","egg","fried"]},{emoji:"ðŸ§ˆ",keywords:["butter"]},{emoji:"ðŸ¥ž",keywords:["pancakes"]},{emoji:"ðŸ§‡",keywords:["waffle"]},{emoji:"ðŸ¥“",keywords:["bacon"]},{emoji:"ðŸ¥©",keywords:["cut","meat"]},{emoji:"ðŸ—",keywords:["poultry","leg","chicken"]},{emoji:"ðŸ–",keywords:["meat","bone"]},{emoji:"ðŸ¦´",keywords:["bone"]},{emoji:"ðŸŒ­",keywords:["hot","dog"]},{emoji:"ðŸ”",keywords:["hamburger","burger"]},{emoji:"ðŸŸ",keywords:["french","fries"]},{emoji:"ðŸ•",keywords:["pizza"]},{emoji:"ðŸ¥ª",keywords:["sandwich"]},{emoji:"ðŸ¥™",keywords:["stuffed","flatbread"]},{emoji:"ðŸ§†",keywords:["falafel"]},{emoji:"ðŸŒ®",keywords:["taco"]},{emoji:"ðŸŒ¯",keywords:["burrito"]},{emoji:"ðŸ«”",keywords:["tamale"]},{emoji:"ðŸ¥—",keywords:["green","salad"]},{emoji:"ðŸ¥˜",keywords:["shallow","pan","food"]},{emoji:"ðŸ«•",keywords:["fondue"]},{emoji:"ðŸ¥«",keywords:["canned","food"]},{emoji:"ðŸ",keywords:["spaghetti","pasta"]},{emoji:"ðŸœ",keywords:["steaming","bowl","ramen"]},{emoji:"ðŸ²",keywords:["pot","food","stew"]},{emoji:"ðŸ›",keywords:["curry","rice"]},{emoji:"ðŸ£",keywords:["sushi"]},{emoji:"ðŸ±",keywords:["bento","box"]},{emoji:"ðŸ¥Ÿ",keywords:["dumpling"]},{emoji:"ðŸ¦ª",keywords:["oyster"]},{emoji:"ðŸ¤",keywords:["fried","shrimp"]},{emoji:"ðŸ™",keywords:["rice","ball"]},{emoji:"ðŸš",keywords:["cooked","rice"]},{emoji:"ðŸ˜",keywords:["rice","cracker"]},{emoji:"ðŸ¥",keywords:["fish","cake","swirl"]},{emoji:"ðŸ¥ ",keywords:["fortune","cookie"]},{emoji:"ðŸ¥®",keywords:["moon","cake"]},{emoji:"ðŸ¢",keywords:["oden"]},{emoji:"ðŸ¡",keywords:["dango"]},{emoji:"ðŸ§",keywords:["shaved","ice"]},{emoji:"ðŸ¨",keywords:["ice","cream"]},{emoji:"ðŸ¦",keywords:["soft","ice","cream"]},{emoji:"ðŸ°",keywords:["shortcake","cake"]},{emoji:"ðŸ§",keywords:["cupcake"]},{emoji:"ðŸ¥§",keywords:["pie"]},{emoji:"ðŸ®",keywords:["custard"]},{emoji:"ðŸ­",keywords:["lollipop","candy"]},{emoji:"ðŸ¬",keywords:["candy","sweet"]},{emoji:"ðŸ«",keywords:["chocolate","bar"]},{emoji:"ðŸ¿",keywords:["popcorn"]},{emoji:"ðŸª",keywords:["cookie"]},{emoji:"ðŸŒ°",keywords:["chestnut"]},{emoji:"ðŸ¥œ",keywords:["peanuts","nuts"]},{emoji:"ðŸ¯",keywords:["honey","pot"]},{emoji:"ðŸ¥›",keywords:["glass","milk"]},{emoji:"ðŸ¼",keywords:["baby","bottle"]},{emoji:"ðŸ«–",keywords:["teapot"]},{emoji:"âš½",keywords:["soccer","ball","football"]},{emoji:"ðŸ€",keywords:["basketball"]},{emoji:"ðŸˆ",keywords:["american","football"]},{emoji:"âš¾",keywords:["baseball"]},{emoji:"ðŸ¥Ž",keywords:["softball"]},{emoji:"ðŸŽ¾",keywords:["tennis"]},{emoji:"ðŸ",keywords:["volleyball"]},{emoji:"ðŸ‰",keywords:["rugby","football"]},{emoji:"ðŸ¥",keywords:["flying","disc","frisbee"]},{emoji:"ðŸŽ±",keywords:["pool","8","ball"]},{emoji:"ðŸª€",keywords:["yo-yo"]},{emoji:"ðŸ“",keywords:["ping","pong","table","tennis"]},{emoji:"ðŸ¸",keywords:["badminton"]},{emoji:"ðŸ’",keywords:["ice","hockey"]},{emoji:"ðŸ‘",keywords:["field","hockey"]},{emoji:"ðŸ¥",keywords:["lacrosse"]},{emoji:"ðŸ",keywords:["cricket"]},{emoji:"ðŸ¥…",keywords:["goal","net"]},{emoji:"â›³",keywords:["flag","hole","golf"]},{emoji:"ðŸª",keywords:["kite"]},{emoji:"ðŸ¹",keywords:["bow","arrow"]},{emoji:"ðŸŽ£",keywords:["fishing","pole"]},{emoji:"ðŸ¤¿",keywords:["diving","mask"]},{emoji:"ðŸ¥Š",keywords:["boxing","glove"]},{emoji:"ðŸ¥‹",keywords:["martial","arts","uniform"]},{emoji:"ðŸŽ½",keywords:["running","shirt"]},{emoji:"ðŸ›¹",keywords:["skateboard"]},{emoji:"ðŸ›·",keywords:["sled"]},{emoji:"â›¸ï¸",keywords:["ice","skate"]},{emoji:"ðŸ¥Œ",keywords:["curling","stone"]},{emoji:"ðŸŽ¿",keywords:["skis"]},{emoji:"â›·ï¸",keywords:["skier"]},{emoji:"ðŸ‚",keywords:["snowboarder"]},{emoji:"ðŸª‚",keywords:["parachute"]},{emoji:"ðŸŽ­",keywords:["performing","arts","theater"]},{emoji:"ðŸ©°",keywords:["ballet","shoes"]},{emoji:"ðŸŽ¨",keywords:["artist","palette","art"]},{emoji:"ðŸŽ¬",keywords:["clapper","board","movie"]},{emoji:"ðŸŽ¤",keywords:["microphone","singing"]},{emoji:"ðŸŽ§",keywords:["headphone","music"]},{emoji:"ðŸŽ¼",keywords:["musical","score"]},{emoji:"ðŸŽ¹",keywords:["musical","keyboard","piano"]},{emoji:"ðŸ¥",keywords:["drum"]},{emoji:"ðŸª˜",keywords:["long","drum"]},{emoji:"ðŸŽ·",keywords:["saxophone"]},{emoji:"ðŸŽº",keywords:["trumpet"]},{emoji:"ðŸŽ¸",keywords:["guitar"]},{emoji:"ðŸª•",keywords:["banjo"]},{emoji:"ðŸŽ»",keywords:["violin"]},{emoji:"ðŸŽ²",keywords:["game","die","dice"]},{emoji:"â™Ÿï¸",keywords:["chess","pawn"]},{emoji:"ðŸŽ¯",keywords:["direct","hit","target"]},{emoji:"ðŸŽ³",keywords:["bowling"]},{emoji:"ðŸŽ®",keywords:["video","game","controller"]},{emoji:"ðŸŽ°",keywords:["slot","machine"]},{emoji:"ðŸ§©",keywords:["puzzle","piece"]},{emoji:"ðŸ“±",keywords:["mobile","phone","cell"]},{emoji:"ðŸš—",keywords:["automobile","car"]},{emoji:"ðŸš•",keywords:["taxi"]},{emoji:"ðŸš™",keywords:["sport","utility","vehicle","suv"]},{emoji:"ðŸšŒ",keywords:["bus"]},{emoji:"ðŸšŽ",keywords:["trolleybus"]},{emoji:"ðŸŽï¸",keywords:["racing","car"]},{emoji:"ðŸš“",keywords:["police","car"]},{emoji:"ðŸš‘",keywords:["ambulance"]},{emoji:"ðŸš’",keywords:["fire","engine"]},{emoji:"ðŸš",keywords:["minibus"]},{emoji:"ðŸšš",keywords:["delivery","truck"]},{emoji:"ðŸš›",keywords:["articulated","lorry"]},{emoji:"ðŸšœ",keywords:["tractor"]},{emoji:"ðŸ›´",keywords:["kick","scooter"]},{emoji:"ðŸ›µ",keywords:["motor","scooter"]},{emoji:"ðŸï¸",keywords:["motorcycle"]},{emoji:"ðŸš¨",keywords:["police","car","light"]},{emoji:"ðŸš”",keywords:["oncoming","police","car"]},{emoji:"ðŸš",keywords:["oncoming","bus"]},{emoji:"ðŸš˜",keywords:["oncoming","automobile"]},{emoji:"ðŸš–",keywords:["oncoming","taxi"]},{emoji:"ðŸš¡",keywords:["aerial","tramway"]},{emoji:"ðŸš ",keywords:["mountain","cableway"]},{emoji:"ðŸšŸ",keywords:["suspension","railway"]},{emoji:"ðŸšƒ",keywords:["railway","car"]},{emoji:"ðŸš‹",keywords:["tram","car"]},{emoji:"ðŸšž",keywords:["mountain","railway"]},{emoji:"ðŸš",keywords:["monorail"]},{emoji:"ðŸš„",keywords:["high-speed","train"]},{emoji:"ðŸš…",keywords:["bullet","train"]},{emoji:"ðŸšˆ",keywords:["light","rail"]},{emoji:"ðŸš‚",keywords:["locomotive"]},{emoji:"ðŸš†",keywords:["train"]},{emoji:"ðŸš‡",keywords:["metro","subway"]},{emoji:"ðŸšŠ",keywords:["tram"]},{emoji:"ðŸš‰",keywords:["station"]},{emoji:"âœˆï¸",keywords:["airplane","plane","flight"]},{emoji:"ðŸ›«",keywords:["airplane","departure"]},{emoji:"ðŸ›¬",keywords:["airplane","arrival"]},{emoji:"ðŸ›©ï¸",keywords:["small","airplane"]},{emoji:"ðŸ’º",keywords:["seat"]},{emoji:"ðŸ›°ï¸",keywords:["satellite"]},{emoji:"ðŸš€",keywords:["rocket","space"]},{emoji:"ðŸ›¸",keywords:["flying","saucer","ufo"]},{emoji:"ðŸš",keywords:["helicopter"]},{emoji:"ðŸ›¶",keywords:["canoe"]},{emoji:"â›µ",keywords:["sailboat"]},{emoji:"ðŸš¤",keywords:["speedboat"]},{emoji:"ðŸ›¥ï¸",keywords:["motor","boat"]},{emoji:"ðŸ›³ï¸",keywords:["passenger","ship"]},{emoji:"â›´ï¸",keywords:["ferry"]},{emoji:"ðŸš¢",keywords:["ship"]},{emoji:"âš“",keywords:["anchor"]},{emoji:"ðŸš§",keywords:["construction"]},{emoji:"â›½",keywords:["fuel","pump","gas"]},{emoji:"ðŸš",keywords:["bus","stop"]},{emoji:"ðŸš¦",keywords:["vertical","traffic","light"]},{emoji:"ðŸš¥",keywords:["horizontal","traffic","light"]},{emoji:"ðŸ—ºï¸",keywords:["world","map"]},{emoji:"ðŸ—¿",keywords:["moai","statue"]},{emoji:"ðŸ—½",keywords:["statue","liberty"]},{emoji:"ðŸ—¼",keywords:["tokyo","tower"]},{emoji:"ðŸ°",keywords:["castle"]},{emoji:"ðŸ¯",keywords:["japanese","castle"]},{emoji:"ðŸŸï¸",keywords:["stadium"]},{emoji:"ðŸŽ¡",keywords:["ferris","wheel"]},{emoji:"ðŸŽ¢",keywords:["roller","coaster"]},{emoji:"ðŸŽ ",keywords:["carousel","horse"]},{emoji:"â›²",keywords:["fountain"]},{emoji:"â›±ï¸",keywords:["umbrella","beach"]},{emoji:"ðŸ–ï¸",keywords:["beach","umbrella"]},{emoji:"ðŸï¸",keywords:["desert","island"]},{emoji:"ðŸ”ï¸",keywords:["snow-capped","mountain"]},{emoji:"ðŸ—»",keywords:["mount","fuji"]},{emoji:"ðŸŒ‹",keywords:["volcano"]},{emoji:"ðŸ—¾",keywords:["map","japan"]},{emoji:"ðŸ•ï¸",keywords:["camping"]},{emoji:"â›º",keywords:["tent"]},{emoji:"ðŸ ",keywords:["house"]},{emoji:"ðŸ¡",keywords:["house","garden"]},{emoji:"ðŸ˜ï¸",keywords:["houses"]},{emoji:"ðŸšï¸",keywords:["derelict","house"]},{emoji:"ðŸ—ï¸",keywords:["building","construction"]},{emoji:"ðŸ­",keywords:["factory"]},{emoji:"ðŸ¢",keywords:["office","building"]},{emoji:"ðŸ¬",keywords:["department","store"]},{emoji:"ðŸ£",keywords:["japanese","post","office"]},{emoji:"ðŸ¤",keywords:["post","office"]},{emoji:"ðŸ¥",keywords:["hospital"]},{emoji:"ðŸ¦",keywords:["bank"]},{emoji:"ðŸ¨",keywords:["hotel"]},{emoji:"ðŸª",keywords:["convenience","store"]},{emoji:"ðŸ«",keywords:["school"]},{emoji:"ðŸ©",keywords:["love","hotel"]},{emoji:"ðŸ’’",keywords:["wedding"]},{emoji:"â›ª",keywords:["church"]},{emoji:"â¤ï¸",keywords:["red","heart","love"]},{emoji:"ðŸ§¡",keywords:["orange","heart","love"]},{emoji:"ðŸ’›",keywords:["yellow","heart","love"]},{emoji:"ðŸ’š",keywords:["green","heart","love"]},{emoji:"ðŸ’™",keywords:["blue","heart","love"]},{emoji:"ðŸ’œ",keywords:["purple","heart","love"]},{emoji:"ðŸ–¤",keywords:["black","heart","love"]},{emoji:"ðŸ¤",keywords:["white","heart","love"]},{emoji:"ðŸ¤Ž",keywords:["brown","heart","love"]},{emoji:"ðŸ’”",keywords:["broken","heart","sad"]},{emoji:"â£ï¸",keywords:["heavy","heart","exclamation"]},{emoji:"ðŸ’•",keywords:["two","hearts","love"]},{emoji:"ðŸ’ž",keywords:["revolving","hearts","love"]},{emoji:"ðŸ’“",keywords:["beating","heart","love"]},{emoji:"ðŸ’—",keywords:["growing","heart","love"]},{emoji:"ðŸ’–",keywords:["sparkling","heart","love"]},{emoji:"ðŸ’˜",keywords:["heart","arrow","cupid"]},{emoji:"ðŸ’",keywords:["heart","ribbon","gift"]},{emoji:"ðŸ’Ÿ",keywords:["heart","decoration"]},{emoji:"â˜®ï¸",keywords:["peace","symbol"]},{emoji:"âœï¸",keywords:["latin","cross"]},{emoji:"â˜ªï¸",keywords:["star","crescent"]},{emoji:"ðŸ•‰ï¸",keywords:["om"]},{emoji:"â˜¸ï¸",keywords:["wheel","dharma"]},{emoji:"âœ¡ï¸",keywords:["star","david"]},{emoji:"ðŸ”¯",keywords:["dotted","six-pointed","star"]},{emoji:"ðŸ•Ž",keywords:["menorah"]},{emoji:"â˜¯ï¸",keywords:["yin","yang"]},{emoji:"â˜¦ï¸",keywords:["orthodox","cross"]},{emoji:"ðŸ›",keywords:["place","worship"]},{emoji:"â›Ž",keywords:["ophiuchus"]},{emoji:"â™ˆ",keywords:["aries"]},{emoji:"â™‰",keywords:["taurus"]},{emoji:"â™Š",keywords:["gemini"]},{emoji:"â™‹",keywords:["cancer"]},{emoji:"â™Œ",keywords:["leo"]},{emoji:"â™",keywords:["virgo"]},{emoji:"â™Ž",keywords:["libra"]},{emoji:"â™",keywords:["scorpio"]},{emoji:"â™",keywords:["sagittarius"]},{emoji:"â™‘",keywords:["capricorn"]},{emoji:"â™’",keywords:["aquarius"]},{emoji:"â™“",keywords:["pisces"]},{emoji:"ðŸ†”",keywords:["id","button"]},{emoji:"âš›ï¸",keywords:["atom","symbol"]},{emoji:"ðŸ‰‘",keywords:["japanese","acceptable"]},{emoji:"â˜¢ï¸",keywords:["radioactive"]},{emoji:"â˜£ï¸",keywords:["biohazard"]},{emoji:"ðŸ“´",keywords:["mobile","phone","off"]},{emoji:"ðŸ“³",keywords:["vibration","mode"]},{emoji:"ðŸˆ¶",keywords:["japanese","not","free","charge"]},{emoji:"ðŸˆš",keywords:["japanese","free","charge"]},{emoji:"ðŸˆ¸",keywords:["japanese","application"]},{emoji:"ðŸˆº",keywords:["japanese","open","business"]},{emoji:"ðŸˆ·ï¸",keywords:["japanese","monthly","amount"]},{emoji:"âœ´ï¸",keywords:["eight-pointed","star"]},{emoji:"ðŸ†š",keywords:["vs","button"]},{emoji:"ðŸ’®",keywords:["white","flower"]},{emoji:"ðŸ‰",keywords:["japanese","bargain"]},{emoji:"ãŠ™ï¸",keywords:["japanese","secret"]},{emoji:"ãŠ—ï¸",keywords:["japanese","congratulations"]},{emoji:"ðŸˆ´",keywords:["japanese","passing","grade"]},{emoji:"ðŸˆµ",keywords:["japanese","no","vacancy"]},{emoji:"ðŸˆ¹",keywords:["japanese","discount"]},{emoji:"ðŸˆ²",keywords:["japanese","prohibited"]},{emoji:"ðŸ…°ï¸",keywords:["a","button","blood","type"]},{emoji:"ðŸ…±ï¸",keywords:["b","button","blood","type"]},{emoji:"ðŸ†Ž",keywords:["ab","button","blood","type"]},{emoji:"ðŸ†‘",keywords:["cl","button"]},{emoji:"ðŸ…¾ï¸",keywords:["o","button","blood","type"]},{emoji:"ðŸ†˜",keywords:["sos","button"]},{emoji:"âŒ",keywords:["cross","mark","no","x"]},{emoji:"â­•",keywords:["heavy","large","circle"]},{emoji:"ðŸ›‘",keywords:["stop","sign"]},{emoji:"â›”",keywords:["no","entry"]},{emoji:"ðŸ“›",keywords:["name","badge"]},{emoji:"ðŸš«",keywords:["prohibited"]},{emoji:"ðŸ’¯",keywords:["hundred","points","perfect"]},{emoji:"ðŸ’¢",keywords:["anger","symbol"]},{emoji:"â™¨ï¸",keywords:["hot","springs"]},{emoji:"ðŸš·",keywords:["no","pedestrians"]},{emoji:"ðŸš¯",keywords:["no","littering"]},{emoji:"ðŸš³",keywords:["no","bicycles"]},{emoji:"ðŸš±",keywords:["non-potable","water"]},{emoji:"ðŸ”ž",keywords:["no","one","under","eighteen"]},{emoji:"ðŸ“µ",keywords:["no","mobile","phones"]},{emoji:"ðŸš­",keywords:["no","smoking"]},{emoji:"â—",keywords:["exclamation","mark"]},{emoji:"â•",keywords:["white","exclamation","mark"]},{emoji:"â“",keywords:["question","mark"]},{emoji:"â”",keywords:["white","question","mark"]},{emoji:"â€¼ï¸",keywords:["double","exclamation","mark"]},{emoji:"â‰ï¸",keywords:["exclamation","question","mark"]},{emoji:"ðŸ”…",keywords:["dim","button"]},{emoji:"ðŸ”†",keywords:["bright","button"]},{emoji:"ã€½ï¸",keywords:["part","alternation","mark"]},{emoji:"ðŸ",keywords:["chequered","flag","racing"]},{emoji:"ðŸš©",keywords:["triangular","flag"]},{emoji:"ðŸŽŒ",keywords:["crossed","flags"]},{emoji:"ðŸ´",keywords:["black","flag"]},{emoji:"ðŸ³ï¸",keywords:["white","flag"]},{emoji:"ðŸ³ï¸â€ðŸŒˆ",keywords:["rainbow","flag","pride"]},{emoji:"ðŸ´â€â˜ ï¸",keywords:["pirate","flag"]},{emoji:"ðŸŽ‰",keywords:["party","popper","celebration"]},{emoji:"ðŸŽŠ",keywords:["confetti","ball","celebration"]},{emoji:"ðŸŽˆ",keywords:["balloon","party"]},{emoji:"ðŸŽ‚",keywords:["birthday","cake"]},{emoji:"ðŸŽ",keywords:["wrapped","gift","present"]},{emoji:"ðŸŽ„",keywords:["christmas","tree"]},{emoji:"ðŸŽƒ",keywords:["jack-o-lantern","halloween"]},{emoji:"ðŸŽ—ï¸",keywords:["reminder","ribbon"]},{emoji:"ðŸŽŸï¸",keywords:["admission","tickets"]},{emoji:"ðŸŽ«",keywords:["ticket"]},{emoji:"ðŸŽ–ï¸",keywords:["military","medal"]},{emoji:"ðŸ†",keywords:["trophy","winner"]},{emoji:"ðŸ…",keywords:["sports","medal"]},{emoji:"ðŸ¥‡",keywords:["1st","place","medal","gold"]},{emoji:"ðŸ¥ˆ",keywords:["2nd","place","medal","silver"]},{emoji:"ðŸ¥‰",keywords:["3rd","place","medal","bronze"]},{emoji:"ðŸ”¥",keywords:["fire","hot","lit"]},{emoji:"ðŸ’¯",keywords:["hundred","points","perfect","100"]},{emoji:"âœ¨",keywords:["sparkles","magic","shiny"]},{emoji:"ðŸŒŸ",keywords:["glowing","star"]},{emoji:"ðŸ’«",keywords:["dizzy"]},{emoji:"â­",keywords:["star"]},{emoji:"ðŸ’¥",keywords:["collision","explosion"]},{emoji:"âš¡",keywords:["high","voltage","lightning"]},{emoji:"ðŸ’¦",keywords:["sweat","droplets"]},{emoji:"ðŸ’¨",keywords:["dashing","away","wind"]},{emoji:"â˜ï¸",keywords:["cloud"]},{emoji:"ðŸŒ¤ï¸",keywords:["sun","behind","small","cloud"]},{emoji:"â›…",keywords:["sun","behind","cloud"]},{emoji:"ðŸŒ¥ï¸",keywords:["sun","behind","large","cloud"]},{emoji:"ðŸŒ¦ï¸",keywords:["sun","behind","rain","cloud"]},{emoji:"ðŸŒ§ï¸",keywords:["cloud","rain"]},{emoji:"â›ˆï¸",keywords:["cloud","lightning","rain"]},{emoji:"ðŸŒ©ï¸",keywords:["cloud","lightning"]},{emoji:"ðŸŒ¨ï¸",keywords:["cloud","snow"]},{emoji:"â˜ƒï¸",keywords:["snowman"]},{emoji:"â›„",keywords:["snowman","without","snow"]},{emoji:"ðŸŒ¬ï¸",keywords:["wind","face"]},{emoji:"ðŸŒªï¸",keywords:["tornado"]},{emoji:"ðŸŒ«ï¸",keywords:["fog"]},{emoji:"ðŸŒŠ",keywords:["water","wave"]},{emoji:"ðŸ’§",keywords:["droplet","water"]},{emoji:"â˜”",keywords:["umbrella","rain","drops"]},{emoji:"â˜‚ï¸",keywords:["umbrella"]},{emoji:"ðŸŒ‚",keywords:["closed","umbrella"]}],ts=h=>{if(!h.trim())return zt.map(j=>j.emoji);const p=h.toLowerCase();return zt.filter(j=>j.keywords.some(P=>P.toLowerCase().includes(p))).map(j=>j.emoji)},[Cs,rt]=c.useState(!1),[xe,R]=c.useState(null),[Ct,St]=c.useState([]);c.useEffect(()=>(I||J||Te||Pe?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[I,J,Te,Pe]),c.useEffect(()=>{const h=p=>{!p.target.closest("[data-audio-menu]")&&!p.target.closest("[data-audio-speed-menu]")&&!p.target.closest("[data-audio-controls-menu]")&&!p.target.closest('button[title="Audio options"]')&&(document.querySelectorAll("[data-audio-menu]").forEach(j=>{j.classList.add("hidden")}),document.querySelectorAll("[data-audio-speed-menu]").forEach(j=>{j.classList.add("hidden")}),document.querySelectorAll("[data-audio-controls-menu]").forEach(j=>{j.classList.add("hidden")}))};return document.addEventListener("click",h),()=>{document.removeEventListener("click",h)}},[]);const _t=c.useRef(!1),ss=c.useCallback((h,p)=>{_t.current||($(j=>j.map(A=>A._id===h&&JSON.stringify(A.comments)!==JSON.stringify(p)?(_t.current=!0,setTimeout(()=>{_t.current=!1},100),{...A,comments:p}):A)),re(j=>j.map(A=>A._id===h&&JSON.stringify(A.comments)!==JSON.stringify(p)?{...A,comments:p}:A)))},[]),Ot=c.useCallback(async()=>{try{const{data:h}=await T.get(`${L}/api/bookings`,{withCredentials:!0}),p=h.appointments||h;Zt(p),ue(!1)}catch(h){console.error("Failed to fetch appointments",h),ue(!1)}},[]),rs=c.useCallback(async()=>{try{const{data:h}=await T.get(`${L}/api/bookings/archived`,{withCredentials:!0});re(h)}catch(h){console.error("Failed to fetch archived appointments",h)}},[]);c.useEffect(()=>{window.scrollTo(0,0)},[]),c.useEffect(()=>{z.connected&&i&&z.emit("adminAppointmentsActive",{adminId:i._id,role:i.role});const h=setInterval(()=>{i&&z.emit("adminAppointmentsActive",{adminId:i._id,role:i.role})},3e4);Ot(),rs();const p=setInterval(()=>{Ot(),rs()},5e3),j=k=>{$(Q=>Q.map(C=>{const W={...C};return C.buyerId&&(C.buyerId._id===k.userId||C.buyerId===k.userId)&&(W.buyerId={...W.buyerId,username:k.username,email:k.email,mobileNumber:k.mobileNumber,avatar:k.avatar}),C.sellerId&&(C.sellerId._id===k.userId||C.sellerId===k.userId)&&(W.sellerId={...W.sellerId,username:k.username,email:k.email,mobileNumber:k.mobileNumber,avatar:k.avatar}),W})),re(Q=>Q.map(C=>{const W={...C};return C.buyerId&&(C.buyerId._id===k.userId||C.buyerId===k.userId)&&(W.buyerId={...W.buyerId,username:k.username,email:k.email,mobileNumber:k.mobileNumber,avatar:k.avatar}),C.sellerId&&(C.sellerId._id===k.userId||C.sellerId===k.userId)&&(W.sellerId={...W.sellerId,username:k.username,email:k.email,mobileNumber:k.mobileNumber,avatar:k.avatar}),W}))};z.on("profileUpdated",j);const P=k=>{k.comment.senderEmail!==(i==null?void 0:i.email)&&($(Q=>Q.map(C=>{var W;if(C._id===k.appointmentId){const fe=(W=C.comments)==null?void 0:W.findIndex(M=>M._id===k.comment._id);if(fe!==-1){const M=C.comments[fe],de={...k.comment,starredBy:M.starredBy||[],videoUrl:k.comment.videoUrl||M.videoUrl,audioUrl:k.comment.audioUrl||M.audioUrl,audioName:k.comment.audioName||M.audioName,documentUrl:k.comment.documentUrl||M.documentUrl,documentName:k.comment.documentName||M.documentName,originalImageUrl:k.comment.originalImageUrl||M.originalImageUrl||M.imageUrl,imageUrl:k.comment.imageUrl||M.imageUrl};if(JSON.stringify(M)!==JSON.stringify(de)){const B=[...C.comments||[]];B[fe]=de;try{playMessageReceived()}catch{}return{...C,comments:B}}return C}else{const M=[...C.comments||[],k.comment];try{playMessageReceived()}catch{}return{...C,comments:M}}}return C})),re(Q=>Q.map(C=>{var W;if(C._id===k.appointmentId){const fe=(W=C.comments)==null?void 0:W.findIndex(M=>M._id===k.comment._id);if(fe!==-1){const M=C.comments[fe],de={...k.comment,starredBy:M.starredBy||[],videoUrl:k.comment.videoUrl||M.videoUrl,audioUrl:k.comment.audioUrl||M.audioUrl,audioName:k.comment.audioName||M.audioName,documentUrl:k.comment.documentUrl||M.documentUrl,documentName:k.comment.documentName||M.documentName,originalImageUrl:k.comment.originalImageUrl||M.originalImageUrl||M.imageUrl,imageUrl:k.comment.imageUrl||M.imageUrl};if(JSON.stringify(M)!==JSON.stringify(de)){const B=[...C.comments||[]];B[fe]=de;try{playMessageReceived()}catch{}return{...C,comments:B}}return C}else{const M=[...C.comments||[],k.comment];try{playMessageReceived()}catch{}return{...C,comments:M}}}return C})))};z.on("commentUpdate",P);const A=k=>{$(Q=>Q.map(C=>C._id===k.appointmentId?{...C,...k.updatedAppointment}:C)),re(Q=>Q.map(C=>C._id===k.appointmentId?{...C,...k.updatedAppointment}:C))},pe=k=>{$(Q=>Q.map(C=>C._id===k.appointmentId?{...C,paymentConfirmed:k.paymentConfirmed}:C)),re(Q=>Q.map(C=>C._id===k.appointmentId?{...C,paymentConfirmed:k.paymentConfirmed}:C))};z.on("appointmentUpdate",A),z.on("paymentStatusUpdated",pe);const U=k=>{const Q=k.appointment;$(C=>[Q,...C])};z.on("appointmentCreated",U);const Fe=()=>{i&&z.emit("adminAppointmentsActive",{adminId:i._id,role:i.role})},ut=()=>{};return z.on("connect",Fe),z.on("disconnect",ut),()=>{clearInterval(p),clearInterval(h),z.off("profileUpdated",j),z.off("commentUpdate",P),z.off("appointmentUpdate",A),z.off("paymentStatusUpdated",pe),z.off("appointmentCreated",U),z.off("connect",Fe),z.off("disconnect",ut)}},[Ot,rs,i]),c.useEffect(()=>{if(Ee.length===0)return;let h=Ee.filter(U=>{var C,W,fe,M,de,B,Ne,X,Ue;const Fe=new Date(U.date)<new Date||new Date(U.date).toDateString()===new Date().toDateString()&&U.time&&U.time<new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),ut=O==="all"?!0:O==="outdated"?Fe:U.status===O,k=((W=(C=U.buyerId)==null?void 0:C.email)==null?void 0:W.toLowerCase().includes(oe.toLowerCase()))||((M=(fe=U.sellerId)==null?void 0:fe.email)==null?void 0:M.toLowerCase().includes(oe.toLowerCase()))||((B=(de=U.buyerId)==null?void 0:de.username)==null?void 0:B.toLowerCase().includes(oe.toLowerCase()))||((X=(Ne=U.sellerId)==null?void 0:Ne.username)==null?void 0:X.toLowerCase().includes(oe.toLowerCase()))||((Ue=U.propertyName)==null?void 0:Ue.toLowerCase().includes(oe.toLowerCase())),Q=(!ge||new Date(U.date)>=new Date(ge))&&(!Re||new Date(U.date)<=new Date(Re));return ut&&k&&Q});const p=10,j=Math.ceil(h.length/p);Me(j);const P=(ve-1)*p,A=P+p,pe=h.slice(P,A);$(pe)},[Ee,ve,oe,O,ge,Re]),c.useEffect(()=>{if(Ke.length===0)return;let h=Ke.filter(U=>{var C,W,fe,M,de,B,Ne,X,Ue;const Fe=new Date(U.date)<new Date||new Date(U.date).toDateString()===new Date().toDateString()&&U.time&&U.time<new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),ut=O==="all"?!0:O==="outdated"?Fe:U.status===O,k=((W=(C=U.buyerId)==null?void 0:C.email)==null?void 0:W.toLowerCase().includes(oe.toLowerCase()))||((M=(fe=U.sellerId)==null?void 0:fe.email)==null?void 0:M.toLowerCase().includes(oe.toLowerCase()))||((B=(de=U.buyerId)==null?void 0:de.username)==null?void 0:B.toLowerCase().includes(oe.toLowerCase()))||((X=(Ne=U.sellerId)==null?void 0:Ne.username)==null?void 0:X.toLowerCase().includes(oe.toLowerCase()))||((Ue=U.propertyName)==null?void 0:Ue.toLowerCase().includes(oe.toLowerCase())),Q=(!ge||new Date(U.date)>=new Date(ge))&&(!Re||new Date(U.date)<=new Date(Re));return ut&&k&&Q});const p=10,j=Math.ceil(h.length/p);tr(j);const P=(ae-1)*p,A=P+p,pe=h.slice(P,A);sr(pe)},[Ke,ae,oe,O,ge,Re]),c.useEffect(()=>(Kt?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[Kt]),c.useEffect(()=>{i&&($(h=>h.map(p=>{const j={...p};return p.buyerId&&(p.buyerId._id===i._id||p.buyerId===i._id)&&(j.buyerId={...j.buyerId,username:i.username,email:i.email,mobileNumber:i.mobileNumber,avatar:i.avatar}),p.sellerId&&(p.sellerId._id===i._id||p.sellerId===i._id)&&(j.sellerId={...j.sellerId,username:i.username,email:i.email,mobileNumber:i.mobileNumber,avatar:i.avatar}),j})),re(h=>h.map(p=>{const j={...p};return p.buyerId&&(p.buyerId._id===i._id||p.buyerId===i._id)&&(j.buyerId={...j.buyerId,username:i.username,email:i.email,mobileNumber:i.mobileNumber,avatar:i.avatar}),p.sellerId&&(p.sellerId._id===i._id||p.sellerId===i._id)&&(j.sellerId={...j.sellerId,username:i.username,email:i.email,mobileNumber:i.mobileNumber,avatar:i.avatar}),j})))},[i]);const ct=async h=>{ke(h),N(""),q(!0),qe(!1),H(null)},ot=async()=>{var h,p;if(!vt.trim()){g.error("Please provide a reason for cancelling this appointment.");return}try{const{data:j}=await T.patch(`${L}/api/bookings/${be}/cancel`,{reason:vt},{withCredentials:!0,headers:{"Content-Type":"application/json"}});$(P=>P.map(A=>A._id===be?{...A,status:"cancelledByAdmin",cancelReason:vt}:A)),g.success("Appointment cancelled successfully. Both buyer and seller have been notified of the cancellation."),q(!1),ke(null),N("")}catch(j){console.error("Error in confirmAdminCancel:",j),g.error(((p=(h=j.response)==null?void 0:h.data)==null?void 0:p.message)||"Failed to cancel appointment.")}},mt=async h=>{ke(h),kt(!0),qe(!1),H(null)},os=async()=>{var h,p;try{const{data:j}=await T.patch(`${L}/api/bookings/${be}/reinitiate`,{},{withCredentials:!0,headers:{"Content-Type":"application/json"}});$(P=>P.map(A=>A._id===be?{...A,status:"pending",cancelReason:""}:A)),g.success("Appointment reinitiated successfully. Both buyer and seller have been notified."),kt(!1),ke(null)}catch(j){console.error("Error in confirmReinitiate:",j),g.error(((p=(h=j.response)==null?void 0:h.data)==null?void 0:p.message)||"Failed to reinitiate appointment.")}},as=async h=>{ke(h),Ut(!0),qe(!1),H(null)},Ss=async()=>{var h,p;try{const{data:j}=await T.patch(`${L}/api/bookings/${be}/archive`,{},{withCredentials:!0,headers:{"Content-Type":"application/json"}}),P=m.find(A=>A._id===be);P&&($(A=>A.filter(pe=>pe._id!==be)),re(A=>[{...P,archivedByAdmin:!0,archivedAt:new Date},...A])),g.success("Appointment archived successfully."),Ut(!1),ke(null)}catch(j){console.error("Error in confirmArchive:",j),g.error(((p=(h=j.response)==null?void 0:h.data)==null?void 0:p.message)||"Failed to archive appointment.")}},$t=async h=>{ke(h),Bt(!0),qe(!1),H(null)},te=async()=>{var h,p;try{const{data:j}=await T.patch(`${L}/api/bookings/${be}/unarchive`,{},{withCredentials:!0,headers:{"Content-Type":"application/json"}}),P=Ke.find(A=>A._id===be);P&&(re(A=>A.filter(pe=>pe._id!==be)),$(A=>[{...P,archivedByAdmin:!1,archivedAt:void 0},...A])),g.success("Appointment unarchived successfully."),Bt(!1),ke(null)}catch(j){console.error("Error in confirmUnarchive:",j),g.error(((p=(h=j.response)==null?void 0:h.data)==null?void 0:p.message)||"Failed to unarchive appointment.")}},K=async h=>{if(!h){g.error("User ID not available");return}et(!0),Xe(!0),qe(!1),H(null);try{const{data:p}=await T.get(`${L}/api/user/id/${h}`);rr(p)}catch{g.error("Failed to fetch user details."),Xe(!1)}et(!1)},w=m.map(h=>({...h,comments:h.comments||[]})),It=Ns.map(h=>({...h,comments:h.comments||[]})),or=async()=>{ue(!0);try{const{data:h}=await T.get(`${L}/api/bookings`,{withCredentials:!0});$(h);const{data:p}=await T.get(`${L}/api/bookings/archived`,{withCredentials:!0});re(Array.isArray(p)?p:[])}catch{}finally{ue(!1)}},_s=h=>{if(!h){g.error("No message to copy");return}navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(h).then(()=>{g.success("Copied",{autoClose:2e3,position:"bottom-center"})}).catch(()=>{is(h)}):is(h)},is=h=>{try{const p=document.createElement("textarea");p.value=h,p.style.position="fixed",p.style.left="-999999px",p.style.top="-999999px",document.body.appendChild(p),p.focus(),p.select();const j=document.execCommand("copy");document.body.removeChild(p),j?g.success("Copied",{autoClose:2e3,position:"bottom-center"}):(console.error("Fallback copy failed"),g.error("Failed to copy message"))}catch(p){console.error("Fallback copy error:",p),g.error("Copy not supported")}},$s=c.useCallback(h=>{Xt===h&&tt?(qe(!1),H(null)):(qe(!0),H(h))},[Xt,tt]),Se=c.useCallback(()=>{He(h=>!h)},[]);return Qe?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Loading appointments..."})]})}):Array.isArray(m)?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-blue-100 py-10 px-2 md:px-8",children:[e.jsx("div",{className:"max-w-7xl mx-auto mb-4 flex justify-end",children:e.jsxs("a",{href:"/admin/payments",className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-semibold shadow",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("path",{d:"M2 7a2 2 0 012-2h16a2 2 0 012 2v3H2V7z"}),e.jsx("path",{d:"M2 12h20v5a2 2 0 01-2 2H4a2 2 0 01-2-2v-5zm4 3a1 1 0 100 2h6a1 1 0 100-2H6z"})]}),"Go to Payments"]})}),e.jsx(Pa,{position:"top-center",autoClose:2e3,closeOnClick:!0,containerClassName:"!z-[100]",toastOptions:{style:{fontSize:"0.9rem",borderRadius:"8px",boxShadow:"0 2px 8px #0001"}}}),e.jsxs("div",{className:"max-w-7xl mx-auto bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-6",children:[e.jsx("h3",{className:"text-2xl sm:text-3xl font-extrabold text-blue-700 drop-shadow",children:Y?`Archived Appointments (${It.length})`:`All Appointments (${w.length})`}),e.jsxs("div",{className:"flex flex-row w-full sm:w-auto gap-2 sm:gap-4 justify-center sm:justify-end mt-2 sm:mt-0",children:[e.jsx("button",{onClick:or,className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-2.5 py-1.5 rounded-md hover:from-blue-600 hover:to-purple-600 transition-all font-semibold shadow-md text-xs sm:text-base sm:px-4 sm:py-2 sm:rounded-lg w-1/2 sm:w-auto",title:"Refresh appointments",children:"Refresh"}),e.jsx("button",{onClick:()=>{Ft(!Y),wt(1),ie(1)},className:`bg-gradient-to-r text-white px-2.5 py-1.5 rounded-md transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-1 sm:gap-2 text-xs sm:text-base w-1/2 sm:w-auto sm:px-6 sm:py-3 sm:rounded-lg justify-center ${Y?"from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600":"from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700"}`,children:Y?e.jsxs(e.Fragment,{children:[e.jsx(Jt,{})," ",e.jsx("span",{children:"Active Appointments"})]}):e.jsxs(e.Fragment,{children:[e.jsx(er,{})," ",e.jsxs("span",{children:["Archived Appointments (",Ke.length,")"]})]})})]})]}),e.jsx("p",{className:"text-center text-gray-600 mb-6",children:Y?"View and manage archived appointments. You can unarchive them to move them back to active appointments.":"ðŸ’¡ High data traffic may cause this page to slow down or stop working. Please refresh to continue using it normally.âš ï¸ Chats are encrypted and secure. View only for valid purposes like disputes or fraud checks. Unauthorized access or sharing is prohibited and will be logged."}),e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold text-sm",children:"Status:"}),e.jsxs("select",{className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200 text-sm",value:O,onChange:h=>Tt(h.target.value),children:[e.jsx("option",{value:"all",children:"All Appointments"}),e.jsx("option",{value:"pending",children:"Pending Appointments"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"cancelledByBuyer",children:"Cancelled by Buyer"}),e.jsx("option",{value:"cancelledBySeller",children:"Cancelled by Seller"}),e.jsx("option",{value:"cancelledByAdmin",children:"Cancelled by Admin"}),e.jsx("option",{value:"deletedByAdmin",children:"Deleted by Admin"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"noShow",children:"No Show"}),e.jsx("option",{value:"outdated",children:"Outdated"})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold text-sm",children:"From:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200 text-sm",value:ge,onChange:h=>jt(h.target.value),max:Re||void 0}),e.jsx("label",{className:"font-semibold text-sm",children:"To:"}),e.jsx("input",{type:"date",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200 text-sm",value:Re,onChange:h=>Qt(h.target.value),min:ge||void 0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Tr,{className:"text-gray-500 hover:text-blue-500 transition-colors duration-200"}),e.jsx("input",{type:"text",className:"border rounded px-2 py-1 focus:outline-none focus:ring focus:ring-blue-200 text-sm flex-1",placeholder:"Search by email, property, or username...",value:oe,onChange:h=>Pt(h.target.value)})]})]})]}),Y?It.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg",children:"No archived appointments found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-gray-100 to-gray-200",children:[e.jsx("th",{className:"border p-2",children:"Date & Time"}),e.jsx("th",{className:"border p-2",children:"Property"}),e.jsx("th",{className:"border p-2",children:"Payment"}),e.jsx("th",{className:"border p-2",children:"Buyer"}),e.jsx("th",{className:"border p-2",children:"Seller"}),e.jsx("th",{className:"border p-2",children:"Purpose"}),e.jsx("th",{className:"border p-2",children:"Message"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Actions"}),e.jsx("th",{className:"border p-2",children:"Connect"})]})}),e.jsx("tbody",{children:It.map(h=>e.jsx(Bo,{appt:h,currentUser:i,handleAdminCancel:ct,handleReinitiateAppointment:mt,handleArchiveAppointment:as,handleUnarchiveAppointment:$t,onUserClick:K,isArchived:!0,copyMessageToClipboard:_s,updateAppointmentComments:ss,showCancelModal:I,setShowCancelModal:q,showReinitiateModal:J,setShowReinitiateModal:kt,showArchiveModal:Te,setShowArchiveModal:Ut,showUnarchiveModal:Pe,setShowUnarchiveModal:Bt,appointmentToHandle:be,setAppointmentToHandle:ke,cancelReason:vt,setCancelReason:N,confirmAdminCancel:ot,confirmReinitiate:os,confirmArchive:Ss,confirmUnarchive:te,showReactionsBar:tt,setShowReactionsBar:qe,reactionsMessageId:Xt,setReactionsMessageId:H,showReactionsEmojiPicker:Nt,setShowReactionsEmojiPicker:He,reactionEmojiSearchTerm:st,setReactionEmojiSearchTerm:es,getFilteredEmojis:ts,toggleReactionsBar:$s,toggleReactionsEmojiPicker:Se,onExportChat:(p,j)=>{R(p),St(j),rt(!0)}},h._id))})]})}):w.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg",children:"No appointments found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse rounded-lg overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-100 to-purple-100",children:[e.jsx("th",{className:"border p-2",children:"Date & Time"}),e.jsx("th",{className:"border p-2",children:"Property"}),e.jsx("th",{className:"border p-2",children:"Payment"}),e.jsx("th",{className:"border p-2",children:"Buyer"}),e.jsx("th",{className:"border p-2",children:"Seller"}),e.jsx("th",{className:"border p-2",children:"Purpose"}),e.jsx("th",{className:"border p-2",children:"Message"}),e.jsx("th",{className:"border p-2",children:"Status"}),e.jsx("th",{className:"border p-2",children:"Actions"}),e.jsx("th",{className:"border p-2",children:"Connect"})]})}),e.jsx("tbody",{children:w.map(h=>e.jsx(Bo,{appt:h,currentUser:i,handleAdminCancel:ct,handleReinitiateAppointment:mt,handleArchiveAppointment:as,handleUnarchiveAppointment:$t,onUserClick:K,isArchived:!1,copyMessageToClipboard:_s,updateAppointmentComments:ss,showCancelModal:I,setShowCancelModal:q,showReinitiateModal:J,setShowReinitiateModal:kt,showArchiveModal:Te,setShowArchiveModal:Ut,showUnarchiveModal:Pe,setShowUnarchiveModal:Bt,appointmentToHandle:be,setAppointmentToHandle:ke,cancelReason:vt,setCancelReason:N,confirmAdminCancel:ot,confirmReinitiate:os,confirmArchive:Ss,confirmUnarchive:te,showReactionsBar:tt,setShowReactionsBar:qe,reactionsMessageId:Xt,setReactionsMessageId:H,showReactionsEmojiPicker:Nt,setShowReactionsEmojiPicker:He,reactionEmojiSearchTerm:st,setReactionEmojiSearchTerm:es,getFilteredEmojis:ts,toggleReactionsBar:$s,toggleReactionsEmojiPicker:Se,onExportChat:(p,j)=>{R(p),St(j),rt(!0)}},h._id))})]})}),!Y&&Oe>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-6 gap-2",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Page ",ve," of ",Oe]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsx("button",{onClick:()=>{wt(Math.max(1,ve-1)),g.info(`Navigated to page ${Math.max(1,ve-1)}`)},disabled:ve===1,className:"px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed w-full sm:w-auto",children:"Previous"}),e.jsx("button",{onClick:()=>{wt(Math.min(Oe,ve+1)),g.info(`Navigated to page ${Math.min(Oe,ve+1)}`)},disabled:ve===Oe,className:"px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed w-full sm:w-auto",children:"Next"})]})]}),Y&&he>1&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mt-6 gap-2",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Archived Page ",ae," of ",he]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsx("button",{onClick:()=>{ie(Math.max(1,ae-1)),g.info(`Navigated to archived page ${Math.max(1,ae-1)}`)},disabled:ae===1,className:"px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed w-full sm:w-auto",children:"Previous"}),e.jsx("button",{onClick:()=>{ie(Math.min(he,ae+1)),g.info(`Navigated to archived page ${Math.min(he,ae+1)}`)},disabled:ae===he,className:"px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed w-full sm:w-auto",children:"Next"})]})]})]}),Kt&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",style:{overflow:"hidden"},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 max-h-[90vh] overflow-y-auto relative animate-fadeIn",children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-40 shadow",onClick:()=>Xe(!1),title:"Close","aria-label":"Close",children:e.jsx(me,{className:"w-4 h-4"})}),le?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsx("p",{className:"ml-4 text-gray-600",children:"Loading user details..."})]}):ne?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col items-center justify-center bg-gradient-to-r from-blue-100 to-purple-100 rounded-t-2xl px-6 py-6 border-b border-gray-200 sticky top-[env(safe-area-inset-top,0px)] z-20",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Fa,{user:{username:ne.username,avatar:ne.avatar},size:"w-16 h-16",textSize:"text-lg",showBorder:!0,className:"border-4 border-white shadow-lg"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 border-2 border-white rounded-full flex items-center justify-center",children:ne.role==="admin"||ne.role==="rootadmin"?e.jsx(ks,{className:"w-3 h-3 text-white"}):e.jsx(Pr,{className:"w-3 h-3 text-white"})})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-blue-800 flex items-center gap-2",children:[ne.username,(ne.role==="admin"||ne.role==="rootadmin")&&e.jsx(ks,{className:"text-purple-600 text-base",title:"Admin user"})]}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx("p",{className:"text-sm text-gray-600 capitalize font-medium bg-white px-3 py-1 rounded-full shadow-sm",children:ne.role||"User"}),ne.adminApprovalStatus&&e.jsx("p",{className:`text-xs font-medium px-2 py-1 rounded-full ${ne.adminApprovalStatus==="approved"?"bg-green-100 text-green-700":ne.adminApprovalStatus==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:ne.adminApprovalStatus})]})]})]})}),e.jsx("div",{className:"px-6 py-6 space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx(Ua,{className:"text-blue-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Email"}),e.jsx("p",{className:"text-gray-800 font-medium",children:ne.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-green-500",children:[e.jsx(Ba,{className:"text-green-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Phone"}),e.jsx("p",{className:"text-gray-800 font-medium",children:ne.mobileNumber||"Not provided"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border-l-4 border-purple-500",children:[e.jsx(za,{className:"text-purple-500 w-5 h-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Member Since"}),e.jsx("p",{className:"text-gray-800 font-medium",children:new Date(ne.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]})]})]})})]}):e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("p",{className:"text-gray-600",children:"User not found"})})]})}),e.jsx(Ja,{isOpen:Cs,onClose:()=>{rt(!1),R(null),St([])},onExport:async h=>{var p;try{g.info("Generating PDF...",{autoClose:2e3});const j=((p=xe==null?void 0:xe.buyerId)==null?void 0:p._id)===i._id?xe==null?void 0:xe.sellerId:xe==null?void 0:xe.buyerId,P=await Za(xe,Ct,i,j,h);P.success?g.success(`Chat transcript exported as ${P.filename}`):g.error(`Export failed: ${P.error}`)}catch(j){g.error("Failed to export chat transcript"),console.error("Export error:",j)}},appointment:xe,messageCount:Ct.filter(h=>{var p;return!h.deleted&&(((p=h.message)==null?void 0:p.trim())||h.imageUrl||h.audioUrl||h.videoUrl||h.documentUrl)}).length,imageCount:Ct.filter(h=>h.imageUrl&&!h.deleted).length})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-50 to-blue-100",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Session expired or unauthorized"}),e.jsx("p",{className:"text-gray-700 mb-4",children:"Please sign in again to access admin appointments."}),e.jsx(zo,{to:"/sign-in",className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-colors",children:"Go to Sign In"})]})})}function Rr(i){const m=new Date,$=new Date;return $.setDate(m.getDate()-1),i.toDateString()===m.toDateString()?"Today":i.toDateString()===$.toDateString()?"Yesterday":i.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}function Ka({appointmentId:i,appointment:m}){var Oe;const[$,Ee]=v.useState(null),[Zt,Ke]=v.useState(!0),[re,Qe]=v.useState(!1),[ue,O]=v.useState(!1);v.useEffect(()=>{async function Me(){try{const ae=await fetch(`${L}/api/payments/history?appointmentId=${i}`,{credentials:"include"}),ie=await ae.json();ae.ok&&Array.isArray(ie.payments)&&ie.payments.length>0?Ee(ie.payments[0]):Ee(null)}catch{Ee(null)}finally{Ke(!1)}}Me()},[i]),v.useEffect(()=>{const Me=ae=>{ue&&!ae.target.closest(".status-options-container")&&O(!1)};if(ue)return document.addEventListener("mousedown",Me),()=>document.removeEventListener("mousedown",Me)},[ue]);const Tt=async Me=>{if(m&&(m==null?void 0:m.paymentConfirmed)!==Me){Qe(!0),O(!1);try{if(Me){if((await fetch(`${L}/api/payments/admin/mark-paid`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({appointmentId:i})})).ok){const ie=await fetch(`${L}/api/payments/history?appointmentId=${i}`,{credentials:"include"}),he=await ie.json();ie.ok&&Array.isArray(he.payments)&&Ee(he.payments[0]||null)}}else if((await fetch(`${L}/api/payments/admin/mark-unpaid`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({appointmentId:i})})).ok){const ie=await fetch(`${L}/api/payments/history?appointmentId=${i}`,{credentials:"include"}),he=await ie.json();ie.ok&&Array.isArray(he.payments)&&Ee(he.payments[0]||null)}}finally{Qe(!1)}}},oe=e.jsxs("div",{className:"mt-1 relative status-options-container",children:[e.jsx("button",{onClick:()=>O(!ue),disabled:re,className:"text-[10px] px-2 py-1 rounded border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",title:"Change payment status",children:re?"Updating...":"Change Status"}),ue&&e.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 min-w-[120px]",children:m!=null&&m.paymentConfirmed?e.jsx("button",{onClick:()=>Tt(!1),className:"w-full text-left px-3 py-2 text-[10px] text-red-700 hover:bg-red-50 border-b border-gray-100",children:"Mark Unpaid"}):e.jsx("button",{onClick:()=>Tt(!0),className:"w-full text-left px-3 py-2 text-[10px] text-green-700 hover:bg-green-50 border-b border-gray-100",children:"Mark Paid"})})]});if(Zt)return e.jsx(Oo,{className:"animate-spin text-blue-600 mx-auto"});if(!$)return e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${m!=null&&m.paymentConfirmed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:m!=null&&m.paymentConfirmed?"Paid (Admin)":"Pending"}),(m==null?void 0:m.paymentConfirmed)&&e.jsx("div",{className:"text-[10px] text-green-700 font-semibold",children:"âœ“ Admin Confirmed"}),oe]});const Pt=!!((Oe=$==null?void 0:$.metadata)!=null&&Oe.adminMarked),ve=$.status==="completed"||Pt?"bg-green-100 text-green-800":$.status==="pending"?"bg-yellow-100 text-yellow-800":$.status==="failed"?"bg-red-100 text-red-800":$.status==="refunded"?"bg-blue-100 text-blue-800":$.status==="partially_refunded"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800",wt=$.status==="completed"?"Paid":Pt?"Paid (Admin)":$.status==="pending"?"Pending":$.status==="failed"?"Failed":$.status==="refunded"?"Refunded":$.status==="partially_refunded"?"Partial Refund":$.status;return e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${ve}`,children:wt}),typeof $.amount=="number"&&e.jsx("div",{className:"text-[10px] text-gray-500 inline-flex items-center gap-1",children:($.currency||"USD")==="INR"?e.jsxs("span",{children:["â‚¹ ",Number($.amount).toFixed(2)]}):e.jsxs("span",{children:["$ ",Number($.amount).toFixed(2)]})}),$.refundAmount>0&&e.jsxs("div",{className:"text-[10px] text-red-500",children:[e.jsxs("div",{children:["Refunded: ",($.currency||"USD")==="INR"?"â‚¹":"$",Number($.refundAmount).toFixed(2)]}),$.refundedAt&&e.jsxs("div",{className:"text-red-400",children:[new Date($.refundedAt).toLocaleDateString("en-GB")," ",new Date($.refundedAt).toLocaleTimeString("en-GB")]})]}),(m==null?void 0:m.paymentConfirmed)&&e.jsx("div",{className:"text-[10px] text-green-700 font-semibold",children:"âœ“ Admin Confirmed"}),oe]})}function Bo({appt:i,currentUser:m,handleAdminCancel:$,handleReinitiateAppointment:Ee,handleArchiveAppointment:Zt,handleUnarchiveAppointment:Ke,onUserClick:re,isArchived:Qe,copyMessageToClipboard:ue,updateAppointmentComments:O,showCancelModal:Tt,setShowCancelModal:oe,showReinitiateModal:Pt,setShowReinitiateModal:ve,showArchiveModal:wt,setShowArchiveModal:Oe,showUnarchiveModal:Me,setShowUnarchiveModal:ae,appointmentToHandle:ie,setAppointmentToHandle:he,cancelReason:tr,setCancelReason:Ns,confirmAdminCancel:sr,confirmReinitiate:ne,confirmArchive:rr,confirmUnarchive:Kt,showReactionsBar:Xe,setShowReactionsBar:le,reactionsMessageId:et,setReactionsMessageId:Y,showReactionsEmojiPicker:Ft,setShowReactionsEmojiPicker:ge,reactionEmojiSearchTerm:jt,setReactionEmojiSearchTerm:Re,getFilteredEmojis:Qt,toggleReactionsBar:be,toggleReactionsEmojiPicker:ke,onExportChat:vt}){var fo,yo,bo,po,wo,jo,vo,ko,No,Co,So,_o,$o,Io,Lo,Do,Ao;const[N,I]=v.useState(i.comments||[]);v.useEffect(()=>{if(N.length>0){const t=N.filter(s=>s.starredBy&&s.starredBy.includes(m._id));$e(t)}},[N,m._id]);const[q,J]=c.useState(""),[kt,Te]=c.useState(null),[Ut,Pe]=c.useState(!1),[Bt,tt]=c.useState(!1),[qe,Xt]=c.useState(!1),[H,Nt]=c.useState(null),[He,st]=c.useState(""),[es,zt]=c.useState(""),[ts,Cs]=c.useState(null),[rt,xe]=c.useState(null),[R,Ct]=c.useState(!1),[St,_t]=c.useState(!1),[ss,Ot]=c.useState(""),[rs,ct]=c.useState(!1),[ot,mt]=c.useState(null),[os,as]=c.useState(!1),[Ss,$t]=c.useState(!1),te=v.useRef(null),K=v.useRef(null),w=v.useRef(null),It=v.useRef(0),[or,_s]=c.useState([]),[is,$s]=c.useState(!1),Se=v.useRef({}),[h,p]=c.useState(!0),[j,P]=c.useState(0),A=30,[pe,U]=c.useState(A),[Fe,ut]=c.useState(""),[k,Q]=c.useState(!1),[C,W]=c.useState(!1),[fe,M]=c.useState(()=>Aa(i._id)),[de,B]=c.useState(null),[Ne,X]=c.useState(!1),Ue=v.useRef(null),[qo,ns]=c.useState(!1),[ls,ds]=c.useState(""),[ar,Is]=c.useState(!1),[Ho,Fr]=c.useState(!1),[_e,Ur]=c.useState(null);v.useEffect(()=>{if(!R||!(i!=null&&i._id)||!(m!=null&&m._id))return;const t=`admin_appt_draft_${i._id}_${m._id}`,s=localStorage.getItem(t);s!=null&&(J(s),setTimeout(()=>{try{if(w.current){const r=w.current.value.length;w.current.focus(),w.current.setSelectionRange(r,r),Ks(w.current)}}catch{}},0))},[R,i==null?void 0:i._id,m==null?void 0:m._id]),v.useEffect(()=>{if(!R||!(i!=null&&i._id)||!(m!=null&&m._id))return;const t=`admin_appt_draft_${i._id}_${m._id}`;localStorage.setItem(t,q)},[q,R,i==null?void 0:i._id,m==null?void 0:m._id]);const[ir,Ls]=c.useState(!1),[Be,$e]=c.useState([]),[nr,Br]=c.useState(!1),[Ds,As]=c.useState(!1),[zr,Or]=c.useState(null),[qr,Hr]=c.useState(!1),[lr,Vr]=c.useState(!1),[Vo,Wr]=c.useState(!1),[qt,Ie]=c.useState(!1),[Gr,dr]=c.useState(!1),Ve=t=>{t(),setTimeout(()=>dr(!1),100)},[cr,at]=c.useState(!1),[Le,Ce]=c.useState([]),[Es,Ms]=c.useState({starring:!1,copying:!1,deleting:!1}),[mr,Rs]=c.useState(!1),[ur,Ts]=c.useState(""),[it,cs]=c.useState([]),[ms,nt]=c.useState(-1),[Ps,us]=c.useState(!1),[Wo,Go]=c.useState(""),[Qa,Yr]=c.useState(null),[lt,dt]=c.useState(!1),[Jr,Lt]=c.useState(""),[F,ht]=c.useState([]),[Yo,hs]=c.useState(!1),[Jo,Fs]=c.useState([]),[we,De]=c.useState(0),[gs,Dt]=c.useState({}),[Zo,xs]=c.useState(!1),[gt,We]=c.useState(0),[Zr,Us]=c.useState(-1),[Ko,fs]=c.useState(0),[Ht,hr]=c.useState([]),[Xa,Kr]=c.useState(!1),At=v.useRef(null),gr=v.useRef(null),xr=v.useRef(null),Qo=v.useRef(null),Xo=v.useRef(null),Qr=v.useRef(null),Xr=v.useRef(null),[fr,xt]=c.useState(!1),[Ge,Bs]=c.useState(null),[ea,zs]=c.useState(!1),[ft,Os]=c.useState(null),[ta,qs]=c.useState(!1),[ys,Hs]=c.useState(""),[bs,Vs]=c.useState(""),[sa,yr]=c.useState(null),[Ye,Vt]=c.useState(null),[ra,ps]=c.useState(!1),[ws,br]=c.useState(""),[oa,pr]=c.useState(null),wr=v.useRef(null),[aa,Ws]=c.useState(!1),[Et,jr]=c.useState(!1),[Gs,Ys]=c.useState(!1),[js,Wt]=c.useState(0),[Mt,vr]=c.useState(null),Ae=v.useRef(null),kr=v.useRef([]),ze=v.useRef(null),yt=v.useRef(0),Nr=v.useRef(!1),Rt=v.useRef(0);v.useEffect(()=>{if(Ge){const t=URL.createObjectURL(Ge);return yr(t),()=>{URL.revokeObjectURL(t),yr(null)}}else yr(null)},[Ge]),v.useEffect(()=>{if(Ye){const t=URL.createObjectURL(Ye);return pr(t),()=>{URL.revokeObjectURL(t),pr(null)}}else pr(null)},[Ye]),v.useEffect(()=>{if(Et&&!Gs){yt.current||(yt.current=Date.now());const t=setInterval(()=>{const s=Date.now()-yt.current-Rt.current;Wt(s)},500);return()=>clearInterval(t)}},[Et,Gs]),v.useEffect(()=>()=>{ze.current&&clearInterval(ze.current),Mt&&Mt.getTracks().forEach(t=>t.stop())},[Mt]);const ia=async()=>{try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});vr(t),kr.current=[];const s=new MediaRecorder(t,{mimeType:"audio/webm"});Ae.current=s,s.ondataavailable=r=>{r.data&&r.data.size>0&&kr.current.push(r.data)},s.onstop=()=>{try{if(Nr.current)return;const r=new Blob(kr.current,{type:"audio/webm"}),a=`recording-${Date.now()}.webm`,o=new File([r],a,{type:"audio/webm"});Vt(o),Ws(!1),ps(!0)}catch{g.error("Failed to prepare audio preview")}finally{Mt&&Mt.getTracks().forEach(r=>r.stop()),vr(null),jr(!1),Ys(!1),Wt(0),Rt.current=0,ze.current&&clearInterval(ze.current),yt.current=0,Nr.current=!1}},s.start(100),jr(!0),yt.current=Date.now(),Wt(0),ze.current=setInterval(()=>{const r=Date.now()-yt.current-Rt.current;Wt(r)},500)}catch(t){console.error("Recording error:",t),g.error("Microphone permission denied or unavailable")}},na=()=>{if(Ae.current)try{Ae.current.stop()}catch{}},la=()=>{if(!(!Ae.current||Ae.current.state!=="recording"))try{Ae.current.pause(),Ys(!0),ze.current&&(clearInterval(ze.current),ze.current=null)}catch(t){console.error("Pause recording error:",t)}},da=()=>{if(!(!Ae.current||Ae.current.state!=="paused"))try{Ae.current.resume(),Ys(!1);const t=Date.now(),s=yt.current+js+Rt.current;Rt.current+=t-s,ze.current=setInterval(()=>{const r=Date.now()-yt.current-Rt.current;Wt(r)},500)}catch(t){console.error("Resume recording error:",t)}},eo=()=>{try{Nr.current=!0,Ae.current&&Ae.current.state!=="inactive"&&Ae.current.stop()}catch{}Mt&&Mt.getTracks().forEach(t=>t.stop()),vr(null),jr(!1),Ys(!1),Wt(0),Rt.current=0,ze.current&&clearInterval(ze.current),Ws(!1),Vt(null)};v.useEffect(()=>{if(!fr)return;const t=s=>{const r=Qr.current,a=Xr.current;a&&a.contains(s.target)||r&&r.contains(s.target)||xt(!1)};return document.addEventListener("mousedown",t,!0),()=>document.removeEventListener("mousedown",t,!0)},[fr]);const u=de?N.find(t=>t._id===de):null,je=async(t,s)=>{var r,a;try{if(!N.find(l=>l._id===t)){g.error("Message not found");return}const{data:n}=await T.patch(`${L}/api/bookings/${i._id}/comment/${t}/react`,{emoji:s},{withCredentials:!0,headers:{"Content-Type":"application/json"}});I(l=>l.map(d=>d._id===t?{...d,reactions:n.reactions||d.reactions||[]}:d)),O(i._id,N.map(l=>l._id===t?{...l,reactions:n.reactions||l.reactions||[]}:l)),ge(!1),le(!1),Y(null),g.success("Reaction added!")}catch(o){g.error(((a=(r=o.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to add reaction")}};v.useEffect(()=>(R?(document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%"):(document.body.style.overflow="",document.body.style.position="",document.body.style.width=""),()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.width=""}),[R]),v.useEffect(()=>{if(R&&(P(0),T.patch(`${L}/api/bookings/${i._id}/comments/read`,{},{withCredentials:!0}).catch(t=>{console.error("Error marking messages as read:",t)}),Be.length>0)){const t=Be.map(s=>{const r=N.find(a=>a._id===s._id);return r?{...s,starredBy:r.starredBy||[]}:s}).filter(s=>s.starredBy&&s.starredBy.includes(m._id));$e(t)}},[R,i._id,Be.length,N,m._id]),v.useEffect(()=>{if(C){const t=setTimeout(()=>{W(!1)},1e4);return()=>clearTimeout(t)}},[C]),v.useEffect(()=>(St?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[St]);const to=async()=>{if(i!=null&&i._id){Br(!0);try{await go();const{data:t}=await T.get(`${L}/api/bookings/${i._id}/starred-messages`,{withCredentials:!0});t.starredMessages&&$e(t.starredMessages)}catch(t){console.error("Error fetching starred messages:",t),g.error("Failed to load starred messages")}finally{Br(!1)}}};v.useEffect(()=>{ir&&to()},[ir,i._id]);const ca=async()=>{if(Be.length!==0){Be.length,Hr(!0);try{let t=0,s=0;const r=[];for(const a of Be)try{const o=await T.patch(`${L}/api/bookings/${i._id}/comment/${a._id}/star`,{starred:!1},{withCredentials:!0,headers:{"Content-Type":"application/json"}});t++,I(n=>n.map(l=>l._id===a._id?{...l,starredBy:(l.starredBy||[]).filter(d=>d!==m._id)}:l))}catch(o){console.error(`Failed to unstar message ${a._id}:`,o),s++,r.push(a)}$e(a=>a.filter(o=>!r.some(n=>n._id===o._id))),t>0&&s===0?(g.success(`Successfully removed ${t} starred message${t!==1?"s":""}`),Ls(!1)):t>0&&s>0?g.warning(`Partially successful: ${t} messages unstarred, ${s} failed`):g.error("Failed to unstar any messages. Please try again.")}catch(t){console.error("Error removing all starred messages:",t),g.error("Failed to remove all starred messages. Please try again.")}finally{Hr(!1)}}};v.useEffect(()=>{const t=n=>{qt&&!n.target.closest(".chat-options-menu")&&Ie(!1),Ne&&!n.target.closest(".chat-options-menu")&&X(!1)},s=n=>{mr&&!n.target.closest(".search-container")&&!n.target.closest(".enhanced-search-header")&&(Rs(!1),Ts(""),cs([]),nt(-1))},r=n=>{Ps&&!n.target.closest(".calendar-container")&&us(!1)},a=n=>{Ft&&!n.target.closest(".quick-reactions-modal")&&ge(!1),Xe&&!n.target.closest(".reactions-bar")&&(le(!1),Y(null))},o=()=>{qt&&Ie(!1),Ne&&X(!1),Xe&&!Ft&&(le(!1),Y(null))};return document.addEventListener("mousedown",t),document.addEventListener("mousedown",s),document.addEventListener("mousedown",r),document.addEventListener("mousedown",a),document.addEventListener("scroll",o,!0),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("mousedown",s),document.removeEventListener("mousedown",r),document.removeEventListener("mousedown",a),document.removeEventListener("scroll",o,!0)}},[qt,Ne,mr,Ps,Xe,Ft]),v.useEffect(()=>{if(lr){const t=setTimeout(()=>{Vr(!1),Wr(!0);const s=setTimeout(()=>Wr(!1),1e3);return()=>clearTimeout(s)},800);return()=>clearTimeout(t)}},[lr]),v.useEffect(()=>{ms>=0&&it[ms]&&ho(it[ms]._id)},[ms,it]),v.useEffect(()=>{const t=i.comments||[],s=It.current,r=t.length;if(I(a=>{const o=new Set(t.map(d=>d._id)),n=a.filter(d=>d._id.startsWith("temp-")),l=[...t];return n.forEach(d=>{o.has(d._id)||l.push(d)}),l.sort((d,y)=>new Date(d.timestamp)-new Date(y.timestamp)),l}),r>s){const o=t.slice(s).filter(n=>n.senderEmail!==m.email);o.length>0&&(R||P(n=>n+o.length),R&&h&&setTimeout(()=>{te.current&&te.current.scrollIntoView({behavior:"smooth"})},100),R&&setTimeout(()=>{T.patch(`${L}/api/bookings/${i._id}/comments/read`,{},{withCredentials:!0}).catch(n=>{console.error("Error marking messages as read:",n)})},100))}It.current=r},[i.comments,i._id,R,h,m.email]),v.useEffect(()=>{if(R){const t=i.comments||[];It.current=t.length}},[R,i._id]),v.useEffect(()=>{if(R){const t=()=>{K.current&&(K.current.scrollTop=K.current.scrollHeight),te.current&&te.current.scrollIntoView({behavior:"instant",block:"end"})};t(),setTimeout(t,100),setTimeout(t,300)}},[R]),v.useEffect(()=>{const t=K.current;if(!t)return;const s=()=>{if(t.scrollTop<=0&&N.length>pe){const r=t.scrollHeight;U(a=>Math.min(a+A,N.length)),setTimeout(()=>{const a=t.scrollHeight;t.scrollTop=a-r},0)}};return t.addEventListener("scroll",s),()=>t.removeEventListener("scroll",s)},[N.length,pe]),v.useEffect(()=>{U(A)},[i._id,R]);const so=v.useRef(N.length),ma=v.useRef(N);v.useEffect(()=>{const t=N.slice(so.current),s=t.length;if(so.current=N.length,ma.current=N,s>0&&R){const r=t.some(o=>o.senderEmail===m.email),a=t.filter(o=>o.senderEmail!==m.email);r||h?setTimeout(()=>{te.current&&te.current.scrollIntoView({behavior:"smooth"})},100):a.length>0&&P(o=>o+a.length)}},[N.length,h,R,m.email]),v.useEffect(()=>{R&&N.length>0&&setTimeout(()=>{K.current&&te.current&&(K.current.scrollTop=K.current.scrollHeight)},200)},[R,N.length]),v.useEffect(()=>{P(0)},[R]);const Cr=v.useCallback(()=>{if(!K.current||N.length===0)return;const s=K.current.getBoundingClientRect(),r=s.top+60;let a="";for(let o=0;o<N.length;o++){const n=Se.current[N[o]._id];if(n){const l=n.getBoundingClientRect();if(l.top>=r&&l.bottom<=s.bottom){const d=new Date(N[o].timestamp);a=Rr(d);break}}}if(!a)for(let o=0;o<N.length;o++){const n=Se.current[N[o]._id];if(n&&n.getBoundingClientRect().bottom>r){const d=new Date(N[o].timestamp);a=Rr(d);break}}a&&a!==Fe&&ut(a)},[N,Fe]),Sr=v.useRef(!1),Js=v.useCallback(async()=>{if(Sr.current)return;const t=N.filter(s=>{var r;return!((r=s.readBy)!=null&&r.includes(m._id))&&s.senderEmail!==m.email});if(t.length>0){Sr.current=!0;try{const{data:s}=await T.patch(`${L}/api/bookings/${i._id}/comments/read`,{},{withCredentials:!0,headers:{"Content-Type":"application/json"}});I(r=>r.map(a=>t.some(o=>o._id===a._id)?{...a,readBy:[...a.readBy||[],m._id],status:"read"}:a)),t.forEach(r=>{z.emit("messageRead",{appointmentId:i._id,messageId:r._id,userId:m._id})})}catch(s){console.error("Error marking messages as read:",s)}finally{Sr.current=!1}}},[N,m._id,i._id,z]),_r=v.useCallback(()=>{if(K.current){const{scrollTop:t,scrollHeight:s,clientHeight:r}=K.current,a=s-t-r<5;p(a),a&&j>0&&(P(0),Js())}},[j,Js]);v.useEffect(()=>{const t=K.current;if(t&&R){const s=()=>{_r(),Cr(),Q(!0),Ue.current&&clearTimeout(Ue.current),Ue.current=setTimeout(()=>{Q(!1)},1e3)};return t.addEventListener("scroll",s),_r(),setTimeout(Cr,100),()=>{t.removeEventListener("scroll",s),Ue.current&&clearTimeout(Ue.current)}}},[R,_r,Cr]);const ro=v.useCallback(()=>{P(0),setTimeout(()=>{K.current&&(K.current.scrollTop=K.current.scrollHeight),te.current&&te.current.scrollIntoView({behavior:"smooth",block:"end"}),setTimeout(()=>{Js()},500)},100)},[Js]);v.useEffect(()=>(R?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[R]),v.useEffect(()=>{function t({appointmentId:r,clearedAt:a}){r===i._id&&(I([]),P(0),le(!1),Y(null))}function s({appointmentId:r,commentId:a}){r===i._id&&(I(o=>o.filter(n=>n._id!==a)),le(!1),Y(null))}return z.on("chatClearedForUser",t),z.on("commentRemovedForUser",s),()=>{z.off("chatClearedForUser",t),z.off("commentRemovedForUser",s)}},[i._id]),v.useEffect(()=>{const t=a=>{a.appointmentId===i._id&&I(o=>o.map(n=>n._id===a.commentId?{...n,status:n.status==="read"?"read":"delivered",deliveredAt:new Date}:n))},s=a=>{a.appointmentId===i._id&&I(o=>o.map(n=>{var l;return(l=n.readBy)!=null&&l.includes(a.userId)?n:{...n,status:"read",readBy:[...n.readBy||[],a.userId],readAt:new Date}}))},r=a=>{a.appointmentId===i._id&&(I([]),g.success("Chat deleted by admin"),le(!1),Y(null))};return z.on("chatCleared",r),z.on("commentDelivered",t),z.on("commentRead",s),()=>{z.off("chatCleared",r),z.off("commentDelivered",t),z.off("commentRead",s)}},[i._id,R,m.email,h]),v.useEffect(()=>{if(!R)return;setTimeout(()=>{w.current&&Wa(w.current,w.current.value.length)},100);const s=r=>{r.ctrlKey&&r.key==="f"?(r.preventDefault(),w.current&&Ga(w.current,w.current.value.length)):r.key==="Escape"&&(r.preventDefault(),Ct(!1))};return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[R]),v.useEffect(()=>{!R||!/@[^\s]*$/.test(q||"")||is||(async()=>{try{const r=await(await fetch(`${L}/api/listing/get?limit=300`,{credentials:"include"})).json(),a=Array.isArray(r)?r.map(o=>({id:o._id,name:o.name||"Property"})):[];_s(a),$s(!0)}catch{}})()},[q,R,is]);const oo=async t=>{if(!t||t.length===0)return;const s=[],r=[];if(Array.from(t).forEach((a,o)=>{if(!a.type.startsWith("image/")){r.push(`File ${o+1}: Please select an image file`);return}if(a.size>5*1024*1024){r.push(`File ${o+1}: File size must be less than 5MB`);return}s.push(a)}),r.length>0){Lt(r.join(", ")),setTimeout(()=>Lt(""),5e3);return}if(s.length>10){Lt("Maximum 10 images allowed at once"),setTimeout(()=>Lt(""),3e3);return}ht(s),De(0),xs(!0),Lt("")},ua=async(t,s,r="")=>{var n,l;const a=`temp-${Date.now()}`,o={_id:a,sender:m._id,senderEmail:m.email,senderName:m.username,message:r||"",imageUrl:t,status:"sending",timestamp:new Date().toISOString(),readBy:[m._id],type:"image"};I(d=>[...d,o]),te.current&&te.current.scrollIntoView({behavior:"smooth"});try{const{data:d}=await T.post(`${L}/api/bookings/${i._id}/comment`,{message:r||"",imageUrl:t,type:"image"},{withCredentials:!0,headers:{"Content-Type":"application/json"}}),y=d.comments[d.comments.length-1];I(S=>S.map(_=>_._id===a?{..._,_id:y._id,status:y.status,readBy:y.readBy||_.readBy,timestamp:y.timestamp||_.timestamp}:_))}catch(d){console.error("Send image error:",d),I(y=>y.filter(S=>S._id!==a)),g.error(((l=(n=d.response)==null?void 0:n.data)==null?void 0:l.message)||"Failed to send image.")}},ao=async(t,s)=>{var r;if(!t||typeof t!="string"){g.error("Error: Invalid image URL. Cannot download image.");return}try{const a=t.split("/");let n=a[a.length-1];if(!n.includes(".")||n.length<5){const l=((r=t.match(/\.(jpg|jpeg|png|gif|webp|bmp|svg)(\?|$)/i))==null?void 0:r[1])||"jpg";n=`chat-image-${s||Date.now()}.${l}`}try{const l=await fetch(t,{mode:"cors",cache:"no-cache"});if(l.ok)try{const d=await l.blob();if(!d||d.size===0)throw new Error("Downloaded image is empty or corrupted");const y=window.URL.createObjectURL(d),S=document.createElement("a");S.href=y,S.download=n,S.style.display="none",document.body.appendChild(S),S.click(),document.body.removeChild(S),setTimeout(()=>window.URL.revokeObjectURL(y),100),g.success(`Image "${n}" downloaded successfully!`);return}catch(d){throw console.error("Blob processing error:",d),new Error(`Failed to process image data: ${d.message}`)}else{let d=`Server error (${l.status}): `;switch(l.status){case 404:d+="Image not found on server";break;case 403:d+="Access denied to image";break;case 500:d+="Server internal error";break;default:d+="Unable to fetch image"}throw new Error(d)}}catch(l){console.warn("Fetch failed, trying direct download:",l),l.name==="TypeError"&&l.message.includes("Failed to fetch")?g.warn("Network error: Trying alternative download method..."):l.message.includes("CORS")?g.warn("CORS error: Trying alternative download method..."):g.warn(`Fetch error: ${l.message}. Trying alternative download method...`);try{const d=document.createElement("a");d.href=t,d.download=n,d.target="_blank",d.rel="noopener noreferrer",d.style.display="none",document.body.appendChild(d),d.click(),document.body.removeChild(d),g.info(`Alternative download initiated. If it doesn't start automatically, please try right-clicking the image and selecting "Save image as..."`);return}catch(d){throw console.error("Direct download failed:",d),new Error(`Direct download failed: ${d.message}`)}}}catch(a){console.error("Download process failed:",a),g.error(`Download failed: ${a.message}. Attempting to open image in new tab...`);try{if(window.open(t,"_blank","noopener,noreferrer"))g.info("Image opened in new tab. You can right-click to save it manually.");else throw new Error("Pop-up blocked by browser")}catch(o){console.error("Failed to open image in new tab:",o),o.message.includes("Pop-up blocked")?g.error('Error: Pop-up blocked. Please allow pop-ups for this site or right-click the image and select "Save image as..."'):g.error(`All download methods failed: ${o.message}. Please right-click the image and select "Save image as..." or check your internet connection.`)}}},io=t=>{if(((F==null?void 0:F.length)||0)+t.length>10){g.error("Maximum 10 images allowed. Please remove some images first.");return}const r=t.filter(o=>o.type.startsWith("image/"));if(r.length===0){g.error("No valid image files found");return}ht(o=>[...o||[],...r]);const a={};r.forEach(o=>{a[o.name]=""}),Dt(o=>({...o,...a})),xs(!0),g.success(`${r.length} image${r.length>1?"s":""} added successfully!`)},no=async()=>{var t,s,r,a;if(!(!F||F.length===0)){dt(!0),We(0),Us(-1),fs(0),hr([]),Kr(!1);try{let o=!1;const n=[];for(let l=0;l<F.length;l++){const d=F[l];Us(l),fs(0);const y=new FormData;y.append("image",d);const S=new AbortController;At.current=S;try{const{data:_}=await T.post(`${L}/api/upload/image`,y,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"},signal:S.signal,onUploadProgress:Z=>{if(Z.total){const se=Math.round(Z.loaded*100/Z.total);fs(se);const ye=Math.round((l+se/100)/F.length*100);We(ye)}}});await ua(_.imageUrl,d.name,gs[d.name]||""),We(Math.round((l+1)/F.length*100))}catch(_){if(_.name==="CanceledError"||_.code==="ERR_CANCELED"){o=!0,Kr(!0);break}else n.push(d)}finally{At.current===S&&(At.current=null)}}n.length&&hr(n),!o&&n.length===0&&(ht([]),Dt({}),De(0),xs(!1))}catch(o){console.error("File upload error:",o),Lt(((s=(t=o.response)==null?void 0:t.data)==null?void 0:s.message)||"Upload failed. Please try again."),g.error(((a=(r=o.response)==null?void 0:r.data)==null?void 0:a.message)||"Upload failed. Please try again."),setTimeout(()=>Lt(""),3e3)}finally{dt(!1),We(0),Us(-1),fs(0)}}},Zs=()=>{if(At.current)try{At.current.abort()}catch{}dt(!1),Us(-1),fs(0)},ha=async()=>{Ht.length&&(ht(Ht),hr([]),await no())},ga=async(t,s,r="")=>{var n,l;const a=`temp-${Date.now()}`,o={_id:a,sender:m._id,senderEmail:m.email,message:r||"",videoUrl:t,type:"video",status:"sending",timestamp:new Date().toISOString()};I(d=>[...d,o]);try{const{data:d}=await T.post(`${L}/api/bookings/${i._id}/comment`,{message:r||"",videoUrl:t,type:"video"},{withCredentials:!0});I(y=>{var ye,V;const S=d.comments||((ye=d.updated)==null?void 0:ye.comments)||((V=d==null?void 0:d.appointment)==null?void 0:V.comments)||[],_=new Set(S.map(G=>G._id)),Z=y.filter(G=>G._id.startsWith("temp-")),se=[...S];return Z.forEach(G=>{_.has(G._id)||se.push(G)}),se}),O(i._id,d.comments||((n=d.updated)==null?void 0:n.comments)||((l=d==null?void 0:d.appointment)==null?void 0:l.comments)||[])}catch{g.error("Failed to send video"),I(y=>y.filter(S=>S._id!==a))}},xa=async()=>{var t,s;if(Ge)try{dt(!0);const r=new FormData;r.append("video",Ge);const{data:a}=await T.post(`${L}/api/upload/video`,r,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:o=>{const n=Math.round(o.loaded*100/Math.max(1,o.total||Ge.size));We(n)}});await ga(a.videoUrl,Ge.name,ys),Bs(null),zs(!1),Hs(""),We(0)}catch(r){g.error(((s=(t=r.response)==null?void 0:t.data)==null?void 0:s.message)||"Video upload failed")}finally{dt(!1)}},fa=async(t,s,r="")=>{var n,l;const a=`temp-${Date.now()}`,o={_id:a,sender:m._id,senderEmail:m.email,message:r||"",documentUrl:t,documentName:s.name,documentType:s.type,type:"document",status:"sending",timestamp:new Date().toISOString()};I(d=>[...d,o]);try{const{data:d}=await T.post(`${L}/api/bookings/${i._id}/comment`,{message:r||"",documentUrl:t,documentName:s.name,documentType:s.type,type:"document"},{withCredentials:!0});I(y=>{var ye,V;const S=d.comments||((ye=d.updated)==null?void 0:ye.comments)||((V=d==null?void 0:d.appointment)==null?void 0:V.comments)||[],_=new Set(S.map(G=>G._id)),Z=y.filter(G=>G._id.startsWith("temp-")),se=[...S];return Z.forEach(G=>{_.has(G._id)||se.push(G)}),se}),O(i._id,d.comments||((n=d.updated)==null?void 0:n.comments)||((l=d==null?void 0:d.appointment)==null?void 0:l.comments)||[])}catch{g.error("Failed to send document"),I(y=>y.filter(S=>S._id!==a))}},ya=async(t,s,r="")=>{var n,l;const a=`temp-${Date.now()}`,o={_id:a,sender:m._id,senderEmail:m.email,message:r||"",audioUrl:t,audioName:s.name,audioMimeType:s.type||null,type:"audio",status:"sending",timestamp:new Date().toISOString()};I(d=>[...d,o]);try{const{data:d}=await T.post(`${L}/api/bookings/${i._id}/comment`,{message:r||"",audioUrl:t,audioName:s.name,audioMimeType:s.type||null,type:"audio"},{withCredentials:!0});I(y=>{var ye,V;const S=d.comments||((ye=d.updated)==null?void 0:ye.comments)||((V=d==null?void 0:d.appointment)==null?void 0:V.comments)||[],_=new Set(S.map(G=>G._id)),Z=y.filter(G=>G._id.startsWith("temp-")),se=[...S];return Z.forEach(G=>{_.has(G._id)||se.push(G)}),se}),O(i._id,d.comments||((n=d.updated)==null?void 0:n.comments)||((l=d==null?void 0:d.appointment)==null?void 0:l.comments)||[])}catch{g.error("Failed to send audio"),I(y=>y.filter(S=>S._id!==a))}},ba=async()=>{var t,s;if(Ye)try{dt(!0);const r=new FormData;r.append("audio",Ye);const a=new AbortController;At.current=a;const{data:o}=await T.post(`${L}/api/upload/audio`,r,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"},signal:a.signal,onUploadProgress:n=>{const l=Math.round(n.loaded*100/Math.max(1,n.total||Ye.size));We(l)}});await ya(o.audioUrl,Ye,ws),Vt(null),ps(!1),br(""),We(0)}catch(r){if(r.name==="CanceledError"||r.code==="ERR_CANCELED")return;g.error(((s=(t=r.response)==null?void 0:t.data)==null?void 0:s.message)||"Audio upload failed")}finally{dt(!1),At.current=null}},pa=async()=>{var t,s;if(ft)try{dt(!0);const r=new FormData;r.append("document",ft);const{data:a}=await T.post(`${L}/api/upload/document`,r,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:o=>{const n=Math.round(o.loaded*100/Math.max(1,o.total||ft.size));We(n)}});await fa(a.documentUrl,ft,bs),Os(null),qs(!1),Vs(""),We(0)}catch(r){g.error(((s=(t=r.response)==null?void 0:t.data)==null?void 0:s.message)||"Document upload failed")}finally{dt(!1)}},$r=async()=>{if(!q.trim())return;window.dispatchEvent(new Event("closeEmojiPicker")),Vr(!0);const t=q.trim(),s=rt,r=`temp-${Date.now()}`,a={_id:r,sender:m._id,senderEmail:m.email,senderName:m.username,message:t,status:"sending",timestamp:new Date().toISOString(),readBy:[m._id],previewDismissed:Ut,...s?{replyTo:s._id}:{}};I(n=>[...n,a]);try{playMessageSent()}catch{}J("");try{const n=`admin_appt_draft_${i._id}_${m._id}`;localStorage.removeItem(n)}catch{}Te(null),Pe(!1),xe(null),wa();const o=()=>{w.current&&(w.current.focus(),w.current.setSelectionRange(0,0),document.activeElement!==w.current&&(w.current.click(),w.current.focus()))};o(),requestAnimationFrame(o),setTimeout(o,10),te.current&&te.current.scrollIntoView({behavior:"smooth"}),(async()=>{var n,l;try{const{data:d}=await T.post(`${L}/api/bookings/${i._id}/comment`,{message:t,...s?{replyTo:s._id}:{}},{withCredentials:!0,headers:{"Content-Type":"application/json"}}),y=d.comments[d.comments.length-1];I(S=>S.map(_=>_._id===r?{..._,_id:y._id,status:y.status,readBy:y.readBy||_.readBy,timestamp:y.timestamp||_.timestamp}:_)),O(i._id,d.comments)}catch(d){I(S=>S.filter(_=>_._id!==r)),J(t),g.error(((l=(n=d.response)==null?void 0:n.data)==null?void 0:l.message)||"Failed to send message.");const y=()=>{w.current&&(w.current.focus(),w.current.setSelectionRange(0,0),document.activeElement!==w.current&&(w.current.click(),w.current.focus()))};y(),requestAnimationFrame(y)}})()},Ir=async t=>{if(!He.trim())return;Cs(t),I(r=>{const a=r.map(o=>o._id===t?{...o,message:He,edited:!0,editedAt:new Date}:o);return O(i._id,a),a});try{const{data:r}=await T.patch(`${L}/api/bookings/${i._id}/comment/${t}`,{message:He},{withCredentials:!0,headers:{"Content-Type":"application/json"}});I(n=>{const l=n.map(d=>{const y=r.comments.find(S=>S._id===d._id);return y?y._id===t?{...y,edited:!0,editedAt:y.editedAt||new Date}:d.status==="read"&&y.status!=="read"?{...y,status:"read"}:y:d});return O(i._id,l),l}),Nt(null),st(""),J(es),setTimeout(()=>{zt("")},100),Te(null),Pe(!1),setTimeout(()=>{if(w.current){const n=new Event("input",{bubbles:!0});w.current.dispatchEvent(n),Ks(w.current)}},50);const o=()=>{w.current&&(w.current.focus(),w.current.setSelectionRange(0,0),document.activeElement!==w.current&&(w.current.click(),w.current.focus()))};o(),requestAnimationFrame(o),setTimeout(o,10),g.success("Message edited successfully!")}catch(r){console.error("Error editing comment:",r),I(a=>{const o=a.map(n=>n._id===t?{...n,message:n.originalMessage||n.message,edited:n.wasEdited||!1}:n);return O(i._id,o),o}),Nt(t),st(He),J(He),g.error("An error occurred. Please try again.")}finally{Cs(null)}},Ks=t=>{if(t){t.style.height="48px";const s=t.scrollHeight,r=144;s<=r?(t.style.height=s+"px",t.style.overflowY="hidden"):(t.style.height=r+"px",t.style.overflowY="auto")}},wa=()=>{w.current&&(w.current.style.height="48px",w.current.style.overflowY="hidden")},ja=t=>{zt(q),Nt(t._id),st(t.message),J(t.message),I(s=>s.map(r=>r._id===t._id?{...r,originalMessage:r.message,wasEdited:r.edited}:r)),setTimeout(()=>{if(w.current){w.current.focus();const s=w.current.value.length;w.current.setSelectionRange(s,s),Ks(w.current)}},100)},lo=t=>{xe(t);const s=()=>{if(w.current){w.current.focus();const r=w.current.value.length;w.current.setSelectionRange(r,r),document.activeElement!==w.current&&(w.current.click(),w.current.focus()),Ks(w.current)}};setTimeout(s,50),setTimeout(s,100),setTimeout(s,200)},co=t=>{Ur(t),Fr(!0)},mo=new Date(i.date)>new Date||new Date(i.date).toDateString()===new Date().toDateString()&&(!i.time||i.time>new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),uo=i.status==="rejected"||i.status==="cancelledByAdmin"||i.status==="cancelledByBuyer"||i.status==="cancelledBySeller"||i.status==="deletedByAdmin",va=t=>{if(!t.trim()){cs([]),nt(-1),document.querySelectorAll(".search-highlight").forEach(r=>{r.classList.remove("search-highlight","search-pulse","search-glow")}),document.querySelectorAll(".search-text-highlight").forEach(r=>{r.outerHTML=r.innerHTML});return}const s=N.filter(r=>!r.deleted).filter(r=>{var a,o;return r.message.toLowerCase().includes(t.toLowerCase())||((a=r.senderName)==null?void 0:a.toLowerCase().includes(t.toLowerCase()))||((o=r.senderEmail)==null?void 0:o.toLowerCase().includes(t.toLowerCase()))}).map(r=>({...r,matchIndex:r.message.toLowerCase().indexOf(t.toLowerCase())}));cs(s),s.length>0?(nt(0),setTimeout(()=>{ho(s[0]._id)},100)):nt(-1)},ka=t=>{const s=t.target.value;Ts(s),va(s)},Na=t=>{t.key==="Enter"?(t.preventDefault(),it.length>0&&nt(s=>s<it.length-1?s+1:0)):t.key==="Escape"&&(Rs(!1),Ts(""),cs([]),nt(-1),document.querySelectorAll(".search-text-highlight").forEach(s=>{s.outerHTML=s.innerHTML}))},ho=t=>{const s=Se.current[t];s&&(s.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),setTimeout(()=>{document.querySelectorAll(".search-highlight").forEach(a=>{a.classList.remove("search-highlight","search-pulse","search-glow")}),s.classList.add("search-highlight","search-pulse","search-glow");const r=document.createElement("div");r.className="search-ripple",s.style.position="relative",s.appendChild(r),setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},1e3),setTimeout(()=>{s.classList.remove("search-highlight","search-pulse","search-glow")},3e3)},300))},Ca=t=>{Go(t),us(!1);const r=new Date(t).toDateString(),a=N.find(o=>new Date(o.timestamp).toDateString()===r);if(a){const o=Se.current[a._id];o&&(o.classList.add("date-jump-preparing"),o.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),setTimeout(()=>{o.classList.remove("date-jump-preparing"),Yr(a._id),o.classList.add("date-highlight","date-jump-pulse");const n=document.createElement("div");n.className="date-jump-ripple",o.style.position="relative",o.appendChild(n),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},1e3),setTimeout(()=>{o.classList.remove("date-highlight","date-jump-pulse"),Yr(null)},4e3)},500))}else g.info("No messages found for the selected date",{position:"top-center",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0})},Sa=t=>{const s=new Date(t),r=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0"),o=String(s.getDate()).padStart(2,"0");return`${r}-${a}-${o}`},_a=t=>{switch(t){case"pending":return"bg-yellow-100 text-yellow-700";case"accepted":return"bg-green-100 text-green-700";case"rejected":return"bg-red-100 text-red-700";case"cancelledByBuyer":return"bg-red-100 text-red-700";case"cancelledBySeller":return"bg-red-100 text-red-700";case"cancelledByAdmin":return"bg-red-100 text-red-700";case"deletedByAdmin":return"bg-gray-100 text-gray-700";default:return"bg-gray-100 text-gray-700"}},$a=()=>{_t(!0),Ot("")},go=async()=>{try{$t(!0);const{data:t}=await T.get(`${L}/api/bookings/${i._id}`,{withCredentials:!0});if(t.comments){const s=t.comments.map(o=>{const n=N.find(l=>l._id===o._id);return n&&n.starredBy?{...o,starredBy:n.starredBy}:o}),r=N.filter(o=>o._id.startsWith("temp-")),a=new Set(t.comments.map(o=>o._id));r.forEach(o=>{a.has(o._id)||s.push(o)}),I(s),setTimeout(()=>{K.current&&te.current&&(K.current.scrollTop=K.current.scrollHeight,te.current.scrollIntoView({behavior:"instant",block:"end"}))},100)}}catch(t){console.error("Error loading initial comments:",t),g.error("Failed to load messages")}finally{$t(!1)}},Ia=async()=>{try{$t(!0);const{data:t}=await T.get(`${L}/api/bookings/${i._id}`,{withCredentials:!0});if(t.comments){const s=t.comments.map(o=>{const n=N.find(l=>l._id===o._id);return n&&n.starredBy?{...o,starredBy:n.starredBy}:o}),r=N.filter(o=>o._id.startsWith("temp-")),a=new Set(t.comments.map(o=>o._id));r.forEach(o=>{a.has(o._id)||s.push(o)}),I(s),g.success("Messages refreshed successfully!",{autoClose:2e3,position:"top-center"})}}catch(t){console.error("Error fetching latest comments:",t),g.error("Failed to refresh messages")}finally{$t(!1)}},La=async t=>{var s,r;t.preventDefault(),as(!0);try{const{data:a}=await T.post(`${L}/api/auth/verify-password`,{password:ss},{withCredentials:!0,headers:{"Content-Type":"application/json"}});a.success&&(_t(!1),Ct(!0),setTimeout(()=>{go()},100))}catch(a){g.error(((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to verify password. Please try again.")}as(!1)},xo=t=>{mt(t),ct(!0)},Da=async()=>{var t,s,r;if(ot){try{if(Array.isArray(ot)){const a=ot.map(n=>n._id),{data:o}=await T.delete(`${L}/api/bookings/${i._id}/comments/bulk-delete`,{withCredentials:!0,headers:{"Content-Type":"application/json"},data:{commentIds:a}});o!=null&&o.comments&&(I(n=>{const l=o.comments,d=new Set(l.map(_=>_._id)),y=n.filter(_=>_._id.startsWith("temp-")),S=[...l];return y.forEach(_=>{d.has(_._id)||S.push(_)}),S}),O(i._id,o.comments)),g.success(`Deleted ${a.length} messages for everyone!`)}else{const a=!((t=ot.readBy)!=null&&t.includes(m._id))&&ot.senderEmail!==m.email,{data:o}=await T.delete(`${L}/api/bookings/${i._id}/comment/${ot._id}`,{withCredentials:!0});I(n=>{const l=o.comments,d=new Set(l.map(_=>_._id)),y=n.filter(_=>_._id.startsWith("temp-")),S=[...l];return y.forEach(_=>{d.has(_._id)||S.push(_)}),S}),O(i._id,o.comments),a&&P(n=>Math.max(0,n-1)),g.success("Message deleted successfully!")}}catch(a){g.error(((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to delete message.")}ct(!1),mt(null)}};function Aa(t){try{return JSON.parse(localStorage.getItem(`hiddenDeletedMsgs_${t}`))||[]}catch{return[]}}const Ea=v.useCallback(t=>{M(s=>{if(!s.includes(t)){const r=[...s,t];return setTimeout(()=>{localStorage.setItem(`hiddenDeletedMsgs_${i._id}`,JSON.stringify(r))},0),r}return s})},[i._id]),Ma=v.useCallback(t=>{M(s=>{const r=s.filter(a=>a!==t);return setTimeout(()=>{localStorage.setItem(`hiddenDeletedMsgs_${i._id}`,JSON.stringify(r))},0),r})},[i._id]);return e.jsxs("tr",{className:`hover:bg-blue-50 transition align-top ${Qe?"bg-gray-50":""} ${mo?"":"bg-gray-100"}`,children:[e.jsx("td",{className:"border p-2",children:e.jsxs("div",{children:[e.jsx("div",{children:new Date(i.date).toLocaleDateString("en-GB")}),e.jsx("div",{className:"text-sm text-gray-600",children:i.time}),!mo&&e.jsx("div",{className:"text-xs text-red-600 font-medium mt-1",children:"Outdated"}),Qe&&i.archivedAt&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Archived: ",new Date(i.archivedAt).toLocaleDateString("en-GB")]})]})}),e.jsx("td",{className:"border p-2",children:e.jsx("div",{children:i.listingId?e.jsx(zo,{to:`/admin/listing/${i.listingId._id}`,className:"font-semibold text-blue-600 hover:text-blue-800 hover:underline cursor-pointer",children:i.propertyName}):e.jsx("div",{className:"font-semibold",children:i.propertyName})})}),e.jsx("td",{className:"border p-2 text-center",children:e.jsx(Ka,{appointmentId:i._id,appointment:i})}),e.jsx("td",{className:"border p-2",children:e.jsxs("button",{onClick:()=>{var t;return re((t=i.buyerId)==null?void 0:t._id)},className:"text-blue-600 hover:text-blue-800 hover:underline text-left",title:"Click to view buyer details",children:[e.jsx("div",{className:"font-semibold",children:((fo=i.buyerId)==null?void 0:fo.username)||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-600",children:((yo=i.buyerId)==null?void 0:yo.email)||i.email}),e.jsx("div",{className:"text-sm text-gray-600",children:((bo=i.buyerId)==null?void 0:bo.mobileNumber)||"No phone"})]})}),e.jsx("td",{className:"border p-2",children:e.jsxs("button",{onClick:()=>{var t;return re((t=i.sellerId)==null?void 0:t._id)},className:"text-blue-600 hover:text-blue-800 hover:underline text-left",title:"Click to view seller details",children:[e.jsx("div",{className:"font-semibold",children:((po=i.sellerId)==null?void 0:po.username)||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-600",children:(wo=i.sellerId)==null?void 0:wo.email}),e.jsx("div",{className:"text-sm text-gray-600",children:((jo=i.sellerId)==null?void 0:jo.mobileNumber)||"No phone"})]})}),e.jsx("td",{className:"border p-2 capitalize",children:i.purpose}),e.jsx("td",{className:"border p-2 max-w-xs truncate",children:i.message||"No message provided"}),e.jsxs("td",{className:"border p-2 text-center",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${_a(i.status)}`,children:i.status==="deletedByAdmin"?"Deleted by Admin":i.status==="cancelledByBuyer"?"Cancelled by Buyer":i.status==="cancelledBySeller"?"Cancelled by Seller":i.status==="cancelledByAdmin"?"Cancelled by Admin":i.status.charAt(0).toUpperCase()+i.status.slice(1)}),i.status==="deletedByAdmin"&&i.adminComment&&e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:['"',i.adminComment,'"']}),(i.status==="cancelledByBuyer"||i.status==="cancelledBySeller")&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:i.status==="cancelledByBuyer"?`Buyer reinitiations: ${i.buyerReinitiationCount||0}/2`:`Seller reinitiations: ${i.sellerReinitiationCount||0}/2`})]}),e.jsx("td",{className:"border p-2 text-center",children:e.jsx("div",{className:"flex flex-col gap-2",children:Qe?e.jsxs("button",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>Ke(i._id),title:"Unarchive Appointment",children:[e.jsx(Jt,{})," Unarchive"]}):e.jsxs(e.Fragment,{children:[i.status==="cancelledByAdmin"?e.jsxs("button",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>Ee(i._id),title:"Reinitiate Appointment (Admin)",children:[e.jsx(ks,{})," Reinitiate"]}):i.status!=="deletedByAdmin"?e.jsxs("button",{className:"bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>$(i._id),title:"Cancel Appointment (Admin)",children:[e.jsx(ks,{})," Cancel"]}):null,e.jsxs("button",{className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white px-4 py-2 rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-lg font-semibold flex items-center gap-2",onClick:()=>Zt(i._id),title:"Archive Appointment",children:[e.jsx(er,{})," Archive"]})]})})}),e.jsxs("td",{className:"border p-2 text-center relative",children:[e.jsxs("button",{className:"flex items-center justify-center bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-full p-3 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 mx-auto relative group",title:"Open Chat",onClick:$a,children:[e.jsx(Qs,{size:22,className:"group-hover:animate-pulse"}),e.jsx("div",{className:"absolute inset-0 bg-white rounded-full opacity-0 group-hover:opacity-20 transition-opacity duration-200"})]}),St&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-xs relative flex flex-col items-center",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors",onClick:()=>_t(!1),title:"Close",children:e.jsx(me,{className:"w-4 h-4"})}),e.jsxs("h3",{className:"text-lg font-bold mb-4 text-blue-700 flex items-center gap-2",children:[e.jsx(ks,{})," Admin Password Required"]}),e.jsxs("form",{onSubmit:La,className:"w-full flex flex-col gap-3",children:[e.jsx("input",{type:"password",className:"border rounded px-3 py-2 w-full focus:ring-2 focus:ring-blue-200",placeholder:"Enter your password",value:ss,onChange:t=>Ot(t.target.value),required:!0,autoFocus:!0}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full font-semibold",disabled:os,children:os?"Verifying...":"Unlock Chat"})]})]})}),R&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-md flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-white via-blue-50 to-purple-50 rounded-3xl shadow-2xl w-full h-full max-w-6xl max-h-full p-0 relative animate-fadeIn flex flex-col border border-gray-200 transform transition-all duration-500 hover:shadow-3xl",children:[e.jsx("div",{className:"flex items-center gap-2 sm:gap-3 px-4 sm:px-6 py-3 sm:py-4 border-b-2 border-blue-700 bg-gradient-to-r from-blue-700 via-purple-700 to-blue-900 rounded-t-3xl relative shadow-2xl sticky top-[env(safe-area-inset-top,0px)] z-30",children:cr?e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-white text-sm cursor-pointer hover:text-blue-200 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:Le.length===N.length&&N.length>0,onChange:()=>{Le.length===N.length?Ce([]):Ce([...N])},className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"}),e.jsx("span",{className:"font-medium",children:"Select All Messages"})]}),e.jsxs("span",{className:"text-white text-sm font-medium",children:["(",Le.length," message",Le.length!==1?"s":""," selected)"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[Le.length===1?e.jsx("div",{className:"flex items-center gap-2",children:(()=>{var s,r,a;const t=Le[0];return t.senderEmail,m.email,e.jsx(e.Fragment,{children:!t.deleted&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{lo(t),at(!1),Ce([])},title:"Reply","aria-label":"Reply",children:e.jsx("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c4.28 0 6.92 1.45 8.84 4.55.23.36.76.09.65-.32C18.31 13.13 15.36 10.36 10 9z"})})}),e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{ue(t.message),at(!1),Ce([])},title:"Copy message","aria-label":"Copy message",children:e.jsx(Gt,{size:18})}),e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:async()=>{var n;const o=(n=t.starredBy)==null?void 0:n.includes(m._id);Ms(l=>({...l,starring:!0}));try{const{data:l}=await T.patch(`${L}/api/bookings/${i._id}/comment/${t._id}/star`,{starred:!o},{withCredentials:!0,headers:{"Content-Type":"application/json"}});I(d=>{const y=d.map(S=>S._id===t._id?{...S,starredBy:o?(S.starredBy||[]).filter(_=>_!==m._id):[...S.starredBy||[],m._id]}:S);return O(i._id,y),y}),$e(o?d=>d.filter(y=>y._id!==t._id):d=>[...d,t]),g.success(o?"Message unstarred.":"Message starred.")}catch{g.error("Failed to update star status")}finally{Ms(l=>({...l,starring:!1}))}at(!1),Ce([])},title:(s=t.starredBy)!=null&&s.includes(m._id)?"Unstar message":"Star message","aria-label":(r=t.starredBy)!=null&&r.includes(m._id)?"Unstar message":"Star message",disabled:Es.starring,children:Es.starring?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):(a=t.starredBy)!=null&&a.includes(m._id)?e.jsx(bt,{size:18}):e.jsx(Xs,{size:18})}),e.jsx("button",{className:"text-white hover:text-red-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{mt(t),ct(!0),at(!1),Ce([])},title:"Delete","aria-label":"Delete",children:e.jsx(Ze,{size:18})})]})})})()}):Le.length>1?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:async()=>{var t,s,r;Ms(a=>({...a,starring:!0}));try{let a=0,o=0;const n=[];for(const l of Le)try{const d=(t=l.starredBy)==null?void 0:t.includes(m._id),y=await T.patch(`${L}/api/bookings/${i._id}/comment/${l._id}/star`,{starred:!d},{withCredentials:!0,headers:{"Content-Type":"application/json"}});a++,I(S=>{const _=S.map(Z=>Z._id===l._id?{...Z,starredBy:d?(Z.starredBy||[]).filter(se=>se!==m._id):[...Z.starredBy||[],m._id]}:Z);return O(i._id,_),_}),$e(S=>d?S.filter(_=>_._id!==l._id):S.some(_=>_._id===l._id)?S:[...S,{...l,starredBy:[...l.starredBy||[],m._id]}])}catch(d){console.error(`Failed to process message ${l._id}:`,d),o++,n.push(l)}a>0&&o===0?g.success(`Successfully updated star status for ${a} messages`):a>0&&o>0?g.warning(`Partially successful: ${a} messages updated, ${o} failed`):g.error("Failed to update any messages. Please try again."),o===0&&(at(!1),Ce([]))}catch(a){console.error("Error in bulk starring operation:",a),a.response&&(console.error("Response data:",a.response.data),console.error("Response status:",a.response.status)),g.error(((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to star messages. Please try again.")}finally{Ms(a=>({...a,starring:!1}))}},title:"Star all selected messages","aria-label":"Star all selected messages",disabled:Es.starring,children:Es.starring?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(bt,{size:18})}),e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{const t=Le.map(s=>s.message).join(`

`);ue(t),g.success("Copied all selected messages"),at(!1),Ce([])},title:"Copy all selected messages","aria-label":"Copy all selected messages",children:e.jsx(Gt,{size:18})}),e.jsx("button",{className:"text-white hover:text-red-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{mt(Le),ct(!0),at(!1),Ce([])},title:"Delete all selected messages","aria-label":"Delete all selected messages",children:e.jsx(Ze,{size:18})})]}):null,e.jsx("button",{className:"text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{at(!1),Ce([])},title:"Exit selection mode","aria-label":"Exit selection mode",children:e.jsx(me,{className:"w-4 h-4"})})]})]}):de&&u?e.jsxs("div",{className:"flex items-center justify-end w-full gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[u&&u.deleted?e.jsx(e.Fragment,{children:e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:async()=>{var s;const t=u&&((s=u.starredBy)==null?void 0:s.includes(m._id));As(!0);try{const{data:r}=await T.patch(`${L}/api/bookings/${i._id}/comment/${u&&u._id}/star`,{starred:!t},{withCredentials:!0,headers:{"Content-Type":"application/json"}});I(a=>{const o=a.map(n=>n._id===(u&&u._id)?{...n,starredBy:t?(n.starredBy||[]).filter(l=>l!==m._id):[...n.starredBy||[],m._id]}:n);return O(i._id,o),o}),$e(t?a=>a.filter(o=>o._id!==(u&&u._id)):a=>[...a,u]),g.success(t?"Message unstarred":"Message starred")}catch{g.error("Failed to update star status")}finally{As(!1)}B(null)},title:u&&((vo=u.starredBy)!=null&&vo.includes(m._id))?"Unstar message":"Star message","aria-label":u&&((ko=u.starredBy)!=null&&ko.includes(m._id))?"Unstar message":"Star message",disabled:Ds,children:Ds?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):u&&((No=u.starredBy)!=null&&No.includes(m._id))?e.jsx(bt,{size:18}):e.jsx(Xs,{size:18})})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{lo(u),B(null)},title:"Reply","aria-label":"Reply",children:e.jsx("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c4.28 0 6.92 1.45 8.84 4.55.23.36.76.09.65-.32C18.31 13.13 15.36 10.36 10 9z"})})}),e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{ue(u&&u.message),B(null)},title:"Copy message","aria-label":"Copy message",children:e.jsx(Gt,{size:18})}),e.jsx("button",{className:"text-white hover:text-yellow-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:async()=>{var s;const t=u&&((s=u.starredBy)==null?void 0:s.includes(m._id));As(!0);try{const{data:r}=await T.patch(`${L}/api/bookings/${i._id}/comment/${u&&u._id}/star`,{starred:!t},{withCredentials:!0,headers:{"Content-Type":"application/json"}});I(a=>{const o=a.map(n=>n._id===(u&&u._id)?{...n,starredBy:t?(n.starredBy||[]).filter(l=>l!==m._id):[...n.starredBy||[],m._id]}:n);return O(i._id,o),o}),$e(t?a=>a.filter(o=>o._id!==(u&&u._id)):a=>[...a,u]),g.success(t?"Message unstarred":"Message starred")}catch{g.error("Failed to update star status")}finally{As(!1)}B(null)},title:u&&((Co=u.starredBy)!=null&&Co.includes(m._id))?"Unstar message":"Star message","aria-label":u&&((So=u.starredBy)!=null&&So.includes(m._id))?"Unstar message":"Star message",disabled:Ds,children:Ds?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):u&&((_o=u.starredBy)!=null&&_o.includes(m._id))?e.jsx(bt,{size:18}):e.jsx(Xs,{size:18})})]}),u&&!u.deleted&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors",onClick:()=>{X(t=>!t),Ne||(le(!1),Y(null))},title:"More options","aria-label":"More options",children:e.jsx(Dr,{size:14})}),Ne&&e.jsx("div",{className:"absolute top-full right-0 mt-2 bg-white rounded-lg shadow-lg border border-gray-200 z-20 min-w-[180px] chat-options-menu",children:u&&u.senderEmail===m.email?e.jsxs(e.Fragment,{children:[u&&u.imageUrl&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2",onClick:()=>{ao(u&&u.imageUrl,u&&u._id),X(!1),B(null)},children:[e.jsx(pt,{className:"text-sm"}),"Download Image"]}),u&&u.videoUrl&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2",onClick:async()=>{try{const t=await fetch(u&&u.videoUrl,{mode:"cors"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const s=await t.blob(),r=window.URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`video-${u&&u._id||Date.now()}.mp4`,document.body.appendChild(a),a.click(),a.remove(),setTimeout(()=>window.URL.revokeObjectURL(r),200),g.success("Video downloaded successfully")}catch(t){console.error("Video download failed:",t);const s=document.createElement("a");s.href=u&&u.videoUrl,s.download=`video-${u&&u._id||Date.now()}.mp4`,s.target="_blank",document.body.appendChild(s),s.click(),s.remove(),g.success("Video download started")}X(!1),B(null)},children:[e.jsx(pt,{className:"text-sm"}),"Download Video"]}),u&&u.audioUrl&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2",onClick:async()=>{try{const t=await fetch(u&&u.audioUrl,{mode:"cors"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const s=await t.blob(),r=window.URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=u.audioName||`audio-${u&&u._id||Date.now()}`,document.body.appendChild(a),a.click(),a.remove(),setTimeout(()=>window.URL.revokeObjectURL(r),200),g.success("Audio downloaded successfully")}catch{const s=document.createElement("a");s.href=u&&u.audioUrl,s.download=u.audioName||`audio-${u&&u._id||Date.now()}`,s.target="_blank",document.body.appendChild(s),s.click(),s.remove(),g.success("Audio download started")}X(!1),B(null)},children:[e.jsx(pt,{className:"text-sm"}),"Download Audio"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{co(u),X(!1),B(null)},children:[e.jsx(Ar,{className:"text-sm"}),"Info"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{ja(u),X(!1),B(null)},disabled:H!==null,children:[e.jsx(Er,{className:"text-sm"}),"Edit"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",onClick:()=>{xo(u),X(!1),B(null)},children:[e.jsx(Ze,{className:"text-sm"}),"Delete"]})]}):e.jsxs(e.Fragment,{children:[u&&u.imageUrl&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2",onClick:()=>{ao(u&&u.imageUrl,u&&u._id),X(!1),B(null)},children:[e.jsx(pt,{className:"text-sm"}),"Download Image"]}),u&&u.videoUrl&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2",onClick:async()=>{try{const t=await fetch(u&&u.videoUrl,{mode:"cors"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const s=await t.blob(),r=window.URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`video-${u&&u._id||Date.now()}.mp4`,document.body.appendChild(a),a.click(),a.remove(),setTimeout(()=>window.URL.revokeObjectURL(r),200),g.success("Video downloaded successfully")}catch(t){console.error("Video download failed:",t);const s=document.createElement("a");s.href=u&&u.videoUrl,s.download=`video-${u&&u._id||Date.now()}.mp4`,s.target="_blank",document.body.appendChild(s),s.click(),s.remove(),g.success("Video download started")}X(!1),B(null)},children:[e.jsx(pt,{className:"text-sm"}),"Download Video"]}),u&&u.audioUrl&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2",onClick:async()=>{try{const t=await fetch(u&&u.audioUrl,{mode:"cors"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const s=await t.blob(),r=window.URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=u.audioName||`audio-${u&&u._id||Date.now()}`,document.body.appendChild(a),a.click(),a.remove(),setTimeout(()=>window.URL.revokeObjectURL(r),200),g.success("Audio downloaded successfully")}catch{const s=document.createElement("a");s.href=u&&u.audioUrl,s.download=u.audioName||`audio-${u&&u._id||Date.now()}`,s.target="_blank",document.body.appendChild(s),s.click(),s.remove(),g.success("Audio download started")}X(!1),B(null)},children:[e.jsx(pt,{className:"text-sm"}),"Download Audio"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{co(u),X(!1),B(null)},children:[e.jsx(Ar,{className:"text-sm"}),"Info"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",onClick:()=>{xo(u),X(!1),B(null)},children:[e.jsx(Ze,{className:"text-sm"}),"Delete"]})]})})]})]}),e.jsx("button",{className:"text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>{B(null),X(!1)},title:"Close options","aria-label":"Close options",children:e.jsx(me,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white rounded-full p-1.5 shadow-lg",children:e.jsx(Qs,{className:"text-blue-600 text-lg"})}),e.jsx("h3",{className:"text-lg font-bold text-white",children:"Live Chat"}),e.jsxs("div",{className:"flex items-center gap-3 ml-auto",children:[e.jsx("div",{className:"relative search-container",children:e.jsx("button",{className:"text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-all duration-300 transform hover:scale-110 shadow",onClick:()=>{Rs(!0),le(!1),Y(null)},title:"Search messages","aria-label":"Search messages",children:e.jsx(Tr,{className:"text-sm"})})}),e.jsxs("div",{className:"relative flex items-center gap-2",children:[Ss&&e.jsx("div",{className:"text-white bg-white/10 rounded-full p-2 shadow",children:e.jsx(Oo,{className:"text-sm animate-spin"})}),e.jsx("button",{className:"text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-colors shadow",onClick:()=>{Ie(!qt),qt||(le(!1),Y(null))},title:"Chat options","aria-label":"Chat options",children:e.jsx(Dr,{className:"text-sm"})}),qt&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 bg-white rounded-lg shadow-lg border border-gray-200 z-20 min-w-[180px] chat-options-menu",children:[e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{Ia(),Ie(!1)},children:[e.jsx(To,{className:"text-sm"}),"Refresh Messages"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-yellow-600 hover:bg-yellow-50 flex items-center gap-2",onClick:()=>{Ls(!0),Ie(!1),le(!1),Y(null)},children:[e.jsx(bt,{className:"text-sm"}),"Starred Messages"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2",onClick:()=>{at(!0),Ce([]),Ie(!1),le(!1),Y(null)},children:[e.jsx(Oa,{className:"text-sm"}),"Select Messages"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-purple-600 hover:bg-purple-50 flex items-center gap-2",onClick:()=>{dr(!Gr),Ie(!1),le(!1),Y(null)},children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5 4v3h5.5v12h3V7H19V4H5z"})}),"Text Styling"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{W(!C),Ie(!1),le(!1),Y(null)},children:[e.jsx(qa,{className:"text-sm"}),"Tips & Guidelines"]}),N.length>0&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-green-600 hover:bg-green-50 flex items-center gap-2",onClick:()=>{Ie(!1),vt(i,N)},children:[e.jsx(pt,{className:"text-sm"}),"Export Chat Transcript (PDF)"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{var t;re((t=i.buyerId)==null?void 0:t._id),Ie(!1)},children:[e.jsx(Pr,{className:"text-sm"}),"View Buyer Details"]}),e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:()=>{var t;re((t=i.sellerId)==null?void 0:t._id),Ie(!1)},children:[e.jsx(Pr,{className:"text-sm"}),"View Seller Details"]}),e.jsx("div",{className:"border-t border-gray-200 my-1"}),N.length>0&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2",onClick:()=>{ns(!0),Ie(!1),le(!1),Y(null)},children:[e.jsx(Ze,{className:"text-sm"}),"Delete Entire Chat"]})]})]}),C&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 bg-gray-800 text-white text-xs rounded-lg px-3 py-2 shadow-lg z-20 max-w-xs animate-fadeIn",children:[e.jsx("div",{className:"font-semibold mb-2",children:"âŒ¨ï¸ Keyboard Shortcuts:"}),e.jsx("div",{className:"mb-2",children:"â€¢ Press Ctrl + F to quickly focus and type your message"}),e.jsx("div",{className:"mb-2",children:"â€¢ Press Esc to close chatbox."}),e.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[e.jsx("div",{className:"font-semibold mb-2",children:"ðŸ“Ž File Upload Guidelines:"}),e.jsx("div",{children:"â€¢ Photos: JPG, PNG, GIF, WebP (â‰¤ 5MB)"}),e.jsx("div",{children:"â€¢ Videos: MP4, WebM, MOV, MKV, OGG (â‰¤ 5MB)"}),e.jsx("div",{children:"â€¢ Documents: PDF, DOCX, XLSX, TXT and more (â‰¤ 5MB)"}),e.jsx("div",{children:"â€¢ Audio: MP3, WAV, M4A, OGG (â‰¤ 5MB)"}),e.jsx("div",{children:"â€¢ Camera: Direct photo capture from device"}),e.jsx("div",{children:"â€¢ Add captions to all media types"})]}),e.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[e.jsx("div",{className:"font-semibold mb-2",children:"ðŸ’¬ Chat Features:"}),e.jsx("div",{children:"â€¢ Real-time messaging with socket.io"}),e.jsx("div",{children:"â€¢ Message reactions and emoji support"}),e.jsx("div",{children:"â€¢ File sharing and media previews"}),e.jsx("div",{children:"â€¢ Audio recording with pause/resume"}),e.jsx("div",{children:"â€¢ Audio playback with speed controls"}),e.jsx("div",{children:"â€¢ Message editing and deletion"}),e.jsx("div",{children:"â€¢ Message starring and search"}),e.jsx("div",{children:"â€¢ Chat export to PDF"}),e.jsx("div",{children:"â€¢ Chat locking for dispute resolution"})]}),e.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[e.jsx("div",{className:"font-semibold mb-2",children:"ðŸ”’ Security & Moderation:"}),e.jsx("div",{children:"â€¢ Report inappropriate content"}),e.jsx("div",{children:"â€¢ Report chat"}),e.jsx("div",{children:"â€¢ Content filtering and moderation"}),e.jsx("div",{children:"â€¢ User blocking capabilities"})]}),e.jsxs("div",{className:"border-t border-gray-600 pt-2 mt-2",children:[e.jsx("div",{className:"font-semibold mb-2",children:"ðŸ‘¨â€ðŸ’¼ Admin Controls:"}),e.jsx("div",{children:"â€¢ Full chat moderation access"}),e.jsx("div",{children:"â€¢ User management and blocking"}),e.jsx("div",{children:"â€¢ Content removal and warnings"}),e.jsx("div",{children:"â€¢ Dispute resolution tools"})]}),e.jsx("div",{className:"absolute -top-1 right-4 w-2 h-2 bg-gray-800 transform rotate-45"})]}),j>0&&!h&&e.jsx("button",{className:"text-blue-500 hover:text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-full p-2 transition-colors shadow animate-bounce",onClick:ro,title:"Scroll to latest messages","aria-label":"Scroll to latest messages",children:e.jsx(Qs,{className:"text-sm"})}),e.jsx("button",{className:"text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors z-10 shadow",onClick:()=>{Ct(!1),le(!1),Y(null)},title:"Close","aria-label":"Close",children:e.jsx(me,{className:"w-4 h-4"})})]})]})}),mr&&e.jsx("div",{className:"enhanced-search-header bg-gradient-to-r from-blue-600 via-purple-600 to-blue-800 px-3 sm:px-4 py-3 border-b-2 border-blue-700 flex-shrink-0 animate-slideDown",children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-nowrap",children:[e.jsxs("div",{className:"relative calendar-container",children:[e.jsx("button",{className:"text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-all duration-300 transform hover:scale-110 shadow",onClick:t=>{t.stopPropagation(),us(!Ps)},title:"Jump to date","aria-label":"Jump to date",children:e.jsx(Ha,{className:"text-sm"})}),Ps&&e.jsxs("div",{className:"absolute top-full left-0 mt-2 bg-white rounded-lg shadow-xl border border-gray-200 p-3 min-w-[250px] animate-fadeIn",style:{zIndex:9999},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Jump to Date"}),e.jsx("button",{onClick:t=>{t.stopPropagation(),us(!1)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(me,{size:14})})]}),e.jsx("input",{type:"date",value:Wo,onChange:t=>{t.stopPropagation(),Ca(t.target.value)},className:"w-full p-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all",max:Sa(new Date)}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"Select a date to jump to the first message from that day"})]})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-2 bg-white/20 rounded-full px-3 sm:px-4 py-2 backdrop-blur-sm min-w-0 overflow-hidden",children:[e.jsx(Tr,{className:"text-white/70 text-sm"}),e.jsx("input",{type:"text",placeholder:"Search messages...",value:ur,onChange:ka,onKeyDown:Na,className:"bg-transparent text-white placeholder-white/70 text-sm outline-none flex-1 min-w-0 w-full",autoFocus:!0}),it.length>0&&e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[e.jsxs("span",{className:"text-white/80 text-xs bg-white/10 px-2 py-1 rounded-full",children:[ms+1,"/",it.length]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>nt(t=>t>0?t-1:it.length-1),className:"text-white/80 hover:text-white p-1 rounded transition-colors text-xs",title:"Previous result",children:"â†‘"}),e.jsx("button",{onClick:()=>nt(t=>t<it.length-1?t+1:0),className:"text-white/80 hover:text-white p-1 rounded transition-colors text-xs",title:"Next result",children:"â†“"})]})]})]}),e.jsx("button",{onClick:()=>{Rs(!1),Ts(""),cs([]),nt(-1),us(!1),document.querySelectorAll(".search-text-highlight").forEach(t=>{t.outerHTML=t.innerHTML})},className:"flex-shrink-0 text-white hover:text-gray-200 bg-white/10 hover:bg-white/20 rounded-full p-2 transition-all duration-300 transform hover:scale-110 shadow",title:"Close search","aria-label":"Close search",children:e.jsx(me,{className:"text-sm"})})]})}),e.jsxs("div",{ref:K,className:`flex-1 overflow-y-auto space-y-2 px-4 pt-4 animate-fadeInChat relative bg-gradient-to-b from-transparent to-blue-50/30 ${Bt?"bg-blue-50/50 border-2 border-dashed border-blue-300":""}`,style:{minHeight:"400px",maxHeight:"calc(100vh - 200px)"},onDragOver:t=>{t.preventDefault(),t.stopPropagation(),tt(!0)},onDragEnter:t=>{t.preventDefault(),t.stopPropagation(),tt(!0)},onDragLeave:t=>{t.preventDefault(),t.stopPropagation(),t.currentTarget.contains(t.relatedTarget)||tt(!1)},onDrop:t=>{t.preventDefault(),t.stopPropagation(),tt(!1);const s=Array.from(t.dataTransfer.files),r=s.filter(a=>a.type.startsWith("image/"));r.length>0?io(r):s.length>0&&g.error("Only image files are supported")},children:[e.jsx("div",{className:"px-4 py-3 bg-gradient-to-r from-blue-50 to-purple-50 border-l-4 border-blue-400 rounded-r-lg mb-4 backdrop-blur-sm",children:e.jsxs("p",{className:"text-sm text-blue-700 font-medium text-center flex items-center justify-center gap-2",children:[e.jsx("span",{className:"animate-gentlePulse",children:"ðŸ”’"}),"Chats are encrypted and secure. View only for valid purposes like disputes or fraud checks. Unauthorized access or sharing is prohibited and will be logged."]})}),Fe&&N.length>0&&e.jsx("div",{className:`sticky top-0 left-0 right-0 z-30 pointer-events-none transition-all duration-300 ease-in-out ${k?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:e.jsx("div",{className:"w-full flex justify-center py-2",children:e.jsx("div",{className:"bg-blue-600 text-white text-xs px-4 py-2 rounded-full shadow-lg border-2 border-white",children:Fe})})}),N.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-8",children:[e.jsx(Qs,{className:"text-gray-300 text-4xl mb-3"}),e.jsx("p",{className:"text-gray-500 font-medium text-sm",children:"No messages in this conversation"}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Monitor and manage communication between parties"})]}):N.slice(Math.max(0,N.length-pe)).filter(t=>t!=null).map((t,s,r)=>{var S,_,Z,se,ye,V,G,ee,Eo,Mo,Ro;const a=N.length-r.length+s,o=t&&t.senderEmail===m.email,n=H===(t&&t._id),l=t&&t.timestamp?new Date(t.timestamp):new Date,d=a>0&&N[a-1]&&N[a-1].timestamp?new Date(N[a-1].timestamp):null,y=d?l.toDateString()!==d.toDateString():!0;return e.jsxs(v.Fragment,{children:[y&&e.jsx("div",{className:"w-full flex justify-center my-2",children:e.jsx("span",{className:"bg-blue-600 text-white text-xs px-4 py-2 rounded-full shadow-lg border-2 border-white",children:Rr(l)})}),j>0&&a===N.length-j&&e.jsxs("div",{className:"w-full flex items-center my-2",children:[e.jsx("div",{className:"flex-1 h-px bg-gray-300"}),e.jsx("span",{className:"mx-2 text-xs font-semibold text-red-600 bg-red-50 px-2 py-1 rounded-full border border-red-200",children:"New messages"}),e.jsx("div",{className:"flex-1 h-px bg-gray-300"})]}),e.jsxs("div",{className:`flex w-full ${o?"justify-end":"justify-start"} animate-fadeInChatBubble`,style:{animationDelay:`${.03*a}s`},children:[cr&&e.jsx("div",{className:`flex items-start ${o?"order-2 ml-2":"order-1 mr-2"}`,children:e.jsx("input",{type:"checkbox",checked:Le.some(x=>x._id===t._id),onChange:x=>{x.target.checked?Ce(f=>[...f,t]):Ce(f=>f.filter(b=>b._id!==t._id))},className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"})}),e.jsxs("div",{ref:x=>Se.current[t&&t._id?t._id:"unknown"]=x,"data-message-id":t&&t._id?t._id:"unknown",className:`relative rounded-2xl px-4 sm:px-5 py-3 text-sm shadow-xl max-w-[90%] sm:max-w-[80%] md:max-w-[70%] lg:max-w-[60%] xl:max-w-[50%] break-words overflow-visible transition-all duration-300 min-h-[60px] ${t&&t.audioUrl?"min-w-[280px] sm:min-w-[320px]":""} ${o?"bg-gradient-to-r from-blue-600 to-purple-700 hover:from-blue-500 hover:to-purple-600 text-white shadow-blue-200 hover:shadow-blue-300 hover:shadow-2xl":"bg-white hover:bg-gray-100 text-gray-800 border border-gray-200 shadow-gray-200 hover:shadow-lg hover:border-gray-300 hover:shadow-xl"} ${cr&&Le.some(x=>x._id===(t&&t._id))?"ring-2 ring-blue-400":""}`,children:[t&&t.replyTo&&e.jsx("div",{className:"border-l-4 border-purple-400 pl-3 mb-2 text-xs bg-gradient-to-r from-purple-50 to-blue-50 hover:from-purple-100 hover:to-blue-100 rounded-lg w-full max-w-full break-words cursor-pointer transition-all duration-200 hover:shadow-sm",onClick:()=>{t&&t.replyTo&&Se.current[t.replyTo]&&(Se.current[t.replyTo].scrollIntoView({behavior:"smooth",block:"center"}),Se.current[t.replyTo].classList.add("reply-highlight"),setTimeout(()=>{var x;(x=Se.current[t.replyTo])==null||x.classList.remove("reply-highlight")},1600))},role:"button",tabIndex:0,"aria-label":"Go to replied message",children:e.jsxs("span",{className:"text-xs text-gray-700 font-medium truncate max-w-[150px] flex items-center gap-1",children:[e.jsx("span",{className:"text-purple-500",children:"â†©"}),((_=(S=N.find(x=>x._id===(t&&t.replyTo)))==null?void 0:S.message)==null?void 0:_.substring(0,30))||"Original message",((se=(Z=N.find(x=>x._id===(t&&t.replyTo)))==null?void 0:Z.message)==null?void 0:se.length)>30?"...":""]})}),e.jsx("div",{className:"font-semibold mb-2 flex items-center gap-2 justify-start text-left",children:e.jsx("span",{className:`truncate max-w-[120px] min-w-[60px] inline-block align-middle overflow-hidden text-ellipsis text-left ${o?"text-blue-100":"text-gray-700"}`,children:o?"You":(()=>{var b,D,E,ce;const x=t&&t.senderEmail===((b=i.buyerId)==null?void 0:b.email),f=t&&t.senderEmail===((D=i.sellerId)==null?void 0:D.email);return x?((E=i.buyerId)==null?void 0:E.username)||t&&t.senderName||t&&t.senderEmail:f?((ce=i.sellerId)==null?void 0:ce.username)||t&&t.senderName||t&&t.senderEmail:t&&t.senderName||t&&t.senderEmail})()})}),e.jsx("div",{className:`text-left ${o?"text-base font-medium":"text-sm"}`,children:t&&t.deleted?(()=>{const x=t&&fe.includes(t._id);return m&&(m.role==="admin"||m.role==="rootadmin")?x?e.jsx("div",{className:"border border-gray-300 bg-gray-100 rounded p-2 mb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 text-xs",children:[e.jsx(Yt,{className:"inline-block"}),e.jsx("span",{children:"Deleted message hidden from view"})]}),e.jsx("button",{className:"text-xs text-blue-500 hover:text-blue-700 underline",onClick:()=>Ma(t._id),title:"Show this deleted message content",children:"Show"})]})}):e.jsxs("div",{className:"border border-red-300 bg-red-50 rounded p-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-xs font-semibold mb-1",children:[e.jsx(Yt,{className:"inline-block"}),"Message deleted by ",t&&t.deletedBy||"user"," (Admin view - preserved for records)"]}),t&&(t.originalImageUrl||t.imageUrl)&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:t&&t.originalImageUrl||t&&t.imageUrl,alt:"Preserved image from deleted message",className:"max-w-full max-h-64 rounded-lg cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>{const f=(N||[]).filter(E=>!!(E.originalImageUrl||E.imageUrl)).map(E=>E.originalImageUrl||E.imageUrl),b=t&&t.originalImageUrl||t&&t.imageUrl,D=Math.max(0,f.indexOf(b));Fs(f),De(D),hs(!0)},onError:f=>{f.target.src="https://via.placeholder.com/300x200?text=Image+Not+Found",f.target.className="max-w-full max-h-64 rounded-lg opacity-50"}})}),t&&t.videoUrl&&e.jsxs("div",{className:"mb-2",children:[e.jsx("video",{src:t.videoUrl,className:"max-w-full max-h-64 rounded-lg border cursor-pointer hover:opacity-90 transition-opacity",controls:!0,onClick:f=>{f.preventDefault(),f.stopPropagation(),f.target.requestFullscreen?f.target.requestFullscreen():f.target.webkitRequestFullscreen&&f.target.webkitRequestFullscreen()}}),e.jsx("div",{className:"mt-1 text-xs text-gray-600 italic",children:"Preserved video from deleted message"})]}),t&&t.audioUrl&&e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"bg-gray-100 border border-gray-300 rounded-lg p-3",children:[e.jsx("audio",{src:t.audioUrl,className:"w-full",controls:!0,preload:"metadata"}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600 italic",children:["Preserved audio from deleted message: ",t.audioName||"Audio file"]})]})}),t&&t.documentUrl&&e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"bg-gray-100 border border-gray-300 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“„"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:t.documentName||"Document"}),e.jsx("div",{className:"text-xs text-gray-600 italic",children:"Preserved document from deleted message"})]}),e.jsx("button",{className:"px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",onClick:async f=>{f.stopPropagation();try{const b=await fetch(t.documentUrl,{mode:"cors"});if(!b.ok)throw new Error(`HTTP ${b.status}`);const D=await b.blob(),E=window.URL.createObjectURL(D),ce=document.createElement("a");ce.href=E,ce.download=t.documentName||`document-${t._id||Date.now()}`,document.body.appendChild(ce),ce.click(),ce.remove(),setTimeout(()=>window.URL.revokeObjectURL(E),200),g.success("Document downloaded successfully")}catch{const D=document.createElement("a");D.href=t.documentUrl,D.download=t.documentName||`document-${t._id||Date.now()}`,D.target="_blank",document.body.appendChild(D),D.click(),D.remove(),g.success("Document download started")}},children:"Download"})]})})}),u&&u.audioUrl&&e.jsxs("button",{className:"w-full px-4 py-2 text-left text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2",onClick:async()=>{try{const f=await fetch(u&&u.audioUrl,{mode:"cors"});if(!f.ok)throw new Error(`HTTP ${f.status}`);const b=await f.blob(),D=window.URL.createObjectURL(b),E=document.createElement("a");E.href=D,E.download=u.audioName||`audio-${u&&u._id||Date.now()}`,document.body.appendChild(E),E.click(),E.remove(),setTimeout(()=>window.URL.revokeObjectURL(D),200),g.success("Audio downloaded successfully")}catch{const b=document.createElement("a");b.href=u&&u.audioUrl,b.download=u.audioName||`audio-${u&&u._id||Date.now()}`,b.target="_blank",document.body.appendChild(b),b.click(),b.remove(),g.success("Audio download started")}X(!1),B(null)},children:[e.jsx(pt,{className:"text-sm"}),"Download Audio"]}),e.jsx("div",{className:"text-gray-800 bg-white p-2 rounded border-l-4 border-red-400 relative group",children:(()=>{const f=t&&t.originalMessage||t&&t.message;return f?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"whitespace-pre-wrap break-words",children:f}),e.jsx("button",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200 text-gray-500 hover:text-gray-700 bg-white rounded p-1 shadow-sm",onClick:()=>ue(f),title:"Copy deleted message content","aria-label":"Copy deleted message content",children:e.jsx(Gt,{className:"text-xs"})})]}):e.jsx("span",{className:"text-gray-500 italic",children:"[Message content not preserved - this message was deleted before content preservation was implemented]"})})()}),e.jsx("button",{className:"mt-2 text-xs text-red-500 hover:text-red-700 underline",onClick:()=>Ea(t._id),title:"Hide this deleted message from your admin view",children:"Hide from admin view"})]}):e.jsxs("span",{className:"flex items-center gap-1 text-gray-400 italic",children:[e.jsx(Yt,{className:"inline-block text-lg"})," This message has been deleted."]})})():e.jsx("div",{children:n?e.jsx("div",{className:"bg-yellow-100 border-l-4 border-yellow-400 px-2 py-1 rounded",children:e.jsx("span",{className:"text-yellow-800 text-xs font-medium",children:"âœï¸ Editing this message below..."})}):e.jsxs(e.Fragment,{children:[t&&(t.originalImageUrl||t.imageUrl)&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:t&&t.originalImageUrl||t&&t.imageUrl,alt:"Shared image",className:"max-w-full max-h-64 rounded-lg cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>{const x=(N||[]).filter(D=>!!(D.originalImageUrl||D.imageUrl)).map(D=>D.originalImageUrl||D.imageUrl),f=t&&t.originalImageUrl||t&&t.imageUrl,b=Math.max(0,x.indexOf(f));Fs(x),De(b),hs(!0)},onError:x=>{x.target.src="https://via.placeholder.com/300x200?text=Image+Not+Found",x.target.className="max-w-full max-h-64 rounded-lg opacity-50"}})}),t&&t.videoUrl&&e.jsxs("div",{className:"mb-2",children:[e.jsx("video",{src:t&&t.videoUrl?t.videoUrl:"",className:"max-w-full max-h-64 rounded-lg border cursor-pointer hover:opacity-90 transition-opacity",controls:!0,onClick:x=>{x.preventDefault(),x.stopPropagation(),x.target.requestFullscreen?x.target.requestFullscreen():x.target.webkitRequestFullscreen?x.target.webkitRequestFullscreen():x.target.msRequestFullscreen&&x.target.msRequestFullscreen()}}),e.jsx("div",{className:`mt-1 text-xs ${o?"text-blue-100":"text-gray-500"}`,children:e.jsx("button",{className:`${o?"text-white hover:text-blue-100":"text-blue-600 hover:underline"}`,onClick:x=>{x.stopPropagation();const f=document.createElement("a");f.href=t&&t.videoUrl?t.videoUrl:"",f.download=`video-${t._id||Date.now()}`,f.target="_blank",document.body.appendChild(f),f.click(),f.remove(),g.success("Video download started")},children:"Download"})})]}),t&&t.audioUrl&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-full min-w-[280px] sm:min-w-[320px]",children:e.jsx("audio",{src:t&&t.audioUrl?t.audioUrl:"",className:"w-full",controls:!0,preload:"metadata",onClick:x=>x.stopPropagation(),ref:x=>{if(x&&!x.dataset.audioId){x.dataset.audioId=t._id,x.addEventListener("play",()=>{document.querySelectorAll("audio[data-audio-id]").forEach(b=>{b!==x&&!b.paused&&b.pause()})}),x.addEventListener("ratechange",()=>{const b=x.playbackRate,D=document.querySelector(`[data-audio-id="${t._id}"].playback-rate-display`);D&&(D.textContent=`${b}x`);const E=document.querySelector(`[data-audio-speed-menu="${t._id}"]`);E&&E.querySelectorAll("[data-speed-option]").forEach(Je=>{Je.classList.remove("bg-blue-100","text-blue-700"),Je.classList.add("text-gray-700","hover:bg-gray-100"),parseFloat(Je.dataset.speedOption)===b&&(Je.classList.remove("text-gray-700","hover:bg-gray-100"),Je.classList.add("bg-blue-100","text-blue-700"))})});const f=document.querySelector(`[data-audio-id="${t._id}"].playback-rate-display`);f&&(f.textContent=`${x.playbackRate}x`)}}})}),e.jsxs("div",{className:"mt-2 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:`px-3 py-1.5 text-xs rounded-full shadow-sm border transition-colors ${o?"bg-white text-blue-600 hover:bg-blue-50 border-blue-200":"bg-blue-600 text-white hover:bg-blue-700 border-transparent"}`,onClick:async x=>{x.stopPropagation();try{const f=await fetch(t&&t.audioUrl?t.audioUrl:"",{mode:"cors"});if(!f.ok)throw new Error(`HTTP ${f.status}`);const b=await f.blob(),D=window.URL.createObjectURL(b),E=document.createElement("a");E.href=D,E.download=t&&t.audioName||`audio-${t&&t._id||Date.now()}`,document.body.appendChild(E),E.click(),E.remove(),setTimeout(()=>window.URL.revokeObjectURL(D),200),g.success("Audio downloaded successfully")}catch{const b=document.createElement("a");b.href=t&&t.audioUrl?t.audioUrl:"",b.download=t&&t.audioName||`audio-${t&&t._id||Date.now()}`,b.target="_blank",document.body.appendChild(b),b.click(),b.remove(),g.success("Audio download started")}},title:"Download audio",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5 5m0 0l5-5m-5 5V4"})}),"Download"]})}),e.jsx("span",{className:`text-xs playback-rate-display ${o?"text-blue-100":"text-gray-500"}`,"data-audio-id":t._id,children:"1x"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:`p-2 rounded-full hover:bg-gray-100 transition-colors ${o?"text-white hover:bg-blue-500":"text-gray-600 hover:bg-gray-200"}`,onClick:x=>{x.stopPropagation();const f=document.querySelector(`[data-audio-menu="${t._id}"]`);f&&(f.classList.toggle("hidden"),f.classList.contains("hidden")||document.querySelectorAll("[data-audio-menu]").forEach(b=>{b!==f&&b.classList.add("hidden")}))},title:"Audio options",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})})}),e.jsx("div",{"data-audio-menu":t._id,className:"hidden absolute right-0 bottom-full mb-1 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-[9999]",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:x=>{x.stopPropagation();const f=document.querySelector(`[data-audio-menu="${t._id}"]`),b=document.querySelector(`[data-audio-speed-menu="${t._id}"]`);f&&b&&(f.classList.add("hidden"),b.classList.remove("hidden"))},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Playback Speed",e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),e.jsxs("button",{className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:x=>{x.stopPropagation();const f=document.querySelector(`[data-audio-menu="${t._id}"]`),b=document.querySelector(`[data-audio-controls-menu="${t._id}"]`);f&&b&&(f.classList.add("hidden"),b.classList.remove("hidden"))},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h1m4 0h1m-6-8h8a2 2 0 012 2v8a2 2 0 01-2 2H8a2 2 0 01-2-2V6a2 2 0 012-2z"})}),"Audio Controls",e.jsx("svg",{className:"w-4 h-4 ml-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})}),e.jsx("div",{"data-audio-speed-menu":t._id,className:"hidden absolute right-0 bottom-full mb-1 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-[9999]",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("div",{className:"px-3 py-2 text-xs font-medium text-gray-500 uppercase tracking-wide flex items-center gap-2",children:[e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:x=>{x.stopPropagation();const f=document.querySelector(`[data-audio-menu="${t._id}"]`),b=document.querySelector(`[data-audio-speed-menu="${t._id}"]`);f&&b&&(b.classList.add("hidden"),f.classList.remove("hidden"))},children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),"Playback Speed"]}),[.5,.75,1,1.25,1.5,2].map(x=>e.jsxs("button",{"data-speed-option":x,className:`w-full px-3 py-2 text-left text-sm flex items-center justify-between transition-colors ${x===1?"bg-blue-100 text-blue-700":"text-gray-700 hover:bg-gray-100"}`,onClick:f=>{f.stopPropagation();const b=document.querySelector(`[data-audio-id="${t._id}"]`);if(b){b.playbackRate=x;const ce=document.querySelector(`[data-audio-id="${t._id}"].playback-rate-display`);ce&&(ce.textContent=`${x}x`)}const D=document.querySelector(`[data-audio-speed-menu="${t._id}"]`);if(D){D.querySelectorAll("[data-speed-option]").forEach(Lr=>{Lr.classList.remove("bg-blue-100","text-blue-700"),Lr.classList.add("text-gray-700","hover:bg-gray-100")});const Je=D.querySelector(`[data-speed-option="${x}"]`);Je&&(Je.classList.remove("text-gray-700","hover:bg-gray-100"),Je.classList.add("bg-blue-100","text-blue-700"))}const E=document.querySelector(`[data-audio-speed-menu="${t._id}"]`);E&&E.classList.add("hidden")},children:[e.jsxs("span",{children:[x,"x"]}),x===1&&e.jsx("span",{className:"text-xs text-gray-400",children:"Normal"})]},x))]})}),e.jsx("div",{"data-audio-controls-menu":t._id,className:"hidden absolute right-0 bottom-full mb-1 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-[9999]",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("div",{className:"px-3 py-2 text-xs font-medium text-gray-500 uppercase tracking-wide flex items-center gap-2",children:[e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",onClick:x=>{x.stopPropagation();const f=document.querySelector(`[data-audio-menu="${t._id}"]`),b=document.querySelector(`[data-audio-controls-menu="${t._id}"]`);f&&b&&(b.classList.add("hidden"),f.classList.remove("hidden"))},children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),"Audio Controls"]}),e.jsxs("button",{className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:x=>{x.stopPropagation();const f=document.querySelector(`[data-audio-id="${t._id}"]`);f&&(f.paused?f.play():f.pause());const b=document.querySelector(`[data-audio-controls-menu="${t._id}"]`);b&&b.classList.add("hidden")},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h1m4 0h1m-6-8h8a2 2 0 012 2v8a2 2 0 01-2 2H8a2 2 0 01-2-2V6a2 2 0 012-2z"})}),"Toggle Play/Pause"]}),e.jsxs("button",{className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:x=>{x.stopPropagation();const f=document.querySelector(`[data-audio-id="${t._id}"]`);f&&(f.currentTime=0);const b=document.querySelector(`[data-audio-controls-menu="${t._id}"]`);b&&b.classList.add("hidden")},children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Restart Audio"]}),e.jsxs("button",{className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",onClick:x=>{x.stopPropagation();const f=document.querySelector(`[data-audio-id="${t._id}"]`);f&&(f.muted=!f.muted);const b=document.querySelector(`[data-audio-controls-menu="${t._id}"]`);b&&b.classList.add("hidden")},children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"})]}),"Toggle Mute"]})]})})]})]})]}),t&&t.message&&e.jsxs("div",{className:`mt-2 text-sm whitespace-pre-wrap break-words ${o?"text-white":"text-gray-700"}`,children:[t&&t.message,t&&t.edited&&e.jsx("span",{className:`ml-2 text-[10px] italic whitespace-nowrap ${o?"text-blue-200":"text-gray-400"}`,children:"(Edited)"})]})]}),t&&t.documentUrl&&e.jsx("div",{className:"mb-2",children:e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border hover:bg-gray-50",onClick:async x=>{x.stopPropagation();try{const f=await fetch(t&&t.documentUrl?t.documentUrl:"",{mode:"cors"});if(!f.ok)throw new Error(`HTTP ${f.status}`);const b=await f.blob(),D=window.URL.createObjectURL(b),E=document.createElement("a");E.href=D,E.download=t&&t.documentName||`document-${t&&t._id||Date.now()}`,document.body.appendChild(E),E.click(),E.remove(),setTimeout(()=>window.URL.revokeObjectURL(D),200),g.success("Document downloaded successfully")}catch(f){console.error("Download failed:",f);const b=document.createElement("a");b.href=t&&t.documentUrl?t.documentUrl:"",b.download=t&&t.documentName||`document-${t&&t._id||Date.now()}`,b.target="_blank",document.body.appendChild(b),b.click(),b.remove(),g.success("Document download started")}},children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“„"}),e.jsx("span",{className:`text-sm truncate max-w-[200px] ${o?"text-white":"text-blue-700"}`,children:t&&t.documentName||"Document"})]})}),(()=>{if(t&&t.previewDismissed)return null;const x=/(https?:\/\/[^\s]+|www\.[^\s]+\.[^\s]{2,}(?:\/[^\s]*)?|[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*\.[a-zA-Z]{2,}(?:\/[^\s]*)?)/gi,f=(t&&t.message||"").match(x);return f&&f.length>0?e.jsx("div",{className:"mb-2 max-h-40 overflow-hidden",children:e.jsx(Uo,{url:f[0],className:"max-w-xs",showRemoveButton:!1,clickable:!0})}):null})(),t&&!t.audioUrl&&e.jsxs("div",{className:"inline",children:[e.jsx(Fo,{text:(t&&t.message||"").replace(/\n+$/,""),isSentMessage:o,className:"whitespace-pre-wrap break-words",searchQuery:ur}),t&&t.edited&&e.jsx("span",{className:"ml-2 text-[10px] italic text-gray-300 whitespace-nowrap",children:"(Edited)"})]})]})})}),e.jsxs("div",{className:"flex items-center gap-1 justify-end mt-2","data-message-actions":!0,children:[t&&t.starredBy&&t.starredBy.includes(m._id)&&e.jsx(bt,{className:`${o?"text-yellow-300":"text-yellow-500"} text-[10px]`}),e.jsx("span",{className:`${o?"text-blue-200":"text-gray-500"} text-[10px]`,children:new Date(t&&t.timestamp?t.timestamp:Date.now()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx("button",{className:`${(t&&t.senderEmail)===m.email?"text-blue-200 hover:text-white":"text-gray-500 hover:text-gray-700"} transition-all duration-200 hover:scale-110 p-1 rounded-full hover:bg-white hover:bg-opacity-20 ml-1`,onClick:x=>{x.stopPropagation(),B(t&&t._id),be(t&&t._id)},title:"Message options","aria-label":"Message options",children:e.jsx(Dr,{size:12})}),t&&!t.deleted&&t.reactions&&t.reactions.length>0&&e.jsx("div",{className:"flex items-center gap-1 ml-1",children:(()=>{const x={};return(t&&t.reactions||[]).forEach(f=>{x[f.emoji]||(x[f.emoji]=[]),x[f.emoji].push(f)}),Object.entries(x).map(([f,b])=>{const D=b.some(ce=>ce.userId===m._id),E=b.map(ce=>ce.userName).join(", ");return e.jsxs("button",{onClick:()=>je(t&&t._id,f),className:`text-xs rounded-full px-2 py-1 flex items-center gap-1 transition-all duration-200 hover:scale-105 ${D?"bg-blue-500 border-2 border-blue-600 hover:bg-blue-600 shadow-md":"bg-gray-100 border border-gray-300 hover:bg-gray-200"}`,title:`${E} reacted with ${f}${D?" (Click to remove)":" (Click to add)"}`,children:[e.jsx("span",{children:f}),e.jsx("span",{className:`${D?"text-white font-semibold":"text-gray-600"}`,children:b.length})]},f)})})()}),(()=>{if(!(t&&!t.deleted&&Xe&&et===(t&&t._id)))return!1;const f=document.querySelector(`[data-message-id="${t&&t._id}"]`);if(f){const b=f.getBoundingClientRect(),D=K.current;if(D){const E=D.getBoundingClientRect();if(b.top-E.top<120&&E.bottom-b.bottom>=60+20)return!1}}return!0})()&&e.jsxs("div",{className:`absolute -top-8 ${o?"right-0":"left-0"} bg-red-500 rounded-full shadow-lg border-2 border-red-600 p-1 flex items-center gap-1 animate-reactions-bar z-[999999] reactions-bar transition-all duration-300`,style:{minWidth:"max-content"},children:[e.jsx("button",{onClick:()=>je(t&&t._id,"ðŸ‘"),className:`w-8 h-8 flex items-center justify-center text-lg hover:scale-110 transition-transform rounded-full ${(ye=t&&t.reactions)!=null&&ye.some(x=>x.emoji==="ðŸ‘"&&x.userId===m._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100"}`,title:"Like",children:"ðŸ‘"}),e.jsx("button",{onClick:()=>je(t&&t._id,"â¤ï¸"),className:`w-8 h-8 flex items-center justify-center text-lg hover:scale-110 transition-transform rounded-full ${(V=t&&t.reactions)!=null&&V.some(x=>x.emoji==="â¤ï¸"&&x.userId===m._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100"}`,title:"Love",children:"â¤ï¸"}),e.jsx("button",{onClick:()=>je(t&&t._id,"ðŸ˜‚"),className:`w-8 h-8 flex items-center justify-center text-lg hover:scale-110 transition-transform rounded-full ${(G=t&&t.reactions)!=null&&G.some(x=>x.emoji==="ðŸ˜‚"&&x.userId===m._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100"}`,title:"Laugh",children:"ðŸ˜‚"}),e.jsx("button",{onClick:()=>je(t&&t._id,"ðŸ˜®"),className:`w-8 h-8 flex items-center justify-center text-lg hover:scale-110 transition-transform rounded-full ${(ee=t&&t.reactions)!=null&&ee.some(x=>x.emoji==="ðŸ˜®"&&x.userId===m._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100"}`,title:"Wow",children:"ðŸ˜®"}),e.jsx("button",{onClick:()=>je(t&&t._id,"ðŸ˜¢"),className:`w-8 h-8 flex items-center justify-center text-lg hover:scale-110 transition-transform rounded-full ${(Eo=t&&t.reactions)!=null&&Eo.some(x=>x.emoji==="ðŸ˜¢"&&x.userId===m._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100"}`,title:"Sad",children:"ðŸ˜¢"}),e.jsx("button",{onClick:()=>je(t&&t._id,"ðŸ˜¡"),className:`w-8 h-8 flex items-center justify-center text-lg hover:scale-110 transition-transform rounded-full ${(Mo=t&&t.reactions)!=null&&Mo.some(x=>x.emoji==="ðŸ˜¡"&&x.userId===m._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100"}`,title:"Angry",children:"ðŸ˜¡"}),e.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),e.jsx("button",{onClick:ke,className:"w-8 h-8 flex items-center justify-center text-lg hover:scale-110 transition-transform bg-gray-50 hover:bg-gray-100 rounded-full",title:"More emojis",children:"âž•"})]}),t&&t.senderEmail===m.email&&!t.deleted&&e.jsx("span",{className:"ml-1 flex items-center gap-1",children:(Ro=t&&t.readBy)!=null&&Ro.some(x=>x!==m._id)?e.jsx(Mr,{className:"text-green-400 text-xs transition-all duration-300 animate-fadeIn",title:"Read"}):(t&&t.status)==="delivered"?e.jsx(Mr,{className:"text-blue-200 text-xs transition-all duration-300 animate-fadeIn",title:"Delivered"}):(t&&t.status)==="sending"?e.jsx(Mr,{className:"text-blue-200 text-xs animate-pulse transition-all duration-300",title:"Sending..."}):e.jsx(Po,{className:"text-blue-200 text-xs transition-all duration-300 animate-fadeIn",title:"Sent"})})]})]})]})]},t&&t._id||a)}),e.jsx("div",{ref:te})]}),(()=>{var l,d,y,S,_,Z;if(!(Xe&&et))return null;const s=document.querySelector(`[data-message-id="${et}"]`);if(!s)return null;const r=s.getBoundingClientRect(),a=K.current;if(!a)return null;const o=a.getBoundingClientRect();if(r.top-o.top<120&&o.bottom-r.bottom>=60+20){const V=N.find(ee=>ee._id===et);if(!V||V.deleted)return null;const G=V.senderEmail===m.email;return e.jsxs("div",{className:"fixed bg-red-500 rounded-full shadow-lg border-2 border-red-600 p-1 flex items-center gap-1 animate-reactions-bar z-[999999] reactions-bar transition-all duration-300",style:{minWidth:"max-content",top:`${r.bottom+2}px`,left:G?"auto":`${r.left}px`,right:G?`${window.innerWidth-r.right}px`:"auto"},children:[e.jsx("button",{onClick:()=>je(V._id,"ðŸ‘"),className:`w-8 h-8 flex items-center justify-center text-lg hover:scale-110 transition-transform rounded-full ${(l=V.reactions)!=null&&l.some(ee=>ee.emoji==="ðŸ‘"&&ee.userId===m._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100"}`,title:"Like",children:"ðŸ‘"}),e.jsx("button",{onClick:()=>je(V._id,"â¤ï¸"),className:`w-8 h-8 flex items-center justify-center text-lg hover:scale-110 transition-transform rounded-full ${(d=V.reactions)!=null&&d.some(ee=>ee.emoji==="â¤ï¸"&&ee.userId===m._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100"}`,title:"Love",children:"â¤ï¸"}),e.jsx("button",{onClick:()=>je(V._id,"ðŸ˜‚"),className:`w-8 h-8 flex items-center justify-center text-lg hover:scale-110 transition-transform rounded-full ${(y=V.reactions)!=null&&y.some(ee=>ee.emoji==="ðŸ˜‚"&&ee.userId===m._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100"}`,title:"Laugh",children:"ðŸ˜‚"}),e.jsx("button",{onClick:()=>je(V._id,"ðŸ˜®"),className:`w-8 h-8 flex items-center justify-center text-lg hover:scale-110 transition-transform rounded-full ${(S=V.reactions)!=null&&S.some(ee=>ee.emoji==="ðŸ˜®"&&ee.userId===m._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100"}`,title:"Wow",children:"ðŸ˜®"}),e.jsx("button",{onClick:()=>je(V._id,"ðŸ˜¢"),className:`w-8 h-8 flex items-center justify-center text-lg hover:scale-110 transition-transform rounded-full ${(_=V.reactions)!=null&&_.some(ee=>ee.emoji==="ðŸ˜¢"&&ee.userId===m._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100"}`,title:"Sad",children:"ðŸ˜¢"}),e.jsx("button",{onClick:()=>je(V._id,"ðŸ˜¡"),className:`w-8 h-8 flex items-center justify-center text-lg hover:scale-110 transition-transform rounded-full ${(Z=V.reactions)!=null&&Z.some(ee=>ee.emoji==="ðŸ˜¡"&&ee.userId===m._id)?"bg-blue-100 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100"}`,title:"Angry",children:"ðŸ˜¡"}),e.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),e.jsx("button",{onClick:ke,className:"w-8 h-8 flex items-center justify-center text-lg hover:scale-110 transition-transform bg-gray-50 hover:bg-gray-100 rounded-full",title:"More emojis",children:"âž•"})]})}return null})(),Ft&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 backdrop-blur-sm flex items-center justify-center z-[999999] animate-fadeIn",onMouseDown:t=>{t.target===t.currentTarget&&ge(!1)},onClick:t=>{t.target===t.currentTarget&&ge(!1)},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-200 p-6 max-w-md w-full mx-4 max-h-[80vh] overflow-hidden quick-reactions-modal",onMouseDown:t=>{t.stopPropagation()},onClick:t=>{t.stopPropagation()},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-800",children:"Quick Reactions"}),e.jsx("button",{onMouseDown:t=>{t.stopPropagation(),t.preventDefault()},onClick:t=>{t.stopPropagation(),ge(!1),Re("")},className:"text-gray-500 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors",title:"Close",children:e.jsx(me,{size:16})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search emojis...",value:jt,onChange:t=>Re(t.target.value),className:"w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",onMouseDown:t=>t.stopPropagation(),onClick:t=>t.stopPropagation()}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),jt&&e.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:[Qt(jt).length," emoji",Qt(jt).length!==1?"s":""," found"]})]}),e.jsx("div",{className:"overflow-y-auto max-h-[60vh] scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",onMouseDown:t=>{t.stopPropagation()},onClick:t=>{t.stopPropagation()},children:e.jsx("div",{className:"grid grid-cols-10 gap-2",onMouseDown:t=>{t.stopPropagation()},onClick:t=>{t.stopPropagation()},children:Qt(jt).map((t,s)=>e.jsx("button",{onClick:r=>{r.stopPropagation(),r.preventDefault(),et&&(je(et,t),ge(!1),le(!1),Y(null))},onMouseDown:r=>{r.stopPropagation(),r.preventDefault()},className:"w-10 h-10 flex items-center justify-center text-xl hover:scale-110 transition-all duration-200 bg-gray-50 hover:bg-gray-100 rounded-lg border border-gray-200 hover:border-gray-300 hover:shadow-md",title:`React with ${t}`,children:t},s))})})]})}),rt&&e.jsx("div",{className:"px-4 mb-2",children:e.jsxs("div",{className:"flex items-center bg-blue-50 border-l-4 border-blue-400 px-2 py-1 rounded",children:[e.jsx("span",{className:"text-xs text-gray-700 font-semibold mr-2",children:"Replying to:"}),e.jsxs("span",{className:"text-xs text-gray-600 truncate max-w-[200px]",children:[($o=rt.message)==null?void 0:$o.substring(0,40),((Io=rt.message)==null?void 0:Io.length)>40?"...":""]}),e.jsx("button",{className:"ml-auto text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-1 transition-colors",onClick:()=>xe(null),title:"Cancel reply",children:e.jsx(me,{className:"w-3 h-3"})})]})}),H&&e.jsx("div",{className:"px-4 mb-2",children:e.jsxs("div",{className:"flex items-center bg-yellow-50 border-l-4 border-yellow-400 px-2 py-1 rounded",children:[e.jsx("span",{className:"text-xs text-yellow-700 font-semibold mr-2",children:"âœï¸ Editing message:"}),e.jsx("span",{className:"text-xs text-yellow-600 truncate",children:He}),e.jsx("button",{className:"ml-auto text-yellow-400 hover:text-yellow-700 bg-yellow-100 hover:bg-yellow-200 rounded-full p-1 transition-colors",onClick:()=>{Nt(null),st(""),J(es),setTimeout(()=>{zt("")},100),Te(null),Pe(!1),setTimeout(()=>{if(w.current){const s=new Event("input",{bubbles:!0});w.current.dispatchEvent(s),w.current.style.height="48px";const r=w.current.scrollHeight,a=144;r<=a?(w.current.style.height=r+"px",w.current.style.overflowY="hidden"):(w.current.style.height=a+"px",w.current.style.overflowY="auto")}},100)},title:"Cancel edit",children:e.jsx(me,{className:"w-3 h-3"})})]})}),e.jsxs("div",{className:"flex gap-2 mt-1 px-3 pb-2 flex-shrink-0 bg-gradient-to-b from-transparent to-white pt-2 items-end",children:[e.jsxs("div",{className:"flex-1 relative",children:[kt&&e.jsx("div",{className:"max-h-32 max-w-full overflow-y-auto mb-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:e.jsx(Uo,{url:kt,onRemove:()=>{Te(null),Pe(!0)},className:"w-full",showRemoveButton:!0,clickable:!1})}),Gr&&e.jsxs("div",{className:"relative mb-2 animate-slideDown bg-gradient-to-r from-purple-50 to-blue-50 p-3 rounded-lg border border-purple-200 shadow-sm",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700 hover:bg-white hover:bg-opacity-50 rounded-full p-1 transition-colors z-10",onClick:()=>dr(!1),title:"Close text styling panel","aria-label":"Close text styling panel",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 pr-8",children:[e.jsx("button",{type:"button",className:"px-2 py-1 text-xs rounded border hover:bg-gray-100",onClick:()=>{Ve(()=>{const t=w.current;if(!t)return;const s=t.selectionStart||0,r=t.selectionEnd||0,a=q||"",o=a.slice(s,r),n=`**${o||"bold"}**`,l=a.slice(0,s)+n+a.slice(r);J(l),setTimeout(()=>{try{t.focus(),t.setSelectionRange(s+2,s+2+(o||"bold").length)}catch{}},0)})},children:"B"}),e.jsx("button",{type:"button",className:"px-2 py-1 text-xs rounded border hover:bg-gray-100 italic",onClick:()=>{Ve(()=>{const t=w.current;if(!t)return;const s=t.selectionStart||0,r=t.selectionEnd||0,a=q||"",o=a.slice(s,r),n=`*${o||"italic"}*`,l=a.slice(0,s)+n+a.slice(r);J(l),setTimeout(()=>{try{t.focus(),t.setSelectionRange(s+1,s+1+(o||"italic").length)}catch{}},0)})},children:"I"}),e.jsx("button",{type:"button",className:"px-2 py-1 text-xs rounded border hover:bg-gray-100 underline",onClick:()=>{Ve(()=>{const t=w.current;if(!t)return;const s=t.selectionStart||0,r=t.selectionEnd||0,a=q||"",o=a.slice(s,r),n=`__${o||"underline"}__`,l=a.slice(0,s)+n+a.slice(r);J(l),setTimeout(()=>{try{t.focus(),t.setSelectionRange(s+2,s+2+(o||"underline").length)}catch{}},0)})},children:"U"}),e.jsx("button",{type:"button",className:"px-2 py-1 text-xs rounded border hover:bg-gray-100",onClick:()=>{Ve(()=>{const t=w.current;if(!t)return;const s=t.selectionStart||0,r=t.selectionEnd||0,a=q||"",o=a.slice(s,r),n=`~~${o||"strike"}~~`,l=a.slice(0,s)+n+a.slice(r);J(l),setTimeout(()=>{try{t.focus(),t.setSelectionRange(s+2,s+2+(o||"strike").length)}catch{}},0)})},children:"S"}),e.jsx("button",{type:"button",className:"px-2 py-1 text-xs rounded border hover:bg-gray-100",onClick:()=>{Ve(()=>{const t=w.current;if(!t)return;const s=q||"",r=t.selectionStart||0;J(s.slice(0,r)+"- "+s.slice(r))})},children:"â€¢ List"}),e.jsx("button",{type:"button",className:"px-2 py-1 text-xs rounded border hover:bg-gray-100",onClick:()=>{const t=w.current;if(!t)return;const s=q||"",r=t.selectionStart||0,a=s.slice(0,r);s.slice(r);const o=a.split(`
`);let n=1;for(let l=o.length-1;l>=0;l--){const d=o[l].trim(),y=d.match(/^(\d+)\.\s/);if(y){n=parseInt(y[1])+1;break}else if(d&&!d.match(/^\s*$/))break}Ve(()=>{J(s.slice(0,r)+`${n}. `+s.slice(r))})},children:"1. List"}),e.jsx("button",{type:"button",className:"px-2 py-1 text-xs rounded border hover:bg-gray-100",onClick:()=>{Ve(()=>{const t=w.current;if(!t)return;const s=q||"",r=t.selectionStart||0;J(s.slice(0,r)+"> "+s.slice(r))})},children:"> Quote"}),e.jsx("button",{type:"button",className:"px-2 py-1 text-xs rounded border hover:bg-gray-100",title:"Tag Property",onClick:()=>{Ve(()=>{const t=w.current;if(!t)return;const s=t.selectionStart||0,r=q||"";J(r.slice(0,s)+"@"+r.slice(s))})},children:"@Prop"}),e.jsx("button",{type:"button",className:"px-2 py-1 text-xs rounded border hover:bg-gray-100",title:"Insert appointment card",onClick:()=>{Ve(()=>{const t=w.current;if(!t)return;const s=t.selectionStart||0,r=q||"";J(r.slice(0,s)+"[Appointment: date â€¢ time â€¢ with]"+r.slice(s))})},children:"Appt"}),e.jsx("button",{type:"button",className:"px-2 py-1 text-xs rounded border hover:bg-gray-100",title:"Insert service link",onClick:()=>{Ve(()=>{const t=w.current;if(!t)return;const s=t.selectionStart||0,r=q||"";J(r.slice(0,s)+"Book Movers: /user/movers"+r.slice(s))})},children:"Service"})]})]}),q&&/@[^\s]*$/.test(q)&&e.jsx("div",{className:"absolute bottom-16 left-2 right-2 bg-white border rounded shadow-lg max-h-48 overflow-auto z-30",children:(()=>{var n;const t=(((n=q.match(/@([^\s]*)$/))==null?void 0:n[1])||"").toLowerCase(),a=[...(typeof appointments<"u"&&Array.isArray(appointments)&&appointments.length>0?appointments:[i].filter(Boolean)).map(l=>{var d,y;return{id:((d=l==null?void 0:l.listingId)==null?void 0:d._id)||(l==null?void 0:l.listingId),name:(l==null?void 0:l.propertyName)||((y=l==null?void 0:l.listingId)==null?void 0:y.name)||"Property"}}),...or],o=Array.from(new Set(a.filter(l=>l.id&&l.name).map(l=>JSON.stringify(l)))).map(l=>JSON.parse(l)).filter(l=>l.name&&l.name.toLowerCase().includes(t));return o.length===0?e.jsx("div",{className:"px-3 py-2 text-sm text-gray-500",children:"No matches"}):o.slice(0,8).map(l=>e.jsx("button",{type:"button",className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-100",onClick:()=>{const d=w.current,y=q||"",S=y.match(/@([^\s]*)$/);if(!S)return;const _=y.lastIndexOf("@"),Z=`@[${l.name}](${l.id})`,se=y.slice(0,_)+Z+" "+y.slice(_+S[0].length);J(se),setTimeout(()=>{try{d==null||d.focus(),d==null||d.setSelectionRange(_+Z.length+1,_+Z.length+1)}catch{}},0)},children:l.name},l.id))})()}),e.jsx("textarea",{rows:1,className:"w-full pl-4 pr-20 py-3 border-2 border-gray-200 rounded-2xl text-sm focus:ring-2 focus:ring-blue-300 focus:border-blue-400 shadow-lg transition-all duration-300 bg-white resize-none whitespace-pre-wrap break-all hover:border-blue-300 hover:shadow-xl focus:shadow-2xl transform hover:scale-[1.01] overflow-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",style:{minHeight:"48px",maxHeight:"144px",lineHeight:"24px",wordBreak:"break-all",overflowWrap:"break-word"},placeholder:H?"Edit your message...":"Type a message...",value:q,onChange:t=>{const s=t.target.value;J(s);const r=/(https?:\/\/[^\s]+|www\.[^\s]+\.[^\s]{2,}(?:\/[^\s]*)?|[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*\.[a-zA-Z]{2,}(?:\/[^\s]*)?)/gi,a=s.match(r);if(a&&a.length>0?(Te(a[0]),Pe(!1)):(Te(null),Pe(!1)),H&&st(s),(t.target.value||"").trim()===""){const d=t.target;d.style.height="48px",d.style.overflowY="hidden";return}const o=t.target;o.style.height="48px";const n=o.scrollHeight,l=144;n<=l?(o.style.height=n+"px",o.style.overflowY="hidden"):(o.style.height=l+"px",o.style.overflowY="auto")},onClick:()=>{de&&(B(null),g.info("You can hit reply icon in header to reply"))},onScroll:t=>{t.stopPropagation()},onPaste:t=>{const r=Array.from(t.clipboardData.items).filter(a=>a.type.startsWith("image/"));if(r.length>0){t.preventDefault();const o=r[0].getAsFile();o&&io([o])}},onKeyDown:t=>{const s=window.matchMedia("(min-width: 768px)").matches;if(t.key==="Enter"){if(t.isComposing||t.keyCode===229)return;(s&&!t.shiftKey||t.ctrlKey||t.metaKey)&&(t.preventDefault(),H?Ir(H):$r())}},ref:w}),e.jsx("div",{className:"absolute right-12 bottom-2",children:e.jsx(vs,{onEmojiClick:t=>{const s=w==null?void 0:w.current,r=s?s.value:q;let a=r.length,o=r.length;try{s&&typeof s.selectionStart=="number"&&typeof s.selectionEnd=="number"&&(a=s.selectionStart,o=s.selectionEnd)}catch{}const n=r.slice(0,a)+t+r.slice(o);J(n),H&&st(n),setTimeout(()=>{try{if(s){const l=a+t.length;s.focus(),s.setSelectionRange(l,l)}}catch{}},0)},className:"w-8 h-8",inputRef:w})}),e.jsxs("div",{className:"absolute right-3 bottom-3",children:[e.jsx("button",{ref:Qr,type:"button",onClick:()=>xt(t=>!t),disabled:lt,className:`flex items-center justify-center w-8 h-8 rounded-full transition-all duration-300 ${lt?"bg-gray-400 cursor-not-allowed":"bg-gray-100 hover:bg-gray-200 hover:shadow-md active:scale-95"}`,title:"Attach",children:lt?e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-gray-600 border-t-transparent rounded-full"}):e.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),fr&&!lt&&e.jsxs("div",{ref:Xr,className:"absolute bottom-10 right-0 bg-white border border-gray-200 shadow-xl rounded-lg w-48 py-2 z-20",children:[e.jsxs("label",{className:"flex items-center gap-3 px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Photos",e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:t=>{const s=t.target.files;s&&s.length>0&&oo(s),t.target.value="",xt(!1)}})]}),e.jsxs("label",{className:"flex items-center gap-3 px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsx("svg",{className:"w-4 h-4 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7a2 2 0 012-2h2l1-2h6l1 2h2a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"})}),"Camera",e.jsx("input",{type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:t=>{t.target.files&&t.target.files[0]&&oo([t.target.files[0]]),t.target.value="",xt(!1)}})]}),e.jsxs("label",{className:"flex items-center gap-3 px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsx("svg",{className:"w-4 h-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Videos",e.jsx("input",{ref:Qo,type:"file",accept:"video/*",className:"hidden",onChange:t=>{const s=t.target.files&&t.target.files[0];s&&(s.size>5*1024*1024?g.error("Maximum video size is 5MB"):(Bs(s),zs(!0))),t.target.value="",xt(!1)}})]}),e.jsxs("label",{className:"flex items-center gap-3 px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Documents",e.jsx("input",{ref:Xo,type:"file",className:"hidden",onChange:t=>{const s=t.target.files&&t.target.files[0];s&&(s.size>5*1024*1024?g.error("Maximum document size is 5MB"):(Os(s),qs(!0))),t.target.value="",xt(!1)}})]}),e.jsxs("label",{className:"flex items-center gap-3 px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer",children:[e.jsxs("svg",{className:"w-4 h-4 text-indigo-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 1a3 3 0 00-3 3v8a3 3 0 106 0V4a3 3 0 00-3-3z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 10v2a7 7 0 11-14 0v-2"})]}),"Audio",e.jsx("input",{type:"file",accept:"audio/*",className:"hidden",onChange:t=>{const s=t.target.files&&t.target.files[0];s&&(s.size>5*1024*1024?g.error("Maximum audio size is 5MB"):(Vt(s),ps(!0))),t.target.value="",xt(!1)}})]}),e.jsxs("button",{type:"button",className:"flex items-center gap-3 px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer w-full text-left",onClick:()=>{xt(!1),Ws(!0)},children:[e.jsxs("svg",{className:"w-4 h-4 text-rose-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 1a3 3 0 00-3 3v8a3 3 0 106 0V4a3 3 0 00-3-3z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 10v2a7 7 0 11-14 0v-2"})]}),"Record Audio"]})]})]})]}),e.jsx("button",{onClick:t=>{t.preventDefault(),H?Ir(H):$r()},disabled:H?ts===H:!q.trim(),className:"bg-gradient-to-r from-blue-600 to-purple-700 text-white w-12 h-12 rounded-full shadow-lg hover:from-blue-700 hover:to-purple-800 hover:shadow-xl transform hover:scale-110 transition-all duration-300 disabled:opacity-50 disabled:transform-none flex items-center justify-center hover:shadow-2xl active:scale-95 group",children:H?ts===H?e.jsx(Er,{className:"text-lg text-white animate-editSaving"}):e.jsx(Er,{className:"text-lg text-white group-hover:scale-110 transition-transform duration-200"}):e.jsx("div",{className:"relative",children:Vo?e.jsx(Po,{className:"text-lg text-white group-hover:scale-110 transition-all duration-300 send-icon animate-sent"}):e.jsx(Va,{className:`text-lg text-white group-hover:scale-110 transition-all duration-300 send-icon ${lr?"animate-fly":""}`})})})]}),Jr&&e.jsx("div",{className:"px-3 pb-2",children:e.jsx("div",{className:"text-red-500 text-sm bg-red-50 p-2 rounded-lg border border-red-200",children:Jr})}),Zo&&F.length>0&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-lg font-medium text-gray-700",children:["Image Preview (",F.length," image",F.length!==1?"s":"",")"]}),e.jsx("button",{onClick:()=>{ht([]),Dt({}),De(0),xs(!1)},className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full p-2 transition-colors",children:e.jsx(me,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative mb-4",children:[F.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>De(t=>t>0?t-1:F.length-1),className:"absolute left-2 top-1/2 transform -translate-y-1/2 z-10 bg-black bg-opacity-50 text-white rounded-full p-2 hover:bg-opacity-70 transition-all duration-200",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:()=>De(t=>t<F.length-1?t+1:0),className:"absolute right-2 top-1/2 transform -translate-y-1/2 z-10 bg-black bg-opacity-50 text-white rounded-full p-2 hover:bg-opacity-70 transition-all duration-200",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:URL.createObjectURL(F[we]),alt:`Preview ${we+1}`,className:"w-full h-64 object-contain rounded-lg border"})}),e.jsxs("div",{className:"text-center text-sm text-gray-600 mb-3",children:[we+1," of ",F.length]}),e.jsxs("div",{className:"flex gap-2 mb-3 overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 pb-2 min-w-0 max-w-full",style:{scrollbarWidth:"thin",scrollbarColor:"#d1d5db #f3f4f6"},children:[F.map((t,s)=>e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>De(s),className:`flex-shrink-0 w-12 h-12 rounded-lg border-2 transition-all duration-200 ${s===we?"border-blue-500 shadow-lg":"border-gray-300 hover:border-gray-400"}`,children:e.jsx("img",{src:URL.createObjectURL(t),alt:`Thumbnail ${s+1}`,className:"w-full h-full object-cover rounded-lg"})}),F.length>1&&e.jsx("button",{onClick:r=>{r.stopPropagation();const a=F.filter((n,l)=>l!==s),o={...gs};delete o[t.name],a.length===0?(ht([]),Dt({}),xs(!1)):(ht(a),Dt(o),we>=a.length?De(a.length-1):we>s&&De(we-1))},className:"absolute -top-1 -right-1 bg-red-500 hover:bg-red-600 text-white rounded-full p-1 shadow-lg transition-all duration-200 hover:scale-110 z-10",title:"Remove this image","aria-label":"Remove this image",children:e.jsx(me,{className:"w-2 h-2"})})]},s)),F.length<10&&e.jsx("div",{className:"relative",children:e.jsxs("label",{className:"flex-shrink-0 w-12 h-12 rounded-lg border-2 border-dashed border-gray-300 hover:border-blue-400 hover:bg-blue-50 transition-all duration-200 cursor-pointer flex items-center justify-center group",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:t=>{const s=t.target.files;if(s&&s.length>0){const r=10-F.length,a=Array.from(s).slice(0,r);if(a.length>0){const o=[...F,...a];ht(o),a.length<s.length&&g.info(`Added ${a.length} images. Maximum limit of 10 images reached.`)}t.target.value=""}}}),e.jsx("svg",{className:"w-5 h-5 text-gray-400 group-hover:text-blue-500 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})]})})]})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("textarea",{placeholder:`Add a caption for ${(Lo=F[we])==null?void 0:Lo.name}...`,value:gs[(Do=F[we])==null?void 0:Do.name]||"",onChange:t=>Dt(s=>{var r;return{...s,[(r=F[we])==null?void 0:r.name]:t.target.value}}),className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg text-sm resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,maxLength:500}),e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx(vs,{onEmojiClick:t=>{var r;const s=gs[(r=F[we])==null?void 0:r.name]||"";Dt(a=>{var o;return{...a,[(o=F[we])==null?void 0:o.name]:s+t}})},className:"w-6 h-6"})}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[(gs[(Ao=F[we])==null?void 0:Ao.name]||"").length,"/500"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:lt&&Zr>=0?e.jsxs("span",{children:["Uploading ",Zr+1," / ",F.length,` â€¢ ${Ko}%`]}):e.jsxs(e.Fragment,{children:[F.length," image",F.length!==1?"s":""," ready to send",Ht.length>0&&e.jsxs("span",{className:"ml-2 text-red-600",children:["â€¢ ",Ht.length," failed"]})]})}),e.jsx("div",{className:"flex items-center gap-2",children:lt?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Zs,className:"bg-red-600 text-white py-2 px-3 rounded-lg hover:bg-red-700 text-sm font-medium transition-colors",children:"Cancel Upload"}),e.jsx("div",{className:"w-24 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-2 bg-blue-600 rounded-full transition-all",style:{width:`${gt}%`}})}),e.jsxs("span",{className:"text-sm text-gray-700 w-10 text-right",children:[gt,"%"]})]}):e.jsxs(e.Fragment,{children:[Ht.length>0&&e.jsxs("button",{onClick:ha,className:"bg-yellow-500 text-white py-2 px-3 rounded-lg hover:bg-yellow-600 text-sm font-medium transition-colors",children:["Retry Failed (",Ht.length,")"]}),e.jsx("button",{onClick:no,className:"bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 text-sm font-medium transition-colors",children:`Send ${F.length} Image${F.length!==1?"s":""}`})]})})]})]})}),e.jsx("style",{jsx:!0,children:`
                @keyframes fadeInChatBubble {
                  from { opacity: 0; transform: translateY(20px) scale(0.95); }
                  to { opacity: 1; transform: translateY(0) scale(1); }
                }
                .animate-fadeInChatBubble {
                  animation: fadeInChatBubble 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
                }
                @keyframes fadeInChat {
                  from { opacity: 0; transform: translateY(10px); }
                  to { opacity: 1; transform: translateY(0); }
                }
                .animate-fadeInChat {
                  animation: fadeInChat 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
                }
                @keyframes gentlePulse {
                  0%, 100% { opacity: 1; transform: scale(1); }
                  50% { opacity: 0.9; transform: scale(1.01); }
                }
                .animate-gentlePulse {
                  animation: gentlePulse 3s ease-in-out infinite;
                }
                @keyframes attentionGlow {
                  0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
                  50% { box-shadow: 0 0 30px rgba(59, 130, 246, 0.6); }
                }
                .animate-attentionGlow {
                  animation: attentionGlow 2s ease-in-out infinite;
                }
                @keyframes slideInFromTop {
                  from { opacity: 0; transform: translateY(-20px) scale(0.95); }
                  to { opacity: 1; transform: translateY(0) scale(1); }
                }
                                  .animate-slideInFromTop {
                    animation: slideInFromTop 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
                  }
                  @keyframes sendIconFly {
                    0% { 
                      transform: translate(0, 0) scale(1); 
                      opacity: 1;
                    }
                    20% { 
                      transform: translate(0, 0) scale(1.2); 
                      opacity: 1;
                    }
                    40% { 
                      transform: translate(15px, -20px) scale(1.3); 
                      opacity: 0.8;
                    }
                    60% { 
                      transform: translate(25px, -35px) scale(1.4); 
                      opacity: 0.6;
                    }
                    80% { 
                      transform: translate(15px, -20px) scale(1.2); 
                      opacity: 0.8;
                    }
                    100% { 
                      transform: translate(0, 0) scale(1); 
                      opacity: 1;
                    }
                  }
                  .send-icon.animate-fly {
                    animation: sendIconFly 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                  }
                  @keyframes sentSuccess {
                    0% { 
                      transform: scale(0.8); 
                      opacity: 0;
                    }
                    50% { 
                      transform: scale(1.2); 
                      opacity: 1;
                    }
                    100% { 
                      transform: scale(1); 
                      opacity: 1;
                    }
                  }
                  .send-icon.animate-sent {
                    animation: sentSuccess 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                  }
                  @keyframes editSaving {
                    0% { 
                      transform: scale(1) rotate(0deg) translate(0, 0); 
                      opacity: 1;
                    }
                    20% { 
                      transform: scale(1.15) rotate(-8deg) translate(-1px, -1px); 
                      opacity: 0.9;
                    }
                    40% { 
                      transform: scale(1.25) rotate(0deg) translate(0, -2px); 
                      opacity: 1;
                    }
                    60% { 
                      transform: scale(1.15) rotate(8deg) translate(1px, -1px); 
                      opacity: 0.9;
                    }
                    80% { 
                      transform: scale(1.1) rotate(-4deg) translate(-1px, 0); 
                      opacity: 0.95;
                    }
                    100% { 
                      transform: scale(1) rotate(0deg) translate(0, 0); 
                      opacity: 1;
                    }
                  }
                  .animate-editSaving {
                    animation: editSaving 1.2s ease-in-out infinite;
                  }
                  .search-highlight {
                    animation: searchHighlight 2s ease-in-out;
                  }
                  @keyframes searchHighlight {
                    0%, 100% { box-shadow: 0 0 0 rgba(59, 130, 246, 0); }
                    50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8); }
                  }
                  .date-highlight {
                    animation: dateHighlight 3s ease-in-out;
                  }
                  @keyframes dateHighlight {
                    0%, 100% { box-shadow: 0 0 0 rgba(168, 85, 247, 0); }
                    50% { box-shadow: 0 0 25px rgba(168, 85, 247, 0.9); }
                  }
                `}),!h&&!H&&!rt&&e.jsx("div",{className:"absolute bottom-20 right-6 z-20",children:e.jsxs("button",{onClick:()=>{U(Math.max(A,N.length)),setTimeout(()=>ro(),50)},className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-full p-3 shadow-xl transition-all duration-200 hover:scale-110 relative transform hover:shadow-2xl",title:j>0?`${j} new message${j>1?"s":""} - Scroll to bottom`:"Scroll to bottom","aria-label":j>0?`${j} new messages, scroll to bottom`:"Scroll to bottom",children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"transform",children:e.jsx("path",{d:"M12 16l-6-6h12l-6 6z"})}),j>0&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center justify-center px-1 border-2 border-white shadow-lg",children:j>99?"99+":j})]})}),qo&&e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-sm relative shadow-2xl",children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors",onClick:()=>{ns(!1),ds("")},title:"Close","aria-label":"Close",children:e.jsx(me,{className:"w-4 h-4"})}),e.jsxs("h3",{className:"text-lg font-bold mb-4 text-red-600 flex items-center gap-2",children:[e.jsx(Ze,{})," Delete Entire Chat"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"This will permanently delete all messages for this appointment. Enter admin password to confirm."}),e.jsx("input",{type:"password",className:"border rounded px-3 py-2 w-full focus:ring-2 focus:ring-red-200 mb-4",placeholder:"Admin password",value:ls,onChange:t=>ds(t.target.value),onKeyDown:t=>{t.key==="Enter"&&ls.trim()&&!ar&&(t.preventDefault(),(async()=>{var s,r;try{Is(!0);const{data:a}=await T.delete(`${L}/api/bookings/${i._id}/comments`,{withCredentials:!0,headers:{"Content-Type":"application/json"},data:{password:ls}});I([]),g.success("Chat deleted successfully."),ns(!1),ds("")}catch(a){g.error(((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to delete chat")}finally{Is(!1)}})())},autoFocus:!0}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{ns(!1),ds("")},className:"px-4 py-2 rounded bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",disabled:ar||!ls,onClick:async()=>{var t,s;try{Is(!0);const{data:r}=await T.delete(`${L}/api/bookings/${i._id}/comments`,{withCredentials:!0,headers:{"Content-Type":"application/json"},data:{password:ls}});I([]),g.success("Chat deleted successfully."),ns(!1),ds("")}catch(r){g.error(((s=(t=r.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to delete chat")}finally{Is(!1)}},className:"px-4 py-2 rounded bg-red-600 text-white font-semibold hover:bg-red-700 transition-colors flex items-center gap-2 disabled:opacity-60",children:ar?"Deleting...":e.jsxs(e.Fragment,{children:[e.jsx(Ze,{size:12})," Delete Chat"]})})]})]})})]})}),ra&&Ye&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700",children:"Audio Preview"}),e.jsx("button",{onClick:()=>{Vt(null),ps(!1)},className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full p-2 transition-colors",children:e.jsx(me,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"mb-4",children:e.jsx("audio",{controls:!0,className:"w-full",src:oa})}),e.jsxs("div",{className:"relative mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:wr,placeholder:`Add a caption for ${Ye.name}...`,value:ws,onChange:t=>br(t.target.value),className:"w-full p-3 pr-12 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:2,maxLength:500}),e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx(vs,{onEmojiClick:t=>{const s=wr.current;if(s){const r=s.selectionStart,a=s.selectionEnd,o=ws.slice(0,r)+t+ws.slice(a);br(o),setTimeout(()=>{s.focus(),s.setSelectionRange(r+t.length,r+t.length)},0)}},inputRef:wr})})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[ws.length,"/500"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600 truncate flex-1 mr-4",children:Ye.name}),e.jsx("div",{className:"flex items-center gap-2",children:lt?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Zs,className:"px-4 py-2 rounded-lg border border-red-300 text-red-600 hover:bg-red-50",children:"Cancel"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-2 bg-blue-600 rounded-full transition-all",style:{width:`${gt}%`}})}),e.jsxs("span",{className:"text-sm text-gray-700 w-10 text-right",children:[gt,"%"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{Vt(null),ps(!1)},className:"py-2 px-4 rounded-lg text-sm font-medium border hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:ba,disabled:uo,className:`py-2 px-4 rounded-lg text-sm font-medium transition-colors ${uo?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:"Send Audio"})]})})]})]})}),rs&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Ze,{className:"text-red-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Delete Message"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify",children:"Are you sure you want to delete this message for everyone?"})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{ct(!1),mt(null)},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Da,className:"px-4 py-2 rounded-lg bg-red-600 text-white font-medium hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(Ze,{size:14}),"Delete"]})]})]})})}),Tt&&ie===i._id&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Yt,{className:"text-red-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Cancel Appointment"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify mb-4",children:"Are you sure you want to cancel this appointment?"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for cancellation (required):"}),e.jsx("textarea",{value:tr,onChange:t=>Ns(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",rows:"3",placeholder:"Please provide a reason for cancelling this appointment..."})]})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{oe(!1),he(null),Ns("")},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:sr,className:"px-4 py-2 rounded-lg bg-red-600 text-white font-medium hover:bg-red-700 transition-colors flex items-center gap-2",children:[e.jsx(Yt,{size:14}),"Cancel Appointment"]})]})]})})}),Pt&&ie===i._id&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Jt,{className:"text-green-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Reinitiate Appointment"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify",children:"Are you sure you want to reinitiate this appointment? This will notify both buyer and seller."})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{ve(!1),he(null)},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:ne,className:"px-4 py-2 rounded-lg bg-green-600 text-white font-medium hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(Jt,{size:14}),"Reinitiate"]})]})]})})}),wt&&ie===i._id&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(er,{className:"text-blue-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Archive Appointment"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify",children:"Are you sure you want to archive this appointment? It will be moved to the archived section."})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{Oe(!1),he(null)},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:rr,className:"px-4 py-2 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(er,{size:14}),"Archive"]})]})]})})}),Me&&ie===i._id&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md mx-2 sm:mx-4 animate-fadeIn",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Jt,{className:"text-green-600 text-xl"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Unarchive Appointment"}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed text-justify",children:"Are you sure you want to unarchive this appointment? It will be moved back to the active appointments."})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>{ae(!1),he(null)},className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"button",onClick:Kt,className:"px-4 py-2 rounded-lg bg-green-600 text-white font-medium hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(Jt,{size:14}),"Unarchive"]})]})]})})}),ir&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-gradient-to-r from-yellow-50 to-amber-50",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(bt,{className:"text-yellow-500"}),"Starred Messages"]}),e.jsx("button",{onClick:to,disabled:nr,className:"p-2 text-yellow-600 hover:text-yellow-700 bg-yellow-100 hover:bg-yellow-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Refresh starred messages",children:nr?e.jsx("div",{className:"w-4 h-4 border-2 border-yellow-600 border-t-transparent rounded-full animate-spin"}):e.jsx(To,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:nr?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-yellow-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading starred messages..."})]}):Be.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Xs,{className:"mx-auto text-6xl text-gray-300 mb-4"}),e.jsx("h4",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No Starred Messages"}),e.jsx("p",{className:"text-gray-500",children:"Star important messages to find them easily later."})]}):e.jsx("div",{className:"space-y-4",children:Be.map((t,s)=>{const r=t.senderEmail===m.email,a=new Date(t.timestamp);return e.jsx("div",{className:`flex w-full ${r?"justify-end":"justify-start"} mb-4`,children:e.jsxs("div",{className:`relative max-w-[80%] ${r?"ml-12":"mr-12"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 mb-1 ${r?"justify-end":"justify-start"}`,children:[e.jsx(bt,{className:"text-yellow-500 text-xs"}),e.jsx("span",{className:`text-xs font-medium ${r?"text-blue-600":"text-green-600"}`,children:r?"You":(()=>{var o,n,l,d;return t.senderEmail===((o=i.buyerId)==null?void 0:o.email)?((n=i.buyerId)==null?void 0:n.username)||"Buyer":t.senderEmail===((l=i.sellerId)==null?void 0:l.email)?((d=i.sellerId)==null?void 0:d.username)||"Seller":t.senderName||"UrbanSetu"})()}),e.jsx("span",{className:"text-xs text-gray-500",children:a.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx("button",{onClick:async()=>{Or(t._id);try{const{data:o}=await T.patch(`${L}/api/bookings/${i._id}/comment/${t._id}/star`,{starred:!1},{withCredentials:!0,headers:{"Content-Type":"application/json"}});$e(n=>n.filter(l=>l._id!==t._id)),I(n=>{const l=n.map(d=>d._id===t._id?{...d,starredBy:(d.starredBy||[]).filter(y=>y!==m._id)}:d);return O(i._id,l),l}),g.success("Message unstarred")}catch{g.error("Failed to unstar message")}finally{Or(null)}},className:"text-red-500 hover:text-red-700 text-xs p-1 rounded-full hover:bg-red-50 transition-colors",title:"Remove from starred messages",disabled:zr===t._id,children:zr===t._id?e.jsx("div",{className:"w-3 h-3 border border-red-500 border-t-transparent rounded-full animate-spin"}):e.jsx(me,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:`rounded-2xl px-4 py-3 text-sm shadow-lg break-words relative group cursor-pointer hover:shadow-xl transition-all duration-200 ${r?"bg-gradient-to-r from-blue-600 to-purple-700 text-white hover:from-blue-500 hover:to-purple-600":"bg-white text-gray-800 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"}`,onClick:()=>{Ls(!1);const o=document.querySelector(`[data-message-id="${t._id}"]`);o&&(o.scrollIntoView({behavior:"smooth",block:"center"}),o.classList.add("starred-highlight"),setTimeout(()=>{o.classList.remove("starred-highlight")},1600))},children:[e.jsxs("div",{className:"whitespace-pre-wrap break-words",children:[(t.originalImageUrl||t.imageUrl)&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:t.originalImageUrl||t.imageUrl,alt:"Shared image",className:"max-w-full max-h-64 rounded-lg cursor-pointer hover:opacity-90 transition-opacity",onClick:o=>{o.stopPropagation();const n=(N||[]).filter(y=>!!(y.originalImageUrl||y.imageUrl)).map(y=>y.originalImageUrl||y.imageUrl),l=t.originalImageUrl||t.imageUrl,d=Math.max(0,n.indexOf(l));Fs(n),De(d),hs(!0)},onError:o=>{o.target.src="https://via.placeholder.com/300x200?text=Image+Not+Found",o.target.className="max-w-full max-h-64 rounded-lg opacity-50"}})}),t.videoUrl&&e.jsx("div",{className:"mb-2",children:e.jsx("video",{src:t.videoUrl,className:"max-w-full max-h-64 rounded-lg border cursor-pointer hover:opacity-90 transition-opacity",controls:!0,onClick:o=>{o.preventDefault(),o.stopPropagation(),o.target.requestFullscreen?o.target.requestFullscreen():o.target.webkitRequestFullscreen?o.target.webkitRequestFullscreen():o.target.msRequestFullscreen&&o.target.msRequestFullscreen()}})}),t.documentUrl&&e.jsx("div",{className:"mb-2",children:e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border hover:bg-gray-50",onClick:o=>{o.stopPropagation();const n=document.createElement("a");n.href=t.documentUrl,n.download=t.documentName||`document-${t._id||Date.now()}`,n.target="_blank",document.body.appendChild(n),n.click(),n.remove()},children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“„"}),e.jsx("span",{className:"text-sm text-blue-700 truncate max-w-[200px]",children:t.documentName||"Document"})]})}),t.deleted?e.jsxs("div",{className:"border border-red-300 bg-red-50 rounded p-2 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-xs font-semibold mb-1",children:[e.jsx(Yt,{className:"inline-block"}),"Message deleted by ",t.deletedBy||"user"," (Admin view - preserved for records)"]}),(t.originalImageUrl||t.imageUrl)&&e.jsxs("div",{className:"mb-2",children:[e.jsx("img",{src:t.originalImageUrl||t.imageUrl,alt:"Preserved image from deleted message",className:"max-w-full max-h-64 rounded-lg cursor-pointer hover:opacity-90 transition-opacity",onClick:o=>{o.stopPropagation();const n=(N||[]).filter(y=>!!(y.originalImageUrl||y.imageUrl)).map(y=>y.originalImageUrl||y.imageUrl),l=t.originalImageUrl||t.imageUrl,d=Math.max(0,n.indexOf(l));Fs(n),De(d),hs(!0)},onError:o=>{o.target.src="https://via.placeholder.com/300x200?text=Image+Not+Found",o.target.className="max-w-full max-h-64 rounded-lg opacity-50"}}),e.jsx("div",{className:"mt-1 text-xs text-gray-600 italic",children:"Preserved image from deleted message"})]}),t.videoUrl&&e.jsxs("div",{className:"mb-2",children:[e.jsx("video",{src:t.videoUrl,className:"max-w-full max-h-64 rounded-lg border cursor-pointer hover:opacity-90 transition-opacity",controls:!0,onClick:o=>{o.preventDefault(),o.stopPropagation(),o.target.requestFullscreen?o.target.requestFullscreen():o.target.webkitRequestFullscreen&&o.target.webkitRequestFullscreen()}}),e.jsx("div",{className:"mt-1 text-xs text-gray-600 italic",children:"Preserved video from deleted message"})]}),t.audioUrl&&e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"bg-gray-100 border border-gray-300 rounded-lg p-3",children:[e.jsx("audio",{src:t.audioUrl,className:"w-full",controls:!0,preload:"metadata"}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600 italic",children:["Preserved audio from deleted message: ",t.audioName||"Audio file"]})]})}),t.documentUrl&&e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"bg-gray-100 border border-gray-300 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“„"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:t.documentName||"Document"}),e.jsx("div",{className:"text-xs text-gray-600 italic",children:"Preserved document from deleted message"})]}),e.jsx("button",{className:"px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",onClick:async o=>{o.stopPropagation();try{const n=await fetch(t.documentUrl,{mode:"cors"});if(!n.ok)throw new Error(`HTTP ${n.status}`);const l=await n.blob(),d=window.URL.createObjectURL(l),y=document.createElement("a");y.href=d,y.download=t.documentName||`document-${t._id||Date.now()}`,document.body.appendChild(y),y.click(),y.remove(),setTimeout(()=>window.URL.revokeObjectURL(d),200),g.success("Document downloaded successfully")}catch{const l=document.createElement("a");l.href=t.documentUrl,l.download=t.documentName||`document-${t._id||Date.now()}`,l.target="_blank",document.body.appendChild(l),l.click(),l.remove(),g.success("Document download started")}},children:"Download"})]})})}),e.jsx("div",{className:"text-gray-800 bg-white p-2 rounded border-l-4 border-red-400 relative group",children:(()=>{const o=t.originalMessage||t.message;return o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"whitespace-pre-wrap break-words",children:o}),e.jsx("button",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200 text-gray-500 hover:text-gray-700 bg-white rounded p-1 shadow-sm",onClick:n=>{n.stopPropagation(),ue(o)},title:"Copy deleted message content","aria-label":"Copy deleted message content",children:e.jsx(Gt,{className:"w-3 h-3"})})]}):e.jsx("span",{className:"text-gray-500 italic",children:"[Message content not preserved - this message was deleted before content preservation was implemented]"})})()})]}):e.jsx(Fo,{text:(t.message||"").replace(/\n+$/,""),isSentMessage:r,className:"whitespace-pre-wrap break-words",searchQuery:ur})]}),!t.deleted&&e.jsx("button",{onClick:o=>{o.stopPropagation(),ue(t.message)},className:`absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 p-1.5 rounded-full ${r?"bg-white/20 hover:bg-white/30 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-600"}`,title:"Copy message",children:e.jsx(Gt,{className:"w-3 h-3"})}),t.edited&&e.jsx("div",{className:`flex justify-end mt-2 text-xs ${r?"text-blue-200":"text-gray-500"}`,children:e.jsx("span",{className:"italic",children:"(Edited)"})})]})]})},t._id)})})}),e.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[Be.length," starred message",Be.length!==1?"s":""]}),e.jsxs("div",{className:"flex gap-2",children:[Be.length>0&&e.jsx("button",{onClick:ca,disabled:qr,className:"px-2 sm:px-4 py-1.5 sm:py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 disabled:bg-red-400 disabled:cursor-not-allowed transition-colors font-medium flex items-center gap-1 sm:gap-2 text-xs sm:text-sm",children:qr?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Removing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"w-4 h-4"}),"Remove All"]})}),e.jsx("button",{onClick:()=>Ls(!1),className:"px-2 sm:px-4 py-1.5 sm:py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors font-medium text-xs sm:text-sm",children:"Close"})]})]})})]})}),Ho&&_e&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(Ar,{className:"text-blue-500"})," Message Info"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded p-3 text-sm text-gray-700",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Message:"}),e.jsxs("div",{className:"whitespace-pre-wrap break-words",children:[(_e.message||"").slice(0,200),(_e.message||"").length>200?"...":""]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Sent:"}),e.jsx("span",{className:"text-sm text-gray-800",children:new Date(_e.timestamp).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),_e.deliveredAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Delivered:"}),e.jsx("span",{className:"text-sm text-gray-800",children:new Date(_e.deliveredAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),_e.readAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Read:"}),e.jsx("span",{className:"text-sm text-gray-800",children:new Date(_e.readAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})})]}),!_e.deliveredAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Not delivered yet"})]}),_e.deliveredAt&&!_e.readAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),e.jsx("span",{className:"text-sm text-blue-600",children:"Delivered"})]}),_e.readAt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Status:"}),e.jsx("span",{className:"text-sm text-green-600",children:"Read"})]})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>{Fr(!1),Ur(null)},className:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Close"})})]})}),e.jsx(Ya,{isOpen:Yo,onClose:()=>hs(!1),images:Jo,initialIndex:we,listingId:null,metadata:{addedFrom:"chat",chatType:"appointment"}}),ea&&Ge&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700",children:"Video Preview"}),e.jsx("button",{onClick:()=>{Bs(null),zs(!1)},className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full p-2 transition-colors",children:e.jsx(me,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 mb-4 min-h-0",children:e.jsx("video",{controls:!0,className:"w-full h-full max-h-[60vh] rounded-lg border",src:sa})}),e.jsxs("div",{className:"relative mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:gr,placeholder:`Add a caption for ${Ge.name}...`,value:ys,onChange:t=>Hs(t.target.value),className:"w-full p-3 pr-12 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:2,maxLength:500}),e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx(vs,{onEmojiClick:t=>{const s=gr.current;if(s){const r=s.selectionStart,a=s.selectionEnd,o=ys.slice(0,r)+t+ys.slice(a);Hs(o),setTimeout(()=>{s.focus(),s.setSelectionRange(r+t.length,r+t.length)},0)}},inputRef:gr})})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[ys.length,"/500"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600 truncate flex-1 mr-4",children:Ge.name}),e.jsx("div",{className:"flex gap-2 flex-shrink-0",children:lt?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Zs,className:"px-4 py-2 rounded-lg border border-red-300 text-red-600 hover:bg-red-50",children:"Cancel"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-2 bg-blue-600 rounded-full transition-all",style:{width:`${gt}%`}})}),e.jsxs("span",{className:"text-sm text-gray-700 w-10 text-right",children:[gt,"%"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{Bs(null),zs(!1),Hs("")},className:"px-4 py-2 rounded-lg border",children:"Cancel"}),e.jsx("button",{onClick:xa,className:"px-4 py-2 rounded-lg bg-blue-600 text-white",children:"Send"})]})})]})]})}),ta&&ft&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700",children:"Document Preview"}),e.jsx("button",{onClick:()=>{Os(null),qs(!1)},className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full p-2 transition-colors",children:e.jsx(me,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded flex items-center justify-center text-gray-600",children:"ðŸ“„"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:ft.name}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:ft.type||"Document"})]})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:xr,placeholder:`Add a caption for ${ft.name}...`,value:bs,onChange:t=>Vs(t.target.value),className:"w-full p-3 pr-12 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:2,maxLength:500}),e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx(vs,{onEmojiClick:t=>{const s=xr.current;if(s){const r=s.selectionStart,a=s.selectionEnd,o=bs.slice(0,r)+t+bs.slice(a);Vs(o),setTimeout(()=>{s.focus(),s.setSelectionRange(r+t.length,r+t.length)},0)}},inputRef:xr})})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[bs.length,"/500"]})]}),e.jsx("div",{className:"flex items-center justify-between",children:lt?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Zs,className:"px-4 py-2 rounded-lg border border-red-300 text-red-600 hover:bg-red-50",children:"Cancel"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-2 bg-blue-600 rounded-full transition-all",style:{width:`${gt}%`}})}),e.jsxs("span",{className:"text-sm text-gray-700 w-10 text-right",children:[gt,"%"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{Os(null),qs(!1),Vs("")},className:"px-4 py-2 rounded-lg border",children:"Cancel"}),e.jsx("button",{onClick:pa,className:"px-4 py-2 rounded-lg bg-blue-600 text-white",children:"Send"})]})})]})}),aa&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-lg p-4 shadow-2xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700",children:"Record Audio"}),e.jsx("button",{onClick:()=>{Et?eo():Ws(!1)},className:"text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full p-2 transition-colors",children:e.jsx(me,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-6",children:[e.jsx("div",{className:`w-24 h-24 rounded-full flex items-center justify-center mb-4 ${Et?"bg-rose-100 animate-pulse":"bg-gray-100"}`,children:e.jsxs("svg",{className:`w-10 h-10 ${Et?"text-rose-600":"text-gray-600"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 1a3 3 0 00-3 3v8a3 3 0 106 0V4a3 3 0 00-3-3z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 10v2a7 7 0 11-14 0v-2"})]})}),e.jsx("div",{className:"text-sm text-gray-600 mb-4",children:Et?Gs?`${Math.floor(js/6e4).toString().padStart(2,"0")}:${Math.floor(js%6e4/1e3).toString().padStart(2,"0")} (Paused)`:`${Math.floor(js/6e4).toString().padStart(2,"0")}:${Math.floor(js%6e4/1e3).toString().padStart(2,"0")}`:"Ready"}),e.jsx("div",{className:"flex items-center gap-3",children:Et?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:na,className:"px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700",children:"Stop & Preview"}),Gs?e.jsx("button",{onClick:da,className:"px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700",children:"Resume"}):e.jsx("button",{onClick:la,className:"px-4 py-2 rounded-lg bg-yellow-600 text-white hover:bg-yellow-700",children:"Pause"}),e.jsx("button",{onClick:eo,className:"px-4 py-2 rounded-lg border",children:"Cancel"})]}):e.jsx("button",{onClick:ia,className:"px-4 py-2 rounded-lg bg-rose-600 text-white hover:bg-rose-700",children:"Start"})}),e.jsx("div",{className:"text-xs text-gray-500",children:"Your mic input stays on device until you choose to send."})]})]})})]})]})}export{oi as default};
