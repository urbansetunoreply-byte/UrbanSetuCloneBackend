import{r as l,y as x,j as e,ak as k,aX as h,aG as Je,X as ne,Z as C,cb as re,aT as ns,R as Z,by as z,cc as Ze,c3 as rs,u as ls,cd as ae,a3 as He,bf as J,l as ds}from"./index-DFkuEFH9.js";const cs=()=>{var oe,me,xe,ue,pe,he,fe,ge,ye,je,Ne,be,ve,we,Re,Ae,Se,Ie,Ce,De,Pe,Le,$e,ke,Te,Ue,Fe,Be,qe,Ge,Ee,Me,Oe,_e;const[w,R]=l.useState([]),[p,H]=l.useState([]),[D,P]=l.useState(!0),[f,E]=l.useState(null),[M,L]=l.useState(!1),[g,A]=l.useState({refundAmount:"",reason:"",type:"full"}),[T,N]=l.useState(!1),[y,t]=l.useState({status:"",search:""}),[d,c]=l.useState({search:"",status:"",type:"",currency:"",dateFrom:"",dateTo:""}),[o,b]=l.useState(null),[u,v]=l.useState("payments"),[n,m]=l.useState(null),[$,S]=l.useState(!1),[U,F]=l.useState(""),[I,V]=l.useState(""),[is,os]=l.useState(!1),[X,le]=l.useState(!1),[Q,de]=l.useState(!1),[Ve,K]=l.useState(!1),[r,ce]=l.useState(null),[Xe,O]=l.useState(!1),[W,Y]=l.useState("");l.useEffect(()=>($?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),()=>{document.body.classList.remove("modal-open")}),[$]),l.useEffect(()=>{o&&clearTimeout(o);const s=setTimeout(()=>{B(!1)},300);return b(s),()=>{s&&clearTimeout(s)}},[y.search]),l.useEffect(()=>{B(!0)},[y.status]),l.useEffect(()=>{o&&clearTimeout(o);const s=setTimeout(()=>{q(!1)},300);return b(s),()=>{s&&clearTimeout(s)}},[d.search]),l.useEffect(()=>{q(!0)},[d.status,d.type,d.currency,d.dateFrom,d.dateTo]),l.useEffect(()=>{B(!0),q(!0)},[]);const B=async(s=!0)=>{try{s&&P(!0);const a=new URLSearchParams;y.status&&a.set("status",y.status),y.search&&a.set("q",y.search);const i=await fetch(`https://urbansetu.onrender.com/api/payments/history?${a}`,{credentials:"include"}),j=await i.json();i.ok?R(j.payments||[]):(x.error(j.message||"Failed to fetch payments"),R([]))}catch(a){console.error("Error fetching payments:",a),x.error("An error occurred while fetching payments"),R([])}finally{s&&P(!1)}},q=async(s=!0)=>{try{s&&P(!0);const a=new URLSearchParams;Object.entries(d).forEach(([_,G])=>{G&&a.append(_,G)});const i=await fetch(`https://urbansetu.onrender.com/api/payments/refund-requests?${a}`,{credentials:"include"}),j=await i.json();i.ok?H(j.refundRequests):x.error(j.message||"Failed to fetch refund requests")}catch(a){console.error("Error fetching refund requests:",a),x.error("An error occurred while fetching refund requests")}finally{s&&P(!1)}},Qe=s=>{E(s),A({refundAmount:s.amount,reason:"",type:"full"}),L(!0)},Ke=async s=>{if(s.preventDefault(),!!f)try{N(!0);const a=await fetch("https://urbansetu.onrender.com/api/payments/refund",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({paymentId:f.paymentId,refundAmount:parseFloat(g.refundAmount),reason:g.reason})}),i=await a.json();a.ok?(x.success("Refund processed successfully"),L(!1),B(!1)):x.error(i.message||"Failed to process refund")}catch(a){console.error("Error processing refund:",a),x.error("An error occurred while processing refund")}finally{N(!1)}},We=s=>{m(s),F(""),V(s.requestedAmount.toString()),S(!0)},ie=async s=>{var a;if(n){if(s==="approved"&&I){const i=((a=n.paymentId)==null?void 0:a.amount)||n.requestedAmount;if(parseFloat(I)<0||parseFloat(I)>i){x.error("Invalid refund amount. Must be between 0 and the maximum payment amount.");return}}try{s==="approved"?le(!0):s==="rejected"&&de(!0);const i=await fetch(`https://urbansetu.onrender.com/api/payments/refund-request/${n._id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:s,adminNotes:U,adminRefundAmount:s==="approved"?parseFloat(I):void 0})}),j=await i.json();i.ok?(x.success(`Refund request ${s} successfully`),S(!1),F(""),V(""),q(!1),B(!1)):x.error(j.message||`Failed to ${s} refund request`)}catch(i){console.error(`Error ${s}ing refund request:`,i),x.error(`An error occurred while ${s}ing refund request`)}finally{le(!1),de(!1)}}},Ye=async s=>{ce(s),Y(""),O(!0)},es=async()=>{if(!r||!W.trim()){x.error("Please provide a reason for reopening the case");return}try{const s=await fetch(`https://urbansetu.onrender.com/api/payments/refund-request/${r._id}/reopen`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reason:W})}),a=await s.json();s.ok?(x.success("Case reopened successfully"),O(!1),Y(""),q(!1)):x.error(a.message||"Failed to reopen case")}catch(s){console.error("Error reopening case:",s),x.error("An error occurred while reopening case")}},ee=s=>{ce(s),K(!0)},ss=s=>s.status==="completed"&&s.refundAmount===0,ts=s=>s.refundAmount===0?"No Refund":s.refundAmount===s.amount?"Fully Refunded":"Partially Refunded",as=s=>s.refundAmount===0?"text-gray-600 bg-gray-100":s.refundAmount===s.amount?"text-red-600 bg-red-100":"text-yellow-600 bg-yellow-100",se=s=>{switch(s){case"pending":return"text-yellow-600 bg-yellow-100";case"approved":return"text-green-600 bg-green-100";case"rejected":return"text-red-600 bg-red-100";case"processed":return"text-blue-600 bg-blue-100";default:return"text-gray-600 bg-gray-100"}},te=s=>{switch(s){case"pending":return"Pending";case"approved":return"Approved";case"rejected":return"Rejected";case"processed":return"Processed";default:return s}};return D?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(k,{className:"animate-spin text-2xl text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading payments..."})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(h,{className:"text-red-600"}),"Refund Management"]})}),e.jsxs("div",{className:"flex space-x-1 mb-6 bg-gray-100 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>v("payments"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${u==="payments"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Direct Refunds"}),e.jsx("button",{onClick:()=>v("requests"),className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${u==="requests"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Refund Requests"})]}),u==="payments"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Je,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by property name or payment ID...",value:y.search,onChange:s=>t(a=>({...a,search:s.target.value})),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),e.jsxs("select",{value:y.status,onChange:s=>t(a=>({...a,status:s.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"completed",children:"Completed Payments"}),e.jsx("option",{value:"refunded",children:"Refunded Payments"}),e.jsx("option",{value:"partially_refunded",children:"Partially Refunded"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Property"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Payment ID"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Amount"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Refund Status"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:w.map(s=>{var a,i;return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:((a=s.appointmentId)==null?void 0:a.propertyName)||"N/A"}),e.jsx("div",{className:"text-sm text-gray-600",children:((i=s.listingId)==null?void 0:i.name)||"N/A"})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"font-mono text-sm text-gray-600",children:s.paymentId})}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsxs("div",{className:"font-semibold text-gray-800",children:["$",s.amount.toLocaleString()]}),s.refundAmount>0&&e.jsxs("div",{className:"text-sm text-red-600",children:["Refunded: $",s.refundAmount.toLocaleString()]})]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-sm text-gray-600",children:new Date(s.createdAt).toLocaleDateString("en-GB")})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${as(s)}`,children:ts(s)})}),e.jsx("td",{className:"py-3 px-4",children:ss(s)?e.jsxs("button",{onClick:()=>Qe(s),className:"px-3 py-1 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors flex items-center gap-1",children:[e.jsx(h,{className:"text-xs"}),"Refund"]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"N/A"})})]},s._id)})})]})}),w.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ne,{className:"text-6xl text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No Payments Found"}),e.jsx("p",{className:"text-gray-500",children:"No completed payments available for refund."})]}),M&&f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(h,{className:"text-red-600"}),"Process Refund"]}),e.jsx("button",{onClick:()=>L(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(C,{className:"text-xl"})})]})}),e.jsxs("form",{onSubmit:Ke,className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Details"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Property:"}),e.jsx("span",{className:"font-medium",children:(oe=f.appointmentId)==null?void 0:oe.propertyName})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Amount:"}),e.jsxs("span",{className:"font-medium",children:["$",f.amount.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Payment ID:"}),e.jsx("span",{className:"font-mono text-sm",children:f.paymentId})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Refund Type"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"type",value:"full",checked:g.type==="full",onChange:s=>{A(a=>({...a,type:s.target.value,refundAmount:s.target.value==="full"?f.amount:a.refundAmount}))},className:"mr-2"}),"Full Refund ($",f.amount.toLocaleString(),")"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"type",value:"partial",checked:g.type==="partial",onChange:s=>A(a=>({...a,type:s.target.value})),className:"mr-2"}),"Partial Refund"]})]})]}),g.type==="partial"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Refund Amount"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"number",value:g.refundAmount,onChange:s=>A(a=>({...a,refundAmount:s.target.value})),max:f.amount,min:"1",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Refund Reason"}),e.jsx("textarea",{value:g.reason,onChange:s=>A(a=>({...a,reason:s.target.value})),placeholder:"Enter reason for refund...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>L(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:T,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:T?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{}),"Process Refund"]})})]})]})]})})]}),u==="requests"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ns,{className:"text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Filter Refund Requests"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Je,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by property, user, reason, or email...",value:d.search,onChange:s=>c(a=>({...a,search:s.target.value})),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("select",{value:d.status,onChange:s=>c(a=>({...a,status:s.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"processed",children:"Processed"})]}),e.jsxs("select",{value:d.type,onChange:s=>c(a=>({...a,type:s.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"full",children:"Full Refund"}),e.jsx("option",{value:"partial",children:"Partial Refund"})]}),e.jsxs("select",{value:d.currency,onChange:s=>c(a=>({...a,currency:s.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Currencies"}),e.jsx("option",{value:"USD",children:"USD ($)"}),e.jsx("option",{value:"INR",children:"INR (₹)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:d.dateFrom,onChange:s=>c(a=>({...a,dateFrom:s.target.value})),max:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:d.dateTo,onChange:s=>c(a=>({...a,dateTo:s.target.value})),max:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:()=>c({search:"",status:"",type:"",currency:"",dateFrom:"",dateTo:""}),className:"w-full px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors flex items-center justify-center gap-2",children:[e.jsx(C,{className:"text-sm"}),"Clear Filters"]})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Property"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"User"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Amount"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Reason"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:p&&p.map(s=>{var a,i,j,_,G,ze;return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:((a=s.appointmentId)==null?void 0:a.propertyName)||"N/A"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Payment ID: ",((i=s.paymentId)==null?void 0:i.paymentId)||s.paymentId]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-800",children:((j=s.userId)==null?void 0:j.name)||"N/A"}),e.jsx("div",{className:"text-sm text-gray-600",children:((_=s.userId)==null?void 0:_.email)||"N/A"})]})}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsxs("div",{className:"font-semibold text-gray-800",children:[((G=s.paymentId)==null?void 0:G.currency)==="INR"?"₹":"$",s.requestedAmount.toLocaleString()]}),e.jsx("div",{className:"text-sm text-gray-600",children:s.type==="full"?"Full Refund":"Partial Refund"})]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"text-sm text-gray-600 max-w-xs truncate",children:s.reason})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${se(s.status)}`,children:te(s.status)})}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:new Date(s.createdAt).toLocaleDateString("en-GB")}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(s.createdAt).toLocaleTimeString("en-GB")})]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"flex items-center gap-2",children:s.status==="pending"?e.jsxs("button",{onClick:()=>We(s),className:"px-3 py-1 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition-colors flex items-center gap-1",children:[e.jsx(Z,{className:"text-xs"}),"Review"]}):s.status==="rejected"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>ee(s),className:"px-3 py-1 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-1",children:[e.jsx(z,{className:"text-xs"}),"Info"]}),e.jsxs("button",{onClick:()=>Ye(s),className:"px-3 py-1 bg-green-100 text-green-600 rounded-lg hover:bg-green-200 transition-colors flex items-center gap-1",children:[e.jsx(h,{className:"text-xs"}),"Reopen Case"]})]}):s.status==="approved"?e.jsxs("button",{onClick:()=>ee(s),className:"px-3 py-1 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-1",children:[e.jsx(z,{className:"text-xs"}),"Info"]}):s.status==="processed"?e.jsxs("button",{onClick:()=>ee(s),className:"px-3 py-1 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-1",children:[e.jsx(z,{className:"text-xs"}),"Info"]}):e.jsx("span",{className:"text-gray-400 text-sm",children:((ze=s.processedBy)==null?void 0:ze.name)||"N/A"})})})]},s._id)})})]})}),p.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ne,{className:"text-6xl text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No Refund Requests"}),e.jsx("p",{className:"text-gray-500",children:"No refund requests found."})]})]}),$&&n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(Z,{className:"text-blue-600"}),"Review Refund Request"]}),e.jsx("button",{onClick:()=>S(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(C,{className:"text-xl"})})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Request Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Property:"}),e.jsx("span",{className:"font-medium",children:(me=n.appointmentId)==null?void 0:me.propertyName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"User:"}),e.jsx("span",{className:"font-medium",children:((xe=n.userId)==null?void 0:xe.name)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Requested Amount:"}),e.jsxs("span",{className:"font-medium",children:[((ue=n.paymentId)==null?void 0:ue.currency)==="INR"?"₹":"$",n.requestedAmount.toLocaleString()]})]}),n.adminRefundAmount&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Admin Override Amount:"}),e.jsxs("span",{className:"font-medium text-blue-600",children:[((pe=n.paymentId)==null?void 0:pe.currency)==="INR"?"₹":"$",n.adminRefundAmount.toLocaleString()]})]}),((he=n.paymentId)==null?void 0:he.refundAmount)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Actual Refunded Amount:"}),e.jsxs("span",{className:"font-medium text-green-600",children:[((fe=n.paymentId)==null?void 0:fe.currency)==="INR"?"₹":"$",n.paymentId.refundAmount.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Type:"}),e.jsxs("span",{className:"font-medium capitalize",children:[n.type," Refund"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Requested Date:"}),e.jsx("span",{className:"font-medium",children:new Date(n.createdAt).toLocaleDateString("en-GB")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Requested Time:"}),e.jsx("span",{className:"font-medium",children:new Date(n.createdAt).toLocaleTimeString("en-GB")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${se(n.status)}`,children:te(n.status)})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Payment Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment ID:"}),e.jsx("span",{className:"font-mono text-sm",children:((ge=n.paymentId)==null?void 0:ge.paymentId)||n.paymentId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Original Amount:"}),e.jsxs("span",{className:"font-medium",children:[((ye=n.paymentId)==null?void 0:ye.currency)==="INR"?"₹":"$",(Ne=(je=n.paymentId)==null?void 0:je.amount)==null?void 0:Ne.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Gateway:"}),e.jsx("span",{className:"font-medium capitalize",children:(be=n.paymentId)==null?void 0:be.gateway})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Appointment Status:"}),e.jsx("span",{className:"font-medium capitalize",children:(we=(ve=n.appointmentId)==null?void 0:ve.status)==null?void 0:we.replace(/([A-Z])/g," $1").trim()})]})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Refund Reason"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsx("p",{className:"text-gray-700",children:n.reason})})]}),n.isAppealed&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 mb-2 flex items-center gap-2",children:[e.jsx(h,{className:"text-purple-600"}),"Appeal Information"]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3 border border-purple-200",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Appeal Reason:"}),e.jsx("p",{className:"text-gray-700",children:n.appealReason})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Appeal Details:"}),e.jsx("p",{className:"text-gray-700",children:n.appealText})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Submitted: ",new Date(n.appealSubmittedAt).toLocaleString("en-GB")]})]})]}),n.caseReopened&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 mb-2 flex items-center gap-2",children:[e.jsx(Ze,{className:"text-green-600"}),"Case Reopened"]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 border border-green-200",children:[e.jsx("p",{className:"text-gray-700",children:"This case has been reopened for review."}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Reopened: ",new Date(n.caseReopenedAt).toLocaleString("en-GB")]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Admin Notes"}),e.jsx("textarea",{value:U,onChange:s=>F(s.target.value),placeholder:"Add notes about this refund request...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"3"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Refund Amount (Admin Override)"}),e.jsxs("div",{className:"relative",children:[((Re=n.paymentId)==null?void 0:Re.currency)==="INR"?e.jsx(rs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}):e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"number",value:I,onChange:s=>V(s.target.value),min:"0",max:((Ae=n.paymentId)==null?void 0:Ae.amount)||n.requestedAmount,step:"0.01",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter refund amount"})]}),e.jsxs("div",{className:"mt-1 text-sm text-gray-600",children:[e.jsxs("div",{children:["Requested: ",((Se=n.paymentId)==null?void 0:Se.currency)==="INR"?"₹":"$",n.requestedAmount.toLocaleString()]}),e.jsxs("div",{children:["Maximum: ",((Ie=n.paymentId)==null?void 0:Ie.currency)==="INR"?"₹":"$",(((Ce=n.paymentId)==null?void 0:Ce.amount)||n.requestedAmount).toLocaleString()]})]})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>S(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:()=>ie("rejected"),disabled:X||Q,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[Q?e.jsx(k,{className:"animate-spin"}):e.jsx(C,{}),"Reject"]}),e.jsxs("button",{onClick:()=>ie("approved"),disabled:X||Q,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[X?e.jsx(k,{className:"animate-spin"}):e.jsx(Z,{}),"Approve"]})]})})]})}),Ve&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(z,{className:"text-blue-600"}),"Refund Request Details"]}),e.jsx("button",{onClick:()=>K(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(C,{className:"text-xl"})})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Request Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Property:"}),e.jsx("span",{className:"font-medium",children:(De=r.appointmentId)==null?void 0:De.propertyName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"User:"}),e.jsx("span",{className:"font-medium",children:((Pe=r.userId)==null?void 0:Pe.name)||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Requested Amount:"}),e.jsxs("span",{className:"font-medium",children:[((Le=r.paymentId)==null?void 0:Le.currency)==="INR"?"₹":"$",r.requestedAmount.toLocaleString()]})]}),r.adminRefundAmount&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Admin Override Amount:"}),e.jsxs("span",{className:"font-medium text-blue-600",children:[(($e=r.paymentId)==null?void 0:$e.currency)==="INR"?"₹":"$",r.adminRefundAmount.toLocaleString()]})]}),((ke=r.paymentId)==null?void 0:ke.refundAmount)>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Actual Refunded Amount:"}),e.jsxs("span",{className:"font-medium text-green-600",children:[((Te=r.paymentId)==null?void 0:Te.currency)==="INR"?"₹":"$",r.paymentId.refundAmount.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Type:"}),e.jsxs("span",{className:"font-medium capitalize",children:[r.type," Refund"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${se(r.status)}`,children:te(r.status)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Requested Date:"}),e.jsx("span",{className:"font-medium",children:new Date(r.createdAt).toLocaleDateString("en-GB")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Requested Time:"}),e.jsx("span",{className:"font-medium",children:new Date(r.createdAt).toLocaleTimeString("en-GB")})]}),r.processedAt&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Processed Date:"}),e.jsx("span",{className:"font-medium",children:new Date(r.processedAt).toLocaleDateString("en-GB")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Processed Time:"}),e.jsx("span",{className:"font-medium",children:new Date(r.processedAt).toLocaleTimeString("en-GB")})]})]}),r.processedBy&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Processed By:"}),e.jsx("span",{className:"font-medium",children:r.processedBy.name||"N/A"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Payment Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment ID:"}),e.jsx("span",{className:"font-mono text-sm",children:((Ue=r.paymentId)==null?void 0:Ue.paymentId)||r.paymentId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Original Amount:"}),e.jsxs("span",{className:"font-medium",children:[((Fe=r.paymentId)==null?void 0:Fe.currency)==="INR"?"₹":"$",(qe=(Be=r.paymentId)==null?void 0:Be.amount)==null?void 0:qe.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Gateway:"}),e.jsx("span",{className:"font-medium capitalize",children:(Ge=r.paymentId)==null?void 0:Ge.gateway})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Appointment Status:"}),e.jsx("span",{className:"font-medium capitalize",children:(Me=(Ee=r.appointmentId)==null?void 0:Ee.status)==null?void 0:Me.replace(/([A-Z])/g," $1").trim()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment Created:"}),e.jsx("span",{className:"font-medium",children:(Oe=r.paymentId)!=null&&Oe.createdAt?new Date(r.paymentId.createdAt).toLocaleDateString("en-GB"):"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment Completed:"}),e.jsx("span",{className:"font-medium",children:(_e=r.paymentId)!=null&&_e.completedAt?new Date(r.paymentId.completedAt).toLocaleDateString("en-GB"):"N/A"})]})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Refund Reason"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsx("p",{className:"text-gray-700",children:r.reason})})]}),r.adminNotes&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Admin Notes"}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-3",children:e.jsx("p",{className:"text-gray-700",children:r.adminNotes})})]}),r.isAppealed&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 mb-2 flex items-center gap-2",children:[e.jsx(h,{className:"text-purple-600"}),"Appeal Information"]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3 border border-purple-200",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Appeal Reason:"}),e.jsx("p",{className:"text-gray-700",children:r.appealReason})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Appeal Details:"}),e.jsx("p",{className:"text-gray-700",children:r.appealText})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Submitted: ",new Date(r.appealSubmittedAt).toLocaleString("en-GB")]})]})]}),r.caseReopened&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 mb-2 flex items-center gap-2",children:[e.jsx(Ze,{className:"text-green-600"}),"Case Reopened"]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 border border-green-200",children:[e.jsx("p",{className:"text-gray-700",children:"This case has been reopened for review."}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Reopened: ",new Date(r.caseReopenedAt).toLocaleString("en-GB")]})]})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-200 flex-shrink-0",children:e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>K(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Close"})})})]})}),Xe&&r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(h,{className:"text-green-600"}),"Reopen Case"]}),e.jsx("button",{onClick:()=>O(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(C,{className:"text-xl"})})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-gray-700 mb-4",children:"Are you sure you want to reopen this case? Please provide a reason for reopening."}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Reopening"}),e.jsx("textarea",{value:W,onChange:s=>Y(s.target.value),placeholder:"Enter reason for reopening this case...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",rows:"3",required:!0})]})]})}),e.jsx("div",{className:"p-6 border-t border-gray-200",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>O(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:es,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(h,{}),"Reopen Case"]})]})})]})})]})},xs=()=>{ls("Payment Dashboard - Financial Management");const[w,R]=l.useState("overview"),[p,H]=l.useState({totalPayments:0,totalAmount:0,totalAmountUsd:0,totalAmountInr:0,totalRefunds:0,totalRefundsUsd:0,totalRefundsInr:0,completedPayments:0,pendingPayments:0,failedPayments:0}),[D,P]=l.useState([]),[f,E]=l.useState(!0),[M,L]=l.useState([]),[g,A]=l.useState([]);l.useEffect(()=>{T(),N()},[]);const T=async()=>{try{E(!0);const t=await fetch("https://urbansetu.onrender.com/api/payments/stats/overview",{credentials:"include"}),d=await t.json();t.ok&&(H(d.overview),P(d.monthlyStats))}catch(t){console.error("Error fetching payment stats:",t)}finally{E(!1)}},N=async()=>{try{const t=document.getElementById("admin-pay-status"),d=document.getElementById("admin-pay-gateway"),c=document.getElementById("admin-pay-q"),o=document.getElementById("admin-pay-from"),b=document.getElementById("admin-pay-to"),u=t?t.value:"",v=d?d.value:"",n=c?c.value:"",m=o?o.value:"",$=b?b.value:"",[S,U]=await Promise.all([fetch(`https://urbansetu.onrender.com/api/payments/admin/list?currency=USD&limit=50&status=${encodeURIComponent(u)}&gateway=${encodeURIComponent(v)}&q=${encodeURIComponent(n)}&fromDate=${encodeURIComponent(m)}&toDate=${encodeURIComponent($)}`,{credentials:"include"}),fetch(`https://urbansetu.onrender.com/api/payments/admin/list?currency=INR&limit=50&status=${encodeURIComponent(u)}&gateway=${encodeURIComponent(v)}&q=${encodeURIComponent(n)}&fromDate=${encodeURIComponent(m)}&toDate=${encodeURIComponent($)}`,{credentials:"include"})]),F=await S.json(),I=await U.json();S.ok&&L(F.payments||[]),U.ok&&A(I.payments||[])}catch{}},y=[{id:"overview",label:"Overview",icon:He},{id:"history",label:"Payment History",icon:J},{id:"refunds",label:"Refund Management",icon:h}];return f?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(k,{className:"animate-spin text-4xl text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading payment dashboard..."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-100 py-6 sm:py-10 px-2 md:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-6 sm:mb-8",children:e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800 flex items-center gap-3",children:[e.jsx(ae,{className:"text-green-600"}),"Payment Dashboard"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage payments, refunds, and financial analytics"})]}),e.jsxs("button",{onClick:T,className:"bg-blue-600 text-white px-3 sm:px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",title:"Refresh stats",children:[e.jsx(k,{className:"animate-spin"}),"Refresh"]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg mb-6 sm:mb-8",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex overflow-x-auto no-scrollbar px-2 sm:px-6 gap-4 sm:gap-8",children:y.map(t=>{const d=t.icon;return e.jsxs("button",{onClick:()=>R(t.id),className:`shrink-0 py-3 sm:py-4 px-1 border-b-2 font-medium text-xs sm:text-sm flex items-center gap-2 ${w===t.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(d,{}),t.label]},t.id)})})})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-4 sm:p-6",children:[w==="overview"&&e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-6 mb-8",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100 text-sm font-medium",children:"Total Revenue (USD)"}),e.jsxs("p",{className:"text-3xl font-bold",children:["$",p.totalAmountUsd.toLocaleString()]})]}),e.jsx(re,{className:"text-4xl text-green-200"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-emerald-600 text-white rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-emerald-100 text-sm font-medium",children:"Total Revenue (INR)"}),e.jsxs("p",{className:"text-3xl font-bold",children:["₹",p.totalAmountInr.toLocaleString("en-IN")]})]}),e.jsx(J,{className:"text-4xl text-emerald-200"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm font-medium",children:"Total Payments"}),e.jsx("p",{className:"text-3xl font-bold",children:p.totalPayments})]}),e.jsx(J,{className:"text-4xl text-blue-200"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100 text-sm font-medium",children:"Completed Payments"}),e.jsx("p",{className:"text-3xl font-bold",children:p.completedPayments})]}),e.jsx(Z,{className:"text-4xl text-purple-200"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-yellow-500 to-yellow-600 text-white rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-100 text-sm font-medium",children:"Pending Payments"}),e.jsx("p",{className:"text-3xl font-bold",children:p.pendingPayments})]}),e.jsx(ne,{className:"text-4xl text-yellow-200"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-red-100 text-sm font-medium",children:"Failed Payments"}),e.jsx("p",{className:"text-3xl font-bold",children:p.failedPayments})]}),e.jsx(C,{className:"text-4xl text-red-200"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-100 text-sm font-medium",children:"Total Refunds"}),e.jsxs("p",{className:"text-lg font-bold",children:["$ ",p.totalRefundsUsd.toLocaleString()," • ₹ ",p.totalRefundsInr.toLocaleString("en-IN")]})]}),e.jsx(h,{className:"text-4xl text-orange-200"})]})})]}),D.length>0&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(He,{className:"text-blue-600"}),"Monthly Payment Trends (USD & INR)"]}),e.jsx("div",{className:"space-y-4",children:D.map((t,d)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-20 text-sm text-gray-600",children:new Date(t._id.year,t._id.month-1).toLocaleDateString("en-US",{month:"short",year:"numeric"})}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-4 relative",children:e.jsxs("div",{className:"absolute inset-y-0 left-0 flex w-full gap-1 px-1",children:[e.jsx("div",{className:"h-4 rounded-l-full bg-blue-500 transition-all duration-500",style:{width:`${Math.min(100,t.amountUsd/Math.max(1,...D.map(c=>c.amountUsd||0))*100)}%`},title:`USD: $${(t.amountUsd||0).toLocaleString()}`}),e.jsx("div",{className:"h-4 rounded-r-full bg-emerald-500 transition-all duration-500",style:{width:`${Math.min(100,t.amountInr/Math.max(1,...D.map(c=>c.amountInr||0))*100)}%`},title:`INR: ₹${(t.amountInr||0).toLocaleString("en-IN")}`})]})})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-gray-800",children:["$ ",(t.amountUsd||0).toLocaleString()," • ₹ ",(t.amountInr||0).toLocaleString("en-IN")]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[t.count," payments"]})]})]},d))})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("button",{onClick:()=>R("history"),className:"bg-blue-100 text-blue-800 p-3 sm:p-4 rounded-lg hover:bg-blue-200 transition-colors flex items-center gap-2 sm:gap-3",children:[e.jsx(J,{className:"text-lg sm:text-xl"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold text-sm sm:text-base",children:"View Payment History"}),e.jsx("div",{className:"text-xs sm:text-sm",children:"Browse all payments"})]})]}),e.jsxs("button",{onClick:()=>R("refunds"),className:"bg-red-100 text-red-800 p-3 sm:p-4 rounded-lg hover:bg-red-200 transition-colors flex items-center gap-2 sm:gap-3",children:[e.jsx(h,{className:"text-lg sm:text-xl"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold text-sm sm:text-base",children:"Manage Refunds"}),e.jsx("div",{className:"text-xs sm:text-sm",children:"Process refunds"})]})]}),e.jsxs("button",{onClick:async()=>{try{const t=await fetch("https://urbansetu.onrender.com/api/payments/admin/export",{credentials:"include"});if(!t.ok)return;const d=await t.blob(),c=window.URL.createObjectURL(d),o=document.createElement("a");o.href=c,o.download="payments_export.csv",document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(c)}catch{}},className:"bg-green-100 text-green-800 p-3 sm:p-4 rounded-lg hover:bg-green-200 transition-colors flex items-center gap-2 sm:gap-3",title:"Export CSV of payments",children:[e.jsx(ds,{className:"text-lg sm:text-xl"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold text-sm sm:text-base",children:"Export Reports"}),e.jsx("div",{className:"text-xs sm:text-sm",children:"Download financial reports"})]})]})]})]})]}),w==="history"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[e.jsx("input",{id:"admin-pay-q",placeholder:"Search payment ID, receipt, user",className:"px-3 py-2 border rounded-lg text-sm",onChange:async()=>{await N()}}),e.jsx("label",{className:"text-sm text-gray-600",children:"From:"}),e.jsx("input",{id:"admin-pay-from",type:"date",max:new Date().toISOString().split("T")[0],className:"px-3 py-2 border rounded-lg text-sm",onChange:async()=>{await N()}}),e.jsx("label",{className:"text-sm text-gray-600",children:"To:"}),e.jsx("input",{id:"admin-pay-to",type:"date",max:new Date().toISOString().split("T")[0],className:"px-3 py-2 border rounded-lg text-sm",onChange:async()=>{await N()}}),e.jsxs("select",{id:"admin-pay-status",onChange:async()=>{await N()},className:"px-3 py-2 border rounded-lg text-sm",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"failed",children:"Failed"}),e.jsx("option",{value:"refunded",children:"Refunded"}),e.jsx("option",{value:"partially_refunded",children:"Partially Refunded"})]}),e.jsxs("select",{id:"admin-pay-gateway",onChange:async()=>{await N()},className:"px-3 py-2 border rounded-lg text-sm",children:[e.jsx("option",{value:"",children:"All Gateways"}),e.jsx("option",{value:"paypal",children:"PayPal"}),e.jsx("option",{value:"razorpay",children:"Razorpay"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-3",children:"USD Payments ($)"}),M.length===0?e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(ae,{className:"text-4xl text-gray-300 mx-auto mb-2"}),e.jsx("div",{children:"No USD payments found."})]}):e.jsx("div",{className:"space-y-3",children:M.map(t=>{var d,c,o;return e.jsxs("div",{className:`border rounded-lg p-4 ${t.status==="completed"?"border-green-200 bg-green-50":t.status==="failed"?"border-red-200 bg-red-50":t.status==="refunded"||t.status==="partially_refunded"?"border-blue-200 bg-blue-50":"border-yellow-200 bg-yellow-50"}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:((d=t.appointmentId)==null?void 0:d.propertyName)||"Property Payment"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Buyer: ",((c=t.userId)==null?void 0:c.username)||"N/A"]})]}),e.jsxs("div",{className:"flex flex-col sm:items-end gap-2",children:[e.jsxs("div",{className:"text-lg font-bold",children:["$ ",Number(t.amount).toFixed(2)]}),t.refundAmount>0&&e.jsxs("div",{className:"text-sm text-red-600 font-semibold",children:["Refunded: $ ",Number(t.refundAmount).toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 space-y-1",children:t.completedAt?e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:["Paid: ",new Date(t.completedAt).toLocaleDateString("en-GB")]}),e.jsx("div",{className:"text-gray-400",children:new Date(t.completedAt).toLocaleTimeString("en-GB")}),e.jsxs("div",{className:"text-gray-300 mt-1",children:["Created: ",new Date(t.createdAt).toLocaleDateString("en-GB")]}),e.jsx("div",{className:"text-gray-300",children:new Date(t.createdAt).toLocaleTimeString("en-GB")}),t.refundedAt&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-red-400 mt-1",children:["Refunded: ",new Date(t.refundedAt).toLocaleDateString("en-GB")]}),e.jsx("div",{className:"text-red-300",children:new Date(t.refundedAt).toLocaleTimeString("en-GB")})]})]}):e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:["Created: ",new Date(t.createdAt).toLocaleDateString("en-GB")]}),e.jsx("div",{className:"text-gray-400",children:new Date(t.createdAt).toLocaleTimeString("en-GB")})]})})]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`px-2 py-1 text-[10px] rounded-full font-semibold ${t.status==="completed"?"bg-green-100 text-green-700":t.status==="failed"?"bg-red-100 text-red-700":t.status==="refunded"||t.status==="partially_refunded"?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"}`,children:t.status})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Payment ID: ",e.jsx("span",{className:"font-mono",children:t.paymentId})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-600",children:["Gateway: ",(o=t.gateway)==null?void 0:o.toUpperCase()]}),t.receiptUrl&&e.jsx("div",{className:"mt-2 text-xs",children:e.jsx("button",{onClick:async()=>{try{const b=t.receiptUrl.includes("?")?`${t.receiptUrl}&admin=true`:`${t.receiptUrl}?admin=true`,u=await fetch(b,{credentials:"include"});if(!u.ok)return;const v=await u.blob(),n=window.URL.createObjectURL(v),m=document.createElement("a");m.href=n,m.download="receipt.pdf",document.body.appendChild(m),m.click(),m.remove(),window.URL.revokeObjectURL(n)}catch{}},className:"text-blue-600 underline",children:"Receipt"})})]},t._id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-3",children:"INR Payments (₹)"}),g.length===0?e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx(ae,{className:"text-4xl text-gray-300 mx-auto mb-2"}),e.jsx("div",{children:"No INR payments found."})]}):e.jsx("div",{className:"space-y-3",children:g.map(t=>{var d,c,o;return e.jsxs("div",{className:`border rounded-lg p-4 ${t.status==="completed"?"border-green-200 bg-green-50":t.status==="failed"?"border-red-200 bg-red-50":t.status==="refunded"||t.status==="partially_refunded"?"border-blue-200 bg-blue-50":"border-yellow-200 bg-yellow-50"}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:((d=t.appointmentId)==null?void 0:d.propertyName)||"Property Payment"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Buyer: ",((c=t.userId)==null?void 0:c.username)||"N/A"]})]}),e.jsxs("div",{className:"flex flex-col sm:items-end gap-2",children:[e.jsxs("div",{className:"text-lg font-bold",children:["₹ ",Number(t.amount).toFixed(2)]}),t.refundAmount>0&&e.jsxs("div",{className:"text-sm text-red-600 font-semibold",children:["Refunded: ₹ ",Number(t.refundAmount).toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500 space-y-1",children:t.completedAt?e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:["Paid: ",new Date(t.completedAt).toLocaleDateString("en-GB")]}),e.jsx("div",{className:"text-gray-400",children:new Date(t.completedAt).toLocaleTimeString("en-GB")}),e.jsxs("div",{className:"text-gray-300 mt-1",children:["Created: ",new Date(t.createdAt).toLocaleDateString("en-GB")]}),e.jsx("div",{className:"text-gray-300",children:new Date(t.createdAt).toLocaleTimeString("en-GB")}),t.refundedAt&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-red-400 mt-1",children:["Refunded: ",new Date(t.refundedAt).toLocaleDateString("en-GB")]}),e.jsx("div",{className:"text-red-300",children:new Date(t.refundedAt).toLocaleTimeString("en-GB")})]})]}):e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:["Created: ",new Date(t.createdAt).toLocaleDateString("en-GB")]}),e.jsx("div",{className:"text-gray-400",children:new Date(t.createdAt).toLocaleTimeString("en-GB")})]})})]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:`px-2 py-1 text-[10px] rounded-full font-semibold ${t.status==="completed"?"bg-green-100 text-green-700":t.status==="failed"?"bg-red-100 text-red-700":t.status==="refunded"||t.status==="partially_refunded"?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"}`,children:t.status})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Payment ID: ",e.jsx("span",{className:"font-mono",children:t.paymentId})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-600",children:["Gateway: ",(o=t.gateway)==null?void 0:o.toUpperCase()]}),t.receiptUrl&&e.jsx("div",{className:"mt-2 text-xs",children:e.jsx("button",{onClick:async()=>{try{const b=t.receiptUrl.includes("?")?`${t.receiptUrl}&admin=true`:`${t.receiptUrl}?admin=true`,u=await fetch(b,{credentials:"include"});if(!u.ok)return;const v=await u.blob(),n=window.URL.createObjectURL(v),m=document.createElement("a");m.href=n,m.download="receipt.pdf",document.body.appendChild(m),m.click(),m.remove(),window.URL.revokeObjectURL(n)}catch{}},className:"text-blue-600 underline",children:"Receipt"})})]},t._id)})})]})]}),w==="refunds"&&e.jsx(cs,{})]})]})})};export{xs as default};
