import{u as yt,k as wt,i as jt,r as n,j as e,T as Fe,ay as de,bV as me,b3 as Be,aL as ue,bW as He,aq as ze,H as c,bv as vt,Y as Nt,aZ as St,bX as kt,O as It,bY as Ct,y as Et,b5 as _t}from"./index-WPqAAPOK.js";import{f as At}from"./linkFormatter-C2S5a9jA.js";const Tt=({forceModalOpen:z=!1,onModalClose:he=null})=>{const{currentUser:m}=yt(t=>t.user);wt(),jt();const[u,L]=n.useState(z),[h,g]=n.useState([{role:"assistant",content:"Hello! I'm your AI assistant powered by Gemini. How can I help you with your real estate needs today?",timestamp:new Date().toISOString()}]),[v,_]=n.useState(""),[N,S]=n.useState(!1),[k,w]=n.useState(null),[$,xe]=n.useState(!1),D=n.useRef(null),U=n.useRef(null),[Ue,ge]=n.useState(!1),[Oe,pe]=n.useState(!1),fe=n.useRef(null),[Ge,Je]=n.useState(!1),[Ye,O]=n.useState(!1),j=n.useRef(null),[G,J]=n.useState(0),[be,Ke]=n.useState(!1),Y=n.useRef(""),[I,Ve]=n.useState(()=>localStorage.getItem("gemini_tone")||"neutral"),[K,p]=n.useState(!1),V=n.useRef(null),q=n.useRef(null),[qe,ye]=n.useState(!1),[C,we]=n.useState(()=>JSON.parse(localStorage.getItem("gemini_bookmarks")||"[]")),[Q,P]=n.useState(()=>JSON.parse(localStorage.getItem("gemini_ratings")||"{}")),[Rt,Mt]=n.useState(!1),[Qe,W]=n.useState(!1),[We,E]=n.useState(!1),[je,Xe]=n.useState([]),[Lt,$t]=n.useState(!1),[Dt,Pt]=n.useState(""),[Ze,X]=n.useState(!1),[Ft,Bt]=n.useState(null),[Ht,zt]=n.useState(!1),[ve,Ne]=n.useState(null),[Z,Se]=n.useState([]),[et,A]=n.useState(null),[f,ee]=n.useState(()=>{const t=localStorage.getItem("gemini_prompt_count");return t?parseInt(t):0}),[tt,T]=n.useState(!1),[st,te]=n.useState(!1),[at,se]=n.useState(!1),[ke,Ie]=n.useState(null),[rt,ae]=n.useState(!1),[nt,re]=n.useState(!1),[ot,ne]=n.useState(null),[Ce,Ee]=n.useState(""),[_e,lt]=n.useState(""),[it,oe]=n.useState(!1),R=n.useRef(null),ct=()=>{var t;(t=D.current)==null||t.scrollIntoView({behavior:"smooth"})},Ae=()=>{var t;(t=D.current)==null||t.scrollIntoView({behavior:"auto"})},le=(t,s)=>{const r=new Date(t),a=new Date(s);return r.getFullYear()===a.getFullYear()&&r.getMonth()===a.getMonth()&&r.getDate()===a.getDate()},Te=t=>{const s=new Date(t),r=new Date,a=new Date;return a.setDate(r.getDate()-1),le(s,r)?"Today":le(s,a)?"Yesterday":s.toLocaleDateString([],{year:"numeric",month:"short",day:"numeric"})},b=()=>{if(k)return k;const t=localStorage.getItem("gemini_session_id");if(t)return w(t),t;const s=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return localStorage.setItem("gemini_session_id",s),w(s),s},dt=async t=>{if(!(!m||!t))try{const r=await fetch(`https://urbansetu.onrender.com/api/chat-history/session/${t}`,{credentials:"include",headers:{"Content-Type":"application/json"}});if(r.ok){const a=await r.json();a.success&&a.data.messages&&a.data.messages.length>0&&(g(a.data.messages),console.log("Chat history loaded:",a.data.messages.length,"messages"))}else r.status===404?console.log("No chat history found for session"):console.error("Failed to load chat history:",r.status)}catch(s){console.error("Error loading chat history:",s)}finally{xe(!0)}},ie=()=>{g([{role:"assistant",content:"Hello! I'm your AI assistant powered by Gemini. How can I help you with your real estate needs today?",timestamp:new Date().toISOString()}]);const t=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;localStorage.setItem("gemini_session_id",t),w(t),P({}),localStorage.setItem("gemini_ratings",JSON.stringify({}))},mt=async()=>{try{if(!m){ie(),c.success("Chat cleared");return}const t="https://urbansetu.onrender.com",s=b(),r=await fetch(`${t}/api/chat-history/session/${s}/clear`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(r.ok)c.success("Chat cleared"),ie();else{const a=await r.json();c.error(a.message||"Failed to clear chat")}}catch(t){console.error("Error clearing chat history:",t),c.error("Failed to clear chat history")}};n.useEffect(()=>{ct()},[h]),n.useEffect(()=>{const t=b();m&&t&&!$?(dt(t),Le(t)):m||xe(!0);const s=`gemini_draft_${t}`,r=localStorage.getItem(s);r&&_(r)},[m,$]),n.useEffect(()=>{const t=k||localStorage.getItem("gemini_session_id");if(!t)return;const s=`gemini_draft_${t}`;localStorage.setItem(s,v)},[v,k]),n.useEffect(()=>{m&&(ee(0),localStorage.removeItem("gemini_prompt_count"))},[m]),n.useEffect(()=>{z&&L(!0)},[z]);const ut=()=>{L(!0)},Re=()=>{L(!1),he&&he()};n.useEffect(()=>{const t=()=>{ie()};return window.addEventListener("clearChatHistory",t),()=>{window.removeEventListener("clearChatHistory",t)}},[]),n.useEffect(()=>{const t=s=>{if(!K)return;const r=V.current&&V.current.contains(s.target),a=q.current&&q.current.contains(s.target);!r&&!a&&p(!1)};return document.addEventListener("mousedown",t),document.addEventListener("touchstart",t,{passive:!0}),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",t)}},[K]),n.useEffect(()=>{if(!u)return;const t=s=>{var r;s.ctrlKey&&s.key==="f"?(s.preventDefault(),(r=U.current)==null||r.focus()):s.key==="Escape"&&L(!1)};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[u]),n.useEffect(()=>{if(u){const t=window.scrollY;document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${t}px`,document.body.style.width="100%",document.body.style.height="100%",document.documentElement.style.overflow="hidden",document.documentElement.style.height="100%";const s=r=>{r.target.closest(".gemini-chatbox-modal")||r.preventDefault()};return document.addEventListener("touchmove",s,{passive:!1}),()=>{document.body.style.overflow="",document.body.style.position="",document.body.style.top="",document.body.style.width="",document.body.style.height="",document.documentElement.style.overflow="",document.documentElement.style.height="",document.removeEventListener("touchmove",s),window.scrollTo(0,t)}}},[u]),n.useEffect(()=>{const t=new CustomEvent("geminiChatboxToggle",{detail:{isOpen:u}});window.dispatchEvent(t),u&&J(0)},[u]),n.useEffect(()=>{u&&setTimeout(()=>{var t;return(t=U.current)==null?void 0:t.focus()},50)},[u]),n.useEffect(()=>{u&&setTimeout(()=>Ae(),50)},[u]),n.useEffect(()=>{u&&$&&setTimeout(()=>Ae(),50)},[$,u]),n.useEffect(()=>{const t=fe.current;if(!t)return;const s=()=>{const a=t.scrollHeight-t.scrollTop-t.clientHeight;Je(a>80);const o=Array.from(t.querySelectorAll("[data-message-index]"));let l=0;for(let d=0;d<o.length;d++){const x=o[d];if(x.offsetTop+x.offsetHeight>=t.scrollTop+8){l=Number(x.getAttribute("data-message-index"))||0;break}}const i=h[l];if(i&&i.timestamp){const d=Te(i.timestamp);lt(d)}};s();const r=()=>{s(),t.scrollHeight-t.scrollTop-t.clientHeight>80?(oe(!0),R.current&&clearTimeout(R.current),R.current=setTimeout(()=>{oe(!1)},1e3)):oe(!1)};return t.addEventListener("scroll",r),()=>{t.removeEventListener("scroll",r),R.current&&clearTimeout(R.current)}},[u,h]);const F=async t=>{var r;if(t.preventDefault(),!v.trim()||N)return;if(!m&&f>=5){T(!0);return}ge(!0),setTimeout(()=>ge(!1),800);let s=v.trim();I&&I!=="neutral"&&(s=`[Tone: ${I}] ${s}`),_(""),g(a=>[...a,{role:"user",content:s,timestamp:new Date().toISOString()}]),Y.current=s,S(!0);try{const a="https://urbansetu.onrender.com",o=b();console.log("Sending message to Gemini:",s,"Session:",o),(r=j.current)==null||r.abort(),j.current=new AbortController;const l=await fetch(`${a}/api/gemini/chat`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:s,history:h.slice(-10),sessionId:o,tone:I}),signal:j.current.signal});if(console.log("Response status:",l.status),console.log("Response ok:",l.ok),!l.ok){const d=await l.json();throw new Error(d.message||`HTTP error! status: ${l.status}`)}const i=await l.json();if(console.log("Response data received:",i),console.log("Response content length:",i.response?i.response.length:0),i&&i.response&&typeof i.response=="string"){const d=i.response.trim();if(console.log("Setting message with response length:",d.length),g(x=>[...x,{role:"assistant",content:d,timestamp:new Date().toISOString()}]),u||J(x=>x+1),i.sessionId&&i.sessionId!==k&&(w(i.sessionId),localStorage.setItem("gemini_session_id",i.sessionId)),!m){const x=f+1;ee(x),localStorage.setItem("gemini_prompt_count",x.toString())}pe(!0),setTimeout(()=>pe(!1),600)}else throw console.error("Invalid response structure:",i),new Error("Invalid response structure from server")}catch(a){console.error("Error in handleSubmit:",a);let o="Sorry, I'm having trouble connecting right now. Please try again later.";if(a.name==="AbortError"){S(!1);return}a.message.includes("timeout")?o="Request timed out. The response is taking longer than expected. Please try again.":a.message.includes("HTTP error")?o="Server error. Please try again later.":a.message.includes("Invalid response structure")?o="I received an invalid response. Please try again.":a.message.includes("Failed to fetch")&&(o="Network error. Please check your connection and try again."),g(l=>[...l,{role:"assistant",content:o,timestamp:new Date().toISOString(),isError:!0,originalUserMessage:Y.current}]),u||J(l=>l+1)}finally{S(!1)}},ht=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),F(t))},B=async t=>{try{await navigator.clipboard.writeText(t),c.success("Message copied to clipboard!")}catch{const r=document.createElement("textarea");r.value=t,document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r),c.success("Message copied to clipboard!")}},xt=async(t,s)=>{var r;if(!(!t||N)){if(!m&&f>=5){T(!0);return}S(!0),g(a=>a.filter((o,l)=>l!==s));try{const a="https://urbansetu.onrender.com",o=b();(r=j.current)==null||r.abort(),j.current=new AbortController;const l=await fetch(`${a}/api/gemini/chat`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t,history:h.slice(-10),sessionId:o,tone:I}),signal:j.current.signal});if(!l.ok){const d=await l.json();throw new Error(d.message||`HTTP error! status: ${l.status}`)}const i=await l.json();if(i&&i.response&&typeof i.response=="string"){const d=i.response.trim();if(g(x=>[...x,{role:"assistant",content:d,timestamp:new Date().toISOString()}]),i.sessionId&&i.sessionId!==k&&(w(i.sessionId),localStorage.setItem("gemini_session_id",i.sessionId)),!m){const x=f+1;ee(x),localStorage.setItem("gemini_prompt_count",x.toString())}}else throw new Error("Invalid response structure from server")}catch(a){console.error("Error in retryMessage:",a);let o="Sorry, I'm having trouble connecting right now. Please try again later.";if(a.name==="AbortError"){S(!1);return}a.message.includes("timeout")?o="Request timed out. The response is taking longer than expected. Please try again.":a.message.includes("HTTP error")?o="Server error. Please try again later.":a.message.includes("Invalid response structure")?o="I received an invalid response. Please try again.":a.message.includes("Failed to fetch")&&(o="Network error. Please check your connection and try again."),g(l=>[...l,{role:"assistant",content:o,timestamp:new Date().toISOString(),isError:!0,originalUserMessage:t}])}finally{S(!1)}}},gt=(t,s)=>{if(!m){c.error("Please sign in to bookmark messages");return}const r=b(),a=`${r}_${t}_${s.timestamp}`,o=C.some(i=>i.key===a);let l;o?(l=C.filter(i=>i.key!==a),c.success("Bookmark removed")):(l=[...C,{key:a,content:s.content,timestamp:s.timestamp,role:s.role,sessionId:r}],c.success("Message bookmarked")),we(l),localStorage.setItem("gemini_bookmarks",JSON.stringify(l))},Me=async(t,s)=>{if(!m){c.error("Please log in to rate messages");return}const r=h[t];if(r)try{const a="https://urbansetu.onrender.com",o=b();if((await fetch(`${a}/api/gemini/rate`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:o,messageIndex:t,messageTimestamp:r.timestamp,rating:s,messageContent:r.content,messageRole:r.role})})).ok){const i=`${t}_${r.timestamp}`,d={...Q,[i]:s};P(d),localStorage.setItem("gemini_ratings",JSON.stringify(d)),c.success(s==="up"?"Thanks for the feedback!":"Feedback recorded")}else c.error("Failed to save rating")}catch(a){console.error("Error rating message:",a),c.error("Failed to save rating")}},pt=async t=>{const s={title:"Gemini AI Response",text:t.content,url:window.location.href};if(navigator.share)try{await navigator.share(s),c.success("Message shared!")}catch{B(t.content)}else B(t.content)},y=async()=>{if(m)try{const s=await fetch("https://urbansetu.onrender.com/api/gemini/sessions",{credentials:"include"});if(s.ok){const r=await s.json();Xe(r.sessions||[])}else console.error("Failed to load chat sessions:",s.status)}catch(t){console.error("Error loading chat sessions:",t)}},ft=async t=>{try{const r=await fetch(`https://urbansetu.onrender.com/api/chat-history/session/${t}`,{credentials:"include"});if(r.ok){const a=await r.json();if(a.success&&a.data.messages){const o={role:"assistant",content:"Hello! I'm your AI assistant powered by Gemini. How can I help you with your real estate needs today?",timestamp:new Date().toISOString()};let l=a.data.messages;(l.length===0||l[0].content!==o.content)&&(l=[o,...l]),g(l),w(t),localStorage.setItem("gemini_session_id",t),await Le(t),c.success("Session loaded")}}}catch(s){console.error("Error loading session:",s),c.error("Failed to load session")}},Le=async t=>{if(!(!m||!t))try{const r=await fetch(`https://urbansetu.onrender.com/api/gemini/ratings/${t}`,{credentials:"include"});if(r.ok){const a=await r.json();a.success&&a.ratings&&(P(a.ratings),localStorage.setItem("gemini_ratings",JSON.stringify(a.ratings)))}}catch(s){console.error("Error loading message ratings:",s)}},H=async()=>{if(!m){c.error("Please log in to create new sessions");return}try{const t="https://urbansetu.onrender.com",s=b();h.length>0&&((await fetch(`${t}/api/chat-history/session/${s}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:h,totalMessages:h.length})})).ok||console.error("Failed to save current session"));const r=await fetch(`${t}/api/gemini/sessions`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(r.ok){const a=await r.json();if(a.success&&a.sessionId){w(a.sessionId),localStorage.setItem("gemini_session_id",a.sessionId);const o={role:"assistant",content:"Hello! I'm your AI assistant powered by Gemini. How can I help you with your real estate needs today?",timestamp:new Date().toISOString()};g([o]),P({}),localStorage.setItem("gemini_ratings",JSON.stringify({})),await y(),c.success("New chat session created")}}else c.error("Failed to create new session")}catch(t){console.error("Error creating new session:",t),c.error("Failed to create new session")}},$e=async t=>{if(!m){c.error("Please log in to delete sessions");return}try{const r=await fetch(`https://urbansetu.onrender.com/api/gemini/sessions/${t}`,{method:"DELETE",credentials:"include"});r.ok?(await r.json()).success&&(await y(),c.success("Session deleted successfully")):c.error("Failed to delete session")}catch(s){console.error("Error deleting session:",s),c.error("Failed to delete session")}},bt=t=>{const s=h.findIndex((r,a)=>`${b()}_${a}_${r.timestamp}`===t);s!==-1&&(Ne(s),setTimeout(()=>{const r=document.querySelector(`[data-message-index="${s}"]`);r&&r.scrollIntoView({behavior:"smooth",block:"center"})},100),setTimeout(()=>{Ne(null)},3e3))};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed bottom-20 right-6 z-50",children:e.jsxs("button",{onClick:u?Re:ut,className:"relative group w-12 h-12 rounded-full shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:scale-110 hover:rotate-12 flex items-center justify-center",style:{background:"linear-gradient(135deg, #6366f1, #6366f1dd)",boxShadow:"0 10px 25px #6366f140"},"aria-label":"Open AI Chat",title:"Chat with Gemini AI Assistant!",children:[e.jsx("div",{className:"absolute inset-0 rounded-full animate-ping",style:{border:"3px solid #6366f155"}}),u?e.jsx(Fe,{className:"w-5 h-5 text-white drop-shadow-lg"}):e.jsx(de,{className:"w-5 h-5 text-white drop-shadow-lg"}),!u&&G>0&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-red-600 text-white text-[10px] font-bold rounded-full min-w-[18px] h-[18px] px-1 flex items-center justify-center border-2 border-white shadow-lg",children:G>99?"99+":G}),e.jsxs("div",{className:"absolute bottom-full right-0 mb-3 bg-white text-gray-800 text-sm px-4 py-2 rounded-xl shadow-2xl hidden group-hover:block z-10 whitespace-nowrap border border-gray-100 transform -translate-y-1 transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ¤–"}),e.jsx("span",{className:"font-medium",children:"Chat with AI Assistant!"})]}),e.jsx("div",{className:"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"})]})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 p-4 md:p-0 md:items-end md:justify-end gemini-chatbox-modal animate-fadeIn",children:e.jsxs("div",{className:`bg-white rounded-2xl shadow-2xl border border-gray-200 flex flex-col relative ${be?"w-full max-w-3xl h-[80vh] md:mb-12 md:mr-12":"w-full max-w-md h-full max-h-[90vh] md:w-96 md:h-[500px] md:mb-32 md:mr-6 md:max-h-[500px]"} animate-slideUp`,children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-3 md:p-4 rounded-t-2xl flex items-center justify-between flex-shrink-0 relative",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-1.5 md:p-2 bg-white/10 rounded-lg border border-white/20",children:e.jsx(me,{size:16,className:"opacity-90"})}),e.jsxs("div",{className:"leading-tight block max-w-full",children:[e.jsx("div",{className:"text-xs md:text-sm font-semibold truncate",children:"Gemini AI"}),e.jsx("div",{className:"text-[10px] md:text-xs text-white/80 truncate",children:"Your Smart Real Estate Assistant"})]})]}),e.jsxs("div",{className:"flex items-center gap-1 relative flex-shrink-0",children:[e.jsxs("select",{value:I,onChange:t=>{Ve(t.target.value),localStorage.setItem("gemini_tone",t.target.value)},className:"text-white/90 bg-white/10 hover:bg-white/20 border border-white/30 text-[10px] md:text-xs px-2 py-1 rounded outline-none max-w-[100px] md:max-w-[120px]",title:"Response Tone","aria-label":"Response Tone",children:[e.jsx("option",{className:"text-gray-800",value:"neutral",children:"Neutral"}),e.jsx("option",{className:"text-gray-800",value:"friendly",children:"Friendly"}),e.jsx("option",{className:"text-gray-800",value:"formal",children:"Formal"}),e.jsx("option",{className:"text-gray-800",value:"concise",children:"Concise"})]}),e.jsx("button",{ref:V,onClick:()=>p(t=>!t),className:"inline-flex text-white/90 hover:text-white text-xs px-2 py-1 rounded border border-white/30 hover:border-white transition-colors",title:"More options","aria-label":"More options",children:"â‹¯"}),e.jsx("button",{onClick:Re,className:"text-white hover:text-gray-200 transition-colors","aria-label":"Close",children:e.jsx(Fe,{size:16})}),K&&e.jsx("div",{ref:q,className:"absolute right-0 top-full mt-2 bg-white text-gray-800 rounded shadow-lg border border-gray-200 w-48 z-50",children:e.jsxs("ul",{className:"py-1 text-sm",children:[e.jsx("li",{children:e.jsxs("button",{onClick:()=>{H(),p(!1)},className:"w-full text-left px-3 py-2 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(de,{size:12,className:"text-blue-500"}),"New Chat"]})}),e.jsx("li",{className:"border-t border-gray-200 my-1"}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>{X(!0),p(!1)},className:"w-full text-left px-3 py-2 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Be,{size:12,className:"text-yellow-500"}),"Quick Actions"]})}),m&&e.jsx("li",{children:e.jsxs("button",{onClick:()=>{W(!0),y(),p(!1)},className:"w-full text-left px-3 py-2 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(ue,{size:12,className:"text-yellow-500"}),"Bookmarks"]})}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>{E(!0),y(),p(!1)},className:"w-full text-left px-3 py-2 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(He,{size:12,className:"text-blue-500"}),"Chat History"]})}),e.jsx("li",{className:"border-t border-gray-200 my-1"}),e.jsx("li",{className:"hidden md:block",children:e.jsxs("button",{onClick:()=>{Ke(t=>!t),p(!1)},className:"w-full text-left px-3 py-2 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M4 4h7v2H6v5H4V4zm10 0h6v6h-2V6h-4V4zM4 14h2v4h4v2H4v-6zm14 0h2v6h-6v-2h4v-4z"})}),be?"Collapse":"Expand"]})}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>{try{const t=h.map(o=>`${o.role==="user"?"You":"Gemini"}: ${o.content}`),s=new Blob([t.join(`

`)],{type:"text/plain;charset=utf-8"}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`gemini_chat_${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r),p(!1)}catch{c.error("Failed to share chat")}},className:"w-full text-left px-3 py-2 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(ze,{size:12,className:"text-green-500"}),"Share Chat"]})}),e.jsx("li",{children:e.jsxs("button",{onClick:()=>{ye(!0),p(!1)},className:"w-full text-left px-3 py-2 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(vt,{size:12,className:"text-gray-500"}),"Features"]})}),h&&(h.length>1||h.some(t=>t.role==="user"))&&e.jsx("li",{children:e.jsxs("button",{onClick:()=>{p(!1),O(!0)},className:"w-full text-left px-3 py-2 hover:bg-gray-100 text-red-600 flex items-center gap-2",children:[e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})}),"Clear Chat"]})})]})})]})]}),e.jsxs("div",{ref:fe,className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0 relative",children:[it&&_e&&e.jsx("div",{className:"sticky top-0 left-0 right-0 z-30 pointer-events-none",children:e.jsx("div",{className:"w-full flex justify-center py-2",children:e.jsx("div",{className:"bg-blue-600 text-white text-xs px-4 py-2 rounded-full shadow-lg border-2 border-white",children:_e})})}),h.map((t,s)=>{var o;const r=s===0||!le((o=h[s-1])==null?void 0:o.timestamp,t.timestamp),a=r?Te(t.timestamp):"";return e.jsxs(Nt.Fragment,{children:[r&&e.jsxs("div",{className:"flex items-center my-2",children:[e.jsx("div",{className:"flex-1 h-px bg-gray-200"}),e.jsx("span",{className:"mx-3 text-xs text-gray-600 bg-white px-3 py-1 rounded-full border border-gray-200 shadow-sm",children:a}),e.jsx("div",{className:"flex-1 h-px bg-gray-200"})]}),e.jsx("div",{"data-message-index":s,className:`flex ${t.role==="user"?"justify-end":"justify-start"} ${ve===s?"animate-pulse":""}`,children:e.jsxs("div",{className:`max-w-[85%] p-3 rounded-2xl break-words relative group ${t.role==="user"?"bg-gradient-to-r from-blue-600 to-purple-600 text-white":t.isError?"bg-red-100 text-red-800 border border-red-200":"bg-gray-100 text-gray-800"} ${ve===s?"ring-4 ring-yellow-400 ring-opacity-50 shadow-lg transform scale-105":""} transition-all duration-300`,children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:At(t.content,t.role==="user")}),e.jsxs("div",{className:"flex items-center justify-between mt-2 pt-2 border-t border-gray-200/20",children:[t.timestamp&&e.jsx("div",{className:`${t.role==="user"?"text-white/80":t.isError?"text-red-600":"text-gray-500"} text-[10px]`,children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-all duration-200",children:[e.jsx("button",{onClick:()=>B(t.content),className:"p-1 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-all duration-200",title:"Copy message","aria-label":"Copy message",children:e.jsx(St,{size:10})}),t.role==="assistant"&&!t.isError&&m&&e.jsx("button",{onClick:()=>gt(s,t),className:"p-1 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-all duration-200",title:"Bookmark message","aria-label":"Bookmark message",children:(()=>{const i=`${b()}_${s}_${t.timestamp}`;return C.some(d=>d.key===i)?e.jsx(ue,{size:10,className:"text-yellow-500"}):e.jsx(kt,{size:10,className:"text-gray-500"})})()}),t.role==="assistant"&&!t.isError&&e.jsx("button",{onClick:()=>pt(t),className:"p-1 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded transition-all duration-200",title:"Share message","aria-label":"Share message",children:e.jsx(ze,{size:10})}),t.role==="assistant"&&!t.isError&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>Me(s,"up"),className:`p-1 rounded transition-all duration-200 ${Q[`${s}_${t.timestamp}`]==="up"?"text-green-600 bg-green-100":"text-gray-500 hover:text-green-600 hover:bg-green-100"}`,title:"Good response","aria-label":"Good response",children:e.jsx(It,{size:10})}),e.jsx("button",{onClick:()=>Me(s,"down"),className:`p-1 rounded transition-all duration-200 ${Q[`${s}_${t.timestamp}`]==="down"?"text-red-600 bg-red-100":"text-gray-500 hover:text-red-600 hover:bg-red-100"}`,title:"Poor response","aria-label":"Poor response",children:e.jsx(Ct,{size:10})})]}),t.role==="assistant"&&e.jsx("button",{onClick:()=>{const l=(()=>{var i;for(let d=s-1;d>=0;d--)if(((i=h[d])==null?void 0:i.role)==="user")return h[d].content;return Y.current})();l&&xt(l,s)},disabled:N||!m&&f>=5,className:"p-1 text-blue-600 hover:text-blue-700 hover:bg-blue-100 rounded transition-all duration-200 disabled:opacity-50",title:"Try Again","aria-label":"Try Again",children:e.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26l1.46-1.46C6.26 13.86 6 12.97 6 12c0-3.31 2.69-6 6-6zm5.76 1.74L16.3 9.2C17.74 10.14 18.5 11.49 18.5 13c0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"})})})]})]})]})})]},s)}),N&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-100 text-gray-800 p-3 rounded-2xl",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"Gemini is thinking..."})]})})}),e.jsx("div",{ref:D})]}),Ge&&e.jsx("div",{className:"absolute bottom-20 right-4 z-30",children:e.jsx("button",{onClick:()=>{var t;return(t=D.current)==null?void 0:t.scrollIntoView({behavior:"smooth"})},className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-full p-3 shadow-xl transition-all duration-200 hover:scale-110 relative transform hover:shadow-2xl",title:"Jump to latest","aria-label":"Jump to latest",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"transform",children:e.jsx("path",{d:"M12 16l-6-6h12l-6 6z"})})})}),h&&e.jsx("div",{className:"px-4 pb-2 pt-2 border-t border-gray-100 flex-shrink-0",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:["Show trending properties","How do I schedule a viewing?","What are popular areas near me?","Explain mortgage basics"].map(t=>e.jsx("button",{onClick:()=>{_(t),setTimeout(()=>F(new Event("submit")),0)},className:"text-xs bg-gray-100 hover:bg-gray-200 text-gray-800 px-3 py-1 rounded-full",children:t},t))})}),qe&&e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center z-50 rounded-2xl",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-5 w-96 max-w-full max-h-[80vh] overflow-y-auto",children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(me,{className:"text-blue-500"}),"Gemini AI Features"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-800 mb-2",children:"ðŸ’¬ Chat Features"}),e.jsxs("ul",{className:"text-sm text-gray-700 list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"Real-time conversation with AI"}),e.jsx("li",{children:"Multiple response tones (Neutral, Friendly, Formal, Concise)"}),e.jsx("li",{children:"Session-based chat history"}),e.jsx("li",{children:"Export conversations to .txt"}),e.jsx("li",{children:"Retry failed responses"})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-800 mb-2",children:"ðŸ”– Message Management"}),e.jsxs("ul",{className:"text-sm text-gray-700 list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"Bookmark important responses"}),e.jsx("li",{children:"Rate responses (thumbs up/down)"}),e.jsx("li",{children:"Share messages via native sharing"}),e.jsx("li",{children:"Copy any message to clipboard"})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-800 mb-2",children:"âš¡ Quick Actions"}),e.jsxs("ul",{className:"text-sm text-gray-700 list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"Property search assistance"}),e.jsx("li",{children:"Market analysis guidance"}),e.jsx("li",{children:"Home buying process help"}),e.jsx("li",{children:"Investment advice"}),e.jsx("li",{children:"Legal information"}),e.jsx("li",{children:"Property management tips"})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-800 mb-2",children:"ðŸ“± User Experience"}),e.jsxs("ul",{className:"text-sm text-gray-700 list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"Mobile-friendly responsive design"}),e.jsx("li",{children:"Keyboard shortcuts (Ctrl+F, Esc)"}),e.jsx("li",{children:"Auto-scroll to latest messages"}),e.jsx("li",{children:"Typing indicators"}),e.jsx("li",{children:"Unread message notifications"})]})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{onClick:()=>ye(!1),className:"px-3 py-1.5 text-sm rounded bg-blue-600 text-white hover:bg-blue-700",children:"Close"})})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 flex-shrink-0",children:[!m&&e.jsx("div",{className:"mb-3 text-center",children:e.jsxs("div",{className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200",children:[e.jsx("span",{className:"mr-1",children:"ðŸ’¬"}),e.jsx("span",{children:f<5?`${5-f} free prompts remaining`:"No free prompts left"})]})}),e.jsxs("form",{onSubmit:F,className:"flex space-x-2",children:[e.jsx("input",{ref:U,type:"text",value:v,onChange:t=>_(t.target.value),onKeyPress:ht,placeholder:!m&&f>=5?"Sign in to continue chatting...":"Ask me anything about real estate...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",disabled:N||!m&&f>=5}),N?e.jsx("button",{type:"button",onClick:()=>{var t;(t=j.current)==null||t.abort(),c.info("Generation stopped")},className:"bg-red-600 hover:bg-red-700 text-white px-3 rounded-full h-10 text-xs font-medium shadow",title:"Stop generating","aria-label":"Stop generating",children:"Stop"}):e.jsx("button",{type:"submit",disabled:!v.trim()||!m&&f>=5,className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-2 rounded-full hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 transform hover:scale-110 flex-shrink-0 flex items-center justify-center w-10 h-10 group hover:shadow-xl active:scale-95",children:e.jsx("div",{className:"relative",children:Oe?e.jsx(Et,{className:"text-white send-icon animate-sent",size:16}):e.jsx(_t,{className:`text-white send-icon ${Ue?"animate-fly":""} group-hover:scale-110 transition-all duration-300`,size:16})})})]})]}),Ze&&e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center z-50 rounded-2xl",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-5 w-96 max-w-full",children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Be,{className:"text-yellow-500"}),"Quick Actions"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{icon:"ðŸ ",text:"Property Search",prompt:"Help me find properties in my area"},{icon:"ðŸ’°",text:"Market Analysis",prompt:"Analyze the real estate market trends"},{icon:"ðŸ“‹",text:"Buying Guide",prompt:"Guide me through the home buying process"},{icon:"ðŸ“Š",text:"Investment Tips",prompt:"Give me real estate investment advice"},{icon:"âš–ï¸",text:"Legal Info",prompt:"Explain real estate legal requirements"},{icon:"ðŸ”§",text:"Property Management",prompt:"Help with property management tips"}].map((t,s)=>e.jsxs("button",{onClick:()=>{_(t.prompt),X(!1),setTimeout(()=>F(new Event("submit")),0)},className:"p-3 text-left border border-gray-200 rounded-lg hover:bg-gray-50 hover:border-blue-300 transition-all duration-200",children:[e.jsx("div",{className:"text-lg mb-1",children:t.icon}),e.jsx("div",{className:"text-sm font-medium text-gray-800",children:t.text})]},s))}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{onClick:()=>X(!1),className:"px-3 py-1.5 text-sm rounded bg-blue-600 text-white hover:bg-blue-700",children:"Close"})})]})}),Qe&&e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center z-50 rounded-2xl",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-5 w-96 max-w-full max-h-[80vh] overflow-y-auto",children:[e.jsxs("h4",{className:"font-semibold mb-3 flex items-center gap-2",children:[e.jsx(ue,{className:"text-yellow-500"}),"Bookmarked Messages"]}),(()=>{const t=b(),s=C.filter(r=>r.sessionId===t);return s.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No bookmarked messages in this session"}):e.jsx("div",{className:"space-y-3",children:s.map((r,a)=>e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:new Date(r.timestamp).toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-800 mb-2 line-clamp-3",children:r.content}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{bt(r.key),W(!1)},className:"text-xs px-2 py-1 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded",children:"Go to Message"}),e.jsx("button",{onClick:()=>B(r.content),className:"text-xs px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded",children:"Copy"}),e.jsx("button",{onClick:()=>{const o=C.filter(l=>l.key!==r.key);we(o),localStorage.setItem("gemini_bookmarks",JSON.stringify(o))},className:"text-xs px-2 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded",children:"Remove"})]})]},a))})})(),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{onClick:()=>W(!1),className:"px-3 py-1.5 text-sm rounded bg-blue-600 text-white hover:bg-blue-700",children:"Close"})})]})}),We&&e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center z-50 rounded-2xl",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-5 w-96 max-w-full max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(He,{className:"text-blue-500"}),"Chat History"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>te(!0),className:"px-3 py-1.5 text-xs rounded bg-red-600 text-white hover:bg-red-700",children:"Delete All"}),e.jsxs("button",{onClick:()=>{H(),E(!1)},className:"px-3 py-1.5 text-xs rounded bg-green-600 text-white hover:bg-green-700 flex items-center gap-1",children:[e.jsx(de,{size:10}),"New Chat"]})]})]}),je.length===0?e.jsxs("div",{className:"text-center py-8 space-y-3",children:[e.jsx("p",{className:"text-gray-500",children:"No chats yet"}),e.jsx("button",{onClick:async()=>{await H(),await y(),E(!1)},className:"px-3 py-1.5 text-xs rounded bg-green-600 text-white hover:bg-green-700",children:"Create First Chat"})]}):e.jsxs("div",{className:"space-y-2",children:[je.map((t,s)=>{var r;return e.jsx("div",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-all duration-200",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("input",{type:"checkbox",className:"mt-1",checked:Z.includes(t.sessionId),onChange:a=>{const o=t.sessionId;Se(l=>a.target.checked?[...l,o]:l.filter(i=>i!==o))},"aria-label":"Select chat"}),e.jsxs("button",{onClick:()=>{ft(t.sessionId),E(!1)},className:"flex-1 text-left",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:(r=t.name)!=null&&r.trim()?t.name:`New chat ${s+1}`}),e.jsx("div",{className:"text-xs text-gray-600",children:new Date(t.lastMessageAt).toLocaleString()}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.messageCount," messages"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),A(o=>o===t.sessionId?null:t.sessionId)},className:"ml-2 p-1 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded transition-all duration-200",title:"Chat options",children:"â‹¯"}),et===t.sessionId&&e.jsxs("div",{className:"absolute right-0 top-6 bg-white border border-gray-200 rounded shadow-lg z-10 w-36",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),Ie(t.sessionId),ae(!0)},className:"block w-full text-left px-3 py-2 text-sm hover:bg-gray-100",children:"Delete chat"}),e.jsx("button",{onClick:async a=>{var o;a.stopPropagation();try{const i=await fetch(`https://urbansetu.onrender.com/api/chat-history/session/${t.sessionId}`,{credentials:"include"}),d=await i.json();if(!i.ok||!((o=d==null?void 0:d.data)!=null&&o.messages))throw new Error("load");const x=d.data.messages.map(Pe=>`${Pe.role==="user"?"You":"Gemini"}: ${Pe.content}`),De=new Blob([x.join(`

`)],{type:"text/plain;charset=utf-8"}),ce=URL.createObjectURL(De),M=document.createElement("a");M.href=ce,M.download=`gemini_chat_${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(ce),A(null)}catch{c.error("Failed to share chat")}},className:"block w-full text-left px-3 py-2 text-sm hover:bg-gray-100",children:"Share chat"}),e.jsx("button",{onClick:a=>{var l;a.stopPropagation(),ne(t.sessionId);const o=((l=t.name)==null?void 0:l.trim())||"";Ee(o),re(!0)},className:"block w-full text-left px-3 py-2 text-sm hover:bg-gray-100",children:"Rename"})]})]})]})},t.sessionId||s)}),Z.length>0&&e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>se(!0),className:"px-3 py-1.5 text-xs rounded bg-red-600 text-white hover:bg-red-700",children:"Delete Selected"})})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{onClick:()=>{E(!1),A(null)},className:"px-3 py-1.5 text-sm rounded bg-blue-600 text-white hover:bg-blue-700",children:"Close"})})]})}),Ye&&e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center z-50 rounded-2xl",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-5 w-80",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Clear chat?"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"This will remove your conversation here. This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>O(!1),className:"px-3 py-1.5 text-sm rounded border border-gray-300 text-gray-700",children:"Cancel"}),e.jsx("button",{onClick:()=>{O(!1),mt()},className:"px-3 py-1.5 text-sm rounded bg-red-600 text-white hover:bg-red-700",children:"Clear"})]})]})}),st&&e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center z-50 rounded-2xl",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-5 w-80",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Delete all chats?"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"This cannot be undone."}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>te(!1),className:"px-3 py-1.5 text-sm rounded border border-gray-300 text-gray-700",children:"Cancel"}),e.jsx("button",{onClick:async()=>{try{await fetch("https://urbansetu.onrender.com/api/gemini/sessions",{method:"DELETE",credentials:"include"}),await H(),await y(),c.success("All chats deleted"),E(!1)}catch{c.error("Failed to delete all chats")}finally{te(!1)}},className:"px-3 py-1.5 text-sm rounded bg-red-600 text-white hover:bg-red-700",children:"Delete"})]})]})}),at&&e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center z-50 rounded-2xl",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-5 w-80",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Delete selected chats?"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"This cannot be undone."}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>se(!1),className:"px-3 py-1.5 text-sm rounded border border-gray-300 text-gray-700",children:"Cancel"}),e.jsx("button",{onClick:async()=>{try{for(const t of Z)await $e(t);Se([]),await y(),c.success("Selected chats deleted")}catch{c.error("Failed to delete selected chats")}finally{se(!1)}},className:"px-3 py-1.5 text-sm rounded bg-red-600 text-white hover:bg-red-700",children:"Delete"})]})]})}),rt&&e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center z-50 rounded-2xl",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-5 w-80",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Delete this chat?"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"This cannot be undone."}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>ae(!1),className:"px-3 py-1.5 text-sm rounded border border-gray-300 text-gray-700",children:"Cancel"}),e.jsx("button",{onClick:async()=>{try{ke&&await $e(ke),await y(),c.success("Chat deleted")}catch{c.error("Failed to delete chat")}finally{Ie(null),ae(!1),A(null)}},className:"px-3 py-1.5 text-sm rounded bg-red-600 text-white hover:bg-red-700",children:"Delete"})]})]})}),nt&&e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center z-50 rounded-2xl",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-5 w-96 max-w-full",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Rename chat"}),e.jsx("input",{type:"text",value:Ce,onChange:t=>Ee(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded mb-4",placeholder:"Enter chat name",maxLength:80,autoFocus:!0}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>{re(!1),ne(null)},className:"px-3 py-1.5 text-sm rounded border border-gray-300 text-gray-700",children:"Cancel"}),e.jsx("button",{onClick:async()=>{try{const t=Ce.trim();await fetch(`https://urbansetu.onrender.com/api/chat-history/session/${ot}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t})}),await y(),c.success("Chat renamed")}catch{c.error("Failed to rename chat")}finally{re(!1),ne(null),A(null)}},className:"px-3 py-1.5 text-sm rounded bg-blue-600 text-white hover:bg-blue-700",children:"Save"})]})]})}),tt&&e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center z-50 rounded-2xl",children:e.jsx("div",{className:"bg-white rounded-xl shadow-xl p-6 w-96 max-w-sm mx-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 mb-4",children:e.jsx(me,{className:"h-6 w-6 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Prompt Limit Reached"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"You've used all 5 free prompts! Sign in to enjoy unlimited access to our AI assistant and unlock premium features like chat history, message ratings, and more."}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{onClick:()=>{T(!1),window.location.href="/signin"},className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 px-4 rounded-lg transition-colors duration-200",children:"Sign In to Continue"}),e.jsx("button",{onClick:()=>{T(!1),window.location.href="/signup"},className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2.5 px-4 rounded-lg transition-colors duration-200",children:"Create Free Account"}),e.jsx("button",{onClick:()=>T(!1),className:"w-full text-gray-500 hover:text-gray-700 text-sm py-2",children:"Maybe Later"})]})]})})})]})}),e.jsx("style",{children:`
                @keyframes fadeIn {
                  from { opacity: 0; }
                  to { opacity: 1; }
                }
                @keyframes slideUp {
                  from {
                    opacity: 0;
                    transform: translateY(20px) scale(0.98);
                  }
                  to {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                  }
                }
                .animate-fadeIn { animation: fadeIn 0.25s ease-out; }
                .animate-slideUp { animation: slideUp 0.28s ease-out; }
                @keyframes sendIconFly {
                  0% {
                    transform: translate(0, 0) scale(1);
                    opacity: 1;
                  }
                  20% {
                    transform: translate(-3px, -6px) scale(1.05);
                    opacity: 0.9;
                  }
                  40% {
                    transform: translate(-8px, -12px) scale(1.1);
                    opacity: 0.8;
                  }
                  60% {
                    transform: translate(8px, -18px) scale(1.15);
                    opacity: 0.9;
                  }
                  80% {
                    transform: translate(15px, -20px) scale(1.2);
                    opacity: 0.95;
                  }
                  100% {
                    transform: translate(0, 0) scale(1);
                    opacity: 1;
                  }
                }
                .send-icon.animate-fly {
                  animation: sendIconFly 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                }
                @keyframes sentSuccess {
                  0% {
                    transform: scale(0.8);
                    opacity: 0;
                  }
                  50% {
                    transform: scale(1.2);
                    opacity: 1;
                  }
                  100% {
                    transform: scale(1);
                    opacity: 1;
                  }
                }
                .send-icon.animate-sent {
                  animation: sentSuccess 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                }
                `})]})};function Gt(){return e.jsx(Tt,{})}export{Gt as G,Tt as a};
