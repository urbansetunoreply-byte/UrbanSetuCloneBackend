import{u as se,r as i,i as re,p as ae,o as te,j as e,y as w}from"./index-AwWxf1fH.js";import{L as oe}from"./LocationSelector-C3s9mesM.js";import"./countries_states_cities-CCOM4uJJ.js";const y="https://urbansetu.onrender.com";function me(){se("Create Property - Admin Panel");const[t,c]=i.useState({imageUrls:[],videoUrls:[],name:"",description:"",propertyNumber:"",landmark:"",city:"",state:"",pincode:"",address:"",type:"sale",bedrooms:1,bathrooms:1,regularPrice:0,discountPrice:0,offer:!1,parking:!1,furnished:!1,locationLink:"",area:"",floor:"",propertyAge:"",assignToEmail:""}),[L,m]=i.useState(""),[U,E]=i.useState(!1),[h,g]=i.useState({}),[v,P]=i.useState({}),[f,p]=i.useState({}),[j,C]=i.useState({}),{currentUser:D}=re(s=>s.user),V=ae(),M=te(),[S,k]=i.useState(""),[le,F]=i.useState(!1),[I,T]=i.useState([]),[B,b]=i.useState(!1),[R,G]=i.useState([]),[ie,A]=i.useState(!1),[N,O]=i.useState({state:"",district:"",city:"",cities:[]}),q=()=>{var r;const s=(r=M.state)==null?void 0:r.from;return s||"/admin/listings"};i.useEffect(()=>{z()},[]);const z=async()=>{try{A(!0);const s=await fetch(`${y}/api/user/all-users-autocomplete`,{credentials:"include"});if(s.ok){const r=await s.json();G(r)}else console.error("Failed to fetch users for autocomplete")}catch(s){console.error("Error fetching users:",s)}finally{A(!1)}};i.useEffect(()=>{c(s=>({...s,state:N.state,city:N.city||""}))},[N]),i.useEffect(()=>{if(t.assignToEmail.trim()){const s=R.filter(r=>r.email.toLowerCase().includes(t.assignToEmail.toLowerCase()));T(s),b(s.length>0)}else T([]),b(!1)},[t.assignToEmail,R]);const _=s=>{if(!s)return!0;try{new URL(s)}catch{return!1}const a=[".jpg",".jpeg",".png",".gif",".webp",".svg"].some(n=>s.toLowerCase().includes(n)),o=s.includes("cloudinary.com");return a||s.includes("images")||s.includes("img")||o},W=s=>{if(!s)return!0;try{new URL(s)}catch{return!1}const a=[".mp4",".webm",".ogg",".mov",".mkv"].some(n=>s.toLowerCase().includes(n)),o=s.includes("cloudinary.com");return a||s.includes("video")||o},H=(s,r)=>{const a=[...t.imageUrls];a[s]=r,c({...t,imageUrls:a});const o={...h};r&&!_(r)?o[s]="Please enter a valid image URL":delete o[s],g(o)},J=async(s,r)=>{if(r){if(!r.type.startsWith("image/")){g(a=>({...a,[s]:"Please select an image file"}));return}if(r.size>5*1024*1024){g(a=>({...a,[s]:"File size must be less than 5MB"}));return}P(a=>({...a,[s]:!0})),g(a=>({...a,[s]:""}));try{const a=new FormData;a.append("image",r);const o=await fetch(`${y}/api/upload/image`,{method:"POST",credentials:"include",body:a}),n=await o.json();if(o.ok){const d=[...t.imageUrls];d[s]=n.imageUrl,c(u=>({...u,imageUrls:d})),g(u=>{const x={...u};return delete x[s],x})}else g(d=>({...d,[s]:n.message||"Upload failed"}))}catch(a){console.error("Upload error:",a),g(o=>({...o,[s]:"Upload failed. Please try again."}))}finally{P(a=>({...a,[s]:!1}))}}},K=(s,r)=>{const a=[...t.videoUrls];a[s]=r,c({...t,videoUrls:a});const o={...f};r&&!W(r)?o[s]="Please enter a valid video URL":delete o[s],p(o)},Q=async(s,r)=>{if(r){if(!r.type.startsWith("video/")){p(a=>({...a,[s]:"Please select a video file"}));return}if(r.size>5*1024*1024){p(a=>({...a,[s]:"File size must be less than 5MB"}));return}C(a=>({...a,[s]:!0})),p(a=>({...a,[s]:""}));try{const a=new FormData;a.append("video",r);const o=await fetch(`${y}/api/upload/video`,{method:"POST",credentials:"include",body:a}),n=await o.json();if(o.ok){const d=[...t.videoUrls];d[s]=n.videoUrl,c(u=>({...u,videoUrls:d})),p(u=>{const x={...u};return delete x[s],x})}else p(d=>({...d,[s]:n.message||"Upload failed"}))}catch(a){console.error("Video upload error:",a),p(o=>({...o,[s]:"Upload failed. Please try again."}))}finally{C(a=>({...a,[s]:!1}))}}},$=s=>{c({...t,imageUrls:t.imageUrls.filter((o,n)=>n!==s)});const r={...h};delete r[s],g(r);const a={...v};delete a[s],P(a)},X=s=>{c({...t,videoUrls:t.videoUrls.filter((o,n)=>n!==s)});const r={...f};delete r[s],p(r);const a={...j};delete a[s],C(a)},l=s=>{const{id:r,value:a,checked:o,type:n,name:d}=s.target;let u=n==="checkbox"?o:a;["regularPrice","discountPrice","bedrooms","bathrooms"].includes(r)&&(u=Number(a)),c({...t,[d||r]:u}),r==="assignToEmail"&&k("")},Y=s=>{c({...t,assignToEmail:s}),b(!1),k("")},Z=async s=>{if(!s.trim())return!0;try{return F(!0),!!(await fetch(`${y}/api/user/validate-email/${encodeURIComponent(s.trim())}`,{credentials:"include"})).ok}catch{return!1}finally{F(!1)}},ee=async s=>{if(s.preventDefault(),!t.type)return m("Please select a listing type (Sale or Rent)");if(t.regularPrice<t.discountPrice)return m("Discount price should be less than regular price");if(!t.propertyNumber)return m("Property number is required");if(!t.city)return m("City is required");if(!t.state)return m("State is required");if(!t.pincode)return m("Pincode is required");if(Object.keys(h).length>0)return m("Please fix the image URL errors before submitting");if(t.assignToEmail.trim()&&!await Z(t.assignToEmail)){k("User not found with this email");return}E(!0),m("");try{console.log("Sending form data:",t);const r=await fetch(`${y}/api/listing/create`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...t,userRef:D._id})}),a=await r.json();if(E(!1),r.ok)t.assignToEmail.trim()?w.success(`Property added successfully to ${t.assignToEmail}`):w.success("Listing created under admin ownership"),V(q());else{const o=a.message||"Failed to create listing";m(o),w.error(o)}}catch(r){const a=r.message||"An error occurred while creating the listing";m(a),w.error(a),E(!1)}};return e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen py-10 px-2 md:px-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 relative",children:[e.jsx("h3",{className:"text-3xl font-extrabold text-blue-700 mb-6 text-center drop-shadow",children:"Create a Listing (Admin)"}),e.jsxs("form",{onSubmit:ee,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Basic Information"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx("input",{type:"text",id:"name",placeholder:"Property Name",required:!0,onChange:l,value:t.name,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("textarea",{id:"description",placeholder:"Property Description",required:!0,onChange:l,value:t.description,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mt-4 resize-y",rows:4})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-3",children:"User Assignment"}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"assignToEmail",className:"block text-sm font-medium text-blue-700 mb-2",children:"Assign to (User Email - optional)"}),e.jsx("input",{type:"email",id:"assignToEmail",placeholder:"Enter user email to assign listing (leave empty for admin ownership)",onChange:l,value:t.assignToEmail,className:`w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${S?"border-red-500":"border-gray-300"}`,onFocus:()=>b(I.length>0),onBlur:()=>setTimeout(()=>b(!1),200)}),B&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:I.map(s=>e.jsxs("div",{className:"px-3 py-2 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",onClick:()=>Y(s.email),children:[e.jsx("div",{className:"font-medium text-gray-800",children:s.email}),e.jsx("div",{className:"text-sm text-gray-500",children:s.username})]},s._id))}),S&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:S}),e.jsx("p",{className:"text-sm text-blue-600 mt-2",children:"ðŸ’¡ Tip: Start typing to see email suggestions. If left empty, the listing will be owned by the admin."})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Address Information"}),e.jsx("div",{className:"mb-4",children:e.jsx(oe,{value:N,onChange:O,mode:"form"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",id:"propertyNumber",placeholder:"Property Number/Flat Number",required:!0,onChange:l,value:t.propertyNumber,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",id:"landmark",placeholder:"Landmark (optional)",onChange:l,value:t.landmark,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",id:"pincode",placeholder:"Pincode",required:!0,onChange:l,value:t.pincode,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("input",{type:"text",id:"locationLink",placeholder:"Google Maps Location Link (Optional)",onChange:l,value:t.locationLink,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Type"}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 p-3 bg-white rounded-lg shadow-sm",children:[e.jsx("input",{type:"radio",name:"type",value:"sale",onChange:l,checked:t.type==="sale",className:"text-blue-600"}),e.jsx("span",{className:"font-medium",children:"For Sale"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-3 bg-white rounded-lg shadow-sm",children:[e.jsx("input",{type:"radio",name:"type",value:"rent",onChange:l,checked:t.type==="rent",className:"text-blue-600"}),e.jsx("span",{className:"font-medium",children:"For Rent"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Area (sq ft) *"}),e.jsx("input",{type:"number",id:"area",placeholder:"Enter property area in square feet",required:!0,onChange:l,value:t.area,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Area refers to the total built-up area of the property including all rooms, kitchen, bathrooms, and common areas"})]})}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Floor Number *"}),e.jsx("input",{type:"number",id:"floor",placeholder:"Enter floor number (e.g., 0, 1, 2...)",required:!0,min:"0",onChange:l,value:t.floor,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Floor number refers to which floor the property is located on (Ground floor = 0, First floor = 1, Second floor = 2, etc.)"})]})}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Property Age (years) *"}),e.jsx("input",{type:"number",id:"propertyAge",placeholder:"Enter property age in years (0 for new construction)",required:!0,min:"0",onChange:l,value:t.propertyAge,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Property age refers to how many years ago the property was constructed/built"})]})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Details"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Bedrooms"}),e.jsx("input",{type:"number",id:"bedrooms",onChange:l,value:t.bedrooms,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Bathrooms"}),e.jsx("input",{type:"number",id:"bathrooms",onChange:l,value:t.bathrooms,className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Regular Price (â‚¹)"}),e.jsx("input",{type:"number",id:"regularPrice",onChange:l,value:t.regularPrice,placeholder:"Enter price",className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-medium mb-1",children:"Discount Price (â‚¹)"}),e.jsx("input",{type:"number",id:"discountPrice",onChange:l,value:t.discountPrice,placeholder:"Enter discount",className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Features"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:["parking","furnished","offer"].map(s=>e.jsxs("label",{className:"flex items-center space-x-2 p-3 bg-white rounded-lg shadow-sm",children:[e.jsx("input",{type:"checkbox",id:s,onChange:l,checked:t[s],className:"text-blue-600"}),e.jsx("span",{className:"text-gray-700 font-medium capitalize",children:s})]},s))})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Images"}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:"Upload images directly or add image URLs. Supported formats: JPG, PNG, GIF, WebP, SVG (max 5MB each)"}),e.jsxs("div",{className:"space-y-3",children:[t.imageUrls.map((s,r)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",placeholder:`Image URL ${r+1} (e.g., https://example.com/image.jpg)`,value:s||"",onChange:a=>H(r,a.target.value),className:`flex-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${h[r]?"border-red-500":""}`}),e.jsxs("label",{className:"bg-green-500 text-white px-3 py-2 rounded-lg hover:bg-green-600 transition cursor-pointer",children:[v[r]?"Uploading...":"Upload File",e.jsx("input",{type:"file",accept:"image/*",onChange:a=>J(r,a.target.files[0]),className:"hidden",disabled:v[r]})]}),e.jsx("button",{type:"button",onClick:()=>$(r),className:"bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition",title:"Remove this photo",children:"Ã—"})]}),h[r]&&e.jsx("p",{className:"text-red-500 text-sm",children:h[r]}),v[r]&&e.jsx("p",{className:"text-blue-500 text-sm",children:"â³ Uploading image..."})]},r)),e.jsx("button",{type:"button",onClick:()=>c({...t,imageUrls:[...t.imageUrls,""]}),className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition mt-2",children:"Add Photo"})]}),t.imageUrls.some(s=>s)&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-2",children:"Image Preview:"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:t.imageUrls.map((s,r)=>s&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s,alt:"listing",className:"w-full h-24 object-cover rounded-lg",onError:a=>{a.target.src="https://via.placeholder.com/400x300?text=Image+Not+Found",a.target.className="w-full h-24 object-cover rounded-lg opacity-50"}}),e.jsx("button",{onClick:()=>$(r),type:"button",className:"absolute top-0 right-0 bg-red-500 text-white text-xs px-2 py-1 rounded-full hover:bg-red-600 transition",children:"Ã—"})]},s))})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Property Videos"}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:"Upload videos directly or add video URLs. Supported formats: MP4, WebM, OGG, MOV, MKV (max 5MB each)"}),e.jsxs("div",{className:"space-y-3",children:[t.videoUrls.map((s,r)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",placeholder:`Video URL ${r+1} (e.g., https://example.com/video.mp4)`,value:s||"",onChange:a=>K(r,a.target.value),className:`flex-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${f[r]?"border-red-500":""}`}),e.jsxs("label",{className:"bg-green-500 text-white px-3 py-2 rounded-lg hover:bg-green-600 transition cursor-pointer",children:[j[r]?"Uploading...":"Upload File",e.jsx("input",{type:"file",accept:"video/*",onChange:a=>Q(r,a.target.files[0]),className:"hidden",disabled:j[r]})]}),e.jsx("button",{type:"button",onClick:()=>X(r),className:"bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition",title:"Remove this video",children:"Ã—"})]}),f[r]&&e.jsx("p",{className:"text-red-500 text-sm",children:f[r]}),j[r]&&e.jsx("p",{className:"text-blue-500 text-sm",children:"â³ Uploading video..."}),s&&e.jsx("div",{className:"w-full rounded-lg overflow-hidden bg-black",children:e.jsx("div",{className:"relative w-full",style:{paddingTop:"56.25%"},children:e.jsx("video",{src:s,className:"absolute inset-0 w-full h-full object-contain bg-black",controls:!0})})})]},r)),e.jsx("button",{type:"button",onClick:()=>c({...t,videoUrls:[...t.videoUrls,""]}),className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition mt-2",children:"Add Video"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:()=>V(q()),disabled:U,className:"flex-1 bg-gray-500 text-white p-3 rounded-lg hover:bg-gray-600 transition-all transform hover:scale-105 shadow-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:U,className:"flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white p-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all transform hover:scale-105 shadow-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:U?"Creating...":"Create Listing"})]}),L&&e.jsx("p",{className:"text-red-500 text-center",children:L})]})]})})}export{me as default};
