import{u as z,i as B,r as t,y as l,j as e}from"./index-AwWxf1fH.js";const V=()=>{z("Session Management - User Sessions");const{currentUser:H}=B(s=>s.user),[d,C]=t.useState([]),[M,j]=t.useState(!0),[N,v]=t.useState(null),[w,R]=t.useState(null),[h,F]=t.useState(!1),c=t.useRef(null),[g,T]=t.useState("all"),[n,u]=t.useState(1),[f,P]=t.useState(0),[S,p]=t.useState(""),[I,y]=t.useState(!1),[i,b]=t.useState(null);t.useEffect(()=>(m(),()=>{c.current&&clearInterval(c.current)}),[g,n]);const m=async()=>{try{const s=new URLSearchParams({page:n,limit:20,role:g}),o=new AbortController,r=await fetch(`https://urbansetu.onrender.com/api/session-management/admin/all-sessions?${s}`,{credentials:"include",headers:{"Content-Type":"application/json"},signal:o.signal});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const a=await r.json();a.success?(C(a.sessions),P(a.total),R(new Date)):l.error(a.message||"Failed to fetch sessions")}catch(s){console.error("Error fetching sessions:",s),l.error("Failed to fetch sessions")}finally{j(!1)}},U=()=>{F(s=>{const o=!s;return o?c.current=setInterval(()=>{m()},3e4):c.current&&(clearInterval(c.current),c.current=null),o})},$=async(s,o,r)=>{var a;v(s);try{const x=await fetch("https://urbansetu.onrender.com/api/session-management/admin/force-logout",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:o,sessionId:s,reason:r||"Admin action"})});if(!x.ok)throw new Error(`HTTP error! status: ${x.status}`);const k=await x.json();if(k.success){l.success("Session force logged out successfully");const L=(a=document.cookie.split("; ").find(A=>A.startsWith("session_id=")))==null?void 0:a.split("=")[1];if(L&&L===s){try{localStorage.removeItem("accessToken")}catch{}document.cookie="access_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="refresh_token=; Max-Age=0; path=/; SameSite=None; Secure",document.cookie="session_id=; Max-Age=0; path=/; SameSite=None; Secure",window.location.href="/sign-in?error=forced_logout";return}m()}else l.error(k.message||"Failed to force logout session")}catch(x){console.error("Error force logging out session:",x),l.error("Failed to force logout session")}finally{v(null),y(!1),b(null),p("")}},E=async(s,o)=>{if(window.confirm("Are you sure you want to log out all sessions for this user?"))try{const r=await fetch("https://urbansetu.onrender.com/api/session-management/admin/force-logout-all",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:s,reason:o||"Admin action"})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const a=await r.json();a.success?(l.success(a.message),m()):l.error(a.message||"Failed to force logout all sessions")}catch(r){console.error("Error force logging out all sessions:",r),l.error("Failed to force logout all sessions")}},D=s=>{b(s),y(!0)},O=s=>new Date(s).toLocaleString(),_=s=>s.includes("Mobile")||s.includes("Android")||s.includes("iPhone")||s.includes("iPad")?"ðŸ“±":s.includes("Windows")||s.includes("Mac")?"ðŸ’»":s.includes("Linux")?"ðŸ–¥ï¸":"ðŸ’»",W=s=>{switch(s){case"rootadmin":return"bg-red-100 text-red-800";case"admin":return"bg-blue-100 text-blue-800";case"user":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return M?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading sessions..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 py-8",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col space-y-4 sm:flex-row sm:items-center sm:justify-between sm:space-y-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"Session Management"}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm sm:text-base",children:"Monitor and manage user sessions across the platform"})]}),e.jsxs("div",{className:"flex flex-col space-y-3 sm:flex-row sm:items-center sm:space-y-0 sm:space-x-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>{j(!0),m()},className:"flex-1 sm:flex-none inline-flex items-center justify-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:"Refresh sessions",children:[e.jsx("svg",{className:"h-4 w-4 sm:mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v6h6M20 20v-6h-6M20 8a8 8 0 10-3.879 6.804"})}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"})]}),e.jsxs("button",{onClick:U,className:`flex-1 sm:flex-none inline-flex items-center justify-center px-3 py-2 border ${h?"border-green-300 text-green-700":"border-gray-300 text-gray-700"} shadow-sm text-sm leading-4 font-medium rounded-md bg-white hover:bg-gray-50`,title:"Auto refresh every 30s",children:[e.jsx("svg",{className:`h-4 w-4 sm:mr-2 ${h?"text-green-600":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"hidden sm:inline",children:h?"Auto: On":"Auto: Off"})]})]}),e.jsxs("div",{className:"text-center sm:text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Active Sessions"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-blue-600",children:f}),w&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Updated ",w.toLocaleTimeString()]})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role-filter",className:"block text-sm font-medium text-gray-700",children:"Filter by Role"}),e.jsxs("select",{id:"role-filter",value:g,onChange:s=>T(s.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"user",children:"Users"}),e.jsx("option",{value:"admin",children:"Admins"}),e.jsx("option",{value:"rootadmin",children:"Root Admins"})]})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Page ",n," â€¢ ",d.length," sessions shown"]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Active Sessions"})}),d.length===0?e.jsxs("div",{className:"px-6 py-12 text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No active sessions"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"No sessions found for the selected filters."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Device"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"IP Address"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Location"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Active"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s.username.charAt(0).toUpperCase()})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.username}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${W(s.role)}`,children:s.role})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-lg mr-2",children:_(s.device)}),e.jsx("span",{className:"text-sm text-gray-900",children:s.isCurrent?`${s.device} (This Device)`:s.device})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.ip}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.location}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:O(s.lastActive)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>D(s),disabled:N===s.sessionId,className:"text-red-600 hover:text-red-900 disabled:opacity-50",children:N===s.sessionId?"Logging out...":"Force Logout"}),e.jsx("button",{onClick:()=>E(s.userId,"Admin action"),className:"text-orange-600 hover:text-orange-900",children:"Logout All"})]})})]},s.sessionId))})]})})]}),f>20&&e.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6 mt-6 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>u(Math.max(1,n-1)),disabled:n===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>u(n+1),disabled:d.length<20,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing page ",e.jsx("span",{className:"font-medium",children:n})," of"," ",e.jsx("span",{className:"font-medium",children:Math.ceil(f/20)})]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[e.jsx("button",{onClick:()=>u(Math.max(1,n-1)),disabled:n===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>u(n+1),disabled:d.length<20,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:"Next"})]})})]})]})]}),I&&i&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Force Logout Session"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["User: ",e.jsx("strong",{children:i.username})," (",i.email,")"]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Device: ",i.device]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["IP: ",i.ip]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"reason",className:"block text-sm font-medium text-gray-700",children:"Reason (optional)"}),e.jsx("input",{type:"text",id:"reason",value:S,onChange:s=>p(s.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Enter reason for force logout"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{y(!1),b(null),p("")},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200",children:"Cancel"}),e.jsx("button",{onClick:()=>$(i.sessionId,i.userId,S),className:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700",children:"Force Logout"})]})]})})})]})};export{V as default};
